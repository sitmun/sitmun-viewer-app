var SITNA;(()=>{var __webpack_modules__={837:(t,e,n)=>{var r={"./Attribution":7738,"./Attribution.js":7738,"./BasemapSelector":1370,"./BasemapSelector.js":1370,"./CacheBuilder":9014,"./CacheBuilder.js":9014,"./Click":1432,"./Click.js":1432,"./Container":2273,"./Container.js":2273,"./ControlContainer":9306,"./ControlContainer.js":9306,"./Coordinates":1977,"./Coordinates.js":1977,"./DataLoader":3192,"./DataLoader.js":3192,"./Download":5153,"./Download.js":5153,"./Draw":2791,"./Draw.js":2791,"./DrawMeasureModify":4313,"./DrawMeasureModify.js":4313,"./Edit":3054,"./Edit.js":3054,"./Elevation":2890,"./Elevation.js":2890,"./ExternalWMS":7648,"./ExternalWMS.js":7648,"./FeatureDownloadDialog":5539,"./FeatureDownloadDialog.js":5539,"./FeatureInfo":8144,"./FeatureInfo.js":8144,"./FeatureInfoCommons":128,"./FeatureInfoCommons.js":128,"./FeatureTools":8703,"./FeatureTools.js":8703,"./FileEdit":3908,"./FileEdit.js":3908,"./FileImport":7757,"./FileImport.js":7757,"./FullScreen":1115,"./FullScreen.js":1115,"./Geolocation":8924,"./Geolocation.js":8924,"./GeometryFeatureInfo":8410,"./GeometryFeatureInfo.js":8410,"./LanguageSelector":8325,"./LanguageSelector.js":8325,"./LayerCatalog":1231,"./LayerCatalog.js":1231,"./Legend":7746,"./Legend.js":7746,"./LineFeatureInfo":3011,"./LineFeatureInfo.js":3011,"./ListTOC":3571,"./ListTOC.js":3571,"./LoadingIndicator":273,"./LoadingIndicator.js":273,"./MapContents":6595,"./MapContents.js":6595,"./MapInfo":2e3,"./MapInfo.js":2e3,"./Measure":3731,"./Measure.js":3731,"./Modify":1797,"./Modify.js":1797,"./MultiFeatureInfo":122,"./MultiFeatureInfo.js":122,"./NavBar":2582,"./NavBar.js":2582,"./NavBarHome":3739,"./NavBarHome.js":3739,"./OfflineMapMaker":2721,"./OfflineMapMaker.js":2721,"./OverviewMap":5277,"./OverviewMap.js":5277,"./PolygonFeatureInfo":8418,"./PolygonFeatureInfo.js":8418,"./Popup":6200,"./Popup.js":6200,"./Print":3905,"./Print.js":3905,"./PrintMap":6145,"./PrintMap.js":6145,"./ProjectionSelector":1926,"./ProjectionSelector.js":1926,"./ResultsPanel":9158,"./ResultsPanel.js":9158,"./SWCacheClient":2197,"./SWCacheClient.js":2197,"./Scale":9555,"./Scale.js":9555,"./ScaleBar":3068,"./ScaleBar.js":3068,"./ScaleSelector":7570,"./ScaleSelector.js":7570,"./Search":907,"./Search.js":907,"./SelectContainer":2780,"./SelectContainer.js":2780,"./Share":956,"./Share.js":956,"./StreetView":1475,"./StreetView.js":1475,"./TOC":3869,"./TOC.js":3869,"./TabContainer":8719,"./TabContainer.js":8719,"./ThreeD":7381,"./ThreeD.js":7381,"./WFSEdit":1373,"./WFSEdit.js":1373,"./WFSQuery":3698,"./WFSQuery.js":3698,"./WebComponentControl":5850,"./WebComponentControl.js":5850,"./WorkLayerManager":8633,"./WorkLayerManager.js":8633,"./infoShare":7901,"./infoShare.js":7901,"./itemToolContainer":7435,"./itemToolContainer.js":7435,"./layerOwner":8330,"./layerOwner.js":8330};function o(t){return i(t).then(n)}function i(t){return Promise.resolve().then((()=>{if(!n.o(r,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return r[t]}))}o.keys=()=>Object.keys(r),o.resolve=i,o.id=837,t.exports=o},8949:(t,e,n)=>{var r={"./Attribution":7738,"./Attribution.js":7738,"./BasemapSelector":1370,"./BasemapSelector.js":1370,"./CacheBuilder":9014,"./CacheBuilder.js":9014,"./Click":1432,"./Click.js":1432,"./Container":2273,"./Container.js":2273,"./ControlContainer":9306,"./ControlContainer.js":9306,"./Coordinates":1977,"./Coordinates.js":1977,"./DataLoader":3192,"./DataLoader.js":3192,"./Download":5153,"./Download.js":5153,"./Draw":2791,"./Draw.js":2791,"./DrawMeasureModify":4313,"./DrawMeasureModify.js":4313,"./Edit":3054,"./Edit.js":3054,"./Elevation":2890,"./Elevation.js":2890,"./ExternalWMS":7648,"./ExternalWMS.js":7648,"./FeatureDownloadDialog":5539,"./FeatureDownloadDialog.js":5539,"./FeatureInfo":8144,"./FeatureInfo.js":8144,"./FeatureInfoCommons":128,"./FeatureInfoCommons.js":128,"./FeatureTools":8703,"./FeatureTools.js":8703,"./FileEdit":3908,"./FileEdit.js":3908,"./FileImport":7757,"./FileImport.js":7757,"./FullScreen":1115,"./FullScreen.js":1115,"./Geolocation":8924,"./Geolocation.js":8924,"./GeometryFeatureInfo":8410,"./GeometryFeatureInfo.js":8410,"./LanguageSelector":8325,"./LanguageSelector.js":8325,"./LayerCatalog":1231,"./LayerCatalog.js":1231,"./Legend":7746,"./Legend.js":7746,"./LineFeatureInfo":3011,"./LineFeatureInfo.js":3011,"./ListTOC":3571,"./ListTOC.js":3571,"./LoadingIndicator":273,"./LoadingIndicator.js":273,"./MapContents":6595,"./MapContents.js":6595,"./MapInfo":2e3,"./MapInfo.js":2e3,"./Measure":3731,"./Measure.js":3731,"./Modify":1797,"./Modify.js":1797,"./MultiFeatureInfo":122,"./MultiFeatureInfo.js":122,"./NavBar":2582,"./NavBar.js":2582,"./NavBarHome":3739,"./NavBarHome.js":3739,"./OfflineMapMaker":2721,"./OfflineMapMaker.js":2721,"./OverviewMap":5277,"./OverviewMap.js":5277,"./PolygonFeatureInfo":8418,"./PolygonFeatureInfo.js":8418,"./Popup":6200,"./Popup.js":6200,"./Print":3905,"./Print.js":3905,"./PrintMap":6145,"./PrintMap.js":6145,"./ProjectionSelector":1926,"./ProjectionSelector.js":1926,"./ResultsPanel":9158,"./ResultsPanel.js":9158,"./SWCacheClient":2197,"./SWCacheClient.js":2197,"./Scale":9555,"./Scale.js":9555,"./ScaleBar":3068,"./ScaleBar.js":3068,"./ScaleSelector":7570,"./ScaleSelector.js":7570,"./Search":907,"./Search.js":907,"./SelectContainer":2780,"./SelectContainer.js":2780,"./Share":956,"./Share.js":956,"./StreetView":1475,"./StreetView.js":1475,"./TOC":3869,"./TOC.js":3869,"./TabContainer":8719,"./TabContainer.js":8719,"./ThreeD":7381,"./ThreeD.js":7381,"./WFSEdit":1373,"./WFSEdit.js":1373,"./WFSQuery":3698,"./WFSQuery.js":3698,"./WebComponentControl":5850,"./WebComponentControl.js":5850,"./WorkLayerManager":8633,"./WorkLayerManager.js":8633,"./infoShare":7901,"./infoShare.js":7901,"./itemToolContainer":7435,"./itemToolContainer.js":7435,"./layerOwner":8330,"./layerOwner.js":8330};function o(t){return Promise.resolve().then((()=>{if(!n.o(r,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return n(r[t])}))}o.keys=()=>Object.keys(r),o.id=8949,t.exports=o},1709:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});var r=n(4519);const o="sitna-button";class i extends r.Z{#t;#e=i.variant.DEFAULT;#n=!1;static variant={DEFAULT:"default",ICON:"icon",ICONLEFT:"iconleft",LINK:"link",MINIMAL:"minimal"};static action={CLOSE:"close",DELETE:"delete",DOWNLOAD:"download",DOWNLOAD_ALL:"download_all",EDIT:"edit",SHARE:"share"};constructor(){super();const t=this;t.#t=document.createElement("button"),t.#t.setAttribute("type","button"),t.shadowRoot.appendChild(t.#t)}connectedCallback(){const t=this;t.text=t.text,t.variant=t.variant,t.active=t.active,t.disabled=t.disabled,t.icon=t.icon,t.iconText=t.iconText}static get observedAttributes(){return["text","icon","variant","disabled","active","icon-text"]}attributeChangedCallback(t,e,n){if(e===n)return;const r=this;"disabled"===t?r.disabled=r.hasAttribute(t):"active"===t&&(r.active=r.hasAttribute(t)),e!==n&&("text"===t&&(r.text=n),"icon"===t&&(r.icon=n),"variant"===t&&(r.variant=n),"icon-text"===t&&(r.iconText=n))}get elementName(){return o}get variant(){return this.#e}set variant(t){const e=this;e.#t.classList.remove(e.#e),t&&t!==i.variant.DEFAULT?(e.#t.classList.add(t),e.setAttribute("variant",t)):e.removeAttribute("variant"),t===i.variant.ICON||t===i.variant.MINIMAL||t===i.variant.LINK?e.#t.setAttribute("title",e.text):e.#t.removeAttribute("title"),e.#e=t||i.variant.DEFAULT}get text(){return this.getAttribute("text")}set text(t){this.#t.innerHTML=t,this.setAttribute("text",t)}get iconText(){return this.getAttribute("icon-text")}#r(t,e){const n=this;e?(n.#t.setAttribute("data-"+t,e),n.setAttribute(t,e)):(n.#t.removeAttribute("data-"+t),n.removeAttribute(t))}set iconText(t){this.#r("icon-text",t)}get icon(){return this.getAttribute("icon")}set icon(t){this.#r("icon",t)}get disabled(){return this.hasAttribute("disabled")}set disabled(t){const e=!!t;this.toggleAttribute("disabled",e),this.#t.disabled=e}get active(){return this.#n}set active(t){const e=!!t;this.toggleAttribute("active",e),this.#t.classList.toggle("active",e)}}customElements.define(o,i);const a=i},4519:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var r=n(5361);class o extends HTMLElement{constructor(){super();const t=this;t.attachShadow({mode:"open"});const e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.href=`${r.Z.apiLocation}css/ui/${t.elementName}.css`,t.shadowRoot.appendChild(e)}get elementName(){return"sitna-component"}}const i=o},7106:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});var r=n(4519);const o="sitna-toggle";class i extends r.Z{#o;constructor(){super();const t=this;t.#o=document.createElement("input"),t.#o.setAttribute("type","checkbox"),t.#o.addEventListener("change",(function(e){t.checked=t.#o.checked;const n=new Event("change",{bubbles:!0});t.dispatchEvent(n)})),t.shadowRoot.appendChild(t.#o)}connectedCallback(){const t=this;t.text=t.text,t.checked=t.checked,t.checkedIconText=t.checkedIconText,t.uncheckedIconText=t.uncheckedIconText,t.disabled=t.disabled}static get observedAttributes(){return["text","disabled","checked","checked-icon-text","unchecked-icon-text"]}attributeChangedCallback(t,e,n){if(e===n)return;const r=this;"disabled"===t?r.disabled=r.disabled:"checked"===t&&(r.checked=r.checked),e!==n&&("text"===t&&(r.text=n),"checked-icon-text"===t&&(r.checkedIconText=n),"unchecked-icon-text"===t&&(r.uncheckedIconText=n))}get elementName(){return o}get text(){return this.getAttribute("text")}set text(t){this.#o.setAttribute("title",t),this.setAttribute("text",t)}get checkedIconText(){return this.getAttribute("checked-icon-text")}get uncheckedIconText(){return this.getAttribute("unchecked-icon-text")}#r(t,e){const n=this;e?(n.#o.setAttribute("data-"+t,e),n.setAttribute(t,e)):(n.#o.removeAttribute("data-"+t),n.removeAttribute(t))}set checkedIconText(t){this.#r("checked-icon-text",t)}set uncheckedIconText(t){this.#r("unchecked-icon-text",t)}get checked(){return this.hasAttribute("checked")}set checked(t){const e=!!t;this.toggleAttribute("checked",e),this.#o.checked=e}get disabled(){return this.hasAttribute("disabled")}set disabled(t){const e=!!t;this.toggleAttribute("disabled",e),this.#o.disabled=e}}customElements.define(o,i);const a=i},5361:(t,e,n)=>{"use strict";n.d(e,{Z:()=>_});var r=n(5915),o=n.n(r),i=n(7074),a=a||{};!function(){if(!a.apiLocation){var t;if(document.currentScript)t=document.currentScript;else{var e=document.getElementsByTagName("script");t=e[e.length-1]}var n=t.getAttribute("src");a.apiLocation=n.substr(0,n.lastIndexOf("/")+1)}}(),a.control={},a.capabilities={},a.capabilitiesWFS={},a.describeFeatureType={},a.cache={},"boolean"!=typeof a.isDebug&&(a.isDebug=!0),a.alert=function(t){alert(t)},a.prompt=function(t,e,n){var r=prompt(t,e);a.Util.isFunction(n)&&n(r)},a.confirm=function(t,e,n){confirm(t)?a.Util.isFunction(e)&&e():a.Util.isFunction(n)&&n()},a.error=function(t){window.console&&console.error(t)},a.proxify=function(t){var e=t=t.trim();const n=window.TC.Cfg.proxy;if(n){var r=!1;const i=window.TC.Cfg.proxyExceptions;if(i)for(var o=0;o<i.length;o++)if(t.indexOf(i[o])>-1){r=!0;break}r||a.Util.isSameOrigin(t)||("function"==typeof n?e=n(t):(e=n,"http"!==t.substr(0,4)&&(e+=window.location.protocol),e+=encodeURIComponent(t)))}return e};var s=function(t){let e="";try{throw new Error}catch(t){e=t&&t.stack?t.stack:t.toString()}const n=a.Map.get(document.querySelector("."+a.Consts.classes.MAP)),r="Error al cargar "+t,o=a.Util.getLocaleString(n?n.options.locale:"es-ES","urlFailedToLoad",{url:t});a.error(o,[a.Consts.msgErrorMode.TOAST],r),a.error(`${o}. Pila de la llamada al recurso: \n${e&&e.length>0?e:""}`,[a.Consts.msgErrorMode.EMAIL],r)};a.syncLoadJS=function(t){var e=function(t,e){var n,r=new XMLHttpRequest;r.open("GET",t,!1),r.onreadystatechange=function(t){4===r.readyState&&(404===r.status?(n=!1,e(!0)):200!==r.status?(e(),n=!1):n=r.responseText)};try{r.send(null)}catch(t){n=!1,e()}return n};/(\.js|\/)$/i.test(t)||(t+=a.isDebug?".js":".min.js");var n,r,o,i=e(t,(function(n){return n?(s(t),!1):e(t,(function(){s(t)}))}));if(i){var l=document.createElement("script");l.type="text/javascript",l.text=i,(r=document,o=r.getElementsByTagName("head"),0===o.length?(n=r.createElement("head"),r.documentElement.insertBefore(n,document.body)):n=o[0],n).appendChild(l)}},a.loadJSInOrder=function(t,e,n){a.loadJS(t,e,n,!0)};const l=function(t,e){a.Util.isSameOrigin(t)||(e.crossOrigin="anonymous")};a.loadJS=function(t,e,n,r,i){arguments.length<4&&(r=!1);var c=Array.isArray(e)?e:[e];if(c=c.map((function(t){return/\.js$/i.test(t)||0!==t.indexOf(a.apiLocation)?t:t+(a.isDebug?".js":".min.js")})),t){var u="";const t=function(t){return t.split("/").reverse().slice(0,2).reverse().join("_").toLowerCase()};if((c=c instanceof Array?c:[c]).length>1){var p=c.slice(0).filter((function(e,r){return!o().isDefined(t(e))||(c.splice(r,1),o().ready(t(e),n),!1)}));1===p.length?u=t(p[0]):p.length>0&&(u=p.reduce((function(e,n){return t(e)+"_"+t(n)})))}else u=t(c[0]);if(u.length>0)if(o().isDefined(u))o().ready(u,n);else{var d={async:!r,numRetries:1};i||a.Util.detectIE()||(d.before=l),o()(c,u,d),o().ready(u,{success:function(){n()},error:function(t){s(t)}})}}else n()},a.loadCSS=function(t){const e=t.split("/").reverse().slice(0,2).reverse().join("_").toLowerCase();o().isDefined(e)?o().ready(e,{}):o()(t,e,{error:function(t){s(t)},numRetries:1})},a.ajax=function(t){return new Promise((function(e,n){const r=(t=t||{}).method||"GET",o="GET"===r;var i;if(t.data)if("string"==typeof t.data)i=t.data;else if("object"==typeof t.data)if(o&&(t.contentType||"boolean"==typeof t.contentType))i=a.Util.getParamString(t.data);else{const e=[];for(var s in t.data)e.push(s+"="+t.data[s].toString());i=e.join("&")}var l=t.url;o&&i&&(l=l+"?"+i),!1===t.cache&&(l+=(l.indexOf("?")<0?"?":"&")+"ts="+Date.now());const c={method:r,headers:new Headers};t.contentType||"boolean"==typeof t.contentType?t.contentType&&c.headers.append("Content-Type",t.contentType+"; charset=UTF-8"):c.headers.append("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),"POST"===r&&(c.body=i),fetch(l,c).then((async r=>{if(r.ok)try{let n;switch(t.responseType){case a.Consts.mimeType.JSON:n=await r.json();break;case a.Consts.mimeType.XML:n=await r.text(),n=(new DOMParser).parseFromString(n,"application/xml");break;default:n=await r.text()}e({data:n,contentType:r.headers.get("Content-type")})}catch(t){n(t)}else n({status:r.status,msg:r.statusText,url:l})})).catch((t=>n(t)))}))};var c={};a.getProjectionData=function(t){const e=((t=t||{}).crs||"").match(/\d{4,5}$/g);let n=e?e[0]:"";const r=a.Consts.url.EPSG+"?format=json&q="+n;let o=c[n];if(o)return t.sync?o:Promise.resolve(o);if(t.sync){let t;const e=new XMLHttpRequest;e.onreadystatechange=function(n){4==e.readyState&&(t=404!=e.status&&(200==e.status&&e.responseText))},e.open("GET",r,!1);try{e.send(null)}catch(e){t=!1}return t&&(t=JSON.parse(t)),t}return new Promise((function(e,o){new a.tool.Proxification(a.proxify).fetchJSON(r,t).then((function(t){c[n]=t,e(t)})).catch((function(t){o(t instanceof Error?t:Error(t))}))}))},a.loadProjDef=function(t){const e=(t=t||{}).crs,n="urn:ogc:def:crs:EPSG::",r="http://www.opengis.net/gml/srs/epsg.xml#";var o;o=function(t){return t=function(t){var e=/http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/\d\/(\d{4,5})/.exec(t);return e&&2===e.length?n+e[1]:t}(t),i.Z.defs(t)};const s=function(t){return"function"==typeof t},l=function(s,l,c){const u="EPSG:"+s,p=n+s,d="urn:x-ogc:def:crs:EPSG:"+s,h=r+s,f="http://www.opengis.net/def/crs/EPSG/0/"+s;var m;"object"==typeof l?(m=a.Util.extend({},l),l=a.Util.extend({},l),m.axis&&delete m.axis):"string"==typeof l&&(m=l.replace("+axis=neu","")),i.Z.defs(u,l),i.Z.defs(p,l),i.Z.defs(d,l),i.Z.defs(h,m),i.Z.defs(f,l),0===e.indexOf(r)&&(i.Z.defs(e,m),o(e).name=c),window.ol&&ol.proj&&!t.silent&&ol.proj.proj4.register(i.Z),o(u).name=c,o(h).name=c,o(f).name=c};var c=e.lastIndexOf("#");c<0&&(c=e.lastIndexOf("/")),c<0&&(c=e.lastIndexOf(":"));var u=e.substr(c+1),p=o(e);if(p)l(u,p,t.name),s(t.callback)&&t.callback();else if(t.def)l(u,t.def,t.name),s(t.callback)&&t.callback();else{const e=function(e){(function(t){const e=t&&"ok"===t.status&&1===t.number_result;if(e){var n=t.results[0];l(n.code,n.proj4,n.name)}return e})(e)&&s(t.callback)&&t.callback()};if(t.sync){e(a.getProjectionData(t))}else a.getProjectionData(t).then(e).catch((t=>console.error(t)))}},a.inherit=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t._super=e.prototype},a.mix=function(t,...e){Object.assign(t.prototype,...e)};const u=new Map;a.getUID=function(t){const e=t||{},n=e.prefix||"";let r=u.get(n);r||(r=1);var o=n+r;return u.set(n,r+1),e.banlist&&e.banlist.includes(o)?a.getUID(t):o},a.setUIDStart=function(t,e){const n=(e||{}).prefix||"";let r=u.get(n);return r||(r=1),t>r?(u.set(n,t),t):r};const p=["","-webkit-","-moz-","-o-","-ms-"],d="http://sitna.tracasa.es/";var h,f,m;a.browserFeatures={touch:function(){if(void 0===h){if("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)return h=!0,!0;const t=p.map((function(t){return"("+t+"touch-enabled)"})).join();h=matchMedia(t).matches}return h},inputTypeColor:function(){if(void 0===f){const t=document.createElement("input");t.setAttribute("type","color"),(f="text"!==t.type&&"style"in t)&&(t.value=":-)",f=":-)"!==t.value)}return f},urlParser:function(){if(void 0===m)try{const t=new URL(d);m=t.href===d}catch(t){m=!1}return m}};const g=/\+/g;function y(t){return t}function v(t){return decodeURIComponent(t.replace(g," "))}a.cookie=function(t,e,n){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(e))||null===e)){if(n=a.Util.extend({},n),null===e&&(n.expires=-1),"number"==typeof n.expires){var r=n.expires,o=n.expires=new Date;o.setDate(o.getDate()+r)}return e=String(e),document.cookie=[encodeURIComponent(t),"=",n.raw?e:encodeURIComponent(e),n.expires?";expires="+n.expires.toUTCString():"",n.path?";path="+n.path:"",n.domain?";domain="+n.domain:"",n.secure?";secure":""].join("")}for(var i,s=(n=e||{}).raw?y:v,l=document.cookie.split("; "),c=0;i=l[c]&&l[c].split("=");c++)if(s(i.shift())===t)return s(i.join("="));return null};const _=a},5155:(t,e)=>{"use strict";e.byteLength=function(t){var e=l(t),n=e[0],r=e[1];return 3*(n+r)/4-r},e.toByteArray=function(t){var e,n,i=l(t),a=i[0],s=i[1],c=new o(function(t,e,n){return 3*(e+n)/4-n}(0,a,s)),u=0,p=s>0?a-4:a;for(n=0;n<p;n+=4)e=r[t.charCodeAt(n)]<<18|r[t.charCodeAt(n+1)]<<12|r[t.charCodeAt(n+2)]<<6|r[t.charCodeAt(n+3)],c[u++]=e>>16&255,c[u++]=e>>8&255,c[u++]=255&e;2===s&&(e=r[t.charCodeAt(n)]<<2|r[t.charCodeAt(n+1)]>>4,c[u++]=255&e);1===s&&(e=r[t.charCodeAt(n)]<<10|r[t.charCodeAt(n+1)]<<4|r[t.charCodeAt(n+2)]>>2,c[u++]=e>>8&255,c[u++]=255&e);return c},e.fromByteArray=function(t){for(var e,r=t.length,o=r%3,i=[],a=16383,s=0,l=r-o;s<l;s+=a)i.push(c(t,s,s+a>l?l:s+a));1===o?(e=t[r-1],i.push(n[e>>2]+n[e<<4&63]+"==")):2===o&&(e=(t[r-2]<<8)+t[r-1],i.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"="));return i.join("")};for(var n=[],r=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,s=i.length;a<s;++a)n[a]=i[a],r[i.charCodeAt(a)]=a;function l(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function c(t,e,r){for(var o,i,a=[],s=e;s<r;s+=3)o=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),a.push(n[(i=o)>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return a.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},2486:(t,e,n)=>{"use strict";
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */const r=n(5155),o=n(4525),i="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=l,e.SlowBuffer=function(t){+t!=t&&(t=0);return l.alloc(+t)},e.INSPECT_MAX_BYTES=50;const a=2147483647;function s(t){if(t>a)throw new RangeError('The value "'+t+'" is invalid for option "size"');const e=new Uint8Array(t);return Object.setPrototypeOf(e,l.prototype),e}function l(t,e,n){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return p(t)}return c(t,e,n)}function c(t,e,n){if("string"==typeof t)return function(t,e){"string"==typeof e&&""!==e||(e="utf8");if(!l.isEncoding(e))throw new TypeError("Unknown encoding: "+e);const n=0|m(t,e);let r=s(n);const o=r.write(t,e);o!==n&&(r=r.slice(0,o));return r}(t,e);if(ArrayBuffer.isView(t))return function(t){if(K(t,Uint8Array)){const e=new Uint8Array(t);return h(e.buffer,e.byteOffset,e.byteLength)}return d(t)}(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(K(t,ArrayBuffer)||t&&K(t.buffer,ArrayBuffer))return h(t,e,n);if("undefined"!=typeof SharedArrayBuffer&&(K(t,SharedArrayBuffer)||t&&K(t.buffer,SharedArrayBuffer)))return h(t,e,n);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');const r=t.valueOf&&t.valueOf();if(null!=r&&r!==t)return l.from(r,e,n);const o=function(t){if(l.isBuffer(t)){const e=0|f(t.length),n=s(e);return 0===n.length||t.copy(n,0,0,e),n}if(void 0!==t.length)return"number"!=typeof t.length||X(t.length)?s(0):d(t);if("Buffer"===t.type&&Array.isArray(t.data))return d(t.data)}(t);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return l.from(t[Symbol.toPrimitive]("string"),e,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function u(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function p(t){return u(t),s(t<0?0:0|f(t))}function d(t){const e=t.length<0?0:0|f(t.length),n=s(e);for(let r=0;r<e;r+=1)n[r]=255&t[r];return n}function h(t,e,n){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(n||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===e&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,e):new Uint8Array(t,e,n),Object.setPrototypeOf(r,l.prototype),r}function f(t){if(t>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return 0|t}function m(t,e){if(l.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||K(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);const n=t.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let o=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return V(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return z(t).length;default:if(o)return r?-1:V(t).length;e=(""+e).toLowerCase(),o=!0}}function g(t,e,n){let r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return x(this,e,n);case"utf8":case"utf-8":return T(this,e,n);case"ascii":return A(this,e,n);case"latin1":case"binary":return O(this,e,n);case"base64":return L(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function y(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function v(t,e,n,r,o){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),X(n=+n)&&(n=o?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(o)return-1;n=t.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof e&&(e=l.from(e,r)),l.isBuffer(e))return 0===e.length?-1:_(t,e,n,r,o);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):_(t,[e],n,r,o);throw new TypeError("val must be string, number or Buffer")}function _(t,e,n,r,o){let i,a=1,s=t.length,l=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;a=2,s/=2,l/=2,n/=2}function c(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(o){let r=-1;for(i=n;i<s;i++)if(c(t,i)===c(e,-1===r?0:i-r)){if(-1===r&&(r=i),i-r+1===l)return r*a}else-1!==r&&(i-=i-r),r=-1}else for(n+l>s&&(n=s-l),i=n;i>=0;i--){let n=!0;for(let r=0;r<l;r++)if(c(t,i+r)!==c(e,r)){n=!1;break}if(n)return i}return-1}function C(t,e,n,r){n=Number(n)||0;const o=t.length-n;r?(r=Number(r))>o&&(r=o):r=o;const i=e.length;let a;for(r>i/2&&(r=i/2),a=0;a<r;++a){const r=parseInt(e.substr(2*a,2),16);if(X(r))return a;t[n+a]=r}return a}function E(t,e,n,r){return Y(V(e,t.length-n),t,n,r)}function w(t,e,n,r){return Y(function(t){const e=[];for(let n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function S(t,e,n,r){return Y(z(e),t,n,r)}function b(t,e,n,r){return Y(function(t,e){let n,r,o;const i=[];for(let a=0;a<t.length&&!((e-=2)<0);++a)n=t.charCodeAt(a),r=n>>8,o=n%256,i.push(o),i.push(r);return i}(e,t.length-n),t,n,r)}function L(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function T(t,e,n){n=Math.min(t.length,n);const r=[];let o=e;for(;o<n;){const e=t[o];let i=null,a=e>239?4:e>223?3:e>191?2:1;if(o+a<=n){let n,r,s,l;switch(a){case 1:e<128&&(i=e);break;case 2:n=t[o+1],128==(192&n)&&(l=(31&e)<<6|63&n,l>127&&(i=l));break;case 3:n=t[o+1],r=t[o+2],128==(192&n)&&128==(192&r)&&(l=(15&e)<<12|(63&n)<<6|63&r,l>2047&&(l<55296||l>57343)&&(i=l));break;case 4:n=t[o+1],r=t[o+2],s=t[o+3],128==(192&n)&&128==(192&r)&&128==(192&s)&&(l=(15&e)<<18|(63&n)<<12|(63&r)<<6|63&s,l>65535&&l<1114112&&(i=l))}}null===i?(i=65533,a=1):i>65535&&(i-=65536,r.push(i>>>10&1023|55296),i=56320|1023&i),r.push(i),o+=a}return function(t){const e=t.length;if(e<=P)return String.fromCharCode.apply(String,t);let n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=P));return n}(r)}e.kMaxLength=a,l.TYPED_ARRAY_SUPPORT=function(){try{const t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),l.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,l.from=function(t,e,n){return c(t,e,n)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(t,e,n){return function(t,e,n){return u(t),t<=0?s(t):void 0!==e?"string"==typeof n?s(t).fill(e,n):s(t).fill(e):s(t)}(t,e,n)},l.allocUnsafe=function(t){return p(t)},l.allocUnsafeSlow=function(t){return p(t)},l.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==l.prototype},l.compare=function(t,e){if(K(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),K(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(t)||!l.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let n=t.length,r=e.length;for(let o=0,i=Math.min(n,r);o<i;++o)if(t[o]!==e[o]){n=t[o],r=e[o];break}return n<r?-1:r<n?1:0},l.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return l.alloc(0);let n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;const r=l.allocUnsafe(e);let o=0;for(n=0;n<t.length;++n){let e=t[n];if(K(e,Uint8Array))o+e.length>r.length?(l.isBuffer(e)||(e=l.from(e)),e.copy(r,o)):Uint8Array.prototype.set.call(r,e,o);else{if(!l.isBuffer(e))throw new TypeError('"list" argument must be an Array of Buffers');e.copy(r,o)}o+=e.length}return r},l.byteLength=m,l.prototype._isBuffer=!0,l.prototype.swap16=function(){const t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)y(this,e,e+1);return this},l.prototype.swap32=function(){const t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)y(this,e,e+3),y(this,e+1,e+2);return this},l.prototype.swap64=function(){const t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)y(this,e,e+7),y(this,e+1,e+6),y(this,e+2,e+5),y(this,e+3,e+4);return this},l.prototype.toString=function(){const t=this.length;return 0===t?"":0===arguments.length?T(this,0,t):g.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(t){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===l.compare(this,t)},l.prototype.inspect=function(){let t="";const n=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(t+=" ... "),"<Buffer "+t+">"},i&&(l.prototype[i]=l.prototype.inspect),l.prototype.compare=function(t,e,n,r,o){if(K(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),e<0||n>t.length||r<0||o>this.length)throw new RangeError("out of range index");if(r>=o&&e>=n)return 0;if(r>=o)return-1;if(e>=n)return 1;if(this===t)return 0;let i=(o>>>=0)-(r>>>=0),a=(n>>>=0)-(e>>>=0);const s=Math.min(i,a),c=this.slice(r,o),u=t.slice(e,n);for(let t=0;t<s;++t)if(c[t]!==u[t]){i=c[t],a=u[t];break}return i<a?-1:a<i?1:0},l.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},l.prototype.indexOf=function(t,e,n){return v(this,t,e,n,!0)},l.prototype.lastIndexOf=function(t,e,n){return v(this,t,e,n,!1)},l.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}const o=this.length-e;if((void 0===n||n>o)&&(n=o),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let i=!1;for(;;)switch(r){case"hex":return C(this,t,e,n);case"utf8":case"utf-8":return E(this,t,e,n);case"ascii":case"latin1":case"binary":return w(this,t,e,n);case"base64":return S(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,t,e,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const P=4096;function A(t,e,n){let r="";n=Math.min(t.length,n);for(let o=e;o<n;++o)r+=String.fromCharCode(127&t[o]);return r}function O(t,e,n){let r="";n=Math.min(t.length,n);for(let o=e;o<n;++o)r+=String.fromCharCode(t[o]);return r}function x(t,e,n){const r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);let o="";for(let r=e;r<n;++r)o+=$[t[r]];return o}function I(t,e,n){const r=t.slice(e,n);let o="";for(let t=0;t<r.length-1;t+=2)o+=String.fromCharCode(r[t]+256*r[t+1]);return o}function M(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function R(t,e,n,r,o,i){if(!l.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>o||e<i)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function Z(t,e,n,r,o){j(e,r,o,t,n,7);let i=Number(e&BigInt(4294967295));t[n++]=i,i>>=8,t[n++]=i,i>>=8,t[n++]=i,i>>=8,t[n++]=i;let a=Number(e>>BigInt(32)&BigInt(4294967295));return t[n++]=a,a>>=8,t[n++]=a,a>>=8,t[n++]=a,a>>=8,t[n++]=a,n}function D(t,e,n,r,o){j(e,r,o,t,n,7);let i=Number(e&BigInt(4294967295));t[n+7]=i,i>>=8,t[n+6]=i,i>>=8,t[n+5]=i,i>>=8,t[n+4]=i;let a=Number(e>>BigInt(32)&BigInt(4294967295));return t[n+3]=a,a>>=8,t[n+2]=a,a>>=8,t[n+1]=a,a>>=8,t[n]=a,n+8}function k(t,e,n,r,o,i){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function N(t,e,n,r,i){return e=+e,n>>>=0,i||k(t,0,n,4),o.write(t,e,n,r,23,4),n+4}function F(t,e,n,r,i){return e=+e,n>>>=0,i||k(t,0,n,8),o.write(t,e,n,r,52,8),n+8}l.prototype.slice=function(t,e){const n=this.length;(t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t);const r=this.subarray(t,e);return Object.setPrototypeOf(r,l.prototype),r},l.prototype.readUintLE=l.prototype.readUIntLE=function(t,e,n){t>>>=0,e>>>=0,n||M(t,e,this.length);let r=this[t],o=1,i=0;for(;++i<e&&(o*=256);)r+=this[t+i]*o;return r},l.prototype.readUintBE=l.prototype.readUIntBE=function(t,e,n){t>>>=0,e>>>=0,n||M(t,e,this.length);let r=this[t+--e],o=1;for(;e>0&&(o*=256);)r+=this[t+--e]*o;return r},l.prototype.readUint8=l.prototype.readUInt8=function(t,e){return t>>>=0,e||M(t,1,this.length),this[t]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(t,e){return t>>>=0,e||M(t,2,this.length),this[t]|this[t+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(t,e){return t>>>=0,e||M(t,2,this.length),this[t]<<8|this[t+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(t,e){return t>>>=0,e||M(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(t,e){return t>>>=0,e||M(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},l.prototype.readBigUInt64LE=J((function(t){W(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||q(t,this.length-8);const r=e+256*this[++t]+65536*this[++t]+this[++t]*2**24,o=this[++t]+256*this[++t]+65536*this[++t]+n*2**24;return BigInt(r)+(BigInt(o)<<BigInt(32))})),l.prototype.readBigUInt64BE=J((function(t){W(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||q(t,this.length-8);const r=e*2**24+65536*this[++t]+256*this[++t]+this[++t],o=this[++t]*2**24+65536*this[++t]+256*this[++t]+n;return(BigInt(r)<<BigInt(32))+BigInt(o)})),l.prototype.readIntLE=function(t,e,n){t>>>=0,e>>>=0,n||M(t,e,this.length);let r=this[t],o=1,i=0;for(;++i<e&&(o*=256);)r+=this[t+i]*o;return o*=128,r>=o&&(r-=Math.pow(2,8*e)),r},l.prototype.readIntBE=function(t,e,n){t>>>=0,e>>>=0,n||M(t,e,this.length);let r=e,o=1,i=this[t+--r];for(;r>0&&(o*=256);)i+=this[t+--r]*o;return o*=128,i>=o&&(i-=Math.pow(2,8*e)),i},l.prototype.readInt8=function(t,e){return t>>>=0,e||M(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},l.prototype.readInt16LE=function(t,e){t>>>=0,e||M(t,2,this.length);const n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(t,e){t>>>=0,e||M(t,2,this.length);const n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(t,e){return t>>>=0,e||M(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},l.prototype.readInt32BE=function(t,e){return t>>>=0,e||M(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},l.prototype.readBigInt64LE=J((function(t){W(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||q(t,this.length-8);const r=this[t+4]+256*this[t+5]+65536*this[t+6]+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+this[++t]*2**24)})),l.prototype.readBigInt64BE=J((function(t){W(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||q(t,this.length-8);const r=(e<<24)+65536*this[++t]+256*this[++t]+this[++t];return(BigInt(r)<<BigInt(32))+BigInt(this[++t]*2**24+65536*this[++t]+256*this[++t]+n)})),l.prototype.readFloatLE=function(t,e){return t>>>=0,e||M(t,4,this.length),o.read(this,t,!0,23,4)},l.prototype.readFloatBE=function(t,e){return t>>>=0,e||M(t,4,this.length),o.read(this,t,!1,23,4)},l.prototype.readDoubleLE=function(t,e){return t>>>=0,e||M(t,8,this.length),o.read(this,t,!0,52,8)},l.prototype.readDoubleBE=function(t,e){return t>>>=0,e||M(t,8,this.length),o.read(this,t,!1,52,8)},l.prototype.writeUintLE=l.prototype.writeUIntLE=function(t,e,n,r){if(t=+t,e>>>=0,n>>>=0,!r){R(this,t,e,n,Math.pow(2,8*n)-1,0)}let o=1,i=0;for(this[e]=255&t;++i<n&&(o*=256);)this[e+i]=t/o&255;return e+n},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(t,e,n,r){if(t=+t,e>>>=0,n>>>=0,!r){R(this,t,e,n,Math.pow(2,8*n)-1,0)}let o=n-1,i=1;for(this[e+o]=255&t;--o>=0&&(i*=256);)this[e+o]=t/i&255;return e+n},l.prototype.writeUint8=l.prototype.writeUInt8=function(t,e,n){return t=+t,e>>>=0,n||R(this,t,e,1,255,0),this[e]=255&t,e+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(t,e,n){return t=+t,e>>>=0,n||R(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(t,e,n){return t=+t,e>>>=0,n||R(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(t,e,n){return t=+t,e>>>=0,n||R(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(t,e,n){return t=+t,e>>>=0,n||R(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},l.prototype.writeBigUInt64LE=J((function(t,e=0){return Z(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeBigUInt64BE=J((function(t,e=0){return D(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e>>>=0,!r){const r=Math.pow(2,8*n-1);R(this,t,e,n,r-1,-r)}let o=0,i=1,a=0;for(this[e]=255&t;++o<n&&(i*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+n},l.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e>>>=0,!r){const r=Math.pow(2,8*n-1);R(this,t,e,n,r-1,-r)}let o=n-1,i=1,a=0;for(this[e+o]=255&t;--o>=0&&(i*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/i>>0)-a&255;return e+n},l.prototype.writeInt8=function(t,e,n){return t=+t,e>>>=0,n||R(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},l.prototype.writeInt16LE=function(t,e,n){return t=+t,e>>>=0,n||R(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},l.prototype.writeInt16BE=function(t,e,n){return t=+t,e>>>=0,n||R(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},l.prototype.writeInt32LE=function(t,e,n){return t=+t,e>>>=0,n||R(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},l.prototype.writeInt32BE=function(t,e,n){return t=+t,e>>>=0,n||R(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},l.prototype.writeBigInt64LE=J((function(t,e=0){return Z(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeBigInt64BE=J((function(t,e=0){return D(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeFloatLE=function(t,e,n){return N(this,t,e,!0,n)},l.prototype.writeFloatBE=function(t,e,n){return N(this,t,e,!1,n)},l.prototype.writeDoubleLE=function(t,e,n){return F(this,t,e,!0,n)},l.prototype.writeDoubleBE=function(t,e,n){return F(this,t,e,!1,n)},l.prototype.copy=function(t,e,n,r){if(!l.isBuffer(t))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);const o=r-n;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,n,r):Uint8Array.prototype.set.call(t,this.subarray(n,r),e),o},l.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===t.length){const e=t.charCodeAt(0);("utf8"===r&&e<128||"latin1"===r)&&(t=e)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;let o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{const i=l.isBuffer(t)?t:l.from(t,r),a=i.length;if(0===a)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(o=0;o<n-e;++o)this[o+e]=i[o%a]}return this};const U={};function G(t,e,n){U[t]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,this.stack,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}function B(t){let e="",n=t.length;const r="-"===t[0]?1:0;for(;n>=r+4;n-=3)e=`_${t.slice(n-3,n)}${e}`;return`${t.slice(0,n)}${e}`}function j(t,e,n,r,o,i){if(t>n||t<e){const r="bigint"==typeof e?"n":"";let o;throw o=i>3?0===e||e===BigInt(0)?`>= 0${r} and < 2${r} ** ${8*(i+1)}${r}`:`>= -(2${r} ** ${8*(i+1)-1}${r}) and < 2 ** ${8*(i+1)-1}${r}`:`>= ${e}${r} and <= ${n}${r}`,new U.ERR_OUT_OF_RANGE("value",o,t)}!function(t,e,n){W(e,"offset"),void 0!==t[e]&&void 0!==t[e+n]||q(e,t.length-(n+1))}(r,o,i)}function W(t,e){if("number"!=typeof t)throw new U.ERR_INVALID_ARG_TYPE(e,"number",t)}function q(t,e,n){if(Math.floor(t)!==t)throw W(t,n),new U.ERR_OUT_OF_RANGE(n||"offset","an integer",t);if(e<0)throw new U.ERR_BUFFER_OUT_OF_BOUNDS;throw new U.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${e}`,t)}G("ERR_BUFFER_OUT_OF_BOUNDS",(function(t){return t?`${t} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),G("ERR_INVALID_ARG_TYPE",(function(t,e){return`The "${t}" argument must be of type number. Received type ${typeof e}`}),TypeError),G("ERR_OUT_OF_RANGE",(function(t,e,n){let r=`The value of "${t}" is out of range.`,o=n;return Number.isInteger(n)&&Math.abs(n)>2**32?o=B(String(n)):"bigint"==typeof n&&(o=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(o=B(o)),o+="n"),r+=` It must be ${e}. Received ${o}`,r}),RangeError);const H=/[^+/0-9A-Za-z-_]/g;function V(t,e){let n;e=e||1/0;const r=t.length;let o=null;const i=[];for(let a=0;a<r;++a){if(n=t.charCodeAt(a),n>55295&&n<57344){if(!o){if(n>56319){(e-=3)>-1&&i.push(239,191,189);continue}if(a+1===r){(e-=3)>-1&&i.push(239,191,189);continue}o=n;continue}if(n<56320){(e-=3)>-1&&i.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&(e-=3)>-1&&i.push(239,191,189);if(o=null,n<128){if((e-=1)<0)break;i.push(n)}else if(n<2048){if((e-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function z(t){return r.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(H,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function Y(t,e,n,r){let o;for(o=0;o<r&&!(o+n>=e.length||o>=t.length);++o)e[o+n]=t[o];return o}function K(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function X(t){return t!=t}const $=function(){const t="0123456789abcdef",e=new Array(256);for(let n=0;n<16;++n){const r=16*n;for(let o=0;o<16;++o)e[r+o]=t[n]+t[o]}return e}();function J(t){return"undefined"==typeof BigInt?Q:t}function Q(){throw new Error("BigInt not supported")}},4525:(t,e)=>{
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
e.read=function(t,e,n,r,o){var i,a,s=8*o-r-1,l=(1<<s)-1,c=l>>1,u=-7,p=n?o-1:0,d=n?-1:1,h=t[e+p];for(p+=d,i=h&(1<<-u)-1,h>>=-u,u+=s;u>0;i=256*i+t[e+p],p+=d,u-=8);for(a=i&(1<<-u)-1,i>>=-u,u+=r;u>0;a=256*a+t[e+p],p+=d,u-=8);if(0===i)i=1-c;else{if(i===l)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,r),i-=c}return(h?-1:1)*a*Math.pow(2,i-r)},e.write=function(t,e,n,r,o,i){var a,s,l,c=8*i-o-1,u=(1<<c)-1,p=u>>1,d=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:i-1,f=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=u):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+p>=1?d/l:d*Math.pow(2,1-p))*l>=2&&(a++,l/=2),a+p>=u?(s=0,a=u):a+p>=1?(s=(e*l-1)*Math.pow(2,o),a+=p):(s=e*Math.pow(2,p-1)*Math.pow(2,o),a=0));o>=8;t[n+h]=255&s,h+=f,s/=256,o-=8);for(a=a<<o|s,c+=o;c>0;t[n+h]=255&a,h+=f,a/=256,c-=8);t[n+h-f]|=128*m}},8575:t=>{"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},2641:function(t,e){var n,r=this&&this.__extends||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)};function n(t){if(!t)return n.__;Array.prototype.reduce||(Array.prototype.reduce=function(t,e){for(var n=e,r=0;r<this.length;r++)n=t(n,this[r],r,this);return n});var e="";return("."+t).split(".").reduce((function(t,r,o,i){e?e+="."+r:e=r;var a=t["__"+e];return void 0===a&&(n.Logger.prototype=t,a=new n.Logger(e),t["__"+e]=a),a}),n.__)}!function(t){function e(t,e,n){void 0!==e[t]&&(null!==e[t]?n[t]=e[t]:delete n[t])}function n(e){if(null!=t.enabled&&!t.enabled)return!1;if(null!=t.maxMessages&&t.maxMessages<1)return!1;try{if(e.userAgentRegex&&!new RegExp(e.userAgentRegex).test(navigator.userAgent))return!1}catch(t){}try{if(e.ipRegex&&t.clientIP&&!new RegExp(e.ipRegex).test(t.clientIP))return!1}catch(t){}return!0}function o(t,e){try{if(t.disallow&&new RegExp(t.disallow).test(e))return!1}catch(t){}return!0}function i(t){return"function"==typeof t?t instanceof RegExp?t.toString():t():t}t.requestId="";var a=function(t,e,n){this.msg=t,this.meta=e,this.finalString=n};function s(t){var e,n=i(t);switch(typeof n){case"string":return new a(n,null,n);case"number":case"boolean":return e=n.toString(),new a(e,null,e);case"undefined":return new a("undefined",null,"undefined");case"object":return n instanceof RegExp||n instanceof String||n instanceof Number||n instanceof Boolean?(e=n.toString(),new a(e,null,e)):new a(null,n,JSON.stringify(n));default:return new a("unknown",null,"unknown")}}function l(){return 1e3}function c(){return 2e3}function u(){return 3e3}function p(){return 4e3}function d(){return 5e3}function h(){return 6e3}function f(t){return t<=1e3?"trace":t<=2e3?"debug":t<=3e3?"info":t<=4e3?"warn":t<=5e3?"error":"fatal"}t.setOptions=function(t){return e("enabled",t,this),e("maxMessages",t,this),e("defaultAjaxUrl",t,this),e("clientIP",t,this),e("requestId",t,this),e("defaultBeforeSend",t,this),this},t.getAllLevel=function(){return-2147483648},t.getTraceLevel=l,t.getDebugLevel=c,t.getInfoLevel=u,t.getWarnLevel=p,t.getErrorLevel=d,t.getFatalLevel=h,t.getOffLevel=function(){return 2147483647};var m=function(t,e){this.inner=e,this.name="JL.Exception",this.message=s(t).finalString};t.Exception=m,m.prototype=new Error;var g=function(t,e,n,r){this.l=t,this.m=e,this.n=n,this.t=r};t.LogItem=g;var y=function(){function r(e,n){this.appenderName=e,this.sendLogItems=n,this.level=t.getTraceLevel(),this.sendWithBufferLevel=2147483647,this.storeInBufferLevel=-2147483648,this.bufferSize=0,this.batchSize=1,this.buffer=[],this.batchBuffer=[]}return r.prototype.setOptions=function(t){return e("level",t,this),e("ipRegex",t,this),e("userAgentRegex",t,this),e("disallow",t,this),e("sendWithBufferLevel",t,this),e("storeInBufferLevel",t,this),e("bufferSize",t,this),e("batchSize",t,this),this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize),this},r.prototype.log=function(t,e,r,i,a,s,l){var c;n(this)&&o(this,s)&&(a<this.storeInBufferLevel||(c=new g(a,s,l,(new Date).getTime()),a<this.level?this.bufferSize>0&&(this.buffer.push(c),this.buffer.length>this.bufferSize&&this.buffer.shift()):(a<this.sendWithBufferLevel||this.buffer.length&&(this.batchBuffer=this.batchBuffer.concat(this.buffer),this.buffer.length=0),this.batchBuffer.push(c),this.batchBuffer.length>=this.batchSize&&this.sendBatch())))},r.prototype.sendBatch=function(){0!=this.batchBuffer.length&&(null!=t.maxMessages&&t.maxMessages<1||(null!=t.maxMessages&&(t.maxMessages-=this.batchBuffer.length),this.sendLogItems(this.batchBuffer),this.batchBuffer.length=0))},r}();t.Appender=y;var v=function(n){function o(t){n.call(this,t,o.prototype.sendLogItemsAjax)}return r(o,n),o.prototype.setOptions=function(t){return e("url",t,this),e("beforeSend",t,this),n.prototype.setOptions.call(this,t),this},o.prototype.sendLogItemsAjax=function(e){try{var n="/jsnlog.logger";null!=t.defaultAjaxUrl&&(n=t.defaultAjaxUrl),this.url&&(n=this.url);var r=this.getXhr(n),o={r:t.requestId,lg:e};"function"==typeof this.beforeSend?this.beforeSend.call(this,r,o):"function"==typeof t.defaultBeforeSend&&t.defaultBeforeSend.call(this,r,o);var i=JSON.stringify(o);r.send(i)}catch(t){}},o.prototype.getXhr=function(e){var n=new XMLHttpRequest;if(!("withCredentials"in n)&&"undefined"!=typeof XDomainRequest){var r=new XDomainRequest;return r.open("POST",e),r}return n.open("POST",e),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("JSNLog-RequestId",t.requestId),n},o}(y);t.AjaxAppender=v;var _=function(e){function n(t){e.call(this,t,n.prototype.sendLogItemsConsole)}return r(n,e),n.prototype.clog=function(t){console.log(t)},n.prototype.cerror=function(t){console.error?console.error(t):this.clog(t)},n.prototype.cwarn=function(t){console.warn?console.warn(t):this.clog(t)},n.prototype.cinfo=function(t){console.info?console.info(t):this.clog(t)},n.prototype.cdebug=function(t){console.debug?console.debug(t):this.cinfo(t)},n.prototype.sendLogItemsConsole=function(e){try{if(!console)return;var n;for(n=0;n<e.length;++n){var r=e[n],o=r.n+": "+r.m;"undefined"==typeof window&&(o=new Date(r.t)+" | "+o),r.l<=t.getDebugLevel()?this.cdebug(o):r.l<=t.getInfoLevel()?this.cinfo(o):r.l<=t.getWarnLevel()?this.cwarn(o):this.cerror(o)}}catch(t){}},n}(y);t.ConsoleAppender=_;var C=function(){function t(t){this.loggerName=t,this.seenRegexes=[]}return t.prototype.setOptions=function(t){return e("level",t,this),e("userAgentRegex",t,this),e("disallow",t,this),e("ipRegex",t,this),e("appenders",t,this),e("onceOnly",t,this),this.seenRegexes=[],this},t.prototype.buildExceptionObject=function(t){var e={};return t.stack?e.stack=t.stack:e.e=t,t.message&&(e.message=t.message),t.name&&(e.name=t.name),t.data&&(e.data=t.data),t.inner&&(e.inner=this.buildExceptionObject(t.inner)),e},t.prototype.log=function(t,e,r){var a,l,c=0;if(!this.appenders)return this;if(t>=this.level&&n(this)&&(r?(l=this.buildExceptionObject(r)).logData=i(e):l=e,o(this,(a=s(l)).finalString))){if(this.onceOnly)for(c=this.onceOnly.length-1;c>=0;){if(new RegExp(this.onceOnly[c]).test(a.finalString)){if(this.seenRegexes[c])return this;this.seenRegexes[c]=!0}c--}for(a.meta=a.meta||{},a.meta.loggerName=this.loggerName,c=this.appenders.length-1;c>=0;)this.appenders[c].log(f(t),a.msg,a.meta,(function(){}),t,a.finalString,this.loggerName),c--}return this},t.prototype.trace=function(t){return this.log(1e3,t)},t.prototype.debug=function(t){return this.log(2e3,t)},t.prototype.info=function(t){return this.log(3e3,t)},t.prototype.warn=function(t){return this.log(4e3,t)},t.prototype.error=function(t){return this.log(5e3,t)},t.prototype.fatal=function(t){return this.log(6e3,t)},t.prototype.fatalException=function(t,e){return this.log(6e3,t,e)},t}();t.Logger=C,t.createAjaxAppender=function(t){return new v(t)},t.createConsoleAppender=function(t){return new _(t)};var E=new v("");"undefined"==typeof window&&(E=new _("")),t.__=new t.Logger(""),t.__.setOptions({level:t.getDebugLevel(),appenders:[E]})}(n||(n={})),e.JL=n,"function"==typeof __jsnlog_configure&&__jsnlog_configure(n)},3837:(t,e,n)=>{var r=n(2486).Buffer;
/*!

JSZip v3.7.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/master/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/master/LICENSE
*/t.exports=function t(e,n,r){function o(a,s){if(!n[a]){if(!e[a]){if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[a]={exports:{}};e[a][0].call(c.exports,(function(t){return o(e[a][1][t]||t)}),c,c.exports,t,e,n,r)}return n[a].exports}for(var i=void 0,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,n){"use strict";var r=t("./utils"),o=t("./support"),i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(t){for(var e,n,o,a,s,l,c,u=[],p=0,d=t.length,h=d,f="string"!==r.getTypeOf(t);p<t.length;)h=d-p,o=f?(e=t[p++],n=p<d?t[p++]:0,p<d?t[p++]:0):(e=t.charCodeAt(p++),n=p<d?t.charCodeAt(p++):0,p<d?t.charCodeAt(p++):0),a=e>>2,s=(3&e)<<4|n>>4,l=1<h?(15&n)<<2|o>>6:64,c=2<h?63&o:64,u.push(i.charAt(a)+i.charAt(s)+i.charAt(l)+i.charAt(c));return u.join("")},n.decode=function(t){var e,n,r,a,s,l,c=0,u=0,p="data:";if(t.substr(0,p.length)===p)throw new Error("Invalid base64 input, it looks like a data url.");var d,h=3*(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(t.charAt(t.length-1)===i.charAt(64)&&h--,t.charAt(t.length-2)===i.charAt(64)&&h--,h%1!=0)throw new Error("Invalid base64 input, bad content length.");for(d=o.uint8array?new Uint8Array(0|h):new Array(0|h);c<t.length;)e=i.indexOf(t.charAt(c++))<<2|(a=i.indexOf(t.charAt(c++)))>>4,n=(15&a)<<4|(s=i.indexOf(t.charAt(c++)))>>2,r=(3&s)<<6|(l=i.indexOf(t.charAt(c++))),d[u++]=e,64!==s&&(d[u++]=n),64!==l&&(d[u++]=r);return d}},{"./support":30,"./utils":32}],2:[function(t,e,n){"use strict";var r=t("./external"),o=t("./stream/DataWorker"),i=t("./stream/Crc32Probe"),a=t("./stream/DataLengthProbe");function s(t,e,n,r,o){this.compressedSize=t,this.uncompressedSize=e,this.crc32=n,this.compression=r,this.compressedContent=o}s.prototype={getContentWorker:function(){var t=new o(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),e=this;return t.on("end",(function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),t},getCompressedWorker:function(){return new o(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},s.createWorkerFrom=function(t,e,n){return t.pipe(new i).pipe(new a("uncompressedSize")).pipe(e.compressWorker(n)).pipe(new a("compressedSize")).withStreamInfo("compression",e)},e.exports=s},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,e,n){"use strict";var r=t("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(t){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},n.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,e,n){"use strict";var r=t("./utils"),o=function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}();e.exports=function(t,e){return void 0!==t&&t.length?"string"!==r.getTypeOf(t)?function(t,e,n,r){var i=o,a=r+n;t^=-1;for(var s=r;s<a;s++)t=t>>>8^i[255&(t^e[s])];return-1^t}(0|e,t,t.length,0):function(t,e,n,r){var i=o,a=r+n;t^=-1;for(var s=r;s<a;s++)t=t>>>8^i[255&(t^e.charCodeAt(s))];return-1^t}(0|e,t,t.length,0):0}},{"./utils":32}],5:[function(t,e,n){"use strict";n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(t,e,n){"use strict";var r=null;r="undefined"!=typeof Promise?Promise:t("lie"),e.exports={Promise:r}},{lie:37}],7:[function(t,e,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,o=t("pako"),i=t("./utils"),a=t("./stream/GenericWorker"),s=r?"uint8array":"array";function l(t,e){a.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}n.magic="\b\0",i.inherits(l,a),l.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(i.transformTo(s,t.data),!1)},l.prototype.flush=function(){a.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},n.compressWorker=function(t){return new l("Deflate",t)},n.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,e,n){"use strict";function r(t,e){var n,r="";for(n=0;n<e;n++)r+=String.fromCharCode(255&t),t>>>=8;return r}function o(t,e,n,o,a,u){var p,d,h=t.file,f=t.compression,m=u!==s.utf8encode,g=i.transformTo("string",u(h.name)),y=i.transformTo("string",s.utf8encode(h.name)),v=h.comment,_=i.transformTo("string",u(v)),C=i.transformTo("string",s.utf8encode(v)),E=y.length!==h.name.length,w=C.length!==v.length,S="",b="",L="",T=h.dir,P=h.date,A={crc32:0,compressedSize:0,uncompressedSize:0};e&&!n||(A.crc32=t.crc32,A.compressedSize=t.compressedSize,A.uncompressedSize=t.uncompressedSize);var O=0;e&&(O|=8),m||!E&&!w||(O|=2048);var x=0,I=0;T&&(x|=16),"UNIX"===a?(I=798,x|=function(t,e){var n=t;return t||(n=e?16893:33204),(65535&n)<<16}(h.unixPermissions,T)):(I=20,x|=function(t){return 63&(t||0)}(h.dosPermissions)),p=P.getUTCHours(),p<<=6,p|=P.getUTCMinutes(),p<<=5,p|=P.getUTCSeconds()/2,d=P.getUTCFullYear()-1980,d<<=4,d|=P.getUTCMonth()+1,d<<=5,d|=P.getUTCDate(),E&&(b=r(1,1)+r(l(g),4)+y,S+="up"+r(b.length,2)+b),w&&(L=r(1,1)+r(l(_),4)+C,S+="uc"+r(L.length,2)+L);var M="";return M+="\n\0",M+=r(O,2),M+=f.magic,M+=r(p,2),M+=r(d,2),M+=r(A.crc32,4),M+=r(A.compressedSize,4),M+=r(A.uncompressedSize,4),M+=r(g.length,2),M+=r(S.length,2),{fileRecord:c.LOCAL_FILE_HEADER+M+g+S,dirRecord:c.CENTRAL_FILE_HEADER+r(I,2)+M+r(_.length,2)+"\0\0\0\0"+r(x,4)+r(o,4)+g+S+_}}var i=t("../utils"),a=t("../stream/GenericWorker"),s=t("../utf8"),l=t("../crc32"),c=t("../signature");function u(t,e,n,r){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=n,this.encodeFileName=r,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}i.inherits(u,a),u.prototype.push=function(t){var e=t.meta.percent||0,n=this.entriesCount,r=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,a.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:n?(e+100*(n-r-1))/n:100}}))},u.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var n=o(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,n=o(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(n.dirRecord),e)this.push({data:function(t){return c.DATA_DESCRIPTOR+r(t.crc32,4)+r(t.compressedSize,4)+r(t.uncompressedSize,4)}(t),meta:{percent:100}});else for(this.push({data:n.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var n=this.bytesWritten-t,o=function(t,e,n,o,a){var s=i.transformTo("string",a(o));return c.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(t,2)+r(t,2)+r(e,4)+r(n,4)+r(s.length,2)+s}(this.dirRecords.length,n,t,this.zipComment,this.encodeFileName);this.push({data:o,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",(function(t){e.processChunk(t)})),t.on("end",(function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()})),t.on("error",(function(t){e.error(t)})),this},u.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(t){var e=this._sources;if(!a.prototype.error.call(this,t))return!1;for(var n=0;n<e.length;n++)try{e[n].error(t)}catch(t){}return!0},u.prototype.lock=function(){a.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},e.exports=u},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,e,n){"use strict";var r=t("../compressions"),o=t("./ZipFileWorker");n.generateWorker=function(t,e,n){var i=new o(e.streamFiles,n,e.platform,e.encodeFileName),a=0;try{t.forEach((function(t,n){a++;var o=function(t,e){var n=t||e,o=r[n];if(!o)throw new Error(n+" is not a valid compression method !");return o}(n.options.compression,e.compression),s=n.options.compressionOptions||e.compressionOptions||{},l=n.dir,c=n.date;n._compressWorker(o,s).withStreamInfo("file",{name:t,dir:l,date:c,comment:n.comment||"",unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions}).pipe(i)})),i.entriesCount=a}catch(t){i.error(t)}return i}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,e,n){"use strict";function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var t=new r;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}(r.prototype=t("./object")).loadAsync=t("./load"),r.support=t("./support"),r.defaults=t("./defaults"),r.version="3.7.1",r.loadAsync=function(t,e){return(new r).loadAsync(t,e)},r.external=t("./external"),e.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,e,n){"use strict";var r=t("./utils"),o=t("./external"),i=t("./utf8"),a=t("./zipEntries"),s=t("./stream/Crc32Probe"),l=t("./nodejsUtils");function c(t){return new o.Promise((function(e,n){var r=t.decompressed.getContentWorker().pipe(new s);r.on("error",(function(t){n(t)})).on("end",(function(){r.streamInfo.crc32!==t.decompressed.crc32?n(new Error("Corrupted zip : CRC32 mismatch")):e()})).resume()}))}e.exports=function(t,e){var n=this;return e=r.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:i.utf8decode}),l.isNode&&l.isStream(t)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",t,!0,e.optimizedBinaryString,e.base64).then((function(t){var n=new a(e);return n.load(t),n})).then((function(t){var n=[o.Promise.resolve(t)],r=t.files;if(e.checkCRC32)for(var i=0;i<r.length;i++)n.push(c(r[i]));return o.Promise.all(n)})).then((function(t){for(var r=t.shift(),o=r.files,i=0;i<o.length;i++){var a=o[i];n.file(a.fileNameStr,a.decompressed,{binary:!0,optimizedBinaryString:!0,date:a.date,dir:a.dir,comment:a.fileCommentStr.length?a.fileCommentStr:null,unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions,createFolders:e.createFolders})}return r.zipComment.length&&(n.comment=r.zipComment),n}))}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,e,n){"use strict";var r=t("../utils"),o=t("../stream/GenericWorker");function i(t,e){o.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}r.inherits(i,o),i.prototype._bindStream=function(t){var e=this;(this._stream=t).pause(),t.on("data",(function(t){e.push({data:t,meta:{percent:0}})})).on("error",(function(t){e.isPaused?this.generatedError=t:e.error(t)})).on("end",(function(){e.isPaused?e._upstreamEnded=!0:e.end()}))},i.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},i.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=i},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,e,n){"use strict";var r=t("readable-stream").Readable;function o(t,e,n){r.call(this,e),this._helper=t;var o=this;t.on("data",(function(t,e){o.push(t)||o._helper.pause(),n&&n(e)})).on("error",(function(t){o.emit("error",t)})).on("end",(function(){o.push(null)}))}t("../utils").inherits(o,r),o.prototype._read=function(){this._helper.resume()},e.exports=o},{"../utils":32,"readable-stream":16}],14:[function(t,e,n){"use strict";e.exports={isNode:void 0!==r,newBufferFrom:function(t,e){if(r.from&&r.from!==Uint8Array.from)return r.from(t,e);if("number"==typeof t)throw new Error('The "data" argument must not be a number');return new r(t,e)},allocBuffer:function(t){if(r.alloc)return r.alloc(t);var e=new r(t);return e.fill(0),e},isBuffer:function(t){return r.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}},{}],15:[function(t,e,n){"use strict";function r(t,e,n){var r,o=i.getTypeOf(e),s=i.extend(n||{},l);s.date=s.date||new Date,null!==s.compression&&(s.compression=s.compression.toUpperCase()),"string"==typeof s.unixPermissions&&(s.unixPermissions=parseInt(s.unixPermissions,8)),s.unixPermissions&&16384&s.unixPermissions&&(s.dir=!0),s.dosPermissions&&16&s.dosPermissions&&(s.dir=!0),s.dir&&(t=m(t)),s.createFolders&&(r=f(t))&&g.call(this,r,!0);var p="string"===o&&!1===s.binary&&!1===s.base64;n&&void 0!==n.binary||(s.binary=!p),(e instanceof c&&0===e.uncompressedSize||s.dir||!e||0===e.length)&&(s.base64=!1,s.binary=!0,e="",s.compression="STORE",o="string");var y=null;y=e instanceof c||e instanceof a?e:d.isNode&&d.isStream(e)?new h(t,e):i.prepareContent(t,e,s.binary,s.optimizedBinaryString,s.base64);var v=new u(t,y,s);this.files[t]=v}var o=t("./utf8"),i=t("./utils"),a=t("./stream/GenericWorker"),s=t("./stream/StreamHelper"),l=t("./defaults"),c=t("./compressedObject"),u=t("./zipObject"),p=t("./generate"),d=t("./nodejsUtils"),h=t("./nodejs/NodejsStreamInputAdapter"),f=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return 0<e?t.substring(0,e):""},m=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},g=function(t,e){return e=void 0!==e?e:l.createFolders,t=m(t),this.files[t]||r.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]};function y(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var v={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,n,r;for(e in this.files)r=this.files[e],(n=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(n,r)},filter:function(t){var e=[];return this.forEach((function(n,r){t(n,r)&&e.push(r)})),e},file:function(t,e,n){if(1!==arguments.length)return t=this.root+t,r.call(this,t,e,n),this;if(y(t)){var o=t;return this.filter((function(t,e){return!e.dir&&o.test(t)}))}var i=this.files[this.root+t];return i&&!i.dir?i:null},folder:function(t){if(!t)return this;if(y(t))return this.filter((function(e,n){return n.dir&&t.test(e)}));var e=this.root+t,n=g.call(this,e),r=this.clone();return r.root=n.name,r},remove:function(t){t=this.root+t;var e=this.files[t];if(e||("/"!==t.slice(-1)&&(t+="/"),e=this.files[t]),e&&!e.dir)delete this.files[t];else for(var n=this.filter((function(e,n){return n.name.slice(0,t.length)===t})),r=0;r<n.length;r++)delete this.files[n[r].name];return this},generate:function(t){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,n={};try{if((n=i.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=n.type.toLowerCase(),n.compression=n.compression.toUpperCase(),"binarystring"===n.type&&(n.type="string"),!n.type)throw new Error("No output type specified.");i.checkSupport(n.type),"darwin"!==n.platform&&"freebsd"!==n.platform&&"linux"!==n.platform&&"sunos"!==n.platform||(n.platform="UNIX"),"win32"===n.platform&&(n.platform="DOS");var r=n.comment||this.comment||"";e=p.generateWorker(this,n,r)}catch(t){(e=new a("error")).error(t)}return new s(e,n.type||"string",n.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return(t=t||{}).type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}};e.exports=v},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,e,n){e.exports=t("stream")},{stream:void 0}],17:[function(t,e,n){"use strict";var r=t("./DataReader");function o(t){r.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}t("../utils").inherits(o,r),o.prototype.byteAt=function(t){return this.data[this.zero+t]},o.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),n=t.charCodeAt(1),r=t.charCodeAt(2),o=t.charCodeAt(3),i=this.length-4;0<=i;--i)if(this.data[i]===e&&this.data[i+1]===n&&this.data[i+2]===r&&this.data[i+3]===o)return i-this.zero;return-1},o.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),n=t.charCodeAt(1),r=t.charCodeAt(2),o=t.charCodeAt(3),i=this.readData(4);return e===i[0]&&n===i[1]&&r===i[2]&&o===i[3]},o.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=o},{"../utils":32,"./DataReader":18}],18:[function(t,e,n){"use strict";var r=t("../utils");function o(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(t){},readInt:function(t){var e,n=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)n=(n<<8)+this.byteAt(e);return this.index+=t,n},readString:function(t){return r.transformTo("string",this.readData(t))},readData:function(t){},lastIndexOfSignature:function(t){},readAndCheckSignature:function(t){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},e.exports=o},{"../utils":32}],19:[function(t,e,n){"use strict";var r=t("./Uint8ArrayReader");function o(t){r.call(this,t)}t("../utils").inherits(o,r),o.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,e,n){"use strict";var r=t("./DataReader");function o(t){r.call(this,t)}t("../utils").inherits(o,r),o.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},o.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},o.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},o.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=o},{"../utils":32,"./DataReader":18}],21:[function(t,e,n){"use strict";var r=t("./ArrayReader");function o(t){r.call(this,t)}t("../utils").inherits(o,r),o.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(t,e,n){"use strict";var r=t("../utils"),o=t("../support"),i=t("./ArrayReader"),a=t("./StringReader"),s=t("./NodeBufferReader"),l=t("./Uint8ArrayReader");e.exports=function(t){var e=r.getTypeOf(t);return r.checkSupport(e),"string"!==e||o.uint8array?"nodebuffer"===e?new s(t):o.uint8array?new l(r.transformTo("uint8array",t)):new i(r.transformTo("array",t)):new a(t)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,e,n){"use strict";n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\b"},{}],24:[function(t,e,n){"use strict";var r=t("./GenericWorker"),o=t("../utils");function i(t){r.call(this,"ConvertWorker to "+t),this.destType=t}o.inherits(i,r),i.prototype.processChunk=function(t){this.push({data:o.transformTo(this.destType,t.data),meta:t.meta})},e.exports=i},{"../utils":32,"./GenericWorker":28}],25:[function(t,e,n){"use strict";var r=t("./GenericWorker"),o=t("../crc32");function i(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(i,r),i.prototype.processChunk=function(t){this.streamInfo.crc32=o(t.data,this.streamInfo.crc32||0),this.push(t)},e.exports=i},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,e,n){"use strict";var r=t("../utils"),o=t("./GenericWorker");function i(t){o.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}r.inherits(i,o),i.prototype.processChunk=function(t){if(t){var e=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=e+t.data.length}o.prototype.processChunk.call(this,t)},e.exports=i},{"../utils":32,"./GenericWorker":28}],27:[function(t,e,n){"use strict";var r=t("../utils"),o=t("./GenericWorker");function i(t){o.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then((function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=r.getTypeOf(t),e.isPaused||e._tickAndRepeat()}),(function(t){e.error(t)}))}r.inherits(i,o),i.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},i.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},i.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},i.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,e=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,e);break;case"uint8array":t=this.data.subarray(this.index,e);break;case"array":case"nodebuffer":t=this.data.slice(this.index,e)}return this.index=e,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=i},{"../utils":32,"./GenericWorker":28}],28:[function(t,e,n){"use strict";function r(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var n=0;n<this._listeners[t].length;n++)this._listeners[t][n].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",(function(t){e.processChunk(t)})),t.on("end",(function(){e.end()})),t.on("error",(function(t){e.error(t)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var t=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},e.exports=r},{}],29:[function(t,e,n){"use strict";var o=t("../utils"),i=t("./ConvertWorker"),a=t("./GenericWorker"),s=t("../base64"),l=t("../support"),c=t("../external"),u=null;if(l.nodestream)try{u=t("../nodejs/NodejsStreamOutputAdapter")}catch(t){}function p(t,e){return new c.Promise((function(n,i){var a=[],l=t._internalType,c=t._outputType,u=t._mimeType;t.on("data",(function(t,n){a.push(t),e&&e(n)})).on("error",(function(t){a=[],i(t)})).on("end",(function(){try{var t=function(t,e,n){switch(t){case"blob":return o.newBlob(o.transformTo("arraybuffer",e),n);case"base64":return s.encode(e);default:return o.transformTo(t,e)}}(c,function(t,e){var n,o=0,i=null,a=0;for(n=0;n<e.length;n++)a+=e[n].length;switch(t){case"string":return e.join("");case"array":return Array.prototype.concat.apply([],e);case"uint8array":for(i=new Uint8Array(a),n=0;n<e.length;n++)i.set(e[n],o),o+=e[n].length;return i;case"nodebuffer":return r.concat(e);default:throw new Error("concat : unsupported type '"+t+"'")}}(l,a),u);n(t)}catch(t){i(t)}a=[]})).resume()}))}function d(t,e,n){var r=e;switch(e){case"blob":case"arraybuffer":r="uint8array";break;case"base64":r="string"}try{this._internalType=r,this._outputType=e,this._mimeType=n,o.checkSupport(r),this._worker=t.pipe(new i(r)),t.lock()}catch(t){this._worker=new a("error"),this._worker.error(t)}}d.prototype={accumulate:function(t){return p(this,t)},on:function(t,e){var n=this;return"data"===t?this._worker.on(t,(function(t){e.call(n,t.data,t.meta)})):this._worker.on(t,(function(){o.delay(e,arguments,n)})),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(o.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:"nodebuffer"!==this._outputType},t)}},e.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,e,n){"use strict";if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer=void 0!==r,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var o=new ArrayBuffer(0);try{n.blob=0===new Blob([o],{type:"application/zip"}).size}catch(t){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(o),n.blob=0===i.getBlob("application/zip").size}catch(t){n.blob=!1}}}try{n.nodestream=!!t("readable-stream").Readable}catch(t){n.nodestream=!1}},{"readable-stream":16}],31:[function(t,e,n){"use strict";for(var r=t("./utils"),o=t("./support"),i=t("./nodejsUtils"),a=t("./stream/GenericWorker"),s=new Array(256),l=0;l<256;l++)s[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function c(){a.call(this,"utf-8 decode"),this.leftOver=null}function u(){a.call(this,"utf-8 encode")}s[254]=s[254]=1,n.utf8encode=function(t){return o.nodebuffer?i.newBufferFrom(t,"utf-8"):function(t){var e,n,r,i,a,s=t.length,l=0;for(i=0;i<s;i++)55296==(64512&(n=t.charCodeAt(i)))&&i+1<s&&56320==(64512&(r=t.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=o.uint8array?new Uint8Array(l):new Array(l),i=a=0;a<l;i++)55296==(64512&(n=t.charCodeAt(i)))&&i+1<s&&56320==(64512&(r=t.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),n<128?e[a++]=n:(n<2048?e[a++]=192|n>>>6:(n<65536?e[a++]=224|n>>>12:(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63),e[a++]=128|n>>>6&63),e[a++]=128|63&n);return e}(t)},n.utf8decode=function(t){return o.nodebuffer?r.transformTo("nodebuffer",t).toString("utf-8"):function(t){var e,n,o,i,a=t.length,l=new Array(2*a);for(e=n=0;e<a;)if((o=t[e++])<128)l[n++]=o;else if(4<(i=s[o]))l[n++]=65533,e+=i-1;else{for(o&=2===i?31:3===i?15:7;1<i&&e<a;)o=o<<6|63&t[e++],i--;1<i?l[n++]=65533:o<65536?l[n++]=o:(o-=65536,l[n++]=55296|o>>10&1023,l[n++]=56320|1023&o)}return l.length!==n&&(l.subarray?l=l.subarray(0,n):l.length=n),r.applyFromCharCode(l)}(t=r.transformTo(o.uint8array?"uint8array":"array",t))},r.inherits(c,a),c.prototype.processChunk=function(t){var e=r.transformTo(o.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var i=e;(e=new Uint8Array(i.length+this.leftOver.length)).set(this.leftOver,0),e.set(i,this.leftOver.length)}else e=this.leftOver.concat(e);this.leftOver=null}var a=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;0<=n&&128==(192&t[n]);)n--;return n<0||0===n?e:n+s[t[n]]>e?n:e}(e),l=e;a!==e.length&&(o.uint8array?(l=e.subarray(0,a),this.leftOver=e.subarray(a,e.length)):(l=e.slice(0,a),this.leftOver=e.slice(a,e.length))),this.push({data:n.utf8decode(l),meta:t.meta})},c.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=c,r.inherits(u,a),u.prototype.processChunk=function(t){this.push({data:n.utf8encode(t.data),meta:t.meta})},n.Utf8EncodeWorker=u},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,e,n){"use strict";var r=t("./support"),o=t("./base64"),i=t("./nodejsUtils"),a=t("set-immediate-shim"),s=t("./external");function l(t){return t}function c(t,e){for(var n=0;n<t.length;++n)e[n]=255&t.charCodeAt(n);return e}n.newBlob=function(t,e){n.checkSupport("blob");try{return new Blob([t],{type:e})}catch(n){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return r.append(t),r.getBlob(e)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var u={stringifyByChunk:function(t,e,n){var r=[],o=0,i=t.length;if(i<=n)return String.fromCharCode.apply(null,t);for(;o<i;)"array"===e||"nodebuffer"===e?r.push(String.fromCharCode.apply(null,t.slice(o,Math.min(o+n,i)))):r.push(String.fromCharCode.apply(null,t.subarray(o,Math.min(o+n,i)))),o+=n;return r.join("")},stringifyByChar:function(t){for(var e="",n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&1===String.fromCharCode.apply(null,i.allocBuffer(1)).length}catch(t){return!1}}()}};function p(t){var e=65536,r=n.getTypeOf(t),o=!0;if("uint8array"===r?o=u.applyCanBeUsed.uint8array:"nodebuffer"===r&&(o=u.applyCanBeUsed.nodebuffer),o)for(;1<e;)try{return u.stringifyByChunk(t,r,e)}catch(t){e=Math.floor(e/2)}return u.stringifyByChar(t)}function d(t,e){for(var n=0;n<t.length;n++)e[n]=t[n];return e}n.applyFromCharCode=p;var h={};h.string={string:l,array:function(t){return c(t,new Array(t.length))},arraybuffer:function(t){return h.string.uint8array(t).buffer},uint8array:function(t){return c(t,new Uint8Array(t.length))},nodebuffer:function(t){return c(t,i.allocBuffer(t.length))}},h.array={string:p,array:l,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return i.newBufferFrom(t)}},h.arraybuffer={string:function(t){return p(new Uint8Array(t))},array:function(t){return d(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:l,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return i.newBufferFrom(new Uint8Array(t))}},h.uint8array={string:p,array:function(t){return d(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:l,nodebuffer:function(t){return i.newBufferFrom(t)}},h.nodebuffer={string:p,array:function(t){return d(t,new Array(t.length))},arraybuffer:function(t){return h.nodebuffer.uint8array(t).buffer},uint8array:function(t){return d(t,new Uint8Array(t.length))},nodebuffer:l},n.transformTo=function(t,e){if(e=e||"",!t)return e;n.checkSupport(t);var r=n.getTypeOf(e);return h[r][t](e)},n.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":r.nodebuffer&&i.isBuffer(t)?"nodebuffer":r.uint8array&&t instanceof Uint8Array?"uint8array":r.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(t){if(!r[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(t){var e,n,r="";for(n=0;n<(t||"").length;n++)r+="\\x"+((e=t.charCodeAt(n))<16?"0":"")+e.toString(16).toUpperCase();return r},n.delay=function(t,e,n){a((function(){t.apply(n||null,e||[])}))},n.inherits=function(t,e){function n(){}n.prototype=e.prototype,t.prototype=new n},n.extend=function(){var t,e,n={};for(t=0;t<arguments.length;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&void 0===n[e]&&(n[e]=arguments[t][e]);return n},n.prepareContent=function(t,e,i,a,l){return s.Promise.resolve(e).then((function(t){return r.blob&&(t instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(t)))&&"undefined"!=typeof FileReader?new s.Promise((function(e,n){var r=new FileReader;r.onload=function(t){e(t.target.result)},r.onerror=function(t){n(t.target.error)},r.readAsArrayBuffer(t)})):t})).then((function(e){var u=n.getTypeOf(e);return u?("arraybuffer"===u?e=n.transformTo("uint8array",e):"string"===u&&(l?e=o.decode(e):i&&!0!==a&&(e=function(t){return c(t,r.uint8array?new Uint8Array(t.length):new Array(t.length))}(e))),e):s.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(t,e,n){"use strict";var r=t("./reader/readerFor"),o=t("./utils"),i=t("./signature"),a=t("./zipEntry"),s=(t("./utf8"),t("./support"));function l(t){this.files=[],this.loadOptions=t}l.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(e)+", expected "+o.pretty(t)+")")}},isSignature:function(t,e){var n=this.reader.index;this.reader.setIndex(t);var r=this.reader.readString(4)===e;return this.reader.setIndex(n),r},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=s.uint8array?"uint8array":"array",n=o.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(n)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,n,r=this.zip64EndOfCentralSize-44;0<r;)t=this.reader.readInt(2),e=this.reader.readInt(4),n=this.reader.readData(e),this.zip64ExtensibleData[t]={id:t,length:e,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(i.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(i.CENTRAL_FILE_HEADER);)(t=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(i.CENTRAL_DIRECTORY_END);if(t<0)throw this.isSignature(0,i.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(t);var e=t;if(this.checkSignature(i.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,i.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(i.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var r=e-n;if(0<r)this.isSignature(e,i.CENTRAL_FILE_HEADER)||(this.reader.zero=r);else if(r<0)throw new Error("Corrupted zip: missing "+Math.abs(r)+" bytes.")},prepareReader:function(t){this.reader=r(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(t,e,n){"use strict";var r=t("./reader/readerFor"),o=t("./utils"),i=t("./compressedObject"),a=t("./crc32"),s=t("./utf8"),l=t("./compressions"),c=t("./support");function u(t,e){this.options=t,this.loadOptions=e}u.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(t){var e,n;if(t.skip(22),this.fileNameLength=t.readInt(2),n=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(e=function(t){for(var e in l)if(l.hasOwnProperty(e)&&l[e].magic===t)return l[e];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new i(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==t&&(this.dosPermissions=63&this.externalFileAttributes),3==t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(t){if(this.extraFields[1]){var e=r(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(t){var e,n,r,o=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index+4<o;)e=t.readInt(2),n=t.readInt(2),r=t.readData(n),this.extraFields[e]={id:e,length:n,value:r};t.setIndex(o)},handleUTF8:function(){var t=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=s.utf8decode(this.fileName),this.fileCommentStr=s.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var n=o.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var r=this.findExtraFieldUnicodeComment();if(null!==r)this.fileCommentStr=r;else{var i=o.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(i)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=r(t.value);return 1!==e.readInt(1)||a(this.fileName)!==e.readInt(4)?null:s.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=r(t.value);return 1!==e.readInt(1)||a(this.fileComment)!==e.readInt(4)?null:s.utf8decode(e.readData(t.length-5))}return null}},e.exports=u},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,e,n){"use strict";function r(t,e,n){this.name=t,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=e,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}}var o=t("./stream/StreamHelper"),i=t("./stream/DataWorker"),a=t("./utf8"),s=t("./compressedObject"),l=t("./stream/GenericWorker");r.prototype={internalStream:function(t){var e=null,n="string";try{if(!t)throw new Error("No output type specified.");var r="string"===(n=t.toLowerCase())||"text"===n;"binarystring"!==n&&"text"!==n||(n="string"),e=this._decompressWorker();var i=!this._dataBinary;i&&!r&&(e=e.pipe(new a.Utf8EncodeWorker)),!i&&r&&(e=e.pipe(new a.Utf8DecodeWorker))}catch(t){(e=new l("error")).error(t)}return new o(e,n,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof s&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new a.Utf8EncodeWorker)),s.createWorkerFrom(n,t,e)},_decompressWorker:function(){return this._data instanceof s?this._data.getContentWorker():this._data instanceof l?this._data:new i(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},p=0;p<c.length;p++)r.prototype[c[p]]=u;e.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,e,r){(function(t){"use strict";var n,r,o=t.MutationObserver||t.WebKitMutationObserver;if(o){var i=0,a=new o(u),s=t.document.createTextNode("");a.observe(s,{characterData:!0}),n=function(){s.data=i=++i%2}}else if(t.setImmediate||void 0===t.MessageChannel)n="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){u(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(u,0)};else{var l=new t.MessageChannel;l.port1.onmessage=u,n=function(){l.port2.postMessage(0)}}var c=[];function u(){var t,e;r=!0;for(var n=c.length;n;){for(e=c,c=[],t=-1;++t<n;)e[t]();n=c.length}r=!1}e.exports=function(t){1!==c.push(t)||r||n()}}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(t,e,n){"use strict";var r=t("immediate");function o(){}var i={},a=["REJECTED"],s=["FULFILLED"],l=["PENDING"];function c(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,t!==o&&h(this,t)}function u(t,e,n){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function p(t,e,n){r((function(){var r;try{r=e(n)}catch(r){return i.reject(t,r)}r===t?i.reject(t,new TypeError("Cannot resolve promise with itself")):i.resolve(t,r)}))}function d(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function h(t,e){var n=!1;function r(e){n||(n=!0,i.reject(t,e))}function o(e){n||(n=!0,i.resolve(t,e))}var a=f((function(){e(o,r)}));"error"===a.status&&r(a.value)}function f(t,e){var n={};try{n.value=t(e),n.status="success"}catch(t){n.status="error",n.value=t}return n}(e.exports=c).prototype.finally=function(t){if("function"!=typeof t)return this;var e=this.constructor;return this.then((function(n){return e.resolve(t()).then((function(){return n}))}),(function(n){return e.resolve(t()).then((function(){throw n}))}))},c.prototype.catch=function(t){return this.then(null,t)},c.prototype.then=function(t,e){if("function"!=typeof t&&this.state===s||"function"!=typeof e&&this.state===a)return this;var n=new this.constructor(o);return this.state!==l?p(n,this.state===s?t:e,this.outcome):this.queue.push(new u(n,t,e)),n},u.prototype.callFulfilled=function(t){i.resolve(this.promise,t)},u.prototype.otherCallFulfilled=function(t){p(this.promise,this.onFulfilled,t)},u.prototype.callRejected=function(t){i.reject(this.promise,t)},u.prototype.otherCallRejected=function(t){p(this.promise,this.onRejected,t)},i.resolve=function(t,e){var n=f(d,e);if("error"===n.status)return i.reject(t,n.value);var r=n.value;if(r)h(t,r);else{t.state=s,t.outcome=e;for(var o=-1,a=t.queue.length;++o<a;)t.queue[o].callFulfilled(e)}return t},i.reject=function(t,e){t.state=a,t.outcome=e;for(var n=-1,r=t.queue.length;++n<r;)t.queue[n].callRejected(e);return t},c.resolve=function(t){return t instanceof this?t:i.resolve(new this(o),t)},c.reject=function(t){var e=new this(o);return i.reject(e,t)},c.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,r=!1;if(!n)return this.resolve([]);for(var a=new Array(n),s=0,l=-1,c=new this(o);++l<n;)u(t[l],l);return c;function u(t,o){e.resolve(t).then((function(t){a[o]=t,++s!==n||r||(r=!0,i.resolve(c,a))}),(function(t){r||(r=!0,i.reject(c,t))}))}},c.race=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,r=!1;if(!n)return this.resolve([]);for(var a,s=-1,l=new this(o);++s<n;)a=t[s],e.resolve(a).then((function(t){r||(r=!0,i.resolve(l,t))}),(function(t){r||(r=!0,i.reject(l,t))}));return l}},{immediate:36}],38:[function(t,e,n){"use strict";var r={};(0,t("./lib/utils/common").assign)(r,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,e,n){"use strict";var r=t("./zlib/deflate"),o=t("./utils/common"),i=t("./utils/strings"),a=t("./zlib/messages"),s=t("./zlib/zstream"),l=Object.prototype.toString,c=0,u=-1,p=0,d=8;function h(t){if(!(this instanceof h))return new h(t);this.options=o.assign({level:u,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},t||{});var e=this.options;e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==c)throw new Error(a[n]);if(e.header&&r.deflateSetHeader(this.strm,e.header),e.dictionary){var f;if(f="string"==typeof e.dictionary?i.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(n=r.deflateSetDictionary(this.strm,f))!==c)throw new Error(a[n]);this._dict_set=!0}}function f(t,e){var n=new h(e);if(n.push(t,!0),n.err)throw n.msg||a[n.err];return n.result}h.prototype.push=function(t,e){var n,a,s=this.strm,u=this.options.chunkSize;if(this.ended)return!1;a=e===~~e?e:!0===e?4:0,"string"==typeof t?s.input=i.string2buf(t):"[object ArrayBuffer]"===l.call(t)?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new o.Buf8(u),s.next_out=0,s.avail_out=u),1!==(n=r.deflate(s,a))&&n!==c)return this.onEnd(n),!(this.ended=!0);0!==s.avail_out&&(0!==s.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(i.buf2binstring(o.shrinkBuf(s.output,s.next_out))):this.onData(o.shrinkBuf(s.output,s.next_out)))}while((0<s.avail_in||0===s.avail_out)&&1!==n);return 4===a?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===c):2!==a||(this.onEnd(c),!(s.avail_out=0))},h.prototype.onData=function(t){this.chunks.push(t)},h.prototype.onEnd=function(t){t===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Deflate=h,n.deflate=f,n.deflateRaw=function(t,e){return(e=e||{}).raw=!0,f(t,e)},n.gzip=function(t,e){return(e=e||{}).gzip=!0,f(t,e)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,e,n){"use strict";var r=t("./zlib/inflate"),o=t("./utils/common"),i=t("./utils/strings"),a=t("./zlib/constants"),s=t("./zlib/messages"),l=t("./zlib/zstream"),c=t("./zlib/gzheader"),u=Object.prototype.toString;function p(t){if(!(this instanceof p))return new p(t);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,e.windowBits);if(n!==a.Z_OK)throw new Error(s[n]);this.header=new c,r.inflateGetHeader(this.strm,this.header)}function d(t,e){var n=new p(e);if(n.push(t,!0),n.err)throw n.msg||s[n.err];return n.result}p.prototype.push=function(t,e){var n,s,l,c,p,d,h=this.strm,f=this.options.chunkSize,m=this.options.dictionary,g=!1;if(this.ended)return!1;s=e===~~e?e:!0===e?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof t?h.input=i.binstring2buf(t):"[object ArrayBuffer]"===u.call(t)?h.input=new Uint8Array(t):h.input=t,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new o.Buf8(f),h.next_out=0,h.avail_out=f),(n=r.inflate(h,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&m&&(d="string"==typeof m?i.string2buf(m):"[object ArrayBuffer]"===u.call(m)?new Uint8Array(m):m,n=r.inflateSetDictionary(this.strm,d)),n===a.Z_BUF_ERROR&&!0===g&&(n=a.Z_OK,g=!1),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),!(this.ended=!0);h.next_out&&(0!==h.avail_out&&n!==a.Z_STREAM_END&&(0!==h.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(l=i.utf8border(h.output,h.next_out),c=h.next_out-l,p=i.buf2string(h.output,l),h.next_out=c,h.avail_out=f-c,c&&o.arraySet(h.output,h.output,l,c,0),this.onData(p)):this.onData(o.shrinkBuf(h.output,h.next_out)))),0===h.avail_in&&0===h.avail_out&&(g=!0)}while((0<h.avail_in||0===h.avail_out)&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(h.avail_out=0))},p.prototype.onData=function(t){this.chunks.push(t)},p.prototype.onEnd=function(t){t===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Inflate=p,n.inflate=d,n.inflateRaw=function(t,e){return(e=e||{}).raw=!0,d(t,e)},n.ungzip=d},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,e,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])}}return t},n.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var o={arraySet:function(t,e,n,r,o){if(e.subarray&&t.subarray)t.set(e.subarray(n,n+r),o);else for(var i=0;i<r;i++)t[o+i]=e[n+i]},flattenChunks:function(t){var e,n,r,o,i,a;for(e=r=0,n=t.length;e<n;e++)r+=t[e].length;for(a=new Uint8Array(r),e=o=0,n=t.length;e<n;e++)i=t[e],a.set(i,o),o+=i.length;return a}},i={arraySet:function(t,e,n,r,o){for(var i=0;i<r;i++)t[o+i]=e[n+i]},flattenChunks:function(t){return[].concat.apply([],t)}};n.setTyped=function(t){t?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,o)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,i))},n.setTyped(r)},{}],42:[function(t,e,n){"use strict";var r=t("./common"),o=!0,i=!0;try{String.fromCharCode.apply(null,[0])}catch(t){o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){i=!1}for(var a=new r.Buf8(256),s=0;s<256;s++)a[s]=252<=s?6:248<=s?5:240<=s?4:224<=s?3:192<=s?2:1;function l(t,e){if(e<65537&&(t.subarray&&i||!t.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(t,e));for(var n="",a=0;a<e;a++)n+=String.fromCharCode(t[a]);return n}a[254]=a[254]=1,n.string2buf=function(t){var e,n,o,i,a,s=t.length,l=0;for(i=0;i<s;i++)55296==(64512&(n=t.charCodeAt(i)))&&i+1<s&&56320==(64512&(o=t.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(o-56320),i++),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=new r.Buf8(l),i=a=0;a<l;i++)55296==(64512&(n=t.charCodeAt(i)))&&i+1<s&&56320==(64512&(o=t.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(o-56320),i++),n<128?e[a++]=n:(n<2048?e[a++]=192|n>>>6:(n<65536?e[a++]=224|n>>>12:(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63),e[a++]=128|n>>>6&63),e[a++]=128|63&n);return e},n.buf2binstring=function(t){return l(t,t.length)},n.binstring2buf=function(t){for(var e=new r.Buf8(t.length),n=0,o=e.length;n<o;n++)e[n]=t.charCodeAt(n);return e},n.buf2string=function(t,e){var n,r,o,i,s=e||t.length,c=new Array(2*s);for(n=r=0;n<s;)if((o=t[n++])<128)c[r++]=o;else if(4<(i=a[o]))c[r++]=65533,n+=i-1;else{for(o&=2===i?31:3===i?15:7;1<i&&n<s;)o=o<<6|63&t[n++],i--;1<i?c[r++]=65533:o<65536?c[r++]=o:(o-=65536,c[r++]=55296|o>>10&1023,c[r++]=56320|1023&o)}return l(c,r)},n.utf8border=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;0<=n&&128==(192&t[n]);)n--;return n<0||0===n?e:n+a[t[n]]>e?n:e}},{"./common":41}],43:[function(t,e,n){"use strict";e.exports=function(t,e,n,r){for(var o=65535&t|0,i=t>>>16&65535|0,a=0;0!==n;){for(n-=a=2e3<n?2e3:n;i=i+(o=o+e[r++]|0)|0,--a;);o%=65521,i%=65521}return o|i<<16|0}},{}],44:[function(t,e,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,e,n){"use strict";var r=function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}();e.exports=function(t,e,n,o){var i=r,a=o+n;t^=-1;for(var s=o;s<a;s++)t=t>>>8^i[255&(t^e[s])];return-1^t}},{}],46:[function(t,e,n){"use strict";var r,o=t("../utils/common"),i=t("./trees"),a=t("./adler32"),s=t("./crc32"),l=t("./messages"),c=0,u=4,p=0,d=-2,h=-1,f=4,m=2,g=8,y=9,v=286,_=30,C=19,E=2*v+1,w=15,S=3,b=258,L=b+S+1,T=42,P=113,A=1,O=2,x=3,I=4;function M(t,e){return t.msg=l[e],e}function R(t){return(t<<1)-(4<t?9:0)}function Z(t){for(var e=t.length;0<=--e;)t[e]=0}function D(t){var e=t.state,n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(o.arraySet(t.output,e.pending_buf,e.pending_out,n,t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))}function k(t,e){i._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,D(t.strm)}function N(t,e){t.pending_buf[t.pending++]=e}function F(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function U(t,e){var n,r,o=t.max_chain_length,i=t.strstart,a=t.prev_length,s=t.nice_match,l=t.strstart>t.w_size-L?t.strstart-(t.w_size-L):0,c=t.window,u=t.w_mask,p=t.prev,d=t.strstart+b,h=c[i+a-1],f=c[i+a];t.prev_length>=t.good_match&&(o>>=2),s>t.lookahead&&(s=t.lookahead);do{if(c[(n=e)+a]===f&&c[n+a-1]===h&&c[n]===c[i]&&c[++n]===c[i+1]){i+=2,n++;do{}while(c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&i<d);if(r=b-(d-i),i=d-b,a<r){if(t.match_start=e,s<=(a=r))break;h=c[i+a-1],f=c[i+a]}}}while((e=p[e&u])>l&&0!=--o);return a<=t.lookahead?a:t.lookahead}function G(t){var e,n,r,i,l,c,u,p,d,h,f=t.w_size;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=f+(f-L)){for(o.arraySet(t.window,t.window,f,f,0),t.match_start-=f,t.strstart-=f,t.block_start-=f,e=n=t.hash_size;r=t.head[--e],t.head[e]=f<=r?r-f:0,--n;);for(e=n=f;r=t.prev[--e],t.prev[e]=f<=r?r-f:0,--n;);i+=f}if(0===t.strm.avail_in)break;if(c=t.strm,u=t.window,p=t.strstart+t.lookahead,h=void 0,(d=i)<(h=c.avail_in)&&(h=d),n=0===h?0:(c.avail_in-=h,o.arraySet(u,c.input,c.next_in,h,p),1===c.state.wrap?c.adler=a(c.adler,u,h,p):2===c.state.wrap&&(c.adler=s(c.adler,u,h,p)),c.next_in+=h,c.total_in+=h,h),t.lookahead+=n,t.lookahead+t.insert>=S)for(l=t.strstart-t.insert,t.ins_h=t.window[l],t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+S-1])&t.hash_mask,t.prev[l&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=l,l++,t.insert--,!(t.lookahead+t.insert<S)););}while(t.lookahead<L&&0!==t.strm.avail_in)}function B(t,e){for(var n,r;;){if(t.lookahead<L){if(G(t),t.lookahead<L&&e===c)return A;if(0===t.lookahead)break}if(n=0,t.lookahead>=S&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-L&&(t.match_length=U(t,n)),t.match_length>=S)if(r=i._tr_tally(t,t.strstart-t.match_start,t.match_length-S),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=S){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,0!=--t.match_length;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else r=i._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(k(t,!1),0===t.strm.avail_out))return A}return t.insert=t.strstart<S-1?t.strstart:S-1,e===u?(k(t,!0),0===t.strm.avail_out?x:I):t.last_lit&&(k(t,!1),0===t.strm.avail_out)?A:O}function j(t,e){for(var n,r,o;;){if(t.lookahead<L){if(G(t),t.lookahead<L&&e===c)return A;if(0===t.lookahead)break}if(n=0,t.lookahead>=S&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=S-1,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-L&&(t.match_length=U(t,n),t.match_length<=5&&(1===t.strategy||t.match_length===S&&4096<t.strstart-t.match_start)&&(t.match_length=S-1)),t.prev_length>=S&&t.match_length<=t.prev_length){for(o=t.strstart+t.lookahead-S,r=i._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-S),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=o&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!=--t.prev_length;);if(t.match_available=0,t.match_length=S-1,t.strstart++,r&&(k(t,!1),0===t.strm.avail_out))return A}else if(t.match_available){if((r=i._tr_tally(t,0,t.window[t.strstart-1]))&&k(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return A}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=i._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<S-1?t.strstart:S-1,e===u?(k(t,!0),0===t.strm.avail_out?x:I):t.last_lit&&(k(t,!1),0===t.strm.avail_out)?A:O}function W(t,e,n,r,o){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=o}function q(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=g,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*E),this.dyn_dtree=new o.Buf16(2*(2*_+1)),this.bl_tree=new o.Buf16(2*(2*C+1)),Z(this.dyn_ltree),Z(this.dyn_dtree),Z(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(w+1),this.heap=new o.Buf16(2*v+1),Z(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*v+1),Z(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function H(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=m,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?T:P,t.adler=2===e.wrap?0:1,e.last_flush=c,i._tr_init(e),p):M(t,d)}function V(t){var e=H(t);return e===p&&function(t){t.window_size=2*t.w_size,Z(t.head),t.max_lazy_match=r[t.level].max_lazy,t.good_match=r[t.level].good_length,t.nice_match=r[t.level].nice_length,t.max_chain_length=r[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=S-1,t.match_available=0,t.ins_h=0}(t.state),e}function z(t,e,n,r,i,a){if(!t)return d;var s=1;if(e===h&&(e=6),r<0?(s=0,r=-r):15<r&&(s=2,r-=16),i<1||y<i||n!==g||r<8||15<r||e<0||9<e||a<0||f<a)return M(t,d);8===r&&(r=9);var l=new q;return(t.state=l).strm=t,l.wrap=s,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=i+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+S-1)/S),l.window=new o.Buf8(2*l.w_size),l.head=new o.Buf16(l.hash_size),l.prev=new o.Buf16(l.w_size),l.lit_bufsize=1<<i+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new o.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=a,l.method=n,V(t)}r=[new W(0,0,0,0,(function(t,e){var n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(G(t),0===t.lookahead&&e===c)return A;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var r=t.block_start+n;if((0===t.strstart||t.strstart>=r)&&(t.lookahead=t.strstart-r,t.strstart=r,k(t,!1),0===t.strm.avail_out))return A;if(t.strstart-t.block_start>=t.w_size-L&&(k(t,!1),0===t.strm.avail_out))return A}return t.insert=0,e===u?(k(t,!0),0===t.strm.avail_out?x:I):(t.strstart>t.block_start&&(k(t,!1),t.strm.avail_out),A)})),new W(4,4,8,4,B),new W(4,5,16,8,B),new W(4,6,32,32,B),new W(4,4,16,16,j),new W(8,16,32,32,j),new W(8,16,128,128,j),new W(8,32,128,256,j),new W(32,128,258,1024,j),new W(32,258,258,4096,j)],n.deflateInit=function(t,e){return z(t,e,g,15,8,0)},n.deflateInit2=z,n.deflateReset=V,n.deflateResetKeep=H,n.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?d:(t.state.gzhead=e,p):d},n.deflate=function(t,e){var n,o,a,l;if(!t||!t.state||5<e||e<0)return t?M(t,d):d;if(o=t.state,!t.output||!t.input&&0!==t.avail_in||666===o.status&&e!==u)return M(t,0===t.avail_out?-5:d);if(o.strm=t,n=o.last_flush,o.last_flush=e,o.status===T)if(2===o.wrap)t.adler=0,N(o,31),N(o,139),N(o,8),o.gzhead?(N(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),N(o,255&o.gzhead.time),N(o,o.gzhead.time>>8&255),N(o,o.gzhead.time>>16&255),N(o,o.gzhead.time>>24&255),N(o,9===o.level?2:2<=o.strategy||o.level<2?4:0),N(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(N(o,255&o.gzhead.extra.length),N(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(t.adler=s(t.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=69):(N(o,0),N(o,0),N(o,0),N(o,0),N(o,0),N(o,9===o.level?2:2<=o.strategy||o.level<2?4:0),N(o,3),o.status=P);else{var h=g+(o.w_bits-8<<4)<<8;h|=(2<=o.strategy||o.level<2?0:o.level<6?1:6===o.level?2:3)<<6,0!==o.strstart&&(h|=32),h+=31-h%31,o.status=P,F(o,h),0!==o.strstart&&(F(o,t.adler>>>16),F(o,65535&t.adler)),t.adler=1}if(69===o.status)if(o.gzhead.extra){for(a=o.pending;o.gzindex<(65535&o.gzhead.extra.length)&&(o.pending!==o.pending_buf_size||(o.gzhead.hcrc&&o.pending>a&&(t.adler=s(t.adler,o.pending_buf,o.pending-a,a)),D(t),a=o.pending,o.pending!==o.pending_buf_size));)N(o,255&o.gzhead.extra[o.gzindex]),o.gzindex++;o.gzhead.hcrc&&o.pending>a&&(t.adler=s(t.adler,o.pending_buf,o.pending-a,a)),o.gzindex===o.gzhead.extra.length&&(o.gzindex=0,o.status=73)}else o.status=73;if(73===o.status)if(o.gzhead.name){a=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>a&&(t.adler=s(t.adler,o.pending_buf,o.pending-a,a)),D(t),a=o.pending,o.pending===o.pending_buf_size)){l=1;break}l=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,N(o,l)}while(0!==l);o.gzhead.hcrc&&o.pending>a&&(t.adler=s(t.adler,o.pending_buf,o.pending-a,a)),0===l&&(o.gzindex=0,o.status=91)}else o.status=91;if(91===o.status)if(o.gzhead.comment){a=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>a&&(t.adler=s(t.adler,o.pending_buf,o.pending-a,a)),D(t),a=o.pending,o.pending===o.pending_buf_size)){l=1;break}l=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,N(o,l)}while(0!==l);o.gzhead.hcrc&&o.pending>a&&(t.adler=s(t.adler,o.pending_buf,o.pending-a,a)),0===l&&(o.status=103)}else o.status=103;if(103===o.status&&(o.gzhead.hcrc?(o.pending+2>o.pending_buf_size&&D(t),o.pending+2<=o.pending_buf_size&&(N(o,255&t.adler),N(o,t.adler>>8&255),t.adler=0,o.status=P)):o.status=P),0!==o.pending){if(D(t),0===t.avail_out)return o.last_flush=-1,p}else if(0===t.avail_in&&R(e)<=R(n)&&e!==u)return M(t,-5);if(666===o.status&&0!==t.avail_in)return M(t,-5);if(0!==t.avail_in||0!==o.lookahead||e!==c&&666!==o.status){var f=2===o.strategy?function(t,e){for(var n;;){if(0===t.lookahead&&(G(t),0===t.lookahead)){if(e===c)return A;break}if(t.match_length=0,n=i._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(k(t,!1),0===t.strm.avail_out))return A}return t.insert=0,e===u?(k(t,!0),0===t.strm.avail_out?x:I):t.last_lit&&(k(t,!1),0===t.strm.avail_out)?A:O}(o,e):3===o.strategy?function(t,e){for(var n,r,o,a,s=t.window;;){if(t.lookahead<=b){if(G(t),t.lookahead<=b&&e===c)return A;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=S&&0<t.strstart&&(r=s[o=t.strstart-1])===s[++o]&&r===s[++o]&&r===s[++o]){a=t.strstart+b;do{}while(r===s[++o]&&r===s[++o]&&r===s[++o]&&r===s[++o]&&r===s[++o]&&r===s[++o]&&r===s[++o]&&r===s[++o]&&o<a);t.match_length=b-(a-o),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=S?(n=i._tr_tally(t,1,t.match_length-S),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=i._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(k(t,!1),0===t.strm.avail_out))return A}return t.insert=0,e===u?(k(t,!0),0===t.strm.avail_out?x:I):t.last_lit&&(k(t,!1),0===t.strm.avail_out)?A:O}(o,e):r[o.level].func(o,e);if(f!==x&&f!==I||(o.status=666),f===A||f===x)return 0===t.avail_out&&(o.last_flush=-1),p;if(f===O&&(1===e?i._tr_align(o):5!==e&&(i._tr_stored_block(o,0,0,!1),3===e&&(Z(o.head),0===o.lookahead&&(o.strstart=0,o.block_start=0,o.insert=0))),D(t),0===t.avail_out))return o.last_flush=-1,p}return e!==u?p:o.wrap<=0?1:(2===o.wrap?(N(o,255&t.adler),N(o,t.adler>>8&255),N(o,t.adler>>16&255),N(o,t.adler>>24&255),N(o,255&t.total_in),N(o,t.total_in>>8&255),N(o,t.total_in>>16&255),N(o,t.total_in>>24&255)):(F(o,t.adler>>>16),F(o,65535&t.adler)),D(t),0<o.wrap&&(o.wrap=-o.wrap),0!==o.pending?p:1)},n.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==T&&69!==e&&73!==e&&91!==e&&103!==e&&e!==P&&666!==e?M(t,d):(t.state=null,e===P?M(t,-3):p):d},n.deflateSetDictionary=function(t,e){var n,r,i,s,l,c,u,h,f=e.length;if(!t||!t.state)return d;if(2===(s=(n=t.state).wrap)||1===s&&n.status!==T||n.lookahead)return d;for(1===s&&(t.adler=a(t.adler,e,f,0)),n.wrap=0,f>=n.w_size&&(0===s&&(Z(n.head),n.strstart=0,n.block_start=0,n.insert=0),h=new o.Buf8(n.w_size),o.arraySet(h,e,f-n.w_size,n.w_size,0),e=h,f=n.w_size),l=t.avail_in,c=t.next_in,u=t.input,t.avail_in=f,t.next_in=0,t.input=e,G(n);n.lookahead>=S;){for(r=n.strstart,i=n.lookahead-(S-1);n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+S-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++,--i;);n.strstart=r,n.lookahead=S-1,G(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=S-1,n.match_available=0,t.next_in=c,t.input=u,t.avail_in=l,n.wrap=s,p},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,e,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,e,n){"use strict";e.exports=function(t,e){var n,r,o,i,a,s,l,c,u,p,d,h,f,m,g,y,v,_,C,E,w,S,b,L,T;n=t.state,r=t.next_in,L=t.input,o=r+(t.avail_in-5),i=t.next_out,T=t.output,a=i-(e-t.avail_out),s=i+(t.avail_out-257),l=n.dmax,c=n.wsize,u=n.whave,p=n.wnext,d=n.window,h=n.hold,f=n.bits,m=n.lencode,g=n.distcode,y=(1<<n.lenbits)-1,v=(1<<n.distbits)-1;t:do{f<15&&(h+=L[r++]<<f,f+=8,h+=L[r++]<<f,f+=8),_=m[h&y];e:for(;;){if(h>>>=C=_>>>24,f-=C,0==(C=_>>>16&255))T[i++]=65535&_;else{if(!(16&C)){if(0==(64&C)){_=m[(65535&_)+(h&(1<<C)-1)];continue e}if(32&C){n.mode=12;break t}t.msg="invalid literal/length code",n.mode=30;break t}E=65535&_,(C&=15)&&(f<C&&(h+=L[r++]<<f,f+=8),E+=h&(1<<C)-1,h>>>=C,f-=C),f<15&&(h+=L[r++]<<f,f+=8,h+=L[r++]<<f,f+=8),_=g[h&v];n:for(;;){if(h>>>=C=_>>>24,f-=C,!(16&(C=_>>>16&255))){if(0==(64&C)){_=g[(65535&_)+(h&(1<<C)-1)];continue n}t.msg="invalid distance code",n.mode=30;break t}if(w=65535&_,f<(C&=15)&&(h+=L[r++]<<f,(f+=8)<C&&(h+=L[r++]<<f,f+=8)),l<(w+=h&(1<<C)-1)){t.msg="invalid distance too far back",n.mode=30;break t}if(h>>>=C,f-=C,(C=i-a)<w){if(u<(C=w-C)&&n.sane){t.msg="invalid distance too far back",n.mode=30;break t}if(b=d,(S=0)===p){if(S+=c-C,C<E){for(E-=C;T[i++]=d[S++],--C;);S=i-w,b=T}}else if(p<C){if(S+=c+p-C,(C-=p)<E){for(E-=C;T[i++]=d[S++],--C;);if(S=0,p<E){for(E-=C=p;T[i++]=d[S++],--C;);S=i-w,b=T}}}else if(S+=p-C,C<E){for(E-=C;T[i++]=d[S++],--C;);S=i-w,b=T}for(;2<E;)T[i++]=b[S++],T[i++]=b[S++],T[i++]=b[S++],E-=3;E&&(T[i++]=b[S++],1<E&&(T[i++]=b[S++]))}else{for(S=i-w;T[i++]=T[S++],T[i++]=T[S++],T[i++]=T[S++],2<(E-=3););E&&(T[i++]=T[S++],1<E&&(T[i++]=T[S++]))}break}}break}}while(r<o&&i<s);r-=E=f>>3,h&=(1<<(f-=E<<3))-1,t.next_in=r,t.next_out=i,t.avail_in=r<o?o-r+5:5-(r-o),t.avail_out=i<s?s-i+257:257-(i-s),n.hold=h,n.bits=f}},{}],49:[function(t,e,n){"use strict";var r=t("../utils/common"),o=t("./adler32"),i=t("./crc32"),a=t("./inffast"),s=t("./inftrees"),l=1,c=2,u=0,p=-2,d=1,h=852,f=592;function m(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function g(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function y(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=d,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new r.Buf32(h),e.distcode=e.distdyn=new r.Buf32(f),e.sane=1,e.back=-1,u):p}function v(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,y(t)):p}function _(t,e){var n,r;return t&&t.state?(r=t.state,e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?p:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,v(t))):p}function C(t,e){var n,r;return t?(r=new g,(t.state=r).window=null,(n=_(t,e))!==u&&(t.state=null),n):p}var E,w,S=!0;function b(t){if(S){var e;for(E=new r.Buf32(512),w=new r.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(s(l,t.lens,0,288,E,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;s(c,t.lens,0,32,w,0,t.work,{bits:5}),S=!1}t.lencode=E,t.lenbits=9,t.distcode=w,t.distbits=5}function L(t,e,n,o){var i,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new r.Buf8(a.wsize)),o>=a.wsize?(r.arraySet(a.window,e,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(o<(i=a.wsize-a.wnext)&&(i=o),r.arraySet(a.window,e,n-o,i,a.wnext),(o-=i)?(r.arraySet(a.window,e,n-o,o,0),a.wnext=o,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0}n.inflateReset=v,n.inflateReset2=_,n.inflateResetKeep=y,n.inflateInit=function(t){return C(t,15)},n.inflateInit2=C,n.inflate=function(t,e){var n,h,f,g,y,v,_,C,E,w,S,T,P,A,O,x,I,M,R,Z,D,k,N,F,U=0,G=new r.Buf8(4),B=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return p;12===(n=t.state).mode&&(n.mode=13),y=t.next_out,f=t.output,_=t.avail_out,g=t.next_in,h=t.input,v=t.avail_in,C=n.hold,E=n.bits,w=v,S=_,k=u;t:for(;;)switch(n.mode){case d:if(0===n.wrap){n.mode=13;break}for(;E<16;){if(0===v)break t;v--,C+=h[g++]<<E,E+=8}if(2&n.wrap&&35615===C){G[n.check=0]=255&C,G[1]=C>>>8&255,n.check=i(n.check,G,2,0),E=C=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&C)<<8)+(C>>8))%31){t.msg="incorrect header check",n.mode=30;break}if(8!=(15&C)){t.msg="unknown compression method",n.mode=30;break}if(E-=4,D=8+(15&(C>>>=4)),0===n.wbits)n.wbits=D;else if(D>n.wbits){t.msg="invalid window size",n.mode=30;break}n.dmax=1<<D,t.adler=n.check=1,n.mode=512&C?10:12,E=C=0;break;case 2:for(;E<16;){if(0===v)break t;v--,C+=h[g++]<<E,E+=8}if(n.flags=C,8!=(255&n.flags)){t.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=C>>8&1),512&n.flags&&(G[0]=255&C,G[1]=C>>>8&255,n.check=i(n.check,G,2,0)),E=C=0,n.mode=3;case 3:for(;E<32;){if(0===v)break t;v--,C+=h[g++]<<E,E+=8}n.head&&(n.head.time=C),512&n.flags&&(G[0]=255&C,G[1]=C>>>8&255,G[2]=C>>>16&255,G[3]=C>>>24&255,n.check=i(n.check,G,4,0)),E=C=0,n.mode=4;case 4:for(;E<16;){if(0===v)break t;v--,C+=h[g++]<<E,E+=8}n.head&&(n.head.xflags=255&C,n.head.os=C>>8),512&n.flags&&(G[0]=255&C,G[1]=C>>>8&255,n.check=i(n.check,G,2,0)),E=C=0,n.mode=5;case 5:if(1024&n.flags){for(;E<16;){if(0===v)break t;v--,C+=h[g++]<<E,E+=8}n.length=C,n.head&&(n.head.extra_len=C),512&n.flags&&(G[0]=255&C,G[1]=C>>>8&255,n.check=i(n.check,G,2,0)),E=C=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&(v<(T=n.length)&&(T=v),T&&(n.head&&(D=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,h,g,T,D)),512&n.flags&&(n.check=i(n.check,h,T,g)),v-=T,g+=T,n.length-=T),n.length))break t;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===v)break t;for(T=0;D=h[g+T++],n.head&&D&&n.length<65536&&(n.head.name+=String.fromCharCode(D)),D&&T<v;);if(512&n.flags&&(n.check=i(n.check,h,T,g)),v-=T,g+=T,D)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===v)break t;for(T=0;D=h[g+T++],n.head&&D&&n.length<65536&&(n.head.comment+=String.fromCharCode(D)),D&&T<v;);if(512&n.flags&&(n.check=i(n.check,h,T,g)),v-=T,g+=T,D)break t}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;E<16;){if(0===v)break t;v--,C+=h[g++]<<E,E+=8}if(C!==(65535&n.check)){t.msg="header crc mismatch",n.mode=30;break}E=C=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=12;break;case 10:for(;E<32;){if(0===v)break t;v--,C+=h[g++]<<E,E+=8}t.adler=n.check=m(C),E=C=0,n.mode=11;case 11:if(0===n.havedict)return t.next_out=y,t.avail_out=_,t.next_in=g,t.avail_in=v,n.hold=C,n.bits=E,2;t.adler=n.check=1,n.mode=12;case 12:if(5===e||6===e)break t;case 13:if(n.last){C>>>=7&E,E-=7&E,n.mode=27;break}for(;E<3;){if(0===v)break t;v--,C+=h[g++]<<E,E+=8}switch(n.last=1&C,E-=1,3&(C>>>=1)){case 0:n.mode=14;break;case 1:if(b(n),n.mode=20,6!==e)break;C>>>=2,E-=2;break t;case 2:n.mode=17;break;case 3:t.msg="invalid block type",n.mode=30}C>>>=2,E-=2;break;case 14:for(C>>>=7&E,E-=7&E;E<32;){if(0===v)break t;v--,C+=h[g++]<<E,E+=8}if((65535&C)!=(C>>>16^65535)){t.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&C,E=C=0,n.mode=15,6===e)break t;case 15:n.mode=16;case 16:if(T=n.length){if(v<T&&(T=v),_<T&&(T=_),0===T)break t;r.arraySet(f,h,g,T,y),v-=T,g+=T,_-=T,y+=T,n.length-=T;break}n.mode=12;break;case 17:for(;E<14;){if(0===v)break t;v--,C+=h[g++]<<E,E+=8}if(n.nlen=257+(31&C),C>>>=5,E-=5,n.ndist=1+(31&C),C>>>=5,E-=5,n.ncode=4+(15&C),C>>>=4,E-=4,286<n.nlen||30<n.ndist){t.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;E<3;){if(0===v)break t;v--,C+=h[g++]<<E,E+=8}n.lens[B[n.have++]]=7&C,C>>>=3,E-=3}for(;n.have<19;)n.lens[B[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,N={bits:n.lenbits},k=s(0,n.lens,0,19,n.lencode,0,n.work,N),n.lenbits=N.bits,k){t.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;x=(U=n.lencode[C&(1<<n.lenbits)-1])>>>16&255,I=65535&U,!((O=U>>>24)<=E);){if(0===v)break t;v--,C+=h[g++]<<E,E+=8}if(I<16)C>>>=O,E-=O,n.lens[n.have++]=I;else{if(16===I){for(F=O+2;E<F;){if(0===v)break t;v--,C+=h[g++]<<E,E+=8}if(C>>>=O,E-=O,0===n.have){t.msg="invalid bit length repeat",n.mode=30;break}D=n.lens[n.have-1],T=3+(3&C),C>>>=2,E-=2}else if(17===I){for(F=O+3;E<F;){if(0===v)break t;v--,C+=h[g++]<<E,E+=8}E-=O,D=0,T=3+(7&(C>>>=O)),C>>>=3,E-=3}else{for(F=O+7;E<F;){if(0===v)break t;v--,C+=h[g++]<<E,E+=8}E-=O,D=0,T=11+(127&(C>>>=O)),C>>>=7,E-=7}if(n.have+T>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=30;break}for(;T--;)n.lens[n.have++]=D}}if(30===n.mode)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,N={bits:n.lenbits},k=s(l,n.lens,0,n.nlen,n.lencode,0,n.work,N),n.lenbits=N.bits,k){t.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,N={bits:n.distbits},k=s(c,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,N),n.distbits=N.bits,k){t.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===e)break t;case 20:n.mode=21;case 21:if(6<=v&&258<=_){t.next_out=y,t.avail_out=_,t.next_in=g,t.avail_in=v,n.hold=C,n.bits=E,a(t,S),y=t.next_out,f=t.output,_=t.avail_out,g=t.next_in,h=t.input,v=t.avail_in,C=n.hold,E=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;x=(U=n.lencode[C&(1<<n.lenbits)-1])>>>16&255,I=65535&U,!((O=U>>>24)<=E);){if(0===v)break t;v--,C+=h[g++]<<E,E+=8}if(x&&0==(240&x)){for(M=O,R=x,Z=I;x=(U=n.lencode[Z+((C&(1<<M+R)-1)>>M)])>>>16&255,I=65535&U,!(M+(O=U>>>24)<=E);){if(0===v)break t;v--,C+=h[g++]<<E,E+=8}C>>>=M,E-=M,n.back+=M}if(C>>>=O,E-=O,n.back+=O,n.length=I,0===x){n.mode=26;break}if(32&x){n.back=-1,n.mode=12;break}if(64&x){t.msg="invalid literal/length code",n.mode=30;break}n.extra=15&x,n.mode=22;case 22:if(n.extra){for(F=n.extra;E<F;){if(0===v)break t;v--,C+=h[g++]<<E,E+=8}n.length+=C&(1<<n.extra)-1,C>>>=n.extra,E-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;x=(U=n.distcode[C&(1<<n.distbits)-1])>>>16&255,I=65535&U,!((O=U>>>24)<=E);){if(0===v)break t;v--,C+=h[g++]<<E,E+=8}if(0==(240&x)){for(M=O,R=x,Z=I;x=(U=n.distcode[Z+((C&(1<<M+R)-1)>>M)])>>>16&255,I=65535&U,!(M+(O=U>>>24)<=E);){if(0===v)break t;v--,C+=h[g++]<<E,E+=8}C>>>=M,E-=M,n.back+=M}if(C>>>=O,E-=O,n.back+=O,64&x){t.msg="invalid distance code",n.mode=30;break}n.offset=I,n.extra=15&x,n.mode=24;case 24:if(n.extra){for(F=n.extra;E<F;){if(0===v)break t;v--,C+=h[g++]<<E,E+=8}n.offset+=C&(1<<n.extra)-1,C>>>=n.extra,E-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===_)break t;if(T=S-_,n.offset>T){if((T=n.offset-T)>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=30;break}P=T>n.wnext?(T-=n.wnext,n.wsize-T):n.wnext-T,T>n.length&&(T=n.length),A=n.window}else A=f,P=y-n.offset,T=n.length;for(_<T&&(T=_),_-=T,n.length-=T;f[y++]=A[P++],--T;);0===n.length&&(n.mode=21);break;case 26:if(0===_)break t;f[y++]=n.length,_--,n.mode=21;break;case 27:if(n.wrap){for(;E<32;){if(0===v)break t;v--,C|=h[g++]<<E,E+=8}if(S-=_,t.total_out+=S,n.total+=S,S&&(t.adler=n.check=n.flags?i(n.check,f,S,y-S):o(n.check,f,S,y-S)),S=_,(n.flags?C:m(C))!==n.check){t.msg="incorrect data check",n.mode=30;break}E=C=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;E<32;){if(0===v)break t;v--,C+=h[g++]<<E,E+=8}if(C!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=30;break}E=C=0}n.mode=29;case 29:k=1;break t;case 30:k=-3;break t;case 31:return-4;default:return p}return t.next_out=y,t.avail_out=_,t.next_in=g,t.avail_in=v,n.hold=C,n.bits=E,(n.wsize||S!==t.avail_out&&n.mode<30&&(n.mode<27||4!==e))&&L(t,t.output,t.next_out,S-t.avail_out)?(n.mode=31,-4):(w-=t.avail_in,S-=t.avail_out,t.total_in+=w,t.total_out+=S,n.total+=S,n.wrap&&S&&(t.adler=n.check=n.flags?i(n.check,f,S,t.next_out-S):o(n.check,f,S,t.next_out-S)),t.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0==w&&0===S||4===e)&&k===u&&(k=-5),k)},n.inflateEnd=function(t){if(!t||!t.state)return p;var e=t.state;return e.window&&(e.window=null),t.state=null,u},n.inflateGetHeader=function(t,e){var n;return t&&t.state?0==(2&(n=t.state).wrap)?p:((n.head=e).done=!1,u):p},n.inflateSetDictionary=function(t,e){var n,r=e.length;return t&&t.state?0!==(n=t.state).wrap&&11!==n.mode?p:11===n.mode&&o(1,e,r,0)!==n.check?-3:L(t,e,r,r)?(n.mode=31,-4):(n.havedict=1,u):p},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,e,n){"use strict";var r=t("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,n,l,c,u,p,d){var h,f,m,g,y,v,_,C,E,w=d.bits,S=0,b=0,L=0,T=0,P=0,A=0,O=0,x=0,I=0,M=0,R=null,Z=0,D=new r.Buf16(16),k=new r.Buf16(16),N=null,F=0;for(S=0;S<=15;S++)D[S]=0;for(b=0;b<l;b++)D[e[n+b]]++;for(P=w,T=15;1<=T&&0===D[T];T--);if(T<P&&(P=T),0===T)return c[u++]=20971520,c[u++]=20971520,d.bits=1,0;for(L=1;L<T&&0===D[L];L++);for(P<L&&(P=L),S=x=1;S<=15;S++)if(x<<=1,(x-=D[S])<0)return-1;if(0<x&&(0===t||1!==T))return-1;for(k[1]=0,S=1;S<15;S++)k[S+1]=k[S]+D[S];for(b=0;b<l;b++)0!==e[n+b]&&(p[k[e[n+b]]++]=b);if(v=0===t?(R=N=p,19):1===t?(R=o,Z-=257,N=i,F-=257,256):(R=a,N=s,-1),S=L,y=u,O=b=M=0,m=-1,g=(I=1<<(A=P))-1,1===t&&852<I||2===t&&592<I)return 1;for(;;){for(_=S-O,E=p[b]<v?(C=0,p[b]):p[b]>v?(C=N[F+p[b]],R[Z+p[b]]):(C=96,0),h=1<<S-O,L=f=1<<A;c[y+(M>>O)+(f-=h)]=_<<24|C<<16|E|0,0!==f;);for(h=1<<S-1;M&h;)h>>=1;if(0!==h?(M&=h-1,M+=h):M=0,b++,0==--D[S]){if(S===T)break;S=e[n+p[b]]}if(P<S&&(M&g)!==m){for(0===O&&(O=P),y+=L,x=1<<(A=S-O);A+O<T&&!((x-=D[A+O])<=0);)A++,x<<=1;if(I+=1<<A,1===t&&852<I||2===t&&592<I)return 1;c[m=M&g]=P<<24|A<<16|y-u|0}}return 0!==M&&(c[y+M]=S-O<<24|64<<16|0),d.bits=P,0}},{"../utils/common":41}],51:[function(t,e,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,e,n){"use strict";var r=t("../utils/common"),o=0,i=1;function a(t){for(var e=t.length;0<=--e;)t[e]=0}var s=0,l=29,c=256,u=c+1+l,p=30,d=19,h=2*u+1,f=15,m=16,g=7,y=256,v=16,_=17,C=18,E=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],w=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],b=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],L=new Array(2*(u+2));a(L);var T=new Array(2*p);a(T);var P=new Array(512);a(P);var A=new Array(256);a(A);var O=new Array(l);a(O);var x,I,M,R=new Array(p);function Z(t,e,n,r,o){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=o,this.has_stree=t&&t.length}function D(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function k(t){return t<256?P[t]:P[256+(t>>>7)]}function N(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function F(t,e,n){t.bi_valid>m-n?(t.bi_buf|=e<<t.bi_valid&65535,N(t,t.bi_buf),t.bi_buf=e>>m-t.bi_valid,t.bi_valid+=n-m):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)}function U(t,e,n){F(t,n[2*e],n[2*e+1])}function G(t,e){for(var n=0;n|=1&t,t>>>=1,n<<=1,0<--e;);return n>>>1}function B(t,e,n){var r,o,i=new Array(f+1),a=0;for(r=1;r<=f;r++)i[r]=a=a+n[r-1]<<1;for(o=0;o<=e;o++){var s=t[2*o+1];0!==s&&(t[2*o]=G(i[s]++,s))}}function j(t){var e;for(e=0;e<u;e++)t.dyn_ltree[2*e]=0;for(e=0;e<p;e++)t.dyn_dtree[2*e]=0;for(e=0;e<d;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*y]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function W(t){8<t.bi_valid?N(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function q(t,e,n,r){var o=2*e,i=2*n;return t[o]<t[i]||t[o]===t[i]&&r[e]<=r[n]}function H(t,e,n){for(var r=t.heap[n],o=n<<1;o<=t.heap_len&&(o<t.heap_len&&q(e,t.heap[o+1],t.heap[o],t.depth)&&o++,!q(e,r,t.heap[o],t.depth));)t.heap[n]=t.heap[o],n=o,o<<=1;t.heap[n]=r}function V(t,e,n){var r,o,i,a,s=0;if(0!==t.last_lit)for(;r=t.pending_buf[t.d_buf+2*s]<<8|t.pending_buf[t.d_buf+2*s+1],o=t.pending_buf[t.l_buf+s],s++,0===r?U(t,o,e):(U(t,(i=A[o])+c+1,e),0!==(a=E[i])&&F(t,o-=O[i],a),U(t,i=k(--r),n),0!==(a=w[i])&&F(t,r-=R[i],a)),s<t.last_lit;);U(t,y,e)}function z(t,e){var n,r,o,i=e.dyn_tree,a=e.stat_desc.static_tree,s=e.stat_desc.has_stree,l=e.stat_desc.elems,c=-1;for(t.heap_len=0,t.heap_max=h,n=0;n<l;n++)0!==i[2*n]?(t.heap[++t.heap_len]=c=n,t.depth[n]=0):i[2*n+1]=0;for(;t.heap_len<2;)i[2*(o=t.heap[++t.heap_len]=c<2?++c:0)]=1,t.depth[o]=0,t.opt_len--,s&&(t.static_len-=a[2*o+1]);for(e.max_code=c,n=t.heap_len>>1;1<=n;n--)H(t,i,n);for(o=l;n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],H(t,i,1),r=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=r,i[2*o]=i[2*n]+i[2*r],t.depth[o]=(t.depth[n]>=t.depth[r]?t.depth[n]:t.depth[r])+1,i[2*n+1]=i[2*r+1]=o,t.heap[1]=o++,H(t,i,1),2<=t.heap_len;);t.heap[--t.heap_max]=t.heap[1],function(t,e){var n,r,o,i,a,s,l=e.dyn_tree,c=e.max_code,u=e.stat_desc.static_tree,p=e.stat_desc.has_stree,d=e.stat_desc.extra_bits,m=e.stat_desc.extra_base,g=e.stat_desc.max_length,y=0;for(i=0;i<=f;i++)t.bl_count[i]=0;for(l[2*t.heap[t.heap_max]+1]=0,n=t.heap_max+1;n<h;n++)g<(i=l[2*l[2*(r=t.heap[n])+1]+1]+1)&&(i=g,y++),l[2*r+1]=i,c<r||(t.bl_count[i]++,a=0,m<=r&&(a=d[r-m]),s=l[2*r],t.opt_len+=s*(i+a),p&&(t.static_len+=s*(u[2*r+1]+a)));if(0!==y){do{for(i=g-1;0===t.bl_count[i];)i--;t.bl_count[i]--,t.bl_count[i+1]+=2,t.bl_count[g]--,y-=2}while(0<y);for(i=g;0!==i;i--)for(r=t.bl_count[i];0!==r;)c<(o=t.heap[--n])||(l[2*o+1]!==i&&(t.opt_len+=(i-l[2*o+1])*l[2*o],l[2*o+1]=i),r--)}}(t,e),B(i,c,t.bl_count)}function Y(t,e,n){var r,o,i=-1,a=e[1],s=0,l=7,c=4;for(0===a&&(l=138,c=3),e[2*(n+1)+1]=65535,r=0;r<=n;r++)o=a,a=e[2*(r+1)+1],++s<l&&o===a||(s<c?t.bl_tree[2*o]+=s:0!==o?(o!==i&&t.bl_tree[2*o]++,t.bl_tree[2*v]++):s<=10?t.bl_tree[2*_]++:t.bl_tree[2*C]++,i=o,c=(s=0)===a?(l=138,3):o===a?(l=6,3):(l=7,4))}function K(t,e,n){var r,o,i=-1,a=e[1],s=0,l=7,c=4;for(0===a&&(l=138,c=3),r=0;r<=n;r++)if(o=a,a=e[2*(r+1)+1],!(++s<l&&o===a)){if(s<c)for(;U(t,o,t.bl_tree),0!=--s;);else 0!==o?(o!==i&&(U(t,o,t.bl_tree),s--),U(t,v,t.bl_tree),F(t,s-3,2)):s<=10?(U(t,_,t.bl_tree),F(t,s-3,3)):(U(t,C,t.bl_tree),F(t,s-11,7));i=o,c=(s=0)===a?(l=138,3):o===a?(l=6,3):(l=7,4)}}a(R);var X=!1;function $(t,e,n,o){F(t,(s<<1)+(o?1:0),3),function(t,e,n,o){W(t),o&&(N(t,n),N(t,~n)),r.arraySet(t.pending_buf,t.window,e,n,t.pending),t.pending+=n}(t,e,n,!0)}n._tr_init=function(t){X||(function(){var t,e,n,r,o,i=new Array(f+1);for(r=n=0;r<l-1;r++)for(O[r]=n,t=0;t<1<<E[r];t++)A[n++]=r;for(A[n-1]=r,r=o=0;r<16;r++)for(R[r]=o,t=0;t<1<<w[r];t++)P[o++]=r;for(o>>=7;r<p;r++)for(R[r]=o<<7,t=0;t<1<<w[r]-7;t++)P[256+o++]=r;for(e=0;e<=f;e++)i[e]=0;for(t=0;t<=143;)L[2*t+1]=8,t++,i[8]++;for(;t<=255;)L[2*t+1]=9,t++,i[9]++;for(;t<=279;)L[2*t+1]=7,t++,i[7]++;for(;t<=287;)L[2*t+1]=8,t++,i[8]++;for(B(L,u+1,i),t=0;t<p;t++)T[2*t+1]=5,T[2*t]=G(t,5);x=new Z(L,E,c+1,u,f),I=new Z(T,w,0,p,f),M=new Z(new Array(0),S,0,d,g)}(),X=!0),t.l_desc=new D(t.dyn_ltree,x),t.d_desc=new D(t.dyn_dtree,I),t.bl_desc=new D(t.bl_tree,M),t.bi_buf=0,t.bi_valid=0,j(t)},n._tr_stored_block=$,n._tr_flush_block=function(t,e,n,r){var a,s,l=0;0<t.level?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return o;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return i;for(e=32;e<c;e++)if(0!==t.dyn_ltree[2*e])return i;return o}(t)),z(t,t.l_desc),z(t,t.d_desc),l=function(t){var e;for(Y(t,t.dyn_ltree,t.l_desc.max_code),Y(t,t.dyn_dtree,t.d_desc.max_code),z(t,t.bl_desc),e=d-1;3<=e&&0===t.bl_tree[2*b[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),a=t.opt_len+3+7>>>3,(s=t.static_len+3+7>>>3)<=a&&(a=s)):a=s=n+5,n+4<=a&&-1!==e?$(t,e,n,r):4===t.strategy||s===a?(F(t,2+(r?1:0),3),V(t,L,T)):(F(t,4+(r?1:0),3),function(t,e,n,r){var o;for(F(t,e-257,5),F(t,n-1,5),F(t,r-4,4),o=0;o<r;o++)F(t,t.bl_tree[2*b[o]+1],3);K(t,t.dyn_ltree,e-1),K(t,t.dyn_dtree,n-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,l+1),V(t,t.dyn_ltree,t.dyn_dtree)),j(t),r&&W(t)},n._tr_tally=function(t,e,n){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(A[n]+c+1)]++,t.dyn_dtree[2*k(e)]++),t.last_lit===t.lit_bufsize-1},n._tr_align=function(t){F(t,2,3),U(t,y,L),function(t){16===t.bi_valid?(N(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{"../utils/common":41}],53:[function(t,e,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,e,n){"use strict";e.exports="function"==typeof setImmediate?setImmediate:function(){var t=[].slice.apply(arguments);t.splice(1,0,0),setTimeout.apply(null,t)}},{}]},{},[10])(10)},5915:function(t,e){var n,r,o;r=[],void 0===(o="function"==typeof(n=function(){var t=function(){},e={},n={},r={};function o(t,e){t=t.push?t:[t];var o,i,a,s=[],l=t.length,c=l;for(o=function(t,n){n.length&&s.push(t),--c||e(s)};l--;)i=t[l],(a=n[i])?o(i,a):(r[i]=r[i]||[]).push(o)}function i(t,e){if(t){var o=r[t];if(n[t]=e,o)for(;o.length;)o[0](t,e),o.splice(0,1)}}function a(e,n){e.call&&(e={success:e}),n.length?(e.error||t)(n):(e.success||t)(e)}function s(e,n,r,o){var i,a,l=document,c=r.async,u=(r.numRetries||0)+1,p=r.before||t,d=e.replace(/[\?|#].*$/,""),h=e.replace(/^(css|img)!/,"");o=o||0,/(^css!|\.css$)/.test(d)?((a=l.createElement("link")).rel="stylesheet",a.href=h,(i="hideFocus"in a)&&a.relList&&(i=0,a.rel="preload",a.as="style")):/(^img!|\.(png|gif|jpg|svg|webp)$)/.test(d)?(a=l.createElement("img")).src=h:((a=l.createElement("script")).src=e,a.async=void 0===c||c),a.onload=a.onerror=a.onbeforeload=function(t){var l=t.type[0];if(i)try{a.sheet.cssText.length||(l="e")}catch(t){18!=t.code&&(l="e")}if("e"==l){if((o+=1)<u)return s(e,n,r,o)}else if("preload"==a.rel&&"style"==a.as)return a.rel="stylesheet";n(e,l,t.defaultPrevented)},!1!==p(e,a)&&l.head.appendChild(a)}function l(t,e,n){var r,o,i=(t=t.push?t:[t]).length,a=i,l=[];for(r=function(t,n,r){if("e"==n&&l.push(t),"b"==n){if(!r)return;l.push(t)}--i||e(l)},o=0;o<a;o++)s(t[o],r,n)}function c(t,n,r){var o,s;if(n&&n.trim&&(o=n),s=(o?r:n)||{},o){if(o in e)throw"LoadJS";e[o]=!0}function c(e,n){l(t,(function(t){a(s,t),e&&a({success:e,error:n},t),i(o,t)}),s)}if(s.returnPromise)return new Promise(c);c()}return c.ready=function(t,e){return o(t,(function(t){a(e,t)})),c},c.done=function(t){i(t,[])},c.reset=function(){e={},n={},r={}},c.isDefined=function(t){return t in e},c})?n.apply(e,r):n)||(t.exports=o)},1466:(t,e,n)=>{
/*!
    localForage -- Offline Storage, Improved
    Version 1.7.3
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/
t.exports=function t(e,n,r){function o(a,s){if(!n[a]){if(!e[a]){if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[a]={exports:{}};e[a][0].call(c.exports,(function(t){var n=e[a][1][t];return o(n||t)}),c,c.exports,t,e,n,r)}return n[a].exports}for(var i=void 0,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,r){(function(t){"use strict";var n,r,o=t.MutationObserver||t.WebKitMutationObserver;if(o){var i=0,a=new o(u),s=t.document.createTextNode("");a.observe(s,{characterData:!0}),n=function(){s.data=i=++i%2}}else if(t.setImmediate||void 0===t.MessageChannel)n="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){u(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(u,0)};else{var l=new t.MessageChannel;l.port1.onmessage=u,n=function(){l.port2.postMessage(0)}}var c=[];function u(){var t,e;r=!0;for(var n=c.length;n;){for(e=c,c=[],t=-1;++t<n;)e[t]();n=c.length}r=!1}function p(t){1!==c.push(t)||r||n()}e.exports=p}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,n){"use strict";var r=t(1);function o(){}var i={},a=["REJECTED"],s=["FULFILLED"],l=["PENDING"];function c(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,t!==o&&h(this,t)}function u(t,e,n){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function p(t,e,n){r((function(){var r;try{r=e(n)}catch(e){return i.reject(t,e)}r===t?i.reject(t,new TypeError("Cannot resolve promise with itself")):i.resolve(t,r)}))}function d(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function h(t,e){var n=!1;function r(e){n||(n=!0,i.reject(t,e))}function o(e){n||(n=!0,i.resolve(t,e))}function a(){e(o,r)}var s=f(a);"error"===s.status&&r(s.value)}function f(t,e){var n={};try{n.value=t(e),n.status="success"}catch(t){n.status="error",n.value=t}return n}function m(t){return t instanceof this?t:i.resolve(new this(o),t)}function g(t){var e=new this(o);return i.reject(e,t)}function y(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,r=!1;if(!n)return this.resolve([]);for(var a=new Array(n),s=0,l=-1,c=new this(o);++l<n;)u(t[l],l);return c;function u(t,o){function l(t){a[o]=t,++s!==n||r||(r=!0,i.resolve(c,a))}e.resolve(t).then(l,(function(t){r||(r=!0,i.reject(c,t))}))}}function v(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,r=!1;if(!n)return this.resolve([]);for(var a=-1,s=new this(o);++a<n;)l(t[a]);return s;function l(t){e.resolve(t).then((function(t){r||(r=!0,i.resolve(s,t))}),(function(t){r||(r=!0,i.reject(s,t))}))}}e.exports=c,c.prototype.catch=function(t){return this.then(null,t)},c.prototype.then=function(t,e){if("function"!=typeof t&&this.state===s||"function"!=typeof e&&this.state===a)return this;var n=new this.constructor(o);return this.state!==l?p(n,this.state===s?t:e,this.outcome):this.queue.push(new u(n,t,e)),n},u.prototype.callFulfilled=function(t){i.resolve(this.promise,t)},u.prototype.otherCallFulfilled=function(t){p(this.promise,this.onFulfilled,t)},u.prototype.callRejected=function(t){i.reject(this.promise,t)},u.prototype.otherCallRejected=function(t){p(this.promise,this.onRejected,t)},i.resolve=function(t,e){var n=f(d,e);if("error"===n.status)return i.reject(t,n.value);var r=n.value;if(r)h(t,r);else{t.state=s,t.outcome=e;for(var o=-1,a=t.queue.length;++o<a;)t.queue[o].callFulfilled(e)}return t},i.reject=function(t,e){t.state=a,t.outcome=e;for(var n=-1,r=t.queue.length;++n<r;)t.queue[n].callRejected(e);return t},c.resolve=m,c.reject=g,c.all=y,c.race=v},{1:1}],3:[function(t,e,r){(function(e){"use strict";"function"!=typeof e.Promise&&(e.Promise=t(2))}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(t){return}}var a=i();function s(){try{if(!a)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||e)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(t){return!1}}function l(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(o){if("TypeError"!==o.name)throw o;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<t.length;r+=1)n.append(t[r]);return n.getBlob(e.type)}}"undefined"==typeof Promise&&t(3);var c=Promise;function u(t,e){e&&t.then((function(t){e(null,t)}),(function(t){e(t)}))}function p(t,e,n){"function"==typeof e&&t.then(e),"function"==typeof n&&t.catch(n)}function d(t){return"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t)),t}function h(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var f="local-forage-detect-blob-support",m=void 0,g={},y=Object.prototype.toString,v="readonly",_="readwrite";function C(t){for(var e=t.length,n=new ArrayBuffer(e),r=new Uint8Array(n),o=0;o<e;o++)r[o]=t.charCodeAt(o);return n}function E(t){return new c((function(e){var n=t.transaction(f,_),r=l([""]);n.objectStore(f).put(r,"key"),n.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},n.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);e(n||!t||parseInt(t[1],10)>=43)}})).catch((function(){return!1}))}function w(t){return"boolean"==typeof m?c.resolve(m):E(t).then((function(t){return m=t}))}function S(t){var e=g[t.name],n={};n.promise=new c((function(t,e){n.resolve=t,n.reject=e})),e.deferredOperations.push(n),e.dbReady?e.dbReady=e.dbReady.then((function(){return n.promise})):e.dbReady=n.promise}function b(t){var e=g[t.name].deferredOperations.pop();if(e)return e.resolve(),e.promise}function L(t,e){var n=g[t.name].deferredOperations.pop();if(n)return n.reject(e),n.promise}function T(t,e){return new c((function(n,r){if(g[t.name]=g[t.name]||k(),t.db){if(!e)return n(t.db);S(t),t.db.close()}var o=[t.name];e&&o.push(t.version);var i=a.open.apply(a,o);e&&(i.onupgradeneeded=function(e){var n=i.result;try{n.createObjectStore(t.storeName),e.oldVersion<=1&&n.createObjectStore(f)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+t.name+'" has been upgraded from version '+e.oldVersion+" to version "+e.newVersion+', but the storage "'+t.storeName+'" already exists.')}}),i.onerror=function(t){t.preventDefault(),r(i.error)},i.onsuccess=function(){n(i.result),b(t)}}))}function P(t){return T(t,!1)}function A(t){return T(t,!0)}function O(t,e){if(!t.db)return!0;var n=!t.db.objectStoreNames.contains(t.storeName),r=t.version<t.db.version,o=t.version>t.db.version;if(r&&(t.version!==e&&console.warn('The database "'+t.name+"\" can't be downgraded from version "+t.db.version+" to version "+t.version+"."),t.version=t.db.version),o||n){if(n){var i=t.db.version+1;i>t.version&&(t.version=i)}return!0}return!1}function x(t){return new c((function(e,n){var r=new FileReader;r.onerror=n,r.onloadend=function(n){var r=btoa(n.target.result||"");e({__local_forage_encoded_blob:!0,data:r,type:t.type})},r.readAsBinaryString(t)}))}function I(t){return l([C(atob(t.data))],{type:t.type})}function M(t){return t&&t.__local_forage_encoded_blob}function R(t){var e=this,n=e._initReady().then((function(){var t=g[e._dbInfo.name];if(t&&t.dbReady)return t.dbReady}));return p(n,t,t),n}function Z(t){S(t);for(var e=g[t.name],n=e.forages,r=0;r<n.length;r++){var o=n[r];o._dbInfo.db&&(o._dbInfo.db.close(),o._dbInfo.db=null)}return t.db=null,P(t).then((function(e){return t.db=e,O(t)?A(t):e})).then((function(r){t.db=e.db=r;for(var o=0;o<n.length;o++)n[o]._dbInfo.db=r})).catch((function(e){throw L(t,e),e}))}function D(t,e,n,r){void 0===r&&(r=1);try{var o=t.db.transaction(t.storeName,e);n(null,o)}catch(o){if(r>0&&(!t.db||"InvalidStateError"===o.name||"NotFoundError"===o.name))return c.resolve().then((function(){if(!t.db||"NotFoundError"===o.name&&!t.db.objectStoreNames.contains(t.storeName)&&t.version<=t.db.version)return t.db&&(t.version=t.db.version+1),A(t)})).then((function(){return Z(t).then((function(){D(t,e,n,r-1)}))})).catch(n);n(o)}}function k(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function N(t){var e=this,n={db:null};if(t)for(var r in t)n[r]=t[r];var o=g[n.name];o||(o=k(),g[n.name]=o),o.forages.push(e),e._initReady||(e._initReady=e.ready,e.ready=R);var i=[];function a(){return c.resolve()}for(var s=0;s<o.forages.length;s++){var l=o.forages[s];l!==e&&i.push(l._initReady().catch(a))}var u=o.forages.slice(0);return c.all(i).then((function(){return n.db=o.db,P(n)})).then((function(t){return n.db=t,O(n,e._defaultConfig.version)?A(n):t})).then((function(t){n.db=o.db=t,e._dbInfo=n;for(var r=0;r<u.length;r++){var i=u[r];i!==e&&(i._dbInfo.db=n.db,i._dbInfo.version=n.version)}}))}function F(t,e){var n=this;t=d(t);var r=new c((function(e,r){n.ready().then((function(){D(n._dbInfo,v,(function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName).get(t);a.onsuccess=function(){var t=a.result;void 0===t&&(t=null),M(t)&&(t=I(t)),e(t)},a.onerror=function(){r(a.error)}}catch(t){r(t)}}))})).catch(r)}));return u(r,e),r}function U(t,e){var n=this,r=new c((function(e,r){n.ready().then((function(){D(n._dbInfo,v,(function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName).openCursor(),s=1;a.onsuccess=function(){var n=a.result;if(n){var r=n.value;M(r)&&(r=I(r));var o=t(r,n.key,s++);void 0!==o?e(o):n.continue()}else e()},a.onerror=function(){r(a.error)}}catch(t){r(t)}}))})).catch(r)}));return u(r,e),r}function G(t,e,n){var r=this;t=d(t);var o=new c((function(n,o){var i;r.ready().then((function(){return i=r._dbInfo,"[object Blob]"===y.call(e)?w(i.db).then((function(t){return t?e:x(e)})):e})).then((function(e){D(r._dbInfo,_,(function(i,a){if(i)return o(i);try{var s=a.objectStore(r._dbInfo.storeName);null===e&&(e=void 0);var l=s.put(e,t);a.oncomplete=function(){void 0===e&&(e=null),n(e)},a.onabort=a.onerror=function(){var t=l.error?l.error:l.transaction.error;o(t)}}catch(t){o(t)}}))})).catch(o)}));return u(o,n),o}function B(t,e){var n=this;t=d(t);var r=new c((function(e,r){n.ready().then((function(){D(n._dbInfo,_,(function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName).delete(t);i.oncomplete=function(){e()},i.onerror=function(){r(a.error)},i.onabort=function(){var t=a.error?a.error:a.transaction.error;r(t)}}catch(t){r(t)}}))})).catch(r)}));return u(r,e),r}function j(t){var e=this,n=new c((function(t,n){e.ready().then((function(){D(e._dbInfo,_,(function(r,o){if(r)return n(r);try{var i=o.objectStore(e._dbInfo.storeName).clear();o.oncomplete=function(){t()},o.onabort=o.onerror=function(){var t=i.error?i.error:i.transaction.error;n(t)}}catch(t){n(t)}}))})).catch(n)}));return u(n,t),n}function W(t){var e=this,n=new c((function(t,n){e.ready().then((function(){D(e._dbInfo,v,(function(r,o){if(r)return n(r);try{var i=o.objectStore(e._dbInfo.storeName).count();i.onsuccess=function(){t(i.result)},i.onerror=function(){n(i.error)}}catch(t){n(t)}}))})).catch(n)}));return u(n,t),n}function q(t,e){var n=this,r=new c((function(e,r){t<0?e(null):n.ready().then((function(){D(n._dbInfo,v,(function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName),s=!1,l=a.openCursor();l.onsuccess=function(){var n=l.result;n?0===t||s?e(n.key):(s=!0,n.advance(t)):e(null)},l.onerror=function(){r(l.error)}}catch(t){r(t)}}))})).catch(r)}));return u(r,e),r}function H(t){var e=this,n=new c((function(t,n){e.ready().then((function(){D(e._dbInfo,v,(function(r,o){if(r)return n(r);try{var i=o.objectStore(e._dbInfo.storeName).openCursor(),a=[];i.onsuccess=function(){var e=i.result;e?(a.push(e.key),e.continue()):t(a)},i.onerror=function(){n(i.error)}}catch(t){n(t)}}))})).catch(n)}));return u(n,t),n}function V(t,e){e=h.apply(this,arguments);var n=this.config();(t="function"!=typeof t&&t||{}).name||(t.name=t.name||n.name,t.storeName=t.storeName||n.storeName);var r,o=this;if(t.name){var i=t.name===n.name&&o._dbInfo.db?c.resolve(o._dbInfo.db):P(t).then((function(e){var n=g[t.name],r=n.forages;n.db=e;for(var o=0;o<r.length;o++)r[o]._dbInfo.db=e;return e}));r=t.storeName?i.then((function(e){if(e.objectStoreNames.contains(t.storeName)){var n=e.version+1;S(t);var r=g[t.name],o=r.forages;e.close();for(var i=0;i<o.length;i++){var s=o[i];s._dbInfo.db=null,s._dbInfo.version=n}var l=new c((function(e,r){var o=a.open(t.name,n);o.onerror=function(t){o.result.close(),r(t)},o.onupgradeneeded=function(){o.result.deleteObjectStore(t.storeName)},o.onsuccess=function(){var t=o.result;t.close(),e(t)}}));return l.then((function(t){r.db=t;for(var e=0;e<o.length;e++){var n=o[e];n._dbInfo.db=t,b(n._dbInfo)}})).catch((function(e){throw(L(t,e)||c.resolve()).catch((function(){})),e}))}})):i.then((function(e){S(t);var n=g[t.name],r=n.forages;e.close();for(var o=0;o<r.length;o++)r[o]._dbInfo.db=null;var i=new c((function(e,n){var r=a.deleteDatabase(t.name);r.onerror=r.onblocked=function(t){var e=r.result;e&&e.close(),n(t)},r.onsuccess=function(){var t=r.result;t&&t.close(),e(t)}}));return i.then((function(t){n.db=t;for(var e=0;e<r.length;e++)b(r[e]._dbInfo)})).catch((function(e){throw(L(t,e)||c.resolve()).catch((function(){})),e}))}))}else r=c.reject("Invalid arguments");return u(r,e),r}var z={_driver:"asyncStorage",_initStorage:N,_support:s(),iterate:U,getItem:F,setItem:G,removeItem:B,clear:j,length:W,key:q,keys:H,dropInstance:V};function Y(){return"function"==typeof openDatabase}var K="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",X="~~local_forage_type~",$=/^~~local_forage_type~([^~]+)~/,J="__lfsc__:",Q=J.length,tt="arbf",et="blob",nt="si08",rt="ui08",ot="uic8",it="si16",at="si32",st="ur16",lt="ui32",ct="fl32",ut="fl64",pt=Q+tt.length,dt=Object.prototype.toString;function ht(t){var e,n,r,o,i,a=.75*t.length,s=t.length,l=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var c=new ArrayBuffer(a),u=new Uint8Array(c);for(e=0;e<s;e+=4)n=K.indexOf(t[e]),r=K.indexOf(t[e+1]),o=K.indexOf(t[e+2]),i=K.indexOf(t[e+3]),u[l++]=n<<2|r>>4,u[l++]=(15&r)<<4|o>>2,u[l++]=(3&o)<<6|63&i;return c}function ft(t){var e,n=new Uint8Array(t),r="";for(e=0;e<n.length;e+=3)r+=K[n[e]>>2],r+=K[(3&n[e])<<4|n[e+1]>>4],r+=K[(15&n[e+1])<<2|n[e+2]>>6],r+=K[63&n[e+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}function mt(t,e){var n="";if(t&&(n=dt.call(t)),t&&("[object ArrayBuffer]"===n||t.buffer&&"[object ArrayBuffer]"===dt.call(t.buffer))){var r,o=J;t instanceof ArrayBuffer?(r=t,o+=tt):(r=t.buffer,"[object Int8Array]"===n?o+=nt:"[object Uint8Array]"===n?o+=rt:"[object Uint8ClampedArray]"===n?o+=ot:"[object Int16Array]"===n?o+=it:"[object Uint16Array]"===n?o+=st:"[object Int32Array]"===n?o+=at:"[object Uint32Array]"===n?o+=lt:"[object Float32Array]"===n?o+=ct:"[object Float64Array]"===n?o+=ut:e(new Error("Failed to get type for BinaryArray"))),e(o+ft(r))}else if("[object Blob]"===n){var i=new FileReader;i.onload=function(){var n=X+t.type+"~"+ft(this.result);e(J+et+n)},i.readAsArrayBuffer(t)}else try{e(JSON.stringify(t))}catch(n){console.error("Couldn't convert value into a JSON string: ",t),e(null,n)}}function gt(t){if(t.substring(0,Q)!==J)return JSON.parse(t);var e,n=t.substring(pt),r=t.substring(Q,pt);if(r===et&&$.test(n)){var o=n.match($);e=o[1],n=n.substring(o[0].length)}var i=ht(n);switch(r){case tt:return i;case et:return l([i],{type:e});case nt:return new Int8Array(i);case rt:return new Uint8Array(i);case ot:return new Uint8ClampedArray(i);case it:return new Int16Array(i);case st:return new Uint16Array(i);case at:return new Int32Array(i);case lt:return new Uint32Array(i);case ct:return new Float32Array(i);case ut:return new Float64Array(i);default:throw new Error("Unkown type: "+r)}}var yt={serialize:mt,deserialize:gt,stringToBuffer:ht,bufferToString:ft};function vt(t,e,n,r){t.executeSql("CREATE TABLE IF NOT EXISTS "+e.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function _t(t){var e=this,n={db:null};if(t)for(var r in t)n[r]="string"!=typeof t[r]?t[r].toString():t[r];var o=new c((function(t,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(t){return r(t)}n.db.transaction((function(o){vt(o,n,(function(){e._dbInfo=n,t()}),(function(t,e){r(e)}))}),r)}));return n.serializer=yt,o}function Ct(t,e,n,r,o,i){t.executeSql(n,r,o,(function(t,a){a.code===a.SYNTAX_ERR?t.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[e.storeName],(function(t,s){s.rows.length?i(t,a):vt(t,e,(function(){t.executeSql(n,r,o,i)}),i)}),i):i(t,a)}),i)}function Et(t,e){var n=this;t=d(t);var r=new c((function(e,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){Ct(n,o,"SELECT * FROM "+o.storeName+" WHERE key = ? LIMIT 1",[t],(function(t,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=o.serializer.deserialize(r)),e(r)}),(function(t,e){r(e)}))}))})).catch(r)}));return u(r,e),r}function wt(t,e){var n=this,r=new c((function(e,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){Ct(n,o,"SELECT * FROM "+o.storeName,[],(function(n,r){for(var i=r.rows,a=i.length,s=0;s<a;s++){var l=i.item(s),c=l.value;if(c&&(c=o.serializer.deserialize(c)),void 0!==(c=t(c,l.key,s+1)))return void e(c)}e()}),(function(t,e){r(e)}))}))})).catch(r)}));return u(r,e),r}function St(t,e,n,r){var o=this;t=d(t);var i=new c((function(i,a){o.ready().then((function(){void 0===e&&(e=null);var s=e,l=o._dbInfo;l.serializer.serialize(e,(function(e,c){c?a(c):l.db.transaction((function(n){Ct(n,l,"INSERT OR REPLACE INTO "+l.storeName+" (key, value) VALUES (?, ?)",[t,e],(function(){i(s)}),(function(t,e){a(e)}))}),(function(e){if(e.code===e.QUOTA_ERR){if(r>0)return void i(St.apply(o,[t,s,n,r-1]));a(e)}}))}))})).catch(a)}));return u(i,n),i}function bt(t,e,n){return St.apply(this,[t,e,n,1])}function Lt(t,e){var n=this;t=d(t);var r=new c((function(e,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){Ct(n,o,"DELETE FROM "+o.storeName+" WHERE key = ?",[t],(function(){e()}),(function(t,e){r(e)}))}))})).catch(r)}));return u(r,e),r}function Tt(t){var e=this,n=new c((function(t,n){e.ready().then((function(){var r=e._dbInfo;r.db.transaction((function(e){Ct(e,r,"DELETE FROM "+r.storeName,[],(function(){t()}),(function(t,e){n(e)}))}))})).catch(n)}));return u(n,t),n}function Pt(t){var e=this,n=new c((function(t,n){e.ready().then((function(){var r=e._dbInfo;r.db.transaction((function(e){Ct(e,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(e,n){var r=n.rows.item(0).c;t(r)}),(function(t,e){n(e)}))}))})).catch(n)}));return u(n,t),n}function At(t,e){var n=this,r=new c((function(e,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){Ct(n,o,"SELECT key FROM "+o.storeName+" WHERE id = ? LIMIT 1",[t+1],(function(t,n){var r=n.rows.length?n.rows.item(0).key:null;e(r)}),(function(t,e){r(e)}))}))})).catch(r)}));return u(r,e),r}function Ot(t){var e=this,n=new c((function(t,n){e.ready().then((function(){var r=e._dbInfo;r.db.transaction((function(e){Ct(e,r,"SELECT key FROM "+r.storeName,[],(function(e,n){for(var r=[],o=0;o<n.rows.length;o++)r.push(n.rows.item(o).key);t(r)}),(function(t,e){n(e)}))}))})).catch(n)}));return u(n,t),n}function xt(t){return new c((function(e,n){t.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var o=[],i=0;i<r.rows.length;i++)o.push(r.rows.item(i).name);e({db:t,storeNames:o})}),(function(t,e){n(e)}))}),(function(t){n(t)}))}))}function It(t,e){e=h.apply(this,arguments);var n=this.config();(t="function"!=typeof t&&t||{}).name||(t.name=t.name||n.name,t.storeName=t.storeName||n.storeName);var r,o=this;return u(r=t.name?new c((function(e){var r;r=t.name===n.name?o._dbInfo.db:openDatabase(t.name,"","",0),t.storeName?e({db:r,storeNames:[t.storeName]}):e(xt(r))})).then((function(t){return new c((function(e,n){t.db.transaction((function(r){function o(t){return new c((function(e,n){r.executeSql("DROP TABLE IF EXISTS "+t,[],(function(){e()}),(function(t,e){n(e)}))}))}for(var i=[],a=0,s=t.storeNames.length;a<s;a++)i.push(o(t.storeNames[a]));c.all(i).then((function(){e()})).catch((function(t){n(t)}))}),(function(t){n(t)}))}))})):c.reject("Invalid arguments"),e),r}var Mt={_driver:"webSQLStorage",_initStorage:_t,_support:Y(),iterate:wt,getItem:Et,setItem:bt,removeItem:Lt,clear:Tt,length:Pt,key:At,keys:Ot,dropInstance:It};function Rt(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(t){return!1}}function Zt(t,e){var n=t.name+"/";return t.storeName!==e.storeName&&(n+=t.storeName+"/"),n}function Dt(){var t="_localforage_support_test";try{return localStorage.setItem(t,!0),localStorage.removeItem(t),!1}catch(t){return!0}}function kt(){return!Dt()||localStorage.length>0}function Nt(t){var e=this,n={};if(t)for(var r in t)n[r]=t[r];return n.keyPrefix=Zt(t,e._defaultConfig),kt()?(e._dbInfo=n,n.serializer=yt,c.resolve()):c.reject()}function Ft(t){var e=this,n=e.ready().then((function(){for(var t=e._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(t)&&localStorage.removeItem(r)}}));return u(n,t),n}function Ut(t,e){var n=this;t=d(t);var r=n.ready().then((function(){var e=n._dbInfo,r=localStorage.getItem(e.keyPrefix+t);return r&&(r=e.serializer.deserialize(r)),r}));return u(r,e),r}function Gt(t,e){var n=this,r=n.ready().then((function(){for(var e=n._dbInfo,r=e.keyPrefix,o=r.length,i=localStorage.length,a=1,s=0;s<i;s++){var l=localStorage.key(s);if(0===l.indexOf(r)){var c=localStorage.getItem(l);if(c&&(c=e.serializer.deserialize(c)),void 0!==(c=t(c,l.substring(o),a++)))return c}}}));return u(r,e),r}function Bt(t,e){var n=this,r=n.ready().then((function(){var e,r=n._dbInfo;try{e=localStorage.key(t)}catch(t){e=null}return e&&(e=e.substring(r.keyPrefix.length)),e}));return u(r,e),r}function jt(t){var e=this,n=e.ready().then((function(){for(var t=e._dbInfo,n=localStorage.length,r=[],o=0;o<n;o++){var i=localStorage.key(o);0===i.indexOf(t.keyPrefix)&&r.push(i.substring(t.keyPrefix.length))}return r}));return u(n,t),n}function Wt(t){var e=this.keys().then((function(t){return t.length}));return u(e,t),e}function qt(t,e){var n=this;t=d(t);var r=n.ready().then((function(){var e=n._dbInfo;localStorage.removeItem(e.keyPrefix+t)}));return u(r,e),r}function Ht(t,e,n){var r=this;t=d(t);var o=r.ready().then((function(){void 0===e&&(e=null);var n=e;return new c((function(o,i){var a=r._dbInfo;a.serializer.serialize(e,(function(e,r){if(r)i(r);else try{localStorage.setItem(a.keyPrefix+t,e),o(n)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||i(t),i(t)}}))}))}));return u(o,n),o}function Vt(t,e){if(e=h.apply(this,arguments),!(t="function"!=typeof t&&t||{}).name){var n=this.config();t.name=t.name||n.name,t.storeName=t.storeName||n.storeName}var r,o=this;return r=t.name?new c((function(e){t.storeName?e(Zt(t,o._defaultConfig)):e(t.name+"/")})).then((function(t){for(var e=localStorage.length-1;e>=0;e--){var n=localStorage.key(e);0===n.indexOf(t)&&localStorage.removeItem(n)}})):c.reject("Invalid arguments"),u(r,e),r}var zt={_driver:"localStorageWrapper",_initStorage:Nt,_support:Rt(),iterate:Gt,getItem:Ut,setItem:Ht,removeItem:qt,clear:Ft,length:Wt,key:Bt,keys:jt,dropInstance:Vt},Yt=function(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)},Kt=function(t,e){for(var n=t.length,r=0;r<n;){if(Yt(t[r],e))return!0;r++}return!1},Xt=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},$t={},Jt={},Qt={INDEXEDDB:z,WEBSQL:Mt,LOCALSTORAGE:zt},te=[Qt.INDEXEDDB._driver,Qt.WEBSQL._driver,Qt.LOCALSTORAGE._driver],ee=["dropInstance"],ne=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ee),re={description:"",driver:te.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function oe(t,e){t[e]=function(){var n=arguments;return t.ready().then((function(){return t[e].apply(t,n)}))}}function ie(){for(var t=1;t<arguments.length;t++){var e=arguments[t];if(e)for(var n in e)e.hasOwnProperty(n)&&(Xt(e[n])?arguments[0][n]=e[n].slice():arguments[0][n]=e[n])}return arguments[0]}var ae=function(){function t(e){for(var n in o(this,t),Qt)if(Qt.hasOwnProperty(n)){var r=Qt[n],i=r._driver;this[n]=i,$t[i]||this.defineDriver(r)}this._defaultConfig=ie({},re),this._config=ie({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return t.prototype.config=function(t){if("object"===(void 0===t?"undefined":r(t))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var e in t){if("storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),"version"===e&&"number"!=typeof t[e])return new Error("Database version must be a number.");this._config[e]=t[e]}return!("driver"in t)||!t.driver||this.setDriver(this._config.driver)}return"string"==typeof t?this._config[t]:this._config},t.prototype.defineDriver=function(t,e,n){var r=new c((function(e,n){try{var r=t._driver,o=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver)return void n(o);for(var i=ne.concat("_initStorage"),a=0,s=i.length;a<s;a++){var l=i[a];if((!Kt(ee,l)||t[l])&&"function"!=typeof t[l])return void n(o)}var p=function(){for(var e=function(t){return function(){var e=new Error("Method "+t+" is not implemented by the current driver"),n=c.reject(e);return u(n,arguments[arguments.length-1]),n}},n=0,r=ee.length;n<r;n++){var o=ee[n];t[o]||(t[o]=e(o))}};p();var d=function(n){$t[r]&&console.info("Redefining LocalForage driver: "+r),$t[r]=t,Jt[r]=n,e()};"_support"in t?t._support&&"function"==typeof t._support?t._support().then(d,n):d(!!t._support):d(!0)}catch(t){n(t)}}));return p(r,e,n),r},t.prototype.driver=function(){return this._driver||null},t.prototype.getDriver=function(t,e,n){var r=$t[t]?c.resolve($t[t]):c.reject(new Error("Driver not found."));return p(r,e,n),r},t.prototype.getSerializer=function(t){var e=c.resolve(yt);return p(e,t),e},t.prototype.ready=function(t){var e=this,n=e._driverSet.then((function(){return null===e._ready&&(e._ready=e._initDriver()),e._ready}));return p(n,t,t),n},t.prototype.setDriver=function(t,e,n){var r=this;Xt(t)||(t=[t]);var o=this._getSupportedDrivers(t);function i(){r._config.driver=r.driver()}function a(t){return r._extend(t),i(),r._ready=r._initStorage(r._config),r._ready}function s(t){return function(){var e=0;function n(){for(;e<t.length;){var o=t[e];return e++,r._dbInfo=null,r._ready=null,r.getDriver(o).then(a).catch(n)}i();var s=new Error("No available storage method found.");return r._driverSet=c.reject(s),r._driverSet}return n()}}var l=null!==this._driverSet?this._driverSet.catch((function(){return c.resolve()})):c.resolve();return this._driverSet=l.then((function(){var t=o[0];return r._dbInfo=null,r._ready=null,r.getDriver(t).then((function(t){r._driver=t._driver,i(),r._wrapLibraryMethodsWithReady(),r._initDriver=s(o)}))})).catch((function(){i();var t=new Error("No available storage method found.");return r._driverSet=c.reject(t),r._driverSet})),p(this._driverSet,e,n),this._driverSet},t.prototype.supports=function(t){return!!Jt[t]},t.prototype._extend=function(t){ie(this,t)},t.prototype._getSupportedDrivers=function(t){for(var e=[],n=0,r=t.length;n<r;n++){var o=t[n];this.supports(o)&&e.push(o)}return e},t.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,e=ne.length;t<e;t++)oe(this,ne[t])},t.prototype.createInstance=function(e){return new t(e)},t}(),se=new ae;e.exports=se},{3:3}]},{},[4])(4)},7074:(t,e,n)=>{"use strict";n.d(e,{Z:()=>fn});var r=6378137,o=.0066943799901413165,i=484813681109536e-20,a=Math.PI/2,s=1e-10,l=.017453292519943295,c=57.29577951308232,u=Math.PI/4,p=2*Math.PI,d=3.14159265359,h={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667};const f={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var m=/[\s_\-\/\(\)]/g;function g(t,e){if(t[e])return t[e];for(var n,r=Object.keys(t),o=e.toLowerCase().replace(m,""),i=-1;++i<r.length;)if((n=r[i]).toLowerCase().replace(m,"")===o)return t[n]}function y(t){var e,n,r,o={},i=t.split("+").map((function(t){return t.trim()})).filter((function(t){return t})).reduce((function(t,e){var n=e.split("=");return n.push(!0),t[n[0].toLowerCase()]=n[1],t}),{}),a={proj:"projName",datum:"datumCode",rf:function(t){o.rf=parseFloat(t)},lat_0:function(t){o.lat0=t*l},lat_1:function(t){o.lat1=t*l},lat_2:function(t){o.lat2=t*l},lat_ts:function(t){o.lat_ts=t*l},lon_0:function(t){o.long0=t*l},lon_1:function(t){o.long1=t*l},lon_2:function(t){o.long2=t*l},alpha:function(t){o.alpha=parseFloat(t)*l},gamma:function(t){o.rectified_grid_angle=parseFloat(t)},lonc:function(t){o.longc=t*l},x_0:function(t){o.x0=parseFloat(t)},y_0:function(t){o.y0=parseFloat(t)},k_0:function(t){o.k0=parseFloat(t)},k:function(t){o.k0=parseFloat(t)},a:function(t){o.a=parseFloat(t)},b:function(t){o.b=parseFloat(t)},r_a:function(){o.R_A=!0},zone:function(t){o.zone=parseInt(t,10)},south:function(){o.utmSouth=!0},towgs84:function(t){o.datum_params=t.split(",").map((function(t){return parseFloat(t)}))},to_meter:function(t){o.to_meter=parseFloat(t)},units:function(t){o.units=t;var e=g(f,t);e&&(o.to_meter=e.to_meter)},from_greenwich:function(t){o.from_greenwich=t*l},pm:function(t){var e=g(h,t);o.from_greenwich=(e||parseFloat(t))*l},nadgrids:function(t){"@null"===t?o.datumCode="none":o.nadgrids=t},axis:function(t){var e="ewnsud";3===t.length&&-1!==e.indexOf(t.substr(0,1))&&-1!==e.indexOf(t.substr(1,1))&&-1!==e.indexOf(t.substr(2,1))&&(o.axis=t)},approx:function(){o.approx=!0}};for(e in i)n=i[e],e in a?"function"==typeof(r=a[e])?r(n):o[r]=n:o[e]=n;return"string"==typeof o.datumCode&&"WGS84"!==o.datumCode&&(o.datumCode=o.datumCode.toLowerCase()),o}const v=function(t){return new b(t).output()};var _=/\s/,C=/[A-Za-z]/,E=/[A-Za-z84_]/,w=/[,\]]/,S=/[\d\.E\-\+]/;function b(t){if("string"!=typeof t)throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=1}function L(t,e,n){Array.isArray(e)&&(n.unshift(e),e=null);var r=e?{}:t,o=n.reduce((function(t,e){return T(e,t),t}),r);e&&(t[e]=o)}function T(t,e){if(Array.isArray(t)){var n=t.shift();if("PARAMETER"===n&&(n=t.shift()),1===t.length)return Array.isArray(t[0])?(e[n]={},void T(t[0],e[n])):void(e[n]=t[0]);if(t.length)if("TOWGS84"!==n){if("AXIS"===n)return n in e||(e[n]=[]),void e[n].push(t);var r;switch(Array.isArray(n)||(e[n]={}),n){case"UNIT":case"PRIMEM":case"VERT_DATUM":return e[n]={name:t[0].toLowerCase(),convert:t[1]},void(3===t.length&&T(t[2],e[n]));case"SPHEROID":case"ELLIPSOID":return e[n]={name:t[0],a:t[1],rf:t[2]},void(4===t.length&&T(t[3],e[n]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return t[0]=["name",t[0]],void L(e,n,t);default:for(r=-1;++r<t.length;)if(!Array.isArray(t[r]))return T(t,e[n]);return L(e,n,t)}}else e[n]=t;else e[n]=!0}else e[t]=!0}b.prototype.readCharicter=function(){var t=this.text[this.place++];if(4!==this.state)for(;_.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case 1:return this.neutral(t);case 2:return this.keyword(t);case 4:return this.quoted(t);case 5:return this.afterquote(t);case 3:return this.number(t);case-1:return}},b.prototype.afterquote=function(t){if('"'===t)return this.word+='"',void(this.state=4);if(w.test(t))return this.word=this.word.trim(),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in afterquote yet, index '+this.place)},b.prototype.afterItem=function(t){return","===t?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=1)):"]"===t?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=1,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},b.prototype.number=function(t){if(!S.test(t)){if(w.test(t))return this.word=parseFloat(this.word),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in number yet, index '+this.place)}this.word+=t},b.prototype.quoted=function(t){'"'!==t?this.word+=t:this.state=5},b.prototype.keyword=function(t){if(E.test(t))this.word+=t;else{if("["===t){var e=[];return e.push(this.word),this.level++,null===this.root?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,void(this.state=1)}if(!w.test(t))throw new Error("havn't handled \""+t+'" in keyword yet, index '+this.place);this.afterItem(t)}},b.prototype.neutral=function(t){if(C.test(t))return this.word=t,void(this.state=2);if('"'===t)return this.word="",void(this.state=4);if(S.test(t))return this.word=t,void(this.state=3);if(!w.test(t))throw new Error("havn't handled \""+t+'" in neutral yet, index '+this.place);this.afterItem(t)},b.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function P(t){return.017453292519943295*t}function A(t){var e=v(t),n=e.shift(),r=e.shift();e.unshift(["name",r]),e.unshift(["type",n]);var o={};return T(e,o),function(t){if("GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):"object"==typeof t.PROJECTION?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.AXIS){for(var e="",n=0,r=t.AXIS.length;n<r;++n){var o=[t.AXIS[n][0].toLowerCase(),t.AXIS[n][1].toLowerCase()];-1!==o[0].indexOf("north")||("y"===o[0]||"lat"===o[0])&&"north"===o[1]?e+="n":-1!==o[0].indexOf("south")||("y"===o[0]||"lat"===o[0])&&"south"===o[1]?e+="s":-1!==o[0].indexOf("east")||("x"===o[0]||"lon"===o[0])&&"east"===o[1]?e+="e":-1===o[0].indexOf("west")&&("x"!==o[0]&&"lon"!==o[0]||"west"!==o[1])||(e+="w")}2===e.length&&(e+="u"),3===e.length&&(t.axis=e)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var i=t.GEOGCS;function a(e){return e*(t.to_meter||1)}"GEOGCS"===t.type&&(i=t),i&&(i.DATUM?t.datumCode=i.DATUM.name.toLowerCase():t.datumCode=i.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==t.datumCode&&"new_zealand_1949"!==t.datumCode||(t.datumCode="nzgd49"),"wgs_1984"!==t.datumCode&&"world_geodetic_system_1984"!==t.datumCode||("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),i.DATUM&&i.DATUM.SPHEROID&&(t.ellps=i.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=i.DATUM.SPHEROID.a,t.rf=parseFloat(i.DATUM.SPHEROID.rf,10)),i.DATUM&&i.DATUM.TOWGS84&&(t.datum_params=i.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),"ch1903+"===t.datumCode&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",P],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",P],["x0","false_easting",a],["y0","false_northing",a],["long0","central_meridian",P],["lat0","latitude_of_origin",P],["lat0","standard_parallel_1",P],["lat1","standard_parallel_1",P],["lat2","standard_parallel_2",P],["azimuth","Azimuth"],["alpha","azimuth",P],["srsCode","name"]].forEach((function(e){return function(t,e){var n=e[0],r=e[1];!(n in t)&&r in t&&(t[n]=t[r],3===e.length&&(t[n]=e[2](t[n])))}(t,e)})),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName||(t.lat0=P(t.lat1>0?90:-90),t.lat_ts=t.lat1)}(o),o}function O(t){var e=this;if(2===arguments.length){var n=arguments[1];"string"==typeof n?"+"===n.charAt(0)?O[t]=y(arguments[1]):O[t]=A(arguments[1]):O[t]=n}else if(1===arguments.length){if(Array.isArray(t))return t.map((function(t){Array.isArray(t)?O.apply(e,t):O(t)}));if("string"==typeof t){if(t in O)return O[t]}else"EPSG"in t?O["EPSG:"+t.EPSG]=t:"ESRI"in t?O["ESRI:"+t.ESRI]=t:"IAU2000"in t?O["IAU2000:"+t.IAU2000]=t:console.log(t);return}}!function(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}(O);const x=O;var I=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];var M=["3857","900913","3785","102113"];const R=function(t){if(!function(t){return"string"==typeof t}(t))return t;if(function(t){return t in x}(t))return x[t];if(function(t){return I.some((function(e){return t.indexOf(e)>-1}))}(t)){var e=A(t);if(function(t){var e=g(t,"authority");if(e){var n=g(e,"epsg");return n&&M.indexOf(n)>-1}}(e))return x["EPSG:3857"];var n=function(t){var e=g(t,"extension");if(e)return g(e,"proj4")}(e);return n?y(n):e}return function(t){return"+"===t[0]}(t)?y(t):void 0};function Z(t,e){var n,r;if(t=t||{},!e)return t;for(r in e)void 0!==(n=e[r])&&(t[r]=n);return t}function D(t,e,n){var r=t*e;return n/Math.sqrt(1-r*r)}function k(t){return t<0?-1:1}function N(t){return Math.abs(t)<=d?t:t-k(t)*p}function F(t,e,n){var r=t*n,o=.5*t;return r=Math.pow((1-r)/(1+r),o),Math.tan(.5*(a-e))/r}function U(t,e){for(var n,r,o=.5*t,i=a-2*Math.atan(e),s=0;s<=15;s++)if(n=t*Math.sin(i),i+=r=a-2*Math.atan(e*Math.pow((1-n)/(1+n),o))-i,Math.abs(r)<=1e-10)return i;return-9999}function G(t){return t}var B=[{init:function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=D(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(t){var e,n,r=t.x,o=t.y;if(o*c>90&&o*c<-90&&r*c>180&&r*c<-180)return null;if(Math.abs(Math.abs(o)-a)<=s)return null;if(this.sphere)e=this.x0+this.a*this.k0*N(r-this.long0),n=this.y0+this.a*this.k0*Math.log(Math.tan(u+.5*o));else{var i=Math.sin(o),l=F(this.e,o,i);e=this.x0+this.a*this.k0*N(r-this.long0),n=this.y0-this.a*this.k0*Math.log(l)}return t.x=e,t.y=n,t},inverse:function(t){var e,n,r=t.x-this.x0,o=t.y-this.y0;if(this.sphere)n=a-2*Math.atan(Math.exp(-o/(this.a*this.k0)));else{var i=Math.exp(-o/(this.a*this.k0));if(-9999===(n=U(this.e,i)))return null}return e=N(this.long0+r/(this.a*this.k0)),t.x=e,t.y=n,t},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:G,inverse:G,names:["longlat","identity"]}],j={},W=[];function q(t,e){var n=W.length;return t.names?(W[n]=t,t.names.forEach((function(t){j[t.toLowerCase()]=n})),this):(console.log(e),!0)}const H={start:function(){B.forEach(q)},add:q,get:function(t){if(!t)return!1;var e=t.toLowerCase();return void 0!==j[e]&&W[j[e]]?W[j[e]]:void 0}};var V={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},z=V.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};V.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var Y={};Y.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},Y.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},Y.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},Y.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},Y.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},Y.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},Y.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},Y.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},Y.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},Y.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},Y.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},Y.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},Y.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},Y.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},Y.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},Y.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},Y.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};const K=function(t,e,n,r,o,a,s){var l={};return l.datum_type=void 0===t||"none"===t?5:4,e&&(l.datum_params=e.map(parseFloat),0===l.datum_params[0]&&0===l.datum_params[1]&&0===l.datum_params[2]||(l.datum_type=1),l.datum_params.length>3&&(0===l.datum_params[3]&&0===l.datum_params[4]&&0===l.datum_params[5]&&0===l.datum_params[6]||(l.datum_type=2,l.datum_params[3]*=i,l.datum_params[4]*=i,l.datum_params[5]*=i,l.datum_params[6]=l.datum_params[6]/1e6+1))),s&&(l.datum_type=3,l.grids=s),l.a=n,l.b=r,l.es=o,l.ep2=a,l};var X={};function $(t){if(0===t.length)return null;var e="@"===t[0];return e&&(t=t.slice(1)),"null"===t?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:t,mandatory:!e,grid:X[t]||null,isNull:!1}}function J(t){return t/3600*Math.PI/180}function Q(t,e,n){return String.fromCharCode.apply(null,new Uint8Array(t.buffer.slice(e,n)))}function tt(t){return t.map((function(t){return[J(t.longitudeShift),J(t.latitudeShift)]}))}function et(t,e,n){return{name:Q(t,e+8,e+16).trim(),parent:Q(t,e+24,e+24+8).trim(),lowerLatitude:t.getFloat64(e+72,n),upperLatitude:t.getFloat64(e+88,n),lowerLongitude:t.getFloat64(e+104,n),upperLongitude:t.getFloat64(e+120,n),latitudeInterval:t.getFloat64(e+136,n),longitudeInterval:t.getFloat64(e+152,n),gridNodeCount:t.getInt32(e+168,n)}}function nt(t,e,n,r){for(var o=e+176,i=[],a=0;a<n.gridNodeCount;a++){var s={latitudeShift:t.getFloat32(o+16*a,r),longitudeShift:t.getFloat32(o+16*a+4,r),latitudeAccuracy:t.getFloat32(o+16*a+8,r),longitudeAccuracy:t.getFloat32(o+16*a+12,r)};i.push(s)}return i}function rt(t,e){if(!(this instanceof rt))return new rt(t);e=e||function(t){if(t)throw t};var n=R(t);if("object"==typeof n){var r=rt.projections.get(n.projName);if(r){if(n.datumCode&&"none"!==n.datumCode){var o=g(Y,n.datumCode);o&&(n.datum_params=n.datum_params||(o.towgs84?o.towgs84.split(","):null),n.ellps=o.ellipse,n.datumName=o.datumName?o.datumName:n.datumCode)}n.k0=n.k0||1,n.axis=n.axis||"enu",n.ellps=n.ellps||"wgs84",n.lat1=n.lat1||n.lat0;var i=function(t,e,n,r,o){if(!t){var i=g(V,r);i||(i=z),t=i.a,e=i.b,n=i.rf}return n&&!e&&(e=(1-1/n)*t),(0===n||Math.abs(t-e)<s)&&(o=!0,e=t),{a:t,b:e,rf:n,sphere:o}}(n.a,n.b,n.rf,n.ellps,n.sphere),a=function(t,e,n,r){var o=t*t,i=e*e,a=(o-i)/o,s=0;return r?(o=(t*=1-a*(.16666666666666666+a*(.04722222222222222+.022156084656084655*a)))*t,a=0):s=Math.sqrt(a),{es:a,e:s,ep2:(o-i)/i}}(i.a,i.b,i.rf,n.R_A),l=function(t){return void 0===t?null:t.split(",").map($)}(n.nadgrids),c=n.datum||K(n.datumCode,n.datum_params,i.a,i.b,a.es,a.ep2,l);Z(this,n),Z(this,r),this.a=i.a,this.b=i.b,this.rf=i.rf,this.sphere=i.sphere,this.es=a.es,this.e=a.e,this.ep2=a.ep2,this.datum=c,this.init(),e(null,this)}else e(t)}else e(t)}rt.projections=H,rt.projections.start();const ot=rt;function it(t,e,n){var r,o,i,s,l=t.x,c=t.y,u=t.z?t.z:0;if(c<-a&&c>-1.001*a)c=-a;else if(c>a&&c<1.001*a)c=a;else{if(c<-a)return{x:-1/0,y:-1/0,z:t.z};if(c>a)return{x:1/0,y:1/0,z:t.z}}return l>Math.PI&&(l-=2*Math.PI),o=Math.sin(c),s=Math.cos(c),i=o*o,{x:((r=n/Math.sqrt(1-e*i))+u)*s*Math.cos(l),y:(r+u)*s*Math.sin(l),z:(r*(1-e)+u)*o}}function at(t,e,n,r){var o,i,s,l,c,u,p,d,h,f,m,g,y,v,_,C=1e-12,E=t.x,w=t.y,S=t.z?t.z:0;if(o=Math.sqrt(E*E+w*w),i=Math.sqrt(E*E+w*w+S*S),o/n<C){if(v=0,i/n<C)return a,_=-r,{x:t.x,y:t.y,z:t.z}}else v=Math.atan2(w,E);s=S/i,d=(l=o/i)*(1-e)*(c=1/Math.sqrt(1-e*(2-e)*l*l)),h=s*c,y=0;do{y++,u=e*(p=n/Math.sqrt(1-e*h*h))/(p+(_=o*d+S*h-p*(1-e*h*h))),g=(m=s*(c=1/Math.sqrt(1-u*(2-u)*l*l)))*d-(f=l*(1-u)*c)*h,d=f,h=m}while(g*g>1e-24&&y<30);return{x:v,y:Math.atan(m/Math.abs(f)),z:_}}function st(t){return 1===t||2===t}function lt(t,e,n){if(function(t,e){return t.datum_type===e.datum_type&&!(t.a!==e.a||Math.abs(t.es-e.es)>5e-11)&&(1===t.datum_type?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]:2!==t.datum_type||t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]&&t.datum_params[3]===e.datum_params[3]&&t.datum_params[4]===e.datum_params[4]&&t.datum_params[5]===e.datum_params[5]&&t.datum_params[6]===e.datum_params[6])}(t,e))return n;if(5===t.datum_type||5===e.datum_type)return n;var i=t.a,a=t.es;if(3===t.datum_type){if(0!==ct(t,!1,n))return;i=r,a=o}var s=e.a,l=e.b,c=e.es;if(3===e.datum_type&&(s=r,l=6356752.314,c=o),a===c&&i===s&&!st(t.datum_type)&&!st(e.datum_type))return n;if((n=it(n,a,i),st(t.datum_type)&&(n=function(t,e,n){if(1===e)return{x:t.x+n[0],y:t.y+n[1],z:t.z+n[2]};if(2===e){var r=n[0],o=n[1],i=n[2],a=n[3],s=n[4],l=n[5],c=n[6];return{x:c*(t.x-l*t.y+s*t.z)+r,y:c*(l*t.x+t.y-a*t.z)+o,z:c*(-s*t.x+a*t.y+t.z)+i}}}(n,t.datum_type,t.datum_params)),st(e.datum_type)&&(n=function(t,e,n){if(1===e)return{x:t.x-n[0],y:t.y-n[1],z:t.z-n[2]};if(2===e){var r=n[0],o=n[1],i=n[2],a=n[3],s=n[4],l=n[5],c=n[6],u=(t.x-r)/c,p=(t.y-o)/c,d=(t.z-i)/c;return{x:u+l*p-s*d,y:-l*u+p+a*d,z:s*u-a*p+d}}}(n,e.datum_type,e.datum_params)),n=at(n,c,s,l),3===e.datum_type)&&0!==ct(e,!0,n))return;return n}function ct(t,e,n){if(null===t.grids||0===t.grids.length)return console.log("Grid shift grids not found"),-1;for(var r={x:-n.x,y:n.y},o={x:Number.NaN,y:Number.NaN},i=[],a=0;a<t.grids.length;a++){var s=t.grids[a];if(i.push(s.name),s.isNull){o=r;break}if(s.mandatory,null!==s.grid){var l=s.grid.subgrids[0],u=(Math.abs(l.del[1])+Math.abs(l.del[0]))/1e4,p=l.ll[0]-u,d=l.ll[1]-u,h=l.ll[0]+(l.lim[0]-1)*l.del[0]+u,f=l.ll[1]+(l.lim[1]-1)*l.del[1]+u;if(!(d>r.y||p>r.x||f<r.y||h<r.x||(o=ut(r,e,l),isNaN(o.x))))break}else if(s.mandatory)return console.log("Unable to find mandatory grid '"+s.name+"'"),-1}return isNaN(o.x)?(console.log("Failed to find a grid shift table for location '"+-r.x*c+" "+r.y*c+" tried: '"+i+"'"),-1):(n.x=-o.x,n.y=o.y,0)}function ut(t,e,n){var r={x:Number.NaN,y:Number.NaN};if(isNaN(t.x))return r;var o={x:t.x,y:t.y};o.x-=n.ll[0],o.y-=n.ll[1],o.x=N(o.x-Math.PI)+Math.PI;var i=pt(o,n);if(e){if(isNaN(i.x))return r;i.x=o.x-i.x,i.y=o.y-i.y;var a,s,l=9;do{if(s=pt(i,n),isNaN(s.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}a={x:o.x-(s.x+i.x),y:o.y-(s.y+i.y)},i.x+=a.x,i.y+=a.y}while(l--&&Math.abs(a.x)>1e-12&&Math.abs(a.y)>1e-12);if(l<0)return console.log("Inverse grid shift iterator failed to converge."),r;r.x=N(i.x+n.ll[0]),r.y=i.y+n.ll[1]}else isNaN(i.x)||(r.x=t.x+i.x,r.y=t.y+i.y);return r}function pt(t,e){var n,r={x:t.x/e.del[0],y:t.y/e.del[1]},o=Math.floor(r.x),i=Math.floor(r.y),a=r.x-1*o,s=r.y-1*i,l={x:Number.NaN,y:Number.NaN};if(o<0||o>=e.lim[0])return l;if(i<0||i>=e.lim[1])return l;n=i*e.lim[0]+o;var c=e.cvs[n][0],u=e.cvs[n][1];n++;var p=e.cvs[n][0],d=e.cvs[n][1];n+=e.lim[0];var h=e.cvs[n][0],f=e.cvs[n][1];n--;var m=e.cvs[n][0],g=e.cvs[n][1],y=a*s,v=a*(1-s),_=(1-a)*(1-s),C=(1-a)*s;return l.x=_*c+v*p+C*m+y*h,l.y=_*u+v*d+C*g+y*f,l}function dt(t,e,n){var r,o,i,a=n.x,s=n.y,l=n.z||0,c={};for(i=0;i<3;i++)if(!e||2!==i||void 0!==n.z)switch(0===i?(r=a,o=-1!=="ew".indexOf(t.axis[i])?"x":"y"):1===i?(r=s,o=-1!=="ns".indexOf(t.axis[i])?"y":"x"):(r=l,o="z"),t.axis[i]){case"e":case"n":c[o]=r;break;case"w":case"s":c[o]=-r;break;case"u":void 0!==n[o]&&(c.z=r);break;case"d":void 0!==n[o]&&(c.z=-r);break;default:return null}return c}function ht(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}function ft(t){if("function"==typeof Number.isFinite){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof t||t!=t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function mt(t,e,n,r){var o;if(Array.isArray(n)&&(n=ht(n)),function(t){ft(t.x),ft(t.y)}(n),t.datum&&e.datum&&function(t,e){return(1===t.datum.datum_type||2===t.datum.datum_type)&&"WGS84"!==e.datumCode||(1===e.datum.datum_type||2===e.datum.datum_type)&&"WGS84"!==t.datumCode}(t,e)&&(n=mt(t,o=new ot("WGS84"),n,r),t=o),r&&"enu"!==t.axis&&(n=dt(t,!1,n)),"longlat"===t.projName)n={x:n.x*l,y:n.y*l,z:n.z||0};else if(t.to_meter&&(n={x:n.x*t.to_meter,y:n.y*t.to_meter,z:n.z||0}),!(n=t.inverse(n)))return;if(t.from_greenwich&&(n.x+=t.from_greenwich),n=lt(t.datum,e.datum,n))return e.from_greenwich&&(n={x:n.x-e.from_greenwich,y:n.y,z:n.z||0}),"longlat"===e.projName?n={x:n.x*c,y:n.y*c,z:n.z||0}:(n=e.forward(n),e.to_meter&&(n={x:n.x/e.to_meter,y:n.y/e.to_meter,z:n.z||0})),r&&"enu"!==e.axis?dt(e,!0,n):n}var gt=ot("WGS84");function yt(t,e,n,r){var o,i,a;return Array.isArray(n)?(o=mt(t,e,n,r)||{x:NaN,y:NaN},n.length>2?void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name?"number"==typeof o.z?[o.x,o.y,o.z].concat(n.splice(3)):[o.x,o.y,n[2]].concat(n.splice(3)):[o.x,o.y].concat(n.splice(2)):[o.x,o.y]):(i=mt(t,e,n,r),2===(a=Object.keys(n)).length||a.forEach((function(r){if(void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name){if("x"===r||"y"===r||"z"===r)return}else if("x"===r||"y"===r)return;i[r]=n[r]})),i)}function vt(t){return t instanceof ot?t:t.oProj?t.oProj:ot(t)}const _t=function(t,e,n){t=vt(t);var r,o=!1;return void 0===e?(e=t,t=gt,o=!0):(void 0!==e.x||Array.isArray(e))&&(n=e,e=t,t=gt,o=!0),e=vt(e),n?yt(t,e,n):(r={forward:function(n,r){return yt(t,e,n,r)},inverse:function(n,r){return yt(e,t,n,r)}},o&&(r.oProj=e),r)};var Ct="AJSAJS",Et="AFAFAF",wt=65,St=73,bt=79,Lt=86,Tt=90;const Pt={forward:At,inverse:function(t){var e=Mt(Dt(t.toUpperCase()));if(e.lat&&e.lon)return[e.lon,e.lat,e.lon,e.lat];return[e.left,e.bottom,e.right,e.top]},toPoint:Ot};function At(t,e){return e=e||5,function(t,e){var n="00000"+t.easting,r="00000"+t.northing;return t.zoneNumber+t.zoneLetter+(h=t.easting,f=t.northing,m=t.zoneNumber,g=Zt(m),y=Math.floor(h/1e5),v=Math.floor(f/1e5)%20,o=y,i=v,a=g,s=a-1,l=Ct.charCodeAt(s),c=Et.charCodeAt(s),u=l+o-1,p=c+i,d=!1,u>Tt&&(u=u-Tt+wt-1,d=!0),(u===St||l<St&&u>St||(u>St||l<St)&&d)&&u++,(u===bt||l<bt&&u>bt||(u>bt||l<bt)&&d)&&++u===St&&u++,u>Tt&&(u=u-Tt+wt-1),p>Lt?(p=p-Lt+wt-1,d=!0):d=!1,(p===St||c<St&&p>St||(p>St||c<St)&&d)&&p++,(p===bt||c<bt&&p>bt||(p>bt||c<bt)&&d)&&++p===St&&p++,p>Lt&&(p=p-Lt+wt-1),String.fromCharCode(u)+String.fromCharCode(p))+n.substr(n.length-5,e)+r.substr(r.length-5,e);var o,i,a,s,l,c,u,p,d;var h,f,m,g,y,v}(function(t){var e,n,r,o,i,a,s,l,c=t.lat,u=t.lon,p=6378137,d=.00669438,h=.9996,f=xt(c),m=xt(u);l=Math.floor((u+180)/6)+1,180===u&&(l=60);c>=56&&c<64&&u>=3&&u<12&&(l=32);c>=72&&c<84&&(u>=0&&u<9?l=31:u>=9&&u<21?l=33:u>=21&&u<33?l=35:u>=33&&u<42&&(l=37));s=xt(6*(l-1)-180+3),e=d/(1-d),n=p/Math.sqrt(1-d*Math.sin(f)*Math.sin(f)),r=Math.tan(f)*Math.tan(f),o=e*Math.cos(f)*Math.cos(f),i=Math.cos(f)*(m-s),a=p*((1-d/4-3*d*d/64-5*d*d*d/256)*f-(3*d/8+3*d*d/32+45*d*d*d/1024)*Math.sin(2*f)+(15*d*d/256+45*d*d*d/1024)*Math.sin(4*f)-35*d*d*d/3072*Math.sin(6*f));var g=h*n*(i+(1-r+o)*i*i*i/6+(5-18*r+r*r+72*o-58*e)*i*i*i*i*i/120)+5e5,y=h*(a+n*Math.tan(f)*(i*i/2+(5-r+9*o+4*o*o)*i*i*i*i/24+(61-58*r+r*r+600*o-330*e)*i*i*i*i*i*i/720));c<0&&(y+=1e7);return{northing:Math.round(y),easting:Math.round(g),zoneNumber:l,zoneLetter:Rt(c)}}({lat:t[1],lon:t[0]}),e)}function Ot(t){var e=Mt(Dt(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function xt(t){return t*(Math.PI/180)}function It(t){return t/Math.PI*180}function Mt(t){var e=t.northing,n=t.easting,r=t.zoneLetter,o=t.zoneNumber;if(o<0||o>60)return null;var i,a,s,l,c,u,p,d,h,f=.9996,m=6378137,g=.00669438,y=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),v=n-5e5,_=e;r<"N"&&(_-=1e7),p=6*(o-1)-180+3,i=.006739496752268451,h=(d=_/f/6367449.145945056)+(3*y/2-27*y*y*y/32)*Math.sin(2*d)+(21*y*y/16-55*y*y*y*y/32)*Math.sin(4*d)+151*y*y*y/96*Math.sin(6*d),a=m/Math.sqrt(1-g*Math.sin(h)*Math.sin(h)),s=Math.tan(h)*Math.tan(h),l=i*Math.cos(h)*Math.cos(h),c=.99330562*m/Math.pow(1-g*Math.sin(h)*Math.sin(h),1.5),u=v/(a*f);var C=h-a*Math.tan(h)/c*(u*u/2-(5+3*s+10*l-4*l*l-9*i)*u*u*u*u/24+(61+90*s+298*l+45*s*s-1.6983531815716497-3*l*l)*u*u*u*u*u*u/720);C=It(C);var E,w=(u-(1+2*s+l)*u*u*u/6+(5-2*l+28*s-3*l*l+8*i+24*s*s)*u*u*u*u*u/120)/Math.cos(h);if(w=p+It(w),t.accuracy){var S=Mt({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});E={top:S.lat,right:S.lon,bottom:C,left:w}}else E={lat:C,lon:w};return E}function Rt(t){var e="Z";return 84>=t&&t>=72?e="X":72>t&&t>=64?e="W":64>t&&t>=56?e="V":56>t&&t>=48?e="U":48>t&&t>=40?e="T":40>t&&t>=32?e="S":32>t&&t>=24?e="R":24>t&&t>=16?e="Q":16>t&&t>=8?e="P":8>t&&t>=0?e="N":0>t&&t>=-8?e="M":-8>t&&t>=-16?e="L":-16>t&&t>=-24?e="K":-24>t&&t>=-32?e="J":-32>t&&t>=-40?e="H":-40>t&&t>=-48?e="G":-48>t&&t>=-56?e="F":-56>t&&t>=-64?e="E":-64>t&&t>=-72?e="D":-72>t&&t>=-80&&(e="C"),e}function Zt(t){var e=t%6;return 0===e&&(e=6),e}function Dt(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,n=t.length,r=null,o="",i=0;!/[A-Z]/.test(e=t.charAt(i));){if(i>=2)throw"MGRSPoint bad conversion from: "+t;o+=e,i++}var a=parseInt(o,10);if(0===i||i+3>n)throw"MGRSPoint bad conversion from: "+t;var s=t.charAt(i++);if(s<="A"||"B"===s||"Y"===s||s>="Z"||"I"===s||"O"===s)throw"MGRSPoint zone letter "+s+" not handled: "+t;r=t.substring(i,i+=2);for(var l=Zt(a),c=function(t,e){var n=Ct.charCodeAt(e-1),r=1e5,o=!1;for(;n!==t.charCodeAt(0);){if(++n===St&&n++,n===bt&&n++,n>Tt){if(o)throw"Bad character: "+t;n=wt,o=!0}r+=1e5}return r}(r.charAt(0),l),u=function(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;var n=Et.charCodeAt(e-1),r=0,o=!1;for(;n!==t.charCodeAt(0);){if(++n===St&&n++,n===bt&&n++,n>Lt){if(o)throw"Bad character: "+t;n=wt,o=!0}r+=1e5}return r}(r.charAt(1),l);u<kt(s);)u+=2e6;var p=n-i;if(p%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var d,h,f,m=p/2,g=0,y=0;return m>0&&(d=1e5/Math.pow(10,m),h=t.substring(i,i+m),g=parseFloat(h)*d,f=t.substring(i+m),y=parseFloat(f)*d),{easting:g+c,northing:y+u,zoneLetter:s,zoneNumber:a,accuracy:d}}function kt(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}function Nt(t,e,n){if(!(this instanceof Nt))return new Nt(t,e,n);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&void 0===e){var r=t.split(",");this.x=parseFloat(r[0],10),this.y=parseFloat(r[1],10),this.z=parseFloat(r[2],10)||0}else this.x=t,this.y=e,this.z=n||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Nt.fromMGRS=function(t){return new Nt(Ot(t))},Nt.prototype.toMGRS=function(t){return At([this.x,this.y],t)};const Ft=Nt;var Ut=.046875,Gt=.01953125,Bt=.01068115234375;function jt(t){var e=[];e[0]=1-t*(.25+t*(Ut+t*(Gt+t*Bt))),e[1]=t*(.75-t*(Ut+t*(Gt+t*Bt)));var n=t*t;return e[2]=n*(.46875-t*(.013020833333333334+.007120768229166667*t)),n*=t,e[3]=n*(.3645833333333333-.005696614583333333*t),e[4]=n*t*.3076171875,e}function Wt(t,e,n,r){return n*=e,e*=e,r[0]*t-n*(r[1]+e*(r[2]+e*(r[3]+e*r[4])))}function qt(t,e,n){for(var r=1/(1-e),o=t,i=20;i;--i){var a=Math.sin(o),l=1-e*a*a;if(o-=l=(Wt(o,a,Math.cos(o),n)-t)*(l*Math.sqrt(l))*r,Math.abs(l)<s)return o}return o}const Ht={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=jt(this.es),this.ml0=Wt(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(t){var e,n,r,o=t.x,i=t.y,a=N(o-this.long0),l=Math.sin(i),c=Math.cos(i);if(this.es){var u=c*a,p=Math.pow(u,2),d=this.ep2*Math.pow(c,2),h=Math.pow(d,2),f=Math.abs(c)>s?Math.tan(i):0,m=Math.pow(f,2),g=Math.pow(m,2);e=1-this.es*Math.pow(l,2),u/=Math.sqrt(e);var y=Wt(i,l,c,this.en);n=this.a*(this.k0*u*(1+p/6*(1-m+d+p/20*(5-18*m+g+14*d-58*m*d+p/42*(61+179*g-g*m-479*m)))))+this.x0,r=this.a*(this.k0*(y-this.ml0+l*a*u/2*(1+p/12*(5-m+9*d+4*h+p/30*(61+g-58*m+270*d-330*m*d+p/56*(1385+543*g-g*m-3111*m))))))+this.y0}else{var v=c*Math.sin(a);if(Math.abs(Math.abs(v)-1)<s)return 93;if(n=.5*this.a*this.k0*Math.log((1+v)/(1-v))+this.x0,r=c*Math.cos(a)/Math.sqrt(1-Math.pow(v,2)),(v=Math.abs(r))>=1){if(v-1>s)return 93;r=0}else r=Math.acos(r);i<0&&(r=-r),r=this.a*this.k0*(r-this.lat0)+this.y0}return t.x=n,t.y=r,t},inverse:function(t){var e,n,r,o,i=(t.x-this.x0)*(1/this.a),l=(t.y-this.y0)*(1/this.a);if(this.es)if(n=qt(e=this.ml0+l/this.k0,this.es,this.en),Math.abs(n)<a){var c=Math.sin(n),u=Math.cos(n),p=Math.abs(u)>s?Math.tan(n):0,d=this.ep2*Math.pow(u,2),h=Math.pow(d,2),f=Math.pow(p,2),m=Math.pow(f,2);e=1-this.es*Math.pow(c,2);var g=i*Math.sqrt(e)/this.k0,y=Math.pow(g,2);r=n-(e*=p)*y/(1-this.es)*.5*(1-y/12*(5+3*f-9*d*f+d-4*h-y/30*(61+90*f-252*d*f+45*m+46*d-y/56*(1385+3633*f+4095*m+1574*m*f)))),o=N(this.long0+g*(1-y/6*(1+2*f+d-y/20*(5+28*f+24*m+8*d*f+6*d-y/42*(61+662*f+1320*m+720*m*f))))/u)}else r=a*k(l),o=0;else{var v=Math.exp(i/this.k0),_=.5*(v-1/v),C=this.lat0+l/this.k0,E=Math.cos(C);e=Math.sqrt((1-Math.pow(E,2))/(1+Math.pow(_,2))),r=Math.asin(e),l<0&&(r=-r),o=0===_&&0===E?0:N(Math.atan2(_,E)+this.long0)}return t.x=o,t.y=r,t},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]};function Vt(t){var e=Math.exp(t);return e=(e-1/e)/2}function zt(t,e){t=Math.abs(t),e=Math.abs(e);var n=Math.max(t,e),r=Math.min(t,e)/(n||1);return n*Math.sqrt(1+Math.pow(r,2))}function Yt(t){var e=Math.abs(t);return e=function(t){var e=1+t,n=e-1;return 0===n?t:t*Math.log(e)/n}(e*(1+e/(zt(1,e)+1))),t<0?-e:e}function Kt(t,e){for(var n,r=2*Math.cos(2*e),o=t.length-1,i=t[o],a=0;--o>=0;)n=r*i-a+t[o],a=i,i=n;return e+n*Math.sin(2*e)}function Xt(t,e,n){for(var r,o,i=Math.sin(e),a=Math.cos(e),s=Vt(n),l=function(t){var e=Math.exp(t);return(e+1/e)/2}(n),c=2*a*l,u=-2*i*s,p=t.length-1,d=t[p],h=0,f=0,m=0;--p>=0;)r=f,o=h,d=c*(f=d)-r-u*(h=m)+t[p],m=u*f-o+c*h;return[(c=i*l)*d-(u=a*s)*m,c*m+u*d]}const $t={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Ht.init.apply(this),this.forward=Ht.forward,this.inverse=Ht.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),e=t/(2-t),n=e;this.cgb[0]=e*(2+e*(-2/3+e*(e*(116/45+e*(26/45+e*(-2854/675)))-2))),this.cbg[0]=e*(e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))-2),n*=e,this.cgb[1]=n*(7/3+e*(e*(-227/45+e*(2704/315+e*(2323/945)))-1.6)),this.cbg[1]=n*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),n*=e,this.cgb[2]=n*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=n*(-26/15+e*(34/21+e*(1.6+e*(-12686/2835)))),n*=e,this.cgb[3]=n*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=n*(1237/630+e*(e*(-24832/14175)-2.4)),n*=e,this.cgb[4]=n*(4174/315+e*(-144838/6237)),this.cbg[4]=n*(-734/315+e*(109598/31185)),n*=e,this.cgb[5]=n*(601676/22275),this.cbg[5]=n*(444337/155925),n=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+n*(1/4+n*(1/64+n/256))),this.utg[0]=e*(e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))-.5),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=n*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=n*(13/48+e*(e*(557/1440+e*(281/630+e*(-1983433/1935360)))-.6)),n*=e,this.utg[2]=n*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=n*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),n*=e,this.utg[3]=n*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=n*(49561/161280+e*(-179/168+e*(6601661/7257600))),n*=e,this.utg[4]=n*(-4583/161280+e*(108847/3991680)),this.gtu[4]=n*(34729/80640+e*(-3418889/1995840)),n*=e,this.utg[5]=n*(-20648693/638668800),this.gtu[5]=.6650675310896665*n;var r=Kt(this.cbg,this.lat0);this.Zb=-this.Qn*(r+function(t,e){for(var n,r=2*Math.cos(e),o=t.length-1,i=t[o],a=0;--o>=0;)n=r*i-a+t[o],a=i,i=n;return Math.sin(e)*n}(this.gtu,2*r))},forward:function(t){var e=N(t.x-this.long0),n=t.y;n=Kt(this.cbg,n);var r=Math.sin(n),o=Math.cos(n),i=Math.sin(e),a=Math.cos(e);n=Math.atan2(r,a*o),e=Math.atan2(i*o,zt(r,o*a)),e=Yt(Math.tan(e));var s,l,c=Xt(this.gtu,2*n,2*e);return n+=c[0],e+=c[1],Math.abs(e)<=2.623395162778?(s=this.a*(this.Qn*e)+this.x0,l=this.a*(this.Qn*n+this.Zb)+this.y0):(s=1/0,l=1/0),t.x=s,t.y=l,t},inverse:function(t){var e,n,r=(t.x-this.x0)*(1/this.a),o=(t.y-this.y0)*(1/this.a);if(o=(o-this.Zb)/this.Qn,r/=this.Qn,Math.abs(r)<=2.623395162778){var i=Xt(this.utg,2*o,2*r);o+=i[0],r+=i[1],r=Math.atan(Vt(r));var a=Math.sin(o),s=Math.cos(o),l=Math.sin(r),c=Math.cos(r);o=Math.atan2(a*c,zt(l,c*s)),e=N((r=Math.atan2(l,c*s))+this.long0),n=Kt(this.cgb,o)}else e=1/0,n=1/0;return t.x=e,t.y=n,t},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"]};const Jt={init:function(){var t=function(t,e){if(void 0===t){if((t=Math.floor(30*(N(e)+Math.PI)/Math.PI)+1)<0)return 0;if(t>60)return 60}return t}(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*l,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,$t.init.apply(this),this.forward=$t.forward,this.inverse=$t.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};function Qt(t,e){return Math.pow((1-t)/(1+t),e)}const te={init:function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+u)/(Math.pow(Math.tan(.5*this.lat0+u),this.C)*Qt(this.e*t,this.ratexp))},forward:function(t){var e=t.x,n=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*n+u),this.C)*Qt(this.e*Math.sin(n),this.ratexp))-a,t.x=this.C*e,t},inverse:function(t){for(var e=t.x/this.C,n=t.y,r=Math.pow(Math.tan(.5*n+u)/this.K,1/this.C),o=20;o>0&&(n=2*Math.atan(r*Qt(this.e*Math.sin(t.y),-.5*this.e))-a,!(Math.abs(n-t.y)<1e-14));--o)t.y=n;return o?(t.x=e,t.y=n,t):null},names:["gauss"]};const ee={init:function(){te.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(t){var e,n,r,o;return t.x=N(t.x-this.long0),te.forward.apply(this,[t]),e=Math.sin(t.y),n=Math.cos(t.y),r=Math.cos(t.x),o=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*n*r),t.x=o*n*Math.sin(t.x),t.y=o*(this.cosc0*e-this.sinc0*n*r),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){var e,n,r,o,i;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,i=Math.sqrt(t.x*t.x+t.y*t.y)){var a=2*Math.atan2(i,this.R2);e=Math.sin(a),n=Math.cos(a),o=Math.asin(n*this.sinc0+t.y*e*this.cosc0/i),r=Math.atan2(t.x*e,i*this.cosc0*n-t.y*this.sinc0*e)}else o=this.phic0,r=0;return t.x=r,t.y=o,te.inverse.apply(this,[t]),t.x=N(t.x+this.long0),t},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]};const ne={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=s&&(this.k0=.5*(1+k(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=s&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=s&&(this.k0=.5*this.cons*D(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/F(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=D(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-a,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(t){var e,n,r,o,i,l,c=t.x,u=t.y,p=Math.sin(u),d=Math.cos(u),h=N(c-this.long0);return Math.abs(Math.abs(c-this.long0)-Math.PI)<=s&&Math.abs(u+this.lat0)<=s?(t.x=NaN,t.y=NaN,t):this.sphere?(e=2*this.k0/(1+this.sinlat0*p+this.coslat0*d*Math.cos(h)),t.x=this.a*e*d*Math.sin(h)+this.x0,t.y=this.a*e*(this.coslat0*p-this.sinlat0*d*Math.cos(h))+this.y0,t):(n=2*Math.atan(this.ssfn_(u,p,this.e))-a,o=Math.cos(n),r=Math.sin(n),Math.abs(this.coslat0)<=s?(i=F(this.e,u*this.con,this.con*p),l=2*this.a*this.k0*i/this.cons,t.x=this.x0+l*Math.sin(c-this.long0),t.y=this.y0-this.con*l*Math.cos(c-this.long0),t):(Math.abs(this.sinlat0)<s?(e=2*this.a*this.k0/(1+o*Math.cos(h)),t.y=e*r):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*r+this.cosX0*o*Math.cos(h))),t.y=e*(this.cosX0*r-this.sinX0*o*Math.cos(h))+this.y0),t.x=e*o*Math.sin(h)+this.x0,t))},inverse:function(t){var e,n,r,o,i;t.x-=this.x0,t.y-=this.y0;var l=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var c=2*Math.atan(l/(2*this.a*this.k0));return e=this.long0,n=this.lat0,l<=s?(t.x=e,t.y=n,t):(n=Math.asin(Math.cos(c)*this.sinlat0+t.y*Math.sin(c)*this.coslat0/l),e=Math.abs(this.coslat0)<s?this.lat0>0?N(this.long0+Math.atan2(t.x,-1*t.y)):N(this.long0+Math.atan2(t.x,t.y)):N(this.long0+Math.atan2(t.x*Math.sin(c),l*this.coslat0*Math.cos(c)-t.y*this.sinlat0*Math.sin(c))),t.x=e,t.y=n,t)}if(Math.abs(this.coslat0)<=s){if(l<=s)return n=this.lat0,e=this.long0,t.x=e,t.y=n,t;t.x*=this.con,t.y*=this.con,r=l*this.cons/(2*this.a*this.k0),n=this.con*U(this.e,r),e=this.con*N(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else o=2*Math.atan(l*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,l<=s?i=this.X0:(i=Math.asin(Math.cos(o)*this.sinX0+t.y*Math.sin(o)*this.cosX0/l),e=N(this.long0+Math.atan2(t.x*Math.sin(o),l*this.cosX0*Math.cos(o)-t.y*this.sinX0*Math.sin(o)))),n=-1*U(this.e,Math.tan(.5*(a+i)));return t.x=e,t.y=n,t},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(t,e,n){return e*=n,Math.tan(.5*(a+t))*Math.pow((1-e)/(1+e),.5*n)}};const re={init:function(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),n=this.a,r=1/this.rf,o=2*r-Math.pow(r,2),i=this.e=Math.sqrt(o);this.R=this.k0*n*Math.sqrt(1-o)/(1-o*Math.pow(e,2)),this.alpha=Math.sqrt(1+o/(1-o)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),s=Math.log(Math.tan(Math.PI/4+t/2)),l=Math.log((1+i*e)/(1-i*e));this.K=a-this.alpha*s+this.alpha*i/2*l},forward:function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),n=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),r=-this.alpha*(e+n)+this.K,o=2*(Math.atan(Math.exp(r))-Math.PI/4),i=this.alpha*(t.x-this.lambda0),a=Math.atan(Math.sin(i)/(Math.sin(this.b0)*Math.tan(o)+Math.cos(this.b0)*Math.cos(i))),s=Math.asin(Math.cos(this.b0)*Math.sin(o)-Math.sin(this.b0)*Math.cos(o)*Math.cos(i));return t.y=this.R/2*Math.log((1+Math.sin(s))/(1-Math.sin(s)))+this.y0,t.x=this.R*a+this.x0,t},inverse:function(t){for(var e=t.x-this.x0,n=t.y-this.y0,r=e/this.R,o=2*(Math.atan(Math.exp(n/this.R))-Math.PI/4),i=Math.asin(Math.cos(this.b0)*Math.sin(o)+Math.sin(this.b0)*Math.cos(o)*Math.cos(r)),a=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(o))),s=this.lambda0+a/this.alpha,l=0,c=i,u=-1e3,p=0;Math.abs(c-u)>1e-7;){if(++p>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+i/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2)),u=c,c=2*Math.atan(Math.exp(l))-Math.PI/2}return t.x=s,t.y=c,t},names:["somerc"]};var oe=1e-7;const ie={init:function(){var t,e,n,r,o,i,c,d,h,f,m,g,y,v=0,_=0,C=0,E=0,w=0,S=0,b=0;this.no_off=(y="object"==typeof(g=this).PROJECTION?Object.keys(g.PROJECTION)[0]:g.PROJECTION,"no_uoff"in g||"no_off"in g||-1!==["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"].indexOf(y)),this.no_rot="no_rot"in this;var L=!1;"alpha"in this&&(L=!0);var T=!1;if("rectified_grid_angle"in this&&(T=!0),L&&(b=this.alpha),T&&(v=this.rectified_grid_angle*l),L||T)_=this.longc;else if(C=this.long1,w=this.lat1,E=this.long2,S=this.lat2,Math.abs(w-S)<=oe||(t=Math.abs(w))<=oe||Math.abs(t-a)<=oe||Math.abs(Math.abs(this.lat0)-a)<=oe||Math.abs(Math.abs(S)-a)<=oe)throw new Error;var P=1-this.es;e=Math.sqrt(P),Math.abs(this.lat0)>s?(d=Math.sin(this.lat0),n=Math.cos(this.lat0),t=1-this.es*d*d,this.B=n*n,this.B=Math.sqrt(1+this.es*this.B*this.B/P),this.A=this.B*this.k0*e/t,(o=(r=this.B*e/(n*Math.sqrt(t)))*r-1)<=0?o=0:(o=Math.sqrt(o),this.lat0<0&&(o=-o)),this.E=o+=r,this.E*=Math.pow(F(this.e,this.lat0,d),this.B)):(this.B=1/e,this.A=this.k0,this.E=r=o=1),L||T?(L?(m=Math.asin(Math.sin(b)/r),T||(v=b)):(m=v,b=Math.asin(r*Math.sin(m))),this.lam0=_-Math.asin(.5*(o-1/o)*Math.tan(m))/this.B):(i=Math.pow(F(this.e,w,Math.sin(w)),this.B),c=Math.pow(F(this.e,S,Math.sin(S)),this.B),o=this.E/i,h=(c-i)/(c+i),f=((f=this.E*this.E)-c*i)/(f+c*i),(t=C-E)<-Math.pi?E-=p:t>Math.pi&&(E+=p),this.lam0=N(.5*(C+E)-Math.atan(f*Math.tan(.5*this.B*(C-E))/h)/this.B),m=Math.atan(2*Math.sin(this.B*N(C-this.lam0))/(o-1/o)),v=b=Math.asin(r*Math.sin(m))),this.singam=Math.sin(m),this.cosgam=Math.cos(m),this.sinrot=Math.sin(v),this.cosrot=Math.cos(v),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A,this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(r*r-1)/Math.cos(b))),this.lat0<0&&(this.u_0=-this.u_0)),o=.5*m,this.v_pole_n=this.ArB*Math.log(Math.tan(u-o)),this.v_pole_s=this.ArB*Math.log(Math.tan(u+o))},forward:function(t){var e,n,r,o,i,l,c,u,p={};if(t.x=t.x-this.lam0,Math.abs(Math.abs(t.y)-a)>s){if(e=.5*((i=this.E/Math.pow(F(this.e,t.y,Math.sin(t.y)),this.B))-(l=1/i)),n=.5*(i+l),o=Math.sin(this.B*t.x),r=(e*this.singam-o*this.cosgam)/n,Math.abs(Math.abs(r)-1)<s)throw new Error;u=.5*this.ArB*Math.log((1-r)/(1+r)),l=Math.cos(this.B*t.x),c=Math.abs(l)<oe?this.A*t.x:this.ArB*Math.atan2(e*this.cosgam+o*this.singam,l)}else u=t.y>0?this.v_pole_n:this.v_pole_s,c=this.ArB*t.y;return this.no_rot?(p.x=c,p.y=u):(c-=this.u_0,p.x=u*this.cosrot+c*this.sinrot,p.y=c*this.cosrot-u*this.sinrot),p.x=this.a*p.x+this.x0,p.y=this.a*p.y+this.y0,p},inverse:function(t){var e,n,r,o,i,l,c,u={};if(t.x=(t.x-this.x0)*(1/this.a),t.y=(t.y-this.y0)*(1/this.a),this.no_rot?(n=t.y,e=t.x):(n=t.x*this.cosrot-t.y*this.sinrot,e=t.y*this.cosrot+t.x*this.sinrot+this.u_0),o=.5*((r=Math.exp(-this.BrA*n))-1/r),i=.5*(r+1/r),c=((l=Math.sin(this.BrA*e))*this.cosgam+o*this.singam)/i,Math.abs(Math.abs(c)-1)<s)u.x=0,u.y=c<0?-a:a;else{if(u.y=this.E/Math.sqrt((1+c)/(1-c)),u.y=U(this.e,Math.pow(u.y,1/this.B)),u.y===1/0)throw new Error;u.x=-this.rB*Math.atan2(o*this.cosgam-l*this.singam,Math.cos(this.BrA*e))}return u.x+=this.lam0,u},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]};const ae={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<s)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),n=Math.cos(this.lat1),r=D(this.e,e,n),o=F(this.e,this.lat1,e),i=Math.sin(this.lat2),a=Math.cos(this.lat2),l=D(this.e,i,a),c=F(this.e,this.lat2,i),u=F(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>s?this.ns=Math.log(r/l)/Math.log(o/c):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=r/(this.ns*Math.pow(o,this.ns)),this.rh=this.a*this.f0*Math.pow(u,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(t){var e=t.x,n=t.y;Math.abs(2*Math.abs(n)-Math.PI)<=s&&(n=k(n)*(a-2e-10));var r,o,i=Math.abs(Math.abs(n)-a);if(i>s)r=F(this.e,n,Math.sin(n)),o=this.a*this.f0*Math.pow(r,this.ns);else{if((i=n*this.ns)<=0)return null;o=0}var l=this.ns*N(e-this.long0);return t.x=this.k0*(o*Math.sin(l))+this.x0,t.y=this.k0*(this.rh-o*Math.cos(l))+this.y0,t},inverse:function(t){var e,n,r,o,i,s=(t.x-this.x0)/this.k0,l=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(s*s+l*l),n=1):(e=-Math.sqrt(s*s+l*l),n=-1);var c=0;if(0!==e&&(c=Math.atan2(n*s,n*l)),0!==e||this.ns>0){if(n=1/this.ns,r=Math.pow(e/(this.a*this.f0),n),-9999===(o=U(this.e,r)))return null}else o=-a;return i=N(c/this.ns+this.long0),t.x=i,t.y=o,t},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc"]};const se={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(t){var e,n,r,o,i,a,s,l=t.x,c=t.y,u=N(l-this.long0);return e=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),n=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/e)-this.s45),r=-u*this.alfa,o=Math.asin(Math.cos(this.ad)*Math.sin(n)+Math.sin(this.ad)*Math.cos(n)*Math.cos(r)),i=Math.asin(Math.cos(n)*Math.sin(r)/Math.cos(o)),a=this.n*i,s=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(o/2+this.s45),this.n),t.y=s*Math.cos(a)/1,t.x=s*Math.sin(a)/1,this.czech||(t.y*=-1,t.x*=-1),t},inverse:function(t){var e,n,r,o,i,a,s,l=t.x;t.x=t.y,t.y=l,this.czech||(t.y*=-1,t.x*=-1),i=Math.sqrt(t.x*t.x+t.y*t.y),o=Math.atan2(t.y,t.x)/Math.sin(this.s0),r=2*(Math.atan(Math.pow(this.ro0/i,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(o)),n=Math.asin(Math.cos(r)*Math.sin(o)/Math.cos(e)),t.x=this.long0-n/this.alfa,a=e,s=0;var c=0;do{t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-t.y)<1e-10&&(s=1),a=t.y,c+=1}while(0===s&&c<15);return c>=15?null:t},names:["Krovak","krovak"]};function le(t,e,n,r,o){return t*o-e*Math.sin(2*o)+n*Math.sin(4*o)-r*Math.sin(6*o)}function ce(t){return 1-.25*t*(1+t/16*(3+1.25*t))}function ue(t){return.375*t*(1+.25*t*(1+.46875*t))}function pe(t){return.05859375*t*t*(1+.75*t)}function de(t){return t*t*t*(35/3072)}function he(t,e,n){var r=e*n;return t/Math.sqrt(1-r*r)}function fe(t){return Math.abs(t)<a?t:t-k(t)*Math.PI}function me(t,e,n,r,o){var i,a;i=t/e;for(var s=0;s<15;s++)if(i+=a=(t-(e*i-n*Math.sin(2*i)+r*Math.sin(4*i)-o*Math.sin(6*i)))/(e-2*n*Math.cos(2*i)+4*r*Math.cos(4*i)-6*o*Math.cos(6*i)),Math.abs(a)<=1e-10)return i;return NaN}const ge={init:function(){this.sphere||(this.e0=ce(this.es),this.e1=ue(this.es),this.e2=pe(this.es),this.e3=de(this.es),this.ml0=this.a*le(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(t){var e,n,r=t.x,o=t.y;if(r=N(r-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(o)*Math.sin(r)),n=this.a*(Math.atan2(Math.tan(o),Math.cos(r))-this.lat0);else{var i=Math.sin(o),a=Math.cos(o),s=he(this.a,this.e,i),l=Math.tan(o)*Math.tan(o),c=r*Math.cos(o),u=c*c,p=this.es*a*a/(1-this.es);e=s*c*(1-u*l*(1/6-(8-l+8*p)*u/120)),n=this.a*le(this.e0,this.e1,this.e2,this.e3,o)-this.ml0+s*i/a*u*(.5+(5-l+6*p)*u/24)}return t.x=e+this.x0,t.y=n+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,n,r=t.x/this.a,o=t.y/this.a;if(this.sphere){var i=o+this.lat0;e=Math.asin(Math.sin(i)*Math.cos(r)),n=Math.atan2(Math.tan(r),Math.cos(i))}else{var l=me(this.ml0/this.a+o,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(l)-a)<=s)return t.x=this.long0,t.y=a,o<0&&(t.y*=-1),t;var c=he(this.a,this.e,Math.sin(l)),u=c*c*c/this.a/this.a*(1-this.es),p=Math.pow(Math.tan(l),2),d=r*this.a/c,h=d*d;e=l-c*Math.tan(l)/u*d*d*(.5-(1+3*p)*d*d/24),n=d*(1-h*(p/3+(1+3*p)*p*h/15))/Math.cos(l)}return t.x=N(n+this.long0),t.y=fe(e),t},names:["Cassini","Cassini_Soldner","cass"]};function ye(t,e){var n;return t>1e-7?(1-t*t)*(e/(1-(n=t*e)*n)-.5/t*Math.log((1-n)/(1+n))):2*e}var ve=.3333333333333333,_e=.17222222222222222,Ce=.10257936507936508,Ee=.06388888888888888,we=.0664021164021164,Se=.016415012942191543;const be={init:function(){var t,e=Math.abs(this.lat0);if(Math.abs(e-a)<s?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<s?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=ye(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(t){var e,n=[];return n[0]=t*ve,e=t*t,n[0]+=e*_e,n[1]=e*Ee,e*=t,n[0]+=e*Ce,n[1]+=e*we,n[2]=e*Se,n}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=ye(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(t){var e,n,r,o,i,l,c,p,d,h,f=t.x,m=t.y;if(f=N(f-this.long0),this.sphere){if(i=Math.sin(m),h=Math.cos(m),r=Math.cos(f),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((n=this.mode===this.EQUIT?1+h*r:1+this.sinph0*i+this.cosph0*h*r)<=s)return null;e=(n=Math.sqrt(2/n))*h*Math.sin(f),n*=this.mode===this.EQUIT?i:this.cosph0*i-this.sinph0*h*r}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(r=-r),Math.abs(m+this.lat0)<s)return null;n=u-.5*m,e=(n=2*(this.mode===this.S_POLE?Math.cos(n):Math.sin(n)))*Math.sin(f),n*=r}}else{switch(c=0,p=0,d=0,r=Math.cos(f),o=Math.sin(f),i=Math.sin(m),l=ye(this.e,i),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(c=l/this.qp,p=Math.sqrt(1-c*c)),this.mode){case this.OBLIQ:d=1+this.sinb1*c+this.cosb1*p*r;break;case this.EQUIT:d=1+p*r;break;case this.N_POLE:d=a+m,l=this.qp-l;break;case this.S_POLE:d=m-a,l=this.qp+l}if(Math.abs(d)<s)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:d=Math.sqrt(2/d),n=this.mode===this.OBLIQ?this.ymf*d*(this.cosb1*c-this.sinb1*p*r):(d=Math.sqrt(2/(1+p*r)))*c*this.ymf,e=this.xmf*d*p*o;break;case this.N_POLE:case this.S_POLE:l>=0?(e=(d=Math.sqrt(l))*o,n=r*(this.mode===this.S_POLE?d:-d)):e=n=0}}return t.x=this.a*e+this.x0,t.y=this.a*n+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,n,r,o,i,l,c,u,p,d,h=t.x/this.a,f=t.y/this.a;if(this.sphere){var m,g=0,y=0;if((n=.5*(m=Math.sqrt(h*h+f*f)))>1)return null;switch(n=2*Math.asin(n),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(y=Math.sin(n),g=Math.cos(n)),this.mode){case this.EQUIT:n=Math.abs(m)<=s?0:Math.asin(f*y/m),h*=y,f=g*m;break;case this.OBLIQ:n=Math.abs(m)<=s?this.lat0:Math.asin(g*this.sinph0+f*y*this.cosph0/m),h*=y*this.cosph0,f=(g-Math.sin(n)*this.sinph0)*m;break;case this.N_POLE:f=-f,n=a-n;break;case this.S_POLE:n-=a}e=0!==f||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(h,f):0}else{if(c=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(h/=this.dd,f*=this.dd,(l=Math.sqrt(h*h+f*f))<s)return t.x=this.long0,t.y=this.lat0,t;o=2*Math.asin(.5*l/this.rq),r=Math.cos(o),h*=o=Math.sin(o),this.mode===this.OBLIQ?(c=r*this.sinb1+f*o*this.cosb1/l,i=this.qp*c,f=l*this.cosb1*r-f*this.sinb1*o):(c=f*o/l,i=this.qp*c,f=l*r)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(f=-f),!(i=h*h+f*f))return t.x=this.long0,t.y=this.lat0,t;c=1-i/this.qp,this.mode===this.S_POLE&&(c=-c)}e=Math.atan2(h,f),u=Math.asin(c),p=this.apa,d=u+u,n=u+p[0]*Math.sin(d)+p[1]*Math.sin(d+d)+p[2]*Math.sin(d+d+d)}return t.x=N(this.long0+e),t.y=n,t},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};function Le(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}const Te={init:function(){Math.abs(this.lat1+this.lat2)<s||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=D(this.e3,this.sin_po,this.cos_po),this.qs1=ye(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=D(this.e3,this.sin_po,this.cos_po),this.qs2=ye(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=ye(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>s?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(t){var e=t.x,n=t.y;this.sin_phi=Math.sin(n),this.cos_phi=Math.cos(n);var r=ye(this.e3,this.sin_phi,this.cos_phi),o=this.a*Math.sqrt(this.c-this.ns0*r)/this.ns0,i=this.ns0*N(e-this.long0),a=o*Math.sin(i)+this.x0,s=this.rh-o*Math.cos(i)+this.y0;return t.x=a,t.y=s,t},inverse:function(t){var e,n,r,o,i,a;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),r=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),r=-1),o=0,0!==e&&(o=Math.atan2(r*t.x,r*t.y)),r=e*this.ns0/this.a,this.sphere?a=Math.asin((this.c-r*r)/(2*this.ns0)):(n=(this.c-r*r)/this.ns0,a=this.phi1z(this.e3,n)),i=N(o/this.ns0+this.long0),t.x=i,t.y=a,t},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(t,e){var n,r,o,i,a=Le(.5*e);if(t<s)return a;for(var l=t*t,c=1;c<=25;c++)if(a+=i=.5*(o=1-(r=t*(n=Math.sin(a)))*r)*o/Math.cos(a)*(e/(1-l)-n/o+.5/t*Math.log((1-r)/(1+r))),Math.abs(i)<=1e-7)return a;return null}};const Pe={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(t){var e,n,r,o,i,a,l,c=t.x,u=t.y;return r=N(c-this.long0),e=Math.sin(u),n=Math.cos(u),o=Math.cos(r),1,(i=this.sin_p14*e+this.cos_p14*n*o)>0||Math.abs(i)<=s?(a=this.x0+1*this.a*n*Math.sin(r)/i,l=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*n*o)/i):(a=this.x0+this.infinity_dist*n*Math.sin(r),l=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*n*o)),t.x=a,t.y=l,t},inverse:function(t){var e,n,r,o,i,a;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(o=Math.atan2(e,this.rc),n=Math.sin(o),a=Le((r=Math.cos(o))*this.sin_p14+t.y*n*this.cos_p14/e),i=Math.atan2(t.x*n,e*this.cos_p14*r-t.y*this.sin_p14*n),i=N(this.long0+i)):(a=this.phic0,i=0),t.x=i,t.y=a,t},names:["gnom"]};const Ae={init:function(){this.sphere||(this.k0=D(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(t){var e,n,r=t.x,o=t.y,i=N(r-this.long0);if(this.sphere)e=this.x0+this.a*i*Math.cos(this.lat_ts),n=this.y0+this.a*Math.sin(o)/Math.cos(this.lat_ts);else{var a=ye(this.e,Math.sin(o));e=this.x0+this.a*this.k0*i,n=this.y0+this.a*a*.5/this.k0}return t.x=e,t.y=n,t},inverse:function(t){var e,n;return t.x-=this.x0,t.y-=this.y0,this.sphere?(e=N(this.long0+t.x/this.a/Math.cos(this.lat_ts)),n=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(n=function(t,e){var n=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-n)<1e-6)return e<0?-1*a:a;for(var r,o,i,s,l=Math.asin(.5*e),c=0;c<30;c++)if(o=Math.sin(l),i=Math.cos(l),s=t*o,l+=r=Math.pow(1-s*s,2)/(2*i)*(e/(1-t*t)-o/(1-s*s)+.5/t*Math.log((1-s)/(1+s))),Math.abs(r)<=1e-10)return l;return NaN}(this.e,2*t.y*this.k0/this.a),e=N(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=n,t},names:["cea"]};const Oe={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(t){var e=t.x,n=t.y,r=N(e-this.long0),o=fe(n-this.lat0);return t.x=this.x0+this.a*r*this.rc,t.y=this.y0+this.a*o,t},inverse:function(t){var e=t.x,n=t.y;return t.x=N(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=fe(this.lat0+(n-this.y0)/this.a),t},names:["Equirectangular","Equidistant_Cylindrical","eqc"]};const xe={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=ce(this.es),this.e1=ue(this.es),this.e2=pe(this.es),this.e3=de(this.es),this.ml0=this.a*le(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(t){var e,n,r,o=t.x,i=t.y,a=N(o-this.long0);if(r=a*Math.sin(i),this.sphere)Math.abs(i)<=s?(e=this.a*a,n=-1*this.a*this.lat0):(e=this.a*Math.sin(r)/Math.tan(i),n=this.a*(fe(i-this.lat0)+(1-Math.cos(r))/Math.tan(i)));else if(Math.abs(i)<=s)e=this.a*a,n=-1*this.ml0;else{var l=he(this.a,this.e,Math.sin(i))/Math.tan(i);e=l*Math.sin(r),n=this.a*le(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+l*(1-Math.cos(r))}return t.x=e+this.x0,t.y=n+this.y0,t},inverse:function(t){var e,n,r,o,i,a,l,c,u;if(r=t.x-this.x0,o=t.y-this.y0,this.sphere)if(Math.abs(o+this.a*this.lat0)<=s)e=N(r/this.a+this.long0),n=0;else{var p;for(a=this.lat0+o/this.a,l=r*r/this.a/this.a+a*a,c=a,i=20;i;--i)if(c+=u=-1*(a*(c*(p=Math.tan(c))+1)-c-.5*(c*c+l)*p)/((c-a)/p-1),Math.abs(u)<=s){n=c;break}e=N(this.long0+Math.asin(r*Math.tan(c)/this.a)/Math.sin(n))}else if(Math.abs(o+this.ml0)<=s)n=0,e=N(this.long0+r/this.a);else{var d,h,f,m,g;for(a=(this.ml0+o)/this.a,l=r*r/this.a/this.a+a*a,c=a,i=20;i;--i)if(g=this.e*Math.sin(c),d=Math.sqrt(1-g*g)*Math.tan(c),h=this.a*le(this.e0,this.e1,this.e2,this.e3,c),f=this.e0-2*this.e1*Math.cos(2*c)+4*this.e2*Math.cos(4*c)-6*this.e3*Math.cos(6*c),c-=u=(a*(d*(m=h/this.a)+1)-m-.5*d*(m*m+l))/(this.es*Math.sin(2*c)*(m*m+l-2*a*m)/(4*d)+(a-m)*(d*f-2/Math.sin(2*c))-f),Math.abs(u)<=s){n=c;break}d=Math.sqrt(1-this.es*Math.pow(Math.sin(n),2))*Math.tan(n),e=N(this.long0+Math.asin(r*d/this.a)/Math.sin(n))}return t.x=e,t.y=n,t},names:["Polyconic","poly"]};const Ie={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(t){var e,n=t.x,r=t.y-this.lat0,o=n-this.long0,a=r/i*1e-5,s=o,l=1,c=0;for(e=1;e<=10;e++)l*=a,c+=this.A[e]*l;var u,p=c,d=s,h=1,f=0,m=0,g=0;for(e=1;e<=6;e++)u=f*p+h*d,h=h*p-f*d,f=u,m=m+this.B_re[e]*h-this.B_im[e]*f,g=g+this.B_im[e]*h+this.B_re[e]*f;return t.x=g*this.a+this.x0,t.y=m*this.a+this.y0,t},inverse:function(t){var e,n,r=t.x,o=t.y,a=r-this.x0,s=(o-this.y0)/this.a,l=a/this.a,c=1,u=0,p=0,d=0;for(e=1;e<=6;e++)n=u*s+c*l,c=c*s-u*l,u=n,p=p+this.C_re[e]*c-this.C_im[e]*u,d=d+this.C_im[e]*c+this.C_re[e]*u;for(var h=0;h<this.iterations;h++){var f,m=p,g=d,y=s,v=l;for(e=2;e<=6;e++)f=g*p+m*d,m=m*p-g*d,g=f,y+=(e-1)*(this.B_re[e]*m-this.B_im[e]*g),v+=(e-1)*(this.B_im[e]*m+this.B_re[e]*g);m=1,g=0;var _=this.B_re[1],C=this.B_im[1];for(e=2;e<=6;e++)f=g*p+m*d,m=m*p-g*d,g=f,_+=e*(this.B_re[e]*m-this.B_im[e]*g),C+=e*(this.B_im[e]*m+this.B_re[e]*g);var E=_*_+C*C;p=(y*_+v*C)/E,d=(v*_-y*C)/E}var w=p,S=d,b=1,L=0;for(e=1;e<=9;e++)b*=w,L+=this.D[e]*b;var T=this.lat0+L*i*1e5,P=this.long0+S;return t.x=P,t.y=T,t},names:["New_Zealand_Map_Grid","nzmg"]};const Me={init:function(){},forward:function(t){var e=t.x,n=t.y,r=N(e-this.long0),o=this.x0+this.a*r,i=this.y0+this.a*Math.log(Math.tan(Math.PI/4+n/2.5))*1.25;return t.x=o,t.y=i,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e=N(this.long0+t.x/this.a),n=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=n,t},names:["Miller_Cylindrical","mill"]};const Re={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=jt(this.es)},forward:function(t){var e,n,r=t.x,o=t.y;if(r=N(r-this.long0),this.sphere){if(this.m)for(var i=this.n*Math.sin(o),a=20;a;--a){var l=(this.m*o+Math.sin(o)-i)/(this.m+Math.cos(o));if(o-=l,Math.abs(l)<s)break}else o=1!==this.n?Math.asin(this.n*Math.sin(o)):o;e=this.a*this.C_x*r*(this.m+Math.cos(o)),n=this.a*this.C_y*o}else{var c=Math.sin(o),u=Math.cos(o);n=this.a*Wt(o,c,u,this.en),e=this.a*r*u/Math.sqrt(1-this.es*c*c)}return t.x=e,t.y=n,t},inverse:function(t){var e,n,r;return t.x-=this.x0,n=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,n/=this.C_x*(this.m+Math.cos(e)),this.m?e=Le((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=Le(Math.sin(e)/this.n)),n=N(n+this.long0),e=fe(e)):(e=qt(t.y/this.a,this.es,this.en),(r=Math.abs(e))<a?(r=Math.sin(e),n=N(this.long0+t.x*Math.sqrt(1-this.es*r*r)/(this.a*Math.cos(e)))):r-s<a&&(n=this.long0)),t.x=n,t.y=e,t},names:["Sinusoidal","sinu"]};const Ze={init:function(){},forward:function(t){for(var e=t.x,n=t.y,r=N(e-this.long0),o=n,i=Math.PI*Math.sin(n);;){var a=-(o+Math.sin(o)-i)/(1+Math.cos(o));if(o+=a,Math.abs(a)<s)break}o/=2,Math.PI/2-Math.abs(n)<s&&(r=0);var l=.900316316158*this.a*r*Math.cos(o)+this.x0,c=1.4142135623731*this.a*Math.sin(o)+this.y0;return t.x=l,t.y=c,t},inverse:function(t){var e,n;t.x-=this.x0,t.y-=this.y0,n=t.y/(1.4142135623731*this.a),Math.abs(n)>.999999999999&&(n=.999999999999),e=Math.asin(n);var r=N(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));r<-Math.PI&&(r=-Math.PI),r>Math.PI&&(r=Math.PI),n=(2*e+Math.sin(2*e))/Math.PI,Math.abs(n)>1&&(n=1);var o=Math.asin(n);return t.x=r,t.y=o,t},names:["Mollweide","moll"]};const De={init:function(){Math.abs(this.lat1+this.lat2)<s||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=ce(this.es),this.e1=ue(this.es),this.e2=pe(this.es),this.e3=de(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=D(this.e,this.sinphi,this.cosphi),this.ml1=le(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<s?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=D(this.e,this.sinphi,this.cosphi),this.ml2=le(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=le(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(t){var e,n=t.x,r=t.y;if(this.sphere)e=this.a*(this.g-r);else{var o=le(this.e0,this.e1,this.e2,this.e3,r);e=this.a*(this.g-o)}var i=this.ns*N(n-this.long0),a=this.x0+e*Math.sin(i),s=this.y0+this.rh-e*Math.cos(i);return t.x=a,t.y=s,t},inverse:function(t){var e,n,r,o;t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns>=0?(n=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(n=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var i=0;return 0!==n&&(i=Math.atan2(e*t.x,e*t.y)),this.sphere?(o=N(this.long0+i/this.ns),r=fe(this.g-n/this.a),t.x=o,t.y=r,t):(r=me(this.g-n/this.a,this.e0,this.e1,this.e2,this.e3),o=N(this.long0+i/this.ns),t.x=o,t.y=r,t)},names:["Equidistant_Conic","eqdc"]};const ke={init:function(){this.R=this.a},forward:function(t){var e,n,r=t.x,o=t.y,i=N(r-this.long0);Math.abs(o)<=s&&(e=this.x0+this.R*i,n=this.y0);var l=Le(2*Math.abs(o/Math.PI));(Math.abs(i)<=s||Math.abs(Math.abs(o)-a)<=s)&&(e=this.x0,n=o>=0?this.y0+Math.PI*this.R*Math.tan(.5*l):this.y0+Math.PI*this.R*-Math.tan(.5*l));var c=.5*Math.abs(Math.PI/i-i/Math.PI),u=c*c,p=Math.sin(l),d=Math.cos(l),h=d/(p+d-1),f=h*h,m=h*(2/p-1),g=m*m,y=Math.PI*this.R*(c*(h-g)+Math.sqrt(u*(h-g)*(h-g)-(g+u)*(f-g)))/(g+u);i<0&&(y=-y),e=this.x0+y;var v=u+h;return y=Math.PI*this.R*(m*v-c*Math.sqrt((g+u)*(u+1)-v*v))/(g+u),n=o>=0?this.y0+y:this.y0-y,t.x=e,t.y=n,t},inverse:function(t){var e,n,r,o,i,a,l,c,u,p,d,h;return t.x-=this.x0,t.y-=this.y0,d=Math.PI*this.R,i=(r=t.x/d)*r+(o=t.y/d)*o,d=3*(o*o/(c=-2*(a=-Math.abs(o)*(1+i))+1+2*o*o+i*i)+(2*(l=a-2*o*o+r*r)*l*l/c/c/c-9*a*l/c/c)/27)/(u=(a-l*l/3/c)/c)/(p=2*Math.sqrt(-u/3)),Math.abs(d)>1&&(d=d>=0?1:-1),h=Math.acos(d)/3,n=t.y>=0?(-p*Math.cos(h+Math.PI/3)-l/3/c)*Math.PI:-(-p*Math.cos(h+Math.PI/3)-l/3/c)*Math.PI,e=Math.abs(r)<s?this.long0:N(this.long0+Math.PI*(i-1+Math.sqrt(1+2*(r*r-o*o)+i*i))/2/r),t.x=e,t.y=n,t},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]};const Ne={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(t){var e,n,r,o,i,l,c,u,p,d,h,f,m,g,y,v,_,C,E,w,S,b,L=t.x,T=t.y,P=Math.sin(t.y),A=Math.cos(t.y),O=N(L-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=s?(t.x=this.x0+this.a*(a-T)*Math.sin(O),t.y=this.y0-this.a*(a-T)*Math.cos(O),t):Math.abs(this.sin_p12+1)<=s?(t.x=this.x0+this.a*(a+T)*Math.sin(O),t.y=this.y0+this.a*(a+T)*Math.cos(O),t):(C=this.sin_p12*P+this.cos_p12*A*Math.cos(O),_=(v=Math.acos(C))?v/Math.sin(v):1,t.x=this.x0+this.a*_*A*Math.sin(O),t.y=this.y0+this.a*_*(this.cos_p12*P-this.sin_p12*A*Math.cos(O)),t):(e=ce(this.es),n=ue(this.es),r=pe(this.es),o=de(this.es),Math.abs(this.sin_p12-1)<=s?(i=this.a*le(e,n,r,o,a),l=this.a*le(e,n,r,o,T),t.x=this.x0+(i-l)*Math.sin(O),t.y=this.y0-(i-l)*Math.cos(O),t):Math.abs(this.sin_p12+1)<=s?(i=this.a*le(e,n,r,o,a),l=this.a*le(e,n,r,o,T),t.x=this.x0+(i+l)*Math.sin(O),t.y=this.y0+(i+l)*Math.cos(O),t):(c=P/A,u=he(this.a,this.e,this.sin_p12),p=he(this.a,this.e,P),d=Math.atan((1-this.es)*c+this.es*u*this.sin_p12/(p*A)),E=0===(h=Math.atan2(Math.sin(O),this.cos_p12*Math.tan(d)-this.sin_p12*Math.cos(O)))?Math.asin(this.cos_p12*Math.sin(d)-this.sin_p12*Math.cos(d)):Math.abs(Math.abs(h)-Math.PI)<=s?-Math.asin(this.cos_p12*Math.sin(d)-this.sin_p12*Math.cos(d)):Math.asin(Math.sin(O)*Math.cos(d)/Math.sin(h)),f=this.e*this.sin_p12/Math.sqrt(1-this.es),v=u*E*(1-(w=E*E)*(y=(m=this.e*this.cos_p12*Math.cos(h)/Math.sqrt(1-this.es))*m)*(1-y)/6+(S=w*E)/8*(g=f*m)*(1-2*y)+(b=S*E)/120*(y*(4-7*y)-3*f*f*(1-7*y))-b*E/48*g),t.x=this.x0+v*Math.sin(h),t.y=this.y0+v*Math.cos(h),t))},inverse:function(t){var e,n,r,o,i,l,c,u,p,d,h,f,m,g,y,v,_,C,E,w,S,b,L;if(t.x-=this.x0,t.y-=this.y0,this.sphere){if((e=Math.sqrt(t.x*t.x+t.y*t.y))>2*a*this.a)return;return n=e/this.a,r=Math.sin(n),o=Math.cos(n),i=this.long0,Math.abs(e)<=s?l=this.lat0:(l=Le(o*this.sin_p12+t.y*r*this.cos_p12/e),c=Math.abs(this.lat0)-a,i=Math.abs(c)<=s?this.lat0>=0?N(this.long0+Math.atan2(t.x,-t.y)):N(this.long0-Math.atan2(-t.x,t.y)):N(this.long0+Math.atan2(t.x*r,e*this.cos_p12*o-t.y*this.sin_p12*r))),t.x=i,t.y=l,t}return u=ce(this.es),p=ue(this.es),d=pe(this.es),h=de(this.es),Math.abs(this.sin_p12-1)<=s?(l=me(((f=this.a*le(u,p,d,h,a))-(e=Math.sqrt(t.x*t.x+t.y*t.y)))/this.a,u,p,d,h),i=N(this.long0+Math.atan2(t.x,-1*t.y)),t.x=i,t.y=l,t):Math.abs(this.sin_p12+1)<=s?(f=this.a*le(u,p,d,h,a),l=me(((e=Math.sqrt(t.x*t.x+t.y*t.y))-f)/this.a,u,p,d,h),i=N(this.long0+Math.atan2(t.x,t.y)),t.x=i,t.y=l,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),y=Math.atan2(t.x,t.y),m=he(this.a,this.e,this.sin_p12),v=Math.cos(y),C=-(_=this.e*this.cos_p12*v)*_/(1-this.es),E=3*this.es*(1-C)*this.sin_p12*this.cos_p12*v/(1-this.es),b=1-C*(S=(w=e/m)-C*(1+C)*Math.pow(w,3)/6-E*(1+3*C)*Math.pow(w,4)/24)*S/2-w*S*S*S/6,g=Math.asin(this.sin_p12*Math.cos(S)+this.cos_p12*Math.sin(S)*v),i=N(this.long0+Math.asin(Math.sin(y)*Math.sin(S)/Math.cos(g))),L=Math.sin(g),l=Math.atan2((L-this.es*b*this.sin_p12)*Math.tan(g),L*(1-this.es)),t.x=i,t.y=l,t)},names:["Azimuthal_Equidistant","aeqd"]};const Fe={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(t){var e,n,r,o,i,a,l,c=t.x,u=t.y;return r=N(c-this.long0),e=Math.sin(u),n=Math.cos(u),o=Math.cos(r),1,((i=this.sin_p14*e+this.cos_p14*n*o)>0||Math.abs(i)<=s)&&(a=1*this.a*n*Math.sin(r),l=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*n*o)),t.x=a,t.y=l,t},inverse:function(t){var e,n,r,o,i,l,c;return t.x-=this.x0,t.y-=this.y0,n=Le((e=Math.sqrt(t.x*t.x+t.y*t.y))/this.a),r=Math.sin(n),o=Math.cos(n),l=this.long0,Math.abs(e)<=s?(c=this.lat0,t.x=l,t.y=c,t):(c=Le(o*this.sin_p14+t.y*r*this.cos_p14/e),i=Math.abs(this.lat0)-a,Math.abs(i)<=s?(l=this.lat0>=0?N(this.long0+Math.atan2(t.x,-t.y)):N(this.long0-Math.atan2(-t.x,t.y)),t.x=l,t.y=c,t):(l=N(this.long0+Math.atan2(t.x*r,e*this.cos_p14*o-t.y*this.sin_p14*r)),t.x=l,t.y=c,t))},names:["ortho"]};var Ue=1,Ge=2,Be=3,je=4,We=5,qe=6,He=1,Ve=2,ze=3,Ye=4;function Ke(t,e,n,r){var o;return t<s?(r.value=He,o=0):(o=Math.atan2(e,n),Math.abs(o)<=u?r.value=He:o>u&&o<=a+u?(r.value=Ve,o-=a):o>a+u||o<=-(a+u)?(r.value=ze,o=o>=0?o-d:o+d):(r.value=Ye,o+=a)),o}function Xe(t,e){var n=t+e;return n<-d?n+=p:n>+d&&(n-=p),n}const $e={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=a-u/2?this.face=We:this.lat0<=-(a-u/2)?this.face=qe:Math.abs(this.long0)<=u?this.face=Ue:Math.abs(this.long0)<=a+u?this.face=this.long0>0?Ge:je:this.face=Be,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(t){var e,n,r,o,i,s,l={x:0,y:0},c={value:0};if(t.x-=this.long0,e=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(t.y)):t.y,n=t.x,this.face===We)o=a-e,n>=u&&n<=a+u?(c.value=He,r=n-a):n>a+u||n<=-(a+u)?(c.value=Ve,r=n>0?n-d:n+d):n>-(a+u)&&n<=-u?(c.value=ze,r=n+a):(c.value=Ye,r=n);else if(this.face===qe)o=a+e,n>=u&&n<=a+u?(c.value=He,r=-n+a):n<u&&n>=-u?(c.value=Ve,r=-n):n<-u&&n>=-(a+u)?(c.value=ze,r=-n-a):(c.value=Ye,r=n>0?-n+d:-n-d);else{var p,h,f,m,g,y;this.face===Ge?n=Xe(n,+a):this.face===Be?n=Xe(n,+d):this.face===je&&(n=Xe(n,-a)),m=Math.sin(e),g=Math.cos(e),y=Math.sin(n),p=g*Math.cos(n),h=g*y,f=m,this.face===Ue?r=Ke(o=Math.acos(p),f,h,c):this.face===Ge?r=Ke(o=Math.acos(h),f,-p,c):this.face===Be?r=Ke(o=Math.acos(-p),f,-h,c):this.face===je?r=Ke(o=Math.acos(-h),f,p,c):(o=r=0,c.value=He)}return s=Math.atan(12/d*(r+Math.acos(Math.sin(r)*Math.cos(u))-a)),i=Math.sqrt((1-Math.cos(o))/(Math.cos(s)*Math.cos(s))/(1-Math.cos(Math.atan(1/Math.cos(r))))),c.value===Ve?s+=a:c.value===ze?s+=d:c.value===Ye&&(s+=1.5*d),l.x=i*Math.cos(s),l.y=i*Math.sin(s),l.x=l.x*this.a+this.x0,l.y=l.y*this.a+this.y0,t.x=l.x,t.y=l.y,t},inverse:function(t){var e,n,r,o,i,s,l,c,u,p,h,f,m={lam:0,phi:0},g={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,n=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),e=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?g.value=He:t.y>=0&&t.y>=Math.abs(t.x)?(g.value=Ve,e-=a):t.x<0&&-t.x>=Math.abs(t.y)?(g.value=ze,e=e<0?e+d:e-d):(g.value=Ye,e+=a),u=d/12*Math.tan(e),i=Math.sin(u)/(Math.cos(u)-1/Math.sqrt(2)),s=Math.atan(i),(l=1-(r=Math.cos(e))*r*(o=Math.tan(n))*o*(1-Math.cos(Math.atan(1/Math.cos(s)))))<-1?l=-1:l>1&&(l=1),this.face===We)c=Math.acos(l),m.phi=a-c,g.value===He?m.lam=s+a:g.value===Ve?m.lam=s<0?s+d:s-d:g.value===ze?m.lam=s-a:m.lam=s;else if(this.face===qe)c=Math.acos(l),m.phi=c-a,g.value===He?m.lam=-s+a:g.value===Ve?m.lam=-s:g.value===ze?m.lam=-s-a:m.lam=s<0?-s-d:-s+d;else{var y,v,_;u=(y=l)*y,v=(u+=(_=u>=1?0:Math.sqrt(1-u)*Math.sin(s))*_)>=1?0:Math.sqrt(1-u),g.value===Ve?(u=v,v=-_,_=u):g.value===ze?(v=-v,_=-_):g.value===Ye&&(u=v,v=_,_=-u),this.face===Ge?(u=y,y=-v,v=u):this.face===Be?(y=-y,v=-v):this.face===je&&(u=y,y=v,v=-u),m.phi=Math.acos(-_)-a,m.lam=Math.atan2(v,y),this.face===Ge?m.lam=Xe(m.lam,-a):this.face===Be?m.lam=Xe(m.lam,-d):this.face===je&&(m.lam=Xe(m.lam,+a))}return 0!==this.es&&(p=m.phi<0?1:0,h=Math.tan(m.phi),f=this.b/Math.sqrt(h*h+this.one_minus_f_squared),m.phi=Math.atan(Math.sqrt(this.a*this.a-f*f)/(this.one_minus_f*f)),p&&(m.phi=-m.phi)),m.lam+=this.long0,t.x=m.lam,t.y=m.phi,t},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]};var Je=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Qe=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],tn=.8487,en=1.3523,nn=c/5,rn=18,on=function(t,e){return t[0]+e*(t[1]+e*(t[2]+e*t[3]))};const an={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(t){var e=N(t.x-this.long0),n=Math.abs(t.y),r=Math.floor(n*nn);r<0?r=0:r>=rn&&(r=17);var o={x:on(Je[r],n=c*(n-.08726646259971647*r))*e,y:on(Qe[r],n)};return t.y<0&&(o.y=-o.y),o.x=o.x*this.a*tn+this.x0,o.y=o.y*this.a*en+this.y0,o},inverse:function(t){var e={x:(t.x-this.x0)/(this.a*tn),y:Math.abs(t.y-this.y0)/(this.a*en)};if(e.y>=1)e.x/=Je[18][0],e.y=t.y<0?-a:a;else{var n=Math.floor(e.y*rn);for(n<0?n=0:n>=rn&&(n=17);;)if(Qe[n][0]>e.y)--n;else{if(!(Qe[n+1][0]<=e.y))break;++n}var r=Qe[n],o=5*(e.y-r[0])/(Qe[n+1][0]-r[0]);o=function(t,e,n,r){for(var o=e;r;--r){var i=t(o);if(o-=i,Math.abs(i)<n)break}return o}((function(t){return(on(r,t)-e.y)/function(t,e){return t[1]+e*(2*t[2]+3*e*t[3])}(r,t)}),o,s,100),e.x/=on(Je[n],o),e.y=(5*n+o)*l,t.y<0&&(e.y=-e.y)}return e.x=N(e.x+this.long0),e},names:["Robinson","robin"]};const sn={init:function(){this.name="geocent"},forward:function(t){return it(t,this.es,this.a)},inverse:function(t){return at(t,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]};var ln=0,cn=1,un=2,pn=3,dn={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};const hn={init:function(){if(Object.keys(dn).forEach(function(t){if(void 0===this[t])this[t]=dn[t].def;else{if(dn[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);dn[t].num&&(this[t]=parseFloat(this[t]))}dn[t].degrees&&(this[t]=this[t]*l)}.bind(this)),Math.abs(Math.abs(this.lat0)-a)<s?this.mode=this.lat0<0?cn:ln:Math.abs(this.lat0)<s?this.mode=un:(this.mode=pn,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var t=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(t),this.sw=Math.sin(t)},forward:function(t){t.x-=this.long0;var e,n,r,o,i=Math.sin(t.y),a=Math.cos(t.y),s=Math.cos(t.x);switch(this.mode){case pn:n=this.sinph0*i+this.cosph0*a*s;break;case un:n=a*s;break;case cn:n=-i;break;case ln:n=i}switch(e=(n=this.pn1/(this.p-n))*a*Math.sin(t.x),this.mode){case pn:n*=this.cosph0*i-this.sinph0*a*s;break;case un:n*=i;break;case ln:n*=-a*s;break;case cn:n*=a*s}return o=1/((r=n*this.cg+e*this.sg)*this.sw*this.h1+this.cw),e=(e*this.cg-n*this.sg)*this.cw*o,n=r*o,t.x=e*this.a,t.y=n*this.a,t},inverse:function(t){t.x/=this.a,t.y/=this.a;var e,n,r,o={x:t.x,y:t.y};r=1/(this.pn1-t.y*this.sw),e=this.pn1*t.x*r,n=this.pn1*t.y*this.cw*r,t.x=e*this.cg+n*this.sg,t.y=n*this.cg-e*this.sg;var i=zt(t.x,t.y);if(Math.abs(i)<s)o.x=0,o.y=t.y;else{var a,l;switch(l=1-i*i*this.pfact,l=(this.p-Math.sqrt(l))/(this.pn1/i+i/this.pn1),a=Math.sqrt(1-l*l),this.mode){case pn:o.y=Math.asin(a*this.sinph0+t.y*l*this.cosph0/i),t.y=(a-this.sinph0*Math.sin(o.y))*i,t.x*=l*this.cosph0;break;case un:o.y=Math.asin(t.y*l/i),t.y=a*i,t.x*=l;break;case ln:o.y=Math.asin(a),t.y=-t.y;break;case cn:o.y=-Math.asin(a)}o.x=Math.atan2(t.x,t.y)}return t.x=o.x+this.long0,t.y=o.y,t},names:["Tilted_Perspective","tpers"]};_t.defaultDatum="WGS84",_t.Proj=ot,_t.WGS84=new _t.Proj("WGS84"),_t.Point=Ft,_t.toPoint=ht,_t.defs=x,_t.nadgrid=function(t,e){var n=new DataView(e),r=function(t){var e=t.getInt32(8,!1);if(11===e)return!1;11!==(e=t.getInt32(8,!0))&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian");return!0}(n),o=function(t,e){return{nFields:t.getInt32(8,e),nSubgridFields:t.getInt32(24,e),nSubgrids:t.getInt32(40,e),shiftType:Q(t,56,64).trim(),fromSemiMajorAxis:t.getFloat64(120,e),fromSemiMinorAxis:t.getFloat64(136,e),toSemiMajorAxis:t.getFloat64(152,e),toSemiMinorAxis:t.getFloat64(168,e)}}(n,r);o.nSubgrids>1&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored");var i=function(t,e,n){for(var r=176,o=[],i=0;i<e.nSubgrids;i++){var a=et(t,r,n),s=nt(t,r,a,n),l=Math.round(1+(a.upperLongitude-a.lowerLongitude)/a.longitudeInterval),c=Math.round(1+(a.upperLatitude-a.lowerLatitude)/a.latitudeInterval);o.push({ll:[J(a.lowerLongitude),J(a.lowerLatitude)],del:[J(a.longitudeInterval),J(a.latitudeInterval)],lim:[l,c],count:a.gridNodeCount,cvs:tt(s)})}return o}(n,o,r),a={header:o,subgrids:i};return X[t]=a,a},_t.transform=mt,_t.mgrs=Pt,_t.version="__VERSION__",function(t){t.Proj.projections.add(Ht),t.Proj.projections.add($t),t.Proj.projections.add(Jt),t.Proj.projections.add(ee),t.Proj.projections.add(ne),t.Proj.projections.add(re),t.Proj.projections.add(ie),t.Proj.projections.add(ae),t.Proj.projections.add(se),t.Proj.projections.add(ge),t.Proj.projections.add(be),t.Proj.projections.add(Te),t.Proj.projections.add(Pe),t.Proj.projections.add(Ae),t.Proj.projections.add(Oe),t.Proj.projections.add(xe),t.Proj.projections.add(Ie),t.Proj.projections.add(Me),t.Proj.projections.add(Re),t.Proj.projections.add(Ze),t.Proj.projections.add(De),t.Proj.projections.add(ke),t.Proj.projections.add(Ne),t.Proj.projections.add(Fe),t.Proj.projections.add($e),t.Proj.projections.add(an),t.Proj.projections.add(sn),t.Proj.projections.add(hn)}(_t);const fn=_t},6656:function(t){t.exports=function(){"use strict";function t(t,r,o,i,a){!function t(n,r,o,i,a){for(;i>o;){if(i-o>600){var s=i-o+1,l=r-o+1,c=Math.log(s),u=.5*Math.exp(2*c/3),p=.5*Math.sqrt(c*u*(s-u)/s)*(l-s/2<0?-1:1);t(n,r,Math.max(o,Math.floor(r-l*u/s+p)),Math.min(i,Math.floor(r+(s-l)*u/s+p)),a)}var d=n[r],h=o,f=i;for(e(n,o,r),a(n[i],d)>0&&e(n,o,i);h<f;){for(e(n,h,f),h++,f--;a(n[h],d)<0;)h++;for(;a(n[f],d)>0;)f--}0===a(n[o],d)?e(n,o,f):e(n,++f,i),f<=r&&(o=f+1),r<=f&&(i=f-1)}}(t,r,o||0,i||t.length-1,a||n)}function e(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function n(t,e){return t<e?-1:t>e?1:0}var r=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function o(t,e,n){if(!n)return e.indexOf(t);for(var r=0;r<e.length;r++)if(n(t,e[r]))return r;return-1}function i(t,e){a(t,0,t.children.length,e,t)}function a(t,e,n,r,o){o||(o=f(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(var i=e;i<n;i++){var a=t.children[i];s(o,t.leaf?r(a):a)}return o}function s(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function l(t,e){return t.minX-e.minX}function c(t,e){return t.minY-e.minY}function u(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function p(t){return t.maxX-t.minX+(t.maxY-t.minY)}function d(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function h(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function f(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(e,n,r,o,i){for(var a=[n,r];a.length;)if(!((r=a.pop())-(n=a.pop())<=o)){var s=n+Math.ceil((r-n)/o/2)*o;t(e,s,n,r,i),a.push(n,s,s,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(t){var e=this.data,n=[];if(!h(t,e))return n;for(var r=this.toBBox,o=[];e;){for(var i=0;i<e.children.length;i++){var a=e.children[i],s=e.leaf?r(a):a;h(t,s)&&(e.leaf?n.push(a):d(t,s)?this._all(a,n):o.push(a))}e=o.pop()}return n},r.prototype.collides=function(t){var e=this.data;if(!h(t,e))return!1;for(var n=[];e;){for(var r=0;r<e.children.length;r++){var o=e.children[r],i=e.leaf?this.toBBox(o):o;if(h(t,i)){if(e.leaf||d(t,i))return!0;n.push(o)}}e=n.pop()}return!1},r.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},r.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},r.prototype.clear=function(){return this.data=f([]),this},r.prototype.remove=function(t,e){if(!t)return this;for(var n,r,i,a=this.data,s=this.toBBox(t),l=[],c=[];a||l.length;){if(a||(a=l.pop(),r=l[l.length-1],n=c.pop(),i=!0),a.leaf){var u=o(t,a.children,e);if(-1!==u)return a.children.splice(u,1),l.push(a),this._condense(l),this}i||a.leaf||!d(a,s)?r?(n++,a=r.children[n],i=!1):a=null:(l.push(a),c.push(n),n=0,r=a,a=a.children[0])}return this},r.prototype.toBBox=function(t){return t},r.prototype.compareMinX=function(t,e){return t.minX-e.minX},r.prototype.compareMinY=function(t,e){return t.minY-e.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(t){return this.data=t,this},r.prototype._all=function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},r.prototype._build=function(t,e,n,r){var o,a=n-e+1,s=this._maxEntries;if(a<=s)return i(o=f(t.slice(e,n+1)),this.toBBox),o;r||(r=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,r-1))),(o=f([])).leaf=!1,o.height=r;var l=Math.ceil(a/s),c=l*Math.ceil(Math.sqrt(s));m(t,e,n,c,this.compareMinX);for(var u=e;u<=n;u+=c){var p=Math.min(u+c-1,n);m(t,u,p,l,this.compareMinY);for(var d=u;d<=p;d+=l){var h=Math.min(d+l-1,p);o.children.push(this._build(t,d,h,r-1))}}return i(o,this.toBBox),o},r.prototype._chooseSubtree=function(t,e,n,r){for(;r.push(e),!e.leaf&&r.length-1!==n;){for(var o=1/0,i=1/0,a=void 0,s=0;s<e.children.length;s++){var l=e.children[s],c=u(l),p=(d=t,h=l,(Math.max(h.maxX,d.maxX)-Math.min(h.minX,d.minX))*(Math.max(h.maxY,d.maxY)-Math.min(h.minY,d.minY))-c);p<i?(i=p,o=c<o?c:o,a=l):p===i&&c<o&&(o=c,a=l)}e=a||e.children[0]}var d,h;return e},r.prototype._insert=function(t,e,n){var r=n?t:this.toBBox(t),o=[],i=this._chooseSubtree(r,this.data,e,o);for(i.children.push(t),s(i,r);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(r,o,e)},r.prototype._split=function(t,e){var n=t[e],r=n.children.length,o=this._minEntries;this._chooseSplitAxis(n,o,r);var a=this._chooseSplitIndex(n,o,r),s=f(n.children.splice(a,n.children.length-a));s.height=n.height,s.leaf=n.leaf,i(n,this.toBBox),i(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(n,s)},r.prototype._splitRoot=function(t,e){this.data=f([t,e]),this.data.height=t.height+1,this.data.leaf=!1,i(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(t,e,n){for(var r,o,i,s,l,c,p,d=1/0,h=1/0,f=e;f<=n-e;f++){var m=a(t,0,f,this.toBBox),g=a(t,f,n,this.toBBox),y=(o=m,i=g,s=void 0,l=void 0,c=void 0,p=void 0,s=Math.max(o.minX,i.minX),l=Math.max(o.minY,i.minY),c=Math.min(o.maxX,i.maxX),p=Math.min(o.maxY,i.maxY),Math.max(0,c-s)*Math.max(0,p-l)),v=u(m)+u(g);y<d?(d=y,r=f,h=v<h?v:h):y===d&&v<h&&(h=v,r=f)}return r||n-e},r.prototype._chooseSplitAxis=function(t,e,n){var r=t.leaf?this.compareMinX:l,o=t.leaf?this.compareMinY:c;this._allDistMargin(t,e,n,r)<this._allDistMargin(t,e,n,o)&&t.children.sort(r)},r.prototype._allDistMargin=function(t,e,n,r){t.children.sort(r);for(var o=this.toBBox,i=a(t,0,e,o),l=a(t,n-e,n,o),c=p(i)+p(l),u=e;u<n-e;u++){var d=t.children[u];s(i,t.leaf?o(d):d),c+=p(i)}for(var h=n-e-1;h>=e;h--){var f=t.children[h];s(l,t.leaf?o(f):f),c+=p(l)}return c},r.prototype._adjustParentBBoxes=function(t,e,n){for(var r=n;r>=0;r--)s(e[r],t)},r.prototype._condense=function(t){for(var e=t.length-1,n=void 0;e>=0;e--)0===t[e].children.length?e>0?(n=t[e-1].children).splice(n.indexOf(t[e]),1):this.clear():i(t[e],this.toBBox)},r}()},3819:function(t,e,n){var r;
/*!
 * UAParser.js v0.7.21
 * Lightweight JavaScript-based User-Agent string parser
 * https://github.com/faisalman/ua-parser-js
 *
 * Copyright © 2012-2019 Faisal Salman <f@faisalman.com>
 * Licensed under MIT License
 */!function(o,i){"use strict";var a="function",s="undefined",l="object",c="model",u="name",p="type",d="vendor",h="version",f="architecture",m="console",g="mobile",y="tablet",v="smarttv",_="wearable",C={extend:function(t,e){var n={};for(var r in t)e[r]&&e[r].length%2==0?n[r]=e[r].concat(t[r]):n[r]=t[r];return n},has:function(t,e){return"string"==typeof t&&-1!==e.toLowerCase().indexOf(t.toLowerCase())},lowerize:function(t){return t.toLowerCase()},major:function(t){return"string"==typeof t?t.replace(/[^\d\.]/g,"").split(".")[0]:i},trim:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},E={rgx:function(t,e){for(var n,r,o,s,c,u,p=0;p<e.length&&!c;){var d=e[p],h=e[p+1];for(n=r=0;n<d.length&&!c;)if(c=d[n++].exec(t))for(o=0;o<h.length;o++)u=c[++r],typeof(s=h[o])===l&&s.length>0?2==s.length?typeof s[1]==a?this[s[0]]=s[1].call(this,u):this[s[0]]=s[1]:3==s.length?typeof s[1]!==a||s[1].exec&&s[1].test?this[s[0]]=u?u.replace(s[1],s[2]):i:this[s[0]]=u?s[1].call(this,u,s[2]):i:4==s.length&&(this[s[0]]=u?s[3].call(this,u.replace(s[1],s[2])):i):this[s]=u||i;p+=2}},str:function(t,e){for(var n in e)if(typeof e[n]===l&&e[n].length>0){for(var r=0;r<e[n].length;r++)if(C.has(e[n][r],t))return"?"===n?i:n}else if(C.has(e[n],t))return"?"===n?i:n;return t}},w={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},S={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[u,h],[/(opios)[\/\s]+([\w\.]+)/i],[[u,"Opera Mini"],h],[/\s(opr)\/([\w\.]+)/i],[[u,"Opera"],h],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim)(?:browser)?[\/\s]?([\w\.]*)/i,/(bidubrowser|baidubrowser)[\/\s]?([\w\.]+)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon)\/([\w\.-]+)/i],[u,h],[/(konqueror)\/([\w\.]+)/i],[[u,"Konqueror"],h],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[u,"IE"],h],[/(edge|edgios|edga|edg)\/((\d+)?[\w\.]+)/i],[[u,"Edge"],h],[/(yabrowser)\/([\w\.]+)/i],[[u,"Yandex"],h],[/(Avast)\/([\w\.]+)/i],[[u,"Avast Secure Browser"],h],[/(AVG)\/([\w\.]+)/i],[[u,"AVG Secure Browser"],h],[/(puffin)\/([\w\.]+)/i],[[u,"Puffin"],h],[/(focus)\/([\w\.]+)/i],[[u,"Firefox Focus"],h],[/(opt)\/([\w\.]+)/i],[[u,"Opera Touch"],h],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[u,"UCBrowser"],h],[/(comodo_dragon)\/([\w\.]+)/i],[[u,/_/g," "],h],[/(windowswechat qbcore)\/([\w\.]+)/i],[[u,"WeChat(Win) Desktop"],h],[/(micromessenger)\/([\w\.]+)/i],[[u,"WeChat"],h],[/(brave)\/([\w\.]+)/i],[[u,"Brave"],h],[/(qqbrowserlite)\/([\w\.]+)/i],[u,h],[/(QQ)\/([\d\.]+)/i],[u,h],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[u,h],[/(baiduboxapp)[\/\s]?([\w\.]+)/i],[u,h],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[u,h],[/(MetaSr)[\/\s]?([\w\.]+)/i],[u],[/(LBBROWSER)/i],[u],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[h,[u,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[h,[u,"Facebook"]],[/safari\s(line)\/([\w\.]+)/i,/android.+(line)\/([\w\.]+)\/iab/i],[u,h],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[h,[u,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[u,/(.+)/,"$1 WebView"],h],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[u,/(.+(?:g|us))(.+)/,"$1 $2"],h],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[h,[u,"Android Browser"]],[/(sailfishbrowser)\/([\w\.]+)/i],[[u,"Sailfish Browser"],h],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[u,h],[/(dolfin)\/([\w\.]+)/i],[[u,"Dolphin"],h],[/(qihu|qhbrowser|qihoobrowser|360browser)/i],[[u,"360 Browser"]],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[u,"Chrome"],h],[/(coast)\/([\w\.]+)/i],[[u,"Opera Coast"],h],[/fxios\/([\w\.-]+)/i],[h,[u,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[h,[u,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[h,u],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[u,"GSA"],h],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[u,[h,E.str,w.browser.oldsafari.version]],[/(webkit|khtml)\/([\w\.]+)/i],[u,h],[/(navigator|netscape)\/([\w\.-]+)/i],[[u,"Netscape"],h],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[u,h]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[f,"amd64"]],[/(ia32(?=;))/i],[[f,C.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[f,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[f,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[f,/ower/,"",C.lowerize]],[/(sun4\w)[;\)]/i],[[f,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+[;l]))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[f,C.lowerize]]],device:[[/\((ipad|playbook);[\w\s\),;-]+(rim|apple)/i],[c,d,[p,y]],[/applecoremedia\/[\w\.]+ \((ipad)/],[c,[d,"Apple"],[p,y]],[/(apple\s{0,1}tv)/i],[[c,"Apple TV"],[d,"Apple"],[p,v]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[d,c,[p,y]],[/(kf[A-z]+)\sbuild\/.+silk\//i],[c,[d,"Amazon"],[p,y]],[/(sd|kf)[0349hijorstuw]+\sbuild\/.+silk\//i],[[c,E.str,w.device.amazon.model],[d,"Amazon"],[p,g]],[/android.+aft([bms])\sbuild/i],[c,[d,"Amazon"],[p,v]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[c,d,[p,g]],[/\((ip[honed|\s\w*]+);/i],[c,[d,"Apple"],[p,g]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[d,c,[p,g]],[/\(bb10;\s(\w+)/i],[c,[d,"BlackBerry"],[p,g]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone|p00c)/i],[c,[d,"Asus"],[p,y]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[d,"Sony"],[c,"Xperia Tablet"],[p,y]],[/android.+\s([c-g]\d{4}|so[-l]\w+)(?=\sbuild\/|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[c,[d,"Sony"],[p,g]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[d,c,[p,m]],[/android.+;\s(shield)\sbuild/i],[c,[d,"Nvidia"],[p,m]],[/(playstation\s[34portablevi]+)/i],[c,[d,"Sony"],[p,m]],[/(sprint\s(\w+))/i],[[d,E.str,w.device.sprint.vendor],[c,E.str,w.device.sprint.model],[p,g]],[/(htc)[;_\s-]+([\w\s]+(?=\)|\sbuild)|\w+)/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[d,[c,/_/g," "],[p,g]],[/(nexus\s9)/i],[c,[d,"HTC"],[p,y]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p|vog-l29|ane-lx1|eml-l29)/i],[c,[d,"Huawei"],[p,g]],[/android.+(bah2?-a?[lw]\d{2})/i],[c,[d,"Huawei"],[p,y]],[/(microsoft);\s(lumia[\s\w]+)/i],[d,c,[p,g]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[c,[d,"Microsoft"],[p,m]],[/(kin\.[onetw]{3})/i],[[c,/\./g," "],[d,"Microsoft"],[p,g]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[c,[d,"Motorola"],[p,g]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[c,[d,"Motorola"],[p,y]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[d,C.trim],[c,C.trim],[p,v]],[/hbbtv.+maple;(\d+)/i],[[c,/^/,"SmartTV"],[d,"Samsung"],[p,v]],[/\(dtv[\);].+(aquos)/i],[c,[d,"Sharp"],[p,v]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[d,"Samsung"],c,[p,y]],[/smart-tv.+(samsung)/i],[d,[p,v],c],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[d,"Samsung"],c,[p,g]],[/sie-(\w*)/i],[c,[d,"Siemens"],[p,g]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[d,"Nokia"],c,[p,g]],[/android[x\d\.\s;]+\s([ab][1-7]\-?[0178a]\d\d?)/i],[c,[d,"Acer"],[p,y]],[/android.+([vl]k\-?\d{3})\s+build/i],[c,[d,"LG"],[p,y]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[d,"LG"],c,[p,y]],[/(lg) netcast\.tv/i],[d,c,[p,v]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[c,[d,"LG"],[p,g]],[/(lenovo)\s?(s(?:5000|6000)(?:[\w-]+)|tab(?:[\s\w]+))/i],[d,c,[p,y]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[c,[d,"Lenovo"],[p,y]],[/(lenovo)[_\s-]?([\w-]+)/i],[d,c,[p,g]],[/linux;.+((jolla));/i],[d,c,[p,g]],[/((pebble))app\/[\d\.]+\s/i],[d,c,[p,_]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[d,c,[p,g]],[/crkey/i],[[c,"Chromecast"],[d,"Google"],[p,v]],[/android.+;\s(glass)\s\d/i],[c,[d,"Google"],[p,_]],[/android.+;\s(pixel c)[\s)]/i],[c,[d,"Google"],[p,y]],[/android.+;\s(pixel( [23])?( xl)?)[\s)]/i],[c,[d,"Google"],[p,g]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:a\d|one|one[\s_]plus|note lte)?[\s_]*(?:\d?\w?)[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+))\s+build/i],[[c,/_/g," "],[d,"Xiaomi"],[p,g]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+))\s+build/i],[[c,/_/g," "],[d,"Xiaomi"],[p,y]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[c,[d,"Meizu"],[p,g]],[/(mz)-([\w-]{2,})/i],[[d,"Meizu"],c,[p,g]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})[\s)]/i],[c,[d,"OnePlus"],[p,g]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[c,[d,"RCA"],[p,y]],[/android.+[;\/\s]+(Venue[\d\s]{2,7})\s+build/i],[c,[d,"Dell"],[p,y]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[c,[d,"Verizon"],[p,y]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[d,"Barnes & Noble"],c,[p,y]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[c,[d,"NuVision"],[p,y]],[/android.+;\s(k88)\sbuild/i],[c,[d,"ZTE"],[p,y]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[c,[d,"Swiss"],[p,g]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[c,[d,"Swiss"],[p,y]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[c,[d,"Zeki"],[p,y]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[d,"Dragon Touch"],c,[p,y]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[c,[d,"Insignia"],[p,y]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[c,[d,"NextBook"],[p,y]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[d,"Voice"],c,[p,g]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[d,"LvTel"],c,[p,g]],[/android.+;\s(PH-1)\s/i],[c,[d,"Essential"],[p,g]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[c,[d,"Envizen"],[p,y]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[d,c,[p,y]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[c,[d,"MachSpeed"],[p,y]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[d,c,[p,y]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[c,[d,"Rotor"],[p,y]],[/android.+(KS(.+))\s+build/i],[c,[d,"Amazon"],[p,y]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[d,c,[p,y]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[p,C.lowerize],d,c],[/[\s\/\(](smart-?tv)[;\)]/i],[[p,v]],[/(android[\w\.\s\-]{0,9});.+build/i],[c,[d,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[h,[u,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[h,[u,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[u,h],[/rv\:([\w\.]{1,9}).+(gecko)/i],[h,u]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[u,h],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[u,[h,E.str,w.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[u,"Windows"],[h,E.str,w.os.windows.version]],[/\((bb)(10);/i],[[u,"BlackBerry"],h],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen|kaios)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|sailfish|contiki)[\/\s-]?([\w\.]*)/i],[u,h],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[u,"Symbian"],h],[/\((series40);/i],[u],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[u,"Firefox OS"],h],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[u,h],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[u,"Chromium OS"],h],[/(sunos)\s?([\w\.\d]*)/i],[[u,"Solaris"],h],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[u,h],[/(haiku)\s(\w+)/i],[u,h],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[h,/_/g,"."],[u,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[u,"Mac OS"],[h,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i,/(unix)\s?([\w\.]*)/i],[u,h]]},b=function(t,e){if("object"==typeof t&&(e=t,t=i),!(this instanceof b))return new b(t,e).getResult();var n=t||(o&&o.navigator&&o.navigator.userAgent?o.navigator.userAgent:""),r=e?C.extend(S,e):S;return this.getBrowser=function(){var t={name:i,version:i};return E.rgx.call(t,n,r.browser),t.major=C.major(t.version),t},this.getCPU=function(){var t={architecture:i};return E.rgx.call(t,n,r.cpu),t},this.getDevice=function(){var t={vendor:i,model:i,type:i};return E.rgx.call(t,n,r.device),t},this.getEngine=function(){var t={name:i,version:i};return E.rgx.call(t,n,r.engine),t},this.getOS=function(){var t={name:i,version:i};return E.rgx.call(t,n,r.os),t},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(t){return n=t,this},this};b.VERSION="0.7.21",b.BROWSER={NAME:u,MAJOR:"major",VERSION:h},b.CPU={ARCHITECTURE:f},b.DEVICE={MODEL:c,VENDOR:d,TYPE:p,CONSOLE:m,MOBILE:g,SMARTTV:v,TABLET:y,WEARABLE:_,EMBEDDED:"embedded"},b.ENGINE={NAME:u,VERSION:h},b.OS={NAME:u,VERSION:h},typeof e!==s?(t.exports&&(e=t.exports=b),e.UAParser=b):(r=function(){return b}.call(e,n,e,t))===i||(t.exports=r);var L=o&&(o.jQuery||o.Zepto);if(L&&!L.ua){var T=new b;L.ua=T.getResult(),L.ua.get=function(){return T.getUA()},L.ua.set=function(t){T.setUA(t);var e=T.getResult();for(var n in e)L.ua[n]=e[n]}}}("object"==typeof window?window:this)},9397:t=>{t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},5663:(t,e,n)=>{var r=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),n={},r=0;r<e.length;r++)n[e[r]]=Object.getOwnPropertyDescriptor(t,e[r]);return n},o=/%[sdj%]/g;e.format=function(t){if(!y(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(s(arguments[n]));return e.join(" ")}n=1;for(var r=arguments,i=r.length,a=String(t).replace(o,(function(t){if("%%"===t)return"%";if(n>=i)return t;switch(t){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(t){return"[Circular]"}default:return t}})),l=r[n];n<i;l=r[++n])m(l)||!C(l)?a+=" "+l:a+=" "+s(l);return a},e.deprecate=function(t,n){if("undefined"!=typeof process&&!0===process.noDeprecation)return t;if("undefined"==typeof process)return function(){return e.deprecate(t,n).apply(this,arguments)};var r=!1;return function(){if(!r){if(process.throwDeprecation)throw new Error(n);process.traceDeprecation?console.trace(n):console.error(n),r=!0}return t.apply(this,arguments)}};var i,a={};function s(t,n){var r={seen:[],stylize:c};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),f(n)?r.showHidden=n:n&&e._extend(r,n),v(r.showHidden)&&(r.showHidden=!1),v(r.depth)&&(r.depth=2),v(r.colors)&&(r.colors=!1),v(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=l),u(r,t,r.depth)}function l(t,e){var n=s.styles[e];return n?"["+s.colors[n][0]+"m"+t+"["+s.colors[n][1]+"m":t}function c(t,e){return t}function u(t,n,r){if(t.customInspect&&n&&S(n.inspect)&&n.inspect!==e.inspect&&(!n.constructor||n.constructor.prototype!==n)){var o=n.inspect(r,t);return y(o)||(o=u(t,o,r)),o}var i=function(t,e){if(v(e))return t.stylize("undefined","undefined");if(y(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}if(g(e))return t.stylize(""+e,"number");if(f(e))return t.stylize(""+e,"boolean");if(m(e))return t.stylize("null","null")}(t,n);if(i)return i;var a=Object.keys(n),s=function(t){var e={};return t.forEach((function(t,n){e[t]=!0})),e}(a);if(t.showHidden&&(a=Object.getOwnPropertyNames(n)),w(n)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return p(n);if(0===a.length){if(S(n)){var l=n.name?": "+n.name:"";return t.stylize("[Function"+l+"]","special")}if(_(n))return t.stylize(RegExp.prototype.toString.call(n),"regexp");if(E(n))return t.stylize(Date.prototype.toString.call(n),"date");if(w(n))return p(n)}var c,C="",b=!1,L=["{","}"];(h(n)&&(b=!0,L=["[","]"]),S(n))&&(C=" [Function"+(n.name?": "+n.name:"")+"]");return _(n)&&(C=" "+RegExp.prototype.toString.call(n)),E(n)&&(C=" "+Date.prototype.toUTCString.call(n)),w(n)&&(C=" "+p(n)),0!==a.length||b&&0!=n.length?r<0?_(n)?t.stylize(RegExp.prototype.toString.call(n),"regexp"):t.stylize("[Object]","special"):(t.seen.push(n),c=b?function(t,e,n,r,o){for(var i=[],a=0,s=e.length;a<s;++a)A(e,String(a))?i.push(d(t,e,n,r,String(a),!0)):i.push("");return o.forEach((function(o){o.match(/^\d+$/)||i.push(d(t,e,n,r,o,!0))})),i}(t,n,r,s,a):a.map((function(e){return d(t,n,r,s,e,b)})),t.seen.pop(),function(t,e,n){if(t.reduce((function(t,e){return e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1];return n[0]+e+" "+t.join(", ")+" "+n[1]}(c,C,L)):L[0]+C+L[1]}function p(t){return"["+Error.prototype.toString.call(t)+"]"}function d(t,e,n,r,o,i){var a,s,l;if((l=Object.getOwnPropertyDescriptor(e,o)||{value:e[o]}).get?s=l.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):l.set&&(s=t.stylize("[Setter]","special")),A(r,o)||(a="["+o+"]"),s||(t.seen.indexOf(l.value)<0?(s=m(n)?u(t,l.value,null):u(t,l.value,n-1)).indexOf("\n")>-1&&(s=i?s.split("\n").map((function(t){return"  "+t})).join("\n").substr(2):"\n"+s.split("\n").map((function(t){return"   "+t})).join("\n")):s=t.stylize("[Circular]","special")),v(a)){if(i&&o.match(/^\d+$/))return s;(a=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=t.stylize(a,"string"))}return a+": "+s}function h(t){return Array.isArray(t)}function f(t){return"boolean"==typeof t}function m(t){return null===t}function g(t){return"number"==typeof t}function y(t){return"string"==typeof t}function v(t){return void 0===t}function _(t){return C(t)&&"[object RegExp]"===b(t)}function C(t){return"object"==typeof t&&null!==t}function E(t){return C(t)&&"[object Date]"===b(t)}function w(t){return C(t)&&("[object Error]"===b(t)||t instanceof Error)}function S(t){return"function"==typeof t}function b(t){return Object.prototype.toString.call(t)}function L(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(t){if(v(i)&&(i=process.env.NODE_DEBUG||""),t=t.toUpperCase(),!a[t])if(new RegExp("\\b"+t+"\\b","i").test(i)){var n=process.pid;a[t]=function(){var r=e.format.apply(e,arguments);console.error("%s %d: %s",t,n,r)}}else a[t]=function(){};return a[t]},e.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=h,e.isBoolean=f,e.isNull=m,e.isNullOrUndefined=function(t){return null==t},e.isNumber=g,e.isString=y,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=v,e.isRegExp=_,e.isObject=C,e.isDate=E,e.isError=w,e.isFunction=S,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=n(9397);var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function P(){var t=new Date,e=[L(t.getHours()),L(t.getMinutes()),L(t.getSeconds())].join(":");return[t.getDate(),T[t.getMonth()],e].join(" ")}function A(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){console.log("%s - %s",P(),e.format.apply(e,arguments))},e.inherits=n(8575),e._extend=function(t,e){if(!e||!C(e))return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t};var O="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function x(t,e){if(!t){var n=new Error("Promise was rejected with a falsy value");n.reason=t,t=n}return e(t)}e.promisify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');if(O&&t[O]){var e;if("function"!=typeof(e=t[O]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,O,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,n,r=new Promise((function(t,r){e=t,n=r})),o=[],i=0;i<arguments.length;i++)o.push(arguments[i]);o.push((function(t,r){t?n(t):e(r)}));try{t.apply(this,o)}catch(t){n(t)}return r}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),O&&Object.defineProperty(e,O,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,r(t))},e.promisify.custom=O,e.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function e(){for(var e=[],n=0;n<arguments.length;n++)e.push(arguments[n]);var r=e.pop();if("function"!=typeof r)throw new TypeError("The last argument must be of type Function");var o=this,i=function(){return r.apply(o,arguments)};t.apply(this,e).then((function(t){process.nextTick(i,null,t)}),(function(t){process.nextTick(x,t,i)}))}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),Object.defineProperties(e,r(t)),e}},8009:(t,e,n)=>{var r=n(2486).Buffer;function o(t,e){this.buffer=t,this.position=0,this.isBigEndian=e||!1}function i(t,e,n){return function(){var r;return r=this.isBigEndian?e.call(this.buffer,this.position):t.call(this.buffer,this.position),this.position+=n,r}}t.exports=o,o.prototype.readUInt8=i(r.prototype.readUInt8,r.prototype.readUInt8,1),o.prototype.readUInt16=i(r.prototype.readUInt16LE,r.prototype.readUInt16BE,2),o.prototype.readUInt32=i(r.prototype.readUInt32LE,r.prototype.readUInt32BE,4),o.prototype.readInt8=i(r.prototype.readInt8,r.prototype.readInt8,1),o.prototype.readInt16=i(r.prototype.readInt16LE,r.prototype.readInt16BE,2),o.prototype.readInt32=i(r.prototype.readInt32LE,r.prototype.readInt32BE,4),o.prototype.readFloat=i(r.prototype.readFloatLE,r.prototype.readFloatBE,4),o.prototype.readDouble=i(r.prototype.readDoubleLE,r.prototype.readDoubleBE,8),o.prototype.readVarInt=function(){var t,e=0,n=0;do{e+=(127&(t=this.buffer[this.position+n]))<<7*n,n++}while(t>=128);return this.position+=n,e}},5315:(t,e,n)=>{var r=n(2486).Buffer;function o(t,e){this.buffer=new r(t),this.position=0,this.allowResize=e}function i(t,e){return function(n,r){this.ensureSize(e),t.call(this.buffer,n,this.position,r),this.position+=e}}t.exports=o,o.prototype.writeUInt8=i(r.prototype.writeUInt8,1),o.prototype.writeUInt16LE=i(r.prototype.writeUInt16LE,2),o.prototype.writeUInt16BE=i(r.prototype.writeUInt16BE,2),o.prototype.writeUInt32LE=i(r.prototype.writeUInt32LE,4),o.prototype.writeUInt32BE=i(r.prototype.writeUInt32BE,4),o.prototype.writeInt8=i(r.prototype.writeInt8,1),o.prototype.writeInt16LE=i(r.prototype.writeInt16LE,2),o.prototype.writeInt16BE=i(r.prototype.writeInt16BE,2),o.prototype.writeInt32LE=i(r.prototype.writeInt32LE,4),o.prototype.writeInt32BE=i(r.prototype.writeInt32BE,4),o.prototype.writeFloatLE=i(r.prototype.writeFloatLE,4),o.prototype.writeFloatBE=i(r.prototype.writeFloatBE,4),o.prototype.writeDoubleLE=i(r.prototype.writeDoubleLE,8),o.prototype.writeDoubleBE=i(r.prototype.writeDoubleBE,8),o.prototype.writeBuffer=function(t){this.ensureSize(t.length),t.copy(this.buffer,this.position,0,t.length),this.position+=t.length},o.prototype.writeVarInt=function(t){for(var e=1;0!=(4294967168&t);)this.writeUInt8(127&t|128),t>>>=7,e++;return this.writeUInt8(127&t),e},o.prototype.ensureSize=function(t){if(this.buffer.length<this.position+t){if(!this.allowResize)throw new RangeError("index out of range");var e=new r(this.position+t);this.buffer.copy(e,0,0,this.buffer.length),this.buffer=e}}},63:(t,e,n)=>{var r=n(2486).Buffer;t.exports=g;var o=n(9821),i=n(59),a=n(5519),s=n(4882),l=n(1456),c=n(4602),u=n(3799),p=n(5368),d=n(8009),h=n(5315),f=n(5346),m=n(9893);function g(){this.srid=void 0,this.hasZ=!1,this.hasM=!1}g.parse=function(t,e){if("string"===typeof t||t instanceof f)return g._parseWkt(t);if(r.isBuffer(t)||t instanceof d)return g._parseWkb(t,e);throw new Error("first argument must be a string or Buffer")},g._parseWkt=function(t){var e,n,r=(e=t instanceof f?t:new f(t)).matchRegex([/^SRID=(\d+);/]);r&&(n=parseInt(r[1],10));var d=e.matchType(),h=e.matchDimension(),m={srid:n,hasZ:h.hasZ,hasM:h.hasM};switch(d){case o.wkt.Point:return i._parseWkt(e,m);case o.wkt.LineString:return a._parseWkt(e,m);case o.wkt.Polygon:return s._parseWkt(e,m);case o.wkt.MultiPoint:return l._parseWkt(e,m);case o.wkt.MultiLineString:return c._parseWkt(e,m);case o.wkt.MultiPolygon:return u._parseWkt(e,m);case o.wkt.GeometryCollection:return p._parseWkt(e,m)}},g._parseWkb=function(t,e){var n,r,h,f={};switch((n=t instanceof d?t:new d(t)).isBigEndian=!n.readInt8(),r=n.readUInt32(),f.hasSrid=536870912==(536870912&r),f.isEwkb=536870912&r||1073741824&r||2147483648&r,f.hasSrid&&(f.srid=n.readUInt32()),f.hasZ=!1,f.hasM=!1,f.isEwkb||e&&e.isEwkb?(2147483648&r&&(f.hasZ=!0),1073741824&r&&(f.hasM=!0),h=15&r):r>=1e3&&r<2e3?(f.hasZ=!0,h=r-1e3):r>=2e3&&r<3e3?(f.hasM=!0,h=r-2e3):r>=3e3&&r<4e3?(f.hasZ=!0,f.hasM=!0,h=r-3e3):h=r,h){case o.wkb.Point:return i._parseWkb(n,f);case o.wkb.LineString:return a._parseWkb(n,f);case o.wkb.Polygon:return s._parseWkb(n,f);case o.wkb.MultiPoint:return l._parseWkb(n,f);case o.wkb.MultiLineString:return c._parseWkb(n,f);case o.wkb.MultiPolygon:return u._parseWkb(n,f);case o.wkb.GeometryCollection:return p._parseWkb(n,f);default:throw new Error("GeometryType "+h+" not supported")}},g.parseTwkb=function(t){var e,n={},r=(e=t instanceof d?t:new d(t)).readUInt8(),h=e.readUInt8(),f=15&r;if(n.precision=m.decode(r>>4),n.precisionFactor=Math.pow(10,n.precision),n.hasBoundingBox=h>>0&1,n.hasSizeAttribute=h>>1&1,n.hasIdList=h>>2&1,n.hasExtendedPrecision=h>>3&1,n.isEmpty=h>>4&1,n.hasExtendedPrecision){var g=e.readUInt8();n.hasZ=1==(1&g),n.hasM=2==(2&g),n.zPrecision=m.decode((28&g)>>2),n.zPrecisionFactor=Math.pow(10,n.zPrecision),n.mPrecision=m.decode((224&g)>>5),n.mPrecisionFactor=Math.pow(10,n.mPrecision)}else n.hasZ=!1,n.hasM=!1;if(n.hasSizeAttribute&&e.readVarInt(),n.hasBoundingBox){var y=2;n.hasZ&&y++,n.hasM&&y++;for(var v=0;v<y;v++)e.readVarInt(),e.readVarInt()}switch(f){case o.wkb.Point:return i._parseTwkb(e,n);case o.wkb.LineString:return a._parseTwkb(e,n);case o.wkb.Polygon:return s._parseTwkb(e,n);case o.wkb.MultiPoint:return l._parseTwkb(e,n);case o.wkb.MultiLineString:return c._parseTwkb(e,n);case o.wkb.MultiPolygon:return u._parseTwkb(e,n);case o.wkb.GeometryCollection:return p._parseTwkb(e,n);default:throw new Error("GeometryType "+f+" not supported")}},g.parseGeoJSON=function(t){return g._parseGeoJSON(t)},g._parseGeoJSON=function(t,e){var n;switch(t.type){case o.geoJSON.Point:n=i._parseGeoJSON(t);break;case o.geoJSON.LineString:n=a._parseGeoJSON(t);break;case o.geoJSON.Polygon:n=s._parseGeoJSON(t);break;case o.geoJSON.MultiPoint:n=l._parseGeoJSON(t);break;case o.geoJSON.MultiLineString:n=c._parseGeoJSON(t);break;case o.geoJSON.MultiPolygon:n=u._parseGeoJSON(t);break;case o.geoJSON.GeometryCollection:n=p._parseGeoJSON(t);break;default:throw new Error("GeometryType "+t.type+" not supported")}if(t.crs&&t.crs.type&&"name"===t.crs.type&&t.crs.properties&&t.crs.properties.name){var r=t.crs.properties.name;if(0===r.indexOf("EPSG:"))n.srid=parseInt(r.substring(5));else{if(0!==r.indexOf("urn:ogc:def:crs:EPSG::"))throw new Error("Unsupported crs: "+r);n.srid=parseInt(r.substring(22))}}else e||(n.srid=4326);return n},g.prototype.toEwkt=function(){return"SRID="+this.srid+";"+this.toWkt()},g.prototype.toEwkb=function(){var t=new h(this._getWkbSize()+4),e=this.toWkb();return t.writeInt8(1),t.writeUInt32LE((536870912|e.slice(1,5).readUInt32LE(0))>>>0,!0),t.writeUInt32LE(this.srid),t.writeBuffer(e.slice(5)),t.buffer},g.prototype._getWktType=function(t,e){var n=t;return this.hasZ&&this.hasM?n+=" ZM ":this.hasZ?n+=" Z ":this.hasM&&(n+=" M "),!e||this.hasZ||this.hasM||(n+=" "),e&&(n+="EMPTY"),n},g.prototype._getWktCoordinate=function(t){var e=t.x+" "+t.y;return this.hasZ&&(e+=" "+t.z),this.hasM&&(e+=" "+t.m),e},g.prototype._writeWkbType=function(t,e,n){var r=0;void 0!==this.srid||n&&void 0!==n.srid?(this.hasZ&&(r|=2147483648),this.hasM&&(r|=1073741824)):this.hasZ&&this.hasM?r+=3e3:this.hasZ?r+=1e3:this.hasM&&(r+=2e3),t.writeUInt32LE(r+e>>>0,!0)},g.getTwkbPrecision=function(t,e,n){return{xy:t,z:e,m:n,xyFactor:Math.pow(10,t),zFactor:Math.pow(10,e),mFactor:Math.pow(10,n)}},g.prototype._writeTwkbHeader=function(t,e,n,r){var o=(m.encode(n.xy)<<4)+e,i=(this.hasZ||this.hasM)<<3;if(i+=r<<4,t.writeUInt8(o),t.writeUInt8(i),this.hasZ||this.hasM){var a=0;this.hasZ&&(a|=1),this.hasM&&(a|=2),t.writeUInt8(a)}},g.prototype.toGeoJSON=function(t){var e={};return this.srid&&t&&(t.shortCrs?e.crs={type:"name",properties:{name:"EPSG:"+this.srid}}:t.longCrs&&(e.crs={type:"name",properties:{name:"urn:ogc:def:crs:EPSG::"+this.srid}})),e}},5368:(t,e,n)=>{t.exports=s;var r=n(5663),o=n(9821),i=n(63),a=n(5315);function s(t,e){i.call(this),this.geometries=t||[],this.srid=e,this.geometries.length>0&&(this.hasZ=this.geometries[0].hasZ,this.hasM=this.geometries[0].hasM)}r.inherits(s,i),s.Z=function(t,e){var n=new s(t,e);return n.hasZ=!0,n},s.M=function(t,e){var n=new s(t,e);return n.hasM=!0,n},s.ZM=function(t,e){var n=new s(t,e);return n.hasZ=!0,n.hasM=!0,n},s._parseWkt=function(t,e){var n=new s;if(n.srid=e.srid,n.hasZ=e.hasZ,n.hasM=e.hasM,t.isMatch(["EMPTY"]))return n;t.expectGroupStart();do{n.geometries.push(i.parse(t))}while(t.isMatch([","]));return t.expectGroupEnd(),n},s._parseWkb=function(t,e){var n=new s;n.srid=e.srid,n.hasZ=e.hasZ,n.hasM=e.hasM;for(var r=t.readUInt32(),o=0;o<r;o++)n.geometries.push(i.parse(t,e));return n},s._parseTwkb=function(t,e){var n=new s;if(n.hasZ=e.hasZ,n.hasM=e.hasM,e.isEmpty)return n;for(var r=t.readVarInt(),o=0;o<r;o++)n.geometries.push(i.parseTwkb(t));return n},s._parseGeoJSON=function(t){for(var e=new s,n=0;n<t.geometries.length;n++)e.geometries.push(i._parseGeoJSON(t.geometries[n],!0));return e.geometries.length>0&&(e.hasZ=e.geometries[0].hasZ),e},s.prototype.toWkt=function(){if(0===this.geometries.length)return this._getWktType(o.wkt.GeometryCollection,!0);for(var t=this._getWktType(o.wkt.GeometryCollection,!1)+"(",e=0;e<this.geometries.length;e++)t+=this.geometries[e].toWkt()+",";return t=t.slice(0,-1),t+=")"},s.prototype.toWkb=function(){var t=new a(this._getWkbSize());t.writeInt8(1),this._writeWkbType(t,o.wkb.GeometryCollection),t.writeUInt32LE(this.geometries.length);for(var e=0;e<this.geometries.length;e++)t.writeBuffer(this.geometries[e].toWkb({srid:this.srid}));return t.buffer},s.prototype.toTwkb=function(){var t=new a(0,!0),e=i.getTwkbPrecision(5,0,0),n=0===this.geometries.length;if(this._writeTwkbHeader(t,o.wkb.GeometryCollection,e,n),this.geometries.length>0){t.writeVarInt(this.geometries.length);for(var r=0;r<this.geometries.length;r++)t.writeBuffer(this.geometries[r].toTwkb())}return t.buffer},s.prototype._getWkbSize=function(){for(var t=9,e=0;e<this.geometries.length;e++)t+=this.geometries[e]._getWkbSize();return t},s.prototype.toGeoJSON=function(t){var e=i.prototype.toGeoJSON.call(this,t);e.type=o.geoJSON.GeometryCollection,e.geometries=[];for(var n=0;n<this.geometries.length;n++)e.geometries.push(this.geometries[n].toGeoJSON());return e}},5519:(t,e,n)=>{t.exports=l;var r=n(5663),o=n(63),i=n(9821),a=n(59),s=n(5315);function l(t,e){o.call(this),this.points=t||[],this.srid=e,this.points.length>0&&(this.hasZ=this.points[0].hasZ,this.hasM=this.points[0].hasM)}r.inherits(l,o),l.Z=function(t,e){var n=new l(t,e);return n.hasZ=!0,n},l.M=function(t,e){var n=new l(t,e);return n.hasM=!0,n},l.ZM=function(t,e){var n=new l(t,e);return n.hasZ=!0,n.hasM=!0,n},l._parseWkt=function(t,e){var n=new l;return n.srid=e.srid,n.hasZ=e.hasZ,n.hasM=e.hasM,t.isMatch(["EMPTY"])||(t.expectGroupStart(),n.points.push.apply(n.points,t.matchCoordinates(e)),t.expectGroupEnd()),n},l._parseWkb=function(t,e){var n=new l;n.srid=e.srid,n.hasZ=e.hasZ,n.hasM=e.hasM;for(var r=t.readUInt32(),o=0;o<r;o++)n.points.push(a._readWkbPoint(t,e));return n},l._parseTwkb=function(t,e){var n=new l;if(n.hasZ=e.hasZ,n.hasM=e.hasM,e.isEmpty)return n;for(var r=new a(0,0,e.hasZ?0:void 0,e.hasM?0:void 0),o=t.readVarInt(),i=0;i<o;i++)n.points.push(a._readTwkbPoint(t,e,r));return n},l._parseGeoJSON=function(t){var e=new l;t.coordinates.length>0&&(e.hasZ=t.coordinates[0].length>2);for(var n=0;n<t.coordinates.length;n++)e.points.push(a._readGeoJSONPoint(t.coordinates[n]));return e},l.prototype.toWkt=function(){return 0===this.points.length?this._getWktType(i.wkt.LineString,!0):this._getWktType(i.wkt.LineString,!1)+this._toInnerWkt()},l.prototype._toInnerWkt=function(){for(var t="(",e=0;e<this.points.length;e++)t+=this._getWktCoordinate(this.points[e])+",";return t=t.slice(0,-1),t+=")"},l.prototype.toWkb=function(t){var e=new s(this._getWkbSize());e.writeInt8(1),this._writeWkbType(e,i.wkb.LineString,t),e.writeUInt32LE(this.points.length);for(var n=0;n<this.points.length;n++)this.points[n]._writeWkbPoint(e);return e.buffer},l.prototype.toTwkb=function(){var t=new s(0,!0),e=o.getTwkbPrecision(5,0,0),n=0===this.points.length;if(this._writeTwkbHeader(t,i.wkb.LineString,e,n),this.points.length>0){t.writeVarInt(this.points.length);for(var r=new a(0,0,0,0),l=0;l<this.points.length;l++)this.points[l]._writeTwkbPoint(t,e,r)}return t.buffer},l.prototype._getWkbSize=function(){var t=16;return this.hasZ&&(t+=8),this.hasM&&(t+=8),9+this.points.length*t},l.prototype.toGeoJSON=function(t){var e=o.prototype.toGeoJSON.call(this,t);e.type=i.geoJSON.LineString,e.coordinates=[];for(var n=0;n<this.points.length;n++)this.hasZ?e.coordinates.push([this.points[n].x,this.points[n].y,this.points[n].z]):e.coordinates.push([this.points[n].x,this.points[n].y]);return e}},4602:(t,e,n)=>{t.exports=c;var r=n(5663),o=n(9821),i=n(63),a=n(59),s=n(5519),l=n(5315);function c(t,e){i.call(this),this.lineStrings=t||[],this.srid=e,this.lineStrings.length>0&&(this.hasZ=this.lineStrings[0].hasZ,this.hasM=this.lineStrings[0].hasM)}r.inherits(c,i),c.Z=function(t,e){var n=new c(t,e);return n.hasZ=!0,n},c.M=function(t,e){var n=new c(t,e);return n.hasM=!0,n},c.ZM=function(t,e){var n=new c(t,e);return n.hasZ=!0,n.hasM=!0,n},c._parseWkt=function(t,e){var n=new c;if(n.srid=e.srid,n.hasZ=e.hasZ,n.hasM=e.hasM,t.isMatch(["EMPTY"]))return n;t.expectGroupStart();do{t.expectGroupStart(),n.lineStrings.push(new s(t.matchCoordinates(e))),t.expectGroupEnd()}while(t.isMatch([","]));return t.expectGroupEnd(),n},c._parseWkb=function(t,e){var n=new c;n.srid=e.srid,n.hasZ=e.hasZ,n.hasM=e.hasM;for(var r=t.readUInt32(),o=0;o<r;o++)n.lineStrings.push(i.parse(t,e));return n},c._parseTwkb=function(t,e){var n=new c;if(n.hasZ=e.hasZ,n.hasM=e.hasM,e.isEmpty)return n;for(var r=new a(0,0,e.hasZ?0:void 0,e.hasM?0:void 0),o=t.readVarInt(),i=0;i<o;i++){var l=new s;l.hasZ=e.hasZ,l.hasM=e.hasM;for(var u=t.readVarInt(),p=0;p<u;p++)l.points.push(a._readTwkbPoint(t,e,r));n.lineStrings.push(l)}return n},c._parseGeoJSON=function(t){var e=new c;t.coordinates.length>0&&t.coordinates[0].length>0&&(e.hasZ=t.coordinates[0][0].length>2);for(var n=0;n<t.coordinates.length;n++)e.lineStrings.push(s._parseGeoJSON({coordinates:t.coordinates[n]}));return e},c.prototype.toWkt=function(){if(0===this.lineStrings.length)return this._getWktType(o.wkt.MultiLineString,!0);for(var t=this._getWktType(o.wkt.MultiLineString,!1)+"(",e=0;e<this.lineStrings.length;e++)t+=this.lineStrings[e]._toInnerWkt()+",";return t=t.slice(0,-1),t+=")"},c.prototype.toWkb=function(){var t=new l(this._getWkbSize());t.writeInt8(1),this._writeWkbType(t,o.wkb.MultiLineString),t.writeUInt32LE(this.lineStrings.length);for(var e=0;e<this.lineStrings.length;e++)t.writeBuffer(this.lineStrings[e].toWkb({srid:this.srid}));return t.buffer},c.prototype.toTwkb=function(){var t=new l(0,!0),e=i.getTwkbPrecision(5,0,0),n=0===this.lineStrings.length;if(this._writeTwkbHeader(t,o.wkb.MultiLineString,e,n),this.lineStrings.length>0){t.writeVarInt(this.lineStrings.length);for(var r=new a(0,0,0,0),s=0;s<this.lineStrings.length;s++){t.writeVarInt(this.lineStrings[s].points.length);for(var c=0;c<this.lineStrings[s].points.length;c++)this.lineStrings[s].points[c]._writeTwkbPoint(t,e,r)}}return t.buffer},c.prototype._getWkbSize=function(){for(var t=9,e=0;e<this.lineStrings.length;e++)t+=this.lineStrings[e]._getWkbSize();return t},c.prototype.toGeoJSON=function(t){var e=i.prototype.toGeoJSON.call(this,t);e.type=o.geoJSON.MultiLineString,e.coordinates=[];for(var n=0;n<this.lineStrings.length;n++)e.coordinates.push(this.lineStrings[n].toGeoJSON().coordinates);return e}},1456:(t,e,n)=>{t.exports=l;var r=n(5663),o=n(9821),i=n(63),a=n(59),s=n(5315);function l(t,e){i.call(this),this.points=t||[],this.srid=e,this.points.length>0&&(this.hasZ=this.points[0].hasZ,this.hasM=this.points[0].hasM)}r.inherits(l,i),l.Z=function(t,e){var n=new l(t,e);return n.hasZ=!0,n},l.M=function(t,e){var n=new l(t,e);return n.hasM=!0,n},l.ZM=function(t,e){var n=new l(t,e);return n.hasZ=!0,n.hasM=!0,n},l._parseWkt=function(t,e){var n=new l;return n.srid=e.srid,n.hasZ=e.hasZ,n.hasM=e.hasM,t.isMatch(["EMPTY"])||(t.expectGroupStart(),n.points.push.apply(n.points,t.matchCoordinates(e)),t.expectGroupEnd()),n},l._parseWkb=function(t,e){var n=new l;n.srid=e.srid,n.hasZ=e.hasZ,n.hasM=e.hasM;for(var r=t.readUInt32(),o=0;o<r;o++)n.points.push(i.parse(t,e));return n},l._parseTwkb=function(t,e){var n=new l;if(n.hasZ=e.hasZ,n.hasM=e.hasM,e.isEmpty)return n;for(var r=new a(0,0,e.hasZ?0:void 0,e.hasM?0:void 0),o=t.readVarInt(),i=0;i<o;i++)n.points.push(a._readTwkbPoint(t,e,r));return n},l._parseGeoJSON=function(t){var e=new l;t.coordinates.length>0&&(e.hasZ=t.coordinates[0].length>2);for(var n=0;n<t.coordinates.length;n++)e.points.push(a._parseGeoJSON({coordinates:t.coordinates[n]}));return e},l.prototype.toWkt=function(){if(0===this.points.length)return this._getWktType(o.wkt.MultiPoint,!0);for(var t=this._getWktType(o.wkt.MultiPoint,!1)+"(",e=0;e<this.points.length;e++)t+=this._getWktCoordinate(this.points[e])+",";return t=t.slice(0,-1),t+=")"},l.prototype.toWkb=function(){var t=new s(this._getWkbSize());t.writeInt8(1),this._writeWkbType(t,o.wkb.MultiPoint),t.writeUInt32LE(this.points.length);for(var e=0;e<this.points.length;e++)t.writeBuffer(this.points[e].toWkb({srid:this.srid}));return t.buffer},l.prototype.toTwkb=function(){var t=new s(0,!0),e=i.getTwkbPrecision(5,0,0),n=0===this.points.length;if(this._writeTwkbHeader(t,o.wkb.MultiPoint,e,n),this.points.length>0){t.writeVarInt(this.points.length);for(var r=new a(0,0,0,0),l=0;l<this.points.length;l++)this.points[l]._writeTwkbPoint(t,e,r)}return t.buffer},l.prototype._getWkbSize=function(){var t=16;return this.hasZ&&(t+=8),this.hasM&&(t+=8),t+=5,9+this.points.length*t},l.prototype.toGeoJSON=function(t){var e=i.prototype.toGeoJSON.call(this,t);e.type=o.geoJSON.MultiPoint,e.coordinates=[];for(var n=0;n<this.points.length;n++)e.coordinates.push(this.points[n].toGeoJSON().coordinates);return e}},3799:(t,e,n)=>{t.exports=c;var r=n(5663),o=n(9821),i=n(63),a=n(59),s=n(4882),l=n(5315);function c(t,e){i.call(this),this.polygons=t||[],this.srid=e,this.polygons.length>0&&(this.hasZ=this.polygons[0].hasZ,this.hasM=this.polygons[0].hasM)}r.inherits(c,i),c.Z=function(t,e){var n=new c(t,e);return n.hasZ=!0,n},c.M=function(t,e){var n=new c(t,e);return n.hasM=!0,n},c.ZM=function(t,e){var n=new c(t,e);return n.hasZ=!0,n.hasM=!0,n},c._parseWkt=function(t,e){var n=new c;if(n.srid=e.srid,n.hasZ=e.hasZ,n.hasM=e.hasM,t.isMatch(["EMPTY"]))return n;t.expectGroupStart();do{t.expectGroupStart();var r=[],o=[];for(t.expectGroupStart(),r.push.apply(r,t.matchCoordinates(e)),t.expectGroupEnd();t.isMatch([","]);)t.expectGroupStart(),o.push(t.matchCoordinates(e)),t.expectGroupEnd();n.polygons.push(new s(r,o)),t.expectGroupEnd()}while(t.isMatch([","]));return t.expectGroupEnd(),n},c._parseWkb=function(t,e){var n=new c;n.srid=e.srid,n.hasZ=e.hasZ,n.hasM=e.hasM;for(var r=t.readUInt32(),o=0;o<r;o++)n.polygons.push(i.parse(t,e));return n},c._parseTwkb=function(t,e){var n=new c;if(n.hasZ=e.hasZ,n.hasM=e.hasM,e.isEmpty)return n;for(var r=new a(0,0,e.hasZ?0:void 0,e.hasM?0:void 0),o=t.readVarInt(),i=0;i<o;i++){var l=new s;l.hasZ=e.hasZ,l.hasM=e.hasM;for(var u=t.readVarInt(),p=t.readVarInt(),d=0;d<p;d++)l.exteriorRing.push(a._readTwkbPoint(t,e,r));for(d=1;d<u;d++){for(var h=[],f=t.readVarInt(),m=0;m<f;m++)h.push(a._readTwkbPoint(t,e,r));l.interiorRings.push(h)}n.polygons.push(l)}return n},c._parseGeoJSON=function(t){var e=new c;t.coordinates.length>0&&t.coordinates[0].length>0&&t.coordinates[0][0].length>0&&(e.hasZ=t.coordinates[0][0][0].length>2);for(var n=0;n<t.coordinates.length;n++)e.polygons.push(s._parseGeoJSON({coordinates:t.coordinates[n]}));return e},c.prototype.toWkt=function(){if(0===this.polygons.length)return this._getWktType(o.wkt.MultiPolygon,!0);for(var t=this._getWktType(o.wkt.MultiPolygon,!1)+"(",e=0;e<this.polygons.length;e++)t+=this.polygons[e]._toInnerWkt()+",";return t=t.slice(0,-1),t+=")"},c.prototype.toWkb=function(){var t=new l(this._getWkbSize());t.writeInt8(1),this._writeWkbType(t,o.wkb.MultiPolygon),t.writeUInt32LE(this.polygons.length);for(var e=0;e<this.polygons.length;e++)t.writeBuffer(this.polygons[e].toWkb({srid:this.srid}));return t.buffer},c.prototype.toTwkb=function(){var t=new l(0,!0),e=i.getTwkbPrecision(5,0,0),n=0===this.polygons.length;if(this._writeTwkbHeader(t,o.wkb.MultiPolygon,e,n),this.polygons.length>0){t.writeVarInt(this.polygons.length);for(var r=new a(0,0,0,0),s=0;s<this.polygons.length;s++){t.writeVarInt(1+this.polygons[s].interiorRings.length),t.writeVarInt(this.polygons[s].exteriorRing.length);for(var c=0;c<this.polygons[s].exteriorRing.length;c++)this.polygons[s].exteriorRing[c]._writeTwkbPoint(t,e,r);for(c=0;c<this.polygons[s].interiorRings.length;c++){t.writeVarInt(this.polygons[s].interiorRings[c].length);for(var u=0;u<this.polygons[s].interiorRings[c].length;u++)this.polygons[s].interiorRings[c][u]._writeTwkbPoint(t,e,r)}}}return t.buffer},c.prototype._getWkbSize=function(){for(var t=9,e=0;e<this.polygons.length;e++)t+=this.polygons[e]._getWkbSize();return t},c.prototype.toGeoJSON=function(t){var e=i.prototype.toGeoJSON.call(this,t);e.type=o.geoJSON.MultiPolygon,e.coordinates=[];for(var n=0;n<this.polygons.length;n++)e.coordinates.push(this.polygons[n].toGeoJSON().coordinates);return e}},59:(t,e,n)=>{t.exports=l;var r=n(5663),o=n(63),i=n(9821),a=n(5315),s=n(9893);function l(t,e,n,r,i){o.call(this),this.x=t,this.y=e,this.z=n,this.m=r,this.srid=i,this.hasZ=void 0!==this.z,this.hasM=void 0!==this.m}r.inherits(l,o),l.Z=function(t,e,n,r){var o=new l(t,e,n,void 0,r);return o.hasZ=!0,o},l.M=function(t,e,n,r){var o=new l(t,e,void 0,n,r);return o.hasM=!0,o},l.ZM=function(t,e,n,r,o){var i=new l(t,e,n,r,o);return i.hasZ=!0,i.hasM=!0,i},l._parseWkt=function(t,e){var n=new l;if(n.srid=e.srid,n.hasZ=e.hasZ,n.hasM=e.hasM,t.isMatch(["EMPTY"]))return n;t.expectGroupStart();var r=t.matchCoordinate(e);return n.x=r.x,n.y=r.y,n.z=r.z,n.m=r.m,t.expectGroupEnd(),n},l._parseWkb=function(t,e){var n=l._readWkbPoint(t,e);return n.srid=e.srid,n},l._readWkbPoint=function(t,e){return new l(t.readDouble(),t.readDouble(),e.hasZ?t.readDouble():void 0,e.hasM?t.readDouble():void 0)},l._parseTwkb=function(t,e){var n=new l;return n.hasZ=e.hasZ,n.hasM=e.hasM,e.isEmpty||(n.x=s.decode(t.readVarInt())/e.precisionFactor,n.y=s.decode(t.readVarInt())/e.precisionFactor,n.z=e.hasZ?s.decode(t.readVarInt())/e.zPrecisionFactor:void 0,n.m=e.hasM?s.decode(t.readVarInt())/e.mPrecisionFactor:void 0),n},l._readTwkbPoint=function(t,e,n){return n.x+=s.decode(t.readVarInt())/e.precisionFactor,n.y+=s.decode(t.readVarInt())/e.precisionFactor,e.hasZ&&(n.z+=s.decode(t.readVarInt())/e.zPrecisionFactor),e.hasM&&(n.m+=s.decode(t.readVarInt())/e.mPrecisionFactor),new l(n.x,n.y,n.z,n.m)},l._parseGeoJSON=function(t){return l._readGeoJSONPoint(t.coordinates)},l._readGeoJSONPoint=function(t){return 0===t.length?new l:t.length>2?new l(t[0],t[1],t[2]):new l(t[0],t[1])},l.prototype.toWkt=function(){return void 0===this.x&&void 0===this.y&&void 0===this.z&&void 0===this.m?this._getWktType(i.wkt.Point,!0):this._getWktType(i.wkt.Point,!1)+"("+this._getWktCoordinate(this)+")"},l.prototype.toWkb=function(t){var e=new a(this._getWkbSize());return e.writeInt8(1),this._writeWkbType(e,i.wkb.Point,t),void 0===this.x&&void 0===this.y?(e.writeDoubleLE(NaN),e.writeDoubleLE(NaN),this.hasZ&&e.writeDoubleLE(NaN),this.hasM&&e.writeDoubleLE(NaN)):this._writeWkbPoint(e),e.buffer},l.prototype._writeWkbPoint=function(t){t.writeDoubleLE(this.x),t.writeDoubleLE(this.y),this.hasZ&&t.writeDoubleLE(this.z),this.hasM&&t.writeDoubleLE(this.m)},l.prototype.toTwkb=function(){var t=new a(0,!0),e=o.getTwkbPrecision(5,0,0),n=void 0===this.x&&void 0===this.y;return this._writeTwkbHeader(t,i.wkb.Point,e,n),n||this._writeTwkbPoint(t,e,new l(0,0,0,0)),t.buffer},l.prototype._writeTwkbPoint=function(t,e,n){var r=this.x*e.xyFactor,o=this.y*e.xyFactor,i=this.z*e.zFactor,a=this.m*e.mFactor;t.writeVarInt(s.encode(r-n.x)),t.writeVarInt(s.encode(o-n.y)),this.hasZ&&t.writeVarInt(s.encode(i-n.z)),this.hasM&&t.writeVarInt(s.encode(a-n.m)),n.x=r,n.y=o,n.z=i,n.m=a},l.prototype._getWkbSize=function(){var t=21;return this.hasZ&&(t+=8),this.hasM&&(t+=8),t},l.prototype.toGeoJSON=function(t){var e=o.prototype.toGeoJSON.call(this,t);return e.type=i.geoJSON.Point,void 0===this.x&&void 0===this.y?e.coordinates=[]:void 0!==this.z?e.coordinates=[this.x,this.y,this.z]:e.coordinates=[this.x,this.y],e}},4882:(t,e,n)=>{t.exports=l;var r=n(5663),o=n(63),i=n(9821),a=n(59),s=n(5315);function l(t,e,n){o.call(this),this.exteriorRing=t||[],this.interiorRings=e||[],this.srid=n,this.exteriorRing.length>0&&(this.hasZ=this.exteriorRing[0].hasZ,this.hasM=this.exteriorRing[0].hasM)}r.inherits(l,o),l.Z=function(t,e,n){var r=new l(t,e,n);return r.hasZ=!0,r},l.M=function(t,e,n){var r=new l(t,e,n);return r.hasM=!0,r},l.ZM=function(t,e,n){var r=new l(t,e,n);return r.hasZ=!0,r.hasM=!0,r},l._parseWkt=function(t,e){var n=new l;if(n.srid=e.srid,n.hasZ=e.hasZ,n.hasM=e.hasM,t.isMatch(["EMPTY"]))return n;for(t.expectGroupStart(),t.expectGroupStart(),n.exteriorRing.push.apply(n.exteriorRing,t.matchCoordinates(e)),t.expectGroupEnd();t.isMatch([","]);)t.expectGroupStart(),n.interiorRings.push(t.matchCoordinates(e)),t.expectGroupEnd();return t.expectGroupEnd(),n},l._parseWkb=function(t,e){var n=new l;n.srid=e.srid,n.hasZ=e.hasZ,n.hasM=e.hasM;var r=t.readUInt32();if(r>0){for(var o=t.readUInt32(),i=0;i<o;i++)n.exteriorRing.push(a._readWkbPoint(t,e));for(i=1;i<r;i++){for(var s=[],c=t.readUInt32(),u=0;u<c;u++)s.push(a._readWkbPoint(t,e));n.interiorRings.push(s)}}return n},l._parseTwkb=function(t,e){var n=new l;if(n.hasZ=e.hasZ,n.hasM=e.hasM,e.isEmpty)return n;for(var r=new a(0,0,e.hasZ?0:void 0,e.hasM?0:void 0),o=t.readVarInt(),i=t.readVarInt(),s=0;s<i;s++)n.exteriorRing.push(a._readTwkbPoint(t,e,r));for(s=1;s<o;s++){for(var c=[],u=t.readVarInt(),p=0;p<u;p++)c.push(a._readTwkbPoint(t,e,r));n.interiorRings.push(c)}return n},l._parseGeoJSON=function(t){var e=new l;t.coordinates.length>0&&t.coordinates[0].length>0&&(e.hasZ=t.coordinates[0][0].length>2);for(var n=0;n<t.coordinates.length;n++){n>0&&e.interiorRings.push([]);for(var r=0;r<t.coordinates[n].length;r++)0===n?e.exteriorRing.push(a._readGeoJSONPoint(t.coordinates[n][r])):e.interiorRings[n-1].push(a._readGeoJSONPoint(t.coordinates[n][r]))}return e},l.prototype.toWkt=function(){return 0===this.exteriorRing.length?this._getWktType(i.wkt.Polygon,!0):this._getWktType(i.wkt.Polygon,!1)+this._toInnerWkt()},l.prototype._toInnerWkt=function(){for(var t="((",e=0;e<this.exteriorRing.length;e++)t+=this._getWktCoordinate(this.exteriorRing[e])+",";for(t=t.slice(0,-1),t+=")",e=0;e<this.interiorRings.length;e++){t+=",(";for(var n=0;n<this.interiorRings[e].length;n++)t+=this._getWktCoordinate(this.interiorRings[e][n])+",";t=t.slice(0,-1),t+=")"}return t+=")"},l.prototype.toWkb=function(t){var e=new s(this._getWkbSize());e.writeInt8(1),this._writeWkbType(e,i.wkb.Polygon,t),this.exteriorRing.length>0?(e.writeUInt32LE(1+this.interiorRings.length),e.writeUInt32LE(this.exteriorRing.length)):e.writeUInt32LE(0);for(var n=0;n<this.exteriorRing.length;n++)this.exteriorRing[n]._writeWkbPoint(e);for(n=0;n<this.interiorRings.length;n++){e.writeUInt32LE(this.interiorRings[n].length);for(var r=0;r<this.interiorRings[n].length;r++)this.interiorRings[n][r]._writeWkbPoint(e)}return e.buffer},l.prototype.toTwkb=function(){var t=new s(0,!0),e=o.getTwkbPrecision(5,0,0),n=0===this.exteriorRing.length;if(this._writeTwkbHeader(t,i.wkb.Polygon,e,n),this.exteriorRing.length>0){t.writeVarInt(1+this.interiorRings.length),t.writeVarInt(this.exteriorRing.length);for(var r=new a(0,0,0,0),l=0;l<this.exteriorRing.length;l++)this.exteriorRing[l]._writeTwkbPoint(t,e,r);for(l=0;l<this.interiorRings.length;l++){t.writeVarInt(this.interiorRings[l].length);for(var c=0;c<this.interiorRings[l].length;c++)this.interiorRings[l][c]._writeTwkbPoint(t,e,r)}}return t.buffer},l.prototype._getWkbSize=function(){var t=16;this.hasZ&&(t+=8),this.hasM&&(t+=8);var e=9;this.exteriorRing.length>0&&(e+=4+this.exteriorRing.length*t);for(var n=0;n<this.interiorRings.length;n++)e+=4+this.interiorRings[n].length*t;return e},l.prototype.toGeoJSON=function(t){var e=o.prototype.toGeoJSON.call(this,t);if(e.type=i.geoJSON.Polygon,e.coordinates=[],this.exteriorRing.length>0){for(var n=[],r=0;r<this.exteriorRing.length;r++)this.hasZ?n.push([this.exteriorRing[r].x,this.exteriorRing[r].y,this.exteriorRing[r].z]):n.push([this.exteriorRing[r].x,this.exteriorRing[r].y]);e.coordinates.push(n)}for(var a=0;a<this.interiorRings.length;a++){for(var s=[],l=0;l<this.interiorRings[a].length;l++)this.hasZ?s.push([this.interiorRings[a][l].x,this.interiorRings[a][l].y,this.interiorRings[a][l].z]):s.push([this.interiorRings[a][l].x,this.interiorRings[a][l].y]);e.coordinates.push(s)}return e}},9821:t=>{t.exports={wkt:{Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION"},wkb:{Point:1,LineString:2,Polygon:3,MultiPoint:4,MultiLineString:5,MultiPolygon:6,GeometryCollection:7},geoJSON:{Point:"Point",LineString:"LineString",Polygon:"Polygon",MultiPoint:"MultiPoint",MultiLineString:"MultiLineString",MultiPolygon:"MultiPolygon",GeometryCollection:"GeometryCollection"}}},5346:(t,e,n)=>{t.exports=i;var r=n(9821),o=n(59);function i(t){this.value=t,this.position=0}i.prototype.match=function(t){this.skipWhitespaces();for(var e=0;e<t.length;e++)if(0===this.value.substring(this.position).indexOf(t[e]))return this.position+=t[e].length,t[e];return null},i.prototype.matchRegex=function(t){this.skipWhitespaces();for(var e=0;e<t.length;e++){var n=this.value.substring(this.position).match(t[e]);if(n)return this.position+=n[0].length,n}return null},i.prototype.isMatch=function(t){this.skipWhitespaces();for(var e=0;e<t.length;e++)if(0===this.value.substring(this.position).indexOf(t[e]))return this.position+=t[e].length,!0;return!1},i.prototype.matchType=function(){var t=this.match([r.wkt.Point,r.wkt.LineString,r.wkt.Polygon,r.wkt.MultiPoint,r.wkt.MultiLineString,r.wkt.MultiPolygon,r.wkt.GeometryCollection]);if(!t)throw new Error("Expected geometry type");return t},i.prototype.matchDimension=function(){switch(this.match(["ZM","Z","M"])){case"ZM":return{hasZ:!0,hasM:!0};case"Z":return{hasZ:!0,hasM:!1};case"M":return{hasZ:!1,hasM:!0};default:return{hasZ:!1,hasM:!1}}},i.prototype.expectGroupStart=function(){if(!this.isMatch(["("]))throw new Error("Expected group start")},i.prototype.expectGroupEnd=function(){if(!this.isMatch([")"]))throw new Error("Expected group end")},i.prototype.matchCoordinate=function(t){var e;if(!(e=t.hasZ&&t.hasM?this.matchRegex([/^(\S*)\s+(\S*)\s+(\S*)\s+([^\s,)]*)/]):t.hasZ||t.hasM?this.matchRegex([/^(\S*)\s+(\S*)\s+([^\s,)]*)/]):this.matchRegex([/^(\S*)\s+([^\s,)]*)/])))throw new Error("Expected coordinates");return t.hasZ&&t.hasM?new o(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])):t.hasZ?new o(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])):t.hasM?new o(parseFloat(e[1]),parseFloat(e[2]),void 0,parseFloat(e[3])):new o(parseFloat(e[1]),parseFloat(e[2]))},i.prototype.matchCoordinates=function(t){var e=[];do{var n=this.isMatch(["("]);e.push(this.matchCoordinate(t)),n&&this.expectGroupEnd()}while(this.isMatch([","]));return e},i.prototype.skipWhitespaces=function(){for(;this.position<this.value.length&&" "===this.value[this.position];)this.position++}},981:(t,e,n)=>{e.Types=n(9821),e.Geometry=n(63),e.Point=n(59),e.LineString=n(5519),e.Polygon=n(4882),e.MultiPoint=n(1456),e.MultiLineString=n(4602),e.MultiPolygon=n(3799),e.GeometryCollection=n(5368)},9893:t=>{t.exports={encode:function(t){return t<<1^t>>31},decode:function(t){return t>>1^-(1&t)}}},1468:(t,e,n)=>{"use strict";n.d(e,{k:()=>a,v:()=>l});var r=n(5361),o=n(2089),i=n(7945);r.Z.Consts=o.Z,r.Z.Util=i.Z;const a=(s={},{imageRatio:1.05,proxy:"",crs:"EPSG:25830",utmCrs:"EPSG:25830",geoCrs:"EPSG:4326",initialExtent:[541084.221,4640788.225,685574.4632,4796618.764],maxExtent:!1,baselayerExtent:[480408,4599748,742552,4861892],resolutions:[1024,512,256,128,64,32,16,8,4,2,1,.5,.25],pointBoundsRadius:30,extentMargin:.2,mouseWheelZoom:!0,attribution:'<a href="http://sitna.navarra.es/" target="_blank">SITNA</a>',oldBrowserAlert:!0,notifyApplicationErrors:!1,loggingErrorsEnabled:!0,maxErrorCount:10,locale:"es-ES",view:r.Z.Consts.view.DEFAULT,screenSize:20,pixelTolerance:10,maxResolutionError:.01,toastDuration:5e3,averageTileSize:31e3,availableBaseLayers:[{id:r.Z.Consts.layer.IDENA_BASEMAP,title:"Mapa base",type:r.Z.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830extended",layerNames:"mapabase",encoding:r.Z.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!0,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-basemap.png",fallbackLayer:r.Z.Consts.layer.IDENA_DYNBASEMAP,overviewMapLayer:r.Z.Consts.layer.IDENA_BASEMAP},{id:r.Z.Consts.layer.IDENA_ORTHOPHOTO,title:"Ortofoto máxima actualidad",type:r.Z.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto_maxima_actualidad",encoding:r.Z.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-orthophoto.jpg",fallbackLayer:r.Z.Consts.layer.IDENA_DYNORTHOPHOTO,overviewMapLayer:r.Z.Consts.layer.IDENA_BASEMAP},{id:r.Z.Consts.layer.IDENA_ORTHOPHOTO2021,title:"Ortofoto 2021",type:r.Z.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2021",encoding:r.Z.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-ortho2021.jpg",fallbackLayer:r.Z.Consts.layer.IDENA_DYNORTHOPHOTO2021,overviewMapLayer:r.Z.Consts.layer.IDENA_BASEMAP},{id:r.Z.Consts.layer.IDENA_ORTHOPHOTO2020,title:"Ortofoto 2020",type:r.Z.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2020",encoding:r.Z.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-ortho2020.jpg",fallbackLayer:r.Z.Consts.layer.IDENA_DYNORTHOPHOTO2020,overviewMapLayer:r.Z.Consts.layer.IDENA_BASEMAP},{id:r.Z.Consts.layer.IDENA_ORTHOPHOTO2019,title:"Ortofoto 2019",type:r.Z.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2019",encoding:r.Z.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-ortho2019.jpg",fallbackLayer:r.Z.Consts.layer.IDENA_DYNORTHOPHOTO2019,overviewMapLayer:r.Z.Consts.layer.IDENA_BASEMAP},{id:r.Z.Consts.layer.IDENA_ORTHOPHOTO2018,title:"Ortofoto 2018",type:r.Z.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2018",encoding:r.Z.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-ortho2018.jpg",fallbackLayer:r.Z.Consts.layer.IDENA_DYNORTHOPHOTO2018,overviewMapLayer:r.Z.Consts.layer.IDENA_BASEMAP},{id:r.Z.Consts.layer.IDENA_ORTHOPHOTO2017,title:"Ortofoto 2017",type:r.Z.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2017",encoding:r.Z.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-ortho2017.jpg",fallbackLayer:r.Z.Consts.layer.IDENA_DYNORTHOPHOTO2017,overviewMapLayer:r.Z.Consts.layer.IDENA_BASEMAP},{id:r.Z.Consts.layer.IDENA_ORTHOPHOTO2014,title:"Ortofoto 2014",type:r.Z.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830reduced",layerNames:"ortofoto2014",encoding:r.Z.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-ortho2014.jpg",fallbackLayer:r.Z.Consts.layer.IDENA_DYNORTHOPHOTO2014,overviewMapLayer:r.Z.Consts.layer.IDENA_BASEMAP},{id:r.Z.Consts.layer.IDENA_ORTHOPHOTO2012,title:"Ortofoto 2012",type:r.Z.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2012",encoding:r.Z.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-ortho2012.jpg",fallbackLayer:r.Z.Consts.layer.IDENA_DYNORTHOPHOTO2012,overviewMapLayer:r.Z.Consts.layer.IDENA_BASEMAP},{id:r.Z.Consts.layer.IDENA_PAMPLONA_ORTHOPHOTO2020,title:"Ortofoto comarca de Pamplona 2020",type:r.Z.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830deep",layerNames:"ortofotoPamplona2020",encoding:r.Z.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-ortho-pamplona2020.jpg",fallbackLayer:r.Z.Consts.layer.IDENA_PAMPLONA_DYNORTHOPHOTO2020,overviewMapLayer:r.Z.Consts.layer.IDENA_BASEMAP},{id:r.Z.Consts.layer.IDENA_CARTO,title:"Cartografía topográfica",type:r.Z.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830extended",layerNames:"mapaTopografico",encoding:r.Z.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-bta.png",fallbackLayer:r.Z.Consts.layer.IDENA_DYNCARTO,overviewMapLayer:r.Z.Consts.layer.IDENA_BASEMAP},{id:r.Z.Consts.layer.IDENA_CADASTER,title:"Catastro",type:r.Z.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"catastro,regionesFronterizas",format:"image/png",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-cadaster.png",overviewMapLayer:r.Z.Consts.layer.IDENA_BASEMAP},{id:r.Z.Consts.layer.IDENA_BW_RELIEF,title:"Relieve",type:r.Z.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"IDENA:mapa_relieve_bn",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-relief_bw.jpg",overviewMapLayer:r.Z.Consts.layer.IDENA_BASEMAP},{id:r.Z.Consts.layer.IDENA_BASEMAP_ORTHOPHOTO,title:"Mapa base/ortofoto",type:r.Z.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"mapaBase_orto",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-base_ortho.png",overviewMapLayer:r.Z.Consts.layer.IDENA_BASEMAP},{id:r.Z.Consts.layer.IDENA_DYNBASEMAP,title:"Mapa base",type:r.Z.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"mapaBase,regionesFronterizas",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-basemap.png",overviewMapLayer:r.Z.Consts.layer.IDENA_DYNBASEMAP},{id:r.Z.Consts.layer.IDENA_DYNORTHOPHOTO,title:"Ortofoto máxima actualidad",type:r.Z.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_maxima_actualidad",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-orthophoto.jpg",overviewMapLayer:r.Z.Consts.layer.IDENA_DYNBASEMAP},{id:r.Z.Consts.layer.IDENA_DYNORTHOPHOTO2021,title:"Ortofoto 2021",type:r.Z.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2021",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-ortho2021.jpg",overviewMapLayer:r.Z.Consts.layer.IDENA_DYNBASEMAP},{id:r.Z.Consts.layer.IDENA_DYNORTHOPHOTO2020,title:"Ortofoto 2020",type:r.Z.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2020",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-ortho2020.jpg",overviewMapLayer:r.Z.Consts.layer.IDENA_DYNBASEMAP},{id:r.Z.Consts.layer.IDENA_DYNORTHOPHOTO2019,title:"Ortofoto 2019",type:r.Z.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2019",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-ortho2019.jpg",overviewMapLayer:r.Z.Consts.layer.IDENA_DYNBASEMAP},{id:r.Z.Consts.layer.IDENA_DYNORTHOPHOTO2018,title:"Ortofoto 2018",type:r.Z.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2018",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-ortho2018.jpg",overviewMapLayer:r.Z.Consts.layer.IDENA_DYNBASEMAP},{id:r.Z.Consts.layer.IDENA_DYNORTHOPHOTO2017,title:"Ortofoto 2017",type:r.Z.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2017",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-ortho2017.jpg",overviewMapLayer:r.Z.Consts.layer.IDENA_DYNBASEMAP},{id:r.Z.Consts.layer.IDENA_DYNORTHOPHOTO2014,title:"Ortofoto 2014",type:r.Z.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2014",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-ortho2014.jpg",overviewMapLayer:r.Z.Consts.layer.IDENA_DYNBASEMAP},{id:r.Z.Consts.layer.IDENA_DYNORTHOPHOTO2012,title:"Ortofoto 2012",type:r.Z.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2012",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-ortho2012.jpg",overviewMapLayer:r.Z.Consts.layer.IDENA_DYNBASEMAP},{id:r.Z.Consts.layer.IDENA_PAMPLONA_DYNORTHOPHOTO2020,title:"Ortofoto comarca de Pamplona 2020",type:r.Z.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_500_Pamplona_2020",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-ortho-pamplona2020.jpg",overviewMapLayer:r.Z.Consts.layer.IDENA_DYNBASEMAP},{id:r.Z.Consts.layer.IDENA_DYNCARTO,title:"Cartografía topográfica 2017",type:r.Z.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"MTNa5_BTA",format:"image/png",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-bta.png",overviewMapLayer:r.Z.Consts.layer.IDENA_DYNBASEMAP},{id:r.Z.Consts.layer.IGN_ES_CARTO,type:r.Z.Consts.layerType.WMTS,title:"Cartografía raster \r\n (IGN ES)",url:"//www.ign.es/wmts/mapa-raster",encoding:r.Z.Consts.WMTSEncoding.KVP,layerNames:"MTN",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:r.Z.apiLocation+"tc/css/img/thumb-carto_ign.png",fallbackLayer:r.Z.Consts.layer.IGN_ES_DYNCARTO,overviewMapLayer:r.Z.Consts.layer.IGN_ES_BASEMAP},{id:r.Z.Consts.layer.IGN_ES_BASEMAP,title:"Callejero \r\n (IGN ES)",type:r.Z.Consts.layerType.WMTS,url:"//www.ign.es/wmts/ign-base",encoding:r.Z.Consts.WMTSEncoding.KVP,layerNames:"IGNBaseTodo",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:r.Z.apiLocation+"tc/css/img/thumb-basemap_ign.png",fallbackLayer:r.Z.Consts.layer.IGN_ES_DYNBASEMAP,overviewMapLayer:r.Z.Consts.layer.IGN_ES_BASEMAP},{id:r.Z.Consts.layer.IGN_ES_BASEMAP_GREY,title:"Callejero gris \r\n (IGN ES)",type:r.Z.Consts.layerType.WMTS,url:"//www.ign.es/wmts/ign-base",encoding:r.Z.Consts.WMTSEncoding.KVP,layerNames:"IGNBase-gris",matrixSet:"GoogleMapsCompatible",format:"image/jpeg",thumbnail:r.Z.apiLocation+"tc/css/img/thumb-basemap_grey_ign.png",fallbackLayer:r.Z.Consts.layer.IGN_ES_DYNBASEMAP_GREY,overviewMapLayer:r.Z.Consts.layer.IGN_ES_BASEMAP},{id:r.Z.Consts.layer.IGN_ES_RELIEF,title:"Relieve \r\n (IGN ES)",type:r.Z.Consts.layerType.WMTS,url:"//servicios.idee.es/wmts/mdt",encoding:r.Z.Consts.WMTSEncoding.KVP,layerNames:"Relieve",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:r.Z.apiLocation+"tc/css/img/thumb-relief_ign.jpg",fallbackLayer:r.Z.Consts.layer.IGN_ES_DYNRELIEF,overviewMapLayer:r.Z.Consts.layer.IGN_ES_BASEMAP},{id:r.Z.Consts.layer.IGN_ES_ORTHOPHOTO,title:"Ortofoto PNOA",type:r.Z.Consts.layerType.WMTS,url:"//www.ign.es/wmts/pnoa-ma",encoding:r.Z.Consts.WMTSEncoding.KVP,layerNames:"OI.OrthoimageCoverage",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:r.Z.apiLocation+"tc/css/img/thumb-orthophoto_pnoa.jpg",fallbackLayer:r.Z.Consts.layer.IGN_ES_DYNORTHOPHOTO,overviewMapLayer:r.Z.Consts.layer.IGN_ES_BASEMAP},{id:r.Z.Consts.layer.IGN_ES_LIDAR,title:"Modelo digital LIDAR (IGN ES)",type:r.Z.Consts.layerType.WMTS,url:"//wmts-mapa-lidar.idee.es/lidar",encoding:r.Z.Consts.WMTSEncoding.KVP,layerNames:"EL.GridCoverageDSM",matrixSet:"GoogleMapsCompatible",format:"image/png",thumbnail:r.Z.apiLocation+"tc/css/img/thumb-lidar_ign.jpg",fallbackLayer:r.Z.Consts.layer.IGN_ES_DYNLIDAR,overviewMapLayer:r.Z.Consts.layer.IGN_ES_BASEMAP},{id:r.Z.Consts.layer.IGN_ES_DYNBASEMAP,title:"Callejero \r\n (IGN ES)",type:r.Z.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/ign-base",layerNames:"IGNBaseTodo",thumbnail:r.Z.apiLocation+"TC/css/img/thumb-basemap_ign.png",overviewMapLayer:r.Z.Consts.layer.IGN_ES_BASEMAP},{id:r.Z.Consts.layer.IGN_ES_DYNBASEMAP_GREY,title:"Callejero gris \r\n (IGN ES)",type:r.Z.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/ign-base",layerNames:"IGNBaseTodo-gris",thumbnail:r.Z.apiLocation+"TC/css/img/thumb-basemap_grey_ign.png",overviewMapLayer:r.Z.Consts.layer.IGN_ES_BASEMAP},{id:r.Z.Consts.layer.IGN_ES_DYNORTHOPHOTO,title:"Ortofoto PNOA",type:r.Z.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/pnoa-ma",layerNames:"OI.OrthoimageCoverage",thumbnail:r.Z.apiLocation+"TC/css/img/thumb-orthophoto_pnoa.jpg",overviewMapLayer:r.Z.Consts.layer.IGN_ES_BASEMAP},{id:r.Z.Consts.layer.IGN_ES_DYNCARTO,title:"Cartografía raster \r\n (IGN ES)",type:r.Z.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/mapa-raster",layerNames:"mtn_rasterizado",thumbnail:r.Z.apiLocation+"TC/css/img/thumb-carto_ign.png",overviewMapLayer:r.Z.Consts.layer.IGN_ES_BASEMAP},{id:r.Z.Consts.layer.IGN_ES_DYNRELIEF,title:"Relieve \r\n (IGN ES)",type:r.Z.Consts.layerType.WMS,url:"//servicios.idee.es/wms-inspire/mdt",layerNames:"EL.GridCoverage",thumbnail:r.Z.apiLocation+"TC/css/img/thumb-relief_ign.jpg",overviewMapLayer:r.Z.Consts.layer.IGN_ES_BASEMAP},{id:r.Z.Consts.layer.IGN_ES_DYNLIDAR,title:"Modelo digital LIDAR (IGN ES)",type:r.Z.Consts.layerType.WMS,url:"//wms-mapa-lidar.idee.es/lidar",layerNames:"EL.GridCoverage",thumbnail:r.Z.apiLocation+"tc/css/img/thumb-lidar_ign.jpg",overviewMapLayer:r.Z.Consts.layer.IGN_ES_BASEMAP},{id:r.Z.Consts.layer.IGN_FR_BASEMAP,title:"Mapa base \r\n (IGN FR)",type:r.Z.Consts.layerType.WMTS,url:"//wxs.ign.fr/essentiels/geoportail/wmts",encoding:r.Z.Consts.WMTSEncoding.KVP,layerNames:"GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2",matrixSet:"PM",format:"image/png",thumbnail:r.Z.apiLocation+"tc/css/img/thumb-base-fr-ign.png",fallbackLayer:r.Z.Consts.layer.IGN_FR_DYNBASEMAP,ignoreProxification:!0,overviewMapLayer:r.Z.Consts.layer.IGN_FR_BASEMAP},{id:r.Z.Consts.layer.IGN_FR_RELIEF,title:"Relieve \r\n (IGN FR)",type:r.Z.Consts.layerType.WMTS,url:"//wxs.ign.fr/altimetrie/geoportail/wmts",encoding:r.Z.Consts.WMTSEncoding.KVP,layerNames:"ELEVATION.ELEVATIONGRIDCOVERAGE.SHADOW",matrixSet:"PM",format:"image/png",thumbnail:r.Z.apiLocation+"tc/css/img/thumb-estom-fr-ign.jpg",fallbackLayer:r.Z.Consts.layer.IGN_FR_DYNRELIEF,ignoreProxification:!0,overviewMapLayer:r.Z.Consts.layer.IGN_FR_BASEMAP},{id:r.Z.Consts.layer.IGN_FR_ORTHOPHOTO,title:"Ortofoto \r\n (IGN FR)",type:r.Z.Consts.layerType.WMTS,url:"//wxs.ign.fr/essentiels/geoportail/wmts",encoding:r.Z.Consts.WMTSEncoding.KVP,layerNames:"ORTHOIMAGERY.ORTHOPHOTOS",matrixSet:"PM",format:"image/jpeg",thumbnail:r.Z.apiLocation+"tc/css/img/thumb-ortho-fr-ign.jpg",fallbackLayer:r.Z.Consts.layer.IGN_FR_DYNORTHOPHOTO,ignoreProxification:!0,overviewMapLayer:r.Z.Consts.layer.IGN_FR_BASEMAP},{id:r.Z.Consts.layer.IGN_FR_DYNBASEMAP,title:"Mapa base \r\n (IGN FR)",type:r.Z.Consts.layerType.WMS,url:"//wxs.ign.fr/essentiels/geoportail/r/wms",layerNames:"GEOGRAPHICALGRIDSYSTEMS.PLANIGN",thumbnail:r.Z.apiLocation+"tc/css/img/thumb-base-fr-ign.png",ignoreProxification:!0,overviewMapLayer:r.Z.Consts.layer.IGN_FR_BASEMAP},{id:r.Z.Consts.layer.IGN_FR_DYNRELIEF,title:"Relieve \r\n (IGN FR)",type:r.Z.Consts.layerType.WMS,url:"//wxs.ign.fr/altimetrie/geoportail/r/wms",layerNames:"ELEVATION.ELEVATIONGRIDCOVERAGE.SHADOW",thumbnail:r.Z.apiLocation+"tc/css/img/thumb-estom-fr-ign.jpg",ignoreProxification:!0,overviewMapLayer:r.Z.Consts.layer.IGN_FR_BASEMAP},{id:r.Z.Consts.layer.IGN_FR_DYNORTHOPHOTO,title:"Ortofoto \r\n (IGN FR)",type:r.Z.Consts.layerType.WMS,url:"//wxs.ign.fr/essentiels/geoportail/r/wms",layerNames:"ORTHOIMAGERY.ORTHOPHOTOS",thumbnail:r.Z.apiLocation+"tc/css/img/thumb-ortho-fr-ign.jpg",ignoreProxification:!0,overviewMapLayer:r.Z.Consts.layer.IGN_FR_BASEMAP},{id:r.Z.Consts.layer.OSM,title:"OSM",type:r.Z.Consts.layerType.WMTS,url:r.Z.apiLocation+"wmts/osm/",matrixSet:"WorldWebMercatorQuad",layerNames:"osm",encoding:r.Z.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-osm.png",overviewMapLayer:r.Z.Consts.layer.OSM},{id:r.Z.Consts.layer.CARTO_VOYAGER,title:"CARTO Voyager",type:r.Z.Consts.layerType.WMTS,url:r.Z.apiLocation+"wmts/carto/",matrixSet:"WorldWebMercatorQuad",layerNames:"voyager",encoding:r.Z.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-carto-voyager.png",overviewMapLayer:r.Z.Consts.layer.CARTO_VOYAGER},{id:r.Z.Consts.layer.CARTO_LIGHT,title:"CARTO light",type:r.Z.Consts.layerType.WMTS,url:r.Z.apiLocation+"wmts/carto/",matrixSet:"WorldWebMercatorQuad",layerNames:"light_all",encoding:r.Z.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-carto-light.png",overviewMapLayer:r.Z.Consts.layer.CARTO_VOYAGER},{id:r.Z.Consts.layer.CARTO_DARK,title:"CARTO dark",type:r.Z.Consts.layerType.WMTS,url:r.Z.apiLocation+"wmts/carto/",matrixSet:"WorldWebMercatorQuad",layerNames:"dark_all",encoding:r.Z.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-carto-dark.png",overviewMapLayer:r.Z.Consts.layer.CARTO_VOYAGER},{id:r.Z.Consts.layer.MAPBOX_STREETS,title:"Mapbox Streets",type:r.Z.Consts.layerType.WMTS,url:r.Z.apiLocation+"wmts/mapbox/",matrixSet:"WorldWebMercatorQuad",layerNames:"streets",encoding:r.Z.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-mapbox-streets.png",overviewMapLayer:r.Z.Consts.layer.MAPBOX_STREETS},{id:r.Z.Consts.layer.MAPBOX_SATELLITE,title:"Mapbox Satellite",type:r.Z.Consts.layerType.WMTS,url:r.Z.apiLocation+"wmts/mapbox/",matrixSet:"WorldWebMercatorQuad",layerNames:"satellite",encoding:r.Z.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:r.Z.apiLocation+"TC/css/img/thumb-mapbox-satellite.jpg",overviewMapLayer:r.Z.Consts.layer.MAPBOX_STREETS},{id:r.Z.Consts.layer.BLANK,title:"Mapa en blanco",type:r.Z.Consts.layerType.VECTOR}],baseLayers:[r.Z.Consts.layer.IDENA_BASEMAP,r.Z.Consts.layer.IDENA_ORTHOPHOTO,r.Z.Consts.layer.IDENA_CADASTER,r.Z.Consts.layer.IDENA_CARTO],defaultBaseLayer:r.Z.Consts.layer.IDENA_BASEMAP,workLayers:[],controls:{loadingIndicator:!0,navBar:!1,scaleBar:!1,scale:!1,scaleSelector:!1,overviewMap:!1,basemapSelector:!1,attribution:!0,TOC:!1,workLayerManager:!1,layerCatalog:!1,coordinates:!0,legend:!1,popup:!1,search:{url:"https://idena.navarra.es/ogc/wfs",allowedSearchTypes:{coordinates:{},municipality:{},urban:{},street:{},number:{},cadastral:{}}},measure:!1,streetView:!1,click:!1,printMap:!1,featureInfo:{active:!0,persistentHighlights:!0},featureTools:!0},layout:null,styles:{point:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#ff0000",strokeWidth:2,strokeOpacity:1,radius:6,labelOutlineWidth:2,labelOutlineColor:"#ffffff",labelOffset:[0,-16],fontColor:"#000000",fontSize:10},marker:{classes:[r.Z.Consts.classes.MARKER+1,r.Z.Consts.classes.MARKER+2,r.Z.Consts.classes.MARKER+3,r.Z.Consts.classes.MARKER+4,r.Z.Consts.classes.MARKER+5],anchor:[.5,1],width:32,height:32,labelOutlineWidth:2,labelOutlineColor:"#ffffff",labelOffset:[0,-32],fontColor:"#000000",fontSize:10},line:{strokeColor:"#ff0000",strokeWidth:2,strokeOpacity:1,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10},polygon:{strokeColor:"#ff0000",strokeWidth:2,strokeOpacity:1,fillColor:"#000000",fillOpacity:.3,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10},label:{strokeColor:"#ffffff",strokeWidth:1,fillColor:"#000000"},cluster:{point:{fillColor:"#333366",fillOpacity:.6,radius:function(t){var e=t.features.length,n=s[e];return n||(n=2+Math.round(5*Math.sqrt(e)),s[e]=n),n},label:"${features.length}",fontColor:"#ffffff",fontSize:9}},selection:{point:{fillColor:"#008000",fillOpacity:.5,strokeColor:"#008000",strokeWidth:2,radius:6,labelOutlineWidth:2,labelOutlineColor:"#ffffff",labelOffset:[0,-16],fontColor:"#000000",fontSize:10},line:{strokeColor:"#008000",strokeWidth:2,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10},polygon:{strokeColor:"#008000",strokeWidth:2,fillColor:"#000000",fillOpacity:.3,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10}}}});var s;const l=r.Z.Util.extend(!0,{},a)},2089:(t,e,n)=>{"use strict";n.d(e,{Z:()=>o});var r=n(5361);r.Z.Consts={},r.Z.Consts.OLNS="ol",r.Z.Consts.PROJ4JSOBJ="proj4",r.Z.Consts.GEOGRAPHIC="geographic",r.Z.Consts.UTM="UTM",r.Z.Consts.OLD_BROWSER_ALERT="TC.oldBrowserAlert",r.Z.Consts.CLUSTER_ANIMATION_DURATION=200,r.Z.Consts.ZOOM_ANIMATION_DURATION=300,r.Z.Consts.URL_MAX_LENGTH=2048,r.Z.Consts.METER_PRECISION=0,r.Z.Consts.DEGREE_PRECISION=5,r.Z.Consts.EXTENT_TOLERANCE=.9998,r.Z.Consts.SRSDOWNLOAD_GEOJSON_KML="EPSG:4326",r.Z.Consts.url={SPLIT_REGEX:/([^:]*:)?\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,TEMPLATING_FULL:"lib/handlebars/handlebars",TEMPLATING_RUNTIME:"lib/handlebars/handlebars.runtime",TEMPLATING_HELPERS:"lib/handlebars/helpers.js",EPSG:"https://epsg.io/",D3C3:r.Z.apiLocation+"lib/d3c3/d3c3.min.js",CESIUM:r.Z.isDebug?"lib/cesium/build/cesium-sitna.js":"lib/cesium/build/cesium-sitna.min.js",CESIUM_CONNECTOR:"TC/cesium/cesium.js",JSNLOG:"lib/jsnlog/jsnlog.min.js",INTERACTJS:"lib/interactjs/interact.min.js",ERROR_LOGGER:r.Z.apiLocation+"errors/logger.ashx",HASH:"lib/jshash/md5-min.js",DRAGGABILLY:"lib/draggabilly/draggabilly.pkgd",URL_POLYFILL:"lib/polyfill/url.js",PROMISE_POLYFILL:"lib/polyfill/promise/polyfill.min.js"},r.Z.Consts.classes={MAP:"tc-map",POINT:"tc-point",MARKER:"tc-marker",VISIBLE:"tc-visible",HIDDEN:"tc-hidden",COLLAPSED:"tc-collapsed",CHECKED:"tc-checked",DISABLED:"tc-disabled",ACTIVE:"tc-active",DEFAULT:"tc-default",LASTCHILD:"tc-lastchild",TRANSPARENT:"tc-transparent",DROP:"tc-drop",LOADING:"tc-loading",IPAD_IOS7_FIX:"tc-ipad-ios7-fix",INFO:"tc-msg-info",WARNING:"tc-msg-warning",ERROR:"tc-msg-error",THREED:"tc-3d",TOAST:"tc-toast",TOAST_CONTAINER:"tc-toast-container"},r.Z.Consts.msgType={INFO:"info",WARNING:"warning",ERROR:"error"},r.Z.Consts.msgErrorMode={TOAST:"toast",CONSOLE:"console",EMAIL:"email"},r.Z.Consts.event={MAPLOAD:"mapload.tc",MAPREADY:"mapready.tc",MAPCHANGE:"mapchange.tc",BEFORELAYERADD:"beforelayeradd.tc",LAYERADD:"layeradd.tc",LAYERREMOVE:"layerremove.tc",LAYERORDER:"layerorder.tc",BEFORELAYERUPDATE:"beforelayerupdate.tc",LAYERUPDATE:"layerupdate.tc",LAYERERROR:"layererror.tc",BEFOREBASELAYERCHANGE:"beforebaselayerchange.tc",BASELAYERCHANGE:"baselayerchange.tc",BEFOREUPDATE:"beforeupdate.tc",UPDATE:"update.tc",BEFOREZOOM:"beforezoom.tc",ZOOM:"zoom.tc",BEFOREUPDATEPARAMS:"beforeupdateparams.tc",UPDATEPARAMS:"updateparams.tc",VECTORUPDATE:"vectorupdate.tc",FEATUREADD:"featureadd.tc",BEFOREFEATURESADD:"beforefeaturesadd.tc",FEATURESADD:"featuresadd.tc",BEFOREFEATUREREMOVE:"beforefeatureremove.tc",FEATUREREMOVE:"featureremove.tc",FEATURESCLEAR:"featuresclear.tc",FEATURESIMPORT:"featuresimport.tc",FEATURESIMPORTERROR:"featuresimporterror.tc",FEATURESIMPORTPARTIAL:"featuresimportpartial.tc",FEATURESIMPORTWARN:"featuresimportwarn.tc",FILESAVE:"filesave.tc",BEFORETILELOAD:"beforetileload.tc",TILELOAD:"tileload.tc",TILELOADERROR:"tileloaderror.tc",CONTROLADD:"controladd.tc",CONTROLACTIVATE:"controlactivate.tc",CONTROLDEACTIVATE:"controldeactivate.tc",BEFORECONTROLRENDER:"beforecontrolrender.tc",CONTROLRENDER:"controlrender.tc",BEFORELAYOUTLOAD:"beforelayoutload.tc",LAYOUTLOAD:"layoutload.tc",LAYERVISIBILITY:"layervisibility.tc",LAYEROPACITY:"layeropacity.tc",FEATURECLICK:"featureclick.tc",NOFEATURECLICK:"nofeatureclick.tc",FEATUREOVER:"featureover.tc",FEATUREOUT:"featureout.tc",BEFOREFEATUREINFO:"beforefeatureinfo.tc",FEATUREINFO:"featureinfo.tc",NOFEATUREINFO:"nofeatureinfo.tc",FEATUREINFOERROR:"featureinfoerror.tc",CLICK:"click",MOUSEUP:"mouseup",MOUSEMOVE:"mousemove",MOUSELEAVE:"mouseleave",STARTLOADING:"startloading.tc",STOPLOADING:"stoploading.tc",EXTERNALSERVICEADDED:"externalserviceadded.tc",ZOOMTO:"zoomto.tc",PROJECTIONCHANGE:"projectionchange.tc",VIEWCHANGE:"viewchange.tc",TERRAINPROVIDERADD:"terrainprovideradd.tc",TERRAINPROVIDERREMOVE:"terrainproviderremove.tc",OVERVIEWBASELAYERCHANGE:"overviewbaselayerchange.tc",POPUP:"popup.tc",BEFOREAPPLYQUERY:"beforeapplyquery.tc"},r.Z.Consts.layer={IDENA_ORTHOPHOTO:"ortofoto",IDENA_BASEMAP:"mapabase",IDENA_CADASTER:"catastro",IDENA_CARTO:"cartografia",IDENA_ORTHOPHOTO2021:"ortofoto2021",IDENA_ORTHOPHOTO2020:"ortofoto2020",IDENA_ORTHOPHOTO2019:"ortofoto2019",IDENA_ORTHOPHOTO2018:"ortofoto2018",IDENA_ORTHOPHOTO2017:"ortofoto2017",IDENA_ORTHOPHOTO2014:"ortofoto2014",IDENA_ORTHOPHOTO2012:"ortofoto2012",IDENA_PAMPLONA_ORTHOPHOTO2020:"ortofoto_pamplona2020",IDENA_DYNBASEMAP:"mapabase_dinamico",IDENA_DYNORTHOPHOTO:"ortofoto_dinamico",IDENA_DYNORTHOPHOTO2021:"ortofoto2021_dinamico",IDENA_DYNORTHOPHOTO2020:"ortofoto2020_dinamico",IDENA_DYNORTHOPHOTO2019:"ortofoto2019_dinamico",IDENA_DYNORTHOPHOTO2018:"ortofoto2018_dinamico",IDENA_DYNORTHOPHOTO2017:"ortofoto2017_dinamico",IDENA_DYNORTHOPHOTO2014:"ortofoto2014_dinamico",IDENA_DYNORTHOPHOTO2012:"ortofoto2012_dinamico",IDENA_PAMPLONA_DYNORTHOPHOTO2020:"ortofoto_pamplona2020_dinamico",IDENA_DYNCARTO:"cartografia_dinamico",IDENA_BW_RELIEF:"relieve_bn",IDENA_BASEMAP_ORTHOPHOTO:"base_orto",IGN_ES_CARTO:"ign-raster",IGN_ES_BASEMAP:"ign-base",IGN_ES_BASEMAP_GREY:"ign-base-gris",IGN_ES_RELIEF:"ign-mtn",IGN_ES_ORTHOPHOTO:"ign-pnoa",IGN_ES_LIDAR:"ign-lidar",IGN_ES_DYNCARTO:"ign-raster-dyn",IGN_ES_DYNBASEMAP:"ign-base-dyn",IGN_ES_DYNBASEMAP_GREY:"ign-base-gris-dyn",IGN_ES_DYNRELIEF:"ign-mtn-dyn",IGN_ES_DYNORTHOPHOTO:"ign-pnoa-dyn",IGN_ES_DYNLIDAR:"ign-lidar-dyn",IGN_FR_BASEMAP:"ign-fr-base",IGN_FR_RELIEF:"ign-fr-estompage",IGN_FR_ORTHOPHOTO:"ign-fr-orto",IGN_FR_DYNBASEMAP:"ign-fr-base-dyn",IGN_FR_DYNRELIEF:"ign-fr-estompage-dyn",IGN_FR_DYNORTHOPHOTO:"ign-fr-orto-dyn",OSM:"osm",CARTO_VOYAGER:"carto_voyager",CARTO_LIGHT:"carto_light",CARTO_DARK:"carto_dark",MAPBOX_STREETS:"mapbox_streets",MAPBOX_SATELLITE:"mapbox_satellite",BLANK:"ninguno"},r.Z.Consts.text={API_ERROR:"Error API SITNA",APP_ERROR:"Error de aplicación"},r.Z.Consts.layerType={WMS:"WMS",WMTS:"WMTS",WFS:"WFS",VECTOR:"vector",KML:"KML",GPX:"GPX",GML:"GML",GEOJSON:"GeoJSON",GROUP:"group"},r.Z.Consts.geom={POINT:"point",MULTIPOINT:"multipoint",POLYLINE:"polyline",POLYGON:"polygon",MULTIPOLYLINE:"multipolyline",MULTIPOLYGON:"multipolygon",CIRCLE:"circle",RECTANGLE:"rectangle"},r.Z.Consts.searchType={CADASTRAL:"cadastral",COORDINATES:"coordinates",MUNICIPALITY:"municipality",COUNCIL:"council",LOCALITY:"locality",STREET:"street",NUMBER:"number",URBAN:"urban",COMMONWEALTH:"commonwealth",ROAD:"road",ROADMILESTONE:"roadmilestone",PLACENAME:"placename",PLACENAMEMUNICIPALITY:"placenamemunicipality"},r.Z.Consts.mapSearchType={MUNICIPALITY:r.Z.Consts.searchType.MUNICIPALITY,COUNCIL:r.Z.Consts.searchType.COUNCIL,URBAN:r.Z.Consts.searchType.URBAN,COMMONWEALTH:r.Z.Consts.searchType.COMMONWEALTH,GENERIC:"generic"},r.Z.Consts.comparison={EQUAL_TO:"==",NOT_EQUAL_TO:"!=",LESS_THAN:"<",GREATER_THAN:">",LESS_THAN_EQUAL_TO:"=<",GREATER_THAN_EQUAL_TO:">=",LIKE:"is"},r.Z.Consts.logicalOperator={AND:"and",OR:"or"},r.Z.Consts.WMTSEncoding={KVP:"KVP",RESTFUL:"RESTful"},r.Z.Consts.mimeType={PNG:"image/png",JPEG:"image/jpeg",JSON:"application/json",GEOJSON:"application/vnd.geo+json",KML:"application/vnd.google-earth.kml+xml",KMZ:"application/vnd.google-earth.kmz",GML:"application/gml+xml",GPX:"application/gpx+xml",XML:"application/xml",GEOPACKAGE:"application/geopackage+sqlite3",SHAPEFILE:"x-gis/x-shapefile",ZIP:"application/x-zip"},r.Z.Consts.format={JSON:"JSON",KML:"KML",KMZ:"KMZ",GML:"GML",GML2:"GML2",GML3:"GML3",GML32:"GML32",GEOJSON:"GeoJSON",TOPOJSON:"TopoJSON",GPX:"GPX",WKT:"WKT",SHAPEFILE:"SHP",ZIP:"ZIP",GEOPACKAGE:"GPKG"},r.Z.Consts.WFSErrors={GETFEATURE_NOT_AVAILABLE:"GetFeatureNotAvailable",LAYERS_NOT_AVAILABLE:"LayersNotAvailable",NO_LAYERS:"NoLayers",NO_VALID_LAYERS:"noValidLayers",QUERY_NOT_AVAILABLE:"QueryNotAvailable",MAX_NUM_FEATURES:"NumMaxFeatures",GETCAPABILITIES:"GetCapabilities",INDETERMINATE:"Indeterminate",NO_FEATURES:"NoFeatures"},r.Z.Consts.visibility={NOT_VISIBLE:0,NOT_VISIBLE_AT_RESOLUTION:1,HAS_VISIBLE:2,VISIBLE:4},r.Z.Consts.view={DEFAULT:0,THREED:1,PRINTING:2},r.Z.Consts.units={DEGREES:"degrees",METERS:"m"},r.Z.Consts.MARKER="marker",r.Z.Consts.infoContainer={POPUP:"popup",RESULTS_PANEL:"resultsPanel"},r.Z.Consts.DownloadError={MIMETYPE_NOT_SUPORTED:"MimeTypeNotSupported"};const o=r.Z.Consts},6498:(t,e,n)=>{"use strict";n.d(e,{Z:()=>s});var r=n(5361),o=n(2089),i=n(4769),a=n(5798);r.Z.Consts=o.Z,r.Z.i18n=r.Z.i18n||a.Z,r.Z.control=r.Z.control||{},r.Z.Control=function(){const t=this;i.Z.call(t),t.map=null,t.isActive=!1,t.isDisabled=!1;var e=arguments.length;t.options=r.Z.Util.extend({},e>1?arguments[1]:arguments[0]),t.id=t.options.id||r.Z.getUID({prefix:t.CLASS.substr(r.Z.Control.prototype.CLASS.length+1)+"-"}),t.div=r.Z.Util.getDiv(t.options.div?t.options.div:arguments[0]),t.div.classList.add(r.Z.Control.prototype.CLASS,t.CLASS),t.template=t.options.template||t.template,t.exportsState=!1},r.Z.inherit(r.Z.Control,i.Z),function(){const t=r.Z.Control.prototype;t.CLASS="tc-ctl",t.template=void 0,t.show=function(){this.div.style.display=""},t.hide=function(){this.div.style.display="none"},t.render=function(t){const e=this;return e._set1stRenderPromise(e.renderData(null,(function(){e.addUIEventListeners(),"function"==typeof t&&t()})))},t._set1stRenderPromise=function(t){const e=this;return e._firstRender||(e._firstRender=t),t},t.renderData=function(t,e){const n=this;return new Promise((function(o,i){let a;n.map&&n.trigger(r.Z.Consts.event.BEFORECONTROLRENDER,{dataObject:t}),n.div.classList.toggle(r.Z.Consts.classes.DISABLED,n.isDisabled),"object"!=typeof n.template||n.template.compiler?(a=n.template,n.template={},n.template[n.CLASS]=a):a=n.template[n.CLASS],n.getRenderedHtml(n.CLASS,t).then((function(t){n.div.innerHTML=t,n.map&&n.trigger(r.Z.Consts.event.CONTROLRENDER),r.Z.Util.isFunction(e)&&e(),o()}))}))};t.getRenderedHtml=function(t,e,n){const o=this;return new Promise((function(i,a){const s=function(t){if(void 0===t)return void i("");const o=t(e);r.Z.Util.isFunction(n)&&n(o),i(o)},l=o.template[t];var c,u;"function"!=typeof l?(c=o.template,u={locale:o.map&&o.map.options.locale,className:o.CLASS},u=u||{},new Promise((function(t,e){let n=!1;for(var o in c)"string"==typeof c[o]&&(n=!0);const i=function(){const e=[];for(var n in c){const t=n;let o=c[t];"string"==typeof o?e.push(new Promise((function(e,n){r.Z.ajax({url:o,method:"GET",responseType:"text"}).then((function(n){c[t]=o=r.Z._hbs.compile(n.data),e(o)})).catch((function(t){console.log("Error fetching template: "+t),n(t)}))}))):"object"==typeof o&&(c[n]=o=r.Z._hbs.template(o))}Promise.all(e).then((function(){for(var e in c)c[e]&&e!==u.className&&r.Z._hbs.registerPartial(e,c[e]);t()}))};n?r.Z.loadJSInOrder(!r.Z._hbs||!r.Z._hbs.compile,[r.Z.apiLocation+r.Z.Consts.url.TEMPLATING_FULL,r.Z.apiLocation+r.Z.Consts.url.TEMPLATING_HELPERS],i):r.Z.loadJSInOrder(!r.Z._hbs,[r.Z.apiLocation+r.Z.Consts.url.TEMPLATING_RUNTIME,r.Z.apiLocation+r.Z.Consts.url.TEMPLATING_HELPERS],i)}))).then((function(){s(o.template[t])})):s(l)}))},t.register=function(t){const e=this;return new Promise((function(n,r){e.map=t,Promise.resolve(e.render()).then((function(){e.options.active&&e.activate(),n(e)}))}))},t.activate=function(){const t=this;t.map&&t.map.activeControl&&t.map.activeControl!==t&&(t.map.previousActiveControl=t.map.activeControl,t.map.activeControl.deactivate()),t.isActive=!0,t.map&&(t.map.activeControl=t,t.map.trigger(r.Z.Consts.event.CONTROLACTIVATE,{control:t}),t.trigger(r.Z.Consts.event.CONTROLACTIVATE,{control:t}))},t.deactivate=function(t){0===arguments.length&&(t=!1);const e=this;if(e.isActive=!1,e.map){if(e.map.activeControl=null,!t){var n=e.map.getDefaultControl();n===e||e.map.previousActiveControl===e?n=null:n||(n=e.map.previousActiveControl),n&&n.activate()}e.map.trigger(r.Z.Consts.event.CONTROLDEACTIVATE,{control:e}),e.trigger(r.Z.Consts.event.CONTROLDEACTIVATE,{control:e})}},t.enable=function(){const t=this;t.isDisabled=!1,t.div&&(t.div.classList.remove(r.Z.Consts.classes.DISABLED),delete t.div.dataset.tcMessage),t.containerControl&&t.containerControl.onControlEnable&&t.containerControl.onControlEnable(t)},t.disable=function(t){const e=this;if(t=t||{},e.isDisabled=!0,e.div){e.div.classList.add(r.Z.Consts.classes.DISABLED);let n=e.getLocaleString("disabledControl");t.reason&&(n=`${n} - ${t.reason}`),e.div.dataset.tcMessage=n}e.containerControl&&e.containerControl.onControlDisable&&e.containerControl.onControlDisable(e)},t.renderPromise=function(){const t=this;return t._firstRender||new Promise((function(e,n){t.one(r.Z.Consts.event.CONTROLRENDER,(function(){e(t)}))}))},t.addUIEventListener=function(t,e,n){(t?this.div.querySelectorAll(t):[this.div]).forEach((function(t){t.addEventListener(e,n)}))},t.addUIEventListeners=function(){},t.isExclusive=function(){return!1},t.getLocaleString=function(t,e){var n=this.map?this.map.options.locale:r.Z.Cfg.locale;return r.Z.Util.getLocaleString(n,t,e)},t.getUID=function(){return r.Z.getUID({prefix:this.id+"-"})},t.exportState=function(){return this.exportsState?{}:null},t.importState=function(t){},t.getDownloadDialog=function(){const t=this;return t._downloadDialog=t._downloadDialog||t.map.getControlsByClass("TC.control.FeatureDownloadDialog")[0],t._downloadDialog?(t._downloadDialog.caller=t,Promise.resolve(t._downloadDialog)):new Promise((function(e,n){t.map.addControl("FeatureDownloadDialog").then((n=>{t._downloadDialog=n,t._downloadDialog.caller=t,e(n)}))}))},t.getElevationTool=function(){const t=this;return t.displayElevation||t.options.displayElevation?t.elevation?Promise.resolve(t.elevation):new Promise((function(e,n){r.Z.loadJS(!r.Z.tool||!r.Z.tool.Elevation,r.Z.apiLocation+"TC/tool/Elevation",(function(){"boolean"==typeof t.options.displayElevation?t.map?t.map.getElevationTool().then((function(n){t.elevation=n||new r.Z.tool.Elevation,e(t.elevation)})):(t.elevation=new r.Z.tool.Elevation,e(t.elevation)):t.map?t.map.getElevationTool().then((function(n){t.elevation=n?new r.Z.tool.Elevation(r.Z.Util.extend(!0,{},n.options,t.options.displayElevation)):new r.Z.tool.Elevation(t.options.displayElevation),e(t.elevation)})):(t.elevation=new r.Z.tool.Elevation(t.options.displayElevation),e(t.elevation))}))})):Promise.resolve(null)}}(),r.Z.Control.create=async function(t,e){const o=t.substr(0,1).toUpperCase()+t.substr(1);if(!r.Z.control[o]){const t=await n(8949)("./"+o);r.Z.control[o]=t.default}return new r.Z.control[o](null,e)};const s=r.Z.Control},4769:(t,e,n)=>{"use strict";n.d(e,{Z:()=>s});const r=function(t,e){const n=function(t){const n={type:t.type,target:this,currentTarget:this};return t.detail&&Object.keys(t.detail).forEach((function(e){e in n||(n[e]=t.detail[e])})),e.call(this,n)}.bind(this);return(this._listeners[t]=this._listeners[t]||new Map).set(e,n),n},o=function(t,e,n){const o=this;return t.split(" ").forEach((function(t){o.$events.addEventListener(t,r.call(o,t,e),n)})),o},i=function(){const t=this;t._listeners={},t.$events=document.createDocumentFragment();const e=["addEventListener","dispatchEvent","removeEventListener"];e.forEach((function(e){this[e]=t.$events[e].bind(t.$events)}),t);e.push("on"),e.push("one"),e.push("off"),e.push("trigger"),e.forEach((function(e){t.$events[e]=t[e].bind(t)}),t)},a=i.prototype;a.on=function(t,e){return o.call(this,t,e)},a.one=function(t,e){return o.call(this,t,e,{once:!0})},a.off=function(t,e){const n=this,r=t.split(" ");return e?r.forEach((function(t){const r=n._listeners[t];r&&r.has(e)&&n.$events.removeEventListener(t,r.get(e))})):r.forEach((function(t){const e=n._listeners[t];e&&(e.forEach((function(e){n.$events.removeEventListener(t,e)})),e.clear())})),n},a.trigger=function(t,e){var n;window.$&&$.Event&&t instanceof $.Event&&(e={},Object.keys(t).forEach((function(n){"type"!==n&&(e[n]=t[n])})),t=t.type),e&&(n={detail:e});const r=new CustomEvent(t,n);this.dispatchEvent(r)},i._onBySelectorMap=new WeakMap,i.listenerBySelector=function(t,e){return function(n){const r=this,o=n.type;var a=i._onBySelectorMap.get(r);a||(a={},i._onBySelectorMap.set(r,a));var s=a[o];if(s||(a[o]=s={}),s[t]||(s[t]=e),!n._listenerBySelectorCalled)for(var l,c=!1,u=n.target;u&&u!==r;){for(t in s)u.matches&&u.matches(t)&&(c=!0,l=s[t].call(r,n),n._listenerBySelectorCalled=!0);if(c)return l;u=u.parentNode}}};const s=i},1299:(t,e,n)=>{"use strict";n.d(e,{Z:()=>s});var r=n(5361),o=n(2089),i=n(1468),a=n(6498);r.Z.Control=a.Z,r.Z.control=r.Z.control||{},r.Z.Consts=o.Z,r.Z.Cfg=r.Z.Cfg||i.v,r.Z.feature=r.Z.feature||{},r.Z.Feature=function(t,e){var n=this;let o;n.wrap=new r.Z.wrap.Feature,n.wrap.parent=n,n.wrap.isNative(t)&&(n.wrap.feature=t,t._wrap=n.wrap,o=n.wrap.getId(),n.geometry=n.wrap.getGeometry(),t._folders&&(n.folders=t._folders),n.setData(n.wrap.getData()));var i=n.options=r.Z.Util.extend(!0,{},e);n.id=o||i.id||r.Z.getUID(),n.wrap.feature&&!o&&n.wrap.feature.setId(n.id),n.data=i.data||n.data||null,n._visibilityState=r.Z.Consts.visibility.VISIBLE,void 0===i.showsPopup?n.showsPopup=!0:n.showsPopup=i.showsPopup,n.layer=i.layer||null,n._selected=!1,i.selected&&n.select()},r.Z.Feature.prototype.STYLETYPE=r.Z.Consts.geom.POLYGON,r.Z.Feature.prototype.CLASSNAME="TC.Feature",r.Z.Feature.prototype.getPath=function(){var t=[],e=this;return e.folders?t=e.folders:e.options.group&&(t=[e.options.group]),t},r.Z.Feature.prototype.setVisibility=function(t){var e=this;if(!t&&e.showsPopup&&e.layer){var n=e.layer.map.getControlsByClass(r.Z.control.Popup).filter((function(t){return t.currentFeature===e}));if(n.length>0){const t=n[0];t.isVisible()&&t.hide()}}(t&&e._visibilityState===r.Z.Consts.visibility.NOT_VISIBLE||!t&&e._visibilityState===r.Z.Consts.visibility.VISIBLE)&&(e._visibilityState=t?r.Z.Consts.visibility.VISIBLE:r.Z.Consts.visibility.NOT_VISIBLE,e.layer.wrap.setFeatureVisibility(e,t))},r.Z.Feature.prototype.getId=function(){return this.wrap.getId()},r.Z.Feature.prototype.setId=function(t){this.id=t,this.wrap.setId(t)},r.Z.Feature.prototype.getBounds=function(){return this.wrap.getBounds()},r.Z.Feature.prototype.setStyle=function(t){this.wrap.setStyle(t)},r.Z.Feature.prototype.toggleSelectedStyle=function(t){const e=this;e._hasSelectedStyle!==t&&(e._hasSelectedStyle=t,e.wrap.toggleSelectedStyle(t))},r.Z.Feature.prototype.getLegend=function(){var t=this;return t._legend||(t._legend=t.wrap.getLegend()),t._legend},r.Z.Feature.prototype.getCoordinates=r.Z.Feature.prototype.getCoords=function(){const t=this;return t.geometry=t.wrap.getGeometry(),t.geometry},r.Z.Feature.prototype.getCoordsArray=function(){const t=function(t){return Array.isArray(t)&&t.length>=2&&"number"==typeof t[0]&&"number"==typeof t[1]},e=function(e){return t(e)?[e]:e.reduce(n,[])},n=function(n,r){return t(r)?n.push(r):n=n.concat(e(r)),n};return e(this.getCoords())},r.Z.Feature.prototype.getGeometryStride=function(){const t=this.getCoordsArray()[0];return t?t.length:0},r.Z.Feature.prototype.setCoords=function(t){const e=function(t){t.forEach((function(n,r){Array.isArray(n)?e(n):null===n?t[r]=0:"number"!=typeof n&&(console.log("Warning: coordinate does not have number type"),t[r]=parseFloat(n))}))};return Array.isArray(t)&&e(t),this.geometry=t,this.wrap.setGeometry(t)},r.Z.Feature.prototype.getData=function(){var t=this;return t.data?t.data:t.wrap.getData()},r.Z.Feature.prototype.setData=function(t){const e=this;if("string"==typeof t)e.data=t;else{for(var n in e.data=r.Z.Util.extend(e.data,t),e.attributes=e.attributes||[],t){let r=e.attributes.filter((t=>t.name===n))[0];r?r.value=t[n]:e.attributes.push({name:n,value:t[n]})}e.wrap.setData(t)}},r.Z.Feature.prototype.unsetData=function(t){const e=this;delete e.data[t];const n=(e.attributes||[]).filter((e=>e.name===t))[0];n&&e.attributes.splice(e.attributes.indexOf(n),1),e.wrap.unsetData(t)},r.Z.Feature.prototype.clearData=function(){const t=this;t.data={},t.attributes=[],t.wrap.clearData()},r.Z.Feature.prototype.getInfo=function(t){var e=null,n=this,o=(t=t||{}).locale||n.layer&&n.layer.map&&r.Z.Util.getMapLocale(n.layer.map),i=n.getData();if("object"==typeof i){var a=n.wrap.getTemplate();if(a)e=a.replace(/\$\[?(?:\w+\/)*(\w+)\]/g,(function(t,e){return i[e]}));else{var s=[];const t=[],n=r.Z.Util.getLocaleString(o,"open"),a=r.Z.Util.getLocaleString(o,"linkInNewWindow"),c=function(t){let e;return e=r.Z.Util.isURL(t)?`<a href="${t}" target="_blank" title="${a}">${n}</a>`:void 0!==t?"number"==typeof t?r.Z.Util.formatNumber(t,o):t:"&mdash;",e},u=function(t){var e=[];if(t instanceof Array){const n="complexAttr_"+r.Z.getUID();e.push(`<div class="complexAttr"><input type="checkbox" id="${n}" /><div><label for="${n}" title="" class="plus"></label>`),e.push(`<label for="${n}" title="" class="title">${t.length} ${r.Z.Util.getLocaleString(o,"featureInfo.complexData.array")}</label><br/>`),e.push('<table class="complexAttr"><tbody>'),t.forEach((t=>{e.push("<tr><td>"),(e=e.concat(u(t))).push("</td></tr>")})),e.push("</tbody></table></div></div>")}else if(t instanceof Object)if(t.getType){const n={type:t.getType(),coordinates:t.getCoordinates()};e=e.concat(u(n))}else{for(var n in e.push('<table class="complexAttr"><tbody>'),t){if(e.push("<tr>"),t[n]&&t[n]instanceof Array){const o="complexAttr_"+r.Z.getUID();e.push(`<th style="display:none">${n}</th>\n                                           <td><label for="${o}" class="title">${n}</label><br/>`),(e=e.concat(u(t[n]))).push("</div></td>")}else if(t[n]&&t[n]instanceof Object){const o="complexAttr_"+r.Z.getUID();e.push(`<th style="display:none">${n}</th>\n                                           <td><input type="checkbox" id="${o}" /><div><label for="${o}" title="" class="plus"></label>`),e.push(`<label for="${o}" title="" class="title">${n}</label><br/>`),(e=e.concat(u(t[n]))).push("</div></td>")}else e.push(`<th class="key">${n}</th>\n                                           <td class="value">`),(e=e.concat(u(t[n]))).push("</td>");e.push("</tr>")}e.push("</tbody></table>")}else e.push(c(t));return e};for(var l in i){const e=i[l],n=l.match(/^h(\d)_/i);n?t[n[1]]=e:"string"==typeof e||"number"==typeof e||void 0===e?s.push(`<tr><th>${l}</th><td>${c(e)}</td></tr>`):(s.push(`<tr><th>${l}</th><td>`),(s=s.concat(u(e))).push("</td></tr>"))}const p=t.map((function(t,e){if(t)return`<h${e}>${t}</h${e}>`})).filter((function(t){return t}));p.length&&(s=p.concat(s)),s.length>0&&(s.unshift('<table class="tc-attr">'),s.push("</table>"),e=s.join(""))}}else"string"==typeof i&&(e=i);return e||(e=n.title,n.group&&(e+=" "+n.group)),e||(e=r.Z.Util.getLocaleString(o,"noData")),e},r.Z.Feature.prototype.getTemplate=function(){let t=this.wrap.getTemplate();return t||null},r.Z.Feature.prototype.clone=function(){var t=this,e=t.wrap.cloneFeature();e._wrap=t.wrap;const n=new t.constructor(e,t.options);return t.folders&&(n.folders=t.folders.slice()),n},r.Z.Feature.prototype.getStyle=function(){return this.wrap.getStyle()},r.Z.Feature.prototype.showPopup=async function(t){const e=this,n=(t=t||{})&&t instanceof r.Z.Control?t:t.control,o=e.layer&&e.layer.map||n&&n.map;if(o){let c=n||e.popup;if(!c)for(var i=o.getControlsByClass("TC.control.Popup"),a=0,s=i.length;a<s;a++){var l=i[a];if(!l.caller){c=l;break}}return c||(c=await o.addControl("popup")),c.currentFeature=e,o.getControlsByClass(r.Z.control.Popup).filter((t=>t!==c&&t.isVisible())).forEach((t=>t.hide())),c.setDragged(!1),e.wrap.showPopup(Object.assign({},t,{control:c})),o.trigger(r.Z.Consts.event.POPUP,{control:c}),c.fitToView(!0),c.contentDiv.querySelectorAll("img").forEach((t=>t.addEventListener("load",(()=>c.fitToView())))),c}return null},r.Z.Feature.prototype.showResultsPanel=async function(t){const e=this,n=(t=t||{})&&t instanceof r.Z.Control?t:t.control,o=e.layer&&e.layer.map||n&&n.map;if(o){let n;var i={content:"table",titles:{main:r.Z.Util.getLocaleString(o.options.locale,"rsp.title"),max:r.Z.Util.getLocaleString(o.options.locale,"rsp.title")}},a=o.getControlsByClass("TC.control.ControlContainer")[0];a?(i.position=a.POSITION.RIGHT,n=o.getControlsByClass("TC.control.ResultsPanel").find((t=>t.currentFeature===e)),n||(n=await a.addControl("resultsPanel",i))):(i.div=document.createElement("div"),o.div.appendChild(i.div),n=o.getControlsByClass("TC.control.ResultsPanel").find((t=>t.currentFeature===e)),n||(n=await o.addControl("resultsPanel",i))),n.currentFeature=e,0===o.getControlsByClass(r.Z.control.ControlContainer).length&&o.getControlsByClass(r.Z.control.ResultsPanel).filter((t=>"table"===t.options.content)).forEach((function(t){t.close()}));o.getControlsByClass("TC.control.ResultsPanel").filter((t=>n!==t)).forEach((function(t){t.currentFeature&&!t.chart&&t.close()})),n.menuDiv.innerHTML="",n.open(t.html||e.getInfo({locale:o.options.locale}),n.getInfoContainer());new ResizeObserver((t=>{for(let e of t)e.target.querySelectorAll("h3, h4").forEach((function(t){t.addEventListener("mouseenter",(function(t){this.offsetWidth<this.scrollWidth?this.title=this.childNodes.item(0).textContent:this.title=""}),{passive:!0})}))})).observe(n.infoDiv);var s=function(t){o.off(r.Z.Consts.event.VIEWCHANGE,s),n.close()};return o.on(r.Z.Consts.event.VIEWCHANGE,s),n}return null},r.Z.Feature.prototype.showInfo=async function(t){const e=this;if(t=t||{},!r.Z.control||!r.Z.control.FeatureInfoCommons){const t=await Promise.resolve().then(n.bind(n,128));r.Z.control=r.Z.control||{},r.Z.control.FeatureInfoCommons=t.default}let o;o=e.getTemplate()?e.getInfo():"string"==typeof e.data?e.data:await r.Z.control.FeatureInfoCommons.renderFeatureAttributeTable({attributes:e.attributes,singleFeature:!0});const i=r.Z.Util.extend({},t,{html:o});let a;if(t.control&&r.Z.control){const n=t.control;n instanceof r.Z.control.Popup?a=await e.showPopup(i):n instanceof r.Z.control.ResultsPanel&&(a=await e.showResultsPanel(i))}else a=e.layer.map.on3DView||e.layer.map.defaultInfoContainer===r.Z.Consts.infoContainer.RESULTS_PANEL?await e.showResultsPanel(i):await e.showPopup(i);r.Z.control.FeatureInfoCommons.addSpecialAttributeEventListeners(a.getContainerElement())},r.Z.Feature.prototype.select=function(){var t=this;t._selected=!0,t.layer&&t.layer.selectedFeatures.push(t);var e=t.options.selection||{};t.setStyle(r.Z.Util.extend({},r.Z.Cfg.styles.selection[t.STYLETYPE],e[t.STYLETYPE]))},r.Z.Feature.prototype.unselect=function(){const t=this;if(t._selected=!1,t.setStyle(t.options),t.layer){const e=t.layer.selectedFeatures.indexOf(t);e>=0&&t.layer.selectedFeatures.splice(e,1)}},r.Z.Feature.prototype.isSelected=function(){return this._selected},r.Z.Feature.prototype.toGML=function(t,e){return this.wrap.toGML(t,e)};const s=r.Z.Feature},2667:(t,e,n)=>{"use strict";n.d(e,{Z:()=>s});var r=n(5361);const o=function(t,e,n,r){return 8&n?[t[0]+(e[0]-t[0])*(r[3]-t[1])/(e[1]-t[1]),r[3]]:4&n?[t[0]+(e[0]-t[0])*(r[1]-t[1])/(e[1]-t[1]),r[1]]:2&n?[r[2],t[1]+(e[1]-t[1])*(r[2]-t[0])/(e[0]-t[0])]:1&n?[r[0],t[1]+(e[1]-t[1])*(r[0]-t[0])/(e[0]-t[0])]:null},i=function(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n},a={isPoint:function(t){return Array.isArray(t)&&t.length>=2&&"number"==typeof t[0]&&"number"==typeof t[1]},isRing:function(t){return Array.isArray(t)&&(0===t.length||a.isPoint(t[0]))},isRingCollection:function(t){return Array.isArray(t)&&(0===t.length||a.isRing(t[0]))},isMultiRingCollection:function(t){return Array.isArray(t)&&(0===t.length||a.isRingCollection(t[0]))},getNearest:function(t,e){return r.Z.wrap.Geometry.getNearest(t,e)},isInside:function t(e,n){var r=!1;if(a.isPoint(e))if(a.isPoint(n))r=e[0]===n[0]&&e[1]===n[1];else if(a.isRing(n))for(var o=0,i=n.length-1;o<n.length;i=o++){var s=n[o][0],l=n[o][1],c=n[i][0],u=n[i][1];l>e[1]!=u>e[1]&&e[0]<(c-s)*(e[1]-l)/(u-l)+s&&(r=!r)}else if(a.isRingCollection(n)&&n.length>0){if(t(e,n[0])){var p=!1;for(o=1;o<n.length;o++)if(t(e,n[o])){p=!0;break}p||(r=!0)}}else if(a.isMultiRingCollection(n)&&n.length>0)for(o=0;o<n.length;o++)if(t(e,n[o])){r=!0;break}return r},getSquaredDistance:function(t,e){const n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r},getDistance:function(t,e){return Math.sqrt(a.getSquaredDistance(t,e))},getFlatCoordinates:function(t){const e=function(t,e){return t.concat(e)};switch(!0){case a.isPoint(t):return[t];case a.isRing(t):return t;case a.isRingCollection(t):return t.reduce(e);case a.isMultiRingCollection(t):return t.reduce(e).reduce(e);default:return[]}},intersects:function(t,e){const n=function(t,e){for(var n=0,r=t.length;n<r;n++)if(a.isInside(t[n],e))return!0;return!1};return!(!n(a.getFlatCoordinates(t),e)&&!n(a.getFlatCoordinates(e),t))},clipPolygon:function(t,e){return t.map((t=>a.clipRing(t,e))).filter((t=>t.length))},clipRing:function(t,e){let n,r,a,s,l;for(r=1;r<=8&&(n=[],a=t[t.length-1],s=!(i(a,e)&r),t.forEach((t=>{l=!(i(t,e)&r),l!==s&&n.push(o(a,t,r,e)),l&&n.push(t),a=t,s=l})),(t=n).length);r*=2);return n},clipPolyline:function(t,e){let n,r,a,s,l,c=t.length,u=i(t[0],e),p=[],d=[];for(n=1;n<c;n++){for(r=t[n-1],a=t[n],s=l=i(a,e);;){if(!(u|s)){p.push(r),s!==l?(p.push(a),n<c-1&&(d=d.concat(p),p=[])):n===c-1&&p.push(a);break}if(u&s)break;u?(r=o(r,a,u,e),u=i(r,e)):(a=o(r,a,s,e),s=i(a,e))}u=l}return p.length&&(d=d.concat(p)),d}},s=a},2530:(t,e,n)=>{"use strict";n.d(e,{Z:()=>s});var r=n(5361),o=n(7945),i=n(1466),a=n.n(i);r.Z.Util=o.Z,r.Z.Layer=function(t){var e=this;e.options=t||{},r.Z.Util.extend(e,e.options),e.PROTOCOL_REGEX=/^(f|ht)tp?:\/\//i,e.id=e.options.id||r.Z.getUID(),e.map=e.options.map,e.type=e.options.type||r.Z.Consts.layerType.WMS,e.customLegend=e.options.customLegend;var n=e.options.isBase?r.Z.Consts.mimeType.JPEG:r.Z.Consts.mimeType.PNG;e.options.format=e.options.format||n,e.options.owner&&(e.owner=e.options.owner),void 0===e.options.hideTree&&(e.options.hideTree=!0),void 0===e.options.hideTitle&&(e.options.hideTitle=!1),e.tree=null,e.wrap=null},r.Z.Layer.state={IDLE:"idle",LOADING:"loading"},r.Z.Layer.prototype.CAPABILITIES_STORE_KEY_PREFIX="TC.capabilities.",r.Z.Layer.prototype.setVisibility=function(t){this.wrap.setVisibility(t)},r.Z.Layer.prototype.getVisibility=function(){var t=this,e=!1;return t.map&&(t.isBase&&t.map.getBaseLayer()!==t||(e=t.wrap.getVisibility())),e},r.Z.Layer.prototype.getOpacity=function(){var t=this,e=!1;return t.map&&(t.isBase&&t.map.getBaseLayer()!==t||(e=t.wrap.layer.getOpacity())),e},r.Z.Layer.prototype.setOpacity=function(t,e){var n=this;this.wrap.getLayer().then((function(o){o.setOpacity(t),n.opacity=t,n.map&&!e&&n.map.trigger(r.Z.Consts.event.LAYEROPACITY,{layer:n,opacity:t})}))},r.Z.Layer.prototype.isCompatible=function(t){return!0},r.Z.Layer.prototype.isValidFromNames=function(){return!0},r.Z.Layer.prototype.isRaster=function(){var t=!0;switch(this.type){case r.Z.Consts.layerType.VECTOR:case r.Z.Consts.layerType.KML:case r.Z.Consts.layerType.WFS:case r.Z.Consts.layerType.GROUP:t=!1}return t},r.Z.Layer.prototype.isVisibleByScale=function(t){return!0},r.Z.Layer.prototype.isVisibleByName=function(t){return!0},r.Z.Layer.prototype.getTree=function(){return{name:this.name,title:this.title}},r.Z.Layer.prototype.findNode=function t(e,n){var r=null;if(n.uid==e)r=n;else for(var o=0;o<n.children.length;o++){var i=t(e,n.children[o]);if(i){r=i;break}}return r},r.Z.Layer.prototype.setNodeVisibility=function(t,e){const n=this,o=n.getTree(!0),i=n.findNode(t,o);if(!n.isRoot(i)){const t=function(e,n){e.visibilityState=n,e.children&&e.children.forEach((e=>t(e,n)))};if(e){t(i,r.Z.Consts.visibility.VISIBLE);let e=i.parent;do{e.visibilityState!==r.Z.Consts.visibility.VISIBLE&&(e.visibilityState=r.Z.Consts.visibility.HAS_VISIBLE),e=e.parent}while(e)}else{t(i,r.Z.Consts.visibility.NOT_VISIBLE);let e=i.parent;do{e.visibilityState===r.Z.Consts.visibility.HAS_VISIBLE&&e.children.every((t=>t.visibilityState===r.Z.Consts.visibility.NOT_VISIBLE))&&(e.visibilityState=r.Z.Consts.visibility.NOT_VISIBLE),e=e.parent}while(e)}}return i},r.Z.Layer.prototype.isRoot=function(t){const e=this.tree||this.getTree(!0);return t.uid===e.uid},r.Z.Layer.prototype.getNodeVisibility=function(t,e){const n=this;let r=e||n.tree;r||(r=n.getTree(!0));const o=n.findNode(t,r);return o?o.visibilityState:o},r.Z.Layer.prototype.getResolutions=function(){return this.wrap.getResolutions?this.wrap.getResolutions():[]},r.Z.Layer.prototype.setProjection=function(){},r.Z.Layer.prototype.clone=function(){const t=this,e=r.Z.Util.extend(!0,{},t.options,{id:t.id+"_clone"});return new t.constructor(e)},r.Z.Layer.prototype.getBySSL_=function(t){return t.replace(this.PROTOCOL_REGEX,"https://")},r.Z.Layer.prototype.clip=function(t){this.wrap.clip(t)},r.Z.Layer.prototype.stroke=function(t,e){this.wrap.stroke(t,e)},function(){const t=window.hasOwnProperty("Worker"),e=r.Z.Util.getWebWorkerCrossOriginURL(r.Z.apiLocation+"TC/workers/tc-caps-web-worker.js"),n=function(t,e){return"No se pudo obtener el documento de capacidades del servicio "+t.url+": ["+e+"]"},o=function(t){const e=document.createElement("a");if(e.href=t,!e.origin){if(!e.protocol||!e.hostname){var n=/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/.exec(e.href);if(e.protocol=n[1],n[4].indexOf(":")>-1){var r=n[4].split(":");e.hostname=r[0],e.port=r[1]}else e.hostname=n[4]}e.origin=0===e.protocol.length?window.location.protocol:e.protocol+"//"+e.hostname+(e.port&&t.indexOf(e.port)>-1?":"+e.port:"")}return e},i=function(t,e){const n=o(t.options.url);var r=t.CAPABILITIES_STORE_KEY_PREFIX+t.type+"."+n.href,i=function(){e.hasOwnProperty("error")||t.getCapabilitiesPromise().then((function(){a().setItem(r,e).catch((t=>console.log(t)))}))};t.map?t.map.loaded(i):i()};r.Z.Layer.prototype.getGetMapUrl=function(){return function(t){var e=t;if(t){var n=t.match(/\??SERVICE=\w+&/i);n&&(e=e.replace(n[0],""))}return e}(this.wrap.getGetMapUrl())},r.Z.Layer.prototype.getCapabilitiesOnline=function(){const o=this;return o._onlineCapabilitiesPromise=o._onlineCapabilitiesPromise||new Promise((function(a,s){const l=o.getGetCapabilitiesUrl();o.toolProxification.fetch(l,{retryAttempts:2}).then((function(l){(function(n,o){var a;if(o.documentElement){const t=o.getElementsByTagName("ServiceException")[0];if(t)a={error:t.textContent};else{var s=n.type===r.Z.Consts.layerType.WMTS?new n.wrap.WmtsParser:new n.wrap.WmsParser;if(a=s.read(o),n.type===r.Z.Consts.layerType.WMTS&&a.Contents&&a.Contents.Layer){const t=o.getElementsByTagName("Layer");for(var l=0,c=t.length;l<c;l++){const e=t[l];var u=r.Z.Util.getElementByNodeName(e,"ows:Identifier")[0].firstChild.data,p=a.Contents.Layer.filter((function(t){return t.Identifier==u}));if(p.length){p=p[0];for(var d=0;d<p.TileMatrixSetLink.length;d++){var h=p.TileMatrixSetLink[d];let t=h.TileMatrixSet;var f;const n=e.getElementsByTagName("TileMatrixSetLink");for(var m=0,g=n.length;m<g;m++){const e=n[m];if(e.querySelector("TileMatrixSet:first").textContent==t){f=e;break}}if(f){h.TileMatrixSetLimits=[];const t=f.getElementsByTagName("TileMatrixLimits");for(m=0,g=t.length;m<g;m++){const e=t[m];h.TileMatrixSetLimits.push({TileMatrix:e.getElementsByTagName("TileMatrix")[0].textContent,MinTileRow:parseInt(e.getElementsByTagName("MinTileRow")[0].textContent),MinTileCol:parseInt(e.getElementsByTagName("MinTileCol")[0].textContent),MaxTileRow:parseInt(e.getElementsByTagName("MaxTileRow")[0].textContent),MaxTileCol:parseInt(e.getElementsByTagName("MaxTileCol")[0].textContent)})}}}}}}}return i(n,a),Promise.resolve(a)}return new Promise((function(s,l){t&&"string"==typeof o?e.then((function(t){var e=new Worker(t);e.onmessage=function(t){"success"===t.data.state?(a=t.data.capabilities,i(n,a)):(a={error:"Web worker error: "+n.url},l(a.error)),s(a),e.terminate()},e.postMessage({type:n.type,text:o,url:r.Z.apiLocation.indexOf("http")>=0?r.Z.apiLocation:document.location.protocol+r.Z.apiLocation})})):s(a=o)}))})(o,l.responseText).then((function(t){t.error?s(Error(n(o,t.error))):a(t)})).catch((function(t){delete o._onlineCapabilitesPromise,s(Error(t))}))})).catch((function(t){delete o._onlineCapabilitesPromise,s(Error(n(o,t)))}))}))},r.Z.Layer.prototype.getCapabilitiesFromStorage=function(){var t=this;return new Promise((function(e,n){const r=o(t.url);a().getItem(t.CAPABILITIES_STORE_KEY_PREFIX+t.type+"."+r.href).then((function(t){t?e(t):n(Error("Capabilities not in storage: "+r.href))})).catch((function(){n(Error("Undefined storage error"))}))}))}}();const s=r.Z.Layer},9774:(t,e,n)=>{"use strict";n.d(e,{Z:()=>vt});var r=n(5361),o=n(2089),i=n(4769),a=n(5798),s=n(6498),l=n(2530),c=n(6947),u=n(1774);r.Z.Layer=l.Z,r.Z.layer=r.Z.layer||{},r.Z.layer.Vector=c.Z,r.Z.tool=r.Z.tool||{},r.Z.tool.Proxification=u.Z,r.Z.Consts.BLANK_IMAGE="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7";const p={};!function(){const t=new Map;var e=null;const n=function(t){return new Promise((function(n,o){e&&e.options.url===t||(e=new r.Z.layer.Vector({type:r.Z.Consts.layerType.WFS,url:t,stealth:!0})),n(e)}))},o=function(t){var e=Array.isArray(t.names)?t.names.join(","):t.names,n=t.options.format,o=t.options,i={LAYERS:e,FORMAT:n,TRANSPARENT:t.transparent,VERSION:t.capabilities.version||"1.3.0"};t.params&&r.Z.Util.extend(i,t.params),t.queryParams&&r.Z.Util.extend(i,t.queryParams);var a=t.getPreferredInfoFormat();return null!==a&&(i.INFO_FORMAT=a),o.filter&&(o.filter instanceof r.Z.filter.Filter?i.filter=o.filter.getText():(new DOMParser).parseFromString(o.filter,"text/xml").querySelector("parsererror")?i.cql_filter=o.filter:i.filter=o.filter),t.wrap.createWMSLayer(t.getGetMapUrl(),i,o)},i=function(t){return t.wrap.createWMTSLayer(t.options)},a=function t(e,n){var r=e.availableNames.indexOf(n.name);if(-1===r)for(var o=0,i=n.children.length;o<i&&-1===(r=t(e,n.children[o]));o++);return r},s=function t(e,n){n.children.sort((function(t,n){return a(e,n)-a(e,t)}));for(var r=0,o=n.children.length;r<o;r++)t(e,n.children[r])},l=function t(e,n,r){var o=!1;if(r.count=r.count+1,e.name===n)o=!0;else for(var i=e.children.length-1;i>=0;i--)if(t(e.children[i],n,r)){o=!0;break}return o};r.Z.layer.Raster=function(){var e=this;if(r.Z.tool&&r.Z.tool.Proxification||r.Z.syncLoadJS(r.Z.apiLocation+"TC/tool/Proxification"),this.toolProxification=new r.Z.tool.Proxification(r.Z.proxify),this._capabilitiesPromise=null,r.Z.Layer.apply(e,arguments),e.wrap=new r.Z.wrap.layer.Raster(e),e.transparent=!1!==e.options.transparent,e.url=e.options.url,e.capabilities=r.Z.capabilities[e.url],e.params=e.options.params,"string"==typeof e.options.layerNames)e.names=e.availableNames=e.options.layerNames.split(",");else if(e.names=[],e.availableNames=[],Array.isArray(e.options.layerNames))for(var n=0;n<e.options.layerNames.length;n++){const t=e.options.layerNames[n];"string"==typeof t?(e.names.push(t),e.availableNames.push(t)):Object.prototype.hasOwnProperty.call(t,"name")&&(e.availableNames.push(t.name),(void 0===t.isVisible||t.isVisible)&&e.names.push(t.name))}else{var a=e.options.params?e.options.params.sld_body:null;if(a){const t=new DOMParser;var s;try{s=t.parseFromString(a,"text/xml")}catch(t){r.Z.error(t.message),s=null}if(s){var l=r.Z.Util.getElementByNodeName(s,"sld:NamedLayer");if(l&&l.length>0){var c=r.Z.Util.getElementByNodeName(l[0],"sld:Name");if(c&&c.length>0){const t=c[0].textContent;e.names.push(t),e.availableNames.push(t)}}}}}e.ignorePrefixes=void 0===e.options.ignorePrefixes||e.options.ignorePrefixes,e._capabilitiesNodes=new Map,e.wrap._promise=new Promise((function(n,a){const s=function(t){e.wrap.setLayer(t),t?n(t):a(Error('Could not create native layer for "'+e.id+'"'))},l=function(t){e.capabilities=e.capabilities||t;var n=e.getGetMapUrl();r.Z.capabilities[e.options.url]=r.Z.capabilities[e.options.url]||t,r.Z.capabilities[n]=r.Z.capabilities[n]||t,function(){let t;if(!e.wrap.layer)switch(e.type){case r.Z.Consts.layerType.GROUP:s(t);break;case r.Z.Consts.layerType.WMTS:try{t=i(e),s(t)}catch(n){e.getCapabilitiesOnline().then((function(n){e.capabilities=n;try{t=i(e),s(t)}catch(t){a(t)}}))}break;default:t=o(e),s(t)}}()};if(e.capabilities)return l(e.capabilities),void(e._capabilitiesPromise=Promise.resolve(e.capabilities));e._capabilitiesPromise=t.get(e.url)||new Promise((function(t,n){const r=e.getCapabilitiesOnline(),o=e.getCapabilitiesFromStorage();r.then((function(e){t(e)})).catch((function(t){o.catch((function(){n(t)}))})),o.then((function(e){t(e)})).catch((function(){r.catch((function(t){n(t)}))}))})),t.set(e.url,e._capabilitiesPromise),e.getCapabilitiesPromise().then((function(t){l(t)})).catch((function(t){e.map&&e.map.trigger(r.Z.Consts.event.LAYERERROR,{layer:e,reason:"couldNotGetCapabilities"}),a(t)}))})),e._disgregatedLayerNames=null,r.Z.Consts.layerType.WMTS===e.type&&e.wrap.setWMTSUrl()},r.Z.inherit(r.Z.layer.Raster,r.Z.Layer);var c=r.Z.layer.Raster.prototype;c.capabilitiesState_={PENDING:0,DONE:1},c.getByProxy_=function(t){return r.Z.proxify(t)},c.getByUrl_=function(t){return t},c.setVisibility=function(t){this.tree=null,r.Z.Layer.prototype.setVisibility.call(this,t)};var u=function t(e,n,r){var o=!1,i=e.wrap.getLayerNodes(r);if(i.length){i.forEach((r=>{t(e,n,r)&&(o=!0)}));var a,s,l=i.map((function(t){return e.wrap.getName(t)})).reverse(),c=!1;if(s=a=n.indexOf(l[0]),a<0)c=!0;else for(var u=1,p=l.length;u<p;u++)if(l[u]!=n[++a]){c=!0;break}if(!c){var d=e.wrap.getName(r);d&&l.length>1&&(n.splice(s,l.length,d),o=!0)}}return o},d=function(t,e){for(var n=[],r=e.slice(),o=t.wrap.getRootLayerNode(),i=0,a=r.length;i<a;i++)n=n.concat(h(t,r[i],o));return n},h=function t(e,n,r,o){for(var i=[],a=e.wrap.getName(r),s=e.compareNames(n,a),l=!1,c=e.wrap.getLayerNodes(r),u=0;u<c.length;u++){var p=t(e,n,c[u],o||s);p.length?i=i.concat(p):l=!0}return c.length&&!l||(o||s)&&(i=[a]),i},f=function(t){return r.Z.Util.extend({aggregate:!0,lazy:!1},t)},m=function(t,e,n){var r,o,i=[];r=e||[],o=n||[];for(var a=(t||[]).concat(r),s=0;s<a.length;s++)a.indexOf(a[s])===s&&-1===o.indexOf(a[s])&&i.push(a[s]);return i},g=function(t,e){var n="string"==typeof e?e.split(","):e;if(t.capabilities){var r=t.getTree();n.sort((function(t,e){var n={count:0},o={count:0};return l(r,t,n),l(r,e,o),n.count-o.count}))}return n},y=function(t,e,n,r){return n.some((function(n){return t.compareNames(e,n,r)}))},v=function(t){const e=this;return e.getDisgregatedLayerNames().some((n=>e.getNodePath(n).some((e=>e.Name===t||!e.Name&e.Title===t))))};c.getLimitedMatrixSet=function(){const t=this,e=t.layerNames,n=t.matrixSet;var o=t.capabilities;const i=o.Contents.TileMatrixSet.find((t=>t.Identifier===n));if(i){const t=o.Contents.Layer.find((t=>t.Identifier===e));if(t.TileMatrixSetLink){const e=t.TileMatrixSetLink.find((t=>t.TileMatrixSet===n));if(e&&e.TileMatrixSetLimits&&e.TileMatrixSetLimits.length){const t=[];return e.TileMatrixSetLimits.forEach((function(e){const n=i.TileMatrix.find((t=>t.Identifier===e.TileMatrix));n&&t.push(r.Z.Util.extend({matrixIndex:i.TileMatrix.indexOf(n)},n,e))})),t}return i.TileMatrix}return i.TileMatrix}return null},c.setLayerNames=function(t,e){var n=this;return new Promise((function(o,i){n.wrap.getLayer().then((function(){var i=Array.isArray(t)?t:t.split(",");n.names=i;var a=f(e);a.aggregate&&(i=function(t,e){if(t.type!==r.Z.Consts.layerType.WMS)return e;var n=e.slice();return u(t,n,t.wrap.getRootLayerNode()),n}(n,i)),n._disgregatedLayerNames=null;var s={LAYERS:i.join(","),TRANSPARENT:!0};if(a.lazy){var l=n._newParams||n.wrap.getParams();n._newParams=r.Z.Util.extend(l,s)}else n.map&&n.map.trigger(r.Z.Consts.event.BEFOREUPDATEPARAMS,{layer:n}),n.tree=null,n.wrap.setParams(s),!a.reset&&n.map||(n.availableNames=n.names),n.map&&n.map.trigger(r.Z.Consts.event.UPDATEPARAMS,{layer:n});o(n.names)}))}))},c.setFilter=function(t){var e=this;return new Promise((function(n,o){e.wrap.getLayer().then((function(){var o=e.wrap.getParams();delete o.filter,delete o.cql_filter,t instanceof r.Z.filter.Filter?e.filter=o.filter=t.getText():(new DOMParser).parseFromString(t,"text/xml").querySelector("parsererror")?e.filter=o.cql_filter=t:e.filter=o.filter=t,e.wrap.setParams(o),n(t)}))}))},c.addLayerNames=function(t,e){const n=this;return new Promise((function(r,o){n.wrap.getLayer().then((function(){var o=f(e),i=Array.isArray(t)?t:t.split(","),a=n.wrap.getParams().LAYERS;o.aggregate&&(i=d(n,i),a=n.getDisgregatedLayerNames()),n.setLayerNames(g(n,m(a,i,null)),e).then((function(t){r(t)}))}))}))},c.removeLayerNames=function(t,e){const n=this;return new Promise((function(r,o){n.wrap.getLayer().then((function(){var o=f(e),i=Array.isArray(t)?t:t.split(","),a=n.wrap.getParams().LAYERS;o.aggregate&&(i=d(n,i),a=n.getDisgregatedLayerNames()),n.setLayerNames(g(n,m(a,null,i)),e).then((function(t){r(t)}))}))}))},c.toggleLayerNames=function(t,e){const n=this;return new Promise((function(r,o){n.wrap.getLayer().then((function(){var o=f(e),i=Array.isArray(t)?t:t.split(","),a=n.wrap.getParams().LAYERS;o.aggregate&&(i=d(n,i),a=n.getDisgregatedLayerNames());for(var s=[],l=[],c=0;c<i.length;c++){var u=i[c];a.indexOf(u)<0?s.push(u):l.push(u)}var p=[];s.length>0&&p.push(n.addLayerNames(s,o)),l.length>0&&p.push(n.removeLayerNames(l,o)),Promise.all(p).then((function(t){const e=t[0],n=t[1];r(e?n?e.concat(n):e:[])}))}))}))},c.getDisgregatedLayerNames=function(){var t=this,e=t.wrap.layer;if(t.wrap.isNative(e)&&t.type===r.Z.Consts.layerType.WMS){if(!t._disgregatedLayerNames){var n=t.wrap.getParams().LAYERS;n=Array.isArray(n)?n:n.split(","),t._disgregatedLayerNames=d(t,n)}}else t._disgregatedLayerNames=t.names;return t._disgregatedLayerNames.slice()},c.isValidFromNames=function(){for(var t=this,e=!0,n=0,r=t.names.length;n<r;n++)if(!t.getLayerNodeByName(t.names[n])){e=!1;break}return e},c.isCompatible=function(t){var e=this,n=!1;switch(e.type){case r.Z.Consts.layerType.WMTS:n=e.wrap.isCompatible(t)||e.wrap.getCompatibleMatrixSets(t).length>0;break;case r.Z.Consts.layerType.WMS:n=e.wrap.isCompatible(t)}return n},c.getCompatibleCRS=function(t){const e=this;t=t||{};var n=e.wrap.getCompatibleCRS();if(t.includeFallback&&e.fallbackLayer){const t=e.getFallbackLayer();t instanceof r.Z.Layer&&(n=n.concat(t.wrap.getCompatibleCRS()))}return t.normalized&&(n=n.map((function(t){return r.Z.Util.getCRSCode(t)})).filter((function(t){return null!==t})).reduce((function(t,e){return t.indexOf(e)<0&&t.push(e),t}),[]).map((function(t){return"EPSG:"+t}))),n},c.getProjection=function(){var t=this;switch(t.type){case r.Z.Consts.layerType.WMTS:return t.wrap.layer.getSource().getProjection().getCode();case r.Z.Consts.layerType.WMS:return t.map.crs}},c.setProjection=function(t){var e=this;if((t=t||{}).crs)switch(e.type){case r.Z.Consts.layerType.WMTS:var n=e.wrap.getCompatibleMatrixSets(t.crs)[0];n?(e.matrixSet=n,e.wrap.setMatrixSet(n)):e.wrap.setProjection(t),e.mustReproject=!n;break;case r.Z.Consts.layerType.WMS:e.wrap.setProjection(t),e.mustReproject=!e.isCompatible(t.crs)}},c.isVisibleByScale=function(t,e){var n,o,i,a=this,s=function(){return a.map.wrap.getResolution()*a.map.getMetersPerUnit()/28e-5};switch(a.type){case r.Z.Consts.layerType.WMTS:n=!1;var l=a.wrap.getTileMatrix(a.options.matrixSet);if(l)for(o=s(),i=0;i<l.length;i++){if(a.wrap.getScaleDenominators(l[i])[0]===o){n=!0;break}}break;case r.Z.Consts.layerType.WMS:n=!0;var c=a.wrap.getAllLayerNodes();if(c.length>0){var u;o=s(),parseInt(t).toString()===t&&(u=a._capabilitiesNodes.get(t)),u||(u=c.find((n=>a.compareNames(a.wrap.getName(n),t,e))));const r=function(t){const e=a.wrap.getScaleDenominators(t);return!(parseFloat(e[1])>o||parseFloat(e[0])<o)};if(u&&!(n=r(u))&&u.Layer&&u.Layer.length>0)return u.Layer.some(r)}break;default:n=!0}return n},c.isVisibleByName=function(t,e){const n=this;let o=!1;switch(n.type){case r.Z.Consts.layerType.WMTS:if(n.wrap.getWMTSLayer()){o=!0;break}break;case r.Z.Consts.layerType.WMS:{const r=function(t){return i(t,n.wrap.getRootLayerNode())},i=function t(r,o){let i=[];const a=n.wrap.getName(o);if(n.compareNames(a,r,e))i.push(a);else{const e=n.wrap.getLayerNodes(o);let s=!1;e.forEach((e=>{const n=t(r,e);n.length&&(s=!0,i=i.concat(n))})),s&&i.push(a)}return i};o=r(t).some((t=>y(n,t,n.names)));break}default:o=!0}return o},c.isVisibleByNode=function(t){const e=this;let n=!1;switch(e.type){case r.Z.Consts.layerType.WMTS:if(e.wrap.getWMTSLayer()){n=!0;break}break;case r.Z.Consts.layerType.WMS:{const r=function(t,e){return t===e||t.Layer&&t.Layer.some((t=>r(t,e)))};for(var o=0,i=e.names.length;o<i;o++){if(e.getLayerNodesByName(e.names[o]).some((e=>r(e,t)))){n=!0;break}}break}default:n=!0}return n},c.getNestedTree=function(){return this.getTree(!1,!0)},c.getFullTree=function(){return this.getTree(!0)},c.getTree=function(t,e=!1){const n=this;void 0===t&&(t=!n.options.hideTree);var o=!t&&!e&&n.tree;if(!o){let i;const a=function t(e,o,a,s){let l;for(var c of n._capabilitiesNodes.keys())if(n._capabilitiesNodes.get(c)===e){l=c;break}l||(l=r.Z.getUID(),n._capabilitiesNodes.set(l,e));let u={name:n.wrap.getName(e),title:e.title||e.Title,uid:l,children:[],abstract:!!e.Abstract,metadata:!!e.MetadataURL};if(a&&(i=u),y(n,u.name,n.availableNames)&&(o=!0),s){if(!a&&!v.apply(n,[u.name||u.title]))return null;o=!0}if(n.options.isBase)u.name=n.names.join(","),u.title=n.title||u.title,u.isBase=n.isDefault,n.options.thumbnail&&(u.legend={src:n.options.thumbnail});else{var p;u.isVisible=u===i?n.getVisibility():n.isVisibleByName(u.name);var d=n.wrap.getLayerNodes(e);for(p=0;p<d.length;p++){const e=t(d[p],o,void 0,s);e&&(h=u,(f=e).parent=h,n.options.inverseTree?r.Z.Util.fastUnshift(h.children,f):h.children.push(f))}u.legend=n.wrap.getLegend(e),o||a||(i.children=i.children.concat(u.children),u=null)}var h,f;return u};switch(n.type){case r.Z.Consts.layerType.WMTS:o=a(n.wrap.getWMTSLayer(),!n.options.hideTree,!0);break;case r.Z.Consts.layerType.WMS:if(n.capabilities){!function t(e){let n=r.Z.Consts.visibility.NOT_VISIBLE;if(e){if(e.children)for(var o=0,i=e.children.length;o<i;o++){var a=t(e.children[o]);if(a===r.Z.Consts.visibility.VISIBLE||a===r.Z.Consts.visibility.HAS_VISIBLE){n=r.Z.Consts.visibility.HAS_VISIBLE;break}}e.isVisible&&(n=r.Z.Consts.visibility.VISIBLE),e.visibilityState=n}return n}(o=a(n.wrap.getRootLayerNode(),t||!n.options.hideTree,!0,e)),n.options.hideTree&&s(n,o)}}o||(o={name:n.name,title:n.title}),o.title=n.title||o.title,o.customLegend=n.customLegend||o.customLegend,t||(n.tree=o)}return o},c.setNodeVisibility=function(t,e){const n=this,o=r.Z.Layer.prototype.setNodeVisibility.call(n,t,e);if(n.isRoot(o))e&&0===n.names.length?n.addLayerNames(n.availableNames).then((function(){n.setVisibility(!0)})):n.setVisibility(e);else{var i=function t(e){var n=[];if(e.name)n[0]=e.name;else for(var r=0;r<e.children.length;r++)n=n.concat(t(e.children[r]));return n}(o);e?n.addLayerNames(i):n.removeLayerNames(i)}return o},c.getNodePath=function(t,e){var n=this,o=[];if(n.type===r.Z.Consts.layerType.WMS&&n.capabilities){t=t||n.names[0];o=function o(i){var a=[],s=n.wrap.getName(i);if(n.compareNames(s,t,e))a.push(i);else for(var l=n.wrap.getLayerNodes(i),c=0;c<l.length;c++){var u=o(l[c]);if(u.length){a=u,r.Z.Util.fastUnshift(a,i);break}}return a}(n.wrap.getRootLayerNode())}return o},c.getPath=function(t,e){return this.getNodePath(t,e).map((function(t){return t.title||t.Title}))},c.getLayerNodesByName=function(t){const e=[],n=this,o=n.wrap.getServiceType()===r.Z.Consts.layerType.WMTS?n.wrap.getIdentifier:n.wrap.getName,i=n.wrap.getAllLayerNodes();for(var a=0,s=i.length;a<s;a++)n.compareNames(o(i[a]),t)&&e.push(i[a]);return e},c.getLayerNodeByName=function(t){const e=this.getLayerNodesByName(t);return e.length?e[0]:null},c.getChildrenLayers=function(t){var e=[],n=function(t,e){if(t&&t.Layer&&t.Layer.length)for(var r=0;r<t.Layer.length;r++)e.push(t.Layer[r]),n(t.Layer[r],e)};return n(t,e),e},c.compareNames=function(t,e,n){var r=t===e,o=void 0!==n?n:this.ignorePrefixes;if(!r&&o&&t&&e){var i=t.indexOf(":"),a=e.indexOf(":");i>=0&&a<0?r=t.substr(i+1)===e:a>=0&&i<0&&(r=t===e.substr(a+1))}return r},c.getCapabilitiesPromise=function(){return this._capabilitiesPromise},c.getResolutions=function(){return this.wrap.getResolutions()},c.setResolutions=function(t){this.wrap.setResolutions(t)};const _=function(t,e,n){const o=r.Z.Util.reproject([t[0],t[3]],e,n),i=r.Z.Util.reproject([t[0],t[1]],e,n),a=r.Z.Util.reproject([t[2],t[3]],e,n),s=r.Z.Util.reproject([t[2],t[1]],e,n),l=new Array(4);return l[0]=Math.min(o[0],i[0]),l[1]=Math.min(i[1],s[1]),l[2]=Math.max(a[0],s[0]),l[3]=Math.max(o[1],a[1]),l};c.getExtent=function(t){const e=this;t=t||{};let n=null;if(e.type===r.Z.Consts.layerType.WMS){const a=function(t){let e=null;return t.BoundingBox&&(e=Array.isArray(t.BoundingBox)?t.BoundingBox:[t.BoundingBox]),t.EX_GeographicBoundingBox&&(e=e||[],e.unshift({crs:"EPSG:4326",extent:t.EX_GeographicBoundingBox})),!e&&t.parent?a(t.parent):e},s=new Array(e.names.length);for(var o=0,i=s.length;o<i;o++){const t=e.getLayerNodeByName(e.names[o]),n=a(t);if(!n)return null;s[o]=n}const l=t.crs||e.map&&e.map.getCRS()||"EPSG:4326",c=r.Z.Util.getCRSCode(l);n=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],s.map((function(t){let e,n;if(t.forEach((function(t,o){0===o&&(e=t),r.Z.Util.getCRSCode(t.crs)===c&&(n=t)})),n)return{crs:l,extent:n.extent};let o=e.crs;return"CRS:84"===o&&(o="EPSG:4326"),{crs:o,extent:e.extent}})).reduce((function(t,e){let n=t.get(e.crs);const r=e.extent;return n?(n[0]=Math.min(n[0],r[0]),n[1]=Math.min(n[1],r[1]),n[2]=Math.max(n[2],r[2]),n[3]=Math.max(n[3],r[3])):n=r,t.set(e.crs,n),t}),new Map).forEach((function(t,e){if(r.Z.Util.getCRSCode(e)===c)n[0]=Math.min(t[0],n[0]),n[1]=Math.min(t[1],n[1]),n[2]=Math.max(t[2],n[2]),n[3]=Math.max(t[3],n[3]);else{const r=_(t,e,l);n[0]=Math.min(r[0],n[0]),n[1]=Math.min(r[1],n[1]),n[2]=Math.max(r[2],n[2]),n[3]=Math.max(r[3],n[3])}}))}else if(e.type===r.Z.Consts.layerType.WMTS){const t=e.names[0],o=e.capabilities.Contents.Layer.find((e=>e.Identifier===t));if(o){const t=e.capabilities.Contents.TileMatrixSet.find((t=>t.Identifier===e.matrixSet));if(t&&(o.BoundingBox||o.WGS84BoundingBox)){if(Array.isArray(o.BoundingBox)){const e=o.BoundingBox.find((e=>r.Z.Util.CRSCodesEqual(e.crs,t.SupportedCRS)));if(e){const t=t=>t.split(" ").map((t=>parseFloat(t))),r=t(e.LowerCorner),o=t(e.UpperCorner);n=[r[0],r[1],o[0],o[1]]}}!n&&o.WGS84BoundingBox&&(n=_(o.WGS84BoundingBox,"EPSG:4326",t.SupportedCRS))}}}return n};const C={};c.getInfo=function(t){const e=this,n=e.wrap.getInfo(t);return n.metadata&&n.metadata.forEach((function(t){e.map?t.formatDescription=C[t.format]=C[t.format]||r.Z.Util.getLocaleString(e.map.options.locale,r.Z.Util.getSimpleMimeType(t.format))||r.Z.Util.getLocaleString(e.map.options.locale,"viewMetadata"):t.formatDescription=C[t.format]})),n},c.searchSubLayers=function(t){if(this.patternFn||(this.patternFn=function(t){return t=(t=(t=(t=(t=(t=(t=t.replace(/[^a-z\dáéíóúüñ]/gi,"\\$&")).replace(/(a|á)/gi,"(a|á)")).replace(/(e|é)/gi,"(e|é)")).replace(/(i|í)/gi,"(i|í)")).replace(/(o|ó)/gi,"(o|ó)")).replace(/(u|ú|ü)/gi,"(u|ú|ü)")).replace(/n/gi,"(n|ñ)")}),t&&t.length&&t.length>=3){var e=this,n=null;if(this.lastPattern&&t.indexOf(this.lastPattern)>=0)n=this.lastMatches;else if(e.availableNames&&e.availableNames.length>0){n=[];for(var o=0;o<e.availableNames.length;o++){var i=e.getLayerNodeByName(e.availableNames[o]);i&&(n.push(i),n=n.concat(e.getChildrenLayers(i)))}}else n=e.wrap.getAllLayerNodes();var a=this.patternFn(t),s=new RegExp(a,"i"),l=n.map((function(t,n){delete t.tcScore,t.tcPosition=n,e.wrap.normalizeLayerNode(t);var r=t.Title.trim(),o=s.exec(r),i=o?o.index:-1,a=-1;if(t.Abstract){var l=t.Abstract.trim(),c=s.exec(l);a=c?c.index:-1}return o&&r==o[0]?t.tcScore=20:0==i?t.tcScore=15:i>-1?t.tcScore=10:0==a?t.tcScore=5:a>-1&&(t.tcScore=1),t.tcScore?t:null})).filter((function(t){return null!=t})).sort((function(t,e){if(e.tcScore===t.tcScore){var n=r.Z.Util.replaceSpecialCharacters(t.Title),o=r.Z.Util.replaceSpecialCharacters(e.Title);return n<o?-1:n>o?1:0}return e.tcScore-t.tcScore}));return this.lastPattern=t,this.lastMatches=l,l}return[]},c.getGetCapabilitiesUrl=function(){const t=this;var e;const n=t.url,o={};if(t.type===r.Z.Consts.layerType.WMTS)if(t.options.encoding===r.Z.Consts.WMTSEncoding.RESTFUL){var i="/1.0.0/WMTSCapabilities.xml";const t=n.indexOf(i);t<0||t<n.length-i.length?("/"===n[n.length-1]&&(i=i.substr(1)),e=n+i):e=n}else e=n,o.SERVICE="WMTS",o.VERSION="1.0.0",o.REQUEST="GetCapabilities";else e=n,o.SERVICE="WMS",o.VERSION="1.3.0",o.REQUEST="GetCapabilities";return e=e+"?"+r.Z.Util.getParamString(r.Z.Util.extend(o,t.queryParams))},c.getPreferredInfoFormat=function(){var t=null;const e=this.wrap.getInfoFormats();if(e)for(var n=0;n<r.Z.wrap.layer.Raster.infoFormatPreference.length;n++){var o=r.Z.wrap.layer.Raster.infoFormatPreference[n];if(e.indexOf(o)>=0){t=o;break}}return t},c.getLegendGraphicImage=function(){const t=this;return new Promise((function(e,n){if(t.options.params.base64LegendSrc)return e(t.options.params.base64LegendSrc);if("function"==typeof window.btoa){for(var r=t.names[0],o=t.wrap.getInfo(r),i=new XMLHttpRequest,a=o.legend[0].src.split("?"),s=a[1].split("&"),l=t.options.params.sld_body?"sld_body="+t.options.params.sld_body:"",c=0;c<s.length;c++){var u=s[c].split("=");u&&u.length>1&&u[1]&&(l+="&"+s[c])}t.options.params.env&&(l+="&"+t.options.params.env),i.open("POST",a[0],!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.responseType="arraybuffer",i.onload=function(n){if(200===this.status){for(var r=new Uint8Array(this.response),o=r.length,a=new Array(o);o--;)a[o]=String.fromCharCode(r[o]);var s,l=a.join(""),c=i.getResponseHeader("content-type");if(0===c.indexOf("image"))s="data:"+c+";base64,"+window.btoa(l),t.options.params.base64LegendSrc=s,e(s)}},i.send(l)}else n(Error("Función window.btoa no soportada por el navegador"))}))},c.getUrl=function(t){return t},c.getWebGLUrl=function(t,e){const n=this;return new Promise((function(e,o){var i=!r.Z.Util.isSecureURL(t)&&r.Z.Util.isSecureURL(r.Z.Util.toAbsolutePath(n.url))?n.getBySSL_(t):t;if(n.ignoreProxification)e(i);else{const t={exportable:!0,ignoreProxification:n.ignoreProxification};n.toolProxification.fetchImage(i,t).then((function(){let r=n.toolProxification.cacheHost.getAction(i,t);r?r.then((function(t){t&&t.action&&e(t.action.call(n.toolProxification,i))})):o("No action to "+i)})).catch((function(t){o(t)}))}}))},c.getFeatureUrl=function(t){var e=this;return e.toolProxification.fetch(t).then((function(){return e.toolProxification.cacheHost.getAction(t).then((function(n){return n.action.call(e.toolProxification,t)})).catch((function(t){return Promise.reject(t)}))})).catch((function(t){return Promise.reject(t)}))},c.getSiblingLoadedLayer=function(t){var e=this;if(e.map){return e.map.baseLayers.slice(0).concat(e.map.workLayers.slice(0)).filter((function(n){return(n.type===r.Z.Consts.layerType.WMS||n.type===r.Z.Consts.layerType.WMTS)&&(n.capabilities===e.capabilities||n.url===e.url)&&(!r.Z.Util.isFunction(t)||t(n))}))[0]||null}return null},c.getImageLoad=function(t,e,n){const o=this,i=function(e){const n=t.getImage();r.Z.Util.isSameOrigin(e.src)||o.map&&!o.map.crossOrigin||(n.crossOrigin=null!==e.crossOrigin?e.crossOrigin:o.map?o.map.crossOrigin:"anonymous"),n.setAttribute("src",e.src),n.onload=function(){E.call(o).trigger(r.Z.Consts.event.TILELOAD,{tile:t})},n.onerror=function(e){n.setAttribute("src",r.Z.Consts.BLANK_IMAGE),E.call(o).trigger(r.Z.Consts.event.TILELOADERROR,{tile:t,error:{code:e.status,text:e.statusText}})}};if(o.names&&o.names.length>0){const n=function(e){E.call(o).trigger(r.Z.Consts.event.TILELOADERROR,{tile:t,error:{code:e.status,text:e.statusText}}),i({src:r.Z.Consts.BLANK_IMAGE})};if(o.type===r.Z.Consts.layerType.WMTS){var a,s,l;if("KVP"!==o.encoding){var c=e.replace("."+o.format.split("/")[1],"");const t=c.split("/").slice(c.split("/").length-3).map((function(t){return parseInt(t)}));a=t[0],s=t[1],l=t[2]}else{let t=/.*TileMatrix=(\d*)&TileCol=(\d*)&TileRow=(\d*)/i.exec(e);t&&4===t.length&&(t=t.slice(1).map((function(t){return parseInt(t)})),a=t[0],s=t[2],l=t[1])}if(a&&s&&l){var u=o.wrap.getWMTSLayer();if(u){const t=u.TileMatrixSetLink.find((t=>t.TileMatrixSet===o.matrixSet));if(t&&t.TileMatrixSetLimits&&t.TileMatrixSetLimits.length>0){var p=t.TileMatrixSetLimits.sort((function(t,e){return parseInt(t.TileMatrix)>parseInt(e.TileMatrix)?1:parseInt(t.TileMatrix)<parseInt(e.TileMatrix)?-1:0}))[a];if(p&&o.map&&o.map.on3DView&&!(p.MinTileRow<=s&&p.MaxTileRow>=s&&p.MinTileCol<=l&&p.MaxTileCol>=l))return console.log("Prevenimos petición fuera de matrix set, cargamos imagen en blanco"),void i({src:r.Z.Consts.BLANK_IMAGE})}}}}E.call(o).trigger(r.Z.Consts.event.BEFORETILELOAD,{tile:t});var d="";if("POST"===o.options.method){var h=e.split("?");d=h[1].split("&").filter((function(t){const e=t.split("=");return e.length>1&&e[1].trim().length>0&&"layers"!==e[0].trim().toLowerCase()})).join("&"),o.toolProxification.fetchImageAsBlob(h[0],{type:"POST",data:d,contentType:"application/x-www-form-urlencoded"}).then((function(e){const n=URL.createObjectURL(e);t.getImage().onload=function(t){URL.revokeObjectURL(n)},i({src:n})})).catch(n)}else if(o.ignoreProxification){i({src:e});var f=t.getImage();r.Z.Util.isSameOrigin(e)||o.map&&!o.map.crossOrigin||(f.crossOrigin=o.map?o.map.crossOrigin:"anonymous"),f.onload=function(){E.call(o).trigger(r.Z.Consts.event.TILELOAD,{tile:t})},f.onerror=function(e){f.src=r.Z.Consts.BLANK_IMAGE,E.call(o).trigger(r.Z.Consts.event.TILELOADERROR,{tile:t,error:{code:e.status,text:e.statusText}})},f.src=o.names.length?e:r.Z.Consts.BLANK_IMAGE}else o.toolProxification.fetchImage(e,{exportable:!o.map||o.map.crossOrigin}).then((function(t){i(t)})).catch(n)}else i({src:r.Z.Consts.BLANK_IMAGE}),E.call(o).trigger(r.Z.Consts.event.TILELOAD,{tile:t})};var E=function(){const t=this;return t.wrap&&t.wrap.$events?t.wrap.$events:null};c.getWFSURL=async function(){const t=this;if(p[t.options.url])return await p[t.options.url];var e=new URL(t.url,document.location.href);return e.search=new URLSearchParams({request:"DescribeLayer",service:"WMS",version:"1.1.1",Layers:t.layerNames instanceof Array?t.layerNames[0]:t.layerNames,outputFormat:"application/json"}),p[t.options.url]=new Promise((async function(n,r){try{var o=await t.toolProxification.fetch(e.toString(),{method:"GET"});if(o.contentType.startsWith("application/json")){var i=JSON.parse(o.responseText).layerDescriptions[0];if("WFS"!==i.owsType)return void n(t.options.url.replace(/wms/gi,"wfs"));var a=i.owsURL.substr(0,i.owsURL.length+(i.owsURL.endsWith("?")?-1:0));t.toolProxification.fetch(a,{method:"HEAD"}).then((function(){n(a)})).catch((function(){n(t.options.url.replace(/wms/gi,"wfs"))}))}else{let e=(new DOMParser).parseFromString(o.responseText,"text/xml");if(e.querySelector("Exception ExceptionText")||e.querySelector("ServiceException"))n(t.options.url.replace(/wms/gi,"wfs"));else{const r=e.querySelector("LayerDescription");n(r&&(r.getAttribute("wfs")||r.getAttribute("owsURL"))||t.options.url.replace(/wms/gi,"wfs"))}}}catch(e){n(t.options.url.replace(/wms/gi,"wfs"))}}))},c.getWFSCapabilities=async function(){return n(await this.getWFSURL()).then((function(t){return t.getCapabilitiesPromise()}))},c.getDescribeFeatureTypeUrl=async function(){const t=await this.getWFSURL();return e&&e.options.url===t||(e=new r.Z.layer.Vector({type:r.Z.Consts.layerType.WFS,url:t,stealth:!0})),e.getDescribeFeatureTypeUrl(this.options.featureType)},c.getFallbackLayer=function(){const t=this;if(t.fallbackLayer instanceof r.Z.Layer)return t.fallbackLayer;if(t.options.fallbackLayer){var e=t.options.fallbackLayer;if("string"==typeof e){(t.map?t.map.options.availableBaseLayers:r.Z.Cfg.availableBaseLayers).forEach((function(e){t.options.fallbackLayer===e.id&&(t.fallbackLayer=new r.Z.layer.Raster(r.Z.Util.extend({},e,{isBase:!0,stealth:!0,map:t.map})),t.fallbackLayer.firstOption=t)}))}else e instanceof r.Z.Layer?(t.fallbackLayer=e,t.fallbackLayer.firstOption=t):(t.fallbackLayer=new r.Z.layer.Raster(r.Z.Util.extend({},e,{id:r.Z.getUID(),isBase:!0,stealth:!0,title:t.title,map:t.map})),t.fallbackLayer.firstOption=t);return t.fallbackLayer}return null},c.describeFeatureType=async function(t){const e=this,r=await e.getWFSURL();return n(r).then((function(n){return n.describeFeatureType(t||e.layerNames[0])}))},c.refresh=function(){return this.wrap.reloadSource()}}();const d=r.Z.layer.Raster;var h=n(9464),f=n(7738),m=n(1370),g=n(9014),y=n(1432),v=n(2273),_=n(9306),C=n(1977),E=n(3192),w=n(5153),S=n(2791),b=n(4313),L=n(3054),T=n(2890),P=n(7648),A=n(5539),O=n(8144),x=n(128),I=n(8703),M=n(7757),R=n(1115),Z=n(8924),D=n(8410),k=n(7901),N=n(1231),F=n(7746),U=n(3011),G=n(3571),B=n(273),j=n(6595),W=n(2e3),q=n(3731),H=n(1797),V=n(122),z=n(2582),Y=n(3739),K=n(2721),X=n(5277),$=n(8418),J=n(6200),Q=n(3905),tt=n(6145),et=n(1926),nt=n(9158),rt=n(9555),ot=n(3068),it=n(7570),at=n(907),st=n(2780),lt=n(956),ct=n(1475),ut=n(2197),pt=n(8719),dt=n(7381),ht=n(3869),ft=n(1373),mt=n(3698),gt=n(8633),yt=n(2641);r.Z.Consts=o.Z,r.Z.EventTarget=i.Z,r.Z.i18n=r.Z.i18n||a.Z,r.Z.Control=s.Z,r.Z.wrap=h.Z,r.Z.control=r.Z.control||{},r.Z.control.Attribution=f.default,r.Z.control.BasemapSelector=m.default,r.Z.control.CacheBuilder=g.default,r.Z.control.Click=y.default,r.Z.control.Container=v.default,r.Z.control.ControlContainer=_.default,r.Z.control.Coordinates=C.default,r.Z.control.DataLoader=E.default,r.Z.control.Download=w.default,r.Z.control.Draw=S.default,r.Z.control.DrawMeasureModify=b.default,r.Z.control.Edit=L.default,r.Z.control.Elevation=T.default,r.Z.control.ExternalWMS=P.default,r.Z.control.FeatureDownloadDialog=A.default,r.Z.control.FeatureInfo=O.default,r.Z.control.FeatureInfoCommons=x.default,r.Z.control.FeatureTools=I.default,r.Z.control.FileImport=M.default,r.Z.control.FullScreen=R.default,r.Z.control.Geolocation=Z.default,r.Z.control.GeometryFeatureInfo=D.default,r.Z.control.infoShare=k.default,r.Z.control.LayerCatalog=N.default,r.Z.control.Legend=F.default,r.Z.control.LineFeatureInfo=U.default,r.Z.control.ListTOC=G.default,r.Z.control.LoadingIndicator=B.default,r.Z.control.MapContents=j.default,r.Z.control.MapInfo=W.default,r.Z.control.Measure=q.default,r.Z.control.Modify=H.default,r.Z.control.MultiFeatureInfo=V.default,r.Z.control.NavBar=z.default,r.Z.control.NavBarHome=Y.default,r.Z.control.OfflineMapMaker=K.default,r.Z.control.OverviewMap=X.default,r.Z.control.PolygonFeatureInfo=$.default,r.Z.control.Popup=J.default,r.Z.control.Print=Q.default,r.Z.control.PrintMap=tt.default,r.Z.control.ProjectionSelector=et.default,r.Z.control.ResultsPanel=nt.default,r.Z.control.Scale=rt.default,r.Z.control.ScaleBar=ot.default,r.Z.control.ScaleSelector=it.default,r.Z.control.Search=at.default,r.Z.control.SelectContainer=st.default,r.Z.control.Share=lt.default,r.Z.control.StreetView=ct.default,r.Z.control.SWCacheClient=ut.default,r.Z.control.TabContainer=pt.default,r.Z.control.ThreeD=dt.default,r.Z.control.TOC=ht.default,r.Z.control.WFSEdit=ft.default,r.Z.control.WFSQuery=mt.default,r.Z.control.WorkLayerManager=gt.default,r.Z.layer=r.Z.layer||{},r.Z.layer.Raster=d,r.Z.layer.Vector=c.Z,r.Z.inherit=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t._super=e.prototype},r.Z.mix=function(t,...e){Object.assign(t.prototype,...e)},function(){(this||{}).CustomEvent="function"==typeof CustomEvent?CustomEvent:function(t){return e[t]=new e("").constructor[t],e;function e(t,e){e||(e={});var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!!e.bubbles,!!e.cancelable,e.detail),n}}("prototype"),Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector);var t=null,e=null;const o=function(){const t=this;var e=[r.Z.Consts.event.LAYERADD,r.Z.Consts.event.LAYERORDER,r.Z.Consts.event.LAYERREMOVE,r.Z.Consts.event.LAYERVISIBILITY,r.Z.Consts.event.ZOOM,r.Z.Consts.event.BASELAYERCHANGE,r.Z.Consts.event.UPDATEPARAMS].join(" ");let n=[r.Z.Consts.event.LAYERUPDATE,r.Z.Consts.event.FEATUREADD,r.Z.Consts.event.FEATUREREMOVE,r.Z.Consts.event.FEATUREMODIFY,r.Z.Consts.event.FEATURESADD,r.Z.Consts.event.FEATURESCLEAR,r.Z.Consts.event.UPDATEPARAMS].join(" ");t.on(n,(()=>t.trigger(r.Z.Consts.event.MAPCHANGE))),t.replaceCurrent=!0,c.call(t);const o=c.bind(t);var i;t.on(e,o),t.on(r.Z.Consts.event.LAYEROPACITY,(function(e){clearTimeout(i),i=setTimeout((function(){c.call(t,e)}),500)})),window.addEventListener("popstate",(function(n){var r;r=t.loadingCtrl&&t.loadingCtrl.addWait(),setTimeout((async function(){if(n){t.off(e,o);var i=n.state;"[object Object]"===Object.prototype.toString.call(i)&&(i=await t.checkLocation()),p.call(t,i).then((function(){setTimeout((function(){t.on(e,o)}),200),t.loadingCtrl&&t.loadingCtrl.removeWait(r)}))}}),4)}))};let i;const a={},s=function(t,e){return new Promise((function(n,o){(async function(){i||(i=r.Z.Util.getWebWorkerCrossOriginURL(r.Z.apiLocation+"TC/workers/tc-jsonpack-web-worker.js"));const t=await i,e=new Worker(t);return e.onmessage=function(t){const n=a[t.data.id];n&&(t.data.error?n.reject(t.data.error):n.resolve(t.data.result),e.terminate(),delete a[t.data.id])},e})().then((function(i){const s=r.Z.getUID();a[s]={resolve:n,reject:o},i.postMessage({id:s,action:t,object:e})}))}))},l=r.Z.Util.isFunction(DataTransferItem.prototype.getAsFileSystemHandle),c=async function(n){const o=this;var i=await u.call(o);if(o.replaceCurrent)return window.history.replaceState(i,null,null),void delete o.replaceCurrent;var a=function(){e=t,(t=r.Z.Util.utf8ToBase64(i))!==e&&window.history.pushState(i,null,window.location.href.split("#").shift()+"#"+t)};if(n){switch(o.lastEventType=n.type,!0){case n.type===r.Z.Consts.event.BASELAYERCHANGE:case n.type===r.Z.Consts.event.LAYERORDER:case n.type===r.Z.Consts.event.ZOOM:a();break;case n.type===r.Z.Consts.event.UPDATEPARAMS:n.layer.type===r.Z.Consts.layerType.WMS&&a();break;case n.type.toLowerCase().indexOf("LAYER".toLowerCase())>-1:(n.layer.type===r.Z.Consts.layerType.WMS||l&&n.layer.type===r.Z.Consts.layerType.VECTOR&&n.layer.options.file)&&a()}o.trigger(r.Z.Consts.event.MAPCHANGE)}},u=function(t){const e=this;return t=t||{},new Promise((function(n,o){var i={};e.crs!==e.options.crs&&(i.crs=e.crs);for(var a=e.getExtent(),c=0;c<a.length;c++)Math.abs(a[c])>180&&(a[c]=Math.floor(1e3*a[c])/1e3);i.ext=a;var u=[];e.baseLayers&&(u=e.baseLayers.filter((function(t){return t.isRaster()&&t.fallbackLayer})).map((function(t){return{baseLayer:t,fallbackLayerID:t.fallbackLayer.id}})).filter((function(t){return t.fallbackLayerID===(e.baseLayer?e.baseLayer.id:e.baseLayers[0].id)}))),u.length>0?i.base=u[0].baseLayer.id:(e.baseLayer||e.baseLayers&&e.baseLayers[0])&&(i.base=(e.baseLayer||e.baseLayers[0]).id),i.layers=[],e.workLayers.forEach((function(t){if(t.type!==r.Z.Consts.layerType.WMS||t.options.stateless){if(l&&t.type===r.Z.Consts.layerType.VECTOR&&t.options.file){const e={o:t.getOpacity(),v:t.getVisibility(),h:t.options.hideTitle,ur:t.unremovable,fn:t.options.file,t:t.title,i:t.id};i.layers.push(e)}}else if(t.layerNames=t.names||t.layerNames,t.layerNames&&t.layerNames.length||!1===t.hideTree){const e={u:r.Z.Util.isOnCapabilities(t.url),n:Array.isArray(t.names)?t.names.join(","):t.names,o:t.getOpacity(),v:t.getVisibility(),h:t.options.hideTitle,ur:t.unremovable,f:t.filter&&(t.filter instanceof r.Z.filter.Filter?t.filter.getText():t.filter),t:t.title,i:t.id};!1===t.hideTree&&(e.x=0),i.layers.push(e)}})),e.on3DView&&e.view3D.cameraControls&&(i.vw3=e.view3D.cameraControls.getCameraState()),t.extraStates&&r.Z.Util.extend(i,t.extraStates),!t.cacheResult&&e._controlStatesCache&&delete e._controlStatesCache,e._controlStatesCache?n(e._controlStatesCache):s("pack",i).then((r=>{t.cacheResult&&(e._controlStatesCache=r),n(r)})).catch((t=>o(t)))}))},p=function(t){const e=this,n=[];return t?(e.loadingctrl||(e.loadingCtrl=e.getControlsByClass("TC.control.LoadingIndicator")[0]),e.hasWait||(e.hasWait=e.loadingCtrl&&e.loadingCtrl.addWait()),new Promise((function(o,i){var a=function(){e.loadingCtrl&&e.loadingCtrl.removeWait(e.hasWait),delete e.hasWait,o()};let l;l="string"==typeof t?new Promise((function(n,o){s("unpack",t).then((t=>n(t))).catch((e=>n(JSON.parse(t)))).catch((t=>{r.Z.error(r.Z.Util.getLocaleString(e.options.locale,"mapStateNotValid")),o(t)}))})):Promise.resolve(t),l.then((function(t){if(t.crs&&t.crs!==e.crs||void 0===t.crs&&e.crs!==e.options.crs)n.push(e.setProjection({crs:t.crs||e.options.crs,oldCrs:e.crs,extent:t.ext,baseLayer:e.getLayer(t.base)}));else{if(t.base!=e.getBaseLayer().id){e.getLayer(t.base)&&e.setBaseLayer(t.base);const r=e.baseLayers.filter((function(e){return e.options.fallbackLayer===t.base}))[0];if(r){const t=e.addLayer(r.getFallbackLayer());n.push(t),t.then((function(t){e.setBaseLayer(t)}))}}t.ext&&n.push(e.setExtent(t.ext,{animate:!1}))}if(t.layers=t.layers||t.capas||[],t.layers.length>0)for(var o=0;o<t.layers.length;o++){var i=t.layers[o],s=!1;let a;for(var l=0;l<e.options.workLayers.length;l++)a=r.Z.Util.extend({},e.options.workLayers[l],{map:e}),i.u===a.url&&(!a.layerNames||a.layerNames.length||a.layerNames.indexOf(i.n)>=0)&&(s=!0,a.renderOptions={opacity:i.o,hide:!i.v},a.unremovable=i.ur,a.title=i.t,a.hideTree=!Object.prototype.hasOwnProperty.call(i,"x")||!!i.x,i.n&&(a.layerNames=i.n),n.push(e.addOrUpdateLayer(a).then(function(t){t.setVisibility(this.v),t.setOpacity(this.o,!0)}.bind(i))));if(!s){const t={id:i.i||r.Z.getUID(),hideTitle:i.h,unremovable:i.ur,title:i.t,hideTree:!Object.prototype.hasOwnProperty.call(i,"x")||!!i.x,renderOptions:{opacity:i.o,hide:!i.v}};i.fn?(t.type=r.Z.Consts.layerType.VECTOR,t.file=i.fn):(t.url=r.Z.Util.isOnCapabilities(i.u,i.u.indexOf(window.location.protocol)<0)||i.u,t.layerNames=i.n?i.n.split(","):[]),n.push(e.addOrUpdateLayer(t).then(function(t){var e=t.wrap.getRootLayerNode();t.title=e.Title||e.title,t.setOpacity(this.o,!0),t.setVisibility(this.v)}.bind(i)))}}e.workLayers.filter((e=>e.type===r.Z.Consts.layerType.WMS&&!t.layers.some((t=>t.i===e.id)))).forEach((function(t){e.removeLayer(t)})),Promise.all(n).then((function(){a()})).catch((function(){a()}))})).catch((function(){a()}))}))):Promise.resolve()},d=function(t,e){return function(n,r,o){return r[t]===e?o:n}},h=function(t){return(this instanceof r.Z.Map?this.options.availableBaseLayers:r.Z.Cfg.availableBaseLayers).filter((function(e){return e.id===t}))[0]};r.Z.Map=r.Z.Map||function(t,i){const a=this;r.Z.EventTarget.call(a),r.Z.Map._instances.push(a),a.isReady=!1,a.isLoaded=!1,a.controls=[],a.activeControl=null,a.layers=[],a.baseLayers=[],a.workLayers=[],a.baseLayer=null,a.vectors=null;var l=0;if(a.div=r.Z.Util.getDiv(t),a.div.classList.add(r.Z.Consts.classes.LOADING,r.Z.Consts.classes.MAP),a._markerPromises=[],a._layerBuffer={layers:[],contains:function(t){return this.layers.some((function(e){return e.id===t}))},getIndex:function(t){return this.layers.reduce(d("id",t),-1)},add:function(t,e,n){const r={id:t,pending:!0,zIndex:e,isBase:n};this.layers.splice(this.getIndexForZIndex(e),0,r)},remove:function(t){this.layers.splice(this.getIndex(t),1)},getMapLayers:function(){return this.layers.filter((t=>!1===t.pending)).filter((t=>!t.rejected)).map((t=>t.mapLayer))},resolve:function(t,e,n){const o=this.layers[this.getIndex(e.id)];if(o.mapLayer=e,o.pending=!1,t.layers=this.getMapLayers(),n){0===t.baseLayers.length&&(t.baseLayers=new Array(t.options.baseLayers.length));var i=t.options.baseLayers.map((t=>t.id)).indexOf(e.id);i<0?(i=t.baseLayers.map((t=>t.type)).indexOf(r.Z.Consts.layerType.VECTOR))<0?t.baseLayers.push(e):t.baseLayers.splice(i,0,e):t.baseLayers.splice(i,1,e)}else t.workLayers=t.layers.filter((function(t){return!t.isBase}))},reject:function(t,e){const n=this.layers[this.getIndex(e.layerId)];n.mapLayer=null,n.pending=!1,n.rejected=!0;var r=t.options.baseLayers.map((t=>t.id)).indexOf(e.layerId);r>=0&&t.baseLayers.splice(r,1)},getResolvedWorkLayerIndex:function(t,e){return this.layers.filter((function(t){return t.id===e||!t.isBase&&!1===t.pending})).reduce(d("id",e),-1)},getResolvedVisibleLayerIndex:function(t,e){var n=this.getResolvedWorkLayerIndex(t,e);return t.baseLayer&&(n+=1),n},getIndexForZIndex:function(t){return this.layers.reduce(function(t){return function(e,n,r){return n.zIndex<=t?r:e}}(t),-1)+1},checkMapLoad:function(t){const e=this;if(t.options.baseLayers.concat(t.options.workLayers).every((function(t){return e.contains(t.id||t)}))&&!this.layers.some((function(t){return!0===t.pending}))){const e=async function(){if(!t.isLoaded){const e=function(){t.options.stateful&&o.call(t),t.isLoaded=!0,t.ready((()=>t.div.classList.remove(r.Z.Consts.classes.LOADING))),t.trigger(r.Z.Consts.event.MAPLOAD)};if(t.state&&t.state.vw3){if(!t.div.classList.contains(r.Z.Consts.classes.THREED)){if(t.div.classList.add(r.Z.Consts.classes.THREED),!r.Z.view||!r.Z.view.ThreeD){const t=await Promise.resolve().then(n.bind(n,9540));r.Z.view=r.Z.view||{},r.Z.view.ThreeD=t.default}r.Z.view.ThreeD.apply({map:t,state:t.state.vw3,callback:function(){e(),t.getControlsByClass(r.Z.control.ThreeD)[0].button.removeAttribute("disabled")}})}}else e()}};if(t.baseLayer)e();else{var i=[];if(t.state&&t.state.base&&(i=r.Z.Cfg.availableBaseLayers.filter((e=>e.id===t.state.base))),i.length>0)i[0].isBase=!0,t.addLayer(i[0]).then((function(t){e()}));else{const n=t.baseLayers.filter((function(t){return!t.mustReproject})).filter((function(t){return t.wrap&&t.wrap.layer}));n.length>0&&(t.wrap.setBaseLayer(n[0].wrap.layer),t.baseLayer=n[0]),e()}}}}},a._layerBuffer.layers=[],a._fileHandles=new WeakMap,r.Z.ready||(r.Z.Cfg=r.Z.Util.extend({},r.Z.Defaults,r.Z.Cfg),r.Z.ready=!0),i&&i.controls&&i.controls.search&&i.controls.search.allowedSearchTypes)for(var c in r.Z.Cfg.controls.search.allowedSearchTypes)Object.prototype.hasOwnProperty.call(i.controls.search.allowedSearchTypes,c)||(i.controls.search.allowedSearchTypes[c]=!1);i=i||{},y.call(a,i),a.id=i.id||r.Z.getUID({prefix:"map-"}),a.crossOrigin=a.options.crossOrigin;var p=async function(){if(a.state=await a.checkLocation(),a.options.layout&&a.trigger(r.Z.Consts.event.LAYOUTLOAD,{map:a}),i&&void 0!==i.workLayers&&(a.options.workLayers=i.workLayers),i&&void 0!==i.baseLayers&&(a.options.baseLayers=i.baseLayers),a.options.zoomToFeatures){a.on(r.Z.Consts.event.FEATURESADD,(function t(e){clearTimeout(a._zoomToFeaturesTimeout),a._zoomToFeaturesTimeout=setTimeout((function(){a.zoomToFeatures(e.layer.features,{animate:!1}),a.off(r.Z.Consts.event.FEATURESADD,t)}),100)}))}a.on(r.Z.Consts.event.LAYERADD,(function t(e){e.layer.isBase&&(e.layer===a.baseLayer||a.baseLayer&&e.layer.fallbackLayer&&e.layer.fallbackLayer.id===a.baseLayer.id)&&(void 0!==a.state&&(a.state.crs?a.loaded((function(){a.setProjection({crs:a.state.crs,extent:a.state.ext})})):a.setExtent(a.state.ext,{animate:!1})),a.off(r.Z.Consts.event.LAYERADD,t))})),a.crs=a.options.crs,a.initialExtent=a.options.initialExtent,a.maxExtent=a.options.maxExtent,a.defaultInfoContainer=a.defaultInfoContainer||a.options.defaultInfoContainer,!a.defaultInfoContainer&&window.matchMedia("screen and (max-width: 40em), screen and (max-height: 40em)").matches&&(a.defaultInfoContainer=r.Z.Consts.infoContainer.RESULTS_PANEL),a.wrap=new r.Z.wrap.Map(a),r.Z.loadProjDef({crs:a.options.crs,callback:function(){a.wrap.setMap();const t=[];for(var e in a.options.controls){var n=a.options.controls[e];n&&("string"==typeof(n="boolean"==typeof n?{}:r.Z.Util.extend(!0,{},n)).div&&(n.div=a.div.querySelector("#"+n.div)||n.div),t.push(a.addControl(e,n)))}var o,i;for(a.on(r.Z.Consts.event.BEFORELAYERUPDATE,m),a.on(r.Z.Consts.event.LAYERUPDATE,g),a.on(r.Z.Consts.event.LAYERERROR,g),o=0;o<a.options.baseLayers.length;o++)"string"==typeof(i=a.options.baseLayers[o])&&(i=h.call(a,i)),a.addLayer(r.Z.Util.extend({},i,{isBase:!0,map:a}));var s=function(t){t.isRaster()&&!t.names&&t.setVisibility(!1)};a.options.workLayers.map((function(t){return r.Z.Util.extend({},t,{map:a})})).filter((function(t){return!a.state||!a.state.layers||!a.state.layers.some((function(e){const n=e.u===t.url&&(!t.layerNames||!t.layerNames.length||t.layerNames.indexOf(e.n)>=0);return n&&(e.id=t.id),n}))})).forEach((function(t){a.addLayer(t).then(s)})),a.state&&a.state.layers&&a.state.layers.forEach((function(t){const e={id:t.i||r.Z.getUID(),hideTitle:t.h,unremovable:t.ur,title:t.t,filter:t.f,hideTree:0!==t.x,renderOptions:{opacity:t.o,hide:!t.v}};t.u?(e.url=r.Z.Util.isOnCapabilities(t.u,t.u.indexOf(window.location.protocol)<0)||t.u,e.layerNames=t.n?t.n.split(","):void 0):(e.type=r.Z.Consts.layerType.VECTOR,e.file=t.fn),a.addLayer(e).then(function(e){if(e.wrap.getRootLayerNode)var n=e.wrap.getRootLayerNode();e.title=t.t||n&&(n.Title||n.title),this.o<1&&e.setOpacity(this.o),this.v||e.setVisibility(this.v)}.bind(t)).catch((function(t){a.toast(t.message,{type:r.Z.Consts.msgType.ERROR})}))})),Promise.all(t).finally((function(){a.state&&a.state.ctl&&a.importControlStates(a.state.ctl),a.isReady=!0,a.trigger(r.Z.Consts.event.MAPREADY)})),b(a.div)}}),a.on(r.Z.Consts.event.FEATURECLICK,(function(t){a.activeControl&&a.activeControl.isExclusive()||t.feature.showInfo()})),a.on(r.Z.Consts.event.NOFEATURECLICK,(function(t){t.layer._noFeatureClicked=!0;for(var e=!0,n=0,o=a.workLayers.length;n<o;n++)if(!a.workLayers[n]._noFeatureClicked){e=!1;break}e&&(a.workLayers.forEach((function(t){delete t._noFeatureClicked})),a.getControlsByClass(r.Z.control.Popup).forEach((function(t){t.isVisible()&&t.hide()})))}))};v.getMapState=async function(t){var e=await u.call(this,t);return r.Z.Util.utf8ToBase64(e)},v.getPreviousMapState=function(){return e},v.checkLocation=async function(){const t=this;var e=window.location.hash;if(e&&e.length>1){var n;e=e.substr(1);try{n=await s("unpack",r.Z.Util.base64ToUtf8(e))}catch(o){try{n=JSON.parse(r.Z.Util.base64ToUtf8(e))}catch(e){return void r.Z.error(r.Z.Util.getLocaleString(t.options.locale,"mapStateNotValid"),r.Z.Consts.msgErrorMode.TOAST)}}if(r.Z.Util.detectIE()&&2047===window.location.href.length&&r.Z.error(r.Z.Util.getLocaleString(t.options.locale,"mapStateNotValidForEdge"),r.Z.Consts.msgErrorMode.TOAST),n){var o=!1;if(Object.prototype.hasOwnProperty.call(n,"ext")||(o=!0,n.ext=t.options.initialExtent),Object.prototype.hasOwnProperty.call(n,"base")||(o=!0,n.base=t.options.defaultBaseLayer),Object.prototype.hasOwnProperty.call(n,"layers"))for(var i=n.layers.length-1;i>=0;i--){const t=n.layers[i];t&&(Object.prototype.hasOwnProperty.call(t,"u")&&Object.prototype.hasOwnProperty.call(t,"n")||Object.prototype.hasOwnProperty.call(t,"fn"))?Object.prototype.hasOwnProperty.call(t,"o")&&Object.prototype.hasOwnProperty.call(t,"v")&&Object.prototype.hasOwnProperty.call(t,"h")||(o=!0,r.Z.Util.extend(t,{o:t.o||1,v:t.v||!0,h:t.h||!1})):(o=!0,n.layers.length=n.layers.length-1)}else o=!0,n.layers=[];return Object.prototype.hasOwnProperty.call(n,"vw3")&&(n.vw3&&n.vw3.cp&&3===n.vw3.cp.length&&n.vw3.chpr&&3===n.vw3.chpr.length&&n.vw3.bcpd||(o=!0)),o&&r.Z.error(r.Z.Util.getLocaleString(t.options.locale,"mapStateNotValid"),r.Z.Consts.msgErrorMode.TOAST),n}r.Z.error(r.Z.Util.getLocaleString(t.options.locale,"mapStateNotValid"),r.Z.Consts.msgErrorMode.TOAST)}};var m=function(t){l<=0&&(l=0,a.trigger(r.Z.Consts.event.BEFOREUPDATE)),l+=1},g=function(t){(l-=1)<=0&&(l=0,a.trigger(r.Z.Consts.event.UPDATE))};const _=a.options.locale;r.Z.i18n.loadResources(!r.Z.i18n[_],r.Z.apiLocation+"TC/resources/",_).finally((function(){if(0===a.div.getBoundingClientRect().height&&(document.querySelectorAll("html,body").forEach((t=>t.classList.add("tc-fullscreen"))),a.div.classList.add("tc-fullscreen")),a.options.layout){var t=a.options.layout;a.trigger(r.Z.Consts.event.BEFORELAYOUTLOAD,{map:a});var e={},n=!1;if("string"==typeof t){var o=t.trim();o+=o.match(/\/$/)?"":"/",e.config=o+"config.json",e.markup=o+"markup.html",e.style=o+"style.css",e.script=o+"script.js",e.i18n=o+"resources",n=!0}else(Object.prototype.hasOwnProperty.call(t,"config")||Object.prototype.hasOwnProperty.call(t,"markup")||Object.prototype.hasOwnProperty.call(t,"style")||Object.prototype.hasOwnProperty.call(t,"script")||Object.prototype.hasOwnProperty.call(t,"href")||Object.prototype.hasOwnProperty.call(t,"i18n"))&&(e=r.Z.Util.extend({},t));e.i18n&&(e.i18n+=e.i18n.match(/\/$/)?"":"/"),a.layout=e;const s=[],l=function(t,e){this.status=t,this.url=e},c=function(t){if(!n||404!=t.status){const e=r.Z.Map.get(document.querySelector("."+r.Z.Consts.classes.MAP));r.Z.error(r.Z.Util.getLocaleString(e.options.locale,"urlFailedToLoad",{url:t.url}),[r.Z.Consts.msgErrorMode.TOAST,r.Z.Consts.msgErrorMode.EMAIL],"Error al cargar "+t.url)}},u=new Promise((function(t,n){e.config?s.push(fetch(e.config).then((function(t){if(!t.ok)throw new l(t.status,e.config);return t.json()})).then((function(e){t(e.i18n),y.call(a,e,i)})).catch((function(e){e.status&&c(e),t(!1)}))):t(!1)}));s.push(u),e.style&&s.push(new Promise((function(t,n){a.div.classList.add("tc-lo"),fetch(e.style,{method:navigator.onLine?"HEAD":"GET"}).then((function(t){if(!t.ok)throw new l(t.status,e.style);return t})).then((function(){var n=document.createElement("link");n.rel="stylesheet",n.href=e.style,document.head.appendChild(n),t()})).catch((function(e){e.status&&c(e),t()}))}))),e.markup&&s.push(new Promise((function(t,n){fetch(e.markup).then((function(t){if(!t.ok)throw new l(t.status,e.markup);return t.text()})).then((function(n){u.then((function(o){o&&_&&e.i18n?r.Z.i18n.loadResources(!0,e.i18n,_).finally((function(){n=n.replace(/\{\{i18n "([^\}\{]+)"\}\}|\{\{([^\}\{]+)\}\}|\{@i18n \$key="([^\}\{]+)"\/\}/g,(function(t,e,n,o){return r.Z.Util.getLocaleString(_,e||n||o)})),a.div.insertAdjacentHTML("beforeend",n),t()})):(a.div.insertAdjacentHTML("beforeend",n),t())}))})).catch((function(e){e.status&&c(e),t()}))}))),Promise.all(s).finally((function(){e.script?fetch(e.script).then((function(t){if(!t.ok)throw new l(t.status,e.script);return t.blob()})).then((function(t){var e=URL.createObjectURL(t),n=document.createElement("script");n.src=e,n.onload=function(){b(a.div),p()},document.head.appendChild(n)})).catch((function(t){t.status&&c(t),p()})):p()}))}else p()})),a.on(r.Z.Consts.event.UPDATEPARAMS,(function(t){f(t.layer)})),a.on(r.Z.Consts.event.ZOOM,(function(){for(var t=0;t<a.workLayers.length;t++)f(a.workLayers[t])}));var C=r.Z.error;r.Z.error=function(t,e,n){if(r.Z.isDebug&&console.trace&&console.trace(),e){var o=function(t,e,n){switch(e){case r.Z.Consts.msgErrorMode.TOAST:if(!a.toast)return void console.warn("No existe el objeto Toast");a.toast(t,{type:r.Z.Consts.msgType.ERROR,duration:2*r.Z.Cfg.toastDuration});break;case r.Z.Consts.msgErrorMode.EMAIL:r.Z.Cfg.loggingErrorsEnabled&&(0,yt.JL)("onerrorLogger").fatalException(n?{msg:n,errorMsg:t}:t,null);break;case r.Z.Consts.msgErrorMode.CONSOLE:default:console.error(t)}};if(Array.isArray(e))for(var i=0;i<e.length;i++)o(t,e[i],n);else o(t,e,n)}else C(t),a.toast(t,{type:r.Z.Consts.msgType.ERROR,duration:2*r.Z.Cfg.toastDuration})}},r.Z.Map._instances=[],r.Z.Map.get=function(t){for(var e=0,n=r.Z.Map._instances.length;e<n;e++){const n=r.Z.Map._instances[e];if(n.div===t)return n}},r.Z.inherit(r.Z.Map,r.Z.EventTarget);var f=function(t){t.type===r.Z.Consts.layerType.WMS&&(t.tree=null)},m=function(t,e){const n=this;var o=Array.prototype.slice.call(t).map((function(t){var n={};return t&&(n[e]=t[e]),n}));"availableBaseLayers"===e&&console.log("layerOptions",o);var i={};if(i[e]=r.Z.Cfg[e],o.unshift(i),"baseLayers"===e&&o[1].baseLayers){i=o[1];for(var a=0;a<i.baseLayers.length;a++)"object"==typeof i.baseLayers[a]&&r.Z.Util.extend(i.baseLayers[a],h.call(n,i.baseLayers[a].id))}else o.unshift(!0),i=r.Z.Util.extend.apply(this,o),"availableBaseLayers"===e&&console.log("layerOption",i);return i[e]};const g=function(t){return t.controlContainer&&(Array.isArray(t.controlContainer.controls)?t.controlContainer.controls.forEach((e=>{Object.keys(e).filter((t=>"position"!==t)).forEach((n=>{void 0!==t[n]&&("boolean"==typeof e[n]&&(e[n]={}),r.Z.Util.extend(e[n],t[n]),delete t[n])}))})):Object.keys(t).filter((function(e){return Object.keys(t.controlContainer.controls).indexOf(e)>-1})).forEach((function(e){const n=t.controlContainer.controls[e];"boolean"==typeof n.options&&(n.options={}),r.Z.Util.extend(n.options,t[e]),delete t[e]}))),t},y=function(){const t=[!0,{},r.Z.Cfg].concat(Array.prototype.slice.call(arguments)),e=this.options=r.Z.Util.extend.apply(this,t);e.availableBaseLayers=r.Z.Cfg.availableBaseLayers.concat.apply(r.Z.Cfg.availableBaseLayers,Array.prototype.map.call(arguments,(function(t){return t.availableBaseLayers||[]}))),e.baseLayers=m.call(this,arguments,"baseLayers"),e.workLayers=m.call(this,arguments,"workLayers");const n=Array.prototype.slice.call(arguments).filter((t=>t.controls)).map((t=>t.controls));return n.length>0&&(e.controls=r.Z.Util.extend(!0,e.controls,g(r.Z.Util.extend(!0,n[0],n[1])))),e};var v=r.Z.Map.prototype,_=function(t,e){var n,o='Layer "'+e.title+'" ("'+e.names+'"): ';n=e.isValidFromNames()?"layerSrsNotCompatible":"layerNameNotValid",o+=r.Z.Util.getLocaleString(t.options.locale,n),r.Z.error(o),t.trigger(r.Z.Consts.event.LAYERERROR,{layer:e,reason:n});const i=Error(o);return i.layerId=e.id,i};v.getCrs=v.getCRS=function(){const t=this;return t.on3DView?t.view3D.crs:t.crs},v.setCrs=async function(t,e){return await this.setProjection({crs:t}),r.Z.Util.isFunction(e)&&e(t),t};v.addLayer=function(t,e){const n=this,o=new Promise((function(e,o){if("object"==typeof t)if(t.id){const e=/(?<ctl>[-_\p{Letter}]+(\u002D\d)?\u002D)?(?<num>[\d]*)?/gu.exec(t.id).groups;e.num&&e.ctl&&r.Z.setUIDStart(parseInt(e.num)+1,{prefix:e.ctl})}else t.id=r.Z.getUID();let a=t.options?t.options.zIndex:t.zIndex;if("number"!=typeof a&&(a=t.stealth?1:0),n._layerBuffer.add(t.id||t,a,t.isBase),n.getLayer(t.id)){const e=Error(`Layer "${t.id}" already exists`);return e.layerId=t.id,void o(e)}var s;"string"==typeof t?s=new r.Z.layer.Raster(r.Z.Util.extend({},h.call(n,t),{map:n})):t instanceof r.Z.Layer?(s=t).map=n:(t.map=n,s=t.type===r.Z.Consts.layerType.VECTOR||t.type===r.Z.Consts.layerType.KML||t.type===r.Z.Consts.layerType.WFS?new r.Z.layer.Vector(t):new r.Z.layer.Raster(t)),Promise.all([n.wrap.getMap(),s.wrap.getLayer()]).then((function(){var t;n.trigger(r.Z.Consts.event.BEFORELAYERADD,{layer:s}),L(s)&&(!function(t){t.wrap.$events.on(r.Z.Consts.event.TILELOADERROR,(function(e){if(e.error.code&&"404"!=e.error.code.toString()&&"offline"!=e.error.text){const n=this;if(!n._tileloaderror){const o=t.getPath(),i=o.length?o[o.length-1]:t.title;t.map.toast(r.Z.Util.getLocaleString(t.map.options.locale,"tileload.error",{name:i,error:e.error.text}),{type:r.Z.Consts.msgType.ERROR}),n._tileloaderror=!0;const a=function(t){t.tile.src&&t.tile.src!==r.Z.Consts.BLANK_IMAGE&&(delete n._tileloaderror,n.$events.off(r.Z.Consts.event.TILELOAD,a))};n.$events.on(r.Z.Consts.event.TILELOAD,a)}}}))}(s),t=n.wrap.indexOfFirstVector()),-1===t&&(t=n.wrap.getLayerCount());const a=n.state&&n.state.crs?n.state.crs:n.getCRS();r.Z.loadProjDef({crs:a,callback:function(){const t=s.isCompatible(a);if(s.isBase){const l=function(){var t;(n.state?s.isDefault=n.state.base===s.id||n.state.base===s.options.fallbackLayer:"string"==typeof n.options.defaultBaseLayer?s.isDefault=n.options.defaultBaseLayer===s.id:"number"==typeof n.options.defaultBaseLayer&&(s.isDefault=n.options.defaultBaseLayer===n.baseLayers.length),s.isDefault)?!s.mustReproject||s.type===r.Z.Consts.layerType.WMTS&&s.wrap.getCompatibleMatrixSets(a)[0]?(t=null===n.baseLayer,s.wrap.getLayer().then((function(r){n.wrap.setBaseLayer(r),n.baseLayer=s,i(t),e(s)}))):s.options.fallbackLayer&&s.getFallbackLayer?n.addLayer(s.getFallbackLayer()).then((function(r){n.wrap.setBaseLayer(r.wrap.layer),n.baseLayer=r.wrap.parent,i(t),e(s)})):o(_(n,s)):e(s)};t?l():s.getCapabilitiesOnline().then((function(t){if(s.capabilities=t,!s.isCompatible(a))if(s.type!==r.Z.Consts.layerType.WMTS)s.mustReproject=!0;else{const t=s.wrap.getCompatibleMatrixSets(a)[0];t?s.wrap.setMatrixSet(t):s.mustReproject=!0}l()}))}else t?s.wrap.getLayer().then((function(t){e(s)})):s.getCapabilitiesOnline().then((function(t){s.capabilities=t,s.isCompatible(a)?s.wrap.getLayer().then((function(t){e(s)})):o(_(n,s))}))}})}),(function(e){var n=new Error(e);n.layerId=t.id,o(n)}))}));o.then((function(t){n._layerBuffer.resolve(n,t,t.isBase),t.isBase||n.wrap.insertLayer(t.wrap.layer,n._layerBuffer.getResolvedVisibleLayerIndex(n,t.id)),n.trigger(r.Z.Consts.event.LAYERADD,{layer:t}),n._layerBuffer.checkMapLoad(n),r.Z.Util.isFunction(e)&&e(t)}),(function(t){n._layerBuffer.reject(n,t),n._layerBuffer.checkMapLoad(n)}));const i=function(t){t&&n.setExtent(n.initialExtent,{animate:!1,contain:!0})};return o},v.addOrUpdateLayer=async function(t,e){const n=this.getLayer(t.id);if(n){const e=Array.isArray(t.layerNames)?t.layerNames:t.layerNames?t.layerNames.split(","):[];switch(n.type){case r.Z.Consts.layerType.WFS:break;case r.Z.Consts.layerType.WMS:n.layerNames!==e&&await n.setLayerNames(e),null!=t.visibility&&n.visibility!==t.visibility&&(n.setVisibility(t.visibility),n.renderOptions=Object.assign(t.renderOptions,{hide:t.visibility})),void 0!==t.opacity&&n.opacity!==t.opacity&&(n.setOpacity(t.opacity,!0),n.renderOptions=Object.assign(t.renderOptions,{opacity:t.opacity})),n.unremovable=t.unremovable,n.title=t.title,n.hideTree=t.hideTree}return n}return await this.addLayer(t,e)},v.removeLayer=function(t){const e=this;return new Promise((function(n,o){if(t.unremovable)return o("Unremovable");let i=!1;for(var a=0;a<e.layers.length;a++)if(e.layers[a]===t){e.layers.splice(a,1),i=!0;break}if(i){if(t.isBase){for(a=0;a<e.baseLayers.length;a++)if(e.baseLayers[a]===t){e.baseLayers.splice(a,1),e.baseLayer===t&&e.setBaseLayer(e.baseLayers[0]);break}}else{for(a=0;a<e.workLayers.length;a++)if(e.workLayers[a]===t){e.workLayers.splice(a,1);break}t===e.vectors&&(e.vectors=null)}t.wrap.getLayer().then((function(o){e.wrap.removeLayer(o),e._layerBuffer.remove(t.id),e.trigger(r.Z.Consts.event.LAYERREMOVE,{layer:t}),e._layerBuffer.checkMapLoad(e),n(t)}))}else o(new Error(`Layer ${t.id} not found in map`))}))},v.insertLayer=function(t,e,n){const o=this;return new Promise((function(i,a){for(var s=-1,l=0;l<o.layers.length;l++)if(t===o.layers[l]){s=l;break}var c=[];c.push(t.wrap.getLayer());var u=o.layers[e];u&&c.push(u.wrap.getLayer()),Promise.all(c).then((function(a){const l=a[0],c=a[1];var u=-1;(u=c?o.wrap.getLayerIndex(c):o.wrap.getLayerCount())>=0&&(t.map=o,o.wrap.insertLayer(l,u),s>-1&&o.layers.splice(s,1),o.layers.splice(e,0,t),o.workLayers=o.layers.filter((function(t){return!t.isBase})),o.trigger(r.Z.Consts.event.LAYERORDER,{layer:t,oldIndex:s,newIndex:e})),r.Z.Util.isFunction(n)&&n(),i(t)}))}))},v.setLayerIndex=function(t,e){const n=e-this.baseLayers.length+1;this.wrap.setLayerIndex(t.wrap.layer,n)},v.putLayerOnTop=function(t){var e=this.wrap.getLayerCount();this.wrap.setLayerIndex(t.wrap.layer,e-1)},v.setBaseLayer=async function(t,e){var n=this,o=null,i=!1;if("string"==typeof t){var a;for(a=0;a<n.layers.length;a++)if(n.layers[a].id===t){t=n.layers[a],i=!0;break}i||(t=h.call(n,t))&&(t=await n.addLayer(r.Z.Util.extend(!0,{},t,{isDefault:!0,isBase:!0,map:n})),i=!0)}else n.layers.indexOf(t)<0&&(t.isDefault=!0,t.isBase=!0,t.map=n,n.addLayer(t)),i=!0;if(i)if(t.isCompatible(n.getCRS())||t.fallbackLayer&&(!t.fallbackLayer||t.fallbackLayer.isCompatible(n.getCRS()))){n.trigger(r.Z.Consts.event.BEFOREBASELAYERCHANGE,{oldLayer:n.getBaseLayer(),newLayer:t}),o=t,await n.wrap.getMap();const i=await t.wrap.getLayer();await n.wrap.setBaseLayer(i),n.baseLayer=t,n.trigger(r.Z.Consts.event.BASELAYERCHANGE,{layer:t}),r.Z.Util.isFunction(e)&&e()}else r.Z.error("Base layer must be reprojected");else r.Z.error("Base layer is not available");return o},v.setView=function(t){this.view=t,this.trigger(r.Z.Consts.event.VIEWCHANGE,{view:t})},v.ready=function(t){r.Z.Util.isFunction(t)&&(this.isReady?t():this.one(r.Z.Consts.event.MAPREADY,t))},v.loaded=function(t){const e=this;return r.Z.Util.isFunction(t)&&(e.isLoaded?t():e.one(r.Z.Consts.event.MAPLOAD,t)),new Promise((t=>{e.isLoaded?t():e.one(r.Z.Consts.event.MAPLOAD,t)}))},v.getLayerTree=function(){var t=this,e={baseLayers:[],workLayers:[]};t.baseLayer&&(e.baseLayers[0]=t.baseLayer.getTree());for(var n=0;n<t.workLayers.length;n++){var r=t.workLayers[n].getTree();r&&e.workLayers.unshift(r)}return e},v.addControl=function(t,e){const o=this;return new Promise((function(i,a){const s=function(t){return o.controls.push(t),Promise.resolve(t.register(o)).then((function(e){return t.div&&(t.div.parentNode||o.div.appendChild(t.div)),o.trigger(r.Z.Consts.event.CONTROLADD,{control:t}),e})).catch((function(t){a(t instanceof Error?t:Error(t))}))};if("string"==typeof t){const o=t.substr(0,1).toUpperCase()+t.substr(1),a=()=>s(new r.Z.control[o](null,e)).then(i);r.Z.Control&&r.Z.control[o]?a():n(837)("./"+o).then((function(t){r.Z.control[o]=t.default,a()}))}else s(t).then((function(t){i(t)}))}))},v.getControlsByClass=function(t){var e=[],n=t;if("string"==typeof t){n=window;for(var o=t.split("."),i=0;i<o.length&&(n=n[o[i]]);i++);}return r.Z.Util.isFunction(n)&&this.controls.forEach((t=>{t instanceof n&&e.push(t)})),e},v.getControlById=function(t){const e=this;for(var n=0,r=e.controls.length;n<r;n++){const r=e.controls[n];if(r.id===t)return r}return null},v.getDefaultControl=function(){const t=this;var e;return t.options.defaultActiveControl&&(e=t.getControlsByClass("TC.control."+t.options.defaultActiveControl.substr(0,1).toUpperCase()+t.options.defaultActiveControl.substr(1))[0]),e||(e=(e=t.getControlsByClass("TC.control.MultiFeatureInfo")[0])?e.lastCtrlActive:t.getControlsByClass("TC.control.FeatureInfo")[0]),e},v.getLoadingIndicator=function(){var t=null,e=this.getControlsByClass("TC.control.LoadingIndicator");return e.length&&(t=e[0]),t},v.addResultsPanel=function(t){const e=this,n=Object.assign({},t),o=e.getControlsByClass(r.Z.control.ControlContainer)[0];return o?(n.position=o.POSITION.RIGHT,o.addControl("resultsPanel",n)):e.addControl("resultsPanel",n)},v.setExtent=function(t,e,n){return this.wrap.setExtent(t,e,n)},v.getExtent=function(){return this.wrap.getExtent()},v.getMaxExtent=function(){return this.maxExtent||null},v.setCenter=function(t,e){return this.wrap.setCenter(t,e)},v.getCenter=function(){return this.wrap.getCenter()},v.setRotation=function(t){this.wrap.setRotation(t)},v.getRotation=function(){return this.wrap.getRotation()},v.getViewHTML=function(){return this.wrap.getViewport()},v.getCompatibleCRS=function(t){const e=((t=t||{}).layers||this.workLayers.concat(this.baseLayer)).filter((function(t){return t.isRaster()})).map((function(e){return e.getCompatibleCRS({normalized:!0,includeFallback:t.includeFallbacks})})),n=e.slice(1);return e[0].filter((function(t){return n.every((function(e){return e.indexOf(t)>=0}))}))},v.loadProjections=function(t){return t=t||{},new Promise((function(e,n){const o=t.crsList||[];Promise.all(o.map((function(t){return r.Z.getProjectionData({crs:r.Z.Util.getCRSCode(t)})}))).then((function(n){var o=n.filter((function(t){return"ok"===t.status&&t.number_result>0})).map((function(t,e,n){const o=t.results[0],i="EPSG:"+o.code;return r.Z.loadProjDef({crs:i,def:o.def,name:o.name,silent:e<n.length-1}),{code:i,name:o.name,proj4:o.proj4,unit:o.unit}}));t.orderBy&&(o=o.sort(r.Z.Util.getSorterByProperty(t.orderBy))),e(o)}),(function(t){n(t)}))}))},v.setProjection=function(t){const e=this;t=t||{};const n=e.crs;return new Promise((function(o,i){var a;if(t.crs){e.isReprojecting=!0,t.baseLayer?a=t.baseLayer:t.allowFallbackLayer&&(e.baseLayer.isCompatible(t.crs)||0!==e.baseLayer.wrap.getCompatibleMatrixSets(t.crs).length?e.baseLayer.firstOption&&(e.baseLayer.firstOption.isCompatible(t.crs)||e.baseLayer.firstOption.wrap.getCompatibleMatrixSets(t.crs).length>0)&&(a=e.baseLayer.firstOption):e.baseLayer.options.fallbackLayer&&(a=e.baseLayer.getFallbackLayer())),a||(a=e.baseLayer);const s=()=>e.isReprojecting=!1,l=async function(){t.extent&&await e.setExtent(t.extent)},c=async function(){s(),e.trigger(r.Z.Consts.event.PROJECTIONCHANGE,{oldCrs:n,newCrs:t.crs}),await l(),o()},u=function(){r.Z.loadProjDef({crs:t.crs,callback:function(){const n=function(o){const a=function(){const a=r.Z.Util.extend({},t,{oldCrs:e.crs}),l=function(t){t.setProjection(a)};o.isCompatible(t.crs)||o.wrap.getCompatibleMatrixSets(t.crs).length>0?(o.setProjection(a),e.wrap.setProjection(r.Z.Util.extend({},t,{baseLayer:o})),e.crs=t.crs,e.baseLayers.filter((function(t){return t!==o})).forEach(l),e.workLayers.forEach(l),o&&o!==e.baseLayer?e.setBaseLayer(o,c):c()):o.fallbackLayer?n(o.fallbackLayer):(s(),i(Error("Layer has no fallback")))};o.type===r.Z.Consts.layerType.WMS||o.type===r.Z.Consts.layerType.WMTS?o.getCapabilitiesPromise().then(a).catch(s):a()};n(a)}})};e.baseLayers.indexOf(a)<0?e.addLayer(a).then(u).catch(s):u()}}))},v.getMetersPerUnit=function(){return this.wrap.getMetersPerUnit()},v.getCoordinateFromPixel=function(t){return this.wrap.getCoordinateFromPixel(t)},v.getPixelFromCoordinate=function(t){return this.wrap.getPixelFromCoordinate(t)},v.zoomToFeatures=function(t,e){const n=this;if(t.length>0){let o;const i=()=>{o=[1/0,1/0,-1/0,-1/0];var r=e||{};r.contain=!0;var i=r.pointBoundsRadius||n.options.pointBoundsRadius;i/=n.getMetersPerUnit();var a=r.extentMargin;"number"!=typeof a&&(a=n.options.extentMargin);for(var s=0;s<t.length;s++){var l=t[s].getBounds();l&&(o[0]=Math.min(o[0],l[0]),o[1]=Math.min(o[1],l[1]),o[2]=Math.max(o[2],l[2]),o[3]=Math.max(o[3],l[3]))}if(o[2]-o[0]==0&&(o[0]=o[0]-i,o[2]=o[2]+i),o[3]-o[1]==0&&(o[1]=o[1]-i,o[3]=o[3]+i),a){var c=(o[2]-o[0])*a/2,u=(o[3]-o[1])*a/2;o[0]=o[0]-c,o[1]=o[1]-u,o[2]=o[2]+c,o[3]=o[3]+u}n.maxExtent&&(o[0]=Math.max(o[0],n.maxExtent[0]),o[1]=Math.max(o[1],n.maxExtent[1]),o[2]=Math.min(o[2],n.maxExtent[2]),o[3]=Math.min(o[3],n.maxExtent[3])),n.setExtent(o,r)};n.isReprojecting?n.one(r.Z.Consts.event.PROJECTIONCHANGE,i):i(),n.on3DView&&n._on3DZoomTo({extent:o})}},v._on3DZoomTo=function(t){const e=this;if(t=t||{},e.on3DView&&t.extent&&4===t.extent.length)if(t.reprojected)e.trigger(r.Z.Consts.event.ZOOMTO,t);else{let n=t.extent,o=e.view3D.view2DCRS!==e.view3D.crs?r.Z.Util.reproject(n.slice(0,2),e.view3D.view2DCRS,e.view3D.crs):n.slice(0,2),i=e.view3D.view2DCRS!==e.view3D.crs?r.Z.Util.reproject(n.slice(2),e.view3D.view2DCRS,e.view3D.crs):n.slice(2);t.extent=o.concat(i),e.trigger(r.Z.Consts.event.ZOOMTO,t)}},v.zoomToMarkers=function(t){var e=this;Promise.all(e._markerPromises).then((function(){for(var n=[],o=0;o<e.workLayers.length;o++){var i=e.workLayers[o];if(i.type===r.Z.Consts.layerType.VECTOR)for(var a=0;a<i.features.length;a++){var s=i.features[a];s instanceof r.Z.feature.Marker&&n.push(s)}}e.zoomToFeatures(n,t),e._markerPromises=[]}))},v.zoomToLayer=function(t,e){const n=this;if((t=n.getLayer(t)).isRaster()){const r=t.getExtent();r&&((e=e||{}).contain=!0,"number"!=typeof e.extentMargin&&(e.extentMargin=n.options.extentMargin),n.setExtent(r,e),n.on3DView&&n._on3DZoomTo({extent:r,reprojected:!0}))}else t.features&&t.features.length&&n.zoomToFeatures(t.features,e)},v.getLayer=function(t){const e=this;var n=null;if("string"==typeof t){for(var o=0;o<e.layers.length;o++)if(e.layers[o].id===t){n=e.layers[o];break}}else r.Z.Layer&&t instanceof r.Z.Layer&&t.map===e&&(n=t);return n};var C=function(t){var e;return t.vectors?e=Promise.resolve(t.vectors):(e=t.addLayer({id:r.Z.getUID(),title:r.Z.i18n[t.options.locale].vectorLayer,type:r.Z.Consts.layerType.VECTOR}),t.vectors=e,e.then((function(e){t.vectors=e}))),e};v.addPoint=function(t,e){if(e&&e.layer){var n=this.getLayer(e.layer);if(!n)throw new Error('Layer "'+e.layer+'" not found');n.addPoint(t,r.Z.Util.extend(!0,{},e,{layer:n}))}else C(this).then((function(n){n.addPoint(t,e)}))},v.addMarker=async function(t,e,n){const o=this;let i;if(r.Z.Util.isFunction(e)?(n=e,e={}):e=e||{},e&&e.layer){var a=o.getLayer(e.layer);i=a?a.addMarker(t,r.Z.Util.extend(!0,{},e,{layer:a})):Promise.reject(new Error('Layer "'+e.layer+'" not found')),o._markerPromises.push(i)}else i=new Promise((function(n,r){C(o).then((function(r){r.addMarker(t,e).then((function(t){n(t)}))}))})),o._markerPromises.push(i);const s=await i;return r.Z.Util.isFunction(n)&&n(s),s},v.addPolyline=function(t,e){if(e&&e.layer){var n=this.getLayer(e.layer);if(!n)throw new Error('Layer "'+e.layer+'" not found');n.addPolyline(t,r.Z.Util.extend(!0,{},e,{layer:n}))}else C(this).then((function(n){n.addPolyline(t,e)}))},v.addPolygon=function(t,e){if(e&&e.layer){var n=this.getLayer(e.layer);if(!n)throw new Error('Layer "'+e.layer+'" not found');n.addPolygon(t,r.Z.Util.extend(!0,{},e,{layer:n}))}else C(this).then((function(n){n.addPolygon(t,e)}))},v.removeFeatures=function(t){this.workLayers.filter((t=>r.Z.layer.Vector&&t instanceof r.Z.layer.Vector)).map((function(e){return{layer:e,features:e.features.filter((e=>t.includes(e)))}})).forEach((t=>t.features.forEach((e=>t.layer.removeFeature(e)))))},v.getBaseLayer=function(){return this.baseLayer||this.baseLayers[0]},v.getResolutions=function(){return this.wrap.getResolutions()},v.getResolution=function(){return this.wrap.getResolution()},v.setResolution=function(t){return this.wrap.setResolution(t)},v.exportFeatures=async function(t,e){var o=this;e=e||{};var i=o.getLoadingIndicator(),a=i&&i.addWait();const s=e.format===r.Z.Consts.format.GPX?Number.NaN:0;t.forEach((function(e,n){const r=e.getData();for(let t in r)if(/&(\w+|#\d{2,4});/g.test(t)){const n=r[t],o={},i=document.createElement("div");i.innerHTML=t,o[i.innerText]=n,e.unsetData(t),e.setData(o)}var o=e.getCoords({pointArray:!0});if(o.some((function(t){return null===t[2]}))){const r=e.clone();r.setId(e.id),t[n]=e=r,(o=e.getCoords({pointArray:!0})).forEach((function(t){null===t[2]&&(t[2]=s)}))}}));const l=e.format||"";if(l===r.Z.Consts.format.SHAPEFILE){const e="ISO-8859-1",s=t.reduce((function(t,e){var n=e.id.substr(0,e.id.lastIndexOf("."));return(t[n]=t[n]||[]).push(e),t}),{}),l=function(t){switch(!0){case"TC.feature.Point"===t:return"POINT";case"TC.feature.Polygon"===t:case"TC.feature.MultiPolygon"===t:return"POLYGON";case"TC.feature.Polyline"===t:case"TC.feature.MultiPolyline"===t:return"POLYLINE"}return"NULL"},u=await r.Z.getProjectionData({crs:o.crs}),p=[],d=(await n.e(621).then(n.t.bind(n,9621,19))).default;let h;for(h in s){let t,e=s[h].reduce((function(t,e){return(t[e.CLASSNAME]=t[e.CLASSNAME]||[]).push(e),t}),{});for(t in e)p.push(new Promise((function(n){const o=t,i=e[o],a=i.reduce((function(t,e){const n={};for(var r in e.data){const t=e.data[r];n[r]="string"==typeof t?t.replace(/•/g,"&bull;").replace(/›/g,"&rsaquo;"):t}return e.getStyle().label&&!e.data.name&&(n.name=e.getStyle().label),t.concat([n])}),[]),s=i.reduce((function(t,e){return e instanceof r.Z.feature.Polyline&&(e=new r.Z.feature.MultiPolyline(e.getCoords(),e.options)),t.concat([e.geometry])}),[]);d.write(a,l(o),s,(function(t,r){const i=h+(Object.keys(e).length>1?"_"+l(o):"");n({fileName:i,content:r})}))})))}const f=[];for(var c=0;c<p.length;c++)f[c]=await p[c];const m=new(0,(await n.e(73).then(n.t.bind(n,2073,23))).default);f.forEach((t=>{m.file(t.fileName+".shp",t.content.shp.buffer),m.file(t.fileName+".shx",t.content.shx.buffer),m.file(t.fileName+".dbf",t.content.dbf.buffer),m.file(t.fileName+".prj",u.results[0].wkt),m.file(t.fileName+".cst",e),m.file(t.fileName+".cpg",e)}));try{const t=await m.generateAsync({type:"blob"});return i&&i.removeWait(a),t}catch(t){throw i&&i.removeWait(a),t}}if(l===r.Z.Consts.format.GEOPACKAGE){const s=function(t,e){var n="";switch(typeof e){case"string":default:n=t.DataTypes.TEXT;break;case"number":n=e%1==0?t.DataTypes.INT:t.DataTypes.FLOAT;break;case"boolean":n=t.DataTypes.BOOLEAN}return n},l=o.crs,c=await n.e(20).then(n.t.bind(n,2020,23));await n.e(305).then(n.t.bind(n,305,23));const S=n(981),b=c.GeoPackageAPI,L=c.FeatureColumn,T=c.GeometryColumns,P=await b.create();var u=l.substr(l.indexOf(":")+1);if(!P.spatialReferenceSystemDao.queryForId(u)){var p=P.spatialReferenceSystemDao.createObject(),d=await r.Z.getProjectionData({crs:l});p.srs_name=l,p.srs_id=d.results[0].code,p.organization=l.substr(0,l.indexOf(":")),p.organization_coordsys_id=d.results[0].code,p.definition=d.results[0].proj4.trim(),p.definition_12_063=d.results[0].wkt.trim(),p.description=d.results[0].name,P.spatialReferenceSystemDao.create(p)}const A=t.reduce((function(t,n){var r="string"==typeof n.id?n.id.substr(0,n.id.lastIndexOf(".")):e.fileName;return(t[r]=t[r]||[]).push(n),t}),{});let O,x;for(O in A){let e,n=A[O].reduce((function(t,e){return(t[e.CLASSNAME]=t[e.CLASSNAME]||[]).push(e),t}),{});for(e in n){const r=n[e];let o=0;const i=r[0].CLASSNAME.substr(r[0].CLASSNAME.lastIndexOf(".")+1).replace("Polyline","LineString").replace("Marker","Point"),a=O+(Object.keys(n).length>1?"_"+i:"");var h=[],f="id";(Object.prototype.hasOwnProperty.call(t[0],"id")||Object.prototype.hasOwnProperty.call(t[0],"ID"))&&h.push(L.createPrimaryKeyColumnWithIndexAndName(o++,f)),h.push(L.createGeometryColumn(o++,"geometry",i.toUpperCase(),!0,null));for(var m=[1/0,1/0,-1/0,-1/0],g=0;g<r.length;g++){var y=r[g].getBounds();y&&(m[0]=Math.min(m[0],y[0]),m[1]=Math.min(m[1],y[1]),m[2]=Math.max(m[2],y[2]),m[3]=Math.max(m[3],y[3]))}for(var v in r[0].data||r[0].attributes){var _=r[0].attributes&&r[0].attributes[v]?r[0].attributes[v].name:v;if("id"===_.toLowerCase())continue;var C=r[0].data[_];const t=L.createColumn(o++,_,s(c,C));h.push(t)}if(r.some((t=>t.getStyle().label&&!t.data.name))){const t=L.createColumn(o++,"name",c.DataTypes.TEXT);h.push(t)}var E=new T;E.table_name=a,E.column_name="geometry",E.geometry_type_name=i.toUpperCase(),E.z=r[0].getGeometryStride(),E.m=2,E.srs_id=u,o=0;const l=new c.BoundingBox(m[0],m[2],m[1],m[3]);await P.createFeatureTable(a,E,h,l,u);const p=P.getFeatureDao(a);for(let t=0;t<r.length;t++){const e=r[t],n=p.newRow(),o=new c.GeometryData;o.setSrsId(u);const i=S.Geometry.parse("SRID="+u+";"+(new ol.format.WKT).writeFeature(e.wrap.feature));for(var w in o.setGeometry(i),n.setValueWithColumnName(n.geometryColumn.name,o),(Object.prototype.hasOwnProperty.call(r[t],"id")||Object.prototype.hasOwnProperty.call(r[t],"ID")||Object.prototype.hasOwnProperty.call(r[t].data,"id")||Object.prototype.hasOwnProperty.call(r[t].data,"ID"))&&n.setValueWithColumnName(f,"string"==typeof e.id?e.id.substring(e.id.lastIndexOf(".")+1):e.id),e.data||e.attributes){const t=r[0].attributes&&r[0].attributes[w]?r[0].attributes[v].name:w;if("id"===t.toLowerCase())continue;const o=e.data[t];n.setValueWithColumnName(t,o)}p.columns.indexOf("name")>=0&&!e.data.name&&n.setValueWithColumnName("name",e.getStyle().label),p.create(n)}}}try{return x=await P.export(),i&&i.removeWait(a),x}catch(t){console.log(t),i&&i.removeWait(a)}return}const S=o.wrap.exportFeatures(t,e),b=r.Z.Consts.mimeType[e.format];if(l===r.Z.Consts.format.KMZ){const t=new(0,(await n.e(73).then(n.t.bind(n,2073,23))).default);t.file((e.fileName||"doc")+".kml",S);const r=await t.generateAsync({type:"blob",mimeType:b,compression:"DEFLATE"});return i&&i.removeWait(a),r}return i&&i.removeWait(a),S},v.exportControlStates=function(){return this.controls.map((function(t){return t.exportState()})).filter((function(t){if(t)for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!0;return!1}))},v.importControlStates=function(t){const e=this;t.forEach((function(t){const n=e.getControlById(t.id);n&&e.loaded((function(){n.importState(t)}))}))};var E={},w=function(){const t=this;var e=t;do{e=e.parentElement}while(e&&!e.matches("."+r.Z.Consts.classes.TOAST_CONTAINER));const n=t.innerHTML;t.classList.add(r.Z.Consts.classes.HIDDEN),void 0!==E[n]&&(E[n]=void 0),setTimeout((function(){t.parentElement&&t.parentElement.removeChild(t),e&&!e.querySelector("."+r.Z.Consts.classes.TOAST)&&e.parentElement&&e.parentElement.removeChild(e)}),1e3)};v.toastHide=function(t){var e=E[t];e&&(clearTimeout(e.timeout),e.toast&&e.toast.parentElement&&e.toast.parentElement.removeChild(e.toast),e.toast=null)},v.toast=function(t,e){const n=this;var o=e||{},i=o.duration||r.Z.Cfg.toastDuration,a=E[t];a&&(clearTimeout(a.timeout),a.toast&&a.toast.parentElement&&a.toast.parentElement.removeChild(a.toast),a.toast=null);var s=n.div.querySelector("."+r.Z.Consts.classes.TOAST_CONTAINER);s||((s=document.createElement("div")).classList.add(r.Z.Consts.classes.TOAST_CONTAINER),(o.container?o.container:n.div).appendChild(s));const l=document.createElement("div"),c=document.createElement("span");l.classList.add(r.Z.Consts.classes.TOAST),l.appendChild(c);const u=document.createElement("p");u.innerHTML=t,l.appendChild(u),l.addEventListener(r.Z.Consts.event.CLICK,w,{passive:!0}),s.appendChild(l),a=E[t]={toast:l};var p="";switch(o.type){case r.Z.Consts.msgType.INFO:p=r.Z.Consts.classes.INFO;break;case r.Z.Consts.msgType.WARNING:p=r.Z.Consts.classes.WARNING;break;case r.Z.Consts.msgType.ERROR:p=r.Z.Consts.classes.ERROR}p.length&&a.toast.classList.add(p),a.timeout=setTimeout((function(){w.call(a.toast)}),i)};var S=!1,b=function(t){if(/iPad/i.test(navigator.userAgent)){var e=window.innerHeight;t.getBoundingClientRect.height===e+(matchMedia("only screen and (orientation : landscape)").matches?20:0)&&(S=!0)}var n=function(){t.classList.toggle(r.Z.Consts.classes.IPAD_IOS7_FIX,matchMedia("only screen and (orientation : landscape)").matches)};S?(n(),window.addEventListener("resize",n)):window.removeEventListener("resize",n)},L=function(t){return"string"==typeof t||t.type!==r.Z.Consts.layerType.VECTOR&&t.type!==r.Z.Consts.layerType.KML&&t.type!==r.Z.Consts.layerType.WFS};v.exportImage=function(){var t=null,e="El mapa actual no es compatible con la exportación de imágenes",n=this.wrap.getViewport({synchronous:!0}).getElementsByTagName("canvas")[0];if(n&&this.crossOrigin)try{t=n.toDataURL()}catch(t){r.Z.error(e+": "+t.message)}else r.Z.error(e);return t},v.loadFiles=function(t,e){this.wrap.loadFiles(t,e)},v.getElevationTool=function(){const t=this;return t.elevation||t.options.elevation?t.elevation?Promise.resolve(t.elevation):new Promise((function(e,n){r.Z.loadJS(!r.Z.tool||!r.Z.tool.Elevation,r.Z.apiLocation+"TC/tool/Elevation",(function(){if(t.options.elevation){const e="boolean"==typeof t.options.elevation?{}:t.options.elevation;e.services&&t.options.googleMapsKey&&(e.services=e.services.map((function(e){const n="string"==typeof e,o=n?e:e.name;return"elevationServiceGoogle"===o?r.Z.Util.extend({name:o,googleMapsKey:t.options.googleMapsKey},n?{}:e):e}))),t.elevation=new r.Z.tool.Elevation(e)}else t.elevation=null;e(t.elevation)}))})):Promise.resolve(null)};const T=function(t,e,n){return new Promise((async function(o,i){let a;try{a=await t.describeFeatureType(e)}catch(t){return void i(t)}var s={};if(1===e.length){var l={};l[e[0]]=a,a=l}for(var c in a){let t;var u=[];for(var p in a[c])!r.Z.Util.isGeometry(a[c][p].type)||a[c][p].nillable||a[c][p].minOccurs||u.push(p);if(u.length<=1){const e=(t,n)=>{if(t instanceof r.Z.filter.LogicalNary)t.conditions.forEach((t=>e(t,n)));else if(t instanceof r.Z.filter.Spatial)return t.geometryName=n,t};t=Object.assign(new n.constructor,e(n,0===u.length?null:u[0]))}else if(u.length>1){const e=(t,n)=>{if(t instanceof r.Z.filter.LogicalNary)t.conditions.forEach((t=>e(t,n)));else if(t instanceof r.Z.filter.Spatial)return r.Z.filter.or.apply(null,n.reduce(((e,n)=>(e.push(new(r.Z.filter[t.getTagName()])(n,t.geometry,t.srsName)),e)),[]))};t=Object.assign(new n.constructor,e(n,u))}s[c]=t}o(s)}))};v.extractFeatures=function(t){const e=this,n=[],o=(t=t||{}).filter,i=t.outputFormat,a=t.download,s=t.layers||e.layers,l={},c=function(t){const e=t.mapLayers[0];return t.title||t.mapLayers.reduce((function(t,e){return t||e.title}),"")||e.tree&&e.tree.title||e.capabilities.Service.Title},u=function(){return!a||i!==r.Z.Consts.mimeType.JSON&&i!==r.Z.Consts.mimeType.KML?e.getCRS():r.Z.Consts.SRSDOWNLOAD_GEOJSON_KML},p=function(t,e){return new Promise((function(n){a?t.mapLayer.toolProxification.cacheHost.getAction(t.url).then((function(r){n({url:r.action(t.url),data:e})})):function(t,e){return new Promise((function(n){t.mapLayer.toolProxification.fetch(t.url,{data:e,contentType:"application/xml",type:"POST"}).then((function(t){if(t instanceof XMLDocument){const e=t.querySelector("ExceptionReport Exception");if(e)return void n({errors:[{key:r.Z.Consts.WFSErrors.INDETERMINATE,params:{err:e.getAttribute("exceptionCode"),errorThrown:e.querySelector("ExceptionText").textContent}}]})}n({response:t})})).catch((function(t){n({errors:[{key:r.Z.Consts.WFSErrors.INDETERMINATE,params:{err:t.name,errorThrown:t.message}}]})}))}))}(t,e).then((function(e){e.errors&&e.errors.length>0?(e.errors[0].params.serviceTitle=t.service.mapLayers.reduce((function(t,e){return t||e.title}),"")||c(t.service),n(e)):n(e)}))}))};return s.forEach((function(t){if(!t.getVisibility()||e.workLayers.indexOf(t)<0||t.type!==r.Z.Consts.layerType.WMS)return;var s=t.getDisgregatedLayerNames()||t.availableNames;const d=t.url.toLowerCase();var h=l[d];h||(h=l[d]={url:d,layers:[],mapLayers:[t],layerNames:[]});for(var f=0;f<s.length;f++){var m=s[f];if(t.wrap.getInfo(m).queryable){h.layerNames.push(m);var g=t.getPath(m);h.layers.push({name:m,title:g[g.length-1],path:g.slice(1),features:[]})}}0!==h.layerNames.length&&void 0===h.request&&(h.request=h.request||t.getWFSCapabilities(),n.push(new Promise((function(t,e){h.request.then((function(e){var n=null,s=[];for(var d in l)l[d].request&&l[d].request===h.request&&(n=l[d]);var f=null,m=n.layerNames;if(!(m instanceof Array&&m.length))return;if(void 0===e.Operations.GetFeature)return s.push({key:r.Z.Consts.WFSErrors.GETFEATURE_NOT_AVAILABLE,params:{serviceTitle:c(n)}}),void t({errors:s});for(var g=[],y=0;y<m.length;y++){for(var v=m[y];"_"===v[v.length-1];)v=v.substring(0,v.lastIndexOf("_"));if(Object.prototype.hasOwnProperty.call(e.FeatureTypes,v.substring(m[y].indexOf(":")+1)))g.indexOf(v)<0&&g.push(v);else{var _=n.mapLayers[0].getPath(v.substring(m[y].indexOf(":")+1));s.push({key:r.Z.Consts.WFSErrors.LAYERS_NOT_AVAILABLE,params:{serviceTitle:c(n),layerName:_[_.length-1]}})}}if(0===g.length)return s.push({key:r.Z.Consts.WFSErrors.NO_VALID_LAYERS,params:{serviceTitle:c(n)}}),void t({errors:s});if(e.Operations.GetFeature.CountDefault&&(f=e.Operations.GetFeature.CountDefault.DefaultValue),"1.0.0"===e.version&&!Object.prototype.hasOwnProperty.call(e.Operations.GetFeature.Operations,"Query")||("2.0.0"===e.version||"1.1.0"===e.version)&&e.Operations.QueryExpressions.indexOf("wfs:Query")<0)return s.push({key:r.Z.Consts.WFSErrors.QUERY_NOT_AVAILABLE,params:{serviceTitle:c(n)}}),void t({errors:s});const C=e.Operations.GetFeature.DCPType?e.Operations.GetFeature.DCPType[1].HTTP.Post.onlineResource:e.Operations.GetFeature.DCP.HTTP.Post.href;Promise.all([T(n.mapLayers[0],g,o)]).then((function(o){var l,d,h,m=o[0];f?(l=f,d={url:C,mapLayer:n.mapLayers[0]},h=r.Z.Util.WFSQueryBuilder(m,null,e,i,!0,u()),new Promise((function(t){d.mapLayer.toolProxification.fetchXML(d.url,{data:h,contentType:"application/xml",type:"POST"}).then((function(e){if(e instanceof XMLDocument){const n=e.querySelector("ExceptionReport Exception");if(n)return void t({errors:[{key:r.Z.Consts.WFSErrors.INDETERMINATE,params:{err:n.getAttribute("exceptionCode"),errorThrown:n.querySelector("ExceptionText").textContent}}]})}var n=parseInt(e.querySelector("FeatureCollection").getAttribute("numberMatched")||e.querySelector("FeatureCollection").getAttribute("numberOfFeatures"),10);isNaN(n)||n>parseInt(l,10)?t({errors:[{key:r.Z.Consts.WFSErrors.MAX_NUM_FEATURES}]}):t(0!==n?n:{errors:[{key:r.Z.Consts.WFSErrors.NO_FEATURES}]})})).catch((function(e){t({errors:[{key:r.Z.Consts.WFSErrors.INDETERMINATE,params:{err:e.name,errorThrown:e.message}}]})}))}))).then((function(o){if(o.errors&&o.errors.length>0){switch(o.errors[0].key){case r.Z.Consts.WFSErrors.INDETERMINATE:o.errors[0].params.serviceTitle=n.mapLayers.reduce(((t,e)=>t||e.title),"")||c(n);break;case r.Z.Consts.WFSErrors.MAX_NUM_FEATURES:o.errors[0].params={limit:f,serviceTitle:c(n)};break;case r.Z.Consts.WFSErrors.NO_FEATURES:o.errors[0].params={serviceTitle:c(n)}}t(o)}else p({url:C,mapLayer:n.mapLayers[0],service:n},r.Z.Util.WFSQueryBuilder(m,null,e,a?i:r.Z.Consts.mimeType.JSON,!1,u())).then((function(e){t(Object.assign({service:n,errors:s},e))}))})):p({url:C,mapLayer:n.mapLayers[0],service:n},r.Z.Util.WFSQueryBuilder(m,null,e,a?i:r.Z.Consts.mimeType.JSON,!1,u())).then((function(e){t(Object.assign({service:n,errors:s},e))}))})).catch((function(e){t({errors:[{key:r.Z.Consts.WFSErrors.INDETERMINATE,params:{err:e.name,errorThrown:e.message,serviceTitle:c(n)}}]})}))}),(function(e){var n=null;for(var o in l)l[o].request&&l[o].request===h.request&&(n=l[o]);t({errors:[{key:r.Z.Consts.WFSErrors.GETCAPABILITIES,params:{err:e.name,serviceTitle:c(n)}}]})}))}))))})),n},v.updateSize=function(){this.wrap.updateSize()},v.linkTo=function(t){this.wrap.linkTo(t)}}();const vt=r.Z.Map},7945:(t,e,n)=>{"use strict";n.d(e,{Z:()=>S});var r=n(5361),o=n(2089),i=n(5798),a=n(7074),s=n(3819),l=n.n(s);r.Z.Consts=o.Z,r.Z.i18n=r.Z.i18n||i.Z,String.prototype.soundex=function(){var t=this.toLowerCase().split(""),e=t.shift(),n={a:"",e:"",i:"",o:"",u:"",b:1,f:1,p:1,v:1,c:2,g:2,j:2,k:2,q:2,s:2,x:2,z:2,d:3,t:3,l:4,m:5,n:5,r:6};return(e+t.map((function(t,e,r){return n[t]})).filter((function(t,r,o){return 0===r?t!==n[e]:t!==o[r-1]})).join("")+"000").slice(0,4).toUpperCase()};var c=Number.prototype.toLocaleString;Number.prototype.toLocaleString=function(t,e){if("eu-ES"!==t||r.Z.Util.detectIE())return c.apply(this,arguments);var n=c.apply(this,arguments);return n=n.replace(/\,/g,"."),Math.floor(this)===this&&Number.isInteger(Math.floor(this))||(n=n.replace(/.([^.]*)$/,",$1")),n};var u={},p={},d=["Capability","Request","GetMap","DCPType","0","HTTP","Get","OnlineResource"],h=["OperationsMetadata","GetTile","DCP","HTTP","Get","0","href"],f=function(t,e,n){return n<e.length-1?t.hasOwnProperty(e[n])?f(t[e[n]],e,++n):null:t[e[n]]};const m=new WeakMap,g=new WeakMap,y={}.hasOwnProperty,v=new Map,_=t=>Math.floor(t)!==t&&t.toString().split(".")[1].length||0;var C={getElevationGain:function(t){const e=(t=t||{}).coords;if(e&&e.length>0&&e[0].length>2){var n=0,r=0;const p=t.hillDeltaThreshold||0;for(var o,i,a,s=!0,l=0;l<e.length;l++){var c=e[l][2];if(null!==c){void 0===o&&(o=c,i=c,a=c),i=Math.min(i,c),a=Math.max(a,c);var u=c-o;u>p||u>0&&l===e.length-1?(s?n+=u:(r-=i-o,n+=c-i,s=!0),o=c,i=c,a=c):(u<-p||u<0&&l===e.length-1)&&(s?(n+=a-o,r-=c-a,s=!1):r-=u,o=c,i=c,a=c)}}return{upHill:Math.round(n),downHill:Math.round(r)}}return null},isPlainObject:function(t){return"object"==typeof t&&!t.nodeType&&t.window!==t&&!(t.constructor&&!y.call(t.constructor.prototype,"isPrototypeOf"))},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},isFunction:function(t){return"function"==typeof t},extend:function(){var t,e=arguments[0]||{},n=1,r=!1;"boolean"==typeof e&&(r=e,e=arguments[n]||{},n++),"object"==typeof e||C.isFunction(e)||(e={});for(var o=arguments.length;n<o;n++){const o=arguments[n];if(null!=o)for(var i in o){const n=e[i],a=o[i];if(e===a)continue;const s=Array.isArray(a);r&&a&&(C.isPlainObject(a)||s)?(t=s?n&&Array.isArray(n)?n:[]:n&&C.isPlainObject(n)?n:{},e[i]=C.extend(r,t,a)):void 0!==a&&(e[i]=a)}}return e},getMapLocale:function(t){return t.options&&t.options.locale&&t.options.locale.replace("_","-")||"es-ES"},regex:{PROTOCOL:/(^https?:)/i},isOnCapabilities:function(t){var e=2!=arguments.length||arguments[1],n=e?t:t.replace(C.regex.PROTOCOL,"");let o;if(e){if(r.Z.capabilities[n])return t}else for(o in r.Z.capabilities)if(o.replace(C.regex.PROTOCOL,"")==n)return o;for(o in r.Z.capabilities){var i=f(r.Z.capabilities[o],d,0)||f(r.Z.capabilities[o],h,0);if(i&&e&&t==i)return i;if(i&&t.replace(C.regex.PROTOCOL,"")==i.replace(C.regex.PROTOCOL,""))return i}return t},reqGetMapOnCapabilities:function(t){var e=2!==arguments.length||arguments[1],n=function(t){var n=f(t,d,0)||f(t,h,0);return n?e?n.split("?")[0]:n.split("?")[0].replace(C.regex.PROTOCOL,""):null};return r.Z.capabilities[t]?n(r.Z.capabilities[t]):null},getFnFromString:function(t){for(var e=window,n=t.split("."),r=0;r<n.length-1;r++)if(null==(e=e[n[r]]))return;return e[n[n.length-1]]},isURL:function(t){return/^(http|https|ftp|mailto)\:\/\//i.test(t)},isSecureURL:function(t){return!/^(f|ht)tps?:\/\//i.test(t)||/^(f|ht)tps:\/\//i.test(t)},isSameOrigin:function(t){var e=0!==t.indexOf("http")&&0!==t.indexOf("//"),n=!e&&t.match(r.Z.Consts.url.SPLIT_REGEX);if(n){var o=window.location,i=n[1];e=(i==o.protocol||null==i)&&n[3]==o.hostname;var a=n[4],s=o.port;(80!=a&&""!==a||"80"!=s&&""!==s)&&(e=e&&a==s)}return e},formatNumber:function(t,e){var n=typeof t;if("number"===n)return t.toLocaleString(e,{maximumFractionDigits:Math.min(6,_(t))});if("string"===n){const n=parseFloat(t);if(n===new Number(t).valueOf())return n.toLocaleString(e,{maximumFractionDigits:Math.min(6,_(n))})}return t},addProtocol:function(t){var e=t;return t&&0===t.indexOf("//")&&(e=location.protocol+t),e},getDiv:function(t){return"string"==typeof t?document.getElementById(t):t instanceof HTMLElement?t:t&&"$"in window&&t instanceof $&&t.length?t[0]:document.createElement("div")},getScriptLocation:function(){var t,e;if(document.currentScript)e=document.currentScript;else{var n=document.getElementsByTagName("script");e=n[n.length-1]}return(t=e.getAttribute("src"))?t.substr(0,t.lastIndexOf("/")+1):""},getBackgroundUrlFromCss:function(t){var e="";if(t)if(void 0!==u[t])e=u[t];else{const r=document.createElement("div");r.style.display="none",r.classList.add(t),document.body.appendChild(r);var n=/^url\(['"]?(.*?)['"]?\)$/gi.exec(window.getComputedStyle(r,null).backgroundImage);n&&n.length>1&&(e=n[n.length-1]),r.parentElement.removeChild(r),u[t]=e}return e},getPointIconUrl:function t(e){var n=null;if(e.url)n=e.url,/Firefox/.test(navigator.userAgent)&&"https:"===location.protocol&&n.startsWith("http:")&&(n=n.replace("http:","https:"));else{var o;if("string"==typeof e.cssClass)o=e.cssClass;else{var i=e.classes||r.Z.Cfg.styles.marker.classes;if(o=i[0],e.group){if(void 0===p[e.group]){var a=0;for(var s in p)a++;a%=i.length,p[e.group]=i[a]}o=p[e.group]}}n=C.getBackgroundUrlFromCss(o)}return n||e===r.Z.Cfg.styles.point||""===e.cssClass||(n=t(r.Z.Cfg.styles.point)),n},getLegendImageFromStyle:function(t,e){let n=null;if(e=e||{},t.url)n=t.url;else{let o=e.width||32,i=e.height||16;const a=t.strokeWidth||0,s=a/2,l=t.fillColor||"transparent",c=t.fillOpacity||1,u=2*(t.radius||0)+a,p=t.lineDash?`stroke-dasharray="${t.lineDash.join(" ")}" `:"";let d;switch(o=Math.max(o,u),i=Math.max(i,u),e.geometryType){case r.Z.Consts.geom.POINT:d=`<circle cx="${o/2}" cy="${i/2}" r="${t.radius}" stroke="${t.strokeColor}" stroke-width="${a}" fill="${l}" fill-opacity="${c}" ${p}/>`;break;case r.Z.Consts.geom.POLYLINE:d=`<polyline points="${s},${i-s} ${o-s},${s}" style="stroke:${t.strokeColor};stroke-width:${a}" ${p}/>`;break;case r.Z.Consts.geom.POLYGON:d=`<polygon points="${s},${i-s} ${s},${s} ${s+.8*o},${s} ${o-s},${i-s}" style="stroke:${t.strokeColor};stroke-width:${a};fill:${l};fill-opacity:${c}" ${p}/>`;break;default:d=`<rect x="${s}" x="${s}" width="${o-a}" height="${i-a}" style="stroke:${t.strokeColor};stroke-width:${a};fill:${l};fill-opacity:${c}" ${p}/>`}n="data:image/svg+xml,"+encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="${o}" height="${i}">${d}</svg>`)}return n},addArrayToTree:function t(e,n,r){var o=null,i=!1,a=e[r=r||0];if(a){for(var s,l=0,c=n.children.length;l<c;l++)if((s=n.children[l]).name===a){i=!0;const n=t(e,s,r+1);n&&(o=n);break}if(!i){s={name:a,title:a,uid:"/"+e.slice(0,r+1).join("/"),children:[]};const i=t(e,s,r+1);o=i||s,s.parent=n,n.children.push(s)}}return o},parseCoords:function(t){var e=null,n=function(t){var e=t,n={};n.type=r.Z.Consts.GEOGRAPHIC;var o=e.indexOf("°");if(n.value=parseFloat(e.substr(0,o)),(o=(e=e.substr(o+1)).indexOf("'"))>=0){var i=parseFloat(e.substr(0,o))/60;n.value>=0?n.value+=i:n.value-=i,(o=(e=e.substr(o+1)).indexOf("'"))>=0&&(i=parseFloat(e.substr(0,o).replace(",","."))/3600,n.value>=0?n.value+=i:n.value-=i)}return n},o=function(t){var e=t.trim();if(e.match(/^1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?\s*[NnSsWwOoEe]$/g)){switch(e[e.length-1]){case"S":case"s":case"W":case"w":case"O":case"o":e="-"+e}return e=e.substr(0,e.length-1),n(e)}if(e.match(/^[+-]?1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?$/g))return n(e);if(e.match(/^1?\d{0,2}([.,]\d+)?\s*\u00B0?\s*[NnSsWwOoEe]$/g)){var o={type:r.Z.Consts.GEOGRAPHIC,value:parseFloat(e.substr(0,e.length-1).replace(",","."))};return e.match(/[SsWwOo]$/)&&(o.value=-o.value),o}return e.match(/^[+-]?1?\d{0,2}([.,]\d+)?\s*\u00B0?$/g)?{type:r.Z.Consts.GEOGRAPHIC,value:parseFloat(e.replace(",","."))}:e.match(/^[-+]?\d{6,7}([.,]\d+)?$/g)?{type:r.Z.Consts.UTM,value:parseFloat(e.replace(",","."))}:null},i=(t=t.trim().toUpperCase()).split(",");if(4===i.length?i=[i.slice(0,1).join("."),i.slice(2,3).join(".")]:1!==i.length&&3!==i.length||(i=t.split(" ")),2===i.length){var a=o(i[0]),s=o(i[1]);null!==a&&null!==s&&(e=[a,s])}return e},reproject:function(t,e,n){var o,i=!0,s=!0,l=!0;Array.isArray(t[0])?Array.isArray(t[0][0])?Array.isArray(t[0][0][0])||(l=!1,t=[t]):(s=!1,t=[[t]]):(i=!1,s=!1,l=!1,t=[[[t]]]);const c=function(t){let e;const n=a.Z.defs[t];return n&&(e=(0,a.Z)(n)),e||(r.Z.loadProjDef({crs:t,sync:!0}),e=(0,a.Z)(a.Z.defs[t])),e};var u=c(e),p=c(n);return o=new Array(t.length),t.forEach((function(t,e){const n=o[e]=[];t.forEach((function(t,e){const r=n[e]=[];t.forEach((function(t,e){if(Array.isArray(t)&&t.length>1){var n=(0,a.Z)(u,p,{x:t[0],y:t[1]});if(r[e]=[n.x,n.y],t.length>2)for(var o=2;o<t.length;o++)r[e][o]=t[o]}else r[e]=t}))}))})),i?s?l||(o=o[0]):o=o[0][0]:o=o[0][0][0],o},getMetersPerDegree:function(t){let e;const n=6370997;if(Array.isArray(t)&&t.length>=4)if(t[3]===t[1])e=Math.PI*n*Math.cos(this.degToRad(t[1]))/180;else{const r=this.degToRad(t[3]-t[1]),o=Math.sin(r/2),i=o*o;e=n*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))/(t[3]-t[1])}return e},radToDeg:function(t){return 180*t/Math.PI},degToRad:function(t){return t*Math.PI/180},mod:function(t){const e=2*Math.PI;return(t%e+e)%e},getCRSCode:function(t){var e=null;if(t=t.trim(),/^EPSG:\d{4,6}$/g.test(t)||/^urn:ogc:def:crs:EPSG:.*:\d{4,6}/g.test(t)||/http:\/\/www.opengis.net\/gml\/srs\/epsg.xml#\d{4,6}$/g.test(t)){var n=t.trim().match(/^.+[:#](\d{4,6})$/);n&&(e=n[1])}return e},CRSCodesEqual:function(t,e){if(t===e)return!0;var n=this.getCRSCode(t),r=this.getCRSCode(e);return null!==n&&null!==r&&n===r},getLocaleString:function(t,e,n){var o=e;if(r.Z.i18n&&r.Z.i18n[t]){var i=r.Z.i18n[t][e];if(i&&(o=i,n))for(var a in n)o=o.replace("{"+a+"}",n[a])}return o},getRenderedHtml:function(t,e,n){const o=function(t,e){const n=r.Z._hbs.compile(e);return r.Z._hbs.registerPartial(t,n),v.set(t,n),n},i=function(t){return new Promise((function(e,n){let a=v.get(t);a?e(a):(v.set(t,!0),r.Z.ajax({url:r.Z.apiLocation+`TC/templates/${t}.hbs`,method:"GET",responseType:"text"}).then((function(n){const r=n.data.match(/{{> ([a-zA-Z\-]+)(?:(?:\s[a-zA-Z]+)\s*)?}}/);r?Promise.all(r.slice(1).map((t=>i(t.trim())))).then((function(){e(o(t,n.data))})):e(o(t,n.data))})).catch((function(t){console.log("Error fetching template: "+t),n(t)})))}))};return new Promise((function(r,o){const a=function(t){const o=t(e);C.isFunction(n)&&n(o),r(o)};C.isFunction(t)?a(t):i(t).then((t=>a(t))).catch((t=>o(t)))}))},getSimpleMimeType:function(t){var e="";if(t){var n=t.indexOf(";");n>0&&(t=t.substring(0,n)),e=t}return e},getMimeTypeFromUrl:function(t){let e=t.indexOf("?");switch(e>=0?t=t.substr(0,e):(e=t.indexOf("#"),e>=0&&(t=t.substr(0,e))),t.substr(t.lastIndexOf(".")+1).toLowerCase()){case"kml":return r.Z.Consts.mimeType.KML;case"kmz":return r.Z.Consts.mimeType.KMZ;case"json":case"geojson":return r.Z.Consts.mimeType.GEOJSON;case"gml":return r.Z.Consts.mimeType.GML;case"gpx":return r.Z.Consts.mimeType.GPX;case"gpkg":return r.Z.Consts.mimeType.GEOPACKAGE;case"shp":case"dbf":case"prj":case"cst":case"cpg":return r.Z.Consts.mimeType.SHAPEFILE;case"zip":return r.Z.Consts.mimeType.ZIP;default:return null}},getQueryStringParams:function(t){var e;if(t){var n=t.indexOf("?");if(n>=0){var r=(e=t.substr(n)).indexOf("#");r>=0&&(e=e.substr(0,r))}else e="?"}else e=location.search;var o=e.replace(/(^\?)/,"").split("&").map(function(t){return this[(t=t.split("="))[0]]=t[1],this}.bind({}))[0];return delete o[""],o},getParamString:function(t){const e=[];for(var n in t)e.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e.join("&").replace(/%20/g,"+")},fastUnshift:function(t,e){for(var n=t.length;n;)t[n]=t[n-1],n--;t[0]=e},storage:{getCookie:function(t){return r.Z.cookie(t)},setCookie:function(t,e,n){return r.Z.cookie(t,e,n)},getLocalValue:function(t){return localStorage&&localStorage instanceof Storage?localStorage.getItem(t):C.storage.getCookie(t)},setLocalValue:function(t,e){if(localStorage&&localStorage instanceof Storage)void 0===e?localStorage.removeItem(t):localStorage.setItem(t,e);else if(void 0===e){var n=new Date;n.setDate(n.getDate()-1),C.storage.setCookie(t,"",{expires:n})}else C.storage.setCookie(t,e);return t},getSessionLocalValue:function(t){return sessionStorage&&sessionStorage instanceof Storage?sessionStorage.getItem(t):C.storage.getCookie(t)},setSessionLocalValue:function(t,e){if(sessionStorage&&sessionStorage instanceof Storage)void 0===e?sessionStorage.removeItem(t):sessionStorage.setItem(t,e);else if(void 0===e){var n=new Date;n.setDate(n.getDate()-1),C.storage.setCookie(t,"",{expires:n})}else C.storage.setCookie(t,e);return t}},detectFirefox:function(){return!!/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&new Number(RegExp.$1)},detectIE:function(){var t=window.navigator.userAgent,e=t.indexOf("MSIE ");if(e>0)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(t.indexOf("Trident/")>0){var n=t.indexOf("rv:");return parseInt(t.substring(n+3,t.indexOf(".",n)),10)}var r=t.indexOf("Edge/");return r>0&&parseInt(t.substring(r+5,t.indexOf(".",r)),10)},detectChrome:function(){return window.chrome},detectSafari:function(){return!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)},detectMouse:function(){const t=matchMedia("(pointer:coarse)").matches,e=matchMedia("(pointer:fine)").matches;if(t&&e)return!0;if(t&&!e){return o="(hover: hover)",i=!r.Z.browserFeatures.touch(),(n=window.matchMedia(o)).media===o&&(i=n.matches),!!i}var n,o,i;return!(t||!e)||!matchMedia("(pointer:none)").matches&&(!r.Z.browserFeatures.touch()||void 0)},detectAndroid:function(){return navigator.userAgent.match(/Android/i)},detectBlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},detectIOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},detectMobileWindows:function(){return navigator.userAgent.match(/IEMobile/i)},detectMobile:function(){return C.detectAndroid()||C.detectIOS()||C.detectMobileWindows()||C.detectBlackBerry()},getBrowser:function(){var t=(new(l())).getBrowser();return{name:t.name,version:t.major}},getElementByNodeName:function(t,e){for(var n=e.indexOf(":"),r=e.substr(n+1),o=t.getElementsByTagNameNS("*",r),i=0;i<o.length;i++)if(o[i].nodeName==e)return o},addURLParameters:function(t,e){if(!e)return t;let n,r=!1;try{n=new URL(t)}catch(e){e instanceof TypeError&&(r=!0,n=new URL(t,window.location.href))}for(var o in e){const t=e[o];n.searchParams.set(o,t)}const i=n.href;return r?i.substr(i.indexOf(n.host)+n.host.length):i},removeURLParameter:function(t,e){var n=t.split("?");if(n.length>=2){for(var r=encodeURIComponent(e.toLowerCase())+"=",o=n[1].toLowerCase().split(/[&;]/g),i=o.length;i-- >0;)-1!==o[i].lastIndexOf(r,0)&&o.splice(i,1);return t=n[0]+"?"+o.join("&")}return t},showModal:function(t,e){e=e||{},t.hidden=!1,t.classList.add(r.Z.Consts.classes.VISIBLE);const n=t.querySelectorAll(".tc-modal-close");if(n&&n.length>0)for(var o=0;o<n.length;o++){var i=g.get(n[o]);i?g.delete(n[o]):(i=function(t){return t.stopPropagation(),r.Z.Util.closeModal(e.closeCallback,t.target)},g.set(n[o],i)),g.set(n[o],i),n[o].addEventListener("click",i)}C.isFunction(e.openCallback)&&e.openCallback()},closeModal:function(t,e){const n=function(t){t.classList.remove(r.Z.Consts.classes.VISIBLE)};var o;if(e){for(o=e;o&&!o.matches(".tc-modal");)o=o.parentElement;n(o)}else Array.prototype.forEach.call(document.querySelectorAll(".tc-modal"),(function(t){n(t)}));t&&t()},closeAlert:function(t){var e=t;do{(e=e.parentElement).matches(".tc-alert")&&(e.style.display="none")}while(e)},swipe:function(t,e){const n=function(e){t.addEventListener("mousedown",e.start),t.addEventListener("touchstart",e.start,{passive:!0}),t.addEventListener("mouseup",e.end),t.addEventListener("touchend",e.end,{passive:!0})};if("disable"===e){const e=m.get(t);return void(e&&(t.removeEventListener("mousedown",e.start),t.removeEventListener("touchstart",e.start),t.removeEventListener("mouseup",e.end),t.removeEventListener("touchend",e.end)))}if("enable"===e){const e=m.get(t);return void(e&&n(e))}const r=(e=e||{}).minDistance||30,o=e.maxCrossDistance||30,i=e.maxAllowedTime||1e3;var a={x:-1,y:-1},s={x:-1,y:-1},l=0;const c={start:function(n){(function(n){if(e.noSwipe)for(var r=n.target;r&&r!==t;){if(r.matches&&r.matches(e.noSwipe))return!1;r=r.parentNode}return!0})(n)&&(n="changedTouches"in n?n.changedTouches[0]:n,a.x=n.pageX,a.y=n.pageY,l=(new Date).getTime())},end:function(n){if(l){if(n="changedTouches"in n?n.changedTouches[0]:n,s.x=n.pageX,s.y=n.pageY,(new Date).getTime()-l<=i){const n=e[function(t,e){const n=e.x-t.x,i=e.y-t.y,a=Math.abs(n),s=Math.abs(i);return a>s&&a>r&&s<=o?n<0?"left":"right":s>a&&s>r&&a<=o?i<0?"up":"down":"none"}(a,s)];n&&n.call(t)}l=0}}};m.set(t,c),n(c)},getParameterByName:function(t){const e=new URLSearchParams(location.search),n=Array.from(e).find((([e,n])=>e.toLowerCase()===t.toLowerCase()));return n?n[1]:""},getLocaleUserChoice:function(t){var e="en-US",n=(t=t||{}).cookieName||"SITNA.language",o=t.paramName||"lang",i=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language||navigator.userLanguage,a=r.Z.Util.getParameterByName(o)||r.Z.Util.storage.getCookie(n)||i,s=a.indexOf("-");s>=0&&(a=a.substr(0,s));var l=new Date((new Date).getTime()+31536e6);switch(r.Z.Util.storage.setCookie(n,a,{expires:l}),a){case"eu":e="eu-ES";break;case"es":e="es-ES";break;default:e="en-US"}return e},getValidFilename:function(t){return(t||"").replace(/[/\\?%*:|"<>]/g,"-")},getFormatFromFileExtension:function(t){switch(t){case".kml":return r.Z.Consts.format.KML;case".kmz":return r.Z.Consts.format.KMZ;case".gpx":return r.Z.Consts.format.GPX;case".json":case".geojson":return r.Z.Consts.format.GEOJSON;case".gml":return r.Z.Consts.format.GML;case".wkt":return r.Z.Consts.format.WKT;case".topojson":return r.Z.Consts.format.TOPOJSON;case".gpkg":return r.Z.Consts.format.GEOPACKAGE;case".shp":return r.Z.Consts.format.SHAPEFILE;default:return null}},downloadBlob:function(t,e){var n=document.createElement("a");if(void 0!==n.download){var o=URL.createObjectURL(e);n.setAttribute("href",o),n.setAttribute("download",r.Z.Util.getValidFilename(t)),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)}},downloadFile:function(t,e,n){var o=new Blob([n],{type:e});t=r.Z.Util.getValidFilename(t),navigator.msSaveBlob?navigator.msSaveBlob(o,t):r.Z.Util.downloadBlob(t,o)},downloadDataURI:function(t,e,n){for(var o=atob(n.split(",")[1]),i=[],a=0;a<o.length;a++)i.push(o.charCodeAt(a));var s=new Blob([new Uint8Array(i)],{type:e});t=r.Z.Util.getValidFilename(t),navigator.msSaveBlob?navigator.msSaveBlob(s,t):r.Z.Util.downloadBlob(t,s)},shortenUrl:function(t){return new Promise((function(e,n){r.Z.ajax({url:"https://api-ssl.bitly.com/v3/shorten",data:{access_token:"6c466047309f44bd8173d83e81491648b243ee3d",longUrl:t}}).then((function(t){e(t.data)})).catch((function(t){n(t)}))}))},utf8ToBase64:function(t){return window.btoa(unescape(encodeURIComponent(t)))},base64ToUtf8:function(t){var e;try{e=decodeURIComponent(escape(window.atob(t)))}catch(t){e=null}return e},colorArrayToString:function(t){return Array.isArray(t)&&(t=t.slice(0,3).reduce((function(t,e){const n=e.toString(16);return t+"00".substring(0,2-n.length)+n}),"#")),t},operation:function(t,e,n,r){for(var o=[],i=0;i<t.length;i++){for(var a=t[i],s=!1,l=0;l<e.length;l++)if(n(a,e[l])){s=!0;break}s===r&&o.push(a)}return o},inBoth:function(t,e,n){return this.operation(t,e,n,!0)},inFirstOnly:function(t,e,n){return this.operation(t,e,n,!1)},inSecondOnly:function(t,e,n){return this.inFirstOnly(e,t,n)},toDataUrl:function(t,e){var n={type:"image/png",encoderOptions:.92},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n,o=r.type,i=r.encoderOptions,a=t.getContext("2d");if(!a)return"";var s=t.width,l=t.height,c=a.getImageData(0,0,s,l),u=a.globalCompositeOperation;e&&(a.globalCompositeOperation="destination-over",a.fillStyle=e,a.fillRect(0,0,s,l));var p=t.toDataURL(o,i);return e&&(a.clearRect(0,0,s,l),a.putImageData(c,0,0),a.globalCompositeOperation=u),p},imgToDataUrl:function(t,e){var n=function(t){var e=document.createElement("CANVAS"),n=e.getContext("2d");return e.height=t.height,e.width=t.width,n.drawImage(t,0,0),e};return new Promise((function(o,i){if(!e)switch(t.substr(t.lastIndexOf(".")+1).toLowerCase()){case"svg":e="image/svg+xml";break;case"png":e="image/png";break;case"gif":e="image/gif";break;default:e="image/jpeg"}var a=new Image;a.crossOrigin="anonymous",a.onload=function(){var i,s=n(a);try{i=r.Z.Util.toDataUrl(s,"#ffffff",{type:e,encoderOptions:1}),o({dataUrl:i,canvas:s})}catch(e){a.src=r.Z.proxify(t)}},a.onerror=function(s){var l=new XMLHttpRequest;l.open("GET",r.Z.proxify(t),!0),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.responseType="arraybuffer",l.onload=function(t){if(200===this.status){for(var i=new Uint8Array(this.response),s=i.length,c=new Array(s);s--;)c[s]=String.fromCharCode(i[s]);var u=c.join(""),p=l.getResponseHeader("content-type");0===p.indexOf("image")&&(a.src="data:"+p+";base64,"+window.btoa(u),a.onload=function(){const t=n(a),i=r.Z.Util.toDataUrl(t,"#ffffff",{type:e||"image/jpeg",encoderOptions:1});o({dataUrl:i,canvas:t})})}},l.onreadystatechange=function(){4===l.readyState&&200!==l.status&&i(Error("HTTP error "+l.status))},l.send()},a.src=t,(a.complete||void 0===a.complete)&&(a.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",a.src=t)}))},imgTagToDataUrl:function(t,e){var n=function(t){var e=document.createElement("CANVAS"),n=e.getContext("2d");return e.height=t.height,e.width=t.width,n.drawImage(t,0,0),e}(t);try{return{base64:r.Z.Util.toDataUrl(n,"#ffffff",{type:e||"image/jpeg",encoderOptions:1}),canvas:n}}catch(t){return null}},addToCanvas:function(t,e,n,o){var i=r.Z.Util.cloneCanvas(t),a=i.getContext("2d");return new Promise((function(t,r){var s=new Image;s.crossOrigin="anonymous",s.src=e,s.onload=function(){o?a.drawImage(s,n.x||0,n.y||0,o.width,o.height):a.drawImage(s,n.x||0,n.y||0),t(i)}}))},cloneCanvas:function(t){var e=document.createElement("canvas"),n=e.getContext("2d");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),e},mergeCanvases:function(t){const e=t.map((t=>t.getBoundingClientRect())),n=e.reduce((function(t,e){return[Math.min(t[0],e.left),Math.min(t[1],e.top),Math.max(t[2],e.right),Math.max(t[3],e.bottom)]}),[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY]),r=n[0],o=n[1],i=document.createElement("canvas"),a=i.getContext("2d");return i.width=n[2]-r,i.height=n[3]-o,t.forEach((function(t,n){const i=e[n];a.drawImage(t,i.left-r,i.top-o,i.right-i.left,i.bottom-i.top)})),i},calculateAspectRatioFit:function(t,e,n,r){var o=Math.min(n/t,r/e);return{width:t*o,height:e*o}},getFormattedDate:function(t,e){function n(t){return t<10?"0"+t:t}var r=new Date(t);return[r.getFullYear(),n(r.getMonth()+1),n(r.getDate())].concat(e?["_",n(r.getHours()),n(r.getMinutes()),n(r.getSeconds())]:[]).join("")},replaceSpecialCharacters:function(t){var e=new Map([["ä","a"],["ö","o"],["ü","u"],["Ä","A"],["Ö","O"],["Ü","U"],["á","a"],["é","e"],["i","i"],["ó","o"],["ú","u"],["Á","A"],["É","E"],["Í","I"],["Ó","O"],["Ú","U"],["ñ","n"],["Ñ","N"]]);return t.replace(/[öäüÖÄÜáéíóúÁÉÍÓÚñÑ]/g,(function(t){return e.get(t)}))},downloadFileForm:async function(t,e){var n,o=async function(t,e){var n=await new Promise((function(n,r){const o=new XMLHttpRequest;o.responseType="blob",o.open("POST",t),o.setRequestHeader("Content-Type","application/xml; charset=UTF-8"),o.onreadystatechange=function(e){if(4===o.readyState)if(200!==o.status)r({status:o.status,msg:o.statusText,url:t});else try{const t=o.getResponseHeader("Content-disposition");var i="";t&&(i=t.split("; ")[1].substring(9),"attachment"!==t.split("; ")[0]&&(i=i.substring(0,i.lastIndexOf("."))));const e=o.getResponseHeader("Content-type");n({data:o.response,contentType:e||("blob"===o.responseType?"application/zip":""),filename:i})}catch(t){r(t)}};try{o.send(e)}catch(t){r(t)}})),o="";if(n.data.type.indexOf("kml")>=0)o=".kml";else if(n.data.type.indexOf("json")>=0)o=".geojson";else if(n.data.type.indexOf("xml")>=0&&(o=".gml",/outputFormat="\S{1,}"/.exec(e)[0].includes(".kml")||/outputFormat="\S{1,}"/.exec(e)[0].includes("shape-zip")))throw{key:r.Z.Consts.DownloadError.MIMETYPE_NOT_SUPORTED,url:t,data:e,format:/outputFormat="\S{1,}"/.exec(e)[0]};r.Z.Util.downloadFile((n.filename?n.filename:r.Z.getUID())+o,n.contentType,n.data)};if(Array.isArray(t)){for(var i=t,a=0;a<i.length;a++)try{await o(i[a].url,i[a].data)}catch(t){n=t}if(n)throw n}else await o(t,e)},WFSQueryBuilder:function(t,e,n,o,i,a,s,l){const c=function(){return a?' srsName="'+a+'"':""},u=function(){if(!l)return"";var t="";switch(n.version){case"1.0.0":t="ogc:PropertyName";break;case"1.1.0":t="wfs:PropertyName";break;case"2.0.0":t="wfs:PropertyName"}return(l instanceof Array?l:[l]).reduce((function(e,n){return e+"<"+t+">"+n+"</"+t+">"}),"")};Array.isArray(t)||t instanceof Object||(t=[t]);let p,d="<wfs:GetFeature "+E(n).format({resultType:i?'resultType="hits"':"",format:'outputFormat="'+o+'"'})+("2.0.0"!==n.version&&s?' maxFeatures="'+s+'"':"")+">",h="";if(Array.isArray(t))p="<wfs:Query typeName"+("2.0.0"===n.version?"s":"")+'="{typeName}"'+c()+">{fields}{filter}</wfs:Query>",t.forEach((function(t){h+=p.format({typeName:t,filter:e&&e instanceof r.Z.filter.Filter?e.getText(n.version):"",fields:u()})}));else for(var f in p="",t){p="<wfs:Query typeName"+("2.0.0"===n.version?"s":"")+'="{typeName}"'+c()+">{fields}{filter}</wfs:Query>";let e=t[f];h+=p.format({typeName:f,filter:e&&e instanceof r.Z.filter.Filter?e.getText(n.version):"",fields:u()})}return d+=h+"</wfs:GetFeature>",d},WFGetPropertyValue:function(t,e,n,o){return r.Z.Util.WFSQueryBuilder([t],n,o,"JSON",!1,null,null,e)},WFSFilterBuilder:function(t,e,n){var o="";if(C.isPlainObject(t))o='<{prefix}:Filter><{prefix}:Intersects><fes:ValueReference></fes:ValueReference><{prefix}:Function name="querySingle"><{prefix}:Literal>{clipLayer}</{prefix}:Literal><{prefix}:Literal>{geometryName}</{prefix}:Literal><{prefix}:Literal>{where}</{prefix}:Literal></{prefix}:Function></{prefix}:Intersects></{prefix}:Filter>'.format({prefix:"2.0.0"===e?"fes":"ogc",clipLayer:t.clipLayer,geometryName:t.geometryName,where:t.where});else switch(!0){case!t:break;case Array.isArray(t):var i="<gml:Envelope><gml:lowerCorner>{lowerCorner}</gml:lowerCorner><gml:upperCorner>{upperCorner}</gml:upperCorner></gml:Envelope>".format({lowerCorner:t[0]+" "+t[1],upperCorner:t[2]+" "+t[3]});switch(!0){case"1.0.0"===e:case"1.1.0"===e:o+="<ogc:Filter><ogc:BBOX>"+i+"</ogc:BBOX></ogc:Filter>";break;case"2.0.0"===e:o+="<fes:Filter><fes:BBOX>"+i+"</fes:BBOX></fes:Filter>"}break;case t instanceof r.Z.Feature:switch(!0){case"1.0.0"===e:case"1.1.0"===e:o+="<ogc:Filter><ogc:Intersects><ogc:PropertyName></ogc:PropertyName>"+r.Z.Util.writeGMLGeometry(t,{version:"2.0",srsName:n})+"</ogc:Intersects></ogc:Filter>";break;case"2.0.0"===e:o+="<fes:Filter><fes:Intersects><fes:ValueReference></fes:ValueReference>"+r.Z.Util.writeGMLGeometry(t,{version:"3.2",srsName:n})+"</fes:Intersects></fes:Filter>"}break;default:r.Z.error("Geometría no válida")}return o},writeGMLGeometry:function(t,e){const n=(e=e||{}).version,o=function(){return e.srsName?' srsName="'+e.srsName+'"':""};var i=function(t){var e;if(0===n.indexOf("3"))for(e=t.toString();e.indexOf(",")>=0;)e=e.replace(","," ");else e=t.map((function(t){return t.join(",")})).join(" ");return e};switch(n){case"3.1.1":break;case"3.2":return!0===(r.Z.feature.Polyline&&t instanceof r.Z.feature.Polyline)?'<gml:LineString srsDimension="2"'+o()+"><gml:posList>"+i(t.geometry)+"</gml:posList></gml:LineString>":'<gml:Polygon srsDimension="2"'+o()+"><gml:exterior><gml:LinearRing><gml:posList>"+i(t.geometry[0])+"</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>";default:return!0===(r.Z.feature.Polyline&&t instanceof r.Z.feature.Polyline)?"<gml:LineString"+o()+"><gml:coordinates>"+i(t.geometry[0])+"</gml:coordinates></gml:LineString>":"<gml:Polygon"+o()+"><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>"+i(t.geometry[0])+"</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs></gml:Polygon>"}},isServiceWorker:function(){return!!navigator.serviceWorker&&!(!navigator.serviceWorker.controller||"activated"!==navigator.serviceWorker.controller.state)},isSameOriginByLocation:function(t,e){var n=0!==t.indexOf("http")&&0!==t.indexOf("//"),o=!n&&t.match(r.Z.Consts.url.SPLIT_REGEX);if(o){var i=o[1];n=(i==e.protocol||null==i)&&o[3]==e.hostname;var a=o[4],s=e.port;(80!=a&&""!==a||"80"!=s&&""!==s)&&(n=n&&a==s)}return n},isSameProtocol:function(t,e){if(t.match(/^(\/\/)/i))return!0;var n=/^(https?:\/\/)/i,r=t.match(n);if(r&&r.length>1){var o=e.match(n);if(o&&o.length>1)return r[0].trim()===o[0].trim()}return!1},consoleRegister:function(t){r.Z.isDebug&&console.log(t)},getSorterByProperty:function(t){return function(e,n){return e[t]>n[t]?1:e[t]<n[t]?-1:0}},getSoundexDifference:function(t,e){for(var n=0,r=0;r<t.length;r++)t.charAt(r)===e.charAt(r)&&n++;return n},toAbsolutePath:function(t){var e=document.createElement("a");return e.href=t,e.href},explodeGeometry:function(t){const e=t.origin,n=function(t,r,o){Array.isArray(t)?t.forEach(n):(0===r&&(o[0]=t+e[0]),1===r&&(o[1]=t+e[1]))};return t.geom.forEach(n),t.geom},cloneMappingFunction:function(t){return Array.isArray(t)?t.map(r.Z.Util.cloneMappingFunction):t},isGeometry:function(t){switch(t){case"gml:LinearRingPropertyType":case"gml:PolygonPropertyType":case"gml:MultiPolygonPropertyType":case"gml:MultiSurfacePropertyType":case"gml:LineStringPropertyType":case"gml:MultiLineStringPropertyType":case"gml:PointPropertyType":case"gml:MultiPointPropertyType":case"gml:BoxPropertyType":case"gml:GeometryCollectionPropertyType":case"gml:GeometryAssociationType":case"gml:GeometryPropertyType":case"gml:MultiCurvePropertyType":case"gml:CurvePropertyType":return!0;default:return!1}},compactGeometry:function(t,e){const n=[Number.MAX_VALUE,Number.MAX_VALUE],o=t.map(r.Z.Util.cloneMappingFunction),i=function(t,e){Array.isArray(t)?t.forEach(i):0===e&&t<n[0]?n[0]=t:1===e&&t<n[1]&&(n[1]=t)};o.forEach(i);const a=function(t){return Math.round(t*e)/e};n[0]=a(n[0]),n[1]=a(n[1]);const s=function(t,e,r){Array.isArray(t)?t.forEach(s):(0===e&&(r[0]=a(t-n[0])),1===e&&(r[1]=a(t-n[1])))};return o.forEach(s),{origin:n,geom:o}},hasStyleOptions:function(t){return t.hasOwnProperty("strokeColor")||t.hasOwnProperty("strokeWidth")||t.hasOwnProperty("fillColor")||t.hasOwnProperty("strokeOpacity")||t.hasOwnProperty("fillOpacity")||t.hasOwnProperty("url")||t.hasOwnProperty("radius")||t.hasOwnProperty("anchor")||t.hasOwnProperty("width")||t.hasOwnProperty("height")||t.hasOwnProperty("labelOutlineWidth")||t.hasOwnProperty("labelOutlineColor")||t.hasOwnProperty("labelOffset")||t.hasOwnProperty("fontColor")||t.hasOwnProperty("fontSize")},formatCoord:function(t,e){return t.toLocaleString(r.Z.Util.getLocaleUserChoice(),{maximumFractionDigits:e})},getWebWorkerCrossOriginURL:function(t){return new Promise((function(e,n){window.hasOwnProperty("Worker")?r.Z.Util.isSameOrigin(t)?e(t):r.Z.ajax({url:t,method:"GET",responseType:"text"}).then((function(t){const n=t.data;var r=new Blob([n],{type:"text/javascript"}),o=window.URL.createObjectURL(r);e(o)}),(function(t){n(Error(t))})):n(new Error("No support for service workers"))}))}};String.prototype.format=function(){var t=this.toString();if(!arguments.length)return t;var e=typeof arguments[0];for(var n in e="string"===e||"number"===e?arguments:arguments[0])t=t.replace(RegExp("\\{"+n+"\\}","gi"),e[n]);return t};const E=function(t){var e='xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"  service="WFS" {resultType} {format} ';switch(t.version){case"1.0.0":case"1.1.0":e+='xmlns:gml="http://www.opengis.net/gml" xmlns:wfs="http://www.opengis.net/wfs" ';break;case"2.0.0":e+='xmlns:wfs="http://www.opengis.net/wfs/2.0" xmlns:gml="http://www.opengis.net/gml/3.2" '}for(var n in t)"string"==typeof t[n]&&n.indexOf("gml")<0&&t[n].indexOf("wfs")<0&&(e+=n+'="'+t[n]+'" ');return e};var w=function(t,e,n){return n(t.getBoundingClientRect(),e.getBoundingClientRect())};window.HTMLElement&&(HTMLElement.prototype.colliding=function(t){return w(this,t,(function(t,e){return!(t.top>e.bottom||t.right<e.left||t.bottom<e.top||t.left>e.right)}))},HTMLElement.prototype.containing=function(t){w(this,t,(function(t,e){return!(t.left<=e.left&&e.left<t.width&&t.top<=e.top&&e.top<t.height)}))},HTMLElement.prototype.inside=function(t){return w(this,t,(function(t,e){return e.top<=t.top&&t.top<=e.bottom&&e.top<=t.bottom&&t.bottom<=e.bottom&&e.left<=t.left&&t.left<=e.right&&e.left<=t.right&&t.right<=e.right}))});const S=C},7738:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var r,o=n(5361),i=n(2089),a=n(6498);o.Z.Consts=i.Z,o.Z.control=o.Z.control||{},o.Z.Control=a.Z,o.Z.control.Attribution=function(){const t=this;o.Z.Control.apply(t,arguments),t.apiAttribution="",t.mainDataAttribution=null,t.dataAttributions=[],t.options.dataAttributions&&(t.dataAttributions=t.options.dataAttributions instanceof Array?t.options.dataAttributions:[t.options.dataAttributions])},o.Z.inherit(o.Z.control.Attribution,o.Z.Control),(r=o.Z.control.Attribution.prototype).CLASS="tc-ctl-attrib",r.template={1:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return" - "+t.escapeExpression(s(n,"i18n").call(a,"data",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:23},end:{line:3,column:38}}}))+":\r\n"+(null!=(i=s(n,"if").call(a,null!=(i=null!=e?s(e,"mainData"):e)?s(i,"site"):i,{name:"if",hash:{},fn:t.program(2,o,0),inverse:t.program(4,o,0),data:o,loc:{start:{line:4,column:8},end:{line:10,column:15}}}))?i:"")},2:function(t,e,n,r,o){var i,a=t.lambda,s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <span> <a href="'+s(a(null!=(i=null!=e?l(e,"mainData"):e)?l(i,"site"):i,e))+'" target="_blank">'+s(a(null!=(i=null!=e?l(e,"mainData"):e)?l(i,"name"):i,e))+"</a></span>\r\n"},4:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=a(n,"if").call(null!=e?e:t.nullContext||{},null!=(i=null!=e?a(e,"mainData"):e)?a(i,"name"):i,{name:"if",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:7,column:12},end:{line:9,column:19}}}))?i:""},5:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"                <span> "+t.escapeExpression(t.lambda(null!=(i=null!=e?a(e,"mainData"):e)?a(i,"name"):i,e))+"</span>\r\n"},7:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return' - <span class="tc-ctl-attrib-cmd">'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"others",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:56},end:{line:12,column:73}}}))+"...</span>"},9:function(t,e,n,r,o){return" tc-collapsed"},11:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=s(n,"unless").call(a,o&&s(o,"first"),{name:"unless",hash:{},fn:t.program(12,o,0),inverse:t.noop,data:o,loc:{start:{line:14,column:20},end:{line:14,column:51}}}))?i:"")+(null!=(i=s(n,"if").call(a,null!=e?s(e,"site"):e,{name:"if",hash:{},fn:t.program(14,o,0),inverse:t.program(16,o,0),data:o,loc:{start:{line:14,column:51},end:{line:14,column:159}}}))?i:"")},12:function(t,e,n,r,o){return", "},14:function(t,e,n,r,o){var i=t.lambda,a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<span><a href="'+a(i(null!=e?s(e,"site"):e,e))+'" target="_blank">'+a(i(null!=e?s(e,"name"):e,e))+"</a></span>"},16:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<span>"+t.escapeExpression(t.lambda(null!=e?i(e,"name"):e,e))+"</span>"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<div>\r\n    <span>"+(null!=(i=t.lambda(null!=e?s(e,"api"):e,e))?i:"")+"</span>\r\n    "+(null!=(i=s(n,"if").call(a,null!=e?s(e,"mainData"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:4},end:{line:11,column:11}}}))?i:"")+"    "+(null!=(i=s(n,"if").call(a,null!=e?s(e,"otherData"):e,{name:"if",hash:{},fn:t.program(7,o,0),inverse:t.noop,data:o,loc:{start:{line:12,column:4},end:{line:12,column:90}}}))?i:"")+'\r\n    <div class="tc-ctl-attrib-other'+(null!=(i=s(n,"if").call(a,null!=e?s(e,"isCollapsed"):e,{name:"if",hash:{},fn:t.program(9,o,0),inverse:t.noop,data:o,loc:{start:{line:13,column:35},end:{line:13,column:74}}}))?i:"")+'">\r\n\t'+(null!=(i=s(n,"each").call(a,null!=e?s(e,"otherData"):e,{name:"each",hash:{},fn:t.program(11,o,0),inverse:t.noop,data:o,loc:{start:{line:14,column:1},end:{line:14,column:168}}}))?i:"")+"\r\n    </div>\r\n</div>"},useData:!0},r.register=function(t){const e=this,n=o.Z.Control.prototype.register.call(e,t);e.apiAttribution=e.map.options.attribution||e.apiAttribution;var r=function(t){if(t){var n=t.getAttribution();if(n)if(/IDENA/.test(n.name)||/Tracasa Instrumental/.test(n.name))e.mainDataAttribution={name:"IDENA",site:"https://idena.navarra.es/"};else{for(var r=!1,o=0;o<e.dataAttributions.length;o++)if(n.name===e.dataAttributions[o].name){r=!0;break}r||e.dataAttributions.push(n)}}},i=function(t){if(t&&(!(t instanceof o.Z.Layer)||function(){if(t.map.workLayers.length>0){const n=t.map.workLayers.slice().reverse();for(var e=0;e<n.length;e++){const r=n[e];if(r.url==t.url&&r.getVisibility())return!1}return!0}return!0}())){var n=t.getAttribution();if(n){var r=e.dataAttributions.reduce((function(t,e,r){return e.name===n.name?r:t}),-1);const i=function(t){return(/IDENA/.test(n.name)||/Tracasa Instrumental/.test(n.name))&&(/IDENA/.test(t)||/Tracasa Instrumental/.test(t))||n.name===t};if(e.map.baseLayer&&e.map.baseLayer.wrap.getAttribution()&&i(e.map.baseLayer.wrap.getAttribution().name)&&t.parent.id!==e.map.baseLayer.id)return;if(e.map.workLayers.filter((function(t){return t.type===o.Z.Consts.layerType.WMS||t.type===o.Z.Consts.layerType.WMTS})).some((function(t){var e=t.wrap.getAttribution();return e&&i(e.name)})))return;r>-1?e.dataAttributions.splice(r,1):(/IDENA/.test(n.name)||/Tracasa Instrumental/.test(n.name))&&(e.mainDataAttribution=null)}}};return t.loaded((function(){t.baseLayer.wrap.getAttribution&&(r(t.baseLayer.wrap),e.render())})),t.on(o.Z.Consts.event.LAYERADD,(function(t){const n=t.layer;!n.isBase&&n.wrap.getAttribution&&n.wrap.getAttribution()&&(r(n.wrap),e.render())})),t.on(o.Z.Consts.event.BEFOREBASELAYERCHANGE+" "+o.Z.Consts.event.OVERVIEWBASELAYERCHANGE,(function(t){const n=t.type,a=t.newLayer,s=t.oldLayer;o.Z.Consts.event.OVERVIEWBASELAYERCHANGE.indexOf(n)>-1&&(e.ignoreLayer=a),s&&s.wrap.getAttribution&&i(s.wrap),a&&a.wrap.getAttribution&&r(a.wrap),e.render()})),t.on(o.Z.Consts.event.LAYERREMOVE,(function(t){const n=t.layer;n.wrap.getAttribution&&(i(n.wrap),e.render())})),t.on(o.Z.Consts.event.TERRAINPROVIDERADD,(function(t){const n=t.terrainProvider;n.getAttribution&&(r(n),e.render())})),t.on(o.Z.Consts.event.TERRAINPROVIDERREMOVE,(function(t){const n=t.terrainProvider;n.getAttribution&&(i(n),e.render())})),t.on(o.Z.Consts.event.LAYERVISIBILITY,(function(t){const n=t.layer;e.ignoreLayer!==n&&n.wrap.getAttribution&&(n.getVisibility()?r(n.wrap):i(n.wrap),e.render())})),n},r.render=function(t){const e=this;return e._set1stRenderPromise(e.renderData({api:"function"==typeof e.apiAttribution?e.apiAttribution.apply(e):e.getLocaleString(e.apiAttribution),mainData:e.mainDataAttribution,otherData:e.dataAttributions,isCollapsed:!e.div.querySelector("."+e.CLASS+"-other")||e.div.querySelector("."+e.CLASS+"-other").classList.contains(o.Z.Consts.classes.COLLAPSED)},(function(){const n=e.div.querySelector("."+e.CLASS+"-cmd");n&&n.addEventListener(o.Z.Consts.event.CLICK,(function(){e.toggleOtherAttributions()}),{passive:!0}),"function"==typeof t&&t()})))},r.toggleOtherAttributions=function(){this.div.querySelector("."+this.CLASS+"-other").classList.toggle(o.Z.Consts.classes.COLLAPSED)};const s=o.Z.control.Attribution},1370:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>a});var r=n(5361),o=n(2089),i=n(6595);r.Z.Consts=o.Z,r.Z.control=r.Z.control||{},r.Z.control.MapContents=i.default,function(){r.Z.control.BasemapSelector=function(){var t=this;r.Z.control.MapContents.apply(t,arguments),t.layerInfos={},t._cssClasses={LOAD_CRS_BUTTON:t.CLASS+"-crs-btn-load",CRS_DIALOG:t.CLASS+"-crs-dialog",CRS_LIST:t.CLASS+"-crs-list",VIEW_BTN:t.CLASS+"-btn-view",CURRENT_CRS_NAME:t.CLASS+"-cur-crs-name",CURRENT_CRS_CODE:t.CLASS+"-cur-crs-code",TREE:t.CLASS+"-tree",DETAILS:"tc-details",GRID:"tc-grid"},t._dialogDiv=r.Z.Util.getDiv(t.options.dialogDiv),window.$&&(t._$dialogDiv=$(t._dialogDiv)),t.options.dialogDiv||document.body.appendChild(t._dialogDiv),t._dialogDiv.addEventListener(r.Z.Consts.event.CLICK,r.Z.EventTarget.listenerBySelector("button:not(.tc-modal-close)",(function(e){if(e.target.classList.contains(t._cssClasses.LOAD_CRS_BUTTON))return void t.loadFallbackProjections();r.Z.Util.closeModal();const n=e.target,o=n.dataset.crsCode,i=t._dialogDiv.querySelector("."+t.CLASS+"-crs-dialog");i.classList.add(r.Z.Consts.classes.HIDDEN);const a=t.getLayer(i.dataset.layerId);if(a)if(o)r.Z.loadProjDef({crs:o,callback:function(){t.map.setProjection({crs:o,baseLayer:a})}});else{const e=t.getFallbackLayer(n.dataset.fallbackLayerId);e&&t.map.setBaseLayer(e)}})),{passive:!0})},r.Z.inherit(r.Z.control.BasemapSelector,r.Z.control.MapContents);var t=r.Z.control.BasemapSelector.prototype;t.CLASS="tc-ctl-bms",t.template={},t.template[t.CLASS]={1:function(t,e,n,r,o,i,a){var s,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(s=t.invokePartial(l(r,"tc-ctl-bms-node"),e,{name:"tc-ctl-bms-node",hash:{controlId:null!=a[1]?l(a[1],"controlId"):a[1]},data:o,indent:"        ",helpers:n,partials:r,decorators:t.decorators}))?s:""},3:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <li class="tc-ctl-bms-node"><label class="tc-ctl-bms-more-node" title="'+a(s(n,"i18n").call(i,"moreBackgroundMaps",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:79},end:{line:8,column:108}}}))+'"><input type="radio" name="'+a(t.lambda(null!=e?s(e,"controlId"):e,e))+'-bm" value="moreLayers"><span></span></label>\r\n        <div class="tc-ctl-bms-info">\r\n            <h3>'+a(s(n,"i18n").call(i,"moreBackgroundMaps",{name:"i18n",hash:{},data:o,loc:{start:{line:10,column:16},end:{line:10,column:45}}}))+"</h3>\r\n        </div></li>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o,i,a){var s,l=null!=e?e:t.nullContext||{},c=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+c(u(n,"i18n").call(l,"backgroundMaps",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:4},end:{line:1,column:29}}}))+' <button type="button" class="tc-icon-btn tc-ctl-bms-btn-view tc-details" title="'+c(u(n,"i18n").call(l,"showDetailsView",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:110},end:{line:1,column:136}}}))+'"></button></h2>\r\n<div class="tc-ctl-bms-tree tc-grid">\r\n    <ul class="tc-ctl-bms-branch">\r\n'+(null!=(s=u(n,"each").call(l,null!=e?u(e,"baseLayers"):e,{name:"each",hash:{},fn:t.program(1,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:4,column:8},end:{line:6,column:17}}}))?s:"")+(null!=(s=u(n,"if").call(l,null!=e?u(e,"dialogMore"):e,{name:"if",hash:{},fn:t.program(3,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:7,column:8},end:{line:12,column:15}}}))?s:"")+"    </ul>\r\n</div>"},usePartial:!0,useData:!0,useDepths:!0},t.template[t.CLASS+"-node"]={1:function(t,e,n,r,o){var i,a=t.lambda,s=t.escapeExpression,l=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li class="tc-ctl-bms-node" data-layer-name="'+s(a(null!=(i=null!=e?c(e,"layer"):e)?c(i,"name"):i,e))+'" data-layer-id="'+s(a(null!=(i=null!=e?c(e,"layer"):e)?c(i,"id"):i,e))+'" data-layer-uid="'+s(a(null!=(i=null!=e?c(e,"layer"):e)?c(i,"uid"):i,e))+'"><label'+(null!=(i=c(n,"if").call(l,null!=(i=null!=e?c(e,"layer"):e)?c(i,"legend"):i,{name:"if",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:127},end:{line:2,column:207}}}))?i:"")+(null!=(i=c(n,"if").call(l,null!=(i=null!=e?c(e,"layer"):e)?c(i,"thumbnail"):i,{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:207},end:{line:2,column:289}}}))?i:"")+'>\r\n<input type="radio" name="'+s(a(null!=e?c(e,"controlId"):e,e))+'-bm" value="'+s(a(null!=(i=null!=e?c(e,"layer"):e)?c(i,"name"):i,e))+'"'+(null!=(i=c(n,"if").call(l,null!=(i=null!=e?c(e,"layer"):e)?c(i,"mustReproject"):i,{name:"if",hash:{},fn:t.program(6,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:66},end:{line:3,column:121}}}))?i:"")+">\r\n<span>"+s(a(null!=(i=null!=e?c(e,"layer"):e)?c(i,"title"):i,e))+'</span></label>\r\n<div class="tc-ctl-bms-info">\r\n    <h3>'+s(a(null!=(i=null!=e?c(e,"layer"):e)?c(i,"title"):i,e))+"</h3>\r\n"+(null!=(i=c(n,"if").call(l,null!=e?c(e,"info"):e,{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.noop,data:o,loc:{start:{line:7,column:4},end:{line:19,column:11}}}))?i:"")+"</div>\r\n</li>\r\n"},2:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return' style="background-image: url('+t.escapeExpression(t.lambda(null!=(i=null!=(i=null!=e?a(e,"layer"):e)?a(i,"legend"):i)?a(i,"src"):i,e))+')"'},4:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return' style="background-image: url('+t.escapeExpression(t.lambda(null!=(i=null!=e?a(e,"layer"):e)?a(i,"thumbnail"):i,e))+')"'},6:function(t,e,n,r,o){return' class="tc-disabled"'},8:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"        <p>"+t.escapeExpression(t.lambda(null!=(i=null!=e?a(e,"info"):e)?a(i,"abstract"):i,e))+"</p>\r\n"+(null!=(i=a(n,"if").call(null!=e?e:t.nullContext||{},null!=(i=null!=e?a(e,"info"):e)?a(i,"metadata"):i,{name:"if",hash:{},fn:t.program(9,o,0),inverse:t.noop,data:o,loc:{start:{line:9,column:8},end:{line:18,column:15}}}))?i:"")},9:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <div class="tc-ctl-bms-metadata">\r\n            <h4>'+t.escapeExpression(s(n,"i18n").call(a,"metadata",{name:"i18n",hash:{},data:o,loc:{start:{line:11,column:16},end:{line:11,column:35}}}))+"</h4>\r\n            <ul>\r\n"+(null!=(i=s(n,"each").call(a,null!=(i=null!=e?s(e,"info"):e)?s(i,"metadata"):i,{name:"each",hash:{},fn:t.program(10,o,0),inverse:t.noop,data:o,loc:{start:{line:13,column:12},end:{line:15,column:21}}}))?i:"")+"        </ul>\r\n        </div>\r\n"},10:function(t,e,n,r,o){var i,a=t.lambda,s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <li><a href="'+(null!=(i=a(null!=e?l(e,"url"):e,e))?i:"")+'" type="'+s(a(null!=e?l(e,"format"):e,e))+'" title="'+s(a(null!=e?l(e,"formatDescription"):e,e))+'" target="_blank">'+s(a(null!=e?l(e,"formatDescription"):e,e))+"</a></li>\r\n"},12:function(t,e,n,r,o){return'<li class="tc-ctl-bms-node"><label class="tc-loading"></label></li>\r\n'},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=a(n,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"layer"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(12,o,0),data:o,loc:{start:{line:1,column:0},end:{line:24,column:7}}}))?i:""},useData:!0},t.template[t.CLASS+"-dialog"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-bms-more-dialog tc-modal tc-hidden">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+a(s(n,"i18n").call(i,"backgroundMaps",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:16},end:{line:5,column:41}}}))+'</h3>\r\n            <button type="button" class="tc-icon-btn tc-ctl-bms-btn-view tc-details" title="'+a(s(n,"i18n").call(i,"showDetailsView",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:92},end:{line:6,column:118}}}))+'"></button>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n        </div>\r\n        <div class="tc-modal-footer">\r\n            <button type="button" class="tc-button tc-modal-close">'+a(s(n,"i18n").call(i,"close",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:67},end:{line:12,column:83}}}))+'</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="tc-ctl-bms-crs-dialog tc-modal tc-hidden">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+a(s(n,"i18n").call(i,"baseLayerNotCompatible",{name:"i18n",hash:{},data:o,loc:{start:{line:20,column:16},end:{line:20,column:49}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <p>'+a(s(n,"i18n").call(i,"baseLayerNotCompatible.instructions",{name:"i18n",hash:{},data:o,loc:{start:{line:24,column:15},end:{line:24,column:61}}}))+'</p>\r\n            <ul class="tc-ctl-bms-crs-list tc-crs-list"></ul>\r\n        </div>\r\n        <div class="tc-modal-footer">\r\n            <button type="button" class="tc-button tc-modal-close">'+a(s(n,"i18n").call(i,"close",{name:"i18n",hash:{},data:o,loc:{start:{line:28,column:67},end:{line:28,column:83}}}))+"</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n"},useData:!0};const e=function(t,e){for(;t&&!t.matches(e);)t=t.parentElement;return t},n=function(t,n){const o=this;var i=!0,a=t.target,s=o.getLayer(e(a,"li").dataset.layerId);if(o.options.dialogMore&&e(a,"."+o.CLASS+"-more-dialog")){const t=o.div.querySelectorAll("input[type=radio]");for(var l=0,c=t.length;l<c;l++){const n=o.getLayer(e(t[l],"li").dataset.layerId);if(n&&!0==(n.id===s.id))s=n}}if(s!=o.map.getBaseLayer())if(s.mustReproject)if(o.map.on3DView){if(!s.getFallbackLayer())return o._currentSelection.checked=!0,void t.stopPropagation();if(s.getFallbackLayer()){const t=s.getFallbackLayer();t&&t._capabilitiesPromise.then((function(){t.isCompatible(o.map.getCRS())&&o.map.setBaseLayer(s)})),i=!0}}else{o._currentSelection&&(o._currentSelection.checked=!0);const t={layer:s},e=s.getFallbackLayer();e?e._capabilitiesPromise.then((function(){e.isCompatible(o.map.getCRS())&&(t.fallbackLayer=e),o.showProjectionChangeDialog(t)})):o.showProjectionChangeDialog(t),i=!1}else(s.type===r.Z.Consts.layerType.WMS||s.type===r.Z.Consts.layerType.WMTS&&s.getProjection()!==o.map.crs)&&s.setProjection({crs:o.map.crs}),o.map.setBaseLayer(s);this._currentSelection&&(this._currentSelection.checked=!0),n&&n(i)};t.register=function(t){const e=this;return new Promise((function(o,i){r.Z.control.MapContents.prototype.register.call(e,t).then((function(i){e.div.querySelector(`.${e._cssClasses.VIEW_BTN}`).addEventListener(r.Z.Consts.event.CLICK,(function(t){e.toggleView(),t.target.blur()}),{passive:!0}),e.options.dialogMore&&t.on(r.Z.Consts.event.VIEWCHANGE,(function(){e._getMoreBaseLayers()})),t.on(r.Z.Consts.event.BASELAYERCHANGE+" "+r.Z.Consts.event.PROJECTIONCHANGE+" "+r.Z.Consts.event.VIEWCHANGE,(function(t){e.update(e.div,t.layer)})),e.div.addEventListener("change",r.Z.EventTarget.listenerBySelector("input[type=radio]",(function(t){"moreLayers"===t.target.value?e.showMoreLayersDialog():n.call(e,t),t.stopPropagation()}))),o(i)}))}))},t.render=function(t){const e=this,o=r.Z.control.MapContents.prototype.render.call(e,t,r.Z.Util.extend({},e.options,{controlId:e.id}));return e.getRenderedHtml(e.CLASS+"-dialog",null,(function(t){if(e._dialogDiv.innerHTML=t,e.options.dialogMore){const t=e._dialogDiv.querySelector("."+e.CLASS+"-more-dialog");t.querySelector(`.${e._cssClasses.VIEW_BTN}`).addEventListener(r.Z.Consts.event.CLICK,(function(t){e.toggleMoreLayersDialogView(),t.target.blur(),t.stopPropagation()}),{passive:!0}),t.addEventListener("change",r.Z.EventTarget.listenerBySelector("input[type=radio]",(function(t){n.call(e,t,(function(t){t&&r.Z.Util.closeModal()})),t.stopPropagation()})))}})),o},t.update=async function(t,e){const n=this;t=t||n.div,await(n._moreBaseLayersPromise||n._getMoreBaseLayers()),Array.from(t.querySelectorAll(`ul.${n.CLASS}-branch li`)).forEach((function(t,o,i){const a=n.getLayer(t.dataset.layerId);if(a){const o=e||n.map.baseLayer,s=t.querySelector("input[type=radio]"),l=a.getFallbackLayer&&a.getFallbackLayer();let c=o&&(o===a||o.id===a.id);if(!c){const e=l&&i.filter((e=>e!==t)).some((t=>t.dataset.layerId===l.id));c=!e&&o&&(o===l||l&&o.id===l.id)}n.map.on3DView&&a.mustReproject&&l?l.getCapabilitiesPromise().then((function(){var e=!a.getFallbackLayer().isCompatible(n.map.getCRS());s.checked=c,e?(s.classList.add(r.Z.Consts.classes.DISABLED),t.setAttribute("title",n.map.on3DView?n.getLocaleString("notAvailableTo3D"):n.getLocaleString("reprojectionNeeded"))):(s.classList.remove(r.Z.Consts.classes.DISABLED),t.removeAttribute("title"))})):(s.checked=c,a.mustReproject?(s.classList.add(r.Z.Consts.classes.DISABLED),t.setAttribute("title",n.map.on3DView?n.getLocaleString("notAvailableTo3D"):n.getLocaleString("reprojectionNeeded"))):(s.classList.remove(r.Z.Consts.classes.DISABLED),t.removeAttribute("title"))),c&&(n._currentSelection=s)}})),n.updateScale()},t.updateLayerTree=function(t){const e=this;if(t.isBase&&(!t.options.stealth||t.firstOption&&!t.firstOption.options.stealth)){r.Z.control.MapContents.prototype.updateLayerTree.call(e,t);const n=t.firstOption||t;n!==t&&(e.layerTrees[n.id]=n.getTree()),n.getInfo&&(e.layerInfos[n.id]=n.getInfo(n.names[0])),e.getRenderedHtml(e.CLASS+"-node",{layer:e.layerTrees[n.id],info:e.layerInfos[n.id],controlId:e.id}).then((function(t){const r=(new DOMParser).parseFromString(t,"text/html").body.firstChild;var o=r.dataset.layerUid;const i=e.div.querySelector("."+e.CLASS+"-branch"),a=i.querySelector('li[data-layer-uid="'+o+'"]');if(a)a.innerHTML=r.innerHTML;else{r.dataset.layerId=n.id;const t=e.map.baseLayers.map((t=>t.firstOption||t)).filter((t=>t&&!t.stealth)).map((t=>t.id)),o=t.indexOf(n.id);let a,s=!1;for(a=o-1;a>=0;a--){const e=i.querySelector(`li[data-layer-id="${t[a]}"]`);if(e){e.insertAdjacentElement("afterend",r),s=!0;break}}if(!s){for(a=o+1;a<t.length;a++){const e=i.querySelector(`li[data-layer-id="${t[a]}"]`);if(e){e.insertAdjacentElement("beforebegin",r),s=!0;break}}if(!s){const t=i.querySelector(`.${e.CLASS}-more-node`);t?t.parentElement.insertAdjacentElement("beforebegin",r):i.appendChild(r)}}e.update()}})).catch((function(t){r.Z.error(t)}))}},t.updateLayerOrder=function(t,e,n){},t.removeLayer=function(t){const e=this;if(t.isBase){const o=e.div.querySelector("."+e.CLASS+"-branch").querySelectorAll("li");for(var n=0,r=o.length;n<r;n++){const e=o[n];if(e.dataset.layerId===t.id){e.parentElement.removeChild(e);break}}}},t.onErrorLayer=function(t){const e=this;t.isBase&&!t.options.stealth&&e.map.toast(e.getLocaleString("baseLayerNotAvailable",{mapName:t.title}),{type:r.Z.Consts.msgType.ERROR})},t.getFallbackLayer=function(t){const e=this,n=function(e){return e.fallbackLayer&&e.fallbackLayer.id===t};let r=e.map.baseLayers.filter(n),o=r.length?r[0].fallbackLayer:null;return!o&&e._moreBaseLayers&&(r=e._moreBaseLayers.filter(n),o=r.length?r[0].fallbackLayer:null),o},t.loadFallbackProjections=function(){const t=this;t._dialogDiv.querySelector("."+t._cssClasses.CRS_DIALOG).querySelectorAll("ul."+t._cssClasses.CRS_LIST+" li").forEach((function(e){e.classList.remove(r.Z.Consts.classes.HIDDEN),e.querySelector("button."+t._cssClasses.LOAD_CRS_BUTTON)&&e.classList.add(r.Z.Consts.classes.HIDDEN)}))},t.showProjectionChangeDialog=function(t){const e=this,n=(t=t||{}).layer,o=e._dialogDiv.querySelector("."+e.CLASS+"-crs-dialog"),i=o.querySelector(".tc-modal-body");i.classList.add(r.Z.Consts.classes.LOADING);const a=n.getCompatibleCRS();o.classList.remove(r.Z.Consts.classes.HIDDEN),o.dataset.layerId=n.id;const s=o.querySelector("ul."+e.CLASS+"-crs-list");s.innerHTML="",e.map.loadProjections({crsList:e.map.getCompatibleCRS({layers:e.map.workLayers.concat(n),includeFallbacks:!0}),orderBy:"name"}).then((function(n){var o=!1;const l=document.createDocumentFragment();if(n.forEach((function(n){const i=document.createElement("li"),s=document.createElement("button");s.setAttribute("type","button"),0===a.filter((function(t){return r.Z.Util.CRSCodesEqual(t,n.code)})).length?(o=!0,s.innerHTML=n.name+" ("+n.code+")",t.layer.fallbackLayer&&(s.dataset.fallbackLayerId=t.layer.fallbackLayer.id),s.dataset.crsCode=n.code,s.classList.add(r.Z.Consts.classes.WARNING),i.classList.add(r.Z.Consts.classes.HIDDEN)):(s.innerHTML=e.getLocaleString("changeMapToCrs",{crs:n.name+" ("+n.code+")"}),s.dataset.crsCode=n.code),i.appendChild(s),l.appendChild(i)})),t.fallbackLayer){const n=document.createElement("li"),r=document.createElement("button");r.setAttribute("type","button"),r.innerHTML=e.getLocaleString("reprojectOnTheFly"),r.dataset.fallbackLayerId=t.fallbackLayer.id,n.appendChild(r),l.appendChild(n)}if(o){const t=document.createElement("li"),n=document.createElement("button");n.setAttribute("type","button"),n.classList.add(e._cssClasses.LOAD_CRS_BUTTON),n.innerHTML=e.getLocaleString("showOnTheFlyProjections"),t.appendChild(n),l.appendChild(t)}s.appendChild(l),i.classList.remove(r.Z.Consts.classes.LOADING)})),o.querySelector("."+e.CLASS+"-name").innerHTML=n.title||n.name,r.Z.Util.showModal(o)},t.showMoreLayersDialog=function(){const t=this,e=t._dialogDiv.querySelector("."+t.CLASS+"-more-dialog");e.classList.toggle(r.Z.Consts.classes.THREED,!!t.map.on3DView);const n=e.querySelector(".tc-modal-body");n.innerHTML="",n.classList.add(r.Z.Consts.classes.LOADING),e.classList.remove(r.Z.Consts.classes.HIDDEN),r.Z.Util.showModal(e,{closeCallback:function(){this.update().then((()=>this._currentSelection.checked=!0))}.bind(t)});const o=t.div.querySelector(`.${t._cssClasses.TREE}`).classList.contains(t._cssClasses.GRID),i=e.querySelector(`.${t._cssClasses.VIEW_BTN}`);i.classList.toggle(t._cssClasses.DETAILS,o),i.classList.toggle(t._cssClasses.GRID,!o),i.setAttribute("title",t.getLocaleString(o?"showDetailsView":"showGridView"));const a=e=>{if(e){const n=e.getInfo?e.getInfo(e.names[0]):null;return{layer:e,info:n,controlId:t.id}}return{}},s=function(){const o=e.querySelector(`.${t._cssClasses.VIEW_BTN}`).classList.contains(t._cssClasses.DETAILS),i=t._moreBaseLayers.slice();for(var s=0,l=i.length;s<l;s++)i[s]||(i[s]=!1);t.getRenderedHtml(t.CLASS,{baseLayers:i.map(a),controlId:t.id},(function(e){n.innerHTML=e;const i=n.querySelector(`.${t._cssClasses.TREE}`);i.classList.toggle(t._cssClasses.DETAILS,!o),i.classList.toggle(t._cssClasses.GRID,o),n.classList.remove(r.Z.Consts.classes.LOADING),t.update(n)}))};t._getMoreBaseLayers((function(e){if(n.classList.contains(r.Z.Consts.classes.LOADING))s();else{const r=n.querySelector(`li.${t.CLASS}-node:nth-child(${e+1})`),o=t._moreBaseLayers[e];o&&t.getRenderedHtml(t.CLASS+"-node",a(o),(function(e){r.insertAdjacentHTML("beforebegin",e),r.remove(),t.update(n)}))}})).then((function(){s()}))};const o=function(t,e){const n=e.querySelector(`.${t._cssClasses.TREE}`);if(n){const r=e.querySelector(`.${t._cssClasses.VIEW_BTN}`),o=r.classList.toggle(t._cssClasses.DETAILS);r.setAttribute("title",t.getLocaleString(r.classList.toggle(t._cssClasses.GRID)?"showGridView":"showDetailsView")),n.classList.remove(t._cssClasses.DETAILS,t._cssClasses.GRID),setTimeout((()=>n.classList.add(o?t._cssClasses.GRID:t._cssClasses.DETAILS)),20)}};t.toggleView=function(){o(this,this.div)},t.toggleMoreLayersDialogView=function(){const t=this;t._dialogDiv&&o(t,t._dialogDiv)},t.getLayer=function(t){const e=this;return e.map&&(e.map.getLayer(t)||e._moreBaseLayers&&e._moreBaseLayers.filter((e=>e.id===t))[0])};const i=function(t){return new Promise((function(e,n){Promise.all([t.getCapabilitiesPromise(),t.getFallbackLayer()?t.getFallbackLayer().getCapabilitiesPromise():Promise.resolve()]).then((function(){e()}))}))};t._getMoreBaseLayers=function(t){const e=this;if(e._moreBaseLayers||e._moreBaseLayersPromise){if(e._moreBaseLayers)return new Promise((function(t,n){Promise.all(e._moreBaseLayers.filter((function(t){return t.type===r.Z.Consts.layerType.WMS||t.type===r.Z.Consts.layerType.WMTS})).map((function(t){return e.map.on3DView?i(t):t.getCapabilitiesPromise()}))).then((function(){e._moreBaseLayers=e._moreBaseLayers.map((function(t){if(t.type===r.Z.Consts.layerType.WMTS){var n=t.wrap.getCompatibleMatrixSets(e.map.getCRS())[0];t.mustReproject=!n}else t.type===r.Z.Consts.layerType.WMS&&(t.mustReproject=!t.isCompatible(e.map.getCRS()));return e.map.on3DView&&t.mustReproject&&t.getFallbackLayer&&t.getFallbackLayer()?(t.mustReproject=!t.getFallbackLayer().isCompatible(e.map.getCRS()),t):t})),t(e._moreBaseLayers)}))}))}else e._moreBaseLayersPromise=new Promise((function(n,o){var a=r.Z.Cfg.availableBaseLayers.filter((function(t){return-1===r.Z.Cfg.availableBaseLayers.filter((t=>t.fallbackLayer)).map((t=>t.fallbackLayer)).indexOf(t.id)})).map((function(t){return t.type===r.Z.Consts.layerType.WMS||t.type===r.Z.Consts.layerType.WMTS?new r.Z.layer.Raster(t):t.type===r.Z.Consts.layerType.VECTOR?new r.Z.layer.Vector(t):void 0}));e._moreBaseLayers=new Array(a.length);const s=async function(n){const o=this;if(o.map=e.map,o.isBase=o.options.isBase=!0,o.type===r.Z.Consts.layerType.WMTS){await o.getCapabilitiesPromise();var i=o.wrap.getCompatibleMatrixSets(e.map.getCRS())[0];o.mustReproject=!i}else o.type===r.Z.Consts.layerType.WMS&&(await o.getCapabilitiesPromise(),o.mustReproject=!o.isCompatible(e.map.getCRS()));if(e.map.on3DView&&o.mustReproject&&o.getFallbackLayer){const t=o.getFallbackLayer();t&&(await t.getCapabilitiesPromise(),o.mustReproject=!t.isCompatible(e.map.getCRS()))}e._moreBaseLayers.splice(n,1,o),r.Z.Util.isFunction(t)&&t(n)};Promise.all(a.map((function(n,o){return new Promise((function(a,l){n.type===r.Z.Consts.layerType.WMS||n.type===r.Z.Consts.layerType.WMTS?(e.map.on3DView?i(n):n.getCapabilitiesPromise()).then((function(){s.call(n,o).then(a)}),(function(n){e._moreBaseLayers.splice(o,1,null),r.Z.Util.isFunction(t)&&t(o),a()})):s.call(n,o).then(a)}))}))).finally((function(){e._moreBaseLayers=e._moreBaseLayers.filter((function(t){return null!==t})),n(e._moreBaseLayers)}))}));return e._moreBaseLayersPromise}}();const a=r.Z.control.BasemapSelector},9014:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>i});var r=n(5361),o=n(2721);r.Z.control=r.Z.control||{},r.Z.control.CacheBuilder=o.default;const i=r.Z.control.CacheBuilder},1432:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var r,o=n(5361),i=n(9464),a=n(6498);o.Z.control=o.Z.control||{},o.Z.Control=a.Z,o.Z.wrap=i.Z,o.Z.control.Click=function(){var t=this;o.Z.Control.apply(t,arguments),t.options&&t.options.callback&&(t.callback=t.options.callback),t.wrap=new o.Z.wrap.control.Click(t)},o.Z.inherit(o.Z.control.Click,o.Z.Control),(r=o.Z.control.Click.prototype).CLASS="tc-ctl-click",r.register=function(t){return this.wrap.register(t),o.Z.Control.prototype.register.call(this,t)},r.activate=function(){o.Z.Control.prototype.activate.call(this),this.wrap.activate()},r.deactivate=function(){this.wrap.deactivate(),o.Z.Control.prototype.deactivate.call(this)},r.callback=function(t,e){console.log("[Click]["+t[0]+", "+t[1]+"]["+e[0]+", "+e[1]+"]")};const s=o.Z.control.Click},2273:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>a});var r,o=n(5361),i=n(6498);o.Z.control=o.Z.control||{},o.Z.Control=i.Z,o.Z.control.Container=function(){var t=this;o.Z.Control.apply(t,arguments),t.controlOptions=t.options.controls||[],t.ctlCount=t.controlOptions instanceof Array?t.controlOptions.length:Object.keys(t.controlOptions).length,t.defaultSelection=t.options.defaultSelection,t._ctlPromises=new Array(t.ctlCount)},o.Z.inherit(o.Z.control.Container,o.Z.Control),(r=o.Z.control.Container.prototype).register=function(t){const e=this,n=o.Z.Control.prototype.register.call(e,t);return e.uids=new Array(e.ctlCount),e.uids.forEach((function(t,n,r){r[n]=e.getUID()})),new Promise((function(t,r){Promise.all([n,e.renderPromise()]).then((function(){e.onRender().then((e=>t(e)))}))}))},r.onRender=function(){return Promise.resolve(this)},r.render=function(t){},r.getControl=function(t){var e=this._ctlPromises[t];return e||Promise.reject(Error("No control found"))},r.getControls=function(){return Promise.all(this._ctlPromises)},r.onControlDisable=function(t){},r.onControlEnable=function(t){};const a=o.Z.control.Container},9306:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>a});var r,o=n(5361),i=n(2273);o.Z.control=o.Z.control||{},o.Z.control.Container=i.default,o.Z.control.ControlContainer=function(){var t=this;if(o.Z.control.Container.apply(t,arguments),!Array.isArray(t.controlOptions)){console.log("Gestionamos config de controlContainer antiguo");var e=[];Object.keys(t.controlOptions).forEach((n=>{const r=t.controlOptions[n];var o={position:r.side};o[n]=r.options,e.push(o)})),t.controlOptions=e}},o.Z.inherit(o.Z.control.ControlContainer,o.Z.control.Container),(r=o.Z.control.ControlContainer.prototype).CLASS="tc-ctl-cctr",r.POSITION={LEFT:"left",RIGHT:"right"},r.SIDE=r.POSITION,r.template={},r.template[r.CLASS]={1:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,null!=e?s(e,"position"):e,"left",{name:"eq",hash:{},data:o,loc:{start:{line:3,column:10},end:{line:3,column:30}}}),{name:"if",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:4},end:{line:7,column:11}}}))?i:""},2:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li class="tc-ctl-cctr-elm tc-ctl-cctr-elm-'+t.escapeExpression(t.lambda(null!=e?i(e,"index"):e,e))+'">\r\n        <div></div>\r\n    </li>\r\n'},4:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,null!=e?s(e,"position"):e,"right",{name:"eq",hash:{},data:o,loc:{start:{line:12,column:10},end:{line:12,column:31}}}),{name:"if",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:12,column:4},end:{line:16,column:11}}}))?i:""},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<ul class="tc-ctl-cctr-left">\r\n'+(null!=(i=s(n,"each").call(a,null!=e?s(e,"controls"):e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:4},end:{line:8,column:13}}}))?i:"")+'</ul>\r\n<ul class="tc-ctl-cctr-right">\r\n'+(null!=(i=s(n,"each").call(a,null!=e?s(e,"controls"):e,{name:"each",hash:{},fn:t.program(4,o,0),inverse:t.noop,data:o,loc:{start:{line:11,column:4},end:{line:17,column:13}}}))?i:"")+"</ul>\r\n\r\n"},useData:!0},r.template[r.CLASS+"-node"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li class="tc-ctl-cctr-elm tc-ctl-cctr-elm-'+t.escapeExpression(t.lambda(null!=e?i(e,"index"):e,e))+'">\r\n    <div></div>\r\n</li>\r\n'},useData:!0},r.onRender=function(){const t=this;return new Promise((function(e,n){for(var r=0,i=t.controlOptions.length;r<i;r++){var a=t.controlOptions[r],s=Object.keys(a).filter((t=>["position","index"].indexOf(t)<0))[0];t._ctlPromises[r]=t.map.addControl(s,o.Z.Util.extend({id:t.uids[r],div:t.div.querySelector("."+t.CLASS+"-elm-"+r).querySelector("div")},a[s]))}Promise.all(t._ctlPromises).then((function(){for(var n=0,r=arguments.length;n<r;n++){var o=arguments[n];o.containerControl=t}e(t)}))}))},r.render=function(t){const e=this;return e._set1stRenderPromise(e.renderData({controls:Object.keys(e.controlOptions).map((function(t,n){return o.Z.Util.extend(e.controlOptions[t],{index:n})}))},t))},r.addControl=function(t,e){const n=this;return e.position=e.position||e.side||n.POSITION.LEFT,new Promise((function(r,i){const a=++n.ctlCount;n.renderPromise().then((function(){n.getRenderedHtml(n.CLASS+"-node",{index:a},(function(i){var s=document.createElement("template");s.innerHTML=i.trim(),n.div.querySelector("ul."+n.CLASS+"-"+e.position).appendChild(s.content?s.content.firstChild:s.firstChild),n.map.addControl(t,o.Z.Util.extend({id:n.getUID(),div:n.div.querySelector("."+n.CLASS+"-elm-"+a).querySelector("div")},e)).then((function(t){r(t)}))}))}))}))},r.addElement=function(t){const e=this;t.position=t.position||t.side||e.POSITION.LEFT;var n=document.createElement("li");n.setAttribute("class",e.CLASS+"-elm "+e.CLASS+"-elm-"+e.ctlCount+++" "),e.div.querySelector("ul."+e.CLASS+"-"+t.position).appendChild(n);var r=n.appendChild(t.htmlElement);return r.setAttribute("class",r.getAttribute("class")+" tc-ctl"),r};const a=o.Z.control.ControlContainer},1977:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var r,o=n(5361),i=n(2089),a=n(1926);o.Z.control=o.Z.control||{},o.Z.Consts=i.Z,o.Z.control.ProjectionSelector=a.default,o.Z.control.Coordinates=function(){var t=this;o.Z.Control.apply(t,arguments),t.crs="",t.xy=[0,0,0],t.latLon=[0,0,0],t.x=0,t.y=0,t.lat=0,t.lon=0,t.units=o.Z.Consts.units.METERS,t.isGeo=!1,t.allowReprojection=!Object.prototype.hasOwnProperty.call(t.options,"allowReprojection")||t.options.allowReprojection,o.Z.control.ProjectionSelector.apply(t,arguments),o.Z.Util.extend(t._cssClasses,{CRS:t.CLASS+"-crs",GEOCRS:t.CLASS+"-geocrs",X:t.CLASS+"-x",Y:t.CLASS+"-y",LAT:t.CLASS+"-lat",LON:t.CLASS+"-lon",ELEVATION:t.CLASS+"-elevation",THREEDMARKER:t.CLASS+"-threed"}),t.geoCrs=t.options.geoCrs||o.Z.Cfg.geoCrs,t.wrap=new o.Z.wrap.control.Coordinates(t)},o.Z.inherit(o.Z.control.Coordinates,o.Z.control.ProjectionSelector),(r=o.Z.control.Coordinates.prototype).CLASS="tc-ctl-coords",r.template={},r.template[r.CLASS]={1:function(t,e,n,r,o){return' class="tc-active"'},3:function(t,e,n,r,o){var i=t.escapeExpression,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<button type="button" class="tc-ctl-coords-crs" title="'+i(a(n,"i18n").call(null!=e?e:t.nullContext||{},"changeCRS",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:209},end:{line:1,column:229}}}))+'">'+i(t.lambda(null!=e?a(e,"crs"):e,e))+"</button>"},5:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lambda,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    "+s(c(n,"i18n").call(a,"lat",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:4},end:{line:4,column:18}}}))+': <span class="tc-ctl-coords-lat">'+s(l(null!=e?c(e,"lat"):e,e))+"</span> "+s(c(n,"i18n").call(a,"lon",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:67},end:{line:4,column:81}}}))+': <span class="tc-ctl-coords-lon">'+s(l(null!=e?c(e,"lon"):e,e))+"</span> "+(null!=(i=c(n,"if").call(a,null!=e?c(e,"ele"):e,{name:"if",hash:{},fn:t.program(6,o,0),inverse:t.noop,data:o,loc:{start:{line:4,column:130},end:{line:4,column:217}}}))?i:"")+"\r\n"},6:function(t,e,n,r,o){var i=t.escapeExpression,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return i(a(n,"i18n").call(null!=e?e:t.nullContext||{},"ele",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:141},end:{line:4,column:155}}}))+': <span class="tc-ctl-coords-elevation">'+i(t.lambda(null!=e?a(e,"ele"):e,e))+"</span> "},8:function(t,e,n,r,o){var i,a=t.lambda,s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    x: <span class="tc-ctl-coords-x">'+s(a(null!=e?l(e,"x"):e,e))+'</span> y: <span class="tc-ctl-coords-y">'+s(a(null!=e?l(e,"y"):e,e))+"</span> "+(null!=(i=l(n,"if").call(null!=e?e:t.nullContext||{},null!=e?l(e,"ele"):e,{name:"if",hash:{},fn:t.program(9,o,0),inverse:t.noop,data:o,loc:{start:{line:6,column:96},end:{line:6,column:170}}}))?i:"")+"\r\n"},9:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'z: <span class="tc-ctl-coords-elevation">'+t.escapeExpression(t.lambda(null!=e?i(e,"ele"):e,e))+"</span> "},11:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lambda,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-coords-alt">\r\n    <div class="tc-ctl-coords-xy">\r\n        '+s(c(n,"i18n").call(a,"lat",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:8},end:{line:12,column:22}}}))+': <span class="tc-ctl-coords-lat">'+s(l(null!=e?c(e,"lat"):e,e))+"</span> "+s(c(n,"i18n").call(a,"lon",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:71},end:{line:12,column:85}}}))+': <span class="tc-ctl-coords-lon">'+s(l(null!=e?c(e,"lon"):e,e))+"</span> "+(null!=(i=c(n,"if").call(a,null!=e?c(e,"ele"):e,{name:"if",hash:{},fn:t.program(6,o,0),inverse:t.noop,data:o,loc:{start:{line:12,column:134},end:{line:12,column:221}}}))?i:"")+"\r\n    </div>\r\n</div>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div title="'+s(l(n,"i18n").call(a,"crs",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:12},end:{line:1,column:26}}}))+'"'+(null!=(i=l(n,"if").call(a,null!=e?l(e,"allowReprojection"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:27},end:{line:1,column:77}}}))?i:"")+'>CRS: <span class="tc-ctl-coords-crs">'+s(t.lambda(null!=e?l(e,"crs"):e,e))+"</span>"+(null!=(i=l(n,"if").call(a,null!=e?l(e,"allowReprojection"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:129},end:{line:1,column:254}}}))?i:"")+'</div>\r\n<div class="tc-ctl-coords-xy">\r\n'+(null!=(i=l(n,"if").call(a,null!=e?l(e,"isGeo"):e,{name:"if",hash:{},fn:t.program(5,o,0),inverse:t.program(8,o,0),data:o,loc:{start:{line:3,column:4},end:{line:7,column:11}}}))?i:"")+"</div>\r\n"+(null!=(i=l(n,"if").call(a,null!=e?l(e,"showGeo"):e,{name:"if",hash:{},fn:t.program(11,o,0),inverse:t.noop,data:o,loc:{start:{line:9,column:0},end:{line:15,column:7}}}))?i:"")+'<span class="close"></span>'},useData:!0},r.template[r.CLASS+"-dialog"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-coords-crs-dialog tc-modal">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+a(s(n,"i18n").call(i,"changeCRS",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:16},end:{line:5,column:36}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <p>'+a(s(n,"i18n").call(i,"coords.currentProjection",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:15},end:{line:9,column:50}}}))+'</p>\r\n            <p class="tc-ctl-coords-no-change">'+a(s(n,"i18n").call(i,"coords.noCrs.warning",!0,{name:"i18n",hash:{},data:o,loc:{start:{line:10,column:47},end:{line:10,column:83}}}))+'</p>\r\n            <div class="tc-ctl-coords-change">\r\n                <p>'+a(s(n,"i18n").call(i,"coords.instructions",!0,{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:19},end:{line:12,column:54}}}))+'</p>\r\n                <p class="tc-msg-warning tc-hidden">'+a(s(n,"i18n").call(i,"coords.instructions.warning",!0,{name:"i18n",hash:{},data:o,loc:{start:{line:13,column:52},end:{line:13,column:95}}}))+'</p>\r\n            </div>\r\n            <ul class="tc-ctl-coords-crs-list tc-crs-list"></ul>\r\n        </div>\r\n        <div class="tc-modal-footer">\r\n            <button type="button" class="tc-button tc-modal-close">'+a(s(n,"i18n").call(i,"close",{name:"i18n",hash:{},data:o,loc:{start:{line:18,column:67},end:{line:18,column:83}}}))+"</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},useData:!0},r.register=function(t){var e=this;const n=o.Z.control.ProjectionSelector.prototype.register.call(e,t);return e.crs=e.map.crs,e.clear(),t.on(o.Z.Consts.event.VIEWCHANGE,(function(t){const n=t.view;if(n===o.Z.Consts.view.PRINTING)return;const r=function(t){e.isPointerOver(t)||e.clear()};n===o.Z.Consts.view.THREED?(e.isGeo=!0,e.units=o.Z.Consts.units.DEGREES,e.crs=e.map.view3D.crs,e.map.view3D.container.addEventListener("mouseout",r),e.map.view3D.on(o.Z.Consts.event.MOUSEMOVE,(function(t){if(t){if(o.Z.Util.detectMobile()&&(e.clear(),e.coordsToClick({coordinate:[t.lon,t.lat,t.ele],cssClass:e._cssClasses.THREEDMARKER})),e.latLon=[t.lat,t.lon],t.ele>0){var n=o.Z.Util.getMapLocale(e.map);e.latLon.push(t.ele.toLocaleString(n)+"m")}e.update()}else e.clear()}))):n===o.Z.Consts.view.DEFAULT&&(e.isGeo=e.map.wrap.isGeo(),e.units=o.Z.Consts.units.METERS,e.crs=e.map.crs,e.map.view3D&&e.map.view3D.container.removeEventListener("mouseout",r)),e.map.view3D&&(e.geoCrs=e.map.view3D.crs,e.render())})),t.loaded((function(){e.wrap.register(t).then((function(){e.render((function(){e.clear()}))})),o.Z.Util.detectMobile()&&e.renderPromise().then((function(){e.getLayer(),e.activateCoords()})),t.on(o.Z.Consts.event.PROJECTIONCHANGE,(function(n){t.on3DView||(e.isGeo=t.wrap.isGeo(),e.crs=n.newCrs,e.render())})),e.map.wrap.getViewport().then((function(t){e.renderPromise().then((function(){t.addEventListener(o.Z.Consts.event.MOUSEMOVE,(function(t){e.map.on3DView||e.onMouseMove(t)})),t.addEventListener(o.Z.Consts.event.MOUSELEAVE,(function(t){e.onMouseLeave(t)}))}))}))})),n},r.render=function(t){const e=this;return e._set1stRenderPromise(e.getRenderedHtml(e.CLASS+"-dialog",null,(function(t){e._dialogDiv.innerHTML=t})).then((function(){return o.Z.Control.prototype.renderData.call(e,{x:e.x,y:e.y,lat:e.lat,lon:e.lon,ele:e.isGeo&&e.latLon.length>2?e.latLon[2]:!e.isGeo&&e.xy.length>2?e.xy[2]:null,crs:e.crs,geoCrs:e.geoCrs,isGeo:e.isGeo,showGeo:!e.isGeo&&e.options.showGeo,allowReprojection:e.allowReprojection},(function(){const n=e.div.querySelector("button."+e._cssClasses.CRS);n&&n.addEventListener(o.Z.Consts.event.CLICK,(function(t){e.showProjectionChangeDialog()}),{passive:!0}),o.Z.Util.isFunction(t)&&t()}))})))},r.onMouseMove=function(t){this.wrap.onMouseMove(t)},r.onMouseLeave=function(t){const e=this;setTimeout((function(){e.isPointerOver(t)||(e.div.style.visibility="hidden",e.clear())}),200)},r.isPointerOver=function(t){var e=this.div.getBoundingClientRect();return e.left<=t.clientX&&e.left+e.width>=t.clientX&&e.top<=t.clientY&&e.top+e.height>=t.clientY},r.update=function(){const t=this;!t.isGeo&&t.options.showGeo&&(t.latLon=o.Z.Util.reproject(t.xy,t.crs,t.geoCrs).reverse()),t.isGeo||(t.x=o.Z.Util.formatCoord(t.xy[0],o.Z.Consts.METER_PRECISION),t.y=o.Z.Util.formatCoord(t.xy[1],o.Z.Consts.METER_PRECISION)),(t.isGeo||t.options.showGeo)&&(t.lat=o.Z.Util.formatCoord(t.latLon[0],o.Z.Consts.DEGREE_PRECISION),t.lon=o.Z.Util.formatCoord(t.latLon[1],o.Z.Consts.DEGREE_PRECISION)),t.render((function(){const e=t.div.querySelector("span.close");o.Z.Util.detectMobile()?(e.addEventListener("click",(function(){t.div.classList.add(o.Z.Consts.classes.HIDDEN),t.clear()})),e.style.display=""):(t.div.classList.remove(o.Z.Consts.classes.HIDDEN),t.div.style.visibility="visible",e.style.display="none")}))},r.clear=function(){const t=this;t.div.classList.add(o.Z.Consts.classes.HIDDEN),t.div.style.visibility="hidden",delete t.currentCoordsMarker,t.getLayer().then((function(t){t.features.length&&t.clearFeatures()}))},r.deactivateCoords=function(){var t=this;t.div.classList.add(o.Z.Consts.classes.HIDDEN),t.clear(),t.wrap.coordsDeactivate()},r.activateCoords=function(){this.wrap.coordsActivate()},r.getCoords=function(){var t=this,e=t.map.getControlsByClass(o.Z.control.Popup);e&&e.length>0&&e[0].isVisible()?t.coordsToPopup(e[0]):(t.updateCoordsCtrl([(t.map.getExtent()[0]+t.map.getExtent()[2])/2,(t.map.getExtent()[1]+t.map.getExtent()[3])/2]),t.coordsToClick.call(t,{coordinate:t.xy}))},r.coordsToPopup=function(t){t&&this.updateCoordsCtrl(t.wrap.popup.getPosition())},r.updateCoordsCtrl=function(t){var e=this;t&&(e.isGeo||(e.x=t[0],e.y=t[1],e.xy=[e.x,e.y],t.length>2&&e.xy.push(t[2])),(e.isGeo||e.options.showGeo)&&(e.lat=t[0],e.lon=t[1],e.latLon=[e.lat,e.lon],t.length>2&&e.latLon.push(t[2])),e.update())},r.coordsToClick=function(t){const e=this;if(!e.map.div.classList.contains("tc-ctl-sv-active")||!e.map.div.classList.contains(o.Z.Consts.classes.COLLAPSED)){var n=e.div.getBoundingClientRect();if(n.left<=t.clientX&&t.clientX<=n.right&&n.top<=t.clientY&&t.clientY<=n.bottom)return e.div.classList.add(o.Z.Consts.classes.HIDDEN),void e.clear();e.div.classList.remove("tc-fading"),setTimeout((function(){e.div.classList.add("tc-fading");let t=0,n=getComputedStyle(e.div).getPropertyValue("animation-duration").match(/^(\d+)(m?s)$/i);n&&(t=parseInt(n[1]),"s"===n[2]&&(t*=1e3)),0!==t&&(clearTimeout(e._markerRemoveTimeout),e._markerRemoveTimeout=setTimeout((()=>{e.currentCoordsMarker&&e.getLayer().then((t=>{t.removeFeature(e.currentCoordsMarker),e.currentCoordsMarker=null}))}),t))}),10),e.updateCoordsCtrl(t.coordinate),e.map.on3DView||e.coordsMarkerAdd(t.coordinate,t.cssClass),e.div.classList.remove(o.Z.Consts.classes.HIDDEN)}},r.coordsMarkerAdd=function(t,e){var n=this;n.currentCoordsMarker?n.currentCoordsMarker.setCoords(t):n.getLayer().then((function(r){r.addMarker(t,{title:"Coord",showsPopup:!1,cssClass:e||o.Z.Consts.classes.POINT,anchor:[.5,.5]}).then((function(t){n.currentCoordsMarker=t}))}))},r.getLayer=function(){const t=this;return new Promise((function(e,n){null==t.layer?t.map.addLayer({id:t.getUID(),type:o.Z.Consts.layerType.VECTOR,stealth:!0,owner:t,title:"Coordenadas"}).then((function(n){t.layer=n,t.layer.map.putLayerOnTop(t.layer),e(t.layer)})):e(t.layer)}))};const s=o.Z.control.Coordinates},3192:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>a});var r=n(5361),o=n(2089),i=n(8719);r.Z.control=r.Z.control||{},r.Z.Consts=o.Z,r.Z.control.TabContainer=i.default,r.Z.control.DataLoader=function(){const t=this;r.Z.control.TabContainer.apply(t,arguments);const e={},n={enableDragAndDrop:t.options.enableDragAndDrop},o=t.options.enableFileEditing?"fileEdit":"fileImport";e[o]=n,t.controlOptions=[{title:"addWMS",externalWMS:{suggestions:t.options.wmsSuggestions}},e],t.defaultSelection=0},r.Z.inherit(r.Z.control.DataLoader,r.Z.control.TabContainer),r.Z.control.DataLoader.prototype.register=function(t){const e=this;return e.map=t,e.title=e.getLocaleString("addMaps"),new Promise((function(n,o){r.Z.control.TabContainer.prototype.register.call(e,t).then((t=>{t.div.classList.add(e.CLASS+"-datldr"),n(t)}))}))};const a=r.Z.control.DataLoader},5153:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var r=n(5361),o=n(2089),i=n(2e3),a=n(4496);r.Z.control=r.Z.control||{},r.Z.Consts=o.Z,r.Z.control.MapInfo=i.default,r.Z.filter=a.Z,r.Z.control.Download=function(t){var e=this;e._classSelector="."+e.CLASS,r.Z.Control.apply(e,arguments),e._hiddenElms=[];var n=t||{};e._dialogDiv=r.Z.Util.getDiv(n.dialogDiv),window.$&&(e._$dialogDiv=$(e._dialogDiv)),n.dialogDiv||document.body.appendChild(e._dialogDiv)},r.Z.inherit(r.Z.control.Download,r.Z.control.MapInfo),function(){var t=r.Z.control.Download.prototype;t.CLASS="tc-ctl-download",t.template={},t.template[t.CLASS]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lambda,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+a(l(n,"i18n").call(i,"download",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:4},end:{line:1,column:23}}}))+' </h2>\r\n<div class="tc-ctl-tctr tc-ctl-tctr-select">\r\n    <label class="tc-ctl-tctr-tab tc-ctl-download-image" style="width:calc(100%/2 - 1px)"><input type="radio" name="'+a(s(null!=e?l(e,"controlId"):e,e))+'-sel" value="image" /><span>'+a(l(n,"i18n").call(i,"dl.export.map",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:157},end:{line:3,column:181}}}))+'</span></label><label \r\n\tclass="tc-ctl-tctr-tab tc-ctl-download-data" style="width:calc(100%/2 - 1px)"><input type="radio" name="'+a(s(null!=e?l(e,"controlId"):e,e))+'-sel" value="data" /><span>'+a(l(n,"i18n").call(i,"dl.export.vector",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:145},end:{line:4,column:172}}}))+'</span></label>\r\n</div>\r\n<div class="tc-ctl tc-ctl-tctr-elm tc-ctl-tctr-elm-image tc-group tc-ctl-download-cnt tc-ctl-download-image tc-collapsed">\r\n    <div>\r\n        <label>'+a(l(n,"i18n").call(i,"format",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:15},end:{line:8,column:32}}}))+':</label><select class="tc-combo">\r\n            <option value="image/png">PNG</option>\r\n            <option value="image/jpeg">JPEG</option>\r\n        </select>\r\n        <div class="tc-ctl-download-div">\r\n            <input id="tc-ctl-download-image-qr-'+a(s(null!=e?l(e,"controlId"):e,e))+'" class="tc-hidden" type="checkbox" checked />\r\n            <label for="tc-ctl-download-image-qr-'+a(s(null!=e?l(e,"controlId"):e,e))+'" class="tc-ctl-download-image-qr-label" title="'+a(l(n,"i18n").call(i,"createQrCodeToImage",{name:"i18n",hash:{},data:o,loc:{start:{line:14,column:110},end:{line:14,column:140}}}))+'">'+a(l(n,"i18n").call(i,"appendQRCode",{name:"i18n",hash:{},data:o,loc:{start:{line:14,column:142},end:{line:14,column:165}}}))+'</label>\r\n            <input id="tc-ctl-download-image-wld-'+a(s(null!=e?l(e,"controlId"):e,e))+'" class="tc-hidden" type="checkbox" />\r\n            <label for="tc-ctl-download-image-wld-'+a(s(null!=e?l(e,"controlId"):e,e))+'" class="tc-ctl-download-image-wld-label" title="'+a(l(n,"i18n").call(i,"appendWorldFile.explanation",{name:"i18n",hash:{},data:o,loc:{start:{line:16,column:112},end:{line:16,column:150}}}))+'">'+a(l(n,"i18n").call(i,"appendWorldFile",{name:"i18n",hash:{},data:o,loc:{start:{line:16,column:152},end:{line:16,column:178}}}))+'</label>\r\n        </div>\r\n\r\n        <div class="tc-group tc-group tc-ctl-download-cnt" style="text-align:right;">\r\n            <button type="button" class="tc-ctl-download-btn tc-button tc-icon-button" title="'+a(l(n,"i18n").call(i,"downloadImageFromCurrentMap",{name:"i18n",hash:{},data:o,loc:{start:{line:20,column:94},end:{line:20,column:132}}}))+'" name="descargar">'+a(l(n,"i18n").call(i,"download",{name:"i18n",hash:{},data:o,loc:{start:{line:20,column:151},end:{line:20,column:170}}}))+'</button>\r\n        </div>\r\n        <div class="tc-ctl-download-alert tc-alert alert-warning tc-hidden">\r\n            <p>'+a(l(n,"i18n").call(i,"qrAdvice",!0,{name:"i18n",hash:{},data:o,loc:{start:{line:23,column:15},end:{line:23,column:39}}}))+'</p>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="tc-ctl tc-ctl-tctr-elm tc-ctl-tctr-elm-data tc-group tc-ctl-download-cnt tc-collapsed">\r\n    <div>\r\n        <label>'+a(l(n,"i18n").call(i,"format",{name:"i18n",hash:{},data:o,loc:{start:{line:29,column:15},end:{line:29,column:32}}}))+':</label><select class="tc-combo">\r\n            <option value="GML32">GML</option>\r\n            <option value="application/json">GeoJSON</option>\r\n            <option value="application/vnd.google-earth.kml+xml">KML (Google Earth)</option>\r\n            <option value="shape-zip">Shapefile (ESRI)</option>\r\n        </select>\r\n\r\n        <div class="tc-ctl-download-div">\r\n            <i class="tc-ctl-download-help icon-question-sign" data-toggle="tooltip" data-placement="top" title="'+a(l(n,"i18n").call(i,"showDownloadHelp",{name:"i18n",hash:{},data:o,loc:{start:{line:37,column:113},end:{line:37,column:140}}}))+'"></i>\r\n        </div>\r\n\r\n        <div class="tc-group tc-group tc-ctl-download-cnt" style="text-align:right;">\r\n            <button type="button" class="tc-ctl-download-btn tc-button tc-icon-button" title="'+a(l(n,"i18n").call(i,"downloadLayersFromCurrentExtent",{name:"i18n",hash:{},data:o,loc:{start:{line:41,column:94},end:{line:41,column:136}}}))+'" name="descargar">'+a(l(n,"i18n").call(i,"download",{name:"i18n",hash:{},data:o,loc:{start:{line:41,column:155},end:{line:41,column:174}}}))+'</button>\r\n        </div>\r\n\r\n        <div class="tc-alert alert-warning tc-hidden">\r\n            <p id="zoom-msg-'+a(s(null!=e?l(e,"controlId"):e,e))+'"><strong>'+a(l(n,"i18n").call(i,"tooManyFeatures",{name:"i18n",hash:{},data:o,loc:{start:{line:45,column:51},end:{line:45,column:77}}}))+": </strong>"+a(l(n,"i18n").call(i,"tooManyFeatures.instructions",{name:"i18n",hash:{},data:o,loc:{start:{line:45,column:88},end:{line:45,column:127}}}))+'</p>\r\n            <p id="layers-msg-'+a(s(null!=e?l(e,"controlId"):e,e))+'"><strong>'+a(l(n,"i18n").call(i,"noLayersLoaded",{name:"i18n",hash:{},data:o,loc:{start:{line:46,column:53},end:{line:46,column:78}}}))+": </strong>"+a(l(n,"i18n").call(i,"noLayersLoaded.instructions",{name:"i18n",hash:{},data:o,loc:{start:{line:46,column:89},end:{line:46,column:127}}}))+'</p>\r\n            <p id="url-msg-'+a(s(null!=e?l(e,"controlId"):e,e))+'"><strong>'+a(l(n,"i18n").call(i,"tooManySelectedLayers",{name:"i18n",hash:{},data:o,loc:{start:{line:47,column:50},end:{line:47,column:82}}}))+": </strong>"+a(l(n,"i18n").call(i,"tooManySelectedLayers.instructions",{name:"i18n",hash:{},data:o,loc:{start:{line:47,column:93},end:{line:47,column:138}}}))+'</p>\r\n            <p id="noFeatures-msg-'+a(s(null!=e?l(e,"controlId"):e,e))+'"><strong>'+a(l(n,"i18n").call(i,"noData",{name:"i18n",hash:{},data:o,loc:{start:{line:48,column:57},end:{line:48,column:74}}}))+": </strong>"+a(l(n,"i18n").call(i,"noData.instructions",{name:"i18n",hash:{},data:o,loc:{start:{line:48,column:85},end:{line:48,column:115}}}))+'</p>\r\n            <p id="novalid-msg-'+a(s(null!=e?l(e,"controlId"):e,e))+'"><strong>'+a(l(n,"i18n").call(i,"noValidService",{name:"i18n",hash:{},data:o,loc:{start:{line:49,column:54},end:{line:49,column:79}}}))+": </strong>"+a(l(n,"i18n").call(i,"noValidService.instructions",{name:"i18n",hash:{},data:o,loc:{start:{line:49,column:90},end:{line:49,column:128}}}))+"</p>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n"},useData:!0},t.template[t.CLASS+"-dialog"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-download-help-dialog tc-modal">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+a(s(n,"i18n").call(i,"downloadData",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:16},end:{line:5,column:39}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <p>'+a(s(n,"i18n").call(i,"dl.instructions.1",!0,{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:15},end:{line:9,column:48}}}))+"</p>\r\n            <ul>\r\n                <li>"+a(s(n,"i18n").call(i,"dl.instructions.2",!0,{name:"i18n",hash:{},data:o,loc:{start:{line:11,column:20},end:{line:11,column:53}}}))+"</li>\r\n                <li>"+a(s(n,"i18n").call(i,"dl.instructions.3",!0,{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:20},end:{line:12,column:53}}}))+"</li>\r\n                    <li>\r\n                        "+a(s(n,"i18n").call(i,"dl.instructions.4",!0,{name:"i18n",hash:{},data:o,loc:{start:{line:14,column:24},end:{line:14,column:57}}}))+"\r\n                    <ul>\r\n                        <li>"+a(s(n,"i18n").call(i,"dl.instructions.5",!0,{name:"i18n",hash:{},data:o,loc:{start:{line:16,column:28},end:{line:16,column:61}}}))+"</li>\r\n                        <li>"+a(s(n,"i18n").call(i,"dl.instructions.6",!0,{name:"i18n",hash:{},data:o,loc:{start:{line:17,column:28},end:{line:17,column:61}}}))+'</li>\r\n                    </ul>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n        <div class="tc-modal-footer">\r\n            <button type="button" class="tc-button tc-modal-close">'+a(s(n,"i18n").call(i,"close",{name:"i18n",hash:{},data:o,loc:{start:{line:23,column:67},end:{line:23,column:83}}}))+"</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n"},useData:!0},t.render=function(t){const e=this;return e._set1stRenderPromise(e.getRenderedHtml(e.CLASS+"-dialog",null,(function(t){e._dialogDiv.innerHTML=t})).then((function(){return r.Z.Control.prototype.renderData.call(e,{controlId:e.id},(function(){const n=".tc-ctl-tctr";e._selectors={TAB:n+"-tab",RADIOBUTTON:`input[type=radio][name="${e.id}-sel"]`,ELEMENT:n+"-elm"};const o=function(t){for(var n=this;n&&!n.matches(e._selectors.TAB);)n=n.parentElement;if(n){const t=n.querySelector(e._selectors.RADIOBUTTON),o=t.value,i=e.div.querySelectorAll(e._selectors.ELEMENT);e._oldValue===o&&e.options.deselectableTabs?(setTimeout((function(){t.checked=!1}),0),e._oldValue=null,e._activeElm=null,i.forEach((function(t){e._hiddenElms.push(t)}))):(i.forEach((function(t){t.matches(e._selectors.ELEMENT+"-"+o)?e._activeElm=t:e._hiddenElms.push(t)})),e._oldValue=o),e._hiddenElms.forEach((function(t){t.classList.add(r.Z.Consts.classes.COLLAPSED)})),e._activeElm&&e._activeElm.classList.remove(r.Z.Consts.classes.COLLAPSED),t.checked=!0}};e.div.querySelectorAll("span").forEach((function(t){t.addEventListener(r.Z.Consts.event.CLICK,o,{passive:!0})})),t&&t()}))})))};const e=function(t){let e=t.toFixed(20);return e.indexOf(".")>=0&&(e=e.replace(/0+$/,"").replace(/\.$/,"")),e};t.register=function(t){var n=this;const o=r.Z.control.MapInfo.prototype.register.call(n,t);n.map.crossOrigin="anonymous";var i=function(t,e){const o=n.div.querySelector(".alert-warning:not(."+n.CLASS+"-alert)");var i;switch(t.key){case r.Z.Consts.WFSErrors.MAX_NUM_FEATURES:i=o.querySelector("#zoom-msg-"+n.id).innerHTML.format({serviceName:t.params.serviceTitle});break;case r.Z.Consts.WFSErrors.NO_LAYERS:i=n.getLocaleString("noLayersLoaded");break;case r.Z.Consts.WFSErrors.GETCAPABILITIES:i=o.querySelector("#novalid-msg-"+n.id).innerHTML.format({serviceName:t.params.serviceTitle});break;case r.Z.Consts.WFSErrors.NO_FEATURES:i=o.querySelector("#noFeatures-msg-"+n.id).innerHTML;break;case r.Z.Consts.WFSErrors.INDETERMINATE:return i=n.getLocaleString("wfs.IndeterminateError"),n.map.toast(i,{type:r.Z.Consts.msgType.ERROR}),r.Z.error("Error:{error} \r\n Descripcion:{descripcion} \r\n Servicio:{serviceName}".format({error:t.params.err,descripcion:t.params.errorThrown,serviceName:t.params.serviceTitle}),r.Z.Consts.msgErrorMode.CONSOLE),void n.map.getLoadingIndicator().removeWait(e);default:i=n.getLocaleString("wfs."+t.key,t.params)}n.map.toast(i,{type:r.Z.Consts.msgType.WARNING}),n.map.getLoadingIndicator().removeWait(e)};return n.div.addEventListener(r.Z.Consts.event.CLICK,r.Z.EventTarget.listenerBySelector(".tc-ctl-download-btn",(function(){var t="";n._activeElm&&(t=n._activeElm.querySelector("select").value),t.indexOf("image")>-1?function(t){const o=n.map.getLoadingIndicator(),i=o&&o.addWait(),a=n.map.getExtent();new Promise((function(t,e){var a=n.map.wrap.getCanvas(),s=r.Z.Util.mergeCanvases(a);if(n.map.getControlsByClass(r.Z.control.ScaleBar)&&n.drawScaleBarIntoCanvas({canvas:s,fill:!0}),!n._activeElm.querySelector(`#${n.CLASS}-image-qr-${n.id}:disabled`)&&n._activeElm.querySelector(`#${n.CLASS}-image-qr-${n.id}:checked`)){const e="qrcode";var l=document.getElementById(e);l?l.innerHTML="":((l=document.createElement("div")).setAttribute("id",e),document.body.appendChild(l)),l.style.top="-200px",l.style.left="-200px",l.style.position="absolute",n.makeQRCode(l,87,87).then((function(e){if(e){var n=s.getContext("2d");n.fillStyle="#ffffff",n.fillRect(s.width-91,s.height-91,91,91),r.Z.Util.addToCanvas(s,e,{x:s.width-88,y:s.height-88}).then((function(e){t(e)}))}else o&&o.removeWait(i)}))}else t(s)})).then((function(s){const l=window.location.hostname+"_"+n.map.crs.replace(":","")+"_"+r.Z.Util.getFormattedDate((new Date).toString(),!0),c="."+t.split("/")[1],u=t===r.Z.Consts.mimeType.JPEG?".jgw":".pgw";if(n._activeElm.querySelector(`#${n.CLASS}-image-wld-${n.id}:checked`))r.Z.loadJS(!window.JSZip,r.Z.apiLocation+"lib/jszip/jszip",(function(){const p=(a[2]-a[0])/s.width,d=(a[1]-a[3])/s.height,h=a[0],f=a[3],m=new JSZip;s.toBlob((function(t){m.file(l+c,t),m.file(l+u,`${e(p)}\n${(0).toFixed(1)}\n${(0).toFixed(1)}\n${e(d)}\n${e(h)}\n${e(f)}`),m.generateAsync({type:"blob"}).then((function(t){r.Z.Util.downloadBlob(l+".zip",t),o&&o.removeWait(i)}),(function(t){r.Z.error(n.getLocaleString("dl.export.map.error")+": "+t.message),o&&o.removeWait(i)}))}),t)}));else{try{const e=s.toDataURL(t);r.Z.Util.downloadDataURI(l+c,t,e)}catch(t){r.Z.error(n.getLocaleString("dl.export.map.error")+": "+t.message)}o&&o.removeWait(i)}}))}(t):function(t){const e=n.map.getLoadingIndicator(),o=e&&e.addWait(),a=n.map.extractFeatures({filter:r.Z.filter.bbox(n.map.getExtent(),n.map.getCRS()),outputFormat:t,download:!0});Promise.all(a).then((async function(a){var s=a.filter((t=>!!t));if(0!==s.length){for(var l=[],c=0;c<s.length;c++)if(s[c].errors&&s[c].errors.length)for(var u=0;u<s[c].errors.length;u++){var p=s[c].errors[u];i(p,o)}else{var d=s[c].data,h=s[c].url;d&&h&&l.push({url:h+"?download=zip",data:d})}try{await r.Z.Util.downloadFileForm(l)}catch(e){if(e.key===r.Z.Consts.DownloadError.MIMETYPE_NOT_SUPORTED){const o=a.find((t=>t.data===e.data)).service,i={plural:o.layers.length>1?n.getLocaleString("dl.format.notSupported.plural"):"",layerNames:o.layers.reduce((function(t,e,r,o){return(t instanceof Array?t:[t]).concat([e.title]).join(r<o.length-1?", ":" "+n.getLocaleString("dl.format.notSupported.conjunction")+" ")}),[]),serviceTitle:o.mapLayers[0].title,format:t};n.map.toast(n.getLocaleString("dl.format.notSupported").format(i),{type:r.Z.Consts.msgType.ERROR})}}e&&e.removeWait(o)}else i({key:r.Z.Consts.WFSErrors.NO_LAYERS},o)}))}(t)})),{passive:!0}),n.div.addEventListener(r.Z.Consts.event.CLICK,r.Z.EventTarget.listenerBySelector(".tc-ctl-download-help",(function(t){t.stopPropagation(),r.Z.Util.showModal(n._dialogDiv.querySelector(n._classSelector+"-help-dialog"))})),{passive:!0}),n.div.addEventListener("change",r.Z.EventTarget.listenerBySelector(`#${n.CLASS}-image-qr-${n.id}`,(function(t){t.target.checked?n.generateLink():n.div.querySelector("."+n.CLASS+"-alert").classList.add(r.Z.Consts.classes.HIDDEN)}))),n.div.addEventListener("click",r.Z.EventTarget.listenerBySelector("h2",(function(t){n.registeredListeners||n.generateLink(),n.registerListeners()}))),o},t.manageMaxLengthExceed=function(t){const e=this,n=e.div.querySelector("."+e.CLASS+"-alert"),o=document.getElementById(`${e.CLASS}-image-qr-${e.id}`);o.disabled=t.qr,o.checked?n.classList.toggle(r.Z.Consts.classes.HIDDEN,!t.qr):n.classList.add(r.Z.Consts.classes.HIDDEN)},t.generateLink=async function(){const t=this,e=t.div.querySelector(`.${t.CLASS}-div input[id|="${t.CLASS}-image-qr-download"]`),n=t.div.querySelector(`label[for="${e.id}"]`);e.disabled=!0,n.classList.add(r.Z.Consts.classes.LOADING);const o=await r.Z.control.MapInfo.prototype.generateLink.call(t);return n.classList.remove(r.Z.Consts.classes.LOADING),o}}();const s=r.Z.control.Download},2791:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>c});var r=n(5361),o=n(2089),i=n(6498),a=n(2391),s=n(1327),l=n(6281);r.Z.control=r.Z.control||{},r.Z.Control=i.Z,r.Z.Consts=o.Z,r.Z.feature=r.Z.feature||{},r.Z.feature.Point=a.Z,r.Z.feature.Polyline=s.Z,r.Z.feature.Polygon=l.Z,r.Z.Consts.event.DRAWSTART="drawstart.tc",r.Z.Consts.event.DRAWEND="drawend.tc",r.Z.Consts.event.DRAWCANCEL="drawcancel.tc",r.Z.Consts.event.DRAWUNDO="drawundo.tc",r.Z.Consts.event.DRAWREDO="drawredo.tc",r.Z.Consts.event.POINT="point.tc",r.Z.Consts.event.MEASURE="measure.tc",r.Z.Consts.event.MEASUREPARTIAL="measurepartial.tc",r.Z.Consts.event.STYLECHANGE="stylechange.tc",r.Z.Consts.event.CHANGE="change",function(){const t=function(t){const e=t.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);return e&&e.length?"#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]:t};r.Z.control.Draw=function(){var t=this;r.Z.Control.apply(t,arguments),r.Z.browserFeatures.inputTypeColor()||window.CP||(r.Z.loadCSS(r.Z.apiLocation+"lib/color-picker/color-picker.min.css"),r.Z.syncLoadJS(r.Z.apiLocation+"lib/color-picker/color-picker.min.js")),t._classSelector="."+t.CLASS,t._pointClass=t.CLASS+"-point",t._lineClass=t.CLASS+"-line",t._polygonClass=t.CLASS+"-polygon",t.history=[],t.historyIndex=0,t.exportsState=!0,t.on(r.Z.Consts.event.DRAWSTART,(function(e){t.resetValues(),e.feature&&(t.history=e.feature.getCoordinates(),t.historyIndex=t.history.length)})).on(r.Z.Consts.event.POINT,(function(e){t.layer&&!t.persistent&&t.layer.features&&t.layer.features.length>0&&t.layer.clearFeatures(),t.history.length=t.historyIndex,t.history[t.historyIndex++]=e.point,n(t)})).on(r.Z.Consts.event.DRAWEND,(function(e){o(t);const n=r.Z.getUID({prefix:t.getLocaleString("sketch")+".",banlist:t.layer.features.map((t=>t.getId()))});e.feature.setId(n),t.callback&&t.callback(e.feature)})),t._layerPromise=null},r.Z.inherit(r.Z.control.Draw,r.Z.Control);var e=r.Z.control.Draw.prototype;e.CLASS="tc-ctl-draw";var n=function(t){t._endBtn.disabled=0===t.historyIndex||t.mode===r.Z.Consts.geom.POLYGON&&t.historyIndex<3||t.mode===r.Z.Consts.geom.POLYLINE&&t.historyIndex<2,t._redoBtn.disabled=t.history.length===t.historyIndex,t._undoBtn.disabled=0===t.historyIndex},o=function(t){t.resetValues(),t._endBtn.disabled=!0,t._cancelBtn.disabled=!1};e.template={1:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lambda,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-draw-style">\r\n    <div class="tc-ctl-draw-style-stroke">\r\n        '+a(l(n,"i18n").call(i,"strokeColor",{name:"i18n",hash:{},data:o,loc:{start:{line:11,column:8},end:{line:11,column:30}}}))+'\r\n        <input type="color" class="tc-ctl-col tc-ctl-draw-str-c" value="'+a(s(null!=e?l(e,"strokeColor"):e,e))+'" title="'+a(l(n,"i18n").call(i,"selectColor",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:96},end:{line:12,column:118}}}))+'" />\r\n        '+a(l(n,"i18n").call(i,"width",{name:"i18n",hash:{},data:o,loc:{start:{line:13,column:8},end:{line:13,column:24}}}))+'\r\n        <div class="tc-ctl-draw-str-w-watch" style="border-bottom-width:'+a(s(null!=e?l(e,"strokeWidth"):e,e))+'px;"> </div>\r\n        <input type="number" class="tc-ctl-draw-str-w tc-textbox" value="'+a(s(null!=e?l(e,"strokeWidth"):e,e))+'" min="1" max="15" />\r\n    </div>\r\n    <div class="tc-ctl-draw-style-fill">\r\n        '+a(l(n,"i18n").call(i,"fillColor",{name:"i18n",hash:{},data:o,loc:{start:{line:18,column:8},end:{line:18,column:28}}}))+'\r\n        <input type="color" class="tc-ctl-col tc-ctl-draw-fll-c" value="'+a(s(null!=e?l(e,"fillColor"):e,e))+'" title="'+a(l(n,"i18n").call(i,"selectColor",{name:"i18n",hash:{},data:o,loc:{start:{line:19,column:94},end:{line:19,column:116}}}))+'" />\r\n        '+a(l(n,"i18n").call(i,"opacity",{name:"i18n",hash:{},data:o,loc:{start:{line:20,column:8},end:{line:20,column:26}}}))+'\r\n        <input type="number" class="tc-ctl-draw-fll-w tc-textbox" value="'+a(s(null!=e?l(e,"fillOpacity"):e,e))+'" min="0" max="100" />\r\n    </div>\r\n</div>\r\n'},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=t.escapeExpression,s=null!=e?e:t.nullContext||{},l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-draw-tools">\r\n    <button type="button" class="tc-ctl-btn tc-ctl-draw-btn-new" title="'+a(t.lambda(null!=e?l(e,"tooltip"):e,e))+'">'+a(l(n,"i18n").call(s,"new",{name:"i18n",hash:{},data:o,loc:{start:{line:2,column:85},end:{line:2,column:99}}}))+'</button>\r\n    <button type="button" class="tc-ctl-btn tc-ctl-draw-btn-undo" disabled title="'+a(l(n,"i18n").call(s,"undo",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:82},end:{line:3,column:97}}}))+'">'+a(l(n,"i18n").call(s,"undo",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:99},end:{line:3,column:114}}}))+'</button>\r\n    <button type="button" class="tc-ctl-btn tc-ctl-draw-btn-redo" disabled title="'+a(l(n,"i18n").call(s,"redo",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:82},end:{line:4,column:97}}}))+'">'+a(l(n,"i18n").call(s,"redo",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:99},end:{line:4,column:114}}}))+'</button>\r\n    <button type="button" class="tc-ctl-btn tc-ctl-draw-btn-end" disabled title="'+a(l(n,"i18n").call(s,"end",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:81},end:{line:5,column:95}}}))+'">'+a(l(n,"i18n").call(s,"end",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:97},end:{line:5,column:111}}}))+'</button>\r\n    <button type="button" class="tc-ctl-btn tc-ctl-draw-btn-cancel" title="'+a(l(n,"i18n").call(s,"cancel",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:75},end:{line:6,column:92}}}))+'">'+a(l(n,"i18n").call(s,"cancel",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:94},end:{line:6,column:111}}}))+"</button>\r\n</div>\r\n"+(null!=(i=l(n,"if").call(s,null!=e?l(e,"styling"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:8,column:0},end:{line:24,column:7}}}))?i:"")+"\r\n"},useData:!0},e.render=function(e){const n=this;let o,i,a,s,l;switch(n.options.mode){case r.Z.Consts.geom.POLYLINE:case r.Z.Consts.geom.MULTIPOLYLINE:o=n.getLocaleString("drawLine"),n.div.classList.add(n._lineClass),i=n.styles.line.strokeColor,a=n.styles.line.strokeWidth,s=n.styles.polygon.fillColor,l=n.styles.polygon.fillOpacity;break;case r.Z.Consts.geom.POLYGON:case r.Z.Consts.geom.MULTIPOLYGON:o=n.getLocaleString("drawPolygon"),n.div.classList.add(n._polygonClass),i=n.styles.polygon.strokeColor,a=n.styles.polygon.strokeWidth,s=n.styles.polygon.fillColor,l=n.styles.polygon.fillOpacity;break;case r.Z.Consts.geom.POINT:case r.Z.Consts.geom.MULTIPOINT:o=n.getLocaleString("drawPoint"),n.div.classList.add(n._pointClass),i=n.styles.point.strokeColor,a=n.styles.point.strokeWidth,s=n.styles.point.fillColor,l=n.styles.point.fillOpacity;break;default:o=n.getLocaleString("draw"),i=n.styles.line.strokeColor,a=n.styles.line.strokeWidth,s=n.styles.polygon.fillColor,l=n.styles.polygon.fillOpacity}const c={tooltip:o,strokeColor:t(i),strokeWidth:a,fillColor:t(s),fillOpacity:100*l,styling:n.options.styling};return n._set1stRenderPromise(n.renderData(c,(function(){if(!r.Z.browserFeatures.inputTypeColor()){const t=n.div.querySelector("input[type=color]");if(t){t.style.backgroundColor=t.value,t.style.color="transparent";const e=new CP(t,"click",document.body);t.onclick=function(t){t.preventDefault()},t.onfocus=function(t){this.blur()},t.onchange=function(t){this.style.backgroundColor=this.value},n.map.loaded((function(){e.on("change",(function(t){n.setStrokeColor("#"+t)}))}))}}n.reset=!0,n.callback=null,n.measure=!1,n._cancelClick=!1,n.mode=n.options.mode||r.Z.Consts.geom.POLYLINE,n.options.measure&&(n.measure=n.options.measure),r.Z.Util.isFunction(n.options.callback)&&(n.callback=n.options.callback),void 0===n.options.persistent?n.persistent=!0:n.persistent=n.options.persistent,n.wrap=new r.Z.wrap.control.Draw(n),n._newBtn=n.div.querySelector(n._classSelector+"-btn-new"),n._newBtn.addEventListener(r.Z.Consts.event.CLICK,(function(){n.new()}),{passive:!0}),n._cancelBtn=n.div.querySelector(n._classSelector+"-btn-cancel"),n._cancelBtn.addEventListener(r.Z.Consts.event.CLICK,(function(){n.cancel()}),{passive:!0}),n._endBtn=n.div.querySelector(n._classSelector+"-btn-end"),n._endBtn.addEventListener(r.Z.Consts.event.CLICK,(function(){n.end()}),{passive:!0}),n._undoBtn=n.div.querySelector(n._classSelector+"-btn-undo"),n._undoBtn.addEventListener(r.Z.Consts.event.CLICK,(function(){n.undo()}),{passive:!0}),n._redoBtn=n.div.querySelector(n._classSelector+"-btn-redo"),n._redoBtn.addEventListener(r.Z.Consts.event.CLICK,(function(){n.redo()}),{passive:!0}),n.options.styling&&(n._strokeColorPicker=n.div.querySelector(n._classSelector+"-str-c"),n._strokeColorPicker.addEventListener(r.Z.Consts.event.CHANGE,(function(t){n.setStrokeColor(t.target.value)})),n._strokeWidthSelector=n.div.querySelector(n._classSelector+"-str-w"),n._strokeWidthSelector.addEventListener(r.Z.Consts.event.CHANGE,(function(t){n.setStrokeWidth(t.target.value)})),n._strokeWidthWatch=n.div.querySelector(n._classSelector+"-str-w-watch"),n._fillColorPicker=n.div.querySelector(n._classSelector+"-fll-c"),n._fillColorPicker.addEventListener(r.Z.Consts.event.CHANGE,(function(t){n.setFillColor(t.target.value)})),n._fillOpacitySelector=n.div.querySelector(n._classSelector+"-fll-w"),n._fillOpacitySelector.addEventListener(r.Z.Consts.event.CHANGE,(function(t){n.setFillOpacity(parseFloat(t.target.value)/100)}))),r.Z.Util.isFunction(e)&&e()})))},e.register=function(t){const e=this;e.styles=r.Z.Util.extend(!0,{},t.options.styles,e.options.styles);const n=r.Z.Control.prototype.register.call(e,t);return e.map.on(r.Z.Consts.event.VIEWCHANGE,(function(){e.map.view===r.Z.Consts.view.PRINTING&&e.end()})).on(r.Z.Consts.event.PROJECTIONCHANGE,(function(t){e.history.forEach((function(e,n,o){o[n]=r.Z.Util.reproject(e,t.oldCrs,t.newCrs)}))})),e._layerPromise=new Promise((function(n,o){t.loaded((function(){e.options.layer?(e.setLayer(e.options.layer),n(e.layer)):!1===e.options.layer?(e.setLayer(null),n(null)):t.addLayer({id:e.getUID(),title:"DrawControl",stealth:!0,owner:e,type:r.Z.Consts.layerType.VECTOR,styles:{point:e.styles.point,line:e.styles.line,polygon:e.styles.polygon}}).then((function(r){t.putLayerOnTop(r),e.setLayer(r),n(e.layer)}))}))})),n},e.new=function(){var t=this;return t.layer&&!t.persistent&&t.layer.clearFeatures(),t._cancelBtn.disabled=!1,t.setMode(t.mode,!0),t},e.undo=function(){var t=this,e=t.wrap.undo();return e&&(t.historyIndex--,n(t),t.historyIndex<=0&&t.resetValues(),t.trigger(r.Z.Consts.event.DRAWUNDO)),e},e.redo=function(){var t=this,e=this.wrap.redo();return e&&(t.historyIndex++,n(t),t.trigger(r.Z.Consts.event.DRAWREDO)),e},e.cancel=function(){var t=this;return t._cancelClick=!0,this.setMode(null,!1),t.resetValues(),o(t),t._cancelBtn.disabled=!0,t.trigger(r.Z.Consts.event.DRAWCANCEL,{ctrl:t}),t},e.activate=function(){var t=this;switch(t._newBtn.classList.add(r.Z.Consts.classes.ACTIVE),t._cancelBtn.disabled=!1,r.Z.Control.prototype.activate.call(t),t.wrap.activate(t.mode),t.div.classList.remove(t._pointClass,t._lineClass,t._polygonClass),t.toggleFillStyleTools(t.mode!==r.Z.Consts.geom.POLYLINE&&t.mode!==r.Z.Consts.geom.MULTIPOLYLINE),t.mode){case r.Z.Consts.geom.POINT:t.div.classList.add(t._pointClass);break;case r.Z.Consts.geom.POLYLINE:t.div.classList.add(t._lineClass);break;case r.Z.Consts.geom.POLYGON:t.div.classList.add(t._polygonClass)}},e.deactivate=function(){var t=this;t._newBtn&&t._newBtn.classList.remove(r.Z.Consts.classes.ACTIVE),t._cancelBtn&&(t._cancelBtn.disabled=!0),r.Z.Control.prototype.deactivate.call(t,!t._cancelClick),t.wrap&&t.wrap.deactivate(),t.resetValues(),t._cancelClick=!1},e.clear=function(){const t=this;return t.layer&&t.layer.clearFatures(),t.resetValues(),t},e.isExclusive=function(){return!0},e.end=function(){const t=this;return t.wrap.end(),t.resetValues(),t},e.setMode=function(t,e){const n=this;return t&&(n.mode=t,n.toggleFillStyleTools(t!==r.Z.Consts.geom.POLYLINE&&t!==r.Z.Consts.geom.MULTIPOLYLINE)),e&&t?n.activate():n.deactivate(),n},e.setStyle=function(t){const e=this;switch(e.options.mode){case r.Z.Consts.geom.POLYLINE:case r.Z.Consts.geom.MULTIPOLYLINE:case r.Z.Consts.geom.RECTANGLE:t=r.Z.Util.extend(e.styles.line,t);break;case r.Z.Consts.geom.POLYGON:case r.Z.Consts.geom.MULTIPOLYGON:t=r.Z.Util.extend(e.styles.polygon,t);break;case r.Z.Consts.geom.POINT:case r.Z.Consts.geom.MULTIPOINT:t=r.Z.Util.extend(e.styles.point,t);break;default:t={}}e.style=r.Z.Util.extend(e.style,t),e.wrap.setStyle()},e.getModeStyle=function(t){const e=this;switch(t=t||e.options.mode){case r.Z.Consts.geom.POLYLINE:case r.Z.Consts.geom.MULTIPOLYLINE:return e.styles.line;case r.Z.Consts.geom.POLYGON:case r.Z.Consts.geom.MULTIPOLYGON:return e.styles.polygon;case r.Z.Consts.geom.POINT:case r.Z.Consts.geom.MULTIPOINT:return e.styles.point;default:return null}};const i=function(t,e){const n=t=>new Number(t).toString(16).padStart(2,"0");if(Array.isArray(e))e=`#${n(e[0])}${n(e[1])}${n(e[2])}`;else{const t=e.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);t&&t.length&&(e="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3])}if(t.value=e,!r.Z.browserFeatures.inputTypeColor()){const n=t;n.style.backgroundColor=e,n.blur()}};e.setStrokeColorWatch=function(t){const e=this;return e.options.styling&&(void 0===t&&(t=e.getModeStyle().strokeColor),i(e._strokeColorPicker,t)),e},e.setFillColorWatch=function(t){const e=this;return e.options.styling&&(void 0===t&&(t=e.getModeStyle().fillColor),i(e._fillColorPicker,t)),e};const a=function(t,e,n){const o=this,i=o.style||o.getModeStyle();return i&&(i[t]=n),o.setStyle(i),e.call(o,n),o.trigger(r.Z.Consts.event.STYLECHANGE,{property:t,value:n}),o};e.setStrokeColor=function(t){return a.call(this,"strokeColor",this.setStrokeColorWatch,t)},e.setFillColor=function(t){return a.call(this,"fillColor",this.setFillColorWatch,t)},e.setFillOpacityWatch=function(t){const e=this;return e.options.styling&&(void 0===t&&(t=Math.round(100*e.getModeStyle().fillOpacity)),(t=parseInt(t,10))!==Number.NaN&&(e._fillOpacitySelector.value=t)),e},e.setFillOpacity=function(t){const e=this;if(t!==Number.NaN){const n=e.getModeStyle();n&&(n.fillOpacity=t),e.setStyle(n),e.setFillOpacityWatch(Math.round(100*t)),e.trigger(r.Z.Consts.event.STYLECHANGE,{property:"fillOpacity",value:t})}return e},e.setStrokeWidthWatch=function(t){const e=this;return e.options.styling&&(void 0===t&&(t=e.getModeStyle().strokeWidth),(t=parseInt(t,10))!==Number.NaN&&(e._strokeWidthSelector.value=t,e._strokeWidthWatch.style.borderBottomWidth=t+"px")),e},e.setStrokeWidth=function(t){const e=this;if((t=parseInt(t,10))!==Number.NaN){const n=e.getModeStyle();n&&(n.strokeWidth=t),e.setStyle(n),e.setStrokeWidthWatch(t),e.trigger(r.Z.Consts.event.STYLECHANGE,{property:"strokeWidth",value:t})}return e};const s=function(t,e){if(t){const n=void 0!==e?!e:void 0;t.classList.toggle(r.Z.Consts.classes.HIDDEN,n)}};e.toggleStyleTools=function(t){const e=this;return s(e.div.querySelector(`.${e.CLASS}-style`),t),e},e.toggleFillStyleTools=function(t){const e=this;return s(e.div.querySelector(`.${e.CLASS}-style-fill`),t),e},e.getLayer=function(){const t=this;return t.layer?Promise.resolve(t.layer):this._layerPromise},e.setLayer=function(t){const e=this;if(e.map){e.layer="string"==typeof t?e.map.getLayer(t):t,e.styles={};const n=e.layer&&e.layer.styles||r.Z.Cfg.styles;r.Z.Util.extend(!0,e.styles,e.options.styles||n)}},e.resetValues=function(){const t=this;return t.history.length=0,t.historyIndex=0,n(t),t},e.exportState=function(){const t=this;return t.exportsState&&t.layer?{id:t.id,layer:t.layer.exportState()}:null},e.importState=function(t){this.getLayer().then((function(e){e.importState(t.layer)}))}}();const c=r.Z.control.Draw},4313:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>a});var r=n(5361),o=n(2089),i=n(3731);r.Z.control=r.Z.control||{},r.Z.Consts=o.Z,r.Z.control.Measure=i.default,r.Z.control.DrawMeasureModify=function(){var t=this;r.Z.control.Measure.apply(t,arguments),t._dialogDiv=r.Z.Util.getDiv(t.options.dialogDiv),window.$&&(t._$dialogDiv=$(t._dialogDiv)),t.options.dialogDiv||document.body.appendChild(t._dialogDiv);const e=t._classSelector="."+t.CLASS;t._selectors={ELEVATION_CHECKBOX:e+"-dialog-elev input[type=checkbox]"},t.persistentDrawControls=!0,t.renderPromise().then((function(){t._1stCoordText=t.div.querySelector(".tc-ctl-meas-val-coord-1-t"),t._2ndCoordText=t.div.querySelector(".tc-ctl-meas-val-coord-2-t"),t._1stCoordValue=t.div.querySelector(".tc-ctl-meas-val-coord-1-v"),t._2ndCoordValue=t.div.querySelector(".tc-ctl-meas-val-coord-2-v"),t._elevationText=t.div.querySelector(".tc-ctl-meas-val-coord-ele-t"),t._elevationValue=t.div.querySelector(".tc-ctl-meas-val-coord-ele-v")}))},r.Z.inherit(r.Z.control.DrawMeasureModify,r.Z.control.Measure),function(){var t=r.Z.control.DrawMeasureModify.prototype;t.CLASS="tc-ctl-dmm",r.Z.Consts.event.RESULTSPANELCLOSE=r.Z.Consts.event.RESULTSPANELCLOSE||"resultspanelclose.tc",r.Z.Consts.event.FEATURESSELECT=r.Z.Consts.event.FEATURESSELECT||"featuresselect.tc",t.template={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lambda,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+a(l(n,"i18n").call(i,"drawAndMeasure",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:4},end:{line:1,column:29}}}))+'</h2>\r\n<div class="tc-ctl-meas-select">\r\n    <label class="tc-ctl-meas-btn-pt"><input type="radio" name="'+a(s(null!=e?l(e,"controlId"):e,e))+'-mode" value="point" /><span>'+a(l(n,"i18n").call(i,"points",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:106},end:{line:3,column:123}}}))+'</span></label><label \r\n\tclass="tc-ctl-meas-btn-len"><input type="radio" name="'+a(s(null!=e?l(e,"controlId"):e,e))+'-mode" value="polyline" /><span>'+a(l(n,"i18n").call(i,"lines",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:100},end:{line:4,column:116}}}))+'</span></label><label \r\n\tclass="tc-ctl-meas-btn-area"><input type="radio" name="'+a(s(null!=e?l(e,"controlId"):e,e))+'-mode" value="polygon" /><span>'+a(l(n,"i18n").call(i,"polygons",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:100},end:{line:5,column:119}}}))+'</span></label>\r\n</div>\r\n<div class="tc-ctl-meas-mode tc-ctl-meas-pt tc-hidden">\r\n    <div class="tc-ctl-meas-point"></div>\r\n    <div class="tc-ctl-meas-txt">'+a(l(n,"i18n").call(i,"search.list.coordinates",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:33},end:{line:9,column:67}}}))+' <span class="tc-ctl-meas-val-coord">\r\n           <span class="tc-ctl-meas-val-coord-1-t"></span> <span class="tc-ctl-meas-val-coord-1-v"></span> <span class="tc-ctl-meas-val-coord-2-t"></span> <span class="tc-ctl-meas-val-coord-2-v"></span> <span class="tc-ctl-meas-val-coord-ele-t"></span> <span class="tc-ctl-meas-val-coord-ele-v"></span>\r\n        </span>\r\n    </div>\r\n</div>\r\n<div class="tc-ctl-meas-mode tc-ctl-meas-len tc-hidden">\r\n    <div class="tc-ctl-meas-line"></div>\r\n    <div class="tc-ctl-meas-txt">'+a(l(n,"i18n").call(i,"2dLength",{name:"i18n",hash:{},data:o,loc:{start:{line:16,column:33},end:{line:16,column:52}}}))+': <span class="tc-ctl-meas-val-len"></span><button type="button" class="tc-ctl-meas-prof-btn tc-active" title="'+a(l(n,"i18n").call(i,"deactivateElevationProfile",{name:"i18n",hash:{},data:o,loc:{start:{line:16,column:163},end:{line:16,column:200}}}))+'">'+a(l(n,"i18n").call(i,"geo.trk.chart.chpe",{name:"i18n",hash:{},data:o,loc:{start:{line:16,column:202},end:{line:16,column:231}}}))+'</button></div>\r\n</div>\r\n<div class="tc-ctl-meas-mode tc-ctl-meas-area tc-hidden">\r\n    <div class="tc-ctl-meas-polygon"></div>\r\n    <div class="tc-ctl-meas-txt">'+a(l(n,"i18n").call(i,"area",{name:"i18n",hash:{},data:o,loc:{start:{line:20,column:33},end:{line:20,column:48}}}))+': <span class="tc-ctl-meas-val-area"></span>, '+a(l(n,"i18n").call(i,"2dPerimeter",{name:"i18n",hash:{},data:o,loc:{start:{line:20,column:94},end:{line:20,column:116}}}))+': <span class="tc-ctl-meas-val-peri"></span></div>\r\n</div>\r\n<div class="tc-ctl-dmm-tool">\r\n    <div class="tc-ctl-dmm-mod"></div>\r\n    <div class="tc-ctl-dmm-cmd">\r\n        <button type="button" class="tc-ctl-dmm-btn-hide tc-active" disabled title="'+a(l(n,"i18n").call(i,"hideSketch",{name:"i18n",hash:{},data:o,loc:{start:{line:25,column:84},end:{line:25,column:105}}}))+'">'+a(l(n,"i18n").call(i,"hideSketch",{name:"i18n",hash:{},data:o,loc:{start:{line:25,column:107},end:{line:25,column:128}}}))+'</button>\r\n        <button type="button" class="tc-ctl-dmm-btn-dl" disabled title="'+a(l(n,"i18n").call(i,"download",{name:"i18n",hash:{},data:o,loc:{start:{line:26,column:72},end:{line:26,column:91}}}))+'">'+a(l(n,"i18n").call(i,"download",{name:"i18n",hash:{},data:o,loc:{start:{line:26,column:93},end:{line:26,column:112}}}))+'...</button>\r\n        <button type="button" class="tc-ctl-dmm-btn-clr" disabled title="'+a(l(n,"i18n").call(i,"deleteAll",{name:"i18n",hash:{},data:o,loc:{start:{line:27,column:73},end:{line:27,column:93}}}))+'">'+a(l(n,"i18n").call(i,"deleteAll",{name:"i18n",hash:{},data:o,loc:{start:{line:27,column:95},end:{line:27,column:115}}}))+"</button>\r\n    </div>\r\n</div>\r\n"},useData:!0},t.render=function(t){const e=this;return e._set1stRenderPromise(r.Z.control.Measure.prototype.render.call(e,(function(){e._clearBtn=e.div.querySelector(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-clr"),e._clearBtn.addEventListener(r.Z.Consts.event.CLICK,(function(t){r.Z.confirm(e.getLocaleString("deleteAll.confirm"),(function(){e.clear(),n.apply(e)}))}),{passive:!0}),e._downloadBtn=e.div.querySelector(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-dl"),e._downloadBtn.addEventListener(r.Z.Consts.event.CLICK,(function(t){e.showSketchDownloadDialog()}),{passive:!0}),e._elevProfileBtn=e.div.querySelector(".tc-ctl-meas-prof-btn"),e._elevProfileBtn.addEventListener(r.Z.Consts.event.CLICK,(function(t){e.elevationProfileActive?e.deactivateElevationProfile():e.activateElevationProfile()}),{passive:!0});e.div.querySelector(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-hide").addEventListener(r.Z.Consts.event.CLICK,(function(t){const n=!t.target.classList.contains(r.Z.Consts.classes.ACTIVE);e.drawControls.forEach((function(t){t.layer.setVisibility(n),t.isActive&&t.wrap.setVisibility(n)})),t.target.title=e.getLocaleString(n?"hideSketch":"showSketch"),t.target.classList.toggle(r.Z.Consts.classes.ACTIVE)}),{passive:!0}),e.options.displayElevation||(e._elevProfileBtn.style.display="none"),r.Z.Util.isFunction(t)&&t()})))},t.register=function(t){const o=this;return new Promise((function(i,a){r.Z.control.Measure.prototype.register.call(o,t).then((function(){const a=o.getUID(),s=o.getUID();Promise.all([o.layerPromise,o.renderPromise(),o.getElevationTool()]).then((function(l){const c=l[0];o.elevationProfileActive=!!l[2],c.title=o.getLocaleString("sketch"),o._modifyPromise=t.addControl("modify",{id:s,div:o.div.querySelector("."+o.CLASS+"-mod"),layer:c}),o._modifyPromise.then((function(e){o.modify=e,e.on(r.Z.Consts.event.FEATURESSELECT,(function(t){o.getElevationControl().then((function(e){e.resultsPanel&&!t.features.some((function(t){return e.resultsPanel.currentFeature===t}))&&e.resultsPanel.setCurrentFeature(null);const n=t.features[t.features.length-1];if(n){o.showMeasurements(o.getFeatureMeasureData(n));const t=n._originalStyle||n.getStyle();switch(!0){case r.Z.feature.Polygon&&n instanceof r.Z.feature.Polygon:o.displayMode(r.Z.Consts.geom.POLYGON),console.log(t.fillOpacity),o.polygonDrawControl.setStrokeColorWatch(t.strokeColor).setStrokeWidthWatch(t.strokeWidth).setFillColorWatch(t.fillColor).setFillOpacityWatch(100*t.fillOpacity);break;case r.Z.feature.Polyline&&n instanceof r.Z.feature.Polyline:o.displayMode(r.Z.Consts.geom.POLYLINE),o.lineDrawControl.setStrokeColorWatch(t.strokeColor).setStrokeWidthWatch(t.strokeWidth),o.elevationProfileActive&&e.displayElevationProfile(n);break;case r.Z.feature.Point&&n instanceof r.Z.feature.Point:o.displayMode(r.Z.Consts.geom.POINT),o.pointDrawControl.setStrokeColorWatch(t.strokeColor).setStrokeWidthWatch(t.strokeWidth).setFillColorWatch(t.fillColor).setFillOpacityWatch(100*t.fillOpacity)}o.modify.setFontColorWatch(t.fontColor).setFontSizeWatch(t.fontSize)}}))})).on(r.Z.Consts.event.FEATURESUNSELECT,(function(t){o.modify.getSelectedFeatures().length||o.resetDrawWatches(),o.getElevationControl().then((function(t){t.resetElevationProfile(),t.resultsPanel&&t.resultsPanel.close()}))})).on(r.Z.Consts.event.FEATUREMODIFY,(function(t){if(t.layer===o.layer){const e=function(t){const e=o.getFeatureMeasureData(t);o.showMeasurements(e),o.setFeatureMeasureData(t)};e(t.feature),r.Z.feature.Point&&t.feature instanceof r.Z.feature.Point&&o.getElevationTool().then((function(n){n&&n.setGeometry({features:[t.feature],crs:o.map.crs}).then((function(t){e(t[0])}),(function(t){console.warn(t.message)}))}));o.map.getControlsByClass("TC.control.Popup").forEach((function(e){e.currentFeature===t.feature&&e.isVisible()&&e.hide()}))}})),t.on(r.Z.Consts.event.CONTROLDEACTIVATE,(function(t){const e=t.control;e!==o.modify&&e!==o.lineDrawControl||(o.resetDrawWatches(),o.getElevationControl().then((function(t){t.resetElevationProfile(),t.resultsPanel&&(e===o.modify&&t.resultsPanel.setCurrentFeature(null),t.resultsPanel.close())})))})).on(r.Z.Consts.event.POPUP,(function(t){const e=t.control.currentFeature;r.Z.feature.Polyline&&e instanceof r.Z.feature.Polyline&&o.layer.features.indexOf(e)>=0&&o.elevationProfileActive&&(t.control.hide(),o.getElevationControl().then((function(t){t.resultsPanel&&(t.resultsPanel.setCurrentFeature(e),t.resultsPanel.isMinimized()&&t.resultsPanel.maximize()),t.displayElevationProfile(e)})))})).on(r.Z.Consts.event.PROJECTIONCHANGE,(function(t){o.elevationChartData&&(o.elevationChartData.coords=r.Z.Util.reproject(o.elevationChartData.coords,t.oldCrs,t.newCrs))}))})),o._lineDrawControlPromise.then((function(t){t.on(r.Z.Consts.event.DRAWSTART,(function(){o.getElevationControl().then((function(t){t.resultsPanel&&t.resultsPanel.currentFeature&&t.resultsPanel.setCurrentFeature(null),o.resetValues()}))})).on(r.Z.Consts.event.DRAWUNDO+" "+r.Z.Consts.event.DRAWREDO,(function(){const t=this;o.getElevationControl().then((function(e){o.elevationProfileActive&&(t.historyIndex?e.displayElevationProfile(t.history.slice(0,t.historyIndex)):e.closeElevationProfile())})),n.apply(o)})).on(r.Z.Consts.event.DRAWEND,(function(t){o.getElevationControl().then((function(e){e.resultsPanel&&(e.resultsPanel.currentFeature=t.feature)}))})).on(r.Z.Consts.event.POINT,(function(t){const n=this.history.slice(0,this.historyIndex),r=n[n.length-1];r[0]===t.point[0]&&r[1]===t.point[1]||n.push(t.point),o.getElevationControl().then((function(t){o.elevationProfileActive&&(navigator.onLine?t.displayElevationProfile(n):t.closeElevationProfile())})),1===t.target.historyIndex&&e.apply(o)})).on(r.Z.Consts.event.STYLECHANGE,(function(t){o.onStyleChange(t)})).on(r.Z.Consts.event.DRAWCANCEL,(function(){n.apply(o)}))})),o._polygonDrawControlPromise.then((function(t){t.on(r.Z.Consts.event.DRAWSTART,(function(){o.resetValues()})).on(r.Z.Consts.event.POINT,(function(t){1===t.target.historyIndex&&e.apply(o)})).on(r.Z.Consts.event.STYLECHANGE,(function(t){o.onStyleChange(t)})).on(r.Z.Consts.event.DRAWCANCEL+" "+r.Z.Consts.event.DRAWUNDO,(function(){n.apply(o)}))})),o._pointDrawControlPromise=t.addControl("draw",{id:a,div:o.div.querySelector("."+r.Z.control.Measure.prototype.CLASS+"-point"),mode:r.Z.Consts.geom.POINT,persistent:o.persistentDrawControls,styling:!0,layer:o.layer}),o._pointDrawControlPromise.then((function(i){i.containerControl=o,o.drawControls.push(i),o.pointDrawControl=i,o.resetValues(),i.on(r.Z.Consts.event.DRAWEND,(function(n){const r=function(e){o.showMeasurements({coords:e.geometry,units:t.wrap.isGeo()?"degrees":"m"}),o.setFeatureMeasureData(e)};r(n.feature),o.getElevationTool().then((function(t){t&&t.setGeometry({features:[n.feature],crs:o.map.crs}).then((function(t){r(t[0])}),(function(t){console.log(t.message)}))})),e.apply(o)})).on(r.Z.Consts.event.DRAWCANCEL,(function(t){setTimeout((function(){o.cancel()}),100),n.apply(o)})).on(r.Z.Consts.event.STYLECHANGE,(function(t){o.onStyleChange(t)})),i.exportsState=!1})),o._elevationControlPromise=t.addControl("elevation",o.options.displayElevation),o.setMode(o.options.mode),t.on(r.Z.Consts.event.FEATUREADD,(function(t){const e=t.layer,n=t.feature;e===o.layer&&(o.setFeatureMeasureData(n),o._modifyPromise.then((function(t){t.displayLabelText(n.getStyle().label)})),o._clearBtn.disabled=!1,o._downloadBtn.disabled=!1)})).on(r.Z.Consts.event.FEATUREREMOVE+" "+r.Z.Consts.event.FEATURESCLEAR,(function(t){t.layer===o.layer&&0===o.layer.features.length&&(o._clearBtn.disabled=!0,o._downloadBtn.disabled=!0,o.resetValues(),n.apply(o))})).on(r.Z.Consts.event.RESULTSPANELCLOSE,(function(t){o.getElevationControl().then((function(e){e===t.control&&e.setCurrentFeature(null)}))})),i(o)}))})).catch((function(t){a(t)}))}))},t.displayMode=function(t){const e=this;return t===r.Z.Consts.geom.POINT&&(e._activeMode=e.div.querySelector(".tc-ctl-meas-pt")),e.modify&&e.modify.div.classList.remove(r.Z.Consts.classes.COLLAPSED),r.Z.control.Measure.prototype.displayMode.call(e,t)},t.setMode=function(t){const e=this;t===r.Z.Consts.geom.POINT?e._pointDrawControlPromise.then((function(o){o.activate(),r.Z.control.Measure.prototype.setMode.call(e,t),n.apply(e)})):(r.Z.control.Measure.prototype.setMode.call(e,t),n.apply(e))},t.setFeatureMeasureData=function(t){const e=this,n={};switch(!0){case r.Z.feature.Point&&t instanceof r.Z.feature.Point:{const r=e._1stCoordText.innerHTML,o=e._2ndCoordText.innerHTML,i=e._elevationText.innerHTML;e._1stCoordValue.textContent.trim().length>0&&e._2ndCoordValue.textContent.trim().length>0&&(n.CRS=e.map.crs,n[r.substr(0,r.indexOf(":"))]=parseFloat(e._1stCoordValue.dataset.value),n[o.substr(0,o.indexOf(":"))]=parseFloat(e._2ndCoordValue.dataset.value),i&&(n[e.getLocaleString("ele")]=parseFloat(e._elevationValue.dataset.value)),t.setData(n));break}case r.Z.feature.Polyline&&t instanceof r.Z.feature.Polyline:e._len.innerHTML.trim()!==e.NOMEASURE&&(n[e.getLocaleString("2dLength")]=e._len.innerHTML,t.setData(n));break;case r.Z.feature.Polygon&&t instanceof r.Z.feature.Polygon:e._area.innerHTML.trim()!==e.NOMEASURE&&e._peri.innerHTML.trim()!==e.NOMEASURE&&(n[e.getLocaleString("area")]=e._area.innerHTML,n[e.getLocaleString("2dPerimeter")]=e._peri.innerHTML,t.setData(n))}return e},t.getFeatureMeasureData=function(t){const e=this,n={units:"m"},o={crs:e.map.options.utmCrs};switch(!0){case r.Z.feature.Polygon&&t instanceof r.Z.feature.Polygon:n.area=t.getArea(o),n.perimeter=t.getLength(o);break;case r.Z.feature.Polyline&&t instanceof r.Z.feature.Polyline:n.length=t.getLength(o),e.getElevationControl().then((n=>{e.elevationProfileActive&&n.displayElevationProfile(t)}));break;case r.Z.feature.Point&&t instanceof r.Z.feature.Point:n.coords=t.geometry}return n},t.showMeasurements=function(t){const e=this;r.Z.control.Measure.prototype.showMeasurements.call(e,t),t=t||{};const n=e.map.options.locale||r.Z.Cfg.locale;if(t.coords){var o,i,a;"m"===t.units?(o=r.Z.Consts.METER_PRECISION,i=t.coords[0],a=t.coords[1],e._1stCoordText.innerHTML="x: ",e._2ndCoordText.innerHTML="y: "):(o=r.Z.Consts.DEGREE_PRECISION,i=t.coords[1],a=t.coords[0],e._1stCoordText.innerHTML="lat: ",e._2ndCoordText.innerHTML="lon: ");const s=Math.pow(10,o),l=function(t){return Math.round(t*s)/s};if(e._1stCoordValue.innerHTML=r.Z.Util.formatNumber(i.toFixed(o),n),e._1stCoordValue.dataset.value=l(i),e._2ndCoordValue.innerHTML=r.Z.Util.formatNumber(a.toFixed(o),n),e._2ndCoordValue.dataset.value=l(a),t.coords.length>2){const o=Math.round(t.coords[2]);e._elevationText.innerHTML=e.getLocaleString("ele").toLowerCase()+": ",e._elevationValue.innerHTML=r.Z.Util.formatNumber(o.toFixed(r.Z.Consts.METER_PRECISION),n)+" m",e._elevationValue.dataset.value=o}else e._elevationText.innerHTML="",e._elevationValue.innerHTML="",e._elevationValue.dataset.value=""}return e},t.resetValues=function(){const t=this;return r.Z.control.Measure.prototype.resetValues.call(t),t._1stCoordText&&(t._1stCoordText.innerHTML=t.NOMEASURE,t._2ndCoordText.innerHTML="",t._1stCoordValue.innerHTML="",t._1stCoordValue.dataset.value="",t._2ndCoordValue.innerHTML="",t._2ndCoordValue.dataset.value="",t._elevationText.innerHTML="",t._elevationValue.innerHTML="",t._elevationValue.dataset.value=""),t},t.resetDrawWatches=function(){this.drawControls.forEach((function(t){t.setStrokeColorWatch().setStrokeWidthWatch()}))},t.clear=function(){const t=this;return t.resetValues(),t.layer.clearFeatures(),t.modify.isActive&&t.modify.deactivate(),t.options.displayElevation&&t.getElevationControl().then((function(t){t.resetElevationProfile(),t.resultsPanel&&t.resultsPanel.close()})),t._clearBtn.disabled=!0,t._downloadBtn.disabled=!0,t},t.showSketchDownloadDialog=function(t){const e=this;return e.getDownloadDialog().then((function(t){var n={title:e.getLocaleString("downloadSketch"),fileName:e.getLocaleString("sketch").toLowerCase().replace(" ","_")+"_"+r.Z.Util.getFormattedDate((new Date).toString(),!0)};(e.map.elevation||e.options.displayElevation)&&(n=Object.assign({},n,{elevation:Object.assign({},e.map.elevation&&e.map.elevation.options,e.options.displayElevation)})),t.open(e.layer.features,n)})),e},t.onStyleChange=function(t){const e=this;var n;switch(t.target.mode){case r.Z.Consts.geom.POLYGON:n=r.Z.feature.Polygon;break;case r.Z.Consts.geom.POLYLINE:n=r.Z.feature.Polyline;break;case r.Z.Consts.geom.POINT:n=r.Z.feature.Point}n&&e.modify.getSelectedFeatures().forEach((function(e){if(e instanceof n){const n={};n[t.property]=t.value,e.setStyle(n)}}))},t.activateElevationProfile=async function(){const t=this;t.elevationProfileActive=!0,t._elevProfileBtn.classList.add(r.Z.Consts.classes.ACTIVE),t._elevProfileBtn.setAttribute("title",t.getLocaleString("deactivateElevationProfile"));var e=!1;const n=await t.getElevationControl();if(t.lineDrawControl.historyIndex>1)n.displayElevationProfile(t.lineDrawControl.history.slice(0,t.lineDrawControl.historyIndex)),e=!0;else{const o=t.modify.getActiveFeatures().filter((function(t){return r.Z.feature.Polyline&&t instanceof r.Z.feature.Polyline}));if(o.length){const t=o[o.length-1];n.displayElevationProfile(t.geometry),e=!0}}e||n.resetElevationProfile(),n.resultsPanel&&n.resultsPanel.show()},t.deactivateElevationProfile=async function(){const t=this;t.elevationProfileActive=!1,t._elevProfileBtn.classList.remove(r.Z.Consts.classes.ACTIVE),t._elevProfileBtn.setAttribute("title",t.getLocaleString("activateElevationProfile"));const e=await t.getElevationControl();e.resetElevationProfile(),e.resultsPanel&&e.resultsPanel.close()},t.resetElevationProfile=function(){const t=this;t.options.displayElevation&&t.resultsPanelChart&&(t.elevationChartData={x:[0],ele:[0],coords:[0,0,0],upHill:0,downHill:0},t.resultsPanelChart.openChart(t.elevationChartData))},t.getElevationControl=function(){return this._elevationControlPromise};const e=function(){const t=this.div.querySelector(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-hide");t&&(t.disabled=!1)},n=function(){const t=this,e=t.div.querySelector(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-hide");if(e){const n=this.drawControls.reduce((function(t,e){return t.concat([e.getLayer()])}),[]);Promise.all(n).then((function(){e.disabled=!t.drawControls.some((t=>t.layer.features.length||t.isActive&&t.historyIndex>0)),e.classList.add(r.Z.Consts.classes.ACTIVE),e.title=t.getLocaleString("hideSketch")}))}}}();const a=r.Z.control.DrawMeasureModify},3054:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var r=n(5361),o=n(2089),i=n(9464),a=n(6498);r.Z.control=r.Z.control||{},r.Z.Consts=o.Z,r.Z.wrap=i.Z,r.Z.Control=a.Z,function(){r.Z.control.Edit=function(){const t=this;r.Z.Control.apply(this,arguments),t._classSelector="."+t.CLASS,t._selectors={MODE_RADIO_BUTTON:`input[type=radio][name="${t.id}-mode"]`},t.wrap=new r.Z.wrap.control.Edit(t),t.layer=null,t.callback=r.Z.Util.isFunction(arguments[2])?arguments[2]:t.options.callback?t.options.callback:null,t.cancelActionConfirmTxt=t.options.cancelText?t.options.eraseText:"Si continua todos los cambios se perderán. ¿Desea continuar?",t.styles=t.options.styles,t.layersEditData={},t.pointDrawControl=null,t.lineDrawControl=null,t.polygonDrawControl=null,t.modifyControl=null,t.snapping="boolean"!=typeof t.options.snapping||t.options.snapping},r.Z.inherit(r.Z.control.Edit,r.Z.Control),r.Z.control.Edit.mode={MODIFY:"modify",ADDPOINT:"addpoint",ADDLINE:"addline",ADDPOLYGON:"addpolygon",CUT:"cut",OTHER:"other"};const t=r.Z.control.Edit.prototype;t.CLASS="tc-ctl-edit",t.template={},t.template[t.CLASS]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lambda,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+a(l(n,"i18n").call(i,"featureEditing",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:4},end:{line:1,column:29}}}))+'</h2>\r\n<div class="tc-ctl-edit-tools">\r\n    <div class="tc-ctl-edit-mode">\r\n        <label class="tc-ctl-edit-btn-modify" title="'+a(l(n,"i18n").call(i,"select",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:53},end:{line:4,column:70}}}))+'"><input type="radio" name="'+a(s(null!=e?l(e,"controlId"):e,e))+'-mode" value="modify" /><span>'+a(l(n,"i18n").call(i,"select",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:141},end:{line:4,column:158}}}))+'</span>\r\n        </label><label class="tc-ctl-edit-btn-point" title="'+a(l(n,"i18n").call(i,"newPoint",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:60},end:{line:5,column:79}}}))+'"><input type="radio" name="'+a(s(null!=e?l(e,"controlId"):e,e))+'-mode" value="addpoint" /><span>'+a(l(n,"i18n").call(i,"newPoint",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:152},end:{line:5,column:171}}}))+'</span>\r\n        </label><label class="tc-ctl-edit-btn-line" title="'+a(l(n,"i18n").call(i,"newLine",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:59},end:{line:6,column:77}}}))+'"><input type="radio" name="'+a(s(null!=e?l(e,"controlId"):e,e))+'-mode" value="addline" /><span>'+a(l(n,"i18n").call(i,"newLine",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:149},end:{line:6,column:167}}}))+'</span>\r\n        </label><label class="tc-ctl-edit-btn-polygon" title="'+a(l(n,"i18n").call(i,"newPolygon",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:62},end:{line:7,column:83}}}))+'"><input type="radio" name="'+a(s(null!=e?l(e,"controlId"):e,e))+'-mode" value="addpolygon" /><span>'+a(l(n,"i18n").call(i,"newPolygon",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:158},end:{line:7,column:179}}}))+'</span>\r\n        </label><label class="tc-ctl-edit-btn-other" title="'+a(l(n,"i18n").call(i,"otherTools",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:60},end:{line:8,column:81}}}))+'"><input type="radio" name="'+a(s(null!=e?l(e,"controlId"):e,e))+'-mode" value="other" /><span>'+a(l(n,"i18n").call(i,"otherTools",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:151},end:{line:8,column:172}}}))+'</span></label>\r\n    </div>\r\n    <div class="tc-ctl-edit-modify tc-hidden"></div>\r\n    <div class="tc-ctl-edit-point tc-hidden"></div>\r\n    <div class="tc-ctl-edit-line tc-hidden"></div>\r\n    <div class="tc-ctl-edit-polygon tc-hidden"></div>\r\n    <div class="tc-ctl-edit-other tc-hidden">\r\n        <button type="button" class="tc-button tc-ctl-edit-btn-import">'+a(l(n,"i18n").call(i,"importFromOtherLayer",{name:"i18n",hash:{},data:o,loc:{start:{line:15,column:71},end:{line:15,column:102}}}))+'</button><button type="button" class="tc-button tc-ctl-edit-btn-dl">'+a(l(n,"i18n").call(i,"download",{name:"i18n",hash:{},data:o,loc:{start:{line:15,column:170},end:{line:15,column:189}}}))+"</button>\r\n    </div>\r\n</div>"},useData:!0},t.template[t.CLASS+"-attr"]={1:function(t,e,n,r,o,i,a){var s,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"            <tr>\r\n                <th>"+t.escapeExpression(t.lambda(null!=e?l(e,"name"):e,e))+"</th>\r\n                <td>\r\n"+(null!=(s=l(n,"if").call(null!=e?e:t.nullContext||{},null!=e?l(e,"readOnly"):e,{name:"if",hash:{},fn:t.program(2,o,0,i,a),inverse:t.program(4,o,0,i,a),data:o,loc:{start:{line:9,column:20},end:{line:48,column:27}}}))?s:"")+"                </td>\r\n            </tr>\r\n"},2:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"                        "+t.escapeExpression(t.lambda(null!=e?i(e,"value"):e,e))+"\r\n"},4:function(t,e,n,r,o,i,a){var s,l=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(s=c(n,"if").call(l,null!=e?c(e,"availableValues"):e,{name:"if",hash:{},fn:t.program(5,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:12,column:24},end:{line:19,column:31}}}))?s:"")+"                        "+(null!=(s=c(n,"if").call(l,c(n,"eq").call(l,null!=e?c(e,"type"):e,"int",{name:"eq",hash:{},data:o,loc:{start:{line:20,column:30},end:{line:20,column:45}}}),{name:"if",hash:{},fn:t.program(8,o,0,i,a),inverse:t.program(10,o,0,i,a),data:o,loc:{start:{line:20,column:24},end:{line:41,column:31}}}))?s:"")+"                        \r\n                        \r\n                        \r\n                        \r\n                        \r\n                        \r\n"},5:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                        <select class="tc-combo" name="'+t.escapeExpression(t.lambda(null!=e?a(e,"name"):e,e))+'">\r\n                            <option value=""></option>\r\n'+(null!=(i=a(n,"each").call(null!=e?e:t.nullContext||{},null!=e?a(e,"availableValues"):e,{name:"each",hash:{},fn:t.program(6,o,0),inverse:t.noop,data:o,loc:{start:{line:15,column:28},end:{line:17,column:37}}}))?i:"")+"                        </select>\r\n"},6:function(t,e,n,r,o){var i=t.lambda,a=t.escapeExpression;return'                            <option value="'+a(i(e,e))+'">'+a(i(e,e))+"</option>\r\n"},8:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=t.invokePartial(a(r,"inputNumber"),e,{name:"inputNumber",data:o,helpers:n,partials:r,decorators:t.decorators}))?i:"")+"\r\n                        "},10:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,null!=e?s(e,"type"):e,"integer",{name:"eq",hash:{},data:o,loc:{start:{line:21,column:34},end:{line:21,column:53}}}),{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.program(11,o,0),data:o,loc:{start:{line:21,column:24},end:{line:41,column:24}}}))?i:""},11:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,null!=e?s(e,"type"):e,"double",{name:"eq",hash:{},data:o,loc:{start:{line:22,column:34},end:{line:22,column:52}}}),{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.program(12,o,0),data:o,loc:{start:{line:22,column:24},end:{line:41,column:24}}}))?i:""},12:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,null!=e?s(e,"type"):e,"boolean",{name:"eq",hash:{},data:o,loc:{start:{line:23,column:34},end:{line:23,column:53}}}),{name:"if",hash:{},fn:t.program(13,o,0),inverse:t.program(15,o,0),data:o,loc:{start:{line:23,column:24},end:{line:41,column:24}}}))?i:""},13:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=t.invokePartial(a(r,"inputCheckbox"),e,{name:"inputCheckbox",data:o,helpers:n,partials:r,decorators:t.decorators}))?i:"")+"\r\n                        "},15:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,null!=e?s(e,"type"):e,"date",{name:"eq",hash:{},data:o,loc:{start:{line:24,column:34},end:{line:24,column:50}}}),{name:"if",hash:{},fn:t.program(16,o,0),inverse:t.program(18,o,0),data:o,loc:{start:{line:24,column:24},end:{line:41,column:24}}}))?i:""},16:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=t.invokePartial(a(r,"inputDate"),e,{name:"inputDate",data:o,helpers:n,partials:r,decorators:t.decorators}))?i:"")+"\r\n                        "},18:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,null!=e?s(e,"type"):e,"time",{name:"eq",hash:{},data:o,loc:{start:{line:25,column:34},end:{line:25,column:50}}}),{name:"if",hash:{},fn:t.program(19,o,0),inverse:t.program(21,o,0),data:o,loc:{start:{line:25,column:24},end:{line:41,column:24}}}))?i:""},19:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=t.invokePartial(a(r,"inputTime"),e,{name:"inputTime",data:o,helpers:n,partials:r,decorators:t.decorators}))?i:"")+"\r\n                        "},21:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,null!=e?s(e,"type"):e,"dateTime",{name:"eq",hash:{},data:o,loc:{start:{line:26,column:34},end:{line:26,column:54}}}),{name:"if",hash:{},fn:t.program(22,o,0),inverse:t.program(24,o,0),data:o,loc:{start:{line:26,column:24},end:{line:41,column:24}}}))?i:""},22:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=t.invokePartial(a(r,"inputDatetime"),e,{name:"inputDatetime",data:o,helpers:n,partials:r,decorators:t.decorators}))?i:"")+"\r\n                        "},24:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,null!=e?s(e,"type"):e,"byte",{name:"eq",hash:{},data:o,loc:{start:{line:27,column:34},end:{line:27,column:50}}}),{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.program(25,o,0),data:o,loc:{start:{line:27,column:24},end:{line:41,column:24}}}))?i:""},25:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,null!=e?s(e,"type"):e,"long",{name:"eq",hash:{},data:o,loc:{start:{line:28,column:34},end:{line:28,column:50}}}),{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.program(26,o,0),data:o,loc:{start:{line:28,column:24},end:{line:41,column:24}}}))?i:""},26:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,null!=e?s(e,"type"):e,"negativeInteger",{name:"eq",hash:{},data:o,loc:{start:{line:29,column:34},end:{line:29,column:61}}}),{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.program(27,o,0),data:o,loc:{start:{line:29,column:24},end:{line:41,column:24}}}))?i:""},27:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,null!=e?s(e,"type"):e,"nonNegativeInteger",{name:"eq",hash:{},data:o,loc:{start:{line:30,column:34},end:{line:30,column:64}}}),{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.program(28,o,0),data:o,loc:{start:{line:30,column:24},end:{line:41,column:24}}}))?i:""},28:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,null!=e?s(e,"type"):e,"nonPositiveInteger",{name:"eq",hash:{},data:o,loc:{start:{line:31,column:34},end:{line:31,column:64}}}),{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.program(29,o,0),data:o,loc:{start:{line:31,column:24},end:{line:41,column:24}}}))?i:""},29:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,null!=e?s(e,"type"):e,"positiveInteger",{name:"eq",hash:{},data:o,loc:{start:{line:32,column:34},end:{line:32,column:61}}}),{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.program(30,o,0),data:o,loc:{start:{line:32,column:24},end:{line:41,column:24}}}))?i:""},30:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,null!=e?s(e,"type"):e,"short",{name:"eq",hash:{},data:o,loc:{start:{line:33,column:34},end:{line:33,column:51}}}),{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.program(31,o,0),data:o,loc:{start:{line:33,column:24},end:{line:41,column:24}}}))?i:""},31:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,null!=e?s(e,"type"):e,"unsignedLong",{name:"eq",hash:{},data:o,loc:{start:{line:34,column:34},end:{line:34,column:58}}}),{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.program(32,o,0),data:o,loc:{start:{line:34,column:24},end:{line:41,column:24}}}))?i:""},32:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,null!=e?s(e,"type"):e,"unsignedInt",{name:"eq",hash:{},data:o,loc:{start:{line:35,column:34},end:{line:35,column:57}}}),{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.program(33,o,0),data:o,loc:{start:{line:35,column:24},end:{line:41,column:24}}}))?i:""},33:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,null!=e?s(e,"type"):e,"unsignedShort",{name:"eq",hash:{},data:o,loc:{start:{line:36,column:34},end:{line:36,column:59}}}),{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.program(34,o,0),data:o,loc:{start:{line:36,column:24},end:{line:41,column:24}}}))?i:""},34:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,null!=e?s(e,"type"):e,"unsignedByte",{name:"eq",hash:{},data:o,loc:{start:{line:37,column:34},end:{line:37,column:58}}}),{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.program(35,o,0),data:o,loc:{start:{line:37,column:24},end:{line:41,column:24}}}))?i:""},35:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,null!=e?s(e,"type"):e,"float",{name:"eq",hash:{},data:o,loc:{start:{line:38,column:34},end:{line:38,column:51}}}),{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.program(36,o,0),data:o,loc:{start:{line:38,column:24},end:{line:41,column:24}}}))?i:""},36:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,null!=e?s(e,"type"):e,"decimal",{name:"eq",hash:{},data:o,loc:{start:{line:39,column:34},end:{line:39,column:53}}}),{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.program(37,o,0),data:o,loc:{start:{line:39,column:24},end:{line:41,column:24}}}))?i:""},37:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=t.invokePartial(a(r,"inputText"),e,{name:"inputText",data:o,helpers:n,partials:r,decorators:t.decorators}))?i:"")+"\r\n                        "},39:function(t,e,n,r,o){var i=t.lambda,a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<input type="text" class="tc-textbox" name="'+a(i(null!=e?s(e,"name"):e,e))+'" value="'+a(i(null!=e?s(e,"value"):e,e))+'" />'},41:function(t,e,n,r,o){var i=t.lambda,a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<input type="number" class="tc-textbox" name="'+a(i(null!=e?s(e,"name"):e,e))+'" value="'+a(i(null!=e?s(e,"value"):e,e))+'" />'},43:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<input type="checkbox" name="'+t.escapeExpression(t.lambda(null!=e?a(e,"name"):e,e))+'"'+(null!=(i=a(n,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"value"):e,{name:"if",hash:{},fn:t.program(44,o,0),inverse:t.noop,data:o,loc:{start:{line:44,column:90},end:{line:44,column:118}}}))?i:"")+"/>"},44:function(t,e,n,r,o){return" checked"},46:function(t,e,n,r,o){var i=t.lambda,a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<input type="date" class="tc-textbox" name="'+a(i(null!=e?s(e,"name"):e,e))+'" value="'+a(i(null!=e?s(e,"value"):e,e))+'" />'},48:function(t,e,n,r,o){var i=t.lambda,a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<input type="time" class="tc-textbox" name="'+a(i(null!=e?s(e,"name"):e,e))+'" value="'+a(i(null!=e?s(e,"value"):e,e))+'" />'},50:function(t,e,n,r,o){var i=t.lambda,a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<input type="datetime" class="tc-textbox" name="'+a(i(null!=e?s(e,"name"):e,e))+'" value="'+a(i(null!=e?s(e,"value"):e,e))+'" />'},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o,i,a){var s,l=null!=e?e:t.nullContext||{},c=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h3>"+c(u(n,"i18n").call(l,"attributeEdit",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:4},end:{line:1,column:28}}}))+'</h3>\r\n<div class="tc-ctl-mod-attr-body">\r\n    <table>\r\n        <tbody>\r\n'+(null!=(s=t.hooks.blockHelperMissing.call(e,t.lambda(null!=e?u(e,"data"):e,e),{name:"data",hash:{},fn:t.program(1,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:5,column:12},end:{line:51,column:21}}}))?s:"")+'        </tbody>\r\n    </table>\r\n</div>\r\n<div class="tc-ctl-mod-attr-footer">\r\n    <button type="button" class="tc-button tc-ctl-mod-btn-attr-ok">'+c(u(n,"i18n").call(l,"ok",{name:"i18n",hash:{},data:o,loc:{start:{line:56,column:67},end:{line:56,column:80}}}))+'</button>\r\n    <button type="button" class="tc-button tc-ctl-mod-btn-attr-cancel">'+c(u(n,"i18n").call(l,"cancel",{name:"i18n",hash:{},data:o,loc:{start:{line:57,column:71},end:{line:57,column:88}}}))+"</button>\r\n</div>\r\n"},"4_d":function(t,e,n,r,o,i,a){var s=n.decorators,l=n.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t=l(s,"inline")(t,e,n,{name:"inline",hash:{},fn:n.program(39,o,0,i,a),inverse:n.noop,args:["inputText"],data:o,loc:{start:{line:42,column:24},end:{line:42,column:133}}})||t,t=l(s,"inline")(t,e,n,{name:"inline",hash:{},fn:n.program(41,o,0,i,a),inverse:n.noop,args:["inputNumber"],data:o,loc:{start:{line:43,column:24},end:{line:43,column:137}}})||t,t=l(s,"inline")(t,e,n,{name:"inline",hash:{},fn:n.program(43,o,0,i,a),inverse:n.noop,args:["inputCheckbox"],data:o,loc:{start:{line:44,column:24},end:{line:44,column:131}}})||t,t=l(s,"inline")(t,e,n,{name:"inline",hash:{},fn:n.program(46,o,0,i,a),inverse:n.noop,args:["inputDate"],data:o,loc:{start:{line:45,column:24},end:{line:45,column:133}}})||t,t=l(s,"inline")(t,e,n,{name:"inline",hash:{},fn:n.program(48,o,0,i,a),inverse:n.noop,args:["inputTime"],data:o,loc:{start:{line:46,column:24},end:{line:46,column:133}}})||t,t=l(s,"inline")(t,e,n,{name:"inline",hash:{},fn:n.program(50,o,0,i,a),inverse:n.noop,args:["inputDatetime"],data:o,loc:{start:{line:47,column:24},end:{line:47,column:141}}})||t},useDecorators:!0,usePartial:!0,useData:!0,useDepths:!0},t.template[t.CLASS+"-import"]={1:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"\r\n"+(null!=(i=t.invokePartial(a(r,"tc-ctl-edit-import-layer"),e,{name:"tc-ctl-edit-import-layer",data:o,indent:"                ",helpers:n,partials:r,decorators:t.decorators}))?i:"")+"            "},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-edit-import">\r\n    <div class="tc-ctl-edit-import-list">\r\n        <ul class="tc-layers">'+(null!=(i=l(n,"each").call(a,null!=e?l(e,"layers"):e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:30},end:{line:5,column:21}}}))?i:"")+'</ul>\r\n        <p class="tc-ctl-edit-import-empty-note">'+s(l(n,"i18n").call(a,"thereAreNoCompatibleFeatures",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:49},end:{line:6,column:88}}}))+'</p>\r\n    </div>\r\n    <div class="tc-ctl-edit-import-foot">\r\n        <button type="button" class="tc-button tc-ctl-edit-import-btn-ok">'+s(l(n,"i18n").call(a,"ok",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:74},end:{line:9,column:87}}}))+"</button>\r\n    </div>\r\n</div>\r\n"},usePartial:!0,useData:!0},t.template[t.CLASS+"-import-layer"]={1:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-edit-import-feature"),e,{name:"tc-ctl-edit-import-feature",data:o,indent:"            ",helpers:n,partials:r,decorators:t.decorators}))?i:""},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=t.lambda,s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li class="tc-layer" data-layer-id="'+s(a(null!=e?l(e,"id"):e,e))+'">\r\n    <h3>'+s(a(null!=e?l(e,"title"):e,e))+'</h3>\r\n    <ul class="tc-features">\r\n'+(null!=(i=l(n,"each").call(null!=e?e:t.nullContext||{},null!=e?l(e,"features"):e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:4,column:8},end:{line:6,column:17}}}))?i:"")+"    </ul>\r\n</li>"},usePartial:!0,useData:!0},t.template[t.CLASS+"-import-feature"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=t.lambda,s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li class="tc-feature"><input type="checkbox" id="tc-ctl-edit-import-list-cb-'+s(a(null!=(i=null!=e?l(e,"layer"):e)?l(i,"id"):i,e))+"-"+s(a(null!=e?l(e,"id"):e,e))+'" value="'+s(a(null!=e?l(e,"id"):e,e))+'"> <label for="tc-ctl-edit-import-list-cb-'+s(a(null!=(i=null!=e?l(e,"layer"):e)?l(i,"id"):i,e))+"-"+s(a(null!=e?l(e,"id"):e,e))+'">'+s(a(null!=e?l(e,"id"):e,e))+"</label></li>\r\n"},useData:!0},t.register=function(t){const e=this;return new Promise((function(n,o){r.Z.Control.prototype.register.call(e,t).then((function(){const o="draw";e._pointDrawCtlPromise=t.addControl(o,{id:e.getUID(),div:e.div.querySelector(`.${e.CLASS}-point`),mode:r.Z.Consts.geom.POINT,styling:e.options.styling,layer:!1}),e._lineDrawCtlPromise=t.addControl(o,{id:e.getUID(),div:e.div.querySelector(`.${e.CLASS}-line`),mode:r.Z.Consts.geom.POLYLINE,styling:e.options.styling,layer:!1}),e._polygonDrawCtlPromise=t.addControl(o,{id:e.getUID(),div:e.div.querySelector(`.${e.CLASS}-polygon`),mode:r.Z.Consts.geom.POLYGON,styling:e.options.styling,layer:!1}),e._modifyCtlPromise=t.addControl("modify",{id:e.getUID(),div:e.div.querySelector(`.${e.CLASS}-modify`),snapping:e.snapping}),Promise.all([e._pointDrawCtlPromise,e._lineDrawCtlPromise,e._polygonDrawCtlPromise,e._modifyCtlPromise]).then((function(o){e.pointDrawControl=o[0],e.lineDrawControl=o[1],e.polygonDrawControl=o[2],e.modifyControl=o[3];const i=function(t){e.trigger(r.Z.Consts.event.DRAWEND,{feature:t.feature})},a=function(){e.cancel()};e.pointDrawControl.on(r.Z.Consts.event.DRAWEND,i).on(r.Z.Consts.event.DRAWCANCEL,a),e.lineDrawControl.on(r.Z.Consts.event.DRAWEND,i).on(r.Z.Consts.event.DRAWCANCEL,a),e.polygonDrawControl.on(r.Z.Consts.event.DRAWEND,i).on(r.Z.Consts.event.DRAWCANCEL,a),e.modifyControl.on(r.Z.Consts.event.FEATUREMODIFY,(function(t){e.trigger(r.Z.Consts.event.FEATUREMODIFY,{feature:t.feature,layer:t.layer})})).on(r.Z.Consts.event.FEATUREADD,(function(t){e.trigger(r.Z.Consts.event.FEATUREADD,{feature:t.feature,layer:t.layer})})).on(r.Z.Consts.event.FEATUREREMOVE,(function(t){e.trigger(r.Z.Consts.event.FEATUREREMOVE,{feature:t.feature,layer:t.layer})})),e.modifyControl.displayAttributes=function(){const t=e.getSelectedFeatures(),n=t[t.length-1];if(n){const t=n.getData()||{};e.modifyControl._editAttrBtn.classList.add(r.Z.Consts.classes.ACTIVE);let i=e.getLayerEditData(n.layer).attributes;if(!Object.keys(i).lengh){if(e.getSelectedFeatures()[0]&&Object.keys(t).length)for(var o in i={},t)i[o]={name:o,value:t[o]}}const a=Object.keys(i).map((t=>i[t])),s=e._joinedFeatureAttributes||[];a.forEach((function(e){e.value=t[e.name],"id"===e.name&&(e.readOnly=!0),e.availableValues=[],s.forEach((function(t){const n=t[e.name];void 0!==n&&""!==n&&e.availableValues.push(n)}))})),a.sort((function(t,e){return(t.readOnly?!e.readOnly:e.readOnly)?!t.readOnly-!e.readOnly:t.name>e.name?1:t.name<e.name?-1:0})),e.getRenderedHtml(e.CLASS+"-attr",{data:a},(function(t){e.modifyControl._attributesSection;const n=e.getAttributeDisplayTarget();n.classList.remove(r.Z.Consts.classes.HIDDEN),n.innerHTML=t;const o=n.querySelectorAll("input"),i=n.querySelectorAll("select");o.forEach((function(t){t.addEventListener("input",(function(t){const e=t.target;for(var n=0,r=i.length;n<r;n++){const r=i[n];if(r.matches(`[name=${t.target.getAttribute("name")}]`)&&r.value!==e.value){r.value="";break}}}))})),i.forEach((function(t){t.addEventListener("change",(function(t){const e=t.target;for(var n=0,r=o.length;n<r;n++){const r=o[n];if(r.matches(`[name=${t.target.getAttribute("name")}]`)){r.value=e.value;break}}}))})),n.querySelector(`.${e.modifyControl.CLASS}-btn-attr-ok`).addEventListener(r.Z.Consts.event.CLICK,(function(t){e.modifyControl._onAttrOK()}),{passive:!0}),n.querySelector(`.${e.modifyControl.CLASS}-btn-attr-cancel`).addEventListener(r.Z.Consts.event.CLICK,(function(t){e.modifyControl.closeAttributes()}),{passive:!0})}))}},e.modifyControl._onAttrOK=function(){const t=this,n=t.getSelectedFeatures()[0];if(n){const o={},i=e.getLayerEditData(n.layer).attributes,a=Object.keys(i).length>0;t.getAttributeDisplayTarget().querySelectorAll("input").forEach((function(t){var e=t.getAttribute("name"),n=t.value;if(a)switch(i[e].type){case"int":case"integer":case"byte":case"long":case"negativeInteger":case"nonNegativeInteger":case"nonPositiveInteger":case"positiveInteger":case"short":case"unsignedLong":case"unsignedInt":case"unsignedShort":case"unsignedByte":n=parseInt(n),Number.isNaN(n)||(o[e]=n);break;case"double":case"float":case"decimal":n=parseFloat(n),Number.isNaN(n)||(o[e]=n);break;case"date":case"time":case"dateTime":o[e]=new Date(n);break;case"boolean":o[e]=!!n;break;case void 0:break;default:o[e]=n}else o[e]=n})),n.setData(o),t.trigger(r.Z.Consts.event.FEATUREMODIFY,{feature:n,layer:t.layer}),t.closeAttributes()}},Array.isArray(e.options.modes)&&1==e.options.modes.length&&e.setMode(e.options.modes[0],null),n(e),t.loaded((function(){e.setLayer(e.options.layer)})),t.on(r.Z.Consts.event.RESULTSPANELCLOSE,(function(t){t.control===e.featureImportPanel&&(e.featuresToImport=[],e.getHighlightsLayer().then((t=>t.clearFeatures())))})).on(r.Z.Consts.event.LAYERREMOVE+" "+r.Z.Consts.event.FEATURESCLEAR,(function(t){e.featureImportPanel&&!e.featureImportPanel.div.classList.contains(r.Z.Consts.classes.HIDDEN)&&e.getHighlightsLayer().then((function(n){for(let r=e.featuresToImport.length-1;r>=0;r--){const o=e.featuresToImport[r];(o.layer===t.layer||o.original&&o.original.layer===t.layer)&&(e.featuresToImport.splice(r,1),n.removeFeature(o))}const r=e.featureImportPanel.getInfoContainer().querySelector(`li[data-layer-id="${t.layer.id}"]`);r&&r.remove()}))})).on(r.Z.Consts.event.FEATUREREMOVE,(function(t){e.featureImportPanel&&!e.featureImportPanel.div.classList.contains(r.Z.Consts.classes.HIDDEN)&&e.getHighlightsLayer().then((function(n){for(var r=0,o=e.featuresToImport.length;r<o;r++){const o=e.featuresToImport[r];if(o===t.feature||o.original===t.feature){e.featuresToImport.splice(r,1),n.removeFeature(o);const i=e.featureImportPanel.getInfoContainer().querySelector(`li[data-layer-id="${t.layer.id}"]`);if(i){const e=i.querySelector(`#tc-ctl-edit-import-list-cb-${t.layer.id}-${t.feature.id}`);e&&e.remove(),i.children.length||i.remove()}break}}}))})).on(r.Z.Consts.event.LAYERUPDATE,(function(t){if(e.featureImportPanel&&!e.featureImportPanel.div.classList.contains(r.Z.Consts.classes.HIDDEN)){const n=e.getAvailableFeaturesToImport().filter((e=>e.id===t.layer.id))[0];n&&e.getRenderedHtml(e.CLASS+"-import-layer",n,(function(n){const r=e.featureImportPanel.getInfoContainer().querySelector(`.${e.CLASS}-import-list .tc-layers`);r.querySelector(`li[data-layer-id="${t.layer.id}"]`)||r.insertAdjacentHTML("beforeend",n)}))}})).on(r.Z.Consts.event.FEATUREADD+" "+r.Z.Consts.event.FEATURESADD,(function(t){if(e.featureImportPanel&&!e.featureImportPanel.div.classList.contains(r.Z.Consts.classes.HIDDEN)){const n=t.layer,r=(t.feature?[t.feature]:t.features).filter((t=>e.isFeatureAllowed(t)));r.length&&e.displayLayerToImport({id:n.id,title:n.title,features:r})}}))}))}))}))},t.render=function(t){const e=this;return e._set1stRenderPromise(r.Z.Control.prototype.renderData.call(e,{controlId:e.id},(function(){if(Array.isArray(e.options.modes)&&e.options.modes.length>0){for(var n in r.Z.control.Edit.mode)if("string"==typeof n&&e.options.modes.indexOf(r.Z.control.Edit.mode[n])<0){const t=e.div.querySelector(`label${e._classSelector}-btn-${r.Z.control.Edit.mode[n]}`);t.parentElement.removeChild(t);const o=e.div.querySelector(`div${e._classSelector}-${r.Z.control.Edit.mode[n]}`);o.parentElement.removeChild(o)}if(1===e.options.modes.length){var o=e.options.modes[0];const t=e.div.querySelector(`label${e._classSelector}-btn-${o}`);t.parentElement.removeChild(t)}}e.div.querySelectorAll(e._selectors.MODE_RADIO_BUTTON).forEach((function(t){t.addEventListener("change",(function(){var t=this.value,n=e.mode===t?void 0:t;e.setMode(n)}))})),e.div.querySelector(e._classSelector+"-btn-import").addEventListener(r.Z.Consts.event.CLICK,(function(t){e.showFeatureImportPanel()}),{passive:!0}),e.div.querySelector(e._classSelector+"-btn-dl").addEventListener(r.Z.Consts.event.CLICK,(function(t){e.getDownloadDialog().then((function(t){const n={title:e.getLocaleString("download"),fileName:e.layer.id.toLowerCase().replace(" ","_")+"_"+r.Z.Util.getFormattedDate((new Date).toString(),!0),elevation:e.options.downloadElevation};t.open(e.layer.features,n)}))}),{passive:!0}),r.Z.Util.isFunction(t)&&t()})))},t.getGeometryType=function(t){switch(t){case"gml:LinearRingPropertyType":case"gml:PolygonPropertyType":case"LinearRingPropertyType":case"PolygonPropertyType":return r.Z.Consts.geom.POLYGON;case"gml:MultiPolygonPropertyType":case"gml:MultiSurfacePropertyType":case"MultiPolygonPropertyType":case"MultiSurfacePropertyType":return r.Z.Consts.geom.MULTIPOLYGON;case"gml:LineStringPropertyType":case"gml:CurvePropertyType":case"LineStringPropertyType":case"CurvePropertyType":return r.Z.Consts.geom.POLYLINE;case"gml:MultiLineStringPropertyType":case"gml:MultiCurvePropertyType":case"MultiLineStringPropertyType":case"MultiCurvePropertyType":return r.Z.Consts.geom.MULTIPOLYLINE;case"gml:PointPropertyType":case"gml:MultiPointPropertyType":case"PointPropertyType":case"MultiPointPropertyType":return r.Z.Consts.geom.POINT;case"gml:BoxPropertyType":case"BoxPropertyType":return r.Z.Consts.geom.RECTANGLE;case"gml:GeometryCollectionPropertyType":case"gml:GeometryAssociationType":case"gml:GeometryPropertyType":case"GeometryCollectionPropertyType":case"GeometryAssociationType":case"GeometryPropertyType":return!0;default:return!1}},t.setLayer=function(t){const e=this;e.modifyControl&&e.modifyControl.unselectFeatures(e.getSelectedFeatures()),e.layer=e.map.getLayer(t),e.layer&&t.describeFeatureType().then((function(n){const r={attributes:{}};let o;for(o in n){const t=n[o],i=e.getGeometryType(t.type);i?(r.geometryName=t.name,r.geometryType="boolean"==typeof i?null:i):r.attributes[o]=t}for(o in r.attributes){const t=r.attributes[o];t.type=t.type.substr(t.type.indexOf(":")+1)}e.layersEditData[t.id]=r})).catch((function(n){e.layersEditData[t.id]={geometryType:null,attributes:{}}}));const n=t=>t.setLayer(e.layer);var o,i;e.getModifyControl().then(n),e.getPointDrawControl().then(n),e.getLineDrawControl().then(n),e.getPolygonDrawControl().then(n),e.setMode(e.layer?r.Z.control.Edit.mode.MODIFY:null),o=e,i=e.layer,o.div.querySelectorAll(o._selectors.MODE_RADIO_BUTTON).forEach((t=>t.disabled=!i))},t.setMode=function(t){var e=this;e.mode=t;var n,o,i=function(t){t&&(e.snapping&&(t.snapping=e.layer),t.activate())};Promise.all([e._pointDrawCtlPromise,e._lineDrawCtlPromise,e._polygonDrawCtlPromise,e._modifyCtlPromise]).then((function(a){const s=a[0],l=a[1],c=a[2],u=a[3];switch(t){case r.Z.control.Edit.mode.MODIFY:n=e.div.querySelector(e._classSelector+"-modify"),o=e.div.querySelectorAll(e._classSelector+"-point,"+e._classSelector+"-line,"+e._classSelector+"-polygon,"+e._classSelector+"-other"),u.activate();break;case r.Z.control.Edit.mode.ADDPOINT:n=e.div.querySelector(e._classSelector+"-point"),o=e.div.querySelectorAll(e._classSelector+"-modify,"+e._classSelector+"-line,"+e._classSelector+"-polygon,"+e._classSelector+"-other"),i(s);break;case r.Z.control.Edit.mode.ADDLINE:n=e.div.querySelector(e._classSelector+"-line"),o=e.div.querySelectorAll(e._classSelector+"-modify,"+e._classSelector+"-point,"+e._classSelector+"-polygon,"+e._classSelector+"-other"),i(l);break;case r.Z.control.Edit.mode.ADDPOLYGON:n=e.div.querySelector(e._classSelector+"-polygon"),o=e.div.querySelectorAll(e._classSelector+"-modify,"+e._classSelector+"-point,"+e._classSelector+"-line,"+e._classSelector+"-other"),i(c);break;case r.Z.control.Edit.mode.OTHER:n=e.div.querySelector(e._classSelector+"-other"),o=e.div.querySelectorAll(e._classSelector+"-modify,"+e._classSelector+"-point,"+e._classSelector+"-line,"+e._classSelector+"-polygon"),a.indexOf(e.map.activeControl)>=0&&e.map.activeControl.deactivate();break;default:n=null,o=e.div.querySelectorAll(e._classSelector+"-modify,"+e._classSelector+"-point,"+e._classSelector+"-line,"+e._classSelector+"-polygon,"+e._classSelector+"-other"),a.indexOf(e.map.activeControl)>=0&&e.map.activeControl.deactivate()}if(t){e.div.querySelector(`${e._selectors.MODE_RADIO_BUTTON}[value=${t}]`).checked=!0}else e.div.querySelectorAll(e._selectors.MODE_RADIO_BUTTON).forEach((function(t){t.checked=!1}));n&&n.classList.remove(r.Z.Consts.classes.HIDDEN),o.forEach((function(t){t.classList.add(r.Z.Consts.classes.HIDDEN)}))}))},t.constrainModes=function(t){const e=this;Array.isArray(t)||(t=[]),e.modes=t.filter((function(t){for(var e in r.Z.control.Edit.mode)if(r.Z.control.Edit.mode[e]===t)return!0;return!1})).filter((function(t){return!Array.isArray(e.options.modes)||e.options.modes.indexOf(t)>=0})),e.modes.indexOf(e.mode)<0&&e.setMode(null);const n=e.modes.map((t=>`[value=${t}]`)).join()||"[value]";e.div.querySelectorAll(e._selectors.MODE_RADIO_BUTTON).forEach((function(t){t.disabled=!t.matches(n)}))},t.isFeatureAllowed=function(t){const e=this;switch(!0){case r.Z.feature.Point&&t instanceof r.Z.feature.Point:return e.modes.indexOf(r.Z.control.Edit.mode.ADDPOINT)>=0;case r.Z.feature.Polyline&&t instanceof r.Z.feature.Polyline:return e.modes.indexOf(r.Z.control.Edit.mode.ADDLINE)>=0;case r.Z.feature.MultiPolyline&&t instanceof r.Z.feature.MultiPolyline:return e.modes.indexOf(r.Z.control.Edit.mode.ADDLINE)>=0&&e.isMultiple;case r.Z.feature.Polygon&&t instanceof r.Z.feature.Polygon:return e.modes.indexOf(r.Z.control.Edit.mode.ADDPOLYGON)>=0;case r.Z.feature.MultiPolygon&&t instanceof r.Z.feature.MultiPolygon:return e.modes.indexOf(r.Z.control.Edit.mode.ADDPOLYGON)>=0&&e.isMultiple;default:return!0}},t.setComplexGeometry=function(t){const e=this;e.isMultiple=t,e.getLineDrawControl().then((e=>e.setMode(t?r.Z.Consts.geom.MULTIPOLYLINE:r.Z.Consts.geom.POLYLINE))),e.getPolygonDrawControl().then((e=>e.setMode(t?r.Z.Consts.geom.MULTIPOLYGON:r.Z.Consts.geom.POLYGON)))},t.getLayerEditData=function(t){const e=this,n=t||e.layer;return n?e.layersEditData[n.id]=e.layersEditData[n.id]||{checkedOut:!1}:null},t.cancel=function(){var t=this;Array.isArray(t.options.modes)&&1==t.options.modes.length?t.setMode(t.options.modes[0],null):t.setMode(null,!1),t.wrap.cancel(!0,t.cancelActionConfirmTxt)},t.onFeatureClick=function(t){this.activeControl&&this.activeControl.isExclusive()||t.feature.show()},t.activate=function(t){const e=this,n=function(t){t!==e.map.activeControl&&(e._previousActiveControl=e.map.activeControl)};switch((t=t||{}).mode){case r.Z.control.Edit.mode.ADDPOINT:e.getPointDrawControl().then(n);break;case r.Z.control.Edit.mode.ADDLINE:e.getLineDrawControl().then(n);break;case r.Z.control.Edit.mode.ADDPOLYGON:e.getPolygonDrawControl().then(n);break;default:e.getModifyControl().then(n)}},t.deactivate=function(){const t=this;if(t._previousActiveControl)switch(t.map.previousActiveControl=t._previousActiveControl,t.map.activeControl){case t.pointDrawControl:t.pointDrawControl.deactivate();break;case t.lineDrawControl:t.lineDrawControl.deactivate();break;case t.polygonDrawControl:t.polygonDrawControl.deactivate();break;case t.modifyControl:t.modifyControl.deactivate()}t.modifyControl&&t.modifyControl.closeAttributes()},t.isExclusive=function(){return!0},t.getAttributeDisplayTarget=function(){return this.modifyControl._attributesSection},t.getSelectedFeatures=function(){return this.modifyControl.getSelectedFeatures()},t.setSelectedFeatures=function(t){return this.modifyControl.setSelectedFeatures(t)},t.getLayer=function(){return this.layer},t.getModifyControl=function(){const t=this;return t._modifyCtlPromise||new Promise((function(e,n){t.renderPromise().then((()=>e(t.modifyControl)))}))},t.getPointDrawControl=function(){const t=this;return t._pointDrawCtlPromise||new Promise((function(e,n){t.renderPromise().then((()=>e(t.pointDrawControl)))}))},t.getLineDrawControl=function(){const t=this;return t._lineDrawCtlPromise||new Promise((function(e,n){t.renderPromise().then((()=>e(t.lineDrawControl)))}))},t.getPolygonDrawControl=function(){const t=this;return t._polygonDrawCtlPromise||new Promise((function(e,n){t.renderPromise().then((()=>e(t.polygonDrawControl)))}))},t.getFeatureImportPanel=function(){const t=this;return t._featureImportPanelPromise||(t._featureImportPanelPromise=t.map.addControl("resultsPanel",{titles:{main:t.getLocaleString("importFromOtherLayer")}}),t._featureImportPanelPromise.then((e=>t.featureImportPanel=e))),t._featureImportPanelPromise},t.getHighlightsLayer=function(){const t=this;return t._highlightsLayerPromise||(t._highlightsLayerPromise=t.map.addLayer({id:t.getUID(),type:r.Z.Consts.layerType.VECTOR,title:"Highlights Layer",stealth:!0,styles:t.map.options.styles.selection||r.Z.Cfg.styles.selection}),t._highlightsLayerPromise.then((e=>t.highlightsLayer=e))),t._highlightsLayerPromise},t.highlightFeatures=function(t){const e=this;e.getHighlightsLayer().then((function(n){const r=e.featuresToImport.concat(t);n.features.slice().forEach((function(t){(!t.original||r.indexOf(t.original)<0)&&n.removeFeature(t)})),n.addFeatures(r.filter((function(t){return!n.features.some((function(e){return e.original&&e.original===t}))})).map((function(t){const e=t.clone();return e.toggleSelectedStyle(!0),e.original=t,e})))}))},t.getAvailableFeaturesToImport=function(){const t=this;return t.map.workLayers.filter((t=>!t.isRaster())).filter((e=>e!==t.layer)).filter((e=>e!==t.highlightsLayer)).map((function(e){return{id:e.id,title:e.title,features:e.features.filter((function(e){return t.isFeatureAllowed(e)}))}})).filter((t=>t.features.length))},t.getFeatureFromImportList=function(t){const e=t.querySelector("input"),n=this.map.getLayer(t.parentElement.parentElement.dataset.layerId);return n?n.getFeatureById(e.value):null},t.importFeatures=function(t){const e=this;let n=!1;const o=e.getLayerEditData();(t||e.featuresToImport||[]).filter((t=>{const r=e.isFeatureAllowed(t);return r||(n=!0),r})).map((function(t){let n;const i={data:t.data,geometryName:o.geometryName};if(e.isMultiple)switch(!0){case r.Z.feature.Polygon&&t instanceof r.Z.feature.Polygon:n=new r.Z.feature.MultiPolygon([t.geometry],i);break;case r.Z.feature.Polyline&&t instanceof r.Z.feature.Polyline:n=new r.Z.feature.MultiPolyline([t.geometry],i);break;default:n=t.clone()}else switch(!0){case r.Z.feature.MultiPolygon&&t instanceof r.Z.feature.MultiPolygon:n=new r.Z.feature.Polygon(t.geometry[0],i);break;case r.Z.feature.MultiPolyline&&t instanceof r.Z.feature.MultiPolyline:n=new r.Z.feature.Polyline(t.geometry[0],i);break;default:n=t.clone()}return n.setStyle(null),n})).forEach((function(t){e.layer.addFeature(t),e.trigger(r.Z.Consts.event.FEATUREADD,{feature:t,layer:e.layer})})),n&&e.map.toast(e.getLocaleString("importFromOtherLayer.warning"),{type:r.Z.Consts.msgType.WARNING})};const e=function(t,e){const n=t.getFeatureFromImportList(e.parentElement);if(e.checked)t.featuresToImport.push(n);else{const e=t.featuresToImport.indexOf(n);e>=0&&t.featuresToImport.splice(e,1)}};t._addImportLayerEvents=function(t){const n=this;t.querySelector("input").addEventListener("change",(function(t){const r=this;r.parentElement.querySelectorAll("li.tc-feature input").forEach((function(t){t.checked!==r.checked&&(t.checked=r.checked,e(n,t))})),n.highlightFeatures([])})),t.querySelectorAll("li.tc-feature").forEach((function(t){n._addImportFeatureEvents(t)}))},t._addImportFeatureEvents=function(t){const n=this,o=function(t){const e=n.getFeatureFromImportList(this);e&&n.highlightFeatures([e])};t.addEventListener(r.Z.Consts.event.CLICK,o,{passive:!0}),t.addEventListener("mouseover",o),t.querySelector("input").addEventListener("change",(function(t){e(n,this)}))},t.showFeatureImportPanel=function(){const t=this;t.featuresToImport=[],t.getFeatureImportPanel().then((function(e){const n=e.getInfoContainer();t.getRenderedHtml(t.CLASS+"-import",{layers:t.getAvailableFeaturesToImport()},(function(o){e.open(o,n),n.querySelector("ul").addEventListener("mouseout",(function(e){t.highlightFeatures([])})),n.querySelectorAll("li.tc-layer").forEach((function(e){t._addImportLayerEvents(e)})),n.querySelector(`.${t.CLASS}-import-btn-ok`).addEventListener(r.Z.Consts.event.CLICK,(function(e){t.importFeatures(),t.featureImportPanel.close()}),{passive:!0})}))}))},t.displayLayerToImport=function(t){const e=this;return new Promise((function(n,o){if(e.featureImportPanel&&!e.featureImportPanel.div.classList.contains(r.Z.Consts.classes.HIDDEN)){const r=e.featureImportPanel.getInfoContainer().querySelector(`.${e.CLASS}-import-list .tc-layers`),o=`li[data-layer-id="${t.id}"]`,i=r.querySelector(o);i?(t.features.forEach((function(n){e.isFeatureAllowed(n)&&e.getRenderedHtml(e.CLASS+"-import-feature",t,(function(t){i.insertAdjacentHTML("beforeend",t),e._addImportFeatureEvents(i.querySelector("li:last-child"))}))})),n(i)):e.getRenderedHtml(e.CLASS+"-import-layer",{id:t.id,title:t.title,features:t.features},(function(t){r.insertAdjacentHTML("beforeend",t);const i=r.querySelector(o);e._addImportLayerEvents(i),n(i)}))}else n(null)}))}}();const s=r.Z.control.Edit},2890:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>a});var r=n(5361),o=n(2089),i=n(6498);r.Z.control=r.Z.control||{},r.Z.Consts=o.Z,r.Z.Control=i.Z,r.Z.control.Elevation=function(){const t=this;r.Z.Control.apply(t,arguments),t.displayElevation=!0,t.resultsPanel=null},r.Z.inherit(r.Z.control.Elevation,r.Z.Control),function(){const t=r.Z.control.Elevation.prototype;t.CLASS="tc-ctl-elev",t.template={},t.template[t.CLASS]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-ftools">\r\n    <button type="button" class="tc-icon-btn tc-ctl-ftools-dl-btn" title="'+a(s(n,"i18n").call(i,"downloadFeature",{name:"i18n",hash:{},data:o,loc:{start:{line:2,column:74},end:{line:2,column:100}}}))+'">'+a(s(n,"i18n").call(i,"download",{name:"i18n",hash:{},data:o,loc:{start:{line:2,column:102},end:{line:2,column:121}}}))+'</button>\r\n    <button type="button" class="tc-icon-btn tc-ctl-ftools-share-btn" title="'+a(s(n,"i18n").call(i,"shareFeature",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:77},end:{line:3,column:100}}}))+'">'+a(s(n,"i18n").call(i,"share",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:102},end:{line:3,column:118}}}))+'</button>\r\n    <button type="button" class="tc-icon-btn tc-ctl-ftools-zoom-btn" title="'+a(s(n,"i18n").call(i,"zoomToFeature",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:76},end:{line:4,column:100}}}))+'">'+a(s(n,"i18n").call(i,"zoomToFeature",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:102},end:{line:4,column:126}}}))+'</button>\r\n    <button type="button" class="tc-icon-btn tc-ctl-ftools-elev-btn tc-hidden" title="'+a(s(n,"i18n").call(i,"viewElevation",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:86},end:{line:5,column:110}}}))+'">'+a(s(n,"i18n").call(i,"viewElevation",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:112},end:{line:5,column:136}}}))+'</button>\r\n    <button type="button" class="tc-icon-btn tc-ctl-ftools-prof-btn tc-hidden" title="'+a(s(n,"i18n").call(i,"viewElevationProfile",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:86},end:{line:6,column:117}}}))+'">'+a(s(n,"i18n").call(i,"viewElevationProfile",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:119},end:{line:6,column:150}}}))+'</button>\r\n    <button type="button" class="tc-icon-btn tc-ctl-ftools-del-btn" title="'+a(s(n,"i18n").call(i,"deleteFeature",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:75},end:{line:7,column:99}}}))+'">'+a(s(n,"i18n").call(i,"deleteFeature",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:101},end:{line:7,column:125}}}))+"</button>\r\n</div>"},useData:!0},t.template[t.CLASS+"-val"]={1:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<tr class="tc-ctl-elev-pair-elev-orig">\r\n    <th><span>'+a(s(n,"i18n").call(i,"ele",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:14},end:{line:3,column:28}}}))+" ("+a(s(n,"i18n").call(i,"original",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:30},end:{line:3,column:49}}}))+")</span></th>\r\n    <td>"+a(t.lambda(null!=e?s(e,"originalValue"):e,e))+" m</td>\r\n</tr>\r\n"},3:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<tr class="tc-ctl-elev-pair-elev">\r\n    <th><span>'+(null!=(i=a(n,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"originalValue"):e,{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.program(6,o,0),data:o,loc:{start:{line:9,column:14},end:{line:9,column:101}}}))?i:"")+"</span></th>\r\n    <td>"+t.escapeExpression(t.lambda(null!=e?a(e,"elevationValue"):e,e))+" m</td>\r\n</tr>\r\n"},4:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return a(s(n,"i18n").call(i,"ele",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:35},end:{line:9,column:49}}}))+" ("+a(s(n,"i18n").call(i,"mdt",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:51},end:{line:9,column:65}}}))+")"},6:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"elevation",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:74},end:{line:9,column:94}}}))},8:function(t,e,n,r,o){var i=t.escapeExpression,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<tr class="tc-ctl-elev-pair-height">\r\n    <th><span>'+i(a(n,"i18n").call(null!=e?e:t.nullContext||{},"heightOverTerrain",{name:"i18n",hash:{},data:o,loc:{start:{line:15,column:14},end:{line:15,column:42}}}))+"</span></th>\r\n    <td>"+i(t.lambda(null!=e?a(e,"heightValue"):e,e))+" m</td>\r\n</tr>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=s(n,"if").call(a,null!=e?s(e,"originalValue"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:0},end:{line:6,column:7}}}))?i:"")+(null!=(i=s(n,"if").call(a,null!=e?s(e,"elevationValue"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:7,column:0},end:{line:12,column:7}}}))?i:"")+(null!=(i=s(n,"if").call(a,null!=e?s(e,"heightValue"):e,{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.noop,data:o,loc:{start:{line:13,column:0},end:{line:18,column:7}}}))?i:"")},useData:!0};const e=new WeakMap,n=new Map,o=function(t){if(t){const e=t.getCoords();e&&n.delete(e.toString())}};t.register=function(t){const n=this;return new Promise((function(i,a){r.Z.Control.prototype.register.call(n,t).then((function(){t.on(r.Z.Consts.event.FEATUREMODIFY+" "+r.Z.Consts.event.FEATUREREMOVE,(function(t){o(t.feature)})).on(r.Z.Consts.event.FEATUREREMOVE,(function(t){o(t.feature)})).on(r.Z.Consts.event.LAYERREMOVE,(function(t){t.layer.features&&t.layer.features.forEach((t=>o(t)))})).on(r.Z.Consts.event.POPUP+" "+r.Z.Consts.event.DRAWTABLE,(function(t){e.has(t.control.currentFeature)&&n.displayElevationValue(t.control.currentFeature)})),i(n)})).catch((function(t){a(t)}))}))},t.getElevationTool=function(){const t=this;return new Promise((function(e,n){const o={options:{displayElevation:t.options||!0},elevation:t.elevation,map:t.map};r.Z.Control.prototype.getElevationTool.call(o).then((n=>{t.elevation=n,e(n)}))}))},t.setElevationToolOptions=function(t){const e=this;r.Z.Util.extend(e.options,t),e.elevation&&r.Z.Util.extend(e.elevation.options,e.options)},t.displayElevationValue=async function(t,n){const o=this;if(n=n||{},t instanceof r.Z.feature.Point){let i;if(n.ignoreCache?e.delete(t):i=e.get(t),!i){const n=await o.getElevationTool(),r=await n.getElevation({crs:o.map.crs,coordinates:[t.geometry]});if(r.length){const n=r[0];i={elevation:n[2],height:n.length>3?n[3]:null},e.set(t,i)}}if(i){const e=[];let n;const a=o.map.options.locale||r.Z.Cfg.locale,s=o.map.getControlsByClass("TC.control.Popup").concat(o.map.getControlsByClass("TC.control.ResultsPanel"));s.filter((e=>e.caller&&e.caller.highlightedFeature===t)).forEach((function(r){const o=r.caller.getFeatureElement(t);o&&(n=o.querySelector("tbody"),e.push(n))})),s.filter((e=>e.currentFeature===t)).forEach((function(t){let o;switch(!0){case r.Z.control.Popup&&t instanceof r.Z.control.Popup:o=t.getContainerElement();break;case r.Z.control.ResultsPanel&&t instanceof r.Z.control.ResultsPanel:o=t.getInfoContainer()}o&&(n=o.querySelector("tbody"),e.push(n))}));const l={originalValue:t.geometry[2]?r.Z.Util.formatNumber(Math.round(t.geometry[2]),a):"",elevationValue:null!==i.elevation?r.Z.Util.formatNumber(Math.round(i.elevation),a):"",heightValue:i.height?i.height.toLocaleString(a,{maximumFractionDigits:1}):""};e.forEach((function(t){o.getRenderedHtml(o.CLASS+"-val",l,(function(e){t.querySelectorAll(`tr[class|=${o.CLASS}-pair]`).forEach((t=>t.remove())),t.insertAdjacentHTML("beforeend",e)}))}))}}},t.displayElevationProfile=function(t,e){const o=this,i=e||{};let a;switch(!0){case r.Z.feature.Polyline&&t instanceof r.Z.feature.Polyline:a=t.geometry;break;case r.Z.feature.MultiPolyline&&t instanceof r.Z.feature.MultiPolyline:a=t.geometry[0];break;case t instanceof r.Z.Feature:return;default:a=t}o.getProfilePanel().then((function(t){t.open()}));const s=function(t){o.getProfilePanel().then((function(e){e.renderPromise().then((function(){o.renderElevationProfile(t)}))}))};if(t instanceof r.Z.Feature){o.getProfilePanel().then((function(e){e.setCurrentFeature(t)}));const e=function(t){if(t){const e=t.getCoords();return e?n.get(e.toString()):null}}(t);if(e)return void s(e)}const l=o.map.getLoadingIndicator(),c=l&&l.addWait(),u=function(e,i){let a=0,l=Number.NEGATIVE_INFINITY,c=Number.POSITIVE_INFINITY;o.map.crs!==o.map.options.utmCrs&&(e=r.Z.Util.reproject(e,o.map.crs,o.map.options.utmCrs));const u=e.map((function(t,e,n){let r=0===e?t:n[e-1];const o=t[0]-r[0],i=t[1]-r[1];a+=Math.sqrt(o*o+i*i);var s=t[2]||0;return"number"==typeof s&&(l=Math.max(s,l),c=Math.min(s,c)),[a,s]}));1===u.length&&u.push(u[0]);let p={x:u.map((function(t){return t[0]})),ele:u.map((function(t){return t[1]||0})),coords:e,min:c,max:l};const d={coords:e};"object"==typeof o.options&&o.map.options.elevation&&(d.hillDeltaThreshold=o.options.hillDeltaThreshold||o.map.options.elevation.hillDeltaThreshold),0===c&&0===l&&i.onlyOriginalElevation&&(p={msg:o.getLocaleString("geo.trk.chart.chpe.empty")}),r.Z.Util.extend(p,r.Z.tool.Elevation.getElevationGain(d),i),i.isSecondary&&o.elevationProfileChartData&&(o.elevationProfileChartData.secondaryElevationProfileChartData?o.elevationProfileChartData.secondaryElevationProfileChartData[0]=p:(o.elevationProfileChartData.showLegend=!0,o.elevationProfileChartData.secondaryElevationProfileChartData=[],o.elevationProfileChartData.secondaryElevationProfileChartData.push(p))),t instanceof r.Z.Feature&&!i.ignoreCaching&&function(t,e){if(t){const r=t.getCoords();r&&n.set(r.toString(),e)}}(t,p),s(p)};o.getElevationTool().then((function(t){if(i.originalElevation&&u(a,i),i.onlyOriginalElevation)return void(l&&l.removeWait(c));const e=Date.now();o._depTimestamp=e;const n={crs:o.map.crs,coordinates:a,partialCallback:function(t){e===o._depTimestamp&&u(t,{isSecondary:0!==Object.keys(i).length,ignoreCaching:i.ignoreCaching})}};Object.prototype.hasOwnProperty.call(t.options,"resolution")&&(n.resolution=t.options.resolution),Object.prototype.hasOwnProperty.call(t.options,"sampleNumber")&&0!==t.options.sampleNumber&&(n.resolution=0),t.getElevation(n).then((function(){i.callback&&r.Z.Util.isFunction(i.callback)&&i.callback(),l&&l.removeWait(c)})).catch((function(t){o.resetElevationProfile(),l&&l.removeWait(c)}))}))},t.createProfilePanel=function(){const e=this,n={id:e.getUID(),content:"chart",titles:{main:e.getLocaleString("geo.trk.chart.chpe"),max:e.getLocaleString("geo.trk.chart.chpe")},chart:{ctx:e,onmouseout:t.removeElevationTooltip,tooltip:t.getElevationTooltip}};return new Promise((function(t,r){var o;const i=function(t){n.position=t.POSITION.RIGHT,o=t.addControl("resultsPanel",n)};if(e.options.displayOn){var a=e.map.getControlsByClass("TC.control."+e.options.displayOn[0].toUpperCase()+e.options.displayOn.substring(1))[0];a?i(a):e.map.addControl(e.options.displayOn).then(i)}else n.div=document.createElement("div"),e.map.div.appendChild(n.div),o=e.map.addControl("resultsPanel",n);o.then((function(n){n.caller=e,e.resultsPanel=n,e._decorateChartPanel(),t(n)}))}))},t.getProfilePanel=async function(){const t=this;return t._resultsPanelPromise||(t._resultsPanelPromise=t.createProfilePanel()),await t._resultsPanelPromise},t.resetElevationProfile=function(){const t=this;t.options.displayElevation&&t.resultsPanel&&(t.elevationProfileChartData={x:[0],ele:[0],coords:[0,0,0],upHill:0,downHill:0},t.resultsPanel.openChart(t.elevationProfileChartData))},t.renderElevationProfile=function(t){const e=this;t.isSecondary||(e.elevationProfileChartData=t||e.elevationProfileChartData),e.getProfilePanel().then((function(n){n.div.classList.contains(r.Z.Consts.classes.HIDDEN)||(t.isSecondary?n.loadDataOnChart(e.elevationProfileChartData):n.openChart(e.elevationProfileChartData),n.isMinimized()||n.doVisible())}))},t.closeElevationProfile=function(){this.getProfilePanel().then((function(t){t.close()}))},t._decorateChartPanel=function(){const t=this;t.resultsPanel.setCurrentFeature=function(t){const e=this;e.currentFeature&&e.currentFeature.toggleSelectedStyle(!1),e.currentFeature=t,t&&t.toggleSelectedStyle(!0)};const e=t.resultsPanel.close;t.resultsPanel.close=function(){const t=this;t.currentFeature&&t.currentFeature.toggleSelectedStyle(!1),e.call(t)}},t.getElevationTooltip=function(t){const e=this;return e.resultsPanel.wrap.showElevationMarker({data:t,layer:e.resultsPanel.currentFeature&&e.resultsPanel.currentFeature.layer,coords:e.elevationProfileChartData.coords}),e.resultsPanel.getElevationChartTooltip(t)},t.removeElevationTooltip=function(){const t=this;t.resultsPanel&&(t.resultsPanel.chart&&t.resultsPanel.chart.chart&&t.resultsPanel.chart.chart.tooltip.hide(),t.resultsPanel.wrap.hideElevationMarker())}}();const a=r.Z.control.Elevation},7648:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var r,o=n(5361),i=n(2089),a=n(6498);o.Z.control=o.Z.control||{},o.Z.Consts=i.Z,o.Z.Control=a.Z,o.Z.control.ExternalWMS=function(t){const e=this;e.count=0,e._addedUrls=[],o.Z.Control.apply(e,arguments),e.allowReprojection=!e.options.hasOwnProperty("allowReprojection")||e.options.allowReprojection},o.Z.inherit(o.Z.control.ExternalWMS,o.Z.Control),(r=o.Z.control.ExternalWMS.prototype).CLASS="tc-ctl-xwms",r.markServicesAsSelected=function(t){if(t.length>0){const e=t[0];e.disabled=!0,e.classList.add("tc-ctl-xwms-option-selected")}},r.register=function(t){const e=this,n=o.Z.Control.prototype.register.call(e,t);e.div.addEventListener("change",o.Z.EventTarget.listenerBySelector("select",(function(t){if(""!==t.target.value){var n=t.target.value;0===n.indexOf("//")&&(n=location.protocol+n),e.div.querySelector("input").value=n,t.target.value=""}})));const r=function(){var t=e.div.querySelector("input").value.trim();if(t)if(/^((https?|ftp):)?(\/\/)?(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(t))if(e._addedUrls.some((function(e){return e.replace(/https?:\/\/|\/\//,"")===t.replace(/https?:\/\/|\/\//,"")})))o.Z.alert(e.getLocaleString("serviceAlreadyAdded"));else{var n=e.map.getControlsByClass("TC.control.LoadingIndicator")[0];n.show();var r=o.Z.Util.getQueryStringParams(t);/https?:\/\/|\/\//i.test(t)||(t="//"+t);var i=["version","service","request"],a=function(t,e){for(var n=0;n<e.length;n++)t=o.Z.Util.removeURLParameter(t,e[n]);return t.match(/\?$/)&&(t=t.substr(0,t.length-1)),t}(t,Object.keys(r));for(var s in r)i.indexOf(s.toLowerCase())>=0&&delete r[s];const d=e.div.querySelector("button");d.setAttribute("type","button"),d.disabled=!0;for(var l={id:"xwms"+ ++e.count,type:"WMS",url:a,hideTree:!1,queryParams:r},c=0;c<e.options.suggestions.length;c++){var u=e.options.suggestions[c].items.filter((e=>e.url===t));if(u.length>0&&u[0].layerNames){l.layerNames=u[0].layerNames;break}}var p=new o.Z.layer.Raster(l);p.getCapabilitiesPromise().then((function(r){if(void 0===r.Capability)return o.Z.alert(e.getLocaleString("noLayersFoundInService")),n.hide(),void(d.disabled=!1);{var i=r.Capability.Layer;if(i.CRS&&-1===i.CRS.indexOf(e.map.crs)&&!e.allowReprojection)return o.Z.alert(e.getLocaleString("serviceSrsNotCompatible")),n.hide(),void(d.disabled=!1);e.map.trigger(o.Z.Consts.event.EXTERNALSERVICEADDED,{layer:p}),e.div.querySelector("input").value="";const a=[];e.div.querySelectorAll("select option").forEach((function(e){e.value.replace(/https?:\/\/|\/\//,"")===t.replace(/https?:\/\/|\/\//,"")&&a.push(e)})),e.markServicesAsSelected(a),e._addedUrls.push(t),n.hide(),d.disabled=!1}}),(function(t){o.Z.alert(e.getLocaleString("serviceCouldNotBeLoaded")+":\n"+t),n.hide(),d.disabled=!1}))}else o.Z.alert(e.getLocaleString("typeAValidAddress"));else o.Z.alert(e.getLocaleString("typeAnAddress"))};return e.renderPromise().then((()=>{e.div.querySelector("input").addEventListener("keyup",(t=>{t.key&&"enter"===t.key.toLowerCase()&&e.div.querySelector("input").value.trim().length>0&&r()}))})),e.div.addEventListener("click",o.Z.EventTarget.listenerBySelector('button[name="agregar"]',r)),t.on(o.Z.Consts.event.LAYERADD,(function(t){const n=t.layer;if(n&&!n.isBase){var r=n.url;if(r){e.pending_markServicesAsSelected=e.pending_markServicesAsSelected||[],0===e.div.querySelectorAll("select option").length&&r&&-1===e.pending_markServicesAsSelected.indexOf(r)&&e.pending_markServicesAsSelected.push(r);const t=[];e.div.querySelectorAll("select option").forEach((function(e){e.value.replace(/https?:\/\/|\/\//,"")===r.replace(/https?:\/\/|\/\//,"")&&t.push(e)})),e.markServicesAsSelected(t),e._addedUrls.push(r)}}})),n},r.template={},r.template[r.CLASS]={1:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"addMaps",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:17},end:{line:1,column:35}}}))+"</h2>"},3:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=s(n,"if").call(a,null!=e?s(e,"group"):e,{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.noop,data:o,loc:{start:{line:7,column:7},end:{line:9,column:14}}}))?i:"")+(null!=(i=s(n,"each").call(a,null!=e?s(e,"items"):e,{name:"each",hash:{},fn:t.program(6,o,0),inverse:t.noop,data:o,loc:{start:{line:10,column:16},end:{line:12,column:25}}}))?i:"")+(null!=(i=s(n,"if").call(a,null!=e?s(e,"group"):e,{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.noop,data:o,loc:{start:{line:13,column:7},end:{line:15,column:14}}}))?i:"")},4:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <optgroup label="'+t.escapeExpression(t.lambda(null!=e?i(e,"group"):e,e))+'">\r\n'},6:function(t,e,n,r,o){var i=t.lambda,a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                    <option value="'+a(i(null!=e?s(e,"url"):e,e))+'">'+a(i(null!=e?s(e,"name"):e,e))+"</option>\r\n"},8:function(t,e,n,r,o){return"                </optgroup>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=l(n,"if").call(a,null!=e?l(e,"title"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:0},end:{line:1,column:47}}}))?i:"")+'\r\n<div>\r\n    <div class="tc-group tc-ctl-xwms-cnt">        \r\n        <select class="tc-combo" title="WMS (Web Map Service)">\r\n            <option value="">WMS</option>\r\n'+(null!=(i=l(n,"each").call(a,null!=e?l(e,"suggestions"):e,{name:"each",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:6,column:12},end:{line:16,column:21}}}))?i:"")+'        </select>\r\n        <input type="url" class="tc-textbox" placeholder="'+s(l(n,"i18n").call(a,"writeAddressOrSelect",{name:"i18n",hash:{},data:o,loc:{start:{line:18,column:58},end:{line:18,column:89}}}))+'" />\r\n    </div>\r\n\r\n\r\n    <div class="tc-group tc-group tc-ctl-xwms-cnt" style="text-align:right;">\r\n        <button type="button" class="tc-button tc-icon-button" title="'+s(l(n,"i18n").call(a,"addService.title",{name:"i18n",hash:{},data:o,loc:{start:{line:23,column:70},end:{line:23,column:97}}}))+'" name="agregar">'+s(l(n,"i18n").call(a,"addService",{name:"i18n",hash:{},data:o,loc:{start:{line:23,column:114},end:{line:23,column:135}}}))+"</button>\r\n    </div>\r\n</div>\r\n"},useData:!0},r.render=function(t){const e=this;return e._set1stRenderPromise(e.renderData(e.options,(function(){e.pending_markServicesAsSelected=e.pending_markServicesAsSelected||[],e.pending_markServicesAsSelected.forEach((function(t){const n=[];e.div.querySelectorAll("select option").forEach((function(e){o.Z.Util.addProtocol(e.value)===o.Z.Util.addProtocol(t)&&n.push(e)})),e.markServicesAsSelected(n),e._addedUrls.push(t)})),e.pending_markServicesAsSelected=[]})))};const s=o.Z.control.ExternalWMS},5539:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>a});var r=n(5361),o=n(2089),i=n(6498);r.Z.control=r.Z.control||{},r.Z.Consts=o.Z,r.Z.Control=i.Z,r.Z.control.FeatureDownloadDialog=function(){var t=this;r.Z.Control.apply(t,arguments),t.title=t.options.title,t.cssClass=t.options.cssClass||"",t._selectors={ELEVATION_CHECKBOX:"."+t.CLASS+"-elev input[type=checkbox]",INTERPOLATION_PANEL:"."+t.CLASS+"-ip",INTERPOLATION_RADIO:`input[type=radio][name=${t.id}-finfo-ip-coords]`,INTERPOLATION_DISTANCE:"."+t.CLASS+"-ip-m"},t.features=[],t.options={}},r.Z.inherit(r.Z.control.FeatureDownloadDialog,r.Z.Control),function(){const t=r.Z.control.FeatureDownloadDialog.prototype;t.CLASS="tc-ctl-dldlog";var e,n=["KMZ","GML","GeoJSON","WKT","GPX","SHP","GPKG"],o=!1,i=null;t.template={},t.template[t.CLASS]={1:function(t,e,n,r,o){var i,a=t.lambda,s=t.escapeExpression,l=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <div class="tc-ctl-dldlog-elev">\r\n                <input id="'+s(a(null!=e?c(e,"checkboxId"):e,e))+'" type="checkbox" '+(null!=(i=c(n,"if").call(l,null!=(i=null!=e?c(e,"elevation"):e)?c(i,"checked"):i,{name:"if",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:11,column:59},end:{line:11,column:98}}}))?i:"")+'>\r\n                <label for="'+s(a(null!=e?c(e,"checkboxId"):e,e))+'" class="tc-ctl-dldlog-elev-label">'+s(c(n,"i18n").call(l,"includeElevations",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:77},end:{line:12,column:105}}}))+'</label>\r\n            </div>\r\n            <div class="tc-ctl-dldlog-ext">\r\n            </div>\r\n'+(null!=(i=c(n,"if").call(l,null!=(i=null!=e?c(e,"elevation"):e)?c(i,"resolution"):i,{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.noop,data:o,loc:{start:{line:16,column:12},end:{line:29,column:19}}}))?i:"")},2:function(t,e,n,r,o){return"checked"},4:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lambda,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <div class="tc-ctl-dldlog-ip tc-hidden">\r\n                <h4>'+s(c(n,"i18n").call(a,"interpolateCoordsFromElevProfile",{name:"i18n",hash:{},data:o,loc:{start:{line:18,column:20},end:{line:18,column:63}}}))+'</h4>\r\n                <label>\r\n                    <input type="radio" name="'+s(l(null!=e?c(e,"controlId"):e,e))+'-finfo-ip-coords" value="0" checked />\r\n                    <span>'+s(c(n,"i18n").call(a,"no",{name:"i18n",hash:{},data:o,loc:{start:{line:21,column:26},end:{line:21,column:39}}}))+'</span>\r\n                </label>\r\n                <label>\r\n                    <input type="radio" name="'+s(l(null!=e?c(e,"controlId"):e,e))+'-finfo-ip-coords" value="1" />\r\n                    <span>'+s(c(n,"i18n").call(a,"yes",{name:"i18n",hash:{},data:o,loc:{start:{line:25,column:26},end:{line:25,column:40}}}))+'</span>\r\n                </label>\r\n                <div class="tc-ctl-dldlog-ip-m tc-hidden">'+s(c(n,"i18n").call(a,"interpolateEveryXMeters.1",{name:"i18n",hash:{},data:o,loc:{start:{line:27,column:58},end:{line:27,column:94}}}))+'<input type="number" min="1" step="1" class="tc-textbox" value="'+s(l(null!=(i=null!=e?c(e,"elevation"):e)?c(i,"resolution"):i,e))+'" />'+s(c(n,"i18n").call(a,"interpolateEveryXMeters.2",{name:"i18n",hash:{},data:o,loc:{start:{line:27,column:186},end:{line:27,column:222}}}))+"</div>\r\n            </div>\r\n"},6:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,e,"KML",{name:"eq",hash:{},data:o,loc:{start:{line:34,column:26},end:{line:34,column:41}}}),{name:"if",hash:{},fn:t.program(7,o,0),inverse:t.program(9,o,0),data:o,loc:{start:{line:34,column:20},end:{line:50,column:28}}}))?i:""},7:function(t,e,n,r,o){return'<button type="button" class="tc-button tc-btn-dl tc-ctl-dldlog-btn-kml" data-format="KML" title="KML">KML</button>'},9:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,e,"KMZ",{name:"eq",hash:{},data:o,loc:{start:{line:36,column:31},end:{line:36,column:46}}}),{name:"if",hash:{},fn:t.program(10,o,0),inverse:t.program(12,o,0),data:o,loc:{start:{line:36,column:20},end:{line:50,column:20}}}))?i:""},10:function(t,e,n,r,o){return'<button type="button" class="tc-button tc-btn-dl tc-ctl-dldlog-btn-kmz" data-format="KMZ" title="KML">KML</button>'},12:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,e,"GML",{name:"eq",hash:{},data:o,loc:{start:{line:38,column:31},end:{line:38,column:46}}}),{name:"if",hash:{},fn:t.program(13,o,0),inverse:t.program(15,o,0),data:o,loc:{start:{line:38,column:20},end:{line:50,column:20}}}))?i:""},13:function(t,e,n,r,o){return'<button type="button" class="tc-button tc-btn-dl tc-ctl-dldlog-btn-gml" data-format="GML" title="GML">GML</button>'},15:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,e,"GeoJSON",{name:"eq",hash:{},data:o,loc:{start:{line:40,column:31},end:{line:40,column:50}}}),{name:"if",hash:{},fn:t.program(16,o,0),inverse:t.program(18,o,0),data:o,loc:{start:{line:40,column:20},end:{line:50,column:20}}}))?i:""},16:function(t,e,n,r,o){return'<button type="button" class="tc-button tc-btn-dl tc-ctl-dldlog-btn-geojson" data-format="GeoJSON" title="GeoJSON">GeoJSON</button>'},18:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,e,"WKT",{name:"eq",hash:{},data:o,loc:{start:{line:42,column:31},end:{line:42,column:46}}}),{name:"if",hash:{},fn:t.program(19,o,0),inverse:t.program(21,o,0),data:o,loc:{start:{line:42,column:20},end:{line:50,column:20}}}))?i:""},19:function(t,e,n,r,o){return'<button type="button" class="tc-button tc-btn-dl tc-ctl-dldlog-btn-wkt" data-format="WKT" title="WKT">WKT</button>'},21:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,e,"GPX",{name:"eq",hash:{},data:o,loc:{start:{line:44,column:31},end:{line:44,column:46}}}),{name:"if",hash:{},fn:t.program(22,o,0),inverse:t.program(24,o,0),data:o,loc:{start:{line:44,column:20},end:{line:50,column:20}}}))?i:""},22:function(t,e,n,r,o){return'<button type="button" class="tc-button tc-btn-dl tc-ctl-dldlog-btn-gpx" data-format="GPX" title="GPX">GPX</button>'},24:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,e,"SHP",{name:"eq",hash:{},data:o,loc:{start:{line:46,column:31},end:{line:46,column:46}}}),{name:"if",hash:{},fn:t.program(25,o,0),inverse:t.program(27,o,0),data:o,loc:{start:{line:46,column:20},end:{line:50,column:20}}}))?i:""},25:function(t,e,n,r,o){return'<button type="button" class="tc-button tc-btn-dl tc-ctl-dldlog-btn-shp" data-format="SHP" title="Shapefile">Shapefile</button>'},27:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"eq").call(a,e,"GPKG",{name:"eq",hash:{},data:o,loc:{start:{line:48,column:31},end:{line:48,column:47}}}),{name:"if",hash:{},fn:t.program(28,o,0),inverse:t.noop,data:o,loc:{start:{line:48,column:20},end:{line:50,column:20}}}))?i:""},28:function(t,e,n,r,o){return'<button type="button" class="tc-button tc-btn-dl tc-ctl-dldlog-btn-gpkg" data-format="GPKG" title="GeoPackage">GeoPackage</button>'},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=t.lambda,s=t.escapeExpression,l=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-dldlog tc-modal '+s(a(null!=e?c(e,"cssClass"):e,e))+'">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+s(a(null!=e?c(e,"title"):e,e))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n'+(null!=(i=c(n,"if").call(l,null!=e?c(e,"elevation"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:9,column:12},end:{line:30,column:19}}}))?i:"")+'            <div class="tc-ctl-dldlog-dl">\r\n                <div>\r\n'+(null!=(i=c(n,"each").call(l,null!=e?c(e,"formats"):e,{name:"each",hash:{},fn:t.program(6,o,0),inverse:t.noop,data:o,loc:{start:{line:33,column:20},end:{line:51,column:29}}}))?i:"")+"                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>"},useData:!0};const a=function(t,e){const n=this;return e=e||{},new Promise((function(o,i){const a=function(t){const e=t.clone();return e.id=t.id,e};if(!e.displayElevation)return void o(t.map((function(t){if(t.getGeometryStride()>2){const e=a(t);return e.id=t.id,e.layer=t.layer,e.getCoordsArray().forEach((t=>t.length=2)),e.setCoords(e.geometry),e}return t})));let s=e.elevation&&e.elevation.resolution,l=s?t.map((t=>a(t))):t.map((t=>t.getCoordsArray().every((t=>!t[2]))?a(t):null));if(s||l.some((t=>null!==t))){const a={crs:n.map.crs,features:l,maxCoordQuantity:e.elevation&&e.elevation.maxCoordQuantity,resolution:e.elevation.resolution,sampleNumber:e.elevation.sampleNumber||0};(n.map.elevation||new r.Z.tool.Elevation("boolean"==typeof e.elevation?{}:e.elevation)).setGeometry(a).then((function(e){e.forEach(((n,r)=>{n||(e[r]=t[r])})),o(e)}),(function(t){i(t instanceof Error?t:Error(t))}))}else o(t)}))},s=function(){return this.getFeatures().some((t=>r.Z.feature.Point&&t instanceof r.Z.feature.Point||r.Z.feature.MultiPoint&&t instanceof r.Z.feature.MultiPoint))},l=function(){return this.getFeatures().some((t=>r.Z.feature.Polyline&&t instanceof r.Z.feature.Polyline||r.Z.feature.MultiPolyline&&t instanceof r.Z.feature.MultiPolyline))},c=function(){return this.getFeatures().some((t=>r.Z.feature.Polygon&&t instanceof r.Z.feature.Polygon||r.Z.feature.MultiPolygon&&t instanceof r.Z.feature.MultiPolygon))};t.render=function(t){return r.Z.Control.prototype.renderData.call(this,{controlId:this.id},t)},t.close=function(t){const e=this;e.modal&&e.modal.parentElement&&(r.Z.Util.closeModal(),e.modal.parentElement.removeChild(e.modal))},t.open=function(u,p){const d=this;d.close(),d.setFeatures(u),p=p||{};const h=(p=Object.assign({},{controlId:d.id,cssClass:d.cssClass,checkboxId:d.getUID(),elevation:p.elevation},p)).excludedFormats?p.excludedFormats.slice():[];s.call(d)||l.call(d)||!c.call(d)||h.push(r.Z.Consts.format.GPX),p.formats=n.filter((t=>h.indexOf(t)<0)),d.setOptions(p),d.getRenderedHtml(t.CLASS,p,(function(t){const n=document.createElement("template");n.innerHTML=t,d.modal=n.content?n.content.firstChild:n.firstChild,document.body.appendChild(d.modal);const s=d.modalBody=d.modal.getElementsByClassName("tc-modal-body")[0];s.addEventListener(r.Z.Consts.event.CLICK,r.Z.EventTarget.listenerBySelector("button[data-format]",(function(t){var n=e&&o?parseFloat(s.querySelector(d._selectors.INTERPOLATION_DISTANCE+" input[type=number]").value)||(d.options.elevation||d.map.elevation&&d.map.elevation.options).resolution:0;const i=async(t,o)=>{var i=!1;if(l!==r.Z.Consts.format.GEOJSON&&o.format!==r.Z.Consts.format.WKT&&t.some((function(t){for(var e in t.getData())if(t.data[e]instanceof Object)return!0;return!1}))&&await r.Z.confirm(d.getLocaleString("dl.export.complexAttr").format(l),null,(function(){i=!0})),i)return;const s=d.map.getLoadingIndicator(),c=s&&s.addWait();r.Z.Util.closeModal(),a.apply(d,[t,{displayElevation:e,elevation:e?Object.assign({},o.elevation||d.map.elevation&&d.map.elevation.options,{resolution:n}):null}]).then((function(t){const e=o.fileName||(o.title?o.title.toLowerCase().replace(/ /g,"_"):"download");let n=o.fileName||e+" "+r.Z.Util.getFormattedDate((new Date).toString(),!0);d.map.exportFeatures(t,{fileName:e,format:l}).then((t=>{switch(n=n||r.Z.getUID(),l){case r.Z.Consts.format.SHAPEFILE:r.Z.Util.downloadBlob(n+".zip",t);break;case r.Z.Consts.format.GEOPACKAGE:r.Z.Util.downloadFile(n+".gpkg","application/geopackage+sqlite3",t);break;case r.Z.Consts.format.KMZ:r.Z.Util.downloadBlob(n+".kmz",t);break;default:{const e=r.Z.Consts.mimeType[p.format];r.Z.Util.downloadFile(n+"."+l.toLowerCase(),e,t);break}}}))}),(function(e){d.open(t,o),r.Z.tool.Elevation&&e.message===r.Z.tool.Elevation.errors.MAX_COORD_QUANTITY_EXCEEDED?r.Z.alert(d.getLocaleString("tooManyCoordinatesForElevation.warning")):r.Z.error(d.getLocaleString("elevation.error"))})).finally((function(){s&&s.removeWait(c)}))},l=t.target.dataset.format;l===r.Z.Consts.format.GPX&&c.call(d)?r.Z.confirm(d.getLocaleString("gpxNotCompatible.confirm"),(function(){i(d.getFeatures().filter((function(t){return!(r.Z.feature.Polygon&&t instanceof r.Z.feature.Polygon||r.Z.feature.MultiPolygon&&t instanceof r.Z.feature.MultiPolygon)})),d.getOptions())})):i(d.getFeatures(),d.getOptions())})),{passive:!0});const u=s.querySelector(d._selectors.INTERPOLATION_PANEL),h=s.querySelector(d._selectors.ELEVATION_CHECKBOX);p.elevation&&(e=p.elevation.checked?p.elevation.checked:e,h.checked=e,u&&(e?u.classList.remove(r.Z.Consts.classes.HIDDEN):u.classList.contains(r.Z.Consts.classes.HIDDEN)||u.classList.add(r.Z.Consts.classes.HIDDEN),e&&(l.call(d)||c.call(d))&&p.elevation.resolution?u.classList.remove(r.Z.Consts.classes.HIDDEN):u.classList.contains(r.Z.Consts.classes.HIDDEN)||u.classList.add(r.Z.Consts.classes.HIDDEN),s.querySelectorAll(d._selectors.INTERPOLATION_RADIO)[o?1:0].checked=!0,o&&(s.querySelector(d._selectors.INTERPOLATION_DISTANCE).classList.remove(r.Z.Consts.classes.HIDDEN),s.querySelector(d._selectors.INTERPOLATION_DISTANCE+" input").value=i||s.querySelector(d._selectors.INTERPOLATION_DISTANCE+" input").value))),s.addEventListener("change",r.Z.EventTarget.listenerBySelector(d._selectors.ELEVATION_CHECKBOX,(function(t){e=!e,u&&(e?u.classList.remove(r.Z.Consts.classes.HIDDEN):u.classList.contains(r.Z.Consts.classes.HIDDEN)||u.classList.add(r.Z.Consts.classes.HIDDEN),e&&(l.call(d)||c.call(d))?u.classList.remove(r.Z.Consts.classes.HIDDEN):u.classList.contains(r.Z.Consts.classes.HIDDEN)||u.classList.add(r.Z.Consts.classes.HIDDEN))}))),s.addEventListener("change",r.Z.EventTarget.listenerBySelector(d._selectors.INTERPOLATION_RADIO,(function(t){s.querySelector(d._selectors.INTERPOLATION_DISTANCE).classList.toggle(r.Z.Consts.classes.HIDDEN),(o=!o)&&(s.querySelector(d._selectors.INTERPOLATION_DISTANCE+" input").value=i||s.querySelector(d._selectors.INTERPOLATION_DISTANCE+" input").value)}))),s.addEventListener("change",r.Z.EventTarget.listenerBySelector(d._selectors.INTERPOLATION_DISTANCE,(function(t){i=t.target.value})));let f={closeCallback:function(){d.modal.parentElement.removeChild(d.modal)}};p.openCallback&&(f.openCallback=p.openCallback),r.Z.Util.showModal(d.modal,f)}))},t.setFeatures=function(t){this.features=Array.isArray(t)?t:[t]},t.getFeatures=function(){return this.features},t.setOptions=function(t){this.options=Object.assign(this.options,t)},t.getOptions=function(){return this.options}}();const a=r.Z.control.FeatureDownloadDialog},8144:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>a});var r=n(5361),o=n(2089),i=n(128);r.Z.control=r.Z.control||{},r.Z.Consts=o.Z,r.Z.control.FeatureInfoCommons=i.default,function(){r.Z.control.FeatureInfo=function(){var t=this;r.Z.control.FeatureInfoCommons.apply(this,arguments),t.wrap=new r.Z.wrap.control.FeatureInfo(t),r.Z.Consts.classes.FROMLEFT="tc-fromleft",r.Z.Consts.classes.FROMRIGHT="tc-fromright"},r.Z.inherit(r.Z.control.FeatureInfo,r.Z.control.FeatureInfoCommons);var t=r.Z.control.FeatureInfo.prototype,e=function t(e,n){var r;if(Array.isArray(e))for(var o=0,i=(r=e.slice()).length;o<i;o++)r[o]=t(r[o]);else r="number"==typeof e?Math.round(e.toFixed(n)):e;return r};t.register=function(t){const e=this;return new Promise((function(n,o){r.Z.control.FeatureInfoCommons.prototype.register.call(e,t).then((function(t){document.createElement("div").appendChild(e.div),n(t)}),(t=>o(t)))}))},t.callback=function(t,e){const n=this;return n.querying=!0,new Promise((function(e,o){const i=n.getElevationTool();if(i.then((function(e){e&&(n.elevationRequest=e.getElevation({crs:n.map.crs,coordinates:[t]}))})),n.map&&n.filterLayer){var a=n.getLocaleString("featureInfo"),s=r.Z.Util.extend({},n.map.options.styles.marker,n.markerStyle,{title:a,set:a,showsPopup:!1});n.filterLayer.clearFeatures(),n.highlightedFeature=null,n.filterFeature=null,n.filterLayer.addMarker(t,s).then((function(o){n.map.putLayerOnTop(n.filterLayer),n.filterFeature=o,i.then((function(t){n.renderResults({coords:o.geometry,displayElevation:t,loading:!0},(function(){n.displayResults()}))}));for(var a=!1,s=0;s<n.map.workLayers.length;s++){var l=n.map.workLayers[s];if(l.type===r.Z.Consts.layerType.WMS&&l.getVisibility()&&l.names.length>0){a=!0;break}}n.queryResolution=n.map.getResolution(),a?n.wrap.getFeatureInfo(t,n.queryResolution).then((()=>e())):setTimeout((function(){n.responseCallback({coords:t}),e()}))}))}else e()}))},t.sendRequest=function(t){return this.callback(t.getCoordinates())},t.responseCallback=function(t){const n=this;if(r.Z.control.FeatureInfoCommons.prototype.responseCallback.call(n,t),n.filterFeature){var o=t.services;if(o)for(var i=0;i<o.length;i++){for(var a=o[i],s=0;s<a.layers.length;s++)a.layers[s].features.length||(a.layers.splice(s,1),s-=1);a.layers.length||(o.splice(i,1),i-=1)}n.info.defaultFeature=t.defaultFeature,n.elevationRequest&&(t.displayElevation=!0),n.renderResults(t,(function(){if(n.insertLinks(),n.sharedFeatureInfo){var t;n.div.querySelectorAll("ul."+n.CLASS+"-services li").forEach((function(t){t.classList.add(r.Z.Consts.classes.CHECKED)}));for(var o=n.sharedFeatureInfo,i=0,a=n.info.services.length;i<a;i++){var s=n.info.services[i];if(s.mapLayers.some((t=>t.url===o.s))){for(var l=0,c=s.layers.length;l<c;l++){var u=s.layers[l];if(u.name===o.l){for(var p=0,d=u.features.length;p<d;p++){var h=u.features[p];if(h.id===o.f){t=h;var f=hex_md5(JSON.stringify({data:h.getData(),geometry:e(h.geometry,r.Z.Consts.DEGREE_PRECISION)}));o.h!==f&&r.Z.alert(n.getLocaleString("finfo.featureChanged.warning"));break}}break}}break}}t&&(n.highlightedFeature=t,n.map.addLayer({id:n.getUID(),type:r.Z.Consts.layerType.VECTOR,title:n.getLocaleString("foi"),owner:n,stealth:!0}).then((function(e){n.sharedFeatureLayer=e,n.filterLayer.clearFeatures(),n.filterFeature=null,e.addFeature(t),n.map.zoomToFeatures([t])}))),delete n.sharedFeatureInfo}else n.displayResults();n.div.querySelectorAll("ul."+n.CLASS+"-services label, ul."+n.CLASS+"-services a").forEach((function(t){t.addEventListener(r.Z.Consts.event.CLICK,(function(t){t.stopPropagation()}),{passive:!0})}))}))}},t.displayResultsCallback=function(){const t=this;if(r.Z.control.FeatureInfoCommons.prototype.displayResultsCallback.call(t),t.elevationRequest){const e=t.getDisplayControl();t.getDisplayTarget().querySelectorAll(`.${t.CLASS}-elev,.${t.CLASS}-height`).forEach((t=>t.classList.add(r.Z.Consts.classes.HIDDEN))),t.elevationRequest.then((function(n){if(e.currentFeature&&n.length){const r=e.currentFeature.geometry,o=n[0];if(r[0]===o[0]&&r[1]===o[1]){const e=n.length?n[0].slice(2):null;t.displayElevationValues(e)}}}))}new ResizeObserver((e=>{for(let n of e)n.target.querySelectorAll("ul."+t.CLASS+"-services label, ul."+t.CLASS+"-services h4, ul."+t.CLASS+"-services h3 span").forEach((function(t){t.addEventListener("mouseenter",(function(t){this.offsetWidth<this.scrollWidth?this.title=this.childNodes.item("H4"===this.tagName?2:0).textContent:this.title=""}),{passive:!0})}))})).observe(t.getDisplayTarget())},t.renderResults=function(t,e){const n=this;if(n.filterFeature){const o=n.filterFeature.geometry;t.coords&&o[0]===t.coords[0]&&o[1]===t.coords[1]&&(t.isGeo=n.map.wrap.isGeo(),t.coords&&(t.crs=n.map.crs,t.coords=t.coords.map((function(e){const n=t.isGeo?r.Z.Consts.DEGREE_PRECISION:r.Z.Consts.METER_PRECISION;return r.Z.Util.formatCoord(e,n)}))),n.renderData(t,e))}},t.displayElevationValues=function(t){const e=this;let n,o;Array.isArray(t)?(n=t[0],o=t.length>1?t[1]:null):(n=t,o=null);const i=e.map.options.locale||r.Z.Cfg.locale;let a=null===n?"-":r.Z.Util.formatNumber(Math.round(n),i)+" m",s=o?o.toLocaleString(i,{maximumFractionDigits:1})+" m":"-";const l=e.getDisplayTarget().querySelector(`.${e.CLASS}-elev`),c=e.getDisplayTarget().querySelector(`.${e.CLASS}-height`);l&&c&&(l.classList.toggle(r.Z.Consts.classes.HIDDEN,null===n),c.classList.toggle(r.Z.Consts.classes.HIDDEN,!o),l.querySelector(`.${e.CLASS}-coords-val`).innerHTML=a,c.querySelector(`.${e.CLASS}-coords-val`).innerHTML=s)},t.loadSharedFeature=function(t){const e=this;if(t){if(0===e.map.workLayers.filter((function(e,n){return e.type===r.Z.Consts.layerType.WMS&&e.url===t.s&&e.getDisgregatedLayerNames().indexOf(t.l)>=0})).length)return void r.Z.error(e.getLocaleString("sharedFeatureNotValid"),r.Z.Consts.msgErrorMode.TOAST);e.sharedFeatureInfo=t,r.Z.loadJS(!window.hex_md5,[r.Z.apiLocation+r.Z.Consts.url.HASH],(function(){const n=[-100,-100];e.beforeRequest({xy:n}),e.filterLayer.clearFeatures(),e.filterFeature=null,e.filterLayer.addMarker(n).then((function(n){e.filterFeature=n,e.wrap.getFeatureInfo(t.xy,t.r,{serviceUrl:t.s,layerName:t.l,featureId:t.f})}))}))}},t.exportQuery=function(){const t=r.Z.control.FeatureInfoCommons.prototype.exportQuery.call(this);return t.res=this.queryResolution,t},t.importQuery=function(t){const e=this;t.filter&&e.map.setResolution(t.res).then((()=>r.Z.control.FeatureInfoCommons.prototype.importQuery.call(e,t)))}}();const a=r.Z.control.FeatureInfo},128:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>l});var r=n(5361),o=n(2089),i=n(1432),a=n(3905),s=n(7901);r.Z.control=r.Z.control||{},r.Z.Consts=o.Z,r.Z.control.Click=i.default,r.Z.control.Print=a.default,r.Z.control.infoShare=s.default,r.Z.Consts.event.POPUP=r.Z.Consts.event.POPUP||"popup.tc",r.Z.Consts.event.POPUPHIDE=r.Z.Consts.event.POPUPHIDE||"popuphide.tc",r.Z.Consts.event.DRAWCHART=r.Z.Consts.event.DRAWCHART||"drawchart.tc",r.Z.Consts.event.DRAWTABLE=r.Z.Consts.event.DRAWTABLE||"drawtable.tc",r.Z.Consts.event.RESULTSPANELCLOSE=r.Z.Consts.event.RESULTSPANELCLOSE||"resultspanelclose.tc",r.Z.Consts.event.FEATUREHIGHLIGHT="featurehighlight.tc",r.Z.Consts.event.FEATUREDOWNPLAY="featuredownplay.tc",r.Z.control.FeatureInfoCommons=function(){const t=this;r.Z.control.Click.apply(t,arguments),t._selectors={LIST_ITEM:`ul.${t.CLASS}-features li`,SHOW_ALL_CHECKBOX:`.${t.CLASS}-btn input[type="checkbox"].${t.CLASS}-btn-show-all`,ZOOM_ALL_BUTTON:`.${t.CLASS}-btn .${t.CLASS}-btn-zoom-all`,DEL_ALL_BUTTON:`.${t.CLASS}-btn .${t.CLASS}-btn-del-all`},t.resultsLayer=null,t.filterLayer=null,t._layersPromise=null,t.filterFeature=null,t.info=null,t._infoHistory={},t.popup=null,t.resultsPanel=null,t.lastFeatureCount=null,t.exportsState=!0,t._dialogDiv=r.Z.Util.getDiv(t.options.dialogDiv),window.$&&(t._$dialogDiv=$(t._dialogDiv)),t.options.dialogDiv||document.body.appendChild(t._dialogDiv)},function(){r.Z.inherit(r.Z.control.FeatureInfoCommons,r.Z.control.Click),r.Z.mix(r.Z.control.FeatureInfoCommons,r.Z.control.infoShare);var t=r.Z.control.FeatureInfoCommons.prototype;t.CLASS="tc-ctl-finfo",t.CURRENT_CLASS="tc-current",t.TITLE_SEPARATOR=" › ",t.DEFAULT_STROKE_COLOR="#0000ff",t.template={},t.template[t.CLASS]={1:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lambda,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-lat">'+s(c(n,"i18n").call(a,"lat",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:67},end:{line:4,column:81}}}))+': <span class="tc-ctl-finfo-coords-val">'+s(l(null!=(i=null!=e?c(e,"coords"):e)?c(i,"1"):i,e))+'</span></span>\r\n    <span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-lon">'+s(c(n,"i18n").call(a,"lon",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:67},end:{line:5,column:81}}}))+': <span class="tc-ctl-finfo-coords-val">'+s(l(null!=(i=null!=e?c(e,"coords"):e)?c(i,"0"):i,e))+"</span></span>\r\n"},3:function(t,e,n,r,o){var i,a=t.lambda,s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-x">x: <span class="tc-ctl-finfo-coords-val">'+s(a(null!=(i=null!=e?l(e,"coords"):e)?l(i,"0"):i,e))+'</span></span>\r\n    <span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-x">y: <span class="tc-ctl-finfo-coords-val">'+s(a(null!=(i=null!=e?l(e,"coords"):e)?l(i,"1"):i,e))+"</span></span>\r\n"},5:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-elev" title="'+a(s(n,"i18n").call(i,"elevation",{name:"i18n",hash:{},data:o,loc:{start:{line:10,column:92},end:{line:10,column:112}}}))+'">'+a(s(n,"i18n").call(i,"ele",{name:"i18n",hash:{},data:o,loc:{start:{line:10,column:114},end:{line:10,column:128}}}))+': <span class="tc-ctl-finfo-coords-val"></span></span><span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-height" title="'+a(s(n,"i18n").call(i,"heightOverTerrain",{name:"i18n",hash:{},data:o,loc:{start:{line:10,column:248},end:{line:10,column:276}}}))+'">'+a(s(n,"i18n").call(i,"height",{name:"i18n",hash:{},data:o,loc:{start:{line:10,column:278},end:{line:10,column:295}}}))+': <span class="tc-ctl-finfo-coords-val"></span></span>'},7:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=s(n,"if").call(a,s(n,"gt").call(a,null!=e?s(e,"featureCount"):e,1,{name:"gt",hash:{},data:o,loc:{start:{line:12,column:58},end:{line:12,column:77}}}),{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.noop,data:o,loc:{start:{line:12,column:52},end:{line:12,column:110}}}))?i:"")+" "},8:function(t,e,n,r,o){return" tc-ctl-finfo-multilayer"},10:function(t,e,n,r,o,i,a){var s,l=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <li>\r\n            <h3>\r\n                <span title="'+(null!=(s=c(n,"if").call(l,null!=e?c(e,"title"):e,{name:"if",hash:{},fn:t.program(11,o,0,i,a),inverse:t.program(13,o,0,i,a),data:o,loc:{start:{line:17,column:29},end:{line:17,column:139}}}))?s:"")+'">\r\n                    '+(null!=(s=c(n,"if").call(l,null!=e?c(e,"title"):e,{name:"if",hash:{},fn:t.program(11,o,0,i,a),inverse:t.program(13,o,0,i,a),data:o,loc:{start:{line:18,column:20},end:{line:18,column:130}}}))?s:"")+'\r\n                </span>\r\n            </h3>\r\n            <div class="tc-ctl-finfo-service-content">\r\n'+(null!=(s=c(n,"each").call(l,null!=e?c(e,"hasLimits"):e,{name:"each",hash:{},fn:t.program(18,o,0,i,a),inverse:t.program(20,o,0,i,a),data:o,loc:{start:{line:22,column:16},end:{line:69,column:25}}}))?s:"")+"            </div>\r\n        </li>\r\n"},11:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(t.lambda(null!=e?i(e,"title"):e,e))},13:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=a(n,"if").call(null!=e?e:t.nullContext||{},null!=(i=null!=(i=null!=e?a(e,"layers"):e)?a(i,"0"):i)?a(i,"title"):i,{name:"if",hash:{},fn:t.program(14,o,0),inverse:t.program(16,o,0),data:o,loc:{start:{line:17,column:59},end:{line:17,column:132}}}))?i:""},14:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(t.lambda(null!=(i=null!=(i=null!=e?a(e,"layers"):e)?a(i,"0"):i)?a(i,"title"):i,e))},16:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(t.lambda(null!=(i=null!=e?a(e,"layer"):e)?a(i,"name"):i,e))},18:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <span class="tc-ctl-finfo-errors">'+t.escapeExpression(t.lambda(null!=e?i(e,"hasLimits"):e,e))+"</span>\r\n"},20:function(t,e,n,r,o,i,a){var s,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                    <ul class="tc-ctl-finfo-layers">\r\n'+(null!=(s=l(n,"each").call(null!=e?e:t.nullContext||{},null!=e?l(e,"layers"):e,{name:"each",hash:{},fn:t.program(21,o,0,i,a),inverse:t.program(45,o,0,i,a),data:o,loc:{start:{line:26,column:24},end:{line:67,column:33}}}))?s:"")+"                    </ul>\r\n"},21:function(t,e,n,r,o,i,a){var s,l=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"                        <li>\r\n                            <h4"+(null!=(s=c(n,"if").call(l,null!=a[2]?c(a[2],"featureCount"):a[2],{name:"if",hash:{},fn:t.program(22,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:28,column:31},end:{line:28,column:138}}}))?s:"")+' title="'+(null!=(s=c(n,"each").call(l,null!=e?c(e,"path"):e,{name:"each",hash:{},fn:t.program(25,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:28,column:146},end:{line:28,column:216}}}))?s:"")+'">\r\n                                <span class="tc-ctl-finfo-layer-n">'+t.escapeExpression(t.lambda(null!=(s=null!=e?c(e,"features"):e)?c(s,"length"):s,e))+"</span> "+(null!=(s=c(n,"each").call(l,null!=e?c(e,"path"):e,{name:"each",hash:{},fn:t.program(25,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:29,column:94},end:{line:29,column:164}}}))?s:"")+'</h4>\r\n                                <div class="tc-ctl-finfo-layer-content">\r\n                                    <ul class="tc-ctl-finfo-features">\r\n'+(null!=(s=c(n,"each").call(l,null!=e?c(e,"features"):e,{name:"each",hash:{},fn:t.program(28,o,0,i,a),inverse:t.program(43,o,0,i,a),data:o,loc:{start:{line:32,column:40},end:{line:61,column:49}}}))?s:"")+"                                    </ul>\r\n                                </div>\r\n</li>\r\n"},22:function(t,e,n,r,o,i,a){var s,l=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(s=c(n,"if").call(l,c(n,"gt").call(l,null!=a[2]?c(a[2],"featureCount"):a[2],1,{name:"gt",hash:{},data:o,loc:{start:{line:28,column:63},end:{line:28,column:88}}}),{name:"if",hash:{},fn:t.program(23,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:28,column:57},end:{line:28,column:130}}}))?s:"")+" "},23:function(t,e,n,r,o){return' class="tc-ctl-finfo-multilayer" '},25:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=a(n,"unless").call(null!=e?e:t.nullContext||{},o&&a(o,"first"),{name:"unless",hash:{},fn:t.program(26,o,0),inverse:t.noop,data:o,loc:{start:{line:28,column:160},end:{line:28,column:199}}}))?i:"")+t.escapeExpression(t.lambda(e,e))},26:function(t,e,n,r,o){return" &rsaquo; "},28:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"                                        <li>\r\n"+(null!=(i=a(n,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"rawContent"):e,{name:"if",hash:{},fn:t.program(29,o,0),inverse:t.program(38,o,0),data:o,loc:{start:{line:34,column:44},end:{line:57,column:51}}}))?i:"")+"                                        </li>\r\n"},29:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"                                            <h5>"+t.escapeExpression(s(n,"i18n").call(a,"feature",{name:"i18n",hash:{},data:o,loc:{start:{line:35,column:48},end:{line:35,column:66}}}))+"</h5>\r\n"+(null!=(i=s(n,"if").call(a,s(n,"eq").call(a,null!=e?s(e,"rawFormat"):e,"text/html",{name:"eq",hash:{},data:o,loc:{start:{line:36,column:50},end:{line:36,column:76}}}),{name:"if",hash:{},fn:t.program(30,o,0),inverse:t.program(36,o,0),data:o,loc:{start:{line:36,column:44},end:{line:49,column:51}}}))?i:"")},30:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=a(n,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"expandUrl"):e,{name:"if",hash:{},fn:t.program(31,o,0),inverse:t.noop,data:o,loc:{start:{line:37,column:44},end:{line:46,column:51}}}))?i:""},31:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"unless").call(a,s(n,"eq").call(a,null!=e?s(e,"expandUrl"):e,"",{name:"eq",hash:{},data:o,loc:{start:{line:38,column:54},end:{line:38,column:71}}}),{name:"unless",hash:{},fn:t.program(32,o,0),inverse:t.program(34,o,0),data:o,loc:{start:{line:38,column:44},end:{line:45,column:55}}}))?i:""},32:function(t,e,n,r,o){var i=t.lambda,a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                                            <div class="tc-ctl-finfo-features-iframe-cnt">\r\n                                                <iframe src="'+a(i(null!=e?s(e,"rawUrl"):e,e))+'"></iframe>\r\n                                                <a class="tc-ctl-finfo-open" onclick="window.open(\''+a(i(null!=e?s(e,"expandUrl"):e,e))+"', '_blank')\" title=\""+a(s(n,"i18n").call(null!=e?e:t.nullContext||{},"expand",{name:"i18n",hash:{},data:o,loc:{start:{line:41,column:133},end:{line:41,column:150}}}))+'"></a>\r\n                                            </div>\r\n'},34:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                                            <iframe src="'+t.escapeExpression(t.lambda(null!=e?i(e,"rawUrl"):e,e))+'"></iframe>\r\n'},36:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"                                            <pre>"+t.escapeExpression(t.lambda(null!=e?i(e,"rawContent"):e,e))+"</pre>\r\n"},38:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=a(n,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"error"):e,{name:"if",hash:{},fn:t.program(39,o,0),inverse:t.program(41,o,0),data:o,loc:{start:{line:51,column:44},end:{line:56,column:51}}}))?i:""},39:function(t,e,n,r,o){var i=t.escapeExpression,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                                            <span class="tc-ctl-finfo-errors">'+i(a(n,"i18n").call(null!=e?e:t.nullContext||{},"fi.error",{name:"i18n",hash:{},data:o,loc:{start:{line:52,column:78},end:{line:52,column:97}}}))+'<span class="tc-ctl-finfo-error-text">'+i(t.lambda(null!=e?a(e,"error"):e,e))+"</span></span>\r\n"},41:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"                                            <h5>"+t.escapeExpression(t.lambda(null!=e?a(e,"id"):e,e))+"</h5>\r\n"+(null!=(i=t.invokePartial(a(r,"tc-ctl-finfo-attr"),e,{name:"tc-ctl-finfo-attr",data:o,indent:"                                            ",helpers:n,partials:r,decorators:t.decorators}))?i:"")},43:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                                        <li class="tc-ctl-finfo-empty">'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"noDataInThisLayer",{name:"i18n",hash:{},data:o,loc:{start:{line:60,column:71},end:{line:60,column:99}}}))+"</li>\r\n"},45:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                            <li class="tc-ctl-finfo-empty">'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"noDataAtThisService",{name:"i18n",hash:{},data:o,loc:{start:{line:66,column:59},end:{line:66,column:89}}}))+"</li>\r\n"},47:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=a(n,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"displayElevation"):e,{name:"if",hash:{},fn:t.program(48,o,0),inverse:t.noop,data:o,loc:{start:{line:73,column:8},end:{line:77,column:15}}}))?i:""},48:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=a(n,"unless").call(null!=e?e:t.nullContext||{},null!=e?a(e,"loading"):e,{name:"unless",hash:{},fn:t.program(49,o,0),inverse:t.noop,data:o,loc:{start:{line:74,column:12},end:{line:76,column:23}}}))?i:""},49:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"                "+(null!=(i=a(n,"unless").call(null!=e?e:t.nullContext||{},null!=e?a(e,"displayElevation"):e,{name:"unless",hash:{},fn:t.program(50,o,0),inverse:t.noop,data:o,loc:{start:{line:75,column:16},end:{line:75,column:108}}}))?i:"")+"\r\n"},50:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li class="tc-ctl-finfo-empty">'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"noData",{name:"i18n",hash:{},data:o,loc:{start:{line:75,column:75},end:{line:75,column:92}}}))+"</li>"},52:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"gt").call(a,null!=e?s(e,"featureCount"):e,1,{name:"gt",hash:{},data:o,loc:{start:{line:82,column:10},end:{line:82,column:29}}}),{name:"if",hash:{},fn:t.program(53,o,0),inverse:t.noop,data:o,loc:{start:{line:82,column:4},end:{line:86,column:11}}}))?i:""},53:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<button type="button" class="tc-ctl-btn tc-ctl-finfo-btn-prev">'+a(s(n,"i18n").call(i,"previous",{name:"i18n",hash:{},data:o,loc:{start:{line:83,column:63},end:{line:83,column:82}}}))+'</button>\r\n<div class="tc-ctl-finfo-counter"><span class="tc-ctl-finfo-counter-current"></span>/'+a(t.lambda(null!=e?s(e,"featureCount"):e,e))+'</div>\r\n<button type="button" class="tc-ctl-btn tc-ctl-finfo-btn-next">'+a(s(n,"i18n").call(i,"next",{name:"i18n",hash:{},data:o,loc:{start:{line:85,column:63},end:{line:85,column:78}}}))+"</button>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o,i,a){var s,l=null!=e?e:t.nullContext||{},c=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-finfo-coords">\r\n    <span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-crs" title="'+c(u(n,"i18n").call(l,"crs",{name:"i18n",hash:{},data:o,loc:{start:{line:2,column:74},end:{line:2,column:88}}}))+'">CRS: <span class="tc-ctl-finfo-coords-val">'+c(t.lambda(null!=e?u(e,"crs"):e,e))+"</span></span>\r\n"+(null!=(s=u(n,"if").call(l,null!=e?u(e,"isGeo"):e,{name:"if",hash:{},fn:t.program(1,o,0,i,a),inverse:t.program(3,o,0,i,a),data:o,loc:{start:{line:3,column:4},end:{line:9,column:11}}}))?s:"")+"    "+(null!=(s=u(n,"if").call(l,null!=e?u(e,"displayElevation"):e,{name:"if",hash:{},fn:t.program(5,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:10,column:4},end:{line:10,column:356}}}))?s:"")+'\r\n</div>\r\n<div class="tc-ctl-finfo-result '+(null!=(s=u(n,"if").call(l,null!=e?u(e,"featureCount"):e,{name:"if",hash:{},fn:t.program(7,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:12,column:32},end:{line:12,column:118}}}))?s:"")+'">\r\n    <ul class="tc-ctl-finfo-services">\r\n'+(null!=(s=u(n,"each").call(l,null!=e?u(e,"services"):e,{name:"each",hash:{},fn:t.program(10,o,0,i,a),inverse:t.program(47,o,0,i,a),data:o,loc:{start:{line:14,column:8},end:{line:78,column:17}}}))?s:"")+"    </ul>\r\n</div>\r\n"+(null!=(s=u(n,"if").call(l,null!=e?u(e,"featureCount"):e,{name:"if",hash:{},fn:t.program(52,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:81,column:0},end:{line:87,column:7}}}))?s:"")},usePartial:!0,useData:!0,useDepths:!0},t.template[t.CLASS+"-attr"]={1:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=a(n,"each").call(null!=e?e:t.nullContext||{},null!=e?a(e,"attributes"):e,{name:"each",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:4},end:{line:6,column:13}}}))?i:""},2:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"getHeader").call(a,null!=e?s(e,"name"):e,{name:"getHeader",hash:{},data:o,loc:{start:{line:3,column:14},end:{line:3,column:30}}}),{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:8},end:{line:5,column:15}}}))?i:""},3:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<"+a(s(n,"getHeader").call(i,null!=e?s(e,"name"):e,{name:"getHeader",hash:{},data:o,loc:{start:{line:4,column:1},end:{line:4,column:19}}}))+">"+a(t.lambda(null!=e?s(e,"value"):e,e))+"</"+a(s(n,"getHeader").call(i,null!=e?s(e,"name"):e,{name:"getHeader",hash:{},data:o,loc:{start:{line:4,column:31},end:{line:4,column:49}}}))+">\r\n"},5:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"unless").call(a,s(n,"getHeader").call(a,null!=e?s(e,"name"):e,{name:"getHeader",hash:{},data:o,loc:{start:{line:11,column:14},end:{line:11,column:30}}}),{name:"unless",hash:{},fn:t.program(6,o,0),inverse:t.noop,data:o,loc:{start:{line:11,column:4},end:{line:60,column:15}}}))?i:""},6:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"isVideoAttribute").call(a,null!=e?s(e,"name"):e,null!=e?s(e,"value"):e,{name:"isVideoAttribute",hash:{},data:o,loc:{start:{line:12,column:14},end:{line:12,column:43}}}),{name:"if",hash:{},fn:t.program(7,o,0),inverse:t.program(9,o,0),data:o,loc:{start:{line:12,column:8},end:{line:59,column:15}}}))?i:""},7:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <tr>\r\n            <th class="tc-ctl-finfo-attr" colspan="2">'+t.escapeExpression(a(n,"removeSpecialAttributeTag").call(null!=e?e:t.nullContext||{},null!=e?a(e,"name"):e,{name:"removeSpecialAttributeTag",hash:{},data:o,loc:{start:{line:14,column:54},end:{line:14,column:88}}}))+'</th>\r\n        </tr>\r\n        <tr>\r\n            <td class="tc-ctl-finfo-val tc-video-attr" colspan="2">\r\n'+(null!=(i=t.invokePartial(a(r,"tc-ctl-finfo-attr-video"),e,{name:"tc-ctl-finfo-attr-video",hash:{value:null!=e?a(e,"value"):e,name:null!=e?a(e,"name"):e},data:o,indent:"                ",helpers:n,partials:r,decorators:t.decorators}))?i:"")+"            </td>\r\n        </tr>                                                            \r\n"},9:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"isImageAttribute").call(a,null!=e?s(e,"name"):e,null!=e?s(e,"value"):e,{name:"isImageAttribute",hash:{},data:o,loc:{start:{line:22,column:18},end:{line:22,column:47}}}),{name:"if",hash:{},fn:t.program(10,o,0),inverse:t.program(12,o,0),data:o,loc:{start:{line:22,column:12},end:{line:58,column:19}}}))?i:""},10:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <tr>\r\n            <th class="tc-ctl-finfo-attr" colspan="2">'+t.escapeExpression(a(n,"removeSpecialAttributeTag").call(null!=e?e:t.nullContext||{},null!=e?a(e,"name"):e,{name:"removeSpecialAttributeTag",hash:{},data:o,loc:{start:{line:24,column:54},end:{line:24,column:88}}}))+'</th>\r\n        </tr>\r\n        <tr>\r\n            <td class="tc-ctl-finfo-val tc-img-attr" colspan="2">\r\n'+(null!=(i=t.invokePartial(a(r,"tc-ctl-finfo-attr-image"),e,{name:"tc-ctl-finfo-attr-image",hash:{value:null!=e?a(e,"value"):e,name:null!=e?a(e,"name"):e},data:o,indent:"                ",helpers:n,partials:r,decorators:t.decorators}))?i:"")+"            </td>\r\n        </tr>                                                            \r\n"},12:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"isAudioAttribute").call(a,null!=e?s(e,"name"):e,null!=e?s(e,"value"):e,{name:"isAudioAttribute",hash:{},data:o,loc:{start:{line:32,column:22},end:{line:32,column:51}}}),{name:"if",hash:{},fn:t.program(13,o,0),inverse:t.program(15,o,0),data:o,loc:{start:{line:32,column:16},end:{line:57,column:23}}}))?i:""},13:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <tr>\r\n            <th class="tc-ctl-finfo-attr" colspan="2">'+t.escapeExpression(a(n,"removeSpecialAttributeTag").call(null!=e?e:t.nullContext||{},null!=e?a(e,"name"):e,{name:"removeSpecialAttributeTag",hash:{},data:o,loc:{start:{line:34,column:54},end:{line:34,column:88}}}))+'</th>\r\n        </tr>\r\n        <tr>\r\n            <td class="tc-ctl-finfo-val tc-audio-attr" colspan="2">\r\n'+(null!=(i=t.invokePartial(a(r,"tc-ctl-finfo-attr-audio"),e,{name:"tc-ctl-finfo-attr-audio",hash:{value:null!=e?a(e,"value"):e,name:null!=e?a(e,"name"):e},data:o,indent:"                    ",helpers:n,partials:r,decorators:t.decorators}))?i:"")+"            </td>\r\n        </tr>                                                            \r\n"},15:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"isEmbedAttribute").call(a,null!=e?s(e,"name"):e,null!=e?s(e,"value"):e,{name:"isEmbedAttribute",hash:{},data:o,loc:{start:{line:42,column:26},end:{line:42,column:55}}}),{name:"if",hash:{},fn:t.program(16,o,0),inverse:t.program(18,o,0),data:o,loc:{start:{line:42,column:20},end:{line:56,column:27}}}))?i:""},16:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <tr>\r\n            <th class="tc-ctl-finfo-attr" colspan="2">'+t.escapeExpression(a(n,"removeSpecialAttributeTag").call(null!=e?e:t.nullContext||{},null!=e?a(e,"name"):e,{name:"removeSpecialAttributeTag",hash:{},data:o,loc:{start:{line:44,column:54},end:{line:44,column:88}}}))+'</th>\r\n        </tr>\r\n        <tr>\r\n            <td class="tc-ctl-finfo-val tc-embed-attr" colspan="2">\r\n'+(null!=(i=t.invokePartial(a(r,"tc-ctl-finfo-attr-embed"),e,{name:"tc-ctl-finfo-attr-embed",hash:{value:null!=e?a(e,"value"):e,name:null!=e?a(e,"name"):e},data:o,indent:"                        ",helpers:n,partials:r,decorators:t.decorators}))?i:"")+"            </td>\r\n        </tr>                                                            \r\n"},18:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <tr>\r\n            <th class="tc-ctl-finfo-attr">'+t.escapeExpression(t.lambda(null!=e?s(e,"name"):e,e))+'</th>\r\n            <td class="tc-ctl-finfo-val">'+(null!=(i=s(n,"unless").call(a,s(n,"eq").call(a,null!=e?s(e,"value"):e,null,{name:"eq",hash:{},data:o,loc:{start:{line:54,column:51},end:{line:54,column:66}}}),{name:"unless",hash:{},fn:t.program(19,o,0),inverse:t.noop,data:o,loc:{start:{line:54,column:41},end:{line:54,column:111}}}))?i:"")+"</td>                                                               \r\n        </tr>\r\n"},19:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-finfo-object"),null!=e?a(e,"value"):e,{name:"tc-ctl-finfo-object",data:o,helpers:n,partials:r,decorators:t.decorators}))?i:""},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=s(n,"if").call(a,null!=e?s(e,"singleFeature"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:0},end:{line:7,column:7}}}))?i:"")+'<table class="tc-attr">\r\n    <tbody>\r\n'+(null!=(i=s(n,"each").call(a,null!=e?s(e,"attributes"):e,{name:"each",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:10,column:0},end:{line:61,column:9}}}))?i:"")+"    </tbody>\r\n</table>"},usePartial:!0,useData:!0},t.template[t.CLASS+"-object"]={1:function(t,e,n,r,o){var i;return'<table class="complexAttr">\r\n    <tbody>\r\n'+(null!=(i=(t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]})(n,"each").call(null!=e?e:t.nullContext||{},e,{name:"each",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:4,column:4},end:{line:41,column:13}}}))?i:"")+"    </tbody>\r\n</table>\r\n"},2:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"unless").call(a,s(n,"isObject").call(a,e,{name:"isObject",hash:{},data:o,loc:{start:{line:5,column:18},end:{line:5,column:33}}}),{name:"unless",hash:{},fn:t.program(3,o,0),inverse:t.program(10,o,0),data:o,loc:{start:{line:5,column:8},end:{line:40,column:19}}}))?i:""},3:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <tr class="keyValue">\r\n'+(null!=(i=s(n,"if").call(a,s(n,"eq").call(a,o&&s(o,"key"),"_content_",{name:"eq",hash:{},data:o,loc:{start:{line:7,column:18},end:{line:7,column:39}}}),{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.program(7,o,0),data:o,loc:{start:{line:7,column:12},end:{line:14,column:19}}}))?i:"")+"        </tr>\r\n"},4:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"unless").call(a,s(n,"isEmpty").call(a,e,{name:"isEmpty",hash:{},data:o,loc:{start:{line:8,column:26},end:{line:8,column:40}}}),{name:"unless",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:8,column:16},end:{line:10,column:27}}}))?i:""},5:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                    <td colspan="2" class="value tc-ctl-finfo-val">'+(null!=(i=t.invokePartial(a(r,"tc-ctl-finfo-object"),e,{name:"tc-ctl-finfo-object",data:o,helpers:n,partials:r,decorators:t.decorators}))?i:"")+"</td>\r\n"},7:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <th class="key">'+t.escapeExpression(t.lambda(o&&s(o,"key"),e))+'</th>\r\n                <td class="value tc-ctl-finfo-val">'+(null!=(i=s(n,"unless").call(a,s(n,"isEmpty").call(a,e,{name:"isEmpty",hash:{},data:o,loc:{start:{line:13,column:61},end:{line:13,column:75}}}),{name:"unless",hash:{},fn:t.program(8,o,0),inverse:t.noop,data:o,loc:{start:{line:13,column:51},end:{line:13,column:119}}}))?i:"")+"</td>\r\n"},8:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-finfo-object"),e,{name:"tc-ctl-finfo-object",data:o,helpers:n,partials:r,decorators:t.decorators}))?i:""},10:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <tr>\r\n            <th style="display:none">'+t.escapeExpression(t.lambda(o&&s(o,"key"),e))+"</th>\r\n            <td>\r\n"+(null!=(i=s(n,"if").call(a,s(n,"isObject").call(a,e,{name:"isObject",hash:{},data:o,loc:{start:{line:20,column:22},end:{line:20,column:37}}}),{name:"if",hash:{},fn:t.program(11,o,0),inverse:t.program(13,o,0),data:o,loc:{start:{line:20,column:16},end:{line:35,column:23}}}))?i:"")+(null!=(i=t.invokePartial(s(r,"tc-ctl-finfo-object"),e,{name:"tc-ctl-finfo-object",data:o,indent:"                    ",helpers:n,partials:r,decorators:t.decorators}))?i:"")+"                </div>\r\n            </td>\r\n        </tr>\r\n"},11:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                \x3c!--object--\x3e\r\n                <input type="checkbox" id="complexAttr_'+a(s(n,"getId").call(i,e,{name:"getId",hash:{},data:o,loc:{start:{line:22,column:55},end:{line:22,column:69}}}))+'">\r\n                <div>\r\n                    <label for="complexAttr_'+a(s(n,"getId").call(i,e,{name:"getId",hash:{},data:o,loc:{start:{line:24,column:44},end:{line:24,column:58}}}))+'" class="plus" title=""></label>\r\n                    <label for="complexAttr_'+a(s(n,"getId").call(i,e,{name:"getId",hash:{},data:o,loc:{start:{line:25,column:44},end:{line:25,column:58}}}))+'" class="title" title="">'+a(t.lambda(o&&s(o,"key"),e))+"</label><br />\r\n"},13:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=s(n,"if").call(a,s(n,"isArray").call(a,e,{name:"isArray",hash:{},data:o,loc:{start:{line:27,column:26},end:{line:27,column:40}}}),{name:"if",hash:{},fn:t.program(14,o,0),inverse:t.program(16,o,0),data:o,loc:{start:{line:27,column:20},end:{line:33,column:27}}}))?i:"")+"                    \x3c!--native--\x3e\r\n"},14:function(t,e,n,r,o){var i=t.escapeExpression,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                \x3c!--array--\x3e\r\n                <div>\r\n                    <label for="complexAttr_'+i(a(n,"getId").call(null!=e?e:t.nullContext||{},e,{name:"getId",hash:{},data:o,loc:{start:{line:30,column:44},end:{line:30,column:58}}}))+'" class="title" title="">'+i(t.lambda(o&&a(o,"key"),e))+"</label><br />\r\n"},16:function(t,e,n,r,o){return"                <div>\r\n"},18:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"isArray").call(a,e,{name:"isArray",hash:{},data:o,loc:{start:{line:45,column:10},end:{line:45,column:24}}}),{name:"if",hash:{},fn:t.program(19,o,0),inverse:t.program(22,o,0),data:o,loc:{start:{line:45,column:4},end:{line:68,column:11}}}))?i:""},19:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="complexAttr">\r\n    <input type="checkbox" id="complexAttr_'+s(l(n,"getId").call(a,e,{name:"getId",hash:{},data:o,loc:{start:{line:47,column:43},end:{line:47,column:57}}}))+'">\r\n    <div>\r\n        <label for="complexAttr_'+s(l(n,"getId").call(a,e,{name:"getId",hash:{},data:o,loc:{start:{line:49,column:32},end:{line:49,column:46}}}))+'" class="plus" title=""></label>\r\n        <label for="complexAttr_'+s(l(n,"getId").call(a,e,{name:"getId",hash:{},data:o,loc:{start:{line:50,column:32},end:{line:50,column:46}}}))+'" class="title" title="">'+s(t.lambda(null!=e?l(e,"length"):e,e))+" "+s(l(n,"i18n").call(a,"featureInfo.complexData.array",{name:"i18n",hash:{},data:o,loc:{start:{line:50,column:82},end:{line:50,column:122}}}))+'</label><br />\r\n        <table class="complexAttr">\r\n            <tbody>\r\n'+(null!=(i=l(n,"each").call(a,e,{name:"each",hash:{},fn:t.program(20,o,0),inverse:t.noop,data:o,loc:{start:{line:53,column:16},end:{line:57,column:25}}}))?i:"")+"            </tbody>\r\n        </table>\r\n    </div>\r\n</div>\r\n"},20:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"                <tr>\r\n                    <td>"+(null!=(i=t.invokePartial(a(r,"tc-ctl-finfo-object"),e,{name:"tc-ctl-finfo-object",data:o,helpers:n,partials:r,decorators:t.decorators}))?i:"")+"</td>\r\n                </tr>\r\n"},22:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"isUrl").call(a,e,{name:"isUrl",hash:{},data:o,loc:{start:{line:63,column:14},end:{line:63,column:26}}}),{name:"if",hash:{},fn:t.program(23,o,0),inverse:t.program(25,o,0),data:o,loc:{start:{line:63,column:8},end:{line:67,column:15}}}))?i:""},23:function(t,e,n,r,o){var i=t.escapeExpression,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<a href="'+i(t.lambda(e,e))+'" target="_blank" title="'+i(s(n,"i18n").call(a,"linkInNewWindow",{name:"i18n",hash:{},data:o,loc:{start:{line:64,column:42},end:{line:64,column:68}}}))+'">'+i(s(n,"i18n").call(a,"open",{name:"i18n",hash:{},data:o,loc:{start:{line:64,column:70},end:{line:64,column:85}}}))+"</a>\r\n"},25:function(t,e,n,r,o){var i;return(null!=(i=(t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]})(n,"formatDateOrNumber").call(null!=e?e:t.nullContext||{},e,{name:"formatDateOrNumber",hash:{},data:o,loc:{start:{line:66,column:0},end:{line:66,column:30}}}))?i:"")+"\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"isObject").call(a,e,{name:"isObject",hash:{},data:o,loc:{start:{line:1,column:6},end:{line:1,column:21}}}),{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(18,o,0),data:o,loc:{start:{line:1,column:0},end:{line:69,column:7}}}))?i:""},usePartial:!0,useData:!0},t.template[t.CLASS+"-buttons"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-finfo-btn">\r\n    <input type="checkbox" class="tc-toggle tc-ctl-finfo-btn-show-all" title="'+a(s(n,"i18n").call(i,"showOnMapAllResults",{name:"i18n",hash:{},data:o,loc:{start:{line:2,column:78},end:{line:2,column:108}}}))+'" />\r\n    <button type="button" class="tc-icon-btn tc-ctl-finfo-btn-zoom-all tc-hidden" title="'+a(s(n,"i18n").call(i,"zoomToAllResults",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:89},end:{line:3,column:116}}}))+'">'+a(s(n,"i18n").call(i,"zoomToAllResults",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:118},end:{line:3,column:145}}}))+'</button>\r\n    <button type="button" class="tc-icon-btn tc-ctl-finfo-btn-del-all tc-hidden" title="'+a(s(n,"i18n").call(i,"removeAllResults",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:88},end:{line:4,column:115}}}))+'">'+a(s(n,"i18n").call(i,"removeAllResults",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:117},end:{line:4,column:144}}}))+'</button>\r\n    <button type="button" class="tc-icon-btn tc-ctl-finfo-btn-dl" title="'+a(s(n,"i18n").call(i,"downloadAllResults",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:73},end:{line:5,column:102}}}))+'">'+a(s(n,"i18n").call(i,"downloadAllResults",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:104},end:{line:5,column:133}}}))+"</button>\r\n</div>"},useData:!0},t.template[t.CLASS+"-dialog"]={1:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<img src="'+t.escapeExpression(t.lambda(null!=e?i(e,"src"):e,e))+'" />'},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-finfo-dialog tc-ctl-finfo-img-dialog tc-modal tc-hidden">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-img">'+(null!=(i=l(n,"if").call(a,null!=e?l(e,"src"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:30},end:{line:3,column:69}}}))?i:"")+'</div>\r\n</div>\r\n<div class="tc-ctl-finfo-dialog tc-ctl-finfo-share-dialog tc-modal tc-hidden">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+s(l(n,"i18n").call(a,"shareQuery",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:16},end:{line:9,column:37}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <div class="tc-ctl-finfo-share-dialog-ctl"></div>\r\n        </div>\r\n        <div class="tc-modal-footer">\r\n            <button type="button" class="tc-button tc-modal-close">'+s(l(n,"i18n").call(a,"close",{name:"i18n",hash:{},data:o,loc:{start:{line:16,column:67},end:{line:16,column:83}}}))+"</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},useData:!0},t.template[t.CLASS+"-attr-val"]={1:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-finfo-attr-video"),e,{name:"tc-ctl-finfo-attr-video",hash:{value:null!=e?a(e,"value"):e,name:null!=e?a(e,"name"):e},data:o,indent:"    ",helpers:n,partials:r,decorators:t.decorators}))?i:""},3:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"isImageAttribute").call(a,null!=e?s(e,"name"):e,null!=e?s(e,"value"):e,{name:"isImageAttribute",hash:{},data:o,loc:{start:{line:4,column:10},end:{line:4,column:39}}}),{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.program(6,o,0),data:o,loc:{start:{line:4,column:4},end:{line:16,column:11}}}))?i:""},4:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-finfo-attr-image"),e,{name:"tc-ctl-finfo-attr-image",hash:{value:null!=e?a(e,"value"):e,name:null!=e?a(e,"name"):e},data:o,indent:"        ",helpers:n,partials:r,decorators:t.decorators}))?i:""},6:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"isAudioAttribute").call(a,null!=e?s(e,"name"):e,null!=e?s(e,"value"):e,{name:"isAudioAttribute",hash:{},data:o,loc:{start:{line:7,column:14},end:{line:7,column:43}}}),{name:"if",hash:{},fn:t.program(7,o,0),inverse:t.program(9,o,0),data:o,loc:{start:{line:7,column:8},end:{line:15,column:15}}}))?i:""},7:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-finfo-attr-audio"),e,{name:"tc-ctl-finfo-attr-audio",hash:{value:null!=e?a(e,"value"):e,name:null!=e?a(e,"name"):e},data:o,indent:"            ",helpers:n,partials:r,decorators:t.decorators}))?i:""},9:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"isEmbedAttribute").call(a,null!=e?s(e,"name"):e,null!=e?s(e,"value"):e,{name:"isEmbedAttribute",hash:{},data:o,loc:{start:{line:10,column:18},end:{line:10,column:47}}}),{name:"if",hash:{},fn:t.program(10,o,0),inverse:t.program(12,o,0),data:o,loc:{start:{line:10,column:12},end:{line:14,column:19}}}))?i:""},10:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-finfo-attr-embed"),e,{name:"tc-ctl-finfo-attr-embed",hash:{value:null!=e?a(e,"value"):e,name:null!=e?a(e,"name"):e},data:o,indent:"                ",helpers:n,partials:r,decorators:t.decorators}))?i:""},12:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"                "+(null!=(i=s(n,"unless").call(a,s(n,"eq").call(a,null!=e?s(e,"value"):e,null,{name:"eq",hash:{},data:o,loc:{start:{line:13,column:26},end:{line:13,column:41}}}),{name:"unless",hash:{},fn:t.program(13,o,0),inverse:t.noop,data:o,loc:{start:{line:13,column:16},end:{line:13,column:86}}}))?i:"")+"\r\n"},13:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-finfo-object"),null!=e?a(e,"value"):e,{name:"tc-ctl-finfo-object",data:o,helpers:n,partials:r,decorators:t.decorators}))?i:""},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"isVideoAttribute").call(a,null!=e?s(e,"name"):e,null!=e?s(e,"value"):e,{name:"isVideoAttribute",hash:{},data:o,loc:{start:{line:1,column:6},end:{line:1,column:35}}}),{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(3,o,0),data:o,loc:{start:{line:1,column:0},end:{line:17,column:7}}}))?i:""},usePartial:!0,useData:!0},t.template[t.CLASS+"-attr-video"]={1:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <iframe src="https://www.youtube.com/embed/'+s(l(n,"getYoutubeId").call(a,l(n,"removeSpecialAttributeTag").call(a,null!=e?l(e,"value"):e,{name:"removeSpecialAttributeTag",hash:{},data:o,loc:{start:{line:2,column:62},end:{line:2,column:95}}}),{name:"getYoutubeId",hash:{},data:o,loc:{start:{line:2,column:47},end:{line:2,column:97}}}))+'" class="tc-video-attr" style="width:'+s(l(n,"getTagWidth").call(a,null!=e?l(e,"name"):e,null!=e?l(e,"value"):e,{name:"getTagWidth",hash:{},data:o,loc:{start:{line:2,column:134},end:{line:2,column:160}}}))+";height:"+s(l(n,"getTagHeight").call(a,null!=e?l(e,"name"):e,null!=e?l(e,"value"):e,{name:"getTagHeight",hash:{},data:o,loc:{start:{line:2,column:168},end:{line:2,column:195}}}))+";"+(null!=(i=l(n,"unless").call(a,l(n,"eq").call(a,l(n,"getTagHeight").call(a,null!=e?l(e,"name"):e,null!=e?l(e,"value"):e,{name:"getTagHeight",hash:{},data:o,loc:{start:{line:2,column:210},end:{line:2,column:235}}}),"auto",{name:"eq",hash:{},data:o,loc:{start:{line:2,column:206},end:{line:2,column:243}}}),{name:"unless",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:196},end:{line:2,column:272}}}))?i:"")+'" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>\r\n'},2:function(t,e,n,r,o){return"max-height:none;"},4:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <video src="'+s(l(n,"removeSpecialAttributeTag").call(a,null!=e?l(e,"value"):e,{name:"removeSpecialAttributeTag",hash:{},data:o,loc:{start:{line:4,column:16},end:{line:4,column:51}}}))+'" class="tc-video-attr" style="width:'+s(l(n,"getTagWidth").call(a,null!=e?l(e,"name"):e,null!=e?l(e,"value"):e,{name:"getTagWidth",hash:{},data:o,loc:{start:{line:4,column:88},end:{line:4,column:114}}}))+";height:"+s(l(n,"getTagHeight").call(a,null!=e?l(e,"name"):e,null!=e?l(e,"value"):e,{name:"getTagHeight",hash:{},data:o,loc:{start:{line:4,column:122},end:{line:4,column:149}}}))+";"+(null!=(i=l(n,"unless").call(a,l(n,"eq").call(a,l(n,"getTagHeight").call(a,null!=e?l(e,"name"):e,null!=e?l(e,"value"):e,{name:"getTagHeight",hash:{},data:o,loc:{start:{line:4,column:164},end:{line:4,column:189}}}),"auto",{name:"eq",hash:{},data:o,loc:{start:{line:4,column:160},end:{line:4,column:197}}}),{name:"unless",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:4,column:150},end:{line:4,column:226}}}))?i:"")+'" controls crossorigin="anonymous" playsinline="true" title="">'+s(l(n,"i18n").call(a,"videoFormatNotCompatible",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:289},end:{line:4,column:324}}}))+"</video>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"getYoutubeId").call(a,s(n,"removeSpecialAttributeTag").call(a,null!=e?s(e,"value"):e,{name:"removeSpecialAttributeTag",hash:{},data:o,loc:{start:{line:1,column:20},end:{line:1,column:53}}}),{name:"getYoutubeId",hash:{},data:o,loc:{start:{line:1,column:6},end:{line:1,column:54}}}),{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(4,o,0),data:o,loc:{start:{line:1,column:0},end:{line:5,column:7}}}))?i:""},useData:!0},t.template[t.CLASS+"-attr-image"]={1:function(t,e,n,r,o){return"max-height:none;"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<img src="'+s(l(n,"removeSpecialAttributeTag").call(a,null!=e?l(e,"value"):e,{name:"removeSpecialAttributeTag",hash:{},data:o,loc:{start:{line:1,column:10},end:{line:1,column:45}}}))+'" class="tc-img-attr" style="width:'+s(l(n,"getTagWidth").call(a,null!=e?l(e,"name"):e,null!=e?l(e,"value"):e,{name:"getTagWidth",hash:{},data:o,loc:{start:{line:1,column:80},end:{line:1,column:106}}}))+";height:"+s(l(n,"getTagHeight").call(a,null!=e?l(e,"name"):e,null!=e?l(e,"value"):e,{name:"getTagHeight",hash:{},data:o,loc:{start:{line:1,column:114},end:{line:1,column:141}}}))+";"+(null!=(i=l(n,"unless").call(a,l(n,"eq").call(a,l(n,"getTagHeight").call(a,null!=e?l(e,"name"):e,null!=e?l(e,"value"):e,{name:"getTagHeight",hash:{},data:o,loc:{start:{line:1,column:156},end:{line:1,column:181}}}),"auto",{name:"eq",hash:{},data:o,loc:{start:{line:1,column:152},end:{line:1,column:189}}}),{name:"unless",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:142},end:{line:1,column:218}}}))?i:"")+'" title="'+s(l(n,"i18n").call(a,"viewEnlargedImage",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:227},end:{line:1,column:255}}}))+'" />'},useData:!0},t.template[t.CLASS+"-attr-audio"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<audio src="'+a(s(n,"removeSpecialAttributeTag").call(i,null!=e?s(e,"value"):e,{name:"removeSpecialAttributeTag",hash:{},data:o,loc:{start:{line:1,column:12},end:{line:1,column:47}}}))+'" class="tc-audio-attr" controls crossorigin="anonymous" title="">'+a(s(n,"i18n").call(i,"audioFormatNotCompatible",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:113},end:{line:1,column:148}}}))+"</audio>"},useData:!0},t.template[t.CLASS+"-attr-embed"]={1:function(t,e,n,r,o){return"max-height:none"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div><a href="'+s(l(n,"removeSpecialAttributeTag").call(a,null!=e?l(e,"value"):e,{name:"removeSpecialAttributeTag",hash:{},data:o,loc:{start:{line:1,column:14},end:{line:1,column:49}}}))+'" class="tc-embed-attr" target="_blank" title="'+s(l(n,"i18n").call(a,"linkInNewWindow",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:96},end:{line:1,column:122}}}))+'">'+s(l(n,"i18n").call(a,"openInNewTab",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:124},end:{line:1,column:147}}}))+'</a></div>\r\n<iframe src="'+s(l(n,"removeSpecialAttributeTag").call(a,null!=e?l(e,"value"):e,{name:"removeSpecialAttributeTag",hash:{},data:o,loc:{start:{line:2,column:13},end:{line:2,column:48}}}))+'" class="tc-embed-attr" style="width:'+s(l(n,"getTagWidth").call(a,null!=e?l(e,"name"):e,null!=e?l(e,"value"):e,{name:"getTagWidth",hash:{},data:o,loc:{start:{line:2,column:85},end:{line:2,column:111}}}))+";height:"+s(l(n,"getTagHeight").call(a,null!=e?l(e,"name"):e,null!=e?l(e,"value"):e,{name:"getTagHeight",hash:{},data:o,loc:{start:{line:2,column:119},end:{line:2,column:146}}}))+";"+(null!=(i=l(n,"unless").call(a,l(n,"eq").call(a,l(n,"getTagHeight").call(a,null!=e?l(e,"name"):e,null!=e?l(e,"value"):e,{name:"getTagHeight",hash:{},data:o,loc:{start:{line:2,column:161},end:{line:2,column:186}}}),"auto",{name:"eq",hash:{},data:o,loc:{start:{line:2,column:157},end:{line:2,column:194}}}),{name:"unless",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:147},end:{line:2,column:222}}}))?i:"")+';" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>'},useData:!0};const e=function(){const t=this,e=t.getMenuTarget(),n=e.querySelector(t._selectors.SHOW_ALL_CHECKBOX);if(n){n.checked=!0;const e=t.getLocaleString("doNotShowOnMapAllResults");n.innerHTML=e,n.setAttribute("title",e)}e.querySelector(t._selectors.ZOOM_ALL_BUTTON).classList.remove(r.Z.Consts.classes.HIDDEN),e.querySelector(t._selectors.DEL_ALL_BUTTON).classList.remove(r.Z.Consts.classes.HIDDEN)},n=function(){const t=this,e=t.getMenuTarget(),n=e.querySelector(t._selectors.SHOW_ALL_CHECKBOX);if(n){n.checked=!1;const o=t.getLocaleString("showOnMapAllResults");n.innerHTML=o,n.setAttribute("title",o),e.querySelector(t._selectors.ZOOM_ALL_BUTTON).classList.add(r.Z.Consts.classes.HIDDEN),e.querySelector(t._selectors.DEL_ALL_BUTTON).classList.add(r.Z.Consts.classes.HIDDEN)}};t.register=async function(t){const e=this,n=r.Z.control.Click.prototype.register.call(e,t);return e._createLayers(),t.loaded((function(){const n=t.getControlsByClass("TC.control.Share")[0];n&&e.loadSharedFeature(n.loadParamFeature()),e.setDisplayMode(e.options.displayMode||t.defaultInfoContainer||r.Z.Consts.infoContainer.POPUP)})),t.on(r.Z.Consts.event.POPUPHIDE+" "+r.Z.Consts.event.RESULTSPANELCLOSE,(function(t){t.control===e.getDisplayControl()&&e.resultsLayer&&(e.highlightedFeature&&!e.options.persistentHighlights&&(e.downplayFeature(e.highlightedFeature),e.highlightedFeature=null),!e.querying&&t.feature&&e.filterLayer.removeFeature(t.feature))})).on(r.Z.Consts.event.POPUP+" "+r.Z.Consts.event.DRAWTABLE+" "+r.Z.Consts.event.DRAWCHART,(function(t){const n=t.control;n.currentFeature!==e.filterFeature&&(e.highlightedFeature=n.currentFeature),t.control.caller===e&&e._decorateDisplay(n)})).on(r.Z.Consts.event.DRAWCHART,(function(t){setTimeout((function(){e.highlightedFeature=t.control.currentFeature}),50)})).on(r.Z.Consts.event.LAYERREMOVE,(function(){if(Object.keys(e._infoHistory).length){const t={};e.map.workLayers.filter((function(t){return t.type===r.Z.Consts.layerType.WMS})).forEach((function(e){const n=t[e.url]||[];t[e.url]=n.concat(e.getDisgregatedLayerNames())}));let n=!1;for(let r in e._infoHistory){const o=e._infoHistory[r];if(Object.prototype.hasOwnProperty.call(t,r)){const i=t[r];for(let t in o){const r=o[t];i.indexOf(t)<0&&(r.slice().forEach((t=>e.downplayFeature(t))),r.length=0,n=!0)}}else{for(let t in o){o[t].slice().forEach((t=>e.downplayFeature(t))),n=!0}delete e._infoHistory[r]}}n&&e.closeResults()}})).on(r.Z.Consts.event.FEATUREREMOVE,(function(t){if(t.layer===e.resultsLayer)for(let n in e._infoHistory){const r=e._infoHistory[n];for(let e in r){const n=r[e];r[e]=n.filter((e=>e!==t.feature))}}})).on(r.Z.Consts.event.FEATURESCLEAR,(function(t){t.layer===e.resultsLayer&&(e._infoHistory={})})).on(r.Z.Consts.event.VIEWCHANGE,(function(t){e.closeResults()})),await n,e.options.share&&await e.getShareDialog(),e},t.render=function(){const t=this;return t.div.classList.add(r.Z.Consts.classes.HIDDEN),t._set1stRenderPromise(t.getRenderedHtml(t.CLASS+"-dialog",{checkboxId:t.getUID(),elevation:t.options.displayElevation},(function(e){t._dialogDiv.innerHTML=e})))},t.responseCallback=function(t){const e=this;if(e.querying=!1,e.filterFeature&&(e.info={services:t.services},e.options.persistentHighlights))for(let t in e._infoHistory){const n=(e.info.services||[]).find((e=>e.url===t));if(n){const r=e._infoHistory[t];for(let t in r){const e=n.layers.filter((e=>e.name===t))[0];if(e){r[t].forEach((function(t){const n=t.wrap.getId(),r=e.features.findIndex((t=>t.wrap.getId()===n));-1!==r&&e.features.splice(r,1)}))}}}}t.featureCount?(e._addSourceAttributes(),e.lastFeatureCount=t.featureCount,e.map.trigger(r.Z.Consts.event.FEATUREINFO,r.Z.Util.extend({control:e},t))):(e.lastFeatureCount=0,e.map.trigger(r.Z.Consts.event.NOFEATUREINFO,{control:e}))},t.responseError=function(t){const e=this;404===t.status&&e.map.toast(e.getLocaleString("featureInfo.tooManyLayers"),{type:r.Z.Consts.msgType.ERROR}),e.responseCallback({})},t.markerStyle={cssClass:r.Z.Consts.classes.POINT,anchor:[.5,.5],width:15,height:15,noPrint:!0},t.setDisplayMode=async function(t){const e=this;if(e.displayMode=t,t===r.Z.Consts.infoContainer.RESULTS_PANEL)await e.getResultsPanel();else e.displayMode=r.Z.Consts.infoContainer.POPUP,await e.getPopup()},t.getPopup=async function(){const t=this;return t.popup||(t.popup=await t.map.addControl("popup",{closeButton:!0,draggable:t.options.draggable,share:t.options.share}),t.popup.caller=t,t.map.on(r.Z.Consts.event.POPUP,(function(e){t.onShowPopup(e)}))),t.popup},t.getResultsPanel=async function(){const t=this;if(!t.resultsPanel){let e;const n={content:"table",titles:{main:t.getLocaleString("threed.rs.panel.gfi"),max:t.getLocaleString("threed.rs.panel.gfi")},share:t.options.share},r=t.map.getControlsByClass("TC.control.ControlContainer")[0];r?(n.position=r.POSITION.RIGHT,e=r.addControl("resultsPanel",n)):(n.div=document.createElement("div"),t.map.div.appendChild(n.div),e=t.map.addControl("resultsPanel",n)),t.resultsPanel=await e,t.resultsPanel.caller=t}return t.resultsPanel},t.getDisplayControl=function(){var t=this;return t.displayMode===r.Z.Consts.infoContainer.RESULTS_PANEL?t.resultsPanel:t.popup},t.getDisplayTarget=function(t){var e=this;if((t=t||{}).control)switch(!0){case r.Z.control.Popup&&t.control instanceof r.Z.control.Popup:return t.control.getContainerElement();case r.Z.control.ResultsPanel&&t.control instanceof r.Z.control.ResultsPanel:return t.control.getInfoContainer();default:return null}return e.displayMode===r.Z.Consts.infoContainer.RESULTS_PANEL?e.resultsPanel.getInfoContainer():e.popup.getContainerElement()},t.getMenuTarget=function(){var t=this;return t.displayMode===r.Z.Consts.infoContainer.RESULTS_PANEL?t.resultsPanel.getMenuElement():t.popup.getMenuElement()},t.displayResults=function(){var t=this;const e=t.div.cloneNode(!0);if(e.classList.remove(r.Z.Consts.classes.HIDDEN),t.filterFeature.data=e.outerHTML,t.displayMode===r.Z.Consts.infoContainer.RESULTS_PANEL){if(t.resultsPanel){0===t.map.getControlsByClass(r.Z.control.ControlContainer).length&&t.map.getControlsByClass(r.Z.control.ResultsPanel).forEach((function(t){t.isVisible()&&t.close()}));t.map.getControlsByClass("TC.control.ResultsPanel").forEach((function(e){e!==t.resultsPanel&&e.currentFeature&&!e.chart&&e.close()})),t.resultsPanel.currentFeature=t.filterFeature,t.resultsPanel.open(t.filterFeature.data,t.resultsPanel.getInfoContainer()),t.getMenuTarget().innerHTML="",t.displayResultsCallback()}}else t.getPopup().then((e=>t.filterFeature.showPopup(e)))};const o=function(t){return Array.from(t.parentElement.children).indexOf(t)},i=function(t,e){var n=t;do{n=n.parentElement}while(n&&n.tagName!==e);return n},a=function(t,e){const n=e,r=i(e,"LI"),a=i(r,"LI");return t.getFeature(o(a),o(r),o(n))};t.getFeatureElement=function(t){const e=this;let n;const r=e.getDisplayTarget().querySelectorAll(e._selectors.LIST_ITEM);for(var o=0,i=r.length;o<i;o++){const i=r[o];if(a(e,i)===t){n=i;break}}return n},t.getNextFeatureElement=function(t){const e=this,n=e.getDisplayTarget().querySelectorAll("ul."+e.CLASS+"-features > li"),r=n.length;for(var o=0;o<r;o++)if(n[o].matches("."+e.CURRENT_CLASS))return n[(o+t+r)%r];return null},t.getFeaturePath=function(t){const e=this;if(e.info&&e.info.services)for(var n=0,r=e.info.services.length;n<r;n++){const r=e.info.services[n];for(var o=0,i=r.layers.length;o<i;o++){const e=r.layers[o];for(var a=0,s=e.features.length;a<s;a++)if(e.features[a]===t)return{service:r.title||r.mapLayers.reduce((function(t,e){return t||e.title}),""),layer:e.path}}}return null},t.closeResults=function(){var t=this;if(t.displayMode===r.Z.Consts.infoContainer.RESULTS_PANEL)t.resultsPanel&&t.resultsPanel.isVisible()&&t.resultsPanel.close();else t.popup&&t.popup.isVisible()&&t.popup.hide()},t.displayResultsCallback=function(){var t=this;const e=t.getDisplayTarget().querySelector("."+t.CLASS),n=e.querySelector(`.${t.CLASS}-btn-next`);n&&n.addEventListener(r.Z.Consts.event.CLICK,(function(e){return t.highlightFeature(t.getNextFeatureElement(1),1),!1}),{passive:!0});const o=e.querySelector(`.${t.CLASS}-btn-prev`);o&&o.addEventListener(r.Z.Consts.event.CLICK,(function(e){return t.highlightFeature(t.getNextFeatureElement(-1),-1),!1}),{passive:!0});const s=function(n){const o=i(n.target,"LI");if(o.classList.contains(r.Z.Consts.classes.CHECKED)){const n=e.querySelector(`.${t.CLASS}-layers li:not(.tc-checked)`);n&&"none"!==getComputedStyle(n).display&&t.downplayFeatures()}else t.highlightFeature(o.querySelector(t._selectors.LIST_ITEM)),t.displayMode===r.Z.Consts.infoContainer.POPUP&&t.popup.fitToView(!0)};if(e.querySelectorAll(`ul.${t.CLASS}-layers h4`).forEach((t=>t.addEventListener(r.Z.Consts.event.CLICK,s,{passive:!0}))),t.displayMode===r.Z.Consts.infoContainer.POPUP&&e.querySelectorAll("img").forEach((e=>e.addEventListener("load",(()=>t.popup.fitToView())))),t.info){const n=t.getFeatures(),o=t.getMenuTarget();if(n.length>1)t.getRenderedHtml(`${t.CLASS}-buttons`,{id:t.id}).then((function(e){o.querySelector(`.${t.CLASS}-btn-dl`)||(o.insertAdjacentHTML("beforeend",e),o.querySelector(`.${t.CLASS}-btn-dl`).addEventListener(r.Z.Consts.event.CLICK,(async function(e){const r=await t.getDownloadDialog();let o={title:t.getLocaleString("featureInfo")+" - "+t.getLocaleString("download"),fileName:t._getFileName()};(t.map.elevation||t.options.displayElevation)&&(o=Object.assign({},o,{elevation:Object.assign({},t.map.elevation&&t.map.elevation.options,t.options.displayElevation)})),r.open(n,o)}),{passive:!0}),o.querySelector(t._selectors.SHOW_ALL_CHECKBOX).addEventListener("change",(function(e){e.target.checked?t.showAllFeatures():t.hideAllFeatures()}),{passive:!0}),o.querySelector(t._selectors.ZOOM_ALL_BUTTON).addEventListener(r.Z.Consts.event.CLICK,(function(e){t.map.zoomToFeatures(n)}),{passive:!0}),o.querySelector(t._selectors.DEL_ALL_BUTTON).addEventListener(r.Z.Consts.event.CLICK,(function(e){t.downplayFeatures(),t.filterLayer.removeFeature(t.filterFeature)}),{passive:!0}))}));else{const e=o.querySelector(`.${t.CLASS}-btn`);e&&e.remove()}t.info.defaultFeature&&t.getFeatureElement(t.info.defaultFeature)?(t.getFeatureElement(t.info.defaultFeature).classList.add(r.Z.Consts.classes.DEFAULT),t.highlightFeature(t.info.defaultFeature)):e.querySelector(t._selectors.LIST_ITEM)&&t.highlightFeature(e.querySelector(t._selectors.LIST_ITEM))}if(e.querySelectorAll("table:not(.complexAttr)").forEach((function(e){e.parentElement.classList.contains(r.Z.Consts.classes.CHECKED)||e.setAttribute("title",t.getLocaleString("clickToShowOnMap")),e.addEventListener("click",(function(e){const n=this.parentElement;if(!n.classList.contains(r.Z.Consts.classes.DISABLED)){if(n.classList.contains(r.Z.Consts.classes.CHECKED)){const e=a(t,n);if(e&&window.getSelection()&&0===window.getSelection().toString().trim().length){t.map.on(r.Z.Consts.event.ZOOM,(function e(){t._zooming=!1,t.map.off(r.Z.Consts.event.ZOOM,e)})),t._zooming=!0,t.map.zoomToFeatures([e],{animate:!0})}}else t.highlightFeature(n);e.stopPropagation()}}),{passive:!0})})),e.querySelectorAll("table a, table label, table input").forEach((function(t){t.addEventListener(r.Z.Consts.event.CLICK,(function(t){t.stopPropagation()}),{passive:!0})})),r.Z.browserFeatures.touch()&&t.displayMode===r.Z.Consts.infoContainer.RESULTS_PANEL){const n=e.querySelector("."+t.CLASS+"-btn-prev");n&&"none"===n.style.display||(t.resultsPanel&&r.Z.Util.swipe(t.resultsPanel.div,"disable"),((l=t).info&&l.info.services?l.info.services.reduce((function(t,e){return t+e.layers.reduce((function(t,e){return t+1}),0)}),0):0)>1&&r.Z.Util.swipe(e,{left:function(){t.highlightFeature(t.getNextFeatureElement(1),1)},right:function(){t.highlightFeature(t.getNextFeatureElement(-1),-1)}}))}var l},t.onShowPopup=function(t){const e=this;t.control===e.popup&&e.displayResultsCallback()},t.loadSharedFeature=function(t){},t.insertLinks=function(){var t=this;const e=t.getLocaleString("open"),n=t.getLocaleString("linkInNewWindow");t.div.querySelectorAll("td."+t.CLASS+"-val").forEach((function(t){const o=t.textContent;r.Z.Util.isURL(o)&&(t.innerHTML='<a href="'+o+'" target="_blank" title="'+n+'">'+e+"</a>")}))},t.highlightFeature=function(t,e){const n=this;var a;if(!n._zooming){var s;if(t instanceof r.Z.Feature)a=t,s=n.getFeatureElement(a);else for(s=t;s&&"LI"!==s.tagName;)s=s.parentElement;const l=i(s,"LI"),c=i(l,"LI"),u=o(c),p=o(l),d=o(s);a=a||n.getFeature(u,p,d),n.downplayFeatures({exception:a});const h=n.info.services[u];Object.prototype.hasOwnProperty.call(n._infoHistory,h.url)||(n._infoHistory[h.url]={});const f=n._infoHistory[h.url],m=h.layers[p],g=f[m.name]||[];g.includes(a)||(f[m.name]=g.concat(a));const y=n.getDisplayTarget();if(y.querySelectorAll("li").forEach((t=>t.classList.remove(n.CURRENT_CLASS))),s.classList.add(r.Z.Consts.classes.CHECKED,n.CURRENT_CLASS),l.classList.add(r.Z.Consts.classes.CHECKED,n.CURRENT_CLASS),c.classList.add(r.Z.Consts.classes.CHECKED,n.CURRENT_CLASS),e>0?(s.classList.add(r.Z.Consts.classes.FROMLEFT),l.classList.add(r.Z.Consts.classes.FROMLEFT),c.classList.add(r.Z.Consts.classes.FROMLEFT)):e<0&&(s.classList.add(r.Z.Consts.classes.FROMRIGHT),l.classList.add(r.Z.Consts.classes.FROMRIGHT),c.classList.add(r.Z.Consts.classes.FROMRIGHT)),s.querySelector("table")&&s.querySelector("table").setAttribute("title",n.getLocaleString("clickToCenter")),a instanceof r.Z.Feature||(a=null),a&&a===n.highlightedFeature)return;n.highlightedFeature=a;const v=y.querySelector("."+n.CLASS+"-counter-current");if(v&&(v.innerHTML=n.getFeatureIndex(u,p,d)+1),n.options.persistentHighlights||n.resultsLayer.features.slice().forEach((t=>{t!==a&&n.downplayFeature(t)})),a){const t=t=>n.map.trigger(r.Z.Consts.event.FEATUREHIGHLIGHT,{feature:t,control:n});if(a.geometry){let e;a.showsPopup=n.options.persistentHighlights,n.options.persistentHighlights&&(e=n.resultsLayer.getFeatureById(a.wrap.getId()),e&&t(e)),e||n.resultsLayer.addFeature(a).then((function(e){t(a)}))}else s.classList.add(r.Z.Consts.classes.DISABLED),t(a)}}},t.downplayFeature=function(t){const e=this,n=e.getFeatureElement(t);let o;for(var i in n&&n.classList.remove(r.Z.Consts.classes.CHECKED),e.options.persistentHighlights&&(o=e.resultsLayer.getFeatureById(t.wrap.getId())),e.resultsLayer.removeFeature(o||t),e._infoHistory){const n=e._infoHistory[i];for(var a in n){let e=n[a];e=n[a]=e.filter((e=>e!==t)),e.length||delete n[a]}}e.highlightedFeature===t&&(e.highlightedFeature=null),e.map.trigger(r.Z.Consts.event.FEATUREDOWNPLAY,{feature:t,control:e})},t.downplayFeatures=function(t){const e=this;t=t||{};const o=e.highlightedFeature;o&&o!==t.exception&&(e.downplayFeature(o),e.highlightedFeature=null),e.getFeatures().filter((t=>t!==o)).forEach((t=>e.resultsLayer.removeFeature(t)));const a=t.exception?e.getFeatureElement(t.exception):void 0;var s,l;a&&(s=i(a,"LI"),l=i(s,"LI"));const c=e.getDisplayTarget();Array.from(c.querySelectorAll("ul."+e.CLASS+"-services li")).filter((function(t){return t!==a&&t!==s&&t!==l})).forEach((function(t){t.classList.remove(r.Z.Consts.classes.CHECKED,r.Z.Consts.classes.DISABLED,r.Z.Consts.classes.FROMLEFT,r.Z.Consts.classes.FROMRIGHT)})),c.querySelectorAll("."+e.CLASS+"-features table:not(.complexAttr)").forEach((function(t){t.setAttribute("title",e.getLocaleString("clickToShowOnMap"))})),n.call(e)},t.showAllFeatures=function(){const t=this;t.highlightedFeature&&t.downplayFeature(t.highlightedFeature);for(var n=0,r=t.info.services.length;n<r;n++){const e=t.info.services[n],r=t._infoHistory[e.url]=t._infoHistory[e.url]||{};for(var o=0,i=e.layers.length;o<i;o++){const n=e.layers[o];let i=r[n.name]||[];for(var a=0,s=n.features.length;a<s;a++){const e=n.features[a];e.showsPopup=t.options.persistentHighlights,i.includes(e)||(r[n.name]=i=i.concat(e)),t.resultsLayer.features.includes(e)||t.resultsLayer.addFeature(e)}}}e.call(t)},t.hideAllFeatures=function(){const t=this,e=t.getDisplayTarget().querySelector(`ul.${t.CLASS}-layers > li.${r.Z.Consts.classes.CHECKED}`);t.downplayFeatures(),e&&e.classList.add(r.Z.Consts.classes.CHECKED)},t.getFeature=function(t,e,n){var r;const o=this.info;return o&&o.services&&(r=o.services[t])&&(r=r.layers[e])&&(r=r.features[n]),r},t.getFeatures=function(){let t=[];const e=this.info;return e&&e.services&&(t=e.services.reduce(((t,e)=>t.concat(e.layers.reduce(((t,e)=>t.concat(e.features)),[]))),t)),t},t.getFeatureIndex=function(t,e,n){var r=-1;const o=this.info;if(o)for(var i=0;i<=t;i++)for(var a=o.services[i],s=i===t?e:a.layers.length-1,l=0;l<=s;l++)for(var c=a.layers[l],u=l===e&&i===t?n:c.features.length-1,p=0;p<=u;p++)r+=1;return r},t.beforeRequest=function(t){var e=this;e.querying=!0,e.map.trigger(r.Z.Consts.event.BEFOREFEATUREINFO,{xy:t.xy,control:e}),e.closeResults(),e.map&&e.resultsLayer&&(e.lastFeatureCount=null,e.options.persistentHighlights||e.resultsLayer.features.slice().forEach((t=>e.downplayFeature(t))),e.info=null)},t.activate=function(){var t=this;t.wrap&&t.wrap.activate(),r.Z.Control.prototype.activate.call(t)},t.deactivate=function(t){var e=this;e.popup&&e.popup.isVisible()&&e.popup.hide(),e.options.persistentHighlights||(e.resultsLayer.features.slice().forEach((t=>e.downplayFeature(t))),e.info=null,e._infoHistory={}),e.filterLayer&&e.filterLayer.clearFeatures(),e.filterFeature=null,e.wrap&&e.wrap.deactivate(),r.Z.Control.prototype.deactivate.call(e,t)},t.exportState=function(){const t=this;if(t.exportsState&&t.resultsLayer){const e={};return t.toShare&&(e.features=[]),{id:t.id,layer:t.resultsLayer.exportState(e),query:t.toShare}}return null},t.importState=function(t){const e=this;e._layersPromise.then((function(){e.resultsLayer.importState(t.layer),t.query&&e.importQuery(t.query)}))},t._createLayers=function(){const t=this;var e,n;if(e=t.options.resultsLayer?t.options.resultsLayer:{id:t.getUID(),title:t.CLASS+": Results layer",type:r.Z.Consts.layerType.VECTOR,owner:t,stealth:!0},t.options.filterLayer)n=t.options.filterLayer;else{const e={};t.geometryType===r.Z.Consts.geom.POLYLINE&&(e.line=t.style),t.geometryType===r.Z.Consts.geom.POLYGON&&(e.polygon=t.style),n={id:t.getUID(),title:t.CLASS+": Filter layer",owner:t,stealth:!0,type:r.Z.Consts.layerType.VECTOR,styles:e}}const o=t.map;return t._layersPromise=new Promise((function(r,i){o.loaded((function(){const i=o.layers.indexOf(e)>=0?Promise.resolve(e):o.addLayer(e),a=o.layers.indexOf(n)>=0?Promise.resolve(n):o.addLayer(n);Promise.all([i,a]).then((function(e){t.resultsLayer=e[0],t.filterLayer=e[1],r()}))}))})),t._layersPromise},t._decorateDisplay=function(t){const e=this,n=e.getMenuTarget({control:t}),o=n.querySelector("."+r.Z.control.Print.prototype.CLASS+"-btn");if(o)e.lastFeatureCount||t.currentFeature&&!0===t.currentFeature.showsPopup||o.remove();else{var i=e.getLocaleString("feature");if(t===e.getDisplayControl())if(r.Z.feature.Point&&e.filterFeature instanceof r.Z.feature.Point){const t=e.filterFeature.geometry;i=e.getLocaleString("featuresAt",{crs:e.map.crs,x:r.Z.Util.formatCoord(t[0],e.map.wrap.isGeo()?r.Z.Consts.DEGREE_PRECISION:r.Z.Consts.METER_PRECISION),y:r.Z.Util.formatCoord(t[1],e.map.wrap.isGeo()?r.Z.Consts.DEGREE_PRECISION:r.Z.Consts.METER_PRECISION)})}else i=e.getLocaleString("spatialQueryResults");else t.currentFeature&&(i=t.currentFeature.id);(e.lastFeatureCount||t.currentFeature&&!0===t.currentFeature.showsPopup)&&new r.Z.control.Print({target:n,printableElement:e.getDisplayTarget({control:t}),title:i})}r.Z.control.FeatureInfoCommons.addSpecialAttributeEventListeners(t.getContainerElement())},t._addSourceAttributes=function(){const t=this,e="h3_"+t.getLocaleString("service"),n="h4_"+t.getLocaleString("layer");t.info&&t.info.services&&t.info.services.forEach((function(o){o.layers.forEach((function(o){o.features.forEach((function(o){if(o instanceof r.Z.Feature){const i=t.getFeaturePath(o);if(i){const a={};a[e]=i.service,i.layer&&(a[n]=i.layer.join(t.TITLE_SEPARATOR));const s=r.Z.Util.extend(a,o.getData());o.clearData(),o.setData(s)}}}))}))}))},t._getFileName=function(){return this.getLocaleString("featureInfo").toLowerCase().replace(/\s/gi,"_")+"_"+r.Z.Util.getFormattedDate((new Date).toString(),!0)},t.showShareDialog=function(t){const e=this;return e.toShare=e.exportQuery(),r.Z.control.infoShare.showShareDialog.call(e,t)},t.exportQuery=function(){const t=this,e={};if(t.filterFeature){const n=t.filterLayer.exportState();n.features.forEach((t=>delete t.data)),e.filter=n,t.highlightedFeature&&(e.hlf=t.highlightedFeature.getId())}return e},t.importQuery=function(t){const e=this;t.filter&&(e.activate(),e.filterLayer.importState(t.filter).then((function(){e.filterFeature=e.filterLayer.features[0],e.sendRequest(e.filterFeature);const n=function(o){if(o.control===e){const o=e.getFeatures().find((e=>e.getId()===t.hlf));o?e.highlightFeature(o):Object.prototype.hasOwnProperty.call(t,"hlf")||setTimeout((()=>e.showAllFeatures()),100),e.map.off(r.Z.Consts.event.FEATUREHIGHLIGHT,n)}};e.map.on(r.Z.Consts.event.FEATUREHIGHLIGHT,n)})))};const s={};r.Z.control.FeatureInfoCommons.renderFeatureAttributeTable=function(e){return s.template||(s.template=r.Z.Util.extend({},t.template)),t.getRenderedHtml.call(s,t.CLASS+"-attr",e)},r.Z.control.FeatureInfoCommons.renderFeatureAttribute=function(e){return s.template||(s.template=r.Z.Util.extend({},t.template)),t.getRenderedHtml.call(s,t.CLASS+"-attr-val",e)},r.Z.control.FeatureInfoCommons.showImageDialog=function(e){return s.template||(s.template=r.Z.Util.extend({},t.template)),new Promise((function(n,o){t.getRenderedHtml.call(s,t.CLASS+"-dialog",{src:e.getAttribute("src")}).then((function(e){const o=document.createElement("div");document.body.appendChild(o),o.innerHTML=e,r.Z.Util.showModal(o.querySelector(`.${t.CLASS}-img-dialog`),{closeCallback:()=>o.remove()}),o.querySelector(".tc-modal-img img").addEventListener(r.Z.Consts.event.CLICK,(function(t){r.Z.Util.closeModal()}),{passive:!0}),n(o)}))}))},r.Z.control.FeatureInfoCommons.addSpecialAttributeEventListeners=function(t){t.querySelectorAll("img.tc-img-attr").forEach((function(t){t.addEventListener(r.Z.Consts.event.CLICK,(function(t){setTimeout((()=>r.Z.control.FeatureInfoCommons.showImageDialog(t.target)),50),t.stopPropagation()}),{passive:!0})}))}}();const l=r.Z.control.FeatureInfoCommons},8703:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>l});var r=n(5361),o=n(2089),i=n(6498),a=n(7901),s=n(3905);r.Z.control=r.Z.control||{},r.Z.control.infoShare=a.default,r.Z.control.Print=s.default,r.Z.Control=i.Z,r.Z.Consts=o.Z,r.Z.Consts.event.POPUP=r.Z.Consts.event.POPUP||"popup.tc",r.Z.Consts.event.POPUPHIDE=r.Z.Consts.event.POPUPHIDE||"popuphide.tc",r.Z.Consts.event.DRAWCHART=r.Z.Consts.event.DRAWCHART||"drawchart.tc",r.Z.Consts.event.DRAWTABLE=r.Z.Consts.event.DRAWTABLE||"drawtable.tc",r.Z.Consts.event.DIALOG=r.Z.Consts.event.DIALOG||"dialog.tc",r.Z.Consts.event.FEATUREHIGHLIGHT=r.Z.Consts.event.FEATUREHIGHLIGHT||"featurehighlight.tc",r.Z.Consts.event.FEATUREDOWNPLAY=r.Z.Consts.event.FEATUREDOWNPLAY||"featuredownplay.tc",r.Z.control.FeatureTools=function(){const t=this;r.Z.Control.apply(t,arguments),t.exportsState=!0;const e=t._classSelector="."+t.CLASS;t._selectors={ELEVATION_CHECKBOX:e+"-dialog-elev input[type=checkbox]",INTERPOLATION_RADIO:"input[type=radio][name=finfo-ip-coords]",INTERPOLATION_DISTANCE:e+"-dialog-ip-m"},t._dialogDiv=r.Z.Util.getDiv(t.options.dialogDiv),window.$&&(t._$dialogDiv=$(t._dialogDiv)),t.options.dialogDiv||document.body.appendChild(t._dialogDiv)},r.Z.inherit(r.Z.control.FeatureTools,r.Z.Control),r.Z.mix(r.Z.control.FeatureTools,r.Z.control.infoShare),function(){var t=r.Z.control.FeatureTools.prototype;t.CLASS="tc-ctl-ftools",t.TITLE_SEPARATOR=" › ",t.FILE_TITLE_SEPARATOR="__",t.template={},t.template[t.CLASS]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-ftools">\r\n    <button type="button" class="tc-icon-btn tc-ctl-ftools-dl-btn" title="'+a(s(n,"i18n").call(i,"downloadFeature",{name:"i18n",hash:{},data:o,loc:{start:{line:2,column:74},end:{line:2,column:100}}}))+'">'+a(s(n,"i18n").call(i,"download",{name:"i18n",hash:{},data:o,loc:{start:{line:2,column:102},end:{line:2,column:121}}}))+'</button>\r\n    <button type="button" class="tc-icon-btn tc-ctl-ftools-share-btn" title="'+a(s(n,"i18n").call(i,"shareFeature",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:77},end:{line:3,column:100}}}))+'">'+a(s(n,"i18n").call(i,"share",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:102},end:{line:3,column:118}}}))+'</button>\r\n    <button type="button" class="tc-icon-btn tc-ctl-ftools-zoom-btn" title="'+a(s(n,"i18n").call(i,"zoomToFeature",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:76},end:{line:4,column:100}}}))+'">'+a(s(n,"i18n").call(i,"zoomToFeature",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:102},end:{line:4,column:126}}}))+'</button>\r\n    <button type="button" class="tc-icon-btn tc-ctl-ftools-elev-btn tc-hidden" title="'+a(s(n,"i18n").call(i,"viewElevation",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:86},end:{line:5,column:110}}}))+'">'+a(s(n,"i18n").call(i,"viewElevation",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:112},end:{line:5,column:136}}}))+'</button>\r\n    <button type="button" class="tc-icon-btn tc-ctl-ftools-prof-btn tc-hidden" title="'+a(s(n,"i18n").call(i,"viewElevationProfile",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:86},end:{line:6,column:117}}}))+'">'+a(s(n,"i18n").call(i,"viewElevationProfile",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:119},end:{line:6,column:150}}}))+'</button>\r\n    <button type="button" class="tc-icon-btn tc-ctl-ftools-del-btn" title="'+a(s(n,"i18n").call(i,"deleteFeature",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:75},end:{line:7,column:99}}}))+'">'+a(s(n,"i18n").call(i,"deleteFeature",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:101},end:{line:7,column:125}}}))+"</button>\r\n</div>"},useData:!0},t.template[t.CLASS+"-dialog"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-ftools-dialog tc-ctl-ftools-share-dialog tc-modal">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+a(s(n,"i18n").call(i,"feature",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:16},end:{line:5,column:34}}}))+" - "+a(s(n,"i18n").call(i,"share",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:37},end:{line:5,column:53}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <div class="tc-ctl-ftools-share-dialog-ctl"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n'},useData:!0},t.register=function(t){const e=this;return t.on(r.Z.Consts.event.POPUP+" "+r.Z.Consts.event.DRAWTABLE+" "+r.Z.Consts.event.DRAWCHART,(function(t){const n=t.control;(n.caller||n.currentFeature)&&e.addUI(n)})).on(r.Z.Consts.event.FEATUREHIGHLIGHT,(function(t){e.addUI(t.control.getDisplayControl())})).on(r.Z.Consts.event.FEATUREDOWNPLAY,(function(t){e.updateUI(t.control.getDisplayControl())})),new Promise((function(n,o){Promise.all([r.Z.Control.prototype.register.call(e,t),e.renderPromise()]).then((function(){e.getShareDialog().then((function(){n(e)})).catch((function(t){o(t instanceof Error?t:Error(t))}))}))}))},t.render=function(){const t=this;return t._set1stRenderPromise(Promise.all([t.renderData({elevation:t.options.displayElevation}),t.getRenderedHtml(t.CLASS+"-dialog",{checkboxId:t.getUID(),elevation:t.options.displayElevation},(function(e){t._dialogDiv.innerHTML=e}))]))},t.addUI=function(t){const e=this,n=t.getMenuElement(),o=function(){return n&&!n.querySelector("."+e.CLASS)};e.getCurrentFeature(t)&&(o()?e.getRenderedHtml(e.CLASS,null,(function(i){if(o()){let a=Promise.resolve();const s=t.getContainerElement();if(!s.querySelectorAll("."+r.Z.control.Print.prototype.CLASS+"-btn").length){const o=!t.caller&&t.currentFeature?t.currentFeature:t.caller.highlightedFeature;o&&!0===o.showsPopup&&(e.printControl=new r.Z.control.Print({target:n,printableElement:s,title:o.id}),a=e.printControl.renderPromise())}a.then((function(){if(o()){const r=(new DOMParser).parseFromString(i,"text/html").body.firstChild;n.appendChild(r),e.updateUI(t),e._setToolButtonHandlers(t),e._decorateDisplay(t)}}))}})):e.updateUI(t))},t._decorateDisplay=function(t){const e=this;t.getContainerElement().querySelectorAll("table.tc-attr").forEach((function(n){!t.caller&&t.currentFeature&&(n.addEventListener(r.Z.Consts.event.CLICK,(function(n){e.zoomToFeatures([e.getCurrentFeature(t)])}),{passive:!0}),n.classList.add(e.CLASS+"-zoom"),n.setAttribute("title",e.getLocaleString("clickToCenter"))),n.querySelectorAll("a, label, input, video, audio").forEach((function(t){t.addEventListener(r.Z.Consts.event.CLICK,(function(t){t.stopPropagation()}),{passive:!0})}))}));const n=t.getContainerElement().querySelector(".prpanel-body > table");n&&n.parentElement.classList.add(e.CLASS+"-zoom")},t.updateUI=function(t){const e=this,n=t.getMenuElement().querySelector("."+e.CLASS),o=e.getCurrentFeature(t),i=o&&o.layer&&o.layer.owner?o.layer.owner.filterLayer!==o.layer:o&&!!o.layer;if(i)if(o){n.dataset.layerId=o.layer.id,n.dataset.featureId=o.id;const i=!!o.layer.cluster&&o.features.length>1,a=n.querySelector(`.${e.CLASS}-share-btn`);a&&a.classList.toggle(r.Z.Consts.classes.HIDDEN,i),n.querySelector(`.${e.CLASS}-dl-btn`).classList.toggle(r.Z.Consts.classes.HIDDEN,i),n.querySelector(`.${e.CLASS}-del-btn`).classList.toggle(r.Z.Consts.classes.HIDDEN,i),e.getElevationTool().then((function(a){const s=n.querySelector(`.${e.CLASS}-prof-btn`);s&&s.classList.toggle(r.Z.Consts.classes.HIDDEN,!a||!(r.Z.feature.Polyline&&o instanceof r.Z.feature.Polyline||r.Z.feature.MultiPolyline&&o instanceof r.Z.feature.MultiPolyline)||!!t.chart);const l=n.querySelector(`.${e.CLASS}-elev-btn`);l&&l.classList.toggle(r.Z.Consts.classes.HIDDEN,!a||!(o instanceof r.Z.feature.Point)||i)}))}else delete n.dataset.layerId,delete n.dataset.featureId;e.printControl&&o&&(e.printControl.title=o.id),n&&(n.classList.remove(r.Z.Consts.classes.ACTIVE),setTimeout((function(){n.classList.toggle(r.Z.Consts.classes.ACTIVE,!!i)}),100))};const e=function(t){return t&&Array.isArray(t.features)?1===t.features.length?t.features[0]:null:t};t.onDownloadButtonClick=function(t){const n=this;let r=e(n.getFeatureFromElement(t.target.parentElement));r&&n.showDownloadDialog(r)},t.onShareButtonClick=function(t){const r=this,o=e(r.getFeatureFromElement(t.target.parentElement));if(!o)throw"FeatureTools: there is not a feature to share";n(r,{feature:o}).then((async function(t){r.toShare={feature:t},r.showShareDialog()}))},t.onZoomButtonClick=function(t){const e=this,n=(r=e.getFeatureFromElement(t.target.parentElement))?Array.isArray(r.features)?r.features:[r]:[];var r;n.length&&e.zoomToFeatures(n)},t.onDeleteButtonClick=function(t){this.removeFeature(this.getFeatureFromElement(t.target.parentElement))},t.onProfileButtonClick=function(t){const n=this,r=e(n.getFeatureFromElement(t.target.parentElement)),o={};r&&n.getElevationControl().then((function(t){t&&(r.getGeometryStride()>2?(o.originalElevation=!0,o.onlyOriginalElevation=!1,t.setElevationToolOptions({resolution:n.options.resolution||0,sampleNumber:n.options.sampleNumber||0})):t.setElevationToolOptions(Object.assign({},n.map.elevation&&n.map.elevation.options,n.options.displayElevation)),t.displayElevationProfile(r,o))}))},t.onElevationButtonClick=function(t){const n=this;n.getElevationControl().then((r=>r&&r.displayElevationValue(e(n.getFeatureFromElement(t.target.parentElement)),{ignoreCache:!0})))},t._setToolButtonHandlers=function(t){const e=this,n=t.getMenuElement();n.querySelector("."+e.CLASS+"-dl-btn").addEventListener(r.Z.Consts.event.CLICK,(function(t){e.onDownloadButtonClick(t)}),{passive:!0}),n.querySelector("."+e.CLASS+"-share-btn").addEventListener(r.Z.Consts.event.CLICK,(function(t){e.onShareButtonClick(t)}),{passive:!0}),n.querySelector("."+e.CLASS+"-zoom-btn").addEventListener(r.Z.Consts.event.CLICK,(function(t){e.onZoomButtonClick(t)}),{passive:!0});const o=n.querySelector(`.${e.CLASS}-prof-btn`);o&&o.addEventListener(r.Z.Consts.event.CLICK,(function(t){e.onProfileButtonClick(t)}),{passive:!0});const i=n.querySelector(`.${e.CLASS}-elev-btn`);i&&i.addEventListener(r.Z.Consts.event.CLICK,(function(t){e.onElevationButtonClick(t)}),{passive:!0}),n.querySelector("."+e.CLASS+"-del-btn").addEventListener(r.Z.Consts.event.CLICK,(function(t){e.onDeleteButtonClick(t)}),{passive:!0})},t.getElevationControl=async function(){const t=this;return t.options.displayElevation?(t.elevationControl||(t.elevationControl=await t.map.addControl("elevation",t.options.displayElevation)),t.elevationControl):null},t.showDownloadDialog=async function(t){const e=this,n=await e.getDownloadDialog();var o={title:e.getLocaleString("feature")+" - "+e.getLocaleString("download"),fileName:e._getFeatureFilename(t)};(e.map.elevation||e.options.displayElevation)&&(o=Object.assign({},o,{elevation:Object.assign({},e.map.elevation&&e.map.elevation.options,e.options.displayElevation)})),o.openCallback=function(){e.map.trigger(r.Z.Consts.event.DIALOG,{control:n,action:"download"})},n.open(t,o)},t.getCurrentFeature=function(t){return t&&(t.caller&&t.caller.highlightedFeature||t.currentFeature)},t.getFeatureFromElement=function(t){const e=this.map.getLayer(t.dataset.layerId);return e?e.getFeatureById(t.dataset.featureId):null},t.zoomToFeatures=function(t){const e=this;e.map&&e.map.zoomToFeatures(t,{animate:!0})},t.removeFeature=function(t){const e=this,n=function(){t&&t.layer&&t.layer.removeFeature(t)},o=function(){const n=e=>e.caller&&e.caller.highlightedFeature===t&&e.isVisible();e.map.getControlsByClass(r.Z.control.Popup).filter(n).forEach((t=>t.hide()));e.map.getControlsByClass(r.Z.control.ResultsPanel).filter(n).forEach((t=>t.close()))};t&&t.layer&&t.layer.owner&&t.layer===t.layer.owner.resultsLayer?(n(),o()):r.Z.confirm(e.getLocaleString("deleteFeature.confirm"),(function(){n(),o()}))};const n=function(t,e){return e=e||{},new Promise((function(n,r){const o=e.feature;if(o){const a=o.clone();if(a.setId(o.id),a.layer=o.layer,e.elevation){var i=!0;if(!e.elevation.resolution&&a.getGeometryStride()>2&&(i=!1),i){const o={crs:t.map.crs,features:[a],maxCoordQuantity:t.options.displayElevation&&t.options.displayElevation.maxCoordQuantity,resolution:e.elevation.resolution,sampleNumber:0};t.getElevationTool().then((function(t){t.setGeometry(o).then((function(t){n(t[0])}),(function(t){r(t instanceof Error?t:Error(t))}))}))}else n(a)}else{const t=a.getCoordsArray(),e=t[0];e&&e.length>2&&(t.forEach((function(t){t.length=2})),a.setCoords(a.geometry)),n(a)}}else n(null)}))};t.getFeatureTitle=function(t){var e="";return t&&(e=t.id),e},t._getFeatureFilename=function(t){const e=this;return(e.getFeatureTitle(t).toString().replace(new RegExp(e.TITLE_SEPARATOR,"g"),e.FILE_TITLE_SEPARATOR)||e.getLocaleString("feature")).toLowerCase().replace(/\s/gi,"_")+"_"+r.Z.Util.getFormattedDate((new Date).toString(),!0)},t.exportState=function(){const t=this;if(t.toShare){const e={};if(t.toShare.doZoom&&(e.doZoom=t.toShare.doZoom),e.id=t.id,t.toShare.feature){let n;const r=t.toShare.feature.clone();r.showsPopup=!0,n=t.toShare.feature.layer.exportState({features:[r]}),e.features=n.features,n.crs&&(e.crs=n.crs)}else if(t.toShare.features){if(e.features=t.toShare.features,t.sharedFeaturesLayer){let n=t.sharedFeaturesLayer.exportState();e.features=n.features}t.toShare.crs&&(e.crs=t.toShare.crs)}return e}return null},t.importState=function(t){const e=this;e.map&&t.features&&t.features.length&&(e.toShare={features:t.features},t.crs&&(e.toShare.crs=t.crs),e.map.addLayer({id:e.getUID(),owner:e,type:r.Z.Consts.layerType.VECTOR,title:e.getLocaleString("foi"),stealth:!0}).then((function(n){e.sharedFeaturesLayer=n,n.importState({features:t.features,crs:t.crs}).then((function(){t.doZoom&&e.map.zoomToFeatures(n.features)}))})))}}();const l=r.Z.control.FeatureTools},3908:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>h});var r=n(5361),o=n(2089),i=n(7757),a=n(2667),s=n(7945),l=n(6947),c=n(4496),u=n(7106);r.Z.Consts=o.Z,r.Z.control=r.Z.control||{},r.Z.Geometry=a.Z,r.Z.layer=r.Z.layer||{},r.Z.layer.Vector=l.Z,r.Z.filter=c.Z;const p=new Set;window.addEventListener("beforeunload",(function(t){p.size>0&&(t.preventDefault(),t.returnValue="")}),{capture:!0});class d extends i.default{TITLE_SEPARATOR=" › ";constructor(){super(...arguments);const t=this;t.CLASS="tc-ctl-fedit",t.template[t.CLASS]={1:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=a(n,"unless").call(null!=e?e:t.nullContext||{},o&&a(o,"first"),{name:"unless",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:5,column:163},end:{line:5,column:193}}}))?i:"")+"."+t.escapeExpression(t.lambda(e,e))},2:function(t,e,n,r,o){return","},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+s(l(n,"i18n").call(a,"openFile",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:4},end:{line:1,column:23}}}))+"</h2>\r\n<div>\r\n    <p>"+s(l(n,"i18n").call(a,"fileImport.instructions",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:7},end:{line:3,column:41}}}))+'</p>\r\n    <div class="tc-ctl-file-open">\r\n        <label class="tc-button tc-ctl-file-open-label tc-icon-button"><input type="file" class="tc-ctl-file-open-ipt tc-button" multiple accept="'+(null!=(i=l(n,"each").call(a,null!=e?l(e,"formats"):e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:5,column:146},end:{line:5,column:211}}}))?i:"")+'" />'+s(l(n,"i18n").call(a,"openFile",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:215},end:{line:5,column:234}}}))+'</label>\r\n    </div>\r\n    <ul class="tc-ctl-file-recent"></ul>\r\n</div>\r\n'},useData:!0},t.template[t.CLASS+"-dialog"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-file-dialog tc-modal">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3></h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            '+a(s(n,"i18n").call(i,"fileAccessPrompt",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:12},end:{line:9,column:39}}}))+'\r\n        </div>\r\n        <div class="tc-modal-footer">\r\n            <sitna-button class="tc-ctl-file-dialog-ok" text="'+a(s(n,"i18n").call(i,"ok",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:62},end:{line:12,column:75}}}))+'"></sitna-button>\r\n        </div>\r\n    </div>\r\n</div>\r\n'},useData:!0},t.template[t.CLASS+"-panel"]={1:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <sitna-button text="'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"saveAs",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:28},end:{line:6,column:45}}}))+'" class="tc-ctl-fedit-btn-saveas"></sitna-button>\r\n'},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-fedit-panel">\r\n    <div class="tc-ctl-fedit-edit"></div>\r\n    <div class="tc-ctl-fedit-actions">\r\n        <sitna-button text="'+t.escapeExpression(s(n,"i18n").call(a,"save",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:28},end:{line:4,column:43}}}))+'" class="tc-ctl-fedit-btn-save"></sitna-button>\r\n'+(null!=(i=s(n,"if").call(a,null!=e?s(e,"includeSaveAs"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:5,column:8},end:{line:7,column:15}}}))?i:"")+"    </div>\r\n</div>"},useData:!0},t.layer=null,t.styles=t.options.styles||{point:{fillColor:"#0000aa",fillOpacity:.1,strokeColor:"#0000aa",strokeWidth:2,strokeOpacity:1,radius:6},line:{strokeColor:"#0000aa",strokeWidth:2,strokeOpacity:1},polygon:{fillColor:"#0000aa",fillOpacity:.1,strokeColor:"#0000aa",strokeWidth:2,strokeOpacity:1}}}async register(t){const e=this,n=await super.register(t);return t.on(r.Z.Consts.event.RESULTSPANELCLOSE,(function(t){t.control===e.panel&&e.closeEditSession()})).on(r.Z.Consts.event.LAYERREMOVE,(function(t){p.delete(t.layer),t.layer===e.getLayer()&&e.closeEditSession()})).on(r.Z.Consts.event.FEATUREADD,(function(t){if(t.layer===e.getLayer()){const e=t.layer.features[0];e!==t.feature&&(t.feature.folders=e.folders.slice(),t.feature.wrap.feature._folders=t.feature.folders)}})).on(r.Z.Consts.event.FEATUREADD+" "+r.Z.Consts.event.FEATUREREMOVE,(function(t){t.layer===e.getLayer()&&(p.has(t.layer)||p.add(t.layer))})),e.getEditControl().then((t=>{t.getModifyControl().then((t=>{t.on(r.Z.Consts.event.FEATUREMODIFY,(function(t){p.has(t.layer)||p.add(t.layer)}))}))})),t.ready((function(){t.getControlsByClass(r.Z.control.WorkLayerManager).forEach((function(n){n.addItemTool({renderFn:function(n,o){if(t.getLayer(o).type!==r.Z.Consts.layerType.VECTOR)return;const i=e.CLASS+"-btn-edit";let a=n.querySelector("sitna-toggle."+i);if(!a){const t=e.getLocaleString("editFeatures");a=new u.Z,a.text=t,a.checkedIconText=getComputedStyle(document.querySelector(":root")).getPropertyValue("--icon-edit").replaceAll('"',""),a.uncheckedIconText=a.checkedIconText,a.dataset.layerId=o}return a},updateEvents:[r.Z.Consts.event.CONTROLACTIVATE,r.Z.Consts.event.CONTROLDEACTIVATE],updateFn:function(n){const r=t.getLayer(this.dataset.layerId);this.checked=e.getLayer()===r},actionFn:function(){const n=this,r=t.getLayer(n.dataset.layerId);r.isRaster()||(e.closeEditSession(),n.checked&&e.setLayer(r).then((()=>{e.openEditSession()})))}})}))})),n}async render(t){const e=this;await super.render.call(e,t);const n=!!window.showSaveFilePicker,o=await e.getRenderedHtml(e.CLASS+"-panel",{includeSaveAs:n});e.panel||(e.panel=await e.map.addResultsPanel({resize:!1,content:"table",titles:{main:e.getLocaleString("editFeatures")}}),e.panel.div.querySelector("."+e.panel.CLASS+"-info").insertAdjacentHTML("beforeend",o)),e.saveButton=e.panel.div.querySelector(`.${e.CLASS}-actions sitna-button.${e.CLASS}-btn-save`),e.saveButton.addEventListener(r.Z.Consts.event.CLICK,(function(t){e.editControl.modifyControl.unselectFeatures(e.editControl.getSelectedFeatures()),e.save()}),{passive:!0}),n&&(e.saveAsButton=e.panel.div.querySelector(`.${e.CLASS}-actions sitna-button.${e.CLASS}-btn-saveas`),e.saveAsButton.addEventListener(r.Z.Consts.event.CLICK,(function(t){e.editControl.modifyControl.unselectFeatures(e.editControl.getSelectedFeatures()),e.save({showDialog:!0})}),{passive:!0})),e._editPromise=e._editPromise||e.map.addControl("edit",{id:e.getUID(),div:e.panel.div.querySelector(`.${e.CLASS}-edit`),layer:!1,styles:e.styles,styling:!0,snapping:e.options.snapping}),e.editControl=await e._editPromise,"function"==typeof t&&t()}getEditControl(){const t=this;return t._editPromise||new Promise((function(e,n){t.renderPromise().then((()=>e(t.editControl)))}))}async openEditSession(){const t=this;await t.renderPromise();const e=t.getLayer().features.map((t=>t.getStyle())).filter((t=>Object.keys(t).length)),n=await t.getEditControl(),r=await n.getPointDrawControl();r.toggleStyleTools(e.length);const o=await n.getLineDrawControl();o.toggleStyleTools(e.length);const i=await n.getPolygonDrawControl();if(i.toggleStyleTools(e.length),e.length){const t=e[0];t.strokeColor&&(r.setStrokeColor(t.strokeColor),o.setStrokeColor(t.strokeColor),i.setStrokeColor(t.strokeColor)),t.strokeWidth&&(r.setStrokeWidth(t.strokeWidth),o.setStrokeWidth(t.strokeWidth),i.setStrokeWidth(t.strokeWidth)),t.fillColor&&(r.setFillColor(t.fillColor),i.setFillColor(t.fillColor)),t.fillOpacity&&(r.setFillOpacity(t.fillOpacity),i.setFillOpacity(t.fillOpacity))}t.panel.open()}closeEditSession(){const t=this;t.editControl&&t.editControl.setLayer(null),t.panel&&!t.panel.div.classList.contains(r.Z.Consts.classes.HIDDEN)&&t.panel.close()}setLayer(t){const e=this;return e.editControl?(e.editControl.setLayer(t),Promise.resolve()):Promise.reject(new Error("Edit control not initialized"))}getLayer(){const t=this;return t.editControl?t.editControl.getLayer():null}async save(t){const e=this,n=(t=t||{}).layer||await e.getLayer();let o,i,a,l,c,u,d,h;const f=async function(){(await i(e.map.workLayers)).forEach((t=>p.delete(t)))};if(n._fileHandle){h=n._fileHandle,d=h,a=d.name,i=async function(t){const e=await Promise.all(t.map((t=>t._fileHandle&&t._fileHandle.isSameEntry(h))));return t.filter(((t,n)=>e[n]))};const p=async function(t){const e={mode:"readwrite"};let n=await t.queryPermission(e);return"granted"!==n&&(n=await t.requestPermission(e)),n};t.showDialog||(u=await p(d)),o=async function(){if(t.showDialog&&window.showSaveFilePicker){const t=s.Z.getMimeTypeFromUrl(d.name),n=e.fileTypes.find((e=>e.accept[t]));try{d=await window.showSaveFilePicker({suggestedName:d.name,types:[n]}),u=await p(d)}catch(t){return void console.log(t.message)}}if("granted"===u){const n=await d.createWritable(),o=await e.map.exportFeatures(c,{fileName:a,format:l});try{await n.write(o),n.close(),await f();let a=0;(await i(e.map.workLayers)).forEach((async n=>{t.showDialog&&(n._fileHandle=d),n.options.groupIndex=a++,await e.saveLayerMetadata(n)})),t.showDialog&&await e.addRecentFile(d),e.map.toast(e.getLocaleString("fileSaved"),{type:r.Z.Consts.msgType.INFO})}catch(t){r.Z.error(t.message)}}}}else a=n.options.fileSystemFile||n.options.file,i=async function(t){return t.filter((t=>n.options.fileSystemFile?t.options.fileSystemFile===n.options.fileSystemFile:t.options.file===n.options.file))},o=async function(){const t=await e.map.exportFeatures(c,{fileName:a,format:l});switch(f(),l){case r.Z.Consts.format.SHAPEFILE:r.Z.Util.downloadBlob(a,t);break;case r.Z.Consts.format.GEOPACKAGE:r.Z.Util.downloadFile(a,"application/geopackage+sqlite3",t);break;case r.Z.Consts.format.KMZ:r.Z.Util.downloadBlob(a,t);break;default:{const e=r.Z.Consts.mimeType[l];r.Z.Util.downloadFile(a,e,t);break}}};if(a){l=r.Z.Util.getFormatFromFileExtension(a.substr(a.lastIndexOf("."))),l||(l=r.Z.Util.getFormatFromFileExtension(n.options.file.substr(n.options.file.lastIndexOf("."))));const t=await i(e.map.workLayers);c=t.map((t=>t.features)).flat();const s=await i(e.map.workLayers.filter((t=>t!==n)));s.length?r.Z.confirm(e.getLocaleString("fileSave.otherLayers.confirm",{layerList:s.map((t=>t.features.length?t.features[0].getPath().join(e.TITLE_SEPARATOR):t.title)).join(", ")}),o):o()}}}customElements.define("sitna-file-edit",d);const h=d},7757:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>d});var r=n(5361),o=n(2089),i=n(5850),a=n(1709),s=n(8330),l=n(7945),c=n(1466),u=n.n(c);r.Z.control=r.Z.control||{},r.Z.Consts=o.Z,r.Z.Util=l.Z;class p extends i.default{constructor(){super(...arguments);const t=this;if(t.CLASS="tc-ctl-file",t.LAYER_METADATA_STORE_KEY_PREFIX="TC.fileLayerMetadata.",t.RECENT_FILES_STORE_KEY_PREFIX="TC.fileImportRecent.",t.template={},t.template[t.CLASS]={1:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=a(n,"unless").call(null!=e?e:t.nullContext||{},o&&a(o,"first"),{name:"unless",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:5,column:163},end:{line:5,column:193}}}))?i:"")+"."+t.escapeExpression(t.lambda(e,e))},2:function(t,e,n,r,o){return","},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+s(l(n,"i18n").call(a,"openFile",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:4},end:{line:1,column:23}}}))+"</h2>\r\n<div>\r\n    <p>"+s(l(n,"i18n").call(a,"fileImport.instructions",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:7},end:{line:3,column:41}}}))+'</p>\r\n    <div class="tc-ctl-file-open">\r\n        <label class="tc-button tc-ctl-file-open-label tc-icon-button"><input type="file" class="tc-ctl-file-open-ipt tc-button" multiple accept="'+(null!=(i=l(n,"each").call(a,null!=e?l(e,"formats"):e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:5,column:146},end:{line:5,column:211}}}))?i:"")+'" />'+s(l(n,"i18n").call(a,"openFile",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:215},end:{line:5,column:234}}}))+'</label>\r\n    </div>\r\n    <ul class="tc-ctl-file-recent"></ul>\r\n</div>\r\n'},useData:!0},t.template[t.CLASS+"-dialog"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-file-dialog tc-modal">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3></h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            '+a(s(n,"i18n").call(i,"fileAccessPrompt",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:12},end:{line:9,column:39}}}))+'\r\n        </div>\r\n        <div class="tc-modal-footer">\r\n            <sitna-button class="tc-ctl-file-dialog-ok" text="'+a(s(n,"i18n").call(i,"ok",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:62},end:{line:12,column:75}}}))+'"></sitna-button>\r\n        </div>\r\n    </div>\r\n</div>\r\n'},useData:!0},t.recentFileCount=8,t.recentFiles=[],t._dialogDiv=r.Z.Util.getDiv(t.options.dialogDiv),t.options.dialogDiv||document.body.appendChild(t._dialogDiv),t.fileTypes=[{accept:{[r.Z.Consts.mimeType.KML]:["."+r.Z.Consts.format.KML]}},{accept:{[r.Z.Consts.mimeType.KMZ]:["."+r.Z.Consts.format.KMZ]}},{accept:{[r.Z.Consts.mimeType.GML]:["."+r.Z.Consts.format.GML,"."+r.Z.Consts.format.GML2]}},{accept:{[r.Z.Consts.mimeType.GEOJSON]:["."+r.Z.Consts.format.GEOJSON,"."+r.Z.Consts.format.JSON]}},{accept:{"text/plain":["."+r.Z.Consts.format.WKT]}},{accept:{[r.Z.Consts.mimeType.ZIP]:[".zip"]}},{accept:{[r.Z.Consts.mimeType.GEOPACKAGE]:["."+r.Z.Consts.format.GEOPACKAGE]}},{accept:{[r.Z.Consts.mimeType.SHAPEFILE]:[".shp",".dbf",".prj",".cst",".cpg"]}},{accept:{[r.Z.Consts.mimeType.GPX]:["."+r.Z.Consts.format.GPX]}}],Array.isArray(t.options.formats)){t.formats=t.options.formats;const e=t.format.map((t=>r.Z.Util.getMimeTypeFromUrl(t)));t.fileTypes=t.fileTypes.filter((t=>{t.accept.keys.some((t=>e.includes(t)))}))}else t.formats=t.fileTypes.reduce(((t,e)=>{for(var n in e.accept)t=t.concat(e.accept[n].map((t=>t.substr(1))));return t}),[]);t.apiAttribution="",t.mainDataAttribution="",t.dataAttributions=[],t.exportsState=!0}register(t){const e=this,n=super.register.call(e,t);return e.registerLayerAdd(),e.options.enableDragAndDrop&&t.wrap.enableDragAndDrop(e.options),t._bufferFeatures=[],document.addEventListener("paste",(async n=>{if(n.clipboardData.files&&n.clipboardData.files.length){let t=n.clipboardData.files;if(DataTransferItem.prototype.getAsFileSystemHandle){t=[];for(var o=0,i=n.clipboardData.items.length;o<i;++o){const e=n.clipboardData.items[o],r=await e.getAsFileSystemHandle();r&&t.push(r)}}e.loadFiles(t)}else n.clipboardData.items.length||t.toast(e.getLocaleString("fileImport.pasteNotSupported"),{type:r.Z.Consts.msgType.WARNING})})),t.on(r.Z.Consts.event.FEATURESIMPORT,(async function(n){const o=n.fileName,i=n.fileHandle,a=n.dropTarget,s=n.features,l=n.timeStamp,c=n.groupIndex,u=n.fileSystemFile&&n.fileSystemFile.name,p=function(t){const n=t.geometry;if(n){var o;switch(!0){case r.Z.feature.Point&&t instanceof r.Z.feature.Point:o=[n];break;case r.Z.feature.MultiPoint&&t instanceof r.Z.feature.MultiPoint:case r.Z.feature.Polyline&&t instanceof r.Z.feature.Polyline:o=n;break;case r.Z.feature.MultiPolyline&&t instanceof r.Z.feature.MultiPolyline:case r.Z.feature.Polygon&&t instanceof r.Z.feature.Polygon:o=n.flat();break;case r.Z.feature.MultiPolygon&&t instanceof r.Z.feature.MultiPolygon:o=n.flat(2)}o&&o.every((function(t){return Math.abs(t[0])<=180&&Math.abs(t[1])<=90}))&&t.setCoords(r.Z.Util.reproject(n,"EPSG:4326",e.map.crs))}return t};var d="."+r.Z.Consts.format.GPX.toLowerCase();if(o.toLowerCase().indexOf(d)===o.length-d.length||a&&a!==e.map.div&&a!==e)return;const h=n=>t.addLayer({id:n||e.getUID(i||l),title:o,owner:e,type:r.Z.Consts.layerType.VECTOR,file:o,groupIndex:c,fileSystemFile:u});let f=n.targetLayers||[];f.length||f.push(await h());for(var m=0;m<f.length;m++){const t=f[m],n=e.map.getLayer(t)||await h(t.id),r=await e.loadLayerMetadata(n);r&&r.groupIndex!==c?f[m]=!1:f[m]=n}f=f.filter((t=>t)),t._fileDropLoadingIndicator=t.getLoadingIndicator().addWait(t._fileDropLoadingIndicator),f.forEach((async function(o){if(i&&(o._fileHandle=i,n.additionalFileHandles&&(o._additionalFileHandles=n.additionalFileHandles),await e.saveLayerMetadata(o),!n.targetLayers)){let t={mainHandle:i};o._additionalFileHandles&&(t.additionalHandles=o._additionalFileHandles),await e.addRecentFileEntry(t)}o._timeStamp=l,o.owner=e,e.getLayers().push(o);const a=o.id+".",c=s.map((t=>t.getId()));o.addFeatures(s.map(p).map((function(t,e){const n=t.getId();if(c.filter(((t,n)=>n!==e)).includes(n)){const n=r.Z.getUID({prefix:a,banlist:c});c[e]=n,t.setId(n)}return t}))).then((()=>e.subtrackPendingFile())),n.targetLayer||(t._bufferFeatures=t._bufferFeatures.concat(o.features))}))})).on(r.Z.Consts.event.FEATURESIMPORTERROR,(function(t){var n,o=t.file.name;n=".kmz"===o.toLowerCase().substr(o.length-4)?"fileImport.error.reasonKmz":"fileImport.error.reasonUnknown",r.Z.error(t.message?e.getLocaleString(t.message):e.getLocaleString(n,{fileName:o}),r.Z.Consts.msgErrorMode.TOAST),(new FileReader).onload=function(t){r.Z.error("Nombre del archivo: "+o+" \n Contenido del archivo: \n\n"+t.target.result,r.Z.Consts.msgErrorMode.EMAIL,"Error en la subida de un archivo")},e.subtrackPendingFile()})).on(r.Z.Consts.event.FEATURESIMPORTPARTIAL,(function(t){e.map.toast(e.getLocaleString("fileImport.partial.problem",{fileName:t.file.name,table:t.table,reason:t.reason}),{type:r.Z.Consts.msgType.ERROR})})).on(r.Z.Consts.event.FEATURESIMPORTWARN,(function(t){e.map.toast(e.getLocaleString("fileImport.geomEmpty",{fileName:t.file.name}),{type:r.Z.Consts.msgType.WARNING})})).on(r.Z.Consts.event.LAYERADD,(function(t){e.loadLayersFromFile([t.layer])})).on(r.Z.Consts.event.LAYERREMOVE,(function(t){t.layer.owner===e&&e.deleteLayerMetadata(t.layer);const n=e.getLayers(),r=n.indexOf(t.layer);r>=0&&n.splice(r,1)})),t.loaded((()=>{e.loadLayersFromFile(t.workLayers)})),n}render(){const t=this;return t._set1stRenderPromise(new Promise((function(e,n){t.renderData({formats:t.formats},(function(){const n=t.querySelector("input[type=file]");n.addEventListener(r.Z.Consts.event.CLICK,(async function(e){const n=this,o=document.createElement("form"),i=n.parentElement;if(i.insertBefore(o,n),o.appendChild(n),o.reset(),o.insertAdjacentElement("afterend",n),i.removeChild(o),r.Z.Util.isFunction(window.showOpenFilePicker)){let n;e.preventDefault();try{n=await window.showOpenFilePicker({multiple:!0})}catch(e){if(!(e instanceof AbortError))throw e}n&&t.loadFiles(n)}})),n.addEventListener("change",(function(e){t.map&&t.loadFiles(e.target.files)})),t.renderRecentFileList(),t.getRenderedHtml(t.CLASS+"-dialog",null,(function(n){t._dialogDiv.innerHTML=n,e(t)}))}))})))}loadFiles(t){const e=this;return e.map.loadFiles(t,{control:e}),e}async loadLayersFromFile(t){const e=this,n=t.filter((t=>e.getIdCount(t.id)&&!t.options.owner&&t.options.file));if(n.length){const a=[],s=Math.max(...n.map((t=>e.getIdCount(t.id))));r.Z.setUIDStart(s+1,{prefix:e.id+"-"});const l=await Promise.all(n.map((t=>e.loadLayerMetadata(t))));n.forEach(((t,e)=>{t.options.groupIndex=l[e]?.groupIndex}));const c=new Map,u=new Map;for(var o=0;o<l.length;o++){const r=l[o];if(r?.fileHandle){let t;for(const[e,n]of c.entries())if(await e.isSameEntry(r.fileHandle)){t=n;break}t||(t=[],c.set(r.fileHandle,t),a.push(r.fileHandle),r.additionalFileHandles&&u.set(r.fileHandle,r.additionalFileHandles)),t.push(n[o])}else e.map.removeLayer(t[o])}await e.renderPromise();const p=e._dialogDiv.querySelector(".tc-ctl-file-dialog"),d=p.querySelector("h3"),h=e._dialogDiv.querySelector("sitna-button.tc-ctl-file-dialog-ok"),f=t=>{e.map.loadFiles(t,{layers:c.get(t[0]),target:e})};for(const t of c.keys()){let e=[t];const n=u.get(t);n&&(e=e.concat(n));const o=[];for await(let t of e.map((t=>t.queryPermission())))o.push(t);let a=!1;for(var i=0;i<o.length;i++){if("prompt"===o[i]){a=!0;const t=e[i];if(d.innerHTML.length){d.innerHTML.split(", ").includes(t.name)||(d.innerHTML=d.innerHTML+", "+t.name)}else d.innerHTML=t.name}}const s=t=>"granted"===t;a?(r.Z.Util.showModal(p),h.addEventListener("click",(async function(t){for(var n=0;n<o.length;n++)o[n]=await e[n].requestPermission();o.every(s)&&f(e),d.innerHTML="",r.Z.Util.closeModal()}))):o.every(s)&&f(e)}}}exportState(){const t=this;return t.exportsState&&t.getLayers().length?{id:t.id,layers:t.getLayers().map((function(t){const e={title:t.title,state:r.Z.Util.extend(t.exportState(),{path:t.features?.length?t.features[0].getPath():void 0})};return t._fileHandle&&(e.file=t._fileHandle.name),e}))}:null}async importState(t){const e=this;if(e.map){const i=[];await e.loadLayersFromFile(e.map.workLayers),t.layers.filter((function(t){return!e.map.workLayers.some((e=>e.options.file&&t.file===e.options.file))})).forEach((function(t){i.push(e.map.addLayer({id:e.getUID(),title:t.title,owner:e,type:r.Z.Consts.layerType.VECTOR}))}));const a=await Promise.all(i);for(var n=0,o=a.length;n<o;n++){const r=a[n],o=n;r.importState(t.layers[n].state).then((function(){for(var e=0;e<r.features.length;e++)r.features[e].folders=t.layers[o].state.path})),e.getLayers().push(r)}}}async saveLayerMetadata(t){const e={fileHandle:t._fileHandle,groupIndex:t.options.groupIndex};t._additionalFileHandles&&(e.additionalFileHandles=t._additionalFileHandles);const n=u().setItem(this.LAYER_METADATA_STORE_KEY_PREFIX+this.map.id+"-"+t.id,e);return n.catch((function(t){console.warn(t.message)})),await n}async loadLayerMetadata(t){const e=this;let n={};try{n=await u().getItem(e.LAYER_METADATA_STORE_KEY_PREFIX+e.map.id+"-"+t.id)}catch(t){console.warn(t.message)}return n}deleteLayerMetadata(t){const e=this;return u().removeItem(e.LAYER_METADATA_STORE_KEY_PREFIX+e.map.id+"-"+t.id).catch((function(t){console.warn(t.message)})),e}async loadRecentFiles(){const t=this,e=[];for(var n=0;n<t.recentFileCount;n++)try{e.push(u().getItem(t.RECENT_FILES_STORE_KEY_PREFIX+n))}catch(t){console.warn(t.message)}const r=[];for await(const t of e)t&&r.push(t);return t.recentFiles=r,r}storeRecentFiles(t){const e=this;t=t||e.recentFiles;for(var n=0;n<e.recentFileCount;n++)if(n<t.length){const r=t[n];try{u().setItem(e.RECENT_FILES_STORE_KEY_PREFIX+n,r)}catch(t){console.warn(t.message)}}else try{u().removeItem(e.RECENT_FILES_STORE_KEY_PREFIX+n)}catch(t){console.warn(t.message)}return e.recentFiles=t,e}async addRecentFileEntry(t){const e=this;let n=!1;for await(const r of e.recentFiles.map((e=>(e.mainHandle||e).isSameEntry(t.mainHandle))))if(r){n=!0;break}if(n){const n=e.recentFiles.findIndex((e=>(e.mainHandle?.name||e.name)===t.mainHandle.name));e.recentFiles.splice(n,1)}else e.recentFiles.length>=e.recentFileCount&&e.recentFiles.pop();e.recentFiles.unshift(t),await e.storeRecentFiles(e.recentFiles),e.renderRecentFileList()}async removeRecentFileEntry(t){const e=this;e.recentFiles.splice(t,1),await e.storeRecentFiles(e.recentFiles),e.renderRecentFileList()}async loadRecentFileEntry(t){const e=this,n=e.recentFiles[t];if(n){for await(const t of e.map.workLayers.filter((t=>t._fileHandle)).map((t=>{const e=n.mainHandle||n;return t._fileHandle.isSameEntry(e)})))t&&e.map.toast(e.getLocaleString("fileLoadedMoreThanOnce"),{type:r.Z.Consts.msgType.WARNING});let t=[n.mainHandle||n];n.additionalHandles&&(t=t.concat(n.additionalHandles));const i=[];for await(let e of t.map((t=>t.queryPermission())))i.push(e);for(var o=0;o<i.length;o++){"prompt"===i[o]&&(i[o]=await t[o].requestPermission())}if(i.every((t=>"granted"===t)))return e.loadFiles(t),n}return null}renderRecentFileList(t){const e=this,n=function(t){e.loadRecentFileEntry(t.target.dataset.fileIndex)},o=function(t){e.removeRecentFileEntry(t.target.dataset.fileIndex)},i=e.querySelector(".tc-ctl-file-recent");if(i){const s=e.getLocaleString("removeFromList");(t?Promise.resolve(t):e.loadRecentFiles()).then((t=>{if(i.replaceChildren(),t.length){const t=document.createElement("li"),n=document.createElement("h3");n.innerHTML=e.getLocaleString("recentFiles"),t.appendChild(n),i.appendChild(t)}t.forEach(((t,e)=>{const l=document.createElement("li"),c=document.createElement("sitna-button");c.dataset.fileIndex=e,c.addEventListener(r.Z.Consts.event.CLICK,n),c.setAttribute("variant",a.Z.variant.LINK),c.setAttribute("text",t.mainHandle?.name||t.name),l.appendChild(c);const u=document.createElement("sitna-button");u.text=s,u.dataset.fileIndex=e,u.addEventListener(r.Z.Consts.event.CLICK,o),u.setAttribute("variant",a.Z.variant.MINIMAL),u.setAttribute("icon",a.Z.action.CLOSE),l.appendChild(u),i.appendChild(l)}))}))}}subtrackPendingFile=function(){const t=this;window.dropFilesCounter--,0===window.dropFilesCounter&&(t.map.zoomToFeatures(t.map._bufferFeatures),t.map._bufferFeatures=[],delete window.dropFilesCounter);var e=t.map.getLoadingIndicator();return e&&(t.map._featureImportWaitId&&e.removeWait(t.map._featureImportWaitId),t.map._fileDropLoadingIndicator&&e.removeWait(t.map._fileDropLoadingIndicator)),t};getUID=function(t){const e=this;if(t){const n=Object.prototype.hasOwnProperty.call(window,"FileSystemFileHandle")?"_fileHandle":"_timeStamp",o=e.getLayers().reduce(((t,e)=>t.findByProperty(n,e[n])&&t.some((t=>/^[\w]*-\d-\d/gi.exec(e.id)[0]===/^[\w]*-\d-\d/gi.exec(t.id)[0]))?t:t.concat(e)),[]);return r.Z.getUID({prefix:e.id+"-"+(o.filter((e=>e[n]!=t)).length+1)+"-"})}return r.Z.getUID({prefix:e.id+"-"})}}r.Z.mix(p,s.default),customElements.define("sitna-file-import",p);const d=p},1115:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>a});var r=n(5361),o=n(2089),i=n(6498);r.Z.control=r.Z.control||{},r.Z.Control=i.Z,r.Z.Consts=o.Z,r.Z.control.FullScreen=function(){var t=this;r.Z.Control.apply(t,arguments)},r.Z.inherit(r.Z.control.FullScreen,r.Z.Control),function(){var t=r.Z.control.FullScreen.prototype;t.CLASS="tc-ctl-fscreen",t.template={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<button type="button" class="tc-ctl-fscreen-btn tc-float-btn" title="'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"fscreen.tip",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:69},end:{line:1,column:91}}}))+'"></button>'},useData:!0};const e={fullscreenEnabled:0,fullscreenElement:1,requestFullscreen:2,exitFullscreen:3,fullscreenchange:4,fullscreenerror:5},n=["webkitFullscreenEnabled","webkitFullscreenElement","webkitRequestFullscreen","webkitExitFullscreen","webkitfullscreenchange","webkitfullscreenerror"],o=["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozfullscreenerror"],i=["msFullscreenEnabled","msFullscreenElement","msRequestFullscreen","msExitFullscreen","MSFullscreenChange","MSFullscreenError"],a="undefined"!=typeof window&&void 0!==window.document?window.document:{},s="fullscreenEnabled"in a&&Object.keys(e)||n[0]in a&&n||o[0]in a&&o||i[0]in a&&i||[];t.fscreen={inFullscreen:!1,requestFullscreen:t=>t[s[e.requestFullscreen]](),requestFullscreenFunction:t=>t[s[e.requestFullscreen]],get exitFullscreen(){return a[s[e.exitFullscreen]].bind(a)},addEventListener:(t,n,r)=>a.addEventListener(s[e[t]],n,r),removeEventListener:(t,n,r)=>a.removeEventListener(s[e[t]],n,r),get fullscreenEnabled(){return Boolean(a[s[e.fullscreenEnabled]])},set fullscreenEnabled(t){},get fullscreenElement(){return a[s[e.fullscreenElement]]},set fullscreenElement(t){},get onfullscreenchange(){return a[("on"+s[e.fullscreenchange]).toLowerCase()]},set onfullscreenchange(t){return a[("on"+s[e.fullscreenchange]).toLowerCase()]=t},get onfullscreenerror(){return a["on"+s[e.fullscreenerror].toLowerCase()]},set onfullscreenerror(t){return a["on"+s[e.fullscreenerror].toLowerCase()]=t}},t.register=function(t){const e=this,n=r.Z.Control.prototype.register.call(e,t);return n.then((function(){const t=e.div.querySelector("."+e.CLASS+"-btn");if(e.fscreen.fullscreenEnabled){const n=()=>{t.classList.toggle(r.Z.Consts.classes.ACTIVE,e.fscreen.inFullscreen),t.setAttribute("title",e.fscreen.inFullscreen?e.getLocaleString("fscreen.tip.return"):e.getLocaleString("fscreen.tip"))};e.fscreen.addEventListener("fullscreenchange",(()=>{e.fscreen.inFullscreen=null!==e.fscreen.fullscreenElement,n()}),!1),t.addEventListener("click",(function(){e.byBtn=!0,e.fscreen.inFullscreen?e.fscreen.exitFullscreen():e.fscreen.requestFullscreen(a.body)}),!1),r.Z.Util.detectMobile()||window.addEventListener("resize",(()=>{if(e.byBtn)return void(e.byBtn=!1);const r=window.innerWidth*window.devicePixelRatio,o=window.innerHeight*window.devicePixelRatio,i=window.screen.width,s=window.screen.height;e.fscreen.inFullscreen=r/i>=.95&&o/s>=.95,n();let l=a.body.getElementsByTagName("header");e.fscreen.inFullscreen?(t.setAttribute("disabled","disabled"),l.length>0&&l[0].classList.add("tc-ctl-fscreenToHeader"),e.map.div.classList.add("tc-ctl-fscreenToMap"),e.map.view3D&&e.map.view3D.container.classList.add("tc-ctl-fscreenToMap")):(t.removeAttribute("disabled"),l.length>0&&l[0].classList.remove("tc-ctl-fscreenToHeader"),e.map.div.classList.remove("tc-ctl-fscreenToMap"),e.map.view3D&&e.map.view3D.container.classList.remove("tc-ctl-fscreenToMap")),t.setAttribute("title",e.fscreen.inFullscreen?e.getLocaleString("fscreen.tip.keyboard"):e.getLocaleString("fscreen.tip"));const c=a.createEvent("HTMLEvents");c.initEvent("resize",!1,!1),e.map.div.dispatchEvent(c)}))}else e.disable()})),n}}();const a=r.Z.control.FullScreen},8924:(t,n,r)=>{"use strict";r.r(n),r.d(n,{default:()=>u});var o=r(1466),i=r.n(o),a=r(5361),s=r(2089),l=r(6498),c=r(7901);a.Z.control=a.Z.control||{},a.Z.control.infoShare=c.default,a.Z.Control=l.Z,a.Z.Consts=s.Z,Math.hypot=Math.hypot||function(){for(var t=0,e=arguments.length,n=0;n<e;n++){if(arguments[n]===1/0||arguments[n]===-1/0)return 1/0;t+=arguments[n]*arguments[n]}return Math.sqrt(t)},function(){for(var t=0,e=["ms","moz","webkit","o"],n=!(!window.performance||!window.performance.now),r=0,o=e.length;r<o&&!window.requestAnimationFrame;r+=1)window.requestAnimationFrame=window[e[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[r]+"CancelAnimationFrame"]||window[e[r]+"CancelRequestAnimationFrame"];if(window.requestAnimationFrame||(window.requestAnimationFrame=function(e,n){var r=(new Date).getTime(),o=Math.max(0,16-(r-t)),i=window.setTimeout((function(){e(r+o)}),o);return t=r+o,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)}),!n){var i=window.requestAnimationFrame,a=+new Date;window.requestAnimationFrame=function(t,e){i((function(e){return t(e<1e12?e:e-a)}),e)}}}(),window.performance?window.performance&&!window.performance.now&&(window.performance.offset=Date.now(),window.performance.now=function(){return Date.now()-window.performance.offset}):window.performance={offset:Date.now(),now:function(){return Date.now()-this.offset}},a.Z.Consts.event.DIALOG=a.Z.Consts.event.DIALOG||"dialog.tc",a.Z.Consts.classes.UNPLUGGED="tc-unplugged",a.Z.control.Geolocation=function(t){var e=this;e._classSelector="."+e.CLASS,e._layerPromises={},e.Const={Classes:{ACTIVE:"tc-ctl-geolocation-active",CLOSED:"closed",SELECTEDTRACK:"selectedTrack",DRAWACTIVATED:"draw-activated",SIMULATIONACTIVATED:"simulation-activated"},Selector:{DRAW:".tc-draw",EDIT:".tc-btn-edit",DELETE:".tc-btn-delete",SAVE:".tc-btn-save",CANCEL:".tc-btn-cancel",EXPORT:".tc-btn-export",SHARE:".tc-btn-share",STOP:".tc-btn-stop",PAUSE:".tc-btn-pause",BACKWARD:".tc-btn-backward",FORWARD:".tc-btn-forward",SPEED:".tc-spn-speed",VISIBILITY:"tc-chk-track-visibility"},LocalStorageKey:{TRACKING:"trk",TRACKINGTEMP:"trktemp",TRACKINGSHOWADVERTISEMENT:"trkAdvertisement",GPSSHOWADVERTISEMENT:"gpsAdvertisement",TEST:"test"},Message:{VALIDATENAME:""},Event:{POSITIONCHANGE:"positionchange.tc.geolocation",GPSPOSITIONCHANGE:"gpspositionchange.tc.geolocation",GPSPOSITIONERROR:"positionerror.tc.geolocation",STATEUPDATED:"stateupdated.tc.geolocation",GPSADD:"gpsadd.tc.geolocation",TRACKSNAPPING:"tracksnapping.tc.geolocation",DRAWTRACK:"drawtrack.tc.geolocation",CLEARTRACK:"cleartrack.tc.geolocation",IMPORTEDTRACK:"importedtrack.tc.geolocation"},MimeMap:{KML:"application/vnd.google-earth.kml+xml",GPX:"application/gpx+xml"},SupportedFileExtensions:[".kml",".gpx"],Tabs:{GPS:"gps"},Layers:{GPS:"gps",TRACK:"track",TRACKING:"tracking"}},a.Z.Control.apply(e,arguments);var n=t||{};e._dialogDiv=a.Z.Util.getDiv(n.dialogDiv),window.$&&(e._$dialogDiv=$(e._dialogDiv)),n.dialogDiv||document.body.appendChild(e._dialogDiv),e._shareDialogDiv=a.Z.Util.getDiv({}),document.body.appendChild(e._shareDialogDiv),e.delta=500,e.walkingSpeed=5e3,e.snappingTolerance=e.options.snappingTolerance||50,e.notificationConf={},e.exportsState=!0,e.storageCRS="EPSG:4326",e.simulate_stopped=!0},a.Z.inherit(a.Z.control.Geolocation,a.Z.Control),a.Z.mix(a.Z.control.Geolocation,a.Z.control.infoShare),function(){var t=a.Z.control.Geolocation.prototype;t.CLASS="tc-ctl-geolocation",t.CHART_SIZE={MIN_HEIGHT:75,MAX_HEIGHT:128,MIN_WIDTH:315,MEDIUM_WIDTH:310,MAX_WIDTH:445},t.featuresToShare=[],a.Z.Consts.event.TOOLSCLOSE=a.Z.Consts.event.TOOLSCLOSE||"toolsclose.tc",a.Z.Consts.event.TOOLSOPEN=a.Z.Consts.event.TOOLSOPEN||"toolsopen.tc",t.template={},t.template[t.CLASS]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lambda,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+a(l(n,"i18n").call(i,"geo",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:4},end:{line:1,column:18}}}))+'</h2>\r\n<div class="tc-ctl-geolocation-content">    \r\n    <div class="tc-ctl-geolocation-track">\r\n        <div class="tc-ctl-geolocation-track-snap-info"></div>                \r\n        <div class="tc-ctl-geolocation-track-panel-block" >\r\n            <input id="tc-ctl-geolocation-track-panel-opened-'+a(s(null!=e?l(e,"controlId"):e,e))+'" type="checkbox" checked/>\r\n            <label for="tc-ctl-geolocation-track-panel-opened-'+a(s(null!=e?l(e,"controlId"):e,e))+'" title="'+a(l(n,"i18n").call(i,"geo.trk.panel.help.1",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:84},end:{line:7,column:115}}}))+'">'+a(l(n,"i18n").call(i,"geo.trk.panel.help.2",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:117},end:{line:7,column:148}}}))+'</label>\r\n            <i class="tc-ctl-geolocation-track-panel-help icon-question-sign" title="'+a(l(n,"i18n").call(i,"geo.trk.panel.help.3",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:85},end:{line:8,column:116}}}))+'"></i>\r\n        </div>\r\n        <div class="tc-ctl-geolocation-track-mng">\r\n            <div class="tc-ctl-geolocation-select">\r\n                <label class="tc-ctl-geolocation-btn-track" title="'+a(l(n,"i18n").call(i,"geo.track.title",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:67},end:{line:12,column:93}}}))+'"><input type="radio" name="'+a(s(null!=e?l(e,"controlId"):e,e))+'-mode" checked value="tracks" /><span>'+a(l(n,"i18n").call(i,"geo.gps",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:172},end:{line:12,column:190}}}))+'</span></label><label \r\n\t\t\t\tclass="tc-ctl-geolocation-btn-tracks" title="'+a(l(n,"i18n").call(i,"geo.tracks.title",{name:"i18n",hash:{},data:o,loc:{start:{line:13,column:49},end:{line:13,column:76}}}))+'"><input type="radio" name="'+a(s(null!=e?l(e,"controlId"):e,e))+'-mode" value="track-available" /><span>'+a(l(n,"i18n").call(i,"geo.tracks",{name:"i18n",hash:{},data:o,loc:{start:{line:13,column:156},end:{line:13,column:177}}}))+'</span></label>                    \r\n            </div>                        \r\n            <div class="tc-ctl-geolocation-track-available tc-ctl-geolocation-track-cnt tc-ctl-geolocation-panel tc-hidden">\r\n                <i class="tc-ctl-geolocation-track-search-icon"></i>\r\n                <input id="tc-ctl-geolocation-track-available-srch" type="search" list="tc-ctl-geolocation-track-available-lst" class="tc-ctl-geolocation-track-available-srch tc-textbox" placeholder="'+a(l(n,"i18n").call(i,"geo.filter.plhr",{name:"i18n",hash:{},data:o,loc:{start:{line:17,column:200},end:{line:17,column:226}}}))+'" maxlength="200" />                \r\n                <ol id="tc-ctl-geolocation-track-available-lst" class="tc-ctl-geolocation-track-available-lst">\r\n                    <li class="tc-ctl-geolocation-track-available-empty"><span>'+a(l(n,"i18n").call(i,"geo.noTracks",{name:"i18n",hash:{},data:o,loc:{start:{line:19,column:79},end:{line:19,column:102}}}))+'</span></li>\r\n                    <li class="tc-ctl-geolocation-track-not" hidden><span>'+a(l(n,"i18n").call(i,"noMatches",{name:"i18n",hash:{},data:o,loc:{start:{line:20,column:74},end:{line:20,column:94}}}))+'</span></li>\r\n                </ol>\r\n                <div class="tc-ctl-geolocation-track-cnt">\r\n                    <input name="uploaded-file" id="uploaded-file-'+a(s(null!=e?l(e,"controlId"):e,e))+'" type="file" class="tc-ctl-geolocation-track-import tc-button" accept=".gpx,.kml,.kmz" disabled />\r\n                    <label class="tc-button tc-icon-button" for="uploaded-file-'+a(s(null!=e?l(e,"controlId"):e,e))+'" title="'+a(l(n,"i18n").call(i,"geo.trk.import.upload",{name:"i18n",hash:{},data:o,loc:{start:{line:24,column:101},end:{line:24,column:134}}}))+'">'+a(l(n,"i18n").call(i,"geo.trk.import.lbl",{name:"i18n",hash:{},data:o,loc:{start:{line:24,column:136},end:{line:24,column:165}}}))+'</label>\r\n                </div>\r\n            </div>\r\n            <div class="tc-ctl-geolocation-tracks tc-ctl-geolocation-panel">    \r\n                <div class="tc-alert alert-warning tc-hidden" >\r\n                    <p id="panel-msg">\r\n                        '+a(l(n,"i18n").call(i,"geo.trk.panel.1",{name:"i18n",hash:{},data:o,loc:{start:{line:30,column:24},end:{line:30,column:50}}}))+"                    \r\n                        <ul>\r\n                            <li>"+a(l(n,"i18n").call(i,"geo.trk.panel.2",{name:"i18n",hash:{},data:o,loc:{start:{line:32,column:32},end:{line:32,column:58}}}))+"</li>\r\n                            <li>"+a(l(n,"i18n").call(i,"geo.trk.panel.3",{name:"i18n",hash:{},data:o,loc:{start:{line:33,column:32},end:{line:33,column:58}}}))+"</li>\r\n                            <li>"+a(l(n,"i18n").call(i,"geo.trk.panel.4",{name:"i18n",hash:{},data:o,loc:{start:{line:34,column:32},end:{line:34,column:58}}}))+"</li>\r\n                            <li>"+a(l(n,"i18n").call(i,"geo.trk.panel.5",{name:"i18n",hash:{},data:o,loc:{start:{line:35,column:32},end:{line:35,column:58}}}))+'</li>\r\n                        </ul>\r\n                    </p>\r\n                </div>            \r\n                <div class="tc-ctl-geolocation-track-ui">   \r\n                    <div  class="tc-ctl-geolocation-track-render">\r\n                        <input id="tc-ctl-geolocation-track-render-'+a(s(null!=e?l(e,"controlId"):e,e))+'" type="checkbox" hidden checked />\r\n                        <label for="tc-ctl-geolocation-track-render-'+a(s(null!=e?l(e,"controlId"):e,e))+'" class="tc-ctl-geolocation-track-render" title="'+a(l(n,"i18n").call(i,"geo.trk.render",{name:"i18n",hash:{},data:o,loc:{start:{line:42,column:130},end:{line:42,column:155}}}))+'">'+a(l(n,"i18n").call(i,"geo.trk.render",{name:"i18n",hash:{},data:o,loc:{start:{line:42,column:157},end:{line:42,column:182}}}))+'</label>\r\n                    </div>\r\n                    <button type="button" class="tc-button tc-icon-button tc-ctl-geolocation-track-ui-activate" title="'+a(l(n,"i18n").call(i,"geo.track.activate.title",{name:"i18n",hash:{},data:o,loc:{start:{line:44,column:119},end:{line:44,column:154}}}))+'">'+a(l(n,"i18n").call(i,"geo.track.activate",{name:"i18n",hash:{},data:o,loc:{start:{line:44,column:156},end:{line:44,column:185}}}))+'</button>\r\n                    <button type="button" class="tc-button tc-icon-button tc-ctl-geolocation-track-ui-deactivate tc-hidden" title="'+a(l(n,"i18n").call(i,"geo.track.deactivate.title",{name:"i18n",hash:{},data:o,loc:{start:{line:45,column:131},end:{line:45,column:169}}}))+'">'+a(l(n,"i18n").call(i,"geo.track.deactivate",{name:"i18n",hash:{},data:o,loc:{start:{line:45,column:171},end:{line:45,column:202}}}))+'</button>\r\n                </div>\r\n                <div  class="tc-ctl-geolocation-track-current tc-ctl-geolocation-track-cnt">\r\n                    <input type="text" class="tc-ctl-geolocation-track-title tc-textbox" disabled placeholder="'+a(l(n,"i18n").call(i,"geo.trk.name.plhr",{name:"i18n",hash:{},data:o,loc:{start:{line:48,column:111},end:{line:48,column:139}}}))+'" maxlength="200" /><button \r\n\t\t\t\t\ttype="button" class="tc-button tc-icon-button tc-ctl-geolocation-track-save" disabled title="'+a(l(n,"i18n").call(i,"geo.trk.name.save",{name:"i18n",hash:{},data:o,loc:{start:{line:49,column:98},end:{line:49,column:126}}}))+'"></button>\r\n                    <input type="text" class="tc-ctl-geolocation-track-waypoint tc-textbox" disabled placeholder="'+a(l(n,"i18n").call(i,"geo.trk.wyp.plhr",{name:"i18n",hash:{},data:o,loc:{start:{line:50,column:114},end:{line:50,column:141}}}))+'" maxlength="200" /><button \r\n\t\t\t\t\ttype="button" class="tc-button tc-icon-button tc-ctl-geolocation-track-add-wpt" disabled title="'+a(l(n,"i18n").call(i,"geo.trk.wyp.save",{name:"i18n",hash:{},data:o,loc:{start:{line:51,column:101},end:{line:51,column:128}}}))+'"></button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="tc-ctl-geolocation-track-center tc-hidden">\r\n    <button type="button" class="tc-float-btn" title="'+a(l(n,"i18n").call(i,"geo.trk.center",{name:"i18n",hash:{},data:o,loc:{start:{line:58,column:54},end:{line:58,column:79}}}))+'"></button>\r\n</div>\r\n\r\n\r\n'},useData:!0},t.template[t.CLASS+"-track-node"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=t.lambda,a=t.escapeExpression,s=null!=e?e:t.nullContext||{},l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li data-id="'+a(i(null!=e?l(e,"id"):e,e))+'" data-uid="'+a(i(null!=e?l(e,"uid"):e,e))+'">\r\n    <span class="tc-draw tc-selectable" title="'+a(i(null!=e?l(e,"name"):e,e))+'">'+a(i(null!=e?l(e,"name"):e,e))+'</span>\r\n    <input class="tc-textbox tc-hidden" type="text" value="'+a(i(null!=e?l(e,"name"):e,e))+'" />\r\n    <button type="button" class="tc-btn-share" title="'+a(l(n,"i18n").call(s,"tr.lst.share",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:54},end:{line:4,column:78}}}))+'"></button>\r\n    \x3c!--<button type="button" class="tc-btn-simulate" title="'+a(l(n,"i18n").call(s,"tr.lst.simulate",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:61},end:{line:5,column:88}}}))+'"></button>--\x3e\r\n\r\n    <button type="button" class="tc-btn-save tc-hidden" title="'+a(l(n,"i18n").call(s,"save",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:63},end:{line:7,column:79}}}))+'"></button>\r\n    <button type="button" class="tc-btn-cancel tc-hidden" title="'+a(l(n,"i18n").call(s,"tr.lst.cancel",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:65},end:{line:8,column:90}}}))+'"></button>\r\n    <button type="button" class="tc-btn-edit" title="'+a(l(n,"i18n").call(s,"tr.lst.edit",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:53},end:{line:9,column:76}}}))+'"></button>\r\n    <button type="button" class="tc-btn-export" title="'+a(l(n,"i18n").call(s,"tr.lst.download",{name:"i18n",hash:{},data:o,loc:{start:{line:10,column:55},end:{line:10,column:82}}}))+'"></button>\r\n    <button type="button" class="tc-btn-delete" title="'+a(l(n,"i18n").call(s,"tr.lst.delete",{name:"i18n",hash:{},data:o,loc:{start:{line:11,column:55},end:{line:11,column:80}}}))+'"></button>    \r\n    <div>\r\n        <button type="button" class="tc-btn-stop" title="'+a(l(n,"i18n").call(s,"tr.lst.stop",{name:"i18n",hash:{},data:o,loc:{start:{line:13,column:57},end:{line:13,column:80}}}))+'"></button>\r\n        <button type="button" class="tc-btn-pause play" title="'+a(l(n,"i18n").call(s,"tr.lst.start",{name:"i18n",hash:{},data:o,loc:{start:{line:14,column:63},end:{line:14,column:87}}}))+'"></button>\r\n        <button type="button" class="tc-btn-backward" title="'+a(l(n,"i18n").call(s,"tr.lst.backward",{name:"i18n",hash:{},data:o,loc:{start:{line:15,column:61},end:{line:15,column:88}}}))+'"></button>\r\n        <label class="tc-spn-speed" title="'+a(l(n,"i18n").call(s,"tr.lst.velocity",{name:"i18n",hash:{},data:o,loc:{start:{line:16,column:43},end:{line:16,column:70}}}))+'"></label>\r\n        <button type="button" class="tc-btn-forward" title="'+a(l(n,"i18n").call(s,"tr.lst.forward",{name:"i18n",hash:{},data:o,loc:{start:{line:17,column:60},end:{line:17,column:86}}}))+'"></button>\r\n        <input type="checkbox" class="tc-toggle tc-chk-track-visibility" checked="checked" title="'+a(l(n,"i18n").call(s,"tr.lst.view",{name:"i18n",hash:{},data:o,loc:{start:{line:18,column:98},end:{line:18,column:121}}}))+'">\r\n    </div>\r\n</li>\r\n'},useData:!0},t.template[t.CLASS+"-track-snapping-node"]={1:function(t,e,n,r,o){var i=t.escapeExpression,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    <li>\r\n        <span>"+i(a(n,"i18n").call(null!=e?e:t.nullContext||{},"geo.trk.snapping.name",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:14},end:{line:4,column:46}}}))+":</span> "+i(t.lambda(null!=e?a(e,"n"):e,e))+"\r\n    </li>\r\n"},3:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"lon",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:28},end:{line:7,column:42}}}))},5:function(t,e,n,r,o){return"X"},7:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"lat",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:28},end:{line:8,column:42}}}))},9:function(t,e,n,r,o){return"Y"},11:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"unless").call(a,s(n,"eq").call(a,null!=e?s(e,"z"):e,0,{name:"eq",hash:{},data:o,loc:{start:{line:10,column:14},end:{line:10,column:22}}}),{name:"unless",hash:{},fn:t.program(12,o,0),inverse:t.noop,data:o,loc:{start:{line:10,column:4},end:{line:12,column:15}}}))?i:""},12:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li> <span>Z:</span> <span class="original"> '+t.escapeExpression(t.lambda(null!=e?i(e,"z"):e,e))+" </span></li>\r\n"},14:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"unless").call(a,s(n,"eq").call(a,null!=e?s(e,"mdtz"):e,0,{name:"eq",hash:{},data:o,loc:{start:{line:15,column:14},end:{line:15,column:25}}}),{name:"unless",hash:{},fn:t.program(15,o,0),inverse:t.noop,data:o,loc:{start:{line:15,column:4},end:{line:17,column:15}}}))?i:""},15:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li> <span>Z:</span> <span class="mdt"> '+t.escapeExpression(t.lambda(null!=e?i(e,"mdtz"):e,e))+" </span> </li>\r\n"},17:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    <li> "+t.escapeExpression(t.lambda(null!=e?i(e,"m"):e,e))+" </li>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lambda,l=t.escapeExpression,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<ul>\r\n"+(null!=(i=c(n,"if").call(a,null!=e?c(e,"n"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:4},end:{line:6,column:11}}}))?i:"")+"    <li> <span>"+(null!=(i=c(n,"if").call(a,null!=e?c(e,"isGeo"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.program(5,o,0),data:o,loc:{start:{line:7,column:15},end:{line:7,column:58}}}))?i:"")+":</span> "+l(s(null!=e?c(e,"x"):e,e))+"</li>\r\n    <li> <span>"+(null!=(i=c(n,"if").call(a,null!=e?c(e,"isGeo"):e,{name:"if",hash:{},fn:t.program(7,o,0),inverse:t.program(9,o,0),data:o,loc:{start:{line:8,column:15},end:{line:8,column:58}}}))?i:"")+":</span> "+l(s(null!=e?c(e,"y"):e,e))+" </li>\r\n"+(null!=(i=c(n,"if").call(a,null!=e?c(e,"z"):e,{name:"if",hash:{},fn:t.program(11,o,0),inverse:t.noop,data:o,loc:{start:{line:9,column:4},end:{line:13,column:11}}}))?i:"")+(null!=(i=c(n,"if").call(a,null!=e?c(e,"mdtz"):e,{name:"if",hash:{},fn:t.program(14,o,0),inverse:t.noop,data:o,loc:{start:{line:14,column:4},end:{line:18,column:11}}}))?i:"")+(null!=(i=c(n,"if").call(a,null!=e?c(e,"m"):e,{name:"if",hash:{},fn:t.program(17,o,0),inverse:t.noop,data:o,loc:{start:{line:19,column:4},end:{line:21,column:11}}}))?i:"")+"</ul>"},useData:!0},t.template[t.CLASS+"-dialog"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-geolocation-continue-track-dialog tc-modal" >\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+a(s(n,"i18n").call(i,"geo.gps",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:16},end:{line:5,column:34}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <button type="button" class="tc-button tc-ctl-geolocation-track-continue"> '+a(s(n,"i18n").call(i,"geo.trk.dialog.cnt",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:87},end:{line:9,column:116}}}))+' </button>\r\n            <button type="button" class="tc-button tc-ctl-geolocation-track-new"> '+a(s(n,"i18n").call(i,"geo.trk.dialog.new",{name:"i18n",hash:{},data:o,loc:{start:{line:10,column:82},end:{line:10,column:111}}}))+' </button>            \r\n            <button type="button" class="tc-button tc-modal-close"> '+a(s(n,"i18n").call(i,"geo.trk.dialog.cancel",{name:"i18n",hash:{},data:o,loc:{start:{line:11,column:68},end:{line:11,column:100}}}))+' </button>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="tc-ctl-geolocation-track-advert-dialog tc-modal" >\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+a(s(n,"i18n").call(i,"geo.track.activate.title",{name:"i18n",hash:{},data:o,loc:{start:{line:19,column:16},end:{line:19,column:51}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <p id="pageBlurMsg">'+a(s(n,"i18n").call(i,"geo.trk.page.blur",{name:"i18n",hash:{},data:o,loc:{start:{line:23,column:32},end:{line:23,column:60}}}))+'</p>\r\n            <p class="tc-ctl-geolocation-track-advertisement p">                \r\n                <label> <input type="checkbox" name="checkbox" id="advertisement"> '+a(s(n,"i18n").call(i,"geo.trk.dialog.advertisement",{name:"i18n",hash:{},data:o,loc:{start:{line:25,column:83},end:{line:25,column:122}}}))+' </label>        \r\n            </p>\r\n        </div>\r\n        <div class="tc-modal-footer">\r\n            <button type="button" class="tc-button tc-ctl-geolocation-track-advert-ok"> '+a(s(n,"i18n").call(i,"ok",{name:"i18n",hash:{},data:o,loc:{start:{line:29,column:88},end:{line:29,column:101}}}))+" </button>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n"},useData:!0},t.template[t.CLASS+"-tracking-toast"]={1:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"lon",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:25},end:{line:3,column:39}}}))},3:function(t,e,n,r,o){return"X"},5:function(t,e,n,r,o){var i=t.escapeExpression,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"        <th>"+i(a(n,"i18n").call(null!=e?e:t.nullContext||{},"geo.trk.accuracy",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:12},end:{line:6,column:39}}}))+":</th>\r\n        <td> "+i(t.lambda(null!=e?a(e,"accuracy"):e,e))+" m </td>\r\n"},7:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"lat",{name:"i18n",hash:{},data:o,loc:{start:{line:11,column:25},end:{line:11,column:39}}}))},9:function(t,e,n,r,o){return"Y"},11:function(t,e,n,r,o){var i=t.escapeExpression,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"        <th>"+i(a(n,"i18n").call(null!=e?e:t.nullContext||{},"geo.trk.speed",{name:"i18n",hash:{},data:o,loc:{start:{line:14,column:12},end:{line:14,column:36}}}))+":</th>\r\n        <td>"+i(t.lambda(null!=e?a(e,"speed"):e,e))+" km/h</td>\r\n"},13:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"        <th>"+(null!=(i=a(n,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"isGeo"):e,{name:"if",hash:{},fn:t.program(14,o,0),inverse:t.program(16,o,0),data:o,loc:{start:{line:20,column:12},end:{line:20,column:55}}}))?i:"")+":</th>\r\n        <td> "+t.escapeExpression(t.lambda(null!=e?a(e,"z"):e,e))+" m </td>\r\n"},14:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"ele",{name:"i18n",hash:{},data:o,loc:{start:{line:20,column:25},end:{line:20,column:39}}}))},16:function(t,e,n,r,o){return"Z"},18:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <th title="'+a(s(n,"i18n").call(i," mdt.title",{name:"i18n",hash:{},data:o,loc:{start:{line:24,column:19},end:{line:24,column:40}}}))+'">'+a(s(n,"i18n").call(i,"ele",{name:"i18n",hash:{},data:o,loc:{start:{line:24,column:42},end:{line:24,column:56}}}))+" ("+a(s(n,"i18n").call(i,"mdt",{name:"i18n",hash:{},data:o,loc:{start:{line:24,column:58},end:{line:24,column:72}}}))+"):</th>\r\n        <td>"+a(t.lambda(null!=e?s(e,"mdt"):e,e))+" m </td>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lambda,l=t.escapeExpression,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<table class="tc-ctl-geolocation-info-tracking">\r\n    <tr>\r\n        <th>'+(null!=(i=c(n,"if").call(a,null!=e?c(e,"isGeo"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(3,o,0),data:o,loc:{start:{line:3,column:12},end:{line:3,column:55}}}))?i:"")+":</th>\r\n        <td> "+l(s(null!=e?c(e,"x"):e,e))+" </td>\r\n"+(null!=(i=c(n,"if").call(a,null!=e?c(e,"accuracy"):e,{name:"if",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:5,column:8},end:{line:8,column:15}}}))?i:"")+"    </tr>\r\n    <tr>\r\n        <th>"+(null!=(i=c(n,"if").call(a,null!=e?c(e,"isGeo"):e,{name:"if",hash:{},fn:t.program(7,o,0),inverse:t.program(9,o,0),data:o,loc:{start:{line:11,column:12},end:{line:11,column:55}}}))?i:"")+":</th>\r\n        <td> "+l(s(null!=e?c(e,"y"):e,e))+" </td>\r\n"+(null!=(i=c(n,"if").call(a,null!=e?c(e,"speed"):e,{name:"if",hash:{},fn:t.program(11,o,0),inverse:t.noop,data:o,loc:{start:{line:13,column:8},end:{line:16,column:15}}}))?i:"")+"    </tr>\r\n    <tr>\r\n"+(null!=(i=c(n,"if").call(a,null!=e?c(e,"z"):e,{name:"if",hash:{},fn:t.program(13,o,0),inverse:t.noop,data:o,loc:{start:{line:19,column:8},end:{line:22,column:15}}}))?i:"")+(null!=(i=c(n,"if").call(a,null!=e?c(e,"mdt"):e,{name:"if",hash:{},fn:t.program(18,o,0),inverse:t.noop,data:o,loc:{start:{line:23,column:8},end:{line:26,column:15}}}))?i:"")+"    </tr>    \r\n</table>\r\n"},useData:!0},t.template[t.CLASS+"-ext-dldlog"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=t.lambda,a=t.escapeExpression,s=null!=e?e:t.nullContext||{},l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-geolocation-ext-dldlog tc-hidden">\r\n    <label>\r\n        <input type="radio" name="'+a(i(null!=e?l(e,"controlId"):e,e))+'-dldlog-source" value="track" checked />\r\n        <span>'+a(l(n,"i18n").call(s,"geo.profile.fromTrack.plural",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:14},end:{line:4,column:53}}}))+'</span>\r\n    </label>\r\n    <label>\r\n        <input type="radio" name="'+a(i(null!=e?l(e,"controlId"):e,e))+'-dldlog-source" value="mdt" />\r\n        <span title="'+a(l(n,"i18n").call(s,"mdt.title",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:21},end:{line:8,column:41}}}))+'">'+a(l(n,"i18n").call(s,"mdt",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:43},end:{line:8,column:57}}}))+"</span>\r\n    </label>\r\n</div>\r\n"},useData:!0},t.template[t.CLASS+"-share-dialog"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-geolocation-dialog tc-ctl-geolocation-share-dialog tc-modal">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+a(s(n,"i18n").call(i,"geo.track.1",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:16},end:{line:5,column:38}}}))+" - "+a(s(n,"i18n").call(i,"share",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:41},end:{line:5,column:57}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <div class="tc-ctl-geolocation-share-dialog-ctl"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n\r\n'},useData:!0};var n=function(t){const e=this;t.feature!==e.wrap.simulateMarker&&t.layer===e.layerTrack&&e.clearSelection()};t.register=function(t){const e=this,n=a.Z.Control.prototype.register.call(e,t);e.wrap=new a.Z.wrap.control.Geolocation(e),e.wrap.register(t),t._bufferFeatures=[],e.hillDeltaThreshold=e.options&&e.options.hillDeltaThreshold||e.map.options.elevation&&e.map.options.elevation.hillDeltaThreshold||20;var r=[];return r.push(t.addLayer({id:e.getUID(),type:a.Z.Consts.layerType.VECTOR,owner:e,stealth:!0,title:"Posicionar.GPS"}).then((function(t){e.layerGPS=t}))),r.push(t.addLayer({id:e.getUID(),type:a.Z.Consts.layerType.VECTOR,owner:e,stealth:!0,title:"Posicionar.Tracking",styles:{point:{radius:3,fillColor:"#00ced1",fillOpacity:function(){return this.track.renderTrack.checked?1:0}.bind(e),strokeColor:"#ffffff",fontColor:"#00ced1",labelOutlineColor:"#ffffff",labelOutlineWidth:1,label:function(t){var e=t.getData().name;return e=e&&(e+"").trim().length>0?(e+"").trim().toLowerCase():""}},line:[{strokeOpacity:function(){return this.track.renderTrack.checked?1:0}.bind(e),strokeWidth:8,strokeColor:"#ffffff"},{strokeOpacity:function(){return this.track.renderTrack.checked?1:0}.bind(e),strokeWidth:4,strokeColor:"#00ced1"}]}}).then((function(t){e.layerTracking=t}))),r.push(t.addLayer({id:e.getUID(),type:a.Z.Consts.layerType.VECTOR,owner:e,stealth:!0,title:"Posicionar.Track",styles:{line:{strokeWidth:2,strokeColor:"#C52737"},point:{radius:function(t){var e=t.getData().name;return e&&(e+"").trim().length>0?3:6},fillColor:"#C52737",strokeColor:"#ffffff",fontColor:"#C52737",fontSize:10,labelOutlineColor:"#ffffff",labelOutlineWidth:2,label:function(t){var e=t.getData().name;return e=e&&(e+"").trim().length>0?(e+"").trim().toLowerCase():""}}}}).then((function(t){e.layerTrack=t}))),Promise.all(r).then((function(){const t=e.map.layers.indexOf(e.layerTrack);e.map.insertLayer(e.layerGPS,t)})),t.on(a.Z.Consts.event.FEATURESIMPORT,function(t){const e=this,n=function(t){const n=t.fileName,r=t.dropTarget;var o="."+a.Z.Consts.format.KML.toLowerCase(),i="."+a.Z.Consts.format.GPX.toLowerCase();if(n.toLowerCase().indexOf(i)===n.length-i.length||n.toLowerCase().indexOf(o)===n.length-o.length&&r===e){e.clear(e.Const.Layers.TRACK);const r=function(){setTimeout((function(){if(e.map._bufferFeatures=e.map._bufferFeatures.concat(t.features),window.dropFilesCounter--,0===window.dropFilesCounter){e.map.zoomToFeatures(e.map._bufferFeatures),e.map._bufferFeatures=[],delete window.dropFilesCounter;var n=e.map.getLoadingIndicator();n&&n.removeWait(e.map._fileDropLoadingIndicator),e.off(e.Const.Event.IMPORTEDTRACK,r)}}),0)};e.on(e.Const.Event.IMPORTEDTRACK,r),e.importTrack(t),/.kml$/g.test(n.toLowerCase())&&e.layerTrack&&e.layerTrack.styles&&e.layerTrack.features.forEach((function(t){a.Z.feature.Point&&t instanceof a.Z.feature.Point&&e.layerTrack.styles.point?t.setStyle(e.layerTrack.styles.point):a.Z.feature.Polyline&&t instanceof a.Z.feature.Polyline&&e.layerTrack.styles.line&&t.setStyle(e.layerTrack.styles.line)}))}};e.working&&a.Z.Util.isFunction(e.working.then)?e.working.then(n(t)):(e.working=!0,n(t))}.bind(e)),t.on(a.Z.Consts.event.PROJECTIONCHANGE,(function(t){e.elevationChartData&&(e.elevationChartData.coords=a.Z.Util.reproject(e.elevationChartData.coords,t.oldCrs,t.newCrs),e.elevationChartData.secondaryElevationProfileChartData&&e.elevationChartData.secondaryElevationProfileChartData.length&&e.elevationChartData.secondaryElevationProfileChartData.forEach((e=>{e.eleCoordinates=a.Z.Util.reproject(e.eleCoordinates,t.oldCrs,t.newCrs)})))})),t.on(a.Z.Consts.event.DIALOG,(function(t){if(t.control)switch(t.action){case"share":t.control.caller!==e&&e.onShowShareDialog(t.control.caller);break;case"download":e.onShowDownloadDialog(t.control.caller)}})),e.notificationConf=Object.assign(e.options.notification||{},{tag:"Geolocation Track",vibrate:[200],renotify:!0,requireInteraction:!0,body:e.getLocaleString("geo.trk.notification.body")},{title:e.options.notification&&e.options.notification.title?e.getLocaleString(e.options.notification.title):document.title}),n},t.getElevationControl=async function(){const t=this;if(!t.elevationControl){let e={};!t.options.displayElevation&&t.options.displayOn?e.displayOn=t.options.displayOn:t.options.displayElevation&&(e=t.options.displayElevation),Object.prototype.hasOwnProperty.call(t.options,"resolution")?e.resolution=t.options.resolution:e.resolution=0,t.elevationControl=await t.map.addControl("elevation",e),t.elevationControl._decorateChartPanel=function(){this.resultsPanel.setCurrentFeature=function(e){const n=this;n.currentFeature=t.layerTrack.features.filter((t=>!(a.Z.feature.Marker&&t instanceof a.Z.feature.Marker||a.Z.feature.Point&&t instanceof a.Z.feature.Point)))[0];const o=t.getSelectedTrack();o&&(n.currentFeature.uid=o.dataset.uid,n.currentFeature.fileName=r.call(t,o))}}}return t.elevationControl},t.render=function(t){const e=this;return e._set1stRenderPromise(e.getRenderedHtml(e.CLASS+"-dialog",null,(function(t){e._dialogDiv.innerHTML=t})).then((function(){return e.getDownloadDialog().then((()=>{e._downloadDialog.caller=e,e.getRenderedHtml(e.CLASS+"-ext-dldlog",{controlId:e.id},(function(n){var r=document.createElement("template");r.innerHTML=n,e._downloadDialogExtNode=r.content?r.content.firstChild:r.firstChild,e.getRenderedHtml(e.CLASS+"-share-dialog",{},(function(n){return e._shareDialogDiv.innerHTML=n,e.renderData({controlId:e.id},t)}))}))}))})))},t.importTrack=function(t){var e=this;if(e.map.off(a.Z.Consts.event.FEATUREREMOVE,n),e.isDisabled)/.gpx$/g.test(t.fileName.toLowerCase())&&e.map.toast(e.getLocaleString("geo.trk.import.disabled"),{type:a.Z.Consts.msgType.WARNING});else if(t.fileName&&t.features&&t.features.length>0){var r=e.getLoadingIndicator().addWait();e.importedFileName=t.fileName;const n=[];for(var o=0,i=t.features.length;o<i;o++)n.push(e.layerTrack.addFeature(t.features[o]));Promise.all(n).then((function(){e.wrap.processImportedFeatures({wait:r,notReproject:t.notReproject}),e.layerTrack&&(e.map&&e.map.layout&&e.map.layout.accordion&&e.div.classList.contains(a.Z.Consts.classes.COLLAPSED)&&e.map.controls.filter((function(t){return t!==e&&!t.containerControl})).forEach((function(t){t.div.classList.add(a.Z.Consts.classes.COLLAPSED)})),e.div.classList.remove(a.Z.Consts.classes.COLLAPSED),e.div.querySelector("."+e.CLASS+"-btn-tracks > span").click(),t.isShared||e.map.trigger(a.Z.Consts.event.TOOLSOPEN))}))}},t.prepareFeaturesToShare=function(t){const e=this;let n=t.uid;return new Promise((function(r,o){if(n){var i=e.availableTracks.filter((function(t){return t.uid.toString()===n.toString()}))[0].data,s=(new ol.format.GeoJSON).readFeatures(i);const o=new Array(s.length);s.forEach((function(t,e){o[e]=a.Z.wrap.Feature.createFeature(t)})),Promise.all(o).then((function(n){let o=n.map((function(t){const e={};switch(!0){case a.Z.feature.Marker&&t instanceof a.Z.feature.Marker:e.type=a.Z.Consts.geom.MARKER;break;case a.Z.feature.Point&&t instanceof a.Z.feature.Point:e.type=a.Z.Consts.geom.POINT;break;case a.Z.feature.Polyline&&t instanceof a.Z.feature.Polyline:e.type=a.Z.Consts.geom.POLYLINE;break;case a.Z.feature.MultiPolyline&&t instanceof a.Z.feature.MultiPolyline:e.type=a.Z.Consts.geom.MULTIPOLYLINE}return e.id=t.id,e.geom=t.geometry,e.data=t.getData(),e}));t.setFeaturesToShare&&(e.featuresToShare=o),r(o)}))}else o()}))};const r=function(t){var e=t.querySelector("span").textContent,n=new RegExp(this.Const.SupportedFileExtensions.join("|"),"gi");return e.replace(n,"")+"_"+a.Z.Util.getFormattedDate(new Date,!0)},o=async function(t){const e=this;let n=j(t);if(n)return console.log("Tengo datos en cache"),n.data;{console.log("NO tengo datos en cache");const n=await e.getElevationTool();if(n){let r=t.clone();try{let o=await n.setGeometry({features:[r],crs:e.map.crs});return W(t,o[0]),o[0]}catch(t){return null}}}};t.onShowShareDialog=function(t){const e=this;return t instanceof Element||t instanceof HTMLDocument?t.classList.contains(e.CLASS+"-share-dialog")?a.Z.control.infoShare.onShowShareDialog.call(e):Promise.resolve():t===e?a.Z.control.infoShare.onShowShareDialog.call(e):void(t!==e&&t.toShare&&t.toShare.feature&&t.toShare.feature.layer===e.layerTrack&&a.Z.Util.closeModal((function(){a.Z.control.infoShare.onCloseShareDialog.call(t);const n=e.getSelectedTrack();return n?e.shareTrack(n).then((function(){const t=e._shareDialogDiv.querySelector("."+e.CLASS+"-share-dialog");a.Z.Util.showModal(t,{openCallback:function(){return a.Z.control.infoShare.onShowShareDialog.call(e)},closeCallback:function(){a.Z.control.infoShare.onCloseShareDialog.call(e)}})})):Promise.resolve()})))};var s=null,l=null;t.onShowDownloadDialog=function(t,e){const n=this,r=n._downloadDialog.getFeatures();if(t!==n&&n._downloadDialog.getFeatures().every((t=>t&&t.layer===n.layerTrack))){let t=n._downloadDialog.getOptions(),e=n.getDownloadDialogOptions();t.elevation=e.elevation,delete t.openCallback,n._downloadDialog.open(n._downloadDialog.getFeatures(),t)}if(1===r.length&&r.every((t=>t&&t.fileName))&&n._downloadDialog.setOptions({fileName:r[0].fileName}),n.options.displayElevation&&(t===n||n._downloadDialog.getFeatures().every((t=>t&&t.layer===n.layerTrack)))&&!n._downloadDialog.modalBody.querySelector("."+n.CLASS+"-ext-dldlog")){let t=n._downloadDialog.modalBody.querySelector("."+n._downloadDialog.CLASS+"-ext");if(t){t.appendChild(n._downloadDialogExtNode),l=n._downloadDialog.modalBody.querySelector("."+n._downloadDialog.CLASS+"-elev input[type='checkbox']"),s=n._downloadDialog.modalBody.querySelector("."+n._downloadDialog.CLASS+"-ip");const i=n._downloadDialog.modalBody.querySelectorAll(`input[type=radio][name="${n.id}-dldlog-source"]`),c=function(t){const e=i[0];t?e.classList.contains(a.Z.Consts.classes.DISABLED)||e.classList.add(a.Z.Consts.classes.DISABLED):e.classList.remove(a.Z.Consts.classes.DISABLED)};let u=r.filter((t=>a.Z.feature.Polyline&&t instanceof a.Z.feature.Polyline))[0],p=2===u.geometry[0].length;p?c(p):u.geometry[0].length>2&&c(u.geometry.map((t=>t[2])).every((t=>0===t)));const d=function(){return s&&s.classList.contains(a.Z.Consts.classes.HIDDEN)},h=function(){if(i[0].checked&&!d())s.classList.add(a.Z.Consts.classes.HIDDEN);else if(i[0].checked){let t=new MutationObserver((function(e){e.filter((t=>"class"===t.attributeName)).forEach((function(e){e.oldValue.indexOf(a.Z.Consts.classes.HIDDEN)>-1&&(i[0].checked?(s.classList.add(a.Z.Consts.classes.HIDDEN),t.disconnect()):t.disconnect())}))})),e={attributes:!0,attributeOldValue:!0};t.observe(s,e)}else d()&&l.checked&&s.classList.remove(a.Z.Consts.classes.HIDDEN)};if(l&&(l.checked?(h(),n._downloadDialogExtNode.classList.remove(a.Z.Consts.classes.HIDDEN)):n._downloadDialogExtNode.classList.contains(a.Z.Consts.classes.HIDDEN)||n._downloadDialogExtNode.classList.add(a.Z.Consts.classes.HIDDEN),l.addEventListener("change",(function(){h(),n._downloadDialogExtNode.classList.toggle(a.Z.Consts.classes.HIDDEN)}))),i&&(h(),i.forEach((t=>{t.dataset.hasChangeEvent||(t.dataset.hasChangeEvent=!0,t.addEventListener("change",(async function(t){if(t.target.checked){let s;if(h(),"track"===t.target.value)s=r;else{let t=r,l=t.filter((t=>a.Z.feature.Polyline&&t instanceof a.Z.feature.Polyline))[0];e&&(s=t.filter((t=>a.Z.feature.Point&&t instanceof a.Z.feature.Point)));let c=l.uid,u=U(c);if(u){let t=l.clone();t.setCoords(u.data.secondaryElevationProfileChartData[0].coords),e?(s||(s=V.call(n)||[]),s.push(t)):s=t}else{n._downloadDialog.modalBody.classList.add(a.Z.Consts.classes.LOADING);let t=await o.call(n,l);t?e?s.push(t):s=t:(n.map.toast(n.getLocaleString("elevation.error"),{type:a.Z.Consts.msgType.ERROR,duration:5e3}),i[0].checked=!0),n._downloadDialog.modalBody.classList.remove(a.Z.Consts.classes.LOADING)}}n._downloadDialog.setFeatures(s)}})))})),i[0].classList.contains(a.Z.Consts.classes.DISABLED)||"mdt"===document.querySelector("."+n.CLASS+"-ext-dldlog input[type=radio]:checked").value)){const t=i[1];t.checked=!0,t.dispatchEvent(new Event("change"))}1===r.length&&r[0].fileName&&n._downloadDialog.setOptions({fileName:r[0].fileName})}}},t.getDownloadDialogOptions=function(t){const e=this,n={title:e.getLocaleString("download"),fileName:t,openCallback:function(){e.onShowDownloadDialog(e,!0)}};return e.options.displayElevation?n.elevation={resolution:e.options.displayElevation&&e.options.displayElevation.resolution||e.map.options.elevation&&e.map.options.elevation.resolution||20,sampleNumber:e.options.displayElevation&&e.options.displayElevation.sampleNumber||e.map.options.elevation&&e.map.options.elevation.sampleNumber||0,checked:!0}:n.elevation={checked:!0},n};var c=!0;t.renderData=function(e,o){const s=this;var l=s.Const.Selector;return a.Z.Control.prototype.renderData.call(s,e,(function(){const e=s.div.querySelectorAll(s._classSelector+"-panel");if(s.div.querySelectorAll("."+s.CLASS+"-select span").forEach((function(t){t.addEventListener(a.Z.Consts.event.CLICK,(function(t){for(var n=t.target;n&&"LABEL"!==n.tagName;)n=n.parentElement;const r=n.querySelector(`input[type=radio][name="${s.id}-mode"]`).value;e.forEach((function(t){t.classList.toggle(a.Z.Consts.classes.HIDDEN,!t.matches("."+s.CLASS+"-"+r))}))}),{passive:!0})})),s.track={activateButton:s.div.querySelector(s._classSelector+"-track-ui-activate"),deactivateButton:s.div.querySelector(s._classSelector+"-track-ui-deactivate"),trackSearch:s.div.querySelector(s._classSelector+"-track-available-srch"),trackImportFile:s.div.querySelector(s._classSelector+"-track-import"),trackSave:s.div.querySelector(s._classSelector+"-track-save"),trackAdd:s.div.querySelector(s._classSelector+"-track-add-wpt"),trackContinue:s._dialogDiv.querySelector("."+s.CLASS+"-track-continue"),trackRenew:s._dialogDiv.querySelector("."+s.CLASS+"-track-new"),trackClose:s._dialogDiv.querySelector("."+s.CLASS+"-continue-track-dialog button.tc-modal-close"),trackAdvertisementOK:s._dialogDiv.querySelector("."+s.CLASS+"-track-advert-ok")},s.track.trackList=s.div.querySelector(s._classSelector+"-track-available-lst"),s.track.trackToolPanelOpened=s.div.querySelector("#tc-ctl-geolocation-track-panel-opened-"+s.id),s.div.querySelector("."+t.CLASS+"-track-panel-help").addEventListener("click",(function(){d.call(s)})),s.track.trackName=s.div.querySelector(s._classSelector+"-track-title"),s.track.trackWPT=s.div.querySelector(s._classSelector+"-track-waypoint"),a.Z.Util.detectMobile()&&matchMedia("screen and (max-height: 50em) and (max-width: 50em)").matches&&(s.track.trackToolPanelOpened.checked=!1),window.File&&window.FileReader&&window.FileList&&window.Blob){s.track.trackImportFile.disabled=!1,s.track.trackImportFile.addEventListener(a.Z.Consts.event.CLICK,(function(t){const e=this,n=document.createElement("form"),r=e.parentElement;r.insertBefore(n,e),n.appendChild(e),n.reset(),n.insertAdjacentElement("afterend",e),r.removeChild(n)}),{passive:!0});const t=function(){s.map.off(a.Z.Consts.event.LAYERERROR,t),s.clearFileInput(s.track.trackImportFile),a.Z.alert(s.getLocaleString("geo.trk.upload.error3"))};s.track.trackImportFile.addEventListener("change",(function(e){s._cleaning||(s.clear(s.Const.Layers.TRACK),s.map&&(s.map.on(a.Z.Consts.event.LAYERERROR,t),s.map.wrap.loadFiles(e.target.files,{control:s})))}))}else console.log("no es posible la importación");s.track.activateButton.addEventListener("click",(function(){s.activateTracking(),u.call(s)})),s.track.deactivateButton.addEventListener("click",(function(){s.deactivateTracking(),p.call(s)}));const h=function(){!function(t){t=t.toLowerCase();const e=Array.from(s.track.trackList.querySelectorAll("li"));e.forEach((function(t){t.style.display="none"}));const n=e.filter((function(t){return t.matches("li:not([class]),li."+s.Const.Classes.SELECTEDTRACK)})),r=s.div.querySelector(s._classSelector+"-track-search-icon");if(0===t.length)n.forEach((function(t){t.style.display=""})),r.style.visibility="visible";else{r.style.visibility="hidden";var o=new RegExp(t,"i");n.forEach((function(t){t.style.display=o.test(t.querySelector("span").textContent)?"":"none"})),n.some((function(t){return""===t.style.display}))||e.forEach((function(t){t.matches('[class^="tc-ctl-geolocation-track-not"]')&&(t.style.display="")}))}}(this.value.toLowerCase().trim())};s.track.trackSearch.addEventListener("keyup",h),s.track.trackSearch.addEventListener("search",h),s.track.trackSave.addEventListener("click",s.saveTrack.bind(s)),s.track.trackAdd.addEventListener("click",s.addWaypoint.bind(s));const f=s.div.querySelector(s._classSelector+"-track-available-lst");var m=function(t,e){"LI"!==e.tagName&&(e=e.parentElement);const n=e.querySelector("input"),r=e.querySelector("span");t?(n.classList.remove(a.Z.Consts.classes.HIDDEN),n.focus(),n.value=r.textContent,r.classList.add(a.Z.Consts.classes.HIDDEN),e.dataset.title=e.title,e.title="",e.querySelector(l.EDIT).classList.add(a.Z.Consts.classes.HIDDEN),e.querySelector(l.DELETE).classList.add(a.Z.Consts.classes.HIDDEN),e.querySelector(l.DRAW).classList.add(a.Z.Consts.classes.HIDDEN),e.querySelector(l.EXPORT).classList.add(a.Z.Consts.classes.HIDDEN),e.querySelector(l.SHARE).classList.add(a.Z.Consts.classes.HIDDEN),e.querySelector(l.SAVE).classList.remove(a.Z.Consts.classes.HIDDEN),e.querySelector(l.CANCEL).classList.remove(a.Z.Consts.classes.HIDDEN)):(n.classList.add(a.Z.Consts.classes.HIDDEN),r.classList.remove(a.Z.Consts.classes.HIDDEN),e.title=e.dataset.title,delete e.dataset.title,e.querySelector(l.EDIT).classList.remove(a.Z.Consts.classes.HIDDEN),e.querySelector(l.DELETE).classList.remove(a.Z.Consts.classes.HIDDEN),e.querySelector(l.DRAW).classList.remove(a.Z.Consts.classes.HIDDEN),e.querySelector(l.EXPORT).classList.remove(a.Z.Consts.classes.HIDDEN),e.querySelector(l.SHARE).classList.remove(a.Z.Consts.classes.HIDDEN),e.querySelector(l.SAVE).classList.add(a.Z.Consts.classes.HIDDEN),e.querySelector(l.CANCEL).classList.add(a.Z.Consts.classes.HIDDEN))};s.uiSimulate=function(t,e){if(e){const t=("LI"===e.tagName?e:e.parentNode).querySelector(l.PAUSE);t.classList.add("play"),t.setAttribute("title",s.getLocaleString("tr.lst.start")),s.simulate_stopped=!0}},f.addEventListener("change",a.Z.EventTarget.listenerBySelector("input."+l.VISIBILITY,(function(t){s.layerTrack.setVisibility(t.target.checked)}))),f.addEventListener("click",a.Z.EventTarget.listenerBySelector(l.DRAW,(function(t){var e=s.getLoadingIndicator().addWait();y(s,t.target).then((function(){s.getLoadingIndicator().removeWait(e)}))}))),s.on(s.Const.Event.IMPORTEDTRACK,(function(t){if(s.isDisabled)s.map.toast(s.getLocaleString("geo.trk.import.disabled"),{type:a.Z.Consts.msgType.WARNING});else{const e=s.track.trackList.querySelector('li[data-id="'+t.index+'"]');y(s,e.querySelector(l.DRAW)).then((function(){s.loadingState&&(delete s.loadingState,delete s.toShare)}));const n=function(r){HTMLElement.prototype.scrollIntoView?e.scrollIntoView({behavior:"smooth",block:"end"}):s.track.trackList.scrollTop=t.index*e.offsetHeight,e.removeEventListener("transitionend",n,!1)};e.addEventListener("transitionend",n,!1)}}));const g=function(t,e){t.track.trackList.querySelectorAll("li[data-id]").forEach((function(n){if(n.dataset.id!==e){const e=n.querySelector(l.PAUSE);t.simulate_stopped=!0,e.classList.add("play"),e.setAttribute("title",t.getLocaleString("tr.lst.start")),m(!1,n)}}))};var y=function(t,e){return new Promise((function(r,o){const i=e.parentElement;setTimeout((function(){i.classList.contains(t.Const.Classes.SELECTEDTRACK)?(t.clear(t.Const.Layers.TRACK),t.map.off(a.Z.Consts.event.FEATUREREMOVE,n),e.setAttribute("title",e.textContent)):t.getSelectedTrack()?(g(t,i.dataset.id),t.working=t.drawTrack(i)):t.working=t.drawTrack(i),i.classList.contains(t.Const.Classes.SELECTEDTRACK)?t.prepareFeaturesToShare({uid:i.dataset.uid,setFeaturesToShare:!0}).then((function(){r()})):r()}),0)}))};f.addEventListener("click",a.Z.EventTarget.listenerBySelector(s._classSelector+" "+l.EDIT,(function(t){m(!0,t.target)}))),f.addEventListener("click",a.Z.EventTarget.listenerBySelector(s._classSelector+" "+l.DELETE,(function(t){s.removeTrack(t.target.parentElement)}))),f.addEventListener("click",a.Z.EventTarget.listenerBySelector(s._classSelector+" "+l.SAVE,(function(t){0===t.target.parentElement.querySelector("input").value.trim().length?a.Z.alert(s.getLocaleString("geo.trk.edit.alert")):(s.editTrackName(t.target.parentElement.dataset.id,t.target.parentElement.querySelector("input").value),m(!1,t.target))}))),f.addEventListener("click",a.Z.EventTarget.listenerBySelector(s._classSelector+" "+l.CANCEL,(function(t){m(!1,t.target)}))),f.addEventListener("click",a.Z.EventTarget.listenerBySelector(s._classSelector+" "+l.SHARE,(function(t){s.shareTrack(t.target.parentElement).then((function(){s.showShareDialog(s._shareDialogDiv)}))}))),f.addEventListener("click",a.Z.EventTarget.listenerBySelector(s._classSelector+" "+l.EXPORT,(function(t){const e=t.target.parentElement;t.target.setAttribute("disabled",""),s.export(e).then((n=>{s.getDownloadDialog().then((function(o){const i=s.getDownloadDialogOptions(r.call(s,e));o.open(n.map((t=>(t.uid=e.dataset.uid,t))),i),t.target.removeAttribute("disabled")}))}))}))),f.addEventListener("click",a.Z.EventTarget.listenerBySelector(s._classSelector+" "+l.STOP,(function(t){s.wrap.simulateTrackEnd();const e=t.target.parentElement.querySelector(l.PAUSE);e.classList.add("play"),e.setAttribute("title",s.getLocaleString("tr.lst.start")),s.simulate_stopped||(t.target.parentElement.querySelector(l.SPEED).textContent="x 1"),s.simulate_speed=1,s.simulate_stopped=!0}))),f.addEventListener("click",a.Z.EventTarget.listenerBySelector(s._classSelector+" "+l.PAUSE,(function(t){if(s.simulate_paused=!t.target.classList.contains("play"),s.simulate_paused)s.simulate_pausedElapse=-1;else if(s.simulate_stopped){var e=s.getLoadingIndicator().addWait();t.target.parentElement.querySelector(l.SPEED).textContent="x 1",function(t,e){return new Promise((function(n,r){setTimeout((function(){const r=e.closest("li"),o=t.getSelectedTrack();g(t,r.dataset.id),o&&r.dataset.id!==o.dataset.id&&t.clear(t.Const.Layers.TRACK),t.simulate_paused=!1,t.simulateTrack(r),n()}),0)}))}(s,t.target).then((function(){s.getLoadingIndicator().removeWait(e),s.simulate_stopped=!1}))}t.target.setAttribute("title",s.getLocaleString(s.simulate_paused?"tr.lst.play":"tr.lst.pause")),t.target.classList.toggle("play",!!s.simulate_paused)})));f.addEventListener("click",a.Z.EventTarget.listenerBySelector(s._classSelector+" "+l.BACKWARD,(function(t){1===s.simulate_speed?s.simulate_speed=.5:s.simulate_speed=s.simulate_speed/2,t.target.parentElement.querySelector(s._classSelector+" "+l.FORWARD).disabled=!1,t.target.parentElement.querySelector(l.SPEED).textContent=s.simulate_speed<1?"/ "+1/s.simulate_speed:"x "+s.simulate_speed,.000244140625===s.simulate_speed&&(t.target.disabled=!0)}))),f.addEventListener("click",a.Z.EventTarget.listenerBySelector(s._classSelector+" "+l.FORWARD,(function(t){s.simulate_speed=s.simulate_speed/.5,t.target.parentElement.querySelector(l.SPEED).textContent=s.simulate_speed<1?"/ "+1/s.simulate_speed:"x "+s.simulate_speed,t.target.parentElement.querySelector(s._classSelector+" "+l.BACKWARD).disabled=!1,4096===s.simulate_speed&&(t.target.disabled=!0)}))),s.track.trackContinue.addEventListener("click",(function(){a.Z.Util.closeModal(),v.call(s)})),s.track.trackRenew.addEventListener("click",(function(){delete s.sessionTracking,a.Z.Util.storage.setSessionLocalValue(s.Const.LocalStorageKey.TRACKINGTEMP,void 0),i().removeItem(s.Const.LocalStorageKey.TRACKINGTEMP),a.Z.Util.closeModal(),v.call(s)})),s.track.trackClose.addEventListener("click",(function(){p.call(s)})),s.track.trackAdvertisementOK.addEventListener("click",(function(){const t=document.body.querySelectorAll('input[name*="Advertisement"]:checked');t.length>0&&i().setItem(t[0].getAttribute("name"),!1),a.Z.Util.closeModal()})),s.track.renderTrack=s.div.querySelector("#tc-ctl-geolocation-track-render-"+s.id),s.track.renderTrack.addEventListener("change",(function(){s.track.activateButton.classList.contains(a.Z.Consts.classes.HIDDEN)&&s.layerTracking.setVisibility(this.checked),c=this.checked})),s.bindTracks(),a.Z.Util.isFunction(o)&&o()}))},t.shareTrack=function(t){const e=this;return e.getShareDialog(e._shareDialogDiv).then((function(){return e.prepareFeaturesToShare({uid:t.dataset.uid,setFeaturesToShare:!1}).then((function(n){e.toShare={trackName:t.querySelector("span").innerHTML,features:n}}))}))},t.activate=function(){},t.deactivate=function(){a.Z.Util.closeModal(),this.clearSelection(),this.deactivateTracking()};var u=function(){this.track.activateButton.classList.add(a.Z.Consts.classes.HIDDEN),this.track.deactivateButton.classList.remove(a.Z.Consts.classes.HIDDEN)},p=function(){this.track.activateButton.classList.remove(a.Z.Consts.classes.HIDDEN),this.track.deactivateButton.classList.add(a.Z.Consts.classes.HIDDEN)},d=function(){this.map.toast(this.div.querySelector(".alert-warning").innerHTML,{duration:1e4})};t.markerStyle={radius:10,fillColor:[255,0,0,100],strokeColor:[255,255,255,255],strokeWidth:2},t.lineStyle={strokeWidth:2,strokeColor:[0,206,209,255]},t.setFormatInfoNewPosition=function(t){var e=this,n={},r=a.Z.Util.getMapLocale(e.map);if(e.map.on3DView){var o=e.map.crs!==e.map.view3D.crs?a.Z.Util.reproject(t.position,e.map.crs,e.map.view3D.crs):t.position;n.x=o[0].toLocaleString(r),n.y=o[1].toLocaleString(r),n.mdt=Math.round(e.map.view3D.getHeightFromMDT(o)).toLocaleString(r),n.isGeo=!0}else n.x=t.position[0].toLocaleString(r),n.y=t.position[1].toLocaleString(r);return n.z=Math.round(t.altitude).toLocaleString(r),n.accuracy=Math.round(t.accuracy).toLocaleString(r),n.speed=t.speed.toLocaleString(r,{minimumFractionDigits:1,maximumFractionDigits:1}),n},t.getTrackInfoPanel=function(){const t=this;return t.track._infoPanelPromise||(t.track._infoPanelPromise=new Promise((function(e,n){if(t.track.infoPanel)e(t.track.infoPanel);else{var r,o={content:"table",resize:!1,titles:{main:t.getLocaleString("geo.mylocation"),max:t.getLocaleString("geo.mylocation.show")},classes:{collapsed:"tracking"}};const n=function(t){o.position=t.POSITION.RIGHT,r=t.addControl("resultsPanel",o)};let a;if(!t.options.displayElevation&&t.options.displayOn?a=t.options.displayOn:t.options.displayElevation&&(a=t.options.displayElevation.displayOn),a){var i=t.map.getControlsByClass("TC.control."+a[0].toUpperCase()+a.substring(1))[0];i?n(i):t.map.addControl(a).then(n)}else o.div=document.createElement("div"),t.map.div.appendChild(o.div),r=t.map.addControl("resultsPanel",o);r.then((function(n){t.track.infoPanel=n,e(n)}))}}))),t.track._infoPanelPromise},t.renderInfoNewPosition=function(t){const e=this;e.getRenderedHtml(e.CLASS+"-tracking-toast",e.setFormatInfoNewPosition(t.pd),(function(t){e.getTrackInfoPanel().then((function(n){n.isMinimized()||(e.map.getControlsByClass(a.Z.control.ResultsPanel).filter((t=>t.content===t.contentType.TABLE&&t!==n)).forEach((function(t){t.close()})),n.renderPromise().then((function(){n.options.collidingPriority=n.COLLIDING_PRIORITY.IGNORE,n.open(t)})))}))}))};var h=function(){this.track.trackToolPanelOpened.checked||this.map.trigger(a.Z.Consts.event.TOOLSCLOSE)},f=!0,m=!1,g=null;t.setFollowing=function(t){const e=this;if(f=t,e.trackCenterButton){const n=e.trackCenterButton.querySelector("button");n.classList.toggle(a.Z.Consts.classes.UNPLUGGED,!t),n.title=e.getLocaleString(t?"geo.trk.notCenter":"geo.trk.center")}!t&&e.trackCenterButton&&e.trackCenterButton.querySelector("button").classList.add(a.Z.Consts.classes.UNPLUGGED),t&&e.trackCenterButton&&e.trackCenterButton.querySelector("button").classList.remove(a.Z.Consts.classes.UNPLUGGED)},t.Move=async function(t){const e=this;t&&Array.isArray(t)&&t.length>0&&(m=!0,t[0]instanceof a.Z.Feature?await e.map.zoomToFeatures(t,{animate:!1}):await e.map.setCenter(t,{animate:!1}),setTimeout((function(){m=!1}),300))};const y=function(){(!g||g[0]!==this.getCenter()[0]&&g[1]!==this.getCenter()[1])&&(g=this.getCenter(),m||this.getControlsByClass(a.Z.control.Geolocation)[0].setFollowing(!1))};var v=function(){var t=this;t.activate(),f=!0,u.call(t),h.call(t),t.map.on(a.Z.Consts.event.ZOOM,y),t.on(t.Const.Event.POSITIONCHANGE,(function(e){t.currentPoint&&t.currentPoint.position[0]!==e.pd.position[0]&&t.currentPoint.position[1]!==e.pd.position[1]&&f&&t.Move(e.pd.position),t.currentPoint=e.pd,t.renderInfoNewPosition(e),t.track.trackName.disabled=!1,t.track.trackSave.disabled=!1,t.track.trackWPT.disabled=!1,t.track.trackAdd.disabled=!1,a.Z.Util.storage.setSessionLocalValue(t.Const.LocalStorageKey.TRACKINGTEMP,t.wrap.formattedToStorage(t.layerTracking).features)})),t.on(t.Const.Event.STATEUPDATED,(function(t){})),t.clear(t.Const.Layers.TRACKING),k.call(t,t.Const.LocalStorageKey.TRACKINGSHOWADVERTISEMENT),t.wrap.setTracking(!0)};let _=!1,C=null,E=null;"wakeLock"in navigator&&(_=!0);var w,S,b,L=function(){if(_){(async()=>{try{C=await navigator.wakeLock.request("screen"),console.log("Wake Lock active"),C.addEventListener("release",(()=>{console.log("Wake Lock released")}))}catch(t){console.error(t)}})()}else P.apply(this)},T=function(){_?C.release().then((()=>{C=null})):A.apply(this)},P=function(){var t=this;if(!t.videoScreenOn){var e={WebM:"data:video/webm;base64,GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA/vz0AAA=",MP4:"data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAAG21kYXQAAAGzABAHAAABthADAowdbb9/AAAC6W1vb3YAAABsbXZoZAAAAAB8JbCAfCWwgAAAA+gAAAAAAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIVdHJhawAAAFx0a2hkAAAAD3wlsIB8JbCAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAIAAAACAAAAAABsW1kaWEAAAAgbWRoZAAAAAB8JbCAfCWwgAAAA+gAAAAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAAVxtaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAEcc3RibAAAALhzdHNkAAAAAAAAAAEAAACobXA0dgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAIAAgASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAAFJlc2RzAAAAAANEAAEABDwgEQAAAAADDUAAAAAABS0AAAGwAQAAAbWJEwAAAQAAAAEgAMSNiB9FAEQBFGMAAAGyTGF2YzUyLjg3LjQGAQIAAAAYc3R0cwAAAAAAAAABAAAAAQAAAAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAAAEwAAAAEAAAAUc3RjbwAAAAAAAAABAAAALAAAAGB1ZHRhAAAAWG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAK2lsc3QAAAAjqXRvbwAAABtkYXRhAAAAAQAAAABMYXZmNTIuNzguMw=="};t.videoScreenOn=document.createElement("video"),t.videoScreenOn.setAttribute("loop",""),t.videoScreenOn.setAttribute("muted",""),t.videoScreenOn.setAttribute("webkit-playsinline",""),t.videoScreenOn.setAttribute("playsinline",""),t.videoScreenOn.setAttribute("style","transform: translateZ(0px);");var n=document.createElement("source");n.src=e.WebM,n.type="video/webm",t.videoScreenOn.appendChild(n);var r=document.createElement("source");r.src=e.MP4,r.type="video/mp4",t.videoScreenOn.appendChild(r)}t.videoScreenOn.play()},A=function(){this.videoScreenOn&&this.videoScreenOn.pause()},O=function(){Z.apply(this)},x=function(){var t=this;t.videoScreenOn&&t.videoScreenOn.paused&&t.videoScreenOn.play(),D.apply(t)},I=async function(){var t=this,e=function(){var t=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var e=0;e<t.length;e++)if(t[e]+"Hidden"in document)return t[e]+"Hidden";return null}();if(document[e]){if(E)if(navigator.serviceWorker&&(navigator.serviceWorker.controller||t.map.getControlsByClass(a.Z.control.SWCacheClient).length&&"activated"===(await t.map.getControlsByClass(a.Z.control.SWCacheClient)[0].getServiceWorker()).state))try{(await navigator.serviceWorker.ready).showNotification(t.notificationConf.title,Object.assign(t.notificationConf,{actions:[{action:"back",title:t.getLocaleString("geo.trk.notification.backButton")}],data:{url:document.location.href}}))}catch(e){new Notification(t.notificationConf.title,t.notificationConf)}else{new Notification(t.notificationConf.title,t.notificationConf)}}else null!==C?L.apply(t):x.apply(t);!C&&t.videoScreenOn&&console.log("video is: "+t.videoScreenOn.paused)},M=function(){var t=this;b||(b=I.bind(t)),w||(w=O.bind(t)),S||(S=x.bind(t)),window.addEventListener("visibilitychange",b,!1),a.Z.Util.detectSafari()&&a.Z.browserFeatures.touch()&&!navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/CriOS/i)?(window.addEventListener("pagehide",w,!1),window.addEventListener("pageshow",S,!1)):(window.addEventListener("blur",w,!1),window.addEventListener("focus",S,!1))},R=function(){window.removeEventListener("visibilitychange",b,!1),a.Z.Util.detectSafari()&&a.Z.browserFeatures.touch()&&!navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/CriOS/i)?(window.removeEventListener("pagehide",w,!1),window.removeEventListener("pageshow",S,!1)):(window.removeEventListener("blur",w,!1),window.removeEventListener("focus",S,!1))},Z=function(){var t=a.Z.Util.storage.getSessionLocalValue(this.Const.LocalStorageKey.TRACKINGTEMP);t&&t.length>0&&i().setItem(this.Const.LocalStorageKey.TRACKINGTEMP,"string"==typeof t?t:JSON.stringify(t))},D=function(){var t=this;i().getItem(t.Const.LocalStorageKey.TRACKINGTEMP).then((function(e){null!==e&&"null"!==e&&e.length>0&&a.Z.Util.storage.setSessionLocalValue(t.Const.LocalStorageKey.TRACKINGTEMP,e)}))},k=function(t){const e=this;i().getItem(t).then((function(n){if(null==n){const n=e._dialogDiv.querySelector(".tc-ctl-geolocation-track-advert-dialog"),r=n.querySelector('input[type="checkbox"]');r.setAttribute("name",t),r.checked=!1,document.querySelector("#pageBlurMsg").textContent=a.Z.Util.detectMobile()?e.getLocaleString("geo.trk.page.blur"):e.getLocaleString("geo.trk.page.blur.desktop"),n.querySelector("h3").textContent=t===e.Const.LocalStorageKey.GPSSHOWADVERTISEMENT?e.getLocaleString("geo.track.activate")+" "+e.getLocaleString("geo.gps"):e.getLocaleString("geo.track.activate.title"),a.Z.Util.showModal(e._dialogDiv.querySelector(".tc-ctl-geolocation-track-advert-dialog"))}})),e.map.toast(a.Z.Util.detectMobile()?e.getLocaleString("geo.trk.page.blur"):e.getLocaleString("geo.trk.page.blur.desktop"),{type:a.Z.Consts.msgType.WARNING})};t._askTracking=function(t){return a.Z.Util.showModal(this._dialogDiv.querySelector(".tc-ctl-geolocation-continue-track-dialog"),{closeCallback:function(){a.Z.Util.isFunction(t)&&t()}}),!0},t.activateTracking=function(){var t=this,e=!0;t.isActive||t.activate(),t.clear(t.Const.Layers.TRACKING);try{a.Z.Util.storage.setSessionLocalValue(t.Const.LocalStorageKey.TEST,t.Const.LocalStorageKey.TEST)}catch(n){n.code===DOMException.QUOTA_EXCEEDED_ERR?a.Z.alert(t.getLocaleString("geo.error.trackinglocalstorage")):a.Z.error(n),e=!1}if(e){if(window.Notification||window.webkitNotifications){const t=window.Notification||window.webkitNotifications;"denied"===t.permission?E=null:"granted"===t.permission?E=t:t.requestPermission((function(e){"granted"===e&&(E=t)}))}if(L.apply(t),M.apply(t),t.sessionTracking=a.Z.Util.storage.getSessionLocalValue(t.Const.LocalStorageKey.TRACKINGTEMP),t.sessionTracking)t._askTracking((function(){p.call(t)}))||t.track.trackRenew.click();else v.call(t)}else p.call(t)},t.deactivateTracking=function(){var t=this,e=function(){return t.getTrackInfoPanel().then((t=>t.close())),Z.apply(t),t.wrap.setTracking(!1),delete t.geopositionTracking,c||t.div.querySelector(t._classSelector+"-track-render").querySelector("label").click(),T.apply(t),R.apply(t),t.off(t.Const.Event.POSITIONCHANGE),t.off(t.Const.Event.STATEUPDATED),p.call(t),t.track.trackName.value="",t.track.trackName.disabled=!0,t.track.trackSave.disabled=!0,t.track.trackWPT.value="",t.track.trackWPT.disabled=!0,t.track.trackAdd.disabled=!0,t.clear(t.Const.Layers.TRACKING),t.clear(t.Const.Layers.GPS),t.map.off(a.Z.Consts.event.ZOOM,y),!0};return t.wrap.hasCoordinates()?(t.map.toast(t.getLocaleString("geo.trk.deactivate.alert"),{duration:1e4}),e()):e()},t.getStoredTracks=function(){const t=this;return new Promise((function(e,n){var r=[];const o=function(t){0===F.length&&t.filter((t=>t.profile)).forEach((t=>F.push({uid:t.uid,data:JSON.parse(t.profile)}))),e(t)};i().keys().then((function(e){0===(e=e.filter((function(e){return 0!==e.indexOf(t.Const.LocalStorageKey.TRACKINGTEMP)&&0===e.indexOf(t.Const.LocalStorageKey.TRACKING)&&/trk#\d/i.exec(e)}))).length&&(t.availableTracks=r,o(r));const n=new Array(e.length);e.forEach((function(t,e){n[e]=new Promise((function(e,n){i().getItem(t,(function(t,n){e(n)}))}))})),Promise.all(n).then((function(e){if(e&&e.length){e.forEach((function(t){const e=JSON.parse(t);e instanceof Array?r=r.concat(e):r.push(e)}));var n=r.length>1?N(r):r;t.availableTracks=n,o(n)}}))})).catch((e=>{console.log("Capturamos error que se produce por configuración del navegador."),a.Z.error(t.getLocaleString("couldNotAccessLocalStorage"))}))}))};var N=function(t){var e=[];for(var n in t)t[n]&&"object"==typeof t[n]&&(e.push(t[n]),e.sort((function(t,e){return"string"==typeof t.name&&a.Z.Util.isFunction(t.name.localeCompare)?t.name.localeCompare(e.name):0})));return e};t.setStoredTracks=function(t){const e=this;return new Promise((function(n,r){const o=[];t.forEach((function(t){o.push(new Promise((function(n,r){i().setItem(e.Const.LocalStorageKey.TRACKING+"#"+t.uid,JSON.stringify(t),(function(t,e){n(e)}))})))})),Promise.all(o).then((function(){e.getStoredTracks().then((function(){e.bindTracks(),n()}))}))}))},t.getAvailableTracks=function(){const t=this;return new Promise((function(e,n){t.availableTracks?e(t.availableTracks):t.getStoredTracks().then((function(t){e(t)}))}))},t.bindTracks=function(){var t=this;t.track.trackList.querySelectorAll("li").forEach((function(t){t.style.display="none"})),t.getAvailableTracks().then((function(e){if(z(e))t.track.trackList.querySelectorAll('li[class^="tc-ctl-geolocation-track-available-empty"]').forEach((function(t){t.style.display=""})),t.track.trackSearch.disabled=!0;else{const i=t.getSelectedTrack();var n;i&&(n=i.dataset.uid),t.track.trackList.querySelectorAll("li[data-id]").forEach((function(e){t.track.trackList.removeChild(e)}));for(var r=0;r<e.length;r++){var o=e[r];o&&"object"==typeof o&&t.getRenderedHtml(t.CLASS+"-track-node",{id:r,uid:o.uid,name:o.name?o.name.trim():""},(function(e){const n=(new DOMParser).parseFromString(e,"text/html").body.firstChild;t.track.trackList.appendChild(n)}))}n&&t.setSelectedTrack(t.track.trackList.querySelector('li[data-uid="'+n+'"]')),t.track.trackSearch.disabled=!1}}))},t.chartProgressClear=function(){this.getElevationControl().then((t=>t&&t.removeElevationTooltip()))},t.chartSetProgress=function(t,e,n,r){var o=this;if(o.elevationControl&&o.elevationControl.resultsPanel&&(!o.elevationControl.resultsPanel.isVisible()||o.elevationControl.resultsPanel.isMinimized()))return;var i=t.d;if(o.elevationChartData&&o.elevationChartData.secondaryElevationProfileChartData&&Array.isArray(o.elevationChartData.secondaryElevationProfileChartData)&&o.elevationChartData.secondaryElevationProfileChartData.length>0&&o.elevationChartData.secondaryElevationProfileChartData[0]&&o.elevationChartData.secondaryElevationProfileChartData[0].elev&&!o.elevationChartData.secondaryElevationProfileChartData[0].elevCoords&&!o.elevationChartData.secondaryElevationProfileChartData[0].eleCoordinates){let t=[...o.elevationChartData.coords];Array.isArray(t)&&Array.isArray(t[0])&&(t.forEach(((t,e)=>{t.splice(2,1,o.elevationChartData.secondaryElevationProfileChartData[0].ele[e])})),o.elevationChartData.secondaryElevationProfileChartData[0].elevCoords=o.elevationChartData.secondaryElevationProfileChartData[0].eleCoordinates=t)}if(o.elevationChartData){let t=0;for(;o.elevationChartData.x[t]<=i;)t++;o.getElevationControl().then((e=>e&&e.getProfilePanel().then((function(e){e&&(e.chart.chart.tooltip.show({x:o.elevationChartData.x[0===t?0:t-1]}),e.wrap.hideElevationMarker())}))))}},t._getTime=function(t,e){var n=e-t,r={},o=Math.floor(n/1e3/60/60/24);n-=1e3*o*60*60*24;var i=Math.floor(n/1e3/60/60);n-=1e3*i*60*60,r.h=i+24*o;var s=Math.floor(n/1e3/60);return n-=1e3*s*60,r.m=s,r.s=Math.floor(n/1e3),a.Z.Util.extend({},r,{toString:("00000"+r.h).slice(-2)+":"+("00000"+r.m).slice(-2)+":"+("00000"+r.s).slice(-2)})},t.simulateTrack=async function(t){var e=this;const n=await e.getElevationControl();n.removeElevationTooltip(),e.simulate_speed=1,e.getSelectedTrack()===t&&n.resultsPanel&&n.resultsPanel.chart&&n.resultsPanel.chart.chart?(e.hasElevation||(e.hasElevation=0!==n.elevationProfileChartData.min||0!==n.elevationProfileChartData.max),e.wrap.simulateTrack()):e.drawTrack(t,!1).then((function(){e.elevationChartData&&0===e.elevationChartData.min&&0===e.elevationChartData.max?(e.map.toast(e.getLocaleString("geo.trk.simulate.empty"),{duration:1e4}),e.hasElevation=!1):0===e.elevationChartData.min&&0===e.elevationChartData.max||(e.hasElevation=!0),e.wrap.simulateTrack()}))},t.drawTrack=function(t,e){var n=this;return n.clear(n.Const.Layers.TRACK),h.call(n),new Promise((function(e,r){n.setSelectedTrack(t),n.drawTrackingData(t).then((function(){n.elevationTrack(t).then((()=>{n.activate(),e()})).catch(r)}))}))};const F=[],U=function(t){return F.filter((function(e){return e.uid.toString()===t.toString()}))[0]},G=function(t,e,n){const r=this;var o=U(n);return o||(o={uid:parseFloat(n)},F.push(o),r.getAvailableTracks().then((function(t){if(t){let o=t.findIndex((t=>t.uid.toString()===n));o>-1&&(t[o].profile=JSON.stringify(e),r.setStoredTracks(t))}}))),o.data=e,o},B=[];const j=function(t){let e=B.filter((function(e){return e.feature===t}))[0];return e||B.filter((function(e){return 0===function(t,e){for(var n=[],r=[],o=0;o<t.length;o++)n[t[o]]=!0;for(o=0;o<e.length;o++)n[e[o]]?delete n[e[o]]:n[e[o]]=!0;for(var i in n)r.push(i);return r}(e.feature.geometry,t.geometry).length}))[0]},W=function(t,e){var n=j(t);return n||(n={feature:t},B.push(n)),n.data=e,n},q=function(t){return a.Z.feature.Polyline&&t instanceof a.Z.feature.Polyline},H=function(){return this.layerTrack.features.filter((function(t){return q(t)}))[0]},V=function(){return this.layerTrack.features.filter((function(t){return a.Z.feature.Marker&&!(t instanceof a.Z.feature.Marker)&&!q(t)}))};t.elevationTrack=function(t,e){var o=this;return new Promise(((i,s)=>{e?o.wrap.simulateTrackEnd(e):(o.onResize||(o.onResize=o.elevationTrack.bind(o,t,!0),window.addEventListener("resize",o.onResize,!1)),o.getElevationControl().then((async function(e){if(e){let l=U(t.dataset.uid);if(l)o.options.displayElevation||delete l.data.secondaryElevationProfileChartData[0],o.elevationChartData=l.data,e.getProfilePanel().then((function(t){t.renderPromise().then((function(){t.doVisible(),e.renderElevationProfile(o.elevationChartData)})),t.setCurrentFeature()}));else{const i=await o.getTrackingData(t);if(o.layerTrack&&o.layerTrack.features){let l=o.layerTrack.features.filter((t=>q(t)&&(i.layout===ol.geom.GeometryLayout.XYZM||i.layout===ol.geom.GeometryLayout.XYZ||o.options.displayElevation)));if(l.length>0){let s=l[0],c={};if(i.layout===ol.geom.GeometryLayout.XYZM||i.layout===ol.geom.GeometryLayout.XYM){let t=0;t=i.layout===ol.geom.GeometryLayout.XYZM?s.geometry[s.geometry.length-1][3]-s.geometry[0][3]:s.geometry[s.geometry.length-1][2]-s.geometry[0][2],c={s:Math.floor(t/1e3%60),m:Math.floor(t/6e4%60),h:Math.floor(t/36e5%24)}}let u={originalElevation:!0,onlyOriginalElevation:!o.options.displayElevation,ignoreCaching:!0,time:c,callback:function(){o.elevationChartData=e.elevationProfileChartData,o.hasElevation=0!==e.elevationProfileChartData.min||0!==e.elevationProfileChartData.max,G.call(o,H.call(o),e.elevationProfileChartData,t.dataset.uid),n=n.bind(o),o.map.on(a.Z.Consts.event.FEATUREREMOVE,n),o.resultsPanelChart.div.addEventListener("mouseover",(function(t){o.layerTrack&&o.layerTrack.getVisibility()&&o.layerTrack.getOpacity()>0&&o.wrap.activateSnapping.call(o.wrap)})),o.resultsPanelChart.div.addEventListener("mouseout",(function(t){o.layerTrack&&!o.layerTrack.getVisibility()&&0==o.layerTrack.getOpacity()&&o.wrap.deactivateSnapping.call(o.wrap)})),o.map.on(a.Z.Consts.event.RESULTSPANELMIN,(function(){o.chartProgressClear()})).on(a.Z.Consts.event.RESULTSPANELCLOSE,(function(){o.chartProgressClear()})),e.getProfilePanel().then((function(t){o.getSelectedTrack()&&(t.currentFeature.fileName=r.call(o,o.getSelectedTrack()))}))}};e.displayElevationProfile(s,u)}else s()}else s()}i()}else s()})).catch(s))}))},t.clear=function(t){var e=this;e.onResize&&(window.removeEventListener("resize",e.onResize,!1),e.onResize=void 0),t===e.Const.Layers.TRACK?(e.layerTrack.clearFeatures(),e.getElevationControl().then((t=>t&&t.closeElevationProfile())),delete e.elevationChartData,e.wrap.simulateTrackEnd(),e.wrap.clear(),e.track.trackList.querySelectorAll("li").forEach((function(t){t.classList.remove(e.Const.Classes.SELECTEDTRACK)})),e.map.trigger(e.Const.Event.CLEARTRACK),e.featuresToShare=[],e.loadingState||delete e.toShare):(e.layerTracking.clearFeatures(),e.layerGPS.clearFeatures())},t.saveTrack=function(t){const e=this;return new Promise((function(n,r){let o=t.message||e.getLocaleString("geo.trk.save.alert");var i=async function(i){let s;s=e.getLoadingIndicator().addWait();let l=t.importedFileName||e.track.trackName.value.trim(),c=await e.getAvailableTracks(),u=e.wrap.formattedToStorage(i,!0,t.notReproject),p=function(t){e.track.trackName.value="",e.track.trackName.disabled=!0,e.track.trackSave.disabled=!0,e.track.trackWPT.value="",e.track.trackWPT.disabled=!0,e.track.trackAdd.disabled=!0,e.getLoadingIndicator().removeWait(t),h.call(e)},d={name:l,data:u.features,layout:u.layout,crs:e.storageCRS};const f=function(t){let e=JSON.parse(JSON.stringify(t));return e.data=e.data.replace(/(\"id\"\s?\:\s?\"[a-z0-9]+\")/gi,'""'),hex_md5(JSON.stringify(e))};a.Z.loadJS(!window.hex_md5,[a.Z.apiLocation+a.Z.Consts.url.HASH],(function(){let t=f(d),i=c.map((function(e){let n=JSON.parse(JSON.stringify(e));if(delete n.uid,delete n.profile,t===f(n))return e.uid;{const r=new ol.format.GeoJSON;let o=r.readFeatures(n.data),i=Math.pow(10,a.Z.Consts.DEGREE_PRECISION+1);return o.forEach((function(t){let e=a.Z.Util.explodeGeometry(a.Z.Util.compactGeometry(t.getGeometry().getCoordinates(),i));t.getGeometry().setCoordinates(e)})),n.data=r.writeFeatures(o),t===hex_md5(JSON.stringify(n))?e.uid:null}})).filter((function(t){return null!==t}));const l=function(t){return e.getStoredTracks().then((function(){let n;e.bindTracks();for(var r=0;r<e.availableTracks.length;r++)if(e.availableTracks[r].uid===t){n=r;break}return n}))};if(0===i.length){d.uid=Date.now()+Math.random(),c.push(d),c=N(c);try{e.setStoredTracks(c).then((function(){e.map.toast(o,{duration:3e3}),p(s),l(d.uid).then((function(t){n(t)}))}))}catch(t){a.Z.alert(e.getLocaleString("geo.error.savelocalstorage")+": "+t.message),p(s),r(t)}}else console.log("Ya existe un track con ese mismo hash"),p(s),l(i[0]).then((function(t){n(t)}))}))};e.importedFileName?i(e.layerTrack):0===e.track.trackName.value.trim().length?(e.track.trackName.value=(new Date).toLocaleString(),i(e.layerTracking)):i(e.layerTracking)}))},t.addWaypoint=function(){var t=this,e=t.track.trackWPT.value.trim();e||(e=(new Date).toLocaleString());var n=t.getLoadingIndicator().addWait();h.call(t),t.wrap.addWaypoint(t.currentPoint.position,{name:e,ele:t.currentPoint.heading,time:(new Date).getTime()}),t.track.trackWPT.value="",t.track.trackWPT.disabled=!0,t.track.trackAdd.disabled=!0,a.Z.Util.storage.setSessionLocalValue(t.Const.LocalStorageKey.TRACKINGTEMP,t.wrap.formattedToStorage(t.layerTracking).features),t.getLoadingIndicator().removeWait(n)},t.editTrackName=function(t,e){var n=this;n.getAvailableTracks().then((function(r){r&&r[t]&&(r[t].name=e,n.setStoredTracks(r))}))},t.removeTrack=function(t){var e=this;e.getAvailableTracks().then((function(n){if(n){var r=t.dataset.id;if(n[r]){var o=n[r].uid;a.Z.confirm(e.getLocaleString("geo.trk.delete.alert"),(function(){const t=e.getSelectedTrack();t&&t.dataset.id===r&&e.clear(e.Const.Layers.TRACK),i().removeItem(e.Const.LocalStorageKey.TRACKING+"#"+o).then((function(){e.getStoredTracks().then((function(){e.bindTracks()}))})).catch((function(t){console.log(t)}))}),(function(){}))}}}))},t.setSelectedTrack=function(t){var n=this;n.isActive||n.activate(),n.track.trackList.querySelectorAll("li[data-id] > span").forEach((function(t){t.setAttribute("title",t.textContent)})),n.track.trackList.querySelectorAll("li").forEach((function(t){t.classList.remove(n.Const.Classes.SELECTEDTRACK)})),t.classList.add(n.Const.Classes.SELECTEDTRACK);const r=function(o){HTMLElement.prototype.scrollIntoView?t.scrollIntoView({behavior:"smooth",block:"end"}):n.track.trackList.scrollTop=e.index*listElement.offsetHeight,t.removeEventListener("transitionend",r,!1)};t.addEventListener("transitionend",r,!1),t.setAttribute("title",n.getLocaleString("tr.lst.clear")+" "+t.querySelector("span").textContent),t.querySelector(n.Const.Selector.DRAW).setAttribute("title",t.getAttribute("title")),n.loadingState||delete n.toShare},t.getSelectedTrack=function(){return this.track.trackList.querySelector("li."+this.Const.Classes.SELECTEDTRACK)},t.clearSelectedTrack=function(){const t=this,e=t.getSelectedTrack();e&&(t.onResize&&(window.removeEventListener("resize",t.onResize,!1),t.onResize=void 0),e.classList.remove(t.Const.Classes.SELECTEDTRACK),e.setAttribute("title",e.textContent),e.querySelector(t.Const.Selector.DRAW).setAttribute("title",e.getAttribute("title")),delete t.toShare)},t.clearSelection=function(){var t=this;t.wrap.deactivateSnapping(),t.getSelectedTrack()&&t.clearSelectedTrack(),t.resultsPanelChart&&(t.resultsPanelChart.div.removeEventListener("mouseover",t.resultsPanelChart.deactivateSnapping),t.resultsPanelChart.div.removeEventListener("mouseout",t.resultsPanelChart.activateSnapping),t.resultsPanelChart.close()),t.clear(t.Const.Layers.TRACK)},t.drawTrackingData=function(t){const e=this;return new Promise((function(n,r){e.wrap.clear(),e.getTrackingData(t).then((function(t){t.data&&e.wrap.drawTrackingData(t).then((function(){var t=e.layerTrack.features;if(t&&t.length>0){var r=t.filter((function(t){return t.showsPopup=!1,!!(a.Z.feature.MultiPolyline&&t instanceof a.Z.feature.MultiPolyline)||t instanceof a.Z.feature.Polyline})).map((function(t){return a.Z.feature.MultiPolyline&&t instanceof a.Z.feature.MultiPolyline?t.geometry[0]:t instanceof a.Z.feature.Polyline?t.geometry:void 0}))[0];if(r){var o=r[0],i=r[r.length-1];o&&o!==i&&e.layerTrack.addMarker(o.slice().splice(0,2),{showsPopup:!1,cssClass:e.CLASS+"-track-marker-icon-end",anchor:[.5,1],notExport:!0}),i&&e.layerTrack.addMarker(i.slice().splice(0,2),{showsPopup:!1,cssClass:e.CLASS+"-track-marker-icon",anchor:[.5,1],notExport:!0})}}e.layerTrack.setVisibility(!0),n()}))}))}))},t.getTrackingData=function(t){const e=this;return new Promise((function(n,r){e.getAvailableTracks().then((function(r){if(r){const i=t.dataset.id;if(r[i]){var o=r[i].data;o=e.wrap.formattedFromStorage(o),n({data:o,layout:r[i].layout})}}else n()}))}))},t.export=function(t){return this.wrap.export(t)},t.clearFileInput=function(t){const e=document.createElement("form"),n=t.parentElement;n.insertBefore(e,t),e.appendChild(t),e.reset(),e.insertAdjacentElement("afterend",t),n.removeChild(e)},t.getLoadingIndicator=function(){var t=this;return t.loading||(t.loading=t.map.getControlsByClass(a.Z.control.LoadingIndicator),t.loading&&t.loading.length>0&&(t.loading=t.loading[0])),t.loading},t.onGeolocateError=function(t){var e,n=this;switch(navigator.geolocation&&(n.currentPosition&&navigator.geolocation.clearWatch(n.currentPosition),n.currentPositionTrk&&(n.currentPositionTrk=n.currentPositionTrk instanceof Array?n.currentPositionTrk:[n.currentPositionTrk],n.currentPositionTrk.forEach((function(t){navigator.geolocation.clearWatch(t)})),n.currentPositionTrk=[])),n.currentPositionWaiting&&n.getLoadingIndicator().removeWait(n.currentPositionWaiting),t.code){case t.PERMISSION_DENIED:e=n.getLocaleString("geo.error.permission_denied");break;case t.POSITION_UNAVAILABLE:e=n.getLocaleString("geo.error.position_unavailable");break;case t.TIMEOUT:e=n.getLocaleString("geo.error.timeout");break;default:e=n.getLocaleString("geo.error.default")}n.map.toast(e,{type:a.Z.Consts.msgType.WARNING}),!n.geopositionTracking&&n.track&&(n.track.activateButton.classList.remove(a.Z.Consts.classes.HIDDEN),n.track.deactivateButton.classList.add(a.Z.Consts.classes.HIDDEN))};var z=function(t){return!t||0===t.length};t.exportState=function(){const t=this;if(t.layerTrack&&t.track||t.toShare){let e={id:t.id};if(!t.toShare||t.toShare&&!t.toShare.doZoom){t.toShare={doZoom:!1};let n=Object.assign({},t.toShare),r=t.layerTrack.features;if(r.length>0&&t.featuresToShare&&t.featuresToShare.length>0)n.features=t.featuresToShare;else{const e=t.layerTrack.exportState({features:r});n.features=e.features}const o=t.getSelectedTrack();o&&(n.trackName=o.querySelector("span").innerHTML),e.trackResult=JSON.stringify(n)}else e.trackResult=JSON.stringify(t.toShare);return e}return null},t.importState=function(t){const e=this;if(e.map&&t.trackResult&&t.trackResult.length){e.enable();let n=JSON.parse(t.trackResult);if(n.features&&n.features.length>0){const t=new Array(n.features.length);n.features.forEach((function(e,n){const r={data:e.data,id:e.id,showsPopup:e.showsPopup};var o=e.geom;switch(e.type){case a.Z.Consts.geom.POLYLINE:t[n]=new a.Z.feature.Polyline(o,r);break;case a.Z.Consts.geom.MULTIPOLYLINE:t[n]=new a.Z.feature.MultiPolyline(o,r);break;case a.Z.Consts.geom.MARKER:t[n]=new a.Z.feature.Marker(o,r);break;case a.Z.Consts.geom.POINT:t[n]=new a.Z.feature.Point(o,r)}})),Object.prototype.hasOwnProperty.call(n,"doZoom")&&(e.loadingState=!0,e.toShare={doZoom:n.doZoom}),Promise.all(t).then((function(t){var r={features:t,fileName:n.trackName,notReproject:!0,isShared:!0};e.availableTracks?e.importTrack(r):e.getStoredTracks().then((function(){e.importTrack(r)}))}))}}}}();const u=a.Z.control.Geolocation},8410:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var r=n(5361),o=n(2089),i=n(128),a=n(4496);r.Z.control=r.Z.control||{},r.Z.Consts=o.Z,r.Z.control.FeatureInfoCommons=i.default,r.Z.filter=a.Z,function(){r.Z.control.GeometryFeatureInfo=function(){var t=this;r.Z.control.FeatureInfoCommons.apply(this,arguments),t.wrap=new r.Z.wrap.control.GeometryFeatureInfo(t),t._isDrawing=!1,t._isSearching=!1,t._drawToken=!1},r.Z.inherit(r.Z.control.GeometryFeatureInfo,r.Z.control.FeatureInfoCommons);var t=r.Z.control.GeometryFeatureInfo.prototype;t.register=function(t){const e=this,n=r.Z.control.FeatureInfoCommons.prototype.register.call(e,t);return e.on(r.Z.Consts.event.CONTROLDEACTIVATE,(function(t){e.wrap.cancelDraw()})),n},t.callback=function(t,e){var n=this;return new Promise((function(e,o){if(n._drawToken)e();else{n.closeResults(),n.filterFeature&&(n.filterLayer.removeFeature(n.filterFeature),n.filterFeature=null),n.highlightedFeature=null;for(var i=!1,a=0;a<n.map.workLayers.length;a++){var s=n.map.workLayers[a];if(s.type===r.Z.Consts.layerType.WMS&&s.getVisibility()&&s.names.length>0){i=!0;break}}i?(n.closeResults(),n.wrap.beginDraw({geometryType:n.geometryType,xy:t,layer:n.filterLayer,callback:function(t){n.wrap.getFeaturesByGeometry(t).then((()=>e()))}})):e()}}))},t.sendRequest=function(t){return this.wrap.getFeaturesByGeometry(t)},t.responseCallback=function(t){var e=this;if(r.Z.control.FeatureInfoCommons.prototype.responseCallback.call(e,t),e.filterFeature){for(var n=t.services,o=0;o<n.length;o++){var i=n[o];if(i.hasLimits)delete i.layers,i.hasLimits=i.hasLimits;else{for(var a=0;a<i.layers.length;a++)i.layers[a].features.length||(i.layers.splice(a,1),a-=1);i.layers.length||(n.splice(o,1),o-=1)}}e.renderData(t,(function(){n.length&&e.insertLinks(),e.div.querySelector(`.${e.CLASS}-coords`).classList.add(r.Z.Consts.classes.HIDDEN),e.info&&e.info.services.length?e.displayResults():e.map.toast(e.getLocaleString("query.msgNoResults"),{type:r.Z.Consts.msgType.INFO})}))}}}();const s=r.Z.control.GeometryFeatureInfo},8325:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>c});var r=n(5850),o=n(2089),i=n(7945),a=n(5361);class s extends HTMLElement{#i;constructor(t){super();const e=this;e.CLASS="tc-ctl-lang-link",e.#i=document.createElement("a"),e.#i.classList.add(e.CLASS),e.appendChild(e.#i),t&&(e.fullCode=t.fullCode,e.shortCode=t.shortCode,e.description=t.description)}connectedCallback(){const t=this;t.fullCode=t.fullCode,t.shortCode=t.shortCode,t.description=t.description}static get observedAttributes(){return["full-code","short-code","description","href"]}get fullCode(){return this.getAttribute("full-code")}set fullCode(t){this.setAttribute("full-code",t)}get shortCode(){return this.getAttribute("short-code")}set shortCode(t){const e=this;e.setAttribute("short-code",t),e.#i.dataset.langCode=t;let n=e;do{n=n.parentElement}while(n&&!(n instanceof l));e.#i.href=n?.getUrl(t),e.#i.innerHTML=t}get description(){return this.getAttribute("description")}set description(t){this.setAttribute("description",t),this.#i.setAttribute("title",t)}get href(){return this.#i.getAttribute("href")}set href(t){this.#i.setAttribute("href",t)}}customElements.define("sitna-language-option",s);class l extends r.default{static PARAMETER_NAME="lang";static COOKIE_NAME="SITNA.language";static#a;constructor(){super(...arguments);const t=this;t.CLASS="tc-ctl-lang-select",t.template={},t.template[t.CLASS]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<button class="tc-ctl-lang-select-toggle" title="'+a(s(n,"i18n").call(i,"selectLanguage",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:49},end:{line:1,column:74}}}))+'" type="button">'+a(s(n,"i18n").call(i,"selectLanguage",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:90},end:{line:1,column:115}}}))+'</button><div class="tc-ctl-lang-select-links">\n</div>'},useData:!0},t.options.static&&(t.static=!0),t.tagAttributeName=t.options.tagAttributeName||"data-sitna-i18n"}connectedCallback(){const t=this;if(super.connectedCallback(),t.languages=Array.from(t.querySelectorAll("sitna-language-option")),!t.languages.length){const e=t.options.languages||[{fullCode:"es-ES",shortCode:"es",description:"Ver en castellano"},{fullCode:"eu-ES",shortCode:"eu",description:"Euskaraz ikusi"},{fullCode:"en-US",shortCode:"en",description:"View in English"}];t.languages=e.map((t=>new s(t))),t.render()}t.static=t.static,t.static||(t.collapsed=t.collapsed||!0);const e=Array.from(t.querySelectorAll("sitna-language-option"));e.length&&(t.languages=e)}static get observedAttributes(){return["static","collapsed"]}attributeChangedCallback(t,e,n){if(e===n)return;const r=this;"static"===t&&(r.static=r.hasAttribute(t)),"collapsed"===t&&(r.collapsed=r.hasAttribute(t))}get static(){return this.hasAttribute("static")}set static(t){const e=this;t?e.setAttribute("static",""):e.removeAttribute("static")}get collapsed(){return this.hasAttribute("collapsed")}set collapsed(t){const e=this;t?e.setAttribute("collapsed",""):e.removeAttribute("collapsed")}register(t){const e=super.register.call(this,t);return t.ready((()=>l.setDocumentTexts())),e}render(){const t=this;return t._set1stRenderPromise(new Promise((function(e,n){t.renderData({languages:t.languages},(function(){const n=t.querySelector(`.${t.CLASS}-links`);let r;t.languages.forEach((e=>{n.appendChild(e);const i=e.querySelector(`a.${e.CLASS}`);i.addEventListener(o.Z.event.CLICK,(function(e){e.preventDefault(),t.setLanguage(e.target.dataset.langCode)})),l.currentLocale===e.fullCode&&(r=i)})),r??=t.languages[0].querySelector(`a.${language.CLASS}`),r.classList.add(o.Z.classes.ACTIVE),t.toggle=t.querySelector(`.${t.CLASS}-toggle`),t.toggle.addEventListener(o.Z.event.CLICK,(function(e){t.collapsed=!t.collapsed})),e(t)}))})))}getUrl(t){return i.Z.addURLParameters(window.location.href,{[l.PARAMETER_NAME]:t})}setLanguage(t){const e=this.languages.map((t=>t.querySelector(`a.${t.CLASS}`)));e.forEach((t=>t.classList.remove(o.Z.classes.ACTIVE))),e.find((e=>e.dataset.langCode===t))?.classList.add(o.Z.classes.ACTIVE),window.location.href=this.getUrl(t)}static setDocumentTexts(){document.querySelectorAll(`[${self.tagAttributeName}]`).forEach((function(t){let e=t.innerHTML;const n=e.match(/\{\{([^\{\}]+)\}\}/g);if(n)for(var r=0,o=n.length;r<o;r++){const t=n[r],o=t.match(/[^\{\}]+/)[0];e=e.replace(t,i.Z.getLocaleString(l.currentLocale,o))}t.innerHTML!==e&&(t.innerHTML=e)}))}static get currentLocale(){return l.#a||(l.#a=i.Z.getLocaleUserChoice({cookieName:l.COOKIE_NAME,paramName:l.PARAMETER_NAME})),l.#a}}l.currentLocale,a.Z.control=a.Z.control||{},a.Z.control.LanguageSelector=l,customElements.define("sitna-language-select",l);const c=l},1231:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var r=n(5361),o=n(2089),i=n(1926),a=n(7364);r.Z.control=r.Z.control||{},r.Z.UI=r.Z.UI||{},r.Z.UI.autocomplete=a.Z,r.Z.Consts=o.Z,r.Z.control.ProjectionSelector=i.default,function(){r.Z.control.LayerCatalog=function(){var t=this;t.layers=[],t.searchInit=!1,r.Z.control.ProjectionSelector.apply(t,arguments),t._selectors={LAYER_ROOT:"div."+t.CLASS+"-tree > ul."+t.CLASS+"-branch > li."+t.CLASS+"-node"},r.Z.Consts.classes.SELECTABLE||(r.Z.Consts.classes.SELECTABLE="tc-selectable"),r.Z.Consts.classes.INCOMPATIBLE||(r.Z.Consts.classes.INCOMPATIBLE="tc-incompatible"),r.Z.Consts.classes.ACTIVE||(r.Z.Consts.classes.ACTIVE="tc-active")},r.Z.inherit(r.Z.control.LayerCatalog,r.Z.control.ProjectionSelector);var t=r.Z.control.LayerCatalog.prototype;t.CLASS="tc-ctl-lcat",t.template={},t.template[t.CLASS]={1:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=s(n,"if").call(a,null!=e?s(e,"layerTrees"):e,{name:"if",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:4,column:8},end:{line:6,column:15}}}))?i:"")+(null!=(i=s(n,"if").call(a,null!=e?s(e,"layers"):e,{name:"if",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:7,column:8},end:{line:9,column:15}}}))?i:"")},2:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <button type="button" class="tc-icon-btn tc-ctl-lcat-btn-search" title="'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"searchLayersByText",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:76},end:{line:5,column:105}}}))+'"></button>\r\n'},4:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <ul class="tc-ctl-lcat-branch">\r\n'+(null!=(i=a(n,"each").call(null!=e?e:t.nullContext||{},null!=e?a(e,"layerTrees"):e,{name:"each",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:25,column:8},end:{line:27,column:17}}}))?i:"")+"    </ul>\r\n"},5:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-lcat-branch"),e,{name:"tc-ctl-lcat-branch",data:o,indent:"            ",helpers:n,partials:r,decorators:t.decorators}))?i:""},7:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=a(n,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"layers"):e,{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.program(11,o,0),data:o,loc:{start:{line:30,column:8},end:{line:40,column:15}}}))?i:""},8:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <ul class="tc-ctl-lcat-branch">\r\n'+(null!=(i=a(n,"each").call(null!=e?e:t.nullContext||{},null!=e?a(e,"layers"):e,{name:"each",hash:{},fn:t.program(9,o,0),inverse:t.noop,data:o,loc:{start:{line:32,column:16},end:{line:34,column:25}}}))?i:"")+"            </ul>\r\n"},9:function(t,e,n,r,o){var i=t.lambda,a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                    <li data-layer-id="'+a(i(null!=e?s(e,"id"):e,e))+'" title="'+a(s(n,"i18n").call(null!=e?e:t.nullContext||{},"loadingLayers",{name:"i18n",hash:{},data:o,loc:{start:{line:33,column:54},end:{line:33,column:78}}}))+'" class="tc-ctl-lcat-loading-node"> '+a(i(null!=e?s(e,"title"):e,e))+"</li>\r\n"},11:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <div class="tc-ctl tc-ctl-lcat-loading">\r\n                <span>'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"loadingLayerTree",{name:"i18n",hash:{},data:o,loc:{start:{line:38,column:22},end:{line:38,column:49}}}))+"...</span>\r\n            </div>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>\r\n    "+s(l(n,"i18n").call(a,"availableLayers",{name:"i18n",hash:{},data:o,loc:{start:{line:2,column:4},end:{line:2,column:30}}}))+"\r\n"+(null!=(i=l(n,"if").call(a,null!=e?l(e,"enableSearch"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:4},end:{line:10,column:11}}}))?i:"")+'</h2>\r\n\r\n\r\n<div class="tc-ctl-lcat-search tc-hidden tc-collapsed">\r\n    <div class="tc-group">\r\n        <input type="search" class="tc-ctl-lcat-input tc-textbox" placeholder="'+s(l(n,"i18n").call(a,"textToSearchInLayers",{name:"i18n",hash:{},data:o,loc:{start:{line:16,column:79},end:{line:16,column:110}}}))+'">\r\n    </div>\r\n    <ul></ul>\r\n\r\n</div>\r\n\r\n<div class="tc-ctl-lcat-tree">\r\n'+(null!=(i=l(n,"if").call(a,null!=e?l(e,"layerTrees"):e,{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.program(7,o,0),data:o,loc:{start:{line:23,column:4},end:{line:41,column:11}}}))?i:"")+'</div>\r\n<div class="tc-ctl-lcat-info tc-hidden">\r\n'+(null!=(i=t.invokePartial(l(r,"tc-ctl-lcat-info"),e,{name:"tc-ctl-lcat-info",data:o,indent:"    ",helpers:n,partials:r,decorators:t.decorators}))?i:"")+"</div>"},usePartial:!0,useData:!0},t.template[t.CLASS+"-branch"]={1:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'class="tc-ctl-lcat-node'+(null!=(i=a(n,"unless").call(null!=e?e:t.nullContext||{},null!=e?a(e,"expanded"):e,{name:"unless",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:43},end:{line:1,column:87}}}))?i:"")+'"'},2:function(t,e,n,r,o){return" tc-collapsed"},4:function(t,e,n,r,o){return'class="tc-ctl-lcat-node tc-ctl-lcat-leaf"'},6:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-lcat-node"),e,{name:"tc-ctl-lcat-node",data:o,indent:"            ",helpers:n,partials:r,decorators:t.decorators}))?i:""},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lambda,l=t.escapeExpression,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<li "+(null!=(i=c(n,"if").call(a,null!=e?c(e,"children"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(4,o,0),data:o,loc:{start:{line:1,column:4},end:{line:1,column:144}}}))?i:"")+' data-layer-name="'+l(s(null!=e?c(e,"name"):e,e))+'" data-layer-uid="'+l(s(null!=e?c(e,"uid"):e,e))+'">\r\n    <button type="button" class="tc-ctl-lcat-collapse-btn"></button>\r\n    <span>'+l(s(null!=e?c(e,"title"):e,e))+'</span>\r\n    <ul class="tc-ctl-lcat-branch'+(null!=(i=c(n,"unless").call(a,null!=e?c(e,"expanded"):e,{name:"unless",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:4,column:33},end:{line:4,column:77}}}))?i:"")+'">\r\n'+(null!=(i=c(n,"each").call(a,null!=e?c(e,"children"):e,{name:"each",hash:{},fn:t.program(6,o,0),inverse:t.noop,data:o,loc:{start:{line:5,column:8},end:{line:7,column:17}}}))?i:"")+"    </ul>\r\n</li>"},usePartial:!0,useData:!0},t.template[t.CLASS+"-node"]={1:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lambda,l=t.escapeExpression,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<li "+(null!=(i=c(n,"if").call(a,null!=e?c(e,"children"):e,{name:"if",hash:{},fn:t.program(2,o,0),inverse:t.program(5,o,0),data:o,loc:{start:{line:1,column:21},end:{line:1,column:164}}}))?i:"")+'data-layer-name="'+l(s(null!=e?c(e,"name"):e,e))+'" data-layer-uid="'+l(s(null!=e?c(e,"uid"):e,e))+'">'+(null!=(i=c(n,"if").call(a,null!=e?c(e,"children"):e,{name:"if",hash:{},fn:t.program(7,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:216},end:{line:1,column:303}}}))?i:"")+'<span data-tooltip="'+(null!=(i=c(n,"if").call(a,null!=e?c(e,"name"):e,{name:"if",hash:{},fn:t.program(9,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:323},end:{line:1,column:368}}}))?i:"")+'">'+l(s(null!=e?c(e,"title"):e,e))+"</span>"+(null!=(i=c(n,"if").call(a,null!=e?c(e,"name"):e,{name:"if",hash:{},fn:t.program(11,o,0),inverse:t.program(13,o,0),data:o,loc:{start:{line:1,column:386},end:{line:1,column:789}}}))?i:"")+'<ul class="tc-ctl-lcat-branch'+(null!=(i=c(n,"unless").call(a,null!=e?c(e,"expanded"):e,{name:"unless",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:818},end:{line:1,column:862}}}))?i:"")+'">'+(null!=(i=c(n,"each").call(a,null!=e?c(e,"children"):e,{name:"each",hash:{},fn:t.program(18,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:864},end:{line:1,column:913}}}))?i:"")+"</ul></li>"},2:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return' class="tc-ctl-lcat-node'+(null!=(i=a(n,"unless").call(null!=e?e:t.nullContext||{},null!=e?a(e,"expanded"):e,{name:"unless",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:61},end:{line:1,column:105}}}))?i:"")+'" '},3:function(t,e,n,r,o){return" tc-collapsed"},5:function(t,e,n,r,o){return'class="tc-ctl-lcat-node tc-ctl-lcat-leaf" '},7:function(t,e,n,r,o){return'<button type="button" class="tc-ctl-lcat-collapse-btn"></button>'},9:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"clickToAddToMap",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:335},end:{line:1,column:361}}}))},11:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<input type="checkbox" title="'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"infoFromThisLayer",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:428},end:{line:1,column:456}}}))+'" class="tc-toggle tc-ctl-lcat-btn-info" ></input>'},13:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=a(n,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"abstract"):e,{name:"if",hash:{},fn:t.program(14,o,0),inverse:t.program(16,o,0),data:o,loc:{start:{line:1,column:514},end:{line:1,column:782}}}))?i:""},14:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<input type="checkbox" title="'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"infoFromThisLayer",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:560},end:{line:1,column:588}}}))+'" class="tc-toggle tc-ctl-lcat-btn-info"></input>'},16:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=a(n,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"metadata"):e,{name:"if",hash:{},fn:t.program(14,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:645},end:{line:1,column:775}}}))?i:""},18:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-lcat-node"),e,{name:"tc-ctl-lcat-node",data:o,helpers:n,partials:r,decorators:t.decorators}))?i:""},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=a(n,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"isVisible"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:0},end:{line:1,column:930}}}))?i:""},usePartial:!0,useData:!0},t.template[t.CLASS+"-info"]={1:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-lcat-abstract">\r\n    <h4>'+t.escapeExpression(a(n,"i18n").call(null!=e?e:t.nullContext||{},"abstract",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:8},end:{line:6,column:27}}}))+"</h4>\r\n    <div><pre>"+(null!=(i=t.lambda(null!=e?a(e,"abstract"):e,e))?i:"")+"</pre></div>\r\n</div>\r\n"},3:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-lcat-metadata">\r\n    <h4>'+t.escapeExpression(s(n,"i18n").call(a,"metadata",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:8},end:{line:12,column:27}}}))+"</h4>\r\n    <ul>\r\n"+(null!=(i=s(n,"each").call(a,null!=e?s(e,"metadata"):e,{name:"each",hash:{},fn:t.program(4,o,0),inverse:t.noop,data:o,loc:{start:{line:14,column:8},end:{line:16,column:17}}}))?i:"")+"    </ul>\r\n</div>\r\n"},4:function(t,e,n,r,o){var i,a=t.lambda,s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <li><a href="'+(null!=(i=a(null!=e?l(e,"url"):e,e))?i:"")+'" type="'+s(a(null!=e?l(e,"format"):e,e))+'" title="'+s(a(null!=e?l(e,"formatDescription"):e,e))+'" target="_blank">'+(null!=(i=a(null!=e?l(e,"formatDescription"):e,e))?i:"")+"</a></li>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<a class="tc-ctl-lcat-info-close"></a>\r\n<h2>'+s(l(n,"i18n").call(a,"layerInfo",{name:"i18n",hash:{},data:o,loc:{start:{line:2,column:4},end:{line:2,column:24}}}))+'</h2>\r\n<h3 class="tc-ctl-lcat-title">'+s(t.lambda(null!=e?l(e,"title"):e,e))+"</h3>\r\n"+(null!=(i=l(n,"if").call(a,null!=e?l(e,"abstract"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:4,column:0},end:{line:9,column:7}}}))?i:"")+(null!=(i=l(n,"if").call(a,null!=e?l(e,"metadata"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:10,column:0},end:{line:19,column:7}}}))?i:"")},useData:!0},t.template[t.CLASS+"-results"]={1:function(t,e,n,r,o,i,a){var s,l=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(s=c(n,"if").call(l,c(n,"gt").call(l,null!=a[1]?c(a[1],"servicesLooked"):a[1],1,{name:"gt",hash:{},data:o,loc:{start:{line:2,column:10},end:{line:2,column:34}}}),{name:"if",hash:{},fn:t.program(2,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:2,column:4},end:{line:5,column:11}}}))?s:"")+(null!=(s=c(n,"each").call(l,null!=e?c(e,"founds"):e,{name:"each",hash:{},fn:t.program(5,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:6,column:8},end:{line:11,column:14}}}))?s:"")+(null!=(s=c(n,"if").call(l,c(n,"gt").call(l,null!=a[1]?c(a[1],"servicesLooked"):a[1],1,{name:"gt",hash:{},data:o,loc:{start:{line:12,column:10},end:{line:12,column:34}}}),{name:"if",hash:{},fn:t.program(12,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:12,column:4},end:{line:14,column:11}}}))?s:"")},2:function(t,e,n,r,o){var i,a=t.lambda,s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li class="tc-ctl-lcat-search-group '+(null!=(i=l(n,"if").call(null!=e?e:t.nullContext||{},null!=(i=null!=e?l(e,"service"):e)?l(i,"isCollapsed"):i,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:36},end:{line:3,column:82}}}))?i:"")+'" data-service-id="'+s(a(null!=(i=null!=e?l(e,"service"):e)?l(i,"id"):i,e))+'">\r\n    <h5>'+s(a(null!=(i=null!=e?l(e,"service"):e)?l(i,"title"):i,e))+"</h5><ul>\r\n"},3:function(t,e,n,r,o){return"tc-collapsed"},5:function(t,e,n,r,o){var i,a=t.lambda,s=t.escapeExpression,l=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <li data-layer-name="'+s(a(null!=e?c(e,"Name"):e,e))+'" '+(null!=(i=c(n,"if").call(l,null!=e?c(e,"alreadyAdded"):e,{name:"if",hash:{},fn:t.program(6,o,0),inverse:t.noop,data:o,loc:{start:{line:7,column:39},end:{line:7,column:85}}}))?i:"")+'>\r\n        <h5 class="tc-selectable"'+(null!=(i=c(n,"if").call(l,null!=e?c(e,"alreadyAdded"):e,{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.program(10,o,0),data:o,loc:{start:{line:8,column:33},end:{line:8,column:154}}}))?i:"")+">"+s(a(null!=e?c(e,"Title"):e,e))+'</h5>\r\n        <input type="checkbox" class="tc-toggle tc-ctl-lcat-search-btn-info" title="'+s(c(n,"i18n").call(l,"infoFromThisLayer",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:84},end:{line:9,column:112}}}))+'"></input>\r\n        </li>\r\n'},6:function(t,e,n,r,o){return' class="tc-checked"'},8:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return' data-tooltip="'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"layerAlreadyAdded",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:68},end:{line:8,column:96}}}))+'"'},10:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return' data-tooltip="'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"clickToAddToMap",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:120},end:{line:8,column:146}}}))+'"'},12:function(t,e,n,r,o){return"</ul></li>\r\n"},14:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li class="tc-ctl-lcat-no-results"><h5>'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"noMatches",{name:"i18n",hash:{},data:o,loc:{start:{line:16,column:39},end:{line:16,column:59}}}))+"</h5></li>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o,i,a){var s,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(s=l(n,"each").call(null!=e?e:t.nullContext||{},null!=e?l(e,"servicesFound"):e,{name:"each",hash:{},fn:t.program(1,o,0,i,a),inverse:t.program(14,o,0,i,a),data:o,loc:{start:{line:1,column:0},end:{line:17,column:9}}}))?s:""},useData:!0,useDepths:!0},t.template[t.CLASS+"-dialog"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-lcat-crs-dialog tc-modal">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+a(s(n,"i18n").call(i,"changeCRS",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:16},end:{line:5,column:36}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <p>'+a(s(n,"i18n").call(i,"wmsLayerNotCompatible.instructions",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:15},end:{line:9,column:60}}}))+'</p>\r\n            <ul class="tc-ctl-lcat-crs-list tc-crs-list"></ul>\r\n        </div>\r\n        <div class="tc-modal-footer">\r\n            <button type="button" class="tc-button tc-modal-close">'+a(s(n,"i18n").call(i,"close",{name:"i18n",hash:{},data:o,loc:{start:{line:13,column:67},end:{line:13,column:83}}}))+"</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},useData:!0};t.register=function(t){const e=this,n=r.Z.control.ProjectionSelector.prototype.register.call(e,t),o=function(t,n){if(Array.isArray(e.options.layers)){for(var o=0;o<e.options.layers.length;o++){var i=e.options.layers[o];i.type&&i.type!==r.Z.Consts.layerType.WMS||(i.id||(i.id=r.Z.getUID()),r.Z.Util.isPlainObject(i)&&(i=new r.Z.layer.Raster(i)),e.layers.push(i))}e.render((function(){t()}))}else t()};e._readyPromise=new Promise((function(e,n){const i=function(n){n.layer===t.baseLayer&&(o(e),t.off(r.Z.Consts.event.LAYERUPDATE,i))};t.loaded((function(){t.baseLayer.state&&t.baseLayer.state!==r.Z.Layer.state.IDLE?t.on(r.Z.Consts.event.LAYERUPDATE,i):o(e)}))}));var s=e.getLocaleString("clickToAddToMap");return t.on(r.Z.Consts.event.BEFORELAYERADD+" "+r.Z.Consts.event.BEFOREUPDATEPARAMS,(function(t){e.getLayerNodes(t.layer).forEach((function(t){t.classList.add(r.Z.Consts.classes.LOADING),delete t.querySelector("span").dataset.tooltip}))})).on(r.Z.Consts.event.LAYERADD+" "+r.Z.Consts.event.UPDATEPARAMS,(function(t){const n=t.layer;n.isBase||n.type!==r.Z.Consts.layerType.WMS||e.loaded().then((function(){if(e.getLayerRootNode(n))a.call(e,n);else{for(var t=!1,o=0,i=e.layers.length;o<i;o++){var s=e.layers[o];if(s.type===n.type&&s.options.url===n.options.url){t=!0;break}}t?(e.layersToSetChecked||(e.layersToSetChecked=[]),e.layersToSetChecked.push(n)):e.addLayer(new r.Z.layer.Raster({url:n.options.url,type:n.type,layerNames:[],title:n.title||n.wrap.getServiceTitle(),hideTitle:!0,hideTree:!1})).then((function(){a.call(e,n)}))}}))})).on(r.Z.Consts.event.LAYERERROR,(function(t){const n=t.reason;e.layers.some((e=>e===t.layer))&&(n&&r.Z.alert(e.getLocaleString(n,{url:t.layer.url})),e.getLayerNodes(t.layer).forEach((function(t){t.classList.remove(r.Z.Consts.classes.LOADING)})))})).on(r.Z.Consts.event.LAYERREMOVE,(function(t){const n=t.layer;e.getLayerNodes(n).forEach((function(t){t.classList.remove(r.Z.Consts.classes.CHECKED),t.querySelector("span").dataset.tooltip=s})),function(t){const n=[];if(!t.isBase){var r=t.options.url;e.list&&e.list.querySelectorAll("li").forEach((function(o){const i=e.getLayer(o.dataset.layerId);if(i&&i.type===t.type&&i.options.url===r)for(var a=0;a<t.names.length;a++)if(o.dataset.layerName===t.names[a]){n.push(o);break}}))}return n}(n).forEach((function(t){t.classList.remove(r.Z.Consts.classes.CHECKED),t.querySelector("h5").dataset.tooltip=s})),function(t){var n=e.map.getControlsByClass(r.Z.control.WorkLayerManager)[0];if(n)for(var o=n.layers,i=0;i<o.length;i++){var a=o[i];a!==t&&e.getLayerNodes(a).forEach((function(t){t.classList.add(r.Z.Consts.classes.CHECKED),t.querySelector("span").dataset.tooltip=e.getLocaleString("layerAlreadyAdded")}))}}(n),i.call(e)})).on(r.Z.Consts.event.EXTERNALSERVICEADDED,(function(t){t&&t.layer&&(e.addLayer(t.layer),e.div.classList.remove(r.Z.Consts.classes.COLLAPSED))})).on(r.Z.Consts.event.PROJECTIONCHANGE,(function(t){e.update()})),n};const e=function(e){e.target.blur(),e.stopPropagation();const n=e.target.parentElement;if("LI"===n.tagName&&!n.classList.contains(t.CLASS+"-leaf")){n.classList.toggle(r.Z.Consts.classes.COLLAPSED);n.querySelector("ul").classList.toggle(r.Z.Consts.classes.COLLAPSED)}},n=function(t,e,n){const o=t.target.parentNode;if(!o.classList.contains(r.Z.Consts.classes.LOADING)&&!o.classList.contains(r.Z.Consts.classes.CHECKED)){t.preventDefault;var i=o.dataset.layerName;i=void 0!==i?i.toString():"";var a=n.call(e,o);if(a&&i){var s=1;/iPad/i.test(navigator.userAgent)?s=10:r.Z.Util.detectFirefox()&&(s=250),a.title||(a.title=a.getTree().title),o.classList.add(r.Z.Consts.classes.LOADING),o.querySelector("span,h5").dataset.tooltip="";(function(t){return new Promise((function(e,n){setTimeout((function(){t.setAttribute("offsetHeight",t.offsetHeight),t.setAttribute("offsetWidth",t.offsetWidth),e()}),s)}))})(o).then((function(){e.addLayerToMap(a,i)})),t.stopPropagation()}}},o=function(){const t=this;t.textInput=t.div.querySelector("."+t.CLASS+"-input"),t.list=t.div.querySelector("."+t.CLASS+"-search ul"),t.textInput.addEventListener("mouseup",(function(e){""!==t.textInput.value&&setTimeout((function(){""===t.textInput.value&&(t.list.innerHTML="")}),1)}));var e=[];if(r.Z._search=r.Z._search||{},r.Z._search.retryTimeout=null,r.Z.UI.autocomplete.call(t.textInput,{link:"#",target:t.list,minLength:0,source:function(n,o){e=[],t._roots.forEach((function(t){t.querySelectorAll("li."+r.Z.Consts.classes.CHECKED).forEach((function(t){e.push(t.dataset.layerName)}))})),(n=n.trim()).length<3?t.list.innerHTML="":n.length>=3&&(r.Z._search.retryTimeout&&clearTimeout(r.Z._search.retryTimeout),r.Z._search.retryTimeout=setTimeout((function(){for(var e=[],r=0,i=t.sourceLayers.length;r<i;r++){const o=t.sourceLayers[r];var a=o.searchSubLayers(n);a.length&&e.push({service:{id:o.id,title:o.title||o.id},founds:a})}o({servicesFound:e,servicesLooked:t.sourceLayers.length})}),r.Z._search.interval))},callback:function(e){t.textInput.value=e.target.text||e.target.innerText,r.Z._search.lastPattern=t.textInput.value,t.goToResult(unescape(e.target.hash).substring(1)),r.Z.UI.autocomplete.call(t.textInput,"clear")},buildHTML:function(n){var o=this.target;if(n.results&&n.results.servicesFound.length>0)for(var i=t.map.getLayerTree().workLayers,a=0;a<n.results.servicesFound.length;a++){for(var s=n.results.servicesFound[a].founds,l=0;l<s.length;l++){delete s[l].alreadyAdded;for(var c=0;c<i.length;c++)if(e.indexOf(s[l].Name)>=0){s[l].alreadyAdded=!0;break}s[l].Name||(s.splice(l,1),l--)}n.results.servicesFound[a].founds.length?t.div.querySelectorAll(".tc-ctl-lcat-search-group")[a]&&(n.results.servicesFound[a].service.isCollapsed=t.div.querySelectorAll(".tc-ctl-lcat-search-group")[a].classList.contains(r.Z.Consts.classes.COLLAPSED)):n.results.servicesFound.splice(a,1)}var u="";return t.getRenderedHtml(t.CLASS+"-results",n.results).then((function(e){o.innerHTML=u=e;const n=t.div.querySelector(`.${t.CLASS}-info`);if(n){const e=n.dataset.serviceId;let r=`li[data-layer-name="${n.dataset.layerName}"] input[type="checkbox"].${t.CLASS}-search-btn-info`;t.sourceLayers.length>1&&(r=`li[data-service-id="${e}"] ${r}`);const i=o.querySelector(r);i&&(i.checked=!0)}})),u}}),!t.searchInit){t.div.querySelector("h2 button").addEventListener(r.Z.Consts.event.CLICK,(function(e){e.target.blur();const n=t.div.querySelector("."+t.CLASS+"-search"),o=t.div.querySelector("."+t.CLASS+"-tree"),i=t.div.querySelector("."+t.CLASS+"-info"),a=n.classList.contains(r.Z.Consts.classes.HIDDEN);if(n.classList.toggle(r.Z.Consts.classes.HIDDEN,!a),o.classList.toggle(r.Z.Consts.classes.HIDDEN,a),e.target.classList.toggle(t.CLASS+"-btn-tree",a),e.target.classList.toggle(t.CLASS+"-btn-search",!a),a)t.textInput.focus(),e.target.setAttribute("title",t.getLocaleString("viewAvailableLayersTree"));else{e.target.setAttribute("title",t.getLocaleString("searchLayersByText"));t.div.querySelectorAll(".tc-ctl-lcat-tree li input[type=checkbox]:checked").length>0&&i.classList.remove(r.Z.Consts.classes.HIDDEN)}}),{passive:!0}),t.div.addEventListener("change",r.Z.EventTarget.listenerBySelector("."+t.CLASS+"-search input[type=checkbox]."+t.CLASS+"-search-btn-info",(function(e){e.stopPropagation();const n=e.target;if(n.checked){const e=n.parentElement;var r=e;do{r=r.parentElement}while(r&&"LI"!==r.tagName);t.showLayerInfo(t.layers.length>1?t.layers.filter((t=>t.id===r.dataset.serviceId))[0]:t.layers[0],e.dataset.layerName)}else t.hideLayerInfo()}))),t.div.addEventListener("click",r.Z.EventTarget.listenerBySelector("."+t.CLASS+"-search input[type=checkbox]."+t.CLASS+"-search-btn-info",(function(t){t.stopPropagation()})));const e="."+t.CLASS+"-search li";t.div.addEventListener("click",r.Z.EventTarget.listenerBySelector(e,(function(o){o.stopPropagation();for(var i=o.target;i&&!i.matches(e);)i=i.parentElement;i.classList.contains(t.CLASS+"-no-results")||(i.classList.contains(t.CLASS+"-search-group")?i.classList.toggle(r.Z.Consts.classes.COLLAPSED):n(o,t,(function(){return 1===this.layers.length?this.layers[0]:this.getLayer(i.closest(".tc-ctl-lcat-search-group")&&i.closest(".tc-ctl-lcat-search-group").dataset.serviceId)})))}))),t.searchInit=!0}},i=function(){const t=this;if("createEvent"in document){var e=document.createEvent("HTMLEvents");e.initEvent("keyup",!1,!0),t.textInput&&t.textInput.dispatchEvent(e)}else t.textInput&&t.textInput.fireEvent("keyup")},a=function(t){const e=this,n=e.map.workLayers.filter((e=>e.type===t.type&&e.url===t.url)).map((t=>e.getLayerNodes(t))).flat();n.forEach((function(t){t.classList.remove(r.Z.Consts.classes.LOADING),t.classList.add(r.Z.Consts.classes.CHECKED),t.querySelector("span").dataset.tooltip=e.getLocaleString("layerAlreadyAdded")})),e.getLayerRootNode(t).querySelectorAll("li.tc-ctl-lcat-node.tc-ctl-lcat-leaf.tc-checked").forEach((function(t){n.find((e=>e===t))||(t.classList.remove(r.Z.Consts.classes.CHECKED),t.querySelector("span").dataset.tooltip=e.getLocaleString("clickToAddToMap"))})),i.call(e)},s=function(){const t=this;t.layersToSetChecked&&t.layersToSetChecked.length>0&&t.layersToSetChecked.forEach((function(e,n,r){t.getLayerRootNode(e)&&(a.call(t,e),r.splice(n,1))}))},l=function(t,o){const i=this;t.querySelectorAll("li > button."+i.CLASS+"-collapse-btn").forEach((function(t){t.addEventListener("click",e)})),t.querySelectorAll("span").forEach((function(t){t.addEventListener("click",(function(t){n(t,i,(function(t){for(var e=0,n=this._roots.length;e<n;e++){const n=this._roots[e];if(n.contains(t))return this.getLayer(n.dataset.layerId)}return i.getLayer(t.dataset.layerId)}))}))})),i._roots=i.div.querySelectorAll(i._selectors.LAYER_ROOT),t.dataset.layerId=o.id,t.querySelectorAll("."+i.CLASS+"-btn-info").forEach((function(t){const e=t.parentElement.querySelector("span"),n=t.parentElement.dataset.layerName;if(n){e.classList.add(r.Z.Consts.classes.SELECTABLE);var a=o.getInfo(n);if(Object.prototype.hasOwnProperty.call(a,"abstract")||Object.prototype.hasOwnProperty.call(a,"legend")||Object.prototype.hasOwnProperty.call(a,"metadata")?(t.addEventListener("change",(function(t){t.stopPropagation();this.checked?i.showLayerInfo(o,n):i.hideLayerInfo()}),{passive:!0}),t.addEventListener(r.Z.Consts.event.CLICK,(function(t){t.stopPropagation()}),{passive:!0})):t.parentElement.removeChild(t),o.compatibleLayers&&o.compatibleLayers.indexOf(n)<0&&(e.classList.add(r.Z.Consts.classes.INCOMPATIBLE),e.setAttribute("title",i.getLocaleString("reprojectionNeeded"))),i.map)for(var s=0,l=i.map.workLayers.length;s<l;s++){var c=i.map.workLayers[s];c.type===r.Z.Consts.layerType.WMS&&c.url===o.url&&1===c.names.length&&c.names[0]===n&&(e.parentElement.classList.add(r.Z.Consts.classes.CHECKED),e.dataset.tooltip=i.getLocaleString("layerAlreadyAdded"))}}else t.addEventListener("change",(function(t){t.stopPropagation();this.checked?i.showLayerInfo(o,n,e.innerText):i.hideLayerInfo()}),{passive:!0}),t.addEventListener(r.Z.Consts.event.CLICK,(function(t){t.stopPropagation()}),{passive:!0})})),s.call(i),i.getRenderedHtml(i.CLASS+"-dialog",null,(function(t){i._dialogDiv.innerHTML=t}))};t.renderBranch=function(t,e,n){const o=this;o.sourceLayers.unshift(t),t.getCapabilitiesPromise().then(function(t){o.getRenderedHtml(o.CLASS+"-branch",function(t){var e=t.getTree();const n=function(e,r){if(t.options.expandedNodeLevel>r){e.expanded=!0;for(var o=0;o<e.children.length;o++)n(e.children[o],r+1)}};return function e(n){for(var r=!1,o=0;o<n.children.length;o++)e(n.children[o])&&(r=!0);return Object.prototype.hasOwnProperty.call(n,"isVisible")&&(n.isVisible=!t.names||!t.names.length||r||n.isVisible),n.isVisible}(e),n(e,0),e}(this),function(t){var i=document.createElement("template");i.innerHTML=t;const a=o.div.querySelector("."+o.CLASS+"-branch");var s=i.content?i.content.firstChild:i.firstChild,c=a.querySelector("li."+o.CLASS+'-loading-node[data-layer-id="'+this.id+'"]');c?a.replaceChild(s,c):a.insertAdjacentElement("afterbegin",s),l.call(o,s,this),1===a.childElementCount&&n(),r.Z.Util.isFunction(e)&&e(o.sourceLayers[o.sourceLayers.map((t=>t&&t.id)).indexOf(this.id)])}.bind(this))}.bind(t)).catch(function(t){var e=o.layers.map((t=>t.id)).indexOf(this.id);o.layers.splice(e,1);var n=o.getLocaleString("lyrCtlg.errorLoadingNode",{serviceName:this.title}),i=o.div.querySelector("."+o.CLASS+"-branch").querySelector("li."+o.CLASS+'-loading-node[data-layer-id="'+this.id+'"]');i.classList.add("error"),i.setAttribute("title",n),o.map.toast(n,{type:r.Z.Consts.msgType.ERROR})}.bind(t))},t.render=function(t){const e=this;return e.sourceLayers=[],e._set1stRenderPromise(new Promise((function(n,i){0===e.layers.length?e.renderData({layerTrees:[],enableSearch:!1},(function(){r.Z.Util.isFunction(t)&&t(),n()})):e.renderData({layers:e.layers,enableSearch:!0},(function(){o.call(e),e.layers.forEach((function(r){e.renderBranch(r,t,n)}))}))})))},t.getLayerRootNode=function(t){const e=this;var n=null;if(!t.isBase){var r=t.options.url;e._roots&&e._roots.forEach((function(o){const i=e.getLayer(o.dataset.layerId);i&&i.type===t.type&&i.options.url.toLowerCase()===r.toLowerCase()&&(n=o)}))}return n},t.getLayerNodes=function(t){const e=[],n=this.getLayerRootNode(t);if(n)for(var r=0;r<t.names.length;r++){const o=n.querySelector('li[data-layer-name="'+t.names[r]+'"]');o&&(e.push(o),o.querySelectorAll("li").forEach((function(t){e.push(t)})))}return e},t.showLayerInfo=function(t,e,n){const o=this;var i=null,a=o.div.querySelector("."+o.CLASS+"-info");const s=function(e,n){var i=!1;return n&&(i=!0,a.dataset.serviceId=t.id,a.dataset.layerName=e,a.classList.remove(r.Z.Consts.classes.HIDDEN),o.getRenderedHtml(o.CLASS+"-info",n).then((function(t){a.innerHTML=t,a.querySelector("."+o.CLASS+"-info-close").addEventListener(r.Z.Consts.event.CLICK,(function(){o.hideLayerInfo()}),{passive:!0})})).catch((function(t){r.Z.error(t)}))),i};o.div.querySelectorAll("."+o.CLASS+"-btn-info, ."+o.CLASS+"-search-btn-info").forEach((function(t){t.checked=!1}));const l=function(t,e){if(t.Title===e)return{title:e,abstract:t.Abstract,metadata:t.MetadataURL?t.MetadataURL.reduce((function(t,e){return t.push({format:e.Format,formatDescription:r.Z.Util.getLocaleString(o.map.options.locale,r.Z.Util.getSimpleMimeType(e.Format))||r.Z.Util.getLocaleString(o.map.options.locale,"viewMetadata"),type:e.type,url:e.OnlineResource}),t}),[]):null};if(t.Layer)for(var n=0;n<t.Layer.length;n++){const r=l(t.Layer[n],e);if(r)return r}};for(var c=0,u=o._roots.length;c<u;c++){const r=o._roots[c];if(r.dataset.layerId===t.id){const a=r.querySelectorAll("."+o.CLASS+"-btn-info");for(var p=0,d=a.length;p<d;p++){const r=a[p];var h=r.parentElement.dataset.layerName;if(e&&h===e){const n=t.getInfo(e),r=o.div.querySelector('li[data-layer-name="'+h+'"] > input[type="checkbox"].'+o.CLASS+"-btn-info");r.checked=s(h,n);const a=o.div.querySelector('li[data-layer-name="'+h+'"] > input[type="checkbox"].'+o.CLASS+"-search-btn-info");a&&(a.checked=r.checked),i=n;break}const c=r.parentElement.querySelector("span").innerText;if(!e&&n&&c===n){const e=l(t.capabilities.Capability.Layer,n);r.checked=s(c,e),i=e;break}}break}}return i},t.update=function(){const t=this;t.sourceLayers.forEach((function(e){e.getCapabilitiesPromise().then((function(){e.compatibleLayers=e.wrap.getCompatibleLayers(t.map.crs);const n=t.getLayerRootNode(e);n&&n.querySelectorAll("li[data-layer-name]").forEach((function(n){const o=n.dataset.layerName,i=n.querySelector("span."+r.Z.Consts.classes.SELECTABLE);e.compatibleLayers.indexOf(o)<0?(i.classList.add(r.Z.Consts.classes.INCOMPATIBLE),i.setAttribute("title",t.getLocaleString("reprojectionNeeded"))):(i.classList.remove(r.Z.Consts.classes.INCOMPATIBLE),i.removeAttribute("title"))}))}))}))},t.hideLayerInfo=function(){var t=this;t.div.querySelectorAll("."+t.CLASS+"-btn-info, ."+t.CLASS+"-search-btn-info").forEach((function(t){t.checked=!1}));const e=t.div.querySelector("."+t.CLASS+"-info");delete e.dataset.serviceId,delete e.dataset.layerName,e.classList.add(r.Z.Consts.classes.HIDDEN)},t.addLayer=function(t){const e=this;return new Promise((function(n,o){var i=[];e.options.layers&&e.options.layers.length&&(i=e.options.layers.filter((function(e){var n=r.Z.Util.reqGetMapOnCapabilities(e.url);return n&&n.replace(r.Z.Util.regex.PROTOCOL)===t.url.replace(r.Z.Util.regex.PROTOCOL)}))),0===i.length&&(i=e.layers.filter((function(e){return e.url.replace(r.Z.Util.regex.PROTOCOL)===t.url.replace(r.Z.Util.regex.PROTOCOL)}))),0===i.length?(e.layers.unshift(t),t.getCapabilitiesPromise().then((function(){t.compatibleLayers=t.wrap.getCompatibleLayers(e.map.crs),t.title=t.title||t.wrap.getServiceTitle(),e.renderBranch(t,(function(){n()}))}))):n()}))},t.getLayer=function(t){const e=this;for(var n=0,r=e.layers.length;n<r;n++){const r=e.layers[n];if(r.id===t){var o=e.options.layers.filter((e=>e.id===t));return o.length>0?r.hideTitle=r.options.hideTitle=o[0].hideTitle:r.hideTitle=r.options.hideTitle=!1,r}}return null},t.addLayerToMap=function(t,e){const n=this,o=r.Z.Util.extend({},t.options);o.id=n.getUID(),o.layerNames=[e],o.title=t.title,o.hideTree=!0;const i=new r.Z.layer.Raster(o);i.isCompatible(n.map.crs)?n.map.addLayer(o):function(t,e){t.showProjectionChangeDialog({layer:e,closeCallback:function(){t.getLayerNodes(t._layerToAdd).forEach((function(e){e.classList.remove(r.Z.Consts.classes.LOADING),e.querySelector("span").dataset.tooltip=t.getLocaleString("clickToAddToMap")}))}})}(n,i)},t.loaded=function(){return this._readyPromise},t.getAvailableCRS=function(t){const e=this;return t=t||{},e.map.getCompatibleCRS({layers:e.map.workLayers.concat(e.map.baseLayer,t.layer),includeFallbacks:!0})},t.setProjection=function(t){const e=this;t=t||{},r.Z.loadProjDef({crs:t.crs,callback:function(){e.map.setProjection(t).then((function(){e._layerToAdd&&e.map.addLayer(e._layerToAdd),r.Z.Util.closeModal()}))}})},t.showProjectionChangeDialog=function(t){this._layerToAdd=t.layer,r.Z.control.ProjectionSelector.prototype.showProjectionChangeDialog.call(this,t)}}();const s=r.Z.control.LayerCatalog},7746:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var r,o=n(5361),i=n(2089),a=n(6595);o.Z.Consts=i.Z,o.Z.control=o.Z.control||{},o.Z.control.MapContents=a.default,o.Z.control.Legend=function(){o.Z.control.MapContents.apply(this,arguments)},o.Z.inherit(o.Z.control.Legend,o.Z.control.MapContents),(r=o.Z.control.Legend.prototype).CLASS="tc-ctl-legend",r.template={},r.template[r.CLASS]={1:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-legend-node"),e,{name:"tc-ctl-legend-node",data:o,indent:"        ",helpers:n,partials:r,decorators:t.decorators}))?i:""},3:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <li class="tc-ctl-legend-empty">'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"noData",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:40},end:{line:7,column:57}}}))+"</li>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+t.escapeExpression(s(n,"i18n").call(a,"legend",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:4},end:{line:1,column:21}}}))+'</h2>\r\n<div class="tc-ctl-legend-tree">\r\n    <ul class="tc-ctl-legend-branch">\r\n'+(null!=(i=s(n,"each").call(a,null!=e?s(e,"workLayers"):e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.program(3,o,0),data:o,loc:{start:{line:4,column:8},end:{line:8,column:17}}}))?i:"")+"    </ul>\r\n</div>"},usePartial:!0,useData:!0},r.template[r.CLASS+"-node"]={1:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    "+(null!=(i=t.lambda(null!=e?a(e,"customLegend"):e,e))?i:"")+"\r\n"},3:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lambda,l=t.escapeExpression,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    <li "+(null!=(i=c(n,"if").call(a,null!=e?c(e,"children"):e,{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.program(6,o,0),data:o,loc:{start:{line:4,column:8},end:{line:4,column:112}}}))?i:"")+' data-layer-name="'+l(s(null!=e?c(e,"name"):e,e))+'" data-layer-uid="'+l(s(null!=e?c(e,"uid"):e,e))+'">\r\n        <div class="tc-ctl-legend-title">'+l(s(null!=e?c(e,"title"):e,e))+"</div>\r\n"+(null!=(i=c(n,"if").call(a,null!=e?c(e,"legend"):e,{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.noop,data:o,loc:{start:{line:6,column:8},end:{line:17,column:15}}}))?i:"")+'        <ul class="tc-ctl-legend-branch">\r\n'+(null!=(i=c(n,"each").call(a,null!=e?c(e,"children"):e,{name:"each",hash:{},fn:t.program(18,o,0),inverse:t.noop,data:o,loc:{start:{line:19,column:12},end:{line:21,column:21}}}))?i:"")+"        </ul>\r\n    </li>\r\n"},4:function(t,e,n,r,o){return'class="tc-ctl-legend-node" '},6:function(t,e,n,r,o){return'class="tc-ctl-legend-node tc-ctl-legend-leaf" '},8:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <div class="tc-ctl-legend-watch">\r\n'+(null!=(i=s(n,"if").call(a,null!=(i=null!=e?s(e,"legend"):e)?s(i,"src"):i,{name:"if",hash:{},fn:t.program(9,o,0),inverse:t.program(14,o,0),data:o,loc:{start:{line:8,column:12},end:{line:14,column:19}}}))?i:"")+'        </div>\r\n        <div class="tc-ctl-legend-nvr">'+t.escapeExpression(s(n,"i18n").call(a,"notVisibleAtCurrentResolution",{name:"i18n",hash:{},data:o,loc:{start:{line:16,column:39},end:{line:16,column:79}}}))+"</div>\r\n"},9:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <img src="" data-img="'+t.escapeExpression(t.lambda(null!=(i=null!=e?s(e,"legend"):e)?s(i,"src"):i,e))+'" style="'+(null!=(i=s(n,"if").call(a,null!=(i=null!=e?s(e,"legend"):e)?s(i,"width"):i,{name:"if",hash:{},fn:t.program(10,o,0),inverse:t.noop,data:o,loc:{start:{line:9,column:57},end:{line:9,column:136}}}))?i:"")+(null!=(i=s(n,"if").call(a,null!=(i=null!=e?s(e,"legend"):e)?s(i,"scale"):i,{name:"if",hash:{},fn:t.program(12,o,0),inverse:t.noop,data:o,loc:{start:{line:9,column:136},end:{line:9,column:222}}}))?i:"")+'" />\r\n'},10:function(t,e,n,r,o){var i,a=t.lambda,s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"width:"+s(a(null!=(i=null!=e?l(e,"legend"):e)?l(i,"width"):i,e))+"px;height:"+s(a(null!=(i=null!=e?l(e,"legend"):e)?l(i,"height"):i,e))+"px;"},12:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"transform:scale("+t.escapeExpression(t.lambda(null!=(i=null!=e?a(e,"legend"):e)?a(i,"scale"):i,e))+");transform-origin:0 50% 0;"},14:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=a(n,"if").call(null!=e?e:t.nullContext||{},null!=(i=null!=e?a(e,"legend"):e)?a(i,"strokeColor"):i,{name:"if",hash:{},fn:t.program(15,o,0),inverse:t.noop,data:o,loc:{start:{line:11,column:16},end:{line:13,column:23}}}))?i:""},15:function(t,e,n,r,o){var i,a=t.lambda,s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                    <div class="tc-ctl-legend-img" style="border:solid '+s(a(null!=(i=null!=e?l(e,"legend"):e)?l(i,"strokeWidth"):i,e))+"px "+s(a(null!=(i=null!=e?l(e,"legend"):e)?l(i,"strokeColor"):i,e))+";background-color:"+s(a(null!=(i=null!=e?l(e,"legend"):e)?l(i,"fillColor"):i,e))+(null!=(i=l(n,"if").call(null!=e?e:t.nullContext||{},null!=(i=null!=e?l(e,"legend"):e)?l(i,"width"):i,{name:"if",hash:{},fn:t.program(16,o,0),inverse:t.noop,data:o,loc:{start:{line:12,column:156},end:{line:12,column:253}}}))?i:"")+'"></div>\r\n'},16:function(t,e,n,r,o){var i,a=t.lambda,s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return";width:"+s(a(null!=(i=null!=e?l(e,"legend"):e)?l(i,"width"):i,e))+"px;height:"+s(a(null!=(i=null!=e?l(e,"legend"):e)?l(i,"height"):i,e))+"px;border-radius:50%"},18:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-legend-node"),e,{name:"tc-ctl-legend-node",data:o,indent:"                ",helpers:n,partials:r,decorators:t.decorators}))?i:""},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=a(n,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"customLegend"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(3,o,0),data:o,loc:{start:{line:1,column:0},end:{line:24,column:7}}}))?i:""},usePartial:!0,useData:!0},r.register=function(t){const e=this;return t.on(o.Z.Consts.event.VIEWCHANGE,(function(n){const r=n.view,i=e.loadGraphics.bind(e);r===o.Z.Consts.view.THREED?t.on(o.Z.Consts.event.LAYERADD,i):r===o.Z.Consts.view.DEFAULT&&t.off(o.Z.Consts.event.LAYERADD,i)})),o.Z.control.MapContents.prototype.register.call(e,t)},r.loadGraphics=function(){const t=this;t.getLayerUIElements().forEach((function(e){const n=t.map.getLayer(e.dataset.layerId);n&&e.querySelectorAll("li."+t.CLASS+"-node-visible").forEach((function(e){const r=e.querySelector("img");r&&void 0!==r.getAttribute("src")&&0===r.getAttribute("src").length&&t.styleLegendImage(r,n)}))}))},r.updateScale=function(){const t=this,e=t.CLASS+"-node-inscale",n=t.CLASS+"-node-outofscale";t.getLayerUIElements().forEach((function(r){const o=t.map.getLayer(r.dataset.layerId);if(o&&!o.customLegend){let i=!1;const a=r.querySelectorAll("li");if(a.forEach((function(r){if(r.classList.contains(t.CLASS+"-node-visible")){const a=r.dataset.layerUid;if(o.isVisibleByScale(a)){i=!0,r.classList.remove(n),r.classList.add(e);const a=r.querySelector("img");a&&t.styleLegendImage(a,o)}else r.classList.add(n),r.classList.remove(e)}})),i=i||!a.length,!a.length){const e=r.querySelector("img");e&&t.styleLegendImage(e)}r.classList.toggle(e,i),r.classList.toggle(n,!i)}}))},r.update=function(){const t=this;t.getLayerUIElements().forEach((function(e){const n=t.map.getLayer(e.dataset.layerId);if(n&&(!n.customLegend||!n.getVisibility())){const r=n.getTree(!1,!0);e.querySelectorAll("li").forEach((function(e){const i=t.CLASS+"-node-visible",a=t.CLASS+"-node-notvisible",s=t.CLASS+"-node-hasvisible";switch(n.getNodeVisibility(e.dataset.layerUid,r)){case o.Z.Consts.visibility.VISIBLE:e.classList.remove(a,s),e.classList.add(i);break;case o.Z.Consts.visibility.NOT_VISIBLE:e.classList.remove(i,s),e.classList.add(a);break;case o.Z.Consts.visibility.HAS_VISIBLE:e.classList.remove(i,a),e.classList.add(s);break;case null:e.classList.remove(i,s),e.classList.add(a);break;default:e.classList.remove(a,s),e.classList.add(i)}})),t.updateLayerVisibility(n)}})),t.updateScale()},r.updateLayerTree=function(t){var e=this;if(!t.isBase&&!t.options.stealth){t.hideTree||t.options.hideTree,e.div.querySelector("."+e.CLASS+"-empty").classList.add(o.Z.Consts.classes.HIDDEN);var n=t.getNestedTree?t.getNestedTree():t.getTree();t._title&&t._title!==t.title&&(n=Object.assign(n,{title:t._title})),e.getRenderedHtml(e.CLASS+"-node",n).then((function(n){const r=(new DOMParser).parseFromString(n,"text/html").body.firstChild,o=r.dataset.layerUid,i=e.div.querySelector("ul."+e.CLASS+"-branch"),a=i.querySelectorAll('li[data-layer-uid="'+o+'"]');if(1===a.length){const t=a[0];t.innerHTML!==r.innerHTML&&(t.innerHTML=r.innerHTML,t.setAttribute("class",r.getAttribute("class")))}else r.dataset.layerId=t.id,i.insertBefore(r,i.firstChild);e.update()})).catch((function(t){o.Z.error(t)}))}},r.removeLayer=function(t){t.isBase||o.Z.control.MapContents.prototype.removeLayer.call(this,t)},r.updateLayerVisibility=function(t){var e=this;e.getLayerUIElements().forEach((function(n){n.dataset.layerId===t.id&&n.classList.toggle(e.CLASS+"-node-notvisible",!t.getVisibility())}))},r.getLayerUIElements=function(){const t=this;return t.div.querySelector("ul."+t.CLASS+"-branch").querySelectorAll("li."+t.CLASS+"-node")};const s=o.Z.control.Legend},3011:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>a});var r=n(5361),o=n(2089),i=n(8410);r.Z.control=r.Z.control||{},r.Z.Consts=o.Z,r.Z.control.GeometryFeatureInfo=i.default,r.Z.control.LineFeatureInfo=function(){var t=this;r.Z.control.GeometryFeatureInfo.apply(this,arguments),t.geometryType=r.Z.Consts.geom.POLYLINE,t.style=r.Z.Util.extend(!0,{strokeColor:t.DEFAULT_STROKE_COLOR,strokeWidth:2},t.options.style)},r.Z.inherit(r.Z.control.LineFeatureInfo,r.Z.control.GeometryFeatureInfo),r.Z.control.LineFeatureInfo.prototype.CLASS="tc-ctl-finfo";const a=r.Z.control.LineFeatureInfo},3571:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>i});var r=n(5361),o=n(8633);r.Z.control=r.Z.control||{},r.Z.control.ListTOC=o.default;const i=r.Z.control.ListTOC},273:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var r,o=n(5361),i=n(2089),a=n(6498);o.Z.Consts=i.Z,o.Z.control=o.Z.control||{},o.Z.Control=a.Z,o.Z.control.LoadingIndicator=function(){const t=this;o.Z.Control.apply(t,arguments),t._waits={},window.addEventListener("error",(function(){return t.reset(),!1}),!1)},o.Z.inherit(o.Z.control.LoadingIndicator,o.Z.Control),(r=o.Z.control.LoadingIndicator.prototype).CLASS="tc-ctl-load",r.template={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){return'<div class="tc-ctl-load-bar">\r\n    <div class="tc-ctl-load-dots tc-ctl-load-dot1"> </div>\r\n    <div class="tc-ctl-load-dots tc-ctl-load-dot2"> </div>\r\n    <div class="tc-ctl-load-dots tc-ctl-load-dot3"> </div>\r\n    <div class="tc-ctl-load-dots tc-ctl-load-dot4"> </div>\r\n    <div class="tc-ctl-load-dots tc-ctl-load-dot5"> </div>\r\n    <div class="tc-ctl-load-dots tc-ctl-load-dot6"> </div>\r\n    <div class="tc-ctl-load-dots tc-ctl-load-dot7"> </div>\r\n    <div class="tc-ctl-load-dots tc-ctl-load-dot8"> </div>\r\n</div>'},useData:!0},r.startWait=function(t){const e=this,n=t.layer.id;void 0===e._waits[n]&&(e._waits[n]=0),e._waits[n]=e._waits[n]+1,e.show(),e.map.trigger(o.Z.Consts.event.STARTLOADING)},r.stopWait=function(t){const e=this,n=t.layer.id;var r=e._waits[n];r>0&&(r=e._waits[n]=r-1),r||delete e._waits[n];var i=0;for(var a in e._waits)i++;i||(e.hide(),e.map.trigger(o.Z.Consts.event.STOPLOADING))},r.endWait=function(t){const e=this,n=t.layer.id;e._waits[n]>0&&delete e._waits[n];var r=0;for(var i in e._waits)r++;r||(e.hide(),e.map.trigger(o.Z.Consts.event.STOPLOADING))},r.reset=function(t){var e=this;e._waits={},e.hide(),e.map&&e.map.trigger(o.Z.Consts.event.STOPLOADING)},r.register=function(t){const e=this,n=o.Z.Control.prototype.register.call(e,t);return t.on(o.Z.Consts.event.BEFORELAYERADD+" "+o.Z.Consts.event.BEFORELAYERUPDATE+" "+o.Z.Consts.event.BEFOREFEATURESADD,(function(t){e.startWait(t)})).on(o.Z.Consts.event.LAYERADD+" "+o.Z.Consts.event.LAYERERROR+" "+o.Z.Consts.event.LAYERUPDATE+" "+o.Z.Consts.event.FEATURESADD,(function(t){e.stopWait(t)})).on(o.Z.Consts.event.BEFOREFEATUREINFO,(function(){e.addWait(o.Z.Consts.event.FEATUREINFO)})).on(o.Z.Consts.event.FEATUREINFO+" "+o.Z.Consts.event.NOFEATUREINFO+" "+o.Z.Consts.event.FEATUREINFOERROR,(function(){e.removeWait(o.Z.Consts.event.FEATUREINFO)})).on(o.Z.Consts.event.LAYERREMOVE,(function(t){e.endWait(t)})),o.Z.isDebug||window.addEventListener("error",(function(t,n,r,o,i){return e.reset(),!1})),n},r.addWait=function(t){const e=t||o.Z.getUID();return this.startWait({layer:{id:e}}),e},r.removeWait=function(t){this.stopWait({layer:{id:t}})};const s=o.Z.control.LoadingIndicator},6595:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>a});var r=n(5361),o=n(2089),i=n(6498);r.Z.Consts=o.Z,r.Z.control=r.Z.control||{},r.Z.Control=i.Z,r.Z.control.MapContents=function(){var t=this;r.Z.Control.apply(t,arguments),t.layerTrees={}},r.Z.inherit(r.Z.control.MapContents,r.Z.Control),function(){var t=r.Z.control.MapContents.prototype;t.CLASS="tc-ctl-mc",t.render=function(t,e){const n=this;return n._set1stRenderPromise(n.map?n.renderData(e?r.Z.Util.extend(n.map.getLayerTree(),e):n.map.getLayerTree(),(function(){n.addUIEventListeners(),"function"==typeof t&&t()})):Promise.reject(Error("Cannot render: control has no map")))},t.register=function(t){const e=this;return new Promise((function(n,o){Promise.all([r.Z.Control.prototype.register.call(e,t),e.renderPromise()]).then((function(){for(var o=0,i=t.layers.length;o<i;o++)e.updateLayerTree(t.layers[o]);t.on(r.Z.Consts.event.ZOOM+" "+r.Z.Consts.event.PROJECTIONCHANGE,(function(){e.updateScale()})).on(r.Z.Consts.event.UPDATEPARAMS,(function(t){const n=t.layer;var o=n.names;!function t(e){var n=!1;if(e)if(o.indexOf(e.name)>=0)n=!0;else for(var r=0;r<e.children.length;r++)if(t(e.children[r])){n=!0;break}return n}(e.layerTrees[n.id])&&0!==o.length?e.updateLayerTree(n):e.update(e instanceof r.Z.control.BasemapSelector?void 0:n)})).on(r.Z.Consts.event.LAYERVISIBILITY,(function(t){e.updateLayerVisibility(t.layer)})).on(r.Z.Consts.event.LAYERADD,(function(t){e.updateLayerTree(t.layer)})).on(r.Z.Consts.event.VECTORUPDATE+" "+r.Z.Consts.event.FEATUREADD+" "+r.Z.Consts.event.FEATURESADD,(function(t){const n=t.layer;e._updateLayerTreeTimeouts=e._updateLayerTreeTimeouts||{},e._updateLayerTreeTimeouts[n.id]&&clearTimeout(e._updateLayerTreeTimeouts[n.id]),e._updateLayerTreeTimeouts[n.id]=setTimeout((function(){e.map.workLayers.indexOf(n)>-1&&(e.updateLayerTree(n),delete e._updateLayerTreeTimeouts[n.id])}),100)})).on(r.Z.Consts.event.LAYERREMOVE,(function(t){e.removeLayer(t.layer)})).on(r.Z.Consts.event.LAYERORDER,(function(t){e.updateLayerOrder(t.layer,t.oldIndex,t.newIndex)})).on(r.Z.Consts.event.LAYERERROR,(function(t){e.onErrorLayer(t.layer)})),n(e)})).catch((function(t){o(t instanceof Error?t:Error(t))}))}))},t.updateScale=function(){},t.updateLayerVisibility=function(t){},t.updateLayerTree=function(t){this.layerTrees[t.id]=t.getTree()},t.updateLayerOrder=function(t,e,n,r){const o=this;if(e>=0&&e!==n){var i,a;const e=o.getLayerUIElements();for(var s=(r=r||o.map.workLayers).length-1;s>=0;s--){const n=r[s];a=i;for(var l=0,c=e.length;l<c;l++){const t=e[l];if(t.dataset.layerId===n.id){i=t;break}}if(n===t){i&&(a?a.insertAdjacentElement("afterend",i):i.parentElement.firstChild.insertAdjacentElement("beforebegin",i));break}}}},t.removeLayer=function(t){const e=this,n=e.getLayerUIElements();for(var o=0,i=n.length;o<i;o++){const e=n[o];if(e.dataset.layerId===t.id){e.parentElement.removeChild(e);break}}0===e.getLayerUIElements().length&&e.div.querySelector("."+e.CLASS+"-empty").classList.remove(r.Z.Consts.classes.HIDDEN)},t.onErrorLayer=function(t){},t.getLayerUIElements=function(){return this.div.querySelector("ul").children};t.styleLegendImage=function(t,e){if(!t.getAttribute("src")){var n=t.dataset.img;const c=new r.Z.tool.Proxification(r.Z.proxify);if(e&&e.options.method&&"POST"===e.options.method)e.getLegendGraphicImage().then((function(e){t.src=e})).catch((function(t){r.Z.error(t)}));else{if(/[&?]REQUEST=getLegendGraphic/i.test(n)){const u=t.parentElement;var o=u.style.color,i=o.indexOf("("),a=o.indexOf(")");if(i>=0&&a>i){let t=o.substr(0,a).substr(i+1).split(",");o="0x";for(var s=0;s<3;s++){var l=parseInt(t[s]).toString(16);o+=1===l.length?"0"+l:l}}else o.replace("#","0x");n+="&LEGEND_OPTIONS=fontName:"+u.style.fontFamily+";fontSize:"+parseInt(u.style.fontSize)+";fontColor:"+o+";fontAntiAliasing:true",e.params&&e.params.sld_body&&(n=r.Z.Util.addURLParameters(n,{sld_body:e.params.sld_body})),c.fetchImage(n).then((function(t){t.dataset.img=t.src})).catch((function(t){r.Z.error(t)}))}c.fetchImage(n).then((function(e){t.src=e.src})).catch((function(t){!t.status||404!==t.status&&401!==t.status?r.Z.error(t):r.Z.error(r.Z.Util.getLocaleString(e.map.options.locale,"simbologyImgNotFound",{url:n}))}))}}}}();const a=r.Z.control.MapContents},2e3:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>l});var r,o=n(5361),i=n(2089),a=n(6498),s=n(1774);o.Z.Consts=i.Z,o.Z.control=o.Z.control||{},o.Z.Control=a.Z,o.Z.tool=o.Z.tool||{},o.Z.tool.Proxification=s.Z,o.Z.control.MapInfo=function(){var t=this;o.Z.Control.apply(t,arguments)},o.Z.inherit(o.Z.control.MapInfo,o.Z.Control),(r=o.Z.control.MapInfo.prototype).CLASS="tc-ctl-mi",r.register=function(t){const e=this,n=o.Z.Control.prototype.register.call(e,t);return e.QR_MAX_URL_LENGTH=150,e.SHORTEN_URL_LENGTH=16e3,e.exportsState=!1,e.includeControls=void 0===e.options.includeControls||e.options.includeControls,n},r.exportControlStates=function(){const t=this;return t.map?t.map.exportControlStates():[]},r.importControlStates=function(t){const e=this;e.map&&e.map.importControlStates(t)},r.exportState=function(){const t=this;if(t.exportsState){const n={};if(t.featureToShare||t.sharedFeaturesLayer){var e;if(n.id=t.id,t.featureToShare){const n=t.featureToShare.clone();n.showsPopup=!0,e=t.featureToShare.layer.exportState({features:[n]})}else e=t.sharedFeaturesLayer.exportState();n.features=e.features,e.crs&&(n.crs=e.crs)}return n}return null},r.importState=function(t){const e=this;e.map&&t.features.length&&e.map.addLayer({id:e.getUID(),owner:e,type:o.Z.Consts.layerType.VECTOR,title:e.getLocaleString("foi"),stealth:!0}).then((function(n){e.sharedFeaturesLayer=n,n.importState({features:t.features,crs:t.crs}).then((function(){e.map.zoomToFeatures(n.features)}))}))},r.manageMaxLengthExceed=function(){throw"Falta implementación del método manageMaxLengthExceed"},r.generateLink=async function(){var t=this,e=window.location.href,n=e.indexOf("#");if(n>0&&(e=e.substring(0,n)),t.extraParams){var r=o.Z.Util.getQueryStringParams(e);o.Z.Util.extend(r,t.extraParams);var i=e.indexOf("?");i>=0&&(e=e.substring(0,i)),e=e.concat("?",o.Z.Util.getParamString(r))}else{var a=e.indexOf("?");a>0&&(e=e.replace(e.substring(a),""))}const s=t.includeControls?t.exportControlStates():[];!t.includeControls&&t.exportsState&&(t.featureToShare||t.sharedFeaturesLayer||t.caller&&t.caller.toShare)&&(t.caller&&t.caller.toShare?s.push(t.caller.exportState()):s.push(t.exportState()));const l=s.length?{ctl:s}:void 0;var c=await t.map.getMapState({extraStates:l,cacheResult:t.includeControls}),u=e.concat("#",c);return t.manageMaxLengthExceed({browser:u.length>o.Z.Consts.URL_MAX_LENGTH,qr:u.length>t.SHORTEN_URL_LENGTH}),u},r.shortenedLink=function(){const t=this;var e;return new Promise((function(n,r){const i=function(){t.map.toast(t.getLocaleString("urlTooLongForShortener"),{type:o.Z.Consts.msgType.ERROR}),t.map.getLoadingIndicator().removeWait(e),n("")};t.generateLink().then((r=>{r.length>t.QR_MAX_URL_LENGTH&&r.length<t.SHORTEN_URL_LENGTH?(e=t.map.getLoadingIndicator().addWait(),function(t){o.Z.tool&&o.Z.tool.Proxification||o.Z.syncLoadJS(o.Z.apiLocation+"TC/tool/Proxification");var e=new FormData;return e.append("url",t),new o.Z.tool.Proxification(o.Z.proxify,{allowedMixedContent:!1}).fetch("https://tinyurl.com/api-create.php",{type:"POST",data:e}).then((function(t){return t})).catch((function(t){return null}))}(r).then((function(r){r&&r.responseText?(t.map.getLoadingIndicator().removeWait(e),n(r.responseText.replace("http://","https://"))):i()}),i)):(r.length>=t.SHORTEN_URL_LENGTH&&i(),n(""))}))}))},r.makeQRCode=function(t,e,n){const r=this;return new Promise((function(i,a){o.Z.loadJS(void 0===window.QRCode,[o.Z.apiLocation+"lib/qrcode/qrcode.min.js"],(function(){r.shortenedLink().then((function(r){if((r=r||"").length>0){var o={text:r};e&&n&&(o.width=e,o.height=n);var a=new MutationObserver((function(t,e){var n=t.filter((function(t){return"attributes"===t.type})).filter((function(t){return t.attributeName.indexOf("src")>-1}));n.length>0&&(e.disconnect(),i(n[0].target.src))}));t.innerHTML="",a.observe(t,{attributes:!0,childList:!0,subtree:!0}),new QRCode(t,o)}else i()}))}))}))},r.drawScaleBarIntoCanvas=function(t){var e,n=this.map.getControlsByClass(o.Z.control.ScaleBar);if(0===n.length)return null;var r=(e=(t=t||{}).canvas?t.canvas:document.createElement("CANVAS")).getContext("2d");r.save();var i,a,s=document.getElementsByClassName("ol-scale-line-inner").item(0),l=o.Z.Util.extend({},s.getBoundingClientRect()),c=s.textContent;r.beginPath(),r.strokeStyle=window.getComputedStyle(s).borderColor,l.width>l.height?(i=l.width,a=l.height):(i=l.height,a=l.width),t.setSize&&(e.width=i,e.height=a),l.left=void 0!==t.left?t.left:15,l.top=void 0!==t.top?t.top:15,r.moveTo(l.left,l.top),r.lineTo(l.left,l.top+a),r.lineTo(l.left+i,l.top+a),r.lineTo(l.left+i,l.top),r.stroke();var u={x:l.left+i/2,y:l.top+a/2};return t.fill&&function(e,r,i){var a=document.getElementsByClassName(n[0].CLASS).item(0),s=o.Z.Util.extend({},a.getBoundingClientRect());s.left=(t.left||15)-2,s.top=t.top||15,s.top--,e.globalAlpha=.5,e.fillStyle=window.getComputedStyle(a).backgroundColor,r+=4,i+=4,e.fillRect(s.left,s.top,r,i)}(r,i,a),r.globalAlpha=1,r.fillStyle=void 0!==t.textColor?t.textColor:window.getComputedStyle(s).color,r.font=void 0!==t.font?t.font:window.getComputedStyle(s).fontSize+" "+window.getComputedStyle(s).fontFamily,r.textAlign="center",r.textBaseline="middle",r.fillText(c,u.x,u.y),e},r.registerListeners=function(){const t=this;if(!t.registeredListeners){let e;const n=function(n){clearTimeout(e),e=setTimeout((function(){delete t.map._controlStatesCache,t.renderPromise().then((function(){t.generateLink()}))}),100)};t.map.on(o.Z.Consts.event.LAYERADD,n).on(o.Z.Consts.event.LAYERREMOVE,n).on(o.Z.Consts.event.FEATUREADD,n).on(o.Z.Consts.event.FEATUREREMOVE+" "+o.Z.Consts.event.FEATURESCLEAR,n),t.registeredListeners=!0}};const l=o.Z.control.MapInfo},3731:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>l});var r,o=n(5361),i=n(2089),a=n(6498),s=n(2791);o.Z.Consts=i.Z,o.Z.control=o.Z.control||{},o.Z.control.Draw=s.default,o.Z.Control=a.Z,o.Z.control.Measure=function(){var t=this;o.Z.Control.apply(t,arguments),t.drawControls=[],t.persistentDrawControls=!1,t.NOMEASURE="-",t.exportsState=!0,this.renderPromise().then((function(){t.measureMode=t.options.mode,t.history=[],t.historyIndex=0,t.reset=!0,t.wrap=new o.Z.wrap.control.Measure(t),t._len=t.div.querySelector(".tc-ctl-meas-val-len"),t._area=t.div.querySelector(".tc-ctl-meas-val-area"),t._peri=t.div.querySelector(".tc-ctl-meas-val-peri")}))},o.Z.control.Measure.units={m:{peso:0,abbr:"m&sup2;"},dam:{peso:1,abbr:"dam&sup2;",precision:2},hm:{peso:2,abbr:"hm&sup2;",precision:2},ha:{peso:2,abbr:"ha",precision:3},km:{peso:3,abbr:"km&sup2;",precision:3}},o.Z.inherit(o.Z.control.Measure,o.Z.Control),(r=o.Z.control.Measure.prototype).CLASS="tc-ctl-meas",r.template={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lambda,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+a(l(n,"i18n").call(i,"measure",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:4},end:{line:1,column:22}}}))+'</h2>\r\n<div class="tc-ctl-meas-select">\r\n    <label class="tc-ctl-meas-btn-len"><input type="radio" name="'+a(s(null!=e?l(e,"controlId"):e,e))+'-mode" value="polyline" /><span>'+a(l(n,"i18n").call(i,"length",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:110},end:{line:3,column:127}}}))+'</span></label><label class="tc-ctl-meas-btn-area"><input type="radio" name="'+a(s(null!=e?l(e,"controlId"):e,e))+'-mode" value="polygon" /><span>'+a(l(n,"i18n").call(i,"areaAndPerimeter",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:248},end:{line:3,column:275}}}))+'</span></label>\r\n</div>\r\n<div class="tc-ctl-meas-mode tc-ctl-meas-len tc-hidden">\r\n    <div class="tc-ctl-meas-line"></div>\r\n    <div class="tc-ctl-meas-txt">'+a(l(n,"i18n").call(i,"length",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:33},end:{line:7,column:50}}}))+': <span class="tc-ctl-meas-val-len"></span></div>\r\n</div>\r\n<div class="tc-ctl-meas-mode tc-ctl-meas-area tc-hidden">\r\n    <div class="tc-ctl-meas-polygon"></div>\r\n    <div class="tc-ctl-meas-txt">'+a(l(n,"i18n").call(i,"area",{name:"i18n",hash:{},data:o,loc:{start:{line:11,column:33},end:{line:11,column:48}}}))+': <span class="tc-ctl-meas-val-area"></span>, '+a(l(n,"i18n").call(i,"perimeter",{name:"i18n",hash:{},data:o,loc:{start:{line:11,column:94},end:{line:11,column:114}}}))+': <span class="tc-ctl-meas-val-peri"></span></div>\r\n</div>'},useData:!0},r.render=function(t){const e=this;return e._set1stRenderPromise(o.Z.Control.prototype.renderData.call(e,{controlId:e.id},(function(){e.options.mode&&e.div.querySelector(".tc-ctl-meas-select").classList.add(o.Z.Consts.classes.HIDDEN),e.div.querySelectorAll(`.${o.Z.control.Measure.prototype.CLASS}-select span`).forEach((function(t){t.addEventListener(o.Z.Consts.event.CLICK,(function(t){for(var n=this;n&&"LABEL"!==n.tagName;)n=n.parentElement;var r=n.querySelector(`input[type=radio][name="${e.id}-mode"]`),o=r.value;r.checked=!0,e.setMode(o,!0)}),{passive:!0})})),o.Z.Util.isFunction(t)&&t()})))},r.register=function(t){const e=this;return new Promise((function(n,r){o.Z.Control.prototype.register.call(e,t).then((function(){e.map.on(o.Z.Consts.event.VIEWCHANGE,(function(){e.map.view===o.Z.Consts.view.PRINTING&&e.trigger(o.Z.Consts.event.DRAWEND)}));const i=e.getUID(),a=e.getUID(),s=e.getUID();e.units=e.options.units?e.options.units:["m","km"],e.layerPromise=t.addLayer({id:i,title:e.getLocaleString("measure"),owner:e,stealth:!0,type:o.Z.Consts.layerType.VECTOR,styles:{point:t.options.styles.point,line:t.options.styles.line,polygon:t.options.styles.polygon}}),Promise.all([e.layerPromise,e.renderPromise()]).then((function(i){const l=i[0];e.layer=l,e.layer.map.putLayerOnTop(e.layer),e._lineDrawControlPromise=t.addControl("draw",{id:a,div:e.div.querySelector(".tc-ctl-meas-line"),mode:o.Z.Consts.geom.POLYLINE,measure:!0,extensible:!0,persistent:e.persistentDrawControls,styling:e.persistentDrawControls,layer:e.layer}),e._polygonDrawControlPromise=t.addControl("draw",{id:s,div:e.div.querySelector(".tc-ctl-meas-polygon"),mode:o.Z.Consts.geom.POLYGON,measure:!0,persistent:e.persistentDrawControls,styling:e.persistentDrawControls,layer:e.layer}),Promise.all([e._lineDrawControlPromise,e._polygonDrawControlPromise]).then((function(t){e.lineDrawControl=t[0],e.polygonDrawControl=t[1],t.forEach((function(t){t.containerControl=e,e.drawControls.push(t),t.on(o.Z.Consts.event.MEASURE+" "+o.Z.Consts.event.MEASUREPARTIAL,(function(t){e.showMeasurements(t)})).on(o.Z.Consts.event.DRAWCANCEL,(function(t){setTimeout((function(){e.cancel()}),100)})),t.exportsState=!1})),n(e),e.setMode(e.options.mode)})).catch(r)})).catch(r)}))}))},r.displayMode=function(t){const e=this,n=[];switch(e.div.querySelectorAll(".tc-ctl-meas-mode").forEach((function(t){n.push(t)})),t){case o.Z.Consts.geom.POLYLINE:e._activeMode=n.filter((function(t){return t.matches(".tc-ctl-meas-len")}))[0];break;case o.Z.Consts.geom.POLYGON:e._activeMode=n.filter((function(t){return t.matches(".tc-ctl-meas-area")}))[0];break;case null:case void 0:e._activeMode=null}const r=n.filter((function(t){return t!==e._activeMode}));return t?e.div.querySelector(`input[type=radio][name="${e.id}-mode"][value="${t}"]`).checked=!0:e.div.querySelectorAll(`input[type=radio][name="${e.id}-mode"]`).forEach((function(t){t.checked=!1})),e._activeMode&&(e._activeMode.classList.remove(o.Z.Consts.classes.HIDDEN),e._activeMode.querySelector(".tc-ctl").classList.remove(o.Z.Consts.classes.COLLAPSED)),r.forEach((function(t){t.classList.add(o.Z.Consts.classes.HIDDEN)})),e},r.setMode=function(t){const e=this;var n;switch(e.mode=t,e.displayMode(t),t){case o.Z.Consts.geom.POLYLINE:e.lineDrawControl.activate(),n=o.Z.Consts.event.CONTROLACTIVATE;break;case o.Z.Consts.geom.POLYGON:e.polygonDrawControl.activate(),n=o.Z.Consts.event.CONTROLACTIVATE;break;case null:case void 0:e.drawControls.forEach((function(t){t.isActive&&t.cancel()})),n=o.Z.Consts.event.CONTROLDEACTIVATE;break;default:n=o.Z.Consts.event.CONTROLACTIVATE}e.resetValues(),n&&e.map&&e.map.trigger(n,{control:e})},r.cancel=function(){return this.setMode(null,!1),this},r.showMeasurements=function(t){const e=this;var n,r=(t=t||{}).units;const i=e.map.options.locale||o.Z.Cfg.locale;if(t.area){var a=t.area;(e.units instanceof Array?e.units:e.units.split(",")).forEach((function(t,n,r){const s=o.Z.control.Measure.units[t.trim()].peso-o.Z.control.Measure.units.m.peso;let l=o.Z.control.Measure.units[t.trim()].precision?o.Z.control.Measure.units[t.trim()].precision:0;(1===r.length||a>=Math.pow(100,s)/Math.pow(10,l?l-1:l))&&(e._area.innerHTML=o.Z.Util.formatNumber((a/Math.pow(100,s)).toFixed(l),i)+" "+o.Z.control.Measure.units[t].abbr)}))}if(t.perimeter){var s=t.perimeter;s>1e3&&(s/=1e3,r="km"),n="m"===r?0:3,e._peri.innerHTML=o.Z.Util.formatNumber(s.toFixed(n),i)+" "+r}if(t.length){var l=t.length;l>1e3&&(l/=1e3,r="km"),n="m"===r?0:3,e._len.innerHTML=o.Z.Util.formatNumber(l.toFixed(n),i)+" "+r}return e},r.resetValues=function(){const t=this;return t._len&&(t._len.textContent=t.NOMEASURE,t._area.textContent=t.NOMEASURE,t._peri.textContent=t.NOMEASURE),t},r.getDrawLines=function(){},r.exportState=function(){const t=this;return t.exportsState&&t.layer?{id:t.id,layer:t.layer.exportState()}:null},r.importState=function(t){this.layerPromise.then((function(e){e.importState(t.layer)}))};const l=o.Z.control.Measure},1797:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>a});var r=n(5361),o=n(2089),i=n(6498);r.Z.Consts=o.Z,r.Z.control=r.Z.control||{},r.Z.Control=i.Z,r.Z.Consts.event.BEFOREFEATUREMODIFY="beforefeaturemodify.tc",r.Z.Consts.event.FEATUREMODIFY="featuremodify.tc",r.Z.Consts.event.FEATURESSELECT="featuresselect.tc",r.Z.Consts.event.FEATURESUNSELECT="featuresunselect.tc",r.Z.Consts.event.CHANGE="change",r.Z.control.Modify=function(){const t=this;r.Z.Control.apply(t,arguments),r.Z.browserFeatures.inputTypeColor()||window.CP||(r.Z.loadCSS(r.Z.apiLocation+"lib/color-picker/color-picker.min.css"),r.Z.syncLoadJS(r.Z.apiLocation+"lib/color-picker/color-picker.min.js")),t.styles=r.Z.Util.extend(!0,r.Z.Cfg.styles.selection,t.options.styles),t.styles.text=t.styles.text||{fontSize:t.styles.line.fontSize,fontColor:t.styles.line.fontColor,labelOutlineColor:t.styles.line.labelOutlineColor,labelOutlineWidth:t.styles.line.labelOutlineWidth},t._classSelector="."+t.CLASS,t.wrap=new r.Z.wrap.control.Modify(t),t.snapping="boolean"!=typeof t.options.snapping||t.options.snapping},r.Z.inherit(r.Z.control.Modify,r.Z.Control),function(){var t=r.Z.control.Modify.prototype;t.CLASS="tc-ctl-mod",t.template={},t.template[t.CLASS]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lambda,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<button type="button" class="tc-ctl-btn tc-ctl-mod-btn-select" disabled title="'+a(l(n,"i18n").call(i,"select",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:79},end:{line:1,column:96}}}))+'">'+a(l(n,"i18n").call(i,"select",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:98},end:{line:1,column:115}}}))+'</button><button \r\ntype="button" class="tc-ctl-btn tc-ctl-mod-btn-delete" disabled title="'+a(l(n,"i18n").call(i,"deleteSelectedFeatures",{name:"i18n",hash:{},data:o,loc:{start:{line:2,column:71},end:{line:2,column:104}}}))+'">'+a(l(n,"i18n").call(i,"deleteSelectedFeatures",{name:"i18n",hash:{},data:o,loc:{start:{line:2,column:106},end:{line:2,column:139}}}))+'</button><button \r\ntype="button" class="tc-ctl-btn tc-ctl-mod-btn-join" disabled title="'+a(l(n,"i18n").call(i,"joinGeometries.tooltip",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:69},end:{line:3,column:102}}}))+'">'+a(l(n,"i18n").call(i,"joinGeometries",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:104},end:{line:3,column:129}}}))+'</button><button \r\ntype="button" class="tc-ctl-btn tc-ctl-mod-btn-split" disabled title="'+a(l(n,"i18n").call(i,"splitGeometry",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:70},end:{line:4,column:94}}}))+'">'+a(l(n,"i18n").call(i,"splitGeometry",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:96},end:{line:4,column:120}}}))+'</button><button \r\ntype="button" class="tc-ctl-btn tc-ctl-mod-btn-attr" disabled title="'+a(l(n,"i18n").call(i,"editAttributes",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:69},end:{line:5,column:94}}}))+'">'+a(l(n,"i18n").call(i,"editAttributes",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:96},end:{line:5,column:121}}}))+'</button><button \r\ntype="button" class="tc-ctl-btn tc-ctl-mod-btn-text" contenteditable="true" disabled title="'+a(l(n,"i18n").call(i,"addText",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:92},end:{line:6,column:110}}}))+'">'+a(l(n,"i18n").call(i,"addText",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:112},end:{line:6,column:130}}}))+'</button>\r\n<div class="tc-ctl-mod-style tc-hidden">\r\n    <input type="text" class="tc-ctl-mod-txt tc-textbox" placeholder="'+a(l(n,"i18n").call(i,"writeTextForSketch",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:70},end:{line:8,column:99}}}))+'" style="font-size:'+a(s(null!=e?l(e,"fontSize"):e,e))+"pt;font-color:"+a(s(null!=e?l(e,"fontColor"):e,e))+";text-shadow: 0 0 "+a(s(null!=e?l(e,"labelOutlineWidth"):e,e))+"px "+a(s(null!=e?l(e,"labelOutlineColor"):e,e))+';" />\r\n    '+a(l(n,"i18n").call(i,"textColor",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:4},end:{line:9,column:24}}}))+'\r\n    <input type="color" class="tc-ctl-mod-fnt-c" value="'+a(s(null!=e?l(e,"fontColor"):e,e))+'" />\r\n    '+a(l(n,"i18n").call(i,"fontSize",{name:"i18n",hash:{},data:o,loc:{start:{line:11,column:4},end:{line:11,column:23}}}))+'\r\n    <input type="number" class="tc-ctl-mod-fnt-s tc-textbox" value="'+a(s(null!=e?l(e,"fontSize"):e,e))+'" min="7" max="20" />\r\n</div>\r\n<div class="tc-ctl-mod-attr tc-hidden"></div>\r\n'},useData:!0},t.template[t.CLASS+"-attr"]={1:function(t,e,n,r,o){var i=t.lambda,a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"                <tr>\r\n                    <th>"+a(i(null!=e?s(e,"name"):e,e))+'</th>\r\n                    <td>\r\n                        <input type="text" class="tc-textbox" name="'+a(i(null!=e?s(e,"name"):e,e))+'" value="'+a(i(null!=e?s(e,"value"):e,e))+'" />\r\n                    </td>\r\n                </tr>\r\n'},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-mod-attr">\r\n    <h3>'+s(l(n,"i18n").call(a,"attributeEdit",{name:"i18n",hash:{},data:o,loc:{start:{line:2,column:8},end:{line:2,column:32}}}))+'</h3>\r\n    <div class="tc-ctl-mod-attr-body">\r\n        <table>\r\n            <tbody>\r\n'+(null!=(i=l(n,"each").call(a,null!=e?l(e,"data"):e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:6,column:16},end:{line:13,column:25}}}))?i:"")+'            </tbody>\r\n        </table>\r\n    </div>\r\n    <div class="tc-ctl-mod-attr-footer">\r\n        <button type="button" class="tc-button tc-ctl-mod-btn-attr-ok">'+s(l(n,"i18n").call(a,"ok",{name:"i18n",hash:{},data:o,loc:{start:{line:18,column:71},end:{line:18,column:84}}}))+'</button>\r\n        <button type="button" class="tc-button tc-ctl-mod-btn-attr-cancel">'+s(l(n,"i18n").call(a,"cancel",{name:"i18n",hash:{},data:o,loc:{start:{line:19,column:75},end:{line:19,column:92}}}))+"</button>\r\n    </div>\r\n</div>\r\n"},useData:!0};const e=function(t,e){t._deleteBtn.disabled=0===e.length,t._editAttrBtn.disabled=1!==e.length,t._joinBtn.disabled=e.length<2,t._splitBtn.disabled=0===e.filter(n).length,t.displayLabelText()},n=function(t){var e=!1;return(r.Z.feature.MultiPolygon&&t instanceof r.Z.feature.MultiPolygon||r.Z.feature.MultiPolyline&&t instanceof r.Z.feature.MultiPolyline)&&t.geometry.length>1&&(e=!0),e};t.register=function(t){const n=this,o=r.Z.Control.prototype.register.call(n,t);return n.options.layer&&n.setLayer(n.options.layer),t.on(r.Z.Consts.event.FEATUREADD+" "+r.Z.Consts.event.FEATURESADD,(function(t){Promise.all([n.getLayer(),n.renderPromise()]).then((function(e){const r=e[0];t.layer===r&&n.setSelectableState(!0)}))})).on(r.Z.Consts.event.FEATUREREMOVE+" "+r.Z.Consts.event.FEATURESCLEAR,(function(t){const r=t.layer,o=t.feature;Promise.all([n.getLayer(),n.renderPromise()]).then((function(t){r===t[0]&&(o?n.unselectFeatures([o]):n.unselectFeatures(),e(n,n.getSelectedFeatures()),0===r.features.length&&(n.setSelectableState(!1),n.setTextMode(!1)))}))})).on(r.Z.Consts.event.LAYERUPDATE,(function(t){const r=t.layer;Promise.all([n.getLayer(),n.renderPromise()]).then((function(t){r===t[0]&&e(n,n.getSelectedFeatures())}))})),n.on(r.Z.Consts.event.FEATURESSELECT+" "+r.Z.Consts.event.FEATURESUNSELECT,(function(){const t=n.getSelectedFeatures();e(n,t);n.layer.features.filter((function(e){return t.indexOf(e)<0})).forEach((function(t){t.toggleSelectedStyle(!1)})),t.forEach((function(t){t.toggleSelectedStyle(!0)})),n.getAttributeDisplayTarget().classList.contains(r.Z.Consts.classes.HIDDEN)||n.displayAttributes(),t.length||n.closeAttributes()})),o},t.render=function(t){const e=this,n=function(){e._selectBtn=e.div.querySelector("."+e.CLASS+"-btn-select"),e._selectBtn.addEventListener(r.Z.Consts.event.CLICK,(function(t){t.target.disabled||(e.isActive?e.deactivate():e.activate())}),{passive:!0}),e._deleteBtn=e.div.querySelector("."+e.CLASS+"-btn-delete"),e._deleteBtn.addEventListener(r.Z.Consts.event.CLICK,(function(){e.deleteSelectedFeatures()}),{passive:!0}),e._textBtn=e.div.querySelector("."+e.CLASS+"-btn-text"),e._textBtn.addEventListener(r.Z.Consts.event.CLICK,(function(){e.setTextMode(!e.textActive)}),{passive:!0}),e._joinBtn=e.div.querySelector("."+e.CLASS+"-btn-join"),e._splitBtn=e.div.querySelector("."+e.CLASS+"-btn-split"),e._editAttrBtn=e.div.querySelector("."+e.CLASS+"-btn-attr"),e._editAttrBtn.addEventListener(r.Z.Consts.event.CLICK,(function(){e.toggleAttributes()}),{passive:!0}),e._textInput=e.div.querySelector("input."+e.CLASS+"-txt"),e._textInput.addEventListener("input",(function(t){e.labelFeatures(t.target.value)})),e._styleSection=e.div.querySelector("."+e.CLASS+"-style"),e._fontColorPicker=e.div.querySelector(e._classSelector+"-fnt-c"),e._fontColorPicker.addEventListener(r.Z.Consts.event.CHANGE,(function(t){e.setFontColor(t.target.value)})),e._fontSizeSelector=e.div.querySelector("."+e.CLASS+"-fnt-s"),e._fontSizeSelector.addEventListener(r.Z.Consts.event.CHANGE,(function(t){e.setFontSize(t.target.value)})),e._attributesSection=e.div.querySelector("."+e.CLASS+"-attr"),r.Z.Util.isFunction(t)&&t()},o={fontSize:e.styles.text.fontSize,fontColor:e.styles.text.fontColor,labelOutlineColor:e.styles.text.labelOutlineColor,labelOutlineWidth:e.styles.text.labelOutlineWidth};return r.Z.browserFeatures.inputTypeColor()?e._set1stRenderPromise(e.renderData(o,n)):e._set1stRenderPromise(e.renderData(o,(function(){const t=e.div.querySelector("input[type=color]");t.style.backgroundColor=t.value,t.style.color="transparent";const r=new CP(t,"click",document.body);t.onclick=function(t){t.preventDefault()},t.onfocus=function(t){this.blur()},t.onchange=function(t){this.style.backgroundColor=this.value},e.map.loaded((function(){r.on("change",(function(t){e.setFontColor("#"+t)}))})),n()})))},t.activate=function(){const t=this;t._selectBtn.classList.add(r.Z.Consts.classes.ACTIVE),r.Z.Control.prototype.activate.call(t),t.wrap.activate(t.mode)},t.deactivate=function(){const t=this;r.Z.Control.prototype.deactivate.call(t),t._selectBtn&&e(t,[]),t.wrap&&t.wrap.deactivate(),t._selectBtn&&(t._selectBtn.classList.remove(r.Z.Consts.classes.ACTIVE),t.layer&&t.unselectFeatures(t.getSelectedFeatures()))},t.clear=function(){const t=this;return t.layer&&t.layer.clearFatures(),t},t.isExclusive=function(){return!0},t.end=function(){return this.wrap.end(),this},t.setMode=function(t,e){const n=this;return t&&(n.mode=t),e&&t?(n.layer&&n.layer.map.putLayerOnTop(n.layer),n.activate()):n.deactivate(),n},t.getLayer=function(){var t=this;return t.options&&"boolean"==typeof t.options.layer&&!t.options.layer?Promise.resolve(null):t.layer?Promise.resolve(t.layer):t._layerPromise},t.setLayer=function(t){const e=this;e.map&&(e.setSelectedFeatures([]),e._layerPromise=new Promise((function(n,r){"string"==typeof t?e.map.loaded((function(){e.layer=e.map.getLayer(t),n(e.layer)})):(e.layer=t,n(e.layer))})),Promise.all([e._layerPromise,e.renderPromise()]).then((function(t){const n=t[0];e.setSelectableState(n&&n.features.length>0)})))},t.setSelectableState=function(t){this._selectBtn.disabled=!t,this._textBtn.disabled=!t},t.getSelectedFeatures=function(){return this.wrap.getSelectedFeatures()},t.setSelectedFeatures=function(t){const e=this.wrap.setSelectedFeatures(t);return this.displayLabelText(),e},t.getActiveFeatures=function(){const t=this,e=t.getSelectedFeatures();return!e.length&&t.layer.features.length&&e.push(t.layer.features[t.layer.features.length-1]),e},t.unselectFeatures=function(t){return t=t||[],this.wrap.unselectFeatures(t.map((function(t){return t.wrap.feature}))),this},t.deleteSelectedFeatures=function(){const t=this,e=t.getSelectedFeatures();return t.wrap.unselectFeatures(e),e.forEach((function(e){t.layer.removeFeature(e),t.trigger(r.Z.Consts.event.FEATUREREMOVE,{feature:e})})),t},t.styleFunction=function(t,e){var n;const o=this.map.options.styles.selection;switch(!0){case r.Z.feature.Polygon&&t instanceof r.Z.feature.Polygon:case r.Z.feature.MultiPolygon&&t instanceof r.Z.feature.MultiPolygon:n=r.Z.Util.extend({},o.polygon);break;case r.Z.feature.Point&&t instanceof r.Z.feature.Point:case r.Z.feature.MultiPoint&&t instanceof r.Z.feature.MultiPoint:n=r.Z.Util.extend({},o.point);break;default:n=r.Z.Util.extend({},o.line)}const i=t.getStyle();return i.label&&(n.label=i.label,n.fontSize=i.fontSize,n.fontColor=i.fontColor,n.labelOutlineColor=i.labelOutlineColor,n.labelOutlineWidth=i.labelOutlineWidth),n},t.setTextMode=function(t){const e=this;return e.textActive=t,t?(e._textBtn.classList.add(r.Z.Consts.classes.ACTIVE,t),e._styleSection.classList.remove(r.Z.Consts.classes.HIDDEN)):(e._textBtn.classList.remove(r.Z.Consts.classes.ACTIVE,t),e._styleSection.classList.add(r.Z.Consts.classes.HIDDEN)),e.displayLabelText(),e},t.setFontColorWatch=function(t,e){const n=this;return void 0===t&&(t=n.styles.text.fontColor),t=r.Z.Util.colorArrayToString(t),e=e||n.getLabelOutlineColor(t),n.renderPromise().then((function(){n._fontColorPicker.value=t,n._textInput.style.color=t,n._textInput.style.textShadow="0 0 "+n.styles.text.labelOutlineWidth+"px "+e,r.Z.browserFeatures.inputTypeColor()||(n._fontColorPicker.style.backgroundColor=t,n._fontColorPicker.blur())})),n},t.setFontColor=function(t){const e=this;e.styles.text.fontColor=t,e.styles.text.labelOutlineColor=e.getLabelOutlineColor(t),e.setFontColorWatch(t,e.styles.text.labelOutlineColor);return e.getActiveFeatures().forEach((function(n){const r=n.getStyle();r.fontColor=t,r.labelOutlineColor=e.styles.text.labelOutlineColor,n.setStyle(r)})),e},t.setFontSizeWatch=function(t){const e=this;void 0===t&&(t=e.styles.text.fontSize);const n=parseInt(t);return n!==Number.NaN&&e.renderPromise().then((function(){e._fontSizeSelector.value=n,e._textInput.style.fontSize=n+"pt"})),e},t.setFontSize=function(t){const e=this,n=parseInt(t);if(n!==Number.NaN){e.styles.text.fontSize=n,e.setFontSizeWatch(n);e.getActiveFeatures().forEach((function(t){const e=t.getStyle();e.fontSize=n,t.setStyle(e)}))}return e},t.getLabelOutlineColor=function(t){if(t){const e=(t=r.Z.Util.colorArrayToString(t)).match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);e&&e.length&&(t="#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]);const n=t.match(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i);if(n&&n.length){return(parseInt(n[1],16)+parseInt(n[2],16)+parseInt(n[3],16))/3<128?"#ffffff":"#000000"}}return"#ffffff"},t.displayLabelText=function(){const t=this,e=t.getSelectedFeatures();var n,r,o;if(t.isActive&&e.length){const t=e[e.length-1].getStyle();n=t.label,o=t.fontColor,r=t.fontSize}else n="",o=t.styles.text.fontColor,r=t.styles.text.fontSize;return t.renderPromise().then((function(){t.setFontSizeWatch(r).setFontColorWatch(o)._textInput.value=n||""})),t},t.labelFeatures=function(t){const e=this,n=e.getActiveFeatures();if(n.length){const o=n[0].getStyle();n.forEach((function(n){const i=r.Z.Util.extend({},e.styles.text,o);o.label=t,o.labelOffset=i.labelOffset,o.fontColor=i.fontColor,o.fontSize=i.fontSize,o.labelOutlineColor=i.labelOutlineColor,o.labelOutlineWidth=i.labelOutlineWidth,n.setStyle(o)}))}return e},t.getAttributeDisplayTarget=function(){return this._attributesSection},t.displayAttributes=function(){const t=this,e=t.getSelectedFeatures(),n=e[e.length-1];n&&t.getRenderedHtml(t.CLASS+"-attr",{data:n.getData()},(function(e){const n=t.getAttributeDisplayTarget();n.innerHTML=e,n.classList.remove(r.Z.Consts.classes.HIDDEN),t._editAttrBtn.classList.add(r.Z.Consts.classes.ACTIVE),n.querySelector(`${t.CLASS}-btn-attr-ok`).addEventListener(r.Z.Consts.event.CLICK,(function(e){t._onAttrOK()}),{passive:!0}),n.querySelector(`.${t.modifyControl.CLASS}-btn-attr-cancel`).addEventListener(r.Z.Consts.event.CLICK,(function(){t.closeAttributes()}),{passive:!0})}))},t.closeAttributes=function(){this._attributesSection.classList.add(r.Z.Consts.classes.HIDDEN),this._editAttrBtn.classList.remove(r.Z.Consts.classes.ACTIVE)},t.toggleAttributes=function(){const t=this;t._editAttrBtn.classList.toggle(r.Z.Consts.classes.ACTIVE)?t.displayAttributes():t.closeAttributes()},t._onAttrOK=function(){const t=this,e=t.getSelectedFeatures()[0];if(e){const n={};t.getAttributeDisplayTarget().querySelectorAll("input").forEach((function(t){n[t.getAttribute("name")]=t.value})),e.setData(n),t.trigger(r.Z.Consts.event.FEATUREMODIFY,{feature:e,layer:t.layer}),t.closeAttributes()}},t.joinFeatures=function(t){const n=this;if(n.geometryType===r.Z.Consts.geom.MULTIPOLYLINE||n.geometryType===r.Z.Consts.geom.MULTIPOLYGON||n.geometryType===r.Z.Consts.geom.MULTIPOINT){let l;if(n._joinedFeatureAttributes=[],t.length>1){var o=t.map((function(t){return n._joinedFeatureAttributes.push(t.getData()),t.geometry})).reduce((function(t,e){return t.concat(e)}));l=new t[0].constructor(o);for(var i=0,a=t.length;i<a;i++){var s=t[i];n.layer.removeFeature(s),n.trigger(r.Z.Consts.event.FEATUREREMOVE,{feature:s})}n.layer.addFeature(l).then((function(t){n.setSelectedFeatures([l]),n.trigger(r.Z.Consts.event.FEATUREADD,{feature:t}),t.showPopup(n.attributeEditor)}))}e(n,[l])}}}();const a=r.Z.control.Modify},122:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>a});var r=n(5361),o=n(2089),i=n(128);r.Z.control=r.Z.control||{},r.Z.Consts=o.Z,r.Z.control.FeatureInfoCommons=i.default,function(){r.Z.control.MultiFeatureInfo=function(){var t=this;r.Z.Control.apply(t,arguments),t.modes=t.options.modes||{},void 0===t.modes[r.Z.Consts.geom.POINT]&&(t.modes[r.Z.Consts.geom.POINT]=!0),void 0===t.modes[r.Z.Consts.geom.POLYGON]&&(t.modes[r.Z.Consts.geom.POLYGON]=!0),t.featureInfoControl=null,t.lineFeatureInfoControl=null,t.polygonFeatureInfoControl=null,t.featureInfoControls=[],t.lastCtrlActive=null,t.popup=null,t.exportsState=!1},r.Z.inherit(r.Z.control.MultiFeatureInfo,r.Z.control.FeatureInfoCommons);var t=r.Z.control.MultiFeatureInfo.prototype;t.CLASS="tc-ctl-m-finfo",t.template={1:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lambda,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<label class="tc-ctl-m-finfo-btn-point" title="'+a(l(n,"i18n").call(i,"selectionByPoint",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:75},end:{line:3,column:102}}}))+'"><input type="radio" name="'+a(s(null!=e?l(e,"controlId"):e,e))+'-mode" value="'+a(s(null!=e?l(e,"pointSelectValue"):e,e))+'" checked /><span class="tc-ctl-btn">'+a(l(n,"i18n").call(i,"byPoint",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:214},end:{line:3,column:232}}}))+"</span></label>"},3:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lambda,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<label class="tc-ctl-m-finfo-btn-line" title="'+a(l(n,"i18n").call(i,"selectionByLine",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:73},end:{line:4,column:99}}}))+'"><input type="radio" name="'+a(s(null!=e?l(e,"controlId"):e,e))+'-mode" value="'+a(s(null!=e?l(e,"lineSelectValue"):e,e))+'" /><span class="tc-ctl-btn">'+a(l(n,"i18n").call(i,"byLine",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:202},end:{line:4,column:219}}}))+"</span></label>"},5:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lambda,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<label class="tc-ctl-m-finfo-btn-polygon" title="'+a(l(n,"i18n").call(i,"selectionByPrecinct",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:79},end:{line:5,column:109}}}))+'"><input type="radio" name="'+a(s(null!=e?l(e,"controlId"):e,e))+'-mode" value="'+a(s(null!=e?l(e,"polygonSelectValue"):e,e))+'" /><span class="tc-ctl-btn">'+a(l(n,"i18n").call(i,"byPrecinct",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:215},end:{line:5,column:236}}}))+"</span></label>"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-m-finfo-select">\r\n    <span>'+s(l(n,"i18n").call(a,"selectionBy",{name:"i18n",hash:{},data:o,loc:{start:{line:2,column:10},end:{line:2,column:32}}}))+"</span>\r\n    "+(null!=(i=l(n,"if").call(a,null!=e?l(e,"pointSelectValue"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:4},end:{line:3,column:254}}}))?i:"")+"\r\n    "+(null!=(i=l(n,"if").call(a,null!=e?l(e,"lineSelectValue"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:4,column:4},end:{line:4,column:241}}}))?i:"")+"\r\n    "+(null!=(i=l(n,"if").call(a,null!=e?l(e,"polygonSelectValue"):e,{name:"if",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:5,column:4},end:{line:5,column:258}}}))?i:"")+'\r\n    <button type="button" class="tc-icon-btn tc-ctl-m-finfo-btn-dl" disabled title="'+s(l(n,"i18n").call(a,"downloadFeatures",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:84},end:{line:6,column:111}}}))+'"></button>\r\n    <button type="button" class="tc-icon-btn tc-ctl-m-finfo-btn-remove" disabled title="'+s(l(n,"i18n").call(a,"deleteFeatures",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:88},end:{line:7,column:113}}}))+'"></button>\r\n</div>\r\n'},useData:!0};const e=function(t,e){return t?(!0===t&&(t={}),r.Z.Util.extend(!0,t,e)):t};t.register=function(t){const n=this;return n.div.querySelectorAll("input[type=radio]").forEach((function(t){t.checked=!1})),new Promise((function(o,i){const a=[r.Z.Control.prototype.register.call(n,t)],s=n.options.styles||{},l=n.modes[r.Z.Consts.geom.POINT],c=n.modes[r.Z.Consts.geom.POLYLINE],u=n.modes[r.Z.Consts.geom.POLYGON];l&&a.push(t.addControl("featureInfo",e(n.modes[r.Z.Consts.geom.POINT],{id:n.getUID(),displayMode:n.options.displayMode,persistentHighlights:n.options.persistentHighlights,share:n.options.share})).then((function(t){return n.featureInfoControl=t,n.featureInfoControls.push(t),t}))),n.modes[r.Z.Consts.geom.POLYLINE]&&a.push(t.addControl("lineFeatureInfo",e(n.modes[r.Z.Consts.geom.POLYLINE],{id:n.getUID(),active:c.active,displayMode:n.options.displayMode,persistentHighlights:n.options.persistentHighlights,share:n.options.share,style:c.filterStyle||s.line})).then((function(t){return n.lineFeatureInfoControl=t,n.featureInfoControls.push(t),t}))),n.modes[r.Z.Consts.geom.POLYGON]&&a.push(t.addControl("polygonFeatureInfo",e(n.modes[r.Z.Consts.geom.POLYGON],{id:n.getUID(),active:u.active,displayMode:n.options.displayMode,persistentHighlights:n.options.persistentHighlights,share:n.options.share,style:u.filterStyle||s.polygon})).then((function(t){return n.polygonFeatureInfoControl=t,n.featureInfoControls.push(t),t}))),t.on(`${r.Z.Consts.event.LAYERADD} ${r.Z.Consts.event.LAYERREMOVE} ${r.Z.Consts.event.LAYERVISIBILITY}`,(function(t){n.updateUI()})),t.on(`${r.Z.Consts.event.CONTROLACTIVATE} ${r.Z.Consts.event.CONTROLDEACTIVATE}`,(function(t){t.control!==n.featureInfoControl&&t.control!==n.lineFeatureInfoControl&&t.control!==n.polygonFeatureInfoControl||n.updateUI()})),Promise.all(a).then((function(){n.featureInfoControl&&(n.featureInfoControl.activate(),n.lastCtrlActive=n.featureInfoControl),n.updateUI(),o(n)}))}))},t.render=function(t){const e=this;var n={controlId:e.id};return e.modes[r.Z.Consts.geom.POINT]&&(n.pointSelectValue=r.Z.Consts.geom.POINT),e.modes[r.Z.Consts.geom.POLYLINE]&&(n.lineSelectValue=r.Z.Consts.geom.POLYLINE),e.modes[r.Z.Consts.geom.POLYGON]&&(n.polygonSelectValue=r.Z.Consts.geom.POLYGON),e._set1stRenderPromise(e.renderData(n,(function(){var n=function(){switch(this.value){case r.Z.Consts.geom.POLYLINE:e.lineFeatureInfoControl.activate(),e.lastCtrlActive=e.lineFeatureInfoControl;break;case r.Z.Consts.geom.POLYGON:e.polygonFeatureInfoControl.activate(),e.lastCtrlActive=e.polygonFeatureInfoControl;break;default:e.featureInfoControl.activate(),e.lastCtrlActive=e.featureInfoControl}};e.div.querySelectorAll("input[type=radio]").forEach((function(t){t.addEventListener("change",n)}));e.div.querySelector(`.${e.CLASS}-btn-remove`).addEventListener(r.Z.Consts.event.CLICK,(function(t){e.featureInfoControls.forEach((t=>{t.resultsLayer.features.slice().forEach((e=>t.downplayFeature(e))),t.filterLayer.features.slice().forEach((t=>t.layer.removeFeature(t)))}))}),{passive:!0}),e.div.querySelector(`.${e.CLASS}-btn-dl`).addEventListener(r.Z.Consts.event.CLICK,(async function(t){const n=await e.getDownloadDialog();let r={title:e.getLocaleString("featureInfo")+" - "+e.getLocaleString("download"),fileName:e._getFileName()};(e.map.elevation||e.options.displayElevation)&&(r=Object.assign({},r,{elevation:Object.assign({},e.map.elevation&&e.map.elevation.options,e.options.displayElevation)})),n.open(Array.prototype.concat.apply([],e.featureInfoControls.map((t=>t.resultsLayer.features))),r)}),{passive:!0}),e.map.on(r.Z.Consts.event.FEATUREREMOVE,(function(t){e.featureInfoControls.some((e=>e.resultsLayer===t.layer||e.filterLayer===t.layer))&&e.updateUI()})).on(r.Z.Consts.event.FEATUREADD+" "+r.Z.Consts.event.FEATURESADD,(function(t){e.featureInfoControls.some((e=>e.resultsLayer===t.layer||e.filterLayer===t.layer))&&e.updateUI()})),r.Z.Util.isFunction(t)&&t()})))},t.activate=function(){this.lastCtrlActive&&this.lastCtrlActive.activate()},t.deactivate=function(){this.lastCtrlActive.deactivate(!1)},t.updateUI=function(){const t=this;t.renderPromise().then((function(){const e=t.map.workLayers.some((t=>t.type===r.Z.Consts.layerType.WMS&&t.getVisibility()));if(t.div.querySelectorAll("input").forEach((function(t){t.disabled=!e})),t.featureInfoControl){const e=t.div.querySelector(`input[value=${r.Z.Consts.geom.POINT}]`);e&&(e.checked=t.featureInfoControl.isActive)}if(t.lineFeatureInfoControl){const e=t.div.querySelector(`input[value=${r.Z.Consts.geom.POLYLINE}]`);e&&(e.checked=t.lineFeatureInfoControl.isActive)}if(t.polygonFeatureInfoControl){const e=t.div.querySelector(`input[value=${r.Z.Consts.geom.POLYGON}]`);e&&(e.checked=t.polygonFeatureInfoControl.isActive)}const n=t.featureInfoControls.some((t=>t.options.persistentHighlights)),o=t.featureInfoControls.every((t=>!(t.resultsLayer&&0!==t.resultsLayer.features.length||t.filterLayer&&0!==t.filterLayer.features.length))),i=t.div.querySelector(`.${t.CLASS}-btn-remove`);i.classList.toggle(r.Z.Consts.classes.HIDDEN,!n),i.disabled=o;const a=t.div.querySelector(`.${t.CLASS}-btn-dl`);a.classList.toggle(r.Z.Consts.classes.HIDDEN,!n),a.disabled=o;const s=t.div.style.display;t.div.style.display="none",s?t.div.style.display=s:t.div.style.removeProperty("display")}))}}();const a=r.Z.control.MultiFeatureInfo},2582:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var r,o=n(5361),i=n(2089),a=n(6498);o.Z.Consts=i.Z,o.Z.control=o.Z.control||{},o.Z.Control=a.Z,o.Z.control.NavBar=function(){o.Z.Control.apply(this,arguments)},o.Z.inherit(o.Z.control.NavBar,o.Z.Control),(r=o.Z.control.NavBar.prototype).CLASS="tc-ctl-nav",r.render=function(){var t=this;return t.wrap||(t.wrap=new o.Z.wrap.control.NavBar(t)),t._set1stRenderPromise(Promise.resolve())},r.register=function(t){const e=this,n=o.Z.Control.prototype.register.call(e,t);return e.wrap.register(t),(void 0===e.options.home||e.options.home)&&t.addControl("navBarHome"),t.loaded((function(){e.wrap.refresh()})),n};const s=o.Z.control.NavBar},3739:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var r,o=n(5361),i=n(2089),a=n(6498);o.Z.Consts=i.Z,o.Z.control=o.Z.control||{},o.Z.Control=a.Z,o.Z.control.NavBarHome=function(){o.Z.Control.apply(this,arguments)},o.Z.inherit(o.Z.control.NavBarHome,o.Z.Control),(r=o.Z.control.NavBarHome.prototype).CLASS="tc-ctl-nav-home",r.render=function(){var t=this;return t.wrap||(t.wrap=new o.Z.wrap.control.NavBarHome(t)),Promise.resolve()},r.register=function(t){const e=this,n=o.Z.Control.prototype.register.call(e,t);return e.wrap.register(t),t.on(o.Z.Consts.event.PROJECTIONCHANGE,(function(n){const r=n.newCrs;var i=o.Z.Util.reproject([t.options.initialExtent[0],t.options.initialExtent[1]],t.options.crs,r),a=o.Z.Util.reproject([t.options.initialExtent[2],t.options.initialExtent[3]],t.options.crs,r);e.wrap.setInitialExtent([i[0],i[1],a[0],a[1]])})),n};const s=o.Z.control.NavBarHome},2721:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>a});var r=n(5361),o=n(2089),i=n(2197);r.Z.control=r.Z.control||{},r.Z.Consts=o.Z,r.Z.control.SWCacheClient=i.default,function(){r.Z.Consts.classes.CONNECTION_OFFLINE=r.Z.Consts.classes.CONNECTION_OFFLINE||"tc-conn-offline",r.Z.Consts.classes.CONNECTION_WIFI=r.Z.Consts.classes.CONNECTION_WIFI||"tc-conn-wifi",r.Z.Consts.classes.CONNECTION_MOBILE=r.Z.Consts.classes.CONNECTION_MOBILE||"tc-conn-mobile",r.Z.Consts.classes.OFFLINE=r.Z.Consts.classes.OFFLINE||"tc-offline";r.Z.control.OfflineMapMaker=function(){var t=this;r.Z.control.SWCacheClient.apply(this,arguments);var n=t._classSelector="."+t.CLASS;t._selectors={DRAW:n+"-draw",DRAWING:n+"-drawing",PROGRESS:n+"-progress",NEW:n+"-new",LIST:n+"-list",LISTITEM:n+"-list > li",OKBTN:n+"-btn-ok",NEWBTN:n+"-btn-new",SAVEBTN:".tc-btn-save",CANCELBTN:".tc-btn-cancel",EDITBTN:".tc-btn-edit",VIEWBTN:".tc-btn-view",DELETEBTN:".tc-btn-delete",TILECOUNT:n+"-tile-count",NAMETB:n+"-txt-name",TEXTBOX:"input.tc-textbox",EXIT:n+"-link-exit",OFFPANEL:n+"-off-panel",RESOLUTIONPANEL:n+"-res-panel",BLLIST:n+"-bl-list",BLLISTITEM:n+"-bl-list > li",BLLISTTEXT:n+"-bl-panel-txt",RNGMAXRES:n+"-rng-maxres",SEARCH:n+"-map-available-srch",EMPTYLIST:n+"-map-available-empty",OFFLINEHIDDEN:"[data-no-cb]"},t.storedMaps=[];const o=r.Z.Util.getParameterByName(t.MAP_DEFINITION_PARAM_NAME),i=r.Z.Util.getParameterByName(t.MAP_EXTENT_PARAM_NAME);t.mapIsOffline=!!o,o&&(t.currentMapDefinition=JSON.parse(window.atob(decodeURIComponent(o)))),i&&(t.currentMapExtent=e(i));try{t.localStorage=window.localStorage;const e="__delete_me__";t.localStorage.setItem(e,e),t.localStorage.removeItem(e)}catch(e){t.localStorage=null,r.Z.error(t.getLocaleString("couldNotAccessLocalStorage"))}if(t.localStorage){for(var a=0,s=t.localStorage.length;a<s;a++){var l=t.localStorage.key(a);if(0===l.indexOf(t.LOCAL_STORAGE_KEY_PREFIX)&&l!==t.LOCAL_STORAGE_KEY_PREFIX+t.ROOT_CACHE_NAME+".hash"){var c=t.localStorage.getItem(l).split(" "),u=e(c.shift()),p=c.join(" "),d={name:p,extent:u,url:decodeURIComponent(l.substr(t.LOCAL_STORAGE_KEY_PREFIX.length))};t.storedMaps.push(d)}}t.storedMaps.sort((function(t,e){return t.name>e.name?1:t.name<e.name?-1:0}))}var h=r.Z.Util.extend({},arguments.length>1?arguments[1]:arguments[0]);t._dialogDiv=r.Z.Util.getDiv(h.dialogDiv),window.$&&(t._$dialogDiv=$(t._dialogDiv)),h.dialogDiv||document.body.appendChild(t._dialogDiv),t.mapIsOffline&&document.querySelectorAll(t._selectors.OFFLINEHIDDEN).forEach((function(t){t.classList.add(r.Z.Consts.classes.HIDDEN)})),r.Z.Control.apply(t,arguments),t.wrap=new r.Z.wrap.control.OfflineMapMaker(t),t.isDownloading=!1,t.baseLayers=[],t.options.averageTileSize=t.options.averageTileSize||r.Z.Cfg.averageTileSize,t.requestSchemas=[],t.minResolution=0,t.currentMap=null,t._loadedCount=0;var f=history.pushState;history.pushState=function(e){var n;return n=f.apply(history,arguments),t._offlineMapHintDiv&&t._offlineMapHintDiv.querySelector(t._selectors.EXIT).setAttribute("href",t.getOnlineMapUrl()),n};var m=navigator.connection||navigator.mozConnection||navigator.webkitConnection||{},g=function(){if(t._offlineMapHintDiv){const e=t._offlineMapHintDiv.querySelector(t._selectors.OFFPANEL);switch(e.classList.remove(r.Z.Consts.classes.CONNECTION_OFFLINE,r.Z.Consts.classes.CONNECTION_MOBILE,r.Z.Consts.classes.CONNECTION_WIFI),m.type){case 1:case 2:case void 0:e.classList.add(r.Z.Consts.classes.CONNECTION_WIFI);break;default:e.classList.add(r.Z.Consts.classes.CONNECTION_MOBILE)}}};m.addEventListener&&m.addEventListener("typechange",g),window.addEventListener("online",g),window.addEventListener("offline",(function(){if(t._offlineMapHintDiv){const e=t._offlineMapHintDiv.querySelector(t._selectors.OFFPANEL);e.classList.add(r.Z.Consts.classes.CONNECTION_OFFLINE),e.classList.remove(r.Z.Consts.classes.CONNECTION_MOBILE,r.Z.Consts.classes.CONNECTION_WIFI)}}))},r.Z.inherit(r.Z.control.OfflineMapMaker,r.Z.control.SWCacheClient);var t=r.Z.control.OfflineMapMaker.prototype;t.CLASS="tc-ctl-omm",t.MAP_DEFINITION_PARAM_NAME="map-def",t.MAP_EXTENT_PARAM_NAME="map-extent",t.LOCAL_STORAGE_KEY_PREFIX="TC.offline.map.",t.ROOT_CACHE_NAME="root",t.SERVICE_WORKER_FLAG="sw",t._states={READY:"ready",EDIT:"editing",DOWNLOADING:"downloading",DELETING:"deleting"},t._actions={CREATE:"create",DELETE:"delete"},t.offlineControls=["attribution","basemapSelector","offlineMapMaker","click","coordinates","dataLoader","draw","edit","fileImport","fullScreen","geolocation","loadingIndicator","measure","modify","navBar","popup","print","scale","scaleBar","scaleSelector","state","workLayerManager"],r.Z.Consts.event.MAPCACHEDOWNLOAD=r.Z.Consts.event.MAPCACHEDOWNLOAD||"mapcachedownload.tc",r.Z.Consts.event.MAPCACHEDELETE=r.Z.Consts.event.MAPCACHEDELETE||"mapcachedelete.tc",r.Z.Consts.event.MAPCACHEPROGRESS=r.Z.Consts.event.MAPCACHEPROGRESS||"mapcacheprogress.tc",r.Z.Consts.event.MAPCACHEERROR=r.Z.Consts.event.MAPCACHEERROR||"mapcacheerror.tc",t.template={},t.template[t.CLASS]={1:function(t,e,n,r,o){return" disabled"},3:function(t,e,n,r,o){return" hidden"},5:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-omm-map-node"),e,{name:"tc-ctl-omm-map-node",data:o,indent:"        ",helpers:n,partials:r,decorators:t.decorators}))?i:""},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lambda,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+s(c(n,"i18n").call(a,"offlineMaps",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:4},end:{line:1,column:26}}}))+'</h2>\r\n<div class="tc-ctl-omm-content">\r\n    <div class="tc-ctl-omm-draw tc-hidden"></div>\r\n    <i class="tc-ctl-omm-map-search-icon"></i>\r\n    <input type="search" list="'+s(l(null!=e?c(e,"listId"):e,e))+'" class="tc-ctl-omm-map-available-srch tc-textbox" placeholder="'+s(c(n,"i18n").call(a,"cb.filter.plhr",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:105},end:{line:5,column:130}}}))+'"'+(null!=(i=c(n,"unless").call(a,null!=e?c(e,"storedMaps"):e,{name:"unless",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:5,column:131},end:{line:5,column:173}}}))?i:"")+' maxlength="200" />                \r\n    <ul id="'+s(l(null!=e?c(e,"listId"):e,e))+'" class="tc-ctl-omm-list">\r\n        <li class="tc-ctl-omm-map-available-empty"'+(null!=(i=c(n,"if").call(a,null!=e?c(e,"storedMaps"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:7,column:50},end:{line:7,column:82}}}))?i:"")+"><span>"+s(c(n,"i18n").call(a,"cb.noMaps",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:89},end:{line:7,column:109}}}))+'</span></li>\r\n        <li class="tc-ctl-omm-map-not" hidden><span>'+s(c(n,"i18n").call(a,"noMatches",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:52},end:{line:8,column:72}}}))+"</span></li>\r\n"+(null!=(i=c(n,"each").call(a,null!=e?c(e,"storedMaps"):e,{name:"each",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:9,column:8},end:{line:11,column:17}}}))?i:"")+'    </ul>\r\n    <div class="tc-ctl-omm-new">\r\n        <button type="button" class="tc-button tc-icon-button tc-ctl-omm-btn-new" disabled title="'+s(c(n,"i18n").call(a,"newofflinemap",{name:"i18n",hash:{},data:o,loc:{start:{line:14,column:98},end:{line:14,column:122}}}))+'">'+s(c(n,"i18n").call(a,"newOfflineMap",{name:"i18n",hash:{},data:o,loc:{start:{line:14,column:124},end:{line:14,column:148}}}))+'</button>\r\n    </div>\r\n    <div class="tc-ctl-omm-drawing tc-hidden">\r\n        <div class="tc-ctl-omm-tile-cmd">\r\n            <button type="button" class="tc-button tc-icon-button tc-ctl-omm-btn-cancel-draw" title="'+s(c(n,"i18n").call(a,"cancel",{name:"i18n",hash:{},data:o,loc:{start:{line:18,column:101},end:{line:18,column:118}}}))+'">'+s(c(n,"i18n").call(a,"cancel",{name:"i18n",hash:{},data:o,loc:{start:{line:18,column:120},end:{line:18,column:137}}}))+'</button>\r\n        </div>\r\n    </div>\r\n    <div class="tc-ctl-omm-progress tc-hidden">\r\n        <p>'+s(c(n,"i18n").call(a,"cb.DownloadingMap",!0,{name:"i18n",hash:{},data:o,loc:{start:{line:22,column:11},end:{line:22,column:44}}}))+': <span class="tc-ctl-omm-progress-count"></span></p>\r\n        <div class="tc-ctl-omm-progress-bar">\r\n            <div class="tc-ctl-omm-progress-ratio" style="width:0"></div>\r\n        </div>\r\n        <button type="button" class="tc-button tc-icon-button tc-ctl-omm-btn-cancel-dl" title="'+s(c(n,"i18n").call(a,"cancel",{name:"i18n",hash:{},data:o,loc:{start:{line:26,column:95},end:{line:26,column:112}}}))+'">'+s(c(n,"i18n").call(a,"cancel",{name:"i18n",hash:{},data:o,loc:{start:{line:26,column:114},end:{line:26,column:131}}}))+"</button>\r\n    </div>\r\n</div>\r\n"},usePartial:!0,useData:!0},t.template[t.CLASS+"-map-node"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=t.lambda,a=t.escapeExpression,s=null!=e?e:t.nullContext||{},l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li data-extent="'+a(i(null!=e?l(e,"extent"):e,e))+'">\r\n    <span><a href="'+a(i(null!=e?l(e,"url"):e,e))+'" title="'+a(i(null!=e?l(e,"name"):e,e))+'">'+a(i(null!=e?l(e,"name"):e,e))+'</a></span>\r\n    <input class="tc-textbox tc-hidden" type="text" value="'+a(i(null!=e?l(e,"name"):e,e))+'" />\r\n    <button type="button" class="tc-icon-btn tc-btn-save tc-hidden" title="'+a(l(n,"i18n").call(s,"save",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:75},end:{line:4,column:90}}}))+'"></button>\r\n    <button type="button" class="tc-icon-btn tc-btn-cancel tc-hidden" title="'+a(l(n,"i18n").call(s,"cancel",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:77},end:{line:5,column:94}}}))+'"></button>\r\n    <button type="button" class="tc-icon-btn tc-btn-edit" title="'+a(l(n,"i18n").call(s,"editMapName",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:65},end:{line:6,column:87}}}))+'">'+a(l(n,"i18n").call(s,"editMapName",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:89},end:{line:6,column:111}}}))+'</button>\r\n    <button type="button" class="tc-toggle tc-btn-view" title="'+a(l(n,"i18n").call(s,"viewMapExtent",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:63},end:{line:7,column:87}}}))+'">'+a(l(n,"i18n").call(s,"viewMapExtent",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:89},end:{line:7,column:113}}}))+'</button>\r\n    <button type="button" class="tc-icon-btn tc-btn-delete" title="'+a(l(n,"i18n").call(s,"deleteMap",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:67},end:{line:8,column:87}}}))+'">'+a(l(n,"i18n").call(s,"deleteMap",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:89},end:{line:8,column:109}}}))+"</button>\r\n</li>\r\n"},useData:!0},t.template[t.CLASS+"-bl-node"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=t.lambda,a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li class="tc-ctl-omm-bl-node" data-layer-uid="'+a(i(null!=e?s(e,"id"):e,e))+'">\r\n    <label style="background-size: 100% 100%; background-image: url('+a(i(null!=e?s(e,"thumbnail"):e,e))+')">\r\n        <input type="checkbox" name="cbbl" value="'+a(i(null!=e?s(e,"id"):e,e))+'" disabled><span>'+a(i(null!=e?s(e,"title"):e,e))+"</span>\r\n    </label>\r\n</li>"},useData:!0},t.template[t.CLASS+"-dialog"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-omm-dialog tc-modal">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+a(s(n,"i18n").call(i,"newOfflineMap",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:16},end:{line:5,column:40}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <input type="text" class="tc-ctl-omm-txt-name" placeholder="'+a(s(n,"i18n").call(i,"nameRequired",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:72},end:{line:9,column:95}}}))+'" required />\r\n            <div class="tc-ctl-omm-bl-panel">\r\n                <h4>'+a(s(n,"i18n").call(i,"availableOfflineMaps",{name:"i18n",hash:{},data:o,loc:{start:{line:11,column:20},end:{line:11,column:51}}}))+'</h4>\r\n                <p class="tc-ctl-omm-bl-panel-txt">'+a(s(n,"i18n").call(i,"selectAtLeastOne",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:51},end:{line:12,column:78}}}))+'</p>\r\n                <ul class="tc-ctl-omm-bl-list"></ul>\r\n            </div>\r\n            <div class="tc-ctl-omm-res-panel tc-hidden">\r\n                <h4>'+a(s(n,"i18n").call(i,"maxRes",{name:"i18n",hash:{},data:o,loc:{start:{line:16,column:20},end:{line:16,column:37}}}))+'</h4>\r\n                <div class="tc-ctl-omm-res"></div>\r\n                <input type="range" class="tc-ctl-omm-rng-maxres" disabled value="0" title="'+a(s(n,"i18n").call(i,"maxRes",{name:"i18n",hash:{},data:o,loc:{start:{line:18,column:92},end:{line:18,column:109}}}))+'">\r\n            </div>\r\n            <div class="tc-ctl-omm-tile-count tc-hidden"></div>\r\n        </div>\r\n        <div class="tc-modal-footer">\r\n            <button type="button" class="tc-button tc-modal-close tc-ctl-omm-btn-ok" disabled>'+a(s(n,"i18n").call(i,"ok",{name:"i18n",hash:{},data:o,loc:{start:{line:23,column:94},end:{line:23,column:107}}}))+'</button>\r\n            <button type="button" class="tc-button tc-modal-close tc-ctl-omm-btn-cancel">'+a(s(n,"i18n").call(i,"cancel",{name:"i18n",hash:{},data:o,loc:{start:{line:24,column:89},end:{line:24,column:106}}}))+"</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},useData:!0},t.template[t.CLASS+"-off-panel"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-omm-off-panel tc-conn-wifi">\r\n    <span>'+a(s(n,"i18n").call(i,"offlineMap",{name:"i18n",hash:{},data:o,loc:{start:{line:2,column:10},end:{line:2,column:31}}}))+'</span> <a href="'+a(t.lambda(null!=e?s(e,"url"):e,e))+'" class="tc-ctl-omm-link-exit" title="'+a(s(n,"i18n").call(i,"returnToOnlineMaps",{name:"i18n",hash:{},data:o,loc:{start:{line:2,column:93},end:{line:2,column:122}}}))+'"><span>'+a(s(n,"i18n").call(i,"returnToOnlineMaps",{name:"i18n",hash:{},data:o,loc:{start:{line:2,column:130},end:{line:2,column:159}}}))+"</span></a>\r\n</div>"},useData:!0};const e=function(t){return decodeURIComponent(t).split(",").map((function(t){return parseFloat(t)}))},n=function(t,e){e.querySelector("span").classList.remove(r.Z.Consts.classes.HIDDEN),e.querySelector(t._selectors.TEXTBOX).classList.add(r.Z.Consts.classes.HIDDEN),e.querySelector(t._selectors.SAVEBTN).classList.add(r.Z.Consts.classes.HIDDEN),e.querySelector(t._selectors.CANCELBTN).classList.add(r.Z.Consts.classes.HIDDEN),e.querySelector(t._selectors.EDITBTN).classList.remove(r.Z.Consts.classes.HIDDEN),e.querySelector(t._selectors.VIEWBTN).classList.remove(r.Z.Consts.classes.HIDDEN),e.querySelector(t._selectors.DELETEBTN).classList.remove(r.Z.Consts.classes.HIDDEN)};var o=function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")},i=function(t,e){var n=e||{};const o=t._dialogDiv.querySelector(t._classSelector+"-res"),i=t._dialogDiv.querySelector(t._selectors.RNGMAXRES);var a,s,l,c=t.getResolutions();if(c.length){if(i.setAttribute("max",c.length-1),t.minResolution){if(void 0===n.rangeValue)for(var u=0,p=c.length;u<p;u++)if(t.minResolution>=c[u]){i.value=u;break}}else if(void 0===n.rangeValue){const e=t.map.getResolution();i.value=c.filter((t=>t>e)).length}s=parseInt(i.value);var d=Math.floor(1e3*new Number(c[s]))/1e3;a=t.getLocaleString("metersPerPixel",{value:d.toLocaleString((t.map?t.map.options.locale:r.Z.Cfg.locale).replace("_","-"))}),l=100*(s+1)/(c.length+1)+"%",i.disabled=!1,t.minResolution=c[i.value]}else s=0,a="",i.value=0,l="0",t.minResolution=0,i.disabled=!0;t._dialogDiv.querySelector(t._selectors.RESOLUTIONPANEL).classList.toggle(r.Z.Consts.classes.HIDDEN,!!i.disabled),t._dialogDiv.querySelector(t._selectors.TILECOUNT).classList.toggle(r.Z.Consts.classes.HIDDEN,!!i.disabled),o.style.left=l,o.innerHTML=a};const a=function(t){t._dialogDiv.querySelectorAll(t._classSelector+"-bl-node input[type=checkbox]").forEach((function(e,n){if(e.checked){var r=t.requestSchemas.filter((function(t){return t.layerId===e.value}))[0];if(r){var o=function(t,e){for(var n=null,r=0,o=t.tileMatrixLimits.length;r<o&&!((n=t.tileMatrixLimits[r]).res<=e);r++);return n}(r,t.minResolution);if(o){const n="{TileMatrixSet}",u="{TileMatrix}",p="{TileRow}",d="{TileCol}";var i=r.url;if(i.indexOf(u)<0){var a=i.indexOf("?");a>=0&&(i=i.substr(0,a));for(var s=0,l=t.baseLayers.length;s<l;s++){var c=t.baseLayers[s];if(c.id===r.layerId){i=i+"?layer="+c.layerNames+"&style=default&tilematrixset="+n+"&Service=WMTS&Request=GetTile&Version=1.0.0&Format="+c.format+"&TileMatrix="+u+"&TileRow="+p+"&TileCol="+d;break}}}for(;e&&"LABEL"!==e.tagName;)e=e.parentElement;e&&(e.style.backgroundSize="auto",e.style.backgroundPosition="left bottom",e.style.backgroundImage="url("+i.replace(n,r.tileMatrixSet).replace(u,o.mId).replace(p,o.rt).replace(d,o.cl)+")")}}}}))},s=function(t,e){return e<1?t.getLocaleString("lessThan1Mb"):t.getLocaleString("approxXMb",{quantity:o(e)})},l=function(t){var e="";t.tileCount=0;for(var n=0,r=t.requestSchemas.length;n<r;n++)for(var i=t.requestSchemas[n],a=0,l=i.tileMatrixLimits.length;a<l;a++){var c=i.tileMatrixLimits[a];if(c.res<t.minResolution)break;t.tileCount+=(c.cr-c.cl+1)*(c.rb-c.rt+1)}t.tileCount&&(t.estimatedMapSize=Math.round(t.tileCount*t.options.averageTileSize/1048576),e=t.getLocaleString("xTiles",{quantity:o(t.tileCount)})+" ("+s(t,t.estimatedMapSize)+")"),t._dialogDiv.querySelector(t._selectors.TILECOUNT).innerHTML=e},c=function(t,e){var n=e.indexOf("#");n>=0&&(e=e.substr(0,n));const r=t.div.querySelectorAll(t._selectors.LISTITEM);for(var o=0,i=r.length;o<i;o++){const t=r[o],n=t.querySelector("a");if(n&&n.getAttribute("href")===e)return t}return null};var u=function(t,e){var n=!1;return t.localStorage&&(t.localStorage.setItem(t.LOCAL_STORAGE_KEY_PREFIX+encodeURIComponent(e.url),e.extent+" "+e.name),n=!0),n};const p=function(t,e){const n=t.findStoredMap({url:e});if(n){if(function(t,e){var n=!1;return t.localStorage&&(t.localStorage.removeItem(t.LOCAL_STORAGE_KEY_PREFIX+encodeURIComponent(e)),n=!0),n}(t,e)){const e=function(t,e){const n=t.div.querySelectorAll(t._selectors.LISTITEM);for(var r=0,o=n.length;r<o;r++){const t=n[r],o=t.querySelector("a");if(o&&o.innerHTML===e)return t}return null}(t,n.name);e&&e.parentElement.removeChild(e)}var r=t.storedMaps.indexOf(n);return t.storedMaps.splice(r,1),t.storedMaps.length||(t.div.querySelector(t._selectors.SEARCH).disabled=!0,t.div.querySelector(t._selectors.EMPTYLIST).removeAttribute("hidden")),t.layer.features.filter((t=>t.data.map===n.name)).forEach((e=>t.layer.removeFeature(e))),n.name}return null};t.render=function(t){const o=this;return o._set1stRenderPromise(new Promise((function(s,p){var d={storedMaps:o.storedMaps,listId:o.CLASS+"-list-"+r.Z.getUID()};o.getRenderedHtml(o.CLASS+"-dialog",null,(function(t){o._dialogDiv.innerHTML=t,o._dialogDiv.querySelector(o._selectors.NAMETB).addEventListener(r.Z.Consts.event.CLICK,(function(t){t.preventDefault(),this.selectionStart=0,this.selectionEnd=this.value.length,this.focus()}))})).then((function(){o.renderData(d,(function(){o._dialogDiv.querySelector(o._selectors.OKBTN).addEventListener(r.Z.Consts.event.CLICK,(function(){o.generateCache()}),{passive:!0}),o._dialogDiv.querySelector(o._selectors.NAMETB).addEventListener("input",(function(){o._updateReadyState()})),o.div.querySelector(o._selectors.NEWBTN).addEventListener(r.Z.Consts.event.CLICK,(function(){o.setEditState()}),{passive:!0}),o.div.querySelector(o._classSelector+"-btn-cancel-draw").addEventListener(r.Z.Consts.event.CLICK,(function(){o.setReadyState()}),{passive:!0}),o.div.querySelector(o._classSelector+"-btn-cancel-dl").addEventListener(r.Z.Consts.event.CLICK,(function(){o.cancelCacheRequest()}),{passive:!0});const s=o.div.querySelector(o._selectors.LIST);s.addEventListener(r.Z.Consts.event.CLICK,r.Z.EventTarget.listenerBySelector(o._selectors.DELETEBTN,(function(t){o.startDeleteMap(t.target.parentElement.querySelector("a").innerHTML)})),{passive:!0}),s.addEventListener(r.Z.Consts.event.CLICK,r.Z.EventTarget.listenerBySelector(o._selectors.EDITBTN,(function(t){!function(t,e){e.querySelector("span").classList.add(r.Z.Consts.classes.HIDDEN);const n=e.querySelector(t._selectors.TEXTBOX);n.classList.remove(r.Z.Consts.classes.HIDDEN),n.value=e.querySelector("span a").innerHTML,n.focus(),e.querySelector(t._selectors.SAVEBTN).classList.remove(r.Z.Consts.classes.HIDDEN),e.querySelector(t._selectors.CANCELBTN).classList.remove(r.Z.Consts.classes.HIDDEN),e.querySelector(t._selectors.EDITBTN).classList.add(r.Z.Consts.classes.HIDDEN),e.querySelector(t._selectors.VIEWBTN).classList.add(r.Z.Consts.classes.HIDDEN),e.querySelector(t._selectors.DELETEBTN).classList.add(r.Z.Consts.classes.HIDDEN)}(o,t.target.parentElement)})),{passive:!0}),s.addEventListener(r.Z.Consts.event.CLICK,r.Z.EventTarget.listenerBySelector(o._selectors.CANCELBTN,(function(t){const e=t.target.parentElement;e.querySelector(o._selectors.TEXTBOX).value=e.querySelector("a").innerHTML,n(o,e)})),{passive:!0}),s.addEventListener(r.Z.Consts.event.CLICK,r.Z.EventTarget.listenerBySelector(o._selectors.SAVEBTN,(function(t){const e=t.target.parentElement;n(o,e);const r=e.querySelector("a"),i=e.querySelector(o._selectors.TEXTBOX).value,a=o.findStoredMap({url:r.getAttribute("href")});a&&(a.name=i,r.innerHTML=i,r.setAttribute("title",i),u(o,a))})),{passive:!0}),s.addEventListener(r.Z.Consts.event.CLICK,r.Z.EventTarget.listenerBySelector(o._selectors.VIEWBTN,(function(t){const n=t.target;var i=!n.classList.contains(r.Z.Consts.classes.ACTIVE);o.div.querySelectorAll(o._selectors.VIEWBTN).forEach((t=>t.classList.remove(r.Z.Consts.classes.ACTIVE)));const a=n.parentElement.querySelector("a").innerHTML;if(a){var s=o.findStoredMap({name:a});if(s){var l=e(s.extent);o.layer.clearFeatures(),i&&(o.layer.addPolygon([[[l[0],l[1]],[l[0],l[3]],[l[2],l[3]],[l[2],l[1]]]],{showsPopup:!1,data:{map:s.name}}).then((function(){o.layer.map.zoomToFeatures(o.layer.features)})),n.classList.add(r.Z.Consts.classes.ACTIVE),n.setAttribute("title",o.getLocaleString("removeMapExtent")))}}})),{passive:!0});const p=o.div.querySelector(o._selectors.SEARCH),d=function(){!function(t){t=t.toLowerCase();const e=o.div.querySelectorAll(o._selectors.LISTITEM);e.forEach((function(t){t.style.display="none"}));const n=[];if(e.forEach((function(t){t.matches("li:not([class]),li."+r.Z.Consts.classes.ACTIVE)&&n.push(t)})),0===t.length)n.forEach((function(t){t.style.removeProperty("display")})),o.div.querySelector(o._classSelector+"-map-search-icon").style.visibility="visible";else{o.div.querySelector(o._classSelector+"-map-search-icon").style.visibility="hidden";var i=new RegExp(t,"i");n.forEach((function(t){t.style.display=i.test(t.querySelector("a").textContent)?"":"none"})),n.some((function(t){return!t.hidden}))||e.forEach((function(t){t.matches('[class^="tc-ctl-omm-map-not"]')&&t.style.removeProperty("display")}))}}(this.value.toLowerCase().trim())};p.addEventListener("keyup",d),p.addEventListener("search",d),o._dialogDiv.querySelector(o._selectors.BLLIST).addEventListener("change",r.Z.EventTarget.listenerBySelector("input[type=checkbox]",(function(t){const e=t.target;if(e.checked)o.baseLayers.push(o.map.getLayer(e.value));else for(var n=0,r=o.baseLayers.length;n<r;n++){if(o.baseLayers[n].id===e.value){o.baseLayers.splice(n,1);break}}o.updateRequestSchemas(),i(o),a(o),o._updateReadyState(),l(o)})));const h=o._dialogDiv.querySelector(o._selectors.RNGMAXRES),f=function(t){i(o,{rangeValue:t.target.value}),a(o),l(o)};h.addEventListener("input",f),h.addEventListener("change",f);const m=c(o,location.href);m&&m.classList.add(r.Z.Consts.classes.ACTIVE),r.Z.Util.isFunction(t)&&t()})).then((function(){s()})).catch((function(t){p(t instanceof Error?t:Error(t))}))})),window.addEventListener("beforeunload",(function(t){if(o.isDownloading){var e=o.getLocaleString("cb.mapDownloading.warning");return t.returnValue=e,e}}),!0)})))},t.register=function(t){var e=this;const n=r.Z.control.SWCacheClient.prototype.register.call(e,t);e.getServiceWorker().then((function(){navigator.serviceWorker.ready.then((function(){navigator.serviceWorker.addEventListener("message",(function(t){switch(t.data.event){case"progress":e.trigger(r.Z.Consts.event.MAPCACHEPROGRESS,{url:t.data.name,requestId:t.data.requestId,loaded:t.data.count,total:t.data.total});break;case"cached":e.trigger(r.Z.Consts.event.MAPCACHEDOWNLOAD,{url:t.data.name,requestId:t.data.requestId});break;case"deleted":e.trigger(r.Z.Consts.event.MAPCACHEDELETE,{url:t.data.name});break;case"error":t.data.action===e._actions.CREATE&&r.Z.error(e.getLocaleString("cb.resourceDownload.error",{url:t.data.url}))}}))})),navigator.onLine&&new Promise((function(t,e){const n=document.documentElement.getAttribute("manifest")||"manifest.appcache";r.Z.ajax({url:r.Z.Util.addURLParameters(n,{ts:Date.now()}),method:"GET",responseType:"text"}).then((function(e){let n=e.data.normalize();r.Z.loadJS(!window.hex_md5,[r.Z.apiLocation+r.Z.Consts.url.HASH],(function(){var e=hex_md5(n),r=n.indexOf("NETWORK:");r>=0&&(n=n.substr(0,r)),(r=n.indexOf("FALLBACK:"))>=0&&(n=n.substr(0,r)),(r=n.indexOf("SETTINGS:"))>=0&&(n=n.substr(0,r));var o=n.split(/[\n\r]/).filter((function(t){return t.length>0&&0!==t.indexOf("#")&&"CACHE:"!==t}));o.shift(),t({hash:e,urls:o})}))})).catch((function(t){e(t)}))})).then((function(t){const n=e.LOCAL_STORAGE_KEY_PREFIX+e.ROOT_CACHE_NAME+".hash";var o;if(e.localStorage&&(o=e.localStorage.getItem(n)),o!==t.hash){const i=!o,a=e.cacheUrlList(t.urls),s=function(o){o.requestId===a&&(e.localStorage&&e.localStorage.setItem(n,t.hash),i||r.Z.confirm(e.getLocaleString("newAppVersionAvailable"),(function(){location.reload()})),e.off(r.Z.Consts.event.MAPCACHEDOWNLOAD,s))};e.on(r.Z.Consts.event.MAPCACHEDOWNLOAD,s)}}))}),(function(t){e.renderPromise().then((function(){const n=e.div.querySelector(`.${e.CLASS}-new`),o=document.createElement("div");o.classList.add("tc-alert","alert-warning");const i=document.createElement("p"),a=document.createElement("strong");a.innerHTML=e.getLocaleString("offlineMap.error"),i.appendChild(a);const s=document.createElement("p");s.innerHTML=t.message,o.appendChild(i),o.appendChild(s),n.querySelector(e._selectors.NEWBTN).classList.add(r.Z.Consts.classes.HIDDEN),n.appendChild(o)}))})).catch((()=>console.log("No SW available: no events handled"))),e.mapIsOffline&&(t.div.classList.add(r.Z.Consts.classes.OFFLINE),e._offlineMapHintDiv=r.Z.Util.getDiv(e.options.offlineMapHintDiv),e.options.offlineMapHintDiv||t.div.appendChild(e._offlineMapHintDiv),e.getRenderedHtml(e.CLASS+"-off-panel",{url:e.getOnlineMapUrl()},(function(t){if(e._offlineMapHintDiv.innerHTML=t,!navigator.onLine){const t=e._offlineMapHintDiv.querySelector(e._selectors.OFFPANEL);t.classList.add(r.Z.Consts.classes.CONNECTION_OFFLINE),t.classList.remove(r.Z.Consts.classes.CONNECTION_MOBILE,r.Z.Consts.classes.CONNECTION_WIFI)}e._offlineMapHintDiv.querySelector(e._selectors.EXIT).addEventListener(r.Z.Consts.event.CLICK,(function(t){r.Z.confirm(e.getLocaleString("offlineMapExit.confirm"),null,(function(){t.preventDefault()}))}))})));const o=e.getUID(),i=e.getUID();e.layerPromise=t.addLayer({id:i,type:r.Z.Consts.layerType.VECTOR,stealth:!0,owner:e,styles:{line:t.options.styles.line}}),e.layer=null,Promise.all([e.layerPromise,e.renderPromise(),t.addControl("draw",{id:o,div:e.div.querySelector(e._selectors.DRAW),mode:r.Z.Consts.geom.RECTANGLE,persistent:!1})]).then((function(n){const o=e.layer=n[0],i=e.boxDraw=n[2];i.setLayer(o),i.on(r.Z.Consts.event.DRAWSTART,(function(t){e.map.toast(e.getLocaleString("clickOnDownloadAreaOppositeCorner"),{type:r.Z.Consts.msgType.INFO})})).on(r.Z.Consts.event.DRAWEND,(function(n){var o=n.feature.geometry[0],i=o[0],s=o[2],c=Math.min(i[0],s[0]),u=Math.max(i[0],s[0]),p=Math.min(i[1],s[1]),d=Math.max(i[1],s[1]);e.setExtent([c,p,u,d]);const h=e._dialogDiv.querySelectorAll("input[type=checkbox]");h.forEach((function(n){const o=e.map.getLayer(n.value);for(var i=n;i&&"LI"!==i.tagName;)i=i.parentElement;if(o.wrap.getCompatibleMatrixSets(t.crs).includes(o.matrixSet)){const t=e.wrap.getRequestSchemas({extent:e.extent,layers:[o]})[0].tileMatrixLimits;i.classList.toggle(r.Z.Consts.classes.HIDDEN,!t.length)}else i.classList.add(r.Z.Consts.classes.HIDDEN)}));const f=e._dialogDiv.querySelector(e._selectors.BLLISTITEM+":not(."+r.Z.Consts.classes.HIDDEN+")");e._dialogDiv.querySelector(e._selectors.BLLISTTEXT).innerHTML=e.getLocaleString(f?"selectAtLeastOne":"cb.noMapsAtSelectedExtent"),a(e),l(e),r.Z.Util.showModal(e._dialogDiv.querySelector(e._classSelector+"-dialog"),{openCallback:function(){var t;if(setTimeout((function(){h.forEach((function(t){t.disabled=!1}))}),100),Date.prototype.toLocaleString){var n={};n.year=n.month=n.day=n.hour=n.minute=n.second="numeric",t=(new Date).toLocaleString(e.map.options.locale.replace("_","-"),n)}else t=(new Date).toString();e._dialogDiv.querySelector(e._selectors.NAMETB).value=t,e._updateReadyState()},closeCallback:function(){h.forEach((function(t){t.disabled=!0})),e.boxDraw.layer.clearFeatures()}})})),t.on(r.Z.Consts.event.CONTROLDEACTIVATE,(function(t){i===t.control&&e._state===e._states.EDITING&&e.setReadyState()}))}));var s=function(t){var n=!1;const o=e._dialogDiv.querySelector(e._selectors.BLLIST),i=function(){return!!o.querySelector('li[data-layer-uid="'+t.id+'"]')};var a=t.type===r.Z.Consts.layerType.WMTS&&!t.mustReproject;return r.Z.Util.detectSafari()&&r.Z.Util.detectIOS()&&(a=a&&r.Z.Util.isSameOrigin(t.url)),a&&!i()&&(n=!0,e.getRenderedHtml(e.CLASS+"-bl-node",t,(function(t){if(!i()){const e=new DOMParser;o.appendChild(e.parseFromString(t,"text/html").body.firstChild)}}))),n};const d=function(t){if(t.isBase&&e.mapIsOffline){const n=t.getResolutions();if(n){const r=n.filter((t=>t>=e.currentMapDefinition.res));r.length&&t.setResolutions(r)}}e.renderPromise().then((function(){s(t)}))};return t.on(r.Z.Consts.event.LAYERADD,(function(t){d(t.layer)})).on(r.Z.Consts.event.LAYERREMOVE,(function(t){e.renderPromise().then((function(){const n=t.layer;if(n.type===r.Z.Consts.layerType.WMTS){const t=e._dialogDiv.querySelector(e._selectors.BLLIST).querySelector('li[data-layer-uid="'+n.id+'"]');t.parentElement.removeChild(t)}}))})).on(r.Z.Consts.event.PROJECTIONCHANGE,(function(e){t.baseLayers.forEach((t=>d(t)))})),t.ready((function(){if(e.mapIsOffline){var n=[];e.offlineControls.forEach((function(e){e=e.substr(0,1).toUpperCase()+e.substr(1),n=n.concat(t.getControlsByClass("TC.control."+e))}));const o=e.getLocaleString("thisControlCannotBeUsedInOfflineMode");t.controls.forEach((function(t){n.indexOf(t)<0&&t.disable({reason:o})})),document.querySelectorAll(e._selectors.OFFLINEHIDDEN).forEach((function(t){t.classList.add(r.Z.Consts.classes.HIDDEN)}))}})),t.loaded((function(){if(e.layerPromise.then((function(e){t.putLayerOnTop(e)})),e.renderPromise().then((function(){e.div.querySelector(e._selectors.NEWBTN).disabled=!1,t.baseLayers.forEach(s)})),e.mapIsOffline){const n=e.currentMapDefinition,o=function(t,e){return(0===t.url.indexOf("//")?location.protocol+t.url:t.url)===n.url[e.urlIdx]&&t.layerNames===e.id&&t.matrixSet===n.tms[e.tmsIdx]},i=t.options.availableBaseLayers.filter((t=>t.type===r.Z.Consts.layerType.WMTS)).filter((t=>n.layers.some((e=>o(t,e))))).filter((e=>!t.baseLayers.some((t=>t.id===e.id))));Promise.all(i.map((e=>t.addLayer(r.Z.Util.extend({},e,{isBase:!0}))))).finally((function(){const i=[];for(var a=0,s=n.layers.length;a<s;a++)for(var l=0,c=t.baseLayers.length;l<c;l++){const e=t.baseLayers[l];if(e&&e.type===r.Z.Consts.layerType.WMTS&&o(e,n.layers[a])){i.push(e);break}}i.length&&t.setBaseLayer(i[0],(function(){for(var n=t.baseLayers.length-1;n>=0;n--){const e=t.baseLayers[n];e&&e.type!==r.Z.Consts.layerType.VECTOR&&!i.includes(e)&&t.removeLayer(e)}t.setExtent(e.currentMapExtent,{animate:!1})}))}))}})),e.on(r.Z.Consts.event.MAPCACHEDOWNLOAD,(function(n){e.isDownloading=!1;const o=function(t){const e=t.indexOf("#");return e>=0?t.substr(0,e):t}(n.url),i=c(e,o);i&&!e.serviceWorkerEnabled?(i.classList.remove(r.Z.Consts.classes.DISABLED),r.Z.alert(e.getLocaleString("cb.delete.error"))):e.currentMap&&o===e.currentMap.url&&(!function(t){const e=t.currentMap;u(t,e)&&(t.getRenderedHtml(t.CLASS+"-map-node",{name:e.name,url:e.url},(function(e){const n=new DOMParser;t.div.querySelector(t._selectors.LIST).appendChild(n.parseFromString(e,"text/html").body.firstChild),t.div.querySelector(t._selectors.EMPTYLIST).setAttribute("hidden","hidden"),t.div.querySelector(t._selectors.SEARCH).disabled=!1})),t.storedMaps.push(e))}(e),t.toast(e.getLocaleString("mapDownloaded",{mapName:e.currentMap.name}))),e.currentMap=null,e.setReadyState()})).on(r.Z.Consts.event.MAPCACHEDELETE,(function(n){e.isDownloading=!1;var r=p(e,n.url)||e.currentMap&&e.currentMap.name;e.currentMap=null,r&&t.toast(e.getLocaleString("mapDeleted",{mapName:r})),e.setReadyState()})).on(r.Z.Consts.event.MAPCACHEPROGRESS,(function(t){var n=t.total;!n&&e.requestSchemas&&(n=e.requestSchemas[0].tileCount);var r=t.loaded;r?e._loadedCount=r:(e._loadedCount+=1,r=e._loadedCount),e.showDownloadProgress(r,n)})).on(r.Z.Consts.event.MAPCACHEERROR,(function(t){e.isDownloading=!1,e.setReadyState();var n=e.getLocaleString("cb.mapCreation.error"),o=!0;switch(t.reason){case"quota":n+=". "+e.getLocaleString("cb.mapCreation.error.reasonQuota");break;case"resource":n+=". "+e.getLocaleString("cb.mapCreation.error.reasonResource");break;case"manifest":"410"==t.status&&p(e,t.url),o=!1;break;case"already_exists":n+=". "+e.getLocaleString("cb.mapCreation.error.reasonAlreadyExists")}o&&(r.Z.Util.detectIE()?(r.Z.error(n),r.Z.alert(e.getLocaleString("cb.mapCreation.error.reasonEdge"))):r.Z.alert(n)),e.currentMap=null})),n},t.setExtent=function(t){Array.isArray(t)&&t.length>=4&&(this.extent=t,this.updateRequestSchemas())},t._updateReadyState=function(){const t=this;t._dialogDiv.querySelector(t._selectors.OKBTN).disabled=!t.extent||0===t._dialogDiv.querySelector(t._selectors.NAMETB).value.length||t._dialogDiv.querySelector(t._selectors.RNGMAXRES).disabled},t.setReadyState=function(){const t=this;t._state=t._states.READY,t.showDownloadProgress(0,1),t.div.querySelector(t._selectors.DRAWING).classList.add(r.Z.Consts.classes.HIDDEN),t.div.querySelector(t._selectors.PROGRESS).classList.add(r.Z.Consts.classes.HIDDEN),t.div.querySelector(t._selectors.NEW).classList.remove(r.Z.Consts.classes.HIDDEN),t.div.querySelectorAll(t._selectors.LISTITEM).forEach((function(t){t.classList.remove(r.Z.Consts.classes.DISABLED)})),t._dialogDiv.querySelector(t._selectors.OKBTN).disabled=!0,t.div.querySelector(t._selectors.NEWBTN).disabled=!1,t._dialogDiv.querySelector(t._selectors.TILECOUNT).innerHTML="",t.extent=null,t._loadedCount=0,t.boxDraw&&t.boxDraw.cancel()},t.setEditState=function(){const t=this;t._state=t._states.EDITING,t.showDownloadProgress(0,1),t.div.querySelector(t._selectors.NEW).classList.add(r.Z.Consts.classes.HIDDEN),t.div.querySelector(t._selectors.PROGRESS).classList.add(r.Z.Consts.classes.HIDDEN),t.div.querySelector(t._selectors.DRAWING).classList.remove(r.Z.Consts.classes.HIDDEN),t.map.toast(t.getLocaleString("clickOnDownloadAreaFirstCorner"),{type:r.Z.Consts.msgType.INFO}),t._dialogDiv.querySelector(t._selectors.OKBTN).disabled=!0,t.div.querySelector(t._selectors.NEWBTN).disabled=!0,t._dialogDiv.querySelector(t._selectors.NAMETB).value="",t.boxDraw.activate()},t.generateCache=function(){const t=this,e={mapName:t._dialogDiv.querySelector(t._selectors.NAMETB).value};if(t.findStoredMap({name:e.mapName}))r.Z.alert(t.getLocaleString("cb.mapNameAlreadyExists.error",e));else{var n=function(){var n;t.div.querySelector(t._classSelector+"-name").innerHTML=e.mapName,t.map.toast(t.getLocaleString("downloadingMap",{mapName:e.mapName})),(n=t)._state=n._states.DOWNLOADING,r.Z.Util.closeModal(),n.showDownloadProgress(0,1),n.div.querySelector(n._selectors.NEW).classList.add(r.Z.Consts.classes.HIDDEN),n.div.querySelector(n._selectors.DRAWING).classList.add(r.Z.Consts.classes.HIDDEN),n.div.querySelector(n._selectors.PROGRESS).classList.remove(r.Z.Consts.classes.HIDDEN),n._dialogDiv.querySelector(n._selectors.OKBTN).disabled=!0,n.div.querySelector(n._selectors.NEWBTN).disabled=!0,n.layer.clearFeatures(),n.boxDraw.cancel(),t.requestCache(e)};navigator.storage&&navigator.storage.estimate?navigator.storage.estimate().then((function(o){const i=(o.quota-o.usage)/1048576;t.estimatedMapSize<i?n():r.Z.confirm(t.getLocaleString("cb.mapCreation.warning.reasonSize",{mapName:e.mapName,mapSize:s(t,t.estimatedMapSize),availableStorage:s(t,Math.round(i))}),n)})):n()}},t.cacheUrlList=function(t,e){var n=this,r=e||{};const o=Date.now().toString();return n.createCache(r.name||n.LOCAL_STORAGE_KEY_PREFIX+n.ROOT_CACHE_NAME,{requestId:o,urlList:t,silent:r.silent}),o},t.requestCache=function(t){var e=this,n=t||{};if(e.map){var o=n.extent||e.extent||e.map.getExtent();if(e.updateRequestSchemas({extent:o}),e.requestSchemas){var i=function(t,n,r){var o=t.res>=e.minResolution;return!o&&n>0&&(o=r[n-1].res>e.minResolution),o},a=function(t){return{mId:t.mId,cl:t.cl,cr:t.cr,rt:t.rt,rb:t.rb}},s=e.requestSchemas.map((function(t){return{layerId:t.layerId,tileMatrixSet:t.tileMatrixSet,tileMatrixLimits:t.tileMatrixLimits.filter(i)}})),l=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];s.forEach((function(t){const e=t.tileMatrixLimits[t.tileMatrixLimits.length-1],n=e.res*e.tSize;l[0]=Math.min(l[0],e.origin[0]+n*e.cl),l[1]=Math.min(l[1],e.origin[1]-n*(e.rb+1)),l[2]=Math.max(l[2],e.origin[0]+n*(e.cr+1)),l[3]=Math.max(l[3],e.origin[1]-n*e.rt),t.tileMatrixLimits=t.tileMatrixLimits.map(a)}));var c=Math.pow(10,e.map.wrap.isGeo()?r.Z.Consts.DEGREE_PRECISION:r.Z.Consts.METER_PRECISION),u={bBox:l=l.map((function(t,e){return(e<3?Math.ceil:Math.floor)(t*c)/c})),res:Math.floor(1e3*e.minResolution)/1e3,url:[],tms:[],format:[],layers:new Array(e.baseLayers.length)};e.baseLayers.forEach((function(t,e){var n=0===t.url.indexOf("//")?location.protocol+t.url:t.url,r=u.url.indexOf(n);r<0&&(r=u.url.push(n)-1);var o=u.tms.indexOf(t.matrixSet);o<0&&(o=u.tms.push(t.matrixSet)-1);var i=t.format.substr(t.format.indexOf("/")+1),a=u.format.indexOf(i);a<0&&(a=u.format.push(i)-1),u.layers[e]={urlIdx:r,id:t.layerNames,tmsIdx:o,formatIdx:a}}));var p=r.Z.Util.getQueryStringParams(),d=p[e.MAP_EXTENT_PARAM_NAME]=l.toString();p[e.MAP_DEFINITION_PARAM_NAME]=btoa(JSON.stringify(u)),e.serviceWorkerEnabled&&(p[e.SERVICE_WORKER_FLAG]=1);const t=location.origin+location.pathname+"?"+r.Z.Util.getParamString(p);if(e.currentMap={name:n.mapName,extent:d,url:t},e.isDownloading=!0,e.serviceWorkerEnabled){const n=[];for(var h=0,f=s.length;h<f;h++){for(var m=s[h],g=null,y=0,v=e.baseLayers.length;y<v;y++){var _=e.baseLayers[y];if(_.id===m.layerId){g=e.wrap.getGetTilePattern(_),_.getFallbackLayer&&_.getFallbackLayer(),_.thumbnail&&n.push(_.thumbnail);break}}if(g)for(var C=0,E=m.tileMatrixLimits.length;C<E;C++){const t=m.tileMatrixLimits[C];for(var w=t.rt;w<=t.rb;w++)for(var S=t.cl;S<=t.cr;S++)n.push(g.replace("{TileMatrixSet}",m.tileMatrixSet).replace("{TileMatrix}",t.mId).replace("{TileCol}",S).replace("{TileRow}",w))}}n.push(t),e.cacheUrlList(n,{name:t})}}}},t.cancelCacheRequest=function(){var t=this;t.currentMap&&t.deleteCache(t.currentMap.url).then((function(e){e||(t.currentMap=null)})),t.isDownloading=!1,t.setReadyState()},t.deleteMap=function(t){var e=this.findStoredMap({name:t});e&&this.deleteCache(e.url)},t.startDeleteMap=function(t){const e=this;if(navigator.onLine){if(t){var n=e.getLocaleString("cb.delete.confirm",{mapName:t});e.serviceWorkerEnabled||(n=n+" "+e.getLocaleString("cb.delete.confirm.connect.warning")),confirm(n)&&(navigator.onLine?((o=e)._state=o._states.DELETING,o.showDownloadProgress(0,1),o.div.querySelector(o._selectors.DRAWING).classList.add(r.Z.Consts.classes.HIDDEN),o.div.querySelector(o._selectors.PROGRESS).classList.add(r.Z.Consts.classes.HIDDEN),o.div.querySelector(o._selectors.NEW).classList.remove(r.Z.Consts.classes.HIDDEN),o.div.querySelectorAll(o._selectors.LISTITEM).forEach((function(t){t.classList.add(r.Z.Consts.classes.DISABLED)})),o._dialogDiv.querySelector(o._selectors.OKBTN).disabled=!0,o.div.querySelector(o._selectors.NEWBTN).disabled=!1,o._dialogDiv.querySelector(o._selectors.TILECOUNT).innerHTML="",o.boxDraw.cancel(),e.deleteMap(t)):r.Z.alert(e.getLocaleString("cb.delete.conn.alert")))}}else r.Z.alert(e.getLocaleString("cb.delete.conn.alert"));var o},t.findStoredMap=function(t){return this.storedMaps.filter((function(e){var n=!0;return t.name&&t.name!==e.name&&(n=!1),n&&t.url&&t.url!==e.url&&(n=!1),n}))[0]},t.showDownloadProgress=function(t,e){const n=this,o=n._classSelector,i=n.div.querySelector(o+"-progress-count");if(e){var a=Math.min(Math.round(100*t/e),100)+"%";const r=n.div.querySelector(o+"-progress-ratio");r&&(r.style.width=a),i&&(i.innerHTML=a)}else{const e=n.div.querySelector(o+"-progress-bar");e&&e.classList.add(r.Z.Consts.classes.HIDDEN),i&&(i.innerHTML=n.getLocaleString("xFiles",{quantity:t}))}},t.updateRequestSchemas=function(t){var e=this,n=t||{};return n.extent=n.extent||e.extent,n.layers=n.layers||e.baseLayers,e.requestSchemas=e.wrap.getRequestSchemas(n),e.requestSchemas},t.getResolutions=function(){var t=[];const e=function(t){return t.res},n=this.requestSchemas.map((function(t){return t.tileMatrixLimits.map(e)}));return t=t.concat.apply(t,n).sort(((t,e)=>e-t)).filter(((t,e,n)=>0===e||n[e-1]!==t))},t.getOnlineMapUrl=function(){const t=this,e=r.Z.Util.getQueryStringParams();delete e[t.MAP_DEFINITION_PARAM_NAME],delete e[t.MAP_EXTENT_PARAM_NAME],delete e[t.SERVICE_WORKER_FLAG];var n=r.Z.Util.getParamString(e);return n.length&&(n="?"+n),location.pathname+n+location.hash}}();const a=r.Z.control.OfflineMapMaker},5277:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var r,o=n(5361),i=n(2089),a=n(6498);o.Z.Consts=i.Z,o.Z.control=o.Z.control||{},o.Z.Control=a.Z,o.Z.control.OverviewMap=function(){var t=this;o.Z.Control.apply(t,arguments),t.isLoaded=!1,t.layer=null},o.Z.inherit(o.Z.control.OverviewMap,o.Z.Control),(r=o.Z.control.OverviewMap.prototype).CLASS="tc-ctl-ovmap",r.template={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){return'<div class="tc-ctl-ovmap-load tc-hidden"></div>'},useData:!0},r.register=function(t){const e=this,n=function(e){var n;return n=function(e){var n,r=function(t,e){for(var n=null,r=0;r<e.length;r++){var o=e[r];if((o.id||o)===t){n=o;break}}return n};if("string"==typeof e){var i=r(e,t.options.availableBaseLayers);o.Z.Util.isPlainObject(i)||(i=r(e,t.options.baseLayers)),o.Z.Util.isPlainObject(i)&&(n=new o.Z.layer.Raster(i))}else n=e instanceof o.Z.Layer?e:e.type===o.Z.Consts.layerType.VECTOR||e.type===o.Z.Consts.layerType.KML||e.type===o.Z.Consts.layerType.WFS?new o.Z.layer.Vector(e):new o.Z.layer.Raster(e);return n}(e),n},r=function(t){const e=this;if(e.map.baseLayer.type===o.Z.Consts.layerType.WMS||e.map.baseLayer.type===o.Z.Consts.layerType.WMTS||e.options.layer){var r=e.map.baseLayer.overviewMapLayer||e.options.layer;let i;e.layer.id!==r?i=n(r):o.Z.Consts.event.PROJECTIONCHANGE.includes(t.type)&&(i=e.layer),i&&e.wrap.reset({layer:i}).then((function(t){e.layer=t}))}};return new Promise((function(i,a){o.Z.Control.prototype.register.call(e,t).then((function(a){e.wrap=new o.Z.wrap.control.OverviewMap(e),t.loaded((function(){e.defaultLayer=n(e.options.layer),e.layer=n(t.baseLayer.overviewMapLayer||e.options.layer||t.options.baseLayers[0]||t.options.availableBaseLayers[0]),e.wrap.register(t),function(n){const r={};e.layer.getCapabilitiesPromise().then((function(){e.layer.isCompatible(t.crs)||0!==e.layer.wrap.getCompatibleMatrixSets(t.crs).length||(r.layer=e.layer.getFallbackLayer()),e.wrap.reset(r)}))}(t.crs),t.on(o.Z.Consts.event.PROJECTIONCHANGE+" "+o.Z.Consts.event.BASELAYERCHANGE,r.bind(e))})),i(a)})).catch((function(t){a(t)}))}))},r.loaded=function(t){var e=this;o.Z.Util.isFunction(t)&&(e.isLoaded&&e.map&&e.map.isLoaded?t():e.on(o.Z.Consts.event.MAPLOAD,t))},r.activate=function(){this.enable()},r.deactivate=function(){this.disable()},r.enable=function(){o.Z.Control.prototype.enable.call(this),this.wrap.enable()},r.disable=function(){o.Z.Control.prototype.disable.call(this),this.wrap.disable()};const s=o.Z.control.OverviewMap},8418:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>a});var r=n(5361),o=n(2089),i=n(8410);r.Z.control=r.Z.control||{},r.Z.Consts=o.Z,r.Z.control.GeometryFeatureInfo=i.default,r.Z.control.PolygonFeatureInfo=function(){var t=this;r.Z.control.GeometryFeatureInfo.apply(this,arguments),t.geometryType=r.Z.Consts.geom.POLYGON,t.style=r.Z.Util.extend(!0,{strokeColor:t.DEFAULT_STROKE_COLOR,strokeWidth:2,fillColor:"#000",fillOpacity:.3},t.options.style)},r.Z.inherit(r.Z.control.PolygonFeatureInfo,r.Z.control.GeometryFeatureInfo),r.Z.control.PolygonFeatureInfo.prototype.CLASS="tc-ctl-finfo";const a=r.Z.control.PolygonFeatureInfo},6200:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var r,o=n(5361),i=n(2089),a=n(6498);o.Z.Consts=i.Z,o.Z.control=o.Z.control||{},o.Z.Control=a.Z,o.Z.Consts.event.POPUP=o.Z.Consts.event.POPUP||"popup.tc",o.Z.Consts.event.POPUPHIDE=o.Z.Consts.event.POPUPHIDE||"popuphide.tc",o.Z.Consts.classes.DRAG=o.Z.Consts.classes.DRAG||"tc-drag",o.Z.Consts.classes.DRAGGED=o.Z.Consts.classes.DRAGGED||"tc-dragged",o.Z.Consts.classes.DRAGGABLE=o.Z.Consts.classes.DRAGGABLE||"tc-draggable",o.Z.control.Popup=function(){var t=this;o.Z.Control.apply(t,arguments),t.currentFeature=null,t.wrap=new o.Z.wrap.control.Popup(t)},o.Z.inherit(o.Z.control.Popup,o.Z.Control),(r=o.Z.control.Popup.prototype).CLASS="tc-ctl-popup",r.template={},r.template[r.CLASS]={1:function(t,e,n,r,o){return" tc-ctl-popup-has-btn"},3:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <button type="button" class="tc-ctl-popup-close tc-icon-btn" title="'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"close",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:76},end:{line:5,column:92}}}))+'"></button>\r\n'},5:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <button type="button" class="tc-ctl-popup-share tc-icon-btn" title="'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"shareQuery",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:76},end:{line:8,column:97}}}))+'"></button>\r\n'},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\ufeff<<div class="tc-ctl-popup">\r\n    <div class="tc-ctl-popup-content'+(null!=(i=s(n,"if").call(a,null!=e?s(e,"closeButton"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:36},end:{line:2,column:83}}}))?i:"")+'"></div>\r\n    <div class="tc-ctl-popup-menu">\r\n'+(null!=(i=s(n,"if").call(a,null!=e?s(e,"closeButton"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:4,column:8},end:{line:6,column:15}}}))?i:"")+(null!=(i=s(n,"if").call(a,null!=e?s(e,"shareButton"):e,{name:"if",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:7,column:8},end:{line:9,column:15}}}))?i:"")+"    </div>\r\n</div>"},useData:!0},r.render=function(t){const e=this;return e._set1stRenderPromise(new Promise((function(n,i){o.Z.Control.prototype.renderData.call(e,{closeButton:e.options.closeButton||void 0===e.options.closeButton,shareButton:e.options.share}).then((function(){e.popupDiv=e.div.querySelector(`.${r.CLASS}`),e.contentDiv=e.popupDiv.querySelector(`.${r.CLASS}-content`),e.menuDiv=e.popupDiv.querySelector(`.${r.CLASS}-menu`),e.addUIEventListeners(),e.map.wrap.addPopup(e).then((function(){o.Z.Util.isFunction(t)&&t(),n()}))})).catch((t=>i(t instanceof Error?t:Error(t))))})))},r.register=function(t){const e=this,n=o.Z.Control.prototype.register.call(e,t);return new Promise((function(r,i){Promise.all([n,e.renderPromise()]).then((function(){t.on(o.Z.Consts.event.VIEWCHANGE,(function(){t.view===o.Z.Consts.view.PRINTING&&e.isVisible()&&e.hide()})),t.on(o.Z.Consts.event.LAYERVISIBILITY,(function(t){e.currentFeature&&e.currentFeature.layer===t.layer&&!t.layer.getVisibility()&&e.isVisible()&&e.hide()})),t.on(o.Z.Consts.event.LAYERREMOVE+" "+o.Z.Consts.event.FEATURESCLEAR,(function(t){e.currentFeature&&e.currentFeature.layer===t.layer&&e.isVisible()&&e.hide()})),t.on(o.Z.Consts.event.UPDATE,(function(){e.currentFeature&&e.currentFeature._visibilityState!==o.Z.Consts.visibility.NOT_VISIBLE||e.isVisible()&&e.hide()})),t.on(o.Z.Consts.event.FEATUREREMOVE,(function(t){e.currentFeature===t.feature&&e.isVisible()&&e.hide()})),r(e)})).catch((function(t){i(t instanceof Error?t:Error(t))}))}))},r.addUIEventListeners=function(){const t=this,e=t.menuDiv.querySelector(`.${t.CLASS}-close`);e&&e.addEventListener(o.Z.Consts.event.CLICK,(function(){t.hide()}),{passive:!0});const n=t.menuDiv.querySelector(`.${t.CLASS}-share`);n&&n.addEventListener(o.Z.Consts.event.CLICK,(function(){t.caller&&t.caller.showShareDialog()}),{passive:!0})},r.fitToView=function(t){var e=this;t?setTimeout((function(){e.wrap.fitToView()}),1e3):e.wrap.fitToView()},r.hide=function(){var t=this;if(t.map){const e={control:t,feature:t.currentFeature};t.setDragged(!1),t.map.wrap.hidePopup(t),t.getContainerElement().innerHTML="",t.map.trigger(o.Z.Consts.event.POPUPHIDE,e)}},r.getContainerElement=function(){return this.contentDiv||null},r.getMenuElement=function(){return this.menuDiv||null},r.setDragged=function(t){const e=this;e.dragged=t,e.popupDiv&&e.popupDiv.classList.toggle(o.Z.Consts.classes.DRAGGED,!!t),e.wrap.setDragged(t)},r.setDragging=function(t){const e=this;t?(e.setDragged(!0),e.popupDiv.classList.add(o.Z.Consts.classes.DRAG)):e.popupDiv.classList.remove(o.Z.Consts.classes.DRAG)},r.isVisible=function(){return this.popupDiv&&this.popupDiv.classList.contains(o.Z.Consts.classes.VISIBLE)};const s=o.Z.control.Popup},3905:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>a});var r=n(5361),o=n(2089),i=n(6498);r.Z.Consts=o.Z,r.Z.control=r.Z.control||{},r.Z.Control=i.Z,r.Z.Consts.classes.PRINTABLE="tc-printable",r.Z.control.Print=function(t){const e=this;e.options=t||{},e.ready=!1,e.title=e.options.title||r.Z.Util.getLocaleString(r.Z.Cfg.locale,"printPage"),e.cssUrl=e.options.cssUrl||r.Z.apiLocation+"TC/css/print.css",e.options.target&&((e.options.printableElement||e.options.target).classList.add(r.Z.Consts.classes.PRINTABLE),e.render())},r.Z.inherit(r.Z.control.Print,r.Z.Control),function(){const t=r.Z.control.Print.prototype;t.CLASS="tc-ctl-print",t.template={},t.template[t.CLASS]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<a class="tc-icon-btn tc-ctl-print-btn" title="'+a(s(n,"i18n").call(i,"printThisContent",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:47},end:{line:1,column:74}}}))+'">'+a(s(n,"i18n").call(i,"print",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:76},end:{line:1,column:92}}}))+"</a>"},useData:!0},t.template[t.CLASS+"-page"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=t.lambda,s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<!DOCTYPE html>\r\n<html xmlns="http://www.w3.org/1999/xhtml">\r\n<head>\r\n    <title>'+s(a(null!=e?l(e,"title"):e,e))+'</title>\r\n    <link rel="stylesheet" href="'+s(a(null!=e?l(e,"cssUrl"):e,e))+'" />\r\n</head>\r\n<body onload="print()" class="tc-ctl-print-page">\r\n    <h1>'+s(a(null!=e?l(e,"title"):e,e))+"</h1>\r\n    "+(null!=(i=a(null!=e?l(e,"content"):e,e))?i:"")+"\r\n</body>\r\n</html>\r\n"},useData:!0},t.renderPrintPage=function(){const t=this,e=open(null,t.CLASS),n=(t.options.printableElement||t.options.target).innerHTML;t.getRenderedHtml(t.CLASS+"-page",{title:t.title,content:n,cssUrl:t.cssUrl}).then((function(t){e.document.write(t),e.document.close(),e.focus()})).catch((function(t){r.Z.error(t)}))},t.getRenderTarget=function(){return this.options.target||this.div},t.addUIEventListeners=function(){const t=this;if(t._mustAddListeners){const e=t.getRenderTarget();if(e){const n=e.querySelector("."+t.CLASS+"-btn");n&&(n.addEventListener("click",(function(e){t.renderPrintPage()})),delete t._mustAddListeners)}}},t.renderData=function(t,e){const n=this;return new Promise((function(o,i){if(n.div)r.Z.Control.prototype.renderData.call(n,t,e).then((()=>o())).catch((t=>i(t)));else{const t=n.getRenderTarget();t?n.getRenderedHtml(n.CLASS,null).then((function(i){t.querySelector("."+n.CLASS+"-btn")||(n._mustAddListeners=!0,t.insertAdjacentHTML("beforeend",i)),r.Z.Util.isFunction(e)&&e(),o()})):(r.Z.Util.isFunction(e)&&e(),o())}}))}}();const a=r.Z.control.Print},6145:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>l});var r=n(5361),o=n(2089),i=n(6498),a=n(2e3),s=n(1774);r.Z.tool=r.Z.tool||{},r.Z.tool.Proxification=s.Z,r.Z.Consts=o.Z,r.Z.control=r.Z.control||{},r.Z.Control=i.Z,r.Z.control.MapInfo=a.default,r.Z.control.PrintMap=function(){var t=this;r.Z.Control.apply(t,arguments)},r.Z.inherit(r.Z.control.PrintMap,r.Z.control.MapInfo),function(){var t=r.Z.control.PrintMap.prototype;t.CLASS="tc-ctl-prnmap";const e="portrait",o="landscape",i="A4",a="A3";var s={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:595,height:842},pageMargins:[29.5,14,29.5,22.5],content:[{columns:[{image:null,height:22,margin:[0,0,0,6]},{text:"",width:489,alignment:"center",margin:[0,10,0,0]},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:534,height:775.5}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,margin:[0,0,0,6]},{text:"",width:489,alignment:"center",margin:[0,10,0,0]},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:534,height:775.5}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]}},l={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:842,height:595},pageMargins:[30,14,30,22],content:[{columns:[{image:null,height:22,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:528}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:528}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]}},c={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:841.89,height:1190.55},pageMargins:[29.954,14,29.954,21.55],content:[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",width:489,margin:[0,10,0,0],alignment:"center"},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:1125}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",width:489,margin:[0,10,0,0],alignment:"center"},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:1125}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]}},u={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:1190.55,height:841.89},pageMargins:[28.775,14,28.775,14.89],content:[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:1131,height:783}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:1131,height:783}]]},layout:{paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}}}]}};const p=function(t,n){switch(t){case e:switch(n){case i:return s;case a:return c}break;case o:switch(n){case i:return l;case a:return u}break;default:return s}},d=function(t){return t.layoutPDF.content[0].columns[0]},h=function(t){return t.layoutPDF.content[0].columns[2]},f={sideLength:85};t.template={},t.template[t.CLASS]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lambda,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+a(l(n,"i18n").call(i,"print",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:4},end:{line:1,column:20}}}))+'</h2>\r\n<div>\r\n    <div class="tc-ctl-prnmap-div">\r\n        <div class="tc-group tc-ctl-prnmap-cnt">\r\n            <label>'+a(l(n,"i18n").call(i,"title",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:19},end:{line:5,column:35}}}))+':</label><input type="text" class="tc-ctl-prnmap-title tc-textbox" maxlength="30" placeholder="'+a(l(n,"i18n").call(i,"mapTitle",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:130},end:{line:5,column:149}}}))+'" />\r\n        </div>\r\n        <div class="tc-group tc-ctl-prnmap-cnt">\r\n            <label>'+a(l(n,"i18n").call(i,"layout",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:19},end:{line:8,column:36}}}))+':</label><select id="print-design" class="tc-combo">\r\n                <option value="landscape">'+a(l(n,"i18n").call(i,"landscape",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:42},end:{line:9,column:62}}}))+'</option>\r\n                <option value="portrait">'+a(l(n,"i18n").call(i,"portrait",{name:"i18n",hash:{},data:o,loc:{start:{line:10,column:41},end:{line:10,column:60}}}))+'</option>\r\n            </select>\r\n        </div>\r\n        <div class="tc-group tc-ctl-prnmap-cnt">\r\n            <label>'+a(l(n,"i18n").call(i,"size",{name:"i18n",hash:{},data:o,loc:{start:{line:14,column:19},end:{line:14,column:34}}}))+':</label><select id="print-size" class="tc-combo">\r\n                <option value="a4">A4</option>\r\n                <option value="a3">A3</option>\r\n            </select>\r\n        </div>\r\n        <div class="tc-group tc-ctl-prnmap-cnt tc-ctl-prnmap-cnt-btn">\r\n            <input id="tc-ctl-prnmap-image-qr-'+a(s(null!=e?l(e,"controlId"):e,e))+'" class="tc-hidden" type="checkbox" checked style="display:none;" />\r\n            <label for="tc-ctl-prnmap-image-qr-'+a(s(null!=e?l(e,"controlId"):e,e))+'" class="tc-ctl-prnmap-image-qr-label" title="'+a(l(n,"i18n").call(i,"createQrCodeToImage",{name:"i18n",hash:{},data:o,loc:{start:{line:21,column:106},end:{line:21,column:136}}}))+'">'+a(l(n,"i18n").call(i,"appendQRCode",{name:"i18n",hash:{},data:o,loc:{start:{line:21,column:138},end:{line:21,column:161}}}))+'</label>\r\n            <button type="button" class="tc-ctl-prnmap-btn tc-button tc-icon-button" title="'+a(l(n,"i18n").call(i,"printMap",{name:"i18n",hash:{},data:o,loc:{start:{line:22,column:92},end:{line:22,column:111}}}))+'">'+a(l(n,"i18n").call(i,"print",{name:"i18n",hash:{},data:o,loc:{start:{line:22,column:113},end:{line:22,column:129}}}))+'</button>\r\n        </div>\r\n        <div class="tc-group tc-ctl-prnmap-cnt">\r\n            <div class="tc-ctl-prnmap-alert tc-alert alert-warning tc-hidden">\r\n                <p>'+a(l(n,"i18n").call(i,"qrAdvice",!0,{name:"i18n",hash:{},data:o,loc:{start:{line:26,column:19},end:{line:26,column:43}}}))+"</p>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>"},useData:!0},t.template[t.CLASS+"-view"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){return'<div class="tc-ctl-prnmap-view tc-ctl-prnmap-view-left">    \r\n</div>\r\n<div class="tc-ctl-prnmap-view tc-ctl-prnmap-view-right">    \r\n</div>\r\n<div class="tc-ctl-prnmap-view tc-ctl-prnmap-view-bottom">    \r\n</div>'},useData:!0},t.template[t.CLASS+"-tools"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-prnmap-tools">\r\n    <div class="tc-ctl-prnmap-btn-pdf" title="'+a(s(n,"i18n").call(i,"printpdf",{name:"i18n",hash:{},data:o,loc:{start:{line:2,column:46},end:{line:2,column:65}}}))+'"></div>\r\n    <div class="tc-ctl-prnmap-btn-close" title="'+a(s(n,"i18n").call(i,"close",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:48},end:{line:3,column:64}}}))+'"></div>\r\n</div>    '},useData:!0};const m=function(){return this.map.workLayers.some((function(t){return t.type===r.Z.Consts.layerType.WMS&&t.getVisibility()}))},g=function(){return this.map.workLayers.some((function(t){if(t.type===r.Z.Consts.layerType.WMS&&t.getVisibility()){for(var e=0;e<t.names.length;e++)if(t.isVisibleByScale(t.names[e]))return!0;return!1}return!1}))};t.register=function(t){const n=this,o=r.Z.control.MapInfo.prototype.register.call(n,t);n.map.crossOrigin="anonymous";const i=function(){p(n.orientation||e,n.format.toString().toUpperCase()||"A4").reset()};return n.div.addEventListener("click",r.Z.EventTarget.listenerBySelector("."+n.CLASS+"-btn",(function(){n.map.setView(r.Z.Consts.view.PRINTING);var t=document.querySelector("."+n.CLASS+"-qrcode");const o=document.querySelector(`#${n.CLASS}-image-qr-${n.id}`);!o.disabled&&o.checked?(t||((t=document.createElement("div")).classList.add(n.CLASS+"-qrcode"),n.map.div.appendChild(t)),t.innerHTML="",n.makeQRCode(t,f.sideLength,f.sideLength)):t&&(t.innerHTML="");const a="."+n.CLASS+"-btn";n.map.on(r.Z.Consts.event.STARTLOADING,(function(){const t=n.div.querySelector(a);t.classList.add("disabled"),t.disabled=!0})),n.map.on(r.Z.Consts.event.STOPLOADING,(function(){const t=n.div.querySelector(a);t.classList.remove("disabled"),t.disabled=!1})),m.call(n)&&n.map.on(r.Z.Consts.event.ZOOM,i);const s=function(t){if(t){n.map.div.classList.add(t);var e=n.map.div.getBoundingClientRect();Number.isInteger(e.width)||(n.map.div.style.width=Math.round(e.width)+"px"),Number.isInteger(e.height)||(n.map.div.style.height=Math.round(e.height)+"px");const o=`calc(50% - ${e.width/2}px)`;if(n._viewDiv.querySelector(`.${n.CLASS}-view-left`).style.width=o,n._viewDiv.querySelector(`.${n.CLASS}-view-right`).style.width=o,n._viewDiv.querySelector(`.${n.CLASS}-view-bottom`).style.top=e.height+"px",n.map.toast(n.getLocaleString("print.advice.title")+": "+n.getLocaleString("print.advice.desc"),{type:r.Z.Consts.msgType.INFO,duration:7e3}),e=n.map.div.getBoundingClientRect(),window.screen.width<e.width){const t=window.screen.width/e.width,o=e.width/window.screen.width,i=document.querySelector('meta[name="viewport"]');n._viewportMeta=i.getAttribute("content"),i.setAttribute("content",`user-scalable=yes, initial-scale=${t}, minimum-scale=${t}`);const a=n.getToolsElement().style;n._toolsTransform=a.transform,n._toolsTransformOrigin=a.transformOrigin,a.transform=`scale(${o}, ${o})`,a.transformOrigin="100% 0%";const s=document.querySelector("."+r.Z.Consts.classes.TOAST_CONTAINER);if(s){const t=s.style;n._toastTransform=t.transform,n._toastTransformOrigin=t.transformOrigin,t.transform=`scale(${o}, ${o})`,t.transformOrigin="0% 100%"}}}n.map.wrap.map.updateSize()},l=function(){if(Object.prototype.hasOwnProperty.call(n,"_viewportMeta")){document.querySelector('meta[name="viewport"]').setAttribute("content",n._viewportMeta),delete n._viewportMeta;const t=n.getToolsElement().style;t.transform=n._toolsTransform,t.transformOrigin=n._toolsTransformOrigin,delete n._toolsTransform,delete n._toolsTransformOrigin;const e=document.querySelector("."+r.Z.Consts.classes.TOAST_CONTAINER);e&&(e.style.transform=n._toastTransform,e.style.transformOrigin=n._toastTransformOrigin),delete n._toastTransform,delete n._toastTransformOrigin}p(n.orientation||e,n.format.toString().toUpperCase()||"A4").reset(),m.call(n)&&n.map.off(r.Z.Consts.event.ZOOM,i),n.map.toastHide(n.getLocaleString("print.advice.title")+": "+n.getLocaleString("print.advice.desc")),n.map.div.classList.remove(n.currentFormat,n.CLASS+"-printing"),n.map.div.style.removeProperty("width"),n.map.div.style.removeProperty("height"),s(),n.map.setView(r.Z.Consts.view.DEFAULT),n._viewDiv.classList.add(r.Z.Consts.classes.HIDDEN)};n._viewDiv||(n._viewDiv=r.Z.Util.getDiv(),document.body.appendChild(n._viewDiv),n.getRenderedHtml(n.CLASS+"-view",null,(function(t){n._viewDiv.innerHTML=t})),n.getRenderedHtml(n.CLASS+"-tools",null,(function(t){n.map.div.insertAdjacentHTML("beforeend",t),n.map.div.querySelector("."+n.CLASS+"-btn-close").addEventListener("click",l),n.map.div.querySelector("."+n.CLASS+"-btn-pdf").addEventListener("click",n.createPdf.bind(n))}))),n.orientation=n.div.querySelector("#print-design").value,n.format=n.div.querySelector("#print-size").value,n.currentFormat=n.CLASS+"-"+n.orientation+"-"+n.format,n._viewDiv.classList.remove(r.Z.Consts.classes.HIDDEN),n.map.div.classList.add(n.CLASS+"-printing"),s(n.currentFormat)}))),n.div.addEventListener("click",r.Z.EventTarget.listenerBySelector(`#${n.CLASS}-image-qr-${n.id}`,(function(t){n.generateLink()}))),n.div.addEventListener("click",r.Z.EventTarget.listenerBySelector("h2",(function(t){n.registeredListeners||n.generateLink(),n.registerListeners()}))),o},t.render=function(t){const e=this;return e._set1stRenderPromise(r.Z.Control.prototype.renderData.call(e,{controlId:e.id},t))},t.createPdf=async function(){var t=this,o=t.map.getControlsByClass(r.Z.control.LoadingIndicator)[0],i=o.addWait();await n.e(746).then(n.t.bind(n,746,23));let a,s=await n.e(340).then(n.t.bind(n,3340,19));pdfMake.vfs=s.pdfMake.vfs,t.canvas=r.Z.Util.mergeCanvases(t.map.wrap.getCanvas());var l=p(t.orientation||e,t.format.toString().toUpperCase()||"A4"),c=l.layoutPDF;const u=function(e){var n=window.location.host+"_",a=t.div.querySelector("."+t.CLASS+"-title").value.trim();a?n+=a:n+=r.Z.Util.getFormattedDate((new Date).toString(),!0);try{pdfMake.createPdf(e).download(n.replace(/[\\\/:*?"<>\|]/g,"")+".pdf")}catch(e){t.map.toast(t.getLocaleString("print.error"),{type:r.Z.Consts.msgType.ERROR}),r.Z.error(e.message+"  "+e.stack,r.Z.Consts.msgErrorMode.EMAIL)}o.removeWait(i)},m=function(e){r.Z.error(t.getLocaleString("print.error")),r.Z.error("No se ha podido generar el base64 correspondiente a la imagen: "+e,r.Z.Consts.msgErrorMode.EMAIL,"Error en la impresión")},y=function(){var e=[],n=t.map.workLayers.filter((function(t){return t.type===r.Z.Consts.layerType.WMS&&t.getVisibility()})),o=[],i=function(t,e,n){var r,o;e.isVisibleByScale(t.name)&&(e.options&&e.options.params&&e.options.params.base64LegendSrc?o=e.options.params.base64LegendSrc:t.legend&&(r=t.legend.src),a.push({src:r,title:t.title,level:n,srcBase64:o}))},s=function(t,e,n,r){if(Array.isArray(t))for(var o=0;o<t.length;o++)s(t[o],e,n,r);else t&&Object.prototype.hasOwnProperty.call(t,"children")&&t.children.length>0&&((t.title||t.name)&&a.push({header:t.title||t.name,level:r}),s(t.children,e,n,++r));t&&Object.prototype.hasOwnProperty.call(t,"children")&&0===t.children.length&&(e.apply(this,[t,n,r]),r--)};return n.forEach((function(t){if(a=[],t.layerNames&&0!==t.layerNames.length){var e=t.options.hideTree;t.tree=null,t.options.hideTree=!0,s(t.getNestedTree(),i,t,0),t.options.hideTree=e,a.length>0&&o.push({title:t.title,layers:a})}})),new Promise((function(t,n){Promise.all(function(){for(var t=[],e=0;e<o.length;e++)for(var n=o[e].layers,i=0;i<n.length;i++)!function(e,n){var i=o[e].layers[n],a=i.src||i.srcBase64;a&&(r.Z.tool&&r.Z.tool.Proxification||r.Z.syncLoadJS(r.Z.apiLocation+"TC/tool/Proxification"),t.push(new Promise((function(t,e){new r.Z.tool.Proxification(r.Z.proxify,{allowedMixedContent:!0}).fetchImage(a,{exportable:!0}).then((function(e){if(e.complete){var n=r.Z.Util.imgTagToDataUrl(e,"image/png");i.image={base64:n.base64,canvas:n.canvas,height:e.height,width:e.width}}else m(a);t()}),(function(t){m(a),e(t)}))}))))}(e,i);return t}()).then((function(){o.map((function(t,e){return{groupIndex:e,height:t.layers.filter((function(t){return t.image&&t.image.canvas})).reduce((function(t,e,n,r){return t+r[n].image.canvas.height}),0)}})).sort((function(t,e){return t.height>e.height?1:t.height<e.height?-1:0})).forEach((function(t,n){!function(t,n){var r=[[{text:t.title,fontSize:13,style:["tablegroup"],margin:[0,n>0?10:0,0,2]}]];const o=(r=r.concat(t.layers.filter((function(e){return Object.prototype.hasOwnProperty.call(e,"header")&&e.header.trim().toLowerCase()!==t.title.trim().toLowerCase()})).map((function(t,e){return[{text:t.header.trim(),fontSize:Math.max(9,14-t.level),margin:[10*t.level,0,0,2]}]})))).length;var i=null,a=null;t.layers.forEach((function(t,e){if(t.header)i=t,a&&(a=null);else{var n;if(a||(a=1),i){var o=r.map((t=>t[0].text||"")).indexOf(i.header);n=o+a++}if(t.image){a++;var s=.75*t.image.width,l=.75*t.image.height;const e=[{ul:[{text:t.title,fontSize:Math.max(9,14-t.level),margin:[-10,0,0,5]},{image:t.image.base64,width:s,height:l,margin:[0,0,0,2]}],type:"none",margin:[10*t.level,0,0,2]}];n?r.splice(n,0,e):r.push(e)}else{const e=[{text:t.title,fontSize:11,margin:[10*t.level,0,0,2]}];n?r.splice(n,0,e):r.push(e)}}})),e.push({layout:"noBorders",table:{dontBreakRows:!0,keepWithHeaderRows:1,headerRows:o,body:r}})}(o[t.groupIndex],n)})),t(e)}),(function(){n([])}))}))},v=[function(){const e=function(){var t=d(l);return delete t.image,t.text="",t.width=0,t};return t.options.logo?r.Z.Util.imgToDataUrl(t.options.logo).then((function(t){const e=t.canvas,n=t.dataUrl;var r=d(l);return r.width||(r.width=e.width/e.height*r.height),r.image=n,r}),(function(){return m(t.options.logo),e()})):e()},function(){var e=function(t){return t.layoutPDF.content[0].columns[1]}(l);return e.text=t.div.querySelector("."+t.CLASS+"-title").value.trim(),e},function(){const e=function(){var t=h(l);return delete t.image,t.text="",t.width="auto",t};let n=t.map.getControlsByClass(r.Z.control.ScaleBar)[0];if(n){var o=document.getElementsByClassName("ol-scale-line-inner"),i=o[0].getBoundingClientRect();if(i){var a=getComputedStyle(o[0],null),s=parseInt(a.getPropertyValue("border-left-width").replace("px",""))||0,c=parseInt(a.getPropertyValue("border-right-width").replace("px",""))||0,u=h(l);return u.table={widths:[.75*((i.width>i.height?i.width:i.height)-s-c)],body:[[{border:[!0,!1,!0,!0],text:n.getText(),fontSize:10,alignment:"center"}]]},u.layout={paddingLeft:function(t,e){return 0},paddingRight:function(t,e){return 0},paddingTop:function(t,e){return 0},paddingBottom:function(t,e){return 0}},u}return e()}return e()},function(){const e=document.querySelector(`#${t.CLASS}-image-qr-${t.id}`);if(!e.disabled&&e.checked){const e=document.querySelector("."+t.CLASS+"-qrcode");return e.innerHTML="",t.makeQRCode(e,f.sideLength,f.sideLength).then((function(e){return e?r.Z.Util.addToCanvas(t.canvas,e,{x:t.canvas.width-f.sideLength,y:t.canvas.height-f.sideLength},{width:f.sideLength,height:f.sideLength}).then((function(t){return t})):t.canvas}))}return t.canvas}];Promise.all(v.map((function(t){return t()}))).then((function(n){if(n[2].table){const t=l.layoutPDF.pageSize.width-(l.layoutPDF.pageMargins[0]+l.layoutPDF.pageMargins[2]),e=l.layoutPDF.content[0].columns[0].width||0,n=l.layoutPDF.content[0].columns[2],r=n.table.widths[0]+2,o=l.layoutPDF.content[0].columns[1];o.width=t-e-r,0===e&&(o.alignment="left",n.margin[3]=2)}var r=function(t){return t.layoutPDF.content[1].table.body[0][0]}(l),o=n[3]||t.canvas;if(r.image=o.toDataURL(),g.call(t)&&2===c.content.length){const n=t.div.querySelector("."+t.CLASS+"-title").value.trim();c.content.push({pageBreak:"before",pageOrientation:t.options.legend&&t.options.legend.orientation||e,text:n.length>0?n:"",fontSize:14,margin:[0,20,0,10]}),c.styles={tablegroup:{bold:!0}},c.defaultStyle={alignment:"left"},y().then((function(t){c.content=c.content.concat(t),u(c)}))}else u(c)}))},t.manageMaxLengthExceed=function(t){const e=this,n=e.div.querySelector("."+e.CLASS+"-alert"),o=document.querySelector(`#${e.CLASS}-image-qr-${e.id}`);o.disabled=t.qr,o.checked?n.classList.toggle(r.Z.Consts.classes.HIDDEN,!t.qr):n.classList.add(r.Z.Consts.classes.HIDDEN)},t.generateLink=async function(){const t=this,e=t.div.querySelector(`.${t.CLASS}-div input[id|="${t.CLASS}-image-qr-${t.id}"]`),n=t.div.querySelector(`label[for="${e.id}"]`);e.disabled=!0,n.classList.add(r.Z.Consts.classes.LOADING);const o=await r.Z.control.MapInfo.prototype.generateLink.call(t);return n.classList.remove(r.Z.Consts.classes.LOADING),o},t.getToolsElement=function(){return this.map.div.querySelector(`.${this.CLASS}-tools`)}}();const l=r.Z.control.PrintMap},1926:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>a});var r=n(5361),o=n(2089),i=n(6498);r.Z.Consts=o.Z,r.Z.control=r.Z.control||{},r.Z.Control=i.Z,function(){r.Z.control.ProjectionSelector=function(){const t=this;r.Z.Control.apply(t,arguments),t._cssClasses={LOAD_CRS_BUTTON:t.CLASS+"-crs-btn-load",CRS_DIALOG:t.CLASS+"-crs-dialog",CRS_LIST:t.CLASS+"-crs-list",CURRENT_CRS_NAME:t.CLASS+"-cur-crs-name",CURRENT_CRS_CODE:t.CLASS+"-cur-crs-code",CHANGE:t.CLASS+"-change",NO_CHANGE:t.CLASS+"-no-change"},t._dialogDiv=r.Z.Util.getDiv(t.options.dialogDiv),window.$&&(t._$dialogDiv=$(t._dialogDiv)),t.options.dialogDiv||document.body.appendChild(t._dialogDiv),t._dialogDiv.addEventListener(r.Z.Consts.event.CLICK,r.Z.EventTarget.listenerBySelector("button:not(."+t._cssClasses.LOAD_CRS_BUTTON+")",(function(e){const n=e.target.dataset.crsCode;n&&t.setProjection({crs:n,allowFallbackLayer:!0})})),{passive:!0}),t._dialogDiv.addEventListener(r.Z.Consts.event.CLICK,r.Z.EventTarget.listenerBySelector("button."+t._cssClasses.LOAD_CRS_BUTTON,(function(){t.loadFallbackProjections()})),{passive:!0})},r.Z.inherit(r.Z.control.ProjectionSelector,r.Z.Control);const t=r.Z.control.ProjectionSelector.prototype;t.CLASS="tc-ctl-projs",t.render=function(t){const e=this,n=r.Z.Control.prototype.render.call(e,t);return e.getRenderedHtml(e.CLASS+"-dialog",null,(function(t){e._dialogDiv.innerHTML=t})),n},t.getAvailableCRS=function(t){return this.map.getCompatibleCRS(r.Z.Util.extend(t||{},{includeFallbacks:!0}))},t.showProjectionChangeDialog=function(t){const e=this,n=e._dialogDiv.querySelector("."+e._cssClasses.CRS_DIALOG),o=n.querySelector(".tc-modal-body");o.classList.add(r.Z.Consts.classes.LOADING);const i=o.querySelector("ul."+e._cssClasses.CRS_LIST);i.innerHTML="";const a=e.map.baseLayer.firstOption||e.map.baseLayer,s=a.isRaster()?a.getFallbackLayer():null,l=function(){var s=[],l=[];if(t=t||{},a.isRaster())l=a.getCompatibleCRS(),s=e.getAvailableCRS(r.Z.Util.extend(t,{}));else{l=e.map.baseLayers.filter((t=>t.isRaster())).map((t=>t.getCompatibleCRS({normalized:!0,includeFallback:!0}))).reduce(((t,e)=>t.concat(e.filter((e=>t.indexOf(e)<0)))));const n=(t.layer?e.map.workLayers.concat(t.layer):e.map.workLayers).filter((function(t){return t.isRaster()})).map((function(t){return t.getCompatibleCRS({normalized:!0,includeFallback:!0})}));s=l.filter((t=>n.every((e=>e.indexOf(t)>-1))))}e.map.loadProjections({crsList:s,orderBy:"name"}).then((function(t){var a=!1,s=n.querySelector("."+e._cssClasses.CURRENT_CRS_NAME),c=n.querySelector("."+e._cssClasses.CURRENT_CRS_CODE);if(t.forEach((function(t){if(s&&c&&r.Z.Util.CRSCodesEqual(e.map.crs,t.code))s.textContent=t.name,c.textContent=t.code;else{const e=document.createElement("button");e.setAttribute("type","button"),e.textContent=t.name+" ("+t.code+")",e.dataset.crsCode=t.code;const n=document.createElement("li");n.appendChild(e),0===l.filter((function(e){return r.Z.Util.CRSCodesEqual(e,t.code)})).length&&(a=!0,n.classList.add(r.Z.Consts.classes.HIDDEN),e.classList.add(r.Z.Consts.classes.WARNING)),i.appendChild(n)}})),a){const t=document.createElement("li"),n=document.createElement("button");n.setAttribute("type","button"),n.classList.add(e._cssClasses.LOAD_CRS_BUTTON),n.innerHTML=e.getLocaleString("showOnTheFlyProjections"),t.appendChild(n),i.appendChild(t)}if(0===i.querySelectorAll("li").length){const t=document.createElement("li");t.innerHTML=e.getLocaleString("thereAreNoCompatibleCRS"),i.appendChild(t)}const u=i.querySelectorAll("li:not(."+r.Z.Consts.classes.HIDDEN+")");n.querySelectorAll("."+e._cssClasses.CHANGE).forEach((function(t){t.style.display=u.length>1?"":"none"})),n.querySelectorAll("."+e._cssClasses.NO_CHANGE).forEach((function(t){t.style.display=u.length>1?"none":""})),n.querySelector("ul."+e._cssClasses.CRS_LIST).style.display=u.length>0||a?"":"none",o.classList.remove(r.Z.Consts.classes.LOADING)}))};s?s.getCapabilitiesPromise().then(l):l(),r.Z.Util.showModal(n,t)},t.setProjection=function(t){const e=this;t=t||{},r.Z.loadProjDef({crs:t.crs,callback:function(){e.map.setProjection(t)}})},t.loadFallbackProjections=function(){const t=this,e=t._dialogDiv.querySelector("."+t._cssClasses.CRS_DIALOG).querySelectorAll("ul."+t._cssClasses.CRS_LIST+" li");e.forEach((function(e){e.classList.remove(r.Z.Consts.classes.HIDDEN),e.querySelector("button."+t._cssClasses.LOAD_CRS_BUTTON)&&e.classList.add(r.Z.Consts.classes.HIDDEN)})),t._dialogDiv.querySelectorAll("p."+r.Z.Consts.classes.WARNING).forEach((function(t){t.classList.remove(r.Z.Consts.classes.HIDDEN)})),t._dialogDiv.querySelectorAll("."+t._cssClasses.CHANGE).forEach((function(t){t.style.display=e.length>1?"":"none"})),t._dialogDiv.querySelectorAll("."+t._cssClasses.NO_CHANGE).forEach((function(t){t.style.display=e.length>1?"none":""}))}}();const a=r.Z.control.ProjectionSelector},9158:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _TC__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5361),_Consts__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2089),_Control__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6498),_feature_Point__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(2391);_TC__WEBPACK_IMPORTED_MODULE_0__.Z.feature=_TC__WEBPACK_IMPORTED_MODULE_0__.Z.feature||{},_TC__WEBPACK_IMPORTED_MODULE_0__.Z.feature.Point=_feature_Point__WEBPACK_IMPORTED_MODULE_3__.Z,_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts=_Consts__WEBPACK_IMPORTED_MODULE_1__.Z,_TC__WEBPACK_IMPORTED_MODULE_0__.Z.control=_TC__WEBPACK_IMPORTED_MODULE_0__.Z.control||{},_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Control=_Control__WEBPACK_IMPORTED_MODULE_2__.Z,_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.event.DRAWCHART="drawchart.tc",_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.event.DRAWTABLE="drawtable.tc",_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.event.RESULTSPANELMIN="resultspanelmin.tc",_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.event.RESULTSPANELMAX="resultspanelmax.tc",_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.event.RESULTSPANELCLOSE="resultspanelclose.tc",_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.event.RESULTSPANELRESIZE="resultspanelresize.tc",_TC__WEBPACK_IMPORTED_MODULE_0__.Z.control.ResultsPanel=function(){var t=this;_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Control.apply(t,arguments),t.wrap=new _TC__WEBPACK_IMPORTED_MODULE_0__.Z.wrap.control.ResultsPanel(t),t.data={},t.classes={SHOW_IN:"showIn",SHOW_OUT:"showOut",RESIZABLE:"tc-resizable"},t.content=t.contentType.TABLE,_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.isEmptyObject(t.options)&&(t.options={content:"table"}),t.options,t.options.content&&(t.content=t.contentType[t.options.content.toUpperCase()]),t.options.chart&&(t.chart=t.options.chart),t.options.table&&(t.table=t.options.table),t.options.save&&(t.save=t.options.save),t.options.share&&(t.share=t.options.share)},_TC__WEBPACK_IMPORTED_MODULE_0__.Z.inherit(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.control.ResultsPanel,_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Control),function(){const ctlProto=_TC__WEBPACK_IMPORTED_MODULE_0__.Z.control.ResultsPanel.prototype;ctlProto.CLASS="tc-ctl-p-results",ctlProto.COLLIDING_PRIORITY={IGNORE:0,LOW:1,MEDIUM:2,HIGH:3},ctlProto.CHART_SIZE={MIN_HEIGHT:75,MAX_HEIGHT:128,MIN_WIDTH:215,MEDIUM_WIDTH:310,MAX_WIDTH:445},ctlProto.template={},ctlProto.template[ctlProto.CLASS]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="prpanel-group prsidebar-body " style="display: none" data-no-cb>\r\n    <div class="prpanel prpanel-default">\r\n        <div class="prpanel-heading">\r\n            <h4 class="prpanel-title">\r\n                <span class="prpanel-title-text"></span>\r\n                <button type="button" class="tc-icon-btn tc-ctl-p-results-share-btn" hidden title="'+a(s(n,"i18n").call(i,"shareQuery",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:99},end:{line:6,column:120}}}))+'">'+a(s(n,"i18n").call(i,"shareQuery",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:122},end:{line:6,column:143}}}))+'</button>\r\n                <button type="button" class="tc-icon-btn tc-ctl-p-results-dwn-btn prcollapsed-slide-submenu-dwn" hidden title="'+a(s(n,"i18n").call(i,"download",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:127},end:{line:7,column:146}}}))+'">'+a(s(n,"i18n").call(i,"download",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:148},end:{line:7,column:167}}}))+'</button>\r\n                <button type="button" class="tc-icon-btn tc-ctl-p-results-csv-btn prcollapsed-slide-submenu-csv" hidden title="'+a(s(n,"i18n").call(i,"export.excel",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:127},end:{line:8,column:150}}}))+'">'+a(s(n,"i18n").call(i,"export.excel",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:152},end:{line:8,column:175}}}))+'</button>\r\n                <button type="button" class="tc-icon-btn tc-ctl-p-results-min-btn prcollapsed-slide-submenu-min" title="'+a(s(n,"i18n").call(i,"hide",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:120},end:{line:9,column:135}}}))+'">'+a(s(n,"i18n").call(i,"hide",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:137},end:{line:9,column:152}}}))+'</button>\r\n                <button type="button" class="tc-icon-btn tc-ctl-p-results-close-btn prcollapsed-slide-submenu-close" title="'+a(s(n,"i18n").call(i,"close",{name:"i18n",hash:{},data:o,loc:{start:{line:10,column:124},end:{line:10,column:140}}}))+'">'+a(s(n,"i18n").call(i,"close",{name:"i18n",hash:{},data:o,loc:{start:{line:10,column:142},end:{line:10,column:158}}}))+'</button>\r\n            </h4>\r\n        </div>\r\n        <div id="results" class="prpanel-collapse collapse in">\r\n            <div class="tc-ctl-p-results-menu"></div>\r\n            <div class="prpanel-body list-group tc-ctl-p-results-info"></div>\r\n            <div class="prpanel-body list-group tc-ctl-p-results-table"></div>\r\n            <div class="prpanel-body list-group tc-ctl-p-results-chart"></div>\r\n        </div>\r\n        <div class="tc-ctl-p-results-resize-handler tc-resizable-grid-handlerRight"></div>\r\n        <div class="tc-ctl-p-results-resize-handler tc-resizable-grid-handlerBottom"></div>\r\n        <div class="tc-ctl-p-results-resize-handler tc-resizable-grid-handlerDiagonal"></div>\r\n    </div>\r\n</div>\r\n<div class="prcollapsed prcollapsed-max prcollapsed-pull-left" style="display: none;" title="'+a(s(n,"i18n").call(i,"expand",{name:"i18n",hash:{},data:o,loc:{start:{line:24,column:93},end:{line:24,column:110}}}))+'" data-no-cb>\r\n    <span class="prcollapsed-max-table tc-hidden"></span>\r\n    <span class="prcollapsed-max-chart tc-hidden"></span>\r\n</div>'},useData:!0},ctlProto.template[ctlProto.CLASS+"-table"]={1:function(t,e,n,r,o,i,a){var s,l=t.lambda,c=t.escapeExpression,u=null!=e?e:t.nullContext||{},p=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    <h4>"+c(l(null!=e?p(e,"tableTitle"):e,e))+'</h4>\r\n    <table class="table">            \r\n        <tbody>\r\n            <tr class="'+c(l(null!=(s=null!=e?p(e,"css"):e)?p(s,"trClass"):s,e))+'">\r\n'+(null!=(s=p(n,"each").call(u,null!=e?p(e,"columns"):e,{name:"each",hash:{},fn:t.program(2,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:7,column:16},end:{line:9,column:25}}}))?s:"")+"             </tr>\r\n"+(null!=(s=p(n,"each").call(u,null!=e?p(e,"results"):e,{name:"each",hash:{},fn:t.program(4,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:11,column:12},end:{line:16,column:21}}}))?s:"")+"        </tbody>\r\n    </table>\r\n"},2:function(t,e,n,r,o,i,a){var s,l=t.lambda,c=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <th class="'+c(l(null!=(s=null!=a[1]?u(a[1],"css"):a[1])?u(s,"thClass"):s,e))+'" data-order-field="'+c(l(e,e))+'" title="'+c(l(e,e))+'">'+c(l(e,e))+"</th>\r\n"},4:function(t,e,n,r,o,i,a){var s,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <tr class="'+t.escapeExpression(t.lambda(null!=(s=null!=a[1]?l(a[1],"css"):a[1])?l(s,"trClass"):s,e))+'">\r\n'+(null!=(s=l(n,"each").call(null!=e?e:t.nullContext||{},e,{name:"each",hash:{},fn:t.program(5,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:13,column:16},end:{line:15,column:25}}}))?s:"")},5:function(t,e,n,r,o,i,a){var s,l=t.lambda,c=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                    <td class="'+c(l(null!=(s=null!=a[2]?u(a[2],"css"):a[2])?u(s,"tdClass"):s,e))+'" title="'+c(l(e,e))+'">'+c(l(e,e))+"</td>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o,i,a){var s,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"\r\n"+(null!=(s=l(n,"if").call(null!=e?e:t.nullContext||{},null!=e?l(e,"results"):e,{name:"if",hash:{},fn:t.program(1,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:2,column:0},end:{line:19,column:7}}}))?s:"")},useData:!0,useDepths:!0},ctlProto.template[ctlProto.CLASS+"-chart"]={1:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    "+t.escapeExpression(t.lambda(null!=e?i(e,"msg"):e,e))+"\r\n"},3:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=a(n,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"secondChart"):e,{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.program(6,o,0),data:o,loc:{start:{line:5,column:4},end:{line:38,column:15}}}))?i:"")+'        <div class="tc-chart"></div>\r\n'},4:function(t,e,n,r,o){var i,a=t.lambda,s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <div class="tc-track-chart-elevation-minmax">\r\n        <div class="tc-track-chart-minmax">\r\n            <span>\r\n                Min,Max:&nbsp;\r\n            </span>\r\n            <div>\r\n                <span>\r\n                    '+s(a(null!=e?l(e,"min"):e,e))+", "+s(a(null!=e?l(e,"max"):e,e))+"\r\n                </span>\r\n                <span>\r\n                    "+s(a(null!=(i=null!=e?l(e,"secondChart"):e)?l(i,"min"):i,e))+", "+s(a(null!=(i=null!=e?l(e,"secondChart"):e)?l(i,"max"):i,e))+'&nbsp;\r\n                </span>\r\n            </div>\r\n        </div>\r\n        <div class="tc-track-chart-elevationGain">\r\n            <span>\r\n                '+s(l(n,"i18n").call(null!=e?e:t.nullContext||{},"geo.trk.chart.elevationGain",{name:"i18n",hash:{},data:o,loc:{start:{line:22,column:16},end:{line:22,column:54}}}))+":&nbsp;\r\n            </span>\r\n            <div>\r\n                <span>\r\n                    +"+s(a(null!=e?l(e,"upHill"):e,e))+" m, -"+s(a(null!=e?l(e,"downHill"):e,e))+" m\r\n                </span>\r\n                <span>\r\n                    +"+s(a(null!=(i=null!=e?l(e,"secondChart"):e)?l(i,"upHill"):i,e))+" m, -"+s(a(null!=(i=null!=e?l(e,"secondChart"):e)?l(i,"downHill"):i,e))+" m\r\n                </span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n"},6:function(t,e,n,r,o){var i=t.escapeExpression,a=t.lambda,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <span class="tc-track-chart-elevationGain">\r\n            '+i(s(n,"i18n").call(null!=e?e:t.nullContext||{},"geo.trk.chart.elevationGain",{name:"i18n",hash:{},data:o,loc:{start:{line:36,column:12},end:{line:36,column:50}}}))+": +"+i(a(null!=e?s(e,"upHill"):e,e))+" m, -"+i(a(null!=e?s(e,"downHill"):e,e))+" m\r\n        </span>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-track-chart">\r\n'+(null!=(i=a(n,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"msg"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(3,o,0),data:o,loc:{start:{line:2,column:4},end:{line:40,column:15}}}))?i:"")+"    </div>\r\n"},useData:!0};const isElementVisible=function(t){const e=getComputedStyle(t);return t&&!t.hidden&&"none"!==e.display&&"hidden"!==e.visibility};ctlProto.isVisible=function(){const t=this.div.querySelector(".prsidebar-body"),e=this.div.querySelector(".prcollapsed-max");return isElementVisible(t)||isElementVisible(e)},ctlProto.isMinimized=function(){const t=this.div.querySelector(".prsidebar-body"),e=this.div.querySelector(".prcollapsed-max");return isElementVisible(e)&&!isElementVisible(t)};const manageClassList=function(t,e,n){const r=this.div.querySelector("."+t);r&&(r.classList.add(e),r.classList.remove(n))};ctlProto.show=function(t){const e=this,n=e.div.querySelector("."+t);n&&"none"===n.style.display&&(n.style.display=""),manageClassList.call(e,t,e.classes.SHOW_IN,e.classes.SHOW_OUT)},ctlProto.hide=function(t){const e=this;manageClassList.call(e,t,e.classes.SHOW_OUT,e.classes.SHOW_IN);const n=e.div.querySelector("."+t);n&&(n.style.display="none")},ctlProto.doVisible=function(){this.div.classList.remove(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.classes.HIDDEN),this.show("prsidebar-body")};const hideResizeHandlers=function(t){document.querySelectorAll("."+t.CLASS+"-resize-handler").forEach((t=>{t.classList.add(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.classes.HIDDEN)}))};ctlProto.render=function(t){const e=this;return e.div.classList.add(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.classes.HIDDEN),_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Control.prototype.render.call(e,(function(){if(e.mainTitleElm=e.div.querySelector(".prpanel-title-text"),e.minimizeButton=e.div.querySelector(".prcollapsed-slide-submenu-min"),e.minimizeButton.addEventListener("click",(function(){e.minimize()})),e.closeButton=e.div.querySelector(".prcollapsed-slide-submenu-close"),e.closeButton.addEventListener("click",(function(){e.close();const t=e.div.querySelector("."+e.classes.RESIZABLE+".prpanel-default");t&&(t.style.removeProperty("width"),t.style.removeProperty("height"),delete t.dataset.chartSizeWidth,delete t.dataset.chartSizeHeight,delete t.dataset.panelSizeWidth,delete t.dataset.panelSizeHeight)})),e.maximizeButton=e.div.querySelector(".prcollapsed-max"),e.maximizeButton.addEventListener("click",(function(){e.maximize()})),e.save&&(e.saveButton=e.div.querySelector(".prcollapsed-slide-submenu-csv"),e.saveButton.addEventListener("click",(function(){e.exportToExcel()})),e.saveButton.removeAttribute("hidden")),e.options.download&&"table"===e.options.content&&(e.downloadButton=e.div.querySelector(".prcollapsed-slide-submenu-dwn"),e.downloadButton.addEventListener("click",(function(){_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.isFunction(e.options.download)&&e.options.download.apply(e,[])})),e.downloadButton.removeAttribute("hidden")),e.options.share&&(e.shareButton=e.div.querySelector("."+e.CLASS+"-share-btn"),e.shareButton.addEventListener("click",(function(){e.caller&&e.caller.showShareDialog()})),e.shareButton.removeAttribute("hidden")),e.content&&(e.content=e.content,e.options.titles?(e.options.titles.main&&(e.mainTitleElm.setAttribute("title",e.options.titles.main),e.mainTitleElm.innerHTML=e.options.titles.main),e.options.titles.max&&e.maximizeButton.setAttribute("title",e.options.titles.max)):(e.mainTitleElm.setAttribute("title",e.getLocaleString("rsp.title")),e.mainTitleElm.innerHTML=e.getLocaleString("rsp.title"))),e.infoDiv=e.div.querySelector("."+e.CLASS+"-info"),e.tableDiv=e.div.querySelector("."+e.CLASS+"-table"),e.menuDiv=e.div.querySelector("."+e.CLASS+"-menu"),_TC__WEBPACK_IMPORTED_MODULE_0__.Z.browserFeatures.touch()&&_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.swipe(e.div,{left:function(){e.minimize()}}),_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.detectMobile())hideResizeHandlers(e);else{const t=!(Object.prototype.hasOwnProperty.call(e.options,"resize")&&!e.options.resize);switch(!0){case"chart"===e.options.content&&t:case e.options.resize:case"table"===e.options.content&&e.infoDiv&&e.infoDiv.childElementCount>0&&t:e.resizable=!0,e.div.classList.add(e.classes.RESIZABLE);break;default:e.resizable=!1}}t&&"function"==typeof t&&t()}))},ctlProto.renderPanelResizable=function(t){const e=this;t=t||{},_TC__WEBPACK_IMPORTED_MODULE_0__.Z.loadJS(!window.interact,[_TC__WEBPACK_IMPORTED_MODULE_0__.Z.apiLocation+_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.url.INTERACTJS],(function(){const n="."+e.classes.RESIZABLE,r=t.target&&t.target.querySelector(".prpanel.prpanel-default")||document.querySelector(".prpanel.prpanel-default");if(!interact.isSet(n)){r.classList.add(e.classes.RESIZABLE),r.closest("."+e.CLASS).classList.add(e.classes.RESIZABLE);const o=document.querySelector(".tc-chart.c3 svg");o&&(o.parentElement.style.maxHeight="unset",o.removeAttribute("max-height"),o.removeAttribute("max-width"),o.removeAttribute("min-height"),o.removeAttribute("min-width"));interact(n).resizable({preserveAspectRatio:t.preserveAspectRatio||!0,edges:{right:".tc-ctl-p-results-resize-handler",bottom:".tc-ctl-p-results-resize-handler"},cursorChecker(t,e,n,r){let o="";return n.querySelectorAll(":hover").forEach((function(t){switch(!0){case t.classList.value.indexOf("tc-resizable-grid-handlerRight")>-1:o="w-resize";break;case t.classList.value.indexOf("tc-resizable-grid-handlerBottom")>-1:o="n-resize";break;case t.classList.value.indexOf("tc-resizable-grid-handlerDiagonal")>-1:o="nw-resize";break;default:o="pointer"}})),o},listeners:{end:function(t){e.onResize(t)},move(t){switch(!0){case"w-resize"===t.target.style.cursor:Object.assign(t.target.style,{width:`${t.rect.width}px`,height:`${t.target.getBoundingClientRect().height}px`});break;case"nw-resize"===t.target.style.cursor:Object.assign(t.target.style,{width:`${t.rect.width}px`,height:`${t.rect.height}px`});break;case"n-resize"===t.target.style.cursor:Object.assign(t.target.style,{width:`${t.target.getBoundingClientRect().width}px`,height:`${t.rect.height}px`})}t.target.querySelector(".tc-chart.c3")&&t.target.classList.add(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.classes.LOADING)}},modifiers:[interact.modifiers.restrict({restriction:"body"})]});t.callback&&_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.isFunction(t.callback)&&t.callback()}}))},ctlProto.getResizableChartSize=function(t){if(t){let e=t.querySelector(".tc-chart.c3").getBoundingClientRect();return{width:e.width,height:e.height}}},ctlProto.getResultsPanelFromElement=function(t){const e=this;let n=e.map.getControlsByClass(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.control.ResultsPanel);for(var r=0;r<n.length;r++)if(n[r].div.querySelector("."+e.classes.RESIZABLE+".prpanel-default")===t)return n[r];return null},ctlProto.onResize=function(t){const e=this,n=t.target;if(n.querySelector(".tc-chart.c3")){n.classList.remove(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.classes.LOADING);const t=e.getResizableChartSize(n);if(t){let r=e.getResultsPanelFromElement(n);r&&r.chart.chart.resize(t)}}e.map.trigger(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.event.RESULTSPANELRESIZE,{control:e,size:{width:n.getBoundingClientRect().width,height:n.getBoundingClientRect().height}})},ctlProto.minimize=function(){const t=this,e=t.div.querySelector(t.content.collapsedClass);e.classList.contains(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.classes.HIDDEN)&&(e.classList.remove(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.classes.HIDDEN),t.hide("prsidebar-body"),t.show("prcollapsed-max"),t.map.trigger(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.event.RESULTSPANELMIN,{control:t}))},ctlProto.maximize=function(){const t=this,e=t.div.querySelector(t.content.collapsedClass);e.classList.contains(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.classes.HIDDEN)||(e.classList.add(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.classes.HIDDEN),t.show("prsidebar-body"),t.hide("prcollapsed-max"),t.map.trigger(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.event.RESULTSPANELMAX,{control:t}))},ctlProto.close=function(){const t=this;if(t.div.classList.add(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.classes.HIDDEN),t.chart&&t.chart.chart){const e=t.div.querySelector("."+t.classes.RESIZABLE+".prpanel-default");if(e&&e.style&&e.style.width&&e.style.height){const t=e.querySelector(".tc-chart").getBoundingClientRect();parseInt(t.width)>0&&parseInt(t.height)>0&&(e.dataset.chartSizeWidth=t.width,e.dataset.chartSizeHeight=t.height),e.dataset.panelSizeWidth=e.style.width,e.dataset.panelSizeHeight=e.style.height}t.chart.chart=t.chart.chart.destroy()}const e=t.getContainerElement();if(e){e.style.display="none",t.div.querySelector(".prcollapsed-max").style.display="none",e.querySelectorAll("video,audio,iframe").forEach((t=>t.remove()));t.div.querySelector(t.content.collapsedClass).classList.add(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.classes.HIDDEN);let n=document.querySelector("."+t.classes.RESIZABLE);n&&(n.style=""),t.map.trigger(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.event.RESULTSPANELCLOSE,{control:t,feature:t.currentFeature})}},ctlProto.openChart=function(t){const e=this;e.onOpen(),e.div.classList.remove(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.classes.HIDDEN),e.map.getControlsByClass(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.control.ResultsPanel).filter((function(t){return t!==e})).filter((function(t){return"chart"===t.options.content})).forEach((function(t){t.close()})),t&&(t.msg?(e.map.toast(t.msg),e.isVisible()&&e.hide("prsidebar-body")):(e.elevationProfileChartData=t,e.renderElevationProfileChart({data:t,div:e.div.querySelector("."+ctlProto.CLASS+"-chart")})))};const formatYAxis=function(t,e){return(parseInt(t.toFixed(0))||0).toLocaleString(e)+" m"};ctlProto.renderElevationProfileChart=function(options){const self=this;options=options||{},_TC__WEBPACK_IMPORTED_MODULE_0__.Z.loadJS(!window.c3,_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.url.D3C3||_TC__WEBPACK_IMPORTED_MODULE_0__.Z.apiLocation+"lib/d3c3/d3c3.min.js",(function(){const data=options.data;data.ele=data.ele.map((t=>null===t?0:t));const div=options.div;let locale=_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.getMapLocale(self.map);var templateData={upHill:data.upHill?data.upHill.toLocaleString(locale):"0",downHill:data.downHill?data.downHill.toLocaleString(locale):"0"};const hasSecondaryElevationProfileChartData=data.secondaryElevationProfileChartData&&Array.isArray(data.secondaryElevationProfileChartData)&&data.secondaryElevationProfileChartData.length>0&&data.secondaryElevationProfileChartData[0];hasSecondaryElevationProfileChartData&&(templateData.min=formatYAxis(data.min,locale),templateData.max=formatYAxis(data.max,locale),templateData.secondChart={upHill:data.secondaryElevationProfileChartData[0].upHill?data.secondaryElevationProfileChartData[0].upHill.toLocaleString(locale):"0",downHill:data.secondaryElevationProfileChartData[0].downHill?data.secondaryElevationProfileChartData[0].downHill.toLocaleString(locale):"0",min:formatYAxis(data.secondaryElevationProfileChartData[0].min,locale),max:formatYAxis(data.secondaryElevationProfileChartData[0].max,locale)}),self.getRenderedHtml(ctlProto.CLASS+"-chart",templateData,(function(out){if(div.innerHTML=out,div.style.display="",self.options.titles){if(self.options.titles.main){const t=self.div.querySelector(".prpanel-title-text");t.setAttribute("title",self.options.titles.main),t.innerHTML=self.options.titles.main}self.options.titles.max&&self.div.querySelector(".prcollapsed-max").setAttribute("title",self.options.titles.max)}var legendOptions={show:!1};hasSecondaryElevationProfileChartData&&(legendOptions={position:"inset",inset:{anchor:"bottom-left",x:-55,y:-30,step:1}});let chartOptions=_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.extend({bindto:div.querySelector(".tc-chart"),padding:{top:13,right:15,bottom:0,left:45},legend:legendOptions},self.createChartOptions(data));const resizedTarget=self.div.querySelector("."+self.classes.RESIZABLE+".prpanel-default");resizedTarget&&resizedTarget.dataset.chartSizeWidth&&parseInt(resizedTarget.dataset.chartSizeWidth)>0&&resizedTarget.dataset.chartSizeHeight&&parseInt(resizedTarget.dataset.chartSizeHeight)>0&&(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.extend(chartOptions.size,{width:resizedTarget.dataset.chartSizeWidth,height:resizedTarget.dataset.chartSizeHeight}),resizedTarget.dataset.panelSizeWidth&&parseInt(resizedTarget.dataset.panelSizeWidth)>0&&resizedTarget.dataset.panelSizeHeight&&parseInt(resizedTarget.dataset.panelSizeHeight)>0&&(resizedTarget.style.width=resizedTarget.dataset.panelSizeWidth,resizedTarget.style.height=resizedTarget.dataset.panelSizeHeight)),self.chart.tooltip&&(chartOptions.tooltip={position:function(t,e,n,r){let o=document.querySelector(".c3-tooltip-container"),i=document.querySelector(".c3").getBoundingClientRect().left,a=document.querySelector(".c3 g.c3-axis-y").getBoundingClientRect().right,s=o.clientWidth,l=parseInt(d3.mouse(r)[0])+a-i-Math.floor(s/2),c=document.querySelector(".c3 g.c3-axis-x").getBoundingClientRect().height+2,u=o.querySelector(".onBottom");return u&&c&&(u.style.height=c+"px"),{top:0,left:l}},contents:function(d){var fn=self.chart.tooltip;return"function"!=typeof fn&&(fn=_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.getFnFromString(self.chart.tooltip)),fn.call(eval(self.chart.ctx),d)}}),self.chart&&self.chart.onmouseout&&(chartOptions.onmouseout=function(){var fn=self.chart.onmouseout;"function"!=typeof fn&&(fn=_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.getFnFromString(self.chart.onmouseout)),fn.call(eval(self.chart.ctx))}),chartOptions.onrendered=function(){_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.isFunction(chartOptions._onrendered)&&chartOptions._onrendered.call(this),self.map.trigger(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.event.DRAWCHART,{control:self,svg:this.svg[0][0],chart:this})},window.c3&&(c3._isOverriden||(window.c3.chart.internal.fn.generateDrawLine=function(t,e){var n=this,r=n.config,o=n.d3.svg.line(),i=n.generateGetLinePoints(t,e),a=e?n.getSubYScale:n.getYScale,s=function(t){return(e?n.subxx:n.xx).call(n,t)},l=function(t,e){return r.data_groups.length>0?i(t,e)[0][1]:a.call(n,t.id)(t.value)};return o=r.axis_rotated?o.x(l).y(s):o.x(s).y(l),r.line_connectNull||(o=o.defined((function(t){return null!=t.value}))),function(t){var i,s=r.line_connectNull?n.filterRemoveNull(t.values):t.values,l=e?n.x:n.subX,c=a.call(n,t.id),u=0,p=0;return n.isLineType(t)?r.data_regions[t.id]?i=n.lineWithRegions(s,l,c,r.data_regions[t.id]):(n.isStepType(t)&&(s=n.convertValuesToStep(s)),i=o.interpolate("linear")(s)):(s[0]&&(u=l(s[0].x),p=c(s[0].value)),i=r.axis_rotated?"M "+p+" "+u:"M "+u+" "+p),i||"M 0 0"}},window.c3.chart.internal.fn.generateDrawArea=function(t,e){var n=this,r=n.config,o=n.d3.svg.area(),i=n.generateGetAreaPoints(t,e),a=e?n.getSubYScale:n.getYScale,s=function(t){return(e?n.subxx:n.xx).call(n,t)},l=function(t,e){return r.data_groups.length>0?i(t,e)[0][1]:a.call(n,t.id)(0)},c=function(t,e){return r.data_groups.length>0?i(t,e)[1][1]:a.call(n,t.id)(t.value)};return o=r.axis_rotated?o.x0(l).x1(c).y(s):o.x(s).y0(l).y1(c),r.line_connectNull||(o=o.defined((function(t){return null!==t.value}))),function(t){var e,i=r.line_connectNull?n.filterRemoveNull(t.values):t.values,a=0,s=0;return n.isAreaType(t)?(n.isStepType(t)&&(i=n.convertValuesToStep(i)),e=o.interpolate("linear")(i)):(i[0]&&(a=n.x(i[0].x),s=n.getYScale(t.id)(i[0].value)),e=r.axis_rotated?"M "+s+" "+a:"M "+a+" "+s),e||"M 0 0"}},c3._isOverriden=!0),self.chart.chart=c3.generate(chartOptions))}))}))};const closeOpenedTableResultsPanel=function(){const t=this;t.map.getControlsByClass(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.control.ResultsPanel).filter((function(e){return e!==t&&e.isVisible()})).filter((function(t){return"chart"!==t.options.content})).forEach((function(t){t.close()}))};ctlProto.openTable=function(){var t=this;t.onOpen(),t.div.classList.remove(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.classes.HIDDEN);var e=arguments[0];if(e){var n;e.css&&(n=e.css);var r=e.callback,o=e.columns;if(e.data&&e.data.length>0){if(!o)for(var i in o=[],e.data[0])o.push(i);t.tableData={columns:o,results:e.data,css:n,callback:r,sort:e.sort?{}:null};var a=null;const s=(e,n,r)=>{var o=e;if(n){const i=t.tableData.results.map((function(t,e){return{index:e,properties:t}}));i.sort(((t,e)=>{const o=t.properties[n]||"",i=e.properties[n]||"";return r?"string"==typeof o?o.localeCompare(i):o<i?-1:o==i?0:1:"string"==typeof i?i.localeCompare(o):o<i?1:o==i?0:-1})),(o=Object.assign({},e,{results:i.map((function(t){return Object.assign({},t.properties,{index:t.index})}))})).sort={field:n,order:r}}t.getRenderedHtml(t.CLASS+"-table",o).then((function(n){const r=t.div.querySelector("."+t.CLASS+"-table"),i=r.parentElement;i.removeChild(r),r.innerHTML=n,i.appendChild(r),e.callback&&e.callback(r),o.sort&&r.querySelectorAll("thead th").forEach((t=>{t.addEventListener("click",(t=>{a=t.target.offsetParent.scrollLeft;const n=t.target.dataset.orderField||t.target.innerText;o.sort.field===n&&o.sort.order?s(e,n,!1):(o.sort.field!==n||o.sort.order,s(e,n,!0))}))})),closeOpenedTableResultsPanel.call(t),t.map.trigger(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.event.DRAWTABLE,{control:t}),a&&(r.scrollLeft=a)}))};s(t.tableData),t.div.querySelector("."+t.CLASS+"-chart").style.display="none",t.div.querySelector("."+t.CLASS+"-info").style.display="none",t.show("prsidebar-body")}}},ctlProto.open=function(t,e){const n=this;n.onOpen(),n.div.classList.remove(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.classes.HIDDEN);const r=e||n.div.querySelector("."+n.CLASS+"-table");n.requestIsRendered=window.requestAnimationFrame(function(){var t=r.getBoundingClientRect();t&&t.width>100&&(window.cancelAnimationFrame(this.requestIsRendered),this.map.trigger(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.event.DRAWTABLE,{control:n}))}.bind(n));const o=n.div.querySelector("."+n.CLASS+"-chart");o.style.display="none";const i=n.div.querySelector("."+n.CLASS+"-table");i.style.display="none";const a=n.div.querySelector("."+n.CLASS+"-info");a.style.display="none",t?e?(n.getTableContainer=function(){return e},e.innerHTML=t,e.style.display=""):(i.innerHTML=t,i.style.display=""):o.childElementCount?o.style.display="":i.childElementCount?i.style.display="":a.childElementCount&&(a.style.display="");const s=n.div.querySelector(".prcollapsed-max");if(n.options.titles){if(n.options.titles.main){const t=n.div.querySelector(".prpanel-title-text");t.setAttribute("title",n.options.titles.main),t.innerHTML=n.options.titles.main}n.options.titles.max&&s.setAttribute("title",n.options.titles.max)}n.options.classes&&n.options.classes.collapsed&&s.querySelector("span.prcollapsed-max-table").classList.add(n.options.classes.collapsed);const l=n.div.querySelector(n.content.collapsedClass);isElementVisible(l)&&n.maximize(),n.show("prsidebar-body"),n.hide("prcollapsed-max")},ctlProto.onOpen=function(){const t=this;t.resizable?t.renderPanelResizable({target:t.div,preserveAspectRatio:!0}):hideResizeHandlers(t)},ctlProto.loadDataOnChart=function(t){const e=this,n=function(){e.elevationProfileChartData=t,e.renderElevationProfileChart({data:t,div:e.div.querySelector("."+ctlProto.CLASS+"-chart")})};e.chart&&e.chart.chart?e.chart.chart.unload({done:n}):n()},ctlProto.createChartOptions=function(t){const e=this;var n={};const r=(t=t||{}).locale||_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.getMapLocale(e.map);if(t.chartType,null!=t.ele){const i=function(){const n=getComputedStyle(e.getContainerElement()),r=document.documentElement.clientWidth/100*40,o={height:r>445?t.maxHeight||e.CHART_SIZE.MAX_HEIGHT:t.minHeight||e.CHART_SIZE.MIN_HEIGHT};return n.width===getComputedStyle(e.map.div).width?o.width=.95*parseFloat(n.width):o.width=r>445?t.maxWidth||e.CHART_SIZE.MAX_WIDTH:r>310?t.mediumWidth||e.CHART_SIZE.MEDIUM_WIDTH:t.minWidth||e.CHART_SIZE.MIN_WIDTH,o},a=["grad"+_TC__WEBPACK_IMPORTED_MODULE_0__.Z.getUID()];let s=Number.NEGATIVE_INFINITY,l=Number.POSITIVE_INFINITY;t.ele.forEach((function(t){"number"==typeof t&&(s=Math.max(t,s),l=Math.min(t,l))}));let c=[...t.x],u=[...t.ele];n={data:{x:"x",columns:[["x"].concat(c),["ele"].concat(u)],types:{ele:"area-spline"},colors:{ele:"url(#"+a[0]+")"}},size:i(),point:{show:!1},axis:{x:{tick:{outer:!1,count:5,format:function(t){var e,n;return(t/=1e3)<1?(e=Math.round(1e3*t),n=" m"):(e=Math.round(100*t)/100,n=" km"),(e=e.toLocaleString(r))+n}}},y:{padding:{top:0,bottom:0},max:s,min:l,tick:{count:2,format:function(t){return formatYAxis(t,r)}}}},onresize:function(){let t,n=this.config.bindto.closest("."+e.classes.RESIZABLE+".prpanel-default");t=n?e.getResizableChartSize(n):i(),t&&this.api.resize(t)}};const p=t.secondaryElevationProfileChartData&&Array.isArray(t.secondaryElevationProfileChartData)&&t.secondaryElevationProfileChartData.length>0&&t.secondaryElevationProfileChartData[0];p&&(n.data.names={ele:e.getLocaleString("geo.profile.fromTrack"),ele2:e.getLocaleString("mdt")},n.data.columns.push(["ele2"].concat(t.secondaryElevationProfileChartData[0].ele)),n.data.types.ele2=n.data.types.ele,a.push("grad"+_TC__WEBPACK_IMPORTED_MODULE_0__.Z.getUID()),n.data.colors.ele2="url(#"+a[a.length-1]+")",n.data.axes={ele:"y"},u.every((t=>0===t))?(n.axis.y.min=t.secondaryElevationProfileChartData[0].min,n.axis.y.max=t.secondaryElevationProfileChartData[0].max):t.secondaryElevationProfileChartData[0].ele.every((t=>0===t))?(n.axis.y.min=Math.min(...u),n.axis.y.max=Math.max(...u)):(n.axis.y.min=Math.min(...u.concat(t.secondaryElevationProfileChartData[0].min)),n.axis.y.max=Math.max(...u.concat(t.secondaryElevationProfileChartData[0].max)))),t.time&&(n.time=("00000"+t.time.h).slice(-2)+":"+("00000"+t.time.m).slice(-2)+":"+("00000"+t.time.s).slice(-2));var o=!1;n._onrendered=function(){if(o||(o=!0,p&&(document.querySelectorAll(".c3-legend-item-tile").forEach((t=>{t.setAttribute("rx",5),t.setAttribute("ry",1)})),document.querySelectorAll(".c3-legend-item").forEach((t=>{var n=document.createElementNS("http://www.w3.org/2000/svg","title");n.textContent=e.getLocaleString("hide"),t.appendChild(n),t.addEventListener(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.event.CLICK,(function(){t.classList.contains(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.classes.HIDDEN)?t.querySelector("title").textContent=e.getLocaleString("hide"):t.querySelector("title").textContent=e.getLocaleString("show"),t.classList.toggle(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.classes.HIDDEN)}),{passive:!0})})))),!this.svg)return;const n=this.svg[0][0];var r=n.getElementsByTagName("defs")[0],i="http://www.w3.org/2000/svg";const s=function(t,e){var n=document.createElementNS(i,"linearGradient");n.setAttributeNS(null,"id",t),n.setAttributeNS(null,"x1","0%"),n.setAttributeNS(null,"x2","0%"),n.setAttributeNS(null,"y1","0%"),n.setAttributeNS(null,"y2","100%"),n.setAttributeNS(null,"gradientUnits","userSpaceOnUse");const o=document.createElementNS(i,"stop");o.setAttributeNS(null,"offset","0%"),o.setAttributeNS(null,"stop-color",e[0]),o.setAttributeNS(null,"stop-opacity","0.7"),n.appendChild(o);const a=document.createElementNS(i,"stop");a.setAttributeNS(null,"offset","50%"),a.setAttributeNS(null,"stop-color",e[1]),a.setAttributeNS(null,"stop-opacity","0.9"),n.appendChild(a);const s=document.createElementNS(i,"stop");s.setAttributeNS(null,"offset","100%"),s.setAttributeNS(null,"stop-color",e[2]),s.setAttributeNS(null,"stop-opacity","1"),n.appendChild(s),r.appendChild(n)};s(a[0],["red","orange","green"]),t.secondaryElevationProfileChartData&&s(a[a.length-1],["blue","cian","green"]);const l=d3.select(".c3-brush").node();l&&l.parentNode.removeChild(l),d3.select(".c3-event-rects,.c3-event-rects-single").selectAll("rect").style("cursor","pointer").on("click",(function(t){d3.event.stopPropagation();let n=e.elevationProfileChartData.coords[t.index];n&&(n=n.slice(0,2),e.map.crs!==e.map.options.utmCrs&&(n=_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.reproject(n,e.map.options.utmCrs,e.map.crs)),e.map.zoomToFeatures([new _TC__WEBPACK_IMPORTED_MODULE_0__.Z.feature.Point(n,{})]))}));const c=d3.select(".c3-axis.c3-axis-x").select("path");if(!c.empty()){let t=c.attr("d");if(/^M\d\,(\d)V\dH\d{3}V(\d)$/i.exec(t))t=t.replace(/(M\d\,)\d/i,"$10").replace(/(H\d{3}V)(\d)/i,"$10"),c.attr("d",t);else{/^M\s\d\s(\d)\sV\s\d\sH\s\d{3}\sV\s(\d)$/i.exec(t)&&(t=t.replace(/(M\s\d\s)\d/i,"$10").replace(/(H\s\d{3}\sV\s)(\d)/i,"$10"),c.attr("d",t))}}const u=n.getBoundingClientRect(),d={width:u.width,height:u.height};var h=function(){var t=d3.scale.ordinal().rangeRoundBands([0,d.width],.1,.3);d3.select(".c3-axis-x").selectAll("text:not(.c3-axis-x-label)").call((function(t,e){t.each((function(){t.each((function(t,e){if(0===e)return;const n=d3.select(this);if(1===n.node().childNodes.length){var r=n.select("tspan").node().cloneNode(),o=n.text().split(" ");n.select("tspan").text(o[0]),r.textContent=o[1];var i=r.getAttribute("dy");i=(i=i?parseFloat(r.getAttribute("dy")):.71)+.18+"em",r.setAttribute("dy",i),n.node().appendChild(r)}}))}))}),t.rangeBand())};const f=d3.select(".c3-axis-x").node().getBoundingClientRect();if(f.width){const t=d3.select(".c3-axis-y").node().getBoundingClientRect();(f.width>=d.width-t.width||100*f.width/(d.width-t.width)>90)&&h()}else{e.elevationChartLabelsRAF&&(window.cancelAnimationFrame(e.elevationChartLabelsRAF),e.elevationChartLabelsRAF=void 0);const t=function(){const n=d3.select(".c3-axis-x"),r=n.node();if(n.length&&!r)e.elevationChartLabelsRAF=requestAnimationFrame(t);else if(n.length&&r&&!r.getBoundingClientRect().width)e.elevationChartLabelsRAF=requestAnimationFrame(t);else{window.cancelAnimationFrame(e.elevationChartLabelsRAF),e.elevationChartLabelsRAF=void 0;const t=r.getBoundingClientRect(),n=d3.select(".c3-axis-y").node().getBoundingClientRect();(t.width>=d.width-n.width||100*t.width/(d.width-n.width)>90)&&h()}};e.elevationChartLabelsRAF=requestAnimationFrame(t)}d3.select("svg").select(".c3-chart-lines").selectAll(".c3-target-ele").each((function(){this.parentNode.appendChild(this)})),e.isMinimized()||(e.show("prsidebar-body"),e.hide("prcollapsed-max")),e.div.querySelector("."+e.CLASS+"-table").style.display="",e.div.querySelector("."+e.CLASS+"-info").style.display=""}}else n={msg:e.getLocaleString("geo.trk.chart.chpe.empty")};return n};const getTime=function(t,e){var n=e-t,r={},o=Math.floor(n/1e3/60/60/24);n-=1e3*o*60*60*24;var i=Math.floor(n/1e3/60/60);n-=1e3*i*60*60,r.h=i+24*o;var a=Math.floor(n/1e3/60);return n-=1e3*a*60,r.m=a,r.s=Math.floor(n/1e3),_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.extend({},r,{toString:("00000"+r.h).slice(-2)+":"+("00000"+r.m).slice(-2)+":"+("00000"+r.s).slice(-2)})};ctlProto.getElevationChartTooltip=function(t){const e=this,n=e.map.options.locale&&e.map.options.locale.replace("_","-")||void 0,r=e.elevationProfileChartData.coords,o=function(t){return t.value?parseInt(t.value.toFixed(0)).toLocaleString(n):"0"},i=r[t[0].index];let a;4===r[0].length&&r[0][3]>0&&i&&(a=getTime(r[0][3],i[3]));let s=t[0].x/1e3,l=(s<1?Math.round(1e3*s):Math.round(100*s)/100).toLocaleString(n)+(s<1?" m":" km");return'<div class="onTop"><span>'+t.map(((t,e)=>t?0===e?'<span data-isNumber class="'+("ele"===t.id?"original":"mdt")+'">'+o(t)+" m</span>":'<span data-isNumber class="'+("ele"===t.id?"original":"mdt")+'">'+o(t)+" m </span>":"")).join("")+"</span ></div>"+('<div class="onBottom"><span>'+l+" </span>"+(a?"<span>"+a.toString+"</span><div/>":"<div/>"))},ctlProto.getTableContainer=function(){return this.tableDiv},ctlProto.getInfoContainer=function(){return this.infoDiv},ctlProto.getMenuElement=function(){return this.menuDiv},ctlProto.getContainerElement=function(){return this.div.querySelector(".prsidebar-body")},ctlProto.register=function(t){const e=this,n=_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Control.prototype.register.call(e,t);return e.wrap.register(t),e.openOn&&e.map.one(e.openOn,(function(t,n){e.content.fnOpen.call(e,t.data)})),e.closeOn&&e.map.one(e.closeOn,(function(t,n){e.close()})),e.options.openOn&&e.map.on(e.options.openOn,(function(t,n){e.content.fnOpen.call(e,t.data)})),e.options.closeOn&&e.map.on(e.options.closeOn,(function(t,n){e.close()})),t.on(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.event.FEATUREREMOVE,(function(t){e.currentFeature===t.feature&&e.isVisible()&&e.close()})).on(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.event.FEATURESCLEAR+" "+_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Consts.event.LAYERREMOVE,(function(t){e.currentFeature&&e.currentFeature.layer===t.layer&&e.isVisible()&&e.close()})),n},ctlProto.exportToExcel=function(){const t=this;var e=[t.tableData.columns];t.tableData.results.forEach((function(t){var n=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&"Id"!==r&&"Geom"!==r&&n.push(t[r]);e.push(n)})),_TC__WEBPACK_IMPORTED_MODULE_0__.Z.loadJS(!_TC__WEBPACK_IMPORTED_MODULE_0__.Z.tool||!_TC__WEBPACK_IMPORTED_MODULE_0__.Z.tool.ExcelExport,_TC__WEBPACK_IMPORTED_MODULE_0__.Z.apiLocation+"TC/tool/ExcelExport",(function(){const n=new _TC__WEBPACK_IMPORTED_MODULE_0__.Z.tool.ExcelExport;var r=t.save.fileName?t.save.fileName:"resultados.xls",o=t.options.titles&&t.options.titles.main?t.options.titles.main:null;n.Save(r,e,o)}))},ctlProto.contentType={TABLE:{fnOpen:ctlProto.openTable,collapsedClass:".prcollapsed-max-table"},CHART:{fnOpen:ctlProto.openChart,collapsedClass:".prcollapsed-max-chart"}}}();const ResultsPanel=_TC__WEBPACK_IMPORTED_MODULE_0__.Z.control.ResultsPanel,__WEBPACK_DEFAULT_EXPORT__=ResultsPanel},2197:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>a});var r=n(5361),o=n(2089),i=n(6498);r.Z.Consts=o.Z,r.Z.control=r.Z.control||{},r.Z.Control=i.Z,function(){r.Z.control.SWCacheClient=function(){const t=this;r.Z.Control.apply(this,arguments),t.serviceWorkerEnabled=!1,t.serviceWorkerIsRequired=t.options.serviceWorkerIsRequired||!0},r.Z.inherit(r.Z.control.SWCacheClient,r.Z.Control);var t=r.Z.control.SWCacheClient.prototype;t.CLASS="tc-ctl-swcc",t.SW_URL="tc-cb-service-worker.js",t.register=function(t){const e=this,n=r.Z.Control.prototype.register.call(e,t);return e._swPromise=new Promise((function(t,n){navigator.serviceWorker?navigator.serviceWorker.register(e.SW_URL,{scope:"./"}).then((function(n){e.serviceWorkerEnabled=!0,n.installing?t(n.installing):n.waiting?t(n.waiting):n.active&&t(n.active),console.log(n.scope,"register")}),(function(t){e.serviceWorkerEnabled=!1,n(new Error(t)),console.error("Could not register service worker: "+t)})):n(new Error("Browser does not support service workers"))})),e._swPromise.catch((()=>{let n=!1;const o=window.parent!==window;for(var i=window;!n;i=i.parent){try{"https:"!==i.location.protocol&&(n=!0)}catch(t){}if(i===i.parent)break}n?t.toast(e.getLocaleString("httpsRequired.warning",{url:location.href.replace(location.protocol,"")}),{type:r.Z.Consts.msgType.WARNING}):o?t.toast(e.getLocaleString("frameOrNotCompatible.warning"),{type:r.Z.Consts.msgType.WARNING}):e.serviceWorkerIsRequired&&t.toast(e.getLocaleString("browserNotCompatible.warning"),{type:r.Z.Consts.msgType.WARNING})})),n},t.getServiceWorker=function(){return this._swPromise?this._swPromise:Promise.reject(new Error("No service worker available"))};var e=function(t,e,n,r,o){var i="message";navigator.serviceWorker.addEventListener(i,(function a(s){s.data.name===n&&(s.data.action===r&&s.data.event===o?t(n):"error"===s.data.event&&e(Error(`Error message from service worker [${s.data.url} - ${s.data.action} - ${s.data.name}]`)),"progress"!==s.data.event&&navigator.serviceWorker.removeEventListener(i,a))}))};t.createCache=function(t,n){var r=this;return new Promise((function(o,i){r.getServiceWorker().then((function(r){var a="create",s=n||{};e(o,i,t,a,"cached"),r.postMessage({action:a,name:t,requestId:s.requestId,list:s.urlList||[],silent:s.silent})}),(function(){o(!1)}))}))},t.deleteCache=function(t,n){var r=this;return new Promise((function(o,i){r.getServiceWorker().then((function(r){var a="delete",s=n||{};e(o,i,t,a,"deleted"),r.postMessage({action:a,requestId:s.requestId,name:t,silent:s.silent})}),(function(){o(!1)}))}))}}();const a=r.Z.control.SWCacheClient},9555:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var r,o=n(5361),i=n(2089),a=n(6498);o.Z.Consts=i.Z,o.Z.control=o.Z.control||{},o.Z.Control=a.Z,o.Z.Consts.SCREEN_SIZE_KEY="TC.Map.screenSize",o.Z.control.Scale=function(){o.Z.Control.apply(this,arguments)},o.Z.inherit(o.Z.control.Scale,o.Z.Control),(r=o.Z.control.Scale.prototype).CLASS="tc-ctl-scl",r.template={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="ol-scale-line ol-unselectable"><span>1:'+a(s(n,"round").call(i,null!=e?s(e,"scale"):e,{name:"round",hash:{},data:o,loc:{start:{line:1,column:51},end:{line:1,column:66}}}))+'</span> <input type="button" value="'+a(t.lambda(null!=e?s(e,"screenSize"):e,e))+"''\" title=\""+a(s(n,"i18n").call(i,"estimatedMapSize",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:127},end:{line:1,column:154}}}))+'" /></div>'},useData:!0},r.render=function(t){const e=this;return e._set1stRenderPromise(e.renderData({scale:e.getScale(),screenSize:o.Z.Cfg.screenSize},(function(){const n=e.div.querySelector("span");n.textContent="1:"+e.format(n.textContent.substr(2)),e.div.querySelector('input[type="button"]').addEventListener(o.Z.Consts.event.CLICK,(function(){e.setScreenSize()}),{passive:!0}),o.Z.Util.isFunction(t)&&t()})))},r.register=function(t){const e=this,n=o.Z.Control.prototype.register.call(e,t);var r=o.Z.Util.storage.getLocalValue(o.Z.Consts.SCREEN_SIZE_KEY);return r&&(o.Z.Cfg.screenSize=r),e.render((function(){t.on(o.Z.Consts.event.ZOOM,(function(){delete e.metersPerDegree,e.update()}))})),n},r.update=function(){this.render()},r.setScreenSize=function(){var t=this;o.Z.prompt(t.getLocaleString("selectScreenSize"),o.Z.Cfg.screenSize,(function(e){e&&(o.Z.Cfg.screenSize=parseFloat(e),o.Z.Util.storage.setLocalValue(o.Z.Consts.SCREEN_SIZE_KEY,o.Z.Cfg.screenSize),t.update())}))},r.getScale=function(t){var e=this,n=0,r=!t&&e.map?e.map.wrap.getResolution():t;if(r&&(n=r*e.getDpi(o.Z.Cfg.screenSize)/.0254,window.devicePixelRatio&&(n*=window.devicePixelRatio)),e.map&&e.map.wrap.isGeo()){if(!e.metersPerDegree){var i=e.map.getExtent();i&&(e.metersPerDegree=o.Z.Util.getMetersPerDegree(i))}e.metersPerDegree&&(n*=e.metersPerDegree)}return n},r.getDpi=function(t){return this.dpi=Math.sqrt(screen.width*screen.width+screen.height*screen.height)/t,this.dpi},r.format=function(t){for(var e=new Number(t).toFixed(0),n=[];e.length>3;){var r=e.length-3;n.unshift(e.substr(r)),e=e.substr(0,r)}return e&&n.unshift(e),n.join(".")};const s=o.Z.control.Scale},3068:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var r,o=n(5361),i=n(2089),a=n(6498);o.Z.Consts=i.Z,o.Z.control=o.Z.control||{},o.Z.Control=a.Z,o.Z.control.ScaleBar=function(){o.Z.Control.apply(this,arguments)},o.Z.inherit(o.Z.control.ScaleBar,o.Z.Control),(r=o.Z.control.ScaleBar.prototype).CLASS="tc-ctl-sb",r.render=function(){var t=this;return t.wrap||(t.wrap=new o.Z.wrap.control.ScaleBar(t)),t.wrap.render(),t._set1stRenderPromise(Promise.resolve())},r.register=function(t){const e=this;return new Promise((function(n,r){Promise.all([o.Z.Control.prototype.register.call(e,t),t.wrap.getMap()]).then((function(t){t[1].addControl(e.wrap.ctl),n(e)}))}))},r.getText=function(){return this.wrap.getText()};const s=o.Z.control.ScaleBar},7570:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var r,o=n(5361),i=n(2089),a=n(9555);o.Z.control=o.Z.control||{},o.Z.Consts=i.Z,o.Z.control.Scale=a.default,o.Z.control.ScaleSelector=function(){var t=this;o.Z.control.Scale.apply(t,arguments),t.scales=null},o.Z.inherit(o.Z.control.ScaleSelector,o.Z.control.Scale),(r=o.Z.control.ScaleSelector.prototype).CLASS="tc-ctl-ss",r.template={1:function(t,e,n,r,o){var i,a=t.escapeExpression,s=null!=e?e:t.nullContext||{},l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <option value="'+a(t.lambda(e,e))+'"'+(null!=(i=l(n,"if").call(s,l(n,"eq").call(s,e,null!=e?l(e,"scale"):e,{name:"eq",hash:{},data:o,loc:{start:{line:3,column:31},end:{line:3,column:43}}}),{name:"if",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:25},end:{line:3,column:68}}}))?i:"")+">1:"+a(l(n,"round").call(s,e,{name:"round",hash:{},data:o,loc:{start:{line:3,column:71},end:{line:3,column:82}}}))+"</option>\r\n"},2:function(t,e,n,r,o){return' selected="true"'},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="ol-scale-line ol-unselectable"><nobr><select>\r\n'+(null!=(i=l(n,"each").call(a,null!=e?l(e,"scales"):e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:0},end:{line:4,column:9}}}))?i:"")+'</select> <input type="button" value="'+s(t.lambda(null!=e?l(e,"screenSize"):e,e))+"''\" title=\""+s(l(n,"i18n").call(a,"estimatedMapSize",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:63},end:{line:5,column:90}}}))+'" /></nobr></div>'},useData:!0},r.render=function(t){var e=this;return e._set1stRenderPromise(new Promise((function(n,r){if(e.map){!e.scales&&e.map.options.resolutions&&(e.scales=e.map.options.resolutions.map(e.getScale,e));var i=function(){e.scales=e.map.wrap.getResolutions().map(e.getScale,e),e.renderData({scale:e.getScale(),screenSize:o.Z.Cfg.screenSize,scales:e.scales},(function(){e.div.querySelectorAll("option").forEach((function(t){t.textContent="1:"+e.format(t.textContent.substr(2))})),e.div.querySelector('input[type="button"]').addEventListener(o.Z.Consts.event.CLICK,(function(){e.setScreenSize()}),{passive:!0}),e.div.querySelector("select").addEventListener("change",(function(){e.setScale(this.value)})),o.Z.Util.isFunction(t)&&t(),n()})).catch((function(t){r(t instanceof Error?t:Error(t))}))};e.scales?i():e.map.wrap.getMap().then(i)}else r(Error("ScaleSelector no registrado"))})))},r.setScale=function(t){var e=this,n=.0254*t/e.getDpi(o.Z.Cfg.screenSize);return window.devicePixelRatio&&(n/=window.devicePixelRatio),e.metersPerDegree&&(n/=e.metersPerDegree),e.map.wrap.setResolution(n),n};const s=o.Z.control.ScaleSelector},907:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>p});var r=n(5361),o=n(2089),i=n(1468),a=n(6498),s=n(7901),l=n(4496),c=n(7364);r.Z.control=r.Z.control||{},r.Z.filter=l.Z,r.Z.UI=r.Z.UI||{},r.Z.UI.autocomplete=c.Z,r.Z.Defaults=i.k,r.Z.control.infoShare=s.default,r.Z.Control=a.Z,r.Z.Consts=o.Z,window.performance?window.performance&&!window.performance.now&&(window.performance.offset=Date.now(),window.performance.now=function(){return Date.now()-window.performance.offset}):window.performance={offset:Date.now(),now:function(){return Date.now()-this.offset}};const u=function(t,e,n){var o=this;o.parent=n,o._featureTypes=[],r.Z.Util.extend(o,e),o.typeName=t,o._throwConfigError=function(){throw new Error("Error en la configuración de la búsqueda: "+this.typeName)},o.getFeatureTypes=function(t){var e=this;if(t)return e.featureType instanceof Array?e.featureType:[e.featureType];if(0===e._featureTypes.length){var n=e.featureType instanceof Array?e.featureType:[e.featureType],r=e.renderFeatureType?e.renderFeatureType instanceof Array?e.renderFeatureType:[e.renderFeatureType]:[];e._featureTypes=n.concat(r)}return e._featureTypes},o.isFeatureOfThisType=function(t){return this.getFeatureTypes().indexOf(t)>-1},o.getStyleByFeatureType=function(t){var e=this;return e.getFeatureTypes().indexOf(t)>-1?e.styles[e.getFeatureTypes().indexOf(t)]:null};var i=function(t,e,n){var r=this,o=function(t,e,n){if(e){if(t.hasOwnProperty(e)&&t[e].hasOwnProperty(n))return t[e][n]}else for(var r in t)if(t[r].hasOwnProperty(n))return t[r][n]};if(n){return o(r.getStyleByFeatureType(n),e,t)}for(var i=0;i<r.styles.length;i++){const n=o(r.styles[i],e,t);if(n)return n}};o.getSuggestionListHead=function(){var t,e,n,r=this;if("function"==typeof r.suggestionListHead)t=r.suggestionListHead(),e=t.label,n=[{color:t.color,title:t.label}];else if(t=r.suggestionListHead,e=r.parent.getLocaleString(t.label),"string"==typeof t.color)n=[{color:i.call(r,t.color),title:e}];else if(t.color instanceof Array){var o=r.getFeatureTypes();t.color.length===o.length?n=t.color.map((function(t,n){return{color:i.call(r,t[o[n]].color.css,t[o[n]].color.geomType,o[n]),title:r.parent.getLocaleString(t[o[n]].title)||e}})):r._throwConfigError()}else"object"==typeof t.color&&(n=[{color:i.call(r,t.color.css,t.color.geomType),title:e}]);if(e&&n){var a='<li header><span class="header">'+e+"</span>";return a+=n.map((function(t){if(t.color)return'<span class="header-color" title="'+t.title+'" style="color: '+t.color+';"></span>'})).join("")+"</li>"}r._throwConfigError()},o.getSuggestionListElements=function(t){var e=this,n=[],r=function(t,e){switch(!0){case"number"==typeof t:if(t===e)return!0;break;case"string"==typeof t:if(isNaN(t)&&isNaN(e)){if(t.trim()===e.trim())return!0}else if(t===e)return!0}return!1},o=function(t){for(var e=[],n=0;n<t.length;n++)-1===e.indexOf(t[n])&&e.push(t[n]);return e};return e.parseFeatures(t).forEach((function(t){var i=[],a=[],s="",l=e.outputProperties,c=e.dataIdProperty,u=e.outputFormatLabel,p=t.id.split(".").slice(0,1).shift();e.outputProperties instanceof Array||(l=e.outputProperties[p],c=e.dataIdProperty[p],u=u[p]);for(var d=0;d<l.length;d++)i.push(t.data[l[d]]);for(d=0;d<c.length;d++)a.push(t.data[c[d]]);for(var h={},f=0;f<e.outputProperties.length;f++)h[e.outputProperties[f]]=i[f];i instanceof Array&&u&&o(i).length>1?s=u.tcFormat(i):i instanceof Array&&1===o(i).length&&(s=i[0]);var m=s.toCamelCase();(function(t){for(var e=0;e<n.length;e++){var o=0,i=[];for(var a in t)i.push(r(t[a],n[e].properties[a])),o++;if(i.filter((function(t){return t})).length===o)return!0}return!1})(h)||n.push({text:m,label:m,id:a.join("#"),dataRole:e.typeName,dataLayer:p,properties:h})})),n},o.parseFeatures=function(t){return(o.outputFormat===r.Z.Consts.format.JSON?new r.Z.wrap.parser.JSON:new r.Z.wrap.parser.WFS({featureNS:o.featurePrefix,featureType:o.featureType})).read(t)},o.getPattern=function(){var t=this;return"function"==typeof t.pattern?t.pattern():t.pattern},o.filter=function(t){const e=function(e,n){var r=[];if(n!=t.parent.rootCfg.active.root)if(-1!==n.indexOf("#")||t.parent.rootCfg.active.limit){const e=n.split("#");t.parent.rootCfg.active.dataIdProperty.forEach((function(n,o,i){0===o&&i.length>1&&r.push("<ogc:And>"),r.push(t.filter.getFilterNode(n,e.length>o?e[o]:e[0])),o===i.length-1&&i.length>1&&r.push("</ogc:And>")}))}else{var o=t.parent.rootCfg.active.queryProperties.firstQueryWord.map((function(e){return t.filter.getFilterNode(e,t.parent._LIKE_PATTERN+n+t.parent._LIKE_PATTERN)}));o.length>1?(r.push("<ogc:And>"),(r=r.concat(o)).push("</ogc:And>")):r=r.concat(o)}else t.parent.rootCfg.active.root.forEach((function(e,n,o){0===n&&o.length>1&&r.push("<ogc:Or>"),t.parent.rootCfg.active.dataIdProperty.forEach((function(n,o,i){0===o&&i.length>1&&r.push("<ogc:And>"),r.push(t.filter.getFilterNode(n,e.length>o?e[o]:e[0])),o===i.length-1&&i.length>1&&r.push("</ogc:And>")}))})),t.parent.rootCfg.active.root.length>1&&r.push("</ogc:Or>");return e.concat(r)};return{getPropertyValue:function(e,n){return t.getSearchTypeByRole(e)[n]},getIsLikeNode:function(e,n){var r=/([\-\"\.\xba\(\)\/])/g;return r.test(n)&&(n=n.replace(r,"\\$1")),n.toString().indexOf(t.parent._LIKE_PATTERN)>-1?'<Or><PropertyIsLike escape="\\" singleChar="_" wildCard="*" matchCase="false"><PropertyName>'+e+"</PropertyName><Literal>"+n.toLowerCase().replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+'</Literal></PropertyIsLike><PropertyIsLike escape="\\" singleChar="_" wildCard="*" matchCase="false"><PropertyName>'+e+"</PropertyName><Literal>"+n.toUpperCase().replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsLike></Or>":"<PropertyIsEqualTo><PropertyName>"+e+"</PropertyName><Literal>"+n.replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsEqualTo>"},getFunctionStrMatches:function(e,n){var r=/([\-\"\xba\(\)\/])/g;if(r.test(n)&&(n=n.replace(r,"\\$1")),n.toString().indexOf(t.parent._LIKE_PATTERN)>-1){var o=n;return'<ogc:PropertyIsEqualTo> <ogc:Function name="strMatches"> <ogc:PropertyName>'+e+"</ogc:PropertyName> <ogc:Literal>(?i)"+(o=(o=(o=(o=(o=o.replace(/a/gi,"[aáà]")).replace(/e/gi,"[eéè]")).replace(/i/gi,"[iíì]")).replace(/o/gi,"[oóò]")).replace(/u/gi,"[uúüù]")).replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</ogc:Literal> </ogc:Function> <ogc:Literal>true</ogc:Literal> </ogc:PropertyIsEqualTo>"}return"<PropertyIsEqualTo><PropertyName>"+e+"</PropertyName><Literal>"+n.replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsEqualTo>"},getFilterNode:function(e,n){var r,o=t.filter.getIsLikeNode;if(t.filterByMatch){o=t.filter.getFunctionStrMatches;var i=new RegExp("\\"+t.parent._LIKE_PATTERN,"gi");n=n.replace(i,t.parent._MATCH_PATTERN)}if(e instanceof Array||"string"==typeof e)return e instanceof Array&&e.length>1?(r="<ogc:Or>",e.forEach((t=>{r+=o(t.trim(),n)})),r+="</ogc:Or>"):o(e instanceof Array&&1===e.length?e[0].trim():e.trim(),n);var a=[];for(var s in e)if(e[s]instanceof Array&&e[s].length>1)r="<Or>",e[s].forEach((t=>{r+=o(t.trim(),n)})),r+="</Or>",a.push('(<Filter xmlns="http://www.opengis.net/ogc">'+r+"</Filter>)");else{var l=e[s];e[s]instanceof Array&&1===e[s].length&&(l=e[s][0]),a.push('(<Filter xmlns="http://www.opengis.net/ogc"><Or>'+o(l.trim(),n)+"</Or></Filter>)")}return a.join("")},getFilter:function(n){var o,i={};switch(i.multiL=!1,i.f="",!0){case t.typeName===r.Z.Consts.searchType.NUMBER:if(o=[],t.parent.rootCfg.active||!/(\<|\>|\<\>)/gi.exec(n.t)&&!/(\<|\>|\<\>)/gi.exec(n.s))t.parent.rootCfg.active?o=e(o,n.t):o.push(t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+n.t+t.parent._LIKE_PATTERN)),o.push(t.filter.getFilterNode(t.queryProperties.secondQueryWord,t.parent._LIKE_PATTERN+n.s+t.parent._LIKE_PATTERN));else{let r=/(\<|\>|\<\>)/gi.exec(n.t);r?o.push(t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+n.t.substring(0,n.t.indexOf(r[0])).trim()+t.parent._LIKE_PATTERN)):t.parent.rootCfg.active?o=e(o,n.t):o.push(t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+n.t+t.parent._LIKE_PATTERN)),r=/(\<|\>|\<\>)/gi.exec(n.s),r?o.push(t.filter.getFilterNode(t.queryProperties.secondQueryWord,t.parent._LIKE_PATTERN+n.s.substring(0,n.s.indexOf(r[0])).trim()+t.parent._LIKE_PATTERN)):o.push(t.filter.getFilterNode(t.queryProperties.secondQueryWord,t.parent._LIKE_PATTERN+n.s+t.parent._LIKE_PATTERN))}o.push(t.filter.getFilterNode(t.queryProperties.thirdQueryWord,n.p+t.parent._LIKE_PATTERN)),i.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+o.join("")+"</ogc:And></ogc:Filter>";break;case t.typeName===r.Z.Consts.searchType.STREET:if(o=[],t.parent.rootCfg.active||!/(\<|\>|\<\>)/gi.exec(n.t)&&!/(\<|\>|\<\>)/gi.exec(n.s))t.parent.rootCfg.active?o=e(o,n.t):o.push(t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+n.t+t.parent._LIKE_PATTERN)),o.push(t.filter.getFilterNode(t.queryProperties.secondQueryWord,t.parent._LIKE_PATTERN+n.s+t.parent._LIKE_PATTERN));else{let r=/(\<|\>|\<\>)/gi.exec(n.t);r?o.push(t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+n.t.substring(0,n.t.indexOf(r[0])).trim()+t.parent._LIKE_PATTERN)):t.parent.rootCfg.active?o=e(o,n.t):o.push(t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+n.t+t.parent._LIKE_PATTERN)),r=/(\<|\>|\<\>)/gi.exec(n.s),r?o.push(t.filter.getFilterNode(t.queryProperties.secondQueryWord,t.parent._LIKE_PATTERN+n.s.substring(0,n.s.indexOf(r[0])).trim()+t.parent._LIKE_PATTERN)):o.push(t.filter.getFilterNode(t.queryProperties.secondQueryWord,t.parent._LIKE_PATTERN+n.s+t.parent._LIKE_PATTERN))}i.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+o.join("")+"</ogc:And></ogc:Filter>";break;case t.typeName===r.Z.Consts.searchType.LOCALITY:i.f=t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+n.t+t.parent._LIKE_PATTERN),i.multiL=!0;break;case t.queryProperties.hasOwnProperty("secondQueryWord"):(o=[]).push(t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+n.t+t.parent._LIKE_PATTERN)),o.push(t.filter.getFilterNode(t.queryProperties.secondQueryWord,t.parent._LIKE_PATTERN+n.s+t.parent._LIKE_PATTERN)),i.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+o.join("")+"</ogc:And></ogc:Filter>";break;default:i.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc">'+t.filter.getFilterNode(t.queryProperties.firstQueryWord,t.parent._LIKE_PATTERN+n.t+t.parent._LIKE_PATTERN)+"</ogc:Filter>"}return i},getParams:function(e){var n=t.filter.getFilter(e),o={REQUEST:"GetFeature",SERVICE:"WFS",MAXFEATURES:500,VERSION:t.version,OUTPUTFORMAT:t.outputFormat},i=t.getFeatureTypes(!0);if(i instanceof Array){var a=i.map((e=>t.featurePrefix?t.featurePrefix+":"+e.trim():e.trim()));o.TYPENAME=a.join(",")}else o.TYPENAME=t.featurePrefix?t.featurePrefix+":"+i.trim():i.trim();var s=function(t){if(""!==(t||"")){if(t instanceof Array)return t.join(",");var e=[];if(t instanceof Object)for(var n in t){var r=t[n][0];t[n].length>1&&(r=t[n].join(",")),e.push(r)}return e}},l=s(t.outputProperties),c=s(t.dataIdProperty);const u=t=>{const e=t.split(",");return e.filter(((t,n)=>e.indexOf(t)===n)).join(",")};if(l instanceof Array&&c instanceof Array){o.PROPERTYNAME="";for(var p=0;p<l.length;p++)o.PROPERTYNAME+="("+u(l[p]+","+c[p])+")"}else o.PROPERTYNAME=u(l+","+c);return o.FILTER=n.f,r.Z.Util.getParamString(o)},getGoToFilter:function(e){var n=[],r=e.split("#"),o=t.dataIdProperty,i=t.getFeatureTypes();if(o&&i)if(e.indexOf("#")>-1&&i instanceof Array&&i.length>1)i.forEach((t=>{o[t].forEach(((t,e)=>{n.push({name:t,value:r[e]})}))}));else if(-1===e.indexOf("#")&&i instanceof Array){let t=o;i.forEach((e=>{n.hasOwnProperty(e)||(t instanceof Object&&o.hasOwnProperty(e)&&(t=o[e]),t.forEach(((t,e)=>{e<r.length&&n.push({name:t,value:r[e]})})))}))}else o instanceof Object&&o.hasOwnProperty(i)&&(o=o[i]),o.forEach(((t,e)=>{n.push({name:t,value:r[e]})}));return t.filter.transformFilter(n)},transformFilter:function(t){if(r.Z.filter||r.Z.syncLoadJS(r.Z.apiLocation+"TC/Filter"),t&&t instanceof Array){var e=t.map((function(t){return t.hasOwnProperty("type")?!0==(t.type===r.Z.Consts.comparison.EQUAL_TO)?new r.Z.filter.equalTo(t.name,t.value):void 0:new r.Z.filter.equalTo(t.name,t.value)}));return e.length>1?r.Z.filter.and.apply(null,e):e[0]}}}}(o)};r.Z.control.Search=function(){var t=this;if(r.Z.Control.apply(t,arguments),t._dialogDiv=r.Z.Util.getDiv(t.options.dialogDiv),t.options.dialogDiv||document.body.appendChild(t._dialogDiv),t.exportsState=!0,r.Z.Consts.event.TOOLSCLOSE=r.Z.Consts.event.TOOLSCLOSE||"toolsclose.tc",t.url="//idena.navarra.es/ogc/wfs",t.version="1.1.0",t.featurePrefix="IDENA",t.options&&t.options.url&&(t.url=t.options.url),t._LIKE_PATTERN="*",t._MATCH_PATTERN=".*",t.UTMX="X",t.UTMY="Y",t.LON="Lon",t.LAT="Lat",t.UTMX_LABEL="X: ",t.UTMY_LABEL="Y: ",t.LON_LABEL="Lon: ",t.LAT_LABEL="Lat: ",t.MUN="Mun",t.POL="Pol",t.PAR="Par",t.MUN_LABEL="Mun: ",t.POL_LABEL="Pol: ",t.PAR_LABEL="Par: ",t._search={data:[]},t.EMPTY_RESULTS_LABEL=t.getLocaleString("noResults"),t.EMPTY_RESULTS_TITLE=t.getLocaleString("checkCriterion"),t.OUTBBX_LABEL=t.getLocaleString("outsideOfLimits"),t.WFS_TYPE_ATTRS=["url","version","geometryName","featurePrefix","featureType","properties","outputFormat"],t.availableSearchTypes={},t.availableSearchTypes[r.Z.Consts.searchType.CADASTRAL]={suggestionRoot:null,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:r.Z.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",searchWeight:3,featureType:["CATAST_Pol_ParcelaUrba","CATAST_Pol_ParcelaRusti","CATAST_Pol_ParcelaMixta"],municipality:{featureType:"CATAST_Pol_Municipio",labelProperty:"MUNICIPIO",idProperty:"CMUNICIPIO"},queryProperties:{firstQueryWord:"CMUNICIPIO",secondQueryWord:"POLIGONO",thirdQueryWord:"PARCELA"},suggestionListHead:{label:"search.list.cadastral",color:[{CATAST_Pol_ParcelaUrba:{title:"search.list.cadastral.urban",color:{geomType:"polygon",css:"strokeColor"}}},{CATAST_Pol_ParcelaRusti:{title:"search.list.cadastral.rustic",color:{geomType:"polygon",css:"strokeColor"}}},{CATAST_Pol_ParcelaMixta:{title:"search.list.cadastral.mixed",color:{geomType:"polygon",css:"strokeColor"}}}]},styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#136278",strokeWidth:2,strokeOpacity:1}},{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#0c8b3d",strokeWidth:2,strokeOpacity:1}},{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#e5475f",strokeWidth:2,strokeOpacity:1}}],parser:t.getCadastralRef,goTo:t.goToCadastralRef,goToIdFormat:t.MUN+"{0}"+t.POL+"{1}"+t.PAR+"{2}",idPropertiesIdentifier:"#"},t.availableSearchTypes[r.Z.Consts.searchType.COORDINATES]={parser:t.getCoordinates,goTo:t.goToCoordinates,searchWeight:4,label:null,suggestionListHead:function(e){return{label:t.availableSearchTypes[r.Z.Consts.searchType.COORDINATES].label||t.getLocaleString("search.list.coordinates")}}},t.queryProperties={QUERYWORD:"QueryWord",FIRST:"first",SECOND:"second",THIRD:"third"},t.availableSearchTypes[r.Z.Consts.searchType.MUNICIPALITY]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:r.Z.Consts.format.JSON,featurePrefix:"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Municipio",dataIdProperty:["CMUNICIPIO"],queryProperties:{firstQueryWord:["MUNINOAC","MUNICIPIO"]},suggestionListHead:{label:"search.list.municipality",color:"strokeColor"},outputProperties:["MUNICIPIO"],outputFormatLabel:"{0}",searchWeight:1,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#fe06a5",strokeWidth:2,strokeOpacity:1}}],parser:t.getStringPattern.bind(this,[r.Z.Consts.searchType.MUNICIPALITY]),stringPatternToCheck:t.stringPatternsValidators.s_or_t,goTo:t.goToStringPattern},t.availableSearchTypes[r.Z.Consts.searchType.COUNCIL]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:r.Z.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Concejo",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CCONCEJO"],queryProperties:{firstQueryWord:["CONCEJO"]},outputProperties:["MUNICIPIO","CONCEJO"],outputFormatLabel:"{1} ({0})",searchWeight:4,parser:t.getStringPattern.bind(this,[r.Z.Consts.searchType.COUNCIL]),stringPatternToCheck:t.stringPatternsValidators.s_or_t,goTo:t.goToStringPattern,idPropertiesIdentifier:"#",suggestionListHead:{label:"search.list.council",color:"strokeColor"},styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#49006a",strokeWidth:2,strokeOpacity:1}}]},t.availableSearchTypes[r.Z.Consts.searchType.STREET]={root:null,limit:null,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:r.Z.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",renderFeatureType:"CATAST_Txt_Calle",featureType:"CATAST_Lin_CalleEje",dataIdProperty:["CVIA"],searchWeight:5,queryProperties:{firstQueryWord:["ENTINOAC","ENTIDADC"],secondQueryWord:["VIA","VIANOAC"]},suggestionListHead:{label:"search.list.street",color:"strokeColor"},outputProperties:["ENTIDADC","VIA","CVIA","CENTIDADC","CMUNICIPIO"],outputFormatLabel:"{1}, {0}",styles:[{line:{strokeColor:"#CB0000",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid"}},{point:{label:"VIA",angle:"CADANGLE",fontColor:"#000000",fontSize:10,fontWeight:"bold",labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:t.getStringPattern.bind(this,[r.Z.Consts.searchType.STREET]),goTo:t.goToStringPattern},t.availableSearchTypes[r.Z.Consts.searchType.NUMBER]={root:null,limit:null,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:r.Z.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Txt_Portal",renderFeatureType:"",searchWeight:6,dataIdProperty:["CMUNICIPIO","CENTIDADC","CVIA","PORTAL"],queryProperties:{firstQueryWord:["ENTIDADC","ENTINOAC"],secondQueryWord:["VIA","VIANOAC"],thirdQueryWord:["PORTAL"]},suggestionListHead:{label:"search.list.number",color:"fontColor"},outputProperties:["ENTIDADC","VIA","PORTAL","CVIA","CENTIDADC","CMUNICIPIO"],outputFormatLabel:"{1} {2}, {0}",styles:[{point:{radius:0,label:"PORTAL",angle:"CADANGLE",fontColor:"#CB0000",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:t.getStringPattern.bind(this,[r.Z.Consts.searchType.NUMBER]),goTo:t.goToStringPattern},t.availableSearchTypes[r.Z.Consts.searchType.URBAN]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:r.Z.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"ESTADI_Pol_EntidadPob",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CENTIDAD"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["ENTINOAC","ENTIDAD"]},suggestionListHead:{label:"search.list.urban",color:"strokeColor"},outputProperties:["MUNICIPIO","ENTIDAD"],outputFormatLabel:"{1} ({0})",searchWeight:2,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#feba1e",strokeWidth:2,strokeOpacity:1}}],parser:t.getStringPattern.bind(this,[r.Z.Consts.searchType.URBAN]),stringPatternToCheck:t.stringPatternsValidators.s_or_t,goTo:t.goToStringPattern},t.availableSearchTypes[r.Z.Consts.searchType.PLACENAME]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:r.Z.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"TOPONI_Txt_Toponimos",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CTOPONIMO"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["TOPONIMO","TOPONINOAC"]},suggestionListHead:{label:"search.list.placeName",color:"fontColor"},outputProperties:["MUNICIPIO","TOPONIMO","CMUNICIPIO","CTOPONIMO"],outputFormatLabel:"{1} ({0})",searchWeight:7,styles:[{point:{radius:0,label:"TOPONIMO",angle:"CADANGLE",fontColor:"#ff5722",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:t.getStringPattern.bind(this,[r.Z.Consts.searchType.PLACENAME]),stringPatternToCheck:t.stringPatternsValidators.s_or_t,goTo:t.goToStringPattern},t.availableSearchTypes[r.Z.Consts.searchType.PLACENAMEMUNICIPALITY]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:r.Z.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"TOPONI_Txt_Toponimos",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CTOPONIMO"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["MUNICIPIO","MUNINOAC"],secondQueryWord:["TOPONIMO","TOPONINOAC"]},suggestionListHead:{label:"search.list.placeName",color:"fontColor"},outputProperties:["MUNICIPIO","TOPONIMO","CMUNICIPIO","CTOPONIMO"],outputFormatLabel:"{1} ({0})",searchWeight:8,styles:[{point:{radius:0,label:"TOPONIMO",angle:"CADANGLE",fontColor:"#ff5722",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:t.getStringPattern.bind(this,[r.Z.Consts.searchType.PLACENAMEMUNICIPALITY]),stringPatternToCheck:[t.stringPatternsValidators.ts,t.stringPatternsValidators.st],goTo:t.goToStringPattern},t.availableSearchTypes[r.Z.Consts.searchType.COMMONWEALTH]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:r.Z.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["POLUCI_Pol_MancoRSUg"],renderFeatureType:"",dataIdProperty:["CMANCOMUNI"],queryProperties:{firstQueryWord:["MANCOMUNID"]},outputProperties:["MANCOMUNID"],outputFormatLabel:"{0}",searchWeight:9,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#fc4e2a",strokeWidth:2,strokeOpacity:1}}]},t.availableSearchTypes[r.Z.Consts.searchType.ROAD]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:r.Z.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"INFRAE_Lin_CtraEje",dataIdProperty:["DCARRETERA"],queryProperties:{firstQueryWord:["DCARRETERA"]},suggestionListHead:{label:"search.list.road",color:"strokeColor"},outputProperties:["DCARRETERA"],outputFormatLabel:t.getLocaleString("search.list.road.shorter")+": {0}",searchWeight:10,styles:[{polygon:{strokeColor:"#00b2fc",strokeOpacity:1,strokeWidth:5},line:{strokeColor:"#00b2fc",strokeOpacity:1,strokeWidth:5,strokeLinecap:"round",strokeDashstyle:"solid"}}],parser:t.getRoad,goTo:t.goToRoad,pattern:function(){return new RegExp("^(?:(?:"+t.getLocaleString("search.list.road")+"|"+t.getLocaleString("search.list.road.shorter")+")\\:?)?\\s*((A?|AP?|N?|R?|E?|[A-Z]{2}?|[A-Z]{1}?)\\s*\\-?\\s*(\\d{1,4})\\s*\\-?\\s*(A?|B?|C?|R?))$","i")}},t.availableSearchTypes[r.Z.Consts.searchType.ROADMILESTONE]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:r.Z.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"INFRAE_Sym_CtraPK",dataIdProperty:["DCARRETERA","CPK"],queryProperties:{firstQueryWord:["DCARRETERA"],secondQueryWord:["PK"]},suggestionListHead:{label:"search.list.milestone.larger",color:"fontColor"},outputProperties:["DCARRETERA","PK"],outputFormatLabel:t.getLocaleString("search.list.road.shorter")+": {0} "+t.getLocaleString("search.list.milestone")+": {1}",searchWeight:11,styles:[{point:{label:["DCARRETERA","PK"],fontColor:"#00b2fc",fontSize:14,labelOutlineColor:"#ffffff",labelOutlineWidth:2}}],parser:t.getMilestone,goTo:t.goToMilestone,pattern:function(){return new RegExp("^(?:(?:"+t.getLocaleString("search.list.road")+"|"+t.getLocaleString("search.list.road.shorter")+")\\:?)?\\s*((A?|AP?|N?|R?|E?|[A-Z]{2}?|[A-Z]{1}?)\\s*\\-?\\s*(\\d{1,4})\\s*\\-?\\s*(A?|B?|C?|R?))\\s*\\,*\\s*(?:(?:"+t.getLocaleString("search.list.milestone")+"\\:?)|(?:P\\:?)|(?:K\\:?)|(?:KM\\:?)|(?:\\s+|\\,+))\\s*(\\d{1,4})$","i")}},t.rootCfg={},t.rootCfg[r.Z.Consts.searchType.MUNICIPALITY]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:r.Z.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Municipio",dataIdProperty:["CMUNICIPIO"],queryProperties:{firstQueryWord:["MUNICIPIO"]},outputProperties:["MUNICIPIO"],outputFormatLabel:"{0}",getRootLabel:function(){return new Promise((function(e,n){if(t.rootCfg.active&&!t.rootCfg[r.Z.Consts.searchType.MUNICIPALITY].rootLabel){var o={SERVICE:"WFS"};o.VERSION=t.rootCfg[r.Z.Consts.searchType.MUNICIPALITY].version,o.REQUEST="GetFeature",o.TYPENAME=t.rootCfg[r.Z.Consts.searchType.MUNICIPALITY].featurePrefix+":"+t.rootCfg[r.Z.Consts.searchType.MUNICIPALITY].featureType,o.OUTPUTFORMAT=t.rootCfg[r.Z.Consts.searchType.MUNICIPALITY].outputFormat,o.PROPERTYNAME=["CMUNICIPIO"].concat(t.rootCfg[r.Z.Consts.searchType.MUNICIPALITY].outputProperties).join(","),o.CQL_FILTER=t.rootCfg[r.Z.Consts.searchType.MUNICIPALITY].root.map((function(t){return["CMUNICIPIO"].map((function(e,n){return e+"="+t[n]})).join(" AND ")})),o.CQL_FILTER=o.CQL_FILTER.join(" OR "),r.Z.ajax({url:t.rootCfg[r.Z.Consts.searchType.MUNICIPALITY].url+"?"+r.Z.Util.getParamString(o),method:"GET",responseType:r.Z.Consts.mimeType.JSON}).then((function(n){const o=n.data;o.totalFeatures>0?(t.rootCfg[r.Z.Consts.searchType.MUNICIPALITY].rootLabel=o.features.map((function(e){return{id:["CMUNICIPIO"].map((function(t){return e.properties[t]})).join("#"),label:e.properties[t.rootCfg[r.Z.Consts.searchType.MUNICIPALITY].outputProperties[0]].toLowerCase()}})),e(t.rootCfg[r.Z.Consts.searchType.MUNICIPALITY].rootLabel)):(t.rootCfg[r.Z.Consts.searchType.MUNICIPALITY].rootLabel=[],e(t.rootCfg[r.Z.Consts.searchType.MUNICIPALITY].rootLabel))})).catch((function(){e([])}))}else e(t.rootCfg[r.Z.Consts.searchType.MUNICIPALITY].rootLabel)}))}},t.rootCfg[r.Z.Consts.searchType.LOCALITY]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:r.Z.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["ESTADI_Pol_EntidadPob"],renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CENTIDADC"],queryProperties:{firstQueryWord:["ENTINOAC"]},outputProperties:["ENTINOAC"],getRootLabel:function(){return new Promise((function(e,n){if(t.rootCfg.active&&!t.rootCfg[r.Z.Consts.searchType.LOCALITY].rootLabel){var o={SERVICE:"WFS"};o.VERSION=t.rootCfg[r.Z.Consts.searchType.LOCALITY].version,o.REQUEST="GetFeature",o.TYPENAME=t.rootCfg[r.Z.Consts.searchType.LOCALITY].featurePrefix+":"+t.rootCfg[r.Z.Consts.searchType.LOCALITY].featureType,o.OUTPUTFORMAT=t.rootCfg[r.Z.Consts.searchType.LOCALITY].outputFormat,o.PROPERTYNAME=["CMUNICIPIO","CENTIDAD"].concat(t.rootCfg[r.Z.Consts.searchType.LOCALITY].outputProperties).join(","),o.CQL_FILTER=t.rootCfg[r.Z.Consts.searchType.LOCALITY].root.map((function(t){return["CMUNICIPIO","CENTIDAD"].map((function(e,n){return e+"="+t[n]})).join(" AND ")})),o.CQL_FILTER=o.CQL_FILTER.join(" OR "),r.Z.ajax({url:t.rootCfg[r.Z.Consts.searchType.LOCALITY].url+"?"+r.Z.Util.getParamString(o),method:"GET",responseType:r.Z.Consts.mimeType.JSON}).then((function(n){const o=n.data;o.totalFeatures>0?(t.rootCfg[r.Z.Consts.searchType.LOCALITY].rootLabel=o.features.map((function(e){return{id:["CMUNICIPIO","CENTIDAD"].map((function(t){return e.properties[t]})).join("#"),label:e.properties[t.rootCfg[r.Z.Consts.searchType.LOCALITY].outputProperties[0]].toLowerCase()}})),e(t.rootCfg[r.Z.Consts.searchType.LOCALITY].rootLabel)):(t.rootCfg[r.Z.Consts.searchType.LOCALITY].rootLabel=[],e(t.rootCfg[r.Z.Consts.searchType.LOCALITY].rootLabel))})).catch((function(){e([])}))}else e(t.rootCfg[r.Z.Consts.searchType.LOCALITY].rootLabel)}))}},t.allowedSearchTypes=[],t.options.allowedSearchTypes)for(var e in t.options.allowedSearchTypes)t.availableSearchTypes[e]&&!r.Z.Util.isEmptyObject(t.options.allowedSearchTypes[e])&&(t.availableSearchTypes[e].renderFeatureType&&t.availableSearchTypes[e].renderFeatureType.length>0&&t.options.allowedSearchTypes[e].featureType&&!t.options.allowedSearchTypes[e].renderFeatureType&&(delete t.availableSearchTypes[e].renderFeatureType,t.availableSearchTypes[e].styles=t.availableSearchTypes[e].styles.slice(0,t.availableSearchTypes[e].styles.length-1)),r.Z.Util.extend(t.availableSearchTypes[e],t.options.allowedSearchTypes[e]),(t.options.allowedSearchTypes[e].root&&e!==r.Z.Consts.searchType.MUNICIPALITY&&t.options.allowedSearchTypes[e].rootType===r.Z.Consts.searchType.MUNICIPALITY||e!==r.Z.Consts.searchType.LOCALITY&&t.options.allowedSearchTypes[e].rootType===r.Z.Consts.searchType.LOCALITY)&&(t.rootCfg.active=t.rootCfg[t.options.allowedSearchTypes[e].rootType],t.rootCfg.active.root=t.options.allowedSearchTypes[e].root,t.rootCfg.active.limit=t.options.allowedSearchTypes[e].limit,t.availableSearchTypes[r.Z.Consts.searchType.STREET].queryProperties.firstQueryWord=t.availableSearchTypes[r.Z.Consts.searchType.NUMBER].queryProperties.firstQueryWord=t.rootCfg.active.dataIdProperty)),t.options.allowedSearchTypes[e]?t.addAllowedSearchType(e,t.availableSearchTypes[e]?t.availableSearchTypes[e]:t.options.allowedSearchTypes[e],t):delete t.options.allowedSearchTypes[e];t.rootCfg.active&&t.rootCfg.active.getRootLabel(),t.queryableFeatures=t.options.queryableFeatures||!1,t.UTMX_LEN=6,t.UTMY_LEN=7,t.wrap=new r.Z.wrap.control.Search(t),t.interval=500,t.NORMAL_PATTERNS={ROMAN_NUMBER:/M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3}){1,}?\S?\./i,ABSOLUTE_NOT_DOT:/[`~!@#$%^&*_|+\=?;:'"\{\}\[\]\\]/gi,ABSOLUTE:/[`~!@#$%^&*_|+\=?;:'.\{\}\[\]\\]/gi}},r.Z.inherit(r.Z.control.Search,r.Z.Control),r.Z.mix(r.Z.control.Search,r.Z.control.infoShare),function(){var t=r.Z.control.Search.prototype;t.CLASS="tc-ctl-search",r.Z.Consts.event.SEARCHQUERYEMPTY=r.Z.Consts.event.SEARCHQUERYEMPTY||"searchqueryempty.tc",t.template={},t.template[t.CLASS]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+a(s(n,"i18n").call(i,"search.1",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:4},end:{line:1,column:23}}}))+'</h2>\r\n<div class="tc-ctl-search-content">\r\n    <input type="search" class="tc-ctl-search-txt" placeholder="'+a(s(n,"i18n").call(i,"search.placeholder",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:64},end:{line:3,column:93}}}))+'" title="'+a(s(n,"i18n").call(i,"search.instructions",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:102},end:{line:3,column:132}}}))+'" />\r\n    <button type="button" title="'+a(s(n,"i18n").call(i,"share",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:33},end:{line:4,column:49}}}))+'" class="tc-ctl-btn tc-ctl-search-share-btn tc-hidden">'+a(s(n,"i18n").call(i,"share",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:104},end:{line:4,column:120}}}))+'</button>\r\n    <button type="button" title="'+a(s(n,"i18n").call(i,"search.instructions",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:33},end:{line:5,column:63}}}))+'" class="tc-ctl-btn tc-ctl-search-btn">'+a(s(n,"i18n").call(i,"search.2",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:102},end:{line:5,column:121}}}))+'</button>\r\n    <ul class="tc-ctl-search-list tc-hidden"></ul>\r\n</div>'},useData:!0},t.template[t.CLASS+"-dialog"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-search-dialog tc-ctl-search-share-dialog tc-modal">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+a(s(n,"i18n").call(i,"search.1",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:16},end:{line:5,column:35}}}))+" - "+a(s(n,"i18n").call(i,"share",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:38},end:{line:5,column:54}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <div class="tc-ctl-search-share-dialog-ctl"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n\r\n'},useData:!0},t.register=function(t){const e=this;return new Promise((function(n,o){Promise.all([r.Z.Control.prototype.register.call(e,t),e.renderPromise()]).then((function(){e.options&&e.options.share?e.getShareDialog().then((function(){n(e)})).catch((function(t){o(t instanceof Error?t:Error(t))})):n(e)}))}))};const e=function(t){const e=this;var n=t.label,o=[];0===e.lastPattern.trim().length&&e.textInput.value.trim().length>0&&(e.lastPattern=e.textInput.value.trim());var i=e.lastPattern,a=[],s=",";if(-1===(i=e.NORMAL_PATTERNS.ROMAN_NUMBER.test(i)?i.replace(e.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT,""):i.replace(e.NORMAL_PATTERNS.ABSOLUTE,"")).indexOf(s)&&(s=" "),a=i.trim().split(s),t.label.indexOf(e.LAT_LABEL)>-1&&t.label.indexOf(e.LON_LABEL)>-1||t.label.indexOf(e.UTMX_LABEL)>-1&&t.label.indexOf(e.UTMY_LABEL)>-1){a=e.lastPattern.split(" ");for(var l=0;l<a.length;l++)","===a[l].trim().slice(-1)&&(a[l]=a[l].slice(0,-1))}for(var c=0;c<a.length;c++)if(a[c].trim().length>0){o.push("("+a[c].trim().replace(/\(/gi,"").replace(/\)/gi,"")+")");if(/((\<)|(\>)|(\<\>))/gi.exec(a[c].trim()))for(var u=a[c].trim().replace(/((\<)|(\>)|(\<\>))/gi,"").split(" "),p=0;p<u.length;p++)u[p].trim().length>0&&o.push("("+u[p].trim().replace(/\(/gi,"\\(").replace(/\)/gi,"\\)")+")")}if(t.dataRole===r.Z.Consts.searchType.ROAD||t.dataRole===r.Z.Consts.searchType.ROADMILESTONE){const n=e.getSearchTypeByRole(t.dataRole).getPattern().exec(e.lastPattern);n&&(o=[],n[2]&&n[3]&&n[4]?o.push("("+n[2]+"-"+n[3]+"-"+n[4]+")"):n[2]&&n[3]?o.push("("+n[2]+"-"+n[3]+")"):n[3]&&n[4]?o.push("("+n[3]+"-"+n[4]+")"):(n[2]||n[3])&&o.push("("+(n[2]||n[3])+")"),n[5]&&o.push("(?:"+e.getLocaleString("search.list.milestone")+"\\:\\s\\d*)("+n[5]+")\\d*"))}var d="("+o.join("|")+")";d=(d=(d=(d=(d=(d=(d=(d=(d=(d=(d=d.replace(/á|à/gi,"a")).replace(/é|è/gi,"e")).replace(/í|ì/gi,"i")).replace(/ó|ò/gi,"o")).replace(/ú|ù/gi,"u")).replace(/ü/gi,"u")).replace(/a/gi,"[a|á|à]")).replace(/e/gi,"[e|é|è]")).replace(/i/gi,"[i|í|ì]")).replace(/o/gi,"[o|ó|ò]")).replace(/u/gi,"[u|ú|ü|ù]");var h=new RegExp(d,"gi"),f=t.label;return n=t.dataRole!==r.Z.Consts.searchType.ROAD||t.dataRole!==r.Z.Consts.searchType.ROADMILESTONE?f.replace(h,(function(){var t=Array.prototype.slice.call(arguments,0);return t[t.length-3]?t[0].replace(t[t.length-3],"<b>"+t[t.length-3]+"</b>"):"<b>"+t[0]+"</b>"})):f.replace(h,"<b>$1</b>"),n},n=function(t){const e=this;var n=t.target;if("a"!==n.tagName.toLowerCase()){let e=t.target;const r=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector;for(;e;){if(r.call(e,"a")){n=e;break}e=e.parentElement}}n.querySelector("span[hidden]")&&(e.textInput.value=n.querySelector("span[hidden]").textContent,e.lastPattern=e.textInput.value,e._goToResult(unescape(n.getAttribute("href")).substring(1),n.parentNode.getAttribute("dataRole")),r.Z.UI.autocomplete.call(e.textInput,"clear"),e.shareButton&&e.shareButton.classList.remove(r.Z.Consts.classes.HIDDEN))},o=function(t,e){const n=/[^a-zA-Z]/g,r=/[^0-9]/g;var o=parseInt(t,10),i=parseInt(e,10);if(isNaN(o)&&isNaN(i)){var a=t.replace(n,""),s=e.replace(n,"");if(a===s){var l=parseInt(t.replace(r,""),10),c=parseInt(e.replace(r,""),10);return l===c?0:l>c?1:-1}return a>s?1:-1}return isNaN(o)?1:isNaN(i)?-1:o>i?1:-1},i=function(t,e){const n=this;return n.getSearchTypeByRole(t.dataRole).searchWeight&&n.getSearchTypeByRole(e.dataRole).searchWeight?(n.getSearchTypeByRole(t.dataRole).searchWeight||0)>(n.getSearchTypeByRole(e.dataRole).searchWeight||0)?1:(n.getSearchTypeByRole(t.dataRole).searchWeight||0)<(n.getSearchTypeByRole(e.dataRole).searchWeight||0)?-1:o(t.label,e.label):t.dataRole>e.dataRole?1:t.dataRole<e.dataRole?-1:o(t.label,e.label)},a=function(t,e){const n=this,r=function(){var r,i,a=n.rootCfg.active.root[0]instanceof Array?n.rootCfg.active.root[0].join("-"):n.rootCfg.active.root[0];return t.properties&&t.properties.length>0&&e.properties&&e.properties.length>0?(r=n.rootCfg.active.dataIdProperty.map((function(e){return t.properties[e].toString()})).join("-"),i=n.rootCfg.active.dataIdProperty.map((function(t){return e.properties[t].toString()})).join("-")):(r=t.id,i=e.id),r!==a&&i===a?1:r===a&&i!==a?-1:o(t.label,e.label)}.bind(this);return n.getSearchTypeByRole(t.dataRole).searchWeight&&n.getSearchTypeByRole(e.dataRole).searchWeight?(n.getSearchTypeByRole(t.dataRole).searchWeight||0)>(n.getSearchTypeByRole(e.dataRole).searchWeight||0)?1:(n.getSearchTypeByRole(t.dataRole).searchWeight||0)<(n.getSearchTypeByRole(e.dataRole).searchWeight||0)?-1:r():r()},s=function(t){const n=this;var r=[],o=[],s=t.results.sort(i.bind(n));n.rootCfg.active&&(s=s.sort(a.bind(n)));for(var l=0;l<s.length;l++){var c=s[l];-1===o.indexOf(c.dataRole)&&(r.push(n.getSearchTypeByRole(c.dataRole).getSuggestionListHead()),o.push(c.dataRole)),r.push(`<li dataRole="${c.dataRole}"><a href="#${encodeURIComponent(c.id)}"><span hidden>${c.label}</span>${e.call(n,c)}</a></li>`)}return Array.prototype.map.call(n.resultsList.querySelectorAll("li[dataRole]"),(t=>t.getAttribute("dataRole"))).filter(((t,e,n)=>n.indexOf(t)===e&&!o.includes(t))).forEach((t=>{r.push(n.getSearchTypeByRole(t).getSuggestionListHead()),r.push(`<li dataRole="${t}"><a class="tc-ctl-search-li-loading" href="#">${n.getLocaleString("searching")}<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>`)})),r.join("")};t.render=function(){const t=this;return t._set1stRenderPromise(Promise.all([t.renderData(),t.getRenderedHtml(t.CLASS+"-dialog",{},(function(e){t._dialogDiv.innerHTML=e}))]))},t.renderData=function(t,e){var o=this;o._search=o._search||{};var i=function(){o.search(o.textInput.value,(function(t){1===t.length?(o.textInput.value=t[0].label,o._goToResult(t[0].id,o.resultsList.querySelector("li:not([header])").getAttribute("dataRole")),o.resultsList.classList.add(r.Z.Consts.classes.HIDDEN)):0===t.length&&o.resultsList.classList.add(r.Z.Consts.classes.HIDDEN)}))};return o.layerStyleFN=function(){function t(t){return t.indexOf(".")>-1?t.split(".")[0]:t}function e(e,n,i){var a=o.getSearchTypeByFeature(i);if(a){var s=a.getStyleByFeatureType(t(i));if(s&&s.hasOwnProperty(n))return s[n][e]}return r.Z.Cfg.styles[n][e]}return function(n,o,i,a){!r.Z.Feature||a instanceof r.Z.Feature||this.map.trigger(r.Z.Consts.event.FEATURESADD,{layer:this.layer,geom:a.geom});var s=e(o,n,t(a.id));if(i){if(s instanceof Array){var l=s.map((function(t){return a.getData().hasOwnProperty(t)?a.getData()[t]:""})),c=this.getSearchTypeByFeature(t(a.id));return c?c.outputFormatLabel.tcFormat(l):l.join(" ")}return a.getData().hasOwnProperty(s)?a.getData()[s]:""}return s}}(),new Promise((function(a,l){r.Z.Control.prototype.renderData.call(o,Object.assign(t||{},{share:o.options.share}),(function(){o.map?o.layerPromise=o.map.addLayer({id:o.getUID(),title:"Búsquedas",owner:o,stealth:!0,declutter:!0,type:r.Z.Consts.layerType.VECTOR,styles:{polygon:{fillColor:o.layerStyleFN.bind(o,"polygon","fillColor",!1),fillOpacity:o.layerStyleFN.bind(o,"polygon","fillOpacity",!1),strokeColor:o.layerStyleFN.bind(o,"polygon","strokeColor",!1),strokeOpacity:o.layerStyleFN.bind(o,"polygon","strokeOpacity",!1),strokeWidth:o.layerStyleFN.bind(o,"polygon","strokeWidth",!1)},line:{strokeColor:o.layerStyleFN.bind(o,"line","strokeColor",!1),strokeOpacity:o.layerStyleFN.bind(o,"line","strokeOpacity",!1),strokeWidth:o.layerStyleFN.bind(o,"line","strokeWidth",!1)},marker:{anchor:r.Z.Defaults.styles.marker.anchor,height:r.Z.Defaults.styles.marker.height,width:r.Z.Defaults.styles.marker.width},point:{radius:o.layerStyleFN.bind(o,"point","radius",!1),height:o.layerStyleFN.bind(o,"point","height",!1),width:o.layerStyleFN.bind(o,"point","width",!1),fillColor:o.layerStyleFN.bind(o,"point","fillColor",!1),fillOpacity:o.layerStyleFN.bind(o,"point","fillOpacity",!1),strokeColor:o.layerStyleFN.bind(o,"point","strokeColor",!1),strokeWidth:o.layerStyleFN.bind(o,"point","strokeWidth",!1),fontSize:o.layerStyleFN.bind(o,"point","fontSize",!1),fontColor:o.layerStyleFN.bind(o,"point","fontColor",!1),labelOutlineColor:o.layerStyleFN.bind(o,"point","labelOutlineColor",!1),labelOutlineWidth:o.layerStyleFN.bind(o,"point","labelOutlineWidth",!1),label:o.layerStyleFN.bind(o,"point","label",!0),angle:o.layerStyleFN.bind(o,"point","angle",!0)}}}).then((function(t){return o.layer=t,o.layer})):o.layerPromise=Promise.reject(new Error("Control not registered to map"));var t,c=function(){o.textInput.value=o.resultsList.label||o.resultsList.querySelector("li:not([header]) > a > span").textContent,o.lastPattern=o.textInput.value,o._goToResult(o.resultsList.id||unescape(o.resultsList.querySelector("li:not([header]) > a").getAttribute("href")).substring(1),o.resultsList.querySelector("li:not([header])").getAttribute("dataRole")),o.resultsList.classList.add(r.Z.Consts.classes.HIDDEN)};o.textInput=o.div.querySelector("input."+o.CLASS+"-txt"),o.options&&o.options.placeHolder&&o.textInput.setAttribute("placeHolder",o.options.placeHolder.trim()),o.resultsList=o.div.querySelector("."+o.CLASS+"-list"),o.button=o.div.querySelector("."+o.CLASS+"-btn"),o.button.addEventListener(r.Z.Consts.event.CLICK,(function(){o.getLayer().then((function(t){o.resultsList.querySelectorAll("li > a:not(.tc-ctl-search-li-loading):not(.tc-ctl-search-li-empty)").length>1||(t.features.length>0?t.map.zoomToFeatures(t.features):1===o.resultsList.querySelectorAll("li > a:not(.tc-ctl-search-li-loading):not(.tc-ctl-search-li-empty)").length?c():o.textInput.dispatchEvent(new Event("keyup")))}))}),{passive:!0}),o.options.instructions&&(o.textInput.setAttribute("title",o.options.instructions.trim()),o.button.setAttribute("title",o.options.instructions.trim())),o.resultsList.addEventListener(r.Z.Consts.event.CLICK,r.Z.EventTarget.listenerBySelector("a."+o.CLASS+"-li-empty",(function(){o.resultsList.classList.add(r.Z.Consts.classes.HIDDEN),o.textInput.focus()})),{passive:!0}),o.textInput.addEventListener("keypress",(function(t){if(13==t.which)return t.preventDefault(),t.stopPropagation(),o.lastPattern="",1===o.resultsList.querySelectorAll("li > a:not(.tc-ctl-search-li-loading):not(.tc-ctl-search-li-empty)").length?c():i(),!1})),o.textInput.addEventListener("search",(function(){0===o.textInput.value.length&&(delete o.toShare,o.shareButton&&o.shareButton.classList.add(r.Z.Consts.classes.HIDDEN),o.resultsList.classList.add(r.Z.Consts.classes.HIDDEN),i())})),o.textInput.addEventListener("input",(function(){0===o.textInput.value.length&&(o.shareButton&&o.shareButton.classList.add(r.Z.Consts.classes.HIDDEN),o.resultsList.classList.add(r.Z.Consts.classes.HIDDEN),i())})),o.textInput.addEventListener("targetCleared.autocomplete",(function(){o.shareButton&&o.shareButton.classList.add(r.Z.Consts.classes.HIDDEN),o.resultsList.classList.add(r.Z.Consts.classes.HIDDEN)})),o.textInput.addEventListener("targetUpdated.autocomplete",(function(){o.resultsList.querySelectorAll("li").length>0&&o.resultsList.classList.remove(r.Z.Consts.classes.HIDDEN)})),o.options.share&&(o.shareButton=o.div.querySelector("."+o.CLASS+"-share-btn"),o.shareButton.addEventListener(r.Z.Consts.event.CLICK,(function(){o.showShareDialog()}),{passive:!0})),o.lastPattern="",o.retryTimeout=null;r.Z.UI.autocomplete.call(o.textInput,{link:"#",target:o.resultsList,minLength:2,ctx:o,source:function(e,n){if(o.lastpress=performance.now(),!t){const e=function(){var i=o.textInput.value.trim();i.length>0&&(!o.lastPattern||i!==o.lastPattern)&&performance.now()-o.lastpress>o.interval?(window.cancelAnimationFrame(t),t=void 0,o.resultsList.classList.add(r.Z.Consts.classes.HIDDEN),o.lastPattern=i,o.search(i,n)):t=requestAnimationFrame(e)};t=requestAnimationFrame(e)}},callback:n.bind(o),buildHTML:s.bind(o)});const u=function(t){t.ctrlKey||t.altKey||t.shiftKey||(40===t.keyCode?(o.textInput==document.activeElement&&o.resultsList.querySelector("li:not([header]) a")?o.resultsList.querySelector("li:not([header]) a").focus():o.resultsList.querySelector("li:not([header]):last-child a")===document.activeElement?o.textInput.focus():function(t,e){var n=t.nextElementSibling;if(!e)return n;for(;n;){if(n.matches(e))return n;n=n.nextElementSibling}}(document.activeElement.parentElement,"li:not([header])").querySelector("a").focus(),t.preventDefault(),t.stopPropagation()):38===t.keyCode&&(o.textInput==document.activeElement||document.activeElement==o.resultsList.querySelector("li:not([header]) a")?o.resultsList.querySelector("li:not([header]):last-child a").focus():function(t,e){var n=t.previousElementSibling;if(!e)return n;for(;n;){if(n.matches(e))return n;n=n.previousElementSibling}}(document.activeElement.parentElement,"li:not([header])").querySelector("a").focus(),t.preventDefault(),t.stopPropagation())),t.stopPropagation()};o.textInput.addEventListener("keydown",u),o.resultsList.addEventListener("keydown",u),r.Z.Util.isFunction(e)&&e(),o.layerPromise.then(a).catch(l)}))}))},t.addAllowedSearchType=function(t,e){this.allowedSearchTypes.push(new u(t,e,this))},t.getSearchTypeByRole=function(t){return this.allowedSearchTypes.filter((function(e){return e.typeName==t}))[0]},t.getSearchTypeByFeature=function(t){var e=this.allowedSearchTypes.filter((function(e){return e.isFeatureOfThisType(t)}));return e.length>0?e[0]:null},t.getElementOnSuggestionList=function(t,e){const n=this;for(var r=0;r<n.searchRequestsResults.length;r++)if(n.searchRequestsResults[r].id==t&&(!e||e&&n.searchRequestsResults[r].dataRole===e))return n.searchRequestsResults[r]},t.getLayer=function(){return this.layerPromise},t.getFeatures=function(){return this.layer.features},t.cleanMap=function(){const t=this;if(t.layer){const o=t.layer;var e=o.features.slice();o.clearFeatures(),e&&e.length>0&&t.map.trigger(r.Z.Consts.event.FEATUREREMOVE,{layer:o,feature:e[0]});for(var n=0;n<t.WFS_TYPE_ATTRS.length;n++)o.hasOwnProperty(t.WFS_TYPE_ATTRS[n])&&delete o[t.WFS_TYPE_ATTRS[n]]}},t.getMunicipalities=function(){var t=this;return r.Z.cache.search=r.Z.cache.search||{},t._municipalitiesPromise=new Promise((function(e,n){if(r.Z.cache.search.municipalities)e(r.Z.cache.search.municipalities);else{var o=t.getSearchTypeByRole(r.Z.Consts.searchType.CADASTRAL);if(!(o.municipality&&o.municipality.featureType&&o.municipality.labelProperty&&o.municipality.idProperty))throw new Error("Error en la configuración de la búsqueda: "+o.typeName+". Error en el objeto municipality");var i={REQUEST:"GetFeature",SERVICE:"WFS",TYPENAME:o.municipality.featureType,VERSION:o.version,PROPERTYNAME:o.municipality.labelProperty+","+o.municipality.idProperty,OUTPUTFORMAT:o.outputFormat};o.featurePrefix&&(i.TYPENAME=o.featurePrefix+":"+i.TYPENAME);var a=o.url+"?"+r.Z.Util.getParamString(i);r.Z.ajax({url:a,method:"GET",responseType:"text"}).then((function(t){const n=t.data;var i=(o.outputFormat===r.Z.Consts.format.JSON?new r.Z.wrap.parser.JSON:new r.Z.wrap.parser.WFS({featureNS:o.municipality.featurePrefix,featureType:o.municipality.featureType})).read(n);r.Z.cache.search.municipalities=[];for(var a=0;a<i.length;a++){var s=i[a];r.Z.cache.search.municipalities.push({label:s.data[o.municipality.labelProperty],id:s.data[o.municipality.idProperty]})}r.Z.cache.search.municipalities.sort((function(t,e){return t.label<e.label?-1:t.label>e.label?1:0})),e(r.Z.cache.search.municipalities)})).catch((function(){e()}))}})),t._municipalitiesPromise},t.getCoordinates=function(t){const e=this;return new Promise((function(n,o){var i=t.match(new RegExp("^"+e.UTMX_LABEL.trim().toLowerCase()+"*\\s*([-+]?[0-9]{"+e.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*"+e.UTMY_LABEL.trim().toLowerCase()+"*\\s*([-+]?[0-9]{"+e.UTMY_LEN+"}(?:[.,]\\d+)?)$"));if(i&&(t=i[1]+" "+i[2]),(i=t.match(new RegExp("^"+e.LAT_LABEL.trim().toLowerCase()+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+e.LON_LABEL.trim().toLowerCase()+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$")))&&(t=i[1]+" "+i[3]),/\d/.test(t)&&(new RegExp("^([-+]?[0-9]{"+e.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*([-+]?[0-9]{"+e.UTMY_LEN+"}(?:[.,]\\d+)?)$").test(t)||/^([-+]?\d{1,3}([.,]\d+)?)\,?\s*([-+]?\d{1,2}([.,]\d+)?)$/.test(t)))if((i=/^([-+]?\d{1,3}([.,]\d+)?)\,?\s*([-+]?\d{1,2}([.,]\d+)?)$/.exec(t))&&(i[1].indexOf(",")>-1||i[3].indexOf(",")>-1)&&(i[1]=i[1].replace(",","."),i[3]=i[3].replace(",","."),t=i[1]+" "+i[3]),!i||i&&(i[1].indexOf(",")>-1?i[1].replace(",","."):i[1])<=180&&(i[3].indexOf(",")>-1?i[3].replace(",","."):i[3])<=90){(i=new RegExp("^([-+]?[0-9]{"+e.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*([-+]?[0-9]{"+e.UTMY_LEN+"}(?:[.,]\\d+)?)$").exec(t))&&(i[1].indexOf(",")>-1||i[2].indexOf(",")>-1)&&(i[1]=i[1].replace(",","."),i[2]=i[2].replace(",","."),t=i[1]+" "+i[2]),t=t.replace(e.UTMX_LABEL,"").replace(e.UTMY_LABEL,"").replace(e.LON_LABEL,"").replace(e.LAT_LABEL,"");var a=r.Z.Util.parseCoords(t);if(a){var s=a[0].value,l=a[1].value,c=a[0].type===r.Z.Consts.UTM?e.UTMX:e.LAT,u=a[1].type===r.Z.Consts.UTM?e.UTMY:e.LON,p=c+s+u+l,d=e.getPoint(p);d&&!e.insideLimit(d)&&(s=a[1].value,l=a[0].value,p=(c=a[1].type===r.Z.Consts.UTM?e.UTMX:e.LAT)+s+(u=a[0].type===r.Z.Consts.UTM?e.UTMY:e.LON)+l,d=e.getPoint(p)),d?(e.availableSearchTypes[r.Z.Consts.searchType.COORDINATES].label=/^X([-+]?\d+(?:\.\d+)?)Y([-+]?\d+(?:\.\d+)?)$/.test(p)?e.getLocaleString("search.list.coordinates.utm")+e.map.crs:e.getLocaleString("search.list.coordinates.geo"),n([{id:p,label:e.getLabel(p),dataRole:r.Z.Consts.searchType.COORDINATES}])):o()}else o()}else o();else o()}))},t.getCadastralRef=function(t){const e=this;return new Promise((function(n,o){var i=t.match(new RegExp(e.MUN_LABEL.trim().toLowerCase()+"?\\s(.*)\\,\\s?"+e.POL_LABEL.trim().toLowerCase()+"?\\s(\\d{1,2})\\,\\s?"+e.PAR_LABEL.trim().toLowerCase()+"?\\s(\\d{1,4})"));i&&(t=i[1]+", "+i[2]+", "+i[3]);var a=t;!/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.test(t)&&e.getSearchTypeByRole(r.Z.Consts.searchType.CADASTRAL).suggestionRoot&&(a=e.getSearchTypeByRole(r.Z.Consts.searchType.CADASTRAL).suggestionRoot+", "+t),/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.test(a)&&!new RegExp("^([-+]?[0-9]{"+e.UTMX_LEN+"})\\s*\\,\\s*([-+]?[0-9]{"+e.UTMY_LEN+"})$").test(t)?e.getMunicipalities().then((function(t){var o=/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.exec(a);if(o){var i=new RegExp(o[1].trim().replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),s=[];const a=function(t,n,o,i){var a=[];return a.push[e.MUN]=t,a.push[e.POL]=o,a.push[e.PAR]=i,{id:e.MUN+t+e.POL+o+e.PAR+i,label:e.getLabel(e.MUN+n+e.POL+o+e.PAR+i),dataRole:r.Z.Consts.searchType.CADASTRAL,properties:a}};if((s=t.filter((function(t){return t=t.label||t.id||t,i.test(t)||i.test(e.removePunctuation(t))}))).length>0)for(var l=0;l<s.length;l++)s[l]=a(s[l].id,s[l].label,o[2].trim(),o[3].trim());if(/^[0-9]*$/g.test(o[1])){if(o[1].trim()===e.getSearchTypeByRole(r.Z.Consts.searchType.CADASTRAL).suggestionRoot){var c=t.filter((function(t){return parseInt(t.id)===parseInt(e.getSearchTypeByRole(r.Z.Consts.searchType.CADASTRAL).suggestionRoot)}))[0];c&&n([a(c.id,c.label,o[2].trim(),o[3].trim())])}s.push(a(o[1].trim(),o[1].trim(),o[2].trim(),o[3].trim()))}n(s)}})):o()}))},t.stringPatternsValidators={tsp:function(t,e,n,r){const o=this;var i=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-zñáéíóúüàèìòù\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(t);if(i&&i[1]&&i[2]){var a=function(){return c.call(o,(i[3]||i[4]||i[5]||i[6]).trim())};return/^([^0-9]+)$/i.test(i[1].trim())&&/^([^0-9]+)$/i.test(i[2].trim())?(e.push({t:i[1].trim(),s:i[2].trim(),p:a()}),e.push({t:i[2].trim(),s:i[1].trim(),p:a()})):/^([^0-9]+)$/i.test(i[1].trim())?e.push({t:i[1].trim(),s:i[2].trim(),p:a()}):e.push({s:i[1].trim(),t:i[2].trim(),p:a()}),p.call(this,e,n,r),!0}return!1},spt:function(t,e,n,r){const o=this;var i=/^(?:([^\,][a-zñáéíóúüàèìòù\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))(?:\s*\,\s*)([^0-9\,]+)$/i.exec(t);if(i&&i[6]&&i[1]){var a=function(){return c.call(o,(i[2]||i[3]||i[4]||i[5]).trim())};return/^([^0-9]+)$/i.test(i[6].trim())&&/^([^0-9]+)$/i.test(i[1].trim())?(e.push({t:i[6].trim(),s:i[1].trim(),p:a()}),e.push({t:i[1].trim(),s:i[6].trim(),p:a()})):/^([^0-9]+)$/i.test(i[6].trim())?e.push({t:i[6].trim(),s:i[1].trim(),p:a()}):e.push({s:i[6].trim(),t:i[1].trim(),p:a()}),p.call(this,e,n,r),!0}return!1},tnsp:function(t,e,n,r){const o=this;var i=/^(?:([^\,][a-zñáéíóúüàèìòù\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)([^0-9\,]+)(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(t);return!!(i&&i[1]&&i[2])&&(e.push({t:i[2].trim(),s:i[1].trim(),p:c.call(o,(i[3]||i[4]||i[5]||i[6]).trim())}),p.call(this,e,n,r),!0)},ts:function(t,e,n,r){const o=this;var i=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-zñáéíóúüàèìòù"\s*\-\.\(\)\/0-9]+))$/i.exec(t);if(!i&&/^[^0-9]*$/i.test(t.trim())){var a=t.split(",").reverse();i=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-zñáéíóúüàèìòù"\s*\-\.\(\)\/0-9]+))$/i.exec(a.join(","))}if(i&&i[1]&&i[2]){if(/^([^0-9]+)$/i.test(i[1].trim())&&/^([^0-9]+)$/i.test(i[2].trim()))e.push({t:i[1].trim(),s:i[2].trim()}),e.push({s:i[1].trim(),t:i[2].trim()}),p.call(this,e,n,r);else{var s=function(t){for(var e=t.split(" ").reverse(),n=[],r=0;r<e.length;r++)1===e[r].length&&(n.push(e[r]),e[r]="");return n.length>0?e.reverse().join(" ").trim()+o._LIKE_PATTERN+n.reverse().join(o._LIKE_PATTERN):e.reverse().join(" ").trim()};/^([^0-9]+)$/i.test(i[1].trim())?e.push({t:i[1].trim(),s:s(i[2].trim())}):e.push({s:s(i[1].trim()),t:i[2].trim()}),p.call(this,e,n,r,!0)}return!0}return!1},st:function(t,e,n,r){const o=this;var i=/^(?:([^\,][a-zñáéíóúüàèìòù\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)([^0-9\,]+)$/i.exec(t);if(!i){const e=t.split(",").reverse();i=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-zñáéíóúüàèìòù"\s*\-\.\(\)\/0-9]+))$/i.exec(e.join(","))}if(i){var a={};const i=t.split(",").reverse();for(var s=0;s<i.length;s++)if(/^([^0-9\,]+)$/i.test(i[s].trim()))a.t=i[s].trim();else if(/(\s*\d+)/i.test(i[s].trim()))if(-1===i[s].trim().indexOf(" "))a.s=i[s].trim();else{for(var l=i[s].trim().split(" ").reverse(),u=function(t){return!!/^(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(t.trim())&&(a.p=c.call(o,t.trim()),!0)},d=0,h=l[d].trim();d<l.length&&!u(h);)++d<l.length&&(h+=l[d]);if(a.p){for(var f=l,m=0;m<f.length;m++){for(var g=!1,y=0;y<f[m].split("").length;y++)a.p.indexOf(f[m][y])>-1&&(g=!0);if(g&&(f[m]="",a.p==c.call(o,h)))break}if(/^([^\,][a-zñáéíóúüàèìòù\s*\-\.\(\)\/0-9]+)$/i.test(l.reverse().join(" ").trim())){for(var v=[],_=l.reverse(),C=0;C<_.length;C++)1===_[C].trim().length&&(v.push(_[C].trim()),_[C]="");a.s=v.length>0?_.reverse().join(" ").trim()+o._LIKE_PATTERN+v.reverse().join(o._LIKE_PATTERN):_.reverse().join(" ").trim()}e.push({t:a.t,s:a.s+" "+a.p})}else a.s=i[s].trim()}return e.push(a),p.call(this,e,n,r),!0}return!1},s_or_t:function(t,e,n,r){var o=/^([^\,][a-zñáéíóúüàèìòù\s*\-\.\(\)\/0-9\<\>]+)$/i.exec(t);return!(!o||!o[1])&&(n?(e.push({t:o[1].trim()}),e.push({t:n,s:o[1].trim()})):e.push({t:o[1].trim()}),!0)},sp:function(t,e,n,r){const o=this;var i=/^([^\,][a-zñáéíóúüàèìòù\s*\-\.\(\)\/]+)\s*\,?\s*((\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(t);return!!(i&&i[1]&&i[2])&&(n?e.push({t:n,s:i[1].trim(),p:c.call(o,i[2].trim())}):e.push({t:i[1].trim(),s:i[2].trim()}),!0)},snp:function(t,e,n,r){const o=this;var i=/^([^\,][0-9\s*\-\.\(\)\/]+)\s*\,?\s*(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.exec(t);return!!(i&&i[1]&&i[2]&&n)&&(e.push({t:n,s:i[1].trim(),p:c.call(o,i[2].trim())}),!0)}};const l=function(t){const e=this;return t=e.removePunctuation(t),(t=e.NORMAL_PATTERNS.ROMAN_NUMBER.test(t)?t.replace(e.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT,""):t.replace(e.NORMAL_PATTERNS.ABSOLUTE,"")).toLowerCase()},c=function(t){const e=this;for(var n=[function(t){return/^(\d{1,3})\s?\-?\s?([a-z]{0,4})\s?\-?\s?([a-z]{0,4})$/i.test(t)},function(t){return/^([a-z]{1,4})\s?\-?\s?(\d{1,3})$/i.test(t)},function(t){return/^(sn|S\/N|s\/n|s\-n)$/i.test(t)},function(t){return/^([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.test(t)}],r=[function(t){var n=[],r=/^(\d{1,3})\s?\-?\s?([a-z]{0,4})\s?\-?\s?([a-z]{0,4})$/i.exec(t);if(r){for(var o=1;o<r.length;o++)r[o].trim().length>0&&n.push(r[o].trim());return n.join(e._LIKE_PATTERN)}return t},function(t){var n=[],r=/^([a-z]{1,4})\s?\-?\s?(\d{1,3})$/i.exec(t);if(r){for(var o=1;o<r.length;o++)r[o].trim().length>0&&n.push(r[o].trim());return n.join(e._LIKE_PATTERN)}return t},function(t){return/^(sn|S\/N|s\/n|s\-n)$/i.exec(t)?"s*n":t},function(t){/^([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.exec(t);return t}],o=0;o<r.length&&!n[o].call(e,t);)o++;return o<r.length?r[o].call(e,t):t},p=function(t,e,n,o){const i=this;if(e)for(var a=t.length;a--;)if(o)t.push(r.Z.Util.extend({},t[a],{t:e}));else if(t[a].t){var s=i.rootCfg.active.rootLabel.filter(function(e){return e.label.indexOf(i.removePunctuation(t[a].t).toLowerCase())>-1}.bind(i));1===s.length?t[a].t=s[0].id:s.length>1?s.map((function(e){var n=r.Z.Util.extend({},t[a]);n.t=e.id,t.push(n)})):0===s.length&&n&&t.splice(a,1)}},d=function(t,e){const n=this,o=n.rootCfg.active&&n.rootCfg.active.root||"",i=n.rootCfg.active&&n.rootCfg.active.limit||!1;var a=[];if(","===(e=e.trim()).charAt(e.length-1)&&(e=e.substring(0,e.length-1)),function(){for(var t=[function(t){return t.length>=3},function(t){return!/^\d+$/.test(t)&&!/^\d+\,\s*\d+$/.test(t)}],r=0;r<t.length;r++)if(!t[r].call(n,e))return!1;return!0}()){var s=[];0===(s=t.map((function(t){return n.getSearchTypeByRole(t)})).filter((function(t){return t.stringPatternToCheck})).map((function(t){return t.stringPatternToCheck})).flat()).length&&(s=[n.stringPatternsValidators.tsp,n.stringPatternsValidators.spt,n.stringPatternsValidators.tnsp,n.stringPatternsValidators.ts,n.stringPatternsValidators.st],s=o&&e.split(",").length<3?[n.stringPatternsValidators.sp,n.stringPatternsValidators.snp,n.stringPatternsValidators.s_or_t].concat(s):s.concat([n.stringPatternsValidators.sp,n.stringPatternsValidators.snp,n.stringPatternsValidators.s_or_t]));var l=0;try{for(;l<s.length&&!s[l].call(n,e,a,o,i);)l++}catch(t){r.Z.error("Error según el patrón: "+e,r.Z.Consts.msgErrorMode.EMAIL,"Error en la búsqueda del callejero")}return a}return null},h=function(t,e,n,o){return fetch(t.url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:t.filter.getParams(o),signal:e}).then((function(t){if(t.ok)return t.text();throw"Search: error requestToWFS"})).then(n).catch((function(t){throw"AbortError"===t.name?console.log("Search: petición abortada"):r.Z.error(t),t}))};t.getStringPattern=function(t,e){const n=this;return new Promise(((r,o)=>{let i=[],a=[];e=l.call(n,e);let s=/(.*)\((.*)\)?/.exec(e);if(s&&s.length>2){i=d.call(n,t,s[1])||[];let e=d.call(n,t,s[1]+","+s[2])||[];i=i.concat(e)}else i=d.call(n,t,e)||[];if(i.length>0){let e=[],s=e=>t.filter((function(t){return Object.keys(n.getSearchTypeByRole(t).queryProperties).length===Object.keys(e).length})),l=[];for(var c=0;c<i.length;c++){let t=i[c],r=s(t);for(var u=0;u<r.length;u++){let o=n.getSearchTypeByRole(r[u]);l.indexOf(o.typeName)<0&&(e.push(o.getSuggestionListHead()),e.push('<li dataRole="'+o.typeName+'"><a class="tc-ctl-search-li-loading" href="#">'+n.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>'),l.push(o.typeName));let i=t=>o.getSuggestionListElements(t);a.push(h.call(n,o,n.searchRequestsAbortController.signal,i,t))}}a.length>0?(n.resultsList.innerHTML+=e.join(""),n.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")),Promise.all(a).then((t=>{r([].concat.apply([],t))})).catch((t=>{o()}))):o()}else o()}))},t.getRoad=function(t){const e=this;return new Promise((function(n,o){if((t=t.trim()).length<2)n([]);else{var i=e.getSearchTypeByRole(r.Z.Consts.searchType.ROAD),a=i.getPattern().exec(t);if(a&&a[3]){var s=a[2]?a[2].trim()+"-"+a[3].trim():a[3].trim();a[4]&&a[4].length>0&&(s=s+"-"+a[4].trim()),e.resultsList.innerHTML=i.getSuggestionListHead()+'<li dataRole="'+i.typeName+'"><a class="tc-ctl-search-li-loading" href="#">'+e.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>',e.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")),fetch(i.url+"?"+i.filter.getParams({t:s}),{signal:e.searchRequestsAbortController.signal}).then((t=>{if(t.ok)return t.text();throw"Search: error getRoad"})).then((t=>{let e=[],r=i.parseFeatures(t);r.length>0?(r.map((function(t){var n=i.outputProperties;if(!e.some((function(e){return e.text==t.data[n[0]]}))){var r=i.outputFormatLabel.tcFormat(i.outputProperties.map((function(e){return t.data[e]}))),o=i.outputProperties.map((function(e){return t.data[e]})).join("-");e.push({id:i.dataIdProperty.map((function(e){return t.data[e]})).join("#"),label:r,text:o,dataLayer:t.id.split(".")[0],dataRole:i.typeName})}})),n(e)):o()})).catch((function(t){o()}))}else o()}}))},t.getMilestone=function(t){var e=this;return new Promise((function(n,o){if((t=t.trim()).length<3)n([]);else{var i=e.getSearchTypeByRole(r.Z.Consts.searchType.ROADMILESTONE),a=i.getPattern().exec(t);if(a&&a[3]&&a[5]){var s=a[2]?a[2].trim()+"-"+a[3].trim():a[3].trim();a[4]&&a[4].length>0&&(s=s+"-"+a[4].trim()),e.resultsList.innerHTML=i.getSuggestionListHead()+'<li dataRole="'+i.typeName+'"><a class="tc-ctl-search-li-loading" href="#">'+e.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>',e.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")),fetch(i.url+"?"+i.filter.getParams({t:s,s:a[5].trim()}),{signal:e.searchRequestsAbortController.signal}).then((t=>{if(t.ok)return t.text();throw"Search: error getMilestone"})).then((function(t){let e=[],r=i.parseFeatures(t);r.length>0?(r.map((function(t){var n=i.outputProperties;if(!e.some((function(e){return e.label==t.data[n[0]]}))){var r=i.outputFormatLabel.tcFormat(i.outputProperties.map((function(e){return t.data[e]})));e.push({id:i.dataIdProperty.map((function(e){return t.data[e]})).join("#"),label:r,text:r,dataLayer:t.id.split(".")[0],dataRole:i.typeName})}})),n(e)):o()})).catch((function(t){o()}))}else o()}}))},t.search=function(t,e){var n=this;if((t=t.trim()).length>0){t=t.toLowerCase(),n.searchRequestsAbortController&&n.searchRequestsAbortController.abort(),n.resultsList.innerHTML="",n.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")),n.searchRequestsResults=[];let r=()=>{n.searchRequestsAbortController.signal.removeEventListener("abort",r)};n.searchRequestsAbortController=new AbortController,n.searchRequestsAbortController.signal.addEventListener("abort",r);let o=0,i=()=>{if(o--,0===o){if(t!==n.textInput.value.trim().toLowerCase())return;0===n.searchRequestsResults.length&&(n.cleanMap(),n.layer&&0!==n.layer.features.length||(n.resultsList.innerHTML='<li><a title="'+n.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+n.EMPTY_RESULTS_LABEL+"</a></li>",n.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")))),n.lastPattern=""}},a=()=>{n.searchRequestsResults&&(n.searchRequestsResults=n.searchRequestsResults.sort((function(t,e){var n,r=/(\d+)/,o="";return r.test(t.label)&&r.test(e.label)?(n=t.label.match(r)[1],o=e.label.match(r)[1]):(n=t.label,o=e.label),n>o?1:n<o?-1:0})),n._search.data=n.searchRequestsResults,e&&e(n.searchRequestsResults))};n.allowedSearchTypes.forEach((function(e){e.parser?(o++,e.parser.call(n,t).then(function(t,e){let r=()=>{let e=n.resultsList.querySelector('li[dataRole="'+t+'"]');if(e){let t=Array.prototype.indexOf.call(e.parentElement.childNodes,e),r=n.resultsList.childNodes[t-1];n.resultsList.removeChild(r),n.resultsList.removeChild(e)}};if(e&&e.length>0){let t=e.filter((t=>-1===n.searchRequestsResults.findIndex((e=>e.id===t.id))));t.length===e.length?(n.searchRequestsResults=n.searchRequestsResults.concat(t),a()):1===e.length&&r()}else r();i()}.bind(n,e.typeName)).catch(function(t){i()}.bind(n,e.typeName))):console.log("Falta implementación del método parser")}))}else n.lastPattern="",n.cleanMap()};var f=function(t){const e=this;if(t&&t.length>0){const n=function(t){for(var n=0;n<t.length;n++)t[n].showsPopup!=e.queryableFeatures&&(t[n].showsPopup=e.queryableFeatures)};n(t),n(e.layer.features)}};t._goToResult=function(t,e){const n=this;n.toShare={id:t,dataRole:e};var o=null;return n.searchRequestsAbortController&&n.searchRequestsAbortController.abort(),new Promise((function(i,a){var s;n.loading||(n.loading=n.map.getControlsByClass("TC.control.LoadingIndicator")[0]),s=n.loading.addWait(),matchMedia("(max-width: 30em)").matches&&(n.textInput.blur(),n.map.trigger(r.Z.Consts.event.TOOLSCLOSE)),n.cleanMap();var l=!1,c=!0;n.allowedSearchTypes.forEach((function(r){if(c)if(n.availableSearchTypes[r.typeName]){var i=e||n.getElementOnSuggestionList.call(n,t).dataRole;if(i){var a=n.getSearchTypeByRole(i);n.availableSearchTypes[i]&&a&&a.goTo?null!==(o=a.goTo.call(n,t,i))&&(c=!1):!n.availableSearchTypes[i]&&a&&a.goTo?(l=!0,null!==(o=a.goTo.call(n,t,i))&&(c=!1)):console.log("Falta implementación del método goTo")}}else r.goTo?(l=!0,null!==(o=r.goTo.call(n,t))&&(c=!1)):console.log("Falta implementación del método goTo")})),n.loading.removeWait(s),o?n.getLayer().then((function(t){var e;switch(!0){case o.params.type===r.Z.Consts.layerType.VECTOR:for(e=0;e<n.WFS_TYPE_ATTRS.length;e++)t.hasOwnProperty(n.WFS_TYPE_ATTRS[e])&&delete t[n.WFS_TYPE_ATTRS[e]];break;case o.params.type===r.Z.Consts.layerType.WFS:for(e=0;e<n.WFS_TYPE_ATTRS.length;e++)t[n.WFS_TYPE_ATTRS[e]]=o.params[n.WFS_TYPE_ATTRS[e]]}t.type=o.params.type;const a=function(t){t.layer===n.layer&&(n.map.off(r.Z.Consts.event.FEATURESADD,a),f.call(n,t.features))};n.map.on(r.Z.Consts.event.FEATURESADD,a);const l=function(e){e.layer===t&&(n.map.off(r.Z.Consts.event.LAYERUPDATE,l),n.map.one(r.Z.Consts.event.FEATURESADD,(function(e){if(e.layer===t)if(!e.layer.features||0===e.layer.features.length&&e.layer.wrap.layer.getSource().getFeatures()){n.resultsList.classList.add(r.Z.Consts.classes.HIDDEN);var i=e.layer.wrap.layer.getSource().getExtent(),a=e.layer.map.options.pointBoundsRadius;i[2]-i[0]==0&&(i[0]=i[0]-a,i[2]=i[2]+a),i[3]-i[1]==0&&(i[1]=i[1]-a,i[3]=i[3]+a),e.layer.map.setExtent(i),n.map.on3DView&&!n.loadingState&&n.map._on3DZoomTo({extent:i,layer:e.layer})}else e.layer.features&&e.layer.features.length>0?(n.resultsList.classList.add(r.Z.Consts.classes.HIDDEN),n.loadingState||n.layer.map.zoomToFeatures(e.layer.features),n.map.trigger(r.Z.Consts.event.FEATURESADD,{layer:n.layer,features:n.layer.features})):e.layer.features&&0===e.layer.features.length&&o.params.type===r.Z.Consts.layerType.WFS&&(n.resultsList.inner=o.emptyResultHTML,n.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")),n.map.trigger(r.Z.Consts.event.SEARCHQUERYEMPTY));n.loading.removeWait(s)})),e.layer.features&&e.layer.features.length>0?(n.resultsList.classList.add(r.Z.Consts.classes.HIDDEN),n.loadingState||n.layer.map.zoomToFeatures(n.layer.features),n.map.trigger(r.Z.Consts.event.FEATURESADD,{layer:n.layer,features:n.layer.features}),n.loading.removeWait(s)):e.layer.features&&0===e.layer.features.length&&o.params.type===r.Z.Consts.layerType.WFS&&(n.resultsList.innerHTML=o.emptyResultHTML,n.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")),e.newData&&e.newData.features&&e.newData.features.length>0||n.map.trigger(r.Z.Consts.event.SEARCHQUERYEMPTY),n.loading.removeWait(s)),i(o))};n.map.on(r.Z.Consts.event.LAYERUPDATE,l),t.wrap.reloadSource()})):(a(Error("Method goTo has no implementation")),l||n.map.trigger(r.Z.Consts.event.SEARCHQUERYEMPTY))}))},t.goToResult=function(t,e){var n=this;return n.getSearchTypeByRole(e)?n._goToResult(t,e):n.availableSearchTypes[e]?(n.addAllowedSearchType(e,n.availableSearchTypes[e],n),n._goToResult(t,e)):void alert("No se reconoce el tipo de búsqueda: "+e)};var m=function(t){var e=this;let n=e.loading.addWait();var o,i,a=e.getPoint(t);if(a)o=e.getLabel(t),i=e.layer.addMarker(a,r.Z.Util.extend({},e.map.options.styles.point,{title:o,group:o}));else{var s=/^Lat((?:[+-]?)\d+(?:\.\d+)?)Lon((?:[+-]?)\d+(?:\.\d+)?)$/.exec(t);t=e.LAT+s[2]+e.LON+s[1],(a=e.getPoint(t))&&(o=e.getLabel(t),i=e.layer.addMarker(a,r.Z.Util.extend({},e.map.options.styles.point,{title:o,group:o})),e.textInput.value=o)}i.then((function(t){e.map.trigger(r.Z.Consts.event.FEATURESADD,{layer:e.layer,features:[t]}),e.map.zoomToFeatures([t]),e.loading.removeWait(n)}))};t.goToCoordinates=function(t){var e=this,n={};return/^X([-+]?\d+(?:[\.\,]\d+)?)Y([-+]?\d+(?:[\.\,]\d+)?)$/.test(t)||/^Lat((?:[+-]?)\d+(?:[.,]\d+)?)Lon((?:[+-]?)\d+(?:[.,]\d+)?)$/.test(t)?(n.params={type:r.Z.Consts.layerType.VECTOR,styles:{marker:{url:e.layerStyleFN.bind(e,"marker","url",!0)}}},n.emptyResultHTML='<li><a class="tc-ctl-search-li-empty">'+e.OUTBBX_LABEL+"</a></li>",m.call(e,t),n):null},t.goToCadastralRef=function(t){var e=this,n={},o=new RegExp("^"+e.MUN+"(\\d+)"+e.POL+"(\\d{1,2})"+e.PAR+"{1}(\\d{1,4})");if(o.test(t)){var i=o.exec(t);r.Z.filter||r.Z.syncLoadJS(r.Z.apiLocation+"TC/Filter");var a=e.getSearchTypeByRole(r.Z.Consts.searchType.CADASTRAL);return n.params={type:r.Z.Consts.layerType.WFS,url:a.url,version:a.version,geometryName:a.geometryName,featurePrefix:a.featurePrefix,featureType:a.featureType,properties:new r.Z.filter.and(new r.Z.filter.equalTo(a.queryProperties.firstQueryWord,i[1].trim()),new r.Z.filter.equalTo(a.queryProperties.secondQueryWord,i[2].trim()),new r.Z.filter.equalTo(a.queryProperties.thirdQueryWord,i[3].trim())),outputFormat:a.outputFormat,styles:a.styles},n.emptyResultHTML='<li><a title="'+e.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+e.EMPTY_RESULTS_LABEL+"</a></li>",n}return null},t.goToRoad=function(t){var e=this,n={},o=e.getSearchTypeByRole(r.Z.Consts.searchType.ROAD);return n.params={type:r.Z.Consts.layerType.WFS,url:o.url,version:o.version,geometryName:o.geometryName,featurePrefix:o.featurePrefix,featureType:o.getFeatureTypes(),maxFeatures:3e3,properties:o.filter.getGoToFilter(t),outputFormat:o.outputFormat,styles:o.styles},n.emptyResultHTML='<li><a title="'+e.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+e.EMPTY_RESULTS_LABEL+"</a></li>",n},t.goToMilestone=function(t){var e=this,n={},o=e.getSearchTypeByRole(r.Z.Consts.searchType.ROADMILESTONE);return n.params={type:r.Z.Consts.layerType.WFS,url:o.url,version:o.version,geometryName:o.geometryName,featurePrefix:o.featurePrefix,featureType:o.getFeatureTypes(),maxFeatures:3e3,properties:o.filter.getGoToFilter(t),outputFormat:o.outputFormat,styles:o.styles},n.emptyResultHTML='<li><a title="'+e.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+e.EMPTY_RESULTS_LABEL+"</a></li>",n},t.goToStringPattern=function(t,e){var n={},o=this.getSearchTypeByRole(e);return n.params={type:r.Z.Consts.layerType.WFS,url:o.url,version:o.version,geometryName:o.geometryName,featurePrefix:o.featurePrefix,featureType:o.getFeatureTypes(),maxFeatures:3e3,properties:o.filter.getGoToFilter(t),outputFormat:o.outputFormat,styles:o.styles},n},t.getPoint=function(t){var e,n=this,o=n.map.wrap.isGeo(),i=/^X([-+]?\d+(?:\.\d+)?)Y([-+]?\d+(?:\.\d+)?)$/.exec(t);if(i&&3===i.length)e=[parseFloat(i[1]),parseFloat(i[2])],o&&(e=r.Z.Util.reproject(e,n.map.options.utmCrs,n.map.crs));else{if((i=/^Lat((?:[+-]?)\d+(?:[.,]\d+)?)Lon((?:[+-]?)\d+(?:[.,]\d+)?)$/.exec(t))&&3===i.length&&(e=[parseFloat(i[2]),parseFloat(i[1])],!o))return r.Z.Util.reproject(e,n.map.options.geoCrs,n.map.crs);if((i=/^Lon((?:[+-]?)\d+(?:[.,]\d+)?)Lat((?:[+-]?)\d+(?:[.,]\d+)?)$/.exec(t))&&3===i.length&&(e=[parseFloat(i[2]),parseFloat(i[1])],!o))return r.Z.Util.reproject(e,n.map.options.geoCrs,n.map.crs)}return e},t.insideLimit=function(t){return!!function(t,e){return!(t instanceof Array)||e[0]>=t[0]&&e[0]<=t[2]&&e[1]>=t[1]&&e[1]<=t[3]}(this.map.options.maxExtent,t)},t.getPattern=function(){return this.textInput.value},t.getLabel=function(t){var e=this,n=t,o=r.Z.Util.getMapLocale(e.map);const i=function(t,e){let n=r.Z.Util.parseCoords(e[1]+","+e[3]);return t=(t=t.replace(e[1],n[0].value.toLocaleString(o,{minimumFractionDigits:r.Z.Consts.DEGREE_PRECISION,maximumFractionDigits:r.Z.Consts.DEGREE_PRECISION}))).replace(e[3],n[1].value.toLocaleString(o,{minimumFractionDigits:r.Z.Consts.DEGREE_PRECISION,maximumFractionDigits:r.Z.Consts.DEGREE_PRECISION}))};if(t.match(new RegExp("^(?:"+e.LAT+"[-\\d])|(?:"+e.UTMX+"[-+]?[\\d])"))){let t=(n=n.replace(e.LAT,e.LAT_LABEL).replace(e.LON," "+e.LON_LABEL).replace(e.UTMX,e.UTMX_LABEL).replace(e.UTMY," "+e.UTMY_LABEL)).match(new RegExp("^"+e.LAT_LABEL.trim()+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+e.LON_LABEL.trim()+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$"));t&&(n=i(n,t));var a=1.1.toLocaleString(o).substring(1,2);t=n.match(new RegExp("^"+e.UTMX_LABEL.trim()+"*\\s*([-+]?[0-9]{"+e.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*"+e.UTMY_LABEL.trim()+"*\\s*([-+]?[0-9]{"+e.UTMY_LEN+"}(?:[.,]\\d+)?)$")),t&&(Number.isInteger(parseFloat(t[1]))||(n=n.replace(t[1],t[1].replace(".",a))),Number.isInteger(parseFloat(t[2]))||(n=n.replace(t[2],t[2].replace(".",a))))}else if(t.match(new RegExp("^(?:"+e.LON+"[-\\d])"))){const t=(n=n.replace(e.LON,e.LON_LABEL).replace(e.LAT," "+e.LAT_LABEL)).match(new RegExp("^"+e.LON_LABEL.trim()+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+e.LAT_LABEL.trim()+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$"));t&&(n=i(n,t))}else if(t.match(new RegExp("^(?:(\\"+e.MUN+"{1})(.*)(\\"+e.POL+"{1})(\\d{1,2})(\\"+e.PAR+"{1})(\\d{1,4}))"))){const r=t.match(new RegExp("^(?:(\\"+e.MUN+"{1})(.*)(\\"+e.POL+"{1})(\\d{1,2})(\\"+e.PAR+"{1})(\\d{1,4}))"));n=e.MUN_LABEL+r[2]+", "+e.POL_LABEL+r[4]+", "+e.PAR_LABEL+r[6]}return n},t.removePunctuation=function(t){t=t||"";for(var e=new Array(t.length),n=new Map([["á","a"],["à","a"],["Á","A"],["À","A"],["é","e"],["è","e"],["É","E"],["È","E"],["í","i"],["ì","i"],["Í","I"],["Ì","I"],["ó","o"],["ò","o"],["Ó","O"],["Ò","O"],["ú","u"],["ù","u"],["ü","u"],["Ú","U"],["Ù","U"],["Ü","U"]]),r=0,o=t.length;r<o;r++)e[r]=n.get(t.charAt(r))||t.charAt(r);return e.join("")},t.exportState=function(){const t=this;return t.toShare?{id:t.id,searchText:t.textInput&&t.textInput.value,searchResult:JSON.stringify(t.toShare)}:null},t.importState=function(t){const e=this;if(t.searchResult){let n=JSON.parse(t.searchResult);n.id&&n.dataRole?(n.doZoom&&e.map.one(r.Z.Consts.event.FEATURESADD,(function(t){t.layer===e.layer&&e.layer.map.zoomToFeatures(t.layer.features)})),e.loadingState=!0,e.goToResult(n.id,n.dataRole).then((function(){delete e.loadingState,e.textInput.value=t.searchText,e.shareButton&&e.shareButton.classList.remove(r.Z.Consts.classes.HIDDEN),e.loading.reset()}))):alert("shared results error")}}}(),String.prototype.tcFormat||(String.prototype.tcFormat=function(){var t=(arguments||[""])[0];return this.replace(/{(\d+)}/g,(function(e,n){return void 0!==t[n]?t[n]:e}))}),String.prototype.splitRemoveWhiteSpaces||(String.prototype.splitRemoveWhiteSpaces=function(t){for(var e=[],n=this.split(t),r=0;r<n.length;r++)n[r].trim().length>0&&e.push(n[r].trim());return e}),String.prototype.toCamelCase||(String.prototype.toCamelCase=function(){var t=this.toLowerCase(),e=this.toLowerCase().match(/[^A-ZÁÉÍÓÚÜÀÈÌÒÙáéíóúüàèìòùa-z0-9_]+(.)/g);if(e)for(var n=0;n<e.length;n++)/[-;:.<>\{\}\[\]\/\s()]/g.test(e[n])&&(t=t.replace(e[n],e[n].toUpperCase()));return t.charAt(0).toUpperCase()+t.substring(1)}),Array.prototype.hasOwnProperty("findByProperty")||Object.defineProperty(Array.prototype,"findByProperty",{enumerable:!1,writable:!0,value:function(t,e){for(var n=0;n<this.length;n++)if(this[n][t]==e)return this[n]}}),String.prototype.endsWith||(String.prototype.endsWith=function(t,e){var n=this.toString();("number"!=typeof e||!isFinite(e)||Math.floor(e)!==e||e>n.length)&&(e=n.length),e-=t.length;var r=n.indexOf(t,e);return-1!==r&&r===e});const p=r.Z.control.Search},2780:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>i});var r=n(5361),o=n(8719);r.Z.control=r.Z.control||{},r.Z.control.SelectContainer=o.default;const i=r.Z.control.SelectContainer},956:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var r,o=n(5361),i=n(2089),a=n(2e3);o.Z.Consts=i.Z,o.Z.control=o.Z.control||{},o.Z.control.MapInfo=a.default,o.Z.control.Share=function(t){var e=this;e._classSelector="."+e.CLASS,o.Z.Control.apply(e,arguments),e.exportsState=!0;var n=t||{};e._dialogDiv=o.Z.Util.getDiv(n.dialogDiv),window.$&&(e._$dialogDiv=$(e._dialogDiv)),n.dialogDiv||document.body.appendChild(e._dialogDiv),e.render()},o.Z.inherit(o.Z.control.Share,o.Z.control.MapInfo),(r=o.Z.control.Share.prototype).CLASS="tc-ctl-share",r.MAILTO_MAX_LENGTH=256,r.IFRAME_WIDTH="600px",r.IFRAME_HEIGHT="450px",r.FEATURE_PARAM="showfeature",r.MOBILEFAV="Siga las instrucciones del navegador del dispositivo móvil para añadir como favorito. Se guardará el estado actual del mapa.",r.NAVALERT=" +D para guardar en marcadores.",r.render=function(t){const e=this;return e._set1stRenderPromise(e.getRenderedHtml(e.CLASS+"-dialog",null,(function(t){e._dialogDiv.innerHTML=t})).then((function(){return o.Z.Control.prototype.renderData.call(e,{controlId:e.id},(function(){document.queryCommandSupported&&document.queryCommandSupported("copy")&&(e.div.querySelectorAll("button").forEach((function(t){t.classList.remove("hide")})),e.div.querySelectorAll("input[type=text]").forEach((function(t){delete t.dataset.dataOriginalTitle}))),o.Z.Util.detectMobile()||e.div.querySelector(".share-whatsapp").classList.add(o.Z.Consts.classes.HIDDEN);const n=e.div.querySelectorAll("."+e.CLASS+"-url-box");e.div.querySelectorAll("span:not(.tc-beta)").forEach((function(t){t.addEventListener(o.Z.Consts.event.CLICK,(function(t){for(var r=this;r&&"LABEL"!==r.tagName;)r=r.parentElement;const i=r.querySelector(`input[type=radio][name="${e.id}-format"]`).value;n.forEach((function(t){t.classList.toggle(o.Z.Consts.classes.HIDDEN,!t.matches(".tc-"+i))}))}),{passive:!0})})),o.Z.Util.isFunction(t)&&t()}))})))},r.getLocation=function(){var t=window.location.href;return window.location.hash&&(t=t.substr(0,t.indexOf(window.location.hash))),t},r.manageMaxLengthExceed=function(t){const e=this;e.div.querySelector("."+e.CLASS+"-alert").classList.toggle(o.Z.Consts.classes.HIDDEN,!t.browser),e._dialogDiv.querySelector("."+e.CLASS+"-qr-alert").classList.toggle(o.Z.Consts.classes.HIDDEN,!t.qr)},r.generateIframe=async function(t){const e=this,n=t||await e.generateLink();return n?'<iframe style="width:'+e.IFRAME_WIDTH+";height:"+e.IFRAME_HEIGHT+';" src="'+n+'"></iframe>':""},r.loadParamFeature=function(){const t=this;var e=null,n=o.Z.Util.getParameterByName(t.FEATURE_PARAM);if(n){var r;try{r=JSON.parse(decodeURIComponent(escape(window.atob(n))))}catch(e){o.Z.error(t.getLocaleString("sharedFeatureNotValid"),o.Z.Consts.msgErrorMode.TOAST)}r&&t.map&&(r.geom?t.map.addLayer({id:t.getUID(),type:o.Z.Consts.layerType.VECTOR,title:t.getLocaleString("foi"),owner:t,stealth:!0}).then((function(e){t.paramFeatureLayer=e,e.importState({features:[r]}).then((function(){t.map.zoomToFeatures(e.features)}))})):e=r)}return e},r.update=async function(){const t=this,e=t.div.querySelector(".tc-url input[type=text]");if(0===e.value.trim().length){const n=await t.generateLink();t.registerListeners(),e.value=n,t.div.querySelector(".tc-iframe input[type=text]").value=await t.generateIframe(n)}},r.register=function(t){const e=this,n=o.Z.control.MapInfo.prototype.register.call(e,t);return n.then((function(){e.exportsState=!0,e.MOBILEFAV=e.getLocaleString("mobileBookmarks.instructions"),e.NAVALERT=e.getLocaleString("bookmarks.instructions"),e.div.addEventListener("click",o.Z.EventTarget.listenerBySelector("h2",(function(t){e.update()}))),e.map.on(o.Z.Consts.event.MAPCHANGE,function(t){const e=this.div.querySelector(".tc-url input[type=text]");e&&(e.dataset.update=!0),delete this.map._controlStatesCache}.bind(e));var n=async function(t,n){const r=t.parentElement.querySelector("input[type=text]");n?!r.dataset.update&&r.dataset.shortened||e.shortenedLink().then((async function(n){n&&n.trim().length>0?(t.textContent=e.getLocaleString("shortened"),setTimeout((function(){t.textContent=e.getLocaleString("shorten"),i()}),1e3),delete r.dataset.update,r.dataset.shortened=!0,r.value=n,r.select()):(delete r.dataset.update,delete r.dataset.shortened,r.value=await e.generateLink())})):(r.classList.contains("tc-url")?r.dataset.update&&(delete r.dataset.update,delete r.dataset.shortened,r.value=await e.generateLink()):r.value=await e.generateIframe(),r.select())},i=function(){document.getSelection().removeAllRanges(),document.getSelection().addRange(document.createRange())};e.div.addEventListener("click",o.Z.EventTarget.listenerBySelector(".tc-ctl-share-url-box button",(function(t){const r=t.target,o=!r.classList.contains("shorten");o?async function(){await n(r),document.execCommand("copy"),r.textContent=e.getLocaleString("copied"),setTimeout((function(){r.textContent=e.getLocaleString(o?"copy":"shorten"),i()}),1e3)}():n(r,!0)}))),e.div.addEventListener("click",o.Z.EventTarget.listenerBySelector("input[type=text]",(function(t){n(t.target)}))),e.div.addEventListener("click",o.Z.EventTarget.listenerBySelector(".ga-share-icon.tc-disabled",(function(t){return t.stopImmediatePropagation(),t.preventDefault(),!1}))),e.div.addEventListener("click",o.Z.EventTarget.listenerBySelector("a.share-email",(async function(n){n.preventDefault(),e.shortenedLink().then((function(n){if(n){const r=encodeURIComponent(n+"\n");r.length>e.MAILTO_MAX_LENGTH&&t.toast(e.getLocaleString("urlTooLongForMailto"),{type:o.Z.Consts.msgType.WARNING}),window.location.href="mailto:?body="+r}}))}))),e.div.addEventListener("click",o.Z.EventTarget.listenerBySelector("a.qr-generator",(function(t){t.preventDefault();const n=e._dialogDiv.querySelector(".qrcode");n.innerHTML="",e._dialogDiv.querySelector("."+e.CLASS+"-qr-alert").classList.contains(o.Z.Consts.classes.HIDDEN)?e.makeQRCode(n,256,256).then((function(t){t&&o.Z.Util.showModal(e._dialogDiv.querySelector(e._classSelector+"-qr-dialog"))})):o.Z.Util.showModal(e._dialogDiv.querySelector(e._classSelector+"-qr-dialog"))})));const a=function(t,n,r){n&&n.trim().length>0?t.location.href=r(n):(o.Z.error(e.getLocaleString("urlTooLongForShortener")),t.close())};e.div.addEventListener("click",o.Z.EventTarget.listenerBySelector("a.share-fb",(function(t){t.preventDefault();const n=window.open();return e.shortenedLink().then((function(t){a(n,t,(function(t){return"https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(t)}))})),!1}))),e.div.addEventListener("click",o.Z.EventTarget.listenerBySelector("a.share-twitter",(function(t){t.preventDefault();const n=window.open();return e.shortenedLink().then((function(t){a(n,t,(function(t){return"https://twitter.com/intent/tweet?text="+encodeURIComponent(window.document.title?window.document.title:"Visor API SITNA")+"&url="+encodeURIComponent(t)}))})),!1}))),o.Z.Util.detectMobile()&&e.div.addEventListener("click",o.Z.EventTarget.listenerBySelector("a.share-whatsapp",(function(t){return t.preventDefault(),e.shortenedLink().then((async function(t){var n="whatsapp://send?text=";location.href=void 0!==t?n+encodeURIComponent(t):n+encodeURIComponent(await e.generateLink())})),!1}))),e.div.addEventListener("click",o.Z.EventTarget.listenerBySelector("a.share-star",(async function(t){t.preventDefault();var n=await e.generateLink(),i=document.title;return o.Z.Util.detectMobile()?alert(r.MOBILEFAV):window.sidebar&&window.sidebar.addPanel?window.sidebar.addPanel(i,n,""):window.sidebar&&/Firefox/i.test(navigator.userAgent)||window.opera&&window.print?(window.location.href=n,alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+r.NAVALERT)):window.external&&"AddFavorite"in window.external?window.external.AddFavorite(n,i):(window.location.href=n,alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+r.NAVALERT)),!1}))),t.loaded((()=>{e.div.classList.contains(o.Z.Consts.classes.COLLAPSED)||e.update()}))})),n},r.template={},r.template[r.CLASS]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lambda,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+a(l(n,"i18n").call(i,"share",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:4},end:{line:1,column:20}}}))+' </h2>\r\n<div>\r\n    <div class="ga-share-icons"><a class="ga-share-icon share-email" target="_blank" data-toggle="tooltip" data-placement="top" title="'+a(l(n,"i18n").call(i,"sendMapByEmail",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:135},end:{line:3,column:160}}}))+'"\r\n        href="#">\r\n        <i class="icon-envelope-alt"></i>\r\n        </a><a class="ga-share-icon qr-generator" target="_blank" data-toggle="tooltip" data-placement="top" title="'+a(l(n,"i18n").call(i,"createQrCode",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:116},end:{line:6,column:139}}}))+'"\r\n        href="#">\r\n        <i class="icon-qrcode"></i>\r\n        </a><a class="ga-share-icon share-fb" target="_blank" data-toggle="tooltip" data-placement="top" title="'+a(l(n,"i18n").call(i,"shareMapToFacebook",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:112},end:{line:9,column:141}}}))+'"\r\n        href="#">\r\n        <i class="icon-facebook"></i>\r\n        </a><a class="ga-share-icon share-twitter" target="_blank" data-toggle="tooltip" data-placement="top" title="'+a(l(n,"i18n").call(i,"shareMapToTwitter",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:117},end:{line:12,column:145}}}))+'"\r\n        href="#">\r\n        <i class="icon-twitter"></i>\r\n        </a><a class="ga-share-icon share-whatsapp" target="_blank" data-toggle="tooltip" data-placement="top" title="'+a(l(n,"i18n").call(i,"shareMapToWhatsapp",{name:"i18n",hash:{},data:o,loc:{start:{line:15,column:118},end:{line:15,column:147}}}))+'"\r\n        href="#">\r\n        <i class="icon-whatsapp"></i>\r\n        </a><a class="ga-share-icon share-star" target="_blank" data-toggle="tooltip" data-placement="top" title="'+a(l(n,"i18n").call(i,"addToBookmarks",{name:"i18n",hash:{},data:o,loc:{start:{line:18,column:114},end:{line:18,column:139}}}))+'"\r\n        href="#">\r\n        <i class="icon-star"></i>\r\n        </a>\r\n    </div>\r\n    <div class="tc-ctl-share-select">\r\n        <label class="tc-ctl-share-btn-url" title="'+a(l(n,"i18n").call(i,"shareLink",{name:"i18n",hash:{},data:o,loc:{start:{line:24,column:51},end:{line:24,column:71}}}))+'"><input type="radio" checked="checked" name="'+a(s(null!=e?l(e,"controlId"):e,e))+'-format" value="url" /><span>'+a(l(n,"i18n").call(i,"shareLink",{name:"i18n",hash:{},data:o,loc:{start:{line:24,column:159},end:{line:24,column:179}}}))+'</span></label><label \r\n\t\tclass="tc-ctl-share-btn-iframe" title="'+a(l(n,"i18n").call(i,"embedMap",{name:"i18n",hash:{},data:o,loc:{start:{line:25,column:41},end:{line:25,column:60}}}))+'"><input type="radio" name="'+a(s(null!=e?l(e,"controlId"):e,e))+'-format" value="iframe" /><span>'+a(l(n,"i18n").call(i,"embedMap",{name:"i18n",hash:{},data:o,loc:{start:{line:25,column:133},end:{line:25,column:152}}}))+'</span></label>\r\n    </div>\r\n    <div class="tc-ctl-share-url-box tc-group tc-url">\r\n        <input type="text" class="tc-textbox tc-url" readonly data-toggle="tooltip" data-placement="top" title="'+a(l(n,"i18n").call(i,"shareLink.tip.1",{name:"i18n",hash:{},data:o,loc:{start:{line:28,column:112},end:{line:28,column:138}}}))+'" />\r\n        <button type="button" class="tc-button hide shorten" title="'+a(l(n,"i18n").call(i,"shareLink.tip.3",{name:"i18n",hash:{},data:o,loc:{start:{line:29,column:68},end:{line:29,column:94}}}))+'">'+a(l(n,"i18n").call(i,"shorten",{name:"i18n",hash:{},data:o,loc:{start:{line:29,column:96},end:{line:29,column:114}}}))+'</button>\r\n        <button type="button" class="tc-button hide" title="'+a(l(n,"i18n").call(i,"shareLink.tip.2",{name:"i18n",hash:{},data:o,loc:{start:{line:30,column:60},end:{line:30,column:86}}}))+'">'+a(l(n,"i18n").call(i,"copy",{name:"i18n",hash:{},data:o,loc:{start:{line:30,column:88},end:{line:30,column:103}}}))+'</button>\r\n    </div>\r\n    <div class="tc-ctl-share-url-box tc-group tc-iframe tc-hidden">\r\n        <input type="text" class="tc-textbox tc-iframe" readonly data-toggle="tooltip" data-placement="top" title="'+a(l(n,"i18n").call(i,"embedMap.tip.1",{name:"i18n",hash:{},data:o,loc:{start:{line:33,column:115},end:{line:33,column:140}}}))+'" />\r\n        <button type="button" class="tc-button hide" title="'+a(l(n,"i18n").call(i,"embedMap.tip.2",{name:"i18n",hash:{},data:o,loc:{start:{line:34,column:60},end:{line:34,column:85}}}))+'">'+a(l(n,"i18n").call(i,"copy",{name:"i18n",hash:{},data:o,loc:{start:{line:34,column:87},end:{line:34,column:102}}}))+'</button>\r\n    </div>\r\n    <div class="tc-ctl-share-alert tc-alert alert-warning tc-hidden">\r\n        <p>'+a(l(n,"i18n").call(i,"tooManyLayersLoaded",!0,{name:"i18n",hash:{},data:o,loc:{start:{line:37,column:11},end:{line:37,column:46}}}))+"</p>\r\n    </div>    \r\n</div>\r\n"},useData:!0},r.template[r.CLASS+"-dialog"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-share-qr-dialog tc-modal">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+a(s(n,"i18n").call(i,"qrCode",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:16},end:{line:5,column:33}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <div class="qrcode"></div>      \r\n            <div class="tc-ctl-share-qr-alert tc-alert alert-warning tc-hidden">\r\n                <p>'+a(s(n,"i18n").call(i,"qrAdvice",!0,{name:"i18n",hash:{},data:o,loc:{start:{line:11,column:19},end:{line:11,column:43}}}))+'</p>\r\n            </div>\r\n        </div>\r\n        <div class="tc-modal-footer">\r\n            <button type="button" class="tc-button tc-modal-close">'+a(s(n,"i18n").call(i,"close",{name:"i18n",hash:{},data:o,loc:{start:{line:15,column:67},end:{line:15,column:83}}}))+"</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},useData:!0},r.generateLink=async function(){const t=this,e=t.div.querySelector(".ga-share-icons"),n=t.div.querySelectorAll(`.${t.CLASS}-url-box tc-textbox`),r=t.div.querySelectorAll(`.${t.CLASS}-url-box button`),i=t.div.querySelector("."+t.CLASS+"-alert");e.classList.add(o.Z.Consts.classes.LOADING),n.forEach((t=>t.disabled=!0)),r.forEach((t=>{t.classList.add(o.Z.Consts.classes.LOADING),t.disabled=!0})),i.classList.add(o.Z.Consts.classes.LOADING);const a=await o.Z.control.MapInfo.prototype.generateLink.call(t);return n.forEach((t=>t.disabled=!1)),r.forEach((t=>{t.disabled=!1,t.classList.remove(o.Z.Consts.classes.LOADING)})),e.classList.remove(o.Z.Consts.classes.LOADING),i.classList.remove(o.Z.Consts.classes.LOADING),a};const s=o.Z.control.Share},1475:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>a});var r=n(5361),o=n(2089),i=n(6498);r.Z.Consts=o.Z,r.Z.control=r.Z.control||{},r.Z.Control=i.Z,function(){r.Z.Consts.url.GOOGLEMAPS="//maps.googleapis.com/maps/api/js?v=3";var t=r.Z.Consts.url.GOOGLEMAPS;r.Z.Cfg.proxyExceptions=r.Z.Cfg.proxyExceptions||[],r.Z.Cfg.proxyExceptions.push(r.Z.Consts.url.GOOGLEMAPS),r.Z.control.StreetView=function(){var t=this;t._sv=null,t._mapActiveControl=null,r.Z.Control.apply(t,arguments),t.viewDiv=null,t._startLonLat=null},r.Z.inherit(r.Z.control.StreetView,r.Z.Control);var e=r.Z.control.StreetView.prototype;e.CLASS="tc-ctl-sv",e.template={},e.template[e.CLASS]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-sv-btn" title="'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"sv.tip",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:34},end:{line:1,column:51}}}))+'">\r\n    <div class="tc-ctl-sv-drag"></div>\r\n</div>'},useData:!0},e.template[e.CLASS+"-view"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-sv-btn-close" title="'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"closeStreetView",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:40},end:{line:1,column:66}}}))+'"></div>'},useData:!0};const n=function(){var t=document.createEvent("HTMLEvents");t.initEvent("resize",!0,!1),this.map.div.querySelector("canvas").dispatchEvent(t)};var o=function(t){const e=t.viewDiv,o=function(){e.removeEventListener("transitionend",o),n.call(t)};e.addEventListener("transitionend",o),setTimeout((function(){n.call(t)}),1e3),t.layer.clearFeatures(),t.div.querySelector("."+t.CLASS+"-btn").classList.remove(r.Z.Consts.classes.CHECKED),t.div.querySelector("."+t.CLASS+"-drag").classList.remove(r.Z.Consts.classes.HIDDEN),t.map.div.classList.remove(t.CLASS+"-active"),t._startLonLat=null};e.register=function(e){const n=this;n.viewDiv||(n.viewDiv=r.Z.Util.getDiv(n.options.viewDiv),n.viewDiv.classList.add(n.CLASS+"-view",r.Z.Consts.classes.HIDDEN),n.options.viewDiv||e.div.insertAdjacentElement("beforebegin",n.viewDiv));const i=r.Z.Control.prototype.register.call(n,e),a=n.options.googleMapsKey||e.options.googleMapsKey;a&&(t+="&key="+a),n.layer=null;for(var s=n.getUID(),l=0;l<e.workLayers.length;l++){var c=e.workLayers[l];if(c.type===r.Z.Consts.layerType.VECTOR&&c.id===s){n.layer=c;break}}return n.layer||e.loaded((function(){e.addLayer({id:s,owner:n,stealth:!0,type:r.Z.Consts.layerType.VECTOR}).then((function(t){n.layer=t}))})),n.renderPromise().then((function(){r.Z.loadJS(!window.Draggabilly,[r.Z.apiLocation+r.Z.Consts.url.DRAGGABILLY],(function(){const t=new Draggabilly(n.div.querySelector("."+n.CLASS+"-drag"),{containment:n.map.div});t.on("dragStart",(function(t){var e;(e=n).div.querySelector("."+e.CLASS+"-btn").classList.add(r.Z.Consts.classes.CHECKED),e.map.div.classList.add(e.CLASS+"-active")})),t.on("dragEnd",(function(e){!function(t){var e=!1;const n=t.div.querySelector("."+t.CLASS+"-btn"),i=t.div.querySelector("."+t.CLASS+"-drag");var a=n.getBoundingClientRect(),s=i.getBoundingClientRect();if(i.classList.add(r.Z.Consts.classes.HIDDEN),s.top<a.top||s.top>a.bottom||s.left<a.left||s.left>a.right){e=!0;for(var l=t.map.getExtent(),c=[l[2],l[3]],u=0;u<16;u++)t.layer.addMarker(c,{cssClass:"tc-marker-sv-"+u,width:48,height:48,anchor:[0,1]});var p=t.map.div.getBoundingClientRect(),d=(s.left*window.devicePixelRatio+s.right*window.devicePixelRatio)/2-p.left*window.devicePixelRatio,h=s.bottom*window.devicePixelRatio-p.top*window.devicePixelRatio,f=t.map.wrap.getCoordinateFromPixel([d,h]);t.callback(f)}else o(t)}(n),t.setPosition(0,0)}))}));n.viewDiv.querySelector("."+n.CLASS+"-btn-close").addEventListener(r.Z.Consts.event.CLICK,(function(t){t.stopPropagation(),n.closeView()}),{passive:!0})}),(function(){r.Z.error("Error de renderizado StreetView")})),i},e.render=function(){const t=this;return t._set1stRenderPromise(new Promise((function(e,n){t.renderData(null,(function(){t.getRenderedHtml(t.CLASS+"-view",null).then((function(n){setTimeout((function(){t.viewDiv.innerHTML=n,e(t)}),300)})).catch((function(t){r.Z.error(t)}))}))})))};var i=0;e.callback=function(e){var a=this,s="EPSG:4326",l=function(t){if(a._sv){var e=t.getBounds();const n=r.Z.Util.reproject([(e[0]+e[2])/2,(e[1]+e[3])/2],a.map.crs,s);a._sv.setPosition({lng:n[0],lat:n[1]})}},c=function(t){if(a._sv){var e=t.getBounds();a._startLonLat=r.Z.Util.reproject([(e[0]+e[2])/2,(e[1]+e[3])/2],a.map.crs,s)}},u=a.map.getLoadingIndicator();u&&(i=u.addWait(i));const p=a.map.div;var d=function(t,n){var o,i;if(a.layer.clearFeatures(),t){var u=t.getPosition();o=r.Z.Util.reproject([u.lng(),u.lat()],s,a.map.crs),i=t.getPov().heading}else o=e,i=0;if(a.map.addMarker(o,{cssClass:"tc-marker-sv-"+(Math.round(16*i/360)+16)%16,width:48,height:48,anchor:[.4791666666666667,.7083333333333333],layer:a.layer,showsPopup:!1}),Promise.all(a.map._markerPromises).then((function(){a.layer.wrap.setDraggable(!0,l,c)})),n){var d=function(){a.map.setCenter(o)};p.classList.contains(r.Z.Consts.classes.COLLAPSED)?d():setTimeout(d,1200)}};r.Z.loadJS(!window.google||!google.maps,t,(function(){if(window.google){d();const t=a.viewDiv,l=r.Z.Util.reproject(e,a.map.crs,s),c=new google.maps.LatLng(l[1],l[0]);(new google.maps.StreetViewService).getPanorama({location:c,preference:google.maps.StreetViewPreference.BEST},(function(e,s){if(s!==google.maps.StreetViewStatus.OK)u&&u.removeWait(i),setTimeout((function(){r.Z.alert(s===google.maps.StreetViewStatus.ZERO_RESULTS?a.getLocaleString("noStreetView"):a.getLocaleString("streetViewUnknownError")),a.layer.wrap.setDraggable(!1),o(a)}),100);else{const e=function(o){if(a._transitioning&&("width"===o.propertyName||"height"===o.propertyName)){a._transitioning=!1,u&&u.removeWait(i);const o=document.createEvent("HTMLEvents");o.initEvent("resize",!1,!1),p.dispatchEvent(o),n.call(a),t.removeEventListener("transitionend",e);var s={position:c,pov:{heading:0,pitch:0},zoom:1,fullscreenControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},panControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},imageDateControl:!0};a._sv?(a._sv.setOptions(s),a._sv.setVisible(!0)):(a._sv=new google.maps.StreetViewPanorama(t,s),google.maps.event.addListener(a._sv,"position_changed",(function(){d(a._sv,t.classList.contains(r.Z.Consts.classes.VISIBLE))})),google.maps.event.addListener(a._sv,"pov_changed",(function(){if(a.layer.features&&a.layer.features.length>0){var t=a.layer.features[0];delete t.options.url,t.options.cssClass="tc-marker-sv-"+(Math.round(16*a._sv.getPov().heading/360)+16)%16,t.setStyle(t.options)}})),google.maps.event.addListener(a._sv,"status_changed",(function(){var t=a._sv.getStatus();t!==google.maps.StreetViewStatus.OK&&(a._sv.setVisible(!1),r.Z.alert(t===google.maps.StreetViewStatus.ZERO_RESULTS?a.getLocaleString("noStreetView"):a.getLocaleString("streetViewUnknownError")),a._startLonLat?(a._sv.setVisible(!0),a._sv.setPosition({lng:a._startLonLat[0],lat:a._startLonLat[1]})):(a.layer.wrap.setDraggable(!1),a.closeView()))})))}};if(a._transitioning=!0,t.addEventListener("transitionend",e),!a.options.viewDiv){const t=p.getBoundingClientRect();a.viewDiv.style.height=t.height+"px",a.viewDiv.style.width=t.width+"px"}p.classList.add(r.Z.Consts.classes.COLLAPSED),t.style.left="",t.style.top="",t.classList.remove(r.Z.Consts.classes.HIDDEN),t.classList.add(r.Z.Consts.classes.VISIBLE),setTimeout((function(){e({propertyName:"width"})}),1e3);const o=document.body.querySelector("header");o&&(o.style.display="none"),a.map.activeControl&&(a._previousActiveControl=a.map.activeControl,a.map.activeControl.deactivate(!0)),d(a._sv)}}))}else o(a)}),!1,!0)},e.closeView=function(){const t=this,e=t.map.div,n=t.viewDiv,i=function(){e.classList.remove(r.Z.Consts.classes.COLLAPSED);const t=document.createEvent("HTMLEvents");t.initEvent("resize",!1,!1),e.dispatchEvent(t)},a="transitionend",s=function(t){"width"!==t.propertyName&&"height"!==t.propertyName||(n.removeEventListener(a,s),i())};n.removeEventListener(a,s),n.addEventListener(a,s),setTimeout(i,1e3),t.options.viewDiv||(t.viewDiv.style.removeProperty("height"),t.viewDiv.style.removeProperty("width")),n.classList.add(r.Z.Consts.classes.HIDDEN),n.classList.remove(r.Z.Consts.classes.VISIBLE),t.div.querySelector("."+t.CLASS+"-drag").classList.remove(r.Z.Consts.classes.HIDDEN),t.layer.wrap.setDraggable(!1),o(t),t._sv.setVisible(!1);const l=document.body.querySelector("header");l&&(l.style.display=""),t._previousActiveControl&&t._previousActiveControl.activate()}}();const a=r.Z.control.StreetView},3869:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>a});var r=n(5361),o=n(2089),i=n(6595);r.Z.Consts=o.Z,r.Z.control=r.Z.control||{},r.Z.control.MapContents=i.default,r.Z.control.TOC=function(){var t=this;r.Z.control.MapContents.apply(t,arguments)},r.Z.inherit(r.Z.control.TOC,r.Z.control.MapContents),function(){var t=r.Z.control.TOC.prototype;t.CLASS="tc-ctl-toc",t.template={},t.template[t.CLASS]={1:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-toc-wlbranch"),e,{name:"tc-ctl-toc-wlbranch",data:o,indent:"        ",helpers:n,partials:r,decorators:t.decorators}))?i:""},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+s(l(n,"i18n").call(a,"worklayers",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:4},end:{line:1,column:25}}}))+'</h2>\r\n<div class="tc-ctl-toc-tree">\r\n    <div class="tc-ctl-toc-empty">'+s(l(n,"i18n").call(a,"noData",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:34},end:{line:3,column:51}}}))+'</div>\r\n    <ul class="tc-ctl-toc-branch tc-ctl-toc-wl">\r\n'+(null!=(i=l(n,"each").call(a,null!=e?l(e,"workLayers"):e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:5,column:8},end:{line:7,column:17}}}))?i:"")+"    </ul>\r\n</div>"},usePartial:!0,useData:!0},t.template[t.CLASS+"-branch"]={1:function(t,e,n,r,o){return'class="tc-ctl-toc-node"'},3:function(t,e,n,r,o){return'class="tc-ctl-toc-node tc-ctl-toc-leaf"'},5:function(t,e,n,r,o){return" checked"},7:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-toc-node"),e,{name:"tc-ctl-toc-node",data:o,indent:"            ",helpers:n,partials:r,decorators:t.decorators}))?i:""},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lambda,l=t.escapeExpression,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<li "+(null!=(i=c(n,"if").call(a,null!=e?c(e,"children"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(3,o,0),data:o,loc:{start:{line:1,column:4},end:{line:1,column:97}}}))?i:"")+' data-layer-name="'+l(s(null!=e?c(e,"name"):e,e))+'" data-layer-uid="'+l(s(null!=e?c(e,"uid"):e,e))+'">\r\n    <button type="button" class="tc-ctl-toc-collapse-btn"></button>\r\n    <input type="checkbox" class="tc-ctl-toc-branch-cb tc-toggle" name="toc" value="'+l(s(null!=e?c(e,"name"):e,e))+'"'+(null!=(i=c(n,"if").call(a,null!=e?c(e,"isVisible"):e,{name:"if",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:93},end:{line:3,column:125}}}))?i:"")+" /><span>"+l(s(null!=e?c(e,"title"):e,e))+'</span>\r\n    <ul class="tc-ctl-toc-branch">\r\n'+(null!=(i=c(n,"each").call(a,null!=e?c(e,"children"):e,{name:"each",hash:{},fn:t.program(7,o,0),inverse:t.noop,data:o,loc:{start:{line:5,column:8},end:{line:7,column:17}}}))?i:"")+"    </ul>\r\n</li>"},usePartial:!0,useData:!0},t.template[t.CLASS+"-node"]={1:function(t,e,n,r,o){return'class="tc-ctl-toc-node"'},3:function(t,e,n,r,o){return'class="tc-ctl-toc-node tc-ctl-toc-leaf"'},5:function(t,e,n,r,o){return'<button type="button" class="tc-ctl-toc-collapse-btn"></button>'},7:function(t,e,n,r,o){return" checked"},9:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-toc-node"),e,{name:"tc-ctl-toc-node",data:o,indent:"            ",helpers:n,partials:r,decorators:t.decorators}))?i:""},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lambda,l=t.escapeExpression,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<li "+(null!=(i=c(n,"if").call(a,null!=e?c(e,"children"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(3,o,0),data:o,loc:{start:{line:1,column:4},end:{line:1,column:97}}}))?i:"")+' data-layer-name="'+l(s(null!=e?c(e,"name"):e,e))+'" data-layer-uid="'+l(s(null!=e?c(e,"uid"):e,e))+'">\r\n    '+(null!=(i=c(n,"if").call(a,null!=e?c(e,"children"):e,{name:"if",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:4},end:{line:2,column:90}}}))?i:"")+'\r\n    <input type="checkbox" class="tc-toggle" name="toc" value="'+l(s(null!=e?c(e,"name"):e,e))+'"'+(null!=(i=c(n,"if").call(a,null!=e?c(e,"isVisible"):e,{name:"if",hash:{},fn:t.program(7,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:72},end:{line:3,column:104}}}))?i:"")+" /><span>"+l(s(null!=e?c(e,"title"):e,e))+'</span>\r\n    <ul class="tc-ctl-toc-branch">\r\n'+(null!=(i=c(n,"each").call(a,null!=e?c(e,"children"):e,{name:"each",hash:{},fn:t.program(9,o,0),inverse:t.noop,data:o,loc:{start:{line:5,column:8},end:{line:7,column:17}}}))?i:"")+"    </ul>\r\n</li>"},usePartial:!0,useData:!0};t.register=function(t){const e=this,n=r.Z.control.MapContents.prototype.register.call(e,t);return t.on(r.Z.Consts.event.EXTERNALSERVICEADDED,(function(t){e.onExternalServiceAdded(t)})),n},t.onExternalServiceAdded=function(t){const e=this;t&&t.layer&&(t.layer.map=e.map,e.map.addLayer(t.layer).then((function(n){e.updateLayerTree(t.layer)})))},t.addUIEventListeners=function(){const t=this;t.div.addEventListener("click",r.Z.EventTarget.listenerBySelector("input[type=checkbox]",(function(e){const n=e.target;for(var r=n;r&&!r.matches("ul."+t.CLASS+"-wl");)r=r.parentElement;const o=[];var i;for(i=0;i<r.children.length;i++){const t=r.children[i];"LI"===t.tagName&&o.push(t)}for(i=0;i<o.length;i++){const e=o[i];if(e.contains(n)){const r=t.map.getLayer(e.dataset.layerId);var a=n;do{a=a.parentElement}while(a&&"LI"!==a.tagName&&!r.getNodeVisibility(a.dataset.layerUid));const o=a.dataset.layerUid;r.setNodeVisibility(o,n.checked);break}}e.stopPropagation()}))),t.div.addEventListener(r.Z.Consts.event.MOUSEUP,r.Z.EventTarget.listenerBySelector("button."+t.CLASS+"-collapse-btn",(function(e){e.target.blur();const n=e.target.parentElement;if(!n.classList.contains(t.CLASS+"-leaf")){n.classList.toggle(r.Z.Consts.classes.COLLAPSED);n.querySelector("ul").classList.toggle(r.Z.Consts.classes.COLLAPSED),e.stopPropagation()}})))},t.update=function(t){var e=function(t){for(var e=0,n=t.children.length;e<n;e++){const n=t.children[e];if(n.matches("input[type=checkbox]"))return n}return null};const n=this.getLayerUIElements().find((e=>e.dataset.layerId===t.id));if(!n)return;e(n).checked=t.getVisibility(),t.tree=null;const o=t.getTree(!0);n.querySelectorAll("li").forEach((function(n){const i=e(n),a=n.dataset.layerUid;switch(t.getNodeVisibility(a,o)){case r.Z.Consts.visibility.VISIBLE:i.checked=!0,i.indeterminate=!1;break;case r.Z.Consts.visibility.NOT_VISIBLE:i.checked=!1,i.indeterminate=!1;break;case r.Z.Consts.visibility.NOT_VISIBLE_AT_RESOLUTION:i.checked=!0,i.indeterminate=!1;break;case r.Z.Consts.visibility.HAS_VISIBLE:case null:i.checked=!1,i.indeterminate=!0;break;default:{const e=t.findNode(a,o),n=!Object.prototype.hasOwnProperty.call(e,"isVisible")||e.isVisible;i.checked=n,i.indeterminate=!1}}}))},t.updateScale=function(t){const e=this,n=function(t,n){t&&t.querySelectorAll("li").forEach((function(t){const r=t.dataset.layerUid;t.classList.toggle(e.CLASS+"-node-notvisible",!n.isVisibleByScale(r))}))};t?n(e.getLayerUIElements().find((e=>e.dataset.layerId===t.id)),t):e.getLayerUIElements().forEach((function(t){n(t,e.map.getLayer(t.dataset.layerId))}))},t.updateLayerTree=function(t){var e=this;t.isBase||t.options.stealth||(r.Z.control.MapContents.prototype.updateLayerTree.call(e,t),e.div.querySelector("."+e.CLASS+"-empty").classList.add(r.Z.Consts.classes.HIDDEN),e.getRenderedHtml(e.CLASS+"-branch",e.layerTrees[t.id]).then((function(n){const o=(new DOMParser).parseFromString(n,"text/html").body.firstChild,i=o.dataset.layerUid,a=e.div.querySelector("."+e.CLASS+'-wl li[data-layer-uid="'+i+'"]')||e.div.querySelector("."+e.CLASS+'-wl li[data-layer-id="'+t.id+'"]');if(a){if(t instanceof r.Z.layer.Vector){const n="ul."+e.CLASS+"-wl",i="ul."+e.CLASS+"-branch",s="li."+e.CLASS+"-node",l="li."+e.CLASS+"-leaf",c=Array.from(a.querySelectorAll("li.tc-ctl-toc-node:not(.tc-ctl-toc-leaf):not(.tc-collapsed)")).reduce((function(t,e){return console.log(t),t.push(e.dataset.layerUid),t}),[]);a.innerHTML=o.innerHTML,a.setAttribute("class",o.getAttribute("class")),a.dataset.layerId||(a.dataset.layerId=t.id),a.querySelectorAll(n+" "+i+" "+i+","+n+" "+i+" "+s).forEach((function(t){t.matches(l)||"LI"===t.tagName&&c.some((e=>e===t.dataset.layerUid))||"UL"===t.tagName&&c.some((e=>e===t.parentElement.dataset.layerUid))||t.classList.add(r.Z.Consts.classes.COLLAPSED)}))}}else{o.dataset.layerId=t.id;const n=e.div.querySelector("."+e.CLASS+"-wl");n.insertBefore(o,n.firstChild);const i="ul."+e.CLASS+"-wl",a="ul."+e.CLASS+"-branch",s="li."+e.CLASS+"-node",l="li."+e.CLASS+"-leaf";o.querySelectorAll(i+" "+a+" "+a+","+i+" "+a+" "+s).forEach((function(t){t.matches(l)||t.classList.add(r.Z.Consts.classes.COLLAPSED)}))}e.update(t),e.updateScale(t)})).catch((function(t){r.Z.error(t)})))},t.removeLayer=function(t){t.isBase||r.Z.control.MapContents.prototype.removeLayer.call(this,t)},t.updateLayerVisibility=function(t){var e=this;e.getLayerUIElements().forEach((function(n){if(n.dataset.layerId===t.id){var r=!t.getVisibility();n.querySelectorAll("input[type=checkbox]").forEach((function(t){t.matches("."+e.CLASS+"-branch-cb")?t.checked=!r:t.disabled=r}))}}))},t.updateLayerOrder=function(t,e,n){},t.render=function(t){const e=this;return r.Z.Control.prototype.render.call(e,(function(){var n=e.options.controls||[];if(n.length>0){var o=n[0],i=document.createElement("div");e.div.appendChild(i),e.map.addControl(o.name,r.Z.Util.extend({div:i},o.options))}r.Z.Util.isFunction(t)&&t()}))},t.getLayerUIElements=function(){const t=[],e=this.div.querySelector("ul."+this.CLASS+"-wl").children;for(var n=0,r=e.length;n<r;n++){const r=e[n];"LI"===r.tagName&&t.push(r)}return t}}();const a=r.Z.control.TOC},8719:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var r,o=n(5361),i=n(2089),a=n(2273);o.Z.Consts=i.Z,o.Z.control=o.Z.control||{},o.Z.control.Container=a.default,o.Z.control.TabContainer=function(){var t=this;o.Z.control.Container.apply(t,arguments);var e=t._classSelector="."+t.CLASS;t._selectors={TAB:e+"-tab",RADIOBUTTON:`input[type=radio][name="${t.id}-sel"]`,ELEMENT:e+"-elm"}},o.Z.inherit(o.Z.control.TabContainer,o.Z.control.Container),(r=o.Z.control.TabContainer.prototype).CLASS="tc-ctl-tctr",r.template={1:function(t,e,n,r,o,i,a){var s=t.lambda,l=t.escapeExpression,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<label class="tc-ctl-tctr-tab tc-ctl-tctr-tab-'+l(s(o&&c(o,"index"),e))+'"><input type="radio" name="'+l(s(null!=a[1]?c(a[1],"controlId"):a[1],e))+'-sel" value="'+l(s(o&&c(o,"index"),e))+'" /><span>'+l(s(null!=e?c(e,"title"):e,e))+"</span></label>"},3:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-tctr-elm tc-ctl-tctr-elm-'+t.escapeExpression(t.lambda(o&&i(o,"index"),e))+' tc-hidden">\r\n</div>\r\n'},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o,i,a){var s,l=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+t.escapeExpression(t.lambda(null!=e?c(e,"title"):e,e))+'</h2>\r\n<div class="tc-ctl-tctr-select">\r\n'+(null!=(s=c(n,"each").call(l,null!=e?c(e,"controls"):e,{name:"each",hash:{},fn:t.program(1,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:3,column:4},end:{line:5,column:14}}}))?s:"")+"</div>\r\n"+(null!=(s=c(n,"each").call(l,null!=e?c(e,"controls"):e,{name:"each",hash:{},fn:t.program(3,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:7,column:0},end:{line:10,column:9}}}))?s:"")},useData:!0,useDepths:!0},r.onRender=function(){const t=this;return new Promise((function(e,n){t.title=t.title||t.getLocaleString(t.options.title||"moreControls"),t.div.querySelector("h2").innerHTML=t.title;for(var r=0,i=t.controlOptions.length;r<i;r++){var a=t.controlOptions[r],s="",l={};void 0!==a.name&&void 0!==a.options?(console.log("Gestionamos config de tabContainer antiguo"),s=a.name,l=a.options):l=a[s=Object.keys(a).filter((t=>"title"!==t))[0]],t._ctlPromises[r]=t.map.addControl(s,o.Z.Util.extend({id:t.uids[r],div:t.div.querySelector("."+t.CLASS+"-elm-"+r)},l))}var c=function(e,n){e.renderPromise().then((function(){const r=t.getLocaleString(t.controlOptions[n].title)||e.div.querySelector("h2").innerHTML;var o=e.div;do{o=o.parentElement}while(o&&!o.matches(t._classSelector));o.querySelector(t._selectors.TAB+"-"+n+" span").innerHTML=r}))};Promise.all(t._ctlPromises).then((function(n){for(var r=0,o=n.length;r<o;r++){var i=n[r];i.containerControl=t,c(i,r)}e(t)}))}))},r.render=function(t){const e=this;return e._set1stRenderPromise(e.renderData({controlId:e.id,title:e.title,controls:e.controlOptions},(function(){var n=function(t){for(var n=this;n&&!n.matches(e._selectors.TAB);)n=n.parentElement;var r,i=[];const a=n.querySelector(e._selectors.RADIOBUTTON),s=a.value,l=e.div.querySelectorAll(e._selectors.ELEMENT);e._oldValue===s&&e.options.deselectableTabs?(setTimeout((function(){a.checked=!1}),0),e._oldValue=null,r=null,i=l):(l.forEach((function(t){t.matches(e._selectors.ELEMENT+"-"+s)?r=t:i.push(t)})),e._oldValue=s),r&&r.classList.contains(o.Z.Consts.classes.COLLAPSED)&&(r.classList.remove(o.Z.Consts.classes.COLLAPSED),new MutationObserver((function(t){t.forEach((function(t){t.target.classList.contains(o.Z.Consts.classes.COLLAPSED)&&t.target.classList.remove(o.Z.Consts.classes.COLLAPSED)}))})).observe(r,{attributes:!0})),r&&r.classList.remove(o.Z.Consts.classes.HIDDEN),i.forEach((function(t){t.classList.add(o.Z.Consts.classes.HIDDEN)})),a.checked=!0};e.div.querySelectorAll("span").forEach((function(t){t.addEventListener(o.Z.Consts.event.CLICK,n,{passive:!0})})),"number"==typeof e.defaultSelection&&n.call(e.div.querySelectorAll(e._selectors.RADIOBUTTON)[e.defaultSelection]),"function"==typeof t&&t()})))},r.selectTab=function(t){const e=this,n=e.div.querySelectorAll(e._selectors.RADIOBUTTON)[t];n&&(n.checked=!0,e.div.querySelectorAll(e._selectors.ELEMENT).forEach(((e,n)=>e.classList.toggle(o.Z.Consts.classes.HIDDEN,t!==n))))},r.onControlDisable=function(t){const e=this;e.getControls().then((n=>{const r=n.indexOf(t);if(r>=0){let o=r,i=t;do{o=(o+1)%n.length,i=n[o]}while(i.isDisabled&&i!==t);o!==r&&e.selectTab(o)}}))};const s=o.Z.control.TabContainer},7381:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var r=n(5361),o=n(2089),i=n(6498),a=n(9540);r.Z.Consts=o.Z,r.Z.control=r.Z.control||{},r.Z.view=r.Z.view||{},r.Z.view.ThreeD=a.default,r.Z.Control=i.Z,function(){r.Z.control.ThreeD=function(){var t=this;r.Z.Control.apply(t,arguments)},r.Z.inherit(r.Z.control.ThreeD,r.Z.Control);var t=r.Z.control.ThreeD.prototype;t.CLASS="tc-ctl-3d",t.classes={BETA:"tc-beta-button",BTNACTIVE:"active"},t.template={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<button type="button" class="tc-ctl-3d-btn tc-beta-button tc-float-btn" title="'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"threed.tip",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:79},end:{line:1,column:100}}}))+'"></button>'},useData:!0},t.register=function(t){const e=this,n=r.Z.Control.prototype.register.call(e,t);return t.on(r.Z.Consts.event.VIEWCHANGE,(function(t){t.view===r.Z.Consts.view.THREED&&e.activate()})),n},t.renderData=function(t,e){const n=this;return r.Z.Control.prototype.renderData.call(n,t,(function(){n.button=n.div.querySelector("."+n.CLASS+"-btn"),n.button.addEventListener(r.Z.Consts.event.CLICK,(function(){n.button.disabled||(n.map.on3DView?(n.button.disabled=!0,r.Z.view.ThreeD.unapply({callback:function(){n.button.setAttribute("title",n.getLocaleString("threed.tip")),n.button.classList.remove(n.classes.BTNACTIVE),n.button.disabled=!1}})):n.activate())}),{passive:!0}),r.Z.Util.isFunction(e)&&e()}))},t.activate=function(){var t=this;t.map.on3DView||(t.button.disabled=!0),t.browserSupportWebGL.call(t);const e=function(){t.button.disabled=!1};t.map.view3D&&t.map.on3DView||r.Z.view.ThreeD.apply({map:t.map,options:t.options,getRenderedHtml:t.getRenderedHtml,callback:e}),t.button.setAttribute("title",t.getLocaleString("threed.two.tip")),t.button.classList.remove(t.classes.BETA),t.button.classList.add(t.classes.BTNACTIVE)},t.deactivate=function(){r.Z.Control.prototype.deactivate.call(this)},t.browserSupportWebGL=function(){var t=this,e=!1;if(window.WebGLRenderingContext){var n=document.createElement("canvas"),o={alpha:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};try{var i=n.getContext("webgl",o)||n.getContext("experimental-webgl",o)||n.getContext("webkit-3d",o)||n.getContext("moz-webgl",o);i?e=!0:(o.failIfMajorPerformanceCaveat=!1,(i=n.getContext("webgl",o)||n.getContext("experimental-webgl",o)||n.getContext("webkit-3d",o)||n.getContext("moz-webgl",o))?(e="slow",t.isSlower=!0):e=!1)}catch(t){console.log(t)}if("slow"===e||!e){var a="slow"===e?"threed.slowSupport.supported":"threed.not.supported";t.map.toast(t.getLocaleString(a),{type:r.Z.Consts.msgType.WARNING,duration:1e4})}return e}e=!1}}();const s=r.Z.control.ThreeD},1373:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>d});var r=n(1466),o=n.n(r),i=n(5361),a=n(2089),s=n(2197),l=n(2667),c=n(6947),u=n(4496),p=n(7106);i.Z.Consts=a.Z,i.Z.control=i.Z.control||{},i.Z.control.SWCacheClient=s.default,i.Z.Geometry=l.Z,i.Z.layer=i.Z.layer||{},i.Z.layer.Vector=c.Z,i.Z.filter=u.Z,i.Z.control.WFSEdit=function(){const t=this;i.Z.control.SWCacheClient.apply(this,arguments),t.serviceWorkerIsRequired=t.options.serviceWorkerIsRequired||!1,t._classSelector="."+t.CLASS,t.layer=null,t.callback=i.Z.Util.isFunction(arguments[2])?arguments[2]:t.options.callback?t.options.callback:null,t.layersEditData={},t.showsOriginalFeatures="boolean"==typeof t.options.showOriginalFeatures&&t.options.showOriginalFeatures,t.highlightsAdded=t.highlightsModified=t.highlightsRemoved="boolean"!=typeof t.options.highlightChanges||t.options.highlightChanges,i.Z.Util.isFunction(t.options.getBeforeEditLayerStyleFunction)||(t.getBeforeEditLayerStyleFunction=t.getBeforeEditLayerStyle),t.styles=t.options.styles||{point:{fillColor:"#0000aa",fillOpacity:.1,strokeColor:"#0000aa",strokeWidth:2,strokeOpacity:1,radius:6},line:{strokeColor:"#0000aa",strokeWidth:2,strokeOpacity:1},polygon:{fillColor:"#0000aa",fillOpacity:.1,strokeColor:"#0000aa",strokeWidth:2,strokeOpacity:1}}},i.Z.inherit(i.Z.control.WFSEdit,i.Z.control.SWCacheClient),function(){var t=0;const e=function(t){const e=t.getLayerEditData();t._saveBtn.disabled=!(navigator.onLine&&e&&e.checkedOut)||t.isSyncing},n=function(t,e){if(t.div.querySelector(t._classSelector+"-view").classList.toggle(i.Z.Consts.classes.HIDDEN,!e||!t.layer||!(t.layer.type===i.Z.Consts.layerType.WFS||t.layer.type===i.Z.Consts.layerType.WMS)),t.layer&&t.layer.wfsLayer){const e=i.Z.filter&&i.Z.filter.Bbox&&t.layer.wfsLayer.properties instanceof i.Z.filter.Bbox;t._recropBtn.classList.toggle(i.Z.Consts.classes.HIDDEN,!e)}t.div.querySelector(t._classSelector+"-edit").classList.toggle(i.Z.Consts.classes.HIDDEN,!e)},r=function(t){e(t);const n=t.getLayerEditData();t._discardBtn.disabled=!n||!n.checkedOut},a=function(t,e){if(t.layer){const i=t.getLayerEditData();if(void 0!==e)i.checkedOut=e,r(t);else{var n=c(t);o().keys().then((function(e){if(e){for(var o=!0,a=0,s=e.length;a<s;a++)if(0===e[a].indexOf(n)){o=!1;break}i.checkedOut=!o,r(t)}}))}}else r(t)},s=function(t,e){return new Promise((function(n,r){var a,s;switch(!0){case e instanceof i.Z.feature.Polygon:s=i.Z.Consts.geom.POLYGON;break;case e instanceof i.Z.feature.Polyline:s=i.Z.Consts.geom.POLYLINE;break;case e instanceof i.Z.feature.Point:s=i.Z.Consts.geom.POINT;break;case e instanceof i.Z.feature.MultiPolygon:s=i.Z.Consts.geom.MULTIPOLYGON;break;case e instanceof i.Z.feature.MultiPolyline:s=i.Z.Consts.geom.MULTIPOLYLINE}a={id:e.id||e.provId,attributes:e.data,type:s,geometry:e.geometry},o().setItem(t,a).then((function(){n({feature:e})})).catch((function(t){r({feature:e,error:t})}))}))},l=function(t){return new Promise((function(e,n){o().removeItem(t).then((function(){e(t)})).catch((function(t){n(Error(t))}))}))},c=function(t,e){return t.LOCAL_STORAGE_KEY_PREFIX+function(t){let e=t.options.featureType[0];return e.indexOf(":")<0&&(e=t.options.featureNS+":"+e),e+"@"+t.options.url}(e||t.layer.wfsLayer||t.layer)},u=function(t,e){return c(t,e)+t.LOCAL_STORAGE_ADDED_KEY_PREFIX},d=function(t,e){return c(t,e)+t.LOCAL_STORAGE_MODIFIED_KEY_PREFIX},h=function(t,e){return c(t,e)+t.LOCAL_STORAGE_REMOVED_KEY_PREFIX},f=function(t){return t.getPath?t.getPath().join(" • "):t.title||t.id},m=i.Z.control.WFSEdit.prototype;m.CLASS="tc-ctl-wfsedit",m.template={1:function(t,e,n,r,o){var i=t.lambda,a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <option value="'+a(i(null!=e?s(e,"id"):e,e))+'">'+a(i(null!=e?s(e,"title"):e,e))+"</option>\r\n"},3:function(t,e,n,r,o){return" checked"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lambda,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+s(c(n,"i18n").call(a,"featureEditing",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:4},end:{line:1,column:29}}}))+'</h2>\r\n<div class="tc-ctl-wfsedit-layer">\r\n    <select class="tc-combo tc-ctl-wfsedit-layer-sel" disabled>\r\n        <option value="">'+s(c(n,"i18n").call(a,"selectLayerToEdit",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:25},end:{line:4,column:53}}}))+"</option>\r\n"+(null!=(i=c(n,"each").call(a,null!=e?c(e,"layers"):e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:5,column:8},end:{line:7,column:17}}}))?i:"")+'    </select>\r\n</div>\r\n<div class="tc-ctl-wfsedit-view tc-hidden">\r\n    <table>\r\n        <tbody>\r\n            <tr>\r\n                <th><img class="tc-ctl-wfsedit-view-watch" /></th>\r\n                <td>'+s(c(n,"i18n").call(a,"featuresInEditedLayer",{name:"i18n",hash:{},data:o,loc:{start:{line:15,column:20},end:{line:15,column:52}}}))+'</td>\r\n            </tr>\r\n            <tr>\r\n                <th><img class="tc-ctl-wfsedit-view-original-watch" /></th>\r\n                <td><input type="checkbox" id="tc-ctl-wfsedit-view-original-cb-'+s(l(null!=e?c(e,"controlId"):e,e))+'"'+(null!=(i=c(n,"if").call(a,null!=e?c(e,"showOriginalFeatures"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:19,column:93},end:{line:19,column:136}}}))?i:"")+' /><label class="tc-ctl-wfsedit-view-original" for="tc-ctl-wfsedit-view-original-cb-'+s(l(null!=e?c(e,"controlId"):e,e))+'">'+s(c(n,"i18n").call(a,"featuresAsBeforeEditing",{name:"i18n",hash:{},data:o,loc:{start:{line:19,column:235},end:{line:19,column:269}}}))+'</label></td>\r\n            </tr>\r\n            <tr>\r\n                <th><input type="color" id="tc-ctl-wfsedit-view-clr-added-'+s(l(null!=e?c(e,"controlId"):e,e))+'" class="tc-clt-wfsedit-view-clr-added" /><label for="tc-ctl-wfsedit-view-clr-added-'+s(l(null!=e?c(e,"controlId"):e,e))+'" title="'+s(c(n,"i18n").call(a,"clickToChangeColor",{name:"i18n",hash:{},data:o,loc:{start:{line:22,column:193},end:{line:22,column:222}}}))+'"><img class="tc-ctl-wfsedit-view-added-watch" /></label></th>\r\n                <td><input type="checkbox" id="tc-ctl-wfsedit-view-added-cb-'+s(l(null!=e?c(e,"controlId"):e,e))+'"'+(null!=(i=c(n,"if").call(a,null!=e?c(e,"highlightChanges"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:23,column:90},end:{line:23,column:129}}}))?i:"")+' /><label class="tc-ctl-wfsedit-view-added" for="tc-ctl-wfsedit-view-added-cb-'+s(l(null!=e?c(e,"controlId"):e,e))+'">'+s(c(n,"i18n").call(a,"unsyncedAdded",{name:"i18n",hash:{},data:o,loc:{start:{line:23,column:222},end:{line:23,column:246}}}))+'</label></td>\r\n            </tr>\r\n            <tr>\r\n                <th><input type="color" id="tc-ctl-wfsedit-view-clr-modified-'+s(l(null!=e?c(e,"controlId"):e,e))+'" class="tc-clt-wfsedit-view-clr-modified" /><label for="tc-ctl-wfsedit-view-clr-modified-'+s(l(null!=e?c(e,"controlId"):e,e))+'" title="'+s(c(n,"i18n").call(a,"clickToChangeColor",{name:"i18n",hash:{},data:o,loc:{start:{line:26,column:202},end:{line:26,column:231}}}))+'"><img class="tc-ctl-wfsedit-view-modified-watch" /></label></th>\r\n                <td><input type="checkbox" id="tc-ctl-wfsedit-view-modified-cb-'+s(l(null!=e?c(e,"controlId"):e,e))+'"'+(null!=(i=c(n,"if").call(a,null!=e?c(e,"highlightChanges"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:27,column:93},end:{line:27,column:132}}}))?i:"")+' /><label class="tc-ctl-wfsedit-view-modified" for="tc-ctl-wfsedit-view-modified-cb-'+s(l(null!=e?c(e,"controlId"):e,e))+'">'+s(c(n,"i18n").call(a,"unsyncedModified",{name:"i18n",hash:{},data:o,loc:{start:{line:27,column:231},end:{line:27,column:258}}}))+'</label></td>\r\n            </tr>\r\n            <tr>\r\n                <th><input type="color" id="tc-ctl-wfsedit-view-clr-removed-'+s(l(null!=e?c(e,"controlId"):e,e))+'" class="tc-clt-wfsedit-view-clr-removed" /><label for="tc-ctl-wfsedit-view-clr-removed-'+s(l(null!=e?c(e,"controlId"):e,e))+'" title="'+s(c(n,"i18n").call(a,"clickToChangeColor",{name:"i18n",hash:{},data:o,loc:{start:{line:30,column:199},end:{line:30,column:228}}}))+'"><img class="tc-ctl-wfsedit-view-removed-watch" /></label></th>\r\n                <td><input type="checkbox" id="tc-ctl-wfsedit-view-removed-cb-'+s(l(null!=e?c(e,"controlId"):e,e))+'"'+(null!=(i=c(n,"if").call(a,null!=e?c(e,"highlightChanges"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:31,column:92},end:{line:31,column:131}}}))?i:"")+' /><label class="tc-ctl-wfsedit-view-removed" for="tc-ctl-wfsedit-view-removed-cb-'+s(l(null!=e?c(e,"controlId"):e,e))+'">'+s(c(n,"i18n").call(a,"unsyncedRemoved",{name:"i18n",hash:{},data:o,loc:{start:{line:31,column:228},end:{line:31,column:254}}}))+'</label></td>\r\n            </tr>\r\n        </tbody>\r\n    </table>\r\n    <button type="button" class="tc-ctl-wfsedit-btn-crop tc-hidden" title="'+s(c(n,"i18n").call(a,"refreshLayerToCurrentExtent",{name:"i18n",hash:{},data:o,loc:{start:{line:35,column:75},end:{line:35,column:113}}}))+'">'+s(c(n,"i18n").call(a,"refreshLayerToCurrentExtent",{name:"i18n",hash:{},data:o,loc:{start:{line:35,column:115},end:{line:35,column:153}}}))+'</button>\r\n</div>\r\n<div class="tc-ctl-wfsedit-edit tc-hidden"></div>\r\n<div class="tc-ctl-wfsedit-save">\r\n    <button type="button" class="tc-button tc-icon-button tc-ctl-wfsedit-btn-save" disabled title="'+s(c(n,"i18n").call(a,"syncChanges",{name:"i18n",hash:{},data:o,loc:{start:{line:39,column:99},end:{line:39,column:121}}}))+'">'+s(c(n,"i18n").call(a,"syncChanges",{name:"i18n",hash:{},data:o,loc:{start:{line:39,column:123},end:{line:39,column:145}}}))+'</button>\r\n    <button type="button" class="tc-button tc-icon-button tc-ctl-wfsedit-btn-discard" disabled title="'+s(c(n,"i18n").call(a,"discardChanges",{name:"i18n",hash:{},data:o,loc:{start:{line:40,column:102},end:{line:40,column:127}}}))+'">'+s(c(n,"i18n").call(a,"discardChanges",{name:"i18n",hash:{},data:o,loc:{start:{line:40,column:129},end:{line:40,column:154}}}))+"</button>\r\n</div>\r\n"},useData:!0},m.LOCAL_STORAGE_KEY_PREFIX="TC.offline.edit.",m.LOCAL_STORAGE_ADDED_KEY_PREFIX=".added.",m.LOCAL_STORAGE_MODIFIED_KEY_PREFIX=".modified.",m.LOCAL_STORAGE_REMOVED_KEY_PREFIX=".removed.",m.register=function(t){const n=this;return new Promise((function(r,o){i.Z.control.SWCacheClient.prototype.register.call(n,t).then((function(){window.addEventListener("online",(function(){e(n)})),window.addEventListener("offline",(function(){e(n)})),n._editPromise=t.addControl("edit",{id:n.getUID(),div:n.div.querySelector(`.${n.CLASS}-edit`),styles:n.styles,downloadElevation:n.options.downloadElevation,snapping:n.options.snapping}),n._editPromise.then((function(e){n.editControl=e,n.editControl.getAvailableFeaturesToImport=function(){const e=Object.getPrototypeOf(n.editControl).getAvailableFeaturesToImport.call(n.editControl),r=n.getLayerEditData();return e.filter((e=>{const n=t.getLayer(e.id);return n!==r.addedFeaturesLayer&&n!==r.modifiedFeaturesLayer&&n!==r.removedFeaturesLayer&&n!==r.beforeEditLayer}))},n.editControl.importFeatures=function(t){const e=t||this.featuresToImport||[],r=n.getLayerEditData(),o=r.attributes?e.map((function(t){const e={};for(let n in r.attributes)e[n]=t.data[n];return new t.constructor(t.geometry,{geometryName:r.geometryName,data:e})})):t;Object.getPrototypeOf(n.editControl).importFeatures.call(n.editControl,o)},n.editControl.on(i.Z.Consts.event.DRAWEND,(function(t){n.getLayerEditData().serializable&&n._storeFeatureAdd(t.feature)})).on(i.Z.Consts.event.FEATUREMODIFY,(function(t){const e=t.feature,r=e.provId||e.id,o=function(){a(n,!0)},l=function(){i.Z.error(n.getLocaleString("failedWhenSavingModifyOperationInSession"))},c=n.getLayerEditData();if(c.serializable){let t=c.addedFeaturesLayer.getFeatureById(r);t?(t.setCoords(e.geometry),t.setData(e.getData()),s(u(n)+r,e).then(o,l)):(t=c.modifiedFeaturesLayer.getFeatureById(r),t?(t.setCoords(e.geometry),t.setData(e.getData())):c.modifiedFeaturesLayer.addFeature(n._createAuxFeature(e)),s(d(n)+r,e).then(o,l))}})).on(i.Z.Consts.event.FEATUREADD,(function(t){n.getLayerEditData().serializable&&n._storeFeatureAdd(t.feature)})).on(i.Z.Consts.event.FEATUREREMOVE,(function(t){n.getLayerEditData().serializable&&n._storeFeatureRemove(t.feature)})),t.workLayers.forEach((t=>n.addLayer(t))),t.on(i.Z.Consts.event.LAYERUPDATE,(function(t){const e=t.layer;e.type!==i.Z.Consts.layerType.WFS||e.options.readOnly||n.getEditableLayer(e).then((t=>n.cacheLayer(t))).catch((t=>console.log("Layer not editable: "+e.id)))})).on(i.Z.Consts.event.ZOOM,(function(e){t.workLayers.filter((t=>t.wfsLayer)).filter((t=>n.layer!==t)).forEach((function(t){t.wfsLayer=null,n.getEditableLayer(t)}))})).on(i.Z.Consts.event.LAYERADD,(function(t){n.addLayer(t.layer)})).on(i.Z.Consts.event.LAYERREMOVE,(function(t){const e=t.layer;if(n._removingLayer===e)return;(n.layer===e||e.wmsLayer&&n.layer===e.wmsLayer)&&n.setLayer(null);const r=n._layerSelect.querySelector(`option[value="${e.id}"]`);r&&r.parentElement.removeChild(r)})).on(i.Z.Consts.event.LAYERERROR,(function(e){const r=e.layer;r.type!==i.Z.Consts.layerType.WFS||r.options.readOnly||(e.reason===i.Z.Consts.WFSErrors.MAX_NUM_FEATURES&&t.toast(n.getLocaleString("query.msgTooManyResults",{limit:e.data.limit}),{type:i.Z.Consts.msgType.WARNING}),(n.layer===r||n.layer&&n.layer.wfsLayer===r)&&(delete n.layersEditData[n.layer.id],n.setLayer(null)),r.wmsLayer&&(t.removeLayer(r),r.wmsLayer.wfsLayer=null))})),r(n)})),t.loaded((function(){if(n._layerSelect.disabled=!1,n.options.layer)n.setLayer(n.options.layer);else{const e=t.workLayers.filter((function(t){return t.type===i.Z.Consts.layerType.WFS&&!t.options.stealth}));1===e.length?n.setLayer(e[0].id):n.setLayer(null)}n.showOriginalFeatures(n.showsOriginalFeatures)})),t.ready((function(){t.getControlsByClass("TC.control.WorkLayerManager").forEach((function(e){e.addItemTool({renderFn:function(e,r){const o=n.CLASS+"-btn-edit";let a=e.querySelector("sitna-toggle."+o);if(!a){const e=n.getLocaleString("featureEditing");a=new p.Z,a.text=e,a.classList.add(o),a.checkedIconText=getComputedStyle(document.querySelector(":root")).getPropertyValue("--icon-edit").replaceAll('"',""),a.uncheckedIconText=a.checkedIconText,a.dataset.layerId=r;const s=t.getLayer(r);s.type===i.Z.Consts.layerType.WMS&&(a.classList.add(i.Z.Consts.classes.LOADING),s.getWFSCapabilities().catch((()=>a.classList.add(i.Z.Consts.classes.HIDDEN))).finally((()=>a.classList.remove(i.Z.Consts.classes.LOADING))))}return a},updateEvents:[i.Z.Consts.event.BEFORELAYERUPDATE,i.Z.Consts.event.LAYERUPDATE,i.Z.Consts.event.LAYERERROR,i.Z.Consts.event.CONTROLACTIVATE,i.Z.Consts.event.CONTROLDEACTIVATE],updateFn:function(e){const r=this,o=t.getLayer(r.dataset.layerId);setTimeout((()=>{r.classList.toggle(i.Z.Consts.classes.ACTIVE,n.layer===o)}),500),r.disabled=!o||o.isRaster()&&1!==o.names.length},actionFn:function(){const e=t.getLayer(this.dataset.layerId),r=n.layer;this.classList.remove(i.Z.Consts.classes.ACTIVE),(e.names&&1===e.names.length||!e.isRaster())&&(e&&r!==e?n.setLayer(e).then((()=>{n.openEditSession()})):n.setLayer(null))}})}))}))}))}))},m.render=function(t){const e=this;var r=[];if(e.map)for(var o=0,a=e.map.workLayers.length;o<a;o++){var s=e.map.workLayers[o];s.type!==i.Z.Consts.layerType.WFS||s.options.stealth||r.push({id:s.id,title:s.title||s.id})}return e._set1stRenderPromise(i.Z.Control.prototype.renderData.call(e,{layers:r,showOriginalFeatures:e.showsOriginalFeatures,highlightChanges:e.highlightsAdded||e.highlightsModified||e.highlightsRemoved,controlId:e.id},(function(){e._layerDiv=e.div.querySelector(e._classSelector+"-layer"),e._layerSelect=e._layerDiv.querySelector(e._classSelector+"-layer-sel"),e._layerSelect.addEventListener("change",(function(t){n(e,!1),e.getEditableLayer(e._layerSelect.value).then((function(t){e.setLayer(t.wmsLayer||t).then((function(){e.layer&&e.openEditSession()}))})).catch((()=>{e.setLayer(null)}))}));const r=e.div.querySelector(e._classSelector+"-view");e._editingWatch=r.querySelector(`.${e.CLASS}-view-watch`),e._beforeEditLayerWatch=r.querySelector(`.${e.CLASS}-view-original-watch`),e._addedWatch=r.querySelector(`.${e.CLASS}-view-added-watch`),e._modifiedWatch=r.querySelector(`.${e.CLASS}-view-modified-watch`),e._removedWatch=r.querySelector(`.${e.CLASS}-view-removed-watch`),r.querySelector(`#${e.CLASS}-view-original-cb-${e.id}`).addEventListener("change",(function(t){e.showOriginalFeatures(t.target.checked)})),r.querySelector(`#${e.CLASS}-view-added-cb-${e.id}`).addEventListener("change",(function(t){e.highlightAdded(t.target.checked)})),r.querySelector(`#${e.CLASS}-view-modified-cb-${e.id}`).addEventListener("change",(function(t){e.highlightModified(t.target.checked)})),r.querySelector(`#${e.CLASS}-view-removed-cb-${e.id}`).addEventListener("change",(function(t){e.highlightRemoved(t.target.checked)}));const o=new RegExp(`${e.CLASS}-view-clr-(.+)-${e.id}`),a=function(t){const n=this.parentElement.querySelector("input[type=color]"),r=e.getLayerEditData(),a=r[n.id.match(o)[1]+"FeaturesLayer"];switch(r.geometryType){case i.Z.Consts.geom.POINT:n.value=a.styles.point.strokeColor;break;case i.Z.Consts.geom.POLYLINE:case i.Z.Consts.geom.MULTIPOLYLINE:n.value=a.styles.line.strokeColor;break;default:n.value=a.styles.polygon.strokeColor}n.click()},s=function(t){const n=t.target,r=e.getLayerEditData(),a=n.id.match(o)[1],s=r[a+"FeaturesLayer"],l=r[a+"CustomColor"]=n.value;switch(r.geometryType){case i.Z.Consts.geom.POINT:s.styles.point.strokeColor=l;break;case i.Z.Consts.geom.POLYLINE:case i.Z.Consts.geom.MULTIPOLYLINE:s.styles.line.strokeColor=l;break;default:s.styles.polygon.strokeColor=l,s.styles.polygon.fillColor=l}s.setStyles(s.styles),e[`_${a}Watch`].src=g(s,r.geometryType)},l=`${e.CLASS}-view-clr-added-${e.id}`;r.querySelector(`label[for="${l}"]`).addEventListener(i.Z.Consts.event.CLICK,a,{passive:!0}),document.getElementById(l).addEventListener("change",s);const c=`${e.CLASS}-view-clr-modified-${e.id}`;r.querySelector(`label[for="${c}"]`).addEventListener(i.Z.Consts.event.CLICK,a,{passive:!0}),document.getElementById(c).addEventListener("change",s);const u=`${e.CLASS}-view-clr-removed-${e.id}`;r.querySelector(`label[for="${u}"]`).addEventListener(i.Z.Consts.event.CLICK,a,{passive:!0}),document.getElementById(u).addEventListener("change",s),e._saveBtn=e.div.querySelector(e._classSelector+"-btn-save"),e._saveBtn.addEventListener(i.Z.Consts.event.CLICK,(function(){i.Z.confirm(e.getLocaleString("edit.applyEdits.confirm",{layerTitle:f(e.layer)}),(function(){e.applyEdits()}))}),{passive:!0}),e._discardBtn=e.div.querySelector(e._classSelector+"-btn-discard"),e._discardBtn.addEventListener(i.Z.Consts.event.CLICK,(function(){i.Z.confirm(e.getLocaleString("edit.discardEdits.confirm",{layerTitle:f(e.layer)}),(function(){e.discardEdits()}))}),{passive:!0}),e._recropBtn=e.div.querySelector(`.${e.CLASS}-view button.${e.CLASS}-btn-crop`),e._recropBtn.addEventListener(i.Z.Consts.event.CLICK,(function(){if(e.layer){const r=()=>{if(e.layer&&e.layer.wfsLayer&&i.Z.filter&&i.Z.filter.Bbox&&e.layer.wfsLayer.properties instanceof i.Z.filter.Bbox){const t=e.getLayerEditData();e.layer.wfsLayer.properties=new i.Z.filter.Bbox(null,e.map.getExtent(),e.map.getCRS()),e.layer.wfsLayer.refresh(),t.beforeEditLayer&&(t.beforeEditLayer.properties=e.layer.wfsLayer.properties,t.beforeEditLayer.refresh())}},o=e.getLayerEditData(),a=o.addedFeaturesLayer.features.concat(o.modifiedFeaturesLayer.features,o.removedFeaturesLayer.features);if(a.length){let o=!1;const s=e.map.getExtent(),l=[[s[0],s[1]],[s[0],s[3]],[s[2],s[3]],[s[2],s[1]]];for(var t=0,n=a.length;t<n;t++)if(!i.Z.Geometry.intersects(a[t].geometry,l)){o=!0;break}o?i.Z.confirm(e.getLocaleString("refreshLayerToCurrentExtent.confirm"),(function(){r()})):r()}else r()}}),{passive:!0}),i.Z.Util.isFunction(t)&&t()})))},m.addLayer=function(t){const e=this;t.isBase||t.options.readOnly||t.options.stealth||e.getEditableLayer(t).then((function(n){!t.isRaster()&&n.wmsLayer||function(t){const n=document.createElement("option");n.setAttribute("value",t.id),n.innerHTML=f(t),e.renderPromise().then((function(){e._layerSelect.appendChild(n)}))}(t)})).catch((e=>console.log(`Layer ${t.id} not editable. Reason: ${e.message}`)))},m.setLayer=function(t){const e=this;return new Promise((function(r,o){const i=e.map,a=e.div.querySelector(e._classSelector+"-layer-sel");t=i.getLayer(t);const s=i.workLayers.filter((e=>e===t))[0],l=function(){s?e.getEditableLayer(s).then((function(t){const n=function(){e.layer=s,e._enableEditSerialization(s).then((function(){e.getEditControl().then((n=>{a.value=e.layer.id,n.setMode(null),n.setLayer(t),r(e.layer)}))})).catch((t=>{e.setLayer(null),o(t)}))};i.workLayers.indexOf(t)>=0?n():i.addLayer(t).then(n)})).catch((()=>{e.setLayer(null),r(null)})):(e.layer&&e.layer.wfsLayer&&(e._removingLayer=e.layer.wfsLayer),e.getEditControl().then((t=>{n(e,!1),e.closeEditSession().then((()=>{a.value="",t.setMode(null),t.setLayer(null),e.layer=null,r(null)})).finally((()=>{delete e._removingLayer}))})))};null!==t&&e.layer?(e.layer.wfsLayer&&(e._removingLayer=e.layer.wfsLayer),e.closeEditSession().then((()=>{s&&l()}))):l()}))},m._storeFeatureAdd=function(e){const n=this;e.provId="NewFeature."+t++;const r=n.getLayerEditData(),o=n._createAuxFeature(e);r.addedFeaturesLayer.addFeature(o),s(u(n)+e.provId,o).then((function(){a(n,!0)}),(function(){i.Z.error(n.getLocaleString("failedWhenSavingAddOperationInSession"))}))},m._storeFeatureRemove=function(t){const e=this;var n=t.provId||t.id,r=function(){a(e)},o=function(){i.Z.error(e.getLocaleString("failedWhenSavingRemoveOperationInSession"))};const c=e.getLayerEditData();if(c.serializable){let i=c.addedFeaturesLayer.getFeatureById(n);if(i)c.addedFeaturesLayer.removeFeature(i),l(u(e)+n).then(r,o);else{var p=h(e);i=c.modifiedFeaturesLayer.getFeatureById(n),i?(c.modifiedFeaturesLayer.removeFeature(i),c.removedFeaturesLayer.addFeature(e._createAuxFeature(t)),l(d(e)+n).then((function(){r(),s(p+n,t).then(r,o)}),o)):(i=c.removedFeaturesLayer.getFeatureById(n),i||(c.removedFeaturesLayer.addFeature(e._createAuxFeature(t)),s(p+n,t).then(r,o)))}}},m._createAuxFeature=function(t){const e=t.provId||t.id,n=this.getLayerEditData(),r=new t.constructor(t.geometry,{geometryName:n.geometryName,data:t.getData()});return r.setStyle(null),r.setId(e),r},m.getEditControl=function(){const t=this;return t._editPromise||new Promise((function(e,n){t.renderPromise().then((()=>e(t.editControl)))}))},m.cacheLayer=function(t){const e=this;return new Promise((function(n,r){e.getServiceWorker().then((async function(){if(navigator.onLine){const o=t.wrap.getGetFeatureUrl(),i=await t.getDescribeFeatureTypeUrl();o&&i?e.createCache(c(e,t),{urlList:[o,i]}).then((()=>n()),(t=>r(t))):n()}else n()})).catch((t=>r(t)))}))},m.getFeatureType=function(t){const e=this;return new Promise((function(n,r){t=t||e.layer;const o=e.map.getLoadingIndicator(),i=o&&o.addWait();t.describeFeatureType().then((function(r){e.getEditControl().then((function(o){const i=e.getLayerEditData(t);let a;for(a in i.attributes={},r){const t=r[a],e=o.getGeometryType(t.type);e?(i.geometryName=t.name,i.geometryType="boolean"==typeof e?null:e):i.attributes[a]=t}for(a in i.attributes){const t=i.attributes[a];t.type=t.type.substr(t.type.indexOf(":")+1)}n(i)}))})).catch((function(t){r(t)})).finally((()=>o&&o.removeWait(i)))}))},m._addAuxLayersToMap=function(t){const e=this;return new Promise((function(n,r){const o=e.map;t=t||e.layer;const i=e.getLayerEditData(t),a=i.beforeEditLayer;if(a){const r=i.addedFeaturesLayer,s=i.modifiedFeaturesLayer,l=i.removedFeaturesLayer;Promise.all([o.addLayer(a),o.addLayer(r),o.addLayer(s),o.addLayer(l)]).then((function(){e.getEditableLayer(t).then((function(t){let c=o.layers.indexOf(t);a.setVisibility(e.showsOriginalFeatures),r.setVisibility(e.highlightsAdded),s.setVisibility(e.highlightsModified),l.setVisibility(e.highlightsRemoved),o.insertLayer(a,++c,(function(){const u=c+1;o.insertLayer(r,u),o.insertLayer(s,u),o.insertLayer(l,u),a.setStyles(e.getBeforeEditLayerStyle(t)),r.setStyles(e.getAddedFeaturesLayerStyle(t)),s.setStyles(e.getModifiedFeaturesLayerStyle(t)),l.setStyles(e.getRemovedFeaturesLayerStyle(t)),e._editingWatch.src=g(t,i.geometryType),e._beforeEditLayerWatch.src=g(a,i.geometryType),e._addedWatch.src=g(r,i.geometryType),e._modifiedWatch.src=g(s,i.geometryType),e._removedWatch.src=g(l,i.geometryType),n()}))}))}))}else r(new Error(`No auxiliary layers for ${t.id}`))}))},m.openEditSession=function(){const t=this;return t.layer?new Promise((function(e,r){t.getFeatureType().then((function(o){t.getEditControl().then((function(s){t.getEditableLayer(t.layer).then((function(l){switch(s.setLayer(l),o.geometryType){case i.Z.Consts.geom.MULTIPOLYLINE:case i.Z.Consts.geom.MULTIPOLYGON:s.setComplexGeometry(!0);break;default:s.setComplexGeometry(!1)}s.activate(),n(t,!0),a(t);const c=[i.Z.control.Edit.mode.MODIFY,i.Z.control.Edit.mode.OTHER];switch(o.geometryType){case i.Z.Consts.geom.POINT:c.push(i.Z.control.Edit.mode.ADDPOINT);break;case i.Z.Consts.geom.POLYLINE:case i.Z.Consts.geom.MULTIPOLYLINE:c.push(i.Z.control.Edit.mode.ADDLINE);break;case i.Z.Consts.geom.POLYGON:case i.Z.Consts.geom.MULTIPOLYGON:c.push(i.Z.control.Edit.mode.ADDPOLYGON)}s.constrainModes(c),s.setMode(i.Z.control.Edit.mode.MODIFY),t._addAuxLayersToMap().then((()=>e())).catch((t=>r(t)))}))}))})).catch((function(o){t.layer&&t.layer.type===i.Z.Consts.layerType.VECTOR?t.getEditControl().then((function(r){r.activate(),n(t,!0),r.setMode(i.Z.control.Edit.mode.MODIFY),e()})):r(o)}))})):Promise.reject(Error("No layer set for editing"))},m.closeEditSession=function(){const t=this;return new Promise((function(e,n){t.renderPromise().then((function(){a(t,!1),t.getEditControl().then((t=>t.deactivate()));const n=t.getLayerEditData();if(n&&n.beforeEditLayer){t._editingWatch.src=i.Z.Consts.BLANK_IMAGE,t._beforeEditLayerWatch.src=i.Z.Consts.BLANK_IMAGE,t._addedWatch.src=i.Z.Consts.BLANK_IMAGE,t._modifiedWatch.src=i.Z.Consts.BLANK_IMAGE,t._removedWatch.src=i.Z.Consts.BLANK_IMAGE;const r=t.layer;t.getEditableLayer(t.layer).then((function(o){const i=[],a=function(e){t.map.workLayers.indexOf(e)>=0&&i.push(t.map.removeLayer(e))};a(n.beforeEditLayer),a(n.beforeEditLayer),a(n.addedFeaturesLayer),a(n.modifiedFeaturesLayer),a(n.removedFeaturesLayer),r!==o&&(r.wfsLayer=null,a(o)),Promise.all(i).then((()=>e()))}))}else e()}))}))},m.getEditableLayer=function(t){const e=this;return new Promise((function(n,r){const o=`Layer ${t.id} not editable`,a=e.map;(t=a?a.getLayer(t):t)?t.type!==i.Z.Consts.layerType.WFS||!t.wmsLayer&&(t.options.stealth||t.options.readOnly)?t.type===i.Z.Consts.layerType.WMS?t.wfsLayer?t.wfsLayer.getCapabilitiesPromise().then((()=>n(t.wfsLayer))):t.getWFSCapabilities().then((async function(s){const l=t.getDisgregatedLayerNames(),c=l[0],u=c.indexOf(":"),p=c.substring(u+1);if(1!==l.length||Object.prototype.hasOwnProperty.call(s.FeatureTypes,p)){const r={id:e.getUID(),type:i.Z.Consts.layerType.WFS,url:await t.getWFSURL(),properties:a?new i.Z.filter.Bbox(null,a.getExtent(),a.getCRS()):null,outputFormat:i.Z.Consts.format.JSON,title:`${t.getPath().join(" • ")} - ${e.getLocaleString("featureEditing")}`,geometryName:"geom",featureType:[c],featureNS:"Edicion",styles:e.styles,stealth:!0};t.wfsLayer=new i.Z.layer.Vector(r),t.wfsLayer.wmsLayer=t,n(t.wfsLayer)}else r(new Error(o))})).catch((t=>r(t))):t.type===i.Z.Consts.layerType.VECTOR?n(t):r(new Error(o)):t.getCapabilitiesPromise().then((()=>n(t))):r(new Error("No layer to edit"))}))},m.isLayerEdited=function(t){const e=this;return new Promise((function(n,r){const i=c(e,t);o().keys().then((function(t){n(!!t&&t.some((t=>0===t.indexOf(i))))}))}))},m.getLayerEditData=function(t){const e=this,n=t||e.layer;return n?e.layersEditData[n.id]=e.layersEditData[n.id]||{checkedOut:!1}:null};const g=function(t,e){switch(e){case i.Z.Consts.geom.POINT:case i.Z.Consts.geom.MULTIPOINT:return i.Z.Util.getLegendImageFromStyle(t.styles.point,{geometryType:i.Z.Consts.geom.POINT});case i.Z.Consts.geom.POLYLINE:case i.Z.Consts.geom.MULTIPOLYLINE:return i.Z.Util.getLegendImageFromStyle(t.styles.line,{geometryType:i.Z.Consts.geom.POLYLINE});default:return i.Z.Util.getLegendImageFromStyle(t.styles.polygon,{geometryType:i.Z.Consts.geom.POLYGON})}};m._enableEditSerialization=function(e){const n=this;return new Promise((function(r,a){n.getEditableLayer(e).then((function(a){const s=function(){const s=n.getLayerEditData(e),l=f(e);var p=s.beforeEditLayer;p||(p=s.beforeEditLayer=new i.Z.layer.Vector(i.Z.Util.extend({},a.options,{id:n.getUID(),title:`${l} - ${n.getLocaleString("dataBeforeEdits")}`,readOnly:!0,owner:n,stealth:!0})));var m=s.addedFeaturesLayer;let g=!0;m||(g=!1,m=s.addedFeaturesLayer=new i.Z.layer.Vector({id:n.getUID(),title:`${l} - ${n.getLocaleString("addedFeatures")}`,owner:n,stealth:!0,zIndex:2}));var y=s.modifiedFeaturesLayer;let v=!0;y||(v=!1,y=s.modifiedFeaturesLayer=new i.Z.layer.Vector({id:n.getUID(),title:`${l} - ${n.getLocaleString("modifiedFeatures")}`,owner:n,stealth:!0,zIndex:2}));var _=s.removedFeaturesLayer;let C=!0;_||(C=!1,_=s.removedFeaturesLayer=new i.Z.layer.Vector({id:n.getUID(),title:`${l} - ${n.getLocaleString("removedFeatures")}`,owner:n,stealth:!0,zIndex:2}));const E=[];if(g&&v&&C)_.features.forEach((function(t){const e=a.getFeatureById(t.id);e&&a.removeFeature(e)})),y.features.forEach((function(t){const e=a.getFeatureById(t.id);e&&(e.setCoords(t.geometry),e.setData(t.getData()))})),m.features.forEach((function(t){a.getFeatureById(t.id)||E.push(a.addFeature(n._createAuxFeature(t)))})),Promise.all(E).then((()=>{s.serializable=!0,r(a)}));else{const e=c(n,a),l=u(n,a),p=d(n,a),f=h(n,a);o().keys().then((function(n){n&&n.filter((t=>0===t.indexOf(e))).forEach((function(e){E.push(new Promise((function(n,r){(function(t){return new Promise((function(e,n){o().getItem(t).then((function(n){e({key:t,feature:n})})).catch((function(t){n(t)}))}))})(e).then((function(e){var r,o=e.key;if(0===o.indexOf(f)){r=o.substr(f.length);const t=a.getFeatureById(r);a.removeFeature(t),_.addFeature(t).then((()=>n(t)))}else if(0===o.indexOf(p)){r=o.substr(p.length);const t=a.getFeatureById(r);if(t){t.setCoords(e.feature.geometry),t.setData(e.feature.attributes);const r=t.clone();r.setId(t.id),y.addFeature(r).then((()=>n(t)))}else n(t)}else if(0===o.indexOf(l)){r=o.substr(l.length);var s,c=parseInt(r.substr(r.lastIndexOf(".")+1));switch(t=Math.max(t,c+1),e.feature.type){case i.Z.Consts.geom.POINT:s=a.addPoint(e.feature.geometry);break;case i.Z.Consts.geom.POLYLINE:s=a.addPolyline(e.feature.geometry);break;case i.Z.Consts.geom.POLYGON:s=a.addPolygon(e.feature.geometry);break;case i.Z.Consts.geom.MULTIPOLYLINE:s=a.addMultiPolyline(e.feature.geometry);break;case i.Z.Consts.geom.MULTIPOLYGON:s=a.addMultiPolygon(e.feature.geometry)}s.then((function(t){t.provId=r,t.setData(e.feature.attributes);const o=t.clone();o.setStyle(null),o.setId(t.provId),m.addFeature(o).then((()=>n(o)))}))}}))})))})),Promise.all(E).then((()=>{s.serializable=!0,r(a)}))}))}};if(a.type===i.Z.Consts.layerType.WFS)if(a.state===i.Z.Layer.state.IDLE)s();else{const t=function(e){e.layer===a&&(s(),n.map.off(i.Z.Consts.event.LAYERUPDATE,t))};n.map.on(i.Z.Consts.event.LAYERUPDATE,t)}else r(a)}))}))},m.applyEdits=function(){const t=this;if(t.layer){const n=t.getLayerEditData();if(n.serializable){t.isSyncing=!0,e(t);const r=t.map.getLoadingIndicator(),o=r&&r.addWait(),a=n.modifiedFeaturesLayer.features.map((function(t){const e=new t.constructor(t.geometry,{geometryName:n.geometryName}),r=n.beforeEditLayer.features.filter((e=>e.id===t.id))[0];let o;if(r){for(var i in o={},t.data)if("id"!==i){const e=r.data[i],n=t.data[i];e!==n&&(o[i]=n)}}else o=t.data;return e.setData(o),e.setId(t.id),e}));t.getEditableLayer(t.layer).then((function(s){s.applyEdits(n.addedFeaturesLayer.features,a,n.removedFeaturesLayer.features).then((function(e){if(e.transactionSummary.totalInserted!==n.addedFeaturesLayer.features.length||e.transactionSummary.totalUpdated!==a.length||e.transactionSummary.totalDeleted!==n.removedFeaturesLayer.features.length)throw i.Z.error("Error de concordancia de número de entidades en transacción"),console.log(e,n.addedFeaturesLayer,a,n.removedFeaturesLayer),new Error(`Error en transacción: Insertados ${e.transactionSummary.totalInserted}, hay ${n.addedFeaturesLayer.features.length} en capa`);t.layer.type===i.Z.Consts.layerType.WMS&&t.layer.refresh(),t.deleteCache(c(t)).then((function(){t.cacheLayer(s).finally((function(){t.isSyncing=!1,r&&r.removeWait(o),t.discardEdits(),t.map.toast(t.getLocaleString("changesSuccessfullySyncedWithServer"),{type:i.Z.Consts.msgType.INFO})}))}))})).catch((function(n){t.isSyncing=!1,e(t),r&&r.removeWait(o),i.Z.error(t.getLocaleString("errorSyncingChanges",{code:n.code,reason:n.reason}),[i.Z.Consts.msgErrorMode.TOAST,i.Z.Consts.msgErrorMode.CONSOLE])}))}))}}},m.discardEdits=function(){var t=this;t._joinedFeatureAttributes=[];var e=c(t);o().keys().then((function(n){if(n){for(var r=0,i=n.length;r<i;r++){var s=n[r];0===s.indexOf(e)&&o().removeItem(s)}if(t.layer){const e=t.getLayerEditData();e.serializable&&(e.addedFeaturesLayer.clearFeatures(),e.modifiedFeaturesLayer.clearFeatures(),e.removedFeaturesLayer.clearFeatures(),t.editControl.setSelectedFeatures([]),t.editControl.modifyControl.closeAttributes(),t.getEditableLayer(t.layer).then((t=>t.refresh())))}a(t,!1)}})),t.editControl.setMode(null)},m.showOriginalFeatures=function(t){this.showsOriginalFeatures=t;const e=this.getLayerEditData();e&&e.beforeEditLayer.setVisibility(t)},m.highlightAdded=function(t){this.highlightsAdded=t;const e=this.getLayerEditData();e&&e.addedFeaturesLayer&&e.addedFeaturesLayer.setVisibility(t)},m.highlightModified=function(t){this.highlightsModified=t;const e=this.getLayerEditData();e&&e.modifiedFeaturesLayer&&e.modifiedFeaturesLayer.setVisibility(t)},m.highlightRemoved=function(t){this.highlightsRemoved=t;const e=this.getLayerEditData();e&&e.removedFeaturesLayer&&e.removedFeaturesLayer.setVisibility(t)};const y=function(t,e){const n={};switch(t.getLayerEditData(e.wmsLayer||e).geometryType){case i.Z.Consts.geom.POLYGON:case i.Z.Consts.geom.MULTIPOLYGON:n.polygon=e.map.options.styles.polygon;break;case i.Z.Consts.geom.POLYLINE:case i.Z.Consts.geom.MULTIPOLYLINE:n.line=e.map.options.styles.line;break;default:n.point=e.map.options.styles.point}return n};m.getBeforeEditLayerStyle=function(t){const e=function(e){const n=t.wrap.getRGBA(e);for(var r=0;r<3;r++)n[r]=255-n[r];return"#"+(65536*n[0]+256*n[1]+n[2]).toString(16).padStart(6,"0")},n=[1,3],r=i.Z.Util.extend(!0,{},t.options.styles||y(this,t));return r.point&&(r.point.strokeColor=e(r.point.strokeColor),r.point.lineDash=n),r.line&&(r.line.strokeColor=e(r.line.strokeColor),r.line.lineDash=n),r.polygon&&(r.polygon.strokeColor=e(r.polygon.strokeColor),r.polygon.lineDash=n),r};const v=function(t,e,n){const r=i.Z.Util.extend(!0,{},e.options.styles||y(t,e));return r.point&&(r.point.strokeColor=n,r.point.fillColor=n),r.line&&(r.line.strokeColor=n),r.polygon&&(r.polygon.strokeColor=n,r.polygon.fillColor=n),r};m.getAddedFeaturesLayerStyle=function(t){const e=this.getLayerEditData(t.wmsLayer||t);return v(this,t,e.addedCustomColor||"#00ff00")},m.getModifiedFeaturesLayerStyle=function(t){const e=this.getLayerEditData(t.wmsLayer||t);return v(this,t,e.modifiedCustomColor||"#ff7f00")},m.getRemovedFeaturesLayerStyle=function(t){const e=this.getLayerEditData(t.wmsLayer||t);return v(this,t,e.removedCustomColor||"#ff0000")}}();const d=i.Z.control.WFSEdit},3698:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>g});var r=n(5361),o=n(2089),i=n(6498),a=n(7901),s=n(4496),l=n(7364),c=n(1299),u=n(2391),p=n(1327),d=n(6281),h=n(9706),f=n(4323),m=n(1709);r.Z.control=r.Z.control||{},"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),r=1;r<arguments.length;r++){var o=arguments[r];if(null!=o)for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])}return n},writable:!0,configurable:!0}),r.Z.control=r.Z.control||{},r.Z.control.infoShare=a.default,r.Z.UI=r.Z.UI||{},r.Z.UI.autocomplete=l.Z,r.Z.Control=i.Z,r.Z.Consts=o.Z,r.Z.filter=s.Z,r.Z.Feature=c.Z,r.Z.feature=r.Z.feature||{},r.Z.feature.Point=u.Z,r.Z.feature.Polyline=p.Z,r.Z.feature.Polygon=d.Z,r.Z.feature.MultiPolyline=h.Z,r.Z.feature.MultiPolygon=f.Z,r.Z.control.WFSQuery=function(t){var e=this;r.Z.Control.apply(this,arguments),e._dialogDiv=r.Z.Util.getDiv(e.options.dialogDiv),e.options.dialogDiv||document.body.appendChild(e._dialogDiv),e.exportsState=!0,e.styles=e.options.styles,e.highlightStyles=e.options.highlightStyles||e.options.highLightStyles,e.download=e.options.download,e.resultsPanel=null,e.geometryPanel=null,e.filters=[],e.deletedFeatures=[],e.styles=r.Z.Util.extend(!0,{polygon:{strokeColor:e.DEFAULT_STROKE_COLOR,strokeWidth:2,fillColor:"#000",fillOpacity:.3},line:{strokeColor:e.DEFAULT_STROKE_COLOR,strokeWidth:2,fillColor:"#000"}},e.options.styles);const n="."+e.CLASS;e._selectors={ELEVATION_CHECKBOX:n+"-dialog-elev input[type=checkbox]",INTERPOLATION_RADIO:"input[type=radio][name=finfo-ip-coords]",INTERPOLATION_DISTANCE:n+"-dialog-ip-m"}},r.Z.inherit(r.Z.control.WFSQuery,r.Z.Control),r.Z.mix(r.Z.control.WFSQuery,r.Z.control.infoShare),function(){const t=r.Z.control.WFSQuery.prototype;t.DEFAULT_STROKE_COLOR="#0000ff";const e=r.Z.Consts.classes.LOADING,n=r.Z.Consts.classes.HIDDEN,o="tc-spatial";var i=null,a=null,s=null,l=null,c=null;const u=function(t){if(t)for(;t.children.length;)t.removeChild(t.children[0])},p={eq:{Ctor:r.Z.filter.equalTo,key:"query.equalTo"},neq:{Ctor:r.Z.filter.notEqualTo,key:"query.notEqualTo"},gt:{Ctor:r.Z.filter.greaterThan,key:"query.greaterThan"},lt:{Ctor:r.Z.filter.lessThan,key:"query.lowerThan"},gte:{Ctor:r.Z.filter.greaterThanOrEqualTo,key:"query.greaterThanOrEqualTo"},lte:{Ctor:r.Z.filter.lessThanOrEqualTo,key:"query.lowerThanOrEqualTo"},contains:{Ctor:r.Z.filter.like,key:"query.contains"},starts:{Ctor:r.Z.filter.like,key:"query.startsBy"},ends:{Ctor:r.Z.filter.like,key:"query.endsBy"},btw:{Ctor:r.Z.filter.between,key:"query.equalTo"},nbtw:{key:"query.notEqualTo"},intersects:{Ctor:r.Z.filter.like,key:"query.intersects"},within:{Ctor:r.Z.filter.between,key:"query.within"},empty:{Ctor:r.Z.filter.equalTo,key:"query.empty"},null:{Ctor:r.Z.filter.isNull,key:"query.empty"}};var d=null,h=null,f=null,g=null,y=null,v=function(){return null},_=function(){return null},C=null,E=null;t.CLASS="tc-ctl-wfsquery",t.template={},t.template[t.CLASS+"-dialog"]={1:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <div>\r\n                    <select class="tc-combo" name="availableLayers">\r\n                        <option value="">'+t.escapeExpression(s(n,"i18n").call(a,"query.chooseALayerCombo",{name:"i18n",hash:{},data:o,loc:{start:{line:13,column:41},end:{line:13,column:75}}}))+"</option>\r\n"+(null!=(i=s(n,"each").call(a,null!=e?s(e,"layers"):e,{name:"each",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:14,column:24},end:{line:16,column:33}}}))?i:"")+"                    </select>\r\n                </div>            \r\n"},2:function(t,e,n,r,o){var i=t.lambda,a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                        <option value="'+a(i(null!=e?s(e,"name"):e,e))+'">'+a(i(null!=e?s(e,"title"):e,e))+"</option>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=t.escapeExpression,s=null!=e?e:t.nullContext||{},l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-wfsquery-dialog tc-modal">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window tc-ctl-wfsquery-modal-window" >\r\n        <div class="tc-modal-header">\r\n            <h3>'+a(t.lambda(null!=e?l(e,"layerName"):e,e))+'</h3>\r\n            <div title="'+a(l(n,"i18n").call(s,"query.tooltipCloseDialogBtn",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:24},end:{line:6,column:62}}}))+'" class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            \r\n'+(null!=(i=l(n,"if").call(s,l(n,"gt").call(s,null!=(i=null!=e?l(e,"layers"):e)?l(i,"length"):i,1,{name:"gt",hash:{},data:o,loc:{start:{line:10,column:18},end:{line:10,column:38}}}),{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:10,column:12},end:{line:19,column:19}}}))?i:"")+'                <div class="tc-modal-form">\r\n                </div>\r\n                <div class="tc-ctl-wfsquery-message tc-hidden"></div>                 \r\n            </div>\r\n        <div class="tc-modal-footer">\r\n            <button type="button" title="'+a(l(n,"i18n").call(s,"query.tooltipSendQueryBtn",{name:"i18n",hash:{},data:o,loc:{start:{line:25,column:41},end:{line:25,column:77}}}))+'" class="tc-button tc-ctl-wlm-btn-launch">'+a(l(n,"i18n").call(s,"query.sendQueryBtnText",{name:"i18n",hash:{},data:o,loc:{start:{line:25,column:119},end:{line:25,column:152}}}))+'</button>\r\n            <button type="button" title="'+a(l(n,"i18n").call(s,"query.cancelQueryTooltip",{name:"i18n",hash:{},data:o,loc:{start:{line:26,column:41},end:{line:26,column:76}}}))+'" class="tc-button tc-modal-close">'+a(l(n,"i18n").call(s,"query.cancelQueryButton",{name:"i18n",hash:{},data:o,loc:{start:{line:26,column:111},end:{line:26,column:145}}}))+"</button>\r\n        </div>\r\n    </div>\r\n</div>"},useData:!0},t.template[t.CLASS+"-form"]={1:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <select class="tc-combo" name="attributes">\r\n        <option value="">'+t.escapeExpression(s(n,"i18n").call(a,"query.chooseAttrCombo",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:25},end:{line:4,column:57}}}))+"</option>\r\n"+(null!=(i=s(n,"each").call(a,null!=e?s(e,"attributes"):e,{name:"each",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:5,column:8},end:{line:9,column:17}}}))?i:"")+"    </select>\r\n"},2:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"unless").call(a,s(n,"eq").call(a,o&&s(o,"key"),"FEATURE",{name:"eq",hash:{},data:o,loc:{start:{line:6,column:22},end:{line:6,column:41}}}),{name:"unless",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:6,column:12},end:{line:8,column:23}}}))?i:""},3:function(t,e,n,r,o){var i,a=t.lambda,s=t.escapeExpression,l=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <option value="'+s(a(o&&c(o,"key"),e))+'"'+(null!=(i=c(n,"if").call(l,null!=e?c(e,"isGeometry"):e,{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.noop,data:o,loc:{start:{line:7,column:32},end:{line:7,column:95}}}))?i:"")+">"+s(a(o&&c(o,"key"),e))+(null!=(i=c(n,"if").call(l,null!=e?c(e,"isGeometry"):e,{name:"if",hash:{},fn:t.program(6,o,0),inverse:t.noop,data:o,loc:{start:{line:7,column:104},end:{line:7,column:156}}}))?i:"")+"</option>\r\n"},4:function(t,e,n,r,o){return' class="tc-ctl-wfsquery-opt-geom"'},6:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return" ("+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"geometry",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:129},end:{line:7,column:148}}}))+")"},8:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <div class="tc-ctl-wfsquery-message tc-msg-warning">'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"query.noAttributes",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:60},end:{line:12,column:89}}}))+"</div>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lambda,l=t.escapeExpression,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<div>\r\n"+(null!=(i=c(n,"if").call(a,c(n,"countif").call(a,null!=e?c(e,"attributes"):e,"FEATURE",{name:"countif",hash:{},data:o,loc:{start:{line:2,column:10},end:{line:2,column:40}}}),{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(8,o,0),data:o,loc:{start:{line:2,column:4},end:{line:13,column:11}}}))?i:"")+'    \r\n</div>\r\n<div class="tc-ctl-wfsquery-op tc-hidden">\r\n    <div class="tc-ctl-wfsquery tc-ctl-wfsquery-numeric tc-hidden">\r\n        <input type="radio" id="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-1" name="'+l(s(null!=e?c(e,"controlId"):e,e))+'-condition" value="eq" /><label for="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-1" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+l(c(n,"i18n").call(a,null!=(i=null!=(i=null!=e?c(e,"operators"):e)?c(i,"eq"):i)?c(i,"key"):i,{name:"i18n",hash:{},data:o,loc:{start:{line:18,column:172},end:{line:18,column:197}}}))+'</label>\r\n        <input type="radio" id="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-2" name="'+l(s(null!=e?c(e,"controlId"):e,e))+'-condition" value="neq" /><label for="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-2" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+l(c(n,"i18n").call(a,null!=(i=null!=(i=null!=e?c(e,"operators"):e)?c(i,"neq"):i)?c(i,"key"):i,{name:"i18n",hash:{},data:o,loc:{start:{line:19,column:173},end:{line:19,column:199}}}))+'</label>\r\n        <input type="radio" id="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-3" name="'+l(s(null!=e?c(e,"controlId"):e,e))+'-condition" value="gt" /><label for="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-3" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+l(c(n,"i18n").call(a,null!=(i=null!=(i=null!=e?c(e,"operators"):e)?c(i,"gt"):i)?c(i,"key"):i,{name:"i18n",hash:{},data:o,loc:{start:{line:20,column:172},end:{line:20,column:197}}}))+'</label>\r\n        <input type="radio" id="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-4" name="'+l(s(null!=e?c(e,"controlId"):e,e))+'-condition" value="lt" /><label for="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-4" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+l(c(n,"i18n").call(a,null!=(i=null!=(i=null!=e?c(e,"operators"):e)?c(i,"lt"):i)?c(i,"key"):i,{name:"i18n",hash:{},data:o,loc:{start:{line:21,column:172},end:{line:21,column:197}}}))+'</label>\r\n        <input type="radio" id="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-5" name="'+l(s(null!=e?c(e,"controlId"):e,e))+'-condition" value="gte" /><label for="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-5" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+l(c(n,"i18n").call(a,null!=(i=null!=(i=null!=e?c(e,"operators"):e)?c(i,"gte"):i)?c(i,"key"):i,{name:"i18n",hash:{},data:o,loc:{start:{line:22,column:173},end:{line:22,column:199}}}))+'</label>\r\n        <input type="radio" id="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-6" name="'+l(s(null!=e?c(e,"controlId"):e,e))+'-condition" value="lte" /><label for="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-6" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+l(c(n,"i18n").call(a,null!=(i=null!=(i=null!=e?c(e,"operators"):e)?c(i,"lte"):i)?c(i,"key"):i,{name:"i18n",hash:{},data:o,loc:{start:{line:23,column:173},end:{line:23,column:199}}}))+'</label>\r\n        \x3c!--<input type="radio" id="cond_7" name="condition" value="like" /><label for="cond_7" class="tc-ctl-wfsquery-cond">es como</label>--\x3e\r\n    </div>\r\n    <div class="tc-ctl-wfsquery tc-ctl-wfsquery-text tc-hidden">\r\n        <input type="radio" id="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-8" name="'+l(s(null!=e?c(e,"controlId"):e,e))+'-condition" value="eq" /><label for="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-8" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+l(c(n,"i18n").call(a,null!=(i=null!=(i=null!=e?c(e,"operators"):e)?c(i,"eq"):i)?c(i,"key"):i,{name:"i18n",hash:{},data:o,loc:{start:{line:27,column:172},end:{line:27,column:197}}}))+'</label>\r\n        <input type="radio" id="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-9" name="'+l(s(null!=e?c(e,"controlId"):e,e))+'-condition" value="contains" /><label for="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-9" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+l(c(n,"i18n").call(a,null!=(i=null!=(i=null!=e?c(e,"operators"):e)?c(i,"contains"):i)?c(i,"key"):i,{name:"i18n",hash:{},data:o,loc:{start:{line:28,column:178},end:{line:28,column:209}}}))+'</label>\r\n        <input type="radio" id="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-10" name="'+l(s(null!=e?c(e,"controlId"):e,e))+'-condition" value="starts" /><label for="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-10" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+l(c(n,"i18n").call(a,null!=(i=null!=(i=null!=e?c(e,"operators"):e)?c(i,"starts"):i)?c(i,"key"):i,{name:"i18n",hash:{},data:o,loc:{start:{line:29,column:178},end:{line:29,column:207}}}))+'</label>\r\n        <input type="radio" id="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-11" name="'+l(s(null!=e?c(e,"controlId"):e,e))+'-condition" value="ends" /><label for="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-11" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+l(c(n,"i18n").call(a,null!=(i=null!=(i=null!=e?c(e,"operators"):e)?c(i,"ends"):i)?c(i,"key"):i,{name:"i18n",hash:{},data:o,loc:{start:{line:30,column:176},end:{line:30,column:203}}}))+'</label>\r\n        <input type="radio" id="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-20" name="'+l(s(null!=e?c(e,"controlId"):e,e))+'-condition" value="empty" /><label for="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-20" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+l(c(n,"i18n").call(a,null!=(i=null!=(i=null!=e?c(e,"operators"):e)?c(i,"empty"):i)?c(i,"key"):i,{name:"i18n",hash:{},data:o,loc:{start:{line:31,column:177},end:{line:31,column:205}}}))+'</label>\r\n    </div>\r\n    <div class="tc-ctl-wfsquery tc-ctl-wfsquery-date tc-hidden">\r\n        <input type="radio" id="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-12" name="'+l(s(null!=e?c(e,"controlId"):e,e))+'-condition" value="btw" /><label for="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-12" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+l(c(n,"i18n").call(a,null!=(i=null!=(i=null!=e?c(e,"operators"):e)?c(i,"btw"):i)?c(i,"key"):i,{name:"i18n",hash:{},data:o,loc:{start:{line:34,column:175},end:{line:34,column:201}}}))+'</label>\r\n        <input type="radio" id="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-13" name="'+l(s(null!=e?c(e,"controlId"):e,e))+'-condition" value="nbtw" /><label for="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-13" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+l(c(n,"i18n").call(a,null!=(i=null!=(i=null!=e?c(e,"operators"):e)?c(i,"nbtw"):i)?c(i,"key"):i,{name:"i18n",hash:{},data:o,loc:{start:{line:35,column:176},end:{line:35,column:203}}}))+'</label>\r\n        <input type="radio" id="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-14" name="'+l(s(null!=e?c(e,"controlId"):e,e))+'-condition" value="gt" /><label for="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-14" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+l(c(n,"i18n").call(a,null!=(i=null!=(i=null!=e?c(e,"operators"):e)?c(i,"gt"):i)?c(i,"key"):i,{name:"i18n",hash:{},data:o,loc:{start:{line:36,column:174},end:{line:36,column:199}}}))+'</label>\r\n        <input type="radio" id="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-15" name="'+l(s(null!=e?c(e,"controlId"):e,e))+'-condition" value="lt" /><label for="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-15" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+l(c(n,"i18n").call(a,null!=(i=null!=(i=null!=e?c(e,"operators"):e)?c(i,"lt"):i)?c(i,"key"):i,{name:"i18n",hash:{},data:o,loc:{start:{line:37,column:174},end:{line:37,column:199}}}))+'</label>\r\n        <input type="radio" id="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-16" name="'+l(s(null!=e?c(e,"controlId"):e,e))+'-condition" value="gte" /><label for="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-16" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+l(c(n,"i18n").call(a,null!=(i=null!=(i=null!=e?c(e,"operators"):e)?c(i,"gte"):i)?c(i,"key"):i,{name:"i18n",hash:{},data:o,loc:{start:{line:38,column:175},end:{line:38,column:201}}}))+'</label>\r\n        <input type="radio" id="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-17" name="'+l(s(null!=e?c(e,"controlId"):e,e))+'-condition" value="lte" /><label for="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-17" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+l(c(n,"i18n").call(a,null!=(i=null!=(i=null!=e?c(e,"operators"):e)?c(i,"lte"):i)?c(i,"key"):i,{name:"i18n",hash:{},data:o,loc:{start:{line:39,column:175},end:{line:39,column:201}}}))+'</label>\r\n        <input type="radio" id="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-21" name="'+l(s(null!=e?c(e,"controlId"):e,e))+'-condition" value="null" /><label for="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-21" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+l(c(n,"i18n").call(a,null!=(i=null!=(i=null!=e?c(e,"operators"):e)?c(i,"empty"):i)?c(i,"key"):i,{name:"i18n",hash:{},data:o,loc:{start:{line:40,column:176},end:{line:40,column:204}}}))+'</label>\r\n        \x3c!--<input type="radio" id="cond_7" name="condition" value="like" /><label for="cond_7" class="tc-ctl-wfsquery-cond">es como</label>--\x3e\r\n    </div>\r\n    <div class="tc-ctl-wfsquery tc-ctl-wfsquery-geom tc-hidden">\r\n        <input type="radio" id="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-18" name="'+l(s(null!=e?c(e,"controlId"):e,e))+'-condition" value="intersects" /><label for="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-18" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+l(c(n,"i18n").call(a,null!=(i=null!=(i=null!=e?c(e,"operators"):e)?c(i,"intersects"):i)?c(i,"key"):i,{name:"i18n",hash:{},data:o,loc:{start:{line:44,column:182},end:{line:44,column:215}}}))+'</label>\r\n        <input type="radio" id="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-19" name="'+l(s(null!=e?c(e,"controlId"):e,e))+'-condition" value="within" /><label for="'+l(s(null!=e?c(e,"controlId"):e,e))+'-cond-19" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+l(c(n,"i18n").call(a,null!=(i=null!=(i=null!=e?c(e,"operators"):e)?c(i,"within"):i)?c(i,"key"):i,{name:"i18n",hash:{},data:o,loc:{start:{line:45,column:178},end:{line:45,column:207}}}))+'</label>\r\n    </div>\r\n    <div class="tc-ctl-wfsquery-where tc-hidden">\r\n        <div class="tc-ctl-wfsquery-value">\r\n            <input type="search" placeholder="'+l(c(n,"i18n").call(a,"query.searchFieldPhd",{name:"i18n",hash:{},data:o,loc:{start:{line:49,column:46},end:{line:49,column:77}}}))+'" class="tc-textbox" />\r\n            <button type="button" title="'+l(c(n,"i18n").call(a,"query.tooltipAddCondBtn",{name:"i18n",hash:{},data:o,loc:{start:{line:50,column:41},end:{line:50,column:75}}}))+'" class="tc-button">'+l(c(n,"i18n").call(a,"query.textAddCondBtn",{name:"i18n",hash:{},data:o,loc:{start:{line:50,column:95},end:{line:50,column:126}}}))+'</button>\r\n            <ul class="tc-ctl-wfsquery-list tc-ctl-search-list tc-hidden"></ul>\r\n        </div>\r\n        <div class="tc-ctl-wfsquery-geomtype">\r\n            <button type="button" class="tc-ctl-btn tc-ctl-wfsquery-geomtype-box-btn" name="geometry" value="rectangle">'+l(c(n,"i18n").call(a,"box",{name:"i18n",hash:{},data:o,loc:{start:{line:54,column:120},end:{line:54,column:134}}}))+'</button>\r\n            <button type="button" class="tc-ctl-btn tc-ctl-wfsquery-geomtype-line-btn" name="geometry" value="line">'+l(c(n,"i18n").call(a,"line",{name:"i18n",hash:{},data:o,loc:{start:{line:55,column:116},end:{line:55,column:131}}}))+'</button>\r\n            <button type="button" class="tc-ctl-btn tc-ctl-wfsquery-geomtype-polygon-btn" name="geometry" value="polygon">'+l(c(n,"i18n").call(a,"polygon",{name:"i18n",hash:{},data:o,loc:{start:{line:56,column:122},end:{line:56,column:140}}}))+'</button>\r\n        </div>\r\n        <div class="tc-ctl-wfsquery-key">\r\n            <label>'+l(c(n,"i18n").call(a,"query.logicalOpLbl",{name:"i18n",hash:{},data:o,loc:{start:{line:59,column:19},end:{line:59,column:48}}}))+'</label>\r\n        </div>\r\n        <div class="tc-ctl-wfsquery-log-ops">\r\n            <input type="radio" id="'+l(s(null!=e?c(e,"controlId"):e,e))+'-log-op-1" class="tc-ctl-wfsquery-logOpRadio" checked name="'+l(s(null!=e?c(e,"controlId"):e,e))+'-log-op" value="AND" /><label for="'+l(s(null!=e?c(e,"controlId"):e,e))+'-log-op-1" class="tc-ctl-btn tc-ctl-wfsquery-log-op">'+l(c(n,"i18n").call(a,"query.logicalOpAndLbl",{name:"i18n",hash:{},data:o,loc:{start:{line:62,column:223},end:{line:62,column:255}}}))+'</label>\r\n            <input type="radio" id="'+l(s(null!=e?c(e,"controlId"):e,e))+'-log-op-2" class="tc-ctl-wfsquery-logOpRadio" name="'+l(s(null!=e?c(e,"controlId"):e,e))+'-log-op" value="OR" /><label for="'+l(s(null!=e?c(e,"controlId"):e,e))+'-log-op-2" class="tc-ctl-btn tc-ctl-wfsquery-log-op">'+l(c(n,"i18n").call(a,"query.logicalOpOrLbl",{name:"i18n",hash:{},data:o,loc:{start:{line:63,column:214},end:{line:63,column:245}}}))+'</label>\r\n        </div>\r\n        <div class="tc-ctl-wfsquery-where-list"></div>\r\n    </div>\r\n</div>\r\n'},useData:!0},t.template[t.CLASS+"-filter"]={1:function(t,e,n,r,o,i,a){var s,l=t.lambda,c=t.escapeExpression,u=null!=e?e:t.nullContext||{},p=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-wfsquery-where-cond">\r\n    '+c(l(null!=e?p(e,"field"):e,e))+"&nbsp;"+c(l(null!=e?p(e,"opText"):e,e))+"&nbsp;"+c(p(n,"formatNumber").call(u,null!=e?p(e,"valueToShow"):e,null!=a[1]?p(a[1],"locale"):a[1],{name:"formatNumber",hash:{},data:o,loc:{start:{line:3,column:35},end:{line:3,column:73}}}))+(null!=(s=p(n,"if").call(u,null!=e?p(e,"isSpatial"):e,{name:"if",hash:{},fn:t.program(2,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:3,column:73},end:{line:3,column:182}}}))?s:"")+'\r\n</div>\r\n<div class="tc-ctl-wfsquery-del-cond" title="'+c(p(n,"i18n").call(u,"query.tooltipRemoveCond",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:45},end:{line:5,column:79}}}))+'"></div>\t\r\n'},2:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return' <button class="tc-icon-btn tc-ctl-wfsquery-where-cond-view">'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"view",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:151},end:{line:3,column:166}}}))+"</button>"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o,i,a){var s,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(s=l(n,"each").call(null!=e?e:t.nullContext||{},null!=e?l(e,"conditions"):e,{name:"each",hash:{},fn:t.program(1,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:1,column:0},end:{line:6,column:9}}}))?s:""},useData:!0,useDepths:!0},t.template[t.CLASS+"-table"]={1:function(t,e,n,r,o,i,a){var s,l=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(s=c(n,"unless").call(l,c(n,"startsWith").call(l,e,"h3_",{name:"startsWith",hash:{},data:o,loc:{start:{line:4,column:18},end:{line:4,column:41}}}),{name:"unless",hash:{},fn:t.program(2,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:4,column:8},end:{line:9,column:19}}}))?s:""},2:function(t,e,n,r,o,i,a){var s,l=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(s=c(n,"unless").call(l,c(n,"startsWith").call(l,e,"h4_",{name:"startsWith",hash:{},data:o,loc:{start:{line:5,column:18},end:{line:5,column:41}}}),{name:"unless",hash:{},fn:t.program(3,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:5,column:8},end:{line:8,column:19}}}))?s:""},3:function(t,e,n,r,o,i,a){var s,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"        <th"+(null!=(s=l(n,"if").call(null!=e?e:t.nullContext||{},null!=a[1]?l(a[1],"sort"):a[1],{name:"if",hash:{},fn:t.program(4,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:6,column:11},end:{line:6,column:259}}}))?s:"")+">\r\n            "+t.escapeExpression(t.lambda(e,e))+"</th>\r\n"},4:function(t,e,n,r,o,i,a){var s,l=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return' title="'+t.escapeExpression(c(n,"i18n").call(l,"wfs.QuerySortTitle",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:34},end:{line:6,column:63}}}))+'" class="tc-ctl-wfsquery-results-sortable'+(null!=(s=c(n,"if").call(l,c(n,"eq").call(l,e,null!=(s=null!=a[1]?c(a[1],"sort"):a[1])?c(s,"field"):s,{name:"eq",hash:{},data:o,loc:{start:{line:6,column:110},end:{line:6,column:133}}}),{name:"if",hash:{},fn:t.program(5,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:6,column:104},end:{line:6,column:250}}}))?s:"")+'" '},5:function(t,e,n,r,o,i,a){var s,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return" "+(null!=(s=l(n,"if").call(null!=e?e:t.nullContext||{},null!=(s=null!=a[1]?l(a[1],"sort"):a[1])?l(s,"order"):s,{name:"if",hash:{},fn:t.program(6,o,0,i,a),inverse:t.program(8,o,0,i,a),data:o,loc:{start:{line:6,column:136},end:{line:6,column:243}}}))?s:"")},6:function(t,e,n,r,o){return"tc-ctl-wfsquery-results-sorting-asc"},8:function(t,e,n,r,o){return"tc-ctl-wfsquery-results-sorting-desc"},10:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <tr title="'+s(l(n,"i18n").call(a,"zoomToFeature",{name:"i18n",hash:{},data:o,loc:{start:{line:15,column:19},end:{line:15,column:44}}}))+'" data-id="'+s(t.lambda(null!=e?l(e,"Id"):e,e))+'" data-index="'+(null!=(i=l(n,"if").call(a,l(n,"gt").call(a,null!=e?l(e,"index"):e,-1,{name:"gt",hash:{},data:o,loc:{start:{line:15,column:81},end:{line:15,column:94}}}),{name:"if",hash:{},fn:t.program(11,o,0),inverse:t.program(13,o,0),data:o,loc:{start:{line:15,column:75},end:{line:15,column:130}}}))?i:"")+'" class="tc-selectable">\r\n'+(null!=(i=l(n,"each").call(a,e,{name:"each",hash:{},fn:t.program(15,o,0),inverse:t.noop,data:o,loc:{start:{line:16,column:12},end:{line:26,column:21}}}))?i:"")+"        </tr>\r\n"},11:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(t.lambda(null!=e?i(e,"index"):e,e))},13:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(t.lambda(o&&i(o,"index"),e))},15:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"unless").call(a,s(n,"eq").call(a,o&&s(o,"key"),"index",{name:"eq",hash:{},data:o,loc:{start:{line:17,column:22},end:{line:17,column:39}}}),{name:"unless",hash:{},fn:t.program(16,o,0),inverse:t.noop,data:o,loc:{start:{line:17,column:12},end:{line:25,column:23}}}))?i:""},16:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"unless").call(a,s(n,"startsWith").call(a,o&&s(o,"key"),"h3_",{name:"startsWith",hash:{},data:o,loc:{start:{line:18,column:22},end:{line:18,column:45}}}),{name:"unless",hash:{},fn:t.program(17,o,0),inverse:t.noop,data:o,loc:{start:{line:18,column:12},end:{line:24,column:23}}}))?i:""},17:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"unless").call(a,s(n,"startsWith").call(a,o&&s(o,"key"),"h4_",{name:"startsWith",hash:{},data:o,loc:{start:{line:19,column:22},end:{line:19,column:45}}}),{name:"unless",hash:{},fn:t.program(18,o,0),inverse:t.noop,data:o,loc:{start:{line:19,column:12},end:{line:23,column:23}}}))?i:""},18:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <td class="'+t.escapeExpression(a(n,"lowerCase").call(null!=e?e:t.nullContext||{},o&&a(o,"key"),{name:"lowerCase",hash:{},data:o,loc:{start:{line:20,column:23},end:{line:20,column:41}}}))+'">\r\n'+(null!=(i=t.invokePartial(a(r,"tc-ctl-finfo-attr-val"),e,{name:"tc-ctl-finfo-attr-val",hash:{value:e,name:o&&a(o,"key")},data:o,indent:"                ",helpers:n,partials:r,decorators:t.decorators}))?i:"")+"            </td>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o,i,a){var s,l=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<table class="table">\r\n    <thead>\r\n'+(null!=(s=c(n,"each").call(l,null!=e?c(e,"columns"):e,{name:"each",hash:{},fn:t.program(1,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:3,column:8},end:{line:10,column:17}}}))?s:"")+"\r\n</thead>\r\n    <tbody>\r\n"+(null!=(s=c(n,"each").call(l,null!=e?c(e,"results"):e,{name:"each",hash:{},fn:t.program(10,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:14,column:8},end:{line:28,column:13}}}))?s:"")+"    </tbody>\r\n</table>\r\n"},usePartial:!0,useData:!0,useDepths:!0},t.template["tc-ctl-finfo-attr-val"]={1:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-finfo-attr-video"),e,{name:"tc-ctl-finfo-attr-video",hash:{value:null!=e?a(e,"value"):e,name:null!=e?a(e,"name"):e},data:o,indent:"    ",helpers:n,partials:r,decorators:t.decorators}))?i:""},3:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"isImageAttribute").call(a,null!=e?s(e,"name"):e,null!=e?s(e,"value"):e,{name:"isImageAttribute",hash:{},data:o,loc:{start:{line:4,column:10},end:{line:4,column:39}}}),{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.program(6,o,0),data:o,loc:{start:{line:4,column:4},end:{line:16,column:11}}}))?i:""},4:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-finfo-attr-image"),e,{name:"tc-ctl-finfo-attr-image",hash:{value:null!=e?a(e,"value"):e,name:null!=e?a(e,"name"):e},data:o,indent:"        ",helpers:n,partials:r,decorators:t.decorators}))?i:""},6:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"isAudioAttribute").call(a,null!=e?s(e,"name"):e,null!=e?s(e,"value"):e,{name:"isAudioAttribute",hash:{},data:o,loc:{start:{line:7,column:14},end:{line:7,column:43}}}),{name:"if",hash:{},fn:t.program(7,o,0),inverse:t.program(9,o,0),data:o,loc:{start:{line:7,column:8},end:{line:15,column:15}}}))?i:""},7:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-finfo-attr-audio"),e,{name:"tc-ctl-finfo-attr-audio",hash:{value:null!=e?a(e,"value"):e,name:null!=e?a(e,"name"):e},data:o,indent:"            ",helpers:n,partials:r,decorators:t.decorators}))?i:""},9:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"isEmbedAttribute").call(a,null!=e?s(e,"name"):e,null!=e?s(e,"value"):e,{name:"isEmbedAttribute",hash:{},data:o,loc:{start:{line:10,column:18},end:{line:10,column:47}}}),{name:"if",hash:{},fn:t.program(10,o,0),inverse:t.program(12,o,0),data:o,loc:{start:{line:10,column:12},end:{line:14,column:19}}}))?i:""},10:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-finfo-attr-embed"),e,{name:"tc-ctl-finfo-attr-embed",hash:{value:null!=e?a(e,"value"):e,name:null!=e?a(e,"name"):e},data:o,indent:"                ",helpers:n,partials:r,decorators:t.decorators}))?i:""},12:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"                "+(null!=(i=s(n,"unless").call(a,s(n,"eq").call(a,null!=e?s(e,"value"):e,null,{name:"eq",hash:{},data:o,loc:{start:{line:13,column:26},end:{line:13,column:41}}}),{name:"unless",hash:{},fn:t.program(13,o,0),inverse:t.noop,data:o,loc:{start:{line:13,column:16},end:{line:13,column:86}}}))?i:"")+"\r\n"},13:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-finfo-object"),null!=e?a(e,"value"):e,{name:"tc-ctl-finfo-object",data:o,helpers:n,partials:r,decorators:t.decorators}))?i:""},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"isVideoAttribute").call(a,null!=e?s(e,"name"):e,null!=e?s(e,"value"):e,{name:"isVideoAttribute",hash:{},data:o,loc:{start:{line:1,column:6},end:{line:1,column:35}}}),{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(3,o,0),data:o,loc:{start:{line:1,column:0},end:{line:17,column:7}}}))?i:""},usePartial:!0,useData:!0},t.template["tc-ctl-finfo-object"]={1:function(t,e,n,r,o){var i;return'<table class="complexAttr">\r\n    <tbody>\r\n'+(null!=(i=(t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]})(n,"each").call(null!=e?e:t.nullContext||{},e,{name:"each",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:4,column:4},end:{line:41,column:13}}}))?i:"")+"    </tbody>\r\n</table>\r\n"},2:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"unless").call(a,s(n,"isObject").call(a,e,{name:"isObject",hash:{},data:o,loc:{start:{line:5,column:18},end:{line:5,column:33}}}),{name:"unless",hash:{},fn:t.program(3,o,0),inverse:t.program(10,o,0),data:o,loc:{start:{line:5,column:8},end:{line:40,column:19}}}))?i:""},3:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <tr class="keyValue">\r\n'+(null!=(i=s(n,"if").call(a,s(n,"eq").call(a,o&&s(o,"key"),"_content_",{name:"eq",hash:{},data:o,loc:{start:{line:7,column:18},end:{line:7,column:39}}}),{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.program(7,o,0),data:o,loc:{start:{line:7,column:12},end:{line:14,column:19}}}))?i:"")+"        </tr>\r\n"},4:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"unless").call(a,s(n,"isEmpty").call(a,e,{name:"isEmpty",hash:{},data:o,loc:{start:{line:8,column:26},end:{line:8,column:40}}}),{name:"unless",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:8,column:16},end:{line:10,column:27}}}))?i:""},5:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                    <td colspan="2" class="value tc-ctl-finfo-val">'+(null!=(i=t.invokePartial(a(r,"tc-ctl-finfo-object"),e,{name:"tc-ctl-finfo-object",data:o,helpers:n,partials:r,decorators:t.decorators}))?i:"")+"</td>\r\n"},7:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <th class="key">'+t.escapeExpression(t.lambda(o&&s(o,"key"),e))+'</th>\r\n                <td class="value tc-ctl-finfo-val">'+(null!=(i=s(n,"unless").call(a,s(n,"isEmpty").call(a,e,{name:"isEmpty",hash:{},data:o,loc:{start:{line:13,column:61},end:{line:13,column:75}}}),{name:"unless",hash:{},fn:t.program(8,o,0),inverse:t.noop,data:o,loc:{start:{line:13,column:51},end:{line:13,column:119}}}))?i:"")+"</td>\r\n"},8:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-finfo-object"),e,{name:"tc-ctl-finfo-object",data:o,helpers:n,partials:r,decorators:t.decorators}))?i:""},10:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <tr>\r\n            <th style="display:none">'+t.escapeExpression(t.lambda(o&&s(o,"key"),e))+"</th>\r\n            <td>\r\n"+(null!=(i=s(n,"if").call(a,s(n,"isObject").call(a,e,{name:"isObject",hash:{},data:o,loc:{start:{line:20,column:22},end:{line:20,column:37}}}),{name:"if",hash:{},fn:t.program(11,o,0),inverse:t.program(13,o,0),data:o,loc:{start:{line:20,column:16},end:{line:35,column:23}}}))?i:"")+(null!=(i=t.invokePartial(s(r,"tc-ctl-finfo-object"),e,{name:"tc-ctl-finfo-object",data:o,indent:"                    ",helpers:n,partials:r,decorators:t.decorators}))?i:"")+"                </div>\r\n            </td>\r\n        </tr>\r\n"},11:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                \x3c!--object--\x3e\r\n                <input type="checkbox" id="complexAttr_'+a(s(n,"getId").call(i,e,{name:"getId",hash:{},data:o,loc:{start:{line:22,column:55},end:{line:22,column:69}}}))+'">\r\n                <div>\r\n                    <label for="complexAttr_'+a(s(n,"getId").call(i,e,{name:"getId",hash:{},data:o,loc:{start:{line:24,column:44},end:{line:24,column:58}}}))+'" class="plus" title=""></label>\r\n                    <label for="complexAttr_'+a(s(n,"getId").call(i,e,{name:"getId",hash:{},data:o,loc:{start:{line:25,column:44},end:{line:25,column:58}}}))+'" class="title" title="">'+a(t.lambda(o&&s(o,"key"),e))+"</label><br />\r\n"},13:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=s(n,"if").call(a,s(n,"isArray").call(a,e,{name:"isArray",hash:{},data:o,loc:{start:{line:27,column:26},end:{line:27,column:40}}}),{name:"if",hash:{},fn:t.program(14,o,0),inverse:t.program(16,o,0),data:o,loc:{start:{line:27,column:20},end:{line:33,column:27}}}))?i:"")+"                    \x3c!--native--\x3e\r\n"},14:function(t,e,n,r,o){var i=t.escapeExpression,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                \x3c!--array--\x3e\r\n                <div>\r\n                    <label for="complexAttr_'+i(a(n,"getId").call(null!=e?e:t.nullContext||{},e,{name:"getId",hash:{},data:o,loc:{start:{line:30,column:44},end:{line:30,column:58}}}))+'" class="title" title="">'+i(t.lambda(o&&a(o,"key"),e))+"</label><br />\r\n"},16:function(t,e,n,r,o){return"                <div>\r\n"},18:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"isArray").call(a,e,{name:"isArray",hash:{},data:o,loc:{start:{line:45,column:10},end:{line:45,column:24}}}),{name:"if",hash:{},fn:t.program(19,o,0),inverse:t.program(22,o,0),data:o,loc:{start:{line:45,column:4},end:{line:68,column:11}}}))?i:""},19:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="complexAttr">\r\n    <input type="checkbox" id="complexAttr_'+s(l(n,"getId").call(a,e,{name:"getId",hash:{},data:o,loc:{start:{line:47,column:43},end:{line:47,column:57}}}))+'">\r\n    <div>\r\n        <label for="complexAttr_'+s(l(n,"getId").call(a,e,{name:"getId",hash:{},data:o,loc:{start:{line:49,column:32},end:{line:49,column:46}}}))+'" class="plus" title=""></label>\r\n        <label for="complexAttr_'+s(l(n,"getId").call(a,e,{name:"getId",hash:{},data:o,loc:{start:{line:50,column:32},end:{line:50,column:46}}}))+'" class="title" title="">'+s(t.lambda(null!=e?l(e,"length"):e,e))+" "+s(l(n,"i18n").call(a,"featureInfo.complexData.array",{name:"i18n",hash:{},data:o,loc:{start:{line:50,column:82},end:{line:50,column:122}}}))+'</label><br />\r\n        <table class="complexAttr">\r\n            <tbody>\r\n'+(null!=(i=l(n,"each").call(a,e,{name:"each",hash:{},fn:t.program(20,o,0),inverse:t.noop,data:o,loc:{start:{line:53,column:16},end:{line:57,column:25}}}))?i:"")+"            </tbody>\r\n        </table>\r\n    </div>\r\n</div>\r\n"},20:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"                <tr>\r\n                    <td>"+(null!=(i=t.invokePartial(a(r,"tc-ctl-finfo-object"),e,{name:"tc-ctl-finfo-object",data:o,helpers:n,partials:r,decorators:t.decorators}))?i:"")+"</td>\r\n                </tr>\r\n"},22:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"isUrl").call(a,e,{name:"isUrl",hash:{},data:o,loc:{start:{line:63,column:14},end:{line:63,column:26}}}),{name:"if",hash:{},fn:t.program(23,o,0),inverse:t.program(25,o,0),data:o,loc:{start:{line:63,column:8},end:{line:67,column:15}}}))?i:""},23:function(t,e,n,r,o){var i=t.escapeExpression,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<a href="'+i(t.lambda(e,e))+'" target="_blank" title="'+i(s(n,"i18n").call(a,"linkInNewWindow",{name:"i18n",hash:{},data:o,loc:{start:{line:64,column:42},end:{line:64,column:68}}}))+'">'+i(s(n,"i18n").call(a,"open",{name:"i18n",hash:{},data:o,loc:{start:{line:64,column:70},end:{line:64,column:85}}}))+"</a>\r\n"},25:function(t,e,n,r,o){var i;return(null!=(i=(t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]})(n,"formatDateOrNumber").call(null!=e?e:t.nullContext||{},e,{name:"formatDateOrNumber",hash:{},data:o,loc:{start:{line:66,column:0},end:{line:66,column:30}}}))?i:"")+"\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=s(n,"if").call(a,s(n,"isObject").call(a,e,{name:"isObject",hash:{},data:o,loc:{start:{line:1,column:6},end:{line:1,column:21}}}),{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(18,o,0),data:o,loc:{start:{line:1,column:0},end:{line:69,column:7}}}))?i:""},usePartial:!0,useData:!0},t.template[t.CLASS+"-geom"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-wfsquery-geom-draw"></div>\r\n<div class="tc-ctl-wfsquery-geom-btn">\r\n    <button type="button" class="tc-button tc-ctl-wfsquery-geom-btn-ok">'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"query.returnToQueryBuilder",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:72},end:{line:3,column:109}}}))+"</button>\r\n</div>"},useData:!0},t.template[t.CLASS+"-share-dialog"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-search-dialog tc-ctl-wfsquery-share-dialog tc-modal">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+a(s(n,"i18n").call(i,"query.tooltipMagnifBtn",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:16},end:{line:5,column:49}}}))+" - "+a(s(n,"i18n").call(i,"share",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:52},end:{line:5,column:68}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <div class="tc-ctl-wfsquery-share-dialog-ctl"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n\r\n'},useData:!0};var w=function(t){var e=document.createElement("input");return e.setAttribute("type",t),e.type==t},S=null,b=null,L=function(t){w("date")?t.type="date":(t.type="search",new Promise((function(t,e){"undefined"!=typeof IMask?setTimeout((function(){t()}),10):r.Z.loadJS(!0,[r.Z.apiLocation+"/lib/polyfill/IMask"+(r.Z.isDebug?"":".min")+".js"],(function(){console.log("Imask loaded"),t()}))})).then((function(){S=new IMask(t,{mask:Date,pattern:c&&"es-ES"!==c?"eu-ES"===c?"Y/`m/`d":"m/`d/`Y":"d/`m/`Y",lazy:!1,format:function(t){var e=t.getDate(),n=t.getMonth()+1,r=t.getFullYear();switch(e<10&&(e="0"+e),n<10&&(n="0"+n),c){case"eu-ES":return[r,n,e].join("/");case"en-US":return[n,e,r].join("/");default:return[e,n,r].join("/")}},parse:function(t){switch(c){case"eu-ES":return new Date(t.split("/")[1]+"/"+t.split("/")[2]+"/"+t.split("/")[0]);case"en-US":return new Date(t);default:return new Date(t.split("/")[1]+"/"+t.split("/")[0]+"/"+t.split("/")[2])}},blocks:{d:{mask:IMask.MaskedRange,from:1,to:31,maxLength:2},m:{mask:IMask.MaskedRange,from:1,to:12,maxLength:2},Y:{mask:IMask.MaskedRange,from:1900,to:9999}}})})))},T=function(){if(S){var t=S.el.input;S.destroy(),S=null,t.value="",t.type="search"}};let P;var A=function(t,e){var n="";for(var o in n+='<option value="">'+C("query.chooseAttrCombo")+"</option>",t)t[o].type&&!r.Z.Util.isGeometry(t[o].type)&&(n+='<option value="'+(t[o].name||o)+'">'+o+"</option>");var i=document.createElement("div");i.insertAdjacentHTML("beforeend",'<select class="'+this.className+'" name="'+this.name+'">'+n+"</select>"),this.parentNode.parentNode.insertBefore(i,this.parentNode.nextSibling).firstElementChild.addEventListener("change",(function(){O.apply(this,[e,t])}))};const O=function(e,i){var a=this;a.parentElement.parentElement.querySelectorAll("select").forEach((function(t){a.offsetTop<t.offsetTop&&t.parentElement.parentElement.removeChild(t.parentElement)}));const s=e.querySelector(`.${t.CLASS}-numeric`),l=e.querySelector(`.${t.CLASS}-text`),u=e.querySelector(`.${t.CLASS}-date`),p=e.querySelector(`.${t.CLASS}-geom`),d=e.querySelector(`.${t.CLASS}-where`),h=e.querySelector(`.${t.CLASS}-op`);var f=d.querySelector(".tc-textbox");if(f.disabled=!1,f.dataset.autocomplete&&r.Z.UI.autocomplete.call(f,"clear"),s.classList.add(n),u.classList.add(n),l.classList.add(n),p.classList.add(n),d.classList.add(n),i[this.selectedOptions[0].value.substring(this.selectedOptions[0].value.indexOf(":")+1)])switch(E=i[this.selectedOptions[0].value.substring(this.selectedOptions[0].value.indexOf(":")+1)].type,h.classList.remove(n),r.Z.UI.autocomplete.call(f,"destroy"),function(){if(b){var t=b.el.input;b.destroy(),b=null,t.value="",t.type="search"}}(),f.type="search",!0){case!E:console.log("type es nulo");break;case E instanceof Object:A.apply(this,[E,e]);break;case r.Z.Util.isGeometry(E):p.classList.remove(n),d.classList.remove(n),d.classList.add(o),0===p.querySelectorAll("input:checked").length&&(p.firstElementChild.checked=!0),T();break;case E.indexOf("int")>=0:case E.indexOf("float")>=0:case E.indexOf("double")>=0:case E.indexOf("long")>=0:case E.indexOf("decimal")>=0:s.classList.remove(n),d.classList.remove(n,o),0===s.querySelectorAll("input:checked").length&&(s.firstElementChild.checked=!0),T(),w("number")&&(r.Z.Util.detectIE()?(f.type="text",new Promise((function(t,e){"undefined"!=typeof IMask?setTimeout((function(){t()}),10):r.Z.loadJS(!0,[r.Z.apiLocation+"/lib/polyfill/IMask"+(r.Z.isDebug?"":".min")+".js"],(function(){console.log("Imask loaded"),t()}))})).then((function(){b=new IMask(f,{mask:Number,scale:E.indexOf("int")>=0||E.indexOf("long")>=0?0:2,signed:!1,thousandsSeparator:c&&"en-US"===c?",":".",padFractionalZeros:!1,normalizeZeros:!0,radix:c&&"en-US"===c?".":","})}))):(f.type="number",E.indexOf("int")>=0||E.indexOf("long")>=0?f.step="1":f.step="0.0001"));break;case E.indexOf("dateTime")>=0:case E.indexOf("date")>=0:u.classList.remove(n),d.classList.remove(n,o),0===u.querySelectorAll("input:checked").length&&(u.firstElementChild.checked=!0),L(f);break;case E.indexOf("string")>=0:{l.classList.remove(n),d.classList.remove(n,o),0===l.querySelectorAll("input:checked").length&&(l.firstElementChild.checked=!0),T();const r=[].slice.call(e.querySelectorAll("select[name="+this.name+"]")).reduce((function(t,e){return t+(t?"/":"")+e.value}),"");k(f,r,e.getElementsByClassName(t.CLASS+"-list tc-ctl-search-list")[0]);break}}else h.classList.add(n)},x=function(e){const n=e.getForm(),o=n.querySelector(`.${e.CLASS}-where-list`);u(o),t.getRenderedHtml(e.CLASS+"-filter",{conditions:e.filters.map((t=>function(t,e){const n=e instanceof r.Z.filter.Spatial;return{field:n?t.getLocaleString("geometry"):e.propertyName,opText:t.getLocaleString(p[e._abbr].key),valueToShow:e._valueToShow,isSpatial:n}}(e,t))),locale:e.map.options.locale},(function(t){o.innerHTML=t,o.querySelectorAll(`.${e.CLASS}-where-cond-view`).forEach((function(t,n){t.addEventListener(r.Z.Consts.event.CLICK,(function(){e.map.zoomToFeatures([e.filters.filter((t=>t instanceof r.Z.filter.Spatial))[n].geometry]),e.showGeometryPanel()}),{passive:!0})})),n.querySelectorAll(`.${e.CLASS}-del-cond`).forEach((function(t,n){t.addEventListener(r.Z.Consts.event.CLICK,(function(){e.removeFilter(n)}),{passive:!0})}))}))};var I=function(t){const e=this;var n,o=t.querySelector('.tc-ctl-wfsquery input[type="radio"]:checked');return S&&!S.masked.isComplete?(!1===/^(?=\d)(?:(?:31(?!.(?:0?[2469]|11))|(?:30|29)(?!.0?2)|29(?=.0?2.(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00)))(?:\x20|$))|(?:2[0-8]|1\d|0?[1-9]))([-.\/])(?:1[012]|0?[1-9])\1(?:1[6-9]|[2-9]\d)?\d\d(?:(?=\x20\d)\x20|$))?(((0?[1-9]|1[012])(:[0-5]\d){0,2}(\x20[AP]M))|([01]\d|2[0-3])(:[0-5]\d){1,2})?$/.test(str)&&Z.call(e,"Fecha "+str+" inválida",r.Z.Consts.msgType.ERROR),!1):0===o.length?(Z.call(e,C("query.msgNoCondition")),!1):t.querySelectorAll("input[type='date']").length&&!t.querySelector("input[type='date']").checkValidity()?(Z.call(e,C("query.msgNoValidDate")),!1):t.querySelectorAll("input[type='number']").length&&null!==(n=t.querySelector("input[type='number']"))&&!n.checkValidity()?("1"===n.step?Z.call(e,C("query.msgNoValidNumberMustInt")):Z.call(e,C("query.msgNoValidNumber")),!1):""!==t.querySelector("input.tc-textbox").value.trim()||"empty"===o.value||"null"===o.value||(Z.call(e,C("query.msgNoValueCondition")),!1)};const M=()=>g;var R=function(t){const e=this;var n=t;return new Promise((async function(t){if(e.resultsPanel)e.resultsPanel.options.save.fileName=n+".xls";else{var o=e.map.getControlsByClass(r.Z.control.ControlContainer);const t={content:"table",titles:{main:"",max:""},save:{fileName:n+".xls"},download:()=>function(t,e){const n=t;n.getDownloadDialog().then((function(t){var r={title:e()};(n.map.elevation||n.options.displayElevation)&&(r=Object.assign({},r,{elevation:Object.assign({},n.map.elevation&&n.map.elevation.options,n.options.displayElevation)})),t.open(n.resultsLayer.features,r)}))}(e,M),share:!0,resize:!0};0===o.length?(e.resultsPanel=await e.map.addControl("resultsPanel",t),e.resultsPanel.caller=e):(t.position="right",e.resultsPanel=await o[0].addControl("resultsPanel",t),e.resultsPanel.caller=e),e.resultsPanel.template[e.resultsPanel.CLASS+"-table"]=e.template[e.CLASS+"-table"]}e.resultsPanel.options.titles.max=e.resultsPanel.getLocaleString("geo.trk.chart.exp"),t()}))},Z=function(t,e){if(i){var o=i.getElementsByClassName("tc-ctl-wfsquery-message")[0];if(a)clearTimeout(a);else{switch(o.innerHTML=t,e){case r.Z.Consts.msgType.INFO:o.classList.add("tc-msg-info");break;case r.Z.Consts.msgType.WARNING:o.classList.add("tc-msg-warning");break;case r.Z.Consts.msgType.ERROR:default:o.classList.add("tc-msg-error")}o.classList.remove(n)}a=setTimeout((function(){a=null,o.classList.add(n)}),3e3)}else this.map.toast(t,{type:e})},D=async function(t,e){const n=this;var o=Object.assign({},f);switch(document.querySelector(".tc-ctl-wfsquery.tc-ctl-wfsquery-text input:checked").value){case"starts":e+="*";break;case"contains":case"eq":e="*"+e+"*";break;case"ends":e="*"+e}l&&l.abort();let i=(l=new AbortController).signal;try{var a=await d.toolProxification.fetch(y,{data:r.Z.Util.WFGetPropertyValue(h,!(t.indexOf("/")>=0)&&t,r.Z.filter.like(t,e,void 0,void 0,void 0,!1),o),contentType:"application/xml",method:"POST",signal:i});if(a.contentType.startsWith("application/xml")||a.contentType.startsWith("text/xml")){let t=(new DOMParser).parseFromString(a.responseText,"text/xml"),e=t.querySelector("Exception ExceptionText");if(e)return Z.call(n,e.innerHTML,r.Z.Consts.msgType.ERROR),[];const o=[];return t.querySelectorAll("member > *").forEach((function(t){o.indexOf(t.innerHTML)<0&&(o[o.length]=t.innerHTML)})),o}if(a.contentType.startsWith("application/json")&&(a=JSON.parse(a.responseText)),a.features&&a.features.length>0){let e;return 1===a.features.length&&(e=[t.split("/").reduce((function(t,e){return t[e.substring(e.indexOf(":")+1)]}),a.features[0].properties)]),a.features.length>1&&(e=a.features.reduce((function(e,n){if(e&&e instanceof Array)return e.indexOf(n.properties[t])<0?e.concat(t.split("/").reduce((function(t,e){return t[e.substring(e.indexOf(":")+1)]}),n.properties)):e}),[])),e}return[]}catch(t){return t instanceof DOMException&&"AbortError"!==t.name&&Z.call(n,t,r.Z.Consts.msgType.ERROR),null}},k=function(t,e,o){r.Z.UI.autocomplete.call(t,{minLength:3,target:o,source:function(t,o){var i=this;i.target.innerHTML='<li><a class="tc-ctl-search-li-loading" href="#">'+C("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>',i.target.classList.remove(n),s&&window.clearTimeout(s),s=window.setTimeout((async function(){if(!document.querySelector(".tc-ctl-wfsquery.tc-ctl-wfsquery-text").classList.contains(r.Z.Consts.classes.HIDDEN)){var a=await D.call(i,e,t);a&&(a.length?o(a.sort()):i.target.classList.add(n))}}),500)},callback:function(e){t.value=e.currentTarget.dataset.value,this.target.classList.add(n)},buildHTML:function(e){var n=t.value;return this.target.style.maxHeight="",e.results.length>1?e.results.reduce((function(t,e,r){return(r>1?t:N(t,n))+N(e,n)})):N(e.results[0],n)}}),t.addEventListener("targetCleared.autocomplete",(function(){o.classList.add(n)})),t.addEventListener("keypress",(function(e){13==e.which&&r.Z.UI.autocomplete.call(t,"clear")})),t.addEventListener("search",(function(e){0===t.value.length&&r.Z.UI.autocomplete.call(t,"clear")})),t.addEventListener("input",(function(e){0===t.value.length&&r.Z.UI.autocomplete.call(t,"clear")}))},N=function(t,e){return e=new RegExp(e.replace(/\W/g,""),"gi"),'<li><a href="#" data-value="'+t+'">'+t.replace(e,"<b>$&</b>")+"</a></li>"},F=function(t){const e=this;var n=function(t,e){var n;return e instanceof r.Z.feature.Point?n=t.addPoint(e.getCoords()):e instanceof r.Z.feature.Polyline?n=t.addPolyline(e.getCoords()):e instanceof r.Z.feature.Polygon?n=t.addPolygon(e.getCoords()):e instanceof r.Z.feature.MultiPolygon?n=t.addMultiPolygon(e.getCoords()):e instanceof r.Z.feature.MultiPolyline&&(n=t.addMultiPolyline(e.getCoords())),n};if(t.layer){var o=t.layer.map.getLayer("WFSQueryResultsHighlight");o?n(o,t):t.layer.map.addLayer({id:"WFSQueryResultsHighlight",type:r.Z.Consts.layerType.VECTOR,owner:e,stealth:!0,styles:_()},(function(e){n(e,t)}))}};t.render=function(t){const e=this;return e._set1stRenderPromise(Promise.all([r.Z.Control.prototype.render.call(e,t),e.getRenderedHtml(e.CLASS+"-share-dialog",{},(function(t){e._dialogDiv.innerHTML=t}))]))},t.register=function(t){const o=this;return new Promise((function(i,a){t.on(r.Z.Consts.event.LAYERERROR,(t=>{if(t.layer===o.resultsLayer){if(o.modalDialog&&o.modalDialog.getElementsByClassName("tc-modal-body")[0].classList.remove(e),t.reason!==r.Z.Consts.WFSErrors.MAX_NUM_FEATURES)throw Z.call(o,C("query.errorUndefined"),r.Z.Consts.msgType.ERROR),new Error(t.reason);Z.call(o,C("query.msgTooManyResults",{limit:t.data.limit}),r.Z.Consts.msgType.WARNING)}})),t.on(r.Z.Consts.event.BEFOREFEATUREREMOVE,(t=>{if(t.layer===o.resultsLayer){const e=t.layer.features.indexOf(t.feature);o.deletedFeatures.push(e);const n=o.resultsPanel.div.querySelector("table tbody tr:not(."+r.Z.Consts.classes.DISABLED+")[data-index='"+e+"']");delete n.dataset.index,n.removeAttribute("title"),n.classList.add(r.Z.Consts.classes.DISABLED);for(let n=e+1;n<t.layer.features.length;n++){const t=o.resultsPanel.div.querySelector("table tbody tr[data-index='"+n+"']");t&&t.dataset.index&&(t.dataset.index=parseInt(t.dataset.index,10)-1)}}})),r.Z.Control.prototype.register.call(o,t).then((function(o){var s=o;v=function(){var t=function(t,e){return this.options.styles&&this.options.styles[t]&&this.options.styles[t][e]||r.Z.Cfg.styles[t][e]};return{polygon:{fillColor:t.bind(s,"polygon","fillColor"),fillOpacity:t.bind(s,"polygon","fillOpacity"),strokeColor:t.bind(s,"polygon","strokeColor"),strokeOpacity:t.bind(s,"polygon","strokeOpacity"),strokeWidth:t.bind(s,"polygon","strokeWidth")},line:{strokeColor:t.bind(s,"line","strokeColor"),strokeOpacity:t.bind(s,"line","strokeOpacity"),strokeWidth:t.bind(s,"line","strokeWidth")},point:{radius:t.bind(s,"point","radius"),height:t.bind(s,"point","height"),width:t.bind(s,"point","width"),fillColor:t.bind(s,"point","fillColor"),fillOpacity:t.bind(s,"point","fillOpacity"),strokeColor:t.bind(s,"point","strokeColor"),strokeWidth:t.bind(s,"point","strokeWidth"),fontSize:t.bind(s,"point","fontSize"),fontColor:t.bind(s,"point","fontColor"),labelOutlineColor:t.bind(s,"point","labelOutlineColor"),labelOutlineWidth:t.bind(s,"point","labelOutlineWidth"),label:t.bind(s,"point","label"),angle:t.bind(s,"point","angle")}}},_=function(){var t={polygon:r.Z.Util.extend(!0,{},r.Z.Cfg.styles.polygon,{fillColor:"#0099FF",fillOpacity:1,strokeColor:"#0099FF",strokeWidth:2}),line:r.Z.Util.extend(!0,{},r.Z.Cfg.styles.line,{strokeColor:"#0099FF",strokeWidth:2}),point:r.Z.Util.extend(!0,{},r.Z.Cfg.styles.point,{strokeColor:"#0099FF"})};return s.highlightStyles?{polygon:r.Z.Util.extend(!0,{},t.polygon,s.highlightStyles.polygon?s.highlightStyles.polygon:{}),line:r.Z.Util.extend(!0,{},t.line,s.highlightStyles.line?s.highlightStyles.line:{}),point:r.Z.Util.extend(!0,{},t.point,s.highlightStyles.point?s.highlightStyles.point:{})}:t},c=t.options.locale,C=function(t,e){return r.Z.Util.getLocaleString(c,t,e)},t.ready((function(){t.getControlsByClass("TC.control.WorkLayerManager").forEach((function(o){o.addItemTool({renderFn:function(o,i){const a=s.CLASS+"-btn-open";let l=o.querySelector("sitna-button."+a);if(!l){const o=t.getLayer(i);if(o.type===r.Z.Consts.layerType.WMS||o.type===r.Z.Consts.layerType.WFS){const t=s.getLocaleString("query.tooltipMagnifBtn");l=new m.Z,l.variant=m.Z.variant.MINIMAL,l.text=t,l.iconText="",l.classList.add(a),l.dataset.layerId=i,o.type===r.Z.Consts.layerType.WMS&&(l.classList.add(e),o.getWFSCapabilities().then((t=>{if(t.Operations.GetFeature){var e=o.getDisgregatedLayerNames?o.getDisgregatedLayerNames():o.featureType;(e=e.filter((function(e){return Object.prototype.hasOwnProperty.call(t.FeatureTypes,e.substring(e.indexOf(":")+1))}))).length||l.classList.add(n)}else l.classList.add(n)})).catch((()=>l.classList.add(n))).finally((()=>l.classList.remove(e))))}}return l},updateEvents:[],actionFn:function(){const t=this;if(t.classList.contains("tc-unavailable")||t.classList.contains("tc-loading"))return;const e=s.map.getLayer(t.dataset.layerId);s.renderModalDialog(e)}})}))})),s.getShareDialog().then((function(){i(s)})).catch((function(t){a(t instanceof Error?t:Error(t))}))}))}))};const U=function(t){const n=t.layer.owner;if(n&&t.layer===n.resultsLayer){if(t.newData&&0===t.newData.totalFeatures)return n.modalDialog.getElementsByClassName("tc-modal-body")[0].classList.remove(e),void Z.call(n,C("query.msgNoResults"),r.Z.Consts.msgType.INFO);var o=t.layer.features;if(o.length>0){n.toShare&&n.toShare.doZoom&&(n._setQueryToSearch({doZoom:!1}),n.map.zoomToFeatures(o));const t="h3_"+n.getLocaleString("service"),e="h4_"+n.getLocaleString("layer"),a=n.map.getControlsByClass(r.Z.control.Click).some((t=>t.TITLE_SEPARATOR))?n.map.getControlsByClass(r.Z.control.Click).find((t=>t.TITLE_SEPARATOR)).TITLE_SEPARATOR:" • ";for(var i=0;i<o.length;i++){const n=d.getPath(h).slice(1);if(n){const s={};s[t]=d.title,s[e]=n.join(a);const l=r.Z.Util.extend(s,o[i].getData());o[i].clearData(),o[i].setData(l)}}n.showResultsPanel(o.length>1?o.reduce((function(t,e){return(t instanceof Array?t:[t.data]).concat([e.data])})):[o[0].data],g)}t.layer.map.off(r.Z.Consts.event.LAYERUPDATE,U)}},G=function(t){const e=t.layer.owner;e&&t.layer===e.resultsLayer&&t.query&&e._setQueryToSearch({filter:t.query})};t._sendQuery=async function(t){const e=this;if(d&&h&&g&&t){var n=await d.getWFSURL();await R.apply(e,[g]),d.toolProxification.cacheHost.getAction(n).then((function(o){const i=o.action(n);e.resultsLayer&&e.resultsLayer.url!==i&&(e.map.removeLayer(e.resultsLayer),e.resultsLayer=null),e.resultsLayer?(e.map.off(r.Z.Consts.event.BEFOREAPPLYQUERY,G),e.map.on(r.Z.Consts.event.BEFOREAPPLYQUERY,G),e.resultsLayer.setVisibility(!1),e.resultsLayer.clearFeatures(),e.map.off(r.Z.Consts.event.LAYERUPDATE,U),e.map.on(r.Z.Consts.event.LAYERUPDATE,U),e.resultsLayer.url=i,e.resultsLayer.featurePrefix=h.substring(0,h.indexOf(":")),e.resultsLayer.featureType=h.substring(h.indexOf(":")+1),e.resultsLayer.properties=t,e.resultsLayer.setVisibility(!0),e.resultsLayer.refresh()):(e.map.on(r.Z.Consts.event.BEFOREAPPLYQUERY,G),e.map.addLayer({id:"WFSQueryResults",type:r.Z.Consts.layerType.WFS,url:i,owner:e,stealth:!0,geometryName:"the_geom",featurePrefix:h.substring(0,h.indexOf(":")),featureType:h.substring(h.indexOf(":")+1),properties:t,outputFormat:r.Z.Consts.format.JSON,styles:v()}).then((function(t){e.resultsLayer=t,t.map.on(r.Z.Consts.event.LAYERUPDATE,U)})),e.map.on(r.Z.Consts.event.RESULTSPANELCLOSE,(function(t){t.control===e.resultsPanel&&(r.Z.browserFeatures.touch()&&r.Z.Util.swipe(t.control.div,"enable"),e.resultsLayer.clearFeatures(),e.resultsLayer.setVisibility(!1),e.clearFilters(),e.map.off(r.Z.Consts.event.LAYERUPDATE,U),e.map.off(r.Z.Consts.event.BEFOREAPPLYQUERY,G),delete e.toShare)})))}))}},t.sendQuery=async function(){const t=this;if(!t.validateQuery())return void Z.call(t,C("query.msgNoQueryFilter"));let n;if(t.modalDialog.getElementsByClassName("tc-modal-body")[0].classList.add(e),t.filters.length>1){const e=t.modalDialog.querySelector(".tc-ctl-wfsquery-logOpRadio:checked").value;n=r.Z.filter[r.Z.Consts.logicalOperator[e]].apply(null,t.filters)}else n=t.filters[0];t._sendQuery.call(t,n)},t._setQueryToSearch=function(t){const e=this;1===Object.keys(t).length&&Object.prototype.hasOwnProperty.call(t,"doZoom")?e.toShare=r.Z.Util.extend(e.toShare,{doZoom:t.doZoom}):(t.filter||e.resultsLayer&&e.resultsLayer.properties instanceof r.Z.filter.Filter)&&(e.toShare=r.Z.Util.extend(e.toShare,{wms:{url:d.url,names:d.names},title:g,name:h,filter:t.filter?t.filter:e.resultsLayer.properties.getText(),doZoom:!Object.prototype.hasOwnProperty.call(t,"doZoom")||t.doZoom}))},t._getQueryToSearch=function(){return this.toShare},t.exportState=function(){const t=this;return t.toShare?{id:t.id,queryResult:JSON.stringify(t.toShare)}:null},t.importState=function(t){const e=this;if(t.queryResult){let n=e.map.getLoadingIndicator().addWait();e.map.loaded((function(){let r=JSON.parse(t.queryResult);if(r.wms&&r.filter){let t=e.map.workLayers.filter((t=>t.url&&t.url===r.wms.url&&t.names.join()===r.wms.names.join()));t.length>0&&(d=t[0],h=r.name,g=r.title,e._setQueryToSearch({doZoom:r.doZoom}),d.describeFeatureType(h).then((function(t){B(t,e,!1),e._sendQuery(r.filter),e._setQueryToSearch({filter:r.filter,doZoom:r.doZoom}),e.map.getLoadingIndicator().removeWait(n)})))}else alert("shared query error")}))}},t.validateQuery=function(){return this.filters.length>0},t.showResultsPanel=function(t,e){const n=this;n.deletedFeatures=[],n.resultsPanel.div.querySelector(".prpanel-title-text").innerText=n.resultsPanel.getLocaleString(t.length>1?"query.titleResultPaneMany":"query.titleResultPanelOne",{numero:t.length,layerName:e}),n.resultsPanel.div.classList.add("tc-ctl-wfsquery-results"),n.modalDialog&&n.modalDialog.parentElement.removeChild(n.modalDialog);const o=P();n.resultsPanel.openTable({data:t,css:{trClass:"trClass",tdClass:"tdClass",thClass:"thClass"},sort:!0,callback:function(e){n.resultsPanel.maximize(),console.log("render del panel de resultados");var i=e.querySelectorAll(".table>tbody>tr"),a=1;for(var s in t[0])if(Object.prototype.hasOwnProperty.call(o,s)){const t=o[s].type;if(t&&!(t instanceof Object)&&(t.indexOf("int")>=0||t.indexOf("float")>=0||t.indexOf("double")>=0||t.indexOf("long")>=0||t.indexOf("decimal")>=0))for(var l=e.querySelectorAll("td:nth-child("+a+")"),c=0;c<l.length;c++)l[c].classList.add("tc-numeric");t&&t instanceof Object&&console.log("aki lo que sea"),a++}for(var u=0;u<i.length;u++)i[u].addEventListener("click",(function(t){if(t.stopPropagation(),!this.classList.contains(r.Z.Consts.classes.DISABLED)){var e=this.dataset.index;null!=e&&n.resultsLayer.map.zoomToFeatures([n.resultsLayer.features[e]])}})),i[u].addEventListener("mouseenter",(function(){if(!this.classList.contains(r.Z.Consts.classes.DISABLED)){var t=this.dataset.index;if(null!=t){var e=n.resultsLayer.features[t];e&&e.geometry&&F.call(n,e);var o=this.querySelectorAll("td.value div");o.length>0?o.forEach((function(t){t.offsetWidth<t.scrollWidth&&(t.title=t.innerText)})):this.querySelectorAll("td").forEach((function(t){t.offsetWidth<t.scrollWidth&&(t.title=t.innerText)}))}}})),i[u].addEventListener("mouseleave",(function(){var t=this.dataset.index;if(null!=t){var e,r=n.resultsLayer.features[t];r&&r.geometry&&(e=r.layer.map.getLayer("WFSQueryResultsHighlight"))&&e.clearFeatures()}}));e.querySelectorAll(".complexAttr label,.complexAttr input").forEach((function(t){t.addEventListener("click",(function(t){t.stopPropagation()}))})),e.querySelectorAll(".complexAttr input").forEach((function(t){t.addEventListener("change",(function(t){this.checked&&this.nextElementSibling.querySelectorAll("td.value div").forEach((function(t){t.offsetWidth<t.scrollWidth&&(t.title=t.innerText)}))}))})),r.Z.control.FeatureInfoCommons.addSpecialAttributeEventListeners(e),e.querySelectorAll("td > img, td > video, td > audio, td > iframe").forEach((t=>t.parentNode.classList.add("tc-multimedia"))),e.querySelectorAll("video").forEach((t=>{t.addEventListener(r.Z.Consts.event.CLICK,(function(t){t.stopPropagation()}),{passive:!0})})),n.deletedFeatures.length>0&&(n.deletedFeatures.sort().forEach((t=>{const e=n.resultsPanel.div.querySelector("table tbody tr[data-index='"+t+"']");delete e.dataset.index,e.removeAttribute("title"),e.classList.add(r.Z.Consts.classes.DISABLED)})),Array.from(n.resultsPanel.div.querySelectorAll("table tbody tr:not(."+r.Z.Consts.classes.DISABLED+")")).forEach((t=>{const e=parseInt(t.dataset.index,10);t.dataset.index=e-n.deletedFeatures.filter((t=>t<e)).length}))),r.Z.browserFeatures.touch()&&r.Z.Util.swipe(n.resultsPanel.div,"disable")}})},t.showGeometryPanel=async function(t){const e=this;if(r.Z.Util.closeModal(),e.geometryPanel)e.geometryPanel.open();else{const t={titles:{main:e.getLocaleString("query.spatialFilter")}},n=e.map.getControlsByClass(r.Z.control.ControlContainer)[0];n?(t.position=n.POSITION.RIGHT,e.geometryPanel=await n.addControl("resultsPanel",t)):e.geometryPanel=await e.map.addControl("resultsPanel",t),e.map.on(r.Z.Consts.event.RESULTSPANELCLOSE,(function(t){t.control===e.geometryPanel&&(setTimeout((()=>e.drawControl.cancel()),500),r.Z.Util.showModal(e.modalDialog,{closeCallback:()=>e.clearFilters()}))}));const o=await e.getRenderedHtml(e.CLASS+"-geom");e.geometryPanel.open(o),e.geometryPanel.div.querySelector(`.${e.CLASS}-geom-btn-ok`).addEventListener(r.Z.Consts.event.CLICK,(function(){e.geometryPanel.close()}),{passive:!0}),e.drawControl||(e.drawControl=await e.map.addControl("draw",{div:e.geometryPanel.getTableContainer().querySelector(`.${e.CLASS}-geom-draw`),styles:e.styles}),e.drawControl.on(r.Z.Consts.event.DRAWEND,(function(t){t.feature.showsPopup=!1,e.geometryPanel.close();const n=e.modalDialog.querySelector(`input[name="${e.id}-condition"]:checked`).value;let o;if("intersects"===n)o=new r.Z.filter.Intersects(null,t.feature,e.map.crs);else o=new r.Z.filter.Within(null,t.feature,e.map.crs);switch(o._abbr=n,t.target.mode){case"polygon":o._valueToShow=e.getLocaleString("polygon");break;case"line":o._valueToShow=e.getLocaleString("line");break;case"rectangle":o._valueToShow=e.getLocaleString("box")}e.filters.push(o),x(e),r.Z.Util.showModal(e.modalDialog,{closeCallback:()=>e.clearFilters()})})))}e.geometryPanel.div.querySelector(`.${e.CLASS}-geom-draw`).classList.toggle(r.Z.Consts.classes.HIDDEN,!t),e.geometryPanel.div.querySelector(`.${e.CLASS}-geom-btn`).classList.toggle(r.Z.Consts.classes.HIDDEN,!!t),t&&e.drawControl.setMode(t,!0)};const B=function(n,o,a){for(var s in P=function(){return n},n){const t=n[s];r.Z.Util.isGeometry(t.type)&&(t.isGeometry=!0)}a&&(o.clearFilters(),t.getRenderedHtml(t.CLASS+"-form",{operators:p,attributes:n,controlId:o.id},(function(a){const s=o.modalDialog,l=o.getForm();u(l),l.insertAdjacentHTML("beforeend",a),i.classList.remove(e);var d=l.getElementsByClassName("tc-combo");if(0===d.length)s.getElementsByClassName("tc-button tc-ctl-wlm-btn-launch")[0].setAttribute("disabled","");else{s.getElementsByClassName("tc-button tc-ctl-wlm-btn-launch")[0].removeAttribute("disabled"),d[0].addEventListener("change",(function(){O.apply(this,[l,n])})),l.querySelectorAll(`input[name="${o.id}-condition"]`).forEach((e=>{e.addEventListener("change",(async function(e){l.querySelector(`.${t.CLASS}-geomtype-line-btn`).disabled="within"===e.target.value;const n=i.querySelector(".tc-ctl-wfsquery-value input");if(n.disabled=!1,this.parentElement.classList.contains("tc-ctl-wfsquery-text")&&"empty"===this.value&&(n.value="",n.disabled=!0,r.Z.UI.autocomplete.call(n,"clear")),this.parentElement.classList.contains("tc-ctl-wfsquery-date")&&"null"===this.value&&(n.value="",n.disabled=!0),""!==n.value.trim()&&this.parentElement.classList.contains("tc-ctl-wfsquery-text")&&"empty"!==this.value){var o=document.createEvent("HTMLEvents");o.initEvent("keyup",!1,!0),n.dispatchEvent(o)}}))})),l.querySelector(".tc-button").addEventListener(r.Z.Consts.event.CLICK,(function(){var t=l.querySelector("input.tc-textbox");if(r.Z.UI.autocomplete.call(t,"clear"),b&&b.masked.remove(),!I.call(o,l))return;var e=[].reduce.call(l.querySelectorAll(".tc-combo"),(function(t,e){return t+(t?"/":"")+e.value}),"");var n,i=l.querySelector('.tc-ctl-wfsquery input[type="radio"]:checked').value,a=(n=t,b?b.unmaskedValue:S?S.unmaskedValue.substring(4)+"-"+S.unmaskedValue.substring(2,4)+"-"+S.unmaskedValue.substring(0,2):n.value);let s=function(t){if(b)return b.value;if(S)return S.value;if("date"===t.type)return new Date(t.value).toLocaleDateString(c,{timeZone:"UTC"});if("number"===t.type){var e=1.1.toLocaleString(c).substring(1,2);return t.value.replace(".",e)}return t.value}(t);switch(!0){case E.indexOf("int")>=0:s=parseInt(a,10);break;case E.indexOf("float")>=0:case E.indexOf("double")>=0:case E.indexOf("long")>=0:case E.indexOf("decimal")>=0:s=parseFloat(a,10);break;case E.indexOf("string")>=0&&"empty"!==i:s='"'+s+'"';break;case E.indexOf("date")>=0&&"null"===i:s=""}var u;if(E.indexOf("dateTime")>=0||E.indexOf("date")>=0)if(a){const t=new Date(a+"T00:00:00").toISOString(),n=new Date(a+"T23:59:59").toISOString();u="nbtw"===i?new r.Z.filter.not(r.Z.filter.between(e,t,n)):new p[i].Ctor(e,t,n)}else u=new p[i].Ctor(e);else u=new p[i].Ctor(e,("ends"===i||"contains"===i?"*":"")+a+("starts"===i||"contains"===i?"*":""));u.matchCase=!1,u._abbr=i,u._valueToShow=s,o.filters.push(u),x(o),t.value=""}),{passive:!0});const e=function(t){o.showGeometryPanel(t.target.value)};l.querySelectorAll("button[name='geometry']").forEach((t=>t.addEventListener(r.Z.Consts.event.CLICK,e,{passive:!0})))}})))},j=function(t){const o=t[0],a=t[1],s=t[2],l=t[3];o.modalDialog=s,d=a,f=l,y=l.Operations.DescribeFeatureType.DCP.HTTP.Get.href,new URL(y).host===document.location.host&&(y=y.substring(y.indexOf(":")+1));var c=a.getDisgregatedLayerNames?a.getDisgregatedLayerNames():a.featureType;if((c=c.filter((function(t){return Object.prototype.hasOwnProperty.call(l.FeatureTypes,t.substring(t.indexOf(":")+1))}))).length>1)i.classList.remove(e),s.getElementsByClassName("tc-combo")[0].addEventListener("change",(function(){if(this.value)s.querySelector(".tc-modal-body .tc-ctl-wfsquery-message",s).classList.add(n),g=this.options[this.selectedIndex].text,i.classList.add(e),h=this.value,d.describeFeatureType(this.value).then((function(t){B(t,o,!0)}),(function(t){var n=s.getElementsByClassName("tc-modal-body")[0];n.classList.remove(e),t?n.insertAdjacentHTML("beforeend",'<div class="tc-ctl-wfsquery-message tc-msg-error">'+t+"</div>"):n.insertAdjacentHTML("beforeend",'<div class="tc-ctl-wfsquery-message tc-msg-warning">'+C("query.LayerNotAvailable")+"</div>")}));else{var t=o.getForm();u(t);for(var r=0;r<t.children.length;r++)t.removeChild(t.children[r]);o.clearFilters()}}));else if(1===c.length){if(l.FeatureTypes[c[0].substring(c[0].indexOf(":")+1)])g=l.FeatureTypes[c[0].substring(c[0].indexOf(":")+1)].Title,h=c[0],d.describeFeatureType(c[0]).then((function(t){B(t,o,!0)}),(function(t){var n=s.getElementsByClassName("tc-modal-body")[0];n.classList.remove(e),t?n.insertAdjacentHTML("beforeend",'<div class="tc-ctl-wfsquery-message tc-msg-error">'+t+"</div>"):n.insertAdjacentHTML("beforeend",'<div class="tc-ctl-wfsquery-message tc-msg-warning">'+C("query.LayerNotAvailable")+"</div>")}));else{var p=s.getElementsByClassName("tc-modal-body")[0];p.classList.remove(e),p.insertAdjacentHTML("beforeend",'<div class="tc-ctl-wfsquery-message tc-msg-warning">'+C("query.LayerNotAvailable")+"</div>")}}else r.Z.Util.closeModal(),a.map.toast(r.Z.Util.getLocaleString(a.map.options.locale,"query.LayerNotAvailable"),{type:r.Z.Consts.msgType.ERROR})},W=function(t,n,o,a){const s=this;let l;t.getDisgregatedLayerNames?(l=[],t.getDisgregatedLayerNames().forEach((function(e,n){var r=t.getPath(e);Object.prototype.hasOwnProperty.call(o.FeatureTypes,e.substring(e.indexOf(":")+1))&&l.push({name:e,title:r[r.length-1]})})),l.sort((function(t,e){return t.title<e.title?-1:t.title>e.title?1:0}))):l=t.featureType,s.getRenderedHtml(s.CLASS+"-dialog",{layerName:C("query.titleDialog",{layerName:n}),layers:l},(function(t){document.body.querySelectorAll(`.${s.CLASS}-dialog`).forEach((t=>t.remove()));var n=document.createElement("div");n.insertAdjacentHTML("beforeEnd",t);var o=null;if(n.childNodes.length>0&&(o=n.firstChild,document.body.appendChild(o)),(i=o.getElementsByClassName("tc-modal-body")[0]).classList.add(e),r.Z.Util.showModal(o,{closeCallback:()=>s.clearFilters()}),r.Z.Util.detectIE()){var l=1;switch(!0){case document.body.clientWidth>768&&document.body.clientWidth<document.body.clientHeight:case document.body.clientWidth>1024:case document.body.clientWidth>1140:l=.7}i.style.maxHeight=document.body.clientHeight*l-i.nextElementSibling.clientHeight-i.previousElementSibling.clientHeight}s.modalDialog=o,o.getElementsByClassName("tc-button tc-ctl-wlm-btn-launch")[0].addEventListener("click",(function(){s.sendQuery()})),a&&a(o)}))};t.renderModalDialog=function(t){const e=this;let n,o;if(t.type===r.Z.Consts.layerType.WMS){const e=t.getPath();n=e[e.length-1],o=t.getWFSCapabilities()}else{if(t.type!==r.Z.Consts.layerType.WFS)return;n=t.title,o=t.getCapabilitiesPromise()}let i=new Promise((function(r,i){o.then((function(o){W.apply(e,[t,n,o,function(t){r(t)}])}))}));Promise.all([e,t,i,o]).then(j)},t.removeFilter=function(t){const e=this;let n=t;if(t instanceof r.Z.filter.Filter&&(n=e.filters.indexOf(t)),n>=0&&n<e.filters.length){const t=e.filters.splice(n,1)[0];t instanceof r.Z.filter.Spatial&&t.geometry.layer.removeFeature(t.geometry),x(e)}},t.clearFilters=function(){this.filters.filter((t=>t instanceof r.Z.filter.Spatial)).forEach((t=>t.geometry.layer.removeFeature(t.geometry))),this.filters.length=0},t.getForm=function(){return this.modalDialog&&this.modalDialog.querySelector(".tc-modal-form")}}();const g=r.Z.control.WFSQuery},5850:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>c});var r=n(5361),o=n(9774),i=n(7945),a=n(2089),s=n(5798);n(1709);r.Z.Consts=a.Z,r.Z.control=r.Z.control||{},r.Z.i18n=r.Z.i18n||s.Z;class l extends HTMLElement{template;control;#s=new WeakMap;static CLASS="tc-ctl";constructor(){super();const t=this;t.map=null,t.isActive=!1,t.isDisabled=!1;var e=arguments.length;t.options=i.Z.extend({},e>1?arguments[1]:arguments[0]);const n=t.options.div||arguments[0];if(n){const e=i.Z.getDiv(n);t.div=e}else t.div=t.parentElement;t.template=t.options.template||t.template,t.exportsState=!1}connectedCallback(){const t=this;if(t.classList.add(l.CLASS,t.CLASS),t.map instanceof o.Z)return;const e=t.getAttribute("for");let n;if(e){const r=document.getElementById(e);if(r)if(n=o.Z.get(r),n)n.addControl(t);else{new MutationObserver((function(e,i){for(const a of e)"childList"===a.type&&(n=o.Z.get(r),n&&(n.addControl(t),i.disconnect()))})).observe(r,{childList:!0})}}else{let e=t;do{e=e.parentNode}while(e&&!e.classList.contains(r.Z.Consts.classes.MAP));n=o.Z.get(e),n?n.addControl(t):t.renderPromise()}}show(){this.style.display=""}hide(){this.style.display="none"}render(t){const e=this;return e._set1stRenderPromise(e.renderData(null,(function(){e.addUIEventListeners(),"function"==typeof t&&t()})))}_set1stRenderPromise(t){const e=this;return e._firstRender||(e._firstRender=t),t}renderData(t,e){const n=this;return new Promise((function(o,i){let a;n.map&&n.trigger(r.Z.Consts.event.BEFORECONTROLRENDER,{dataObject:t}),n.classList.toggle(r.Z.Consts.classes.DISABLED,n.isDisabled),"object"!=typeof n.template||n.template.compiler?(a=n.template,n.template={},n.template[n.CLASS]=a):a=n.template[n.CLASS],n.getRenderedHtml(n.CLASS,t).then((function(t){n.innerHTML=t,!n.parentElement&&n.div&&n.div.appendChild(n),n.map&&n.trigger(r.Z.Consts.event.CONTROLRENDER),r.Z.Util.isFunction(e)&&e(),o()}))}))}getRenderedHtml(t,e,n){const o=this;return new Promise((function(i,a){const s=function(t){if(void 0===t)return void i("");const o=t(e);r.Z.Util.isFunction(n)&&n(o),i(o)},l=o.template[t];"function"!=typeof l?o.#l({locale:o.map&&o.map.options.locale,className:o.CLASS}).then((function(){s(o.template[t])})):s(l)}))}#l(t){const e=this;return t=t||{},new Promise((function(n,o){const i=e.template;let a=!1;for(var s in i){"string"==typeof i[s]&&(a=!0)}const l=function(){const e=[];for(var o in i){const t=o;let n=i[t];"string"==typeof n?e.push(new Promise((function(e,o){r.Z.ajax({url:n,method:"GET",responseType:"text"}).then((function(o){i[t]=n=r.Z._hbs.compile(o.data),e(n)})).catch((function(t){console.log("Error fetching template: "+t),o(t)}))}))):"object"==typeof n&&(i[o]=n=r.Z._hbs.template(n))}Promise.all(e).then((function(){for(var e in i){i[e]&&e!==t.className&&r.Z._hbs.registerPartial(e,i[e])}n()}))};a?r.Z.loadJSInOrder(!r.Z._hbs||!r.Z._hbs.compile,[r.Z.apiLocation+r.Z.Consts.url.TEMPLATING_FULL,r.Z.apiLocation+r.Z.Consts.url.TEMPLATING_HELPERS],l):r.Z.loadJSInOrder(!r.Z._hbs,[r.Z.apiLocation+r.Z.Consts.url.TEMPLATING_RUNTIME,r.Z.apiLocation+r.Z.Consts.url.TEMPLATING_HELPERS],l)}))}register(t){const e=this;return e.id=e.options.id||r.Z.getUID({prefix:e.CLASS.substr("tc-ctl".length+1)+"-"}),new Promise((function(n,r){e.map=t,Promise.resolve(e.render()).then((function(){e.div.parentElement||(t.div.appendChild(e),e.div=t.div),e.options.active&&e.activate(),n(e)}))}))}activate(){const t=this;t.map&&t.map.activeControl&&t.map.activeControl!==t&&(t.map.previousActiveControl=t.map.activeControl,t.map.activeControl.deactivate()),t.isActive=!0,t.map&&(t.map.activeControl=t,t.map.trigger(r.Z.Consts.event.CONTROLACTIVATE,{control:t}),t.trigger(r.Z.Consts.event.CONTROLACTIVATE,{control:t}))}deactivate(t){0===arguments.length&&(t=!1);const e=this;if(e.isActive=!1,e.map){if(e.map.activeControl=null,!t){var n=e.map.getDefaultControl();n===e||e.map.previousActiveControl===e?n=null:n||(n=e.map.previousActiveControl),n&&n.activate()}e.map.trigger(r.Z.Consts.event.CONTROLDEACTIVATE,{control:e}),e.trigger(r.Z.Consts.event.CONTROLDEACTIVATE,{control:e})}}enable(){const t=this;t.isDisabled=!1,t.classList.remove(r.Z.Consts.classes.DISABLED),delete t.dataset.tcMessage,t.containerControl&&t.containerControl.onControlEnable&&t.containerControl.onControlEnable(t)}disable(t){const e=this;t=t||{},e.isDisabled=!0,e.classList.add(r.Z.Consts.classes.DISABLED);let n=e.getLocaleString("disabledControl");t.reason&&(n=`${n} - ${t.reason}`),e.dataset.tcMessage=n,e.containerControl&&e.containerControl.onControlDisable&&e.containerControl.onControlDisable(e)}renderPromise(){const t=this;return t._firstRender||new Promise((function(e,n){t.one(r.Z.Consts.event.CONTROLRENDER,(function(){e(t)}))}))}addUIEventListener(t,e,n){(t?this.querySelectorAll(t):[this]).forEach((function(t){t.addEventListener(e,n)}))}addUIEventListeners(){}isExclusive(){return!1}getLocaleString(t,e){const n=this.map?this.map.options.locale:r.Z.Cfg.locale;return i.Z.getLocaleString(n,t,e)}getUID(){return r.Z.getUID({prefix:this.id+"-"})}exportState(){return this.exportsState?{}:null}importState(t){}getDownloadDialog(){const t=this;return t._downloadDialog=t._downloadDialog||t.map.getControlsByClass("TC.control.FeatureDownloadDialog")[0],t._downloadDialog?(t._downloadDialog.caller=t,Promise.resolve(t._downloadDialog)):new Promise((function(e,n){t.map.addControl("FeatureDownloadDialog").then((n=>{t._downloadDialog=n,t._downloadDialog.caller=t,e(n)}))}))}getElevationTool(){const t=this;return t.displayElevation||t.options.displayElevation?t.elevation?Promise.resolve(t.elevation):new Promise((function(e,n){r.Z.loadJS(!r.Z.tool||!r.Z.tool.Elevation,r.Z.apiLocation+"TC/tool/Elevation",(function(){"boolean"==typeof t.options.displayElevation?t.map?t.map.getElevationTool().then((function(n){t.elevation=n||new r.Z.tool.Elevation,e(t.elevation)})):(t.elevation=new r.Z.tool.Elevation,e(t.elevation)):t.map?t.map.getElevationTool().then((function(n){t.elevation=n?new r.Z.tool.Elevation(r.Z.Util.extend(!0,{},n.options,t.options.displayElevation)):new r.Z.tool.Elevation(t.options.displayElevation),e(t.elevation)})):(t.elevation=new r.Z.tool.Elevation(t.options.displayElevation),e(t.elevation))}))})):Promise.resolve(null)}#c(t,e){const n=function(t){const n={type:t.type,target:this,currentTarget:this};return t.detail&&Object.keys(t.detail).forEach((function(e){e in n||(n[e]=t.detail[e])})),e.call(this,n)}.bind(this);return(this._listeners[t]=this._listeners[t]||new Map).set(e,n),n}#u(t,e,n){const r=this;return t.split(" ").forEach((function(t){r.addEventListener(t,r.#c(t,e),n)})),r}on(t,e){return this.#u(t,e)}one(t,e){return self.#u(t,e,{once:!0})}off(t,e){const n=this,r=t.split(" ");return e?r.forEach((function(t){const r=n._listeners[t];r&&r.has(e)&&n.removeEventListener(t,r.get(e))})):r.forEach((function(t){const e=n._listeners[t];e&&(e.forEach((function(e){n.removeEventListener(t,e)})),e.clear())})),n}trigger(t,e){let n;e&&(n={detail:e});const r=new CustomEvent(t,n);this.dispatchEvent(r)}listenerBySelector(t,e){const n=this;return function(r){const o=this,i=r.type;var a=n.#s.get(o);a||(a={},n.#s.set(o,a));var s=a[i];if(s||(a[i]=s={}),s[t]||(s[t]=e),!r._listenerBySelectorCalled)for(var l,c=!1,u=r.target;u&&u!==o;){for(t in s)u.matches&&u.matches(t)&&(c=!0,l=s[t].call(o,r),r._listenerBySelectorCalled=!0);if(c)return l;u=u.parentNode}}}static async create(t,e){const o=t.substr(0,1).toUpperCase()+t.substr(1);if(!r.Z.control[o]){const t=await n(8949)("./"+o);r.Z.control[o]=t.default}return new r.Z.control[o](null,e)}}customElements.define("sitna-control",l),r.Z.control.WebComponentControl=l;const c=l},8633:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>u});var r=n(5361),o=n(2089),i=n(3869),a=n(5850),s=n(1709),l=(n(7106),n(7435));r.Z.Consts=o.Z,r.Z.control=r.Z.control||{},r.Z.Consts.classes.DRAG=r.Z.Consts.classes.DRAG||"tc-drag",r.Z.Consts.classes.DRAGEND=r.Z.Consts.classes.DRAGEND||"tc-dragend",r.Z.Consts.event.TOOLSOPEN=r.Z.Consts.event.TOOLSOPEN||"toolsopen.tc";class c extends i.default{CLASS="tc-ctl-wlm";CLICKEVENT="click";constructor(){super(...arguments);const t=this;t.div.classList.remove(super.CLASS),t.div.classList.add(t.CLASS),t.template={},t.template[t.CLASS]={1:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-wlm-elm"),e,{name:"tc-ctl-wlm-elm",data:o,helpers:n,partials:r,decorators:t.decorators}))?i:""},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+s(l(n,"i18n").call(a,"loadedLayers",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:4},end:{line:1,column:27}}}))+'<span class="tc-ctl-wlm-n"></span><button type="button" class="tc-ctl-wlm-del-all tc-hidden" title="'+s(l(n,"i18n").call(a,"removeAllLayersFromMap",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:127},end:{line:1,column:160}}}))+'"></button></h2>\r\n<div class="tc-ctl-wlm-empty">'+s(l(n,"i18n").call(a,"noData",{name:"i18n",hash:{},data:o,loc:{start:{line:2,column:30},end:{line:2,column:47}}}))+'</div>\r\n<div class="tc-ctl-wlm-content tc-hidden">\r\n    <ul>'+(null!=(i=l(n,"each").call(a,null!=e?l(e,"workLayers"):e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:4,column:8},end:{line:4,column:57}}}))?i:"")+"</ul>\r\n</div>"},usePartial:!0,useData:!0},t.template[t.CLASS+"-elm"]={1:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(t.lambda(null!=e?i(e,"title"):e,e))},3:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=s(n,"unless").call(a,o&&s(o,"first"),{name:"unless",hash:{},fn:t.program(4,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:89},end:{line:3,column:126}}}))?i:"")+(null!=(i=s(n,"each").call(a,e,{name:"each",hash:{},fn:t.program(6,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:126},end:{line:3,column:196}}}))?i:"")},4:function(t,e,n,r,o){return" &bull; "},6:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=a(n,"unless").call(null!=e?e:t.nullContext||{},o&&a(o,"first"),{name:"unless",hash:{},fn:t.program(7,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:140},end:{line:3,column:179}}}))?i:"")+t.escapeExpression(t.lambda(e,e))},7:function(t,e,n,r,o){return" &rsaquo; "},9:function(t,e,n,r,o){var i;return"<span>"+(null!=(i=(t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]})(n,"each").call(null!=e?e:t.nullContext||{},e,{name:"each",hash:{},fn:t.program(6,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:244},end:{line:3,column:314}}}))?i:"")+"</span>"},11:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<sitna-toggle class="tc-ctl-wlm-cb-info" text="'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"infoFromThisLayer",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:109},end:{line:6,column:137}}}))+'" checked-icon-text="&#xe923;" unchecked-icon-text="&#xe923;"></sitna-toggle>'},13:function(t,e,n,r,o){return" checked "},15:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<sitna-button variant="minimal" icon-text="&#xe917;" class="tc-ctl-wlm-btn-zoom" text="'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"zoomToLayerExtent",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:151},end:{line:8,column:179}}}))+'"></sitna-button>'},17:function(t,e,n,r,o){return" disabled"},19:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'text="'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"removeLayerFromMap",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:180},end:{line:9,column:209}}}))+'" '},21:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <div class="tc-ctl-wlm-abstract">\r\n                <h4>'+t.escapeExpression(s(n,"i18n").call(a,"abstract",{name:"i18n",hash:{},data:o,loc:{start:{line:17,column:20},end:{line:17,column:39}}}))+"</h4>\r\n"+(null!=(i=s(n,"each").call(a,null!=e?s(e,"abstract"):e,{name:"each",hash:{},fn:t.program(22,o,0),inverse:t.noop,data:o,loc:{start:{line:18,column:16},end:{line:20,column:25}}}))?i:"")+"            </div>\r\n"},22:function(t,e,n,r,o){var i;return"                <div><pre>"+(null!=(i=t.lambda(e,e))?i:"")+"</pre></div>\r\n"},24:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <ul class="tc-ctl-wlm-custom-legend">\r\n                '+(null!=(i=t.lambda(null!=e?a(e,"customLegend"):e,e))?i:"")+"\r\n            </ul>\r\n"},26:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=a(n,"if").call(null!=e?e:t.nullContext||{},null!=(i=null!=e?a(e,"legend"):e)?a(i,"length"):i,{name:"if",hash:{},fn:t.program(27,o,0),inverse:t.noop,data:o,loc:{start:{line:28,column:16},end:{line:37,column:23}}}))?i:""},27:function(t,e,n,r,o){var i,a=t.escapeExpression,s=null!=e?e:t.nullContext||{},l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <div class="tc-ctl-wlm-legend" data-layer-name="'+a(t.lambda(null!=e?l(e,"layerNames"):e,e))+'">\r\n                    <h4>'+a(l(n,"i18n").call(s,"content",{name:"i18n",hash:{},data:o,loc:{start:{line:30,column:24},end:{line:30,column:42}}}))+"</h4>\r\n"+(null!=(i=l(n,"each").call(s,null!=e?l(e,"legend"):e,{name:"each",hash:{},fn:t.program(28,o,0),inverse:t.noop,data:o,loc:{start:{line:31,column:20},end:{line:35,column:29}}}))?i:"")+"                </div>\r\n"},28:function(t,e,n,r,o){var i;return null!=(i=(t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]})(n,"each").call(null!=e?e:t.nullContext||{},e,{name:"each",hash:{},fn:t.program(29,o,0),inverse:t.noop,data:o,loc:{start:{line:32,column:24},end:{line:34,column:33}}}))?i:""},29:function(t,e,n,r,o){var i=t.lambda,a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"                    <div><p>"+a(i(null!=e?s(e,"title"):e,e))+'</p><img data-img="'+a(i(null!=e?s(e,"src"):e,e))+'" /></div>\r\n'},31:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <div class="tc-ctl-wlm-metadata">\r\n                <h4>'+t.escapeExpression(s(n,"i18n").call(a,"metadata",{name:"i18n",hash:{},data:o,loc:{start:{line:41,column:20},end:{line:41,column:39}}}))+"</h4>\r\n                <ul>\r\n"+(null!=(i=s(n,"each").call(a,null!=e?s(e,"metadata"):e,{name:"each",hash:{},fn:t.program(32,o,0),inverse:t.noop,data:o,loc:{start:{line:43,column:20},end:{line:51,column:29}}}))?i:"")+"                </ul>\r\n            </div>\r\n"},32:function(t,e,n,r,o){var i;return"                    <li>\r\n                        <ul>\r\n"+(null!=(i=(t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]})(n,"each").call(null!=e?e:t.nullContext||{},e,{name:"each",hash:{},fn:t.program(33,o,0),inverse:t.noop,data:o,loc:{start:{line:46,column:24},end:{line:48,column:33}}}))?i:"")+"                        </ul>\r\n                    </li>\r\n"},33:function(t,e,n,r,o){var i,a=t.lambda,s=t.escapeExpression,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                            <li><a href="'+(null!=(i=a(null!=e?l(e,"url"):e,e))?i:"")+'" type="'+s(a(null!=e?l(e,"format"):e,e))+'" title="'+s(a(null!=e?l(e,"formatDescription"):e,e))+'" target="_blank">'+s(a(null!=e?l(e,"formatDescription"):e,e))+"</a></li>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=t.lambda,s=t.escapeExpression,l=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li class="tc-ctl-wlm-elm" tabindex="-1">\r\n    <div title="'+s(a(null!=e?c(e,"title"):e,e))+'" class="tc-ctl-wlm-lyr">'+(null!=(i=c(n,"if").call(l,null!=e?c(e,"path"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:50},end:{line:2,column:78}}}))?i:"")+'</div>\r\n    <div class="tc-ctl-wlm-type"></div><div class="tc-ctl-wlm-path" title="'+(null!=(i=c(n,"each").call(l,null!=e?c(e,"path"):e,{name:"each",hash:{},fn:t.program(3,o,0),inverse:t.program(1,o,0),data:o,loc:{start:{line:3,column:75},end:{line:3,column:222}}}))?i:"")+'">'+(null!=(i=c(n,"each").call(l,null!=e?c(e,"path"):e,{name:"each",hash:{},fn:t.program(9,o,0),inverse:t.program(1,o,0),data:o,loc:{start:{line:3,column:224},end:{line:3,column:347}}}))?i:"")+'</div>\r\n                                       <div class="tc-ctl-wlm-input">\r\n                                           <div class="tc-ctl-wlm-tools">\r\n                                               '+(null!=(i=c(n,"if").call(l,null!=e?c(e,"hasInfo"):e,{name:"if",hash:{},fn:t.program(11,o,0),inverse:t.noop,data:o,loc:{start:{line:6,column:47},end:{line:6,column:221}}}))?i:"")+'\r\n                                               <sitna-toggle class="tc-ctl-wlm-cb-visibility" '+(null!=(i=c(n,"unless").call(l,null!=e?c(e,"hide"):e,{name:"unless",hash:{},fn:t.program(13,o,0),inverse:t.noop,data:o,loc:{start:{line:7,column:94},end:{line:7,column:130}}}))?i:"")+' text="'+s(c(n,"i18n").call(l,"visibilityOfThisLayer",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:137},end:{line:7,column:169}}}))+'" checked-icon-text="&#xe910;" unchecked-icon-text="&#xe911;"></sitna-toggle>\r\n                                               '+(null!=(i=c(n,"if").call(l,null!=e?c(e,"hasExtent"):e,{name:"if",hash:{},fn:t.program(15,o,0),inverse:t.noop,data:o,loc:{start:{line:8,column:47},end:{line:8,column:203}}}))?i:"")+'\r\n                                               <sitna-button variant="minimal" icon="delete" class="tc-ctl-wlm-btn-del tc-item-tool-last" '+(null!=(i=c(n,"if").call(l,null!=e?c(e,"unremovable"):e,{name:"if",hash:{},fn:t.program(17,o,0),inverse:t.program(19,o,0),data:o,loc:{start:{line:9,column:138},end:{line:9,column:218}}}))?i:"")+'></sitna-button>\r\n                                               <sitna-button variant="minimal" icon-text="&#x2022&#x2022&#x2022" class="tc-ctl-wlm-btn-more" text="'+s(c(n,"i18n").call(l,"otherTools",{name:"i18n",hash:{},data:o,loc:{start:{line:10,column:147},end:{line:10,column:168}}}))+'"></sitna-button>\r\n                                           </div>\r\n                                           <input type="range" value="'+s(a(null!=e?c(e,"opacity"):e,e))+'" title="'+s(c(n,"i18n").call(l,"transparencyOfThisLayer",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:90},end:{line:12,column:124}}}))+'" />\r\n                                       </div>\r\n        <div class="tc-ctl-wlm-info tc-hidden">\r\n'+(null!=(i=c(n,"if").call(l,null!=(i=null!=e?c(e,"abstract"):e)?c(i,"length"):i,{name:"if",hash:{},fn:t.program(21,o,0),inverse:t.noop,data:o,loc:{start:{line:15,column:12},end:{line:22,column:19}}}))?i:"")+(null!=(i=c(n,"if").call(l,null!=e?c(e,"customLegend"):e,{name:"if",hash:{},fn:t.program(24,o,0),inverse:t.program(26,o,0),data:o,loc:{start:{line:23,column:12},end:{line:38,column:19}}}))?i:"")+(null!=(i=c(n,"if").call(l,null!=(i=null!=e?c(e,"metadata"):e)?c(i,"length"):i,{name:"if",hash:{},fn:t.program(31,o,0),inverse:t.noop,data:o,loc:{start:{line:39,column:12},end:{line:54,column:19}}}))?i:"")+'        </div>\r\n    <div class="tc-ctl-wlm-dd" title="'+s(c(n,"i18n").call(l,"dragToReorder",{name:"i18n",hash:{},data:o,loc:{start:{line:56,column:38},end:{line:56,column:62}}}))+'"></div>\r\n</li>'},useData:!0},t.template[t.CLASS+"-type-sgl"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"singleLayer",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:0},end:{line:1,column:22}}}))},useData:!0},t.template[t.CLASS+"-type-grp"]={1:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-wlm-type-grp-node"),e,{name:"tc-ctl-wlm-type-grp-node",data:o,indent:"    ",helpers:n,partials:r,decorators:t.decorators}))?i:""},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<div>"+t.escapeExpression(s(n,"i18n").call(a,"groupLayerThatContains",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:5},end:{line:1,column:38}}}))+":</div>\r\n<ul>\r\n"+(null!=(i=s(n,"each").call(a,null!=e?s(e,"Layer"):e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:4},end:{line:5,column:13}}}))?i:"")+"</ul>"},usePartial:!0,useData:!0},t.template[t.CLASS+"-type-grp-node"]={1:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=t.invokePartial(a(r,"tc-ctl-wlm-type-grp-node"),e,{name:"tc-ctl-wlm-type-grp-node",data:o,indent:"        ",helpers:n,partials:r,decorators:t.decorators}))?i:""},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li class="tc-ctl-ltoc-tip-grp-elm">\r\n    <span>'+t.escapeExpression(t.lambda(null!=e?a(e,"Title"):e,e))+"</span>\r\n    <ul>\r\n"+(null!=(i=a(n,"each").call(null!=e?e:t.nullContext||{},null!=e?a(e,"Layer"):e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:4,column:8},end:{line:6,column:17}}}))?i:"")+"    </ul>\r\n</li>"},usePartial:!0,useData:!0},t.layers=[],t._uiElementSelector=`ul > li.${t.CLASS}-elm`,t._toolContainerSelector=`.${t.CLASS}-tools`,t.addItemTool({renderFn:function(e,n){const o=t.CLASS+"-btn-dl";let i=e.querySelector("sitna-button."+o);if(!i){const e=t.map.getLayer(n);if(r.Z.layer.Vector&&e instanceof r.Z.layer.Vector){const e=t.getLocaleString("downloadFeatures");i=new s.Z,i.variant=s.Z.variant.MINIMAL,i.text=e,i.icon=s.Z.action.DOWNLOAD_ALL,i.setAttribute("title",e),i.dataset.layerId=n}}return i},actionFn:function(){var e=this;do{e=e.parentElement}while(e&&"LI"!==e.tagName);const n=t.map.getLayer(this.dataset.layerId);t.getDownloadDialog().then((function(e){const r=n.title||"",o={title:`${r} - ${t.getLocaleString("downloadFeatures")}`,fileName:/\.[a-z0-9]+$/i.test(r)?r.substr(0,r.lastIndexOf(".")):r,elevation:t.map.elevation&&t.map.elevation.options};e.open(n.features,o)}))}})}render(t,e){const o=this;return o._set1stRenderPromise(o.map?o.renderData(e?r.Z.Util.extend(o.map.getLayerTree(),e):o.map.getLayerTree(),(function(){o.addUIEventListeners(),n.e(958).then(n.bind(n,4958)).then((function(e){const n=e.default;o.map.workLayers.filter((function(t){return!t.stealth})).forEach((function(t){o.updateLayerTree(t)}));const i=o.div.querySelector("ul");o._sortable=n.create(i,{handle:"."+o.CLASS+"-dd",animation:150,onSort:function(t){o.#p(t.item,t.oldIndex,t.newIndex)}}),i.addEventListener("keydown",r.Z.EventTarget.listenerBySelector("li",(function(t){for(var e=t.target;"LI"!==e.tagName;)if(!(e=e.parentElement))return;const n=function(t,n){const r=o._sortable.toArray(),i=r[t];r[t]=r[n],r[n]=i,o._sortable.sort(r),o.#p(e,t,n)},r=o.getLayerUIElements(),i=r.indexOf(e);switch(!0){case/Up$/.test(t.key):i>0&&(n(i,i-1),e.focus(),t.stopPropagation());break;case/Down$/.test(t.key):i<r.length-1&&(n(i,i+1),e.focus(),t.stopPropagation());break;case/Enter$/.test(t.key):e.blur(),t.stopPropagation()}}))),"function"==typeof t&&t()}))})):Promise.reject(Error("Cannot render: control has no map")))}async register(t){const e=this;return await super.register(t),t.loaded((function(){e.updateScale()})),t.on(r.Z.Consts.event.LAYEROPACITY,(function(t){const n=e.#d(t.layer);n&&(n.querySelector("input[type=range]").value=Math.round(100*t.opacity))})).on(r.Z.Consts.event.FEATURESIMPORT,(function(n){var o=n.fileName;if(n.features&&n.features.length>0){var i="."+r.Z.Consts.format.GPX.toLowerCase();if(n.fileName.toLowerCase().indexOf(i)===n.fileName.length-i.length)return;t.one(r.Z.Consts.event.LAYERADD,(function(t){t&&t.layer&&t.layer.title===o&&(e.map&&e.map.layout&&e.map.layout.accordion&&e.div.classList.contains(r.Z.Consts.classes.COLLAPSED)&&e.map.controls.filter((function(t){return t!==e&&!t.containerControl})).forEach((function(t){let e;e=t instanceof a.default?t:t.div,e.classList.add(r.Z.Consts.classes.COLLAPSED)})),e.map.trigger(r.Z.Consts.event.TOOLSOPEN),e.div.classList.remove(r.Z.Consts.classes.COLLAPSED))}))}})),e}onExternalServiceAdded(t){}addUIEventListeners(){const t=this;t.div.addEventListener("change",r.Z.EventTarget.listenerBySelector(`sitna-toggle.${t.CLASS}-cb-visibility`,(function(e){const n=e.target;var r=n;do{r=r.parentElement}while(r&&!r.matches("li."+t.CLASS+"-elm"));t.map.getLayer(r.dataset.layerId).setVisibility(n.checked),e.stopPropagation()})));const e=function(e){const n=e.target;var r=n;do{r=r.parentElement}while(r&&"LI"!==r.tagName);t.map.getLayer(r.dataset.layerId).setOpacity(n.value/100)};t.div.addEventListener("change",r.Z.EventTarget.listenerBySelector("input[type=range]",e)),t.div.addEventListener("input",r.Z.EventTarget.listenerBySelector("input[type=range]",e)),t.div.addEventListener("change",r.Z.EventTarget.listenerBySelector(`.${t.CLASS}-cb-info`,(function(e){const n=e.target;var o=n;do{o=o.parentElement}while(o&&"LI"!==o.tagName);const i=o.querySelector("."+t.CLASS+"-info"),a=t.map.getLayer(o.dataset.layerId);i.querySelectorAll("."+t.CLASS+"-legend img").forEach((function(e){t.styleLegendImage(e,a)})),i.classList.toggle(r.Z.Consts.classes.HIDDEN,!n.checked)}))),t.div.addEventListener(t.CLICKEVENT,r.Z.EventTarget.listenerBySelector(`.${t.CLASS}-btn-del:not(:disabled)`,(function(e){var n=e.target;do{n=n.parentElement}while(n&&"LI"!==n.tagName);const r=t.map.getLayer(n.dataset.layerId);t.map.removeLayer(r)}))),t.div.addEventListener(t.CLICKEVENT,r.Z.EventTarget.listenerBySelector("."+t.CLASS+"-del-all",(function(e){r.Z.confirm(t.getLocaleString("layersRemove.confirm"),(function(){t.getLayerUIElements().map((function(e){return t.map.getLayer(e.dataset.layerId)})).forEach((function(e){t.map.removeLayer(e)}))})),e.stopPropagation()}))),t.div.addEventListener(t.CLICKEVENT,r.Z.EventTarget.listenerBySelector(`.${t.CLASS}-btn-more`,(function(e){const n=e.target,r=n.parentElement.classList.toggle("tc-expanded");n.title=r?"":t.getLocaleString("otherTools"),n.iconText=r?"⯇":"•••"})))}updateLayerVisibility(t){const e=this,n=e.#d(t);if(n){const r=t.getVisibility();n.querySelector(`sitna-toggle.${e.CLASS}-cb-visibility`).checked=r}}updateLayerTree(t){const e=this;if(!t.isBase&&!t.options.stealth){r.Z.control.MapContents.prototype.updateLayerTree.call(e,t);for(var n=!1,o=0,i=e.layers.length;o<i;o++)if(t===e.layers[o]){n=!0;break}if(n){let n=t.title||t.wrap.getServiceTitle&&t.wrap.getServiceTitle();const r=function(){return new RegExp(t.id.replace(/([\w]*-\d)(-\d)*/gi,"$1-\\d"),"gi")},o=e.layers.filter((e=>e.title===t.title)).reduce(((t,e)=>{const n=r().exec(e.id)?r().exec(e.id)[0]:e.id;return t.indexOf(n)>=0?t:t.concat(n)}),[]).findIndex((e=>e===/^[\w]*-\d-\d/gi.exec(t.id)||t.id));o>0&&(t._title=n=n+" ("+(o+1)+")");const i=e.div.querySelector("ul li[data-layer-id='"+t.id+"']");t.features&&t.features.length&&(t.features[0].getPath().length?(i.querySelector(".tc-ctl-wlm-lyr").innerHTML=n,i.querySelector(".tc-ctl-wlm-lyr").title=n,i.querySelector(".tc-ctl-wlm-path").innerHTML=t.features[0].getPath().join(" &rsaquo; ")):(i.querySelector(".tc-ctl-wlm-path").innerHTML=n,i.querySelector(".tc-ctl-wlm-path").title=n))}else{e.layers.push(t);const n=t.title||t.wrap.getServiceTitle&&t.wrap.getServiceTitle();t._title=n;var a={title:t.options.hideTitle?"":n,hide:!(!t.renderOptions||!t.renderOptions.hide),opacity:t.renderOptions&&t.renderOptions.opacity?100*t.renderOptions.opacity:100,customLegend:t.customLegend,unremovable:t.unremovable,id:t.id},s=t.isRaster();if(s){a.hasExtent=!!t.getExtent(),a.layerNames=t.layerNames;const e=t.names.map((e=>t.getPath(e)));e.forEach((t=>t.shift())),a.path=e,a.legend=[],a.abstract=[],a.metadata=[],t.names.forEach((function(e){var n=t.getInfo(e);a.legend.push(n.legend),a.abstract.push(n.abstract),a.metadata.push(n.metadata)}));const n=t.getInfo();a.hasInfo=Object.prototype.hasOwnProperty.call(n,"abstract")||Object.prototype.hasOwnProperty.call(n,"legend")||Object.prototype.hasOwnProperty.call(n,"metadata")}else a.hasExtent=!0,a.hasInfo=!1;(function(t){return new Promise((function(e,n){t&&t.options.method&&"POST"===t.options.method?t.getLegendGraphicImage().then((function(t){e(t)})).catch((function(t){r.Z.error(t)})):e()}))})(t).then((function(n){e.getRenderedHtml(e.CLASS+"-elm",a).then((function(n){const o=(new DOMParser).parseFromString(n,"text/html").body.firstChild;var i,a,l=!1;if(s&&!(l=t.names.length>1)){const e=t.names[0],n=t.wrap.getAllLayerNodes();for(a=0;a<n.length;a++){var c=n[a];if(t.wrap.getName(c)===e){i=c,t.wrap.getLayerNodes(c).length>0&&(l=!0);break}}}const u=o.querySelector("."+e.CLASS+"-type"),p=l?e.CLASS+"-type-grp":e.CLASS+"-type-sgl";u.classList.add(p);const d=o.querySelector(`.${e.CLASS}-btn-zoom`);d&&d.addEventListener(r.Z.Consts.event.CLICK,(function(t){e.map.zoomToLayer(o.dataset.layerId,{animate:!0})}),{passive:!0}),i&&(t.wrap.normalizeLayerNode(i),e.getRenderedHtml(p,i).then((function(t){var n;u.addEventListener("mouseover",(function(r){const o=e.map.div,i=u.getBoundingClientRect();(n=document.createElement("div")).classList.add(e.CLASS+"-tip"),n.innerHTML=t,n.style.top=i.top-o.offsetTop+"px",n.style.right=o.offsetWidth-(i.left-o.offsetLeft)+"px",o.appendChild(n)})),u.addEventListener("mouseout",(function(t){n.parentElement.removeChild(n)}))})));const h=e.div.querySelector("ul");o.dataset.layerId=t.id;const f=e.getLayerUIElements(),m=e.map.workLayers.filter((function(t){return!t.stealth})),g=m.indexOf(t);e.getItemTools().forEach((t=>e.addItemToolUI(o,t)));var y=!1;for(a=0;a<f.length;a++){const t=f[a];if(m.indexOf(e.map.getLayer(t.dataset.layerId))<g){t.insertAdjacentElement("beforebegin",o),y=!0;break}}y||h.appendChild(o),e.updateScale()}))}));var l=e.#h();const o=e.div.querySelector("."+e.CLASS+"-n"),i=e.div.querySelector("."+e.CLASS+"-empty"),c=e.div.querySelector("."+e.CLASS+"-content");o.textContent=l,l>0?(o.classList.add(r.Z.Consts.classes.VISIBLE),i.classList.add(r.Z.Consts.classes.HIDDEN),c.classList.remove(r.Z.Consts.classes.HIDDEN)):(o.classList.remove(r.Z.Consts.classes.VISIBLE),i.classList.remove(r.Z.Consts.classes.HIDDEN),c.classList.add(r.Z.Consts.classes.HIDDEN));e.div.querySelector("."+e.CLASS+"-del-all").classList.toggle(r.Z.Consts.classes.HIDDEN,!e.#f())}}}updateScale(){const t=this;t.getLayerUIElements().forEach((function(e){var n=t.map.getLayer(e.dataset.layerId);if(n&&n.names){for(var r=!1,o=0;o<n.names.length;o++)if(n.isVisibleByScale(n.names[o])){r=!0;break}e.classList.toggle(t.CLASS+"-elm-notvisible",!r)}}))}update(){const t=this;t.getLayerUIElements().forEach((function(e){const n=t.map.getLayer(e.dataset.layerId);n&&(e.querySelector(`sitna-toggle.${t.CLASS}-cb-visibility`).checked=n.getVisibility(),n.tree=null)})),t.updateScale()}updateLayerOrder(t,e,n){const r=this;r.map.workLayers.filter((function(t){return!t.stealth})).forEach((function(t){const e=r.#d(t);e&&e.parentElement.firstChild.insertAdjacentElement("beforebegin",e)}))}removeLayer(t){const e=this,n=e.layers.indexOf(t);n>=0&&e.layers.splice(n,1),e.getLayerUIElements().forEach((function(e){e.dataset.layerId===t.id&&e.parentElement.removeChild(e)}));const o=e.div.querySelector("."+e.CLASS+"-content"),i=e.div.querySelector("."+e.CLASS+"-empty"),a=e.div.querySelector("."+e.CLASS+"-n");var s=e.#h();a.textContent=s,s>0?(o.classList.remove(r.Z.Consts.classes.HIDDEN),i.classList.add(r.Z.Consts.classes.HIDDEN),a.classList.add(r.Z.Consts.classes.VISIBLE)):(e.#f()&&e.div.querySelector("."+e.CLASS+"-del-all").classList.add(r.Z.Consts.classes.HIDDEN),o.classList.add(r.Z.Consts.classes.HIDDEN),i.classList.remove(r.Z.Consts.classes.HIDDEN),a.classList.remove(r.Z.Consts.classes.VISIBLE))}getLayerUIElements(){return Array.from(this.div.querySelectorAll(`ul > li.${this.CLASS}-elm`))}#d(t){this.getLayerUIElements().find((e=>e.dataset.layerId===t.id))}#f=function(){return!this.layers.some((t=>t.unremovable))};#h(){return this.layers.length}#p=function(t,e,n,r){const o=this,i=o.getLayerUIElements();var a;if(n>e)a=i[n-1];else{if(!(n<e))return;a=i[n+1]}const s=o.map.getLayer(t.dataset.layerId),l=o.map.getLayer(a.dataset.layerId),c=o.map.layers.indexOf(l);c>=1&&c<o.map.layers.length&&o.map.insertLayer(s,c,r)}}r.Z.mix(c,l.default);const u=c},7901:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>i});var r=n(5361),o=n(7945);r.Z.Util=o.Z,r.Z.control=r.Z.control||{},r.Z.control.infoShare={getDiv:function(t){return t||this._dialogDiv},getShareDialog:function(t){const e=this,n=e.getDiv(t);return e._shareCtl?Promise.resolve(e._shareCtl):new Promise((function(t,r){e.map.addControl("share",{id:e.getUID(),div:n.querySelector(".tc-modal-body ."+e.CLASS+"-share-dialog-ctl"),includeControls:!1}).then((n=>{e._shareCtl=n,e._shareCtl.caller=e,e._shareCtl.extraParams=null,t(n)}))}))},onShowShareDialog:async function(){const t=this;t.toShare=t.toShare||{},t.toShare.doZoom=!0,t.map.trigger(r.Z.Consts.event.MAPCHANGE);const e=t._shareCtl,n=e.div,o=await e.generateLink(),i=n.querySelector(".tc-url input[type=text]");i.value=o,delete i.dataset.update,delete i.dataset.shortened,n.querySelector(".tc-iframe input[type=text]").value=await e.generateIframe(o)},showShareDialog:function(t){const e=this,n=e.getDiv(t).querySelector("."+e.CLASS+"-share-dialog");r.Z.Util.showModal(n,{openCallback:function(){e.onShowShareDialog(n).then((function(){e.map.trigger(r.Z.Consts.event.DIALOG,{control:e._shareCtl,action:"share"})}))},closeCallback:function(){e.onCloseShareDialog()}})},onCloseShareDialog:function(){const t=this;t.toShare=t.toShare||{},t.toShare.doZoom=!1,t.map.trigger(r.Z.Consts.event.MAPCHANGE)}};const i=r.Z.control.infoShare},7435:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>l});var r=n(5361),o=n(7945),i=n(2089),a=n(7106);r.Z.Util=o.Z,r.Z.control=r.Z.control||{};const s={_uiElementSelector:"ul > li",_toolContainerSelector:".tc-item-tools",isItemToolContainer:!0,getItemTools:function(){const t=this;return t.itemTools||(t.itemTools=[]),t.itemTools},getItemUIElements:function(t){const e=this;return t&&(e._uiElementSelector=t),Array.from(e.div.querySelectorAll(e._uiElementSelector))},getToolContainer:function(t){return t.querySelector(this._toolContainerSelector)},addItemToolUI:function(t,e){const n=this;if(o.Z.isFunction(e.renderFn)){const r=n.getToolContainer(t),s=e.renderFn(r,t.dataset.layerId);if(s){const t=r.querySelector(".tc-item-tool-last");if(t?t.insertAdjacentElement("beforebegin",s):r.appendChild(s),o.Z.isFunction(e.actionFn)){const t=s instanceof a.Z?"change":i.Z.event.CLICK;s.addEventListener(t,(function(t){e.actionFn.call(s)}),{passive:!0})}o.Z.isFunction(e.updateFn)&&e.updateEvents&&n.map.on(e.updateEvents.join(" "),(function(t){t.layer&&t.layer.id!==s.dataset.layerId||e.updateFn.call(s,t)}))}}},addItemTool:function(t){const e=this;e.getItemTools().push(t),e.getItemUIElements().forEach((function(n){e.addItemToolUI(n,t)}))}};r.Z.control.itemToolContainer=s;const l=s},8330:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>i});var r=n(5361),o=n(2089);const i={getLayers:function(){const t=this;return t.layers||(t.layers=[]),t.layers},registerLayerAdd:function(){const t=this;t.map.on(o.Z.event.LAYERADD,(function(e){const n=t.getIdCount(e.layer.id);n&&(r.Z.setUIDStart(n+1,{prefix:t.id+"-"}),e.layer.owner=t)}))},getIdCount:function(t){const e=new RegExp(`^${this.id}(-(\\d+))*$`),n=t.match(e);return n?parseInt(n[1]):0}}},6804:(t,e,n)=>{"use strict";n.d(e,{Z:()=>s});var r=n(5361),o=n(1299),i=n(2391),a=n(5798);r.Z.Feature=o.Z,r.Z.feature=r.Z.feature||{},r.Z.feature.Point=i.Z,r.Z.i18n=r.Z.i18n||a.Z,r.Z.feature.Marker=function(t,e){const n=this;if(r.Z.Feature.apply(n,arguments),!n.wrap.isNative(t)){var o=n.layer&&n.layer.map?n.layer.map.options.locale:r.Z.Cfg.locale;n.title=n.options.title||r.Z.i18n[o][r.Z.Consts.MARKER],n.wrap.createMarker(t,e)}},r.Z.inherit(r.Z.feature.Marker,r.Z.feature.Point),r.Z.feature.Marker.prototype.STYLETYPE="marker",r.Z.feature.Marker.prototype.CLASSNAME="TC.feature.Marker";const s=r.Z.feature.Marker},6236:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});var r=n(5361),o=n(1299),i=n(9874);r.Z.Feature=o.Z,r.Z.feature=r.Z.feature||{},r.Z.feature.MultiPoint=i.Z,r.Z.feature.MultiMarker=function(t,e){var n=this;r.Z.Feature.apply(n,arguments),n.wrap.isNative(t)||(n.wrap.feature=t,n.wrap.createMultiMarker(t,e))},r.Z.inherit(r.Z.feature.MultiMarker,r.Z.feature.MultiPoint),r.Z.feature.MultiMarker.prototype.STYLETYPE="marker",r.Z.feature.MultiMarker.prototype.CLASSNAME="TC.feature.MultiMarker",r.Z.feature.MultiMarker.prototype.setCoords=function(t){if(!Array.isArray(t))throw new Error("Coordinates not valid for multimarker");return Array.isArray(t[0])||(t=[t]),r.Z.Feature.prototype.setCoords.call(this,t)},r.Z.feature.MultiMarker.prototype.getCoords=function(t){t=t||{};return r.Z.Feature.prototype.getCoords.call(this,t)};const a=r.Z.feature.MultiMarker},9874:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var r=n(5361),o=n(1299);r.Z.Feature=o.Z,r.Z.feature=r.Z.feature||{},r.Z.feature.MultiPoint=function(t,e){var n=this;r.Z.Feature.apply(n,arguments),n.wrap.isNative(t)||(n.wrap.feature=t,n.wrap.createMultiPoint(t,e))},r.Z.inherit(r.Z.feature.MultiPoint,r.Z.Feature),r.Z.feature.MultiPoint.prototype.STYLETYPE=r.Z.Consts.geom.POINT,r.Z.feature.MultiPoint.prototype.CLASSNAME="TC.feature.MultiPoint",r.Z.feature.MultiPoint.prototype.setCoords=function(t){if(!Array.isArray(t))throw new Error("Coordinates not valid for multipoint");return Array.isArray(t[0])||(t=[t]),r.Z.Feature.prototype.setCoords.call(this,t)},r.Z.feature.MultiPoint.prototype.getCoords=function(t){t=t||{};return r.Z.Feature.prototype.getCoords.call(this,t)};const i=r.Z.feature.MultiPoint},4323:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var r=n(5361),o=n(1299);r.Z.Feature=o.Z,r.Z.feature=r.Z.feature||{},r.Z.feature.MultiPolygon=function(t,e){const n=this;r.Z.Feature.apply(n,arguments),n.wrap.isNative(t)||n.wrap.createMultiPolygon(t,e)},r.Z.inherit(r.Z.feature.MultiPolygon,r.Z.Feature),r.Z.feature.MultiPolygon.prototype.STYLETYPE=r.Z.Consts.geom.POLYGON,r.Z.feature.MultiPolygon.prototype.CLASSNAME="TC.feature.MultiPolygon",r.Z.feature.MultiPolygon.prototype.getCoords=function(t){t=t||{};const e=r.Z.Feature.prototype.getCoords.call(this,t);return t.pointArray?[].concat.apply([],[].concat.apply([],e)):e},r.Z.feature.MultiPolygon.prototype.setCoords=function(t){if(!Array.isArray(t)||!Array.isArray(t[0]))throw new Error("Coordinates not valid for multipolygon");return Array.isArray(t[0][0])?Array.isArray(t[0][0][0])||(t=[t]):t=[[t]],t.forEach((function(t){t.forEach((function(t){const e=t[0],n=t[t.length-1];e[0]===n[0]&&e[1]===n[1]||(t[t.length]=e)}))})),r.Z.Feature.prototype.setCoords.call(this,t)},r.Z.feature.MultiPolygon.prototype.getLength=function(t){return this.wrap.getLength(t)};const i=r.Z.feature.MultiPolygon},9706:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var r=n(5361),o=n(1299);r.Z.Feature=o.Z,r.Z.feature=r.Z.feature||{},r.Z.feature.MultiPolyline=function(t,e){const n=this;r.Z.Feature.apply(n,arguments),n.wrap.isNative(t)||n.wrap.createMultiPolyline(t,e)},r.Z.inherit(r.Z.feature.MultiPolyline,r.Z.Feature),r.Z.feature.MultiPolyline.prototype.STYLETYPE="line",r.Z.feature.MultiPolyline.prototype.CLASSNAME="TC.feature.MultiPolyline",r.Z.feature.MultiPolyline.prototype.getCoords=function(t){t=t||{};const e=r.Z.Feature.prototype.getCoords.call(this,t);return t.pointArray?[].concat.apply([],e):e},r.Z.feature.MultiPolyline.prototype.setCoords=function(t){return Array.isArray(t)&&Array.isArray(t[0])&&!Array.isArray(t[0][0])&&(t=[t]),r.Z.Feature.prototype.setCoords.call(this,t)},r.Z.feature.MultiPolyline.prototype.getLength=function(t){return this.wrap.getLength(t)};const i=r.Z.feature.MultiPolyline},2391:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var r=n(5361),o=n(1299);r.Z.Feature=o.Z,r.Z.feature=r.Z.feature||{},r.Z.feature.Point=function(t,e){var n=this;r.Z.Feature.apply(n,arguments),n.wrap.isNative(t)||(n.wrap.feature=t,n.wrap.createPoint(t,e))},r.Z.inherit(r.Z.feature.Point,r.Z.Feature),r.Z.feature.Point.prototype.STYLETYPE=r.Z.Consts.geom.POINT,r.Z.feature.Point.prototype.CLASSNAME="TC.feature.Point",r.Z.feature.Point.prototype.getCoords=function(t){t=t||{};const e=r.Z.Feature.prototype.getCoords.call(this,t);return t.pointArray?[e]:e};const i=r.Z.feature.Point},6281:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var r=n(5361),o=n(1299);r.Z.Feature=o.Z,r.Z.feature=r.Z.feature||{},r.Z.feature.Polygon=function(t,e){const n=this;r.Z.Feature.apply(n,arguments),n.wrap.isNative(t)||n.wrap.createPolygon(t,e)},r.Z.inherit(r.Z.feature.Polygon,r.Z.Feature),r.Z.feature.Polygon.prototype.STYLETYPE=r.Z.Consts.geom.POLYGON,r.Z.feature.Polygon.prototype.CLASSNAME="TC.feature.Polygon",r.Z.feature.Polygon.prototype.getCoords=function(t){t=t||{};const e=r.Z.Feature.prototype.getCoords.call(this,t);return t.pointArray?[].concat.apply([],e):e},r.Z.feature.Polygon.prototype.setCoords=function(t){if(!Array.isArray(t)||!Array.isArray(t[0]))throw new Error("Coordinates not valid for polygon");return Array.isArray(t[0][0])||(t=[t]),t.forEach((function(t){const e=t[0],n=t[t.length-1];e[0]===n[0]&&e[1]===n[1]||(t[t.length]=e)})),r.Z.Feature.prototype.setCoords.call(this,t)},r.Z.feature.Polygon.prototype.getLength=function(t){return this.wrap.getLength(t)},r.Z.feature.Polygon.prototype.getArea=function(t){return this.wrap.getArea(t)};const i=r.Z.feature.Polygon},1327:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var r=n(5361),o=n(1299);r.Z.Feature=o.Z,r.Z.feature=r.Z.feature||{},r.Z.feature.Polyline=function(t,e){const n=this;r.Z.Feature.apply(n,arguments),n.wrap.isNative(t)||n.wrap.createPolyline(t,e)},r.Z.inherit(r.Z.feature.Polyline,r.Z.Feature),r.Z.feature.Polyline.prototype.STYLETYPE="line",r.Z.feature.Polyline.prototype.CLASSNAME="TC.feature.Polyline",r.Z.feature.Polyline.prototype.setCoords=function(t){return Array.isArray(t)&&!Array.isArray(t[0])&&(t=[t]),r.Z.Feature.prototype.setCoords.call(this,t)},r.Z.feature.Polyline.prototype.getLength=function(t){return this.wrap.getLength(t)};const i=r.Z.feature.Polyline},4496:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var r=n(5361);r.Z.filter={},r.Z.filter.Filter=function(t){this.tagName_=t,this._defaultNSURL="http://www.opengis.net/ogc",this._defaultPrefixNS=this._wfsPrefixNS="ogc",this._fieldTitle="PropertyName",this._defaultNSURL=this._wfsNSURL="http://www.opengis.net/ogc",this._wfs2prefixNS="fes",this._wfs2NSURL="http://www.opengis.net/fes/2.0",this._wfs2FieldTitle="ValueReference",this._escapeAttrName="escape",this._wfs2EscapeAttrName="escapeChar"},r.Z.filter.Filter.prototype.getTagName=function(){return this.tagName_},r.Z.filter.Filter.prototype.setTagName=function(t){return this.tagName_},r.Z.filter.Filter.prototype.writeFilterCondition_=function(){return'<{prefix}:Filter xmlns:{prefix}="{NSURL}" xmlns:gml="http://www.opengis.net/gml{gmlversion}">{inner}</{prefix}:Filter>'.format({prefix:this._defaultPrefixNS,NSURL:this._defaultNSURL,tag:this.getTagName(),inner:this.writeInnerCondition_(this),gmlVersion:this._defaultNSURL===this._wfs2NSURL?"/3.2":""})},r.Z.filter.Filter.prototype.writeInnerCondition_=function(t){return t!=this&&(t._defaultNSURL=this._defaultNSURL,t._defaultPrefixNS=this._defaultPrefixNS,t._fieldTitle=this._fieldTitle),t instanceof r.Z.filter.LogicalNary||t instanceof r.Z.filter.ComparisonBinary||t instanceof r.Z.filter.Comparison||t instanceof r.Z.filter.Spatial||r.Z.filter.Function,t.write()},r.Z.filter.Filter.prototype.writeInnerArrayCondition_=function(t){const e=this;return e.conditions.reduce((function(t,n,o){return(t instanceof r.Z.filter.Filter?e.writeInnerCondition_(t):t)+e.writeInnerCondition_(n)}))},r.Z.filter.Filter.prototype.getText=function(t){return t&&parseFloat(t,10)>=2&&(this._defaultPrefixNS=this._wfs2prefixNS,this._defaultNSURL=this._wfs2NSURL,this._fieldTitle=this._wfs2FieldTitle,this._escapeAttrName=this._wfs2EscapeAttrName),this.writeFilterCondition_()},r.Z.filter.Filter.prototype.readText=function(t){return t.indexOf(this._wfs2prefixNS)>-1&&t.indexOf(this._wfs2NSURL)>-1&&t.indexOf(this._wfs2FieldTitle)>-1&&t.indexOf(this._wfs2EscapeAttrName)>-1&&(this._defaultPrefixNS=this._wfs2prefixNS,this._defaultNSURL=this._wfs2NSURL,this._fieldTitle=this._wfs2FieldTitle,this._escapeAttrName=this._wfs2EscapeAttrName),this.readFilterCondition_(t)},r.Z.filter.Filter.prototype.readFilterCondition_=function(t){return this.setTagName(t),this.readInnerCondition_(t)},r.Z.filter.Filter.prototype.readInnerCondition_=function(t){return o.read(t)},r.Z.filter.and=function(t){var e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(r.Z.filter.And,e))},r.Z.filter.or=function(t){var e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(r.Z.filter.Or,e))},r.Z.filter.not=function(t){return new r.Z.filter.Not(t)},r.Z.filter.intersects=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new r.Z.filter.Intersects(null,arguments[0],arguments[1]):new r.Z.filter.Intersects(arguments[0],arguments[1],arguments[2])},r.Z.filter.within=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new r.Z.filter.Within(null,arguments[0],arguments[1]):new r.Z.filter.Within(arguments[0],arguments[1],arguments[2])},r.Z.filter.equalTo=function(t,e,n){return new r.Z.filter.EqualTo(t,e,n)},r.Z.filter.notEqualTo=function(t,e,n){return new r.Z.filter.NotEqualTo(t,e,n)},r.Z.filter.lessThan=function(t,e){return new r.Z.filter.LessThan(t,e)},r.Z.filter.lessThanOrEqualTo=function(t,e){return new r.Z.filter.LessThanOrEqualTo(t,e)},r.Z.filter.greaterThan=function(t,e){return new r.Z.filter.GreaterThan(t,e)},r.Z.filter.greaterThanOrEqualTo=function(t,e){return new r.Z.filter.GreaterThanOrEqualTo(t,e)},r.Z.filter.isNull=function(t){return new r.Z.filter.IsNull(t)},r.Z.filter.between=function(t,e,n){return new r.Z.filter.IsBetween(t,e,n)},r.Z.filter.function=function(t,e){return new r.Z.filter.Function(t,e)},r.Z.filter.like=function(t,e,n,o,i,a){return new r.Z.filter.IsLike(t,e,n,o,i,a)},r.Z.filter.LogicalNary=function(t,e){r.Z.filter.Filter.call(this,t),this.conditions=Array.prototype.slice.call(arguments,1)},r.Z.inherit(r.Z.filter.LogicalNary,r.Z.filter.Filter),r.Z.filter.And=function(t){var e=["And"].concat(Array.prototype.slice.call(arguments));r.Z.filter.LogicalNary.apply(this,e)},r.Z.inherit(r.Z.filter.And,r.Z.filter.LogicalNary),r.Z.filter.Or=function(t){var e=["Or"].concat(Array.prototype.slice.call(arguments));r.Z.filter.LogicalNary.apply(this,e)},r.Z.inherit(r.Z.filter.Or,r.Z.filter.LogicalNary),r.Z.filter.LogicalNary.prototype.write=function(){return"<{prefix}:{tag}>{inner}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:this.writeInnerArrayCondition_()})},r.Z.filter.Not=function(t){this.condition=t,r.Z.filter.Filter.call(this,"Not")},r.Z.inherit(r.Z.filter.Not,r.Z.filter.Filter),r.Z.filter.Filter.prototype.write=function(){return"<{prefix}:{tag}>{inner}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:this.writeInnerCondition_(this.condition)})},r.Z.filter.Comparison=function(t,e){r.Z.filter.Filter.call(this,t),this.propertyName=e},r.Z.inherit(r.Z.filter.Comparison,r.Z.filter.Filter),r.Z.filter.Comparison.prototype.write=function(){var t="";return this.lowerBoundary&&this.upperBoundary&&(t="<{prefix}:LowerBoundary><{prefix}:Literal>{LowerBoundary}</{prefix}:Literal></{prefix}:LowerBoundary><{prefix}:UpperBoundary><{prefix}:Literal>{UpperBoundary}</{prefix}:Literal></{prefix}:UpperBoundary>".format({prefix:this._defaultPrefixNS,LowerBoundary:this.lowerBoundary,UpperBoundary:this.upperBoundary})),this.pattern&&(t="<{prefix}:Literal><![CDATA[{Pattern}]]></{prefix}:Literal>".format({prefix:this._defaultPrefixNS,Pattern:this.pattern})),this.params&&(t=Array.isArray(this.params)?this.params.reduce((function(t,e,n){var r=function(t){return"<{prefix}:Literal><![CDATA[{value}]]></{prefix}:Literal>".format({prefix:this._defaultPrefixNS,value:t})};return(n>0?t:r(t))+r(e)})):"<{prefix}:Literal><![CDATA[{value}]]></{prefix}:Literal>".format({prefix:this._defaultPrefixNS,value:this.params})),"<{prefix}:{tag}{matchCase}{escape}{singleChar}{wildCard}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{values}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),matchCase:void 0!==this.matchCase?' matchCase="'+this.matchCase+'"':"",escape:void 0!==this.escapeChar?" "+this._escapeAttrName+'="'+this.escapeChar+'"':"",singleChar:void 0!==this.singleChar?' singleChar="'+this.singleChar+'"':"",wildCard:void 0!==this.wildCard?' wildCard="'+this.wildCard+'"':"",name:this.propertyName,values:t,fieldTitle:this._fieldTitle})},r.Z.filter.ComparisonBinary=function(t,e,n,o){r.Z.filter.Comparison.call(this,t,e),this.expression=n,this.matchCase=o},r.Z.inherit(r.Z.filter.ComparisonBinary,r.Z.filter.Comparison),r.Z.filter.ComparisonBinary.prototype.write=function(){return("<{prefix}:{tag}{matchCase}>"+(this.propertyName instanceof r.Z.filter.Filter?"{name}":"<{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>")+"<{prefix}:Literal><![CDATA[{value}]]></{prefix}:Literal></{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),matchCase:void 0!==this.matchCase?' matchCase="'+this.matchCase+'"':"",name:this.propertyName instanceof r.Z.filter.Filter?this.propertyName.write():this.propertyName,value:this.expression,fieldTitle:this._fieldTitle})},r.Z.filter.EqualTo=function(t,e,n){r.Z.filter.ComparisonBinary.call(this,"PropertyIsEqualTo",t,e,n)},r.Z.inherit(r.Z.filter.EqualTo,r.Z.filter.ComparisonBinary),r.Z.filter.GreaterThan=function(t,e){r.Z.filter.ComparisonBinary.call(this,"PropertyIsGreaterThan",t,e)},r.Z.inherit(r.Z.filter.GreaterThan,r.Z.filter.ComparisonBinary),r.Z.filter.GreaterThanOrEqualTo=function(t,e){r.Z.filter.ComparisonBinary.call(this,"PropertyIsGreaterThanOrEqualTo",t,e)},r.Z.inherit(r.Z.filter.GreaterThanOrEqualTo,r.Z.filter.ComparisonBinary),r.Z.filter.LessThan=function(t,e){r.Z.filter.ComparisonBinary.call(this,"PropertyIsLessThan",t,e)},r.Z.inherit(r.Z.filter.LessThan,r.Z.filter.ComparisonBinary),r.Z.filter.LessThanOrEqualTo=function(t,e){r.Z.filter.ComparisonBinary.call(this,"PropertyIsLessThanOrEqualTo",t,e)},r.Z.inherit(r.Z.filter.LessThanOrEqualTo,r.Z.filter.ComparisonBinary),r.Z.filter.NotEqualTo=function(t,e,n){r.Z.filter.ComparisonBinary.call(this,"PropertyIsNotEqualTo",t,e,n)},r.Z.inherit(r.Z.filter.NotEqualTo,r.Z.filter.ComparisonBinary),r.Z.filter.IsLike=function(t,e,n,o,i,a){r.Z.filter.Comparison.call(this,"PropertyIsLike",t),this.pattern=e,this.wildCard=void 0!==n?n:"*",this.singleChar=void 0!==o?o:".",this.escapeChar=void 0!==i?i:"!",this.matchCase=a},r.Z.inherit(r.Z.filter.IsLike,r.Z.filter.Comparison),r.Z.filter.IsNull=function(t){r.Z.filter.Comparison.call(this,"PropertyIsNull",t)},r.Z.inherit(r.Z.filter.IsNull,r.Z.filter.Comparison),r.Z.filter.IsBetween=function(t,e,n){r.Z.filter.Comparison.call(this,"PropertyIsBetween",t),this.lowerBoundary=e,this.upperBoundary=n},r.Z.inherit(r.Z.filter.IsBetween,r.Z.filter.Comparison),r.Z.filter.Function=function(t,e){r.Z.filter.Filter.call(this,t),this.params=e},r.Z.inherit(r.Z.filter.Function,r.Z.filter.Filter),r.Z.filter.Function.prototype.write=function(){var t="";if(this.params){var e=function(t,e){if("string"==typeof t)return"<{prefix}:Literal><![CDATA[{value}]]></{prefix}:Literal>".format({prefix:e,value:t});if("object"==typeof t){var n="";for(var r in t)n+="<{prefix}:{key}>{value}</{prefix}:{key}>".format({prefix:e,value:t[r],key:r});return n}};if(Array.isArray(this.params)){var n=this._defaultPrefixNS;t=this.params.reduce((function(t,r,o){var i=function(t){return e(t,n)};return(o>1?t:i(t))+i(r)}))}else t=e(this.params,this._defaultPrefixNS)}return'<{prefix}:Function name="{tag}">{inner}</{prefix}:Function>'.format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:t})},r.Z.filter.Spatial=function(t,e,n,o){r.Z.filter.Filter.call(this,t),this.geometryName=e,this.geometry=n,this.srsName=o,this.wrap=new r.Z.wrap.Filter(this)},r.Z.wrap.Filter=function(t){this.parent=t},r.Z.wrap.Filter.prototype.getAxisOrientation=function(){var t=this.parent.srsName;if(t){const e=t.match(/\d{4,6}$/);if(e){const n=e[0],r=ol.proj.get(t);if(r)return("neu"===r.axisOrientation_?"urn:x-ogc:def:crs:EPSG:":"EPSG:")+n}}return t},r.Z.inherit(r.Z.filter.Spatial,r.Z.filter.Filter),r.Z.filter.Spatial.prototype.write=function(){return(this.geometryName?"<{prefix}:{tag}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{geometry}</{prefix}:{tag}>":"<{prefix}:{tag}><{prefix}:{fieldTitle}/>{geometry}</{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),name:this.geometryName,geometry:this.geometry instanceof r.Z.filter.Function?this.writeInnerCondition_(this.geometry):this.geometry.wrap.toGML(void 0,this.wrap.getAxisOrientation()),fieldTitle:this._fieldTitle})},r.Z.filter.bbox=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new r.Z.filter.Bbox(null,arguments[0],arguments[1]):new r.Z.filter.Bbox(arguments[0],arguments[1],arguments[2])},r.Z.filter.Bbox=function(t,e,n){r.Z.filter.Filter.call(this,"BBOX"),this.geometryName=t,this.extent=e,this.srsName=n},r.Z.inherit(r.Z.filter.Bbox,r.Z.filter.Spatial),r.Z.filter.Bbox.prototype.write=function(){var t="<gml:Envelope{srsName}><gml:lowerCorner>{lowerCorner}</gml:lowerCorner><gml:upperCorner>{upperCorner}</gml:upperCorner></gml:Envelope>".format({srsName:void 0!==this.srsName?' srsName="'+this.srsName+'"':"",lowerCorner:this.extent[0]+" "+this.extent[1],upperCorner:this.extent[2]+" "+this.extent[3]});return(this.geometryName?"<{prefix}:{tag}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{BBOX}</{prefix}:{tag}>":"<{prefix}:{tag}><{prefix}:{fieldTitle}/>{BBOX}</{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),fieldTitle:this._fieldTitle,name:this.geometryName,BBOX:t})},r.Z.filter.Intersects=function(t,e,n){r.Z.filter.Spatial.call(this,"Intersects",t,e,n)},r.Z.inherit(r.Z.filter.Intersects,r.Z.filter.Spatial),r.Z.filter.Within=function(t,e,n){r.Z.filter.Spatial.call(this,"Within",t,e,n)},r.Z.inherit(r.Z.filter.Within,r.Z.filter.Spatial);const o=r.Z.filter,i=o},5798:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});var r=n(5361),o=n(2089);const i={loadResources:function(t,e,n){var a;return t?a=new Promise((function(t,a){r.Z.ajax({url:e+n+".json",method:"GET",responseType:o.Z.mimeType.JSON}).then((function(e){const r=e.data;i[n]=i[n]||{},Object.assign(i[n],r),i.currentLocale=i[n],i.currentLocaleKey=n,t()})).catch((function(t){a(t)}))})):(i.currentLocale=i[n],a=Promise.resolve()),a}},a=i},6947:(t,e,n)=>{"use strict";n.d(e,{Z:()=>v});var r,o=n(5361),i=n(7945),a=n(2530),s=n(2391),l=n(6804),c=n(1327),u=n(6281),p=n(9874),d=n(6236),h=n(9706),f=n(4323),m=n(1299);o.Z.Feature=m.Z,o.Z.feature=o.Z.feature||{},o.Z.feature.Circle=function(t,e){const n=this;o.Z.Feature.apply(n,arguments),n.wrap.isNative(t)||n.wrap.createCircle(t,e)},o.Z.inherit(o.Z.feature.Circle,o.Z.Feature),(r=o.Z.feature.Circle.prototype).STYLETYPE=o.Z.Consts.geom.POLYGON,r.CLASSNAME="TC.feature.Circle",r.getCoords=function(){return this.wrap.getGeometry()},r.setCoords=function(t){const e=this;if(!Array.isArray(t)||!Array.isArray(t[0])||Array.isArray(t[0][0])||Array.isArray(t[0][1])||Array.isArray(t[1]))throw new Error("Coordinates not valid for circle");return o.Z.Feature.prototype.setCoords.call(e,t)};const g=o.Z.feature.Circle;var y;o.Z.Layer=a.Z,o.Z.Util=i.Z,o.Z.layer=o.Z.layer||{},o.Z.feature=o.Z.feature||{},o.Z.feature.Point=s.Z,o.Z.feature.Marker=l.Z,o.Z.feature.Polyline=c.Z,o.Z.feature.Polygon=u.Z,o.Z.feature.MultiPoint=p.Z,o.Z.feature.MultiMarker=d.Z,o.Z.feature.MultiPolyline=h.Z,o.Z.feature.MultiPolygon=f.Z,o.Z.feature.Circle=g,y={},o.Z.layer.Vector=function(){var t=this;t._capabilitiesPromise=null,t.capabilities=null,o.Z.Layer.apply(t,arguments),t.type=t.options.type||o.Z.Consts.layerType.VECTOR,t.features=[],t.selectedFeatures=[];const e=function(t){var e=(t=t||"").indexOf("?");return(e>=0||(e=t.indexOf("#"))>=0)&&(t=t.substr(0,e)),t.substr(t.lastIndexOf(".")).toLowerCase()},n=function(t){switch(t){case o.Z.Consts.mimeType.KML:return o.Z.Consts.format.KML;case o.Z.Consts.mimeType.GPX:return o.Z.Consts.format.GPX;case o.Z.Consts.mimeType.JSON:case o.Z.Consts.mimeType.GEOJSON:return o.Z.Consts.format.GEOJSON;case o.Z.Consts.mimeType.GML:return o.Z.Consts.format.GML;default:return null}},r=e(t.url),i=n(t.options.format)||o.Z.Util.getFormatFromFileExtension(r);if(i||t.type===o.Z.Consts.layerType.KML){i===o.Z.Consts.format.KML&&(t.type=o.Z.Consts.layerType.KML);var a=function(t){for(var e=t=t||"",n=new RegExp("([\\w|\\-|\\.]+\\"+r+")","i"),o=0;o<3;o++){t=decodeURIComponent(t);var i=n.exec(t);if(i.length>1){e=i[1];break}}return e};t.title=t.options.title||a(t.url)}t.wrap=new o.Z.wrap.layer.Vector(t),t.wrap._promise=new Promise(((e,n)=>{var r;r=t.wrap.createVectorLayer(),t.wrap.setLayer(r),e(r)}))},o.Z.inherit(o.Z.layer.Vector,o.Z.Layer),function(){var t=o.Z.layer.Vector.prototype;const e=function(t){let e=0;const n=t.map((t=>t.replace("data:image/svg+xml,",""))).map((t=>decodeURIComponent(t))),r=n.map((t=>parseFloat(t.match(/ width="([\d\.]*)"/)[1]))),o=n.map((t=>parseFloat(t.match(/ height="([\d\.]*)"/)[1]))),i=r.reduce(((t,e)=>t+e+2),0),a=Math.max.apply(Math,o),s=n.map(((t,n)=>{const i=t.replace('<svg xmlns="http://www.w3.org/2000/svg"',`<svg x="${e}" y="${(a-o[n])/2}" `);return e+=r[n]+2,i}));return"data:image/svg+xml,"+encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="${i}" height="${a}">${s.join("")}</svg>`)};t.getTree=function(){const t=this;let n=null;if(!t.options.stealth){if(n={children:[]},t.features.forEach((t=>{const e=t.getPath();if(e.length){const r=o.Z.Util.addArrayToTree(e,n);r&&(r.legend=t.getLegend(),t._visibilityState===o.Z.Consts.visibility.NOT_VISIBLE?Object.prototype.hasOwnProperty.call(r,"visibilityState")||(r.visibilityState=o.Z.Consts.visibility.NOT_VISIBLE):r.visibilityState=o.Z.Consts.visibility.VISIBLE)}})),t.styles||t.cluster){const r=[];t.cluster&&r.push(o.Z.Util.getLegendImageFromStyle(o.Z.Util.extend({},t.cluster.styles.point,{radius:o.Z.Cfg.styles.point.radius+2,offset:[0,6]}),{geometryType:o.Z.Consts.geom.POINT})),t.styles.point&&r.push(o.Z.Util.getLegendImageFromStyle(t.styles.point,{geometryType:o.Z.Consts.geom.POINT})),t.styles.line&&r.push(o.Z.Util.getLegendImageFromStyle(t.styles.line,{geometryType:o.Z.Consts.geom.POLYLINE})),t.styles.polygon&&r.push(o.Z.Util.getLegendImageFromStyle(t.styles.polygon,{geometryType:o.Z.Consts.geom.POLYGON})),n.legend={src:e(r)}}n.name=t.name||n.name,n.customLegend=t.options.customLegend,n.title=t.title||n.title,n.uid=t.id}return n};var n=function(t,e,n,r){return new Promise((function(i,a){e.call(t,[n],r).then((function(e){i(e[0]),t.map&&t.map.trigger(o.Z.Consts.event.FEATUREADD,{layer:t,feature:e[0]})}))}))},r=function(t,e,n,r,i){var a=o.Z.Util.extend(!0,{},i);return new Promise((function(s,l){let c;c=n?o.Z.feature[n]:o.Z.Feature;for(var u=new Array(e.length),p=[],d=0,h=e.length;d<h;d++){var f,m=e[d];const s=o.Z.wrap.Feature.prototype.isNative(m);if(m instanceof c||"TC.feature."+n===m.CLASSNAME)f=m;else if(s&&(f=m._wrap&&m._wrap.parent),!f){a.layer=t;const e=t.styles&&t.styles[r];if(o.Z.Util.hasStyleOptions(a)||!e){const n=o.Z.Util.extend(!0,{},o.Z.Cfg.styles,t.map?t.map.options.styles:null);o.Z.Util.extend(!0,a,n[r],e||{},i)}f=new c(m,a)}f.layer=t,u[d]=f,t.features.push(f),s||p.push(f.wrap.feature),f.options.showPopup&&f.showInfo()}p.length&&t.wrap.addFeatures(p),s(u)}))};t.addPoint=function(t,e){return n(this,this.addPoints,t,e)},t.addPoints=function(t,e){return r(this,t,"Point",o.Z.Consts.geom.POINT,e)},t.addMultiPoint=function(t,e){return n(this,this.addMultiPoints,t,e)},t.addMultiPoints=function(t,e){return r(this,t,"MultiPoint","point",e)},t.addMarker=function(t,e){return n(this,this.addMarkers,t,e)},t.addMarkers=function(t,e){return r(this,t,"Marker","marker",e)},t.addMultiMarker=function(t,e){return n(this,this.addMultiMarkers,t,e)},t.addMultiMarkers=function(t,e){return r(this,t,"MultiMarker","marker",e)},t.addPolyline=function(t,e){return n(this,this.addPolylines,t,e)},t.addPolylines=function(t,e){return r(this,t,"Polyline","line",e)},t.addMultiPolyline=function(t,e){return n(this,this.addMultiPolylines,t,e)},t.addMultiPolylines=function(t,e){return r(this,t,"MultiPolyline","line",e)},t.addPolygon=function(t,e){return n(this,this.addPolygons,t,e)},t.addPolygons=function(t,e){return r(this,t,"Polygon",o.Z.Consts.geom.POLYGON,e)},t.addMultiPolygon=function(t,e){return n(this,this.addMultiPolygons,t,e)},t.addMultiPolygons=function(t,e){return r(this,t,"MultiPolygon",o.Z.Consts.geom.POLYGON,e)},t.addCircle=function(t,e){return n(this,this.addCircles,t,e)},t.addCircles=function(t,e){return r(this,t,"Circle",o.Z.Consts.geom.POLYGON,e)},t.addFeature=function(t){const e=this;var n;return o.Z.feature&&(n=o.Z.feature.Point&&t instanceof o.Z.feature.Point||"TC.feature.Point"===t.CLASSNAME?e.addPoint(t):o.Z.feature.Polyline&&t instanceof o.Z.feature.Polyline||"TC.feature.Polyline"===t.CLASSNAME?e.addPolyline(t):o.Z.feature.Polygon&&t instanceof o.Z.feature.Polygon||"TC.feature.Polygon"===t.CLASSNAME?e.addPolygon(t):o.Z.feature.MultiPolygon&&t instanceof o.Z.feature.MultiPolygon||"TC.feature.MultiPolygon"===t.CLASSNAME?e.addMultiPolygon(t):o.Z.feature.MultiPolyline&&t instanceof o.Z.feature.MultiPolyline||"TC.feature.MultiPolyline"===t.CLASSNAME?e.addMultiPolyline(t):o.Z.feature.Circle&&t instanceof o.Z.feature.Circle||"TC.feature.Circle"===t.CLASSNAME?e.addCircle(t):r(e,[t])),n},t.addFeatures=function(t){return r(this,t)},t.removeFeature=function(t){const e=this;t.layer&&e.features.indexOf(t)>=0&&(e.wrap.removeFeature(t),t.layer=null)},t.getFeatureById=function(t){let e=null;var n=this.wrap.getFeatureById(t);return n&&(e=n._wrap.parent),e},t.clearFeatures=function(){var t=this;t.features&&t.wrap&&(t.map&&t.map.getControlsByClass("TC.control.Popup").forEach((function(e){e.isVisible()&&t.features.indexOf(e.currentFeature)>=0&&e.hide()})),t.features.length=0,t.wrap.clearFeatures())},t.getDescribeFeatureTypeUrl=function(t){const e=this,n=e.options.version||e.capabilities.version||"1.1.0";let r=t||e.featureType;return r=Array.isArray(r)?r:[r],e.url+"?service=WFS&version="+n+"&request=DescribeFeatureType&typename="+r.join(",")+"&outputFormat="+encodeURIComponent(e.capabilities.Operations.DescribeFeatureType.outputFormat)},t.describeFeatureType=function(t,e,n){const r=this;t||(t=r.options.featureType);const i=new Promise((function(e,n){r.getCapabilitiesPromise().then((function(i){if(i.Operations.DescribeFeatureType)if(Object.prototype.hasOwnProperty.call(window,"Worker")){const i=async function(){var t=o.Z.apiLocation+"TC/workers/tc-dft-web-worker.js";if(o.Z.Util.isSameOrigin(o.Z.apiLocation))return t;{const n=(await o.Z.ajax({url:t,method:"GET",responseType:"text"})).data;var e=new Blob([n],{type:"text/javascript"});return window.URL.createObjectURL(e)}},s=async function(){r.WebWorkerDFT||(r.WebWorkerDFT=new Worker(await i())),r.WebWorkerDFT.onmessage=async function(t){if(t.data instanceof Object){if("success"!==t.data.state)throw"Ha habido problemas procesando el Describe feature type";{let e=Object.keys(t.data.DFTCollection).join(",");if(!o.Z.describeFeatureType[e])throw"No se encuentra la clave "+e+" en la colección";"function"==typeof o.Z.describeFeatureType[e]&&o.Z.describeFeatureType[e].call(null,t.data.DFTCollection),o.Z.describeFeatureType=Object.assign(o.Z.describeFeatureType,t.data.DFTCollection)}}else{var e=await r.toolProxification.fetchXML(t.data);r.WebWorkerDFT.postMessage({url:t.data,response:e.documentElement.outerHTML})}}},l=async function(t,e){var n=await r.toolProxification.fetchXML(r.getDescribeFeatureTypeUrl(t||r.featureType));if(n.querySelector("Exception")||n.querySelector("exception"))throw(n.querySelector("Exception")||n.querySelector("exception")).textContent.trim();r.WebWorkerDFT.postMessage({layerName:t,xml:n.documentElement.outerHTML,url:o.Z.apiLocation.indexOf("http")>=0?o.Z.apiLocation:document.location.protocol+o.Z.apiLocation}),o.Z.describeFeatureType[t instanceof Array?t.join(","):t]=e};try{s()}catch(t){n(t)}t instanceof Array||(t=t.split(","));var a=Object.entries(t.reduce((function(t,e){let n=e.substring(0,e.indexOf(":"));if(t[n])return t[n].push(e),t;{let r={};return r[n]=[e],Object.assign(t,r)}}),{})).map((function(t){var e=t[1];return new Promise((async function(t,n){if(o.Z.describeFeatureType[e])t(function(t,e){return t instanceof Array||(t=t.split(",")),t.reduce((function(t,n){var r=[];return r[n]=e[n],Object.assign(t,r)}),{})}(e,o.Z.describeFeatureType));else try{await l(e,(function(e){t(e)}))}catch(t){n(t)}}))}));Promise.all(a).then((function(t){let n=t.reduce((function(t,e){return Object.assign(t,e)}),{});e(1===Object.keys(n).length?n[Object.keys(n)[0]]:n)})).catch(n)}else n("No esta disponible el WebWorker");else n("No esta disponible el método describeFeatureType")})).catch((t=>n(t)))}));return i.then((function(t){o.Z.Util.isFunction(e)&&e(t)}),(function(t){o.Z.Util.isFunction(n)&&n(t)})),i},t.import=function(t){this.wrap.import(t)};var i={};t.setNodeVisibility=function(t,e){const n=this;n.state=o.Z.Layer.state.LOADING,n.map.trigger(o.Z.Consts.event.BEFOREUPDATE),n.map.trigger(o.Z.Consts.event.BEFORELAYERUPDATE,{layer:n});const r=o.Z.Layer.prototype.setNodeVisibility.call(n,t,e);if(r.parent){i[t]=e?o.Z.Consts.visibility.VISIBLE:o.Z.Consts.visibility.NOT_VISIBLE,r.children.forEach((t=>{n.setNodeVisibility(t.uid,e)})),r.parent&&(i[r.parent.uid]===o.Z.Consts.visibility.NOT_VISIBLE&&r.parent.children.length>0&&r.parent.children.every((t=>void 0===i[t.uid]||i[t.uid]!==o.Z.Consts.visibility.NOT_VISIBLE))&&n.setNodeVisibility(r.parent.uid,!0),i[r.parent.uid]!==o.Z.Consts.visibility.NOT_VISIBLE&&r.parent.children.length>0&&r.parent.children.every((t=>i[t.uid]===o.Z.Consts.visibility.NOT_VISIBLE))&&n.setNodeVisibility(r.parent.uid,!1));var a,s,l=!1;for(a=0;a<n.features.length;a++)if((s=n.features[a]).id==t){l=!0,s.setVisibility(e);break}if(!l)for(a=0;a<n.features.length;a++)void 0===(s=n.features[a])._path&&(s._path="/"+s.getPath().join("/")),(s._path===t||s._path.startsWith(t))&&s.setVisibility(e)}else n.setVisibility(e);return n.state=o.Z.Layer.state.IDLE,n.map.trigger(o.Z.Consts.event.LAYERUPDATE,{layer:n}),n.map.trigger(o.Z.Consts.event.UPDATE),r},t.getNodeVisibility=function(t){var e=this,n=o.Z.Layer.prototype.getNodeVisibility.call(e,t);e.tree||(e.tree=e.getTree());var r=e.findNode(t,e.tree);if(r){if(r===e.tree)n=e.getVisibility()?o.Z.Consts.visibility.VISIBLE:o.Z.Consts.visibility.NOT_VISIBLE;else{var a=i[t];if(void 0!==a)n=a,Object.entries(i).some((e=>e[0]!==t&&e[0].startsWith(t)&&e[1]!==n))&&(n=o.Z.Consts.visibility.HAS_VISIBLE);else{const e=Object.entries(i).some((e=>e[0]!==t&&e[0].startsWith(t)&&!e[1])),a=r.children.length>0&&r.children.every((t=>void 0!==i[t.uid]&&i[t.uid]===o.Z.Consts.visibility.NOT_VISIBLE));n=a?o.Z.Consts.visibility.NOT_VISIBLE:e?o.Z.Consts.visibility.HAS_VISIBLE:o.Z.Consts.visibility.VISIBLE}}return n}},t.setModifiable=function(t){this.wrap.setModifiable(t)},t.applyEdits=function(t,e,n){return this.wrap.sendTransaction(t,e,n)},t.refresh=function(){return this.clearFeatures(),this.wrap.reloadSource()},t.getFeaturesInCurrentExtent=function(t){var e=this.map.getExtent();return this.getFeaturesInExtent(e,t)},t.getFeaturesInExtent=function(t,e){return this.wrap.getFeaturesInExtent(t,e)},t.setProjection=function(t){const e=this;e.wrap.setProjection(t),t.crs&&t.oldCrs&&(e.map.trigger(o.Z.Consts.event.BEFORELAYERUPDATE,{layer:e}),e.features.forEach((function(e){e.wrap.setGeometry(o.Z.Util.reproject(e.geometry,t.oldCrs,t.crs)),e.geometry=e.wrap.getGeometry()})),e.map.trigger(o.Z.Consts.event.LAYERUPDATE,{layer:e}))},t.setStyles=function(t){this.styles=o.Z.Util.extend({},t),this.wrap.setStyles(t)};const a=function(t,e,n=!0){const r=function(t,e,n){return n?t!==e:t===e};for(let o in e){const i=e[o];if(Array.isArray(i)){let e=t[o];e=e?Array.isArray(e)?e:[e]:[],Object.prototype.hasOwnProperty.call(t,o)&&r(i.join(),e.join(),n)&&delete t[o]}else"object"==typeof i?t[o]=a(t[o],i):Object.prototype.hasOwnProperty.call(t,o)&&r(i,t[o],n)&&delete t[o]}return t};t.exportState=function(t){const e=this;t=t||{};const n={id:e.id};e.map&&e.map.crs!==e.map.options.crs&&(n.crs=e.map.crs);var r=Math.pow(10,(e.map.wrap.isGeo()?o.Z.Consts.DEGREE_PRECISION:o.Z.Consts.METER_PRECISION)+1);let i=null;const s=t.features||e.features;return n.features=s.map((function(n){let s={};var l;switch(!0){case o.Z.feature.Marker&&n instanceof o.Z.feature.Marker:s.type=o.Z.Consts.geom.POINT,l=e.options.styles&&e.options.styles.marker;break;case o.Z.feature.Point&&n instanceof o.Z.feature.Point:s.type=o.Z.Consts.geom.POINT,l=e.options.styles&&e.options.styles.point;break;case o.Z.feature.MultiPoint&&n instanceof o.Z.feature.MultiPoint:s.type=o.Z.Consts.geom.MULTIPOINT;break;case o.Z.feature.Polyline&&n instanceof o.Z.feature.Polyline:s.type=o.Z.Consts.geom.POLYLINE,l=e.options.styles&&e.options.styles.line;break;case o.Z.feature.MultiPolyline&&n instanceof o.Z.feature.MultiPolyline:s.type=o.Z.Consts.geom.MULTIPOLYLINE,l=e.options.styles&&e.options.styles.line;break;case o.Z.feature.Polygon&&n instanceof o.Z.feature.Polygon:s.type=o.Z.Consts.geom.POLYGON,l=e.options.styles&&e.options.styles.polygon;break;case o.Z.feature.MultiPolygon&&n instanceof o.Z.feature.MultiPolygon:s.type=o.Z.Consts.geom.MULTIPOLYGON,l=e.options.styles&&e.options.styles.polygon;break;case o.Z.feature.Circle&&n instanceof o.Z.feature.Circle:s.type=o.Z.Consts.geom.CIRCLE,l=e.options.styles&&e.options.styles.polygon}if(s.id=n.id,s.geom=o.Z.Util.compactGeometry(n.geometry,r),s.data=n.getData(),s.showsPopup=n.showsPopup,void 0===t.exportStyles||t.exportStyles){for(var c in l=o.Z.Util.extend({},l)){var u=l[c];o.Z.Util.isFunction(u)&&(l[c]=u(n))}s.style=o.Z.Util.extend(l,n.getStyle()),i=i?a(i,s.style):Object.assign({},s.style)}return s})),!t.features&&i&&Object.keys(i).length&&(n.features.forEach((function(t){t.style=a(t.style,i,!1)})),n.style=i),n},t.importState=function(t){const e=this;return new Promise((function(n,r){const i=new Array(t.features.length);t.features.forEach((function(n,r){let a=o.Z.Util.extend(t.style||{},n.style);const s=o.Z.Util.extend(a,{data:n.data,id:n.id,showsPopup:n.showsPopup});var l;switch(n.type){case o.Z.Consts.geom.POLYGON:l=e.addPolygon;break;case o.Z.Consts.geom.MULTIPOLYGON:l=e.addMultiPolygon;break;case o.Z.Consts.geom.POLYLINE:l=e.addPolyline;break;case o.Z.Consts.geom.MULTIPOLYLINE:l=e.addMultiPolyline;break;case o.Z.Consts.geom.CIRCLE:l=e.addCircle;break;case o.Z.Consts.geom.MULTIPOINT:l=n.style&&(n.style.url||n.style.className)?e.addMultiMarker:e.addMultiPoint;break;case o.Z.Consts.geom.POINT:l=a&&(a.url||a.className)?e.addMarker:e.addPoint}if(l){var c=o.Z.Util.explodeGeometry(n.geom);t.crs&&e.map.crs!==t.crs?i[r]=new Promise((function(t,n){e.map.one(o.Z.Consts.event.PROJECTIONCHANGE,(function(r){l.call(e,c,s).then((function(){t()}),(function(){n(Error("addFn failed"))}))}))})):i[r]=l.call(e,c,s)}})),Promise.all(i).then((function(){n()}),(function(t){r(t instanceof Error?t:Error(t))}))}))},t.clone=function(){const t=o.Z.Layer.prototype.clone.call(this);return this.features.forEach((e=>t.addFeature(e.clone()))),t},t.getGetCapabilitiesUrl=function(){const t=this;if(t.type===o.Z.Consts.layerType.WFS){const n=()=>t.options.url||t.url;var e={SERVICE:"WFS",VERSION:"2.0.0",REQUEST:"GetCapabilities"};return(!o.Z.Util.isSecureURL(n())&&o.Z.Util.isSecureURL(o.Z.Util.toAbsolutePath(n()))?t.getBySSL_(n()):n())+"?"+o.Z.Util.getParamString(e)}return null},t.getCapabilitiesPromise=function(){const t=this;return t.type===o.Z.Consts.layerType.WFS?new Promise(((e,n)=>{var r=(t.options.url||t.url).replace(/https ?:/gi,"");t.capabilities&&(e(t.capabilities),t._capabilitiesPromise=Promise.resolve(t.capabilities)),o.Z.capabilitiesWFS[r]&&(e(o.Z.capabilitiesWFS[r]),t._capabilitiesPromise=Promise.resolve(o.Z.capabilitiesWFS[r])),t.toolProxification=new o.Z.tool.Proxification(o.Z.proxify);const i=y[r];y[r]=t._capabilitiesPromise=i||new Promise((function(e,n){const r=t.getCapabilitiesOnline(),o=t.getCapabilitiesFromStorage();r.then((function(t){e(t)})).catch((function(t){o.catch((function(){n(t)}))})),o.then((function(t){e(t)})).catch((function(){r.catch((function(t){n(t)}))}))})),y[r].then((function(n){!function(n){t.capabilities=t.capabilities||n,o.Z.capabilitiesWFS[t.options.url||t.url]=o.Z.capabilitiesWFS[t.options.url||t.url]||n,o.Z.capabilitiesWFS[r]=o.Z.capabilitiesWFS[r]||n,e(n)}(n)})).catch((function(e){t.map&&t.map.trigger(o.Z.Consts.event.LAYERERROR,{layer:t,reason:"couldNotGetCapabilities"}),n(e)}))})):Promise.reject(new Error(`Layer "${t.id}" does not have capabilities document`))}}();const v=o.Z.layer.Vector},9464:(t,e,n)=>{"use strict";function r(){return function(){throw new Error("Unimplemented abstract method.")}()}n.d(e,{Z:()=>Hb});var o=0;function i(t){return t.ol_uid||(t.ol_uid=String(++o))}var a="6.13.0";const s=function(){function t(){this.disposed=!1}return t.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposeInternal())},t.prototype.disposeInternal=function(){},t}();function l(t,e){return t>e?1:t<e?-1:0}function c(t,e){return t.indexOf(e)>=0}function u(t,e,n){var r=t.length;if(t[0]<=e)return 0;if(e<=t[r-1])return r-1;var o=void 0;if(n>0){for(o=1;o<r;++o)if(t[o]<e)return o-1}else if(n<0){for(o=1;o<r;++o)if(t[o]<=e)return o}else for(o=1;o<r;++o){if(t[o]==e)return o;if(t[o]<e)return"function"==typeof n?n(e,t[o-1],t[o])>0?o-1:o:t[o-1]-e<e-t[o]?o-1:o}return r-1}function p(t,e,n){for(;e<n;){var r=t[e];t[e]=t[n],t[n]=r,++e,--n}}function d(t,e){for(var n=Array.isArray(e)?e:[e],r=n.length,o=0;o<r;o++)t[t.length]=n[o]}function h(t,e){for(var n,r=t.length>>>0,o=0;o<r;o++)if(e(n=t[o],o,t))return n;return null}function f(t,e){var n=t.length;if(n!==e.length)return!1;for(var r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}function m(t,e){var n;return!t.every((function(r,o){return n=o,!e(r,o,t)}))?n:-1}function g(){return!0}function y(){return!1}function v(){}var _,C="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"",E=-1!==C.indexOf("firefox"),w=(-1!==C.indexOf("safari")&&C.indexOf("chrom"),-1!==C.indexOf("webkit")&&-1==C.indexOf("edge")),S=-1!==C.indexOf("macintosh"),b="undefined"!=typeof devicePixelRatio?devicePixelRatio:1,L="undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&self instanceof WorkerGlobalScope,T="undefined"!=typeof Image&&Image.prototype.decode,P=function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch(t){}return t}(),A=(_=function(t,e){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},_(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}_(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});const O=function(t){function e(e){var n=this,r="Assertion failed. See https://openlayers.org/en/"+("v"+a.split("-")[0])+"/doc/errors/#"+e+" for details.";return(n=t.call(this,r)||this).code=e,n.name="AssertionError",n.message=r,n}return A(e,t),e}(Error);function x(t,e){if(!t)throw new O(e)}var I,M=new Array(6);function R(t){return D(t,1,0,0,1,0,0)}function Z(t,e){var n=t[0],r=t[1],o=t[2],i=t[3],a=t[4],s=t[5],l=e[0],c=e[1],u=e[2],p=e[3],d=e[4],h=e[5];return t[0]=n*l+o*c,t[1]=r*l+i*c,t[2]=n*u+o*p,t[3]=r*u+i*p,t[4]=n*d+o*h+a,t[5]=r*d+i*h+s,t}function D(t,e,n,r,o,i,a){return t[0]=e,t[1]=n,t[2]=r,t[3]=o,t[4]=i,t[5]=a,t}function k(t,e){var n=e[0],r=e[1];return e[0]=t[0]*n+t[2]*r+t[4],e[1]=t[1]*n+t[3]*r+t[5],e}function N(t,e,n){return Z(t,D(M,e,0,0,n,0,0))}function F(t,e,n,r,o,i,a,s){var l=Math.sin(i),c=Math.cos(i);return t[0]=r*c,t[1]=o*l,t[2]=-r*l,t[3]=o*c,t[4]=a*r*c-s*r*l+e,t[5]=a*o*l+s*o*c+n,t}function U(t,e){var n,r=(n=e)[0]*n[3]-n[1]*n[2];x(0!==r,32);var o=e[0],i=e[1],a=e[2],s=e[3],l=e[4],c=e[5];return t[0]=s/r,t[1]=-i/r,t[2]=-a/r,t[3]=o/r,t[4]=(a*c-s*l)/r,t[5]=-(o*c-i*l)/r,t}function G(t){var e="matrix("+t.join(", ")+")";if(L)return e;var n=I||(I=document.createElement("div"));return n.style.transform=e,n.style.transform}const B="bottom-left",j="bottom-right",W="top-left",q="top-right",H=0,V=1,z=2,Y=4,K=8,X=16;function $(t){for(var e=it(),n=0,r=t.length;n<r;++n)dt(e,t[n]);return e}function J(t,e,n){return n?(n[0]=t[0]-e,n[1]=t[1]-e,n[2]=t[2]+e,n[3]=t[3]+e,n):[t[0]-e,t[1]-e,t[2]+e,t[3]+e]}function Q(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t.slice()}function tt(t,e,n){var r,o;return(r=e<t[0]?t[0]-e:t[2]<e?e-t[2]:0)*r+(o=n<t[1]?t[1]-n:t[3]<n?n-t[3]:0)*o}function et(t,e){return rt(t,e[0],e[1])}function nt(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]}function rt(t,e,n){return t[0]<=e&&e<=t[2]&&t[1]<=n&&n<=t[3]}function ot(t,e){var n=t[0],r=t[1],o=t[2],i=t[3],a=e[0],s=e[1],l=H;return a<n?l|=X:a>o&&(l|=Y),s<r?l|=K:s>i&&(l|=z),l===H&&(l=V),l}function it(){return[1/0,1/0,-1/0,-1/0]}function at(t,e,n,r,o){return o?(o[0]=t,o[1]=e,o[2]=n,o[3]=r,o):[t,e,n,r]}function st(t){return at(1/0,1/0,-1/0,-1/0,t)}function lt(t,e){var n=t[0],r=t[1];return at(n,r,n,r,e)}function ct(t,e,n,r,o){return ht(st(o),t,e,n,r)}function ut(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]}function pt(t,e){return e[0]<t[0]&&(t[0]=e[0]),e[2]>t[2]&&(t[2]=e[2]),e[1]<t[1]&&(t[1]=e[1]),e[3]>t[3]&&(t[3]=e[3]),t}function dt(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function ht(t,e,n,r,o){for(;n<r;n+=o)ft(t,e[n],e[n+1]);return t}function ft(t,e,n){t[0]=Math.min(t[0],e),t[1]=Math.min(t[1],n),t[2]=Math.max(t[2],e),t[3]=Math.max(t[3],n)}function mt(t,e){var n;return(n=e(yt(t)))||(n=e(vt(t)))||(n=e(Lt(t)))?n:(n=e(bt(t)))||!1}function gt(t){var e=0;return At(t)||(e=Tt(t)*wt(t)),e}function yt(t){return[t[0],t[1]]}function vt(t){return[t[2],t[1]]}function _t(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function Ct(t,e){var n;return e===B?n=yt(t):e===j?n=vt(t):e===W?n=bt(t):e===q?n=Lt(t):x(!1,13),n}function Et(t,e,n,r,o){var i=e*r[0]/2,a=e*r[1]/2,s=Math.cos(n),l=Math.sin(n),c=i*s,u=i*l,p=a*s,d=a*l,h=t[0],f=t[1],m=h-c+d,g=h-c-d,y=h+c-d,v=h+c+d,_=f-u-p,C=f-u+p,E=f+u+p,w=f+u-p;return at(Math.min(m,g,y,v),Math.min(_,C,E,w),Math.max(m,g,y,v),Math.max(_,C,E,w),o)}function wt(t){return t[3]-t[1]}function St(t,e,n){var r=n||[1/0,1/0,-1/0,-1/0];return Pt(t,e)?(t[0]>e[0]?r[0]=t[0]:r[0]=e[0],t[1]>e[1]?r[1]=t[1]:r[1]=e[1],t[2]<e[2]?r[2]=t[2]:r[2]=e[2],t[3]<e[3]?r[3]=t[3]:r[3]=e[3]):st(r),r}function bt(t){return[t[0],t[3]]}function Lt(t){return[t[2],t[3]]}function Tt(t){return t[2]-t[0]}function Pt(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}function At(t){return t[2]<t[0]||t[3]<t[1]}function Ot(t,e){var n=(t[2]-t[0])/2*(e-1),r=(t[3]-t[1])/2*(e-1);t[0]-=n,t[2]+=n,t[1]-=r,t[3]+=r}function xt(t,e,n,r){var o=[];if(r>1)for(var i=t[2]-t[0],a=t[3]-t[1],s=0;s<r;++s)o.push(t[0]+i*s/r,t[1],t[2],t[1]+a*s/r,t[2]-i*s/r,t[3],t[0],t[3]-a*s/r);else o=[t[0],t[1],t[2],t[1],t[2],t[3],t[0],t[3]];e(o,o,2);for(var l=[],c=[],u=(s=0,o.length);s<u;s+=2)l.push(o[s]),c.push(o[s+1]);return function(t,e,n){return at(Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e),n)}(l,c,n)}function It(t,e,n){return Math.min(Math.max(t,e),n)}var Mt=function(){var t;return t="cosh"in Math?Math.cosh:function(t){var e=Math.exp(t);return(e+1/e)/2},t}(),Rt=function(){var t;return t="log2"in Math?Math.log2:function(t){return Math.log(t)*Math.LOG2E},t}();function Zt(t,e,n,r,o,i){var a=o-n,s=i-r;if(0!==a||0!==s){var l=((t-n)*a+(e-r)*s)/(a*a+s*s);l>1?(n=o,r=i):l>0&&(n+=a*l,r+=s*l)}return Dt(t,e,n,r)}function Dt(t,e,n,r){var o=n-t,i=r-e;return o*o+i*i}function kt(t){return t*Math.PI/180}function Nt(t,e){var n=t%e;return n*e<0?n+e:n}function Ft(t,e,n){return t+n*(e-t)}function Ut(t,e){var n=Math.pow(10,e);return Math.round(t*n)/n}function Gt(t,e){return Math.round(Ut(t,e))}function Bt(t,e){return Math.floor(Ut(t,e))}function jt(t,e){return Math.ceil(Ut(t,e))}var Wt=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,qt=/^([a-z]*)$|^hsla?\(.*\)$/i;function Ht(t){return"string"==typeof t?t:Xt(t)}function Vt(t){var e=document.createElement("div");if(e.style.color=t,""!==e.style.color){document.body.appendChild(e);var n=getComputedStyle(e).color;return document.body.removeChild(e),n}return""}var zt=function(){var t={},e=0;return function(n){var r;if(t.hasOwnProperty(n))r=t[n];else{if(e>=1024){var o=0;for(var i in t)0==(3&o++)&&(delete t[i],--e)}r=function(t){var e,n,r,o,i;qt.exec(t)&&(t=Vt(t));if(Wt.exec(t)){var a=t.length-1,s=void 0;s=a<=4?1:2;var l=4===a||8===a;e=parseInt(t.substr(1+0*s,s),16),n=parseInt(t.substr(1+1*s,s),16),r=parseInt(t.substr(1+2*s,s),16),o=l?parseInt(t.substr(1+3*s,s),16):255,1==s&&(e=(e<<4)+e,n=(n<<4)+n,r=(r<<4)+r,l&&(o=(o<<4)+o)),i=[e,n,r,o/255]}else 0==t.indexOf("rgba(")?Kt(i=t.slice(5,-1).split(",").map(Number)):0==t.indexOf("rgb(")?((i=t.slice(4,-1).split(",").map(Number)).push(1),Kt(i)):x(!1,14);return i}(n),t[n]=r,++e}return r}}();function Yt(t){return Array.isArray(t)?t:zt(t)}function Kt(t){return t[0]=It(t[0]+.5|0,0,255),t[1]=It(t[1]+.5|0,0,255),t[2]=It(t[2]+.5|0,0,255),t[3]=It(t[3],0,1),t}function Xt(t){var e=t[0];e!=(0|e)&&(e=e+.5|0);var n=t[1];n!=(0|n)&&(n=n+.5|0);var r=t[2];return r!=(0|r)&&(r=r+.5|0),"rgba("+e+","+n+","+r+","+(void 0===t[3]?1:Math.round(100*t[3])/100)+")"}var $t=function(){function t(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}return t.prototype.clear=function(){this.cache_={},this.cacheSize_=0},t.prototype.canExpireCache=function(){return this.cacheSize_>this.maxCacheSize_},t.prototype.expire=function(){if(this.canExpireCache()){var t=0;for(var e in this.cache_){var n=this.cache_[e];0!=(3&t++)||n.hasListener()||(delete this.cache_[e],--this.cacheSize_)}}},t.prototype.get=function(t,e,n){var r=Jt(t,e,n);return r in this.cache_?this.cache_[r]:null},t.prototype.set=function(t,e,n,r){var o=Jt(t,e,n);this.cache_[o]=r,++this.cacheSize_},t.prototype.setSize=function(t){this.maxCacheSize_=t,this.expire()},t}();function Jt(t,e,n){return e+":"+t+":"+(n?Ht(n):"null")}var Qt=new $t,te=function(){function t(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}return t.prototype.preventDefault=function(){this.defaultPrevented=!0},t.prototype.stopPropagation=function(){this.propagationStopped=!0},t}();function ee(t){t.stopPropagation()}const ne=te,re="propertychange";var oe="function"==typeof Object.assign?Object.assign:function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),r=1,o=arguments.length;r<o;++r){var i=arguments[r];if(null!=i)for(var a in i)i.hasOwnProperty(a)&&(n[a]=i[a])}return n};function ie(t){for(var e in t)delete t[e]}var ae="function"==typeof Object.values?Object.values:function(t){var e=[];for(var n in t)e.push(t[n]);return e};function se(t){var e;for(e in t)return!1;return!e}var le=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ce=function(t){function e(e){var n=t.call(this)||this;return n.eventTarget_=e,n.pendingRemovals_=null,n.dispatching_=null,n.listeners_=null,n}return le(e,t),e.prototype.addEventListener=function(t,e){if(t&&e){var n=this.listeners_||(this.listeners_={}),r=n[t]||(n[t]=[]);-1===r.indexOf(e)&&r.push(e)}},e.prototype.dispatchEvent=function(t){var e="string"==typeof t,n=e?t:t.type,r=this.listeners_&&this.listeners_[n];if(r){var o=e?new ne(t):t;o.target||(o.target=this.eventTarget_||this);var i,a=this.dispatching_||(this.dispatching_={}),s=this.pendingRemovals_||(this.pendingRemovals_={});n in a||(a[n]=0,s[n]=0),++a[n];for(var l=0,c=r.length;l<c;++l)if(!1===(i="handleEvent"in r[l]?r[l].handleEvent(o):r[l].call(this,o))||o.propagationStopped){i=!1;break}if(0==--a[n]){var u=s[n];for(delete s[n];u--;)this.removeEventListener(n,v);delete a[n]}return i}},e.prototype.disposeInternal=function(){this.listeners_&&ie(this.listeners_)},e.prototype.getListeners=function(t){return this.listeners_&&this.listeners_[t]||void 0},e.prototype.hasListener=function(t){return!!this.listeners_&&(t?t in this.listeners_:Object.keys(this.listeners_).length>0)},e.prototype.removeEventListener=function(t,e){var n=this.listeners_&&this.listeners_[t];if(n){var r=n.indexOf(e);-1!==r&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[r]=v,++this.pendingRemovals_[t]):(n.splice(r,1),0===n.length&&delete this.listeners_[t]))}},e}(s);const ue=ce,pe={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function de(t,e,n,r,o){if(r&&r!==t&&(n=n.bind(r)),o){var i=n;n=function(){t.removeEventListener(e,n),i.apply(this,arguments)}}var a={target:t,type:e,listener:n};return t.addEventListener(e,n),a}function he(t,e,n,r){return de(t,e,n,r,!0)}function fe(t){t&&t.target&&(t.target.removeEventListener(t.type,t.listener),ie(t))}var me=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ge=function(t){function e(){var e=t.call(this)||this;return e.on=e.onInternal,e.once=e.onceInternal,e.un=e.unInternal,e.revision_=0,e}return me(e,t),e.prototype.changed=function(){++this.revision_,this.dispatchEvent(pe.CHANGE)},e.prototype.getRevision=function(){return this.revision_},e.prototype.onInternal=function(t,e){if(Array.isArray(t)){for(var n=t.length,r=new Array(n),o=0;o<n;++o)r[o]=de(this,t[o],e);return r}return de(this,t,e)},e.prototype.onceInternal=function(t,e){var n;if(Array.isArray(t)){var r=t.length;n=new Array(r);for(var o=0;o<r;++o)n[o]=he(this,t[o],e)}else n=he(this,t,e);return e.ol_key=n,n},e.prototype.unInternal=function(t,e){var n=e.ol_key;if(n)ye(n);else if(Array.isArray(t))for(var r=0,o=t.length;r<o;++r)this.removeEventListener(t[r],e);else this.removeEventListener(t,e)},e}(ue);function ye(t){if(Array.isArray(t))for(var e=0,n=t.length;e<n;++e)fe(t[e]);else fe(t)}ge.prototype.on,ge.prototype.once,ge.prototype.un;const ve=ge;var _e=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ce=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.key=n,o.oldValue=r,o}return _e(e,t),e}(ne);const Ee=function(t){function e(e){var n=t.call(this)||this;return n.on,n.once,n.un,i(n),n.values_=null,void 0!==e&&n.setProperties(e),n}return _e(e,t),e.prototype.get=function(t){var e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e},e.prototype.getKeys=function(){return this.values_&&Object.keys(this.values_)||[]},e.prototype.getProperties=function(){return this.values_&&oe({},this.values_)||{}},e.prototype.hasProperties=function(){return!!this.values_},e.prototype.notify=function(t,e){var n;n="change:".concat(t),this.hasListener(n)&&this.dispatchEvent(new Ce(n,t,e)),n=re,this.hasListener(n)&&this.dispatchEvent(new Ce(n,t,e))},e.prototype.addChangeListener=function(t,e){this.addEventListener("change:".concat(t),e)},e.prototype.removeChangeListener=function(t,e){this.removeEventListener("change:".concat(t),e)},e.prototype.set=function(t,e,n){var r=this.values_||(this.values_={});if(n)r[t]=e;else{var o=r[t];r[t]=e,o!==e&&this.notify(t,o)}},e.prototype.setProperties=function(t,e){for(var n in t)this.set(n,t[n],e)},e.prototype.applyProperties=function(t){t.values_&&oe(this.values_||(this.values_={}),t.values_)},e.prototype.unset=function(t,e){if(this.values_&&t in this.values_){var n=this.values_[t];delete this.values_[t],se(this.values_)&&(this.values_=null),e||this.notify(t,n)}},e}(ve),we="opacity",Se="visible",be="extent",Le="zIndex",Te="maxResolution",Pe="minResolution",Ae="maxZoom",Oe="minZoom",xe="source",Ie="map";var Me=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const Re=function(t){function e(e){var n=t.call(this)||this;n.on,n.once,n.un,n.background_=e.background;var r=oe({},e);return"object"==typeof e.properties&&(delete r.properties,oe(r,e.properties)),r[we]=void 0!==e.opacity?e.opacity:1,x("number"==typeof r[we],64),r[Se]=void 0===e.visible||e.visible,r[Le]=e.zIndex,r[Te]=void 0!==e.maxResolution?e.maxResolution:1/0,r[Pe]=void 0!==e.minResolution?e.minResolution:0,r[Oe]=void 0!==e.minZoom?e.minZoom:-1/0,r[Ae]=void 0!==e.maxZoom?e.maxZoom:1/0,n.className_=void 0!==r.className?r.className:"ol-layer",delete r.className,n.setProperties(r),n.state_=null,n}return Me(e,t),e.prototype.getBackground=function(){return this.background_},e.prototype.getClassName=function(){return this.className_},e.prototype.getLayerState=function(t){var e=this.state_||{layer:this,managed:void 0===t||t},n=this.getZIndex();return e.opacity=It(Math.round(100*this.getOpacity())/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=void 0!==n||e.managed?n:1/0,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e},e.prototype.getLayersArray=function(t){return r()},e.prototype.getLayerStatesArray=function(t){return r()},e.prototype.getExtent=function(){return this.get(be)},e.prototype.getMaxResolution=function(){return this.get(Te)},e.prototype.getMinResolution=function(){return this.get(Pe)},e.prototype.getMinZoom=function(){return this.get(Oe)},e.prototype.getMaxZoom=function(){return this.get(Ae)},e.prototype.getOpacity=function(){return this.get(we)},e.prototype.getSourceState=function(){return r()},e.prototype.getVisible=function(){return this.get(Se)},e.prototype.getZIndex=function(){return this.get(Le)},e.prototype.setBackground=function(t){this.background_=t,this.changed()},e.prototype.setExtent=function(t){this.set(be,t)},e.prototype.setMaxResolution=function(t){this.set(Te,t)},e.prototype.setMinResolution=function(t){this.set(Pe,t)},e.prototype.setMaxZoom=function(t){this.set(Ae,t)},e.prototype.setMinZoom=function(t){this.set(Oe,t)},e.prototype.setOpacity=function(t){x("number"==typeof t,64),this.set(we,t)},e.prototype.setVisible=function(t){this.set(Se,t)},e.prototype.setZIndex=function(t){this.set(Le,t)},e.prototype.disposeInternal=function(){this.state_&&(this.state_.layer=null,this.state_=null),t.prototype.disposeInternal.call(this)},e}(Ee),Ze={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},De="undefined",ke="ready";var Ne=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function Fe(t,e){if(!t.visible)return!1;var n=e.resolution;if(n<t.minResolution||n>=t.maxResolution)return!1;var r=e.zoom;return r>t.minZoom&&r<=t.maxZoom}const Ue=function(t){function e(e){var n=this,r=oe({},e);delete r.source,(n=t.call(this,r)||this).on,n.once,n.un,n.mapPrecomposeKey_=null,n.mapRenderKey_=null,n.sourceChangeKey_=null,n.renderer_=null,n.rendered=!1,e.render&&(n.render=e.render),e.map&&n.setMap(e.map),n.addChangeListener(xe,n.handleSourcePropertyChange_);var o=e.source?e.source:null;return n.setSource(o),n}return Ne(e,t),e.prototype.getLayersArray=function(t){var e=t||[];return e.push(this),e},e.prototype.getLayerStatesArray=function(t){var e=t||[];return e.push(this.getLayerState()),e},e.prototype.getSource=function(){return this.get(xe)||null},e.prototype.getRenderSource=function(){return this.getSource()},e.prototype.getSourceState=function(){var t=this.getSource();return t?t.getState():De},e.prototype.handleSourceChange_=function(){this.changed()},e.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(fe(this.sourceChangeKey_),this.sourceChangeKey_=null);var t=this.getSource();t&&(this.sourceChangeKey_=de(t,pe.CHANGE,this.handleSourceChange_,this)),this.changed()},e.prototype.getFeatures=function(t){return this.renderer_?this.renderer_.getFeatures(t):new Promise((function(t){return t([])}))},e.prototype.getData=function(t){return this.renderer_&&this.rendered?this.renderer_.getData(t):null},e.prototype.render=function(t,e){var n=this.getRenderer();if(n.prepareFrame(t))return this.rendered=!0,n.renderFrame(t,e)},e.prototype.unrender=function(){this.rendered=!1},e.prototype.setMapInternal=function(t){t||this.unrender(),this.set(Ie,t)},e.prototype.getMapInternal=function(){return this.get(Ie)},e.prototype.setMap=function(t){this.mapPrecomposeKey_&&(fe(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(fe(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=de(t,Ze.PRECOMPOSE,(function(t){var e=t.frameState.layerStatesArray,n=this.getLayerState(!1);x(!e.some((function(t){return t.layer===n.layer})),67),e.push(n)}),this),this.mapRenderKey_=de(this,pe.CHANGE,t.render,t),this.changed())},e.prototype.setSource=function(t){this.set(xe,t)},e.prototype.getRenderer=function(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_},e.prototype.hasRenderer=function(){return!!this.renderer_},e.prototype.createRenderer=function(){return null},e.prototype.disposeInternal=function(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),t.prototype.disposeInternal.call(this)},e}(Re);function Ge(t,e){return t[0]+=+e[0],t[1]+=+e[1],t}function Be(t,e){var n,r,o=t[0],i=t[1],a=e[0],s=e[1],l=a[0],c=a[1],u=s[0],p=s[1],d=u-l,h=p-c,f=0===d&&0===h?0:(d*(o-l)+h*(i-c))/(d*d+h*h||0);return f<=0?(n=l,r=c):f>=1?(n=u,r=p):(n=l+f*d,r=c+f*h),[n,r]}function je(t,e){for(var n=!0,r=t.length-1;r>=0;--r)if(t[r]!=e[r]){n=!1;break}return n}function We(t,e){var n=Math.cos(e),r=Math.sin(e),o=t[0]*n-t[1]*r,i=t[1]*n+t[0]*r;return t[0]=o,t[1]=i,t}function qe(t,e){return t[0]*=e,t[1]*=e,t}function He(t,e){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function Ve(t,e){return Math.sqrt(He(t,e))}function ze(t,e){return He(t,Be(t,e))}function Ye(t,e){if(e.canWrapX()){var n=Tt(e.getExtent()),r=Ke(t,e,n);r&&(t[0]-=r*n)}return t}function Ke(t,e,n){var r=e.getExtent(),o=0;if(e.canWrapX()&&(t[0]<r[0]||t[0]>r[2])){var i=n||Tt(r);o=Math.floor((t[0]-r[0])/i)}return o}var Xe=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),$e=function(t){function e(e){var n=t.call(this)||this;return n.map_=e,n}return Xe(e,t),e.prototype.dispatchRenderEvent=function(t,e){r()},e.prototype.calculateMatrices2D=function(t){var e=t.viewState,n=t.coordinateToPixelTransform,r=t.pixelToCoordinateTransform;F(n,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),U(r,n)},e.prototype.forEachFeatureAtCoordinate=function(t,e,n,r,o,i,a,s){var l,c=e.viewState;function u(t,e,n,r){return o.call(i,e,t?n:null,r)}var p=c.projection,d=Ye(t.slice(),p),h=[[0,0]];if(p.canWrapX()&&r){var f=Tt(p.getExtent());h.push([-f,0],[f,0])}for(var m=e.layerStatesArray,g=m.length,y=[],v=[],_=0;_<h.length;_++)for(var C=g-1;C>=0;--C){var E=m[C],w=E.layer;if(w.hasRenderer()&&Fe(E,c)&&a.call(s,w)){var S=w.getRenderer(),b=w.getSource();if(S&&b){var L=b.getWrapX()?d:t,T=u.bind(null,E.managed);v[0]=L[0]+h[_][0],v[1]=L[1]+h[_][1],l=S.forEachFeatureAtCoordinate(v,e,n,T,y)}if(l)return l}}if(0!==y.length){var P=1/y.length;return y.forEach((function(t,e){return t.distanceSq+=e*P})),y.sort((function(t,e){return t.distanceSq-e.distanceSq})),y.some((function(t){return l=t.callback(t.feature,t.layer,t.geometry)})),l}},e.prototype.forEachLayerAtPixel=function(t,e,n,o,i){return r()},e.prototype.hasFeatureAtCoordinate=function(t,e,n,r,o,i){return void 0!==this.forEachFeatureAtCoordinate(t,e,n,r,g,this,o,i)},e.prototype.getMap=function(){return this.map_},e.prototype.renderFrame=function(t){r()},e.prototype.scheduleExpireIconCache=function(t){Qt.canExpireCache()&&t.postRenderFunctions.push(Je)},e}(s);function Je(t,e){Qt.expire()}const Qe=$e;var tn=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),en=function(t){function e(e,n,r,o){var i=t.call(this,e)||this;return i.inversePixelTransform=n,i.frameState=r,i.context=o,i}return tn(e,t),e}(ne);const nn=en;var rn="ol-hidden",on="ol-unselectable",an="ol-control",sn="ol-collapsed",ln=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i"),cn=["style","variant","weight","size","lineHeight","family"],un=function(t){var e=t.match(ln);if(!e)return null;for(var n={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"},r=0,o=cn.length;r<o;++r){var i=e[r+1];void 0!==i&&(n[cn[r]]=i)}return n.families=n.family.split(/,\s?/),n};function pn(t){return 1===t?"":String(Math.round(100*t)/100)}function dn(t,e,n,r){var o;return o=n&&n.length?n.shift():L?new OffscreenCanvas(t||300,e||300):document.createElement("canvas"),t&&(o.width=t),e&&(o.height=e),o.getContext("2d",r)}function hn(t){var e=t.offsetWidth,n=getComputedStyle(t);return e+=parseInt(n.marginLeft,10)+parseInt(n.marginRight,10)}function fn(t){var e=t.offsetHeight,n=getComputedStyle(t);return e+=parseInt(n.marginTop,10)+parseInt(n.marginBottom,10)}function mn(t,e){var n=e.parentNode;n&&n.replaceChild(t,e)}function gn(t){return t&&t.parentNode?t.parentNode.removeChild(t):null}function yn(t){for(;t.lastChild;)t.removeChild(t.lastChild)}var vn="10px sans-serif",_n="#000",Cn="round",En=[],wn="round",Sn="#000",bn="center",Ln="middle",Tn=[0,0,0,0],Pn=new Ee;(new ue).setSize=function(){console.warn("labelCache is deprecated.")};var An,On,xn=null,In={},Mn=function(){var t,e,n="32px ",r=["monospace","serif"],o=r.length,i="wmytzilWMYTZIL@#/&?$%10";function a(t,a,s){for(var l=!0,c=0;c<o;++c){var u=r[c];if(e=Dn(t+" "+a+" "+n+u,i),s!=u){var p=Dn(t+" "+a+" "+n+s+","+u,i);l=l&&p!=e}}return!!l}function s(){for(var e=!0,n=Pn.getKeys(),r=0,o=n.length;r<o;++r){var i=n[r];Pn.get(i)<100&&(a.apply(this,i.split("\n"))?(ie(In),xn=null,An=void 0,Pn.set(i,100)):(Pn.set(i,Pn.get(i)+1,!0),e=!1))}e&&(clearInterval(t),t=void 0)}return function(e){var n=un(e);if(n)for(var r=n.families,o=0,i=r.length;o<i;++o){var l=r[o],c=n.style+"\n"+n.weight+"\n"+l;void 0===Pn.get(c)&&(Pn.set(c,100,!0),a(n.style,n.weight,l)||(Pn.set(c,0,!0),void 0===t&&(t=setInterval(s,32))))}}}(),Rn=function(t){var e=In[t];if(null==e){if(L){var n=un(t),r=Zn(t,"Žg");e=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(r.actualBoundingBoxAscent+r.actualBoundingBoxDescent)}else On||((On=document.createElement("div")).innerHTML="M",On.style.minHeight="0",On.style.maxHeight="none",On.style.height="auto",On.style.padding="0",On.style.border="none",On.style.position="absolute",On.style.display="block",On.style.left="-99999px"),On.style.font=t,document.body.appendChild(On),e=On.offsetHeight,document.body.removeChild(On);In[t]=e}return e};function Zn(t,e){return xn||(xn=dn(1,1)),t!=An&&(xn.font=t,An=xn.font),xn.measureText(e)}function Dn(t,e){return Zn(t,e).width}function kn(t,e,n){if(e in n)return n[e];var r=Dn(t,e);return n[e]=r,r}function Nn(t,e,n,r,o,i,a,s,l,c,u){t.save(),1!==n&&(t.globalAlpha*=n),e&&t.setTransform.apply(t,e),r.contextInstructions?(t.translate(l,c),t.scale(u[0],u[1]),function(t,e){for(var n=t.contextInstructions,r=0,o=n.length;r<o;r+=2)Array.isArray(n[r+1])?e[n[r]].apply(e,n[r+1]):e[n[r]]=n[r+1]}(r,t)):u[0]<0||u[1]<0?(t.translate(l,c),t.scale(u[0],u[1]),t.drawImage(r,o,i,a,s,0,0,a,s)):t.drawImage(r,o,i,a,s,l,c,a*u[0],s*u[1]),t.restore()}var Fn=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Un=function(t){function e(e){var n=t.call(this,e)||this;n.fontChangeListenerKey_=de(Pn,re,e.redrawText.bind(e)),n.element_=document.createElement("div");var r=n.element_.style;r.position="absolute",r.width="100%",r.height="100%",r.zIndex="0",n.element_.className="ol-unselectable ol-layers";var o=e.getViewport();return o.insertBefore(n.element_,o.firstChild||null),n.children_=[],n.renderedVisible_=!0,n}return Fn(e,t),e.prototype.dispatchRenderEvent=function(t,e){var n=this.getMap();if(n.hasListener(t)){var r=new nn(t,void 0,e);n.dispatchEvent(r)}},e.prototype.disposeInternal=function(){fe(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),t.prototype.disposeInternal.call(this)},e.prototype.renderFrame=function(t){if(t){this.calculateMatrices2D(t),this.dispatchRenderEvent(Ze.PRECOMPOSE,t);var e=t.layerStatesArray.sort((function(t,e){return t.zIndex-e.zIndex})),n=t.viewState;this.children_.length=0;for(var r=[],o=null,i=0,a=e.length;i<a;++i){var s=e[i];t.layerIndex=i;var l=s.layer,c=l.getSourceState();if(!Fe(s,n)||c!=ke&&c!=De)l.unrender();else{var u=l.render(t,o);u&&(u!==o&&(this.children_.push(u),o=u),"getDeclutter"in l&&r.push(l))}}for(i=r.length-1;i>=0;--i)r[i].renderDeclutter(t);!function(t,e){for(var n=t.childNodes,r=0;;++r){var o=n[r],i=e[r];if(!o&&!i)break;o!==i&&(o?i?t.insertBefore(i,o):(t.removeChild(o),--r):t.appendChild(i))}}(this.element_,this.children_),this.dispatchRenderEvent(Ze.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}else this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1)},e.prototype.forEachLayerAtPixel=function(t,e,n,r,o){for(var i=e.viewState,a=e.layerStatesArray,s=a.length-1;s>=0;--s){var l=a[s],c=l.layer;if(c.hasRenderer()&&Fe(l,i)&&o(c)){var u=c.getRenderer().getDataAtPixel(t,e,n);if(u){var p=r(c,u);if(p)return p}}}},e}(Qe);const Gn=Un,Bn="add",jn="remove";var Wn=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),qn="length",Hn=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.element=n,o.index=r,o}return Wn(e,t),e}(ne);const Vn=function(t){function e(e,n){var r=t.call(this)||this;r.on,r.once,r.un;var o=n||{};if(r.unique_=!!o.unique,r.array_=e||[],r.unique_)for(var i=0,a=r.array_.length;i<a;++i)r.assertUnique_(r.array_[i],i);return r.updateLength_(),r}return Wn(e,t),e.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},e.prototype.extend=function(t){for(var e=0,n=t.length;e<n;++e)this.push(t[e]);return this},e.prototype.forEach=function(t){for(var e=this.array_,n=0,r=e.length;n<r;++n)t(e[n],n,e)},e.prototype.getArray=function(){return this.array_},e.prototype.item=function(t){return this.array_[t]},e.prototype.getLength=function(){return this.get(qn)},e.prototype.insertAt=function(t,e){this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new Hn(Bn,e,t))},e.prototype.pop=function(){return this.removeAt(this.getLength()-1)},e.prototype.push=function(t){this.unique_&&this.assertUnique_(t);var e=this.getLength();return this.insertAt(e,t),this.getLength()},e.prototype.remove=function(t){for(var e=this.array_,n=0,r=e.length;n<r;++n)if(e[n]===t)return this.removeAt(n)},e.prototype.removeAt=function(t){var e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new Hn(jn,e,t)),e},e.prototype.setAt=function(t,e){var n=this.getLength();if(t<n){this.unique_&&this.assertUnique_(e,t);var r=this.array_[t];this.array_[t]=e,this.dispatchEvent(new Hn(jn,r,t)),this.dispatchEvent(new Hn(Bn,e,t))}else{for(var o=n;o<t;++o)this.insertAt(o,void 0);this.insertAt(t,e)}},e.prototype.updateLength_=function(){this.set(qn,this.array_.length)},e.prototype.assertUnique_=function(t,e){for(var n=0,r=this.array_.length;n<r;++n)if(this.array_[n]===t&&n!==e)throw new O(58)},e}(Ee);var zn=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Yn=function(t){function e(e,n){var r=t.call(this,e)||this;return r.layer=n,r}return zn(e,t),e}(ne),Kn="layers";const Xn=function(t){function e(e){var n=this,r=e||{},o=oe({},r);delete o.layers;var i=r.layers;return(n=t.call(this,o)||this).on,n.once,n.un,n.layersListenerKeys_=[],n.listenerKeys_={},n.addChangeListener(Kn,n.handleLayersChanged_),i?Array.isArray(i)?i=new Vn(i.slice(),{unique:!0}):x("function"==typeof i.getArray,43):i=new Vn(void 0,{unique:!0}),n.setLayers(i),n}return zn(e,t),e.prototype.handleLayerChange_=function(){this.changed()},e.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(fe),this.layersListenerKeys_.length=0;var t=this.getLayers();for(var e in this.layersListenerKeys_.push(de(t,Bn,this.handleLayersAdd_,this),de(t,jn,this.handleLayersRemove_,this)),this.listenerKeys_)this.listenerKeys_[e].forEach(fe);ie(this.listenerKeys_);for(var n=t.getArray(),r=0,o=n.length;r<o;r++){var i=n[r];this.registerLayerListeners_(i),this.dispatchEvent(new Yn("addlayer",i))}this.changed()},e.prototype.registerLayerListeners_=function(t){var n=[de(t,re,this.handleLayerChange_,this),de(t,pe.CHANGE,this.handleLayerChange_,this)];t instanceof e&&n.push(de(t,"addlayer",this.handleLayerGroupAdd_,this),de(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[i(t)]=n},e.prototype.handleLayerGroupAdd_=function(t){this.dispatchEvent(new Yn("addlayer",t.layer))},e.prototype.handleLayerGroupRemove_=function(t){this.dispatchEvent(new Yn("removelayer",t.layer))},e.prototype.handleLayersAdd_=function(t){var e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new Yn("addlayer",e)),this.changed()},e.prototype.handleLayersRemove_=function(t){var e=t.element,n=i(e);this.listenerKeys_[n].forEach(fe),delete this.listenerKeys_[n],this.dispatchEvent(new Yn("removelayer",e)),this.changed()},e.prototype.getLayers=function(){return this.get(Kn)},e.prototype.setLayers=function(t){var e=this.getLayers();if(e)for(var n=e.getArray(),r=0,o=n.length;r<o;++r)this.dispatchEvent(new Yn("removelayer",n[r]));this.set(Kn,t)},e.prototype.getLayersArray=function(t){var e=void 0!==t?t:[];return this.getLayers().forEach((function(t){t.getLayersArray(e)})),e},e.prototype.getLayerStatesArray=function(t){var e=void 0!==t?t:[],n=e.length;this.getLayers().forEach((function(t){t.getLayerStatesArray(e)}));var r=this.getLayerState(),o=r.zIndex;t||void 0!==r.zIndex||(o=0);for(var i=n,a=e.length;i<a;i++){var s=e[i];s.opacity*=r.opacity,s.visible=s.visible&&r.visible,s.maxResolution=Math.min(s.maxResolution,r.maxResolution),s.minResolution=Math.max(s.minResolution,r.minResolution),s.minZoom=Math.max(s.minZoom,r.minZoom),s.maxZoom=Math.min(s.maxZoom,r.maxZoom),void 0!==r.extent&&(void 0!==s.extent?s.extent=St(s.extent,r.extent):s.extent=r.extent),void 0===s.zIndex&&(s.zIndex=o)}return e},e.prototype.getSourceState=function(){return ke},e}(Re);var $n=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Jn=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.map=n,o.frameState=void 0!==r?r:null,o}return $n(e,t),e}(ne);const Qn=Jn;var tr=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),er=function(t){function e(e,n,r,o,i){var a=t.call(this,e,n,i)||this;return a.originalEvent=r,a.pixel_=null,a.coordinate_=null,a.dragging=void 0!==o&&o,a}return tr(e,t),Object.defineProperty(e.prototype,"pixel",{get:function(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_},set:function(t){this.pixel_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"coordinate",{get:function(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_},set:function(t){this.coordinate_=t},enumerable:!1,configurable:!0}),e.prototype.preventDefault=function(){t.prototype.preventDefault.call(this),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()},e.prototype.stopPropagation=function(){t.prototype.stopPropagation.call(this),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()},e}(Qn);const nr=er,rr={SINGLECLICK:"singleclick",CLICK:pe.CLICK,DBLCLICK:pe.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},or="pointermove",ir="pointerdown",ar="pointerup";var sr=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const lr=function(t){function e(e,n){var r=t.call(this,e)||this;r.map_=e,r.clickTimeoutId_,r.emulateClicks_=!1,r.dragging_=!1,r.dragListenerKeys_=[],r.moveTolerance_=void 0===n?1:n,r.down_=null;var o=r.map_.getViewport();return r.activePointers_=0,r.trackedTouches_={},r.element_=o,r.pointerdownListenerKey_=de(o,ir,r.handlePointerDown_,r),r.originalPointerMoveEvent_,r.relayedListenerKey_=de(o,or,r.relayEvent_,r),r.boundHandleTouchMove_=r.handleTouchMove_.bind(r),r.element_.addEventListener(pe.TOUCHMOVE,r.boundHandleTouchMove_,!!P&&{passive:!1}),r}return sr(e,t),e.prototype.emulateClick_=function(t){var e=new nr(rr.CLICK,this.map_,t);this.dispatchEvent(e),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new nr(rr.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;var e=new nr(rr.SINGLECLICK,this.map_,t);this.dispatchEvent(e)}.bind(this),250)},e.prototype.updateActivePointers_=function(t){var e=t;e.type==rr.POINTERUP||e.type==rr.POINTERCANCEL?delete this.trackedTouches_[e.pointerId]:e.type==rr.POINTERDOWN&&(this.trackedTouches_[e.pointerId]=!0),this.activePointers_=Object.keys(this.trackedTouches_).length},e.prototype.handlePointerUp_=function(t){this.updateActivePointers_(t);var e=new nr(rr.POINTERUP,this.map_,t);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),0===this.activePointers_&&(this.dragListenerKeys_.forEach(fe),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)},e.prototype.isMouseActionButton_=function(t){return 0===t.button},e.prototype.handlePointerDown_=function(t){this.emulateClicks_=0===this.activePointers_,this.updateActivePointers_(t);var e=new nr(rr.POINTERDOWN,this.map_,t);for(var n in this.dispatchEvent(e),this.down_={},t){var r=t[n];this.down_[n]="function"==typeof r?v:r}if(0===this.dragListenerKeys_.length){var o=this.map_.getOwnerDocument();this.dragListenerKeys_.push(de(o,rr.POINTERMOVE,this.handlePointerMove_,this),de(o,rr.POINTERUP,this.handlePointerUp_,this),de(this.element_,rr.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==o&&this.dragListenerKeys_.push(de(this.element_.getRootNode(),rr.POINTERUP,this.handlePointerUp_,this))}},e.prototype.handlePointerMove_=function(t){if(this.isMoving_(t)){this.dragging_=!0;var e=new nr(rr.POINTERDRAG,this.map_,t,this.dragging_);this.dispatchEvent(e)}},e.prototype.relayEvent_=function(t){this.originalPointerMoveEvent_=t;var e=!(!this.down_||!this.isMoving_(t));this.dispatchEvent(new nr(t.type,this.map_,t,e))},e.prototype.handleTouchMove_=function(t){var e=this.originalPointerMoveEvent_;e&&!e.defaultPrevented||"boolean"==typeof t.cancelable&&!0!==t.cancelable||t.preventDefault()},e.prototype.isMoving_=function(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_},e.prototype.disposeInternal=function(){this.relayedListenerKey_&&(fe(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(pe.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(fe(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(fe),this.dragListenerKeys_.length=0,this.element_=null,t.prototype.disposeInternal.call(this)},e}(ue),cr={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend"},ur="layergroup",pr="size",dr="target",hr="view";var fr=1/0;const mr=function(){function t(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}return t.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,ie(this.queuedElements_)},t.prototype.dequeue=function(){var t=this.elements_,e=this.priorities_,n=t[0];1==t.length?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));var r=this.keyFunction_(n);return delete this.queuedElements_[r],n},t.prototype.enqueue=function(t){x(!(this.keyFunction_(t)in this.queuedElements_),31);var e=this.priorityFunction_(t);return e!=fr&&(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0)},t.prototype.getCount=function(){return this.elements_.length},t.prototype.getLeftChildIndex_=function(t){return 2*t+1},t.prototype.getRightChildIndex_=function(t){return 2*t+2},t.prototype.getParentIndex_=function(t){return t-1>>1},t.prototype.heapify_=function(){var t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)},t.prototype.isEmpty=function(){return 0===this.elements_.length},t.prototype.isKeyQueued=function(t){return t in this.queuedElements_},t.prototype.isQueued=function(t){return this.isKeyQueued(this.keyFunction_(t))},t.prototype.siftUp_=function(t){for(var e=this.elements_,n=this.priorities_,r=e.length,o=e[t],i=n[t],a=t;t<r>>1;){var s=this.getLeftChildIndex_(t),l=this.getRightChildIndex_(t),c=l<r&&n[l]<n[s]?l:s;e[t]=e[c],n[t]=n[c],t=c}e[t]=o,n[t]=i,this.siftDown_(a,t)},t.prototype.siftDown_=function(t,e){for(var n=this.elements_,r=this.priorities_,o=n[e],i=r[e];e>t;){var a=this.getParentIndex_(e);if(!(r[a]>i))break;n[e]=n[a],r[e]=r[a],e=a}n[e]=o,r[e]=i},t.prototype.reprioritize=function(){var t,e,n,r=this.priorityFunction_,o=this.elements_,i=this.priorities_,a=0,s=o.length;for(e=0;e<s;++e)(n=r(t=o[e]))==fr?delete this.queuedElements_[this.keyFunction_(t)]:(i[a]=n,o[a++]=t);o.length=a,i.length=a,this.heapify_()},t}(),gr=0,yr=1,vr=2,_r=3,Cr=4;var Er=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),wr=function(t){function e(e,n){var r=t.call(this,(function(t){return e.apply(null,t)}),(function(t){return t[0].getKey()}))||this;return r.boundHandleTileChange_=r.handleTileChange.bind(r),r.tileChangeCallback_=n,r.tilesLoading_=0,r.tilesLoadingKeys_={},r}return Er(e,t),e.prototype.enqueue=function(e){var n=t.prototype.enqueue.call(this,e);n&&e[0].addEventListener(pe.CHANGE,this.boundHandleTileChange_);return n},e.prototype.getTilesLoading=function(){return this.tilesLoading_},e.prototype.handleTileChange=function(t){var e=t.target,n=e.getState();if(n===vr||n===_r||n===Cr){e.removeEventListener(pe.CHANGE,this.boundHandleTileChange_);var r=e.getKey();r in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[r],--this.tilesLoading_),this.tileChangeCallback_()}},e.prototype.loadMoreTiles=function(t,e){for(var n,r,o=0;this.tilesLoading_<t&&o<e&&this.getCount()>0;)r=(n=this.dequeue()[0]).getKey(),n.getState()!==gr||r in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[r]=!0,++this.tilesLoading_,++o,n.load())},e}(mr);const Sr=wr;const br={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"};var Lr={RADIANS:"radians",DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"};var Tr={};Tr[Lr.RADIANS]=6370997/(2*Math.PI),Tr[Lr.DEGREES]=2*Math.PI*6370997/360,Tr[Lr.FEET]=.3048,Tr[Lr.METERS]=1,Tr[Lr.USFEET]=1200/3937;const Pr=Lr,Ar=0,Or=1,xr={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};var Ir=256;const Mr=function(){function t(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}return t.prototype.canWrapX=function(){return this.canWrapX_},t.prototype.getCode=function(){return this.code_},t.prototype.getExtent=function(){return this.extent_},t.prototype.getUnits=function(){return this.units_},t.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||Tr[this.units_]},t.prototype.getWorldExtent=function(){return this.worldExtent_},t.prototype.getAxisOrientation=function(){return this.axisOrientation_},t.prototype.isGlobal=function(){return this.global_},t.prototype.setGlobal=function(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)},t.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},t.prototype.setDefaultTileGrid=function(t){this.defaultTileGrid_=t},t.prototype.setExtent=function(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)},t.prototype.setWorldExtent=function(t){this.worldExtent_=t},t.prototype.setGetPointResolution=function(t){this.getPointResolutionFunc_=t},t.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},t}();var Rr=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Zr=6378137,Dr=Math.PI*Zr,kr=[-Dr,-Dr,Dr,Dr],Nr=[-180,-85,180,85],Fr=Zr*Math.log(Math.tan(Math.PI/2)),Ur=function(t){function e(e){return t.call(this,{code:e,units:Pr.METERS,extent:kr,global:!0,worldExtent:Nr,getPointResolution:function(t,e){return t/Mt(e[1]/Zr)}})||this}return Rr(e,t),e}(Mr),Gr=[new Ur("EPSG:3857"),new Ur("EPSG:102100"),new Ur("EPSG:102113"),new Ur("EPSG:900913"),new Ur("http://www.opengis.net/def/crs/EPSG/0/3857"),new Ur("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Br(t,e,n){var r=t.length,o=n>1?n:2,i=e;void 0===i&&(i=o>2?t.slice():new Array(r));for(var a=0;a<r;a+=o){i[a]=Dr*t[a]/180;var s=Zr*Math.log(Math.tan(Math.PI*(+t[a+1]+90)/360));s>Fr?s=Fr:s<-Fr&&(s=-Fr),i[a+1]=s}return i}function jr(t,e,n){var r=t.length,o=n>1?n:2,i=e;void 0===i&&(i=o>2?t.slice():new Array(r));for(var a=0;a<r;a+=o)i[a]=180*t[a]/Dr,i[a+1]=360*Math.atan(Math.exp(t[a+1]/Zr))/Math.PI-90;return i}var Wr=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),qr=[-180,-90,180,90],Hr=6378137*Math.PI/180,Vr=function(t){function e(e,n){return t.call(this,{code:e,units:Pr.DEGREES,extent:qr,axisOrientation:n,global:!0,metersPerUnit:Hr,worldExtent:qr})||this}return Wr(e,t),e}(Mr),zr=[new Vr("CRS:84"),new Vr("EPSG:4326","neu"),new Vr("urn:ogc:def:crs:OGC:1.3:CRS84"),new Vr("urn:ogc:def:crs:OGC:2:84"),new Vr("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Vr("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Vr("http://www.opengis.net/def/crs/EPSG/0/4326","neu")],Yr={};var Kr={};function Xr(t,e,n){var r=t.getCode(),o=e.getCode();r in Kr||(Kr[r]={}),Kr[r][o]=n}function $r(t,e){var n;return t in Kr&&e in Kr[t]&&(n=Kr[t][e]),n}var Jr=6371008.8;function Qr(t,e,n){var r=n||Jr,o=kt(t[1]),i=kt(e[1]),a=(i-o)/2,s=kt(e[0]-t[0])/2,l=Math.sin(a)*Math.sin(a)+Math.sin(s)*Math.sin(s)*Math.cos(o)*Math.cos(i);return 2*r*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))}var to=!0;function eo(t){to=!(void 0===t||t)}function no(t,e,n){var r;if(void 0!==e){for(var o=0,i=t.length;o<i;++o)e[o]=t[o];r=e}else r=t.slice();return r}function ro(t,e,n){if(void 0!==e&&t!==e){for(var r=0,o=t.length;r<o;++r)e[r]=t[r];t=e}return t}function oo(t){!function(t,e){Yr[t]=e}(t.getCode(),t),Xr(t,t,no)}function io(t){return"string"==typeof t?Yr[e=t]||Yr[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null:t||null;var e}function ao(t,e,n,r){var o,i=(t=io(t)).getPointResolutionFunc();if(i){if(o=i(e,n),r&&r!==t.getUnits())(s=t.getMetersPerUnit())&&(o=o*s/Tr[r])}else{var a=t.getUnits();if(a==Pr.DEGREES&&!r||r==Pr.DEGREES)o=e;else{var s,l=po(t,io("EPSG:4326"));if(l===ro&&a!==Pr.DEGREES)o=e*t.getMetersPerUnit();else{var c=[n[0]-e/2,n[1],n[0]+e/2,n[1],n[0],n[1]-e/2,n[0],n[1]+e/2];o=(Qr((c=l(c,c,2)).slice(0,2),c.slice(2,4))+Qr(c.slice(4,6),c.slice(6,8)))/2}void 0!==(s=r?Tr[r]:t.getMetersPerUnit())&&(o/=s)}}return o}function so(t){!function(t){t.forEach(oo)}(t),t.forEach((function(e){t.forEach((function(t){e!==t&&Xr(e,t,no)}))}))}function lo(t,e){return t?"string"==typeof t?io(t):t:io(e)}function co(t){return function(e,n,r){for(var o=e.length,i=void 0!==r?r:2,a=void 0!==n?n:new Array(o),s=0;s<o;s+=i){var l=t([e[s],e[s+1]]);a[s]=l[0],a[s+1]=l[1];for(var c=i-1;c>=2;--c)a[s+c]=e[s+c]}return a}}function uo(t,e){if(t===e)return!0;var n=t.getUnits()===e.getUnits();return(t.getCode()===e.getCode()||po(t,e)===no)&&n}function po(t,e){var n=$r(t.getCode(),e.getCode());return n||(n=ro),n}function ho(t,e){return po(io(t),io(e))}function fo(t,e,n){return ho(e,n)(t,void 0,t.length)}function mo(t,e,n,r){return xt(t,ho(e,n),void 0,r)}var go,yo,vo,_o=null;function Co(){return _o}function Eo(t,e){return _o?fo(t,e,_o):t}function wo(t,e){return _o?fo(t,_o,e):(to&&!je(t,[0,0])&&t[0]>=-180&&t[0]<=180&&t[1]>=-90&&t[1]<=90&&(to=!1,console.warn("Call useGeographic() ol/proj once to work with [longitude, latitude] coordinates.")),t)}function So(t,e){return _o?mo(t,e,_o):t}function bo(t,e){return _o?mo(t,_o,e):t}function Lo(t,e){if(!_o)return t;var n=io(e).getUnits(),r=_o.getUnits();return n&&r?t*Tr[n]/Tr[r]:t}function To(t,e,n){return function(r){var o,i,a=r[0],s=r[1];if(t.canWrapX()){var l=t.getExtent(),c=Tt(l);(i=Ke(r,t,c))&&(a-=i*c),a=It(a,l[0],l[2]),s=It(s,l[1],l[3]),o=n([a,s])}else o=n(r);return i&&e.canWrapX()&&(o[0]+=i*Tt(e.getExtent())),o}}function Po(t,e,n){return function(r,o,i,a,s){if(r){if(!o&&!e)return r;var l=e?0:i[0]*o,c=e?0:i[1]*o,u=s?s[0]:0,p=s?s[1]:0,d=t[0]+l/2+u,h=t[2]-l/2+u,f=t[1]+c/2+p,m=t[3]-c/2+p;d>h&&(h=d=(h+d)/2),f>m&&(m=f=(m+f)/2);var g=It(r[0],d,h),y=It(r[1],f,m);if(a&&n&&o){var v=30*o;g+=-v*Math.log(1+Math.max(0,d-r[0])/v)+v*Math.log(1+Math.max(0,r[0]-h)/v),y+=-v*Math.log(1+Math.max(0,f-r[1])/v)+v*Math.log(1+Math.max(0,r[1]-m)/v)}return[g,y]}}}function Ao(t){return t}function Oo(t,e,n,r){var o=Tt(e)/n[0],i=wt(e)/n[1];return r?Math.min(t,Math.max(o,i)):Math.min(t,Math.min(o,i))}function xo(t,e,n){var r=Math.min(t,e);return r*=Math.log(1+50*Math.max(0,t/e-1))/50+1,n&&(r=Math.max(r,n),r/=Math.log(1+50*Math.max(0,n/t-1))/50+1),It(r,n/2,2*e)}function Io(t,e,n,r,o){return function(i,a,s,l){if(void 0!==i){var c=r?Oo(t,r,s,o):t;return(void 0===n||n)&&l?xo(i,c,e):It(i,e,c)}}}function Mo(t){return void 0!==t?0:void 0}function Ro(t){return void 0!==t?t:void 0}function Zo(t){return Math.pow(t,3)}function Do(t){return 1-Zo(1-t)}function ko(t){return 3*t*t-2*t*t*t}function No(t){return t}so(Gr),so(zr),go=Gr,yo=Br,vo=jr,zr.forEach((function(t){go.forEach((function(e){Xr(t,e,yo),Xr(e,t,vo)}))}));const Fo={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"};function Uo(t,e,n,r,o,i){for(var a=i||[],s=0,l=e;l<n;l+=r){var c=t[l],u=t[l+1];a[s++]=o[0]*c+o[2]*u+o[4],a[s++]=o[1]*c+o[3]*u+o[5]}return i&&a.length!=s&&(a.length=s),a}function Go(t,e,n,r,o,i,a){for(var s=a||[],l=Math.cos(o),c=Math.sin(o),u=i[0],p=i[1],d=0,h=e;h<n;h+=r){var f=t[h]-u,m=t[h+1]-p;s[d++]=u+f*l-m*c,s[d++]=p+f*c+m*l;for(var g=h+2;g<h+r;++g)s[d++]=t[g]}return a&&s.length!=d&&(s.length=d),s}function Bo(t,e,n,r,o,i,a){for(var s=a||[],l=0,c=e;c<n;c+=r){s[l++]=t[c]+o,s[l++]=t[c+1]+i;for(var u=c+2;u<c+r;++u)s[l++]=t[u]}return a&&s.length!=l&&(s.length=l),s}var jo=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Wo=[1,0,0,1,0,0],qo=function(t){function e(){var e,n,r,o,i,a=t.call(this)||this;return a.extent_=[1/0,1/0,-1/0,-1/0],a.extentRevision_=-1,a.simplifiedGeometryMaxMinSquaredTolerance=0,a.simplifiedGeometryRevision=0,a.simplifyTransformedInternal=(e=function(t,e,n){if(!n)return this.getSimplifiedGeometry(e);var r=this.clone();return r.applyTransform(n),r.getSimplifiedGeometry(e)},i=!1,function(){var t=Array.prototype.slice.call(arguments);return i&&this===o&&f(t,r)||(i=!0,o=this,r=t,n=e.apply(this,arguments)),n}),a}return jo(e,t),e.prototype.simplifyTransformed=function(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)},e.prototype.clone=function(){return r()},e.prototype.closestPointXY=function(t,e,n,o){return r()},e.prototype.containsXY=function(t,e){var n=this.getClosestPoint([t,e]);return n[0]===t&&n[1]===e},e.prototype.getClosestPoint=function(t,e){var n=e||[NaN,NaN];return this.closestPointXY(t[0],t[1],n,1/0),n},e.prototype.intersectsCoordinate=function(t){return this.containsXY(t[0],t[1])},e.prototype.computeExtent=function(t){return r()},e.prototype.getExtent=function(t){if(this.extentRevision_!=this.getRevision()){var e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&st(e),this.extentRevision_=this.getRevision()}return function(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t}(this.extent_,t)},e.prototype.rotate=function(t,e){r()},e.prototype.scale=function(t,e,n){r()},e.prototype.simplify=function(t){return this.getSimplifiedGeometry(t*t)},e.prototype.getSimplifiedGeometry=function(t){return r()},e.prototype.getType=function(){return r()},e.prototype.applyTransform=function(t){r()},e.prototype.intersectsExtent=function(t){return r()},e.prototype.translate=function(t,e){r()},e.prototype.transform=function(t,e){var n=io(t),r=n.getUnits()==Pr.TILE_PIXELS?function(t,r,o){var i=n.getExtent(),a=n.getWorldExtent(),s=wt(a)/wt(i);return F(Wo,a[0],a[3],s,-s,0,0,0),Uo(t,0,t.length,o,Wo,r),ho(n,e)(t,r,o)}:ho(n,e);return this.applyTransform(r),this},e}(Ee);const Ho=qo;var Vo=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),zo=function(t){function e(){var e=t.call(this)||this;return e.layout=Fo.XY,e.stride=2,e.flatCoordinates=null,e}return Vo(e,t),e.prototype.computeExtent=function(t){return ct(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinates=function(){return r()},e.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},e.prototype.getFlatCoordinates=function(){return this.flatCoordinates},e.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},e.prototype.getLayout=function(){return this.layout},e.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)},e.prototype.getSimplifiedGeometryInternal=function(t){return this},e.prototype.getStride=function(){return this.stride},e.prototype.setFlatCoordinates=function(t,e){this.stride=Yo(t),this.layout=t,this.flatCoordinates=e},e.prototype.setCoordinates=function(t,e){r()},e.prototype.setLayout=function(t,e,n){var r;if(t)r=Yo(t);else{for(var o=0;o<n;++o){if(0===e.length)return this.layout=Fo.XY,void(this.stride=2);e=e[0]}t=function(t){var e;2==t?e=Fo.XY:3==t?e=Fo.XYZ:4==t&&(e=Fo.XYZM);return e}(r=e.length)}this.layout=t,this.stride=r},e.prototype.applyTransform=function(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},e.prototype.rotate=function(t,e){var n=this.getFlatCoordinates();if(n){var r=this.getStride();Go(n,0,n.length,r,t,e,n),this.changed()}},e.prototype.scale=function(t,e,n){var r=e;void 0===r&&(r=t);var o=n;o||(o=_t(this.getExtent()));var i=this.getFlatCoordinates();if(i){var a=this.getStride();!function(t,e,n,r,o,i,a,s){for(var l=s||[],c=a[0],u=a[1],p=0,d=e;d<n;d+=r){var h=t[d]-c,f=t[d+1]-u;l[p++]=c+o*h,l[p++]=u+i*f;for(var m=d+2;m<d+r;++m)l[p++]=t[m]}s&&l.length!=p&&(l.length=p)}(i,0,i.length,a,t,r,o,i),this.changed()}},e.prototype.translate=function(t,e){var n=this.getFlatCoordinates();if(n){var r=this.getStride();Bo(n,0,n.length,r,t,e,n),this.changed()}},e}(Ho);function Yo(t){var e;return t==Fo.XY?e=2:t==Fo.XYZ||t==Fo.XYM?e=3:t==Fo.XYZM&&(e=4),e}const Ko=zo;function Xo(t,e,n,r,o,i,a){var s,l=t[e],c=t[e+1],u=t[n]-l,p=t[n+1]-c;if(0===u&&0===p)s=e;else{var d=((o-l)*u+(i-c)*p)/(u*u+p*p);if(d>1)s=n;else{if(d>0){for(var h=0;h<r;++h)a[h]=Ft(t[e+h],t[n+h],d);return void(a.length=r)}s=e}}for(h=0;h<r;++h)a[h]=t[s+h];a.length=r}function $o(t,e,n,r,o){var i=t[e],a=t[e+1];for(e+=r;e<n;e+=r){var s=t[e],l=t[e+1],c=Dt(i,a,s,l);c>o&&(o=c),i=s,a=l}return o}function Jo(t,e,n,r,o){for(var i=0,a=n.length;i<a;++i){var s=n[i];o=$o(t,e,s,r,o),e=s}return o}function Qo(t,e,n,r,o,i,a,s,l,c,u){if(e==n)return c;var p,d;if(0===o){if((d=Dt(a,s,t[e],t[e+1]))<c){for(p=0;p<r;++p)l[p]=t[e+p];return l.length=r,d}return c}for(var h=u||[NaN,NaN],f=e+r;f<n;)if(Xo(t,f-r,f,r,a,s,h),(d=Dt(a,s,h[0],h[1]))<c){for(c=d,p=0;p<r;++p)l[p]=h[p];l.length=r,f+=r}else f+=r*Math.max((Math.sqrt(d)-Math.sqrt(c))/o|0,1);if(i&&(Xo(t,n-r,e,r,a,s,h),(d=Dt(a,s,h[0],h[1]))<c)){for(c=d,p=0;p<r;++p)l[p]=h[p];l.length=r}return c}function ti(t,e,n,r,o,i,a,s,l,c,u){for(var p=u||[NaN,NaN],d=0,h=n.length;d<h;++d){var f=n[d];c=Qo(t,e,f,r,o,i,a,s,l,c,p),e=f}return c}function ei(t,e,n,r){for(var o=0,i=n.length;o<i;++o)t[e++]=n[o];return e}function ni(t,e,n,r){for(var o=0,i=n.length;o<i;++o)for(var a=n[o],s=0;s<r;++s)t[e++]=a[s];return e}function ri(t,e,n,r,o){for(var i=o||[],a=0,s=0,l=n.length;s<l;++s){var c=ni(t,e,n[s],r);i[a++]=c,e=c}return i.length=a,i}function oi(t,e,n,r,o,i,a){var s=(n-e)/r;if(s<3){for(;e<n;e+=r)i[a++]=t[e],i[a++]=t[e+1];return a}var l=new Array(s);l[0]=1,l[s-1]=1;for(var c=[e,n-r],u=0;c.length>0;){for(var p=c.pop(),d=c.pop(),h=0,f=t[d],m=t[d+1],g=t[p],y=t[p+1],v=d+r;v<p;v+=r){var _=Zt(t[v],t[v+1],f,m,g,y);_>h&&(u=v,h=_)}h>o&&(l[(u-e)/r]=1,d+r<u&&c.push(d,u),u+r<p&&c.push(u,p))}for(v=0;v<s;++v)l[v]&&(i[a++]=t[e+v*r],i[a++]=t[e+v*r+1]);return a}function ii(t,e,n,r,o,i,a,s){for(var l=0,c=n.length;l<c;++l){var u=n[l];a=oi(t,e,u,r,o,i,a),s.push(a),e=u}return a}function ai(t,e){return e*Math.round(t/e)}function si(t,e,n,r,o,i,a){if(e==n)return a;var s,l,c=ai(t[e],o),u=ai(t[e+1],o);e+=r,i[a++]=c,i[a++]=u;do{if(s=ai(t[e],o),l=ai(t[e+1],o),(e+=r)==n)return i[a++]=s,i[a++]=l,a}while(s==c&&l==u);for(;e<n;){var p=ai(t[e],o),d=ai(t[e+1],o);if(e+=r,p!=s||d!=l){var h=s-c,f=l-u,m=p-c,g=d-u;h*g==f*m&&(h<0&&m<h||h==m||h>0&&m>h)&&(f<0&&g<f||f==g||f>0&&g>f)?(s=p,l=d):(i[a++]=s,i[a++]=l,c=s,u=l,s=p,l=d)}}return i[a++]=s,i[a++]=l,a}function li(t,e,n,r,o,i,a,s){for(var l=0,c=n.length;l<c;++l){var u=n[l];a=si(t,e,u,r,o,i,a),s.push(a),e=u}return a}function ci(t,e,n,r,o){for(var i=void 0!==o?o:[],a=0,s=e;s<n;s+=r)i[a++]=t.slice(s,s+r);return i.length=a,i}function ui(t,e,n,r,o){for(var i=void 0!==o?o:[],a=0,s=0,l=n.length;s<l;++s){var c=n[s];i[a++]=ci(t,e,c,r,i[a]),e=c}return i.length=a,i}function pi(t,e,n,r,o){for(var i=void 0!==o?o:[],a=0,s=0,l=n.length;s<l;++s){var c=n[s];i[a++]=ui(t,e,c,r,i[a]),e=c[c.length-1]}return i.length=a,i}function di(t,e,n,r){for(var o=0,i=t[n-r],a=t[n-r+1];e<n;e+=r){var s=t[e],l=t[e+1];o+=a*s-i*l,i=s,a=l}return o/2}function hi(t,e,n,r){for(var o=0,i=0,a=n.length;i<a;++i){var s=n[i];o+=di(t,e,s,r),e=s}return o}var fi=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),mi=function(t){function e(e,n){var r=t.call(this)||this;return r.maxDelta_=-1,r.maxDeltaRevision_=-1,void 0===n||Array.isArray(e[0])?r.setCoordinates(e,n):r.setFlatCoordinates(n,e),r}return fi(e,t),e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,n,r){return r<tt(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt($o(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Qo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,n,r))},e.prototype.getArea=function(){return di(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinates=function(){return ci(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getSimplifiedGeometryInternal=function(t){var n=[];return n.length=oi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,n,0),new e(n,Fo.XY)},e.prototype.getType=function(){return br.LINEAR_RING},e.prototype.intersectsExtent=function(t){return!1},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ni(this.flatCoordinates,0,t,this.stride),this.changed()},e}(Ko);const gi=mi;var yi=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),vi=function(t){function e(e,n){var r=t.call(this)||this;return r.setCoordinates(e,n),r}return yi(e,t),e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,n,r){var o=this.flatCoordinates,i=Dt(t,e,o[0],o[1]);if(i<r){for(var a=this.stride,s=0;s<a;++s)n[s]=o[s];return n.length=a,i}return r},e.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},e.prototype.computeExtent=function(t){return lt(this.flatCoordinates,t)},e.prototype.getType=function(){return br.POINT},e.prototype.intersectsExtent=function(t){return rt(t,this.flatCoordinates[0],this.flatCoordinates[1])},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ei(this.flatCoordinates,0,t,this.stride),this.changed()},e}(Ko);const _i=vi;function Ci(t,e,n,r,o){return!mt(o,(function(o){return!Ei(t,e,n,r,o[0],o[1])}))}function Ei(t,e,n,r,o,i){for(var a=0,s=t[n-r],l=t[n-r+1];e<n;e+=r){var c=t[e],u=t[e+1];l<=i?u>i&&(c-s)*(i-l)-(o-s)*(u-l)>0&&a++:u<=i&&(c-s)*(i-l)-(o-s)*(u-l)<0&&a--,s=c,l=u}return 0!==a}function wi(t,e,n,r,o,i){if(0===n.length)return!1;if(!Ei(t,e,n[0],r,o,i))return!1;for(var a=1,s=n.length;a<s;++a)if(Ei(t,n[a-1],n[a],r,o,i))return!1;return!0}function Si(t,e,n,r,o,i,a){for(var s,c,u,p,d,h,f,m=o[i+1],g=[],y=0,v=n.length;y<v;++y){var _=n[y];for(p=t[_-r],h=t[_-r+1],s=e;s<_;s+=r)d=t[s],f=t[s+1],(m<=h&&f<=m||h<=m&&m<=f)&&(u=(m-h)/(f-h)*(d-p)+p,g.push(u)),p=d,h=f}var C=NaN,E=-1/0;for(g.sort(l),p=g[0],s=1,c=g.length;s<c;++s){d=g[s];var w=Math.abs(d-p);w>E&&wi(t,e,n,r,u=(p+d)/2,m)&&(C=u,E=w),p=d}return isNaN(C)&&(C=o[i]),a?(a.push(C,m,E),a):[C,m,E]}function bi(t,e,n,r,o){var i;for(e+=r;e<n;e+=r)if(i=o(t.slice(e-r,e),t.slice(e,e+r)))return i;return!1}function Li(t,e,n,r,o){var i=ht([1/0,1/0,-1/0,-1/0],t,e,n,r);return!!Pt(o,i)&&(!!nt(o,i)||(i[0]>=o[0]&&i[2]<=o[2]||(i[1]>=o[1]&&i[3]<=o[3]||bi(t,e,n,r,(function(t,e){return function(t,e,n){var r=!1,o=ot(t,e),i=ot(t,n);if(o===V||i===V)r=!0;else{var a=t[0],s=t[1],l=t[2],c=t[3],u=e[0],p=e[1],d=n[0],h=n[1],f=(h-p)/(d-u),m=void 0,g=void 0;i&z&&!(o&z)&&(r=(m=d-(h-c)/f)>=a&&m<=l),r||!(i&Y)||o&Y||(r=(g=h-(d-l)*f)>=s&&g<=c),r||!(i&K)||o&K||(r=(m=d-(h-s)/f)>=a&&m<=l),r||!(i&X)||o&X||(r=(g=h-(d-a)*f)>=s&&g<=c)}return r}(o,t,e)})))))}function Ti(t,e,n,r,o){if(!function(t,e,n,r,o){return!!(Li(t,e,n,r,o)||Ei(t,e,n,r,o[0],o[1])||Ei(t,e,n,r,o[0],o[3])||Ei(t,e,n,r,o[2],o[1])||Ei(t,e,n,r,o[2],o[3]))}(t,e,n[0],r,o))return!1;if(1===n.length)return!0;for(var i=1,a=n.length;i<a;++i)if(Ci(t,n[i-1],n[i],r,o)&&!Li(t,n[i-1],n[i],r,o))return!1;return!0}function Pi(t,e,n,r){for(;e<n-r;){for(var o=0;o<r;++o){var i=t[e+o];t[e+o]=t[n-r+o],t[n-r+o]=i}e+=r,n-=r}}function Ai(t,e,n,r){for(var o=0,i=t[n-r],a=t[n-r+1];e<n;e+=r){var s=t[e],l=t[e+1];o+=(s-i)*(l+a),i=s,a=l}return 0===o?void 0:o>0}function Oi(t,e,n,r,o){for(var i=void 0!==o&&o,a=0,s=n.length;a<s;++a){var l=n[a],c=Ai(t,e,l,r);if(0===a){if(i&&c||!i&&!c)return!1}else if(i&&!c||!i&&c)return!1;e=l}return!0}function xi(t,e,n,r,o){for(var i=void 0!==o&&o,a=0,s=n.length;a<s;++a){var l=n[a],c=Ai(t,e,l,r);(0===a?i&&c||!i&&!c:i&&!c||!i&&c)&&Pi(t,e,l,r),e=l}return e}function Ii(t,e,n,r,o){for(var i=0,a=n.length;i<a;++i)e=xi(t,e,n[i],r,o);return e}var Mi=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ri=function(t){function e(e,n,r){var o=t.call(this)||this;return o.ends_=[],o.flatInteriorPointRevision_=-1,o.flatInteriorPoint_=null,o.maxDelta_=-1,o.maxDeltaRevision_=-1,o.orientedRevision_=-1,o.orientedFlatCoordinates_=null,void 0!==n&&r?(o.setFlatCoordinates(n,e),o.ends_=r):o.setCoordinates(e,n),o}return Mi(e,t),e.prototype.appendLinearRing=function(t){this.flatCoordinates?d(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,n,r){return r<tt(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Jo(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ti(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,n,r))},e.prototype.containsXY=function(t,e){return wi(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)},e.prototype.getArea=function(){return hi(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},e.prototype.getCoordinates=function(t){var e;return void 0!==t?xi(e=this.getOrientedFlatCoordinates().slice(),0,this.ends_,this.stride,t):e=this.flatCoordinates,ui(e,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var t=_t(this.getExtent());this.flatInteriorPoint_=Si(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},e.prototype.getInteriorPoint=function(){return new _i(this.getFlatInteriorPoint(),Fo.XYM)},e.prototype.getLinearRingCount=function(){return this.ends_.length},e.prototype.getLinearRing=function(t){return t<0||this.ends_.length<=t?null:new gi(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLinearRings=function(){for(var t=this.layout,e=this.flatCoordinates,n=this.ends_,r=[],o=0,i=0,a=n.length;i<a;++i){var s=n[i],l=new gi(e.slice(o,s),t);r.push(l),o=s}return r},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;Oi(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=xi(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var n=[],r=[];return n.length=li(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),n,0,r),new e(n,Fo.XY,r)},e.prototype.getType=function(){return br.POLYGON},e.prototype.intersectsExtent=function(t){return Ti(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var n=ri(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===n.length?0:n[n.length-1],this.changed()},e}(Ko);const Zi=Ri;function Di(t){var e=t[0],n=t[1],r=t[2],o=t[3],i=[e,n,e,o,r,o,r,n,e,n];return new Ri(i,Fo.XY,[i.length])}function ki(t,e,n){for(var r=e||32,o=t.getStride(),i=t.getLayout(),a=t.getCenter(),s=o*(r+1),l=new Array(s),c=0;c<s;c+=o){l[c]=0,l[c+1]=0;for(var u=2;u<o;u++)l[c+u]=a[u]}var p=[l.length],d=new Ri(l,i,p);return function(t,e,n,r){for(var o=t.getFlatCoordinates(),i=t.getStride(),a=o.length/i-1,s=r||0,l=0;l<=a;++l){var c=l*i,u=s+2*Nt(l,a)*Math.PI/a;o[c]=e[0]+n*Math.cos(u),o[c+1]=e[1]+n*Math.sin(u)}t.changed()}(d,a,t.getRadius(),n),d}var Ni=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Fi=function(t){function e(e){var n=t.call(this)||this;n.on,n.once,n.un;var r=oe({},e);return n.hints_=[0,0],n.animations_=[],n.updateAnimationKey_,n.projection_=lo(r.projection,"EPSG:3857"),n.viewportSize_=[100,100],n.targetCenter_=null,n.targetResolution_,n.targetRotation_,n.nextCenter_=null,n.nextResolution_,n.nextRotation_,n.cancelAnchor_=void 0,r.center&&(r.center=wo(r.center,n.projection_)),r.extent&&(r.extent=bo(r.extent,n.projection_)),r.projection&&eo(),n.applyOptions_(r),n}return Ni(e,t),e.prototype.applyOptions_=function(t){var e=oe({},t);for(var n in xr)delete e[n];this.setProperties(e,!0);var r=function(t){var e,n,r,o=28,i=2,a=void 0!==t.minZoom?t.minZoom:0,s=void 0!==t.maxZoom?t.maxZoom:o,l=void 0!==t.zoomFactor?t.zoomFactor:i,c=void 0!==t.multiWorld&&t.multiWorld,p=void 0===t.smoothResolutionConstraint||t.smoothResolutionConstraint,d=void 0!==t.showFullExtent&&t.showFullExtent,h=lo(t.projection,"EPSG:3857"),f=h.getExtent(),m=t.constrainOnlyCenter,g=t.extent;c||g||!h.isGlobal()||(m=!1,g=f);if(void 0!==t.resolutions){var y=t.resolutions;n=y[a],r=void 0!==y[s]?y[s]:y[y.length-1],e=t.constrainResolution?function(t,e,n,r){return function(o,i,a,s){if(void 0!==o){var l=t[0],c=t[t.length-1],p=n?Oo(l,n,a,r):l;if(s)return void 0===e||e?xo(o,p,c):It(o,c,p);var d=Math.min(p,o),h=Math.floor(u(t,d,i));return t[h]>p&&h<t.length-1?t[h+1]:t[h]}}}(y,p,!m&&g,d):Io(n,r,p,!m&&g,d)}else{var v=(f?Math.max(Tt(f),wt(f)):360*Tr[Pr.DEGREES]/h.getMetersPerUnit())/Ir/Math.pow(i,0),_=v/Math.pow(i,o-0);void 0!==(n=t.maxResolution)?a=0:n=v/Math.pow(l,a),void 0===(r=t.minResolution)&&(r=void 0!==t.maxZoom?void 0!==t.maxResolution?n/Math.pow(l,s):v/Math.pow(l,s):_),s=a+Math.floor(Math.log(n/r)/Math.log(l)),r=n/Math.pow(l,s-a),e=t.constrainResolution?function(t,e,n,r,o,i){return function(a,s,l,c){if(void 0!==a){var u=o?Oo(e,o,l,i):e,p=void 0!==n?n:0;if(c)return void 0===r||r?xo(a,u,p):It(a,p,u);var d=Math.ceil(Math.log(e/u)/Math.log(t)-1e-9),h=-s*(.5-1e-9)+.5,f=Math.min(u,a),m=Math.floor(Math.log(e/f)/Math.log(t)+h),g=Math.max(d,m);return It(e/Math.pow(t,g),p,u)}}}(l,n,r,p,!m&&g,d):Io(n,r,p,!m&&g,d)}return{constraint:e,maxResolution:n,minResolution:r,minZoom:a,zoomFactor:l}}(t);this.maxResolution_=r.maxResolution,this.minResolution_=r.minResolution,this.zoomFactor_=r.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=r.minZoom;var o=function(t){if(void 0!==t.extent){var e=void 0===t.smoothExtentConstraint||t.smoothExtentConstraint;return Po(t.extent,t.constrainOnlyCenter,e)}var n=lo(t.projection,"EPSG:3857");if(!0!==t.multiWorld&&n.isGlobal()){var r=n.getExtent().slice();return r[0]=-1/0,r[2]=1/0,Po(r,!1,!1)}return Ao}(t),i=r.constraint,a=function(t){if(void 0===t.enableRotation||t.enableRotation){var e=t.constrainRotation;return void 0===e||!0===e?(i=o||kt(5),function(t,e){return e?t:void 0!==t?Math.abs(t)<=i?0:t:void 0}):!1===e?Ro:"number"==typeof e?(n=e,r=2*Math.PI/n,function(t,e){return e?t:void 0!==t?t=Math.floor(t/r+.5)*r:void 0}):Ro}return Mo;var n,r;var o,i}(t);this.constraints_={center:o,resolution:i,rotation:a},this.setRotation(void 0!==t.rotation?t.rotation:0),this.setCenterInternal(void 0!==t.center?t.center:null),void 0!==t.resolution?this.setResolution(t.resolution):void 0!==t.zoom&&this.setZoom(t.zoom)},Object.defineProperty(e.prototype,"padding",{get:function(){return this.padding_},set:function(t){var e=this.padding_;this.padding_=t;var n=this.getCenter();if(n){var r=t||[0,0,0,0];e=e||[0,0,0,0];var o=this.getResolution(),i=o/2*(r[3]-e[3]+e[1]-r[1]),a=o/2*(r[0]-e[0]+e[2]-r[2]);this.setCenterInternal([n[0]+i,n[1]-a])}},enumerable:!1,configurable:!0}),e.prototype.getUpdatedOptions_=function(t){var e=this.getProperties();return void 0!==e.resolution?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),oe({},e,t)},e.prototype.animate=function(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);for(var e=new Array(arguments.length),n=0;n<e.length;++n){var r=arguments[n];r.center&&((r=oe({},r)).center=wo(r.center,this.getProjection())),r.anchor&&((r=oe({},r)).anchor=wo(r.anchor,this.getProjection())),e[n]=r}this.animateInternal.apply(this,e)},e.prototype.animateInternal=function(t){var e,n=arguments.length;n>1&&"function"==typeof arguments[n-1]&&(e=arguments[n-1],--n);for(var r=0;r<n&&!this.isDef();++r){var o=arguments[r];o.center&&this.setCenterInternal(o.center),void 0!==o.zoom?this.setZoom(o.zoom):o.resolution&&this.setResolution(o.resolution),void 0!==o.rotation&&this.setRotation(o.rotation)}if(r!==n){for(var i=Date.now(),a=this.targetCenter_.slice(),s=this.targetResolution_,l=this.targetRotation_,c=[];r<n;++r){var u=arguments[r],p={start:i,complete:!1,anchor:u.anchor,duration:void 0!==u.duration?u.duration:1e3,easing:u.easing||ko,callback:e};if(u.center&&(p.sourceCenter=a,p.targetCenter=u.center.slice(),a=p.targetCenter),void 0!==u.zoom?(p.sourceResolution=s,p.targetResolution=this.getResolutionForZoom(u.zoom),s=p.targetResolution):u.resolution&&(p.sourceResolution=s,p.targetResolution=u.resolution,s=p.targetResolution),void 0!==u.rotation){p.sourceRotation=l;var d=Nt(u.rotation-l+Math.PI,2*Math.PI)-Math.PI;p.targetRotation=l+d,l=p.targetRotation}Gi(p)?p.complete=!0:i+=p.duration,c.push(p)}this.animations_.push(c),this.setHint(Ar,1),this.updateAnimations_()}else e&&Ui(e,!0)},e.prototype.getAnimating=function(){return this.hints_[Ar]>0},e.prototype.getInteracting=function(){return this.hints_[Or]>0},e.prototype.cancelAnimations=function(){var t;this.setHint(Ar,-this.hints_[Ar]);for(var e=0,n=this.animations_.length;e<n;++e){var r=this.animations_[e];if(r[0].callback&&Ui(r[0].callback,!1),!t)for(var o=0,i=r.length;o<i;++o){var a=r[o];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN},e.prototype.updateAnimations_=function(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),this.getAnimating()){for(var t=Date.now(),e=!1,n=this.animations_.length-1;n>=0;--n){for(var r=this.animations_[n],o=!0,i=0,a=r.length;i<a;++i){var s=r[i];if(!s.complete){var l=t-s.start,c=s.duration>0?l/s.duration:1;c>=1?(s.complete=!0,c=1):o=!1;var u=s.easing(c);if(s.sourceCenter){var p=s.sourceCenter[0],d=s.sourceCenter[1],h=s.targetCenter[0],f=s.targetCenter[1];this.nextCenter_=s.targetCenter;var m=p+u*(h-p),g=d+u*(f-d);this.targetCenter_=[m,g]}if(s.sourceResolution&&s.targetResolution){var y=1===u?s.targetResolution:s.sourceResolution+u*(s.targetResolution-s.sourceResolution);if(s.anchor){var v=this.getViewportSize_(this.getRotation()),_=this.constraints_.resolution(y,0,v,!0);this.targetCenter_=this.calculateCenterZoom(_,s.anchor)}this.nextResolution_=s.targetResolution,this.targetResolution_=y,this.applyTargetState_(!0)}if(void 0!==s.sourceRotation&&void 0!==s.targetRotation){var C=1===u?Nt(s.targetRotation+Math.PI,2*Math.PI)-Math.PI:s.sourceRotation+u*(s.targetRotation-s.sourceRotation);if(s.anchor){var E=this.constraints_.rotation(C,!0);this.targetCenter_=this.calculateCenterRotate(E,s.anchor)}this.nextRotation_=s.targetRotation,this.targetRotation_=C}if(this.applyTargetState_(!0),e=!0,!s.complete)break}}if(o){this.animations_[n]=null,this.setHint(Ar,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;var w=r[0].callback;w&&Ui(w,!0)}}this.animations_=this.animations_.filter(Boolean),e&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}},e.prototype.calculateCenterRotate=function(t,e){var n,r=this.getCenterInternal();return void 0!==r&&(We(n=[r[0]-e[0],r[1]-e[1]],t-this.getRotation()),Ge(n,e)),n},e.prototype.calculateCenterZoom=function(t,e){var n,r=this.getCenterInternal(),o=this.getResolution();void 0!==r&&void 0!==o&&(n=[e[0]-t*(e[0]-r[0])/o,e[1]-t*(e[1]-r[1])/o]);return n},e.prototype.getViewportSize_=function(t){var e=this.viewportSize_;if(t){var n=e[0],r=e[1];return[Math.abs(n*Math.cos(t))+Math.abs(r*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(r*Math.cos(t))]}return e},e.prototype.setViewportSize=function(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)},e.prototype.getCenter=function(){var t=this.getCenterInternal();return t?Eo(t,this.getProjection()):t},e.prototype.getCenterInternal=function(){return this.get(xr.CENTER)},e.prototype.getConstraints=function(){return this.constraints_},e.prototype.getConstrainResolution=function(){return this.get("constrainResolution")},e.prototype.getHints=function(t){return void 0!==t?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()},e.prototype.calculateExtent=function(t){return So(this.calculateExtentInternal(t),this.getProjection())},e.prototype.calculateExtentInternal=function(t){var e=t||this.getViewportSizeMinusPadding_(),n=this.getCenterInternal();x(n,1);var r=this.getResolution();x(void 0!==r,2);var o=this.getRotation();return x(void 0!==o,3),Et(n,r,o,e)},e.prototype.getMaxResolution=function(){return this.maxResolution_},e.prototype.getMinResolution=function(){return this.minResolution_},e.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)},e.prototype.setMaxZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))},e.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)},e.prototype.setMinZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))},e.prototype.setConstrainResolution=function(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))},e.prototype.getProjection=function(){return this.projection_},e.prototype.getResolution=function(){return this.get(xr.RESOLUTION)},e.prototype.getResolutions=function(){return this.resolutions_},e.prototype.getResolutionForExtent=function(t,e){return this.getResolutionForExtentInternal(bo(t,this.getProjection()),e)},e.prototype.getResolutionForExtentInternal=function(t,e){var n=e||this.getViewportSizeMinusPadding_(),r=Tt(t)/n[0],o=wt(t)/n[1];return Math.max(r,o)},e.prototype.getResolutionForValueFunction=function(t){var e=t||2,n=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,o=Math.log(n/r)/Math.log(e);return function(t){return n/Math.pow(e,t*o)}},e.prototype.getRotation=function(){return this.get(xr.ROTATION)},e.prototype.getValueForResolutionFunction=function(t){var e=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,o=Math.log(n/r)/e;return function(t){return Math.log(n/t)/e/o}},e.prototype.getViewportSizeMinusPadding_=function(t){var e=this.getViewportSize_(t),n=this.padding_;return n&&(e=[e[0]-n[1]-n[3],e[1]-n[0]-n[2]]),e},e.prototype.getState=function(){var t=this.getProjection(),e=this.getResolution(),n=this.getRotation(),r=this.getCenterInternal(),o=this.padding_;if(o){var i=this.getViewportSizeMinusPadding_();r=Bi(r,this.getViewportSize_(),[i[0]/2+o[3],i[1]/2+o[0]],e,n)}return{center:r.slice(0),projection:void 0!==t?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}},e.prototype.getZoom=function(){var t,e=this.getResolution();return void 0!==e&&(t=this.getZoomForResolution(e)),t},e.prototype.getZoomForResolution=function(t){var e,n,r=this.minZoom_||0;if(this.resolutions_){var o=u(this.resolutions_,t,1);r=o,e=this.resolutions_[o],n=o==this.resolutions_.length-1?2:e/this.resolutions_[o+1]}else e=this.maxResolution_,n=this.zoomFactor_;return r+Math.log(e/t)/Math.log(n)},e.prototype.getResolutionForZoom=function(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;var e=It(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(n,It(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)},e.prototype.fit=function(t,e){var n;if(x(Array.isArray(t)||"function"==typeof t.getSimplifiedGeometry,24),Array.isArray(t))x(!At(t),25),n=Di(r=bo(t,this.getProjection()));else if(t.getType()===br.CIRCLE){var r;(n=Di(r=bo(t.getExtent(),this.getProjection()))).rotate(this.getRotation(),_t(r))}else{var o=Co();n=o?t.clone().transform(o,this.getProjection()):t}this.fitInternal(n,e)},e.prototype.rotatedExtentForGeometry=function(t){for(var e=this.getRotation(),n=Math.cos(e),r=Math.sin(-e),o=t.getFlatCoordinates(),i=t.getStride(),a=1/0,s=1/0,l=-1/0,c=-1/0,u=0,p=o.length;u<p;u+=i){var d=o[u]*n-o[u+1]*r,h=o[u]*r+o[u+1]*n;a=Math.min(a,d),s=Math.min(s,h),l=Math.max(l,d),c=Math.max(c,h)}return[a,s,l,c]},e.prototype.fitInternal=function(t,e){var n=e||{},r=n.size;r||(r=this.getViewportSizeMinusPadding_());var o,i=void 0!==n.padding?n.padding:[0,0,0,0],a=void 0!==n.nearest&&n.nearest;o=void 0!==n.minResolution?n.minResolution:void 0!==n.maxZoom?this.getResolutionForZoom(n.maxZoom):0;var s=this.rotatedExtentForGeometry(t),l=this.getResolutionForExtentInternal(s,[r[0]-i[1]-i[3],r[1]-i[0]-i[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,a?0:1);var c=this.getRotation(),u=Math.sin(c),p=Math.cos(c),d=_t(s);d[0]+=(i[1]-i[3])/2*l,d[1]+=(i[0]-i[2])/2*l;var h=d[0]*p-d[1]*u,f=d[1]*p+d[0]*u,m=this.getConstrainedCenter([h,f],l),g=n.callback?n.callback:v;void 0!==n.duration?this.animateInternal({resolution:l,center:m,duration:n.duration,easing:n.easing},g):(this.targetResolution_=l,this.targetCenter_=m,this.applyTargetState_(!1,!0),Ui(g,!0))},e.prototype.centerOn=function(t,e,n){this.centerOnInternal(wo(t,this.getProjection()),e,n)},e.prototype.centerOnInternal=function(t,e,n){this.setCenterInternal(Bi(t,e,n,this.getResolution(),this.getRotation()))},e.prototype.calculateCenterShift=function(t,e,n,r){var o,i=this.padding_;if(i&&t){var a=this.getViewportSizeMinusPadding_(-n),s=Bi(t,r,[a[0]/2+i[3],a[1]/2+i[0]],e,n);o=[t[0]-s[0],t[1]-s[1]]}return o},e.prototype.isDef=function(){return!!this.getCenterInternal()&&void 0!==this.getResolution()},e.prototype.adjustCenter=function(t){var e=Eo(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])},e.prototype.adjustCenterInternal=function(t){var e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])},e.prototype.adjustResolution=function(t,e){var n=e&&wo(e,this.getProjection());this.adjustResolutionInternal(t,n)},e.prototype.adjustResolutionInternal=function(t,e){var n=this.getAnimating()||this.getInteracting(),r=this.getViewportSize_(this.getRotation()),o=this.constraints_.resolution(this.targetResolution_*t,0,r,n);e&&(this.targetCenter_=this.calculateCenterZoom(o,e)),this.targetResolution_*=t,this.applyTargetState_()},e.prototype.adjustZoom=function(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)},e.prototype.adjustRotation=function(t,e){e&&(e=wo(e,this.getProjection())),this.adjustRotationInternal(t,e)},e.prototype.adjustRotationInternal=function(t,e){var n=this.getAnimating()||this.getInteracting(),r=this.constraints_.rotation(this.targetRotation_+t,n);e&&(this.targetCenter_=this.calculateCenterRotate(r,e)),this.targetRotation_+=t,this.applyTargetState_()},e.prototype.setCenter=function(t){this.setCenterInternal(t?wo(t,this.getProjection()):t)},e.prototype.setCenterInternal=function(t){this.targetCenter_=t,this.applyTargetState_()},e.prototype.setHint=function(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]},e.prototype.setResolution=function(t){this.targetResolution_=t,this.applyTargetState_()},e.prototype.setRotation=function(t){this.targetRotation_=t,this.applyTargetState_()},e.prototype.setZoom=function(t){this.setResolution(this.getResolutionForZoom(t))},e.prototype.applyTargetState_=function(t,e){var n=this.getAnimating()||this.getInteracting()||e,r=this.constraints_.rotation(this.targetRotation_,n),o=this.getViewportSize_(r),i=this.constraints_.resolution(this.targetResolution_,0,o,n),a=this.constraints_.center(this.targetCenter_,i,o,n,this.calculateCenterShift(this.targetCenter_,i,r,o));this.get(xr.ROTATION)!==r&&this.set(xr.ROTATION,r),this.get(xr.RESOLUTION)!==i&&(this.set(xr.RESOLUTION,i),this.set("zoom",this.getZoom(),!0)),a&&this.get(xr.CENTER)&&je(this.get(xr.CENTER),a)||this.set(xr.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0},e.prototype.resolveConstraints=function(t,e,n){var r=void 0!==t?t:200,o=e||0,i=this.constraints_.rotation(this.targetRotation_),a=this.getViewportSize_(i),s=this.constraints_.resolution(this.targetResolution_,o,a),l=this.constraints_.center(this.targetCenter_,s,a,!1,this.calculateCenterShift(this.targetCenter_,s,i,a));if(0===r&&!this.cancelAnchor_)return this.targetResolution_=s,this.targetRotation_=i,this.targetCenter_=l,void this.applyTargetState_();var c=n||(0===r?this.cancelAnchor_:void 0);this.cancelAnchor_=void 0,this.getResolution()===s&&this.getRotation()===i&&this.getCenterInternal()&&je(this.getCenterInternal(),l)||(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:i,center:l,resolution:s,duration:r,easing:Do,anchor:c}))},e.prototype.beginInteraction=function(){this.resolveConstraints(0),this.setHint(Or,1)},e.prototype.endInteraction=function(t,e,n){var r=n&&wo(n,this.getProjection());this.endInteractionInternal(t,e,r)},e.prototype.endInteractionInternal=function(t,e,n){this.setHint(Or,-1),this.resolveConstraints(t,e,n)},e.prototype.getConstrainedCenter=function(t,e){var n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),n)},e.prototype.getConstrainedZoom=function(t,e){var n=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(n,e))},e.prototype.getConstrainedResolution=function(t,e){var n=e||0,r=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,n,r)},e}(Ee);function Ui(t,e){setTimeout((function(){t(e)}),0)}function Gi(t){return!(t.sourceCenter&&t.targetCenter&&!je(t.sourceCenter,t.targetCenter))&&(t.sourceResolution===t.targetResolution&&t.sourceRotation===t.targetRotation)}function Bi(t,e,n,r,o){var i=Math.cos(-o),a=Math.sin(-o),s=t[0]*i-t[1]*a,l=t[1]*i+t[0]*a;return[(s+=(e[0]/2-n[0])*r)*i-(l+=(n[1]-e[1]/2)*r)*(a=-a),l*i+s*a]}const ji=Fi;function Wi(t){return t[0]>0&&t[1]>0}function qi(t,e){return Array.isArray(t)?t:(void 0===e?e=[t,t]:(e[0]=t,e[1]=t),e)}var Hi=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function Vi(t){t instanceof Ue?t.setMapInternal(null):t instanceof Xn&&t.getLayers().forEach(Vi)}function zi(t,e){if(t instanceof Ue)t.setMapInternal(e);else if(t instanceof Xn)for(var n=t.getLayers().getArray(),r=0,o=n.length;r<o;++r)zi(n[r],e)}var Yi=function(t){function e(e){var n=t.call(this)||this;n.on,n.once,n.un;var r=function(t){var e=null;void 0!==t.keyboardEventTarget&&(e="string"==typeof t.keyboardEventTarget?document.getElementById(t.keyboardEventTarget):t.keyboardEventTarget);var n,r,o,i={},a=t.layers&&"function"==typeof t.layers.getLayers?t.layers:new Xn({layers:t.layers});i[ur]=a,i[dr]=t.target,i[hr]=t.view instanceof ji?t.view:new ji,void 0!==t.controls&&(Array.isArray(t.controls)?n=new Vn(t.controls.slice()):(x("function"==typeof t.controls.getArray,47),n=t.controls));void 0!==t.interactions&&(Array.isArray(t.interactions)?r=new Vn(t.interactions.slice()):(x("function"==typeof t.interactions.getArray,48),r=t.interactions));void 0!==t.overlays?Array.isArray(t.overlays)?o=new Vn(t.overlays.slice()):(x("function"==typeof t.overlays.getArray,49),o=t.overlays):o=new Vn;return{controls:n,interactions:r,keyboardEventTarget:e,overlays:o,values:i}}(e);n.renderComplete_,n.boundHandleBrowserEvent_=n.handleBrowserEvent.bind(n),n.maxTilesLoading_=void 0!==e.maxTilesLoading?e.maxTilesLoading:16,n.pixelRatio_=void 0!==e.pixelRatio?e.pixelRatio:b,n.postRenderTimeoutHandle_,n.animationDelayKey_,n.animationDelay_=function(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}.bind(n),n.coordinateToPixelTransform_=[1,0,0,1,0,0],n.pixelToCoordinateTransform_=[1,0,0,1,0,0],n.frameIndex_=0,n.frameState_=null,n.previousExtent_=null,n.viewPropertyListenerKey_=null,n.viewChangeListenerKey_=null,n.layerGroupPropertyListenerKeys_=null,n.viewport_=document.createElement("div"),n.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),n.viewport_.style.position="relative",n.viewport_.style.overflow="hidden",n.viewport_.style.width="100%",n.viewport_.style.height="100%",n.overlayContainer_=document.createElement("div"),n.overlayContainer_.style.position="absolute",n.overlayContainer_.style.zIndex="0",n.overlayContainer_.style.width="100%",n.overlayContainer_.style.height="100%",n.overlayContainer_.style.pointerEvents="none",n.overlayContainer_.className="ol-overlaycontainer",n.viewport_.appendChild(n.overlayContainer_),n.overlayContainerStopEvent_=document.createElement("div"),n.overlayContainerStopEvent_.style.position="absolute",n.overlayContainerStopEvent_.style.zIndex="0",n.overlayContainerStopEvent_.style.width="100%",n.overlayContainerStopEvent_.style.height="100%",n.overlayContainerStopEvent_.style.pointerEvents="none",n.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",n.viewport_.appendChild(n.overlayContainerStopEvent_),n.mapBrowserEventHandler_=null,n.moveTolerance_=e.moveTolerance,n.keyboardEventTarget_=r.keyboardEventTarget,n.targetChangeHandlerKeys_=null,n.controls=r.controls||new Vn,n.interactions=r.interactions||new Vn,n.overlays_=r.overlays,n.overlayIdIndex_={},n.renderer_=null,n.postRenderFunctions_=[],n.tileQueue_=new Sr(n.getTilePriority.bind(n),n.handleTileChange_.bind(n)),n.addChangeListener(ur,n.handleLayerGroupChanged_),n.addChangeListener(hr,n.handleViewChanged_),n.addChangeListener(pr,n.handleSizeChanged_),n.addChangeListener(dr,n.handleTargetChanged_),n.setProperties(r.values);var o=n;return!e.view||e.view instanceof ji||e.view.then((function(t){o.setView(new ji(t))})),n.controls.addEventListener(Bn,function(t){t.element.setMap(this)}.bind(n)),n.controls.addEventListener(jn,function(t){t.element.setMap(null)}.bind(n)),n.interactions.addEventListener(Bn,function(t){t.element.setMap(this)}.bind(n)),n.interactions.addEventListener(jn,function(t){t.element.setMap(null)}.bind(n)),n.overlays_.addEventListener(Bn,function(t){this.addOverlayInternal_(t.element)}.bind(n)),n.overlays_.addEventListener(jn,function(t){var e=t.element.getId();void 0!==e&&delete this.overlayIdIndex_[e.toString()],t.element.setMap(null)}.bind(n)),n.controls.forEach(function(t){t.setMap(this)}.bind(n)),n.interactions.forEach(function(t){t.setMap(this)}.bind(n)),n.overlays_.forEach(n.addOverlayInternal_.bind(n)),n}return Hi(e,t),e.prototype.createRenderer=function(){throw new Error("Use a map type that has a createRenderer method")},e.prototype.addControl=function(t){this.getControls().push(t)},e.prototype.addInteraction=function(t){this.getInteractions().push(t)},e.prototype.addLayer=function(t){this.getLayerGroup().getLayers().push(t)},e.prototype.handleLayerAdd_=function(t){zi(t.layer,this)},e.prototype.addOverlay=function(t){this.getOverlays().push(t)},e.prototype.addOverlayInternal_=function(t){var e=t.getId();void 0!==e&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)},e.prototype.disposeInternal=function(){this.setTarget(null),t.prototype.disposeInternal.call(this)},e.prototype.forEachFeatureAtPixel=function(t,e,n){if(this.frameState_){var r=this.getCoordinateFromPixelInternal(t),o=void 0!==(n=void 0!==n?n:{}).hitTolerance?n.hitTolerance:0,i=void 0!==n.layerFilter?n.layerFilter:g,a=!1!==n.checkWrapped;return this.renderer_.forEachFeatureAtCoordinate(r,this.frameState_,o,a,e,null,i,null)}},e.prototype.getFeaturesAtPixel=function(t,e){var n=[];return this.forEachFeatureAtPixel(t,(function(t){n.push(t)}),e),n},e.prototype.getAllLayers=function(){var t=[];return function e(n){n.forEach((function(n){n instanceof Xn?e(n.getLayers()):t.push(n)}))}(this.getLayers()),t},e.prototype.forEachLayerAtPixel=function(t,e,n){if(this.frameState_){var r=n||{},o=void 0!==r.hitTolerance?r.hitTolerance:0,i=r.layerFilter||g;return this.renderer_.forEachLayerAtPixel(t,this.frameState_,o,e,i)}},e.prototype.hasFeatureAtPixel=function(t,e){if(!this.frameState_)return!1;var n=this.getCoordinateFromPixelInternal(t),r=void 0!==(e=void 0!==e?e:{}).layerFilter?e.layerFilter:g,o=void 0!==e.hitTolerance?e.hitTolerance:0,i=!1!==e.checkWrapped;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,o,i,r,null)},e.prototype.getEventCoordinate=function(t){return this.getCoordinateFromPixel(this.getEventPixel(t))},e.prototype.getEventCoordinateInternal=function(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))},e.prototype.getEventPixel=function(t){var e=this.viewport_.getBoundingClientRect(),n="changedTouches"in t?t.changedTouches[0]:t;return[n.clientX-e.left,n.clientY-e.top]},e.prototype.getTarget=function(){return this.get(dr)},e.prototype.getTargetElement=function(){var t=this.getTarget();return void 0!==t?"string"==typeof t?document.getElementById(t):t:null},e.prototype.getCoordinateFromPixel=function(t){return Eo(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())},e.prototype.getCoordinateFromPixelInternal=function(t){var e=this.frameState_;return e?k(e.pixelToCoordinateTransform,t.slice()):null},e.prototype.getControls=function(){return this.controls},e.prototype.getOverlays=function(){return this.overlays_},e.prototype.getOverlayById=function(t){var e=this.overlayIdIndex_[t.toString()];return void 0!==e?e:null},e.prototype.getInteractions=function(){return this.interactions},e.prototype.getLayerGroup=function(){return this.get(ur)},e.prototype.setLayers=function(t){var e=this.getLayerGroup();if(t instanceof Vn)e.setLayers(t);else{var n=e.getLayers();n.clear(),n.extend(t)}},e.prototype.getLayers=function(){return this.getLayerGroup().getLayers()},e.prototype.getLoadingOrNotReady=function(){for(var t=this.getLayerGroup().getLayerStatesArray(),e=0,n=t.length;e<n;++e){var r=t[e].layer;if(!r.getRenderer().ready)return!0;var o=r.getSource();if(o&&o.loading)return!0}return!1},e.prototype.getPixelFromCoordinate=function(t){var e=wo(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)},e.prototype.getPixelFromCoordinateInternal=function(t){var e=this.frameState_;return e?k(e.coordinateToPixelTransform,t.slice(0,2)):null},e.prototype.getRenderer=function(){return this.renderer_},e.prototype.getSize=function(){return this.get(pr)},e.prototype.getView=function(){return this.get(hr)},e.prototype.getViewport=function(){return this.viewport_},e.prototype.getOverlayContainer=function(){return this.overlayContainer_},e.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},e.prototype.getOwnerDocument=function(){var t=this.getTargetElement();return t?t.ownerDocument:document},e.prototype.getTilePriority=function(t,e,n,r){return function(t,e,n,r,o){if(!t||!(n in t.wantedTiles))return fr;if(!t.wantedTiles[n][e.getKey()])return fr;var i=t.viewState.center,a=r[0]-i[0],s=r[1]-i[1];return 65536*Math.log(o)+Math.sqrt(a*a+s*s)/o}(this.frameState_,t,e,n,r)},e.prototype.handleBrowserEvent=function(t,e){var n=e||t.type,r=new nr(n,this,t);this.handleMapBrowserEvent(r)},e.prototype.handleMapBrowserEvent=function(t){if(this.frameState_){var e=t.originalEvent,n=e.type;if(n===ir||n===pe.WHEEL||n===pe.KEYDOWN){var r=this.getOwnerDocument(),o=this.viewport_.getRootNode?this.viewport_.getRootNode():r,i=e.target;if(this.overlayContainerStopEvent_.contains(i)||!(o===r?r.documentElement:o).contains(i))return}if(t.frameState=this.frameState_,!1!==this.dispatchEvent(t))for(var a=this.getInteractions().getArray().slice(),s=a.length-1;s>=0;s--){var l=a[s];if(l.getMap()===this&&l.getActive()&&this.getTargetElement())if(!l.handleEvent(t)||t.propagationStopped)break}}},e.prototype.handlePostRender=function(){var t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){var n=this.maxTilesLoading_,r=n;if(t){var o=t.viewHints;if(o[Ar]||o[Or]){var i=Date.now()-t.time>8;n=i?0:8,r=i?0:2}}e.getTilesLoading()<n&&(e.reprioritize(),e.loadMoreTiles(n,r))}t&&this.hasListener(Ze.RENDERCOMPLETE)&&!t.animate&&this.renderComplete_&&this.renderer_.dispatchRenderEvent(Ze.RENDERCOMPLETE,t);for(var a=this.postRenderFunctions_,s=0,l=a.length;s<l;++s)a[s](this,t);a.length=0},e.prototype.handleSizeChanged_=function(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()},e.prototype.handleTargetChanged_=function(){if(this.mapBrowserEventHandler_){for(var t=0,e=this.targetChangeHandlerKeys_.length;t<e;++t)fe(this.targetChangeHandlerKeys_[t]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(pe.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(pe.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,gn(this.viewport_)}var n=this.getTargetElement();if(n){for(var r in n.appendChild(this.viewport_),this.renderer_||(this.renderer_=this.createRenderer()),this.mapBrowserEventHandler_=new lr(this,this.moveTolerance_),rr)this.mapBrowserEventHandler_.addEventListener(rr[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(pe.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(pe.WHEEL,this.boundHandleBrowserEvent_,!!P&&{passive:!1});var o=this.getOwnerDocument().defaultView,i=this.keyboardEventTarget_?this.keyboardEventTarget_:n;this.targetChangeHandlerKeys_=[de(i,pe.KEYDOWN,this.handleBrowserEvent,this),de(i,pe.KEYPRESS,this.handleBrowserEvent,this),de(o,pe.RESIZE,this.updateSize,this)]}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()},e.prototype.handleTileChange_=function(){this.render()},e.prototype.handleViewPropertyChanged_=function(){this.render()},e.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&(fe(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(fe(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var t=this.getView();t&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=de(t,re,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=de(t,pe.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()},e.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(fe),this.layerGroupPropertyListenerKeys_=null);var t=this.getLayerGroup();t&&(this.handleLayerAdd_(new Yn("addlayer",t)),this.layerGroupPropertyListenerKeys_=[de(t,re,this.render,this),de(t,pe.CHANGE,this.render,this),de(t,"addlayer",this.handleLayerAdd_,this),de(t,"removelayer",this.handleLayerRemove_,this)]),this.render()},e.prototype.isRendered=function(){return!!this.frameState_},e.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()},e.prototype.redrawText=function(){for(var t=this.getLayerGroup().getLayerStatesArray(),e=0,n=t.length;e<n;++e){var r=t[e].layer;r.hasRenderer()&&r.getRenderer().handleFontsChanged()}},e.prototype.render=function(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))},e.prototype.removeControl=function(t){return this.getControls().remove(t)},e.prototype.removeInteraction=function(t){return this.getInteractions().remove(t)},e.prototype.removeLayer=function(t){return this.getLayerGroup().getLayers().remove(t)},e.prototype.handleLayerRemove_=function(t){Vi(t.layer)},e.prototype.removeOverlay=function(t){return this.getOverlays().remove(t)},e.prototype.renderFrame_=function(t){var e=this,n=this.getSize(),r=this.getView(),o=this.frameState_,a=null;if(void 0!==n&&Wi(n)&&r&&r.isDef()){var s=r.getHints(this.frameState_?this.frameState_.viewHints:void 0),l=r.getState();if(a={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:Et(l.center,l.resolution,l.rotation,n),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:n,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:l,viewHints:s,wantedTiles:{},mapId:i(this),renderTargets:{}},l.nextCenter&&l.nextResolution){var c=isNaN(l.nextRotation)?l.rotation:l.nextRotation;a.nextExtent=Et(l.nextCenter,l.nextResolution,c,n)}}if(this.frameState_=a,this.renderer_.renderFrame(a),a){if(a.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,a.postRenderFunctions),o)(!this.previousExtent_||!At(this.previousExtent_)&&!ut(a.extent,this.previousExtent_))&&(this.dispatchEvent(new Qn(cr.MOVESTART,this,o)),this.previousExtent_=st(this.previousExtent_));this.previousExtent_&&!a.viewHints[Ar]&&!a.viewHints[Or]&&!ut(a.extent,this.previousExtent_)&&(this.dispatchEvent(new Qn(cr.MOVEEND,this,a)),Q(a.extent,this.previousExtent_))}this.dispatchEvent(new Qn(cr.POSTRENDER,this,a)),this.renderComplete_=!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout((function(){e.postRenderTimeoutHandle_=void 0,e.handlePostRender()}),0))},e.prototype.setLayerGroup=function(t){var e=this.getLayerGroup();e&&this.handleLayerRemove_(new Yn("removelayer",e)),this.set(ur,t)},e.prototype.setSize=function(t){this.set(pr,t)},e.prototype.setTarget=function(t){this.set(dr,t)},e.prototype.setView=function(t){if(!t||t instanceof ji)this.set(hr,t);else{this.set(hr,new ji);var e=this;t.then((function(t){e.setView(new ji(t))}))}},e.prototype.updateSize=function(){var t=this.getTargetElement(),e=void 0;if(t){var n=getComputedStyle(t),r=t.offsetWidth-parseFloat(n.borderLeftWidth)-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight)-parseFloat(n.borderRightWidth),o=t.offsetHeight-parseFloat(n.borderTopWidth)-parseFloat(n.paddingTop)-parseFloat(n.paddingBottom)-parseFloat(n.borderBottomWidth);isNaN(r)||isNaN(o)||!Wi(e=[r,o])&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&console.warn("No map visible because the map container's width or height are 0.")}this.setSize(e),this.updateViewportSize_()},e.prototype.updateViewportSize_=function(){var t=this.getView();if(t){var e=void 0,n=getComputedStyle(this.viewport_);n.width&&n.height&&(e=[parseInt(n.width,10),parseInt(n.height,10)]),t.setViewportSize(e)}},e}(Ee);const Ki=Yi;var Xi=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const $i=function(t){function e(e){var n=t.call(this)||this,r=e.element;return!r||e.target||r.style.pointerEvents||(r.style.pointerEvents="auto"),n.element=r||null,n.target_=null,n.map_=null,n.listenerKeys=[],e.render&&(n.render=e.render),e.target&&n.setTarget(e.target),n}return Xi(e,t),e.prototype.disposeInternal=function(){gn(this.element),t.prototype.disposeInternal.call(this)},e.prototype.getMap=function(){return this.map_},e.prototype.setMap=function(t){this.map_&&gn(this.element);for(var e=0,n=this.listenerKeys.length;e<n;++e)fe(this.listenerKeys[e]);(this.listenerKeys.length=0,this.map_=t,t)&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==v&&this.listenerKeys.push(de(t,cr.POSTRENDER,this.render,this)),t.render())},e.prototype.render=function(t){},e.prototype.setTarget=function(t){this.target_="string"==typeof t?document.getElementById(t):t},e}(Ee);var Ji=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const Qi=function(t){function e(e){var n=this,r=e||{};(n=t.call(this,{element:document.createElement("div"),render:r.render,target:r.target})||this).ulElement_=document.createElement("ul"),n.collapsed_=void 0===r.collapsed||r.collapsed,n.userCollapsed_=n.collapsed_,n.overrideCollapsible_=void 0!==r.collapsible,n.collapsible_=void 0===r.collapsible||r.collapsible,n.collapsible_||(n.collapsed_=!1);var o=void 0!==r.className?r.className:"ol-attribution",i=void 0!==r.tipLabel?r.tipLabel:"Attributions",a=void 0!==r.expandClassName?r.expandClassName:o+"-expand",s=void 0!==r.collapseLabel?r.collapseLabel:"›",l=void 0!==r.collapseClassName?r.collapseClassName:o+"-collapse";"string"==typeof s?(n.collapseLabel_=document.createElement("span"),n.collapseLabel_.textContent=s,n.collapseLabel_.className=l):n.collapseLabel_=s;var c=void 0!==r.label?r.label:"i";"string"==typeof c?(n.label_=document.createElement("span"),n.label_.textContent=c,n.label_.className=a):n.label_=c;var u=n.collapsible_&&!n.collapsed_?n.collapseLabel_:n.label_;n.toggleButton_=document.createElement("button"),n.toggleButton_.setAttribute("type","button"),n.toggleButton_.setAttribute("aria-expanded",String(!n.collapsed_)),n.toggleButton_.title=i,n.toggleButton_.appendChild(u),n.toggleButton_.addEventListener(pe.CLICK,n.handleClick_.bind(n),!1);var p=o+" "+"ol-unselectable "+an+(n.collapsed_&&n.collapsible_?" ol-collapsed":"")+(n.collapsible_?"":" ol-uncollapsible"),d=n.element;return d.className=p,d.appendChild(n.toggleButton_),d.appendChild(n.ulElement_),n.renderedAttributions_=[],n.renderedVisible_=!0,n}return Ji(e,t),e.prototype.collectSourceAttributions_=function(t){for(var e={},n=[],r=!0,o=t.layerStatesArray,i=0,a=o.length;i<a;++i){var s=o[i];if(Fe(s,t.viewState)){var l=s.layer.getSource();if(l){var c=l.getAttributions();if(c){var u=c(t);if(u)if(r=r&&!1!==l.getAttributionsCollapsible(),Array.isArray(u))for(var p=0,d=u.length;p<d;++p)u[p]in e||(n.push(u[p]),e[u[p]]=!0);else u in e||(n.push(u),e[u]=!0)}}}}return this.overrideCollapsible_||this.setCollapsible(r),n},e.prototype.updateElement_=function(t){if(t){var e=this.collectSourceAttributions_(t),n=e.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!f(e,this.renderedAttributions_)){yn(this.ulElement_);for(var r=0,o=e.length;r<o;++r){var i=document.createElement("li");i.innerHTML=e[r],this.ulElement_.appendChild(i)}this.renderedAttributions_=e}}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)},e.prototype.handleClick_=function(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_},e.prototype.handleToggle_=function(){this.element.classList.toggle(sn),this.collapsed_?mn(this.collapseLabel_,this.label_):mn(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))},e.prototype.getCollapsible=function(){return this.collapsible_},e.prototype.setCollapsible=function(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())},e.prototype.setCollapsed=function(t){this.userCollapsed_=t,this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()},e.prototype.getCollapsed=function(){return this.collapsed_},e.prototype.render=function(t){this.updateElement_(t.frameState)},e}($i);var ta=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ea=function(t){function e(e){var n=this,r=e||{};n=t.call(this,{element:document.createElement("div"),render:r.render,target:r.target})||this;var o=void 0!==r.className?r.className:"ol-rotate",i=void 0!==r.label?r.label:"⇧",a=void 0!==r.compassClassName?r.compassClassName:"ol-compass";n.label_=null,"string"==typeof i?(n.label_=document.createElement("span"),n.label_.className=a,n.label_.textContent=i):(n.label_=i,n.label_.classList.add(a));var s=r.tipLabel?r.tipLabel:"Reset rotation",l=document.createElement("button");l.className=o+"-reset",l.setAttribute("type","button"),l.title=s,l.appendChild(n.label_),l.addEventListener(pe.CLICK,n.handleClick_.bind(n),!1);var c=o+" "+"ol-unselectable "+an,u=n.element;return u.className=c,u.appendChild(l),n.callResetNorth_=r.resetNorth?r.resetNorth:void 0,n.duration_=void 0!==r.duration?r.duration:250,n.autoHide_=void 0===r.autoHide||r.autoHide,n.rotation_=void 0,n.autoHide_&&n.element.classList.add(rn),n}return ta(e,t),e.prototype.handleClick_=function(t){t.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()},e.prototype.resetNorth_=function(){var t=this.getMap().getView();if(t){var e=t.getRotation();void 0!==e&&(this.duration_>0&&e%(2*Math.PI)!=0?t.animate({rotation:0,duration:this.duration_,easing:Do}):t.setRotation(0))}},e.prototype.render=function(t){var e=t.frameState;if(e){var n=e.viewState.rotation;if(n!=this.rotation_){var r="rotate("+n+"rad)";if(this.autoHide_){var o=this.element.classList.contains(rn);o||0!==n?o&&0!==n&&this.element.classList.remove(rn):this.element.classList.add(rn)}this.label_.style.transform=r}this.rotation_=n}},e}($i);const na=ea;var ra=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const oa=function(t){function e(e){var n=this,r=e||{};n=t.call(this,{element:document.createElement("div"),target:r.target})||this;var o=void 0!==r.className?r.className:"ol-zoom",i=void 0!==r.delta?r.delta:1,a=void 0!==r.zoomInClassName?r.zoomInClassName:o+"-in",s=void 0!==r.zoomOutClassName?r.zoomOutClassName:o+"-out",l=void 0!==r.zoomInLabel?r.zoomInLabel:"+",c=void 0!==r.zoomOutLabel?r.zoomOutLabel:"–",u=void 0!==r.zoomInTipLabel?r.zoomInTipLabel:"Zoom in",p=void 0!==r.zoomOutTipLabel?r.zoomOutTipLabel:"Zoom out",d=document.createElement("button");d.className=a,d.setAttribute("type","button"),d.title=u,d.appendChild("string"==typeof l?document.createTextNode(l):l),d.addEventListener(pe.CLICK,n.handleClick_.bind(n,i),!1);var h=document.createElement("button");h.className=s,h.setAttribute("type","button"),h.title=p,h.appendChild("string"==typeof c?document.createTextNode(c):c),h.addEventListener(pe.CLICK,n.handleClick_.bind(n,-i),!1);var f=o+" "+"ol-unselectable "+an,m=n.element;return m.className=f,m.appendChild(d),m.appendChild(h),n.duration_=void 0!==r.duration?r.duration:250,n}return ra(e,t),e.prototype.handleClick_=function(t,e){e.preventDefault(),this.zoomByDelta_(t)},e.prototype.zoomByDelta_=function(t){var e=this.getMap().getView();if(e){var n=e.getZoom();if(void 0!==n){var r=e.getConstrainedZoom(n+t);this.duration_>0?(e.getAnimating()&&e.cancelAnimations(),e.animate({zoom:r,duration:this.duration_,easing:Do})):e.setZoom(r)}}},e}($i);const ia="active";var aa=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function sa(t,e,n,r){var o=t.getZoom();if(void 0!==o){var i=t.getConstrainedZoom(o+e),a=t.getResolutionForZoom(i);t.getAnimating()&&t.cancelAnimations(),t.animate({resolution:a,anchor:n,duration:void 0!==r?r:250,easing:Do})}}const la=function(t){function e(e){var n=t.call(this)||this;return n.on,n.once,n.un,e&&e.handleEvent&&(n.handleEvent=e.handleEvent),n.map_=null,n.setActive(!0),n}return aa(e,t),e.prototype.getActive=function(){return this.get(ia)},e.prototype.getMap=function(){return this.map_},e.prototype.handleEvent=function(t){return!0},e.prototype.setActive=function(t){this.set(ia,t)},e.prototype.setMap=function(t){this.map_=t},e}(Ee);var ca=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const ua=function(t){function e(e){var n=t.call(this)||this,r=e||{};return n.delta_=r.delta?r.delta:1,n.duration_=void 0!==r.duration?r.duration:250,n}return ca(e,t),e.prototype.handleEvent=function(t){var e=!1;if(t.type==rr.DBLCLICK){var n=t.originalEvent,r=t.map,o=t.coordinate,i=n.shiftKey?-this.delta_:this.delta_;sa(r.getView(),i,o,this.duration_),n.preventDefault(),e=!0}return!e},e}(la);var pa=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),da=function(t){function e(e){var n=this,r=e||{};return n=t.call(this,r)||this,r.handleDownEvent&&(n.handleDownEvent=r.handleDownEvent),r.handleDragEvent&&(n.handleDragEvent=r.handleDragEvent),r.handleMoveEvent&&(n.handleMoveEvent=r.handleMoveEvent),r.handleUpEvent&&(n.handleUpEvent=r.handleUpEvent),r.stopDown&&(n.stopDown=r.stopDown),n.handlingDownUpSequence=!1,n.trackedPointers_={},n.targetPointers=[],n}return pa(e,t),e.prototype.getPointerCount=function(){return this.targetPointers.length},e.prototype.handleDownEvent=function(t){return!1},e.prototype.handleDragEvent=function(t){},e.prototype.handleEvent=function(t){if(!t.originalEvent)return!0;var e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==rr.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==rr.POINTERUP){var n=this.handleUpEvent(t);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(t.type==rr.POINTERDOWN){var r=this.handleDownEvent(t);this.handlingDownUpSequence=r,e=this.stopDown(r)}else t.type==rr.POINTERMOVE&&this.handleMoveEvent(t);return!e},e.prototype.handleMoveEvent=function(t){},e.prototype.handleUpEvent=function(t){return!1},e.prototype.stopDown=function(t){return t},e.prototype.updateTrackedPointers_=function(t){if(function(t){var e=t.type;return e===rr.POINTERDOWN||e===rr.POINTERDRAG||e===rr.POINTERUP}(t)){var e=t.originalEvent,n=e.pointerId.toString();t.type==rr.POINTERUP?delete this.trackedPointers_[n]:(t.type==rr.POINTERDOWN||n in this.trackedPointers_)&&(this.trackedPointers_[n]=e),this.targetPointers=ae(this.trackedPointers_)}},e}(la);function ha(t){for(var e=t.length,n=0,r=0,o=0;o<e;o++)n+=t[o].clientX,r+=t[o].clientY;return[n/e,r/e]}const fa=da;function ma(t){var e=arguments;return function(t){for(var n=!0,r=0,o=e.length;r<o&&(n=n&&e[r](t));++r);return n}}var ga=function(t){var e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},ya=function(t){return!t.map.getTargetElement().hasAttribute("tabindex")||function(t){var e=t.map.getTargetElement(),n=t.map.getOwnerDocument().activeElement;return e.contains(n)}(t)},va=g,_a=function(t){var e=t.originalEvent;return 0==e.button&&!(w&&S&&e.ctrlKey)},Ca=y,Ea=function(t){return t.type==rr.SINGLECLICK},wa=function(t){var e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},Sa=function(t){var e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},ba=function(t){var e=t.originalEvent.target.tagName;return"INPUT"!==e&&"SELECT"!==e&&"TEXTAREA"!==e},La=function(t){var e=t.originalEvent;return x(void 0!==e,56),"mouse"==e.pointerType},Ta=function(t){var e=t.originalEvent;return x(void 0!==e,56),e.isPrimary&&0===e.button},Pa=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Aa=function(t){function e(e){var n=t.call(this,{stopDown:y})||this,r=e||{};n.kinetic_=r.kinetic,n.lastCentroid=null,n.lastPointersCount_,n.panning_=!1;var o=r.condition?r.condition:ma(wa,Ta);return n.condition_=r.onFocusOnly?ma(ya,o):o,n.noKinetic_=!1,n}return Pa(e,t),e.prototype.handleDragEvent=function(t){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());var e=this.targetPointers,n=ha(e);if(e.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(n[0],n[1]),this.lastCentroid){var r=[this.lastCentroid[0]-n[0],n[1]-this.lastCentroid[1]],o=t.map.getView();qe(r,o.getResolution()),We(r,o.getRotation()),o.adjustCenterInternal(r)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=n,this.lastPointersCount_=e.length,t.originalEvent.preventDefault()},e.prototype.handleUpEvent=function(t){var e=t.map,n=e.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var r=this.kinetic_.getDistance(),o=this.kinetic_.getAngle(),i=n.getCenterInternal(),a=e.getPixelFromCoordinateInternal(i),s=e.getCoordinateFromPixelInternal([a[0]-r*Math.cos(o),a[1]-r*Math.sin(o)]);n.animateInternal({center:n.getConstrainedCenter(s),duration:500,easing:Do})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>0&&this.condition_(t)){var e=t.map.getView();return this.lastCentroid=null,e.getAnimating()&&e.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1},e}(fa);const Oa=Aa;var xa=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ia=function(t){function e(e){var n=this,r=e||{};return(n=t.call(this,{stopDown:y})||this).condition_=r.condition?r.condition:ga,n.lastAngle_=void 0,n.duration_=void 0!==r.duration?r.duration:250,n}return xa(e,t),e.prototype.handleDragEvent=function(t){if(La(t)){var e=t.map,n=e.getView();if(n.getConstraints().rotation!==Mo){var r=e.getSize(),o=t.pixel,i=Math.atan2(r[1]/2-o[1],o[0]-r[0]/2);if(void 0!==this.lastAngle_){var a=i-this.lastAngle_;n.adjustRotationInternal(-a)}this.lastAngle_=i}}},e.prototype.handleUpEvent=function(t){return!La(t)||(t.map.getView().endInteraction(this.duration_),!1)},e.prototype.handleDownEvent=function(t){return!!La(t)&&(!(!_a(t)||!this.condition_(t))&&(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0))},e}(fa);const Ma=Ia;var Ra=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Za=function(t){function e(e){var n=t.call(this)||this;return n.geometry_=null,n.element_=document.createElement("div"),n.element_.style.position="absolute",n.element_.style.pointerEvents="auto",n.element_.className="ol-box "+e,n.map_=null,n.startPixel_=null,n.endPixel_=null,n}return Ra(e,t),e.prototype.disposeInternal=function(){this.setMap(null)},e.prototype.render_=function(){var t=this.startPixel_,e=this.endPixel_,n="px",r=this.element_.style;r.left=Math.min(t[0],e[0])+n,r.top=Math.min(t[1],e[1])+n,r.width=Math.abs(e[0]-t[0])+n,r.height=Math.abs(e[1]-t[1])+n},e.prototype.setMap=function(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},e.prototype.setPixels=function(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()},e.prototype.createOrUpdateGeometry=function(){var t=this.startPixel_,e=this.endPixel_,n=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);n[4]=n[0].slice(),this.geometry_?this.geometry_.setCoordinates([n]):this.geometry_=new Zi([n])},e.prototype.getGeometry=function(){return this.geometry_},e}(s);const Da=Za;var ka=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Na="boxstart",Fa="boxdrag",Ua="boxend",Ga="boxcancel",Ba=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.coordinate=n,o.mapBrowserEvent=r,o}return ka(e,t),e}(ne);const ja=function(t){function e(e){var n=t.call(this)||this;n.on,n.once,n.un;var r=e||{};return n.box_=new Da(r.className||"ol-dragbox"),n.minArea_=void 0!==r.minArea?r.minArea:64,r.onBoxEnd&&(n.onBoxEnd=r.onBoxEnd),n.startPixel_=null,n.condition_=r.condition?r.condition:_a,n.boxEndCondition_=r.boxEndCondition?r.boxEndCondition:n.defaultBoxEndCondition,n}return ka(e,t),e.prototype.defaultBoxEndCondition=function(t,e,n){var r=n[0]-e[0],o=n[1]-e[1];return r*r+o*o>=this.minArea_},e.prototype.getGeometry=function(){return this.box_.getGeometry()},e.prototype.handleDragEvent=function(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new Ba(Fa,t.coordinate,t))},e.prototype.handleUpEvent=function(t){this.box_.setMap(null);var e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new Ba(e?Ua:Ga,t.coordinate,t)),!1},e.prototype.handleDownEvent=function(t){return!!this.condition_(t)&&(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Ba(Na,t.coordinate,t)),!0)},e.prototype.onBoxEnd=function(t){},e}(fa);var Wa=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const qa=function(t){function e(e){var n=this,r=e||{},o=r.condition?r.condition:Sa;return(n=t.call(this,{condition:o,className:r.className||"ol-dragzoom",minArea:r.minArea})||this).duration_=void 0!==r.duration?r.duration:200,n.out_=void 0!==r.out&&r.out,n}return Wa(e,t),e.prototype.onBoxEnd=function(t){var e=this.getMap().getView(),n=this.getGeometry();if(this.out_){var r=e.rotatedExtentForGeometry(n),o=e.getResolutionForExtentInternal(r),i=e.getResolution()/o;(n=n.clone()).scale(i*i)}e.fitInternal(n,{duration:this.duration_,easing:Do})},e}(ja),Ha=37,Va=38,za=39,Ya=40;var Ka=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const Xa=function(t){function e(e){var n=t.call(this)||this,r=e||{};return n.defaultCondition_=function(t){return wa(t)&&ba(t)},n.condition_=void 0!==r.condition?r.condition:n.defaultCondition_,n.duration_=void 0!==r.duration?r.duration:100,n.pixelDelta_=void 0!==r.pixelDelta?r.pixelDelta:128,n}return Ka(e,t),e.prototype.handleEvent=function(t){var e=!1;if(t.type==pe.KEYDOWN){var n=t.originalEvent,r=n.keyCode;if(this.condition_(t)&&(r==Ya||r==Ha||r==za||r==Va)){var o=t.map.getView(),i=o.getResolution()*this.pixelDelta_,a=0,s=0;r==Ya?s=-i:r==Ha?a=-i:r==za?a=i:s=i;var l=[a,s];We(l,o.getRotation()),function(t,e,n){var r=t.getCenterInternal();if(r){var o=[r[0]+e[0],r[1]+e[1]];t.animateInternal({duration:void 0!==n?n:250,easing:No,center:t.getConstrainedCenter(o)})}}(o,l,this.duration_),n.preventDefault(),e=!0}}return!e},e}(la);var $a=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const Ja=function(t){function e(e){var n=t.call(this)||this,r=e||{};return n.condition_=r.condition?r.condition:ba,n.delta_=r.delta?r.delta:1,n.duration_=void 0!==r.duration?r.duration:100,n}return $a(e,t),e.prototype.handleEvent=function(t){var e=!1;if(t.type==pe.KEYDOWN||t.type==pe.KEYPRESS){var n=t.originalEvent,r=n.charCode;if(this.condition_(t)&&(r=="+".charCodeAt(0)||r=="-".charCodeAt(0))){var o=t.map,i=r=="+".charCodeAt(0)?this.delta_:-this.delta_;sa(o.getView(),i,void 0,this.duration_),n.preventDefault(),e=!0}}return!e},e}(la);var Qa=function(){function t(t,e,n){this.decay_=t,this.minVelocity_=e,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}return t.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},t.prototype.update=function(t,e){this.points_.push(t,e,Date.now())},t.prototype.end=function(){if(this.points_.length<6)return!1;var t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;for(var n=e-3;n>0&&this.points_[n+2]>t;)n-=3;var r=this.points_[e+2]-this.points_[n+2];if(r<1e3/60)return!1;var o=this.points_[e]-this.points_[n],i=this.points_[e+1]-this.points_[n+1];return this.angle_=Math.atan2(i,o),this.initialVelocity_=Math.sqrt(o*o+i*i)/r,this.initialVelocity_>this.minVelocity_},t.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},t.prototype.getAngle=function(){return this.angle_},t}();const ts=Qa;var es=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ns="trackpad",rs="wheel";const os=function(t){function e(e){var n=this,r=e||{};(n=t.call(this,r)||this).totalDelta_=0,n.lastDelta_=0,n.maxDelta_=void 0!==r.maxDelta?r.maxDelta:1,n.duration_=void 0!==r.duration?r.duration:250,n.timeout_=void 0!==r.timeout?r.timeout:80,n.useAnchor_=void 0===r.useAnchor||r.useAnchor,n.constrainResolution_=void 0!==r.constrainResolution&&r.constrainResolution;var o=r.condition?r.condition:va;return n.condition_=r.onFocusOnly?ma(ya,o):o,n.lastAnchor_=null,n.startTime_=void 0,n.timeoutId_,n.mode_=void 0,n.trackpadEventGap_=400,n.trackpadTimeoutId_,n.deltaPerZoom_=300,n}return es(e,t),e.prototype.endInteraction_=function(){this.trackpadTimeoutId_=void 0,this.getMap().getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)},e.prototype.handleEvent=function(t){if(!this.condition_(t))return!0;if(t.type!==pe.WHEEL)return!0;var e,n=t.map,r=t.originalEvent;if(r.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate),t.type==pe.WHEEL&&(e=r.deltaY,E&&r.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(e/=b),r.deltaMode===WheelEvent.DOM_DELTA_LINE&&(e*=40)),0===e)return!1;this.lastDelta_=e;var o=Date.now();void 0===this.startTime_&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(e)<4?ns:rs);var i=n.getView();if(this.mode_===ns&&!i.getConstrainResolution()&&!this.constrainResolution_)return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(i.getAnimating()&&i.cancelAnimations(),i.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),i.adjustZoom(-e/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=o,!1;this.totalDelta_+=e;var a=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),a),!1},e.prototype.handleWheelZoom_=function(t){var e=t.getView();e.getAnimating()&&e.cancelAnimations();var n=-It(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),sa(e,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},e.prototype.setMouseAnchor=function(t){this.useAnchor_=t,t||(this.lastAnchor_=null)},e}(la);var is=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const as=function(t){function e(e){var n=this,r=e||{},o=r;return o.stopDown||(o.stopDown=y),(n=t.call(this,o)||this).anchor_=null,n.lastAngle_=void 0,n.rotating_=!1,n.rotationDelta_=0,n.threshold_=void 0!==r.threshold?r.threshold:.3,n.duration_=void 0!==r.duration?r.duration:250,n}return is(e,t),e.prototype.handleDragEvent=function(t){var e=0,n=this.targetPointers[0],r=this.targetPointers[1],o=Math.atan2(r.clientY-n.clientY,r.clientX-n.clientX);if(void 0!==this.lastAngle_){var i=o-this.lastAngle_;this.rotationDelta_+=i,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=i}this.lastAngle_=o;var a=t.map,s=a.getView();if(s.getConstraints().rotation!==Mo){var l=a.getViewport().getBoundingClientRect(),c=ha(this.targetPointers);c[0]-=l.left,c[1]-=l.top,this.anchor_=a.getCoordinateFromPixelInternal(c),this.rotating_&&(a.render(),s.adjustRotationInternal(e,this.anchor_))}},e.prototype.handleUpEvent=function(t){return!(this.targetPointers.length<2)||(t.map.getView().endInteraction(this.duration_),!1)},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1},e}(fa);var ss=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ls=function(t){function e(e){var n=this,r=e||{},o=r;return o.stopDown||(o.stopDown=y),(n=t.call(this,o)||this).anchor_=null,n.duration_=void 0!==r.duration?r.duration:400,n.lastDistance_=void 0,n.lastScaleDelta_=1,n}return ss(e,t),e.prototype.handleDragEvent=function(t){var e=1,n=this.targetPointers[0],r=this.targetPointers[1],o=n.clientX-r.clientX,i=n.clientY-r.clientY,a=Math.sqrt(o*o+i*i);void 0!==this.lastDistance_&&(e=this.lastDistance_/a),this.lastDistance_=a;var s=t.map,l=s.getView();1!=e&&(this.lastScaleDelta_=e);var c=s.getViewport().getBoundingClientRect(),u=ha(this.targetPointers);u[0]-=c.left,u[1]-=c.top,this.anchor_=s.getCoordinateFromPixelInternal(u),s.render(),l.adjustResolutionInternal(e,this.anchor_)},e.prototype.handleUpEvent=function(t){if(this.targetPointers.length<2){var e=t.map.getView(),n=this.lastScaleDelta_>1?1:-1;return e.endInteraction(this.duration_,n),!1}return!0},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1},e}(fa);const cs=ls;function us(t){var e=t||{},n=new Vn,r=new ts(-.005,.05,100);return(void 0===e.altShiftDragRotate||e.altShiftDragRotate)&&n.push(new Ma),(void 0===e.doubleClickZoom||e.doubleClickZoom)&&n.push(new ua({delta:e.zoomDelta,duration:e.zoomDuration})),(void 0===e.dragPan||e.dragPan)&&n.push(new Oa({onFocusOnly:e.onFocusOnly,kinetic:r})),(void 0===e.pinchRotate||e.pinchRotate)&&n.push(new as),(void 0===e.pinchZoom||e.pinchZoom)&&n.push(new cs({duration:e.zoomDuration})),(void 0===e.keyboard||e.keyboard)&&(n.push(new Xa),n.push(new Ja({delta:e.zoomDelta,duration:e.zoomDuration}))),(void 0===e.mouseWheelZoom||e.mouseWheelZoom)&&n.push(new os({onFocusOnly:e.onFocusOnly,duration:e.zoomDuration})),(void 0===e.shiftDragZoom||e.shiftDragZoom)&&n.push(new qa({duration:e.zoomDuration})),n}var ps=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const ds=function(t){function e(e){return(e=oe({},e)).controls||(e.controls=function(t){var e=t||{},n=new Vn;return(void 0===e.zoom||e.zoom)&&n.push(new oa(e.zoomOptions)),(void 0===e.rotate||e.rotate)&&n.push(new na(e.rotateOptions)),(void 0===e.attribution||e.attribution)&&n.push(new Qi(e.attributionOptions)),n}()),e.interactions||(e.interactions=us({onFocusOnly:!0})),t.call(this,e)||this}return ps(e,t),e.prototype.createRenderer=function(){return new Gn(this)},e}(Ki),hs={BOTTOM_LEFT:"bottom-left",BOTTOM_CENTER:"bottom-center",BOTTOM_RIGHT:"bottom-right",CENTER_LEFT:"center-left",CENTER_CENTER:"center-center",CENTER_RIGHT:"center-right",TOP_LEFT:"top-left",TOP_CENTER:"top-center",TOP_RIGHT:"top-right"};var fs=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ms="element",gs="map",ys="offset",vs="position",_s="positioning",Cs=function(t){function e(e){var n=t.call(this)||this;n.on,n.once,n.un,n.options=e,n.id=e.id,n.insertFirst=void 0===e.insertFirst||e.insertFirst,n.stopEvent=void 0===e.stopEvent||e.stopEvent,n.element=document.createElement("div"),n.element.className=void 0!==e.className?e.className:"ol-overlay-container ol-selectable",n.element.style.position="absolute",n.element.style.pointerEvents="auto";var r=e.autoPan;return r&&"object"!=typeof r&&(r={animation:e.autoPanAnimation,margin:e.autoPanMargin}),n.autoPan=r||!1,n.rendered={transform_:"",visible:!0},n.mapPostrenderListenerKey=null,n.addChangeListener(ms,n.handleElementChanged),n.addChangeListener(gs,n.handleMapChanged),n.addChangeListener(ys,n.handleOffsetChanged),n.addChangeListener(vs,n.handlePositionChanged),n.addChangeListener(_s,n.handlePositioningChanged),void 0!==e.element&&n.setElement(e.element),n.setOffset(void 0!==e.offset?e.offset:[0,0]),n.setPositioning(void 0!==e.positioning?e.positioning:hs.TOP_LEFT),void 0!==e.position&&n.setPosition(e.position),n}return fs(e,t),e.prototype.getElement=function(){return this.get(ms)},e.prototype.getId=function(){return this.id},e.prototype.getMap=function(){return this.get(gs)||null},e.prototype.getOffset=function(){return this.get(ys)},e.prototype.getPosition=function(){return this.get(vs)},e.prototype.getPositioning=function(){return this.get(_s)},e.prototype.handleElementChanged=function(){yn(this.element);var t=this.getElement();t&&this.element.appendChild(t)},e.prototype.handleMapChanged=function(){this.mapPostrenderListenerKey&&(gn(this.element),fe(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);var t=this.getMap();if(t){this.mapPostrenderListenerKey=de(t,cr.POSTRENDER,this.render,this),this.updatePixelPosition();var e=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?e.insertBefore(this.element,e.childNodes[0]||null):e.appendChild(this.element),this.performAutoPan()}},e.prototype.render=function(){this.updatePixelPosition()},e.prototype.handleOffsetChanged=function(){this.updatePixelPosition()},e.prototype.handlePositionChanged=function(){this.updatePixelPosition(),this.performAutoPan()},e.prototype.handlePositioningChanged=function(){this.updatePixelPosition()},e.prototype.setElement=function(t){this.set(ms,t)},e.prototype.setMap=function(t){this.set(gs,t)},e.prototype.setOffset=function(t){this.set(ys,t)},e.prototype.setPosition=function(t){this.set(vs,t)},e.prototype.performAutoPan=function(){this.autoPan&&this.panIntoView(this.autoPan)},e.prototype.panIntoView=function(t){var e=this.getMap();if(e&&e.getTargetElement()&&this.get(vs)){var n=this.getRect(e.getTargetElement(),e.getSize()),r=this.getElement(),o=this.getRect(r,[hn(r),fn(r)]),i=t||{},a=void 0===i.margin?20:i.margin;if(!nt(n,o)){var s=o[0]-n[0],l=n[2]-o[2],c=o[1]-n[1],u=n[3]-o[3],p=[0,0];if(s<0?p[0]=s-a:l<0&&(p[0]=Math.abs(l)+a),c<0?p[1]=c-a:u<0&&(p[1]=Math.abs(u)+a),0!==p[0]||0!==p[1]){var d=e.getView().getCenterInternal(),h=e.getPixelFromCoordinateInternal(d);if(!h)return;var f=[h[0]+p[0],h[1]+p[1]],m=i.animation||{};e.getView().animateInternal({center:e.getCoordinateFromPixelInternal(f),duration:m.duration,easing:m.easing})}}}},e.prototype.getRect=function(t,e){var n=t.getBoundingClientRect(),r=n.left+window.pageXOffset,o=n.top+window.pageYOffset;return[r,o,r+e[0],o+e[1]]},e.prototype.setPositioning=function(t){this.set(_s,t)},e.prototype.setVisible=function(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)},e.prototype.updatePixelPosition=function(){var t=this.getMap(),e=this.getPosition();if(t&&t.isRendered()&&e){var n=t.getPixelFromCoordinate(e),r=t.getSize();this.updateRenderedPosition(n,r)}else this.setVisible(!1)},e.prototype.updateRenderedPosition=function(t,e){var n=this.element.style,r=this.getOffset(),o=this.getPositioning();this.setVisible(!0);var i=Math.round(t[0]+r[0])+"px",a=Math.round(t[1]+r[1])+"px",s="0%",l="0%";o==hs.BOTTOM_RIGHT||o==hs.CENTER_RIGHT||o==hs.TOP_RIGHT?s="-100%":o!=hs.BOTTOM_CENTER&&o!=hs.CENTER_CENTER&&o!=hs.TOP_CENTER||(s="-50%"),o==hs.BOTTOM_LEFT||o==hs.BOTTOM_CENTER||o==hs.BOTTOM_RIGHT?l="-100%":o!=hs.CENTER_LEFT&&o!=hs.CENTER_CENTER&&o!=hs.CENTER_RIGHT||(l="-50%");var c="translate(".concat(s,", ").concat(l,") translate(").concat(i,", ").concat(a,")");this.rendered.transform_!=c&&(this.rendered.transform_=c,n.transform=c,n.msTransform=c)},e.prototype.getOptions=function(){return this.options},e}(Ee);const Es=Cs;function ws(t,e,n){var r=void 0!==n?t.toFixed(n):""+t,o=r.indexOf(".");return(o=-1===o?r.length:o)>e?r:new Array(1+e-o).join("0")+r}var Ss=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),bs=.75,Ls=.1,Ts=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ss(e,t),e.prototype.createRenderer=function(){return new Gn(this)},e}(Ki),Ps=function(t){function e(e){var n=this,r=e||{};(n=t.call(this,{element:document.createElement("div"),render:r.render,target:r.target})||this).boundHandleRotationChanged_=n.handleRotationChanged_.bind(n),n.collapsed_=void 0===r.collapsed||r.collapsed,n.collapsible_=void 0===r.collapsible||r.collapsible,n.collapsible_||(n.collapsed_=!1),n.rotateWithView_=void 0!==r.rotateWithView&&r.rotateWithView,n.viewExtent_=void 0;var o=void 0!==r.className?r.className:"ol-overviewmap",i=void 0!==r.tipLabel?r.tipLabel:"Overview map",a=void 0!==r.collapseLabel?r.collapseLabel:"‹";"string"==typeof a?(n.collapseLabel_=document.createElement("span"),n.collapseLabel_.textContent=a):n.collapseLabel_=a;var s=void 0!==r.label?r.label:"›";"string"==typeof s?(n.label_=document.createElement("span"),n.label_.textContent=s):n.label_=s;var l=n.collapsible_&&!n.collapsed_?n.collapseLabel_:n.label_,c=document.createElement("button");c.setAttribute("type","button"),c.title=i,c.appendChild(l),c.addEventListener(pe.CLICK,n.handleClick_.bind(n),!1),n.ovmapDiv_=document.createElement("div"),n.ovmapDiv_.className="ol-overviewmap-map",n.view_=r.view,n.ovmap_=new Ts({view:r.view});var u=n.ovmap_;r.layers&&r.layers.forEach((function(t){u.addLayer(t)}));var p=document.createElement("div");p.className="ol-overviewmap-box",p.style.boxSizing="border-box",n.boxOverlay_=new Es({position:[0,0],positioning:hs.CENTER_CENTER,element:p}),n.ovmap_.addOverlay(n.boxOverlay_);var d=o+" "+"ol-unselectable "+an+(n.collapsed_&&n.collapsible_?" ol-collapsed":"")+(n.collapsible_?"":" ol-uncollapsible"),h=n.element;h.className=d,h.appendChild(n.ovmapDiv_),h.appendChild(c);var f=n,m=n.boxOverlay_,g=n.boxOverlay_.getElement(),y=function(t){var e,n={clientX:(e=t).clientX,clientY:e.clientY},r=u.getEventCoordinateInternal(n);m.setPosition(r)},v=function(t){var e=u.getEventCoordinateInternal(t);f.getMap().getView().setCenterInternal(e),window.removeEventListener("mousemove",y),window.removeEventListener("mouseup",v)};return g.addEventListener("mousedown",(function(){window.addEventListener("mousemove",y),window.addEventListener("mouseup",v)})),n}return Ss(e,t),e.prototype.setMap=function(e){var n=this.getMap();if(e!==n){if(n){var r=n.getView();r&&this.unbindView_(r),this.ovmap_.setTarget(null)}if(t.prototype.setMap.call(this,e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(de(e,re,this.handleMapPropertyChange_,this));var o=e.getView();o&&(this.bindView_(o),o.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}},e.prototype.handleMapPropertyChange_=function(t){if(t.key===hr){var e=t.oldValue;e&&this.unbindView_(e);var n=this.getMap().getView();this.bindView_(n)}else this.ovmap_.isRendered()||t.key!==dr&&t.key!==pr||this.ovmap_.updateSize()},e.prototype.bindView_=function(t){if(!this.view_){var e=new ji({projection:t.getProjection()});this.ovmap_.setView(e)}t.addChangeListener(xr.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_()},e.prototype.unbindView_=function(t){t.removeChangeListener(xr.ROTATION,this.boundHandleRotationChanged_)},e.prototype.handleRotationChanged_=function(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())},e.prototype.validateExtent_=function(){var t=this.getMap(),e=this.ovmap_;if(t.isRendered()&&e.isRendered()){var n=t.getSize(),r=t.getView().calculateExtentInternal(n);if(!this.viewExtent_||!ut(r,this.viewExtent_)){this.viewExtent_=r;var o=e.getSize(),i=e.getView().calculateExtentInternal(o),a=e.getPixelFromCoordinateInternal(bt(r)),s=e.getPixelFromCoordinateInternal(vt(r)),l=Math.abs(a[0]-s[0]),c=Math.abs(a[1]-s[1]),u=o[0],p=o[1];l<u*Ls||c<p*Ls||l>u*bs||c>p*bs?this.resetExtent_():nt(i,r)||this.recenter_()}}},e.prototype.resetExtent_=function(){var t=this.getMap(),e=this.ovmap_,n=t.getSize(),r=t.getView().calculateExtentInternal(n),o=e.getView(),i=Math.log(7.5)/Math.LN2;Ot(r,1/(Math.pow(2,i/2)*Ls)),o.fitInternal(Di(r))},e.prototype.recenter_=function(){var t=this.getMap(),e=this.ovmap_,n=t.getView();e.getView().setCenterInternal(n.getCenterInternal())},e.prototype.updateBox_=function(){var t=this.getMap(),e=this.ovmap_;if(t.isRendered()&&e.isRendered()){var n=t.getSize(),r=t.getView(),o=e.getView(),i=this.rotateWithView_?0:-r.getRotation(),a=this.boxOverlay_,s=this.boxOverlay_.getElement(),l=r.getCenterInternal(),c=r.getResolution(),u=o.getResolution(),p=n[0]*c/u,d=n[1]*c/u;if(a.setPosition(l),s){s.style.width=p+"px",s.style.height=d+"px";var h="rotate("+i+"rad)";s.style.transform=h}}},e.prototype.updateBoxAfterOvmapIsRendered_=function(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=he(this.ovmap_,cr.POSTRENDER,(function(t){delete this.ovmapPostrenderKey_,this.updateBox_()}),this))},e.prototype.handleClick_=function(t){t.preventDefault(),this.handleToggle_()},e.prototype.handleToggle_=function(){this.element.classList.toggle(sn),this.collapsed_?mn(this.collapseLabel_,this.label_):mn(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;var t=this.ovmap_;if(!this.collapsed_){if(t.isRendered())return this.viewExtent_=void 0,void t.render();t.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}},e.prototype.getCollapsible=function(){return this.collapsible_},e.prototype.setCollapsible=function(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),!t&&this.collapsed_&&this.handleToggle_())},e.prototype.setCollapsed=function(t){this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()},e.prototype.getCollapsed=function(){return this.collapsed_},e.prototype.getRotateWithView=function(){return this.rotateWithView_},e.prototype.setRotateWithView=function(t){this.rotateWithView_!==t&&(this.rotateWithView_=t,0!==this.getMap().getView().getRotation()&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))},e.prototype.getOverviewMap=function(){return this.ovmap_},e.prototype.render=function(t){this.validateExtent_(),this.updateBox_()},e}($i);const As=Ps;var Os=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),xs="units",Is="degrees",Ms="imperial",Rs="nautical",Zs="metric",Ds="us",ks=[1,2,5],Ns=25.4/.28,Fs=function(t){function e(e){var n=this,r=e||{},o=void 0!==r.className?r.className:r.bar?"ol-scale-bar":"ol-scale-line";return(n=t.call(this,{element:document.createElement("div"),render:r.render,target:r.target})||this).on,n.once,n.un,n.innerElement_=document.createElement("div"),n.innerElement_.className=o+"-inner",n.element.className=o+" "+on,n.element.appendChild(n.innerElement_),n.viewState_=null,n.minWidth_=void 0!==r.minWidth?r.minWidth:64,n.renderedVisible_=!1,n.renderedWidth_=void 0,n.renderedHTML_="",n.addChangeListener(xs,n.handleUnitsChanged_),n.setUnits(r.units||Zs),n.scaleBar_=r.bar||!1,n.scaleBarSteps_=r.steps||4,n.scaleBarText_=r.text||!1,n.dpi_=r.dpi||void 0,n}return Os(e,t),e.prototype.getUnits=function(){return this.get(xs)},e.prototype.handleUnitsChanged_=function(){this.updateElement_()},e.prototype.setUnits=function(t){this.set(xs,t)},e.prototype.setDpi=function(t){this.dpi_=t},e.prototype.updateElement_=function(){var t=this.viewState_;if(t){var e=t.center,n=t.projection,r=this.getUnits(),o=r==Is?Pr.DEGREES:Pr.METERS,i=ao(n,t.resolution,e,o),a=this.minWidth_*(this.dpi_||Ns)/Ns,s=a*i,l="";if(r==Is){var c=Tr[Pr.DEGREES];(s*=c)<c/60?(l="″",i*=3600):s<c?(l="′",i*=60):l="°"}else r==Ms?s<.9144?(l="in",i/=.0254):s<1609.344?(l="ft",i/=.3048):(l="mi",i/=1609.344):r==Rs?(i/=1852,l="nm"):r==Zs?s<.001?(l="μm",i*=1e6):s<1?(l="mm",i*=1e3):s<1e3?l="m":(l="km",i/=1e3):r==Ds?s<.9144?(l="in",i*=39.37):s<1609.344?(l="ft",i/=.30480061):(l="mi",i/=1609.3472):x(!1,33);for(var u,p,d,h,f=3*Math.floor(Math.log(a*i)/Math.log(10));;){d=Math.floor(f/3);var m=Math.pow(10,d);if(u=ks[(f%3+3)%3]*m,p=Math.round(u/i),isNaN(p))return this.element.style.display="none",void(this.renderedVisible_=!1);if(p>=a)break;++f}h=this.scaleBar_?this.createScaleBar(p,u,l):u.toFixed(d<0?-d:0)+" "+l,this.renderedHTML_!=h&&(this.innerElement_.innerHTML=h,this.renderedHTML_=h),this.renderedWidth_!=p&&(this.innerElement_.style.width=p+"px",this.renderedWidth_=p),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)},e.prototype.createScaleBar=function(t,e,n){for(var r="1 : "+Math.round(this.getScaleForResolution()).toLocaleString(),o=[],i=t/this.scaleBarSteps_,a="#ffffff",s=0;s<this.scaleBarSteps_;s++)0===s&&o.push(this.createMarker("absolute",s)),o.push('<div><div class="ol-scale-singlebar" style="width: '+i+"px;background-color: "+a+';"></div>'+this.createMarker("relative",s)+(s%2==0||2===this.scaleBarSteps_?this.createStepText(s,t,!1,e,n):"")+"</div>"),s===this.scaleBarSteps_-1&&o.push(this.createStepText(s+1,t,!0,e,n)),a="#ffffff"===a?"#000000":"#ffffff";return'<div style="display: flex;">'+(this.scaleBarText_?'<div class="ol-scale-text" style="width: '+t+'px;">'+r+"</div>":"")+o.join("")+"</div>"},e.prototype.createMarker=function(t,e){return'<div class="ol-scale-step-marker" style="position: '+t+";top: "+("absolute"===t?3:-10)+'px;"></div>'},e.prototype.createStepText=function(t,e,n,r,o){var i=(0===t?0:Math.round(r/this.scaleBarSteps_*t*100)/100)+(0===t?"":" "+o);return'<div class="ol-scale-step-text" style="margin-left: '+(0===t?-3:e/this.scaleBarSteps_*-1)+"px;text-align: "+(0===t?"left":"center")+"; min-width: "+(0===t?0:e/this.scaleBarSteps_*2)+"px;left: "+(n?e+"px":"unset")+';">'+i+"</div>"},e.prototype.getScaleForResolution=function(){var t=ao(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,Pr.METERS),e=this.dpi_||Ns;return parseFloat(t.toString())*(1e3/25.4)*e},e.prototype.render=function(t){var e=t.frameState;this.viewState_=e?e.viewState:null,this.updateElement_()},e}($i);const Us=Fs;var Gs=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const Bs=function(t){function e(e){var n=this,r=e||{};(n=t.call(this,{element:document.createElement("div"),target:r.target})||this).extent=r.extent?r.extent:null;var o=void 0!==r.className?r.className:"ol-zoom-extent",i=void 0!==r.label?r.label:"E",a=void 0!==r.tipLabel?r.tipLabel:"Fit to extent",s=document.createElement("button");s.setAttribute("type","button"),s.title=a,s.appendChild("string"==typeof i?document.createTextNode(i):i),s.addEventListener(pe.CLICK,n.handleClick_.bind(n),!1);var l=o+" "+"ol-unselectable "+an,c=n.element;return c.className=l,c.appendChild(s),n}return Gs(e,t),e.prototype.handleClick_=function(t){t.preventDefault(),this.handleZoomToExtent()},e.prototype.handleZoomToExtent=function(){var t=this.getMap().getView(),e=this.extent?this.extent:t.getProjection().getExtent();t.fitInternal(Di(e))},e}($i);var js=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ws=0,qs=1,Hs=function(t){function e(e){var n=this,r=e||{};(n=t.call(this,{element:document.createElement("div"),render:r.render})||this).dragListenerKeys_=[],n.currentResolution_=void 0,n.direction_=Ws,n.dragging_,n.heightLimit_=0,n.widthLimit_=0,n.startX_,n.startY_,n.thumbSize_=null,n.sliderInitialized_=!1,n.duration_=void 0!==r.duration?r.duration:200;var o=void 0!==r.className?r.className:"ol-zoomslider",i=document.createElement("button");i.setAttribute("type","button"),i.className=o+"-thumb "+on;var a=n.element;return a.className=o+" "+"ol-unselectable "+an,a.appendChild(i),a.addEventListener(ir,n.handleDraggerStart_.bind(n),!1),a.addEventListener(or,n.handleDraggerDrag_.bind(n),!1),a.addEventListener(ar,n.handleDraggerEnd_.bind(n),!1),a.addEventListener(pe.CLICK,n.handleContainerClick_.bind(n),!1),i.addEventListener(pe.CLICK,ee,!1),n}return js(e,t),e.prototype.setMap=function(e){t.prototype.setMap.call(this,e),e&&e.render()},e.prototype.initSlider_=function(){var t=this.element,e=t.offsetWidth,n=t.offsetHeight;if(0===e&&0===n)return this.sliderInitialized_=!1;var r=getComputedStyle(t);e-=parseFloat(r.paddingRight)+parseFloat(r.paddingLeft),n-=parseFloat(r.paddingTop)+parseFloat(r.paddingBottom);var o=t.firstElementChild,i=getComputedStyle(o),a=o.offsetWidth+parseFloat(i.marginRight)+parseFloat(i.marginLeft),s=o.offsetHeight+parseFloat(i.marginTop)+parseFloat(i.marginBottom);return this.thumbSize_=[a,s],e>n?(this.direction_=qs,this.widthLimit_=e-a):(this.direction_=Ws,this.heightLimit_=n-s),this.sliderInitialized_=!0},e.prototype.handleContainerClick_=function(t){var e=this.getMap().getView(),n=this.getRelativePosition_(t.offsetX-this.thumbSize_[0]/2,t.offsetY-this.thumbSize_[1]/2),r=this.getResolutionForPosition_(n),o=e.getConstrainedZoom(e.getZoomForResolution(r));e.animateInternal({zoom:o,duration:this.duration_,easing:Do})},e.prototype.handleDraggerStart_=function(t){if(!this.dragging_&&t.target===this.element.firstElementChild){var e=this.element.firstElementChild;if(this.getMap().getView().beginInteraction(),this.startX_=t.clientX-parseFloat(e.style.left),this.startY_=t.clientY-parseFloat(e.style.top),this.dragging_=!0,0===this.dragListenerKeys_.length){var n=this.handleDraggerDrag_,r=this.handleDraggerEnd_,o=this.getMap().getOwnerDocument();this.dragListenerKeys_.push(de(o,or,n,this),de(o,ar,r,this))}}},e.prototype.handleDraggerDrag_=function(t){if(this.dragging_){var e=t.clientX-this.startX_,n=t.clientY-this.startY_,r=this.getRelativePosition_(e,n);this.currentResolution_=this.getResolutionForPosition_(r),this.getMap().getView().setResolution(this.currentResolution_)}},e.prototype.handleDraggerEnd_=function(t){this.dragging_&&(this.getMap().getView().endInteraction(),this.dragging_=!1,this.startX_=void 0,this.startY_=void 0,this.dragListenerKeys_.forEach(fe),this.dragListenerKeys_.length=0)},e.prototype.setThumbPosition_=function(t){var e=this.getPositionForResolution_(t),n=this.element.firstElementChild;this.direction_==qs?n.style.left=this.widthLimit_*e+"px":n.style.top=this.heightLimit_*e+"px"},e.prototype.getRelativePosition_=function(t,e){return It(this.direction_===qs?t/this.widthLimit_:e/this.heightLimit_,0,1)},e.prototype.getResolutionForPosition_=function(t){return this.getMap().getView().getResolutionForValueFunction()(1-t)},e.prototype.getPositionForResolution_=function(t){return It(1-this.getMap().getView().getValueForResolutionFunction()(t),0,1)},e.prototype.render=function(t){if(t.frameState&&(this.sliderInitialized_||this.initSlider_())){var e=t.frameState.viewState.resolution;this.currentResolution_=e,this.setThumbPosition_(e)}},e}($i);const Vs=Hs;var zs=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ys=function(t){function e(e){var n=t.call(this)||this;if(n.on,n.once,n.un,n.id_=void 0,n.geometryName_="geometry",n.style_=null,n.styleFunction_=void 0,n.geometryChangeKey_=null,n.addChangeListener(n.geometryName_,n.handleGeometryChanged_),e)if("function"==typeof e.getSimplifiedGeometry){var r=e;n.setGeometry(r)}else{var o=e;n.setProperties(o)}return n}return zs(e,t),e.prototype.clone=function(){var t=new e(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());var n=this.getGeometry();n&&t.setGeometry(n.clone());var r=this.getStyle();return r&&t.setStyle(r),t},e.prototype.getGeometry=function(){return this.get(this.geometryName_)},e.prototype.getId=function(){return this.id_},e.prototype.getGeometryName=function(){return this.geometryName_},e.prototype.getStyle=function(){return this.style_},e.prototype.getStyleFunction=function(){return this.styleFunction_},e.prototype.handleGeometryChange_=function(){this.changed()},e.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(fe(this.geometryChangeKey_),this.geometryChangeKey_=null);var t=this.getGeometry();t&&(this.geometryChangeKey_=de(t,pe.CHANGE,this.handleGeometryChange_,this)),this.changed()},e.prototype.setGeometry=function(t){this.set(this.geometryName_,t)},e.prototype.setStyle=function(t){this.style_=t,this.styleFunction_=t?Ks(t):void 0,this.changed()},e.prototype.setId=function(t){this.id_=t,this.changed()},e.prototype.setGeometryName=function(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()},e}(Ee);function Ks(t){return"function"==typeof t?t:(Array.isArray(t)?e=t:(x("function"==typeof t.getZIndex,41),e=[t]),function(){return e});var e}const Xs=Ys;var $s=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Js=function(t){function e(e,n){var r=t.call(this)||this;return n&&!Array.isArray(e[0])?r.setFlatCoordinates(n,e):r.setCoordinates(e,n),r}return $s(e,t),e.prototype.appendPoint=function(t){this.flatCoordinates?d(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()},e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,n,r){if(r<tt(this.getExtent(),t,e))return r;for(var o=this.flatCoordinates,i=this.stride,a=0,s=o.length;a<s;a+=i){var l=Dt(t,e,o[a],o[a+1]);if(l<r){r=l;for(var c=0;c<i;++c)n[c]=o[a+c];n.length=i}}return r},e.prototype.getCoordinates=function(){return ci(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getPoint=function(t){var e=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||e<=t?null:new _i(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)},e.prototype.getPoints=function(){for(var t=this.flatCoordinates,e=this.layout,n=this.stride,r=[],o=0,i=t.length;o<i;o+=n){var a=new _i(t.slice(o,o+n),e);r.push(a)}return r},e.prototype.getType=function(){return br.MULTI_POINT},e.prototype.intersectsExtent=function(t){for(var e=this.flatCoordinates,n=this.stride,r=0,o=e.length;r<o;r+=n){if(rt(t,e[r],e[r+1]))return!0}return!1},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ni(this.flatCoordinates,0,t,this.stride),this.changed()},e}(Ko);const Qs=Js;function tl(t,e,n,r,o,i,a){var s,c,u=(n-e)/r;if(1===u)s=e;else if(2===u)s=e,c=o;else if(0!==u){for(var p=t[e],d=t[e+1],h=0,f=[0],m=e+r;m<n;m+=r){var g=t[m],y=t[m+1];h+=Math.sqrt((g-p)*(g-p)+(y-d)*(y-d)),f.push(h),p=g,d=y}var v=o*h,_=function(t,e,n){for(var r,o,i=n||l,a=0,s=t.length,c=!1;a<s;)(o=+i(t[r=a+(s-a>>1)],e))<0?a=r+1:(s=r,c=!o);return c?a:~a}(f,v);_<0?(c=(v-f[-_-2])/(f[-_-1]-f[-_-2]),s=e+(-_-2)*r):s=e+_*r}var C=a>1?a:2,E=i||new Array(C);for(m=0;m<C;++m)E[m]=void 0===s?NaN:void 0===c?t[s+m]:Ft(t[s+m],t[s+r+m],c);return E}function el(t,e,n,r,o,i){if(n==e)return null;var a;if(o<t[e+r-1])return i?((a=t.slice(e,e+r))[r-1]=o,a):null;if(t[n-1]<o)return i?((a=t.slice(n-r,n))[r-1]=o,a):null;if(o==t[e+r-1])return t.slice(e,e+r);for(var s=e/r,l=n/r;s<l;){var c=s+l>>1;o<t[(c+1)*r-1]?l=c:s=c+1}var u=t[s*r-1];if(o==u)return t.slice((s-1)*r,(s-1)*r+r);var p=(o-u)/(t[(s+1)*r-1]-u);a=[];for(var d=0;d<r-1;++d)a.push(Ft(t[(s-1)*r+d],t[s*r+d],p));return a.push(o),a}function nl(t,e,n,r){for(var o=t[e],i=t[e+1],a=0,s=e+r;s<n;s+=r){var l=t[s],c=t[s+1];a+=Math.sqrt((l-o)*(l-o)+(c-i)*(c-i)),o=l,i=c}return a}var rl=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),il=function(t){function e(e,n){var r=t.call(this)||this;return r.flatMidpoint_=null,r.flatMidpointRevision_=-1,r.maxDelta_=-1,r.maxDeltaRevision_=-1,void 0===n||Array.isArray(e[0])?r.setCoordinates(e,n):r.setFlatCoordinates(n,e),r}return rl(e,t),e.prototype.appendCoordinate=function(t){this.flatCoordinates?d(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()},e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,n,r){return r<tt(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt($o(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Qo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,n,r))},e.prototype.forEachSegment=function(t){return bi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinateAtM=function(t,e){if(this.layout!=Fo.XYM&&this.layout!=Fo.XYZM)return null;var n=void 0!==e&&e;return el(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,n)},e.prototype.getCoordinates=function(){return ci(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinateAt=function(t,e){return tl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)},e.prototype.getLength=function(){return nl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},e.prototype.getSimplifiedGeometryInternal=function(t){var n=[];return n.length=oi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,n,0),new e(n,Fo.XY)},e.prototype.getType=function(){return br.LINE_STRING},e.prototype.intersectsExtent=function(t){return Li(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ni(this.flatCoordinates,0,t,this.stride),this.changed()},e}(Ko);const al=il;var sl=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ll=function(t){function e(e,n,r){var o=t.call(this)||this;if(o.ends_=[],o.maxDelta_=-1,o.maxDeltaRevision_=-1,Array.isArray(e[0]))o.setCoordinates(e,n);else if(void 0!==n&&r)o.setFlatCoordinates(n,e),o.ends_=r;else{for(var i=o.getLayout(),a=e,s=[],l=[],c=0,u=a.length;c<u;++c){var p=a[c];0===c&&(i=p.getLayout()),d(s,p.getFlatCoordinates()),l.push(s.length)}o.setFlatCoordinates(i,s),o.ends_=l}return o}return sl(e,t),e.prototype.appendLineString=function(t){this.flatCoordinates?d(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,n,r){return r<tt(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Jo(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ti(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,n,r))},e.prototype.getCoordinateAtM=function(t,e,n){if(this.layout!=Fo.XYM&&this.layout!=Fo.XYZM||0===this.flatCoordinates.length)return null;var r=void 0!==e&&e,o=void 0!==n&&n;return function(t,e,n,r,o,i,a){if(a)return el(t,e,n[n.length-1],r,o,i);var s;if(o<t[r-1])return i?((s=t.slice(0,r))[r-1]=o,s):null;if(t[t.length-1]<o)return i?((s=t.slice(t.length-r))[r-1]=o,s):null;for(var l=0,c=n.length;l<c;++l){var u=n[l];if(e!=u){if(o<t[e+r-1])return null;if(o<=t[u-1])return el(t,e,u,r,o,!1);e=u}}return null}(this.flatCoordinates,0,this.ends_,this.stride,t,r,o)},e.prototype.getCoordinates=function(){return ui(this.flatCoordinates,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getLineString=function(t){return t<0||this.ends_.length<=t?null:new al(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLineStrings=function(){for(var t=this.flatCoordinates,e=this.ends_,n=this.layout,r=[],o=0,i=0,a=e.length;i<a;++i){var s=e[i],l=new al(t.slice(o,s),n);r.push(l),o=s}return r},e.prototype.getFlatMidpoints=function(){for(var t=[],e=this.flatCoordinates,n=0,r=this.ends_,o=this.stride,i=0,a=r.length;i<a;++i){var s=r[i];d(t,tl(e,n,s,o,.5)),n=s}return t},e.prototype.getSimplifiedGeometryInternal=function(t){var n=[],r=[];return n.length=ii(this.flatCoordinates,0,this.ends_,this.stride,t,n,0,r),new e(n,Fo.XY,r)},e.prototype.getType=function(){return br.MULTI_LINE_STRING},e.prototype.intersectsExtent=function(t){return function(t,e,n,r,o){for(var i=0,a=n.length;i<a;++i){if(Li(t,e,n[i],r,o))return!0;e=n[i]}return!1}(this.flatCoordinates,0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var n=ri(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===n.length?0:n[n.length-1],this.changed()},e}(Ko);const cl=ll;var ul=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),pl=function(t){function e(e,n,r){var o=t.call(this)||this;if(o.endss_=[],o.flatInteriorPointsRevision_=-1,o.flatInteriorPoints_=null,o.maxDelta_=-1,o.maxDeltaRevision_=-1,o.orientedRevision_=-1,o.orientedFlatCoordinates_=null,!r&&!Array.isArray(e[0])){for(var i=o.getLayout(),a=e,s=[],l=[],c=0,u=a.length;c<u;++c){var p=a[c];0===c&&(i=p.getLayout());for(var h=s.length,f=p.getEnds(),m=0,g=f.length;m<g;++m)f[m]+=h;d(s,p.getFlatCoordinates()),l.push(f)}n=i,e=s,r=l}return void 0!==n&&r?(o.setFlatCoordinates(n,e),o.endss_=r):o.setCoordinates(e,n),o}return ul(e,t),e.prototype.appendPolygon=function(t){var e;if(this.flatCoordinates){var n=this.flatCoordinates.length;d(this.flatCoordinates,t.getFlatCoordinates());for(var r=0,o=(e=t.getEnds().slice()).length;r<o;++r)e[r]+=n}else this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();this.endss_.push(e),this.changed()},e.prototype.clone=function(){for(var t=this.endss_.length,n=new Array(t),r=0;r<t;++r)n[r]=this.endss_[r].slice();var o=new e(this.flatCoordinates.slice(),this.layout,n);return o.applyProperties(this),o},e.prototype.closestPointXY=function(t,e,n,r){return r<tt(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function(t,e,n,r,o){for(var i=0,a=n.length;i<a;++i){var s=n[i];o=Jo(t,e,s,r,o),e=s[s.length-1]}return o}(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function(t,e,n,r,o,i,a,s,l,c,u){for(var p=u||[NaN,NaN],d=0,h=n.length;d<h;++d){var f=n[d];c=ti(t,e,f,r,o,i,a,s,l,c,p),e=f[f.length-1]}return c}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,n,r))},e.prototype.containsXY=function(t,e){return function(t,e,n,r,o,i){if(0===n.length)return!1;for(var a=0,s=n.length;a<s;++a){var l=n[a];if(wi(t,e,l,r,o,i))return!0;e=l[l.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)},e.prototype.getArea=function(){return function(t,e,n,r){for(var o=0,i=0,a=n.length;i<a;++i){var s=n[i];o+=hi(t,e,s,r),e=s[s.length-1]}return o}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},e.prototype.getCoordinates=function(t){var e;return void 0!==t?Ii(e=this.getOrientedFlatCoordinates().slice(),0,this.endss_,this.stride,t):e=this.flatCoordinates,pi(e,0,this.endss_,this.stride)},e.prototype.getEndss=function(){return this.endss_},e.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var t=function(t,e,n,r){for(var o=[],i=[1/0,1/0,-1/0,-1/0],a=0,s=n.length;a<s;++a){var l=n[a];i=ct(t,e,l[0],r),o.push((i[0]+i[2])/2,(i[1]+i[3])/2),e=l[l.length-1]}return o}(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=function(t,e,n,r,o){for(var i=[],a=0,s=n.length;a<s;++a){var l=n[a];i=Si(t,e,l,r,o,2*a,i),e=l[l.length-1]}return i}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_},e.prototype.getInteriorPoints=function(){return new Qs(this.getFlatInteriorPoints().slice(),Fo.XYM)},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;!function(t,e,n,r,o){for(var i=0,a=n.length;i<a;++i){var s=n[i];if(!Oi(t,e,s,r,o))return!1;s.length&&(e=s[s.length-1])}return!0}(t,0,this.endss_,this.stride)?(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Ii(this.orientedFlatCoordinates_,0,this.endss_,this.stride)):this.orientedFlatCoordinates_=t,this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var n=[],r=[];return n.length=function(t,e,n,r,o,i,a,s){for(var l=0,c=n.length;l<c;++l){var u=n[l],p=[];a=li(t,e,u,r,o,i,a,p),s.push(p),e=u[u.length-1]}return a}(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),n,0,r),new e(n,Fo.XY,r)},e.prototype.getPolygon=function(t){if(t<0||this.endss_.length<=t)return null;var e;if(0===t)e=0;else{var n=this.endss_[t-1];e=n[n.length-1]}var r=this.endss_[t].slice(),o=r[r.length-1];if(0!==e)for(var i=0,a=r.length;i<a;++i)r[i]-=e;return new Zi(this.flatCoordinates.slice(e,o),this.layout,r)},e.prototype.getPolygons=function(){for(var t=this.layout,e=this.flatCoordinates,n=this.endss_,r=[],o=0,i=0,a=n.length;i<a;++i){var s=n[i].slice(),l=s[s.length-1];if(0!==o)for(var c=0,u=s.length;c<u;++c)s[c]-=o;var p=new Zi(e.slice(o,l),t,s);r.push(p),o=l}return r},e.prototype.getType=function(){return br.MULTI_POLYGON},e.prototype.intersectsExtent=function(t){return function(t,e,n,r,o){for(var i=0,a=n.length;i<a;++i){var s=n[i];if(Ti(t,e,s,r,o))return!0;e=s[s.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);var n=function(t,e,n,r,o){for(var i=o||[],a=0,s=0,l=n.length;s<l;++s){var c=ri(t,e,n[s],r,i[a]);i[a++]=c,e=c[c.length-1]}return i.length=a,i}(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===n.length)this.flatCoordinates.length=0;else{var r=n[n.length-1];this.flatCoordinates.length=0===r.length?0:r[r.length-1]}this.changed()},e}(Ko);const dl=pl;var hl=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),fl=function(t){function e(e,n,r){var o=t.call(this)||this;if(void 0!==r&&void 0===n)o.setFlatCoordinates(r,e);else{var i=n||0;o.setCenterAndRadius(e,i,r)}return o}return hl(e,t),e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),void 0,this.layout);return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,n,r){var o=this.flatCoordinates,i=t-o[0],a=e-o[1],s=i*i+a*a;if(s<r){if(0===s)for(var l=0;l<this.stride;++l)n[l]=o[l];else{var c=this.getRadius()/Math.sqrt(s);n[0]=o[0]+c*i,n[1]=o[1]+c*a;for(l=2;l<this.stride;++l)n[l]=o[l]}return n.length=this.stride,s}return r},e.prototype.containsXY=function(t,e){var n=this.flatCoordinates,r=t-n[0],o=e-n[1];return r*r+o*o<=this.getRadiusSquared_()},e.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)},e.prototype.computeExtent=function(t){var e=this.flatCoordinates,n=e[this.stride]-e[0];return at(e[0]-n,e[1]-n,e[0]+n,e[1]+n,t)},e.prototype.getRadius=function(){return Math.sqrt(this.getRadiusSquared_())},e.prototype.getRadiusSquared_=function(){var t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e},e.prototype.getType=function(){return br.CIRCLE},e.prototype.intersectsExtent=function(t){if(Pt(t,this.getExtent())){var e=this.getCenter();return t[0]<=e[0]&&t[2]>=e[0]||(t[1]<=e[1]&&t[3]>=e[1]||mt(t,this.intersectsCoordinate.bind(this)))}return!1},e.prototype.setCenter=function(t){var e=this.stride,n=this.flatCoordinates[e]-this.flatCoordinates[0],r=t.slice();r[e]=r[0]+n;for(var o=1;o<e;++o)r[e+o]=t[o];this.setFlatCoordinates(this.layout,r),this.changed()},e.prototype.setCenterAndRadius=function(t,e,n){this.setLayout(n,t,0),this.flatCoordinates||(this.flatCoordinates=[]);var r=this.flatCoordinates,o=ei(r,0,t,this.stride);r[o++]=r[0]+e;for(var i=1,a=this.stride;i<a;++i)r[o++]=r[i];r.length=o,this.changed()},e.prototype.getCoordinates=function(){return null},e.prototype.setCoordinates=function(t,e){},e.prototype.setRadius=function(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()},e.prototype.rotate=function(t,e){var n=this.getCenter(),r=this.getStride();this.setCenter(Go(n,0,n.length,r,t,e,n)),this.changed()},e.prototype.translate=function(t,e){var n=this.getCenter(),r=this.getStride();this.setCenter(Bo(n,0,n.length,r,t,e,n)),this.changed()},e}(Ko);fl.prototype.transform;const ml=fl;var gl=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),yl=function(t){function e(e){var n=t.call(this)||this;return n.geometries_=e||null,n.changeEventsKeys_=[],n.listenGeometriesChange_(),n}return gl(e,t),e.prototype.unlistenGeometriesChange_=function(){this.changeEventsKeys_.forEach(fe),this.changeEventsKeys_.length=0},e.prototype.listenGeometriesChange_=function(){if(this.geometries_)for(var t=0,e=this.geometries_.length;t<e;++t)this.changeEventsKeys_.push(de(this.geometries_[t],pe.CHANGE,this.changed,this))},e.prototype.clone=function(){var t=new e(null);return t.setGeometries(this.geometries_),t.applyProperties(this),t},e.prototype.closestPointXY=function(t,e,n,r){if(r<tt(this.getExtent(),t,e))return r;for(var o=this.geometries_,i=0,a=o.length;i<a;++i)r=o[i].closestPointXY(t,e,n,r);return r},e.prototype.containsXY=function(t,e){for(var n=this.geometries_,r=0,o=n.length;r<o;++r)if(n[r].containsXY(t,e))return!0;return!1},e.prototype.computeExtent=function(t){st(t);for(var e=this.geometries_,n=0,r=e.length;n<r;++n)pt(t,e[n].getExtent());return t},e.prototype.getGeometries=function(){return vl(this.geometries_)},e.prototype.getGeometriesArray=function(){return this.geometries_},e.prototype.getGeometriesArrayRecursive=function(){for(var t=[],e=this.geometries_,n=0,r=e.length;n<r;++n)e[n].getType()===this.getType()?t=t.concat(e[n].getGeometriesArrayRecursive()):t.push(e[n]);return t},e.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;for(var n=[],r=this.geometries_,o=!1,i=0,a=r.length;i<a;++i){var s=r[i],l=s.getSimplifiedGeometry(t);n.push(l),l!==s&&(o=!0)}if(o){var c=new e(null);return c.setGeometriesArray(n),c}return this.simplifiedGeometryMaxMinSquaredTolerance=t,this},e.prototype.getType=function(){return br.GEOMETRY_COLLECTION},e.prototype.intersectsExtent=function(t){for(var e=this.geometries_,n=0,r=e.length;n<r;++n)if(e[n].intersectsExtent(t))return!0;return!1},e.prototype.isEmpty=function(){return 0===this.geometries_.length},e.prototype.rotate=function(t,e){for(var n=this.geometries_,r=0,o=n.length;r<o;++r)n[r].rotate(t,e);this.changed()},e.prototype.scale=function(t,e,n){var r=n;r||(r=_t(this.getExtent()));for(var o=this.geometries_,i=0,a=o.length;i<a;++i)o[i].scale(t,e,r);this.changed()},e.prototype.setGeometries=function(t){this.setGeometriesArray(vl(t))},e.prototype.setGeometriesArray=function(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()},e.prototype.applyTransform=function(t){for(var e=this.geometries_,n=0,r=e.length;n<r;++n)e[n].applyTransform(t);this.changed()},e.prototype.translate=function(t,e){for(var n=this.geometries_,r=0,o=n.length;r<o;++r)n[r].translate(t,e);this.changed()},e.prototype.disposeInternal=function(){this.unlistenGeometriesChange_(),t.prototype.disposeInternal.call(this)},e}(Ho);function vl(t){for(var e=[],n=0,r=t.length;n<r;++n)e.push(t[n].clone());return e}const _l=yl,Cl="arraybuffer",El="json",wl="text",Sl="xml";var bl=!1;function Ll(t,e){return function(n,r,o,i,a){var s=this;!function(t,e,n,r,o,i,a){var s=new XMLHttpRequest;s.open("GET","function"==typeof t?t(n,r,o):t,!0),e.getType()==Cl&&(s.responseType="arraybuffer"),s.withCredentials=bl,s.onload=function(t){if(!s.status||s.status>=200&&s.status<300){var r=e.getType(),l=void 0;r==El||r==wl?l=s.responseText:r==Sl?(l=s.responseXML)||(l=(new DOMParser).parseFromString(s.responseText,"application/xml")):r==Cl&&(l=s.response),l?i(e.readFeatures(l,{extent:n,featureProjection:o}),e.readProjection(l)):a()}else a()},s.onerror=a,s.send()}(t,e,n,r,o,(function(t,e){s.addFeatures(t),void 0!==i&&i(t)}),a||v)}}const Tl=function(){function t(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}return t.prototype.getReadOptions=function(t,e){var n;if(e){var r=e.dataProjection?io(e.dataProjection):this.readProjection(t);e.extent&&r&&r.getUnits()===Pr.TILE_PIXELS&&(r=io(r)).setWorldExtent(e.extent),n={dataProjection:r,featureProjection:e.featureProjection}}return this.adaptOptions(n)},t.prototype.adaptOptions=function(t){return oe({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)},t.prototype.getType=function(){return r()},t.prototype.readFeature=function(t,e){return r()},t.prototype.readFeatures=function(t,e){return r()},t.prototype.readGeometry=function(t,e){return r()},t.prototype.readProjection=function(t){return r()},t.prototype.writeFeature=function(t,e){return r()},t.prototype.writeFeatures=function(t,e){return r()},t.prototype.writeGeometry=function(t,e){return r()},t}();function Pl(t,e,n){var r,o=n?io(n.featureProjection):null,i=n?io(n.dataProjection):null;if(r=o&&i&&!uo(o,i)?(e?t.clone():t).transform(e?o:i,e?i:o):t,e&&n&&void 0!==n.decimals){var a=Math.pow(10,n.decimals);r===t&&(r=t.clone()),r.applyTransform((function(t){for(var e=0,n=t.length;e<n;++e)t[e]=Math.round(t[e]*a)/a;return t}))}return r}function Al(t,e){var n=e?io(e.featureProjection):null,r=e?io(e.dataProjection):null;return n&&r&&!uo(n,r)?mo(t,r,n):t}var Ol="http://www.w3.org/2001/XMLSchema-instance";function xl(t,e){return Jl().createElementNS(t,e)}function Il(t,e){return Ml(t,e,[]).join("")}function Ml(t,e,n){if(t.nodeType==Node.CDATA_SECTION_NODE||t.nodeType==Node.TEXT_NODE)e?n.push(String(t.nodeValue).replace(/(\r\n|\r|\n)/g,"")):n.push(t.nodeValue);else{var r=void 0;for(r=t.firstChild;r;r=r.nextSibling)Ml(r,e,n)}return n}function Rl(t){return"documentElement"in t}function Zl(t){return(new DOMParser).parseFromString(t,"application/xml")}function Dl(t,e){return function(n,r){var o=t.call(void 0!==e?e:this,n,r);void 0!==o&&d(r[r.length-1],o)}}function kl(t,e){return function(n,r){var o=t.call(void 0!==e?e:this,n,r);void 0!==o&&r[r.length-1].push(o)}}function Nl(t,e){return function(n,r){var o=t.call(void 0!==e?e:this,n,r);void 0!==o&&(r[r.length-1]=o)}}function Fl(t,e,n){return function(r,o){var i=t.call(void 0!==n?n:this,r,o);if(void 0!==i){var a=o[o.length-1],s=void 0!==e?e:r.localName,l=void 0;s in a?l=a[s]:(l=[],a[s]=l),l.push(i)}}}function Ul(t,e,n){return function(r,o){var i=t.call(void 0!==n?n:this,r,o);void 0!==i&&(o[o.length-1][void 0!==e?e:r.localName]=i)}}function Gl(t,e){return function(n,r,o){t.call(void 0!==e?e:this,n,r,o),o[o.length-1].node.appendChild(n)}}function Bl(t,e){var n,r;return function(e,o,i){if(void 0===n){n={};var a={};a[e.localName]=t,n[e.namespaceURI]=a,r=jl(e.localName)}Yl(n,r,o,i)}}function jl(t,e){var n=t;return function(t,r,o){var i=r[r.length-1].node,a=n;return void 0===a&&(a=o),xl(void 0!==e?e:i.namespaceURI,a)}}var Wl=jl();function ql(t,e){for(var n=e.length,r=new Array(n),o=0;o<n;++o)r[o]=t[e[o]];return r}function Hl(t,e,n){var r,o,i=void 0!==n?n:{};for(r=0,o=t.length;r<o;++r)i[t[r]]=e;return i}function Vl(t,e,n,r){var o;for(o=e.firstElementChild;o;o=o.nextElementSibling){var i=t[o.namespaceURI];if(void 0!==i){var a=i[o.localName];void 0!==a&&a.call(r,o,n)}}}function zl(t,e,n,r,o){return r.push(t),Vl(e,n,r,o),r.pop()}function Yl(t,e,n,r,o,i){for(var a,s,l=(void 0!==o?o:n).length,c=0;c<l;++c)void 0!==(a=n[c])&&void 0!==(s=e.call(void 0!==i?i:this,a,r,void 0!==o?o[c]:void 0))&&t[s.namespaceURI][s.localName].call(i,s,a,r)}function Kl(t,e,n,r,o,i,a){return o.push(t),Yl(e,n,r,o,i,a),o.pop()}var Xl=void 0;var $l=void 0;function Jl(){return void 0===$l&&"undefined"!=typeof document&&($l=document.implementation.createDocument("","",null)),$l}var Ql=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const tc=function(t){function e(){var e=t.call(this)||this;return e.xmlSerializer_=(void 0===Xl&&"undefined"!=typeof XMLSerializer&&(Xl=new XMLSerializer),Xl),e}return Ql(e,t),e.prototype.getType=function(){return Sl},e.prototype.readFeature=function(t,e){if(t){if("string"==typeof t){var n=Zl(t);return this.readFeatureFromDocument(n,e)}return Rl(t)?this.readFeatureFromDocument(t,e):this.readFeatureFromNode(t,e)}return null},e.prototype.readFeatureFromDocument=function(t,e){var n=this.readFeaturesFromDocument(t,e);return n.length>0?n[0]:null},e.prototype.readFeatureFromNode=function(t,e){return null},e.prototype.readFeatures=function(t,e){if(t){if("string"==typeof t){var n=Zl(t);return this.readFeaturesFromDocument(n,e)}return Rl(t)?this.readFeaturesFromDocument(t,e):this.readFeaturesFromNode(t,e)}return[]},e.prototype.readFeaturesFromDocument=function(t,e){for(var n=[],r=t.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&d(n,this.readFeaturesFromNode(r,e));return n},e.prototype.readFeaturesFromNode=function(t,e){return r()},e.prototype.readGeometry=function(t,e){if(t){if("string"==typeof t){var n=Zl(t);return this.readGeometryFromDocument(n,e)}return Rl(t)?this.readGeometryFromDocument(t,e):this.readGeometryFromNode(t,e)}return null},e.prototype.readGeometryFromDocument=function(t,e){return null},e.prototype.readGeometryFromNode=function(t,e){return null},e.prototype.readProjection=function(t){if(t){if("string"==typeof t){var e=Zl(t);return this.readProjectionFromDocument(e)}return Rl(t)?this.readProjectionFromDocument(t):this.readProjectionFromNode(t)}return null},e.prototype.readProjectionFromDocument=function(t){return this.dataProjection},e.prototype.readProjectionFromNode=function(t){return this.dataProjection},e.prototype.writeFeature=function(t,e){var n=this.writeFeatureNode(t,e);return this.xmlSerializer_.serializeToString(n)},e.prototype.writeFeatureNode=function(t,e){return null},e.prototype.writeFeatures=function(t,e){var n=this.writeFeaturesNode(t,e);return this.xmlSerializer_.serializeToString(n)},e.prototype.writeFeaturesNode=function(t,e){return null},e.prototype.writeGeometry=function(t,e){var n=this.writeGeometryNode(t,e);return this.xmlSerializer_.serializeToString(n)},e.prototype.writeGeometryNode=function(t,e){return null},e}(Tl);var ec=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),nc="http://www.opengis.net/gml",rc=/^[\s\xa0]*$/,oc=function(t){function e(e){var n=t.call(this)||this,r=e||{};return n.featureType=r.featureType,n.featureNS=r.featureNS,n.srsName=r.srsName,n.schemaLocation="",n.FEATURE_COLLECTION_PARSERS={},n.FEATURE_COLLECTION_PARSERS[n.namespace]={featureMember:kl(n.readFeaturesInternal),featureMembers:Nl(n.readFeaturesInternal)},n.supportedMediaTypes=["application/gml+xml"],n}return ec(e,t),e.prototype.readFeaturesInternal=function(t,e){var n=t.localName,r=null;if("FeatureCollection"==n)r=zl([],this.FEATURE_COLLECTION_PARSERS,t,e,this);else if("featureMembers"==n||"featureMember"==n||"member"==n){var o=e[0],i=o.featureType,a=o.featureNS;if(!i&&t.childNodes){i=[],a={};for(var s=0,l=t.childNodes.length;s<l;++s){var c=t.childNodes[s];if(1===c.nodeType){var u=c.nodeName.split(":").pop();if(-1===i.indexOf(u)){var p="",d=0,h=c.namespaceURI;for(var f in a){if(a[f]===h){p=f;break}++d}p||(a[p="p"+d]=h),i.push(p+":"+u)}}}"featureMember"!=n&&(o.featureType=i,o.featureNS=a)}if("string"==typeof a){var m=a;(a={}).p0=m}var g={},y=Array.isArray(i)?i:[i];for(var v in a){var _={};for(s=0,l=y.length;s<l;++s){(-1===y[s].indexOf(":")?"p0":y[s].split(":")[0])===v&&(_[y[s].split(":").pop()]="featureMembers"==n?kl(this.readFeatureElement,this):Nl(this.readFeatureElement,this))}g[a[v]]=_}r=zl("featureMember"==n||"member"==n?void 0:[],g,t,e)}return null===r&&(r=[]),r},e.prototype.readGeometryElement=function(t,e){var n=e[0];n.srsName=t.firstElementChild.getAttribute("srsName"),n.srsDimension=t.firstElementChild.getAttribute("srsDimension");var r=zl(null,this.GEOMETRY_PARSERS,t,e,this);return r?Array.isArray(r)?Al(r,n):Pl(r,!1,n):void 0},e.prototype.readFeatureElementInternal=function(t,e,n){for(var r,o={},i=t.firstElementChild;i;i=i.nextElementSibling){var a=void 0,s=i.localName;0===i.childNodes.length||1===i.childNodes.length&&(3===i.firstChild.nodeType||4===i.firstChild.nodeType)?(a=Il(i,!1),rc.test(a)&&(a=void 0)):(n&&(a=this.readGeometryElement(i,e)),a?"boundedBy"!==s&&(r=s):a=this.readFeatureElementInternal(i,e,!1)),o[s]?(o[s]instanceof Array||(o[s]=[o[s]]),o[s].push(a)):o[s]=a;var l=i.attributes.length;if(l>0){o[s]={_content_:o[s]};for(var c=0;c<l;c++){var u=i.attributes[c].name;o[s][u]=i.attributes[c].value}}}if(n){var p=new Xs(o);r&&p.setGeometryName(r);var d=t.getAttribute("fid")||function(t,e,n){return t.getAttributeNS(e,n)||""}(t,this.namespace,"id");return d&&p.setId(d),p}return o},e.prototype.readFeatureElement=function(t,e){return this.readFeatureElementInternal(t,e,!0)},e.prototype.readPoint=function(t,e){var n=this.readFlatCoordinatesFromNode(t,e);if(n)return new _i(n,Fo.XYZ)},e.prototype.readMultiPoint=function(t,e){var n=zl([],this.MULTIPOINT_PARSERS,t,e,this);return n?new Qs(n):void 0},e.prototype.readMultiLineString=function(t,e){var n=zl([],this.MULTILINESTRING_PARSERS,t,e,this);if(n)return new cl(n)},e.prototype.readMultiPolygon=function(t,e){var n=zl([],this.MULTIPOLYGON_PARSERS,t,e,this);if(n)return new dl(n)},e.prototype.pointMemberParser=function(t,e){Vl(this.POINTMEMBER_PARSERS,t,e,this)},e.prototype.lineStringMemberParser=function(t,e){Vl(this.LINESTRINGMEMBER_PARSERS,t,e,this)},e.prototype.polygonMemberParser=function(t,e){Vl(this.POLYGONMEMBER_PARSERS,t,e,this)},e.prototype.readLineString=function(t,e){var n=this.readFlatCoordinatesFromNode(t,e);return n?new al(n,Fo.XYZ):void 0},e.prototype.readFlatLinearRing=function(t,e){var n=zl(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this);return n||void 0},e.prototype.readLinearRing=function(t,e){var n=this.readFlatCoordinatesFromNode(t,e);if(n)return new gi(n,Fo.XYZ)},e.prototype.readPolygon=function(t,e){var n=zl([null],this.FLAT_LINEAR_RINGS_PARSERS,t,e,this);if(n&&n[0]){var r,o=n[0],i=[o.length],a=void 0;for(a=1,r=n.length;a<r;++a)d(o,n[a]),i.push(o.length);return new Zi(o,Fo.XYZ,i)}},e.prototype.readFlatCoordinatesFromNode=function(t,e){return zl(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this)},e.prototype.readGeometryFromNode=function(t,e){var n=this.readGeometryElement(t,[this.getReadOptions(t,e||{})]);return n||null},e.prototype.readFeaturesFromNode=function(t,e){var n={featureType:this.featureType,featureNS:this.featureNS};return e&&oe(n,this.getReadOptions(t,e)),this.readFeaturesInternal(t,[n])||[]},e.prototype.readProjectionFromNode=function(t){return io(this.srsName?this.srsName:t.firstElementChild.getAttribute("srsName"))},e}(tc);oc.prototype.namespace=nc,oc.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}},oc.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}},oc.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}},oc.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:kl(oc.prototype.pointMemberParser),pointMembers:kl(oc.prototype.pointMemberParser)}},oc.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:kl(oc.prototype.lineStringMemberParser),lineStringMembers:kl(oc.prototype.lineStringMemberParser)}},oc.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:kl(oc.prototype.polygonMemberParser),polygonMembers:kl(oc.prototype.polygonMemberParser)}},oc.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:kl(oc.prototype.readFlatCoordinatesFromNode)}},oc.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:kl(oc.prototype.readLineString)}},oc.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:kl(oc.prototype.readPolygon)}},oc.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:Nl(oc.prototype.readFlatLinearRing)}};const ic=oc,ac="http://www.opengis.net/gml",sc="http://www.opengis.net/gml/3.2";ic.prototype.MULTIPOINT_PARSERS[sc]=ic.prototype.MULTIPOINT_PARSERS[ac],ic.prototype.MULTILINESTRING_PARSERS[sc]=ic.prototype.MULTILINESTRING_PARSERS[ac],ic.prototype.MULTIPOLYGON_PARSERS[sc]=ic.prototype.MULTIPOLYGON_PARSERS[ac],ic.prototype.POINTMEMBER_PARSERS[sc]=ic.prototype.POINTMEMBER_PARSERS[ac],ic.prototype.LINESTRINGMEMBER_PARSERS[sc]=ic.prototype.LINESTRINGMEMBER_PARSERS[ac],ic.prototype.POLYGONMEMBER_PARSERS[sc]=ic.prototype.POLYGONMEMBER_PARSERS[ac],ic.prototype.RING_PARSERS[sc]=ic.prototype.RING_PARSERS[ac],ic.prototype.readFeaturesInternal=function(t,e){const n=t.localName;let r=null;if("FeatureCollection"==n){var o=this.FEATURE_COLLECTION_PARSERS[ol.format.GMLBase.prototype.namespace]||this.FEATURE_COLLECTION_PARSERS[this.namespace];o.member||(o.member=ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.readFeaturesInternal)),"http://www.opengis.net/wfs"===t.namespaceURI||(this.FEATURE_COLLECTION_PARSERS[t.namespaceURI]=this.FEATURE_COLLECTION_PARSERS[t.namespaceURI]||this.FEATURE_COLLECTION_PARSERS[ol.format.GMLBase.prototype.namespace]||this.FEATURE_COLLECTION_PARSERS[this.namespace]),r=ol.xml.pushParseAndPop([],this.FEATURE_COLLECTION_PARSERS,t,e,this)}else if("featureMembers"==n||"featureMember"==n||"member"==n){const o=e[0];let i=o.featureType,a=o.featureNS;const s="p",l="p0";if(/*!featureType && */t.childNodes){i=[],a={};for(let n=0,r=t.childNodes.length;n<r;++n){const r=t.childNodes[n];if(1===r.nodeType){const t=r.nodeName.split(":").pop();if("FeatureCollection"==t)return zl([],this.FEATURE_COLLECTION_PARSERS,r,e,this);if(-1===i.indexOf(t)){let e="",n=0;const o=r.namespaceURI;for(let t in a){if(a[t]===o){e=t;break}++n}e||(e=s+n,a[e]=o),i.push(e+":"+t)}}}"featureMember"!=n&&(o.featureType=i,o.featureNS=a)}if("string"==typeof a){const t=a;a={},a[l]=t}const c={},u=Array.isArray(i)?i:[i];for(let t in a){const e={};for(let r=0,o=u.length;r<o;++r){(-1===u[r].indexOf(":")?l:u[r].split(":")[0])===t&&(e[u[r].split(":").pop()]="featureMembers"==n?ol.xml.makeArrayPusher(this.readFeatureElement,this):ol.xml.makeReplacer(this.readFeatureElement,this))}c[a[t]]=e}r="featureMember"==n?ol.xml.pushParseAndPop(void 0,c,t,e):ol.xml.pushParseAndPop([],c,t,e)}return null===r&&(r=[]),r},ic.prototype.readGeometryElement=function(t,e){var n=e[0];if(n.srsName=t.firstElementChild.getAttribute("srsName"),n.srsDimension=t.firstElementChild.getAttribute("srsDimension"),(this instanceof ol.format.GML2CRS84||this instanceof ol.format.GML3CRS84)&&("EPSG:4326"!==n.srsName||!n.srsName))throw new Error("Conflicto de CRS");n.srsName||(n.srsName=this.srsName),n.dataProjection=ol.proj.get(n.srsName);const r=ol.xml.pushParseAndPop(null,this.GEOMETRY_PARSERS,t,e,this);return r?Array.isArray(r)?Al(r,n):Pl(r,!1,n):void 0};const lc=/^[\s\xa0]*$/;ic.prototype.readFeatureElementInternal=function(t,e,n){let r;const o={};for(let i=t.firstElementChild;i;i=i.nextElementSibling){let t;const a=i.localName;0===i.childNodes.length||1===i.childNodes.length&&(3===i.firstChild.nodeType||4===i.firstChild.nodeType)?(t=ol.xml.getAllTextContent(i,!1),lc.test(t)&&(t=void 0)):(n&&(t=this.readGeometryElement(i,e)),t?"boundedBy"!==a&&"referencePoint"!==a&&(r=a):t=this.readFeatureElementInternal(i,e,!1)),o[a]?(o[a]instanceof Array||(o[a]=[o[a]]),o[a].push(t)):o[a]=t;const s=i.attributes.length;if(s>0){o[a]={_content_:o[a]};for(let t=0;t<s;t++){const e=i.attributes[t].name;o[a][e]=i.attributes[t].value}}}if(n){const e=new ol.Feature(o);r&&e.setGeometryName(r);const n=t.getAttribute("fid")||t.getAttributeNS(this.namespace,"id");return n&&e.setId(n),e}return o};const cc=ic;function uc(t){return pc(Il(t,!1))}function pc(t){var e=/^\s*(true|1)|(false|0)\s*$/.exec(t);return e?void 0!==e[1]||!1:void 0}function dc(t){var e=Il(t,!1),n=Date.parse(e);return isNaN(n)?void 0:n/1e3}function hc(t){return fc(Il(t,!1))}function fc(t){var e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(t);return e?parseFloat(e[1]):void 0}function mc(t){return gc(Il(t,!1))}function gc(t){var e=/^\s*(\d+)\s*$/.exec(t);return e?parseInt(e[1],10):void 0}function yc(t){return Il(t,!1).trim()}function vc(t,e){wc(t,e?"1":"0")}function _c(t,e){t.appendChild(Jl().createCDATASection(e))}function Cc(t,e){var n=e.toPrecision();t.appendChild(Jl().createTextNode(n))}function Ec(t,e){var n=e.toString();t.appendChild(Jl().createTextNode(n))}function wc(t,e){t.appendChild(Jl().createTextNode(e))}var Sc=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),bc={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"},Lc=function(t){function e(e){var n=this,r=e||{};return(n=t.call(this,r)||this).FEATURE_COLLECTION_PARSERS[nc].featureMember=kl(n.readFeaturesInternal),n.schemaLocation=r.schemaLocation?r.schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",n}return Sc(e,t),e.prototype.readFlatCoordinates=function(t,e){var n=Il(t,!1).replace(/^\s*|\s*$/g,""),r=e[0].srsName,o="enu";if(r){var i=io(r);i&&(o=i.getAxisOrientation())}for(var a=n.trim().split(/\s+/),s=[],l=0,c=a.length;l<c;l++){var u=a[l].split(/,+/),p=parseFloat(u[0]),d=parseFloat(u[1]),h=3===u.length?parseFloat(u[2]):0;"en"===o.substr(0,2)?s.push(p,d,h):s.push(d,p,h)}return s},e.prototype.readBox=function(t,e){var n=zl([null],this.BOX_PARSERS_,t,e,this);return at(n[1][0],n[1][1],n[1][3],n[1][4])},e.prototype.innerBoundaryIsParser=function(t,e){var n=zl(void 0,this.RING_PARSERS,t,e,this);n&&e[e.length-1].push(n)},e.prototype.outerBoundaryIsParser=function(t,e){var n=zl(void 0,this.RING_PARSERS,t,e,this);n&&(e[e.length-1][0]=n)},e.prototype.GEOMETRY_NODE_FACTORY_=function(t,e,n){var r,o=e[e.length-1],i=o.multiSurface,a=o.surface,s=o.multiCurve;return Array.isArray(t)?r="Envelope":"MultiPolygon"===(r=t.getType())&&!0===i?r="MultiSurface":"Polygon"===r&&!0===a?r="Surface":"MultiLineString"===r&&!0===s&&(r="MultiCurve"),xl("http://www.opengis.net/gml",r)},e.prototype.writeFeatureElement=function(t,e,n){var r=e.getId();r&&t.setAttribute("fid",r);var o=n[n.length-1],i=o.featureNS,a=e.getGeometryName();o.serializers||(o.serializers={},o.serializers[i]={});var s=[],l=[];if(e.hasProperties()){var c=e.getProperties();for(var u in c){var p=c[u];null!==p&&(s.push(u),l.push(p),u==a||"function"==typeof p.getSimplifiedGeometry?u in o.serializers[i]||(o.serializers[i][u]=Gl(this.writeGeometryElement,this)):u in o.serializers[i]||(o.serializers[i][u]=Gl(wc)))}}var d=oe({},o);d.node=t,Kl(d,o.serializers,jl(void 0,i),l,n,s)},e.prototype.writeCurveOrLineString=function(t,e,n){var r=n[n.length-1].srsName;if("LineStringSegment"!==t.nodeName&&r&&t.setAttribute("srsName",r),"LineString"===t.nodeName||"LineStringSegment"===t.nodeName){var o=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(o),this.writeCoordinates_(o,e,n)}else if("Curve"===t.nodeName){var i=xl(t.namespaceURI,"segments");t.appendChild(i),this.writeCurveSegments_(i,e,n)}},e.prototype.writeLineStringOrCurveMember=function(t,e,n){var r=this.GEOMETRY_NODE_FACTORY_(e,n);r&&(t.appendChild(r),this.writeCurveOrLineString(r,e,n))},e.prototype.writeMultiCurveOrLineString=function(t,e,n){var r=n[n.length-1],o=r.hasZ,i=r.srsName,a=r.curve;i&&t.setAttribute("srsName",i);var s=e.getLineStrings();Kl({node:t,hasZ:o,srsName:i,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,n,void 0,this)},e.prototype.writeGeometryElement=function(t,e,n){var r,o=n[n.length-1],i=oe({},o);i.node=t,r=Array.isArray(e)?Al(e,o):Pl(e,!0,o),Kl(i,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[r],n,void 0,this)},e.prototype.createCoordinatesNode_=function(t){var e=xl(t,"coordinates");return e.setAttribute("decimal","."),e.setAttribute("cs",","),e.setAttribute("ts"," "),e},e.prototype.writeCoordinates_=function(t,e,n){for(var r=n[n.length-1],o=r.hasZ,i=r.srsName,a=e.getCoordinates(),s=a.length,l=new Array(s),c=0;c<s;++c){var u=a[c];l[c]=this.getCoords_(u,i,o)}wc(t,l.join(" "))},e.prototype.writeCurveSegments_=function(t,e,n){var r=xl(t.namespaceURI,"LineStringSegment");t.appendChild(r),this.writeCurveOrLineString(r,e,n)},e.prototype.writeSurfaceOrPolygon=function(t,e,n){var r=n[n.length-1],o=r.hasZ,i=r.srsName;if("PolygonPatch"!==t.nodeName&&i&&t.setAttribute("srsName",i),"Polygon"===t.nodeName||"PolygonPatch"===t.nodeName){var a=e.getLinearRings();Kl({node:t,hasZ:o,srsName:i},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,n,void 0,this)}else if("Surface"===t.nodeName){var s=xl(t.namespaceURI,"patches");t.appendChild(s),this.writeSurfacePatches_(s,e,n)}},e.prototype.RING_NODE_FACTORY_=function(t,e,n){var r=e[e.length-1],o=r.node,i=r.exteriorWritten;return void 0===i&&(r.exteriorWritten=!0),xl(o.namespaceURI,void 0!==i?"innerBoundaryIs":"outerBoundaryIs")},e.prototype.writeSurfacePatches_=function(t,e,n){var r=xl(t.namespaceURI,"PolygonPatch");t.appendChild(r),this.writeSurfaceOrPolygon(r,e,n)},e.prototype.writeRing=function(t,e,n){var r=xl(t.namespaceURI,"LinearRing");t.appendChild(r),this.writeLinearRing(r,e,n)},e.prototype.getCoords_=function(t,e,n){var r="enu";e&&(r=io(e).getAxisOrientation());var o="en"===r.substr(0,2)?t[0]+","+t[1]:t[1]+","+t[0];n&&(o+=","+(t[2]||0));return o},e.prototype.writePoint=function(t,e,n){var r=n[n.length-1],o=r.hasZ,i=r.srsName;i&&t.setAttribute("srsName",i);var a=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(a);var s=e.getCoordinates();wc(a,this.getCoords_(s,i,o))},e.prototype.writeMultiPoint=function(t,e,n){var r=n[n.length-1],o=r.hasZ,i=r.srsName;i&&t.setAttribute("srsName",i);var a=e.getPoints();Kl({node:t,hasZ:o,srsName:i},this.POINTMEMBER_SERIALIZERS,jl("pointMember"),a,n,void 0,this)},e.prototype.writePointMember=function(t,e,n){var r=xl(t.namespaceURI,"Point");t.appendChild(r),this.writePoint(r,e,n)},e.prototype.writeLinearRing=function(t,e,n){var r=n[n.length-1].srsName;r&&t.setAttribute("srsName",r);var o=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(o),this.writeCoordinates_(o,e,n)},e.prototype.writeMultiSurfaceOrPolygon=function(t,e,n){var r=n[n.length-1],o=r.hasZ,i=r.srsName,a=r.surface;i&&t.setAttribute("srsName",i);var s=e.getPolygons();Kl({node:t,hasZ:o,srsName:i,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,n,void 0,this)},e.prototype.writeSurfaceOrPolygonMember=function(t,e,n){var r=this.GEOMETRY_NODE_FACTORY_(e,n);r&&(t.appendChild(r),this.writeSurfaceOrPolygon(r,e,n))},e.prototype.writeEnvelope=function(t,e,n){var r=n[n.length-1].srsName;r&&t.setAttribute("srsName",r);var o=[e[0]+" "+e[1],e[2]+" "+e[3]];Kl({node:t},this.ENVELOPE_SERIALIZERS,Wl,o,n,["lowerCorner","upperCorner"],this)},e.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_=function(t,e,n){var r=e[e.length-1].node;return xl("http://www.opengis.net/gml",bc[r.nodeName])},e}(ic);Lc.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:Nl(Lc.prototype.readFlatCoordinates)}},Lc.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:Lc.prototype.innerBoundaryIsParser,outerBoundaryIs:Lc.prototype.outerBoundaryIsParser}},Lc.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:kl(Lc.prototype.readFlatCoordinates)}},Lc.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:Nl(ic.prototype.readPoint),MultiPoint:Nl(ic.prototype.readMultiPoint),LineString:Nl(ic.prototype.readLineString),MultiLineString:Nl(ic.prototype.readMultiLineString),LinearRing:Nl(ic.prototype.readLinearRing),Polygon:Nl(ic.prototype.readPolygon),MultiPolygon:Nl(ic.prototype.readMultiPolygon),Box:Nl(Lc.prototype.readBox)}},Lc.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:Gl(Lc.prototype.writeCurveOrLineString),MultiCurve:Gl(Lc.prototype.writeMultiCurveOrLineString),Point:Gl(Lc.prototype.writePoint),MultiPoint:Gl(Lc.prototype.writeMultiPoint),LineString:Gl(Lc.prototype.writeCurveOrLineString),MultiLineString:Gl(Lc.prototype.writeMultiCurveOrLineString),LinearRing:Gl(Lc.prototype.writeLinearRing),Polygon:Gl(Lc.prototype.writeSurfaceOrPolygon),MultiPolygon:Gl(Lc.prototype.writeMultiSurfaceOrPolygon),Surface:Gl(Lc.prototype.writeSurfaceOrPolygon),MultiSurface:Gl(Lc.prototype.writeMultiSurfaceOrPolygon),Envelope:Gl(Lc.prototype.writeEnvelope)}},Lc.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:Gl(Lc.prototype.writeLineStringOrCurveMember),curveMember:Gl(Lc.prototype.writeLineStringOrCurveMember)}},Lc.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:Gl(Lc.prototype.writeRing),innerBoundaryIs:Gl(Lc.prototype.writeRing)}},Lc.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:Gl(Lc.prototype.writePointMember)}},Lc.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:Gl(Lc.prototype.writeSurfaceOrPolygonMember),polygonMember:Gl(Lc.prototype.writeSurfaceOrPolygonMember)}},Lc.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:Gl(wc),upperCorner:Gl(wc)}};const Tc=Lc;var Pc=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ac={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"},Oc=function(t){function e(e){var n=this,r=e||{};return(n=t.call(this,r)||this).surface_=void 0!==r.surface&&r.surface,n.curve_=void 0!==r.curve&&r.curve,n.multiCurve_=void 0===r.multiCurve||r.multiCurve,n.multiSurface_=void 0===r.multiSurface||r.multiSurface,n.schemaLocation=r.schemaLocation?r.schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",n.hasZ=void 0!==r.hasZ&&r.hasZ,n}return Pc(e,t),e.prototype.readMultiCurve=function(t,e){var n=zl([],this.MULTICURVE_PARSERS,t,e,this);return n?new cl(n):void 0},e.prototype.readMultiSurface=function(t,e){var n=zl([],this.MULTISURFACE_PARSERS,t,e,this);if(n)return new dl(n)},e.prototype.curveMemberParser=function(t,e){Vl(this.CURVEMEMBER_PARSERS,t,e,this)},e.prototype.surfaceMemberParser=function(t,e){Vl(this.SURFACEMEMBER_PARSERS,t,e,this)},e.prototype.readPatch=function(t,e){return zl([null],this.PATCHES_PARSERS,t,e,this)},e.prototype.readSegment=function(t,e){return zl([null],this.SEGMENTS_PARSERS,t,e,this)},e.prototype.readPolygonPatch=function(t,e){return zl([null],this.FLAT_LINEAR_RINGS_PARSERS,t,e,this)},e.prototype.readLineStringSegment=function(t,e){return zl([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this)},e.prototype.interiorParser=function(t,e){var n=zl(void 0,this.RING_PARSERS,t,e,this);n&&e[e.length-1].push(n)},e.prototype.exteriorParser=function(t,e){var n=zl(void 0,this.RING_PARSERS,t,e,this);n&&(e[e.length-1][0]=n)},e.prototype.readSurface=function(t,e){var n=zl([null],this.SURFACE_PARSERS,t,e,this);if(n&&n[0]){var r,o=n[0],i=[o.length],a=void 0;for(a=1,r=n.length;a<r;++a)d(o,n[a]),i.push(o.length);return new Zi(o,Fo.XYZ,i)}},e.prototype.readCurve=function(t,e){var n=zl([null],this.CURVE_PARSERS,t,e,this);return n?new al(n,Fo.XYZ):void 0},e.prototype.readEnvelope=function(t,e){var n=zl([null],this.ENVELOPE_PARSERS,t,e,this);return at(n[1][0],n[1][1],n[2][0],n[2][1])},e.prototype.readFlatPos=function(t,e){for(var n,r=Il(t,!1),o=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,i=[];n=o.exec(r);)i.push(parseFloat(n[1])),r=r.substr(n[0].length);if(""===r){var a=e[0].srsName,s="enu";if(a)s=io(a).getAxisOrientation();if("neu"===s){var l,c=void 0;for(c=0,l=i.length;c<l;c+=3){var u=i[c],p=i[c+1];i[c]=p,i[c+1]=u}}var d=i.length;if(2==d&&i.push(0),0!==d)return i}},e.prototype.readFlatPosList=function(t,e){var n=Il(t,!1).replace(/^\s*|\s*$/g,""),r=e[0],o=r.srsName,i=r.srsDimension,a="enu";o&&(a=io(o).getAxisOrientation());var s,l,c,u=n.split(/\s+/),p=2;t.getAttribute("srsDimension")?p=gc(t.getAttribute("srsDimension")):t.getAttribute("dimension")?p=gc(t.getAttribute("dimension")):t.parentNode.getAttribute("srsDimension")?p=gc(t.parentNode.getAttribute("srsDimension")):i&&(p=gc(i));for(var d=[],h=0,f=u.length;h<f;h+=p)s=parseFloat(u[h]),l=parseFloat(u[h+1]),c=3===p?parseFloat(u[h+2]):0,"en"===a.substr(0,2)?d.push(s,l,c):d.push(l,s,c);return d},e.prototype.writePos_=function(t,e,n){var r=n[n.length-1],o=r.hasZ,i=o?"3":"2";t.setAttribute("srsDimension",i);var a=r.srsName,s="enu";a&&(s=io(a).getAxisOrientation());var l,c=e.getCoordinates();(l="en"===s.substr(0,2)?c[0]+" "+c[1]:c[1]+" "+c[0],o)&&(l+=" "+(c[2]||0));wc(t,l)},e.prototype.getCoords_=function(t,e,n){var r="enu";e&&(r=io(e).getAxisOrientation());var o="en"===r.substr(0,2)?t[0]+" "+t[1]:t[1]+" "+t[0];n&&(o+=" "+(t[2]||0));return o},e.prototype.writePosList_=function(t,e,n){var r=n[n.length-1],o=r.hasZ,i=o?"3":"2";t.setAttribute("srsDimension",i);for(var a,s=r.srsName,l=e.getCoordinates(),c=l.length,u=new Array(c),p=0;p<c;++p)a=l[p],u[p]=this.getCoords_(a,s,o);wc(t,u.join(" "))},e.prototype.writePoint=function(t,e,n){var r=n[n.length-1].srsName;r&&t.setAttribute("srsName",r);var o=xl(t.namespaceURI,"pos");t.appendChild(o),this.writePos_(o,e,n)},e.prototype.writeEnvelope=function(t,e,n){var r=n[n.length-1].srsName;r&&t.setAttribute("srsName",r);var o=[e[0]+" "+e[1],e[2]+" "+e[3]];Kl({node:t},this.ENVELOPE_SERIALIZERS,Wl,o,n,["lowerCorner","upperCorner"],this)},e.prototype.writeLinearRing=function(t,e,n){var r=n[n.length-1].srsName;r&&t.setAttribute("srsName",r);var o=xl(t.namespaceURI,"posList");t.appendChild(o),this.writePosList_(o,e,n)},e.prototype.RING_NODE_FACTORY_=function(t,e,n){var r=e[e.length-1],o=r.node,i=r.exteriorWritten;return void 0===i&&(r.exteriorWritten=!0),xl(o.namespaceURI,void 0!==i?"interior":"exterior")},e.prototype.writeSurfaceOrPolygon=function(t,e,n){var r=n[n.length-1],o=r.hasZ,i=r.srsName;if("PolygonPatch"!==t.nodeName&&i&&t.setAttribute("srsName",i),"Polygon"===t.nodeName||"PolygonPatch"===t.nodeName){var a=e.getLinearRings();Kl({node:t,hasZ:o,srsName:i},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,n,void 0,this)}else if("Surface"===t.nodeName){var s=xl(t.namespaceURI,"patches");t.appendChild(s),this.writeSurfacePatches_(s,e,n)}},e.prototype.writeCurveOrLineString=function(t,e,n){var r=n[n.length-1].srsName;if("LineStringSegment"!==t.nodeName&&r&&t.setAttribute("srsName",r),"LineString"===t.nodeName||"LineStringSegment"===t.nodeName){var o=xl(t.namespaceURI,"posList");t.appendChild(o),this.writePosList_(o,e,n)}else if("Curve"===t.nodeName){var i=xl(t.namespaceURI,"segments");t.appendChild(i),this.writeCurveSegments_(i,e,n)}},e.prototype.writeMultiSurfaceOrPolygon=function(t,e,n){var r=n[n.length-1],o=r.hasZ,i=r.srsName,a=r.surface;i&&t.setAttribute("srsName",i);var s=e.getPolygons();Kl({node:t,hasZ:o,srsName:i,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,n,void 0,this)},e.prototype.writeMultiPoint=function(t,e,n){var r=n[n.length-1],o=r.srsName,i=r.hasZ;o&&t.setAttribute("srsName",o);var a=e.getPoints();Kl({node:t,hasZ:i,srsName:o},this.POINTMEMBER_SERIALIZERS,jl("pointMember"),a,n,void 0,this)},e.prototype.writeMultiCurveOrLineString=function(t,e,n){var r=n[n.length-1],o=r.hasZ,i=r.srsName,a=r.curve;i&&t.setAttribute("srsName",i);var s=e.getLineStrings();Kl({node:t,hasZ:o,srsName:i,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,n,void 0,this)},e.prototype.writeRing=function(t,e,n){var r=xl(t.namespaceURI,"LinearRing");t.appendChild(r),this.writeLinearRing(r,e,n)},e.prototype.writeSurfaceOrPolygonMember=function(t,e,n){var r=this.GEOMETRY_NODE_FACTORY_(e,n);r&&(t.appendChild(r),this.writeSurfaceOrPolygon(r,e,n))},e.prototype.writePointMember=function(t,e,n){var r=xl(t.namespaceURI,"Point");t.appendChild(r),this.writePoint(r,e,n)},e.prototype.writeLineStringOrCurveMember=function(t,e,n){var r=this.GEOMETRY_NODE_FACTORY_(e,n);r&&(t.appendChild(r),this.writeCurveOrLineString(r,e,n))},e.prototype.writeSurfacePatches_=function(t,e,n){var r=xl(t.namespaceURI,"PolygonPatch");t.appendChild(r),this.writeSurfaceOrPolygon(r,e,n)},e.prototype.writeCurveSegments_=function(t,e,n){var r=xl(t.namespaceURI,"LineStringSegment");t.appendChild(r),this.writeCurveOrLineString(r,e,n)},e.prototype.writeGeometryElement=function(t,e,n){var r,o=n[n.length-1],i=oe({},o);i.node=t,r=Array.isArray(e)?Al(e,o):Pl(e,!0,o),Kl(i,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[r],n,void 0,this)},e.prototype.writeFeatureElement=function(t,e,n){var r=e.getId();r&&t.setAttribute("fid",r);var o=n[n.length-1],i=o.featureNS,a=e.getGeometryName();o.serializers||(o.serializers={},o.serializers[i]={});var s=[],l=[];if(e.hasProperties()){var c=e.getProperties();for(var u in c){var p=c[u];null!==p&&(s.push(u),l.push(p),u==a||"function"==typeof p.getSimplifiedGeometry?u in o.serializers[i]||(o.serializers[i][u]=Gl(this.writeGeometryElement,this)):u in o.serializers[i]||(o.serializers[i][u]=Gl(wc)))}}var d=oe({},o);d.node=t,Kl(d,o.serializers,jl(void 0,i),l,n,s)},e.prototype.writeFeatureMembers_=function(t,e,n){var r=n[n.length-1],o=r.featureType,i=r.featureNS,a={};a[i]={},a[i][o]=Gl(this.writeFeatureElement,this);var s=oe({},r);s.node=t,Kl(s,a,jl(o,i),e,n)},e.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_=function(t,e,n){var r=e[e.length-1].node;return xl(this.namespace,Ac[r.nodeName])},e.prototype.GEOMETRY_NODE_FACTORY_=function(t,e,n){var r,o=e[e.length-1],i=o.multiSurface,a=o.surface,s=o.curve,l=o.multiCurve;return Array.isArray(t)?r="Envelope":"MultiPolygon"===(r=t.getType())&&!0===i?r="MultiSurface":"Polygon"===r&&!0===a?r="Surface":"LineString"===r&&!0===s?r="Curve":"MultiLineString"===r&&!0===l&&(r="MultiCurve"),xl(this.namespace,r)},e.prototype.writeGeometryNode=function(t,e){e=this.adaptOptions(e);var n=xl(this.namespace,"geom"),r={node:n,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return e&&oe(r,e),this.writeGeometryElement(n,t,[r]),n},e.prototype.writeFeaturesNode=function(t,e){e=this.adaptOptions(e);var n=xl(this.namespace,"featureMembers");n.setAttributeNS(Ol,"xsi:schemaLocation",this.schemaLocation);var r={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return e&&oe(r,e),this.writeFeatureMembers_(n,t,[r]),n},e}(ic);Oc.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:Nl(Oc.prototype.readFlatPos),posList:Nl(Oc.prototype.readFlatPosList),coordinates:Nl(Tc.prototype.readFlatCoordinates)}},Oc.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:Oc.prototype.interiorParser,exterior:Oc.prototype.exteriorParser}},Oc.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:Nl(ic.prototype.readPoint),MultiPoint:Nl(ic.prototype.readMultiPoint),LineString:Nl(ic.prototype.readLineString),MultiLineString:Nl(ic.prototype.readMultiLineString),LinearRing:Nl(ic.prototype.readLinearRing),Polygon:Nl(ic.prototype.readPolygon),MultiPolygon:Nl(ic.prototype.readMultiPolygon),Surface:Nl(Oc.prototype.readSurface),MultiSurface:Nl(Oc.prototype.readMultiSurface),Curve:Nl(Oc.prototype.readCurve),MultiCurve:Nl(Oc.prototype.readMultiCurve),Envelope:Nl(Oc.prototype.readEnvelope)}},Oc.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:kl(Oc.prototype.curveMemberParser),curveMembers:kl(Oc.prototype.curveMemberParser)}},Oc.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:kl(Oc.prototype.surfaceMemberParser),surfaceMembers:kl(Oc.prototype.surfaceMemberParser)}},Oc.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:kl(ic.prototype.readLineString),Curve:kl(Oc.prototype.readCurve)}},Oc.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:kl(ic.prototype.readPolygon),Surface:kl(Oc.prototype.readSurface)}},Oc.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:Nl(Oc.prototype.readPatch)}},Oc.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:Nl(Oc.prototype.readSegment)}},Oc.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:kl(Oc.prototype.readFlatPosList),upperCorner:kl(Oc.prototype.readFlatPosList)}},Oc.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:Nl(Oc.prototype.readPolygonPatch)}},Oc.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:Nl(Oc.prototype.readLineStringSegment)}},Oc.prototype.writeFeatures,Oc.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:Gl(Oc.prototype.writeRing),interior:Gl(Oc.prototype.writeRing)}},Oc.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:Gl(wc),upperCorner:Gl(wc)}},Oc.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:Gl(Oc.prototype.writeSurfaceOrPolygonMember),polygonMember:Gl(Oc.prototype.writeSurfaceOrPolygonMember)}},Oc.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:Gl(Oc.prototype.writePointMember)}},Oc.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:Gl(Oc.prototype.writeLineStringOrCurveMember),curveMember:Gl(Oc.prototype.writeLineStringOrCurveMember)}},Oc.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:Gl(Oc.prototype.writeCurveOrLineString),MultiCurve:Gl(Oc.prototype.writeMultiCurveOrLineString),Point:Gl(Oc.prototype.writePoint),MultiPoint:Gl(Oc.prototype.writeMultiPoint),LineString:Gl(Oc.prototype.writeCurveOrLineString),MultiLineString:Gl(Oc.prototype.writeMultiCurveOrLineString),LinearRing:Gl(Oc.prototype.writeLinearRing),Polygon:Gl(Oc.prototype.writeSurfaceOrPolygon),MultiPolygon:Gl(Oc.prototype.writeMultiSurfaceOrPolygon),Surface:Gl(Oc.prototype.writeSurfaceOrPolygon),MultiSurface:Gl(Oc.prototype.writeMultiSurfaceOrPolygon),Envelope:Gl(Oc.prototype.writeEnvelope)}};const xc=Oc;var Ic=xc;Ic.prototype.writeFeatures,Ic.prototype.writeFeaturesNode;const Mc=Ic;var Rc=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Zc=function(t){function e(e){var n=this,r=e||{};return(n=t.call(this,r)||this).schemaLocation=r.schemaLocation?r.schemaLocation:n.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd",n}return Rc(e,t),e}(xc);Zc.prototype.namespace="http://www.opengis.net/gml/3.2",Zc.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:Nl(xc.prototype.readFlatPos),posList:Nl(xc.prototype.readFlatPosList),coordinates:Nl(Tc.prototype.readFlatCoordinates)}},Zc.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:xc.prototype.interiorParser,exterior:xc.prototype.exteriorParser}},Zc.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:Nl(ic.prototype.readPoint),MultiPoint:Nl(ic.prototype.readMultiPoint),LineString:Nl(ic.prototype.readLineString),MultiLineString:Nl(ic.prototype.readMultiLineString),LinearRing:Nl(ic.prototype.readLinearRing),Polygon:Nl(ic.prototype.readPolygon),MultiPolygon:Nl(ic.prototype.readMultiPolygon),Surface:Nl(Zc.prototype.readSurface),MultiSurface:Nl(xc.prototype.readMultiSurface),Curve:Nl(Zc.prototype.readCurve),MultiCurve:Nl(xc.prototype.readMultiCurve),Envelope:Nl(Zc.prototype.readEnvelope)}},Zc.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:kl(xc.prototype.curveMemberParser),curveMembers:kl(xc.prototype.curveMemberParser)}},Zc.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:kl(xc.prototype.surfaceMemberParser),surfaceMembers:kl(xc.prototype.surfaceMemberParser)}},Zc.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:kl(ic.prototype.readLineString),Curve:kl(xc.prototype.readCurve)}},Zc.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:kl(ic.prototype.readPolygon),Surface:kl(xc.prototype.readSurface)}},Zc.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:Nl(xc.prototype.readPatch)}},Zc.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:Nl(xc.prototype.readSegment)}},Zc.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:kl(xc.prototype.readFlatPosList),upperCorner:kl(xc.prototype.readFlatPosList)}},Zc.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:Nl(xc.prototype.readPolygonPatch)}},Zc.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:Nl(xc.prototype.readLineStringSegment)}},Zc.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:kl(ic.prototype.pointMemberParser),pointMembers:kl(ic.prototype.pointMemberParser)}},Zc.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:kl(ic.prototype.lineStringMemberParser),lineStringMembers:kl(ic.prototype.lineStringMemberParser)}},Zc.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:kl(ic.prototype.polygonMemberParser),polygonMembers:kl(ic.prototype.polygonMemberParser)}},Zc.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:kl(ic.prototype.readFlatCoordinatesFromNode)}},Zc.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:kl(ic.prototype.readLineString)}},Zc.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:kl(ic.prototype.readPolygon)}},Zc.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:Nl(ic.prototype.readFlatLinearRing)}},Zc.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:Gl(xc.prototype.writeRing),interior:Gl(xc.prototype.writeRing)}},Zc.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:Gl(wc),upperCorner:Gl(wc)}},Zc.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:Gl(xc.prototype.writeSurfaceOrPolygonMember),polygonMember:Gl(xc.prototype.writeSurfaceOrPolygonMember)}},Zc.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:Gl(xc.prototype.writePointMember)}},Zc.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:Gl(xc.prototype.writeLineStringOrCurveMember),curveMember:Gl(xc.prototype.writeLineStringOrCurveMember)}},Zc.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:Gl(xc.prototype.writeCurveOrLineString),MultiCurve:Gl(xc.prototype.writeMultiCurveOrLineString),Point:Gl(Zc.prototype.writePoint),MultiPoint:Gl(xc.prototype.writeMultiPoint),LineString:Gl(xc.prototype.writeCurveOrLineString),MultiLineString:Gl(xc.prototype.writeMultiCurveOrLineString),LinearRing:Gl(xc.prototype.writeLinearRing),Polygon:Gl(xc.prototype.writeSurfaceOrPolygon),MultiPolygon:Gl(xc.prototype.writeMultiSurfaceOrPolygon),Surface:Gl(xc.prototype.writeSurfaceOrPolygon),MultiSurface:Gl(xc.prototype.writeMultiSurfaceOrPolygon),Envelope:Gl(xc.prototype.writeEnvelope)}};const Dc=Zc;const kc=function(){function t(t){this.tagName_=t}return t.prototype.getTagName=function(){return this.tagName_},t}();var Nc=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const Fc=function(t){function e(e,n){var r=t.call(this,e)||this;return r.conditions=n,x(r.conditions.length>=2,57),r}return Nc(e,t),e}(kc);var Uc=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const Gc=function(t){function e(e){return t.call(this,"And",Array.prototype.slice.call(arguments))||this}return Uc(e,t),e}(Fc);var Bc=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const jc=function(t){function e(e,n,r){var o=t.call(this,"BBOX")||this;if(o.geometryName=e,o.extent=n,4!==n.length)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");return o.srsName=r,o}return Bc(e,t),e}(kc);var Wc=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),qc={"http://www.opengis.net/gml":{boundedBy:Ul(ic.prototype.readGeometryElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:kl(ic.prototype.readFeaturesInternal)}},Hc={"http://www.opengis.net/wfs":{totalInserted:Ul(mc),totalUpdated:Ul(mc),totalDeleted:Ul(mc)},"http://www.opengis.net/wfs/2.0":{totalInserted:Ul(mc),totalUpdated:Ul(mc),totalDeleted:Ul(mc)}},Vc={"http://www.opengis.net/wfs":{TransactionSummary:Ul(ou,"transactionSummary"),InsertResults:Ul(lu,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:Ul(ou,"transactionSummary"),InsertResults:Ul(lu,"insertIds")}},zc={"http://www.opengis.net/wfs":{PropertyName:Gl(wc)},"http://www.opengis.net/wfs/2.0":{PropertyName:Gl(wc)}},Yc={"http://www.opengis.net/wfs":{Insert:Gl(cu),Update:Gl(hu),Delete:Gl(du),Property:Gl(fu),Native:Gl(mu)},"http://www.opengis.net/wfs/2.0":{Insert:Gl(cu),Update:Gl(hu),Delete:Gl(du),Property:Gl(fu),Native:Gl(mu)}},Kc="feature",Xc="http://www.w3.org/2000/xmlns/",$c={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},Jc={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},Qc={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},tu={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},eu={"2.0.0":Dc,"1.1.0":xc,"1.0.0":Tc},nu=function(t){function e(e){var n=t.call(this)||this,r=e||{};return n.version_=r.version?r.version:"1.1.0",n.featureType_=r.featureType,n.featureNS_=r.featureNS,n.gmlFormat_=r.gmlFormat?r.gmlFormat:new eu[n.version_],n.schemaLocation_=r.schemaLocation?r.schemaLocation:tu[n.version_],n}return Wc(e,t),e.prototype.getFeatureType=function(){return this.featureType_},e.prototype.setFeatureType=function(t){this.featureType_=t},e.prototype.readFeaturesFromNode=function(t,e){var n={node:t};oe(n,{featureType:this.featureType_,featureNS:this.featureNS_}),oe(n,this.getReadOptions(t,e||{}));var r=[n],o=zl([],"2.0.0"===this.version_?qc:this.gmlFormat_.FEATURE_COLLECTION_PARSERS,t,r,this.gmlFormat_);return o||(o=[]),o},e.prototype.readTransactionResponse=function(t){if(t){if("string"==typeof t){var e=Zl(t);return this.readTransactionResponseFromDocument(e)}return Rl(t)?this.readTransactionResponseFromDocument(t):this.readTransactionResponseFromNode(t)}},e.prototype.readFeatureCollectionMetadata=function(t){if(t){if("string"==typeof t){var e=Zl(t);return this.readFeatureCollectionMetadataFromDocument(e)}return Rl(t)?this.readFeatureCollectionMetadataFromDocument(t):this.readFeatureCollectionMetadataFromNode(t)}},e.prototype.readFeatureCollectionMetadataFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(e)},e.prototype.readFeatureCollectionMetadataFromNode=function(t){var e={},n=gc(t.getAttribute("numberOfFeatures"));return e.numberOfFeatures=n,zl(e,qc,t,[],this.gmlFormat_)},e.prototype.readTransactionResponseFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(e)},e.prototype.readTransactionResponseFromNode=function(t){return zl({},Vc,t,[])},e.prototype.writeGetFeature=function(t){var e=this,n=xl(Jc[this.version_],"GetFeature");n.setAttribute("service","WFS"),n.setAttribute("version",this.version_),t.handle&&n.setAttribute("handle",t.handle),t.outputFormat&&n.setAttribute("outputFormat",t.outputFormat),void 0!==t.maxFeatures&&n.setAttribute("maxFeatures",String(t.maxFeatures)),t.resultType&&n.setAttribute("resultType",t.resultType),void 0!==t.startIndex&&n.setAttribute("startIndex",String(t.startIndex)),void 0!==t.count&&n.setAttribute("count",String(t.count)),void 0!==t.viewParams&&n.setAttribute("viewParams",t.viewParams),n.setAttributeNS(Ol,"xsi:schemaLocation",this.schemaLocation_);var r={node:n};if(oe(r,{version:this.version_,srsName:t.srsName,featureNS:t.featureNS?t.featureNS:this.featureNS_,featurePrefix:t.featurePrefix,propertyNames:t.propertyNames?t.propertyNames:[]}),x(Array.isArray(t.featureTypes),11),"string"==typeof t.featureTypes[0]){var o=t.filter;t.bbox&&(x(t.geometryName,12),o=this.combineBboxAndFilter(t.geometryName,t.bbox,t.srsName,o)),oe(r,{geometryName:t.geometryName,filter:o}),Ru(n,t.featureTypes,[r])}else t.featureTypes.forEach((function(o){var i=e.combineBboxAndFilter(o.geometryName,o.bbox,t.srsName,t.filter);oe(r,{geometryName:o.geometryName,filter:i}),Ru(n,[o.name],[r])}));return n},e.prototype.combineBboxAndFilter=function(t,e,n,r){var o=function(t,e,n){return new jc(t,e,n)}(t,e,n);return r?function(t){var e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(Gc,e))}(r,o):o},e.prototype.writeTransaction=function(t,e,n,r){var o,i=[],a=r.version?r.version:this.version_,s=xl(Jc[a],"Transaction");s.setAttribute("service","WFS"),s.setAttribute("version",a),r&&(o=r.gmlOptions?r.gmlOptions:{},r.handle&&s.setAttribute("handle",r.handle)),s.setAttributeNS(Ol,"xsi:schemaLocation",tu[a]);var l=function(t,e,n,r){var o,i=r.featurePrefix?r.featurePrefix:Kc;"1.0.0"===n?o=2:"1.1.0"===n?o=3:"2.0.0"===n&&(o=3.2);return oe({node:t},{version:n,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:i,gmlVersion:o,hasZ:r.hasZ,srsName:r.srsName},e)}(s,o,a,r);return t&&ru("Insert",t,i,l),e&&ru("Update",e,i,l),n&&ru("Delete",n,i,l),r.nativeElements&&ru("Native",r.nativeElements,i,l),s},e.prototype.readProjectionFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(e);return null},e.prototype.readProjectionFromNode=function(t){if(t.firstElementChild&&t.firstElementChild.firstElementChild)for(var e=(t=t.firstElementChild.firstElementChild).firstElementChild;e;e=e.nextElementSibling)if(0!==e.childNodes.length&&(1!==e.childNodes.length||3!==e.firstChild.nodeType)){var n=[{}];return this.gmlFormat_.readGeometryElement(e,n),io(n.pop().srsName)}return null},e}(tc);function ru(t,e,n,r){Kl(r,Yc,jl(t),e,n)}function ou(t,e){return zl({},Hc,t,e)}var iu={"http://www.opengis.net/ogc":{FeatureId:kl((function(t,e){return t.getAttribute("fid")}))},"http://www.opengis.net/ogc/1.1":{FeatureId:kl((function(t,e){return t.getAttribute("fid")}))}};function au(t,e){Vl(iu,t,e)}var su={"http://www.opengis.net/wfs":{Feature:au},"http://www.opengis.net/wfs/2.0":{Feature:au}};function lu(t,e){return zl([],su,t,e)}function cu(t,e,n){var r=n[n.length-1],o=r.featureType,i=r.featureNS,a=r.gmlVersion,s=xl(i,o);t.appendChild(s),2===a?Tc.prototype.writeFeatureElement(s,e,n):3===a?xc.prototype.writeFeatureElement(s,e,n):Dc.prototype.writeFeatureElement(s,e,n)}function uu(t,e,n){var r=n[n.length-1].version,o=$c[r],i=xl(o,"Filter"),a=xl(o,"FeatureId");i.appendChild(a),a.setAttribute("fid",e),t.appendChild(i)}function pu(t,e){var n=(t=t||Kc)+":";return 0===e.indexOf(n)?e:n+e}function du(t,e,n){var r=n[n.length-1];x(void 0!==e.getId(),26);var o=r.featureType,i=r.featurePrefix,a=r.featureNS,s=pu(i,o);t.setAttribute("typeName",s),t.setAttributeNS(Xc,"xmlns:"+i,a);var l=e.getId();void 0!==l&&uu(t,l,n)}function hu(t,e,n){var r=n[n.length-1];x(void 0!==e.getId(),27);var o=r.version,i=r.featureType,a=r.featurePrefix,s=r.featureNS,l=pu(a,i),c=e.getGeometryName();t.setAttribute("typeName",l),t.setAttributeNS(Xc,"xmlns:"+a,s);var u=e.getId();if(void 0!==u){for(var p=e.getKeys(),d=[],h=0,f=p.length;h<f;h++){var m=e.get(p[h]);if(void 0!==m){var g=p[h];m&&"function"==typeof m.getSimplifiedGeometry&&(g=c),d.push({name:g,value:m})}}Kl({version:o,gmlVersion:r.gmlVersion,node:t,hasZ:r.hasZ,srsName:r.srsName},Yc,jl("Property"),d,n),uu(t,u,n)}}function fu(t,e,n){var r=n[n.length-1],o=r.version,i=Jc[o],a=xl(i,"Name"),s=r.gmlVersion;if(t.appendChild(a),wc(a,e.name),void 0!==e.value&&null!==e.value){var l=xl(i,"Value");t.appendChild(l),e.value&&"function"==typeof e.value.getSimplifiedGeometry?2===s?Tc.prototype.writeGeometryElement(l,e.value,n):3===s?xc.prototype.writeGeometryElement(l,e.value,n):Dc.prototype.writeGeometryElement(l,e.value,n):wc(l,e.value)}}function mu(t,e,n){e.vendorId&&t.setAttribute("vendorId",e.vendorId),void 0!==e.safeToIgnore&&t.setAttribute("safeToIgnore",String(e.safeToIgnore)),void 0!==e.value&&wc(t,e.value)}var gu={"http://www.opengis.net/wfs":{Query:Gl(yu)},"http://www.opengis.net/wfs/2.0":{Query:Gl(yu)},"http://www.opengis.net/ogc":{During:Gl(wu),And:Gl(Su),Or:Gl(Su),Not:Gl(bu),BBOX:Gl(_u),Contains:Gl(Cu),Intersects:Gl(Cu),Within:Gl(Cu),DWithin:Gl(Eu),PropertyIsEqualTo:Gl(Lu),PropertyIsNotEqualTo:Gl(Lu),PropertyIsLessThan:Gl(Lu),PropertyIsLessThanOrEqualTo:Gl(Lu),PropertyIsGreaterThan:Gl(Lu),PropertyIsGreaterThanOrEqualTo:Gl(Lu),PropertyIsNull:Gl(Tu),PropertyIsBetween:Gl(Pu),PropertyIsLike:Gl(Au)},"http://www.opengis.net/fes/2.0":{During:Gl(wu),And:Gl(Su),Or:Gl(Su),Not:Gl(bu),BBOX:Gl(_u),Contains:Gl(Cu),Disjoint:Gl(Cu),Intersects:Gl(Cu),ResourceId:Gl((function(t,e,n){t.setAttribute("rid",e.rid)})),Within:Gl(Cu),DWithin:Gl(Eu),PropertyIsEqualTo:Gl(Lu),PropertyIsNotEqualTo:Gl(Lu),PropertyIsLessThan:Gl(Lu),PropertyIsLessThanOrEqualTo:Gl(Lu),PropertyIsGreaterThan:Gl(Lu),PropertyIsGreaterThanOrEqualTo:Gl(Lu),PropertyIsNull:Gl(Tu),PropertyIsBetween:Gl(Pu),PropertyIsLike:Gl(Au)}};function yu(t,e,n){var r,o,i=n[n.length-1],a=i.version,s=i.featurePrefix,l=i.featureNS,c=i.propertyNames,u=i.srsName;r=s?pu(s,e):e,o="2.0.0"===a?"typeNames":"typeName",t.setAttribute(o,r),u&&t.setAttribute("srsName",u),l&&t.setAttributeNS(Xc,"xmlns:"+s,l);var p=oe({},i);p.node=t,Kl(p,zc,jl("PropertyName"),c,n);var d=i.filter;if(d){var h=xl(Zu(a),"Filter");t.appendChild(h),vu(h,d,n)}}function vu(t,e,n){var r=n[n.length-1],o={node:t};oe(o,{context:r}),Kl(o,gu,jl(e.getTagName()),[e],n)}function _u(t,e,n){var r=n[n.length-1],o=r.context.version;r.srsName=e.srsName;var i=eu[o];Iu(o,t,e.geometryName),i.prototype.writeGeometryElement(t,e.extent,n)}function Cu(t,e,n){var r=n[n.length-1],o=r.context.version;r.srsName=e.srsName;var i=eu[o];Iu(o,t,e.geometryName),i.prototype.writeGeometryElement(t,e.geometry,n)}function Eu(t,e,n){var r=n[n.length-1].context.version;Cu(t,e,n);var o=xl(Zu(r),"Distance");wc(o,e.distance.toString()),"2.0.0"===r?o.setAttribute("uom",e.unit):o.setAttribute("units",e.unit),t.appendChild(o)}function wu(t,e,n){var r=n[n.length-1].context.version;Ou(Qc[r],"ValueReference",t,e.propertyName);var o=xl(nc,"TimePeriod");t.appendChild(o);var i=xl(nc,"begin");o.appendChild(i),Mu(i,e.begin);var a=xl(nc,"end");o.appendChild(a),Mu(a,e.end)}function Su(t,e,n){var r=n[n.length-1].context,o={node:t};oe(o,{context:r});for(var i=e.conditions,a=0,s=i.length;a<s;++a){var l=i[a];Kl(o,gu,jl(l.getTagName()),[l],n)}}function bu(t,e,n){var r=n[n.length-1].context,o={node:t};oe(o,{context:r});var i=e.condition;Kl(o,gu,jl(i.getTagName()),[i],n)}function Lu(t,e,n){var r=n[n.length-1].context.version;void 0!==e.matchCase&&t.setAttribute("matchCase",e.matchCase.toString()),Iu(r,t,e.propertyName),xu(r,t,""+e.expression)}function Tu(t,e,n){Iu(n[n.length-1].context.version,t,e.propertyName)}function Pu(t,e,n){var r=n[n.length-1].context.version,o=Zu(r);Iu(r,t,e.propertyName);var i=xl(o,"LowerBoundary");t.appendChild(i),xu(r,i,""+e.lowerBoundary);var a=xl(o,"UpperBoundary");t.appendChild(a),xu(r,a,""+e.upperBoundary)}function Au(t,e,n){var r=n[n.length-1].context.version;t.setAttribute("wildCard",e.wildCard),t.setAttribute("singleChar",e.singleChar),t.setAttribute("escapeChar",e.escapeChar),void 0!==e.matchCase&&t.setAttribute("matchCase",e.matchCase.toString()),Iu(r,t,e.propertyName),xu(r,t,""+e.pattern)}function Ou(t,e,n,r){var o=xl(t,e);wc(o,r),n.appendChild(o)}function xu(t,e,n){Ou(Zu(t),"Literal",e,n)}function Iu(t,e,n){"2.0.0"===t?Ou(Qc[t],"ValueReference",e,n):Ou($c[t],"PropertyName",e,n)}function Mu(t,e){var n=xl(nc,"TimeInstant");t.appendChild(n);var r=xl(nc,"timePosition");n.appendChild(r),wc(r,e)}function Ru(t,e,n){var r=n[n.length-1],o=oe({},r);o.node=t,Kl(o,gu,jl("Query"),e,n)}function Zu(t){return"2.0.0"===t?Qc[t]:$c[t]}const Du=nu;var ku=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function Nu(t){return"string"==typeof t?t:""}const Fu=function(t){function e(){return t.call(this)||this}return ku(e,t),e.prototype.getType=function(){return wl},e.prototype.readFeature=function(t,e){return this.readFeatureFromText(Nu(t),this.adaptOptions(e))},e.prototype.readFeatureFromText=function(t,e){return r()},e.prototype.readFeatures=function(t,e){return this.readFeaturesFromText(Nu(t),this.adaptOptions(e))},e.prototype.readFeaturesFromText=function(t,e){return r()},e.prototype.readGeometry=function(t,e){return this.readGeometryFromText(Nu(t),this.adaptOptions(e))},e.prototype.readGeometryFromText=function(t,e){return r()},e.prototype.readProjection=function(t){return this.readProjectionFromText(Nu(t))},e.prototype.readProjectionFromText=function(t){return this.dataProjection},e.prototype.writeFeature=function(t,e){return this.writeFeatureText(t,this.adaptOptions(e))},e.prototype.writeFeatureText=function(t,e){return r()},e.prototype.writeFeatures=function(t,e){return this.writeFeaturesText(t,this.adaptOptions(e))},e.prototype.writeFeaturesText=function(t,e){return r()},e.prototype.writeGeometry=function(t,e){return this.writeGeometryText(t,this.adaptOptions(e))},e.prototype.writeGeometryText=function(t,e){return r()},e}(Tl);var Uu=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Gu={POINT:_i,LINESTRING:al,POLYGON:Zi,MULTIPOINT:Qs,MULTILINESTRING:cl,MULTIPOLYGON:dl},Bu="EMPTY",ju=0,Wu=1,qu=2,Hu=3,Vu=4,zu=5,Yu=6,Ku={};for(var Xu in br)Ku[Xu]=br[Xu].toUpperCase();var $u=function(){function t(t){this.wkt=t,this.index_=-1}return t.prototype.isAlpha_=function(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"},t.prototype.isNumeric_=function(t,e){return t>="0"&&t<="9"||"."==t&&!(void 0!==e&&e)},t.prototype.isWhiteSpace_=function(t){return" "==t||"\t"==t||"\r"==t||"\n"==t},t.prototype.nextChar_=function(){return this.wkt.charAt(++this.index_)},t.prototype.nextToken=function(){var t,e=this.nextChar_(),n=this.index_,r=e;if("("==e)t=qu;else if(","==e)t=zu;else if(")"==e)t=Hu;else if(this.isNumeric_(e)||"-"==e)t=Vu,r=this.readNumber_();else if(this.isAlpha_(e))t=Wu,r=this.readText_();else{if(this.isWhiteSpace_(e))return this.nextToken();if(""!==e)throw new Error("Unexpected character: "+e);t=Yu}return{position:n,value:r,type:t}},t.prototype.readNumber_=function(){var t,e=this.index_,n=!1,r=!1;do{"."==t?n=!0:"e"!=t&&"E"!=t||(r=!0),t=this.nextChar_()}while(this.isNumeric_(t,n)||!r&&("e"==t||"E"==t)||r&&("-"==t||"+"==t));return parseFloat(this.wkt.substring(e,this.index_--))},t.prototype.readText_=function(){var t,e=this.index_;do{t=this.nextChar_()}while(this.isAlpha_(t));return this.wkt.substring(e,this.index_--).toUpperCase()},t}(),Ju=function(){function t(t){this.lexer_=t,this.token_={position:0,type:ju},this.layout_=Fo.XY}return t.prototype.consume_=function(){this.token_=this.lexer_.nextToken()},t.prototype.isTokenType=function(t){return this.token_.type==t},t.prototype.match=function(t){var e=this.isTokenType(t);return e&&this.consume_(),e},t.prototype.parse=function(){return this.consume_(),this.parseGeometry_()},t.prototype.parseGeometryLayout_=function(){var t=Fo.XY,e=this.token_;if(this.isTokenType(Wu)){var n=e.value;"Z"===n?t=Fo.XYZ:"M"===n?t=Fo.XYM:"ZM"===n&&(t=Fo.XYZM),t!==Fo.XY&&this.consume_()}return t},t.prototype.parseGeometryCollectionText_=function(){if(this.match(qu)){var t=[];do{t.push(this.parseGeometry_())}while(this.match(zu));if(this.match(Hu))return t}throw new Error(this.formatErrorMessage_())},t.prototype.parsePointText_=function(){if(this.match(qu)){var t=this.parsePoint_();if(this.match(Hu))return t}throw new Error(this.formatErrorMessage_())},t.prototype.parseLineStringText_=function(){if(this.match(qu)){var t=this.parsePointList_();if(this.match(Hu))return t}throw new Error(this.formatErrorMessage_())},t.prototype.parsePolygonText_=function(){if(this.match(qu)){var t=this.parseLineStringTextList_();if(this.match(Hu))return t}throw new Error(this.formatErrorMessage_())},t.prototype.parseMultiPointText_=function(){if(this.match(qu)){var t=void 0;if(t=this.token_.type==qu?this.parsePointTextList_():this.parsePointList_(),this.match(Hu))return t}throw new Error(this.formatErrorMessage_())},t.prototype.parseMultiLineStringText_=function(){if(this.match(qu)){var t=this.parseLineStringTextList_();if(this.match(Hu))return t}throw new Error(this.formatErrorMessage_())},t.prototype.parseMultiPolygonText_=function(){if(this.match(qu)){var t=this.parsePolygonTextList_();if(this.match(Hu))return t}throw new Error(this.formatErrorMessage_())},t.prototype.parsePoint_=function(){for(var t=[],e=this.layout_.length,n=0;n<e;++n){var r=this.token_;if(!this.match(Vu))break;t.push(r.value)}if(t.length==e)return t;throw new Error(this.formatErrorMessage_())},t.prototype.parsePointList_=function(){for(var t=[this.parsePoint_()];this.match(zu);)t.push(this.parsePoint_());return t},t.prototype.parsePointTextList_=function(){for(var t=[this.parsePointText_()];this.match(zu);)t.push(this.parsePointText_());return t},t.prototype.parseLineStringTextList_=function(){for(var t=[this.parseLineStringText_()];this.match(zu);)t.push(this.parseLineStringText_());return t},t.prototype.parsePolygonTextList_=function(){for(var t=[this.parsePolygonText_()];this.match(zu);)t.push(this.parsePolygonText_());return t},t.prototype.isEmptyGeometry_=function(){var t=this.isTokenType(Wu)&&this.token_.value==Bu;return t&&this.consume_(),t},t.prototype.formatErrorMessage_=function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"},t.prototype.parseGeometry_=function(){var t=this.token_;if(this.match(Wu)){var e=t.value;this.layout_=this.parseGeometryLayout_();var n=this.isEmptyGeometry_();if("GEOMETRYCOLLECTION"==e){if(n)return new _l([]);var r=this.parseGeometryCollectionText_();return new _l(r)}var o=Gu[e];if(!o)throw new Error("Invalid geometry type: "+e);var i=void 0;if(n)i="POINT"==e?[NaN,NaN]:[];else switch(e){case"POINT":i=this.parsePointText_();break;case"LINESTRING":i=this.parseLineStringText_();break;case"POLYGON":i=this.parsePolygonText_();break;case"MULTIPOINT":i=this.parseMultiPointText_();break;case"MULTILINESTRING":i=this.parseMultiLineStringText_();break;case"MULTIPOLYGON":i=this.parseMultiPolygonText_()}return new o(i,this.layout_)}throw new Error(this.formatErrorMessage_())},t}(),Qu=function(t){function e(e){var n=t.call(this)||this,r=e||{};return n.splitCollection_=void 0!==r.splitCollection&&r.splitCollection,n}return Uu(e,t),e.prototype.parse_=function(t){var e=new $u(t);return new Ju(e).parse()},e.prototype.readFeatureFromText=function(t,e){var n=this.readGeometryFromText(t,e),r=new Xs;return r.setGeometry(n),r},e.prototype.readFeaturesFromText=function(t,e){for(var n=[],r=this.readGeometryFromText(t,e),o=[],i=0,a=(n=this.splitCollection_&&r.getType()==br.GEOMETRY_COLLECTION?r.getGeometriesArray():[r]).length;i<a;++i){var s=new Xs;s.setGeometry(n[i]),o.push(s)}return o},e.prototype.readGeometryFromText=function(t,e){return Pl(this.parse_(t),!1,e)},e.prototype.writeFeatureText=function(t,e){var n=t.getGeometry();return n?this.writeGeometryText(n,e):""},e.prototype.writeFeaturesText=function(t,e){if(1==t.length)return this.writeFeatureText(t[0],e);for(var n=[],r=0,o=t.length;r<o;++r)n.push(t[r].getGeometry());var i=new _l(n);return this.writeGeometryText(i,e)},e.prototype.writeGeometryText=function(t,e){return op(Pl(t,!0,e))},e}(Fu);function tp(t){var e=t.getCoordinates();return 0===e.length?"":e.join(" ")}function ep(t){for(var e=t.getCoordinates(),n=[],r=0,o=e.length;r<o;++r)n.push(e[r].join(" "));return n.join(",")}function np(t){for(var e=[],n=t.getLinearRings(),r=0,o=n.length;r<o;++r)e.push("("+ep(n[r])+")");return e.join(",")}var rp={Point:tp,LineString:ep,Polygon:np,MultiPoint:function(t){for(var e=[],n=t.getPoints(),r=0,o=n.length;r<o;++r)e.push("("+tp(n[r])+")");return e.join(",")},MultiLineString:function(t){for(var e=[],n=t.getLineStrings(),r=0,o=n.length;r<o;++r)e.push("("+ep(n[r])+")");return e.join(",")},MultiPolygon:function(t){for(var e=[],n=t.getPolygons(),r=0,o=n.length;r<o;++r)e.push("("+np(n[r])+")");return e.join(",")},GeometryCollection:function(t){for(var e=[],n=t.getGeometries(),r=0,o=n.length;r<o;++r)e.push(op(n[r]));return e.join(",")}};function op(t){var e=t.getType(),n=(0,rp[e])(t);if(e=e.toUpperCase(),"function"==typeof t.getFlatCoordinates){var r=function(t){var e=t.getLayout(),n="";return e!==Fo.XYZ&&e!==Fo.XYZM||(n+="Z"),e!==Fo.XYM&&e!==Fo.XYZM||(n+="M"),n}(t);r.length>0&&(e+=" "+r)}return 0===n.length?e+" "+Bu:e+"("+n+")"}const ip=Qu;const ap=function(){function t(){}return t.prototype.read=function(t){if(t){if("string"==typeof t){var e=Zl(t);return this.readFromDocument(e)}return Rl(t)?this.readFromDocument(t):this.readFromNode(t)}return null},t.prototype.readFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null},t.prototype.readFromNode=function(t){},t}();function sp(t){return t.getAttributeNS("http://www.w3.org/1999/xlink","href")}var lp=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),cp=[null,"http://www.opengis.net/wms"],up=Hl(cp,{Service:Ul((function(t,e){return zl({},hp,t,e)})),Capability:Ul((function(t,e){return zl({},pp,t,e)}))}),pp=Hl(cp,{Request:Ul((function(t,e){return zl({},Ep,t,e)})),Exception:Ul((function(t,e){return zl([],yp,t,e)})),Layer:Ul((function(t,e){var n=zl({},vp,t,e);if(void 0===n.Layer)return Object.assign(n,Ap(t,e));return n}))}),dp=function(t){function e(){var e=t.call(this)||this;return e.version=void 0,e}return lp(e,t),e.prototype.readFromNode=function(t){this.version=t.getAttribute("version").trim();var e=zl({version:this.version},up,t,[]);return e||null},e}(ap),hp=Hl(cp,{Name:Ul(yc),Title:Ul(yc),Abstract:Ul(yc),KeywordList:Ul(Mp),OnlineResource:Ul(sp),ContactInformation:Ul((function(t,e){return zl({},fp,t,e)})),Fees:Ul(yc),AccessConstraints:Ul(yc),LayerLimit:Ul(mc),MaxWidth:Ul(mc),MaxHeight:Ul(mc)}),fp=Hl(cp,{ContactPersonPrimary:Ul((function(t,e){return zl({},mp,t,e)})),ContactPosition:Ul(yc),ContactAddress:Ul((function(t,e){return zl({},gp,t,e)})),ContactVoiceTelephone:Ul(yc),ContactFacsimileTelephone:Ul(yc),ContactElectronicMailAddress:Ul(yc)}),mp=Hl(cp,{ContactPerson:Ul(yc),ContactOrganization:Ul(yc)}),gp=Hl(cp,{AddressType:Ul(yc),Address:Ul(yc),City:Ul(yc),StateOrProvince:Ul(yc),PostCode:Ul(yc),Country:Ul(yc)}),yp=Hl(cp,{Format:kl(yc)}),vp=Hl(cp,{Name:Ul(yc),Title:Ul(yc),Abstract:Ul(yc),KeywordList:Ul(Mp),CRS:Fl(yc),EX_GeographicBoundingBox:Ul((function(t,e){var n=zl({},Cp,t,e);if(!n)return;var r=n.westBoundLongitude,o=n.southBoundLatitude,i=n.eastBoundLongitude,a=n.northBoundLatitude;if(void 0===r||void 0===o||void 0===i||void 0===a)return;return[r,o,i,a]})),BoundingBox:Fl((function(t,e){var n=[fc(t.getAttribute("minx")),fc(t.getAttribute("miny")),fc(t.getAttribute("maxx")),fc(t.getAttribute("maxy"))],r=[fc(t.getAttribute("resx")),fc(t.getAttribute("resy"))];return{crs:t.getAttribute("CRS"),extent:n,res:r}})),Dimension:Fl((function(t,e){return{name:t.getAttribute("name"),units:t.getAttribute("units"),unitSymbol:t.getAttribute("unitSymbol"),default:t.getAttribute("default"),multipleValues:pc(t.getAttribute("multipleValues")),nearestValue:pc(t.getAttribute("nearestValue")),current:pc(t.getAttribute("current")),values:yc(t)}})),Attribution:Ul((function(t,e){return zl({},_p,t,e)})),AuthorityURL:Fl((function(t,e){var n=Op(t,e);if(n)return n.name=t.getAttribute("name"),n;return})),Identifier:Fl(yc),MetadataURL:Fl((function(t,e){var n=Op(t,e);if(n)return n.type=t.getAttribute("type"),n;return})),DataURL:Fl(Op),FeatureListURL:Fl(Op),Style:Fl((function(t,e){return zl({},Lp,t,e)})),MinScaleDenominator:Ul(hc),MaxScaleDenominator:Ul(hc),Layer:Fl(Ap)}),_p=Hl(cp,{Title:Ul(yc),OnlineResource:Ul(sp),LogoURL:Ul(Ip)}),Cp=Hl(cp,{westBoundLongitude:Ul(hc),eastBoundLongitude:Ul(hc),southBoundLatitude:Ul(hc),northBoundLatitude:Ul(hc)}),Ep=Hl(cp,{GetCapabilities:Ul(xp),GetMap:Ul(xp),GetFeatureInfo:Ul(xp)}),wp=Hl(cp,{Format:Fl(yc),DCPType:Fl((function(t,e){return zl({},Sp,t,e)}))}),Sp=Hl(cp,{HTTP:Ul((function(t,e){return zl({},bp,t,e)}))}),bp=Hl(cp,{Get:Ul(Op),Post:Ul(Op)}),Lp=Hl(cp,{Name:Ul(yc),Title:Ul(yc),Abstract:Ul(yc),LegendURL:Fl(Ip),StyleSheetURL:Ul(Op),StyleURL:Ul(Op)}),Tp=Hl(cp,{Format:Ul(yc),OnlineResource:Ul(sp)}),Pp=Hl(cp,{Keyword:kl(yc)});function Ap(t,e){var n=e[e.length-1],r=zl({},vp,t,e);if(r){var o=pc(t.getAttribute("queryable"));void 0===o&&(o=n.queryable),r.queryable=void 0!==o&&o;var i=gc(t.getAttribute("cascaded"));void 0===i&&(i=n.cascaded),r.cascaded=i;var a=pc(t.getAttribute("opaque"));void 0===a&&(a=n.opaque),r.opaque=void 0!==a&&a;var s=pc(t.getAttribute("noSubsets"));void 0===s&&(s=n.noSubsets),r.noSubsets=void 0!==s&&s;var l=fc(t.getAttribute("fixedWidth"));l||(l=n.fixedWidth),r.fixedWidth=l;var c=fc(t.getAttribute("fixedHeight"));c||(c=n.fixedHeight),r.fixedHeight=c;["Style","CRS","AuthorityURL"].forEach((function(t){if(t in n){var e=r[t]||[];r[t]=e.concat(n[t])}}));return["EX_GeographicBoundingBox","BoundingBox","Dimension","Attribution","MinScaleDenominator","MaxScaleDenominator"].forEach((function(t){if(!(t in r)){var e=n[t];r[t]=e}})),r}}function Op(t,e){return zl({},Tp,t,e)}function xp(t,e){return zl({},wp,t,e)}function Ip(t,e){var n=Op(t,e);if(n){var r=[gc(t.getAttribute("width")),gc(t.getAttribute("height"))];return n.size=r,n}}function Mp(t,e){return zl([],Pp,t,e)}const Rp=dp;var Zp=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const Dp=function(t){function e(e){var n=t.call(this)||this,r=e||{};return n.featureNS_="http://mapserver.gis.umn.edu/mapserver",n.gmlFormat_=new Tc,n.layers_=r.layers?r.layers:null,n}return Zp(e,t),e.prototype.getLayers=function(){return this.layers_},e.prototype.setLayers=function(t){this.layers_=t},e.prototype.readFeatures_=function(t,e){t.setAttribute("namespaceURI",this.featureNS_);var n=t.localName,r=[];if(0===t.childNodes.length)return r;if("msGMLOutput"==n)for(var o=0,i=t.childNodes.length;o<i;o++){var a=t.childNodes[o];if(a.nodeType===Node.ELEMENT_NODE){var s=a,l=e[0],u=s.localName.replace("_layer","");if(!this.layers_||c(this.layers_,u)){var p=u+"_feature";l.featureType=p,l.featureNS=this.featureNS_;var h={};h[p]=kl(this.gmlFormat_.readFeatureElement,this.gmlFormat_);var f=Hl([l.featureNS,null],h);s.setAttribute("namespaceURI",this.featureNS_);var m=zl([],f,s,e,this.gmlFormat_);m&&d(r,m)}}}if("FeatureCollection"==n){var g=zl([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,t,[{}],this.gmlFormat_);g&&(r=g)}return r},e.prototype.readFeaturesFromNode=function(t,e){var n={};return e&&oe(n,this.getReadOptions(t,e)),this.readFeatures_(t,[n])},e}(tc);var kp=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Np=[null,"http://www.opengis.net/ows/1.1"],Fp=Hl(Np,{ServiceIdentification:Ul((function(t,e){return zl({},$p,t,e)})),ServiceProvider:Ul((function(t,e){return zl({},Jp,t,e)})),OperationsMetadata:Ul((function(t,e){return zl({},zp,t,e)}))}),Up=function(t){function e(){return t.call(this)||this}return kp(e,t),e.prototype.readFromNode=function(t){var e=zl({},Fp,t,[]);return e||null},e}(ap),Gp=Hl(Np,{DeliveryPoint:Ul(yc),City:Ul(yc),AdministrativeArea:Ul(yc),PostalCode:Ul(yc),Country:Ul(yc),ElectronicMailAddress:Ul(yc)}),Bp=Hl(Np,{Value:Fl((function(t,e){return yc(t)}))}),jp=Hl(Np,{AllowedValues:Ul((function(t,e){return zl({},Bp,t,e)}))}),Wp=Hl(Np,{Phone:Ul((function(t,e){return zl({},Yp,t,e)})),Address:Ul((function(t,e){return zl({},Gp,t,e)}))}),qp=Hl(Np,{HTTP:Ul((function(t,e){return zl({},Hp,t,e)}))}),Hp=Hl(Np,{Get:Fl((function(t,e){var n=sp(t);if(!n)return;return zl({href:n},Kp,t,e)})),Post:void 0}),Vp=Hl(Np,{DCP:Ul((function(t,e){return zl({},qp,t,e)}))}),zp=Hl(Np,{Operation:function(t,e){var n=t.getAttribute("name"),r=zl({},Vp,t,e);if(!r)return;e[e.length-1][n]=r}}),Yp=Hl(Np,{Voice:Ul(yc),Facsimile:Ul(yc)}),Kp=Hl(Np,{Constraint:Fl((function(t,e){var n=t.getAttribute("name");if(!n)return;return zl({name:n},jp,t,e)}))}),Xp=Hl(Np,{IndividualName:Ul(yc),PositionName:Ul(yc),ContactInfo:Ul((function(t,e){return zl({},Wp,t,e)}))}),$p=Hl(Np,{Abstract:Ul(yc),AccessConstraints:Ul(yc),Fees:Ul(yc),Title:Ul(yc),ServiceTypeVersion:Ul(yc),ServiceType:Ul(yc)}),Jp=Hl(Np,{ProviderName:Ul(yc),ProviderSite:Ul(sp),ServiceContact:Ul((function(t,e){return zl({},Xp,t,e)}))});const Qp=Up;var td=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ed=[null,"http://www.opengis.net/wmts/1.0"],nd=[null,"http://www.opengis.net/ows/1.1"],rd=Hl(ed,{Contents:Ul((function(t,e){return zl({},id,t,e)}))}),od=function(t){function e(){var e=t.call(this)||this;return e.owsParser_=new Qp,e}return td(e,t),e.prototype.readFromNode=function(t){var e=t.getAttribute("version");e&&(e=e.trim());var n=this.owsParser_.readFromNode(t);return n?(n.version=e,(n=zl(n,rd,t,[]))||null):null},e}(ap),id=Hl(ed,{Layer:Fl((function(t,e){return zl({},ad,t,e)})),TileMatrixSet:Fl((function(t,e){return zl({},hd,t,e)}))}),ad=Hl(ed,{Style:Fl((function(t,e){var n=zl({},sd,t,e);if(!n)return;var r="true"===t.getAttribute("isDefault");return n.isDefault=r,n})),Format:Fl(yc),TileMatrixSetLink:Fl((function(t,e){return zl({},ld,t,e)})),Dimension:Fl((function(t,e){return zl({},pd,t,e)})),ResourceURL:Fl((function(t,e){var n=t.getAttribute("format"),r=t.getAttribute("template"),o=t.getAttribute("resourceType"),i={};n&&(i.format=n);r&&(i.template=r);o&&(i.resourceType=o);return i}))},Hl(nd,{Title:Ul(yc),Abstract:Ul(yc),WGS84BoundingBox:Ul(md),Identifier:Ul(yc)})),sd=Hl(ed,{LegendURL:Fl((function(t,e){var n={};return n.format=t.getAttribute("format"),n.href=sp(t),n}))},Hl(nd,{Title:Ul(yc),Identifier:Ul(yc)})),ld=Hl(ed,{TileMatrixSet:Ul(yc),TileMatrixSetLimits:Ul((function(t,e){return zl([],cd,t,e)}))}),cd=Hl(ed,{TileMatrixLimits:kl((function(t,e){return zl({},ud,t,e)}))}),ud=Hl(ed,{TileMatrix:Ul(yc),MinTileRow:Ul(mc),MaxTileRow:Ul(mc),MinTileCol:Ul(mc),MaxTileCol:Ul(mc)}),pd=Hl(ed,{Default:Ul(yc),Value:Fl(yc)},Hl(nd,{Identifier:Ul(yc)})),dd=Hl(nd,{LowerCorner:kl(gd),UpperCorner:kl(gd)}),hd=Hl(ed,{WellKnownScaleSet:Ul(yc),TileMatrix:Fl((function(t,e){return zl({},fd,t,e)}))},Hl(nd,{SupportedCRS:Ul(yc),Identifier:Ul(yc),BoundingBox:Ul(md)})),fd=Hl(ed,{TopLeftCorner:Ul(gd),ScaleDenominator:Ul(hc),TileWidth:Ul(mc),TileHeight:Ul(mc),MatrixWidth:Ul(mc),MatrixHeight:Ul(mc)},Hl(nd,{Identifier:Ul(yc)}));function md(t,e){var n=zl([],dd,t,e);if(2==n.length)return $(n)}function gd(t,e){var n=yc(t).split(/\s+/);if(n&&2==n.length){var r=+n[0],o=+n[1];if(!isNaN(r)&&!isNaN(o))return[r,o]}}const yd=od;var vd=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function _d(t){if("string"==typeof t){var e=JSON.parse(t);return e||null}return null!==t?t:null}const Cd=function(t){function e(){return t.call(this)||this}return vd(e,t),e.prototype.getType=function(){return El},e.prototype.readFeature=function(t,e){return this.readFeatureFromObject(_d(t),this.getReadOptions(t,e))},e.prototype.readFeatures=function(t,e){return this.readFeaturesFromObject(_d(t),this.getReadOptions(t,e))},e.prototype.readFeatureFromObject=function(t,e){return r()},e.prototype.readFeaturesFromObject=function(t,e){return r()},e.prototype.readGeometry=function(t,e){return this.readGeometryFromObject(_d(t),this.getReadOptions(t,e))},e.prototype.readGeometryFromObject=function(t,e){return r()},e.prototype.readProjection=function(t){return this.readProjectionFromObject(_d(t))},e.prototype.readProjectionFromObject=function(t){return r()},e.prototype.writeFeature=function(t,e){return JSON.stringify(this.writeFeatureObject(t,e))},e.prototype.writeFeatureObject=function(t,e){return r()},e.prototype.writeFeatures=function(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))},e.prototype.writeFeaturesObject=function(t,e){return r()},e.prototype.writeGeometry=function(t,e){return JSON.stringify(this.writeGeometryObject(t,e))},e.prototype.writeGeometryObject=function(t,e){return r()},e}(Tl);var Ed=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),wd=function(t){function e(e){var n=t.call(this)||this,r=e||{};return n.layerName_=r.layerName,n.layers_=r.layers?r.layers:null,n.dataProjection=io(r.dataProjection?r.dataProjection:"EPSG:4326"),n}return Ed(e,t),e.prototype.readFeaturesFromObject=function(t,e){if("Topology"==t.type){var n=t,r=void 0,o=null,i=null;n.transform&&(o=(r=n.transform).scale,i=r.translate);var a=n.arcs;r&&function(t,e,n){for(var r=0,o=t.length;r<o;++r)Pd(t[r],e,n)}(a,o,i);var s=[],l=n.objects,c=this.layerName_,u=void 0;for(var p in l)this.layers_&&-1==this.layers_.indexOf(p)||("GeometryCollection"===l[p].type?(u=l[p],s.push.apply(s,Ld(u,a,o,i,c,p,e))):(u=l[p],s.push(Td(u,a,o,i,c,p,e))));return s}return[]},e.prototype.readProjectionFromObject=function(t){return this.dataProjection},e}(Cd),Sd={Point:function(t,e,n){var r=t.coordinates;e&&n&&Ad(r,e,n);return new _i(r)},LineString:function(t,e){var n=bd(t.arcs,e);return new al(n)},Polygon:function(t,e){for(var n=[],r=0,o=t.arcs.length;r<o;++r)n[r]=bd(t.arcs[r],e);return new Zi(n)},MultiPoint:function(t,e,n){var r=t.coordinates;if(e&&n)for(var o=0,i=r.length;o<i;++o)Ad(r[o],e,n);return new Qs(r)},MultiLineString:function(t,e){for(var n=[],r=0,o=t.arcs.length;r<o;++r)n[r]=bd(t.arcs[r],e);return new cl(n)},MultiPolygon:function(t,e){for(var n=[],r=0,o=t.arcs.length;r<o;++r){for(var i=t.arcs[r],a=[],s=0,l=i.length;s<l;++s)a[s]=bd(i[s],e);n[r]=a}return new dl(n)}};function bd(t,e){for(var n,r=[],o=0,i=t.length;o<i;++o)if(n=t[o],o>0&&r.pop(),n>=0)for(var a=0,s=(l=e[n]).length;a<s;++a)r.push(l[a].slice(0));else{var l;for(a=(l=e[~n]).length-1;a>=0;--a)r.push(l[a].slice(0))}return r}function Ld(t,e,n,r,o,i,a){for(var s=t.geometries,l=[],c=0,u=s.length;c<u;++c)l[c]=Td(s[c],e,n,r,o,i,a);return l}function Td(t,e,n,r,o,i,a){var s=null,l=t.type;if(l){var c=Sd[l];s=Pl(s="Point"===l||"MultiPoint"===l?c(t,n,r):c(t,e),!1,a)}var u=new Xs({geometry:s});void 0!==t.id&&u.setId(t.id);var p=t.properties;return o&&(p||(p={}),p[o]=i),p&&u.setProperties(p,!0),u}function Pd(t,e,n){for(var r=0,o=0,i=0,a=t.length;i<a;++i){var s=t[i];r+=s[0],o+=s[1],s[0]=r,s[1]=o,Ad(s,e,n)}}function Ad(t,e,n){t[0]=t[0]*e[0]+n[0],t[1]=t[1]*e[1]+n[1]}const Od=wd;var xd=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function Id(t,e){if(!t)return null;var n;switch(t.type){case br.POINT:n=function(t){return new _i(t.coordinates)}(t);break;case br.LINE_STRING:n=function(t){return new al(t.coordinates)}(t);break;case br.POLYGON:n=function(t){return new Zi(t.coordinates)}(t);break;case br.MULTI_POINT:n=function(t){return new Qs(t.coordinates)}(t);break;case br.MULTI_LINE_STRING:n=function(t){return new cl(t.coordinates)}(t);break;case br.MULTI_POLYGON:n=function(t){return new dl(t.coordinates)}(t);break;case br.GEOMETRY_COLLECTION:n=function(t,e){var n=t.geometries.map((function(t){return Id(t,e)}));return new _l(n)}(t);break;default:throw new Error("Unsupported GeoJSON type: "+t.type)}return Pl(n,!1,e)}function Md(t,e){var n,r=(t=Pl(t,!0,e)).getType();switch(r){case br.POINT:n=function(t,e){return{type:"Point",coordinates:t.getCoordinates()}}(t);break;case br.LINE_STRING:n=function(t,e){return{type:"LineString",coordinates:t.getCoordinates()}}(t);break;case br.POLYGON:n=function(t,e){var n;e&&(n=e.rightHanded);return{type:"Polygon",coordinates:t.getCoordinates(n)}}(t,e);break;case br.MULTI_POINT:n=function(t,e){return{type:"MultiPoint",coordinates:t.getCoordinates()}}(t);break;case br.MULTI_LINE_STRING:n=function(t,e){return{type:"MultiLineString",coordinates:t.getCoordinates()}}(t);break;case br.MULTI_POLYGON:n=function(t,e){var n;e&&(n=e.rightHanded);return{type:"MultiPolygon",coordinates:t.getCoordinates(n)}}(t,e);break;case br.GEOMETRY_COLLECTION:n=function(t,e){return{type:"GeometryCollection",geometries:t.getGeometriesArray().map((function(t){var n=oe({},e);return delete n.featureProjection,Md(t,n)}))}}(t,e);break;case br.CIRCLE:n={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+r)}return n}const Rd=function(t){function e(e){var n=this,r=e||{};return(n=t.call(this)||this).dataProjection=io(r.dataProjection?r.dataProjection:"EPSG:4326"),r.featureProjection&&(n.defaultFeatureProjection=io(r.featureProjection)),n.geometryName_=r.geometryName,n.extractGeometryName_=r.extractGeometryName,n.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"],n}return xd(e,t),e.prototype.readFeatureFromObject=function(t,e){var n=null,r=Id((n="Feature"===t.type?t:{type:"Feature",geometry:t,properties:null}).geometry,e),o=new Xs;return this.geometryName_?o.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in n!==void 0&&o.setGeometryName(n.geometry_name),o.setGeometry(r),"id"in n&&o.setId(n.id),n.properties&&o.setProperties(n.properties,!0),o},e.prototype.readFeaturesFromObject=function(t,e){var n=null;if("FeatureCollection"===t.type){n=[];for(var r=t.features,o=0,i=r.length;o<i;++o)n.push(this.readFeatureFromObject(r[o],e))}else n=[this.readFeatureFromObject(t,e)];return n},e.prototype.readGeometryFromObject=function(t,e){return Id(t,e)},e.prototype.readProjectionFromObject=function(t){var e,n=t.crs;return n?"name"==n.type?e=io(n.properties.name):"EPSG"===n.type?e=io("EPSG:"+n.properties.code):x(!1,36):e=this.dataProjection,e},e.prototype.writeFeatureObject=function(t,e){e=this.adaptOptions(e);var n={type:"Feature",geometry:null,properties:null},r=t.getId();if(void 0!==r&&(n.id=r),!t.hasProperties())return n;var o=t.getProperties(),i=t.getGeometry();return i&&(n.geometry=Md(i,e),delete o[t.getGeometryName()]),se(o)||(n.properties=o),n},e.prototype.writeFeaturesObject=function(t,e){e=this.adaptOptions(e);for(var n=[],r=0,o=t.length;r<o;++r)n.push(this.writeFeatureObject(t[r],e));return{type:"FeatureCollection",features:n}},e.prototype.writeGeometryObject=function(t,e){return Md(t,this.adaptOptions(e))},e}(Cd);function Zd(t,e){if(!t)return null;var n;switch(t.type){case br.POINT:n=function(t){return new _i(t.coordinates)}(t);break;case br.LINE_STRING:n=function(t){return new al(t.coordinates)}(t);break;case br.POLYGON:n=function(t){return new Zi(t.coordinates)}(t);break;case br.MULTI_POINT:n=function(t){return new Qs(t.coordinates)}(t);break;case br.MULTI_LINE_STRING:n=function(t){return new cl(t.coordinates)}(t);break;case br.MULTI_POLYGON:n=function(t){return new dl(t.coordinates)}(t);break;case br.GEOMETRY_COLLECTION:n=function(t,e){var n=t.geometries.map((function(t){return Zd(t,e)}));return new _l(n)}(t);break;default:throw new Error("Unsupported GeoJSON type: "+t.type)}return Pl(n,!1,e)}Rd.prototype.readFeatureFromObject=function(t,e){var n=null;const r=(n="Feature"===t.type?t:{type:"Feature",geometry:t,properties:null}).geometry&&n.geometry.coordinates&&n.geometry.coordinates.length?Zd(n.geometry,e):null;var o=new Xs;return this.geometryName_?o.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in n!==void 0&&o.setGeometryName(n.geometry_name),o.setGeometry(r),"id"in n&&o.setId(n.id),n.properties&&o.setProperties(n.properties,!0),o};const Dd=Rd;var kd=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Nd=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"];const Fd=function(t){for(var e=[],n=[],r=Math.pow(2,t.length),o=0;o<r;o++){n=[];for(var i=0;i<t.length;i++)o&Math.pow(2,i)&&-1==n.indexOf(t[i])&&n.push(t[i]);n.length>0&&-1==e.indexOf(n.join(" "))&&e.push(n.join(" "))}return e}(Nd.slice().slice(1));!function(t,e){if(t&&t.length>0)for(var n=0;n<e.length;n++){var r=t.indexOf(e[n]);r>-1&&t.splice(r,1)}}(Fd,Nd),Nd=Nd.concat(Fd);const Ud=function(t){return 1e3*dc(t)};var Gd={rte:fh,trk:mh,wpt:gh},Bd=Hl(Nd,{rte:kl(fh),trk:kl(mh),wpt:kl(gh)}),jd=Hl(Nd,{text:Ul(yc,"linkText"),type:Ul(yc,"linkType")}),Wd=Hl(Nd,{rte:Gl((function(t,e,n){var r=n[0],o=e.getProperties(),i={node:t};i.properties=o;var a=e.getGeometry();if(a.getType()==br.LINE_STRING){var s=Pl(a,!0,r);i.geometryLayout=s.getLayout(),o.rtept=s.getCoordinates()}var l=n[n.length-1].node,c=Qd[l.namespaceURI],u=ql(o,c);Kl(i,th,Wl,u,n,c)})),trk:Gl((function(t,e,n){var r=n[0],o=e.getProperties(),i={node:t};i.properties=o;var a=e.getGeometry();if(a.getType()==br.MULTI_LINE_STRING){var s=Pl(a,!0,r);o.trkseg=s.getLineStrings()}var l=n[n.length-1].node,c=nh[l.namespaceURI],u=ql(o,c);Kl(i,rh,Wl,u,n,c)})),wpt:Gl((function(t,e,n){var r=n[0],o=n[n.length-1];o.properties=e.getProperties();var i=e.getGeometry();if(i.getType()==br.POINT){var a=Pl(i,!0,r);o.geometryLayout=a.getLayout(),vh(t,a.getCoordinates(),n)}}))}),qd=function(t){function e(e){var n=t.call(this)||this,r=e||{};return n.dataProjection=io("EPSG:4326"),n.readExtensions_=r.readExtensions,n}return kd(e,t),e.prototype.handleReadExtensions_=function(t){t||(t=[]);for(var e=0,n=t.length;e<n;++e){var r=t[e];if(this.readExtensions_){var o=r.get("extensionsNode_")||null;this.readExtensions_(r,o)}r.set("extensionsNode_",void 0)}},e.prototype.readFeatureFromNode=function(t,e){if(!c(Nd,t.namespaceURI))return null;var n=Gd[t.localName];if(!n)return null;var r=n(t,[this.getReadOptions(t,e)]);return r?(this.handleReadExtensions_([r]),r):null},e.prototype.readFeaturesFromNode=function(t,e){if(!c(Nd,t.namespaceURI))return[];if("gpx"==t.localName){var n=zl([],Bd,t,[this.getReadOptions(t,e)]);return n?(this.handleReadExtensions_(n),n):[]}return[]},e.prototype.writeFeaturesNode=function(t,e){e=this.adaptOptions(e);var n=xl("http://www.topografix.com/GPX/1/1","gpx");return n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",Ol),n.setAttributeNS(Ol,"xsi:schemaLocation","http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd"),n.setAttribute("version","1.1"),n.setAttribute("creator","OpenLayers"),Kl({node:n},Wd,ch,t,[e]),n},e}(tc),Hd=Hl(Nd,{name:Ul(yc),cmt:Ul(yc),desc:Ul(yc),src:Ul(yc),link:dh,number:Ul(mc),extensions:hh,type:Ul(yc),rtept:function(t,e){var n=zl({},Vd,t,e);if(n){var r=e[e.length-1],o=r.flatCoordinates,i=r.layoutOptions;uh(o,i,t,n)}}}),Vd=Hl(Nd,{ele:Ul(hc),time:Ul(Ud)}),zd=Hl(Nd,{name:Ul(yc),cmt:Ul(yc),desc:Ul(yc),src:Ul(yc),link:dh,number:Ul(mc),type:Ul(yc),extensions:hh,trkseg:function(t,e){var n=e[e.length-1];Vl(Yd,t,e);var r=n.flatCoordinates;n.ends.push(r.length)}}),Yd=Hl(Nd,{trkpt:function(t,e){var n=zl({},Kd,t,e);if(n){var r=e[e.length-1],o=r.flatCoordinates,i=r.layoutOptions;uh(o,i,t,n)}}}),Kd=Hl(Nd,{ele:Ul(hc),time:Ul(Ud)}),Xd=Hl(Nd,{ele:Ul(hc),time:Ul(Ud),magvar:Ul(hc),geoidheight:Ul(hc),name:Ul(yc),cmt:Ul(yc),desc:Ul(yc),src:Ul(yc),link:dh,sym:Ul(yc),type:Ul(yc),fix:Ul(yc),sat:Ul(mc),hdop:Ul(hc),vdop:Ul(hc),pdop:Ul(hc),ageofdgpsdata:Ul(hc),dgpsid:Ul(mc),extensions:hh}),$d=["text","type"],Jd=Hl(Nd,{text:Gl(wc),type:Gl(wc)}),Qd=Hl(Nd,["name","cmt","desc","src","link","number","type","rtept"]),th=Hl(Nd,{name:Gl(wc),cmt:Gl(wc),desc:Gl(wc),src:Gl(wc),link:Gl(yh),number:Gl(Ec),type:Gl(wc),rtept:Bl(Gl(vh))}),eh=Hl(Nd,["ele","time"]),nh=Hl(Nd,["name","cmt","desc","src","link","number","type","trkseg"]),rh=Hl(Nd,{name:Gl(wc),cmt:Gl(wc),desc:Gl(wc),src:Gl(wc),link:Gl(yh),number:Gl(Ec),type:Gl(wc),trkseg:Bl(Gl((function(t,e,n){var r={node:t};r.geometryLayout=e.getLayout(),r.properties={},Kl(r,ih,oh,e.getCoordinates(),n)})))}),oh=jl("trkpt"),ih=Hl(Nd,{trkpt:Gl(vh)}),ah=Hl(Nd,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),sh=Hl(Nd,{ele:Gl(Cc),time:Gl((function(t,e){var n=new Date(1e3*e),r=n.getUTCFullYear()+"-"+ws(n.getUTCMonth()+1,2)+"-"+ws(n.getUTCDate(),2)+"T"+ws(n.getUTCHours(),2)+":"+ws(n.getUTCMinutes(),2)+":"+ws(n.getUTCSeconds(),2)+"Z";t.appendChild(Jl().createTextNode(r))})),magvar:Gl(Cc),geoidheight:Gl(Cc),name:Gl(wc),cmt:Gl(wc),desc:Gl(wc),src:Gl(wc),link:Gl(yh),sym:Gl(wc),type:Gl(wc),fix:Gl(wc),sat:Gl(Ec),hdop:Gl(Cc),vdop:Gl(Cc),pdop:Gl(Cc),ageofdgpsdata:Gl(Cc),dgpsid:Gl(Ec)}),lh={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function ch(t,e,n){var r=t.getGeometry();if(r){var o=lh[r.getType()];if(o)return xl(e[e.length-1].node.namespaceURI,o)}}function uh(t,e,n,r){return t.push(parseFloat(n.getAttribute("lon")),parseFloat(n.getAttribute("lat"))),"ele"in r?(t.push(r.ele),delete r.ele,e.hasZ=!0):t.push(0),"time"in r?(t.push(r.time),delete r.time,e.hasM=!0):t.push(0),t}function ph(t,e,n){var r=Fo.XY,o=2;if(t.hasZ&&t.hasM?(r=Fo.XYZM,o=4):t.hasZ?(r=Fo.XYZ,o=3):t.hasM&&(r=Fo.XYM,o=3),4!==o){for(var i=0,a=e.length/4;i<a;i++)e[i*o]=e[4*i],e[i*o+1]=e[4*i+1],t.hasZ&&(e[i*o+2]=e[4*i+2]),t.hasM&&(e[i*o+2]=e[4*i+3]);if(e.length=e.length/4*o,n)for(i=0,a=n.length;i<a;i++)n[i]=n[i]/4*o}return r}function dh(t,e){var n=e[e.length-1],r=t.getAttribute("href");null!==r&&(n.link=r),Vl(jd,t,e)}function hh(t,e){e[e.length-1].extensionsNode_=t}function fh(t,e){var n=e[0],r=zl({flatCoordinates:[],layoutOptions:{}},Hd,t,e);if(r){var o=r.flatCoordinates;delete r.flatCoordinates;var i=r.layoutOptions;delete r.layoutOptions;var a=ph(i,o),s=new al(o,a);Pl(s,!1,n);var l=new Xs(s);return l.setProperties(r,!0),l}}function mh(t,e){var n=e[0],r=zl({flatCoordinates:[],ends:[],layoutOptions:{}},zd,t,e);if(r){var o=r.flatCoordinates;delete r.flatCoordinates;var i=r.ends;delete r.ends;var a=r.layoutOptions;delete r.layoutOptions;var s=ph(a,o,i),l=new cl(o,s,i);Pl(l,!1,n);var c=new Xs(l);return c.setProperties(r,!0),c}}function gh(t,e){var n=e[0],r=zl({},Xd,t,e);if(r){var o={},i=uh([],o,t,r),a=ph(o,i),s=new _i(i,a);Pl(s,!1,n);var l=new Xs(s);return l.setProperties(r,!0),l}}function yh(t,e,n){t.setAttribute("href",e);var r=n[n.length-1].properties,o=[r.linkText,r.linkType];Kl({node:t},Jd,Wl,o,n,$d)}function vh(t,e,n){var r=n[n.length-1],o=r.node.namespaceURI,i=r.properties;switch(t.setAttributeNS(null,"lat",String(e[1])),t.setAttributeNS(null,"lon",String(e[0])),r.geometryLayout){case Fo.XYZM:0!==e[3]&&(i.time=e[3]);case Fo.XYZ:0!==e[2]&&(i.ele=e[2]);break;case Fo.XYM:0!==e[2]&&(i.time=e[2])}var a="rtept"==t.nodeName?eh[o]:ah[o],s=ql(i,a);Kl({node:t,properties:i},sh,Wl,s,n,a)}const _h=qd;const Ch=function(){function t(t){var e=t||{};this.color_=void 0!==e.color?e.color:null}return t.prototype.clone=function(){var e=this.getColor();return new t({color:Array.isArray(e)?e.slice():e||void 0})},t.prototype.getColor=function(){return this.color_},t.prototype.setColor=function(t){this.color_=t},t}(),Eh={FRACTION:"fraction",PIXELS:"pixels"},wh={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},Sh=0,bh=1,Lh=2,Th=3,Ph=4;var Ah=function(){function t(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=qi(t.scale),this.displacement_=t.displacement}return t.prototype.clone=function(){var e=this.getScale();return new t({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()})},t.prototype.getOpacity=function(){return this.opacity_},t.prototype.getRotateWithView=function(){return this.rotateWithView_},t.prototype.getRotation=function(){return this.rotation_},t.prototype.getScale=function(){return this.scale_},t.prototype.getScaleArray=function(){return this.scaleArray_},t.prototype.getDisplacement=function(){return this.displacement_},t.prototype.getAnchor=function(){return r()},t.prototype.getImage=function(t){return r()},t.prototype.getHitDetectionImage=function(){return r()},t.prototype.getPixelRatio=function(t){return 1},t.prototype.getImageState=function(){return r()},t.prototype.getImageSize=function(){return r()},t.prototype.getOrigin=function(){return r()},t.prototype.getSize=function(){return r()},t.prototype.setDisplacement=function(t){this.displacement_=t},t.prototype.setOpacity=function(t){this.opacity_=t},t.prototype.setRotateWithView=function(t){this.rotateWithView_=t},t.prototype.setRotation=function(t){this.rotation_=t},t.prototype.setScale=function(t){this.scale_=t,this.scaleArray_=qi(t)},t.prototype.listenImageChange=function(t){r()},t.prototype.load=function(){r()},t.prototype.unlistenImageChange=function(t){r()},t}();const Oh=Ah;var xh=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const Ih=function(t){function e(e,n,r,o){var i=t.call(this)||this;return i.extent=e,i.pixelRatio_=r,i.resolution=n,i.state=o,i}return xh(e,t),e.prototype.changed=function(){this.dispatchEvent(pe.CHANGE)},e.prototype.getExtent=function(){return this.extent},e.prototype.getImage=function(){return r()},e.prototype.getPixelRatio=function(){return this.pixelRatio_},e.prototype.getResolution=function(){return this.resolution},e.prototype.getState=function(){return this.state},e.prototype.load=function(){r()},e}(ue);var Mh=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function Rh(t,e,n){var r=t,o=!0,i=!1,a=!1,s=[he(r,pe.LOAD,(function(){a=!0,i||e()}))];return r.src&&T?(i=!0,r.decode().then((function(){o&&e()})).catch((function(t){o&&(a?e():n())}))):s.push(he(r,pe.ERROR,n)),function(){o=!1,s.forEach(fe)}}const Zh=function(t){function e(e,n,r,o,i,a){var s=t.call(this,e,n,r,Sh)||this;return s.src_=o,s.image_=new Image,null!==i&&(s.image_.crossOrigin=i),s.unlisten_=null,s.state=Sh,s.imageLoadFunction_=a,s}return Mh(e,t),e.prototype.getImage=function(){return this.image_},e.prototype.handleImageError_=function(){this.state=Th,this.unlistenImage_(),this.changed()},e.prototype.handleImageLoad_=function(){void 0===this.resolution&&(this.resolution=wt(this.extent)/this.image_.height),this.state=Lh,this.unlistenImage_(),this.changed()},e.prototype.load=function(){this.state!=Sh&&this.state!=Th||(this.state=bh,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=Rh(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},e.prototype.setImage=function(t){this.image_=t,this.resolution=wt(this.extent)/this.image_.height},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},e}(Ih);var Dh=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),kh=null,Nh=function(t){function e(e,n,r,o,i,a){var s=t.call(this)||this;return s.hitDetectionImage_=null,s.image_=e||new Image,null!==o&&(s.image_.crossOrigin=o),s.canvas_={},s.color_=a,s.unlisten_=null,s.imageState_=i,s.size_=r,s.src_=n,s.tainted_,s}return Dh(e,t),e.prototype.isTainted_=function(){if(void 0===this.tainted_&&this.imageState_===Lh){kh||(kh=dn(1,1)),kh.drawImage(this.image_,0,0);try{kh.getImageData(0,0,1,1),this.tainted_=!1}catch(t){kh=null,this.tainted_=!0}}return!0===this.tainted_},e.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(pe.CHANGE)},e.prototype.handleImageError_=function(){this.imageState_=Th,this.unlistenImage_(),this.dispatchChangeEvent_()},e.prototype.handleImageLoad_=function(){this.imageState_=Lh,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()},e.prototype.getImage=function(t){return this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_},e.prototype.getPixelRatio=function(t){return this.replaceColor_(t),this.canvas_[t]?t:1},e.prototype.getImageState=function(){return this.imageState_},e.prototype.getHitDetectionImage=function(){if(!this.hitDetectionImage_)if(this.isTainted_()){var t=this.size_[0],e=this.size_[1],n=dn(t,e);n.fillRect(0,0,t,e),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},e.prototype.getSize=function(){return this.size_},e.prototype.getSrc=function(){return this.src_},e.prototype.load=function(){if(this.imageState_==Sh){this.imageState_=bh;try{this.image_.src=this.src_}catch(t){this.handleImageError_()}this.unlisten_=Rh(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}},e.prototype.replaceColor_=function(t){if(this.color_&&!this.canvas_[t]&&this.imageState_===Lh){var e=document.createElement("canvas");this.canvas_[t]=e,e.width=Math.ceil(this.image_.width*t),e.height=Math.ceil(this.image_.height*t);var n=e.getContext("2d");if(n.scale(t,t),n.drawImage(this.image_,0,0),n.globalCompositeOperation="multiply","multiply"===n.globalCompositeOperation||this.isTainted_())n.fillStyle=Ht(this.color_),n.fillRect(0,0,e.width/t,e.height/t),n.globalCompositeOperation="destination-in",n.drawImage(this.image_,0,0);else{for(var r=n.getImageData(0,0,e.width,e.height),o=r.data,i=this.color_[0]/255,a=this.color_[1]/255,s=this.color_[2]/255,l=this.color_[3],c=0,u=o.length;c<u;c+=4)o[c]*=i,o[c+1]*=a,o[c+2]*=s,o[c+3]*=l;n.putImageData(r,0,0)}}},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},e}(ue);var Fh=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Uh=function(t){function e(e){var n=this,r=e||{},o=void 0!==r.opacity?r.opacity:1,a=void 0!==r.rotation?r.rotation:0,s=void 0!==r.scale?r.scale:1,l=void 0!==r.rotateWithView&&r.rotateWithView;(n=t.call(this,{opacity:o,rotation:a,scale:s,displacement:void 0!==r.displacement?r.displacement:[0,0],rotateWithView:l})||this).anchor_=void 0!==r.anchor?r.anchor:[.5,.5],n.normalizedAnchor_=null,n.anchorOrigin_=void 0!==r.anchorOrigin?r.anchorOrigin:wh.TOP_LEFT,n.anchorXUnits_=void 0!==r.anchorXUnits?r.anchorXUnits:Eh.FRACTION,n.anchorYUnits_=void 0!==r.anchorYUnits?r.anchorYUnits:Eh.FRACTION,n.crossOrigin_=void 0!==r.crossOrigin?r.crossOrigin:null;var c=void 0!==r.img?r.img:null;n.imgSize_=r.imgSize;var u=r.src;x(!(void 0!==u&&c),4),x(!c||c&&n.imgSize_,5),void 0!==u&&0!==u.length||!c||(u=c.src||i(c)),x(void 0!==u&&u.length>0,6);var p=void 0!==r.src?Sh:Lh;return n.color_=void 0!==r.color?Yt(r.color):null,n.iconImage_=function(t,e,n,r,o,i){var a=Qt.get(e,r,i);return a||(a=new Nh(t,e,n,r,o,i),Qt.set(e,r,i,a)),a}(c,u,void 0!==n.imgSize_?n.imgSize_:null,n.crossOrigin_,p,n.color_),n.offset_=void 0!==r.offset?r.offset:[0,0],n.offsetOrigin_=void 0!==r.offsetOrigin?r.offsetOrigin:wh.TOP_LEFT,n.origin_=null,n.size_=void 0!==r.size?r.size:null,n}return Fh(e,t),e.prototype.clone=function(){var t=this.getScale();return new e({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Array.isArray(t)?t.slice():t,size:null!==this.size_?this.size_.slice():void 0,src:this.getSrc()})},e.prototype.getAnchor=function(){var t=this.normalizedAnchor_;if(!t){t=this.anchor_;var e=this.getSize();if(this.anchorXUnits_==Eh.FRACTION||this.anchorYUnits_==Eh.FRACTION){if(!e)return null;t=this.anchor_.slice(),this.anchorXUnits_==Eh.FRACTION&&(t[0]*=e[0]),this.anchorYUnits_==Eh.FRACTION&&(t[1]*=e[1])}if(this.anchorOrigin_!=wh.TOP_LEFT){if(!e)return null;t===this.anchor_&&(t=this.anchor_.slice()),this.anchorOrigin_!=wh.TOP_RIGHT&&this.anchorOrigin_!=wh.BOTTOM_RIGHT||(t[0]=-t[0]+e[0]),this.anchorOrigin_!=wh.BOTTOM_LEFT&&this.anchorOrigin_!=wh.BOTTOM_RIGHT||(t[1]=-t[1]+e[1])}this.normalizedAnchor_=t}var n=this.getDisplacement();return[t[0]-n[0],t[1]+n[1]]},e.prototype.setAnchor=function(t){this.anchor_=t,this.normalizedAnchor_=null},e.prototype.getColor=function(){return this.color_},e.prototype.getImage=function(t){return this.iconImage_.getImage(t)},e.prototype.getPixelRatio=function(t){return this.iconImage_.getPixelRatio(t)},e.prototype.getImageSize=function(){return this.iconImage_.getSize()},e.prototype.getImageState=function(){return this.iconImage_.getImageState()},e.prototype.getHitDetectionImage=function(){return this.iconImage_.getHitDetectionImage()},e.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var t=this.offset_;if(this.offsetOrigin_!=wh.TOP_LEFT){var e=this.getSize(),n=this.iconImage_.getSize();if(!e||!n)return null;t=t.slice(),this.offsetOrigin_!=wh.TOP_RIGHT&&this.offsetOrigin_!=wh.BOTTOM_RIGHT||(t[0]=n[0]-e[0]-t[0]),this.offsetOrigin_!=wh.BOTTOM_LEFT&&this.offsetOrigin_!=wh.BOTTOM_RIGHT||(t[1]=n[1]-e[1]-t[1])}return this.origin_=t,this.origin_},e.prototype.getSrc=function(){return this.iconImage_.getSrc()},e.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},e.prototype.listenImageChange=function(t){this.iconImage_.addEventListener(pe.CHANGE,t)},e.prototype.load=function(){this.iconImage_.load()},e.prototype.unlistenImageChange=function(t){this.iconImage_.removeEventListener(pe.CHANGE,t)},e}(Oh);const Gh=Uh;const Bh=function(){function t(t){var e=t||{};this.color_=void 0!==e.color?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=void 0!==e.lineDash?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}return t.prototype.clone=function(){var e=this.getColor();return new t({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},t.prototype.getColor=function(){return this.color_},t.prototype.getLineCap=function(){return this.lineCap_},t.prototype.getLineDash=function(){return this.lineDash_},t.prototype.getLineDashOffset=function(){return this.lineDashOffset_},t.prototype.getLineJoin=function(){return this.lineJoin_},t.prototype.getMiterLimit=function(){return this.miterLimit_},t.prototype.getWidth=function(){return this.width_},t.prototype.setColor=function(t){this.color_=t},t.prototype.setLineCap=function(t){this.lineCap_=t},t.prototype.setLineDash=function(t){this.lineDash_=t},t.prototype.setLineDashOffset=function(t){this.lineDashOffset_=t},t.prototype.setLineJoin=function(t){this.lineJoin_=t},t.prototype.setMiterLimit=function(t){this.miterLimit_=t},t.prototype.setWidth=function(t){this.width_=t},t}();function jh(t){return Array.isArray(t)?Xt(t):t}var Wh=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),qh=function(t){function e(e){var n=this,r=void 0!==e.rotateWithView&&e.rotateWithView;return(n=t.call(this,{opacity:1,rotateWithView:r,rotation:void 0!==e.rotation?e.rotation:0,scale:void 0!==e.scale?e.scale:1,displacement:void 0!==e.displacement?e.displacement:[0,0]})||this).canvas_=void 0,n.hitDetectionCanvas_=null,n.fill_=void 0!==e.fill?e.fill:null,n.origin_=[0,0],n.points_=e.points,n.radius_=void 0!==e.radius?e.radius:e.radius1,n.radius2_=e.radius2,n.angle_=void 0!==e.angle?e.angle:0,n.stroke_=void 0!==e.stroke?e.stroke:null,n.size_=null,n.renderOptions_=null,n.render(),n}return Wh(e,t),e.prototype.clone=function(){var t=this.getScale(),n=new e({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice()});return n.setOpacity(this.getOpacity()),n},e.prototype.getAnchor=function(){var t=this.size_;if(!t)return null;var e=this.getDisplacement();return[t[0]/2-e[0],t[1]/2+e[1]]},e.prototype.getAngle=function(){return this.angle_},e.prototype.getFill=function(){return this.fill_},e.prototype.getHitDetectionImage=function(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_},e.prototype.getImage=function(t){var e=this.canvas_[t];if(!e){var n=this.renderOptions_,r=dn(n.size*t,n.size*t);this.draw_(n,r,t),e=r.canvas,this.canvas_[t]=e}return e},e.prototype.getPixelRatio=function(t){return t},e.prototype.getImageSize=function(){return this.size_},e.prototype.getImageState=function(){return Lh},e.prototype.getOrigin=function(){return this.origin_},e.prototype.getPoints=function(){return this.points_},e.prototype.getRadius=function(){return this.radius_},e.prototype.getRadius2=function(){return this.radius2_},e.prototype.getSize=function(){return this.size_},e.prototype.getStroke=function(){return this.stroke_},e.prototype.listenImageChange=function(t){},e.prototype.load=function(){},e.prototype.unlistenImageChange=function(t){},e.prototype.calculateLineJoinSize_=function(t,e,n){if(0===e||this.points_===1/0||"bevel"!==t&&"miter"!==t)return e;var r=this.radius_,o=void 0===this.radius2_?r:this.radius2_;if(r<o){var i=r;r=o,o=i}var a=void 0===this.radius2_?this.points_:2*this.points_,s=2*Math.PI/a,l=o*Math.sin(s),c=r-Math.sqrt(o*o-l*l),u=Math.sqrt(l*l+c*c),p=u/l;if("miter"===t&&p<=n)return p*e;var d=e/2/p,h=e/2*(c/u),f=Math.sqrt((r+d)*(r+d)+h*h)-r;if(void 0===this.radius2_||"bevel"===t)return 2*f;var m=r*Math.sin(s),g=o-Math.sqrt(r*r-m*m),y=Math.sqrt(m*m+g*g)/m;if(y<=n){var v=y*e/2-o-r;return 2*Math.max(f,v)}return 2*f},e.prototype.createRenderOptions=function(){var t,e=wn,n=0,r=null,o=0,i=0;this.stroke_&&(null===(t=this.stroke_.getColor())&&(t=Sn),t=jh(t),void 0===(i=this.stroke_.getWidth())&&(i=1),r=this.stroke_.getLineDash(),o=this.stroke_.getLineDashOffset(),void 0===(e=this.stroke_.getLineJoin())&&(e=wn),void 0===(n=this.stroke_.getMiterLimit())&&(n=10));var a=this.calculateLineJoinSize_(e,i,n),s=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:t,strokeWidth:i,size:Math.ceil(2*s+a),lineDash:r,lineDashOffset:o,lineJoin:e,miterLimit:n}},e.prototype.render=function(){this.renderOptions_=this.createRenderOptions();var t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]},e.prototype.draw_=function(t,e,n){if(e.scale(n,n),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){var r=this.fill_.getColor();null===r&&(r=_n),e.fillStyle=jh(r),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,e.setLineDash&&t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())},e.prototype.createHitDetectionCanvas_=function(t){if(this.fill_){var e=this.fill_.getColor(),n=0;if("string"==typeof e&&(e=Yt(e)),null===e?n=1:Array.isArray(e)&&(n=4===e.length?e[3]:1),0===n){var r=dn(t.size,t.size);this.hitDetectionCanvas_=r.canvas,this.drawHitDetectionCanvas_(t,r)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))},e.prototype.createPath_=function(t){var e=this.points_,n=this.radius_;if(e===1/0)t.arc(0,0,n,0,2*Math.PI);else{var r=void 0===this.radius2_?n:this.radius2_;void 0!==this.radius2_&&(e*=2);for(var o=this.angle_-Math.PI/2,i=2*Math.PI/e,a=0;a<e;a++){var s=o+a*i,l=a%2==0?n:r;t.lineTo(l*Math.cos(s),l*Math.sin(s))}t.closePath()}},e.prototype.drawHitDetectionCanvas_=function(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=_n,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())},e}(Oh);const Hh=qh;var Vh=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),zh=function(t){function e(e){var n=e||{};return t.call(this,{points:1/0,fill:n.fill,radius:n.radius,stroke:n.stroke,scale:void 0!==n.scale?n.scale:1,rotation:void 0!==n.rotation?n.rotation:0,rotateWithView:void 0!==n.rotateWithView&&n.rotateWithView,displacement:void 0!==n.displacement?n.displacement:[0,0]})||this}return Vh(e,t),e.prototype.clone=function(){var t=this.getScale(),n=new e({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()});return n.setOpacity(this.getOpacity()),n},e.prototype.setRadius=function(t){this.radius_=t,this.render()},e}(Hh);const Yh=zh;var Kh=function(){function t(t){var e=t||{};this.geometry_=null,this.geometryFunction_=Qh,void 0!==e.geometry&&this.setGeometry(e.geometry),this.fill_=void 0!==e.fill?e.fill:null,this.image_=void 0!==e.image?e.image:null,this.renderer_=void 0!==e.renderer?e.renderer:null,this.hitDetectionRenderer_=void 0!==e.hitDetectionRenderer?e.hitDetectionRenderer:null,this.stroke_=void 0!==e.stroke?e.stroke:null,this.text_=void 0!==e.text?e.text:null,this.zIndex_=e.zIndex}return t.prototype.clone=function(){var e=this.getGeometry();return e&&"object"==typeof e&&(e=e.clone()),new t({geometry:e,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},t.prototype.getRenderer=function(){return this.renderer_},t.prototype.setRenderer=function(t){this.renderer_=t},t.prototype.setHitDetectionRenderer=function(t){this.hitDetectionRenderer_=t},t.prototype.getHitDetectionRenderer=function(){return this.hitDetectionRenderer_},t.prototype.getGeometry=function(){return this.geometry_},t.prototype.getGeometryFunction=function(){return this.geometryFunction_},t.prototype.getFill=function(){return this.fill_},t.prototype.setFill=function(t){this.fill_=t},t.prototype.getImage=function(){return this.image_},t.prototype.setImage=function(t){this.image_=t},t.prototype.getStroke=function(){return this.stroke_},t.prototype.setStroke=function(t){this.stroke_=t},t.prototype.getText=function(){return this.text_},t.prototype.setText=function(t){this.text_=t},t.prototype.getZIndex=function(){return this.zIndex_},t.prototype.setGeometry=function(t){"function"==typeof t?this.geometryFunction_=t:"string"==typeof t?this.geometryFunction_=function(e){return e.get(t)}:t?void 0!==t&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Qh,this.geometry_=t},t.prototype.setZIndex=function(t){this.zIndex_=t},t}();var Xh=null;function $h(t,e){if(!Xh){var n=new Ch({color:"rgba(255,255,255,0.4)"}),r=new Bh({color:"#3399CC",width:1.25});Xh=[new Kh({image:new Yh({fill:n,stroke:r,radius:5}),fill:n,stroke:r})]}return Xh}function Jh(){var t={},e=[255,255,255,1],n=[0,153,255,1];return t[br.POLYGON]=[new Kh({fill:new Ch({color:[255,255,255,.5]})})],t[br.MULTI_POLYGON]=t[br.POLYGON],t[br.LINE_STRING]=[new Kh({stroke:new Bh({color:e,width:5})}),new Kh({stroke:new Bh({color:n,width:3})})],t[br.MULTI_LINE_STRING]=t[br.LINE_STRING],t[br.CIRCLE]=t[br.POLYGON].concat(t[br.LINE_STRING]),t[br.POINT]=[new Kh({image:new Yh({radius:6,fill:new Ch({color:n}),stroke:new Bh({color:e,width:1.5})}),zIndex:1/0})],t[br.MULTI_POINT]=t[br.POINT],t[br.GEOMETRY_COLLECTION]=t[br.POLYGON].concat(t[br.LINE_STRING],t[br.POINT]),t}function Qh(t){return t.getGeometry()}const tf=Kh,ef="point",nf="line";var rf=function(){function t(t){var e=t||{};this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.scale_=e.scale,this.scaleArray_=qi(void 0!==e.scale?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.textBaseline_=e.textBaseline,this.fill_=void 0!==e.fill?e.fill:new Ch({color:"#333"}),this.maxAngle_=void 0!==e.maxAngle?e.maxAngle:Math.PI/4,this.placement_=void 0!==e.placement?e.placement:ef,this.overflow_=!!e.overflow,this.stroke_=void 0!==e.stroke?e.stroke:null,this.offsetX_=void 0!==e.offsetX?e.offsetX:0,this.offsetY_=void 0!==e.offsetY?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=void 0===e.padding?null:e.padding}return t.prototype.clone=function(){var e=this.getScale();return new t({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})},t.prototype.getOverflow=function(){return this.overflow_},t.prototype.getFont=function(){return this.font_},t.prototype.getMaxAngle=function(){return this.maxAngle_},t.prototype.getPlacement=function(){return this.placement_},t.prototype.getOffsetX=function(){return this.offsetX_},t.prototype.getOffsetY=function(){return this.offsetY_},t.prototype.getFill=function(){return this.fill_},t.prototype.getRotateWithView=function(){return this.rotateWithView_},t.prototype.getRotation=function(){return this.rotation_},t.prototype.getScale=function(){return this.scale_},t.prototype.getScaleArray=function(){return this.scaleArray_},t.prototype.getStroke=function(){return this.stroke_},t.prototype.getText=function(){return this.text_},t.prototype.getTextAlign=function(){return this.textAlign_},t.prototype.getTextBaseline=function(){return this.textBaseline_},t.prototype.getBackgroundFill=function(){return this.backgroundFill_},t.prototype.getBackgroundStroke=function(){return this.backgroundStroke_},t.prototype.getPadding=function(){return this.padding_},t.prototype.setOverflow=function(t){this.overflow_=t},t.prototype.setFont=function(t){this.font_=t},t.prototype.setMaxAngle=function(t){this.maxAngle_=t},t.prototype.setOffsetX=function(t){this.offsetX_=t},t.prototype.setOffsetY=function(t){this.offsetY_=t},t.prototype.setPlacement=function(t){this.placement_=t},t.prototype.setRotateWithView=function(t){this.rotateWithView_=t},t.prototype.setFill=function(t){this.fill_=t},t.prototype.setRotation=function(t){this.rotation_=t},t.prototype.setScale=function(t){this.scale_=t,this.scaleArray_=qi(void 0!==t?t:1)},t.prototype.setStroke=function(t){this.stroke_=t},t.prototype.setText=function(t){this.text_=t},t.prototype.setTextAlign=function(t){this.textAlign_=t},t.prototype.setTextBaseline=function(t){this.textBaseline_=t},t.prototype.setBackgroundFill=function(t){this.backgroundFill_=t},t.prototype.setBackgroundStroke=function(t){this.backgroundStroke_=t},t.prototype.setPadding=function(t){this.padding_=t},t}();const of=rf;var af,sf,lf,cf,uf,pf,df=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),hf=["http://www.google.com/kml/ext/2.2"],ff=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],mf={fraction:Eh.FRACTION,pixels:Eh.PIXELS,insetPixels:Eh.PIXELS},gf=Hl(ff,{ExtendedData:hm,Region:fm,MultiGeometry:Ul(om,"geometry"),LineString:Ul(em,"geometry"),LinearRing:Ul(nm,"geometry"),Point:Ul(im,"geometry"),Polygon:Ul(sm,"geometry"),Style:Ul(cm),StyleMap:function(t,e){var n=Bf.call(this,t,e);if(!n)return;var r=e[e.length-1];Array.isArray(n)?r.Style=n:"string"==typeof n?r.styleUrl=n:x(!1,38)},address:Ul(yc),description:Ul(yc),name:Ul(yc),open:Ul(uc),phoneNumber:Ul(yc),styleUrl:Ul(Ff),visibility:Ul(uc)},Hl(hf,{MultiTrack:Ul((function(t,e){var n=zl([],Yf,t,e);if(!n)return;return new cl(n)}),"geometry"),Track:Ul(Xf,"geometry")})),yf=Hl(ff,{ExtendedData:hm,Region:fm,Link:function(t,e){Vl(vf,t,e)},address:Ul(yc),description:Ul(yc),name:Ul(yc),open:Ul(uc),phoneNumber:Ul(yc),visibility:Ul(uc)}),vf=Hl(ff,{href:Ul(Nf)}),_f=Hl(ff,{LatLonAltBox:function(t,e){var n=zl({},ym,t,e);if(!n)return;var r=e[e.length-1],o=[parseFloat(n.west),parseFloat(n.south),parseFloat(n.east),parseFloat(n.north)];r.extent=o,r.altitudeMode=n.altitudeMode,r.minAltitude=parseFloat(n.minAltitude),r.maxAltitude=parseFloat(n.maxAltitude)},Lod:function(t,e){var n=zl({},vm,t,e);if(!n)return;var r=e[e.length-1];r.minLodPixels=parseFloat(n.minLodPixels),r.maxLodPixels=parseFloat(n.maxLodPixels),r.minFadeExtent=parseFloat(n.minFadeExtent),r.maxFadeExtent=parseFloat(n.maxFadeExtent)}}),Cf=Hl(ff,["Document","Placemark"]),Ef=Hl(ff,{Document:Gl((function(t,e,n){Kl({node:t},Sm,bm,e,n,void 0,this)})),Placemark:Gl(Ym)}),wf=null;var Sf,bf=null;var Lf,Tf=null;var Pf=null;var Af=null;var Of,xf=null;function If(t){return 32/Math.min(t[0],t[1])}function Mf(t){return t}var Rf=function(t){function e(e){var n=t.call(this)||this,r=e||{};return xf||(wf=new Ch({color:af=[255,255,255,1]}),pf="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",bf=new Gh({anchor:sf=[20,2],anchorOrigin:wh.BOTTOM_LEFT,anchorXUnits:lf=Eh.PIXELS,anchorYUnits:cf=Eh.PIXELS,crossOrigin:"anonymous",rotation:0,scale:If(uf=[64,64]),size:uf,src:pf}),Sf="NO_IMAGE",Tf=new Bh({color:af,width:1}),Lf=new Bh({color:[51,51,51,1],width:2}),Pf=new of({font:"bold 16px Helvetica",fill:wf,stroke:Lf,scale:.8}),Af=new tf({fill:wf,image:bf,text:Pf,stroke:Tf,zIndex:0}),xf=[Af]),n.dataProjection=io("EPSG:4326"),n.defaultStyle_=r.defaultStyle?r.defaultStyle:xf,n.extractStyles_=void 0===r.extractStyles||r.extractStyles,n.writeStyles_=void 0===r.writeStyles||r.writeStyles,n.sharedStyles_={},n.showPointNames_=void 0===r.showPointNames||r.showPointNames,n.crossOrigin_=void 0!==r.crossOrigin?r.crossOrigin:"anonymous",n.iconUrlFunction_=r.iconUrlFunction?r.iconUrlFunction:Mf,n.supportedMediaTypes=["application/vnd.google-earth.kml+xml"],n}return df(e,t),e.prototype.readDocumentOrFolder_=function(t,e){var n=zl([],Hl(ff,{Document:Dl(this.readDocumentOrFolder_,this),Folder:Dl(this.readDocumentOrFolder_,this),Placemark:kl(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),t,e,this);return n||void 0},e.prototype.readPlacemark_=function(t,e){var n=zl({geometry:null},gf,t,e,this);if(n){var r=new Xs,o=t.getAttribute("id");null!==o&&r.setId(o);var i=e[0],a=n.geometry;if(a&&Pl(a,!1,i),r.setGeometry(a),delete n.geometry,this.extractStyles_){var s=function(t,e,n,r,o){return function(i,a){var s=o,l="",c=[];if(s){var u=i.getGeometry();if(u)if(u instanceof _l)c=u.getGeometriesArrayRecursive().filter((function(t){var e=t.getType();return e===br.POINT||e===br.MULTI_POINT})),s=c.length>0;else{var p=u.getType();s=p===br.POINT||p===br.MULTI_POINT}}s&&(l=i.get("name"),(s=s&&!!l)&&l.search(/&[^&]+;/)>-1&&(Of||(Of=document.createElement("textarea")),Of.innerHTML=l,l=Of.value));var d=n;if(t?d=t:e&&(d=Zf(e,n,r)),s){var h=function(t,e){var n=[0,0],r="start",o=t.getImage();if(o){var i=o.getSize();if(i&&2==i.length){var a=o.getScaleArray(),s=o.getAnchor();n[0]=a[0]*(i[0]-s[0]),n[1]=a[1]*(i[1]/2-s[1]),r="left"}}var l=t.getText();l?((l=l.clone()).setFont(l.getFont()||Pf.getFont()),l.setScale(l.getScale()||Pf.getScale()),l.setFill(l.getFill()||Pf.getFill()),l.setStroke(l.getStroke()||Lf)):l=Pf.clone();return l.setText(e),l.setOffsetX(n[0]),l.setOffsetY(n[1]),l.setTextAlign(r),new tf({image:o,text:l})}(d[0],l);return c.length>0?(h.setGeometry(new _l(c)),[h,new tf({geometry:d[0].getGeometry(),image:null,fill:d[0].getFill(),stroke:d[0].getStroke(),text:null})].concat(d.slice(1))):h}return d}}(n.Style,n.styleUrl,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);r.setStyle(s)}return delete n.Style,r.setProperties(n,!0),r}},e.prototype.readSharedStyle_=function(t,e){var n=t.getAttribute("id");if(null!==n){var r=cm.call(this,t,e);if(r){var o=void 0,i=t.baseURI;if(i&&"about:blank"!=i||(i=window.location.href),i)o=new URL("#"+n,i).href;else o="#"+n;this.sharedStyles_[o]=r}}},e.prototype.readSharedStyleMap_=function(t,e){var n=t.getAttribute("id");if(null!==n){var r=Bf.call(this,t,e);if(r){var o,i=t.baseURI;if(i&&"about:blank"!=i||(i=window.location.href),i)o=new URL("#"+n,i).href;else o="#"+n;this.sharedStyles_[o]=r}}},e.prototype.readFeatureFromNode=function(t,e){if(!c(ff,t.namespaceURI))return null;var n=this.readPlacemark_(t,[this.getReadOptions(t,e)]);return n||null},e.prototype.readFeaturesFromNode=function(t,e){if(!c(ff,t.namespaceURI))return[];var n,r=t.localName;if("Document"==r||"Folder"==r)return(n=this.readDocumentOrFolder_(t,[this.getReadOptions(t,e)]))||[];if("Placemark"==r){var o=this.readPlacemark_(t,[this.getReadOptions(t,e)]);return o?[o]:[]}if("kml"==r){n=[];for(var i=t.firstElementChild;i;i=i.nextElementSibling){var a=this.readFeaturesFromNode(i,e);a&&d(n,a)}return n}return[]},e.prototype.readName=function(t){if(t){if("string"==typeof t){var e=Zl(t);return this.readNameFromDocument(e)}return Rl(t)?this.readNameFromDocument(t):this.readNameFromNode(t)}},e.prototype.readNameFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE){var n=this.readNameFromNode(e);if(n)return n}},e.prototype.readNameFromNode=function(t){for(var e=t.firstElementChild;e;e=e.nextElementSibling)if(c(ff,e.namespaceURI)&&"name"==e.localName)return yc(e);for(e=t.firstElementChild;e;e=e.nextElementSibling){var n=e.localName;if(c(ff,e.namespaceURI)&&("Document"==n||"Folder"==n||"Placemark"==n||"kml"==n)){var r=this.readNameFromNode(e);if(r)return r}}},e.prototype.readNetworkLinks=function(t){var e=[];if("string"==typeof t){var n=Zl(t);d(e,this.readNetworkLinksFromDocument(n))}else Rl(t)?d(e,this.readNetworkLinksFromDocument(t)):d(e,this.readNetworkLinksFromNode(t));return e},e.prototype.readNetworkLinksFromDocument=function(t){for(var e=[],n=t.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&d(e,this.readNetworkLinksFromNode(n));return e},e.prototype.readNetworkLinksFromNode=function(t){for(var e=[],n=t.firstElementChild;n;n=n.nextElementSibling)if(c(ff,n.namespaceURI)&&"NetworkLink"==n.localName){var r=zl({},yf,n,[]);e.push(r)}for(n=t.firstElementChild;n;n=n.nextElementSibling){var o=n.localName;!c(ff,n.namespaceURI)||"Document"!=o&&"Folder"!=o&&"kml"!=o||d(e,this.readNetworkLinksFromNode(n))}return e},e.prototype.readRegion=function(t){var e=[];if("string"==typeof t){var n=Zl(t);d(e,this.readRegionFromDocument(n))}else Rl(t)?d(e,this.readRegionFromDocument(t)):d(e,this.readRegionFromNode(t));return e},e.prototype.readRegionFromDocument=function(t){for(var e=[],n=t.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&d(e,this.readRegionFromNode(n));return e},e.prototype.readRegionFromNode=function(t){for(var e=[],n=t.firstElementChild;n;n=n.nextElementSibling)if(c(ff,n.namespaceURI)&&"Region"==n.localName){var r=zl({},_f,n,[]);e.push(r)}for(n=t.firstElementChild;n;n=n.nextElementSibling){var o=n.localName;!c(ff,n.namespaceURI)||"Document"!=o&&"Folder"!=o&&"kml"!=o||d(e,this.readRegionFromNode(n))}return e},e.prototype.writeFeaturesNode=function(t,e){e=this.adaptOptions(e);var n=xl(ff[4],"kml"),r="http://www.w3.org/2000/xmlns/";n.setAttributeNS(r,"xmlns:gx",hf[0]),n.setAttributeNS(r,"xmlns:xsi",Ol),n.setAttributeNS(Ol,"xsi:schemaLocation","http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd");var o={node:n},i={};t.length>1?i.Document=t:1==t.length&&(i.Placemark=t[0]);var a=Cf[n.namespaceURI],s=ql(i,a);return Kl(o,Ef,Wl,s,[e],a,this),n},e}(tc);function Zf(t,e,n){return Array.isArray(t)?t:"string"==typeof t?Zf(n[t],e,n):e}function Df(t){var e=Il(t,!1),n=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(e);if(n){var r=n[1];return[parseInt(r.substr(6,2),16),parseInt(r.substr(4,2),16),parseInt(r.substr(2,2),16),parseInt(r.substr(0,2),16)/255]}}function kf(t){var e=Il(t,!1),n=[];e=e.replace(/\s*,\s*/g,",");for(var r,o=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;r=o.exec(e);){var i=parseFloat(r[1]),a=parseFloat(r[2]),s=r[3]?parseFloat(r[3]):0;n.push(i,a,s),e=e.substr(r[0].length)}if(""===e)return n}function Nf(t){var e=Il(t,!1).trim(),n=t.baseURI;return n&&"about:blank"!=n||(n=window.location.href),n?new URL(e,n).href:e}function Ff(t){var e=Il(t,!1).trim().replace(/^(?!.*#)/,"#"),n=t.baseURI;return n&&"about:blank"!=n||(n=window.location.href),n?new URL(e,n).href:e}function Uf(t){return hc(t)}var Gf=Hl(ff,{Pair:function(t,e){var n=zl({},mm,t,e,this);if(!n)return;var r=n.key;if(r&&"normal"==r){var o=n.styleUrl;o&&(e[e.length-1]=o);var i=n.Style;i&&(e[e.length-1]=i)}}});function Bf(t,e){return zl(void 0,Gf,t,e,this)}var jf=Hl(ff,{Icon:Ul((function(t,e){var n=zl({},$f,t,e);return n||null})),color:Ul(Df),heading:Ul(hc),hotSpot:Ul((function(t){var e,n=t.getAttribute("xunits"),r=t.getAttribute("yunits");return e="insetPixels"!==n?"insetPixels"!==r?wh.BOTTOM_LEFT:wh.TOP_LEFT:"insetPixels"!==r?wh.BOTTOM_RIGHT:wh.TOP_RIGHT,{x:parseFloat(t.getAttribute("x")),xunits:mf[n],y:parseFloat(t.getAttribute("y")),yunits:mf[r],origin:e}})),scale:Ul(Uf)});var Wf=Hl(ff,{color:Ul(Df),scale:Ul(Uf)});var qf=Hl(ff,{color:Ul(Df),width:Ul(hc)});var Hf=Hl(ff,{color:Ul(Df),fill:Ul(uc),outline:Ul(uc)});var Vf=Hl(ff,{coordinates:Nl(kf)});function zf(t,e){return zl(null,Vf,t,e)}var Yf=Hl(hf,{Track:kl(Xf)});var Kf=Hl(ff,{when:function(t,e){var n=e[e.length-1].whens,r=Il(t,!1),o=Date.parse(r);n.push(isNaN(o)?0:o)}},Hl(hf,{coord:function(t,e){var n=e[e.length-1].coordinates,r=Il(t,!1),o=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(r);if(o){var i=parseFloat(o[1]),a=parseFloat(o[2]),s=parseFloat(o[3]);n.push([i,a,s])}else n.push([])}}));function Xf(t,e){var n=zl({coordinates:[],whens:[]},Kf,t,e);if(n){for(var r=[],o=n.coordinates,i=n.whens,a=0,s=Math.min(o.length,i.length);a<s;++a)3==o[a].length&&r.push(o[a][0],o[a][1],o[a][2],i[a]);return new al(r,Fo.XYZM)}}var $f=Hl(ff,{href:Ul(Nf)},Hl(hf,{x:Ul(hc),y:Ul(hc),w:Ul(hc),h:Ul(hc)}));var Jf=Hl(ff,{coordinates:Nl(kf)});function Qf(t,e){return zl(null,Jf,t,e)}var tm=Hl(ff,{extrude:Ul(uc),tessellate:Ul(uc),altitudeMode:Ul(yc)});function em(t,e){var n=zl({},tm,t,e),r=Qf(t,e);if(r){var o=new al(r,Fo.XYZ);return o.setProperties(n,!0),o}}function nm(t,e){var n=zl({},tm,t,e),r=Qf(t,e);if(r){var o=new Zi(r,Fo.XYZ,[r.length]);return o.setProperties(n,!0),o}}var rm=Hl(ff,{LineString:kl(em),LinearRing:kl(nm),MultiGeometry:kl(om),Point:kl(im),Polygon:kl(sm)});function om(t,e){var n,r=zl([],rm,t,e);if(!r)return null;if(0===r.length)return new _l(r);for(var o=!0,i=r[0].getType(),a=1,s=r.length;a<s;++a)if(r[a].getType()!=i){o=!1;break}if(o){var l=void 0,c=void 0;if(i==br.POINT){var u=r[0];l=u.getLayout(),c=u.getFlatCoordinates();for(a=1,s=r.length;a<s;++a)d(c,r[a].getFlatCoordinates());um(n=new Qs(c,l),r)}else i==br.LINE_STRING?um(n=new cl(r),r):i==br.POLYGON?um(n=new dl(r),r):i==br.GEOMETRY_COLLECTION?n=new _l(r):x(!1,37)}else n=new _l(r);return n}function im(t,e){var n=zl({},tm,t,e),r=Qf(t,e);if(r){var o=new _i(r,Fo.XYZ);return o.setProperties(n,!0),o}}var am=Hl(ff,{innerBoundaryIs:function(t,e){var n=zl([],_m,t,e);if(n.length>0){var r=e[e.length-1];r.push.apply(r,n)}},outerBoundaryIs:function(t,e){var n=zl(void 0,Cm,t,e);if(n){e[e.length-1][0]=n}}});function sm(t,e){var n=zl({},tm,t,e),r=zl([null],am,t,e);if(r&&r[0]){for(var o=r[0],i=[o.length],a=1,s=r.length;a<s;++a)d(o,r[a]),i.push(o.length);var l=new Zi(o,Fo.XYZ,i);return l.setProperties(n,!0),l}}var lm=Hl(ff,{IconStyle:function(t,e){var n=zl({},jf,t,e);if(n){var r,o,i,a,s=e[e.length-1],l="Icon"in n?n.Icon:{},c=!("Icon"in n)||Object.keys(l).length>0,u=l.href;u?r=u:c&&(r=pf);var p,d=wh.BOTTOM_LEFT,h=n.hotSpot;h?(o=[h.x,h.y],i=h.xunits,a=h.yunits,d=h.origin):/^http:\/\/maps\.(?:google|gstatic)\.com\//.test(r)&&(/pushpin/.test(r)?(o=sf,i=lf,a=cf):/arrow-reverse/.test(r)?(o=[54,42],i=lf,a=cf):/paddle/.test(r)&&(o=[32,1],i=lf,a=cf));var f,m=l.x,g=l.y;void 0!==m&&void 0!==g&&(p=[m,g]);var y,v=l.w,_=l.h;void 0!==v&&void 0!==_&&(f=[v,_]);var C=n.heading;void 0!==C&&(y=kt(C));var E=n.scale,w=n.color;if(c){r==pf&&(f=uf);var S=new Gh({anchor:o,anchorOrigin:d,anchorXUnits:i,anchorYUnits:a,crossOrigin:this.crossOrigin_,offset:p,offsetOrigin:wh.BOTTOM_LEFT,rotation:y,scale:E,size:f,src:this.iconUrlFunction_(r),color:w}),b=S.getScaleArray()[0],L=S.getSize();if(null===L){var T=S.getImageState();if(T===Sh||T===bh){var P=function(){var t=S.getImageState();if(t!==Sh&&t!==bh){var e=S.getSize();if(e&&2==e.length){var n=If(e);S.setScale(b*n)}S.unlistenImageChange(P)}};S.listenImageChange(P),T===Sh&&S.load()}}else if(2==L.length){var A=If(L);S.setScale(b*A)}s.imageStyle=S}else s.imageStyle=Sf}},LabelStyle:function(t,e){var n=zl({},Wf,t,e);if(n){var r=e[e.length-1],o=new of({fill:new Ch({color:"color"in n?n.color:af}),scale:n.scale});r.textStyle=o}},LineStyle:function(t,e){var n=zl({},qf,t,e);if(n){var r=e[e.length-1],o=new Bh({color:"color"in n?n.color:af,width:"width"in n?n.width:1});r.strokeStyle=o}},PolyStyle:function(t,e){var n=zl({},Hf,t,e);if(n){var r=e[e.length-1],o=new Ch({color:"color"in n?n.color:af});r.fillStyle=o;var i=n.fill;void 0!==i&&(r.fill=i);var a=n.outline;void 0!==a&&(r.outline=a)}}});function cm(t,e){var n=zl({},lm,t,e,this);if(!n)return null;var r,o="fillStyle"in n?n.fillStyle:wf,i=n.fill;void 0===i||i||(o=null),"imageStyle"in n?n.imageStyle!=Sf&&(r=n.imageStyle):r=bf;var a="textStyle"in n?n.textStyle:Pf,s="strokeStyle"in n?n.strokeStyle:Tf,l=n.outline;return void 0===l||l?[new tf({fill:o,image:r,stroke:s,text:a,zIndex:void 0})]:[new tf({geometry:function(t){var e=t.getGeometry(),n=e.getType();return n===br.GEOMETRY_COLLECTION?new _l(e.getGeometriesArrayRecursive().filter((function(t){var e=t.getType();return e!==br.POLYGON&&e!==br.MULTI_POLYGON}))):n!==br.POLYGON&&n!==br.MULTI_POLYGON?e:void 0},fill:o,image:r,stroke:s,text:a,zIndex:void 0}),new tf({geometry:function(t){var e=t.getGeometry(),n=e.getType();return n===br.GEOMETRY_COLLECTION?new _l(e.getGeometriesArrayRecursive().filter((function(t){var e=t.getType();return e===br.POLYGON||e===br.MULTI_POLYGON}))):n===br.POLYGON||n===br.MULTI_POLYGON?e:void 0},fill:o,stroke:null,zIndex:void 0})]}function um(t,e){var n,r,o,i=e.length,a=new Array(e.length),s=new Array(e.length),l=new Array(e.length);n=!1,r=!1,o=!1;for(var c=0;c<i;++c){var u=e[c];a[c]=u.get("extrude"),s[c]=u.get("tessellate"),l[c]=u.get("altitudeMode"),n=n||void 0!==a[c],r=r||void 0!==s[c],o=o||l[c]}n&&t.set("extrude",a),r&&t.set("tessellate",s),o&&t.set("altitudeMode",l)}var pm=Hl(ff,{displayName:Ul(yc),value:Ul(yc)});var dm=Hl(ff,{Data:function(t,e){var n=t.getAttribute("name");Vl(pm,t,e);var r=e[e.length-1];n&&r.displayName?r[n]={value:r.value,displayName:r.displayName,toString:function(){return r.value}}:null!==n?r[n]=r.value:null!==r.displayName&&(r[r.displayName]=r.value),delete r.value},SchemaData:function(t,e){Vl(gm,t,e)}});function hm(t,e){Vl(dm,t,e)}function fm(t,e){Vl(_f,t,e)}var mm=Hl(ff,{Style:Ul(cm),key:Ul(yc),styleUrl:Ul(Ff)});var gm=Hl(ff,{SimpleData:function(t,e){var n=t.getAttribute("name");if(null!==n){var r=yc(t);e[e.length-1][n]=r}}});var ym=Hl(ff,{altitudeMode:Ul(yc),minAltitude:Ul(hc),maxAltitude:Ul(hc),north:Ul(hc),south:Ul(hc),east:Ul(hc),west:Ul(hc)});var vm=Hl(ff,{minLodPixels:Ul(hc),maxLodPixels:Ul(hc),minFadeExtent:Ul(hc),maxFadeExtent:Ul(hc)});var _m=Hl(ff,{LinearRing:kl(zf)});var Cm=Hl(ff,{LinearRing:Nl(zf)});function Em(t,e){for(var n=Yt(e),r=[255*(4==n.length?n[3]:1),n[2],n[1],n[0]],o=0;o<4;++o){var i=Math.floor(r[o]).toString(16);r[o]=1==i.length?"0"+i:i}wc(t,r.join(""))}var wm=Hl(ff,{Data:Gl((function(t,e,n){t.setAttribute("name",e.name);var r={node:t},o=e.value;"object"==typeof o?(null!==o&&o.displayName&&Kl(r,wm,Wl,[o.displayName],n,["displayName"]),null!==o&&o.value&&Kl(r,wm,Wl,[o.value],n,["value"])):Kl(r,wm,Wl,[o],n,["value"])})),value:Gl((function(t,e){wc(t,e)})),displayName:Gl((function(t,e){_c(t,e)}))});var Sm=Hl(ff,{Placemark:Gl(Ym)}),bm=function(t,e,n){return xl(e[e.length-1].node.namespaceURI,"Placemark")};var Lm=jl("Data");var Tm=Hl(ff,["href"],Hl(hf,["x","y","w","h"])),Pm=Hl(ff,{href:Gl(wc)},Hl(hf,{x:Gl(Cc),y:Gl(Cc),w:Gl(Cc),h:Gl(Cc)})),Am=function(t,e,n){return xl(hf[0],"gx:"+n)};var Om=Hl(ff,["scale","heading","Icon","color","hotSpot"]),xm=Hl(ff,{Icon:Gl((function(t,e,n){var r={node:t},o=n[n.length-1].node,i=Tm[o.namespaceURI],a=ql(e,i);Kl(r,Pm,Wl,a,n,i),a=ql(e,i=Tm[hf[0]]),Kl(r,Pm,Am,a,n,i)})),color:Gl(Em),heading:Gl(Cc),hotSpot:Gl((function(t,e){t.setAttribute("x",String(e.x)),t.setAttribute("y",String(e.y)),t.setAttribute("xunits",e.xunits),t.setAttribute("yunits",e.yunits)})),scale:Gl(og)});var Im=Hl(ff,["color","scale"]),Mm=Hl(ff,{color:Gl(Em),scale:Gl(og)});var Rm=Hl(ff,["color","width"]),Zm=Hl(ff,{color:Gl(Em),width:Gl(Cc)});var Dm={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},km=function(t,e,n){if(t)return xl(e[e.length-1].node.namespaceURI,Dm[t.getType()])},Nm=jl("Point"),Fm=jl("LineString"),Um=jl("LinearRing"),Gm=jl("Polygon"),Bm=Hl(ff,{LineString:Gl($m),Point:Gl($m),Polygon:Gl(ng),GeometryCollection:Gl(jm)});function jm(t,e,n){var r,o={node:t},i=e.getType(),a=[];i===br.GEOMETRY_COLLECTION?(e.getGeometriesArrayRecursive().forEach((function(t){var e=t.getType();e===br.MULTI_POINT?a=a.concat(t.getPoints()):e===br.MULTI_LINE_STRING?a=a.concat(t.getLineStrings()):e===br.MULTI_POLYGON?a=a.concat(t.getPolygons()):e===br.POINT||e===br.LINE_STRING||e===br.POLYGON?a.push(t):x(!1,39)})),r=km):i===br.MULTI_POINT?(a=e.getPoints(),r=Nm):i===br.MULTI_LINE_STRING?(a=e.getLineStrings(),r=Fm):i===br.MULTI_POLYGON?(a=e.getPolygons(),r=Gm):x(!1,39),Kl(o,Bm,r,a,n)}var Wm=Hl(ff,{LinearRing:Gl($m)});function qm(t,e,n){Kl({node:t},Wm,Um,[e],n)}var Hm=Hl(ff,{ExtendedData:Gl((function(t,e,n){for(var r={node:t},o=e.names,i=e.values,a=o.length,s=0;s<a;s++)Kl(r,wm,Lm,[{name:o[s],value:i[s]}],n)})),MultiGeometry:Gl(jm),LineString:Gl($m),LinearRing:Gl($m),Point:Gl($m),Polygon:Gl(ng),Style:Gl((function(t,e,n){var r={node:t},o={};if(e.pointStyles.length){var i=e.pointStyles[0].getText();i&&(o.LabelStyle=i);var a=e.pointStyles[0].getImage();a&&"function"==typeof a.getSrc&&(o.IconStyle=a)}if(e.lineStyles.length){(s=e.lineStyles[0].getStroke())&&(o.LineStyle=s)}if(e.polyStyles.length){var s;(s=e.polyStyles[0].getStroke())&&!o.LineStyle&&(o.LineStyle=s),o.PolyStyle=e.polyStyles[0]}var l=n[n.length-1].node,c=ig[l.namespaceURI],u=ql(o,c);Kl(r,ag,Wl,u,n,c)})),address:Gl(wc),description:Gl(wc),name:Gl(wc),open:Gl(vc),phoneNumber:Gl(wc),styleUrl:Gl(wc),visibility:Gl(vc)}),Vm=Hl(ff,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),zm=jl("ExtendedData");function Ym(t,e,n){var r={node:t};e.getId()&&t.setAttribute("id",e.getId());var o=e.getProperties(),i={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};i[e.getGeometryName()]=1;var a=Object.keys(o||{}).sort().filter((function(t){return!i[t]})),s=e.getStyleFunction();if(s){var l=s(e,0);if(l){var c=Array.isArray(l)?l:[l],u=c;if(e.getGeometry()&&(u=c.filter((function(t){var n=t.getGeometryFunction()(e);if(n){var r=n.getType();return r===br.GEOMETRY_COLLECTION?n.getGeometriesArrayRecursive().filter((function(t){var e=t.getType();return e===br.POINT||e===br.MULTI_POINT})).length:r===br.POINT||r===br.MULTI_POINT}}))),this.writeStyles_){var p=c,d=c;e.getGeometry()&&(p=c.filter((function(t){var n=t.getGeometryFunction()(e);if(n){var r=n.getType();return r===br.GEOMETRY_COLLECTION?n.getGeometriesArrayRecursive().filter((function(t){var e=t.getType();return e===br.LINE_STRING||e===br.MULTI_LINE_STRING})).length:r===br.LINE_STRING||r===br.MULTI_LINE_STRING}})),d=c.filter((function(t){var n=t.getGeometryFunction()(e);if(n){var r=n.getType();return r===br.GEOMETRY_COLLECTION?n.getGeometriesArrayRecursive().filter((function(t){var e=t.getType();return e===br.POLYGON||e===br.MULTI_POLYGON})).length:r===br.POLYGON||r===br.MULTI_POLYGON}}))),o.Style={pointStyles:u,lineStyles:p,polyStyles:d}}if(u.length&&void 0===o.name){var h=u[0].getText();h&&(o.name=h.getText())}}}var f=n[n.length-1].node,m=Vm[f.namespaceURI],g=ql(o,m);if(Kl(r,Hm,Wl,g,n,m),a.length>0){var y=ql(o,a);Kl(r,Hm,zm,[{names:a,values:y}],n)}var v=n[0],_=e.getGeometry();_&&(_=Pl(_,!0,v)),Kl(r,Hm,km,[_],n)}var Km=Hl(ff,["extrude","tessellate","altitudeMode","coordinates"]),Xm=Hl(ff,{extrude:Gl(vc),tessellate:Gl(vc),altitudeMode:Gl(wc),coordinates:Gl((function(t,e,n){var r,o=n[n.length-1],i=o.layout,a=o.stride;i==Fo.XY||i==Fo.XYM?r=2:i==Fo.XYZ||i==Fo.XYZM?r=3:x(!1,34);var s=e.length,l="";if(s>0){l+=e[0];for(var c=1;c<r;++c)l+=","+e[c];for(var u=a;u<s;u+=a){l+=" "+e[u];for(c=1;c<r;++c)l+=","+e[u+c]}}wc(t,l)}))});function $m(t,e,n){var r=e.getFlatCoordinates(),o={node:t};o.layout=e.getLayout(),o.stride=e.getStride();var i=e.getProperties();i.coordinates=r;var a=n[n.length-1].node,s=Km[a.namespaceURI],l=ql(i,s);Kl(o,Xm,Wl,l,n,s)}var Jm=Hl(ff,["color","fill","outline"]),Qm=Hl(ff,{outerBoundaryIs:Gl(qm),innerBoundaryIs:Gl(qm)}),tg=jl("innerBoundaryIs"),eg=jl("outerBoundaryIs");function ng(t,e,n){var r=e.getLinearRings(),o=r.shift(),i={node:t};Kl(i,Qm,tg,r,n),Kl(i,Qm,eg,[o],n)}var rg=Hl(ff,{color:Gl(Em),fill:Gl(vc),outline:Gl(vc)});function og(t,e){Cc(t,Math.round(1e6*e)/1e6)}var ig=Hl(ff,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),ag=Hl(ff,{IconStyle:Gl((function(t,e,n){var r={node:t},o={},i=e.getSrc(),a=e.getSize(),s=e.getImageSize(),l={href:i};if(a){l.w=a[0],l.h=a[1];var c=e.getAnchor(),u=e.getOrigin();if(u&&s&&0!==u[0]&&u[1]!==a[1]&&(l.x=u[0],l.y=s[1]-(u[1]+a[1])),c&&(c[0]!==a[0]/2||c[1]!==a[1]/2)){var p={x:c[0],xunits:Eh.PIXELS,y:a[1]-c[1],yunits:Eh.PIXELS};o.hotSpot=p}}o.Icon=l;var d=e.getScaleArray()[0],h=a;null===h&&(h=uf),2==h.length&&(d/=If(h)),1!==d&&(o.scale=d);var f=e.getRotation();0!==f&&(o.heading=f);var m=e.getColor();m&&(o.color=m);var g=n[n.length-1].node,y=Om[g.namespaceURI],v=ql(o,y);Kl(r,xm,Wl,v,n,y)})),LabelStyle:Gl((function(t,e,n){var r={node:t},o={},i=e.getFill();i&&(o.color=i.getColor());var a=e.getScale();a&&1!==a&&(o.scale=a);var s=n[n.length-1].node,l=Im[s.namespaceURI],c=ql(o,l);Kl(r,Mm,Wl,c,n,l)})),LineStyle:Gl((function(t,e,n){var r={node:t},o={color:e.getColor(),width:Number(e.getWidth())||1},i=n[n.length-1].node,a=Rm[i.namespaceURI],s=ql(o,a);Kl(r,Zm,Wl,s,n,a)})),PolyStyle:Gl((function(t,e,n){var r={node:t},o=e.getFill(),i=e.getStroke(),a={color:o?o.getColor():void 0,fill:!!o&&void 0,outline:!!i&&void 0},s=n[n.length-1].node,l=Jm[s.namespaceURI],c=ql(a,l);Kl(r,rg,Wl,c,n,l)}))});const sg=Rf;var lg=["http://www.google.com/kml/ext/2.2"],cg=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"];const ug=function(t){for(var e=[],n=[],r=Math.pow(2,t.length),o=0;o<r;o++){n=[];for(var i=0;i<t.length;i++)o&Math.pow(2,i)&&-1==n.indexOf(t[i])&&n.push(t[i]);n.length>0&&-1==e.indexOf(n.join(" "))&&e.push(n.join(" "))}return e}(cg.slice().slice(1));!function(t,e){if(t&&t.length>0)for(var n=0;n<e.length;n++){var r=t.indexOf(e[n]);r>-1&&t.splice(r,1)}}(ug,cg),cg=cg.concat(ug);var pg,dg,hg,fg,mg,gg,yg={fraction:Eh.FRACTION,pixels:Eh.PIXELS,insetPixels:Eh.PIXELS},vg=Hl(cg,{ExtendedData:gy,Region:yy,MultiGeometry:Ul(sy,"geometry"),LineString:Ul(oy,"geometry"),LinearRing:Ul(iy,"geometry"),Point:Ul(ly,"geometry"),Polygon:Ul(uy,"geometry"),Style:Ul(dy),StyleMap:function(t,e){var n=Wg.call(this,t,e);if(!n)return;var r=e[e.length-1];Array.isArray(n)?r.Style=n:"string"==typeof n?r.styleUrl=n:x(!1,38)},address:Ul(yc),description:Ul(yc),name:Ul(yc),open:Ul(uc),phoneNumber:Ul(yc),styleUrl:Ul(Gg),visibility:Ul(uc)},Hl(lg,{MultiTrack:Ul((function(t,e){var n=zl([],$g,t,e);if(!n)return;return new cl(n)}),"geometry"),Track:Ul(Qg,"geometry")})),_g=(Hl(cg,{ExtendedData:gy,Region:yy,Link:function(t,e){Vl(_g,t,e)},address:Ul(yc),description:Ul(yc),name:Ul(yc),open:Ul(uc),phoneNumber:Ul(yc),visibility:Ul(uc)}),Hl(cg,{href:Ul(Ug)})),Cg=Hl(cg,{LatLonAltBox:function(t,e){var n=zl({},Cy,t,e);if(!n)return;var r=e[e.length-1],o=[parseFloat(n.west),parseFloat(n.south),parseFloat(n.east),parseFloat(n.north)];r.extent=o,r.altitudeMode=n.altitudeMode,r.minAltitude=parseFloat(n.minAltitude),r.maxAltitude=parseFloat(n.maxAltitude)},Lod:function(t,e){var n=zl({},Ey,t,e);if(!n)return;var r=e[e.length-1];r.minLodPixels=parseFloat(n.minLodPixels),r.maxLodPixels=parseFloat(n.maxLodPixels),r.minFadeExtent=parseFloat(n.minFadeExtent),r.maxFadeExtent=parseFloat(n.maxFadeExtent)}}),Eg=Hl(cg,["Document","Placemark"]),wg=Hl(cg,{Document:Gl(Oy),Placemark:Gl(Qy)}),Sg=null;var bg,Lg=null;var Tg,Pg=null;var Ag=null;var Og=null;var xg=null;const Ig=function(t,e){var n;return t?(n=(n=Yt(t)).slice(),void 0!==e&&(n[3]=e)):n=[0,0,0,1],n};function Mg(t){return 32/Math.min(t[0],t[1])}function Rg(){pg=[255,255,255,1],Sg=new Ch({color:Ig(TC.Cfg.styles.polygon.fillColor,TC.Cfg.styles.polygon.fillOpacity)}),gg="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",Lg=new Gh({anchor:dg=[20,2],anchorOrigin:wh.BOTTOM_LEFT,anchorXUnits:hg=Eh.PIXELS,anchorYUnits:fg=Eh.PIXELS,crossOrigin:"anonymous",rotation:0,scale:Mg(mg=[64,64]),size:mg,src:gg}),bg="NO_IMAGE",Pg=new Bh({color:pg,width:1}),Tg=new Bh({color:Ig(TC.Cfg.styles.label.strokeColor,1),width:TC.Cfg.styles.label.strokeWidth||1}),Ag=new of({font:"bold 16px Helvetica",fill:new Ch({color:Ig(TC.Cfg.styles.label.fillColor,1)}),stroke:Tg,scale:.8}),Og=new tf({fill:Sg,image:Lg,text:Ag,stroke:Pg,zIndex:0}),xg=[Og]}var Zg;class Dg extends sg{constructor(t){super(),xg||Rg()}}function kg(t,e,n){return Array.isArray(t)?t:"string"==typeof t?kg(n[t],e,n):e}function Ng(t){var e=Il(t,!1),n=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(e);if(n){var r=n[1];return[parseInt(r.substr(6,2),16),parseInt(r.substr(4,2),16),parseInt(r.substr(2,2),16),parseInt(r.substr(0,2),16)/255]}}function Fg(t){var e=Il(t,!1),n=[];e=e.replace(/\s*,\s*/g,",");for(var r,o=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;r=o.exec(e);){var i=parseFloat(r[1]),a=parseFloat(r[2]),s=r[3]?parseFloat(r[3]):0;n.push(i,a,s),e=e.substr(r[0].length)}if(""===e)return n}function Ug(t){var e=Il(t,!1).trim(),n=t.baseURI;return n&&"about:blank"!=n||(n=window.location.href),n?("https:"===location.protocol&&0===n.indexOf("http://")&&(n=n.substr(5)),new URL(e,n).href):e}function Gg(t){var e=Il(t,!1).trim().replace(/^(?!.*#)/,"#"),n=t.baseURI;return n&&"about:blank"!=n||(n=window.location.href),n?new URL(e,n).href:e}function Bg(t){return hc(t)}Dg.prototype.readDocumentOrFolder_=function(t,e){var n=zl([],Hl(cg,{Document:Dl(this.readDocumentOrFolder_,this),Folder:Dl(this.readDocumentOrFolder_,this),Placemark:kl(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),t,e,this);if(n){const e=t.getElementsByTagName("name")[0];let r=e&&(e.innerHTML||e.textContent);return n.forEach((t=>{Array.isArray(t._folders)||(t._folders=[]),r&&t._folders.unshift(r)})),n}},Dg.prototype.readPlacemark_=function(t,e){var n=zl({geometry:null},vg,t,e,this);if(n){var r=new Xs,o=t.getAttribute("id");null!==o&&r.setId(o);var i=e[0],a=n.geometry;if(a&&Pl(a,!1,i),r.setGeometry(a),delete n.geometry,this.extractStyles_){var s=function(t,e,n,r,o){return function(i,a){var s=o,l="",c=[];if(s){var u=i.getGeometry();if(u){var p=u.getType();p===br.GEOMETRY_COLLECTION?(c=u.getGeometriesArrayRecursive().filter((function(t){var e=t.getType();return e===br.POINT||e===br.MULTI_POINT})),s=c.length>0):s=p===br.POINT||p===br.MULTI_POINT}}s&&(l=i.get("name"),(s=s&&!!l)&&l.search(/&[^&]+;/)>-1&&(Zg||(Zg=document.createElement("textarea")),Zg.innerHTML=l,l=Zg.value));var d=n;if(t?d=t:e&&(d=kg(e,n,r)),s){var h=function(t,e){Ag||Rg();var n=[0,0],r="start",o=t.getImage();if(o){var i=o.getSize();if(i&&2==i.length){var a=o.getScaleArray(),s=o.getAnchor();n[0]=a[0]*(i[0]-s[0]),n[1]=a[1]*(i[1]/2-s[1]),r="left"}}var l=t.getText();l?((l=l.clone()).setFont(l.getFont()||Ag.getFont()),l.setScale(l.getScale()||Ag.getScale()),l.setFill(l.getFill()||Ag.getFill()),l.setStroke(l.getStroke()||Tg)):l=Ag.clone();l.setText(e),l.setOffsetX(n[0]),l.setOffsetY(n[1]),l.setTextAlign(r);var c=new tf({image:o,text:l});t._balloon&&(c._balloon=t._balloon);return c}(d[0],l);return c.length>0?(h.setGeometry(new _l(c)),[h,new tf({geometry:d[0].getGeometry(),image:null,fill:d[0].getFill(),stroke:d[0].getStroke(),text:null})].concat(d.slice(1))):h}return d}}(n.Style,n.styleUrl,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);r.setStyle(s)}return delete n.Style,delete n.styleUrl,r.setProperties(n,!0),r}},Dg.prototype.readSharedStyle_=function(t,e){var n=t.getAttribute("id");if(null!==n){var r=dy.call(this,t,e);if(r){var o=void 0,i=t.baseURI;if(i&&"about:blank"!=i||(i=window.location.href),i)o=new URL("#"+n,i).href;else o="#"+n;this.sharedStyles_[o]=r}}},Dg.prototype.readFeaturesFromNode=function(t,e){if(!c(cg,t.namespaceURI))return[];var n,r=t.localName;if("Document"==r||"Folder"==r)return(n=this.readDocumentOrFolder_(t,[this.getReadOptions(t,e)]))||[];if("Placemark"==r){var o=this.readPlacemark_(t,[this.getReadOptions(t,e)]);return o?[o]:[]}if("kml"==r){n=[];for(var i=t.firstElementChild;i;i=i.nextElementSibling){var a=this.readFeaturesFromNode(i,e);a&&d(n,a)}return n.forEach((function(t){t.getId()||t.setId(TC.getUID())})),n}return[]},Dg.prototype.writeFeaturesNode=function(t,e){e=this.adaptOptions(e);var n=xl(cg[4],"kml"),r="http://www.w3.org/2000/xmlns/";n.setAttributeNS(r,"xmlns:gx",lg[0]),n.setAttributeNS(r,"xmlns:xsi",Ol),n.setAttributeNS(Ol,"xsi:schemaLocation","http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd");var o={node:n},i={};const a=[];let s=[];const l=function(t,e,n){if(n>=e._folders.length)t.push(e);else{let r=t.find((t=>t._name===e._folders[n]));r||(r=[],r._name=e._folders[n],t.push(r)),l(r,e,n+1)}};t.forEach((function(t){t._folders?l(s,t,0):a.push(t)})),1===s.length&&(s=s[0]);const c=s._name;Array.isArray(s)||(s=[s]),s=s.concat(a),s._name=c,i.Document=s;var u=Eg[n.namespaceURI],p=ql(i,u);return Kl(o,wg,Wl,p,[e],u,this),n};var jg=Hl(cg,{Pair:function(t,e){var n=zl({},vy,t,e,this);if(!n)return;var r=n.key;if(r&&"normal"==r){var o=n.styleUrl;o&&(e[e.length-1]=o);var i=n.Style;i&&(e[e.length-1]=i)}}});function Wg(t,e){return zl(void 0,jg,t,e,this)}var qg=Hl(cg,{Icon:Ul((function(t,e){var n=zl({},ty,t,e);return n||null})),color:Ul(Ng),heading:Ul(hc),hotSpot:Ul((function(t){var e,n=t.getAttribute("xunits"),r=t.getAttribute("yunits");return e="insetPixels"!==n?"insetPixels"!==r?wh.BOTTOM_LEFT:wh.TOP_LEFT:"insetPixels"!==r?wh.BOTTOM_RIGHT:wh.TOP_RIGHT,{x:parseFloat(t.getAttribute("x")),xunits:yg[n],y:parseFloat(t.getAttribute("y")),yunits:yg[r],origin:e}})),scale:Ul(Bg)});const Hg=Hl(cg,{text:Ul((function(t,e){return ol.asserts.assert(t.nodeType==Node.ELEMENT_NODE),ol.asserts.assert("text"==t.localName),ol.format.xsd.readString(t).trim()}))});var Vg=Hl(cg,{color:Ul(Ng),scale:Ul(Bg)});var zg=Hl(cg,{color:Ul(Ng),width:Ul(hc)});var Yg=Hl(cg,{color:Ul(Ng),fill:Ul(uc),outline:Ul(uc)});var Kg=Hl(cg,{coordinates:Nl(Fg)});function Xg(t,e){return zl(null,Kg,t,e)}var $g=Hl(lg,{Track:kl(Qg)});var Jg=Hl(cg,{when:function(t,e){var n=e[e.length-1].whens,r=Il(t,!1),o=Date.parse(r);n.push(isNaN(o)?0:o)}},Hl(lg,{coord:function(t,e){var n=e[e.length-1].coordinates,r=Il(t,!1),o=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(r);if(o){var i=parseFloat(o[1]),a=parseFloat(o[2]),s=parseFloat(o[3]);n.push([i,a,s])}else n.push([])}}));function Qg(t,e){var n=zl({coordinates:[],whens:[]},Jg,t,e);if(n){for(var r=[],o=n.coordinates,i=n.whens,a=0,s=Math.min(o.length,i.length);a<s;++a)3==o[a].length&&r.push(o[a][0],o[a][1],o[a][2],i[a]);return new al(r,Fo.XYZM)}}var ty=Hl(cg,{href:Ul(Ug)},Hl(lg,{x:Ul(hc),y:Ul(hc),w:Ul(hc),h:Ul(hc)}));var ey=Hl(cg,{coordinates:Nl(Fg)});function ny(t,e){return zl(null,ey,t,e)}var ry=Hl(cg,{extrude:Ul(uc),tessellate:Ul(uc),altitudeMode:Ul(yc)});function oy(t,e){var n=zl({},ry,t,e),r=ny(t,e);if(r){var o=new al(r,Fo.XYZ);return o.setProperties(n,!0),o}}function iy(t,e){var n=zl({},ry,t,e),r=ny(t,e);if(r){var o=new Zi(r,Fo.XYZ,[r.length]);return o.setProperties(n,!0),o}}var ay=Hl(cg,{LineString:kl(oy),LinearRing:kl(iy),MultiGeometry:kl(sy),Point:kl(ly),Polygon:kl(uy)});function sy(t,e){var n,r=zl([],ay,t,e);if(!r)return null;if(0===r.length)return new _l(r);for(var o=!0,i=r[0].getType(),a=1,s=r.length;a<s;++a)if(r[a].getType()!=i){o=!1;break}if(o){var l=void 0,c=void 0;if(i==br.POINT){var u=r[0];l=u.getLayout(),c=u.getFlatCoordinates();for(a=1,s=r.length;a<s;++a)d(c,r[a].getFlatCoordinates());hy(n=new Qs(c,l),r)}else i==br.LINE_STRING?hy(n=new cl(r),r):i==br.POLYGON?hy(n=new dl(r),r):i==br.GEOMETRY_COLLECTION?n=new _l(r):x(!1,37)}else n=new _l(r);return n}function ly(t,e){var n=zl({},ry,t,e),r=ny(t,e);if(r){var o=new _i(r,Fo.XYZ);return o.setProperties(n,!0),o}}var cy=Hl(cg,{innerBoundaryIs:function(t,e){var n=zl([],wy,t,e);if(n.length>0){var r=e[e.length-1];r.push.apply(r,n)}},outerBoundaryIs:function(t,e){var n=zl(void 0,Sy,t,e);if(n){e[e.length-1][0]=n}}});function uy(t,e){var n=zl({},ry,t,e),r=zl([null],cy,t,e);if(r&&r[0]){for(var o=r[0],i=[o.length],a=1,s=r.length;a<s;++a)d(o,r[a]),i.push(o.length);var l=new Zi(o,Fo.XYZ,i);return l.setProperties(n,!0),l}}var py=Hl(cg,{IconStyle:function(t,e){var n=zl({},qg,t,e);if(n){var r,o,i,a,s=e[e.length-1],l="Icon"in n?n.Icon:{},c=!("Icon"in n)||Object.keys(l).length>0,u=l.href;u?r=u:c&&(r=gg);var p,d=wh.BOTTOM_LEFT,h=n.hotSpot;h?(o=[h.x,h.y],i=h.xunits,a=h.yunits,d=h.origin):/^http:\/\/maps\.(?:google|gstatic)\.com\//.test(r)&&(/pushpin/.test(r)?(o=dg,i=hg,a=fg):/arrow-reverse/.test(r)?(o=[54,42],i=hg,a=fg):/paddle/.test(r)&&(o=[32,1],i=hg,a=fg)),c&&/Firefox/.test(navigator.userAgent)&&"https:"===location.protocol&&r.startsWith("http:")&&(r=r.replace("http:","https:"));var f,m=l.x,g=l.y;void 0!==m&&void 0!==g&&(p=[m,g]);var y,v=l.w,_=l.h;void 0!==v&&void 0!==_&&(f=[v,_]);var C=n.heading;void 0!==C&&(y=kt(C));var E=n.scale,w=n.color;if(c){r==gg&&(f=mg);var S=new Gh({anchor:o,anchorOrigin:d,anchorXUnits:i,anchorYUnits:a,crossOrigin:this.crossOrigin_,offset:p,offsetOrigin:wh.BOTTOM_LEFT,rotation:y,scale:E,size:f,src:this.iconUrlFunction_(r),color:w}),b=S.getScaleArray()[0],L=S.getSize();if(null===L){var T=S.getImageState();if(T===Sh||T===bh){var P=function(){var t=S.getImageState();if(t!==Sh&&t!==bh){var e=S.getSize();if(e&&2==e.length){var n=Mg(e);S.setScale(b*n)}S.unlistenImageChange(P)}};S.listenImageChange(P),T===Sh&&S.load()}}else if(2==L.length){var A=Mg(L);S.setScale(b*A)}s.imageStyle=S}else s.imageStyle=bg}},LabelStyle:function(t,e){var n=zl({},Vg,t,e);if(n){var r=e[e.length-1],o=new of({fill:new Ch({color:"color"in n?n.color:pg}),scale:n.scale});r.textStyle=o}},LineStyle:function(t,e){var n=zl({},zg,t,e);if(n){var r=e[e.length-1],o=new Bh({color:"color"in n?n.color:pg,width:"width"in n?n.width:1});r.strokeStyle=o}},PolyStyle:function(t,e){var n=zl({},Yg,t,e);if(n){var r=e[e.length-1],o=new Ch({color:"color"in n?n.color:pg});r.fillStyle=o;var i=n.fill;void 0!==i&&(r.fill=i);var a=n.outline;void 0!==a&&(r.outline=a)}},BalloonStyle:function(t,e){ol.asserts.assert(t.nodeType==Node.ELEMENT_NODE),ol.asserts.assert("BalloonStyle"==t.localName);var n=ol.xml.pushParseAndPop({},Hg,t,e);if(!n)return;const r=e[e.length-1],o=typeof r;ol.asserts.assert("object"==o&&null!=r||"function"==o);var i=new ol.style.Text({text:n.text});r.balloonStyle=i}});function dy(t,e){var n=zl({},py,t,e,this);if(!n)return null;var r,o="fillStyle"in n?n.fillStyle:Sg,i=n.fill;void 0===i||i||(o=null),"imageStyle"in n?n.imageStyle!=bg&&(r=n.imageStyle):r=Lg;var a="textStyle"in n?n.textStyle:Ag,s="strokeStyle"in n?n.strokeStyle:Pg;let l;var c=n.outline;l=void 0===c||c?[new tf({fill:o,image:r,stroke:s,text:a,zIndex:void 0})]:[new tf({geometry:function(t){var e=t.getGeometry(),n=e.getType();return n===br.GEOMETRY_COLLECTION?new _l(e.getGeometriesArrayRecursive().filter((function(t){var e=t.getType();return e!==br.POLYGON&&e!==br.MULTI_POLYGON}))):n!==br.POLYGON&&n!==br.MULTI_POLYGON?e:void 0},fill:o,image:r,stroke:s,text:a,zIndex:void 0}),new tf({geometry:function(t){var e=t.getGeometry(),n=e.getType();return n===br.GEOMETRY_COLLECTION?new _l(e.getGeometriesArrayRecursive().filter((function(t){var e=t.getType();return e===br.POLYGON||e===br.MULTI_POLYGON}))):n===br.POLYGON||n===br.MULTI_POLYGON?e:void 0},fill:o,stroke:null,zIndex:void 0})];const u=n.balloonStyle;return u&&l.forEach((t=>t._balloon=u)),l}function hy(t,e){var n,r,o,i=e.length,a=new Array(e.length),s=new Array(e.length),l=new Array(e.length);n=!1,r=!1,o=!1;for(var c=0;c<i;++c){var u=e[c];a[c]=u.get("extrude"),s[c]=u.get("tessellate"),l[c]=u.get("altitudeMode"),n=n||void 0!==a[c],r=r||void 0!==s[c],o=o||l[c]}n&&t.set("extrude",a),r&&t.set("tessellate",s),o&&t.set("altitudeMode",l)}var fy=Hl(cg,{displayName:Ul(yc),value:Ul(yc)});var my=Hl(cg,{Data:function(t,e){var n=t.getAttribute("name");Vl(fy,t,e);var r=e[e.length-1];n&&r.displayName?r[n]={value:r.value,displayName:r.displayName,toString:function(){return r.value}}:null!==n?r[n]=r.value:null!==r.displayName&&(r[r.displayName]=r.value),delete r.value},SchemaData:function(t,e){Vl(_y,t,e)}});function gy(t,e){Vl(my,t,e)}function yy(t,e){Vl(Cg,t,e)}var vy=Hl(cg,{Style:Ul(dy),key:Ul(yc),styleUrl:Ul(Gg)});var _y=Hl(cg,{SimpleData:function(t,e){var n=t.getAttribute("name");if(null!==n){var r=yc(t);e[e.length-1][n]=r}}});var Cy=Hl(cg,{altitudeMode:Ul(yc),minAltitude:Ul(hc),maxAltitude:Ul(hc),north:Ul(hc),south:Ul(hc),east:Ul(hc),west:Ul(hc)});var Ey=Hl(cg,{minLodPixels:Ul(hc),maxLodPixels:Ul(hc),minFadeExtent:Ul(hc),maxFadeExtent:Ul(hc)});var wy=Hl(cg,{LinearRing:kl(Xg)});var Sy=Hl(cg,{LinearRing:Nl(Xg)});function by(t,e){for(var n=Yt(e),r=[255*(4==n.length?n[3]:1),n[2],n[1],n[0]],o=0;o<4;++o){var i=Math.floor(r[o]).toString(16);r[o]=1==i.length?"0"+i:i}wc(t,r.join(""))}var Ly=Hl(cg,{Data:Gl((function(t,e,n){t.setAttribute("name",e.name);var r={node:t},o=e.value;"object"==typeof o?(null!==o&&o.displayName&&Kl(r,Ly,Wl,[o.displayName],n,["displayName"]),null!==o&&o.value&&Kl(r,Ly,Wl,[o.value],n,["value"])):Kl(r,Ly,Wl,[o],n,["value"])})),value:Gl((function(t,e){wc(t,e)})),displayName:Gl((function(t,e){_c(t,e)}))});var Ty=Hl(cg,["name"]),Py=Hl(cg,{Placemark:Gl(Qy),Document:Gl(Oy),Folder:Gl(Oy),name:Gl(wc)}),Ay=function(t,e,n){var r=e[e.length-1].node;return Array.isArray(t)?xl(r.namespaceURI,"Folder"):xl(r.namespaceURI,"string"==typeof t?"name":"Placemark")};function Oy(t,e,n){var r={node:t};if(e._name){var o={name:e._name},i=n[n.length-1].node,a=Ty[i.namespaceURI],s=ql(o,a);Kl(r,Py,Ay,s,n,a)}Kl(r,Py,Ay,e,n,void 0,this)}var xy=jl("Data");var Iy=Hl(cg,["href"],Hl(lg,["x","y","w","h"])),My=Hl(cg,{href:Gl(wc)},Hl(lg,{x:Gl(Cc),y:Gl(Cc),w:Gl(Cc),h:Gl(Cc)})),Ry=function(t,e,n){return xl(lg[0],"gx:"+n)};var Zy=Hl(cg,["scale","heading","Icon","color","hotSpot"]),Dy=Hl(cg,{Icon:Gl((function(t,e,n){var r={node:t},o=n[n.length-1].node,i=Iy[o.namespaceURI],a=ql(e,i);Kl(r,My,Wl,a,n,i),a=ql(e,i=Iy[lg[0]]),Kl(r,My,Ry,a,n,i)})),color:Gl(by),heading:Gl(Cc),hotSpot:Gl((function(t,e){t.setAttribute("x",String(e.x)),t.setAttribute("y",String(e.y)),t.setAttribute("xunits",e.xunits),t.setAttribute("yunits",e.yunits)})),scale:Gl(cv)});var ky=Hl(cg,["color","scale"]),Ny=Hl(cg,{color:Gl(by),scale:Gl(cv)});var Fy=Hl(cg,["color","width"]),Uy=Hl(cg,{color:Gl(by),width:Gl(Cc)});var Gy={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},By=function(t,e,n){if(t)return xl(e[e.length-1].node.namespaceURI,Gy[t.getType()])},jy=jl("Point"),Wy=jl("LineString"),qy=jl("LinearRing"),Hy=jl("Polygon"),Vy=Hl(cg,{LineString:Gl(nv),Point:Gl(nv),Polygon:Gl(sv),GeometryCollection:Gl(zy)});function zy(t,e,n){var r,o={node:t},i=e.getType(),a=[];i===br.GEOMETRY_COLLECTION?(e.getGeometriesArrayRecursive().forEach((function(t){var e=t.getType();e===br.MULTI_POINT?a=a.concat(t.getPoints()):e===br.MULTI_LINE_STRING?a=a.concat(t.getLineStrings()):e===br.MULTI_POLYGON?a=a.concat(t.getPolygons()):e===br.POINT||e===br.LINE_STRING||e===br.POLYGON?a.push(t):x(!1,39)})),r=By):i===br.MULTI_POINT?(a=e.getPoints(),r=jy):i===br.MULTI_LINE_STRING?(a=e.getLineStrings(),r=Wy):i===br.MULTI_POLYGON?(a=e.getPolygons(),r=Hy):x(!1,39),Kl(o,Vy,r,a,n)}var Yy=Hl(cg,{LinearRing:Gl(nv)});function Ky(t,e,n){Kl({node:t},Yy,qy,[e],n)}var Xy=Hl(cg,{ExtendedData:Gl((function(t,e,n){for(var r={node:t},o=e.names,i=e.values,a=o.length,s=0;s<a;s++)Kl(r,Ly,xy,[{name:o[s],value:i[s]}],n)})),MultiGeometry:Gl(zy),LineString:Gl(nv),LinearRing:Gl(nv),Point:Gl(nv),Polygon:Gl(sv),Style:Gl((function(t,e,n){var r={node:t},o={};if(e.pointStyles.length){var i=e.pointStyles[0].getText();i&&(o.LabelStyle=i);var a=e.pointStyles[0].getImage();a&&"function"==typeof a.getSrc&&(o.IconStyle=a);var s=e.pointStyles[0]._balloon;s&&(o.BalloonStyle=s)}if(e.lineStyles.length){(l=e.lineStyles[0].getStroke())&&(o.LineStyle=l)}if(e.polyStyles.length){var l;(l=e.polyStyles[0].getStroke())&&!o.LineStyle&&(o.LineStyle=l),o.PolyStyle=e.polyStyles[0]}var c=n[n.length-1].node,u=uv[c.namespaceURI],p=ql(o,u);Kl(r,pv,Wl,p,n,u)})),address:Gl(wc),description:Gl(wc),name:Gl(wc),open:Gl(vc),phoneNumber:Gl(wc),styleUrl:Gl(wc),visibility:Gl(vc)}),$y=Hl(cg,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),Jy=jl("ExtendedData");function Qy(t,e,n){var r={node:t};e.getId()&&t.setAttribute("id",e.getId());var o=e.getProperties(),i={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};i[e.getGeometryName()]=1;var a=Object.keys(o||{}).filter((function(t){return!i[t]})),s=e.getStyleFunction();if(s){var l=s(e,0);if(l){var c=Array.isArray(l)?l:[l],u=c;if(e.getGeometry()&&(u=c.filter((function(t){var n=t.getGeometryFunction()(e);if(n){var r=n.getType();return r===br.GEOMETRY_COLLECTION?n.getGeometriesArrayRecursive().filter((function(t){var e=t.getType();return e===br.POINT||e===br.MULTI_POINT})).length:r===br.POINT||r===br.MULTI_POINT}}))),this.writeStyles_){var p=c,d=c;e.getGeometry()&&(p=c.filter((function(t){var n=t.getGeometryFunction()(e);if(n){var r=n.getType();return r===br.GEOMETRY_COLLECTION?n.getGeometriesArrayRecursive().filter((function(t){var e=t.getType();return e===br.LINE_STRING||e===br.MULTI_LINE_STRING})).length:r===br.LINE_STRING||r===br.MULTI_LINE_STRING}})),d=c.filter((function(t){var n=t.getGeometryFunction()(e);if(n){var r=n.getType();return r===br.GEOMETRY_COLLECTION?n.getGeometriesArrayRecursive().filter((function(t){var e=t.getType();return e===br.POLYGON||e===br.MULTI_POLYGON})).length:r===br.POLYGON||r===br.MULTI_POLYGON}}))),o.Style={pointStyles:u,lineStyles:p,polyStyles:d}}if(u.length&&void 0===o.name){var h=u[0].getText();h&&(o.name=h.getText())}}}var f=n[n.length-1].node,m=$y[f.namespaceURI],g=ql(o,m);if(Kl(r,Xy,Wl,g,n,m),a.length>0){var y=ql(o,a);Kl(r,Xy,Jy,[{names:a,values:y}],n)}var v=n[0],_=e.getGeometry();_&&(_=Pl(_,!0,v)),Kl(r,Xy,By,[_],n)}var tv=Hl(cg,["extrude","tessellate","altitudeMode","coordinates"]),ev=Hl(cg,{extrude:Gl(vc),tessellate:Gl(vc),altitudeMode:Gl(wc),coordinates:Gl((function(t,e,n){var r,o=n[n.length-1],i=o.layout,a=o.stride;i==Fo.XY||i==Fo.XYM?r=2:i==Fo.XYZ||i==Fo.XYZM?r=3:x(!1,34);var s=e.length,l="";if(s>0){l+=e[0];for(var c=1;c<r;++c)l+=","+e[c];for(var u=a;u<s;u+=a){l+=" "+e[u];for(c=1;c<r;++c)l+=","+e[u+c]}}wc(t,l)}))});function nv(t,e,n){var r=e.getFlatCoordinates(),o={node:t};o.layout=e.getLayout(),o.stride=e.getStride();var i=e.getProperties();i.coordinates=r;var a=n[n.length-1].node,s=tv[a.namespaceURI],l=ql(i,s);Kl(o,ev,Wl,l,n,s)}var rv=Hl(cg,["color","fill","outline"]),ov=Hl(cg,{outerBoundaryIs:Gl(Ky),innerBoundaryIs:Gl(Ky)}),iv=jl("innerBoundaryIs"),av=jl("outerBoundaryIs");function sv(t,e,n){var r=e.getLinearRings(),o=r.shift(),i={node:t};Kl(i,ov,iv,r,n),Kl(i,ov,av,[o],n)}var lv=Hl(cg,{color:Gl(by),fill:Gl(vc),outline:Gl(vc)});function cv(t,e){Cc(t,Math.round(1e6*e)/1e6)}var uv=Hl(cg,["IconStyle","LabelStyle","LineStyle","PolyStyle","BalloonStyle"]),pv=Hl(cg,{IconStyle:Gl((function(t,e,n){var r={node:t},o={},i=e.getSrc(),a=e.getSize(),s=e.getImageSize(),l={href:i};if(a){l.w=a[0],l.h=a[1];var c=e.getAnchor(),u=e.getOrigin();if(u&&s&&0!==u[0]&&u[1]!==a[1]&&(l.x=u[0],l.y=s[1]-(u[1]+a[1])),c&&(c[0]!==a[0]/2||c[1]!==a[1]/2)){var p={x:c[0],xunits:Eh.PIXELS,y:a[1]-c[1],yunits:Eh.PIXELS};o.hotSpot=p}}o.Icon=l;var d=e.getScaleArray()[0],h=a;null===h&&(mg||Rg(),h=mg),2==h.length&&(d/=Mg(h)),1!==d&&(o.scale=d);var f=e.getRotation();0!==f&&(o.heading=f*(180/Math.PI));var m=e.getColor();m&&(o.color=m);var g=n[n.length-1].node,y=Zy[g.namespaceURI],v=ql(o,y);Kl(r,Dy,Wl,v,n,y)})),LabelStyle:Gl((function(t,e,n){var r={node:t},o={},i=e.getFill();i&&(o.color=i.getColor());var a=e.getScale();a&&1!==a&&(o.scale=a);var s=n[n.length-1].node,l=ky[s.namespaceURI],c=ql(o,l);Kl(r,Ny,Wl,c,n,l)})),LineStyle:Gl((function(t,e,n){var r={node:t},o={color:e.getColor(),width:Number(e.getWidth())||1},i=n[n.length-1].node,a=Fy[i.namespaceURI],s=ql(o,a);Kl(r,Uy,Wl,s,n,a)})),PolyStyle:Gl((function(t,e,n){var r={node:t},o=e.getFill(),i=e.getStroke(),a={color:o?o.getColor():void 0,fill:!!o&&void 0,outline:!!i&&void 0},s=n[n.length-1].node,l=rv[s.namespaceURI],c=ql(a,l);Kl(r,lv,Wl,c,n,l)})),BalloonStyle:Gl(((t,e)=>{const n=Jl().createCDATASection(e.getText()),r=Jl().createElement("text");r.appendChild(n),t.appendChild(r)}))});const dv=Dg;var hv=n(6656),fv=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),mv="renderOrder";const gv=function(t){function e(e){var n=this,r=e||{},o=oe({},r);return delete o.style,delete o.renderBuffer,delete o.updateWhileAnimating,delete o.updateWhileInteracting,(n=t.call(this,o)||this).declutter_=void 0!==r.declutter&&r.declutter,n.renderBuffer_=void 0!==r.renderBuffer?r.renderBuffer:100,n.style_=null,n.styleFunction_=void 0,n.setStyle(r.style),n.updateWhileAnimating_=void 0!==r.updateWhileAnimating&&r.updateWhileAnimating,n.updateWhileInteracting_=void 0!==r.updateWhileInteracting&&r.updateWhileInteracting,n}return fv(e,t),e.prototype.getDeclutter=function(){return this.declutter_},e.prototype.getFeatures=function(e){return t.prototype.getFeatures.call(this,e)},e.prototype.getRenderBuffer=function(){return this.renderBuffer_},e.prototype.getRenderOrder=function(){return this.get(mv)},e.prototype.getStyle=function(){return this.style_},e.prototype.getStyleFunction=function(){return this.styleFunction_},e.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},e.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},e.prototype.renderDeclutter=function(t){t.declutterTree||(t.declutterTree=new hv(9)),this.getRenderer().renderDeclutter(t)},e.prototype.setRenderOrder=function(t){this.set(mv,t)},e.prototype.setStyle=function(t){this.style_=void 0!==t?t:$h,this.styleFunction_=null===t?void 0:function(t){var e;if("function"==typeof t)e=t;else{var n;Array.isArray(t)?n=t:(x("function"==typeof t.getZIndex,41),n=[t]),e=function(){return n}}return e}(this.style_),this.changed()},e}(Ue);var yv={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},vv=[yv.FILL],_v=[yv.STROKE],Cv=[yv.BEGIN_PATH],Ev=[yv.CLOSE_PATH];const wv=yv;const Sv=function(){function t(){}return t.prototype.drawCustom=function(t,e,n,r){},t.prototype.drawGeometry=function(t){},t.prototype.setStyle=function(t){},t.prototype.drawCircle=function(t,e){},t.prototype.drawFeature=function(t,e){},t.prototype.drawGeometryCollection=function(t,e){},t.prototype.drawLineString=function(t,e){},t.prototype.drawMultiLineString=function(t,e){},t.prototype.drawMultiPoint=function(t,e){},t.prototype.drawMultiPolygon=function(t,e){},t.prototype.drawPoint=function(t,e){},t.prototype.drawPolygon=function(t,e){},t.prototype.drawText=function(t,e){},t.prototype.setFillStrokeStyle=function(t,e){},t.prototype.setImageStyle=function(t,e){},t.prototype.setTextStyle=function(t,e){},t}();var bv=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Lv=function(t){function e(e,n,r,o){var i=t.call(this)||this;return i.tolerance=e,i.maxExtent=n,i.pixelRatio=o,i.maxLineWidth=0,i.resolution=r,i.beginGeometryInstruction1_=null,i.beginGeometryInstruction2_=null,i.bufferedMaxExtent_=null,i.instructions=[],i.coordinates=[],i.tmpCoordinate_=[],i.hitDetectionInstructions=[],i.state={},i}return bv(e,t),e.prototype.applyPixelRatio=function(t){var e=this.pixelRatio;return 1==e?t:t.map((function(t){return t*e}))},e.prototype.appendFlatPointCoordinates=function(t,e){for(var n=this.getBufferedMaxExtent(),r=this.tmpCoordinate_,o=this.coordinates,i=o.length,a=0,s=t.length;a<s;a+=e)r[0]=t[a],r[1]=t[a+1],et(n,r)&&(o[i++]=r[0],o[i++]=r[1]);return i},e.prototype.appendFlatLineCoordinates=function(t,e,n,r,o,i){var a=this.coordinates,s=a.length,l=this.getBufferedMaxExtent();i&&(e+=r);var c,u,p,d=t[e],h=t[e+1],f=this.tmpCoordinate_,m=!0;for(c=e+r;c<n;c+=r)f[0]=t[c],f[1]=t[c+1],(p=ot(l,f))!==u?(m&&(a[s++]=d,a[s++]=h,m=!1),a[s++]=f[0],a[s++]=f[1]):p===V?(a[s++]=f[0],a[s++]=f[1],m=!1):m=!0,d=f[0],h=f[1],u=p;return(o&&m||c===e+r)&&(a[s++]=d,a[s++]=h),s},e.prototype.drawCustomCoordinates_=function(t,e,n,r,o){for(var i=0,a=n.length;i<a;++i){var s=n[i],l=this.appendFlatLineCoordinates(t,e,s,r,!1,!1);o.push(l),e=s}return e},e.prototype.drawCustom=function(t,e,n,r){this.beginGeometry(t,e);var o,i,a,s,l,c=t.getType(),u=t.getStride(),p=this.coordinates.length;switch(c){case br.MULTI_POLYGON:o=t.getOrientedFlatCoordinates(),s=[];var d=t.getEndss();l=0;for(var h=0,f=d.length;h<f;++h){var m=[];l=this.drawCustomCoordinates_(o,l,d[h],u,m),s.push(m)}this.instructions.push([wv.CUSTOM,p,s,t,n,pi]),this.hitDetectionInstructions.push([wv.CUSTOM,p,s,t,r||n,pi]);break;case br.POLYGON:case br.MULTI_LINE_STRING:a=[],o=c==br.POLYGON?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),l=this.drawCustomCoordinates_(o,0,t.getEnds(),u,a),this.instructions.push([wv.CUSTOM,p,a,t,n,ui]),this.hitDetectionInstructions.push([wv.CUSTOM,p,a,t,r||n,ui]);break;case br.LINE_STRING:case br.CIRCLE:o=t.getFlatCoordinates(),i=this.appendFlatLineCoordinates(o,0,o.length,u,!1,!1),this.instructions.push([wv.CUSTOM,p,i,t,n,ci]),this.hitDetectionInstructions.push([wv.CUSTOM,p,i,t,r||n,ci]);break;case br.MULTI_POINT:o=t.getFlatCoordinates(),(i=this.appendFlatPointCoordinates(o,u))>p&&(this.instructions.push([wv.CUSTOM,p,i,t,n,ci]),this.hitDetectionInstructions.push([wv.CUSTOM,p,i,t,r||n,ci]));break;case br.POINT:o=t.getFlatCoordinates(),this.coordinates.push(o[0],o[1]),i=this.coordinates.length,this.instructions.push([wv.CUSTOM,p,i,t,n]),this.hitDetectionInstructions.push([wv.CUSTOM,p,i,t,r||n])}this.endGeometry(e)},e.prototype.beginGeometry=function(t,e){this.beginGeometryInstruction1_=[wv.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[wv.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},e.prototype.finish=function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}},e.prototype.reverseHitDetectionInstructions=function(){var t,e=this.hitDetectionInstructions;e.reverse();var n,r,o=e.length,i=-1;for(t=0;t<o;++t)(r=(n=e[t])[0])==wv.END_GEOMETRY?i=t:r==wv.BEGIN_GEOMETRY&&(n[2]=t,p(this.hitDetectionInstructions,i,t),i=-1)},e.prototype.setFillStrokeStyle=function(t,e){var n=this.state;if(t){var r=t.getColor();n.fillStyle=jh(r||_n)}else n.fillStyle=void 0;if(e){var o=e.getColor();n.strokeStyle=jh(o||Sn);var i=e.getLineCap();n.lineCap=void 0!==i?i:Cn;var a=e.getLineDash();n.lineDash=a?a.slice():En;var s=e.getLineDashOffset();n.lineDashOffset=s||0;var l=e.getLineJoin();n.lineJoin=void 0!==l?l:wn;var c=e.getWidth();n.lineWidth=void 0!==c?c:1;var u=e.getMiterLimit();n.miterLimit=void 0!==u?u:10,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0},e.prototype.createFill=function(t){var e=t.fillStyle,n=[wv.SET_FILL_STYLE,e];return"string"!=typeof e&&n.push(!0),n},e.prototype.applyStroke=function(t){this.instructions.push(this.createStroke(t))},e.prototype.createStroke=function(t){return[wv.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]},e.prototype.updateFillStyle=function(t,e){var n=t.fillStyle;"string"==typeof n&&t.currentFillStyle==n||(void 0!==n&&this.instructions.push(e.call(this,t)),t.currentFillStyle=n)},e.prototype.updateStrokeStyle=function(t,e){var n=t.strokeStyle,r=t.lineCap,o=t.lineDash,i=t.lineDashOffset,a=t.lineJoin,s=t.lineWidth,l=t.miterLimit;(t.currentStrokeStyle!=n||t.currentLineCap!=r||o!=t.currentLineDash&&!f(t.currentLineDash,o)||t.currentLineDashOffset!=i||t.currentLineJoin!=a||t.currentLineWidth!=s||t.currentMiterLimit!=l)&&(void 0!==n&&e.call(this,t),t.currentStrokeStyle=n,t.currentLineCap=r,t.currentLineDash=o,t.currentLineDashOffset=i,t.currentLineJoin=a,t.currentLineWidth=s,t.currentMiterLimit=l)},e.prototype.endGeometry=function(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var e=[wv.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)},e.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Q(this.maxExtent),this.maxLineWidth>0)){var t=this.resolution*(this.maxLineWidth+1)/2;J(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},e}(Sv);const Tv=Lv;var Pv=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const Av=function(t){function e(e,n,r,o){var i=t.call(this,e,n,r,o)||this;return i.hitDetectionImage_=null,i.image_=null,i.imagePixelRatio_=void 0,i.anchorX_=void 0,i.anchorY_=void 0,i.height_=void 0,i.opacity_=void 0,i.originX_=void 0,i.originY_=void 0,i.rotateWithView_=void 0,i.rotation_=void 0,i.scale_=void 0,i.width_=void 0,i.declutterImageWithText_=void 0,i}return Pv(e,t),e.prototype.drawPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var n=t.getFlatCoordinates(),r=t.getStride(),o=this.coordinates.length,i=this.appendFlatPointCoordinates(n,r);this.instructions.push([wv.DRAW_IMAGE,o,i,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([wv.DRAW_IMAGE,o,i,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(e)}},e.prototype.drawMultiPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var n=t.getFlatCoordinates(),r=t.getStride(),o=this.coordinates.length,i=this.appendFlatPointCoordinates(n,r);this.instructions.push([wv.DRAW_IMAGE,o,i,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([wv.DRAW_IMAGE,o,i,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(e)}},e.prototype.finish=function(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,t.prototype.finish.call(this)},e.prototype.setImageStyle=function(t,e){var n=t.getAnchor(),r=t.getSize(),o=t.getHitDetectionImage(),i=t.getImage(this.pixelRatio),a=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=o,this.image_=i,this.height_=r[1],this.opacity_=t.getOpacity(),this.originX_=a[0]*this.imagePixelRatio_,this.originY_=a[1]*this.imagePixelRatio_,this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=r[0],this.declutterImageWithText_=e},e}(Tv);var Ov=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),xv=function(t){function e(e,n,r,o){return t.call(this,e,n,r,o)||this}return Ov(e,t),e.prototype.drawFlatCoordinates_=function(t,e,n,r){var o=this.coordinates.length,i=this.appendFlatLineCoordinates(t,e,n,r,!1,!1),a=[wv.MOVE_TO_LINE_TO,o,i];return this.instructions.push(a),this.hitDetectionInstructions.push(a),n},e.prototype.drawLineString=function(t,e){var n=this.state,r=n.strokeStyle,o=n.lineWidth;if(void 0!==r&&void 0!==o){this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([wv.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,En,0],Cv);var i=t.getFlatCoordinates(),a=t.getStride();this.drawFlatCoordinates_(i,0,i.length,a),this.hitDetectionInstructions.push(_v),this.endGeometry(e)}},e.prototype.drawMultiLineString=function(t,e){var n=this.state,r=n.strokeStyle,o=n.lineWidth;if(void 0!==r&&void 0!==o){this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([wv.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset],Cv);for(var i=t.getEnds(),a=t.getFlatCoordinates(),s=t.getStride(),l=0,c=0,u=i.length;c<u;++c)l=this.drawFlatCoordinates_(a,l,i[c],s);this.hitDetectionInstructions.push(_v),this.endGeometry(e)}},e.prototype.finish=function(){var e=this.state;return null!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&this.instructions.push(_v),this.reverseHitDetectionInstructions(),this.state=null,t.prototype.finish.call(this)},e.prototype.applyStroke=function(e){null!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(_v),e.lastStroke=this.coordinates.length),e.lastStroke=0,t.prototype.applyStroke.call(this,e),this.instructions.push(Cv)},e}(Tv);const Iv=xv;var Mv=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Rv=function(t){function e(e,n,r,o){return t.call(this,e,n,r,o)||this}return Mv(e,t),e.prototype.drawFlatCoordinatess_=function(t,e,n,r){var o=this.state,i=void 0!==o.fillStyle,a=void 0!==o.strokeStyle,s=n.length;this.instructions.push(Cv),this.hitDetectionInstructions.push(Cv);for(var l=0;l<s;++l){var c=n[l],u=this.coordinates.length,p=this.appendFlatLineCoordinates(t,e,c,r,!0,!a),d=[wv.MOVE_TO_LINE_TO,u,p];this.instructions.push(d),this.hitDetectionInstructions.push(d),a&&(this.instructions.push(Ev),this.hitDetectionInstructions.push(Ev)),e=c}return i&&(this.instructions.push(vv),this.hitDetectionInstructions.push(vv)),a&&(this.instructions.push(_v),this.hitDetectionInstructions.push(_v)),e},e.prototype.drawCircle=function(t,e){var n=this.state,r=n.fillStyle,o=n.strokeStyle;if(void 0!==r||void 0!==o){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==n.fillStyle&&this.hitDetectionInstructions.push([wv.SET_FILL_STYLE,_n]),void 0!==n.strokeStyle&&this.hitDetectionInstructions.push([wv.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);var i=t.getFlatCoordinates(),a=t.getStride(),s=this.coordinates.length;this.appendFlatLineCoordinates(i,0,i.length,a,!1,!1);var l=[wv.CIRCLE,s];this.instructions.push(Cv,l),this.hitDetectionInstructions.push(Cv,l),void 0!==n.fillStyle&&(this.instructions.push(vv),this.hitDetectionInstructions.push(vv)),void 0!==n.strokeStyle&&(this.instructions.push(_v),this.hitDetectionInstructions.push(_v)),this.endGeometry(e)}},e.prototype.drawPolygon=function(t,e){var n=this.state,r=n.fillStyle,o=n.strokeStyle;if(void 0!==r||void 0!==o){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==n.fillStyle&&this.hitDetectionInstructions.push([wv.SET_FILL_STYLE,_n]),void 0!==n.strokeStyle&&this.hitDetectionInstructions.push([wv.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);var i=t.getEnds(),a=t.getOrientedFlatCoordinates(),s=t.getStride();this.drawFlatCoordinatess_(a,0,i,s),this.endGeometry(e)}},e.prototype.drawMultiPolygon=function(t,e){var n=this.state,r=n.fillStyle,o=n.strokeStyle;if(void 0!==r||void 0!==o){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==n.fillStyle&&this.hitDetectionInstructions.push([wv.SET_FILL_STYLE,_n]),void 0!==n.strokeStyle&&this.hitDetectionInstructions.push([wv.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);for(var i=t.getEndss(),a=t.getOrientedFlatCoordinates(),s=t.getStride(),l=0,c=0,u=i.length;c<u;++c)l=this.drawFlatCoordinatess_(a,l,i[c],s);this.endGeometry(e)}},e.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var e=this.tolerance;if(0!==e)for(var n=this.coordinates,r=0,o=n.length;r<o;++r)n[r]=ai(n[r],e);return t.prototype.finish.call(this)},e.prototype.setFillStrokeStyles_=function(){var t=this.state;void 0!==t.fillStyle&&this.updateFillStyle(t,this.createFill),void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)},e}(Tv);const Zv=Rv;function Dv(t,e,n,r,o){var i,a,s,l,c,u,p,d,h,f=n,m=n,g=0,y=0,v=n;for(i=n;i<r;i+=o){var _=e[i],C=e[i+1];void 0!==l&&(d=_-l,h=C-c,s=Math.sqrt(d*d+h*h),void 0!==u&&(y+=a,Math.acos((u*d+p*h)/(a*s))>t&&(y>g&&(g=y,f=v,m=i),y=0,v=i-o)),a=s,u=d,p=h),l=_,c=C}return(y+=s)>g?[v,i]:[f,m]}var kv=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Nv={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},Fv=function(t){function e(e,n,r,o){var i=t.call(this,e,n,r,o)||this;return i.labels_=null,i.text_="",i.textOffsetX_=0,i.textOffsetY_=0,i.textRotateWithView_=void 0,i.textRotation_=0,i.textFillState_=null,i.fillStates={},i.textStrokeState_=null,i.strokeStates={},i.textState_={},i.textStates={},i.textKey_="",i.fillKey_="",i.strokeKey_="",i.declutterImageWithText_=void 0,i}return kv(e,t),e.prototype.finish=function(){var e=t.prototype.finish.call(this);return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e},e.prototype.drawText=function(t,e){var n=this.textFillState_,r=this.textStrokeState_,o=this.textState_;if(""!==this.text_&&o&&(n||r)){var i=this.coordinates,a=i.length,s=t.getType(),l=null,c=t.getStride();if(o.placement!==nf||s!=br.LINE_STRING&&s!=br.MULTI_LINE_STRING&&s!=br.POLYGON&&s!=br.MULTI_POLYGON){var u=o.overflow?null:[];switch(s){case br.POINT:case br.MULTI_POINT:l=t.getFlatCoordinates();break;case br.LINE_STRING:l=t.getFlatMidpoint();break;case br.CIRCLE:l=t.getCenter();break;case br.MULTI_LINE_STRING:l=t.getFlatMidpoints(),c=2;break;case br.POLYGON:l=t.getFlatInteriorPoint(),o.overflow||u.push(l[2]/this.resolution),c=3;break;case br.MULTI_POLYGON:var p=t.getFlatInteriorPoints();l=[];for(w=0,S=p.length;w<S;w+=3)o.overflow||u.push(p[w+2]/this.resolution),l.push(p[w],p[w+1]);if(0===l.length)return;c=2}if((x=this.appendFlatPointCoordinates(l,c))===a)return;if(u&&(x-a)/2!=l.length/c){var d=a/2;u=u.filter((function(t,e){var n=i[2*(d+e)]===l[e*c]&&i[2*(d+e)+1]===l[e*c+1];return n||--d,n}))}this.saveTextStates_(),(o.backgroundFill||o.backgroundStroke)&&(this.setFillStrokeStyle(o.backgroundFill,o.backgroundStroke),o.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),o.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);var h=o.padding;if(h!=Tn&&(o.scale[0]<0||o.scale[1]<0)){var f=o.padding[0],m=o.padding[1],g=o.padding[2],y=o.padding[3];o.scale[0]<0&&(m=-m,y=-y),o.scale[1]<0&&(f=-f,g=-g),h=[f,m,g,y]}var v=this.pixelRatio;this.instructions.push([wv.DRAW_IMAGE,a,x,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterImageWithText_,h==Tn?Tn:h.map((function(t){return t*v})),!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,u]);var _=1/v;this.hitDetectionInstructions.push([wv.DRAW_IMAGE,a,x,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[_,_],NaN,this.declutterImageWithText_,h,!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,u]),this.endGeometry(e)}else{if(!Pt(this.getBufferedMaxExtent(),t.getExtent()))return;var C=void 0;if(l=t.getFlatCoordinates(),s==br.LINE_STRING)C=[l.length];else if(s==br.MULTI_LINE_STRING)C=t.getEnds();else if(s==br.POLYGON)C=t.getEnds().slice(0,1);else if(s==br.MULTI_POLYGON){var E=t.getEndss();C=[];for(var w=0,S=E.length;w<S;++w)C.push(E[w][0])}this.beginGeometry(t,e);for(var b=o.textAlign,L=0,T=void 0,P=0,A=C.length;P<A;++P){if(null==b){var O=Dv(o.maxAngle,l,L,C[P],c);L=O[0],T=O[1]}else T=C[P];for(var w=L;w<T;w+=c)i.push(l[w],l[w+1]);var x=i.length;L=C[P],this.drawChars_(a,x),a=x}this.endGeometry(e)}}},e.prototype.saveTextStates_=function(){var t=this.textStrokeState_,e=this.textState_,n=this.textFillState_,r=this.strokeKey_;t&&(r in this.strokeStates||(this.strokeStates[r]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));var o=this.textKey_;o in this.textStates||(this.textStates[o]={font:e.font,textAlign:e.textAlign||bn,textBaseline:e.textBaseline||Ln,scale:e.scale});var i=this.fillKey_;n&&(i in this.fillStates||(this.fillStates[i]={fillStyle:n.fillStyle}))},e.prototype.drawChars_=function(t,e){var n=this.textStrokeState_,r=this.textState_,o=this.strokeKey_,i=this.textKey_,a=this.fillKey_;this.saveTextStates_();var s=this.pixelRatio,l=Nv[r.textBaseline],c=this.textOffsetY_*s,u=this.text_,p=n?n.lineWidth*Math.abs(r.scale[0])/2:0;this.instructions.push([wv.DRAW_CHARS,t,e,l,r.overflow,a,r.maxAngle,s,c,o,p*s,u,i,1]),this.hitDetectionInstructions.push([wv.DRAW_CHARS,t,e,l,r.overflow,a,r.maxAngle,1,c,o,p,u,i,1/s])},e.prototype.setTextStyle=function(t,e){var n,r,o;if(t){var a=t.getFill();a?((r=this.textFillState_)||(r={},this.textFillState_=r),r.fillStyle=jh(a.getColor()||_n)):(r=null,this.textFillState_=r);var s=t.getStroke();if(s){(o=this.textStrokeState_)||(o={},this.textStrokeState_=o);var l=s.getLineDash(),c=s.getLineDashOffset(),u=s.getWidth(),p=s.getMiterLimit();o.lineCap=s.getLineCap()||Cn,o.lineDash=l?l.slice():En,o.lineDashOffset=void 0===c?0:c,o.lineJoin=s.getLineJoin()||wn,o.lineWidth=void 0===u?1:u,o.miterLimit=void 0===p?10:p,o.strokeStyle=jh(s.getColor()||Sn)}else o=null,this.textStrokeState_=o;n=this.textState_;var d=t.getFont()||vn;Mn(d);var h=t.getScaleArray();n.overflow=t.getOverflow(),n.font=d,n.maxAngle=t.getMaxAngle(),n.placement=t.getPlacement(),n.textAlign=t.getTextAlign(),n.textBaseline=t.getTextBaseline()||Ln,n.backgroundFill=t.getBackgroundFill(),n.backgroundStroke=t.getBackgroundStroke(),n.padding=t.getPadding()||Tn,n.scale=void 0===h?[1,1]:h;var f=t.getOffsetX(),m=t.getOffsetY(),g=t.getRotateWithView(),y=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=void 0===f?0:f,this.textOffsetY_=void 0===m?0:m,this.textRotateWithView_=void 0!==g&&g,this.textRotation_=void 0===y?0:y,this.strokeKey_=o?("string"==typeof o.strokeStyle?o.strokeStyle:i(o.strokeStyle))+o.lineCap+o.lineDashOffset+"|"+o.lineWidth+o.lineJoin+o.miterLimit+"["+o.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.textBaseline||"?"),this.fillKey_=r?"string"==typeof r.fillStyle?r.fillStyle:"|"+i(r.fillStyle):""}else this.text_="";this.declutterImageWithText_=e},e}(Tv);var Uv={Circle:Zv,Default:Tv,Image:Av,LineString:Iv,Polygon:Zv,Text:Fv};const Gv=function(){function t(t,e,n,r){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=r,this.resolution_=n,this.buildersByZIndex_={}}return t.prototype.finish=function(){var t={};for(var e in this.buildersByZIndex_){t[e]=t[e]||{};var n=this.buildersByZIndex_[e];for(var r in n){var o=n[r].finish();t[e][r]=o}}return t},t.prototype.getBuilder=function(t,e){var n=void 0!==t?t.toString():"0",r=this.buildersByZIndex_[n];void 0===r&&(r={},this.buildersByZIndex_[n]=r);var o=r[e];void 0===o&&(o=new(0,Uv[e])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),r[e]=o);return o},t}();var Bv=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),jv=function(t){function e(e){var n=t.call(this)||this;return n.ready=!0,n.boundHandleImageChange_=n.handleImageChange_.bind(n),n.layer_=e,n.declutterExecutorGroup=null,n}return Bv(e,t),e.prototype.getFeatures=function(t){return r()},e.prototype.getData=function(t){return null},e.prototype.prepareFrame=function(t){return r()},e.prototype.renderFrame=function(t,e){return r()},e.prototype.loadedTileCallback=function(t,e,n){t[e]||(t[e]={}),t[e][n.tileCoord.toString()]=n},e.prototype.createLoadedTileFinder=function(t,e,n){return function(r,o){var i=this.loadedTileCallback.bind(this,n,r);return t.forEachLoadedTile(e,r,o,i)}.bind(this)},e.prototype.forEachFeatureAtCoordinate=function(t,e,n,r,o){},e.prototype.getDataAtPixel=function(t,e,n){return null},e.prototype.getLayer=function(){return this.layer_},e.prototype.handleFontsChanged=function(){},e.prototype.handleImageChange_=function(t){t.target.getState()===Lh&&this.renderIfReadyAndVisible()},e.prototype.loadImage=function(t){var e=t.getState();return e!=Lh&&e!=Th&&t.addEventListener(pe.CHANGE,this.boundHandleImageChange_),e==Sh&&(t.load(),e=t.getState()),e==Lh},e.prototype.renderIfReadyAndVisible=function(){var t=this.getLayer();t.getVisible()&&t.getSourceState()==ke&&t.changed()},e.prototype.disposeInternal=function(){delete this.layer_,t.prototype.disposeInternal.call(this)},e}(ve);const Wv=jv;var qv=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Hv=null;var Vv=function(t){function e(e){var n=t.call(this,e)||this;return n.container=null,n.renderedResolution,n.tempTransform=[1,0,0,1,0,0],n.pixelTransform=[1,0,0,1,0,0],n.inversePixelTransform=[1,0,0,1,0,0],n.context=null,n.containerReused=!1,n.pixelContext_=null,n.frameState=null,n}return qv(e,t),e.prototype.getImageData=function(t,e,n){var r,o;Hv||((r=document.createElement("canvas")).width=1,r.height=1,Hv=r.getContext("2d")),Hv.clearRect(0,0,1,1);try{Hv.drawImage(t,e,n,1,1,0,0,1,1),o=Hv.getImageData(0,0,1,1).data}catch(t){return null}return o},e.prototype.getBackground=function(t){var e=this.getLayer().getBackground();return"function"==typeof e&&(e=e(t.viewState.resolution)),e||void 0},e.prototype.useContainer=function(t,e,n,r){var o,i,a=this.getLayer().getClassName();t&&t.className===a&&""===t.style.opacity&&1===n&&(!r||t.style.backgroundColor&&f(Yt(t.style.backgroundColor),Yt(r)))&&((l=t.firstElementChild)instanceof HTMLCanvasElement&&(i=l.getContext("2d")));if(i&&i.canvas.style.transform===e?(this.container=t,this.context=i,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){(o=document.createElement("div")).className=a;var s=o.style;s.position="absolute",s.width="100%",s.height="100%",r&&(s.backgroundColor=r);var l=(i=dn()).canvas;o.appendChild(l),(s=l.style).position="absolute",s.left="0",s.transformOrigin="top left",this.container=o,this.context=i}},e.prototype.clipUnrotated=function(t,e,n){var r=bt(n),o=Lt(n),i=vt(n),a=yt(n);k(e.coordinateToPixelTransform,r),k(e.coordinateToPixelTransform,o),k(e.coordinateToPixelTransform,i),k(e.coordinateToPixelTransform,a);var s=this.inversePixelTransform;k(s,r),k(s,o),k(s,i),k(s,a),t.save(),t.beginPath(),t.moveTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(i[0]),Math.round(i[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()},e.prototype.dispatchRenderEvent_=function(t,e,n){var r=this.getLayer();if(r.hasListener(t)){var o=new nn(t,this.inversePixelTransform,n,e);r.dispatchEvent(o)}},e.prototype.preRender=function(t,e){this.frameState=e,this.dispatchRenderEvent_(Ze.PRERENDER,t,e)},e.prototype.postRender=function(t,e){this.dispatchRenderEvent_(Ze.POSTRENDER,t,e)},e.prototype.getRenderTransform=function(t,e,n,r,o,i,a){var s=o/2,l=i/2,c=r/e,u=-c,p=-t[0]+a,d=-t[1];return F(this.tempTransform,s,l,c,u,-n,p,d)},e.prototype.getDataAtPixel=function(t,e,n){var r=k(this.inversePixelTransform,t.slice()),o=this.context,i=this.getLayer().getExtent();if(i&&!et(i,k(e.pixelToCoordinateTransform,t.slice())))return null;var a,s=Math.round(r[0]),l=Math.round(r[1]),c=this.pixelContext_;if(!c){var u=document.createElement("canvas");u.width=1,u.height=1,c=u.getContext("2d"),this.pixelContext_=c}c.clearRect(0,0,1,1);try{c.drawImage(o.canvas,s,l,1,1,0,0,1,1),a=c.getImageData(0,0,1,1).data}catch(t){return"SecurityError"===t.name?(this.pixelContext_=null,new Uint8Array):a}return 0===a[3]?null:a},e.prototype.disposeInternal=function(){delete this.frameState,t.prototype.disposeInternal.call(this)},e}(Wv);const zv=Vv,Yv="Circle",Kv="Default",Xv="Image",$v="LineString",Jv="Polygon",Qv="Text";function t_(t,e,n,r,o,i,a,s,l,c,u,p){var d=t[e],h=t[e+1],f=0,m=0,g=0,y=0;function v(){f=d,m=h,d=t[e+=r],h=t[e+1],y+=g,g=Math.sqrt((d-f)*(d-f)+(h-m)*(h-m))}do{v()}while(e<n-r&&y+g<i);for(var _=0===g?0:(i-y)/g,C=Ft(f,d,_),E=Ft(m,h,_),w=e-r,S=y,b=i+s*l(c,o,u);e<n-r&&y+g<b;)v();var L,T=Ft(f,d,_=0===g?0:(b-y)/g),P=Ft(m,h,_);if(p){var A=[C,E,T,P];Go(A,0,4,2,p,A,A),L=A[0]>A[2]}else L=C>T;var O,x=Math.PI,I=[],M=w+r===e;if(g=0,y=S,d=t[e=w],h=t[e+1],M){v(),O=Math.atan2(h-m,d-f),L&&(O+=O>0?-x:x);var R=(T+C)/2,Z=(P+E)/2;return I[0]=[R,Z,(b-i)/2,O,o],I}for(var D=0,k=o.length;D<k;){v();var N=Math.atan2(h-m,d-f);if(L&&(N+=N>0?-x:x),void 0!==O){var F=N-O;if(F+=F>x?-2*x:F<-x?2*x:0,Math.abs(F)>a)return null}O=N;for(var U=D,G=0;D<k;++D){var B=s*l(c,o[L?k-D-1:D],u);if(e+r<n&&y+g<i+G+B/2)break;G+=B}if(D!==U){var j=L?o.substring(k-U,k-D):o.substring(U,D);R=Ft(f,d,_=0===g?0:(i+G/2-y)/g),Z=Ft(m,h,_);I.push([R,Z,G/2,N,j]),i+=G}}return I}var e_=[1/0,1/0,-1/0,-1/0],n_=[],r_=[],o_=[],i_=[];function a_(t){return t[3].declutterBox}var s_=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function l_(t,e){return"start"!==e&&"end"!==e||s_.test(t)||(e="start"===e?"left":"right"),Nv[e]}function c_(t,e,n){return n>0&&t.push("\n",""),t.push(e,""),t}var u_=function(){function t(t,e,n,r){this.overlaps=n,this.pixelRatio=e,this.resolution=t,this.alignFill_,this.instructions=r.instructions,this.coordinates=r.coordinates,this.coordinateCache_={},this.renderedTransform_=[1,0,0,1,0,0],this.hitDetectionInstructions=r.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=r.fillStates||{},this.strokeStates=r.strokeStates||{},this.textStates=r.textStates||{},this.widths_={},this.labels_={}}return t.prototype.createLabel=function(t,e,n,r){var o=t+e+n+r;if(this.labels_[o])return this.labels_[o];var i=r?this.strokeStates[r]:null,a=n?this.fillStates[n]:null,s=this.textStates[e],l=this.pixelRatio,c=[s.scale[0]*l,s.scale[1]*l],u=Array.isArray(t),p=l_(u?t[0]:t,s.textAlign||bn),d=r&&i.lineWidth?i.lineWidth:0,h=u?t:t.split("\n").reduce(c_,[]),f=function(t,e){for(var n=[],r=[],o=[],i=0,a=0,s=0,l=0,c=0,u=e.length;c<=u;c+=2){var p=e[c];if("\n"!==p&&c!==u){var d=e[c+1]||t.font,h=Dn(d,p);n.push(h),a+=h;var f=Rn(d);r.push(f),l=Math.max(l,f)}else i=Math.max(i,a),o.push(a),a=0,s+=l}return{width:i,height:s,widths:n,heights:r,lineWidths:o}}(s,h),m=f.width,g=f.height,y=f.widths,v=f.heights,_=f.lineWidths,C=m+d,E=[],w=(C+2)*c[0],S=(g+d)*c[1],b={width:w<0?Math.floor(w):Math.ceil(w),height:S<0?Math.floor(S):Math.ceil(S),contextInstructions:E};(1==c[0]&&1==c[1]||E.push("scale",c),r)&&(E.push("strokeStyle",i.strokeStyle),E.push("lineWidth",d),E.push("lineCap",i.lineCap),E.push("lineJoin",i.lineJoin),E.push("miterLimit",i.miterLimit),(L?OffscreenCanvasRenderingContext2D:CanvasRenderingContext2D).prototype.setLineDash&&(E.push("setLineDash",[i.lineDash]),E.push("lineDashOffset",i.lineDashOffset)));n&&E.push("fillStyle",a.fillStyle),E.push("textBaseline","middle"),E.push("textAlign","center");for(var T,P=.5-p,A=p*C+P*d,O=[],x=[],I=0,M=0,R=0,Z=0,D=0,k=h.length;D<k;D+=2){var N=h[D];if("\n"!==N){var F=h[D+1]||s.font;F!==T&&(r&&O.push("font",F),n&&x.push("font",F),T=F),I=Math.max(I,v[R]);var U=[N,A+P*y[R]+p*(y[R]-_[Z]),.5*(d+I)+M];A+=y[R],r&&O.push("strokeText",U),n&&x.push("fillText",U),++R}else M+=I,I=0,A=p*C+P*d,++Z}return Array.prototype.push.apply(E,O),Array.prototype.push.apply(E,x),this.labels_[o]=b,b},t.prototype.replayTextBackground_=function(t,e,n,r,o,i,a){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,n),t.lineTo.apply(t,r),t.lineTo.apply(t,o),t.lineTo.apply(t,e),i&&(this.alignFill_=i[2],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())},t.prototype.calculateImageOrLabelDimensions_=function(t,e,n,r,o,i,a,s,l,c,u,p,d,h,f,m){var g,y=n-(a*=p[0]),v=r-(s*=p[1]),_=o+l>t?t-l:o,C=i+c>e?e-c:i,E=h[3]+_*p[0]+h[1],w=h[0]+C*p[1]+h[2],S=y-h[3],b=v-h[0];return(f||0!==u)&&(n_[0]=S,i_[0]=S,n_[1]=b,r_[1]=b,r_[0]=S+E,o_[0]=r_[0],o_[1]=b+w,i_[1]=o_[1]),0!==u?(k(g=F([1,0,0,1,0,0],n,r,1,1,u,-n,-r),n_),k(g,r_),k(g,o_),k(g,i_),at(Math.min(n_[0],r_[0],o_[0],i_[0]),Math.min(n_[1],r_[1],o_[1],i_[1]),Math.max(n_[0],r_[0],o_[0],i_[0]),Math.max(n_[1],r_[1],o_[1],i_[1]),e_)):at(Math.min(S,S+E),Math.min(b,b+w),Math.max(S,S+E),Math.max(b,b+w),e_),d&&(y=Math.round(y),v=Math.round(v)),{drawImageX:y,drawImageY:v,drawImageW:_,drawImageH:C,originX:l,originY:c,declutterBox:{minX:e_[0],minY:e_[1],maxX:e_[2],maxY:e_[3],value:m},canvasTransform:g,scale:p}},t.prototype.replayImageOrLabel_=function(t,e,n,r,o,i,a){var s=!(!i&&!a),l=r.declutterBox,c=t.canvas,u=a?a[2]*r.scale[0]/2:0;return l.minX-u<=c.width/e&&l.maxX+u>=0&&l.minY-u<=c.height/e&&l.maxY+u>=0&&(s&&this.replayTextBackground_(t,n_,r_,o_,i_,i,a),Nn(t,r.canvasTransform,o,n,r.originX,r.originY,r.drawImageW,r.drawImageH,r.drawImageX,r.drawImageY,r.scale)),!0},t.prototype.fill_=function(t){if(this.alignFill_){var e=k(this.renderedTransform_,[0,0]),n=512*this.pixelRatio;t.save(),t.translate(e[0]%n,e[1]%n),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()},t.prototype.setStrokeStyle_=function(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.setLineDash&&(t.lineDashOffset=e[7],t.setLineDash(e[6]))},t.prototype.drawLabelWithPointPlacement_=function(t,e,n,r){var o=this.textStates[e],i=this.createLabel(t,e,r,n),a=this.strokeStates[n],s=this.pixelRatio,l=l_(Array.isArray(t)?t[0]:t,o.textAlign||bn),c=Nv[o.textBaseline||Ln],u=a&&a.lineWidth?a.lineWidth:0;return{label:i,anchorX:l*(i.width/s-2*o.scale[0])+2*(.5-l)*u,anchorY:c*i.height/s+2*(.5-c)*u}},t.prototype.execute_=function(t,e,n,r,o,i,a,s){var l,c,u;this.pixelCoordinates_&&f(n,this.renderedTransform_)?l=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),l=Uo(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),c=this.renderedTransform_,u=n,c[0]=u[0],c[1]=u[1],c[2]=u[2],c[3]=u[3],c[4]=u[4],c[5]=u[5]);for(var p,d,h,m,g,y,v,_,C,E,w,S,b,L,T,P,A=0,O=r.length,x=0,I=0,M=0,R=null,Z=null,D=this.coordinateCache_,k=this.viewRotation_,N=Math.round(1e12*Math.atan2(-n[1],n[0]))/1e12,F={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:k},U=this.instructions!=r||this.overlaps?0:200;A<O;){var G=r[A];switch(G[0]){case wv.BEGIN_GEOMETRY:b=G[1],P=G[3],b.getGeometry()?void 0===a||Pt(a,P.getExtent())?++A:A=G[2]+1:A=G[2];break;case wv.BEGIN_PATH:I>U&&(this.fill_(t),I=0),M>U&&(t.stroke(),M=0),I||M||(t.beginPath(),m=NaN,g=NaN),++A;break;case wv.CIRCLE:var B=l[x=G[1]],j=l[x+1],W=l[x+2]-B,q=l[x+3]-j,H=Math.sqrt(W*W+q*q);t.moveTo(B+H,j),t.arc(B,j,H,0,2*Math.PI,!0),++A;break;case wv.CLOSE_PATH:t.closePath(),++A;break;case wv.CUSTOM:x=G[1],p=G[2];var V=G[3],z=G[4],Y=6==G.length?G[5]:void 0;F.geometry=V,F.feature=b,A in D||(D[A]=[]);var K=D[A];Y?Y(l,x,p,2,K):(K[0]=l[x],K[1]=l[x+1],K.length=2),z(K,F),++A;break;case wv.DRAW_IMAGE:x=G[1],p=G[2],_=G[3],d=G[4],h=G[5];var X=G[6],$=G[7],J=G[8],Q=G[9],tt=G[10],et=G[11],nt=G[12],rt=G[13],ot=G[14];if(!_&&G.length>=19){C=G[18],E=G[19],w=G[20],S=G[21];var it=this.drawLabelWithPointPlacement_(C,E,w,S);_=it.label,G[3]=_;var at=G[22];d=(it.anchorX-at)*this.pixelRatio,G[4]=d;var st=G[23];h=(it.anchorY-st)*this.pixelRatio,G[5]=h,X=_.height,G[6]=X,rt=_.width,G[13]=rt}var lt=void 0;G.length>24&&(lt=G[24]);var ct=void 0,ut=void 0,pt=void 0;G.length>16?(ct=G[15],ut=G[16],pt=G[17]):(ct=Tn,ut=!1,pt=!1),tt&&N?et+=k:tt||N||(et-=k);for(var dt=0;x<p;x+=2)if(!(lt&&lt[dt++]<rt/this.pixelRatio)){var ht=[t,e,_,Bt=this.calculateImageOrLabelDimensions_(_.width,_.height,l[x],l[x+1],rt,X,d,h,J,Q,et,nt,o,ct,ut||pt,b),$,ut?R:null,pt?Z:null],ft=void 0,mt=void 0;if(s&&ot){var gt=p-x;if(!ot[gt]){ot[gt]=ht;continue}if(ft=ot[gt],delete ot[gt],mt=a_(ft),s.collides(mt))continue}s&&s.collides(Bt.declutterBox)||(ft&&(s&&s.insert(mt),this.replayImageOrLabel_.apply(this,ft)),s&&s.insert(Bt.declutterBox),this.replayImageOrLabel_.apply(this,ht))}++A;break;case wv.DRAW_CHARS:var yt=G[1],vt=G[2],_t=G[3],Ct=G[4];S=G[5];var Et=G[6],wt=G[7],St=G[8];w=G[9];var bt=G[10];C=G[11],E=G[12];var Lt=[G[13],G[13]],Tt=this.textStates[E],At=Tt.font,Ot=[Tt.scale[0]*wt,Tt.scale[1]*wt],xt=void 0;At in this.widths_?xt=this.widths_[At]:(xt={},this.widths_[At]=xt);var It=nl(l,yt,vt,2),Mt=Math.abs(Ot[0])*kn(At,C,xt);if(Ct||Mt<=It){var Rt=this.textStates[E].textAlign,Zt=t_(l,yt,vt,2,C,(It-Mt)*Nv[Rt],Et,Math.abs(Ot[0]),kn,At,xt,N?0:this.viewRotation_);t:if(Zt){var Dt=[],kt=void 0,Nt=void 0,Ft=void 0,Ut=void 0,Gt=void 0;if(w)for(kt=0,Nt=Zt.length;kt<Nt;++kt){Ft=(Gt=Zt[kt])[4],Ut=this.createLabel(Ft,E,"",w),d=Gt[2]+(Ot[0]<0?-bt:bt),h=_t*Ut.height+2*(.5-_t)*bt*Ot[1]/Ot[0]-St;var Bt=this.calculateImageOrLabelDimensions_(Ut.width,Ut.height,Gt[0],Gt[1],Ut.width,Ut.height,d,h,0,0,Gt[3],Lt,!1,Tn,!1,b);if(s&&s.collides(Bt.declutterBox))break t;Dt.push([t,e,Ut,Bt,1,null,null])}if(S)for(kt=0,Nt=Zt.length;kt<Nt;++kt){Ft=(Gt=Zt[kt])[4],Ut=this.createLabel(Ft,E,S,""),d=Gt[2],h=_t*Ut.height-St;Bt=this.calculateImageOrLabelDimensions_(Ut.width,Ut.height,Gt[0],Gt[1],Ut.width,Ut.height,d,h,0,0,Gt[3],Lt,!1,Tn,!1,b);if(s&&s.collides(Bt.declutterBox))break t;Dt.push([t,e,Ut,Bt,1,null,null])}s&&s.load(Dt.map(a_));for(var jt=0,Wt=Dt.length;jt<Wt;++jt)this.replayImageOrLabel_.apply(this,Dt[jt])}}++A;break;case wv.END_GEOMETRY:if(void 0!==i){var qt=i(b=G[1],P);if(qt)return qt}++A;break;case wv.FILL:U?I++:this.fill_(t),++A;break;case wv.MOVE_TO_LINE_TO:for(x=G[1],p=G[2],L=l[x],v=(T=l[x+1])+.5|0,(y=L+.5|0)===m&&v===g||(t.moveTo(L,T),m=y,g=v),x+=2;x<p;x+=2)y=(L=l[x])+.5|0,v=(T=l[x+1])+.5|0,x!=p-2&&y===m&&v===g||(t.lineTo(L,T),m=y,g=v);++A;break;case wv.SET_FILL_STYLE:R=G,this.alignFill_=G[2],I&&(this.fill_(t),I=0,M&&(t.stroke(),M=0)),t.fillStyle=G[1],++A;break;case wv.SET_STROKE_STYLE:Z=G,M&&(t.stroke(),M=0),this.setStrokeStyle_(t,G),++A;break;case wv.STROKE:U?M++:t.stroke(),++A;break;default:++A}}I&&this.fill_(t),M&&t.stroke()},t.prototype.execute=function(t,e,n,r,o,i){this.viewRotation_=r,this.execute_(t,e,n,this.instructions,o,void 0,void 0,i)},t.prototype.executeHitDetection=function(t,e,n,r,o){return this.viewRotation_=n,this.execute_(t,1,e,this.hitDetectionInstructions,!0,r,o)},t}();const p_=u_;var d_=[Jv,Yv,$v,Xv,Qv,Kv],h_=function(){function t(t,e,n,r,o,i){this.maxExtent_=t,this.overlaps_=r,this.pixelRatio_=n,this.resolution_=e,this.renderBuffer_=i,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=[1,0,0,1,0,0],this.createExecutors_(o)}return t.prototype.clip=function(t,e){var n=this.getClipCoords(e);t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(n[2],n[3]),t.lineTo(n[4],n[5]),t.lineTo(n[6],n[7]),t.clip()},t.prototype.createExecutors_=function(t){for(var e in t){var n=this.executorsByZIndex_[e];void 0===n&&(n={},this.executorsByZIndex_[e]=n);var r=t[e];for(var o in r){var i=r[o];n[o]=new p_(this.resolution_,this.pixelRatio_,this.overlaps_,i)}}},t.prototype.hasExecutors=function(t){for(var e in this.executorsByZIndex_)for(var n=this.executorsByZIndex_[e],r=0,o=t.length;r<o;++r)if(t[r]in n)return!0;return!1},t.prototype.forEachFeatureAtCoordinate=function(t,e,n,r,o,i){var a=2*(r=Math.round(r))+1,s=F(this.hitDetectionTransform_,r+.5,r+.5,1/e,-1/e,-n,-t[0],-t[1]),c=!this.hitDetectionContext_;c&&(this.hitDetectionContext_=dn(a,a));var u,p=this.hitDetectionContext_;p.canvas.width!==a||p.canvas.height!==a?(p.canvas.width=a,p.canvas.height=a):c||p.clearRect(0,0,a,a),void 0!==this.renderBuffer_&&(dt(u=[1/0,1/0,-1/0,-1/0],t),J(u,e*(this.renderBuffer_+r),u));var d,h=function(t){if(void 0!==f_[t])return f_[t];for(var e=2*t+1,n=t*t,r=new Array(n+1),o=0;o<=t;++o)for(var i=0;i<=t;++i){var a=o*o+i*i;if(a>n)break;var s=r[a];s||(s=[],r[a]=s),s.push(4*((t+o)*e+(t+i))+3),o>0&&s.push(4*((t-o)*e+(t+i))+3),i>0&&(s.push(4*((t+o)*e+(t-i))+3),o>0&&s.push(4*((t-o)*e+(t-i))+3))}for(var l=[],c=(o=0,r.length);o<c;++o)r[o]&&l.push.apply(l,r[o]);return f_[t]=l,l}(r);function f(t,e){for(var n=p.getImageData(0,0,a,a).data,s=0,l=h.length;s<l;s++)if(n[h[s]]>0){if(!i||d!==Xv&&d!==Qv||-1!==i.indexOf(t)){var c=(h[s]-3)/4,u=r-c%a,f=r-(c/a|0),m=o(t,e,u*u+f*f);if(m)return m}p.clearRect(0,0,a,a);break}}var m,g,y,v,_,C=Object.keys(this.executorsByZIndex_).map(Number);for(C.sort(l),m=C.length-1;m>=0;--m){var E=C[m].toString();for(y=this.executorsByZIndex_[E],g=d_.length-1;g>=0;--g)if(void 0!==(v=y[d=d_[g]])&&(_=v.executeHitDetection(p,s,n,f,u)))return _}},t.prototype.getClipCoords=function(t){var e=this.maxExtent_;if(!e)return null;var n=e[0],r=e[1],o=e[2],i=e[3],a=[n,r,n,i,o,i,o,r];return Uo(a,0,8,2,t,a),a},t.prototype.isEmpty=function(){return se(this.executorsByZIndex_)},t.prototype.execute=function(t,e,n,r,o,i,a){var s=Object.keys(this.executorsByZIndex_).map(Number);s.sort(l),this.maxExtent_&&(t.save(),this.clip(t,n));var c,u,p,d,h,f,m=i||d_;for(a&&s.reverse(),c=0,u=s.length;c<u;++c){var g=s[c].toString();for(h=this.executorsByZIndex_[g],p=0,d=m.length;p<d;++p){void 0!==(f=h[m[p]])&&f.execute(t,e,n,r,o,a)}}this.maxExtent_&&t.restore()},t}(),f_={};const m_=h_;var g_=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),y_=function(t){function e(e,n,r,o,i,a,s){var l=t.call(this)||this;return l.context_=e,l.pixelRatio_=n,l.extent_=r,l.transform_=o,l.viewRotation_=i,l.squaredTolerance_=a,l.userTransform_=s,l.contextFillState_=null,l.contextStrokeState_=null,l.contextTextState_=null,l.fillState_=null,l.strokeState_=null,l.image_=null,l.imageAnchorX_=0,l.imageAnchorY_=0,l.imageHeight_=0,l.imageOpacity_=0,l.imageOriginX_=0,l.imageOriginY_=0,l.imageRotateWithView_=!1,l.imageRotation_=0,l.imageScale_=[0,0],l.imageWidth_=0,l.text_="",l.textOffsetX_=0,l.textOffsetY_=0,l.textRotateWithView_=!1,l.textRotation_=0,l.textScale_=[0,0],l.textFillState_=null,l.textStrokeState_=null,l.textState_=null,l.pixelCoordinates_=[],l.tmpLocalTransform_=[1,0,0,1,0,0],l}return g_(e,t),e.prototype.drawImages_=function(t,e,n,r){if(this.image_){var o=Uo(t,e,n,r,this.transform_,this.pixelCoordinates_),i=this.context_,a=this.tmpLocalTransform_,s=i.globalAlpha;1!=this.imageOpacity_&&(i.globalAlpha=s*this.imageOpacity_);var l=this.imageRotation_;this.imageRotateWithView_&&(l+=this.viewRotation_);for(var c=0,u=o.length;c<u;c+=2){var p=o[c]-this.imageAnchorX_,d=o[c+1]-this.imageAnchorY_;if(0!==l||1!=this.imageScale_[0]||1!=this.imageScale_[1]){var h=p+this.imageAnchorX_,f=d+this.imageAnchorY_;F(a,h,f,1,1,l,-h,-f),i.setTransform.apply(i,a),i.translate(h,f),i.scale(this.imageScale_[0],this.imageScale_[1]),i.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),i.setTransform(1,0,0,1,0,0)}else i.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,p,d,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(i.globalAlpha=s)}},e.prototype.drawText_=function(t,e,n,r){if(this.textState_&&""!==this.text_){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var o=Uo(t,e,n,r,this.transform_,this.pixelCoordinates_),i=this.context_,a=this.textRotation_;for(this.textRotateWithView_&&(a+=this.viewRotation_);e<n;e+=r){var s=o[e]+this.textOffsetX_,l=o[e+1]+this.textOffsetY_;if(0!==a||1!=this.textScale_[0]||1!=this.textScale_[1]){var c=F(this.tmpLocalTransform_,s,l,1,1,a,-s,-l);i.setTransform.apply(i,c),i.translate(s,l),i.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&i.strokeText(this.text_,0,0),this.textFillState_&&i.fillText(this.text_,0,0),i.setTransform(1,0,0,1,0,0)}else this.textStrokeState_&&i.strokeText(this.text_,s,l),this.textFillState_&&i.fillText(this.text_,s,l)}}},e.prototype.moveToLineTo_=function(t,e,n,r,o){var i=this.context_,a=Uo(t,e,n,r,this.transform_,this.pixelCoordinates_);i.moveTo(a[0],a[1]);var s=a.length;o&&(s-=2);for(var l=2;l<s;l+=2)i.lineTo(a[l],a[l+1]);return o&&i.closePath(),n},e.prototype.drawRings_=function(t,e,n,r){for(var o=0,i=n.length;o<i;++o)e=this.moveToLineTo_(t,e,n[o],r,!0);return e},e.prototype.drawCircle=function(t){if(Pt(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=function(t,e,n){var r=t.getFlatCoordinates();if(r){var o=t.getStride();return Uo(r,0,r.length,o,e,n)}return null}(t,this.transform_,this.pixelCoordinates_),n=e[2]-e[0],r=e[3]-e[1],o=Math.sqrt(n*n+r*r),i=this.context_;i.beginPath(),i.arc(e[0],e[1],o,0,2*Math.PI),this.fillState_&&i.fill(),this.strokeState_&&i.stroke()}""!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}},e.prototype.setStyle=function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())},e.prototype.setTransform=function(t){this.transform_=t},e.prototype.drawGeometry=function(t){switch(t.getType()){case br.POINT:this.drawPoint(t);break;case br.LINE_STRING:this.drawLineString(t);break;case br.POLYGON:this.drawPolygon(t);break;case br.MULTI_POINT:this.drawMultiPoint(t);break;case br.MULTI_LINE_STRING:this.drawMultiLineString(t);break;case br.MULTI_POLYGON:this.drawMultiPolygon(t);break;case br.GEOMETRY_COLLECTION:this.drawGeometryCollection(t);break;case br.CIRCLE:this.drawCircle(t)}},e.prototype.drawFeature=function(t,e){var n=e.getGeometryFunction()(t);n&&Pt(this.extent_,n.getExtent())&&(this.setStyle(e),this.drawGeometry(n))},e.prototype.drawGeometryCollection=function(t){for(var e=t.getGeometriesArray(),n=0,r=e.length;n<r;++n)this.drawGeometry(e[n])},e.prototype.drawPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),""!==this.text_&&this.drawText_(e,0,e.length,n)},e.prototype.drawMultiPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),""!==this.text_&&this.drawText_(e,0,e.length,n)},e.prototype.drawLineString=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Pt(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var e=this.context_,n=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),e.stroke()}if(""!==this.text_){var r=t.getFlatMidpoint();this.drawText_(r,0,2,2)}}},e.prototype.drawMultiLineString=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getExtent();if(Pt(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var n=this.context_,r=t.getFlatCoordinates(),o=0,i=t.getEnds(),a=t.getStride();n.beginPath();for(var s=0,l=i.length;s<l;++s)o=this.moveToLineTo_(r,o,i[s],a,!1);n.stroke()}if(""!==this.text_){var c=t.getFlatMidpoints();this.drawText_(c,0,c.length,2)}}},e.prototype.drawPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Pt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){var n=t.getFlatInteriorPoint();this.drawText_(n,0,2,2)}}},e.prototype.drawMultiPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Pt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_,n=t.getOrientedFlatCoordinates(),r=0,o=t.getEndss(),i=t.getStride();e.beginPath();for(var a=0,s=o.length;a<s;++a){var l=o[a];r=this.drawRings_(n,r,l,i)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){var c=t.getFlatInteriorPoints();this.drawText_(c,0,c.length,2)}}},e.prototype.setContextFillState_=function(t){var e=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})},e.prototype.setContextStrokeState_=function(t){var e=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,e.lineCap=t.lineCap),e.setLineDash&&(f(n.lineDash,t.lineDash)||e.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset)),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})},e.prototype.setContextTextState_=function(t){var e=this.context_,n=this.contextTextState_,r=t.textAlign?t.textAlign:bn;n?(n.font!=t.font&&(n.font=t.font,e.font=t.font),n.textAlign!=r&&(n.textAlign=r,e.textAlign=r),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=r,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:r,textBaseline:t.textBaseline})},e.prototype.setFillStrokeStyle=function(t,e){var n=this;if(t){var r=t.getColor();this.fillState_={fillStyle:jh(r||_n)}}else this.fillState_=null;if(e){var o=e.getColor(),i=e.getLineCap(),a=e.getLineDash(),s=e.getLineDashOffset(),l=e.getLineJoin(),c=e.getWidth(),u=e.getMiterLimit(),p=a||En;this.strokeState_={lineCap:void 0!==i?i:Cn,lineDash:1===this.pixelRatio_?p:p.map((function(t){return t*n.pixelRatio_})),lineDashOffset:(s||0)*this.pixelRatio_,lineJoin:void 0!==l?l:wn,lineWidth:(void 0!==c?c:1)*this.pixelRatio_,miterLimit:void 0!==u?u:10,strokeStyle:jh(o||Sn)}}else this.strokeState_=null},e.prototype.setImageStyle=function(t){var e;if(t&&(e=t.getSize())){var n=t.getAnchor(),r=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*this.pixelRatio_,this.imageAnchorY_=n[1]*this.pixelRatio_,this.imageHeight_=e[1]*this.pixelRatio_,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation(),this.imageScale_=t.getScaleArray(),this.imageWidth_=e[0]*this.pixelRatio_}else this.image_=null},e.prototype.setTextStyle=function(t){if(t){var e=t.getFill();if(e){var n=e.getColor();this.textFillState_={fillStyle:jh(n||_n)}}else this.textFillState_=null;var r=t.getStroke();if(r){var o=r.getColor(),i=r.getLineCap(),a=r.getLineDash(),s=r.getLineDashOffset(),l=r.getLineJoin(),c=r.getWidth(),u=r.getMiterLimit();this.textStrokeState_={lineCap:void 0!==i?i:Cn,lineDash:a||En,lineDashOffset:s||0,lineJoin:void 0!==l?l:wn,lineWidth:void 0!==c?c:1,miterLimit:void 0!==u?u:10,strokeStyle:jh(o||Sn)}}else this.textStrokeState_=null;var p=t.getFont(),d=t.getOffsetX(),h=t.getOffsetY(),f=t.getRotateWithView(),m=t.getRotation(),g=t.getScaleArray(),y=t.getText(),v=t.getTextAlign(),_=t.getTextBaseline();this.textState_={font:void 0!==p?p:vn,textAlign:void 0!==v?v:bn,textBaseline:void 0!==_?_:Ln},this.text_=void 0!==y?Array.isArray(y)?y.reduce((function(t,e,n){return t+(n%2?" ":e)}),""):y:"",this.textOffsetX_=void 0!==d?this.pixelRatio_*d:0,this.textOffsetY_=void 0!==h?this.pixelRatio_*h:0,this.textRotateWithView_=void 0!==f&&f,this.textRotation_=void 0!==m?m:0,this.textScale_=[this.pixelRatio_*g[0],this.pixelRatio_*g[1]]}else this.text_=""},e}(Sv);const v_=y_;var __=.5;var C_={Point:function(t,e,n,r,o){var i,a=n.getImage(),s=n.getText();o&&(t=o,i=a&&s&&s.getText()?{}:void 0);if(a){if(a.getImageState()!=Lh)return;var l=t.getBuilder(n.getZIndex(),Xv);l.setImageStyle(a,i),l.drawPoint(e,r)}if(s&&s.getText()){var c=t.getBuilder(n.getZIndex(),Qv);c.setTextStyle(s,i),c.drawText(e,r)}},LineString:function(t,e,n,r,o){var i=n.getStroke();if(i){var a=t.getBuilder(n.getZIndex(),$v);a.setFillStrokeStyle(null,i),a.drawLineString(e,r)}var s=n.getText();if(s&&s.getText()){var l=(o||t).getBuilder(n.getZIndex(),Qv);l.setTextStyle(s),l.drawText(e,r)}},Polygon:function(t,e,n,r,o){var i=n.getFill(),a=n.getStroke();if(i||a){var s=t.getBuilder(n.getZIndex(),Jv);s.setFillStrokeStyle(i,a),s.drawPolygon(e,r)}var l=n.getText();if(l&&l.getText()){var c=(o||t).getBuilder(n.getZIndex(),Qv);c.setTextStyle(l),c.drawText(e,r)}},MultiPoint:function(t,e,n,r,o){var i,a=n.getImage(),s=n.getText();o&&(t=o,i=a&&s&&s.getText()?{}:void 0);if(a){if(a.getImageState()!=Lh)return;var l=t.getBuilder(n.getZIndex(),Xv);l.setImageStyle(a,i),l.drawMultiPoint(e,r)}if(s&&s.getText()){var c=(o||t).getBuilder(n.getZIndex(),Qv);c.setTextStyle(s,i),c.drawText(e,r)}},MultiLineString:function(t,e,n,r,o){var i=n.getStroke();if(i){var a=t.getBuilder(n.getZIndex(),$v);a.setFillStrokeStyle(null,i),a.drawMultiLineString(e,r)}var s=n.getText();if(s&&s.getText()){var l=(o||t).getBuilder(n.getZIndex(),Qv);l.setTextStyle(s),l.drawText(e,r)}},MultiPolygon:function(t,e,n,r,o){var i=n.getFill(),a=n.getStroke();if(a||i){var s=t.getBuilder(n.getZIndex(),Jv);s.setFillStrokeStyle(i,a),s.drawMultiPolygon(e,r)}var l=n.getText();if(l&&l.getText()){var c=(o||t).getBuilder(n.getZIndex(),Qv);c.setTextStyle(l),c.drawText(e,r)}},GeometryCollection:function(t,e,n,r,o){var i,a,s=e.getGeometriesArray();for(i=0,a=s.length;i<a;++i){(0,C_[s[i].getType()])(t,s[i],n,r,o)}},Circle:function(t,e,n,r,o){var i=n.getFill(),a=n.getStroke();if(i||a){var s=t.getBuilder(n.getZIndex(),Yv);s.setFillStrokeStyle(i,a),s.drawCircle(e,r)}var l=n.getText();if(l&&l.getText()){var c=(o||t).getBuilder(n.getZIndex(),Qv);c.setTextStyle(l),c.drawText(e,r)}}};function E_(t,e){return parseInt(i(t),10)-parseInt(i(e),10)}function w_(t,e){var n=S_(t,e);return n*n}function S_(t,e){return.5*t/e}function b_(t,e,n,r,o,i,a){var s=!1,l=n.getImage();if(l){var c=l.getImageState();c==Lh||c==Th?l.unlistenImageChange(o):(c==Sh&&l.load(),c=l.getImageState(),l.listenImageChange(o),s=!0)}return function(t,e,n,r,o,i){var a=n.getGeometryFunction()(e);if(!a)return;var s=a.simplifyTransformed(r,o);if(n.getRenderer())L_(t,s,n,e);else{(0,C_[s.getType()])(t,s,n,e,i)}}(t,e,n,r,i,a),s}function L_(t,e,n,r){if(e.getType()!=br.GEOMETRY_COLLECTION)t.getBuilder(n.getZIndex(),Kv).drawCustom(e,r,n.getRenderer(),n.getHitDetectionRenderer());else for(var o=e.getGeometries(),i=0,a=o.length;i<a;++i)L_(t,o[i],n,r)}var T_=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),P_=function(t){function e(e){var n=t.call(this,e)||this;return n.boundHandleStyleImageChange_=n.handleStyleImageChange_.bind(n),n.animatingOrInteracting_,n.dirty_=!1,n.hitDetectionImageData_=null,n.renderedFeatures_=null,n.renderedRevision_=-1,n.renderedResolution_=NaN,n.renderedExtent_=[1/0,1/0,-1/0,-1/0],n.wrappedRenderedExtent_=[1/0,1/0,-1/0,-1/0],n.renderedRotation_,n.renderedCenter_=null,n.renderedProjection_=null,n.renderedRenderOrder_=null,n.replayGroup_=null,n.replayGroupChanged=!0,n.declutterExecutorGroup=null,n.clipping=!0,n}return T_(e,t),e.prototype.renderWorlds=function(t,e,n){var r=e.extent,o=e.viewState,i=o.center,a=o.resolution,s=o.projection,l=o.rotation,c=s.getExtent(),u=this.getLayer().getSource(),p=e.pixelRatio,d=e.viewHints,h=!(d[Ar]||d[Or]),f=this.context,m=Math.round(e.size[0]*p),g=Math.round(e.size[1]*p),y=u.getWrapX()&&s.canWrapX(),v=y?Tt(c):null,_=y?Math.ceil((r[2]-c[2])/v)+1:1,C=y?Math.floor((r[0]-c[0])/v):0;do{var E=this.getRenderTransform(i,a,l,p,m,g,C*v);t.execute(f,1,E,l,h,void 0,n)}while(++C<_)},e.prototype.renderDeclutter=function(t){this.declutterExecutorGroup&&this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree)},e.prototype.renderFrame=function(t,e){var n=t.pixelRatio,r=t.layerStatesArray[t.layerIndex];!function(t,e,n){D(t,e,0,0,n,0,0)}(this.pixelTransform,1/n,1/n),U(this.inversePixelTransform,this.pixelTransform);var o=G(this.pixelTransform);this.useContainer(e,o,r.opacity,this.getBackground(t));var i=this.context,a=i.canvas,s=this.replayGroup_,l=this.declutterExecutorGroup;if((!s||s.isEmpty())&&(!l||l.isEmpty()))return null;var c=Math.round(t.size[0]*n),u=Math.round(t.size[1]*n);a.width!=c||a.height!=u?(a.width=c,a.height=u,a.style.transform!==o&&(a.style.transform=o)):this.containerReused||i.clearRect(0,0,c,u),this.preRender(i,t);var p=t.viewState,d=p.projection,h=!1,f=!0;if(r.extent&&this.clipping){var m=bo(r.extent,d);(h=(f=Pt(m,t.extent))&&!nt(m,t.extent))&&this.clipUnrotated(i,t,m)}f&&this.renderWorlds(s,t),h&&i.restore(),this.postRender(i,t);var g=pn(r.opacity),y=this.container;return g!==y.style.opacity&&(y.style.opacity=g),this.renderedRotation_!==p.rotation&&(this.renderedRotation_=p.rotation,this.hitDetectionImageData_=null),this.container},e.prototype.getFeatures=function(t){return new Promise(function(e){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){var n=[this.context.canvas.width,this.context.canvas.height];k(this.pixelTransform,n);var r=this.renderedCenter_,o=this.renderedResolution_,i=this.renderedRotation_,a=this.renderedProjection_,s=this.wrappedRenderedExtent_,c=this.getLayer(),u=[],p=n[0]*__,d=n[1]*__;u.push(this.getRenderTransform(r,o,i,__,p,d,0).slice());var h=c.getSource(),f=a.getExtent();if(h.getWrapX()&&a.canWrapX()&&!nt(f,s)){for(var m=s[0],g=Tt(f),y=0,v=void 0;m<f[0];)v=g*--y,u.push(this.getRenderTransform(r,o,i,__,p,d,v).slice()),m+=g;for(y=0,m=s[2];m>f[2];)v=g*++y,u.push(this.getRenderTransform(r,o,i,__,p,d,v).slice()),m-=g}this.hitDetectionImageData_=function(t,e,n,r,o,i,a){var s=dn(t[0]*__,t[1]*__);s.imageSmoothingEnabled=!1;for(var c=s.canvas,u=new v_(s,__,o,null,a),p=n.length,d=Math.floor(16777215/p),h={},f=1;f<=p;++f){var m=n[f-1],g=m.getStyleFunction()||r;if(r){var y=g(m,i);if(y){Array.isArray(y)||(y=[y]);for(var v="#"+("000000"+(f*d).toString(16)).slice(-6),_=0,C=y.length;_<C;++_){var E=y[_],w=E.getGeometryFunction()(m);if(w&&Pt(o,w.getExtent())){var S=E.clone(),b=S.getFill();b&&b.setColor(v);var L=S.getStroke();L&&(L.setColor(v),L.setLineDash(null)),S.setText(void 0);var T=E.getImage();if(T&&0!==T.getOpacity()){var P=T.getImageSize();if(!P)continue;var A=dn(P[0],P[1],void 0,{alpha:!1}),O=A.canvas;A.fillStyle=v,A.fillRect(0,0,O.width,O.height),S.setImage(new Gh({img:O,imgSize:P,anchor:T.getAnchor(),anchorXUnits:Eh.PIXELS,anchorYUnits:Eh.PIXELS,offset:T.getOrigin(),opacity:1,size:T.getSize(),scale:T.getScale(),rotation:T.getRotation(),rotateWithView:T.getRotateWithView()}))}var x=S.getZIndex()||0;(R=h[x])||(R={},h[x]=R,R[br.POLYGON]=[],R[br.CIRCLE]=[],R[br.LINE_STRING]=[],R[br.POINT]=[]),R[w.getType().replace("Multi","")].push(w,S)}}}}}for(var I=Object.keys(h).map(Number).sort(l),M=(f=0,I.length);f<M;++f){var R=h[I[f]];for(var Z in R){var D=R[Z];for(_=0,C=D.length;_<C;_+=2){u.setStyle(D[_+1]);for(var k=0,N=e.length;k<N;++k)u.setTransform(e[k]),u.drawGeometry(D[_])}}}return s.getImageData(0,0,c.width,c.height)}(n,u,this.renderedFeatures_,c.getStyleFunction(),s,o,i)}e(function(t,e,n){var r=[];if(n){var o=Math.floor(Math.round(t[0])*__),i=Math.floor(Math.round(t[1])*__),a=4*(It(o,0,n.width-1)+It(i,0,n.height-1)*n.width),s=n.data[a],l=n.data[a+1],c=n.data[a+2]+256*(l+256*s),u=Math.floor(16777215/e.length);c&&c%u==0&&r.push(e[c/u-1])}return r}(t,this.renderedFeatures_,this.hitDetectionImageData_))}.bind(this))},e.prototype.forEachFeatureAtCoordinate=function(t,e,n,r,o){var a=this;if(this.replayGroup_){var s,l=e.viewState.resolution,c=e.viewState.rotation,u=this.getLayer(),p={},d=function(t,e,n){var a=i(t),s=p[a];if(s){if(!0!==s&&n<s.distanceSq){if(0===n)return p[a]=!0,o.splice(o.lastIndexOf(s),1),r(t,u,e);s.geometry=e,s.distanceSq=n}}else{if(0===n)return p[a]=!0,r(t,u,e);o.push(p[a]={feature:t,layer:u,geometry:e,distanceSq:n,callback:r})}},h=[this.replayGroup_];return this.declutterExecutorGroup&&h.push(this.declutterExecutorGroup),h.some((function(r){return s=r.forEachFeatureAtCoordinate(t,l,c,n,d,r===a.declutterExecutorGroup&&e.declutterTree?e.declutterTree.all().map((function(t){return t.value})):null)})),s}},e.prototype.handleFontsChanged=function(){var t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()},e.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()},e.prototype.prepareFrame=function(t){var e=this.getLayer(),n=e.getSource();if(!n)return!1;var r=t.viewHints[Ar],o=t.viewHints[Or],i=e.getUpdateWhileAnimating(),a=e.getUpdateWhileInteracting();if(!this.dirty_&&!i&&r||!a&&o)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;var s=t.extent,l=t.viewState,c=l.projection,u=l.resolution,p=t.pixelRatio,d=e.getRevision(),h=e.getRenderBuffer(),m=e.getRenderOrder();void 0===m&&(m=E_);var g=l.center.slice(),y=J(s,h*u),v=y.slice(),_=[y.slice()],C=c.getExtent();if(n.getWrapX()&&c.canWrapX()&&!nt(C,t.extent)){var E=Tt(C),w=Math.max(Tt(y)/2,E);y[0]=C[0]-w,y[2]=C[2]+w,Ye(g,c);var S=function(t,e){var n=e.getExtent(),r=_t(t);if(e.canWrapX()&&(r[0]<n[0]||r[0]>=n[2])){var o=Tt(n),i=Math.floor((r[0]-n[0])/o)*o;t[0]-=i,t[2]-=i}return t}(_[0],c);S[0]<C[0]&&S[2]<C[2]?_.push([S[0]+E,S[1],S[2]+E,S[3]]):S[0]>C[0]&&S[2]>C[2]&&_.push([S[0]-E,S[1],S[2]-E,S[3]])}if(!this.dirty_&&this.renderedResolution_==u&&this.renderedRevision_==d&&this.renderedRenderOrder_==m&&nt(this.wrappedRenderedExtent_,y))return f(this.renderedExtent_,v)||(this.hitDetectionImageData_=null,this.renderedExtent_=v),this.renderedCenter_=g,this.replayGroupChanged=!1,!0;this.replayGroup_=null,this.dirty_=!1;var b,L=new Gv(S_(u,p),y,u,p);this.getLayer().getDeclutter()&&(b=new Gv(S_(u,p),y,u,p));var T,P=Co();if(P){for(var A=0,O=_.length;A<O;++A){var x=So(_[A],c);n.loadFeatures(x,Lo(u,c),P)}T=po(P,c)}else for(A=0,O=_.length;A<O;++A)n.loadFeatures(_[A],u,c);var I=w_(u,p),M=function(t){var n,r=t.getStyleFunction()||e.getStyleFunction();if(r&&(n=r(t,u)),n){var o=this.renderFeature(t,I,n,L,T,b);this.dirty_=this.dirty_||o}}.bind(this),R=So(y,c),Z=n.getFeaturesInExtent(R);m&&Z.sort(m);for(A=0,O=Z.length;A<O;++A)M(Z[A]);this.renderedFeatures_=Z;var D=L.finish(),k=new m_(y,u,p,n.getOverlaps(),D,e.getRenderBuffer());return b&&(this.declutterExecutorGroup=new m_(y,u,p,n.getOverlaps(),b.finish(),e.getRenderBuffer())),this.renderedResolution_=u,this.renderedRevision_=d,this.renderedRenderOrder_=m,this.renderedExtent_=v,this.wrappedRenderedExtent_=y,this.renderedCenter_=g,this.renderedProjection_=c,this.replayGroup_=k,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0},e.prototype.renderFeature=function(t,e,n,r,o,i){if(!n)return!1;var a=!1;if(Array.isArray(n))for(var s=0,l=n.length;s<l;++s)a=b_(r,t,n[s],e,this.boundHandleStyleImageChange_,o,i)||a;else a=b_(r,t,n,e,this.boundHandleStyleImageChange_,o,i);return a},e}(zv);const A_=P_;var O_=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const x_=function(t){function e(e){return t.call(this,e)||this}return O_(e,t),e.prototype.createRenderer=function(){return new A_(this)},e}(gv);var I_=function(){function t(t){this.rbush_=new hv(t),this.items_={}}return t.prototype.insert=function(t,e){var n={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(n),this.items_[i(e)]=n},t.prototype.load=function(t,e){for(var n=new Array(e.length),r=0,o=e.length;r<o;r++){var a=t[r],s=e[r],l={minX:a[0],minY:a[1],maxX:a[2],maxY:a[3],value:s};n[r]=l,this.items_[i(s)]=l}this.rbush_.load(n)},t.prototype.remove=function(t){var e=i(t),n=this.items_[e];return delete this.items_[e],null!==this.rbush_.remove(n)},t.prototype.update=function(t,e){var n=this.items_[i(e)];ut([n.minX,n.minY,n.maxX,n.maxY],t)||(this.remove(e),this.insert(t,e))},t.prototype.getAll=function(){return this.rbush_.all().map((function(t){return t.value}))},t.prototype.getInExtent=function(t){var e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map((function(t){return t.value}))},t.prototype.forEach=function(t){return this.forEach_(this.getAll(),t)},t.prototype.forEachInExtent=function(t,e){return this.forEach_(this.getInExtent(t),e)},t.prototype.forEach_=function(t,e){for(var n,r=0,o=t.length;r<o;r++)if(n=e(t[r]))return n;return n},t.prototype.isEmpty=function(){return se(this.items_)},t.prototype.clear=function(){this.rbush_.clear(),this.items_={}},t.prototype.getExtent=function(t){var e=this.rbush_.toJSON();return at(e.minX,e.minY,e.maxX,e.maxY,t)},t.prototype.concat=function(t){for(var e in this.rbush_.load(t.rbush_.all()),t.items_)this.items_[e]=t.items_[e]},t}();const M_=I_;var R_=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function Z_(t){return t?Array.isArray(t)?function(e){return t}:"function"==typeof t?t:function(e){return[t]}:null}const D_=function(t){function e(e){var n=t.call(this)||this;n.projection=io(e.projection),n.attributions_=Z_(e.attributions),n.attributionsCollapsible_=void 0===e.attributionsCollapsible||e.attributionsCollapsible,n.loading=!1,n.state_=void 0!==e.state?e.state:ke,n.wrapX_=void 0!==e.wrapX&&e.wrapX,n.interpolate_=!!e.interpolate,n.viewResolver=null,n.viewRejector=null;var r=n;return n.viewPromise_=new Promise((function(t,e){r.viewResolver=t,r.viewRejector=e})),n}return R_(e,t),e.prototype.getAttributions=function(){return this.attributions_},e.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},e.prototype.getProjection=function(){return this.projection},e.prototype.getResolutions=function(){return r()},e.prototype.getView=function(){return this.viewPromise_},e.prototype.getState=function(){return this.state_},e.prototype.getWrapX=function(){return this.wrapX_},e.prototype.getInterpolate=function(){return this.interpolate_},e.prototype.refresh=function(){this.changed()},e.prototype.setAttributions=function(t){this.attributions_=Z_(t),this.changed()},e.prototype.setState=function(t){this.state_=t,this.changed()},e}(Ee),k_={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function N_(t,e){return[[-1/0,-1/0,1/0,1/0]]}var F_=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),U_=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.feature=n,o.features=r,o}return F_(e,t),e}(ne),G_=function(t){function e(e){var n=this,r=e||{};(n=t.call(this,{attributions:r.attributions,interpolate:!0,projection:void 0,state:ke,wrapX:void 0===r.wrapX||r.wrapX})||this).on,n.once,n.un,n.loader_=v,n.format_=r.format,n.overlaps_=void 0===r.overlaps||r.overlaps,n.url_=r.url,void 0!==r.loader?n.loader_=r.loader:void 0!==n.url_&&(x(n.format_,7),n.loader_=Ll(n.url_,n.format_)),n.strategy_=void 0!==r.strategy?r.strategy:N_;var o,i,a=void 0===r.useSpatialIndex||r.useSpatialIndex;return n.featuresRtree_=a?new M_:null,n.loadedExtentsRtree_=new M_,n.loadingExtentsCount_=0,n.nullGeometryFeatures_={},n.idIndex_={},n.uidIndex_={},n.featureChangeKeys_={},n.featuresCollection_=null,Array.isArray(r.features)?i=r.features:r.features&&(i=(o=r.features).getArray()),a||void 0!==o||(o=new Vn(i)),void 0!==i&&n.addFeaturesInternal(i),void 0!==o&&n.bindFeaturesCollection_(o),n}return F_(e,t),e.prototype.addFeature=function(t){this.addFeatureInternal(t),this.changed()},e.prototype.addFeatureInternal=function(t){var e=i(t);if(this.addToIndex_(e,t)){this.setupChangeEvents_(e,t);var n=t.getGeometry();if(n){var r=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(r,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new U_(k_.ADDFEATURE,t))}else this.featuresCollection_&&this.featuresCollection_.remove(t)},e.prototype.setupChangeEvents_=function(t,e){this.featureChangeKeys_[t]=[de(e,pe.CHANGE,this.handleFeatureChange_,this),de(e,re,this.handleFeatureChange_,this)]},e.prototype.addToIndex_=function(t,e){var n=!0,r=e.getId();return void 0!==r&&(r.toString()in this.idIndex_?n=!1:this.idIndex_[r.toString()]=e),n&&(x(!(t in this.uidIndex_),30),this.uidIndex_[t]=e),n},e.prototype.addFeatures=function(t){this.addFeaturesInternal(t),this.changed()},e.prototype.addFeaturesInternal=function(t){for(var e=[],n=[],r=[],o=0,a=t.length;o<a;o++){var s=i(c=t[o]);this.addToIndex_(s,c)&&n.push(c)}o=0;for(var l=n.length;o<l;o++){var c;s=i(c=n[o]);this.setupChangeEvents_(s,c);var u=c.getGeometry();if(u){var p=u.getExtent();e.push(p),r.push(c)}else this.nullGeometryFeatures_[s]=c}if(this.featuresRtree_&&this.featuresRtree_.load(e,r),this.hasListener(k_.ADDFEATURE)){o=0;for(var d=n.length;o<d;o++)this.dispatchEvent(new U_(k_.ADDFEATURE,n[o]))}},e.prototype.bindFeaturesCollection_=function(t){var e=!1;this.addEventListener(k_.ADDFEATURE,(function(n){e||(e=!0,t.push(n.feature),e=!1)})),this.addEventListener(k_.REMOVEFEATURE,(function(n){e||(e=!0,t.remove(n.feature),e=!1)})),t.addEventListener(Bn,function(t){e||(e=!0,this.addFeature(t.element),e=!1)}.bind(this)),t.addEventListener(jn,function(t){e||(e=!0,this.removeFeature(t.element),e=!1)}.bind(this)),this.featuresCollection_=t},e.prototype.clear=function(t){if(t){for(var e in this.featureChangeKeys_){this.featureChangeKeys_[e].forEach(fe)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){var n=function(t){this.removeFeatureInternal(t)}.bind(this);for(var r in this.featuresRtree_.forEach(n),this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[r])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};var o=new U_(k_.CLEAR);this.dispatchEvent(o),this.changed()},e.prototype.forEachFeature=function(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)},e.prototype.forEachFeatureAtCoordinateDirect=function(t,e){var n=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(n,(function(n){return n.getGeometry().intersectsCoordinate(t)?e(n):void 0}))},e.prototype.forEachFeatureInExtent=function(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)},e.prototype.forEachFeatureIntersectingExtent=function(t,e){return this.forEachFeatureInExtent(t,(function(n){if(n.getGeometry().intersectsExtent(t)){var r=e(n);if(r)return r}}))},e.prototype.getFeaturesCollection=function(){return this.featuresCollection_},e.prototype.getFeatures=function(){var t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),se(this.nullGeometryFeatures_)||d(t,ae(this.nullGeometryFeatures_))),t},e.prototype.getFeaturesAtCoordinate=function(t){var e=[];return this.forEachFeatureAtCoordinateDirect(t,(function(t){e.push(t)})),e},e.prototype.getFeaturesInExtent=function(t){return this.featuresRtree_?this.featuresRtree_.getInExtent(t):this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]},e.prototype.getClosestFeatureToCoordinate=function(t,e){var n=t[0],r=t[1],o=null,i=[NaN,NaN],a=1/0,s=[-1/0,-1/0,1/0,1/0],l=e||g;return this.featuresRtree_.forEachInExtent(s,(function(t){if(l(t)){var e=t.getGeometry(),c=a;if((a=e.closestPointXY(n,r,i,a))<c){o=t;var u=Math.sqrt(a);s[0]=n-u,s[1]=r-u,s[2]=n+u,s[3]=r+u}}})),o},e.prototype.getExtent=function(t){return this.featuresRtree_.getExtent(t)},e.prototype.getFeatureById=function(t){var e=this.idIndex_[t.toString()];return void 0!==e?e:null},e.prototype.getFeatureByUid=function(t){var e=this.uidIndex_[t];return void 0!==e?e:null},e.prototype.getFormat=function(){return this.format_},e.prototype.getOverlaps=function(){return this.overlaps_},e.prototype.getUrl=function(){return this.url_},e.prototype.handleFeatureChange_=function(t){var e=t.target,n=i(e),r=e.getGeometry();if(r){var o=r.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(o,e)):this.featuresRtree_&&this.featuresRtree_.update(o,e)}else n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[n]=e);var a=e.getId();if(void 0!==a){var s=a.toString();this.idIndex_[s]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[s]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[n]=e;this.changed(),this.dispatchEvent(new U_(k_.CHANGEFEATURE,e))},e.prototype.hasFeature=function(t){var e=t.getId();return void 0!==e?e in this.idIndex_:i(t)in this.uidIndex_},e.prototype.isEmpty=function(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&se(this.nullGeometryFeatures_):!this.featuresCollection_||0===this.featuresCollection_.getLength()},e.prototype.loadFeatures=function(t,e,n){for(var r=this.loadedExtentsRtree_,o=this.strategy_(t,e,n),i=function(t,i){var s=o[t];r.forEachInExtent(s,(function(t){return nt(t.extent,s)}))||(++a.loadingExtentsCount_,a.dispatchEvent(new U_(k_.FEATURESLOADSTART)),a.loader_.call(a,s,e,n,function(t){--this.loadingExtentsCount_,this.dispatchEvent(new U_(k_.FEATURESLOADEND,void 0,t))}.bind(a),function(){--this.loadingExtentsCount_,this.dispatchEvent(new U_(k_.FEATURESLOADERROR))}.bind(a)),r.insert(s,{extent:s.slice()}))},a=this,s=0,l=o.length;s<l;++s)i(s);this.loading=!(this.loader_.length<4)&&this.loadingExtentsCount_>0},e.prototype.refresh=function(){this.clear(!0),this.loadedExtentsRtree_.clear(),t.prototype.refresh.call(this)},e.prototype.removeLoadedExtent=function(t){var e,n=this.loadedExtentsRtree_;n.forEachInExtent(t,(function(n){if(ut(n.extent,t))return e=n,!0})),e&&n.remove(e)},e.prototype.removeFeature=function(t){if(t){var e=i(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t)&&this.changed()}},e.prototype.removeFeatureInternal=function(t){var e=i(t),n=this.featureChangeKeys_[e];if(n){n.forEach(fe),delete this.featureChangeKeys_[e];var r=t.getId();return void 0!==r&&delete this.idIndex_[r.toString()],delete this.uidIndex_[e],this.dispatchEvent(new U_(k_.REMOVEFEATURE,t)),t}},e.prototype.removeFromIdIndex_=function(t){var e=!1;for(var n in this.idIndex_)if(this.idIndex_[n]===t){delete this.idIndex_[n],e=!0;break}return e},e.prototype.setLoader=function(t){this.loader_=t},e.prototype.setUrl=function(t){x(this.format_,7),this.url_=t,this.setLoader(Ll(t,this.format_))},e}(D_);const B_=G_;var j_=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),W_="Point",q_="LineString",H_="Polygon",V_="Circle",z_="drawstart",Y_="drawend",K_="drawabort",X_=function(t){function e(e,n){var r=t.call(this,e)||this;return r.feature=n,r}return j_(e,t),e}(ne),$_=function(t){function e(e){var n=this,r=e;r.stopDown||(r.stopDown=y),(n=t.call(this,r)||this).on,n.once,n.un,n.shouldHandle_=!1,n.downPx_=null,n.downTimeout_,n.lastDragTime_,n.pointerType_,n.freehand_=!1,n.source_=e.source?e.source:null,n.features_=e.features?e.features:null,n.snapTolerance_=e.snapTolerance?e.snapTolerance:12,n.type_=e.type,n.mode_=function(t){switch(t){case br.POINT:case br.MULTI_POINT:return W_;case br.LINE_STRING:case br.MULTI_LINE_STRING:return q_;case br.POLYGON:case br.MULTI_POLYGON:return H_;case br.CIRCLE:return V_;default:throw new Error("Invalid type: "+t)}}(n.type_),n.stopClick_=!!e.stopClick,n.minPoints_=e.minPoints?e.minPoints:n.mode_===H_?3:2,n.maxPoints_=n.mode_===V_?2:e.maxPoints?e.maxPoints:1/0,n.finishCondition_=e.finishCondition?e.finishCondition:g;var o,i=e.geometryFunction;if(!i){var a,s=n.mode_;if(s===V_)i=function(t,e,n){var r=e||new ml([NaN,NaN]),o=wo(t[0],n),i=He(o,wo(t[t.length-1],n));r.setCenterAndRadius(o,Math.sqrt(i));var a=Co();return a&&r.transform(n,a),r};else s===W_?a=_i:s===q_?a=al:s===H_&&(a=Zi),i=function(t,e,n){return e?s===H_?t[0].length?e.setCoordinates([t[0].concat([t[0][0]])]):e.setCoordinates([]):e.setCoordinates(t):e=new a(t),e}}return n.geometryFunction_=i,n.dragVertexDelay_=void 0!==e.dragVertexDelay?e.dragVertexDelay:500,n.finishCoordinate_=null,n.sketchFeature_=null,n.sketchPoint_=null,n.sketchCoords_=null,n.sketchLine_=null,n.sketchLineCoords_=null,n.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,n.overlay_=new x_({source:new B_({useSpatialIndex:!1,wrapX:!!e.wrapX&&e.wrapX}),style:e.style?e.style:(o=Jh(),function(t,e){return o[t.getGeometry().getType()]}),updateWhileInteracting:!0}),n.geometryName_=e.geometryName,n.condition_=e.condition?e.condition:wa,n.freehandCondition_,e.freehand?n.freehandCondition_=va:n.freehandCondition_=e.freehandCondition?e.freehandCondition:Sa,n.addChangeListener(ia,n.updateState_),n}return j_(e,t),e.prototype.setMap=function(e){t.prototype.setMap.call(this,e),this.updateState_()},e.prototype.getOverlay=function(){return this.overlay_},e.prototype.handleEvent=function(e){e.originalEvent.type===pe.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!==W_&&this.freehandCondition_(e);var n=e.type===rr.POINTERMOVE,r=!0;!this.freehand_&&this.lastDragTime_&&e.type===rr.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,n=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0));return this.freehand_&&e.type===rr.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(e.coordinate),r=!1):this.freehand_&&e.type===rr.POINTERDOWN?r=!1:n&&this.getPointerCount()<2?(r=e.type===rr.POINTERMOVE)&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):("mouse"===e.originalEvent.pointerType||e.type===rr.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(e):e.type===rr.DBLCLICK&&(r=!1),t.prototype.handleEvent.call(this,e)&&r},e.prototype.handleDownEvent=function(t){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=t.pixel,this.finishCoordinate_||this.startDrawing_(t.coordinate),!0):this.condition_(t)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(function(){this.handlePointerMove_(new nr(rr.POINTERMOVE,t.map,t.originalEvent,!1,t.frameState))}.bind(this),this.dragVertexDelay_),this.downPx_=t.pixel,!0):(this.lastDragTime_=void 0,!1)},e.prototype.handleUpEvent=function(t){var e=!0;if(0===this.getPointerCount())if(this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(t),this.shouldHandle_){var n=!this.finishCoordinate_;n&&this.startDrawing_(t.coordinate),!n&&this.freehand_?this.finishDrawing():this.freehand_||n&&this.mode_!==W_||(this.atFinish_(t.pixel)?this.finishCondition_(t)&&this.finishDrawing():this.addToDrawing_(t.coordinate)),e=!1}else this.freehand_&&this.abortDrawing();return!e&&this.stopClick_&&t.preventDefault(),e},e.prototype.handlePointerMove_=function(t){if(this.pointerType_=t.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){var e=this.downPx_,n=t.pixel,r=e[0]-n[0],o=e[1]-n[1],i=r*r+o*o;if(this.shouldHandle_=this.freehand_?i>this.squaredClickTolerance_:i<=this.squaredClickTolerance_,!this.shouldHandle_)return}this.finishCoordinate_?this.modifyDrawing_(t.coordinate):this.createOrUpdateSketchPoint_(t.coordinate.slice())},e.prototype.atFinish_=function(t){var e=!1;if(this.sketchFeature_){var n=!1,r=[this.finishCoordinate_],o=this.mode_;if(o===W_)e=!0;else if(o===V_)e=2===this.sketchCoords_.length;else if(o===q_)n=this.sketchCoords_.length>this.minPoints_;else if(o===H_){var i=this.sketchCoords_;n=i[0].length>this.minPoints_,r=[i[0][0],i[0][i[0].length-2]]}if(n)for(var a=this.getMap(),s=0,l=r.length;s<l;s++){var c=r[s],u=a.getPixelFromCoordinate(c),p=t[0]-u[0],d=t[1]-u[1],h=this.freehand_?1:this.snapTolerance_;if(e=Math.sqrt(p*p+d*d)<=h){this.finishCoordinate_=c;break}}}return e},e.prototype.createOrUpdateSketchPoint_=function(t){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(t):(this.sketchPoint_=new Xs(new _i(t)),this.updateSketchFeatures_())},e.prototype.createOrUpdateCustomSketchLine_=function(t){this.sketchLine_||(this.sketchLine_=new Xs);var e=t.getLinearRing(0),n=this.sketchLine_.getGeometry();n?(n.setFlatCoordinates(e.getLayout(),e.getFlatCoordinates()),n.changed()):(n=new al(e.getFlatCoordinates(),e.getLayout()),this.sketchLine_.setGeometry(n))},e.prototype.startDrawing_=function(t){var e=this.getMap().getView().getProjection();this.finishCoordinate_=t,this.mode_===W_?this.sketchCoords_=t.slice():this.mode_===H_?(this.sketchCoords_=[[t.slice(),t.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[t.slice(),t.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Xs(new al(this.sketchLineCoords_)));var n=this.geometryFunction_(this.sketchCoords_,void 0,e);this.sketchFeature_=new Xs,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(n),this.updateSketchFeatures_(),this.dispatchEvent(new X_(z_,this.sketchFeature_))},e.prototype.modifyDrawing_=function(t){var e,n,r=this.getMap(),o=this.sketchFeature_.getGeometry(),i=r.getView().getProjection();(this.mode_===W_?n=this.sketchCoords_:this.mode_===H_?(n=(e=this.sketchCoords_[0])[e.length-1],this.atFinish_(r.getPixelFromCoordinate(t))&&(t=this.finishCoordinate_.slice())):n=(e=this.sketchCoords_)[e.length-1],n[0]=t[0],n[1]=t[1],this.geometryFunction_(this.sketchCoords_,o,i),this.sketchPoint_)&&this.sketchPoint_.getGeometry().setCoordinates(t);if(o.getType()===br.POLYGON&&this.mode_!==H_)this.createOrUpdateCustomSketchLine_(o);else if(this.sketchLineCoords_){this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_)}this.updateSketchFeatures_()},e.prototype.addToDrawing_=function(t){var e,n,r=this.sketchFeature_.getGeometry(),o=this.getMap().getView().getProjection(),i=this.mode_;i===q_||i===V_?(this.finishCoordinate_=t.slice(),(n=this.sketchCoords_).length>=this.maxPoints_&&(this.freehand_?n.pop():e=!0),n.push(t.slice()),this.geometryFunction_(n,r,o)):i===H_&&((n=this.sketchCoords_[0]).length>=this.maxPoints_&&(this.freehand_?n.pop():e=!0),n.push(t.slice()),e&&(this.finishCoordinate_=n[0]),this.geometryFunction_(this.sketchCoords_,r,o)),this.createOrUpdateSketchPoint_(t.slice()),this.updateSketchFeatures_(),e&&this.finishDrawing()},e.prototype.removeLastPoint=function(){if(this.sketchFeature_){var t,e=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection(),r=this.mode_;if(r===q_||r===V_){if((t=this.sketchCoords_).splice(-2,1),t.length>=2){this.finishCoordinate_=t[t.length-2].slice();var o=this.finishCoordinate_.slice();t[t.length-1]=o,this.createOrUpdateSketchPoint_(o)}this.geometryFunction_(t,e,n),e.getType()===br.POLYGON&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(e)}else if(r===H_){(t=this.sketchCoords_[0]).splice(-2,1);var i=this.sketchLine_.getGeometry();if(t.length>=2){o=t[t.length-2].slice();t[t.length-1]=o,this.createOrUpdateSketchPoint_(o)}i.setCoordinates(t),this.geometryFunction_(this.sketchCoords_,e,n)}1===t.length&&this.abortDrawing(),this.updateSketchFeatures_()}},e.prototype.finishDrawing=function(){var t=this.abortDrawing_();if(t){var e=this.sketchCoords_,n=t.getGeometry(),r=this.getMap().getView().getProjection();this.mode_===q_?(e.pop(),this.geometryFunction_(e,n,r)):this.mode_===H_&&(e[0].pop(),this.geometryFunction_(e,n,r),e=n.getCoordinates()),this.type_===br.MULTI_POINT?t.setGeometry(new Qs([e])):this.type_===br.MULTI_LINE_STRING?t.setGeometry(new cl([e])):this.type_===br.MULTI_POLYGON&&t.setGeometry(new dl([e])),this.dispatchEvent(new X_(Y_,t)),this.features_&&this.features_.push(t),this.source_&&this.source_.addFeature(t)}},e.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var t=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),t},e.prototype.abortDrawing=function(){var t=this.abortDrawing_();t&&this.dispatchEvent(new X_(K_,t))},e.prototype.appendCoordinates=function(t){var e,n=this.mode_,r=!this.sketchFeature_;if(r&&this.startDrawing_(t[0]),n===q_||n===V_)e=this.sketchCoords_;else{if(n!==H_)return;e=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]}r&&e.shift(),e.pop();for(var o=0;o<t.length;o++)this.addToDrawing_(t[o]);var i=t[t.length-1];this.addToDrawing_(i),this.modifyDrawing_(i)},e.prototype.extend=function(t){var e=t.getGeometry();this.sketchFeature_=t,this.sketchCoords_=e.getCoordinates();var n=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=n.slice(),this.sketchCoords_.push(n.slice()),this.sketchPoint_=new Xs(new _i(n)),this.updateSketchFeatures_(),this.dispatchEvent(new X_(z_,this.sketchFeature_))},e.prototype.updateSketchFeatures_=function(){var t=[];this.sketchFeature_&&t.push(this.sketchFeature_),this.sketchLine_&&t.push(this.sketchLine_),this.sketchPoint_&&t.push(this.sketchPoint_);var e=this.overlay_.getSource();e.clear(!0),e.addFeatures(t)},e.prototype.updateState_=function(){var t=this.getMap(),e=this.getActive();t&&e||this.abortDrawing(),this.overlay_.setMap(e?t:null)},e}(fa);const J_=$_;var Q_=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),tC="translatestart",eC="translating",nC="translateend",rC=function(t){function e(e,n,r,o,i){var a=t.call(this,e)||this;return a.features=n,a.coordinate=r,a.startCoordinate=o,a.mapBrowserEvent=i,a}return Q_(e,t),e}(ne),oC=function(t){function e(e){var n,r=this,o=e||{};if((r=t.call(this,o)||this).on,r.once,r.un,r.lastCoordinate_=null,r.startCoordinate_=null,r.features_=void 0!==o.features?o.features:null,o.layers&&!r.features_)if("function"==typeof o.layers)n=o.layers;else{var i=o.layers;n=function(t){return c(i,t)}}else n=g;return r.layerFilter_=n,r.filter_=o.filter&&!r.features_?o.filter:g,r.hitTolerance_=o.hitTolerance?o.hitTolerance:0,r.condition_=o.condition?o.condition:va,r.lastFeature_=null,r.addChangeListener(ia,r.handleActiveChanged_),r}return Q_(e,t),e.prototype.handleDownEvent=function(t){if(!t.originalEvent||!this.condition_(t))return!1;if(this.lastFeature_=this.featuresAtPixel_(t.pixel,t.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=t.coordinate,this.lastCoordinate_=t.coordinate,this.handleMoveEvent(t);var e=this.features_||new Vn([this.lastFeature_]);return this.dispatchEvent(new rC(tC,e,t.coordinate,this.startCoordinate_,t)),!0}return!1},e.prototype.handleUpEvent=function(t){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(t);var e=this.features_||new Vn([this.lastFeature_]);return this.dispatchEvent(new rC(nC,e,t.coordinate,this.startCoordinate_,t)),this.startCoordinate_=null,!0}return!1},e.prototype.handleDragEvent=function(t){if(this.lastCoordinate_){var e=t.coordinate,n=e[0]-this.lastCoordinate_[0],r=e[1]-this.lastCoordinate_[1],o=this.features_||new Vn([this.lastFeature_]);o.forEach((function(t){var e=t.getGeometry();e.translate(n,r),t.setGeometry(e)})),this.lastCoordinate_=e,this.dispatchEvent(new rC(eC,o,e,this.startCoordinate_,t))}},e.prototype.handleMoveEvent=function(t){var e=t.map.getViewport();this.featuresAtPixel_(t.pixel,t.map)?(e.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),e.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):e.classList.remove("ol-grab","ol-grabbing")},e.prototype.featuresAtPixel_=function(t,e){return e.forEachFeatureAtPixel(t,function(t,e){if(this.filter_(t,e)&&(!this.features_||c(this.features_.getArray(),t)))return t}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})},e.prototype.getHitTolerance=function(){return this.hitTolerance_},e.prototype.setHitTolerance=function(t){this.hitTolerance_=t},e.prototype.setMap=function(e){var n=this.getMap();t.prototype.setMap.call(this,e),this.updateState_(n)},e.prototype.handleActiveChanged_=function(){this.updateState_(null)},e.prototype.updateState_=function(t){var e=this.getMap(),n=this.getActive();e&&n||(e=e||t)&&e.getViewport().classList.remove("ol-grab","ol-grabbing")},e}(fa);const iC=oC;var aC=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function sC(t){return t.feature?t.feature:t.element?t.element:void 0}var lC=[],cC=function(t){function e(e){var n=this,r=e||{},o=r;return o.handleDownEvent||(o.handleDownEvent=g),o.stopDown||(o.stopDown=y),(n=t.call(this,o)||this).source_=r.source?r.source:null,n.vertex_=void 0===r.vertex||r.vertex,n.edge_=void 0===r.edge||r.edge,n.features_=r.features?r.features:null,n.featuresListenerKeys_=[],n.featureChangeListenerKeys_={},n.indexedFeaturesExtents_={},n.pendingFeatures_={},n.pixelTolerance_=void 0!==r.pixelTolerance?r.pixelTolerance:10,n.rBush_=new M_,n.SEGMENT_WRITERS_={Point:n.writePointGeometry_.bind(n),LineString:n.writeLineStringGeometry_.bind(n),LinearRing:n.writeLineStringGeometry_.bind(n),Polygon:n.writePolygonGeometry_.bind(n),MultiPoint:n.writeMultiPointGeometry_.bind(n),MultiLineString:n.writeMultiLineStringGeometry_.bind(n),MultiPolygon:n.writeMultiPolygonGeometry_.bind(n),GeometryCollection:n.writeGeometryCollectionGeometry_.bind(n),Circle:n.writeCircleGeometry_.bind(n)},n}return aC(e,t),e.prototype.addFeature=function(t,e){var n=void 0===e||e,r=i(t),o=t.getGeometry();if(o){var a=this.SEGMENT_WRITERS_[o.getType()];a&&(this.indexedFeaturesExtents_[r]=o.getExtent([1/0,1/0,-1/0,-1/0]),a(t,o))}n&&(this.featureChangeListenerKeys_[r]=de(t,pe.CHANGE,this.handleFeatureChange_,this))},e.prototype.forEachFeatureAdd_=function(t){this.addFeature(t)},e.prototype.forEachFeatureRemove_=function(t){this.removeFeature(t)},e.prototype.getFeatures_=function(){var t;return this.features_?t=this.features_:this.source_&&(t=this.source_.getFeatures()),t},e.prototype.handleEvent=function(e){var n=this.snapTo(e.pixel,e.coordinate,e.map);return n.snapped&&(e.coordinate=n.vertex.slice(0,2),e.pixel=n.vertexPixel),t.prototype.handleEvent.call(this,e)},e.prototype.handleFeatureAdd_=function(t){var e=sC(t);this.addFeature(e)},e.prototype.handleFeatureRemove_=function(t){var e=sC(t);this.removeFeature(e)},e.prototype.handleFeatureChange_=function(t){var e=t.target;if(this.handlingDownUpSequence){var n=i(e);n in this.pendingFeatures_||(this.pendingFeatures_[n]=e)}else this.updateFeature_(e)},e.prototype.handleUpEvent=function(t){var e=ae(this.pendingFeatures_);return e.length&&(e.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1},e.prototype.removeFeature=function(t,e){var n=void 0===e||e,r=i(t),o=this.indexedFeaturesExtents_[r];if(o){var a=this.rBush_,s=[];a.forEachInExtent(o,(function(e){t===e.feature&&s.push(e)}));for(var l=s.length-1;l>=0;--l)a.remove(s[l])}n&&(fe(this.featureChangeListenerKeys_[r]),delete this.featureChangeListenerKeys_[r])},e.prototype.setMap=function(e){var n=this.getMap(),r=this.featuresListenerKeys_,o=this.getFeatures_();n&&(r.forEach(fe),r.length=0,o.forEach(this.forEachFeatureRemove_.bind(this))),t.prototype.setMap.call(this,e),e&&(this.features_?r.push(de(this.features_,Bn,this.handleFeatureAdd_,this),de(this.features_,jn,this.handleFeatureRemove_,this)):this.source_&&r.push(de(this.source_,k_.ADDFEATURE,this.handleFeatureAdd_,this),de(this.source_,k_.REMOVEFEATURE,this.handleFeatureRemove_,this)),o.forEach(this.forEachFeatureAdd_.bind(this)))},e.prototype.snapTo=function(t,e,n){var r=$([n.getCoordinateFromPixel([t[0]-this.pixelTolerance_,t[1]+this.pixelTolerance_]),n.getCoordinateFromPixel([t[0]+this.pixelTolerance_,t[1]-this.pixelTolerance_])]),o=this.rBush_.getInExtent(r);this.vertex_&&!this.edge_&&(o=o.filter((function(t){return t.feature.getGeometry().getType()!==br.CIRCLE})));var i=!1,a=null,s=null;if(0===o.length)return{snapped:i,vertex:a,vertexPixel:s};for(var l,c=n.getView().getProjection(),u=wo(e,c),p=1/0,d=0;d<o.length;++d){var h=o[d];lC[0]=wo(h.segment[0],c),lC[1]=wo(h.segment[1],c);var f=ze(u,lC);f<p&&(l=h,p=f)}var m=l.segment;if(this.vertex_&&!this.edge_){var g=n.getPixelFromCoordinate(m[0]),y=n.getPixelFromCoordinate(m[1]),v=He(t,g),_=He(t,y);Math.sqrt(Math.min(v,_))<=this.pixelTolerance_&&(i=!0,a=v>_?m[1]:m[0],s=n.getPixelFromCoordinate(a))}else if(this.edge_){var C=l.feature.getGeometry().getType()===br.CIRCLE;if(C){var E=l.feature.getGeometry(),w=Co();w&&(E=E.clone().transform(w,c)),a=Eo(function(t,e){var n=e.getRadius(),r=e.getCenter(),o=r[0],i=r[1],a=t[0]-o,s=t[1]-i;0===a&&0===s&&(a=1);var l=Math.sqrt(a*a+s*s);return[o+n*a/l,i+n*s/l]}(u,E),c)}else lC[0]=wo(m[0],c),lC[1]=wo(m[1],c),a=Eo(Be(u,lC),c);if(Ve(t,s=n.getPixelFromCoordinate(a))<=this.pixelTolerance_&&(i=!0,this.vertex_&&!C)){g=n.getPixelFromCoordinate(m[0]),y=n.getPixelFromCoordinate(m[1]),v=He(s,g),_=He(s,y);Math.sqrt(Math.min(v,_))<=this.pixelTolerance_&&(a=v>_?m[1]:m[0],s=n.getPixelFromCoordinate(a))}}return i&&(s=[Math.round(s[0]),Math.round(s[1])]),{snapped:i,vertex:a,vertexPixel:s}},e.prototype.updateFeature_=function(t){this.removeFeature(t,!1),this.addFeature(t,!1)},e.prototype.writeCircleGeometry_=function(t,e){var n=this.getMap().getView().getProjection(),r=e,o=Co();o&&(r=r.clone().transform(o,n));var i=ki(r);o&&i.transform(n,o);for(var a=i.getCoordinates()[0],s=0,l=a.length-1;s<l;++s){var c=a.slice(s,s+2),u={feature:t,segment:c};this.rBush_.insert($(c),u)}},e.prototype.writeGeometryCollectionGeometry_=function(t,e){for(var n=e.getGeometriesArray(),r=0;r<n.length;++r){var o=this.SEGMENT_WRITERS_[n[r].getType()];o&&o(t,n[r])}},e.prototype.writeLineStringGeometry_=function(t,e){for(var n=e.getCoordinates(),r=0,o=n.length-1;r<o;++r){var i=n.slice(r,r+2),a={feature:t,segment:i};this.rBush_.insert($(i),a)}},e.prototype.writeMultiLineStringGeometry_=function(t,e){for(var n=e.getCoordinates(),r=0,o=n.length;r<o;++r)for(var i=n[r],a=0,s=i.length-1;a<s;++a){var l=i.slice(a,a+2),c={feature:t,segment:l};this.rBush_.insert($(l),c)}},e.prototype.writeMultiPointGeometry_=function(t,e){for(var n=e.getCoordinates(),r=0,o=n.length;r<o;++r){var i=n[r],a={feature:t,segment:[i,i]};this.rBush_.insert(e.getExtent(),a)}},e.prototype.writeMultiPolygonGeometry_=function(t,e){for(var n=e.getCoordinates(),r=0,o=n.length;r<o;++r)for(var i=n[r],a=0,s=i.length;a<s;++a)for(var l=i[a],c=0,u=l.length-1;c<u;++c){var p=l.slice(c,c+2),d={feature:t,segment:p};this.rBush_.insert($(p),d)}},e.prototype.writePointGeometry_=function(t,e){var n=e.getCoordinates(),r={feature:t,segment:[n,n]};this.rBush_.insert(e.getExtent(),r)},e.prototype.writePolygonGeometry_=function(t,e){for(var n=e.getCoordinates(),r=0,o=n.length;r<o;++r)for(var i=n[r],a=0,s=i.length-1;a<s;++a){var l=i.slice(a,a+2),c={feature:t,segment:l};this.rBush_.insert($(l),c)}},e}(fa);const uC=cC;var pC=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),dC="select",hC=function(t){function e(e,n,r,o){var i=t.call(this,e)||this;return i.selected=n,i.deselected=r,i.mapBrowserEvent=o,i}return pC(e,t),e}(ne),fC={},mC=function(t){function e(e){var n=t.call(this)||this;n.on,n.once,n.un;var r,o,i=e||{};if(n.boundAddFeature_=n.addFeature_.bind(n),n.boundRemoveFeature_=n.removeFeature_.bind(n),n.condition_=i.condition?i.condition:Ea,n.addCondition_=i.addCondition?i.addCondition:Ca,n.removeCondition_=i.removeCondition?i.removeCondition:Ca,n.toggleCondition_=i.toggleCondition?i.toggleCondition:Sa,n.multi_=!!i.multi&&i.multi,n.filter_=i.filter?i.filter:g,n.hitTolerance_=i.hitTolerance?i.hitTolerance:0,n.style_=void 0!==i.style?i.style:(d((r=Jh())[br.POLYGON],r[br.LINE_STRING]),d(r[br.GEOMETRY_COLLECTION],r[br.LINE_STRING]),function(t){return t.getGeometry()?r[t.getGeometry().getType()]:null}),n.features_=i.features||new Vn,i.layers)if("function"==typeof i.layers)o=i.layers;else{var a=i.layers;o=function(t){return c(a,t)}}else o=g;return n.layerFilter_=o,n.featureLayerAssociation_={},n}return pC(e,t),e.prototype.addFeatureLayerAssociation_=function(t,e){this.featureLayerAssociation_[i(t)]=e},e.prototype.getFeatures=function(){return this.features_},e.prototype.getHitTolerance=function(){return this.hitTolerance_},e.prototype.getLayer=function(t){return this.featureLayerAssociation_[i(t)]},e.prototype.setHitTolerance=function(t){this.hitTolerance_=t},e.prototype.setMap=function(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),t.prototype.setMap.call(this,e),e?(this.features_.addEventListener(Bn,this.boundAddFeature_),this.features_.addEventListener(jn,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(Bn,this.boundAddFeature_),this.features_.removeEventListener(jn,this.boundRemoveFeature_))},e.prototype.addFeature_=function(t){var e=t.element;if(this.style_&&this.applySelectedStyle_(e),!this.getLayer(e)){var n=this.getMap().getAllLayers().find((function(t){if(t instanceof x_&&t.getSource()&&t.getSource().hasFeature(e))return t}));n&&this.addFeatureLayerAssociation_(e,n)}},e.prototype.removeFeature_=function(t){var e=t.element;this.style_&&this.restorePreviousStyle_(e)},e.prototype.getStyle=function(){return this.style_},e.prototype.applySelectedStyle_=function(t){var e=i(t);e in fC||(fC[e]=t.getStyle()),t.setStyle(this.style_)},e.prototype.restorePreviousStyle_=function(t){for(var n=this.getMap().getInteractions().getArray(),r=n.length-1;r>=0;--r){var o=n[r];if(o!==this&&o instanceof e&&o.getStyle()&&-1!==o.getFeatures().getArray().lastIndexOf(t))return void t.setStyle(o.getStyle())}var a=i(t);t.setStyle(fC[a]),delete fC[a]},e.prototype.removeFeatureLayerAssociation_=function(t){delete this.featureLayerAssociation_[i(t)]},e.prototype.handleEvent=function(t){if(!this.condition_(t))return!0;var e=this.addCondition_(t),n=this.removeCondition_(t),r=this.toggleCondition_(t),o=!e&&!n&&!r,i=t.map,a=this.getFeatures(),s=[],l=[];if(o){ie(this.featureLayerAssociation_),i.forEachFeatureAtPixel(t.pixel,function(t,e){if(this.filter_(t,e))return this.addFeatureLayerAssociation_(t,e),l.push(t),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var u=a.getLength()-1;u>=0;--u){var p=a.item(u),d=l.indexOf(p);d>-1?l.splice(d,1):(a.remove(p),s.push(p))}0!==l.length&&a.extend(l)}else{i.forEachFeatureAtPixel(t.pixel,function(t,o){if(this.filter_(t,o))return!e&&!r||c(a.getArray(),t)?(n||r)&&c(a.getArray(),t)&&(s.push(t),this.removeFeatureLayerAssociation_(t)):(this.addFeatureLayerAssociation_(t,o),l.push(t)),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var h=s.length-1;h>=0;--h)a.remove(s[h]);a.extend(l)}return(l.length>0||s.length>0)&&this.dispatchEvent(new hC(dC,l,s,t)),!0},e}(la);const gC=mC;var yC=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),vC=[0,0,0,0],_C=[],CC="modifystart",EC="modifyend",wC=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.features=n,o.mapBrowserEvent=r,o}return yC(e,t),e}(ne),SC=function(t){function e(e){var n,r,o=t.call(this,e)||this;if(o.on,o.once,o.un,o.boundHandleFeatureChange_=o.handleFeatureChange_.bind(o),o.condition_=e.condition?e.condition:Ta,o.defaultDeleteCondition_=function(t){return function(t){var e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey}(t)&&Ea(t)},o.deleteCondition_=e.deleteCondition?e.deleteCondition:o.defaultDeleteCondition_,o.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:va,o.vertexFeature_=null,o.vertexSegments_=null,o.lastPixel_=[0,0],o.ignoreNextSingleClick_=!1,o.featuresBeingModified_=null,o.rBush_=new M_,o.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,o.snappedToVertex_=!1,o.changingFeature_=!1,o.dragSegments_=[],o.overlay_=new x_({source:new B_({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:(n=Jh(),function(t,e){return n[br.POINT]}),updateWhileAnimating:!0,updateWhileInteracting:!0}),o.SEGMENT_WRITERS_={Point:o.writePointGeometry_.bind(o),LineString:o.writeLineStringGeometry_.bind(o),LinearRing:o.writeLineStringGeometry_.bind(o),Polygon:o.writePolygonGeometry_.bind(o),MultiPoint:o.writeMultiPointGeometry_.bind(o),MultiLineString:o.writeMultiLineStringGeometry_.bind(o),MultiPolygon:o.writeMultiPolygonGeometry_.bind(o),Circle:o.writeCircleGeometry_.bind(o),GeometryCollection:o.writeGeometryCollectionGeometry_.bind(o)},o.source_=null,o.hitDetection_=null,e.features?r=e.features:e.source&&(o.source_=e.source,r=new Vn(o.source_.getFeatures()),o.source_.addEventListener(k_.ADDFEATURE,o.handleSourceAdd_.bind(o)),o.source_.addEventListener(k_.REMOVEFEATURE,o.handleSourceRemove_.bind(o))),!r)throw new Error("The modify interaction requires features, a source or a layer");return e.hitDetection&&(o.hitDetection_=e.hitDetection),o.features_=r,o.features_.forEach(o.addFeature_.bind(o)),o.features_.addEventListener(Bn,o.handleFeatureAdd_.bind(o)),o.features_.addEventListener(jn,o.handleFeatureRemove_.bind(o)),o.lastPointerEvent_=null,o.delta_=[0,0],o.snapToPointer_=void 0===e.snapToPointer?!o.hitDetection_:e.snapToPointer,o}return yC(e,t),e.prototype.addFeature_=function(t){var e=t.getGeometry();if(e){var n=this.SEGMENT_WRITERS_[e.getType()];n&&n(t,e)}var r=this.getMap();r&&r.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,r),t.addEventListener(pe.CHANGE,this.boundHandleFeatureChange_)},e.prototype.willModifyFeatures_=function(t,e){if(!this.featuresBeingModified_){this.featuresBeingModified_=new Vn;for(var n=this.featuresBeingModified_.getArray(),r=0,o=e.length;r<o;++r)for(var i=e[r],a=0,s=i.length;a<s;++a){var l=i[a].feature;l&&-1===n.indexOf(l)&&this.featuresBeingModified_.push(l)}0===this.featuresBeingModified_.getLength()?this.featuresBeingModified_=null:this.dispatchEvent(new wC(CC,this.featuresBeingModified_,t))}},e.prototype.removeFeature_=function(t){this.removeFeatureSegmentData_(t),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.removeEventListener(pe.CHANGE,this.boundHandleFeatureChange_)},e.prototype.removeFeatureSegmentData_=function(t){var e=this.rBush_,n=[];e.forEach((function(e){t===e.feature&&n.push(e)}));for(var r=n.length-1;r>=0;--r){for(var o=n[r],i=this.dragSegments_.length-1;i>=0;--i)this.dragSegments_[i][0]===o&&this.dragSegments_.splice(i,1);e.remove(o)}},e.prototype.setActive=function(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.prototype.setActive.call(this,e)},e.prototype.setMap=function(e){this.overlay_.setMap(e),t.prototype.setMap.call(this,e)},e.prototype.getOverlay=function(){return this.overlay_},e.prototype.handleSourceAdd_=function(t){t.feature&&this.features_.push(t.feature)},e.prototype.handleSourceRemove_=function(t){t.feature&&this.features_.remove(t.feature)},e.prototype.handleFeatureAdd_=function(t){this.addFeature_(t.element)},e.prototype.handleFeatureChange_=function(t){if(!this.changingFeature_){var e=t.target;this.removeFeature_(e),this.addFeature_(e)}},e.prototype.handleFeatureRemove_=function(t){var e=t.element;this.removeFeature_(e)},e.prototype.writePointGeometry_=function(t,e){var n=e.getCoordinates(),r={feature:t,geometry:e,segment:[n,n]};this.rBush_.insert(e.getExtent(),r)},e.prototype.writeMultiPointGeometry_=function(t,e){for(var n=e.getCoordinates(),r=0,o=n.length;r<o;++r){var i=n[r],a={feature:t,geometry:e,depth:[r],index:r,segment:[i,i]};this.rBush_.insert(e.getExtent(),a)}},e.prototype.writeLineStringGeometry_=function(t,e){for(var n=e.getCoordinates(),r=0,o=n.length-1;r<o;++r){var i=n.slice(r,r+2),a={feature:t,geometry:e,index:r,segment:i};this.rBush_.insert($(i),a)}},e.prototype.writeMultiLineStringGeometry_=function(t,e){for(var n=e.getCoordinates(),r=0,o=n.length;r<o;++r)for(var i=n[r],a=0,s=i.length-1;a<s;++a){var l=i.slice(a,a+2),c={feature:t,geometry:e,depth:[r],index:a,segment:l};this.rBush_.insert($(l),c)}},e.prototype.writePolygonGeometry_=function(t,e){for(var n=e.getCoordinates(),r=0,o=n.length;r<o;++r)for(var i=n[r],a=0,s=i.length-1;a<s;++a){var l=i.slice(a,a+2),c={feature:t,geometry:e,depth:[r],index:a,segment:l};this.rBush_.insert($(l),c)}},e.prototype.writeMultiPolygonGeometry_=function(t,e){for(var n=e.getCoordinates(),r=0,o=n.length;r<o;++r)for(var i=n[r],a=0,s=i.length;a<s;++a)for(var l=i[a],c=0,u=l.length-1;c<u;++c){var p=l.slice(c,c+2),d={feature:t,geometry:e,depth:[a,r],index:c,segment:p};this.rBush_.insert($(p),d)}},e.prototype.writeCircleGeometry_=function(t,e){var n=e.getCenter(),r={feature:t,geometry:e,index:0,segment:[n,n]},o={feature:t,geometry:e,index:1,segment:[n,n]},i=[r,o];r.featureSegments=i,o.featureSegments=i,this.rBush_.insert(lt(n),r);var a=e,s=Co();if(s&&this.getMap()){var l=this.getMap().getView().getProjection();a=ki(a=a.clone().transform(s,l)).transform(l,s)}this.rBush_.insert(a.getExtent(),o)},e.prototype.writeGeometryCollectionGeometry_=function(t,e){for(var n=e.getGeometriesArray(),r=0;r<n.length;++r){var o=n[r];(0,this.SEGMENT_WRITERS_[o.getType()])(t,o)}},e.prototype.createOrUpdateVertexFeature_=function(t,e,n){var r=this.vertexFeature_;r?r.getGeometry().setCoordinates(t):(r=new Xs(new _i(t)),this.vertexFeature_=r,this.overlay_.getSource().addFeature(r));return r.set("features",e),r.set("geometries",n),r},e.prototype.handleEvent=function(e){return!e.originalEvent||(this.lastPointerEvent_=e,e.map.getView().getInteracting()||e.type!=rr.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(n=!(e.type!=rr.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),e.type==rr.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),t.prototype.handleEvent.call(this,e)&&!n);var n},e.prototype.handleDragEvent=function(t){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(t,this.dragSegments_);for(var e=[t.coordinate[0]+this.delta_[0],t.coordinate[1]+this.delta_[1]],n=[],r=[],o=0,i=this.dragSegments_.length;o<i;++o){var a=this.dragSegments_[o],s=a[0],l=s.feature;-1===n.indexOf(l)&&n.push(l);var c=s.geometry;-1===r.indexOf(c)&&r.push(c);for(var u=s.depth,p=void 0,d=s.segment,h=a[1];e.length<c.getStride();)e.push(d[h][e.length]);switch(c.getType()){case br.POINT:p=e,d[0]=e,d[1]=e;break;case br.MULTI_POINT:(p=c.getCoordinates())[s.index]=e,d[0]=e,d[1]=e;break;case br.LINE_STRING:(p=c.getCoordinates())[s.index+h]=e,d[h]=e;break;case br.MULTI_LINE_STRING:case br.POLYGON:(p=c.getCoordinates())[u[0]][s.index+h]=e,d[h]=e;break;case br.MULTI_POLYGON:(p=c.getCoordinates())[u[1]][u[0]][s.index+h]=e,d[h]=e;break;case br.CIRCLE:if(d[0]=e,d[1]=e,0===s.index)this.changingFeature_=!0,c.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0;var f=t.map.getView().getProjection(),m=Ve(wo(c.getCenter(),f),wo(e,f)),g=Co();if(g){var y=c.clone().transform(g,f);y.setRadius(m),m=y.transform(f,g).getRadius()}c.setRadius(m),this.changingFeature_=!1}}p&&this.setGeometryCoordinates_(c,p)}this.createOrUpdateVertexFeature_(e,n,r)},e.prototype.handleDownEvent=function(t){if(!this.condition_(t))return!1;var e=t.coordinate;this.handlePointerAtPixel_(t.pixel,t.map,e),this.dragSegments_.length=0,this.featuresBeingModified_=null;var n=this.vertexFeature_;if(n){var r=t.map.getView().getProjection(),o=[],a=n.getGeometry().getCoordinates(),s=$([a]),l=this.rBush_.getInExtent(s),c={};l.sort(bC);for(var u=0,p=l.length;u<p;++u){var d=l[u],h=d.segment,f=i(d.geometry),m=d.depth;if(m&&(f+="-"+m.join("-")),c[f]||(c[f]=new Array(2)),d.geometry.getType()!==br.CIRCLE||1!==d.index)if(!je(h[0],a)||c[f][0])if(!je(h[1],a)||c[f][1])i(h)in this.vertexSegments_&&!c[f][0]&&!c[f][1]&&this.insertVertexCondition_(t)&&o.push(d);else{if((d.geometry.getType()===br.LINE_STRING||d.geometry.getType()===br.MULTI_LINE_STRING)&&c[f][0]&&0===c[f][0].index)continue;this.dragSegments_.push([d,1]),c[f][1]=d}else this.dragSegments_.push([d,0]),c[f][0]=d;else je(PC(e,d,r),a)&&!c[f][0]&&(this.dragSegments_.push([d,0]),c[f][0]=d)}o.length&&this.willModifyFeatures_(t,[o]);for(var g=o.length-1;g>=0;--g)this.insertVertex_(o[g],a)}return!!this.vertexFeature_},e.prototype.handleUpEvent=function(t){for(var e=this.dragSegments_.length-1;e>=0;--e){var n=this.dragSegments_[e][0],r=n.geometry;if(r.getType()===br.CIRCLE){var o=r.getCenter(),i=n.featureSegments[0],a=n.featureSegments[1];i.segment[0]=o,i.segment[1]=o,a.segment[0]=o,a.segment[1]=o,this.rBush_.update(lt(o),i);var s=r,l=Co();if(l){var c=t.map.getView().getProjection();s=ki(s=s.clone().transform(l,c)).transform(c,l)}this.rBush_.update(s.getExtent(),a)}else this.rBush_.update($(n.segment),n)}return this.featuresBeingModified_&&(this.dispatchEvent(new wC(EC,this.featuresBeingModified_,t)),this.featuresBeingModified_=null),!1},e.prototype.handlePointerMove_=function(t){this.lastPixel_=t.pixel,this.handlePointerAtPixel_(t.pixel,t.map,t.coordinate)},e.prototype.handlePointerAtPixel_=function(t,e,n){var r,o,a=this,s=n||e.getCoordinateFromPixel(t),l=e.getView().getProjection();if(this.hitDetection_){var u="object"==typeof this.hitDetection_?function(t){return t===a.hitDetection_}:void 0;e.forEachFeatureAtPixel(t,(function(t,e,n){if((n=n||t.getGeometry()).getType()===br.POINT&&c(a.features_.getArray(),t)){o=n;var i=n.getFlatCoordinates().slice(0,2);r=[{feature:t,geometry:n,segment:[i,i]}]}return!0}),{layerFilter:u})}if(!r){var p=So(J(bo(lt(s,vC),l),e.getView().getResolution()*this.pixelTolerance_,vC),l);r=this.rBush_.getInExtent(p)}if(r&&r.length>0){var d=r.sort((function(t,e){return LC(s,t,l)-LC(s,e,l)}))[0],h=d.segment,f=PC(s,d,l),m=e.getPixelFromCoordinate(f),g=Ve(t,m);if(o||g<=this.pixelTolerance_){var y={};if(y[i(h)]=!0,this.snapToPointer_||(this.delta_[0]=f[0]-s[0],this.delta_[1]=f[1]-s[1]),d.geometry.getType()===br.CIRCLE&&1===d.index)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(f,[d.feature],[d.geometry]);else{var v=e.getPixelFromCoordinate(h[0]),_=e.getPixelFromCoordinate(h[1]),C=He(m,v),E=He(m,_);g=Math.sqrt(Math.min(C,E)),this.snappedToVertex_=g<=this.pixelTolerance_,this.snappedToVertex_&&(f=C>E?h[1]:h[0]),this.createOrUpdateVertexFeature_(f,[d.feature],[d.geometry]);var w={};w[i(d.geometry)]=!0;for(var S=1,b=r.length;S<b;++S){var L=r[S].segment;if(!(je(h[0],L[0])&&je(h[1],L[1])||je(h[0],L[1])&&je(h[1],L[0])))break;var T=i(r[S].geometry);T in w||(w[T]=!0,y[i(L)]=!0)}}return void(this.vertexSegments_=y)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},e.prototype.insertVertex_=function(t,e){for(var n,r=t.segment,o=t.feature,i=t.geometry,a=t.depth,s=t.index;e.length<i.getStride();)e.push(0);switch(i.getType()){case br.MULTI_LINE_STRING:case br.POLYGON:(n=i.getCoordinates())[a[0]].splice(s+1,0,e);break;case br.MULTI_POLYGON:(n=i.getCoordinates())[a[1]][a[0]].splice(s+1,0,e);break;case br.LINE_STRING:(n=i.getCoordinates()).splice(s+1,0,e);break;default:return}this.setGeometryCoordinates_(i,n);var l=this.rBush_;l.remove(t),this.updateSegmentIndices_(i,s,a,1);var c={segment:[r[0],e],feature:o,geometry:i,depth:a,index:s};l.insert($(c.segment),c),this.dragSegments_.push([c,1]);var u={segment:[e,r[1]],feature:o,geometry:i,depth:a,index:s+1};l.insert($(u.segment),u),this.dragSegments_.push([u,0]),this.ignoreNextSingleClick_=!0},e.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=rr.POINTERDRAG){var t=this.lastPointerEvent_;this.willModifyFeatures_(t,this.dragSegments_);var e=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new wC(EC,this.featuresBeingModified_,t)),this.featuresBeingModified_=null,e}return!1},e.prototype.removeVertex_=function(){var t,e,n,r,o,a,s,l,c,u,p,d=this.dragSegments_,h={},f=!1;for(o=d.length-1;o>=0;--o)p=i((u=(n=d[o])[0]).feature),u.depth&&(p+="-"+u.depth.join("-")),p in h||(h[p]={}),0===n[1]?(h[p].right=u,h[p].index=u.index):1==n[1]&&(h[p].left=u,h[p].index=u.index+1);for(p in h){switch(c=h[p].right,s=h[p].left,(l=(a=h[p].index)-1)<0&&(l=0),t=e=(r=(u=void 0!==s?s:c).geometry).getCoordinates(),f=!1,r.getType()){case br.MULTI_LINE_STRING:e[u.depth[0]].length>2&&(e[u.depth[0]].splice(a,1),f=!0);break;case br.LINE_STRING:e.length>2&&(e.splice(a,1),f=!0);break;case br.MULTI_POLYGON:t=t[u.depth[1]];case br.POLYGON:(t=t[u.depth[0]]).length>4&&(a==t.length-1&&(a=0),t.splice(a,1),f=!0,0===a&&(t.pop(),t.push(t[0]),l=t.length-1))}if(f){this.setGeometryCoordinates_(r,e);var m=[];if(void 0!==s&&(this.rBush_.remove(s),m.push(s.segment[0])),void 0!==c&&(this.rBush_.remove(c),m.push(c.segment[1])),void 0!==s&&void 0!==c){var g={depth:u.depth,feature:u.feature,geometry:u.geometry,index:l,segment:m};this.rBush_.insert($(g.segment),g)}this.updateSegmentIndices_(r,a,u.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),d.length=0}}return f},e.prototype.setGeometryCoordinates_=function(t,e){this.changingFeature_=!0,t.setCoordinates(e),this.changingFeature_=!1},e.prototype.updateSegmentIndices_=function(t,e,n,r){this.rBush_.forEachInExtent(t.getExtent(),(function(o){o.geometry===t&&(void 0===n||void 0===o.depth||f(o.depth,n))&&o.index>e&&(o.index+=r)}))},e}(fa);function bC(t,e){return t.index-e.index}function LC(t,e,n){var r=e.geometry;if(r.getType()===br.CIRCLE){var o=r;if(1===e.index){var i=Co();i&&(o=o.clone().transform(i,n));var a=He(o.getCenter(),wo(t,n)),s=Math.sqrt(a)-o.getRadius();return s*s}}var l=wo(t,n);return _C[0]=wo(e.segment[0],n),_C[1]=wo(e.segment[1],n),ze(l,_C)}function PC(t,e,n){var r=e.geometry;if(r.getType()===br.CIRCLE&&1===e.index){var o=r,i=Co();return i&&(o=o.clone().transform(i,n)),Eo(o.getClosestPoint(wo(t,n)),n)}var a=wo(t,n);return _C[0]=wo(e.segment[0],n),_C[1]=wo(e.segment[1],n),Eo(Be(a,_C),n)}const AC=SC;var OC=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),xC="addfeatures",IC=function(t){function e(e,n,r,o){var i=t.call(this,e)||this;return i.features=r,i.file=n,i.projection=o,i}return OC(e,t),e}(ne),MC=function(t){function e(e){var n=this,r=e||{};(n=t.call(this,{handleEvent:g})||this).on,n.once,n.un,n.readAsBuffer_=!1,n.formats_=[];for(var o=r.formatConstructors?r.formatConstructors:[],i=0,a=o.length;i<a;++i){var s=o[i];"function"==typeof s&&(s=new s),n.formats_.push(s),n.readAsBuffer_=n.readAsBuffer_||s.getType()===Cl}return n.projection_=r.projection?io(r.projection):null,n.dropListenKeys_=null,n.source_=r.source||null,n.target=r.target?r.target:null,n}return OC(e,t),e.prototype.handleResult_=function(t,e){var n,r=e.target.result,o=this.getMap(),i=this.projection_;i||(i=o.getView().getProjection());for(var a=this.formats_,s=0,l=a.length;s<l;++s){var c=a[s],u=r;this.readAsBuffer_&&c.getType()!==Cl&&(void 0===n&&(n=(new TextDecoder).decode(r)),u=n);var p=this.tryReadFeatures_(c,u,{featureProjection:i});if(p&&p.length>0){this.source_&&(this.source_.clear(),this.source_.addFeatures(p)),this.dispatchEvent(new IC(xC,t,p,i));break}}},e.prototype.registerListeners_=function(){var t=this.getMap();if(t){var e=this.target?this.target:t.getViewport();this.dropListenKeys_=[de(e,pe.DROP,this.handleDrop,this),de(e,pe.DRAGENTER,this.handleStop,this),de(e,pe.DRAGOVER,this.handleStop,this),de(e,pe.DROP,this.handleStop,this)]}},e.prototype.setActive=function(e){!this.getActive()&&e&&this.registerListeners_(),this.getActive()&&!e&&this.unregisterListeners_(),t.prototype.setActive.call(this,e)},e.prototype.setMap=function(e){this.unregisterListeners_(),t.prototype.setMap.call(this,e),this.getActive()&&this.registerListeners_()},e.prototype.tryReadFeatures_=function(t,e,n){try{return t.readFeatures(e,n)}catch(t){return null}},e.prototype.unregisterListeners_=function(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(fe),this.dropListenKeys_=null)},e.prototype.handleDrop=function(t){for(var e=t.dataTransfer.files,n=0,r=e.length;n<r;++n){var o=e.item(n),i=new FileReader;i.addEventListener(pe.LOAD,this.handleResult_.bind(this,o)),this.readAsBuffer_?i.readAsArrayBuffer(o):i.readAsText(o)}},e.prototype.handleStop=function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"},e}(la);const RC=MC;var ZC=n(3837),DC=n.n(ZC),kC="addfeatures";RC.prototype.handleResult_=function(t,e){var n=e.target.result,r=this.getMap(),o=this.projection_;o||(o=r.getView().getProjection());var i=[],a={},s=this.formats_,l=t.name;if("string"==typeof n){for(var c=0,u=s.length;c<u;++c){var p=s[c];if((i=this.tryReadFeatures_(p,n,{featureProjection:o}))&&i.length>0)break}i&&i.length>0?a=i.every((t=>Array.isArray(t)))?i.reduce((function(e,n){if(0===n.length)return e;const r=/(?<layer>[-_\p{Letter}]+)?\.*(?<id>[\d]*)?/iu.exec(n[0].getId()).groups,o=r.layer?r.layer:n[0].getGeometry()?Object.keys(ol.geom).find((t=>n[0].getGeometry()instanceof ol.geom[t])):t.name;return e[o]=(e[o]=e[o]||[]).concat(n),e}),{}):i.reduce((function(e,n){var r=n._folders&&n._folders.length?n._folders[n._folders.length-1]:null;if(!r){const e=/(?<layer>[-_\p{Letter}.]+[\p{Letter}])?\.*(?<id>[\d]*)?/iu.exec(n.getId()).groups;r=e.layer?e.layer:n.getGeometry()?Object.keys(ol.geom).find((t=>n.getGeometry()instanceof ol.geom[t])):t.name}return(e[r]=e[r]||[]).push(n),e}),{}):a[t.name]=i}else i=n?(new ol.format.GeoJSON).readFeaturesFromObject(n,{featureProjection:o,dataProjection:(new ol.format.GeoJSON).readProjectionFromObject(n)}):null,a[t.name]=i;const d=Date.now(),h=Object.keys(a);h.length>1&&(window.dropFilesCounter=window.dropFilesCounter+h.length-1);for(c=0;c<h.length;c++){const e=h[c],n=a[e];"undefined"!==e&&n&&n.forEach((t=>{t._folders||(t._folders=[e])})),this.source_&&(this.source_.clear(),this.source_.addFeatures(n));const r=n&&n.length&&n[0]._document,i=new File([t],r?r+" ("+l+")":l,{lastModified:d});t._fileSystemFile&&(i._fileSystemFile=t._fileSystemFile);const s=this.getFileHandle(t);s&&NC.set(i,s);const u=new IC(kC,i,a[e],o);u._groupIndex=c,u._groupCount=h.length,this.dispatchEvent(u)}},RC.prototype.handleDrop=function(t){const e=this;var n=t.dataTransfer.items;if(DataTransferItem.prototype.getAsFileSystemHandle){const t=function(t){t&&e.processFile(t)};for(var r=0,o=n.length;r<o;++r)n[r].getAsFileSystemHandle().then(t)}else{const t=n=>{n.isDirectory?n.createReader().readEntries((function(e){e.forEach((function(e){t(e)}))})):n instanceof File?e.processFile(n):n.file((async function(t){e.processFile(t)}))};for(var i=0,a=n.length;i<a;++i){const e=n[i];"file"===e.kind&&t(e.webkitGetAsEntry()||e.getAsFile())}}};const NC=new Map;RC.prototype.getFileHandle=function(t){return NC.get(t)},RC.prototype.getFileHandleByName=function(t){const e=t.toLowerCase();for(const t of NC.keys())if(t.name.toLowerCase()===e)return NC.get(t);return null},RC.prototype.setFileHandle=function(t,e){return NC.set(t,e)},RC.prototype.processFile=async function(t){const e=this;let n;if(window.FileSystemFileHandle&&t instanceof window.FileSystemFileHandle&&(n=t,t=await n.getFile(),e.setFileHandle(t,n)),"application/zip"===t.type||"application/x-zip-compressed"===t.type||"application/vnd.google-earth.kmz"===t.type||(!t.type||"application/octet-stream"===t.type)&&t.name.match(/\.kmz|\.zip$/gi)){var r=new(DC());window.dropFilesCounter=window.dropFilesCounter?window.dropFilesCounter+1:1;const o=await r.loadAsync(t);window.dropFilesCounter--;const i="application/vnd.google-earth.kmz"===t.type||(!t.type||"application/octet-stream"===t.type)&&t.name.match(/\.kmz$/gi)?t.name:null;o.forEach((function(r,o){o.dir||(window.dropFilesCounter++,o.async("blob").then((function(o){window.dropFilesCounter--;const a=i?new File([o],i,{type:"application/vnd.google-earth.kml+xml"}):new File([o],r);a._fileSystemFile=t._fileSystemFile||t,n&&e.setFileHandle(a,n),e.processFile(a)})))}))}else if(window.FileSystemDirectoryHandle&&t instanceof window.FileSystemDirectoryHandle)for await(const n of t.values())e.processFile(n);else{window.dropFilesCounter=window.dropFilesCounter?window.dropFilesCounter+1:1;var o=new FileReader;o.addEventListener(pe.LOAD,e.handleResult_.bind(e,t)),o.readAsText(t)}},RC.prototype.tryReadFeatures_=function(t,e,n){let r;try{r=t.readFeatures(e,n)}catch(t){return null}return r&&r.length&&r.some((t=>Array.isArray(t)?t.some((t=>!!t.getGeometry())):!!t.getGeometry()))?r:null};const FC=RC,UC="preload",GC="useInterimTilesOnError";var BC=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const jC=function(t){function e(e){var n=this,r=e||{},o=oe({},r);return delete o.preload,delete o.useInterimTilesOnError,(n=t.call(this,o)||this).on,n.once,n.un,n.setPreload(void 0!==r.preload?r.preload:0),n.setUseInterimTilesOnError(void 0===r.useInterimTilesOnError||r.useInterimTilesOnError),n}return BC(e,t),e.prototype.getPreload=function(){return this.get(UC)},e.prototype.setPreload=function(t){this.set(UC,t)},e.prototype.getUseInterimTilesOnError=function(){return this.get(GC)},e.prototype.setUseInterimTilesOnError=function(t){this.set(GC,t)},e.prototype.getData=function(e){return t.prototype.getData.call(this,e)},e}(Ue);var WC=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),qC=function(t){function e(e,n,r){var o=t.call(this)||this,i=r||{};return o.tileCoord=e,o.state=n,o.interimTile=null,o.key="",o.transition_=void 0===i.transition?250:i.transition,o.transitionStarts_={},o.interpolate=!!i.interpolate,o}return WC(e,t),e.prototype.changed=function(){this.dispatchEvent(pe.CHANGE)},e.prototype.release=function(){},e.prototype.getKey=function(){return this.key+"/"+this.tileCoord},e.prototype.getInterimTile=function(){if(!this.interimTile)return this;var t=this.interimTile;do{if(t.getState()==vr)return this.transition_=0,t;t=t.interimTile}while(t);return this},e.prototype.refreshInterimChain=function(){if(this.interimTile){var t=this.interimTile,e=this;do{if(t.getState()==vr){t.interimTile=null;break}t.getState()==yr?e=t:t.getState()==gr?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}},e.prototype.getTileCoord=function(){return this.tileCoord},e.prototype.getState=function(){return this.state},e.prototype.setState=function(t){if(this.state!==_r&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()},e.prototype.load=function(){r()},e.prototype.getAlpha=function(t,e){if(!this.transition_)return 1;var n=this.transitionStarts_[t];if(n){if(-1===n)return 1}else n=e,this.transitionStarts_[t]=n;var r=e-n+1e3/60;return r>=this.transition_?1:Zo(r/this.transition_)},e.prototype.inTransition=function(t){return!!this.transition_&&-1!==this.transitionStarts_[t]},e.prototype.endTransition=function(t){this.transition_&&(this.transitionStarts_[t]=-1)},e}(ue);const HC=qC;var VC=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const zC=function(t){function e(e,n,r,o,i,a){var s=t.call(this,e,n,a)||this;return s.crossOrigin_=o,s.src_=r,s.key=r,s.image_=new Image,null!==o&&(s.image_.crossOrigin=o),s.unlisten_=null,s.tileLoadFunction_=i,s}return VC(e,t),e.prototype.getImage=function(){return this.image_},e.prototype.setImage=function(t){this.image_=t,this.state=vr,this.unlistenImage_(),this.changed()},e.prototype.handleImageError_=function(){var t;this.state=_r,this.unlistenImage_(),this.image_=((t=dn(1,1)).fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas),this.changed()},e.prototype.handleImageLoad_=function(){var t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=vr:this.state=Cr,this.unlistenImage_(),this.changed()},e.prototype.load=function(){this.state==_r&&(this.state=gr,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==gr&&(this.state=yr,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Rh(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},e}(HC);const YC=function(){function t(t,e,n,r,o,i){this.sourceProj_=t,this.targetProj_=e;var a={},s=ho(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){var e=t[0]+"/"+t[1];return a[e]||(a[e]=s(t)),a[e]},this.maxSourceExtent_=r,this.errorThresholdSquared_=o*o,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&Tt(r)==Tt(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Tt(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Tt(this.targetProj_.getExtent()):null;var l=bt(n),c=Lt(n),u=vt(n),p=yt(n),d=this.transformInv_(l),h=this.transformInv_(c),f=this.transformInv_(u),m=this.transformInv_(p),g=10+(i?Math.max(0,Math.ceil(Rt(gt(n)/(i*i*256*256)))):0);if(this.addQuad_(l,c,u,p,d,h,f,m,g),this.wrapsXInSource_){var y=1/0;this.triangles_.forEach((function(t,e,n){y=Math.min(y,t.source[0][0],t.source[1][0],t.source[2][0])})),this.triangles_.forEach(function(t){if(Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-y>this.sourceWorldWidth_/2){var e=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];e[0][0]-y>this.sourceWorldWidth_/2&&(e[0][0]-=this.sourceWorldWidth_),e[1][0]-y>this.sourceWorldWidth_/2&&(e[1][0]-=this.sourceWorldWidth_),e[2][0]-y>this.sourceWorldWidth_/2&&(e[2][0]-=this.sourceWorldWidth_);var n=Math.min(e[0][0],e[1][0],e[2][0]);Math.max(e[0][0],e[1][0],e[2][0])-n<this.sourceWorldWidth_/2&&(t.source=e)}}.bind(this))}a={}}return t.prototype.addTriangle_=function(t,e,n,r,o,i){this.triangles_.push({source:[r,o,i],target:[t,e,n]})},t.prototype.addQuad_=function(t,e,n,r,o,i,a,s,l){var c=$([o,i,a,s]),u=this.sourceWorldWidth_?Tt(c)/this.sourceWorldWidth_:null,p=this.sourceWorldWidth_,d=this.sourceProj_.canWrapX()&&u>.5&&u<1,h=!1;if(l>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_)h=Tt($([t,e,n,r]))/this.targetWorldWidth_>.25||h;!d&&this.sourceProj_.isGlobal()&&u&&(h=u>.25||h)}if(!(!h&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3]))||Pt(c,this.maxSourceExtent_)){var f=0;if(!(h||isFinite(o[0])&&isFinite(o[1])&&isFinite(i[0])&&isFinite(i[1])&&isFinite(a[0])&&isFinite(a[1])&&isFinite(s[0])&&isFinite(s[1])))if(l>0)h=!0;else if(1!=(f=(isFinite(o[0])&&isFinite(o[1])?0:8)+(isFinite(i[0])&&isFinite(i[1])?0:4)+(isFinite(a[0])&&isFinite(a[1])?0:2)+(isFinite(s[0])&&isFinite(s[1])?0:1))&&2!=f&&4!=f&&8!=f)return;if(l>0){if(!h){var m=[(t[0]+n[0])/2,(t[1]+n[1])/2],g=this.transformInv_(m),y=void 0;if(d)y=(Nt(o[0],p)+Nt(a[0],p))/2-Nt(g[0],p);else y=(o[0]+a[0])/2-g[0];var v=(o[1]+a[1])/2-g[1];h=y*y+v*v>this.errorThresholdSquared_}if(h){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){var _=[(e[0]+n[0])/2,(e[1]+n[1])/2],C=this.transformInv_(_),E=[(r[0]+t[0])/2,(r[1]+t[1])/2],w=this.transformInv_(E);this.addQuad_(t,e,_,E,o,i,C,w,l-1),this.addQuad_(E,_,n,r,w,C,a,s,l-1)}else{var S=[(t[0]+e[0])/2,(t[1]+e[1])/2],b=this.transformInv_(S),L=[(n[0]+r[0])/2,(n[1]+r[1])/2],T=this.transformInv_(L);this.addQuad_(t,S,L,r,o,b,T,s,l-1),this.addQuad_(S,e,n,L,b,i,a,T,l-1)}return}}if(d){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}0==(11&f)&&this.addTriangle_(t,n,r,o,a,s),0==(14&f)&&this.addTriangle_(t,n,e,o,a,i),f&&(0==(13&f)&&this.addTriangle_(e,r,t,i,s,o),0==(7&f)&&this.addTriangle_(e,r,n,i,s,a))}},t.prototype.calculateSourceExtent=function(){var t=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach((function(e,n,r){var o=e.source;dt(t,o[0]),dt(t,o[1]),dt(t,o[2])})),t},t.prototype.getTriangles=function(){return this.triangles_},t}();var KC,XC={imageSmoothingEnabled:!1,msImageSmoothingEnabled:!1},$C={imageSmoothingEnabled:!0,msImageSmoothingEnabled:!0};function JC(t,e,n,r,o){t.beginPath(),t.moveTo(0,0),t.lineTo(e,n),t.lineTo(r,o),t.closePath(),t.save(),t.clip(),t.fillRect(0,0,Math.max(e,r)+1,Math.max(n,o)),t.restore()}function QC(t,e){return Math.abs(t[4*e]-210)>2||Math.abs(t[4*e+3]-191.25)>2}function tE(t,e,n,r){var o=fo(n,e,t),i=ao(e,r,n),a=e.getMetersPerUnit();void 0!==a&&(i*=a);var s=t.getMetersPerUnit();void 0!==s&&(i/=s);var l=t.getExtent();if(!l||et(l,o)){var c=ao(t,i,o)/i;isFinite(c)&&c>0&&(i/=c)}return i}function eE(t,e,n,r,o,i,a,s,l,c,u,p){var d=dn(Math.round(n*t),Math.round(n*e));if(p||oe(d,XC),0===l.length)return d.canvas;function h(t){return Math.round(t*n)/n}d.scale(n,n),d.globalCompositeOperation="lighter";var f=[1/0,1/0,-1/0,-1/0];l.forEach((function(t,e,n){pt(f,t.extent)}));var m=Tt(f),g=wt(f),y=dn(Math.round(n*m/r),Math.round(n*g/r));p||oe(y,XC);var v=n/r;l.forEach((function(t,e,n){var r=t.extent[0]-f[0],o=-(t.extent[3]-f[3]),i=Tt(t.extent),a=wt(t.extent);t.image.width>0&&t.image.height>0&&y.drawImage(t.image,c,c,t.image.width-2*c,t.image.height-2*c,r*v,o*v,i*v,a*v)}));var _=bt(a);return s.getTriangles().forEach((function(t,e,o){var a=t.source,s=t.target,l=a[0][0],c=a[0][1],u=a[1][0],m=a[1][1],g=a[2][0],v=a[2][1],C=h((s[0][0]-_[0])/i),E=h(-(s[0][1]-_[1])/i),w=h((s[1][0]-_[0])/i),S=h(-(s[1][1]-_[1])/i),b=h((s[2][0]-_[0])/i),L=h(-(s[2][1]-_[1])/i),T=l,P=c;l=0,c=0;var A=function(t){for(var e=t.length,n=0;n<e;n++){for(var r=n,o=Math.abs(t[n][n]),i=n+1;i<e;i++){var a=Math.abs(t[i][n]);a>o&&(o=a,r=i)}if(0===o)return null;var s=t[r];t[r]=t[n],t[n]=s;for(var l=n+1;l<e;l++)for(var c=-t[l][n]/t[n][n],u=n;u<e+1;u++)n==u?t[l][u]=0:t[l][u]+=c*t[n][u]}for(var p=new Array(e),d=e-1;d>=0;d--){p[d]=t[d][e]/t[d][d];for(var h=d-1;h>=0;h--)t[h][e]-=t[h][d]*p[d]}return p}([[u-=T,m-=P,0,0,w-C],[g-=T,v-=P,0,0,b-C],[0,0,u,m,S-E],[0,0,g,v,L-E]]);if(A){if(d.save(),d.beginPath(),function(){if(void 0===KC){var t=document.createElement("canvas").getContext("2d");t.globalCompositeOperation="lighter",t.fillStyle="rgba(210, 0, 0, 0.75)",JC(t,4,5,4,0),JC(t,4,5,0,5);var e=t.getImageData(0,0,3,3).data;KC=QC(e,0)||QC(e,4)||QC(e,8)}return KC}()||!p){d.moveTo(w,S);for(var O=C-w,x=E-S,I=0;I<4;I++)d.lineTo(w+h((I+1)*O/4),S+h(I*x/3)),3!=I&&d.lineTo(w+h((I+1)*O/4),S+h((I+1)*x/3));d.lineTo(b,L)}else d.moveTo(w,S),d.lineTo(C,E),d.lineTo(b,L);d.clip(),d.transform(A[0],A[2],A[1],A[3],C,E),d.translate(f[0]-T,f[3]-P),d.scale(r/n,-r/n),d.drawImage(y.canvas,0,0),d.restore()}})),u&&(d.save(),d.globalCompositeOperation="source-over",d.strokeStyle="black",d.lineWidth=1,s.getTriangles().forEach((function(t,e,n){var r=t.target,o=(r[0][0]-_[0])/i,a=-(r[0][1]-_[1])/i,s=(r[1][0]-_[0])/i,l=-(r[1][1]-_[1])/i,c=(r[2][0]-_[0])/i,u=-(r[2][1]-_[1])/i;d.beginPath(),d.moveTo(s,l),d.lineTo(o,a),d.lineTo(c,u),d.closePath(),d.stroke()})),d.restore()),d.canvas}var nE=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),rE=function(t){function e(e,n,r,o,i,a,s,l,c,u,p,d){var h=t.call(this,i,gr,{interpolate:!!d})||this;h.renderEdges_=void 0!==p&&p,h.pixelRatio_=s,h.gutter_=l,h.canvas_=null,h.sourceTileGrid_=n,h.targetTileGrid_=o,h.wrappedTileCoord_=a||i,h.sourceTiles_=[],h.sourcesListenerKeys_=null,h.sourceZ_=0;var f=o.getTileCoordExtent(h.wrappedTileCoord_),m=h.targetTileGrid_.getExtent(),g=h.sourceTileGrid_.getExtent(),y=m?St(f,m):f;if(0===gt(y))return h.state=Cr,h;var v=e.getExtent();v&&(g=g?St(g,v):v);var _=o.getResolution(h.wrappedTileCoord_[0]),C=function(t,e,n,r){var o=_t(n),i=tE(t,e,o,r);return(!isFinite(i)||i<=0)&&mt(n,(function(n){return i=tE(t,e,n,r),isFinite(i)&&i>0})),i}(e,r,y,_);if(!isFinite(C)||C<=0)return h.state=Cr,h;var E=void 0!==u?u:.5;if(h.triangulation_=new YC(e,r,y,g,C*E,_),0===h.triangulation_.getTriangles().length)return h.state=Cr,h;h.sourceZ_=n.getZForResolution(C);var w=h.triangulation_.calculateSourceExtent();if(g&&(e.canWrapX()?(w[1]=It(w[1],g[1],g[3]),w[3]=It(w[3],g[1],g[3])):w=St(w,g)),gt(w)){for(var S=n.getTileRangeForExtentAndZ(w,h.sourceZ_),b=S.minX;b<=S.maxX;b++)for(var L=S.minY;L<=S.maxY;L++){var T=c(h.sourceZ_,b,L,s);T&&h.sourceTiles_.push(T)}0===h.sourceTiles_.length&&(h.state=Cr)}else h.state=Cr;return h}return nE(e,t),e.prototype.getImage=function(){return this.canvas_},e.prototype.reproject_=function(){var t=[];if(this.sourceTiles_.forEach(function(e,n,r){e&&e.getState()==vr&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}.bind(this)),this.sourceTiles_.length=0,0===t.length)this.state=_r;else{var e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),r="number"==typeof n?n:n[0],o="number"==typeof n?n:n[1],i=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),s=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=eE(r,o,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),i,s,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=vr}this.changed()},e.prototype.load=function(){if(this.state==gr){this.state=yr,this.changed();var t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(e,n,r){var o=e.getState();if(o==gr||o==yr){t++;var i=de(e,pe.CHANGE,(function(n){var r=e.getState();r!=vr&&r!=_r&&r!=Cr||(fe(i),0===--t&&(this.unlistenSources_(),this.reproject_()))}),this);this.sourcesListenerKeys_.push(i)}}.bind(this)),0===t?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach((function(t,e,n){t.getState()==gr&&t.load()}))}},e.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(fe),this.sourcesListenerKeys_=null},e}(HC);const oE=rE;var iE=function(){function t(t,e,n,r){this.minX=t,this.maxX=e,this.minY=n,this.maxY=r}return t.prototype.contains=function(t){return this.containsXY(t[1],t[2])},t.prototype.containsTileRange=function(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY},t.prototype.containsXY=function(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY},t.prototype.equals=function(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY},t.prototype.extend=function(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)},t.prototype.getHeight=function(){return this.maxY-this.minY+1},t.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},t.prototype.getWidth=function(){return this.maxX-this.minX+1},t.prototype.intersects=function(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY},t}();function aE(t,e,n,r,o){return void 0!==o?(o.minX=t,o.maxX=e,o.minY=n,o.maxY=r,o):new iE(t,e,n,r)}const sE=iE;var lE=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),cE=function(t){function e(e){var n=t.call(this,e)||this;return n.extentChanged=!0,n.renderedExtent_=null,n.renderedPixelRatio,n.renderedProjection=null,n.renderedRevision,n.renderedTiles=[],n.newTiles_=!1,n.tmpExtent=[1/0,1/0,-1/0,-1/0],n.tmpTileRange_=new sE(0,0,0,0),n}return lE(e,t),e.prototype.isDrawableTile=function(t){var e=this.getLayer(),n=t.getState(),r=e.getUseInterimTilesOnError();return n==vr||n==Cr||n==_r&&!r},e.prototype.getTile=function(t,e,n,r){var o=r.pixelRatio,i=r.viewState.projection,a=this.getLayer(),s=a.getSource().getTile(t,e,n,o,i);return s.getState()==_r&&(a.getUseInterimTilesOnError()?a.getPreload()>0&&(this.newTiles_=!0):s.setState(vr)),this.isDrawableTile(s)||(s=s.getInterimTile()),s},e.prototype.getData=function(t){var e=this.frameState;if(!e)return null;var n=this.getLayer(),r=k(e.pixelToCoordinateTransform,t.slice()),o=n.getExtent();if(o&&!et(o,r))return null;for(var i=e.pixelRatio,a=e.viewState.projection,s=e.viewState,l=n.getRenderSource(),c=l.getTileGridForProjection(s.projection),u=l.getTilePixelRatio(e.pixelRatio),p=c.getZForResolution(s.resolution);p>=c.getMinZoom();--p){var d=c.getTileCoordForCoordAndZ(r,p),h=l.getTile(p,d[1],d[2],i,a);if(!(h instanceof zC||h instanceof oE))return null;if(h.getState()===vr){var f=c.getOrigin(p),m=qi(c.getTileSize(p)),g=c.getResolution(p),y=Math.floor(u*((r[0]-f[0])/g-d[1]*m[0])),v=Math.floor(u*((f[1]-r[1])/g-d[2]*m[1]));return this.getImageData(h.getImage(),y,v)}}return null},e.prototype.loadedTileCallback=function(e,n,r){return!!this.isDrawableTile(r)&&t.prototype.loadedTileCallback.call(this,e,n,r)},e.prototype.prepareFrame=function(t){return!!this.getLayer().getSource()},e.prototype.renderFrame=function(t,e){var n=t.layerStatesArray[t.layerIndex],r=t.viewState,o=r.projection,a=r.resolution,s=r.center,c=r.rotation,u=t.pixelRatio,p=this.getLayer(),d=p.getSource(),h=d.getRevision(),f=d.getTileGridForProjection(o),m=f.getZForResolution(a,d.zDirection),g=f.getResolution(m),y=t.extent,v=n.extent&&bo(n.extent,o);v&&(y=St(y,bo(n.extent,o)));var _=d.getTilePixelRatio(u),C=Math.round(t.size[0]*_),E=Math.round(t.size[1]*_);if(c){var w=Math.round(Math.sqrt(C*C+E*E));C=w,E=w}var S=g*C/2/_,b=g*E/2/_,L=[s[0]-S,s[1]-b,s[0]+S,s[1]+b],T=f.getTileRangeForExtentAndZ(y,m),P={};P[m]={};var A=this.createLoadedTileFinder(d,o,P),O=this.tmpExtent,x=this.tmpTileRange_;this.newTiles_=!1;for(var I=T.minX;I<=T.maxX;++I)for(var M=T.minY;M<=T.maxY;++M){var R=this.getTile(m,I,M,t);if(this.isDrawableTile(R)){var Z=i(this);if(R.getState()==vr){P[m][R.tileCoord.toString()]=R;var D=R.inTransition(Z);this.newTiles_||!D&&-1!==this.renderedTiles.indexOf(R)||(this.newTiles_=!0)}if(1===R.getAlpha(Z,t.time))continue}var N=f.getTileCoordChildTileRange(R.tileCoord,x,O),B=!1;N&&(B=A(m+1,N)),B||f.forEachTileCoordParentTileRange(R.tileCoord,A,x,O)}var j=g/a;F(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/_,1/_,c,-C/2,-E/2);var W=G(this.pixelTransform);this.useContainer(e,W,n.opacity,this.getBackground(t));var q=this.context,H=q.canvas;U(this.inversePixelTransform,this.pixelTransform),F(this.tempTransform,C/2,E/2,j,j,0,-C/2,-E/2),H.width!=C||H.height!=E?(H.width=C,H.height=E):this.containerReused||q.clearRect(0,0,C,E),v&&this.clipUnrotated(q,t,v),d.getInterpolate()||oe(q,XC),this.preRender(q,t),this.renderedTiles.length=0;var V,z,Y,K=Object.keys(P).map(Number);K.sort(l),1!==n.opacity||this.containerReused&&!d.getOpaque(t.viewState.projection)?(V=[],z=[]):K=K.reverse();for(var X=K.length-1;X>=0;--X){var $=K[X],J=d.getTilePixelSize($,u,o),Q=f.getResolution($)/g,tt=J[0]*Q*j,et=J[1]*Q*j,nt=f.getTileCoordForCoordAndZ(bt(L),$),rt=f.getTileCoordExtent(nt),ot=k(this.tempTransform,[_*(rt[0]-L[0])/g,_*(L[3]-rt[3])/g]),it=_*d.getGutterForProjection(o),at=P[$];for(var st in at){var lt=(R=at[st]).tileCoord,ct=nt[1]-lt[1],pt=Math.round(ot[0]-(ct-1)*tt),dt=nt[2]-lt[2],ht=Math.round(ot[1]-(dt-1)*et),ft=pt-(I=Math.round(ot[0]-ct*tt)),mt=ht-(M=Math.round(ot[1]-dt*et)),gt=m===$,yt=!1;if(!(D=gt&&1!==R.getAlpha(i(this),t.time)))if(V){Y=[I,M,I+ft,M,I+ft,M+mt,I,M+mt];for(var vt=0,_t=V.length;vt<_t;++vt)if(m!==$&&$<z[vt]){var Ct=V[vt];Pt([I,M,I+ft,M+mt],[Ct[0],Ct[3],Ct[4],Ct[7]])&&(yt||(q.save(),yt=!0),q.beginPath(),q.moveTo(Y[0],Y[1]),q.lineTo(Y[2],Y[3]),q.lineTo(Y[4],Y[5]),q.lineTo(Y[6],Y[7]),q.moveTo(Ct[6],Ct[7]),q.lineTo(Ct[4],Ct[5]),q.lineTo(Ct[2],Ct[3]),q.lineTo(Ct[0],Ct[1]),q.clip())}V.push(Y),z.push($)}else q.clearRect(I,M,ft,mt);this.drawTileImage(R,t,I,M,ft,mt,it,gt),V&&!D?(yt&&q.restore(),this.renderedTiles.unshift(R)):this.renderedTiles.push(R),this.updateUsedTiles(t.usedTiles,d,R)}}this.renderedRevision=h,this.renderedResolution=g,this.extentChanged=!this.renderedExtent_||!ut(this.renderedExtent_,L),this.renderedExtent_=L,this.renderedPixelRatio=u,this.renderedProjection=o,this.manageTilePyramid(t,d,f,u,o,y,m,p.getPreload()),this.scheduleExpireCache(t,d),this.postRender(q,t),n.extent&&q.restore(),oe(q,$C),W!==H.style.transform&&(H.style.transform=W);var Et=pn(n.opacity),wt=this.container;return Et!==wt.style.opacity&&(wt.style.opacity=Et),this.container},e.prototype.drawTileImage=function(t,e,n,r,o,a,s,l){var c=this.getTileImage(t);if(c){var u=i(this),p=l?t.getAlpha(u,e.time):1,d=p!==this.context.globalAlpha;d&&(this.context.save(),this.context.globalAlpha=p),this.context.drawImage(c,s,s,c.width-2*s,c.height-2*s,n,r,o,a),d&&this.context.restore(),1!==p?e.animate=!0:l&&t.endTransition(u)}},e.prototype.getImage=function(){var t=this.context;return t?t.canvas:null},e.prototype.getTileImage=function(t){return t.getImage()},e.prototype.scheduleExpireCache=function(t,e){if(e.canExpireCache()){var n=function(t,e,n){var r=i(t);r in n.usedTiles&&t.expireCache(n.viewState.projection,n.usedTiles[r])}.bind(null,e);t.postRenderFunctions.push(n)}},e.prototype.updateUsedTiles=function(t,e,n){var r=i(e);r in t||(t[r]={}),t[r][n.getKey()]=!0},e.prototype.manageTilePyramid=function(t,e,n,r,o,a,s,l,c){var u=i(e);u in t.wantedTiles||(t.wantedTiles[u]={});var p,d,h,f,m,g,y=t.wantedTiles[u],v=t.tileQueue,_=0;for(g=n.getMinZoom();g<=s;++g)for(d=n.getTileRangeForExtentAndZ(a,g,d),h=n.getResolution(g),f=d.minX;f<=d.maxX;++f)for(m=d.minY;m<=d.maxY;++m)s-g<=l?(++_,(p=e.getTile(g,f,m,r,o)).getState()==gr&&(y[p.getKey()]=!0,v.isKeyQueued(p.getKey())||v.enqueue([p,u,n.getTileCoordCenter(p.tileCoord),h])),void 0!==c&&c(p)):e.useTile(g,f,m,o);e.updateCacheSize(_,o)},e}(zv);const uE=cE;var pE=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const dE=function(t){function e(e){return t.call(this,e)||this}return pE(e,t),e.prototype.createRenderer=function(){return new uE(this)},e}(jC);var hE=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const fE=function(t){function e(e){var n=e||{};return t.call(this,n)||this}return hE(e,t),e}(Ue);var mE=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),gE=function(t){function e(e){var n=t.call(this,e)||this;return n.image_=null,n}return mE(e,t),e.prototype.getImage=function(){return this.image_?this.image_.getImage():null},e.prototype.prepareFrame=function(t){var e=t.layerStatesArray[t.layerIndex],n=t.pixelRatio,r=t.viewState,o=r.resolution,i=this.getLayer().getSource(),a=t.viewHints,s=t.extent;if(void 0!==e.extent&&(s=St(s,bo(e.extent,r.projection))),!a[Ar]&&!a[Or]&&!At(s))if(i){var l=r.projection,c=i.getImage(s,o,n,l);c&&this.loadImage(c)?this.image_=c:this.image_=null}else this.image_=null;return!!this.image_},e.prototype.getData=function(t){var e=this.frameState;if(!e)return null;var n=this.getLayer(),r=k(e.pixelToCoordinateTransform,t.slice()),o=n.getExtent();if(o&&!et(o,r))return null;var i=this.image_.getExtent(),a=this.image_.getImage(),s=Tt(i),l=Math.floor(a.width*((r[0]-i[0])/s));if(l<0||l>=a.width)return null;var c=wt(i),u=Math.floor(a.height*((i[3]-r[1])/c));return u<0||u>=a.height?null:this.getImageData(a,l,u)},e.prototype.renderFrame=function(t,e){var n=this.image_,r=n.getExtent(),o=n.getResolution(),i=n.getPixelRatio(),a=t.layerStatesArray[t.layerIndex],s=t.pixelRatio,l=t.viewState,c=l.center,u=l.resolution,p=t.size,d=s*o/(u*i),h=Math.round(p[0]*s),f=Math.round(p[1]*s),m=l.rotation;if(m){var g=Math.round(Math.sqrt(h*h+f*f));h=g,f=g}F(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/s,1/s,m,-h/2,-f/2),U(this.inversePixelTransform,this.pixelTransform);var y=G(this.pixelTransform);this.useContainer(e,y,a.opacity,this.getBackground(t));var v=this.context,_=v.canvas;_.width!=h||_.height!=f?(_.width=h,_.height=f):this.containerReused||v.clearRect(0,0,h,f);var C=!1,E=!0;if(a.extent){var w=bo(a.extent,l.projection);(C=(E=Pt(w,t.extent))&&!nt(w,t.extent))&&this.clipUnrotated(v,t,w)}var S=n.getImage(),b=F(this.tempTransform,h/2,f/2,d,d,0,i*(r[0]-c[0])/o,i*(c[1]-r[3])/o);this.renderedResolution=o*s/i;var L=S.width*b[0],T=S.height*b[3];if(this.getLayer().getSource().getInterpolate()||oe(v,XC),this.preRender(v,t),E&&L>=.5&&T>=.5){var P=b[4],A=b[5],O=a.opacity,x=void 0;1!==O&&(x=v.globalAlpha,v.globalAlpha=O),v.drawImage(S,0,0,+S.width,+S.height,Math.round(P),Math.round(A),Math.round(L),Math.round(T)),1!==O&&(v.globalAlpha=x)}return this.postRender(v,t),C&&v.restore(),oe(v,$C),y!==_.style.transform&&(_.style.transform=y),this.container},e}(zv);const yE=gE;var vE=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const _E=function(t){function e(e){return t.call(this,e)||this}return vE(e,t),e.prototype.createRenderer=function(){return new yE(this)},e.prototype.getData=function(e){return t.prototype.getData.call(this,e)},e}(fE);var CE=34962,EE=34963,wE=35048,SE=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function bE(t,e){for(var n=oe({preserveDrawingBuffer:!0},e),r=SE.length,o=0;o<r;++o)try{var i=t.getContext(SE[o],n);if(i)return i}catch(t){}return null}var LE=35044,TE=function(){function t(t,e){this.array=null,this.type=t,x(t===CE||t===EE,62),this.usage=void 0!==e?e:LE}return t.prototype.ofSize=function(t){this.array=new(PE(this.type))(t)},t.prototype.fromArray=function(t){var e=PE(this.type);this.array=e.from?e.from(t):new e(t)},t.prototype.fromArrayBuffer=function(t){this.array=new(PE(this.type))(t)},t.prototype.getType=function(){return this.type},t.prototype.getArray=function(){return this.array},t.prototype.getUsage=function(){return this.usage},t.prototype.getSize=function(){return this.array?this.array.length:0},t}();function PE(t){switch(t){case CE:return Float32Array;case EE:return Uint32Array;default:return Float32Array}}const AE=TE,OE="webglcontextlost",xE="webglcontextrestored";var IE=function(){function t(t){this.gl_=t.webGlContext;var e=this.gl_;this.scaleRatio_=t.scaleRatio||1,this.renderTargetTexture_=e.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=e.createFramebuffer();var n=e.createShader(e.VERTEX_SHADER);e.shaderSource(n,t.vertexShader||"\n  precision mediump float;\n  \n  attribute vec2 a_position;\n  varying vec2 v_texCoord;\n  varying vec2 v_screenCoord;\n  \n  uniform vec2 u_screenSize;\n   \n  void main() {\n    v_texCoord = a_position * 0.5 + 0.5;\n    v_screenCoord = v_texCoord * u_screenSize;\n    gl_Position = vec4(a_position, 0.0, 1.0);\n  }\n"),e.compileShader(n);var r=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(r,t.fragmentShader||"\n  precision mediump float;\n   \n  uniform sampler2D u_image;\n  uniform float u_opacity;\n   \n  varying vec2 v_texCoord;\n   \n  void main() {\n    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n  }\n"),e.compileShader(r),this.renderTargetProgram_=e.createProgram(),e.attachShader(this.renderTargetProgram_,n),e.attachShader(this.renderTargetProgram_,r),e.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]),e.STATIC_DRAW),this.renderTargetAttribLocation_=e.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],t.uniforms&&Object.keys(t.uniforms).forEach(function(n){this.uniforms_.push({value:t.uniforms[n],location:e.getUniformLocation(this.renderTargetProgram_,n)})}.bind(this))}return t.prototype.getGL=function(){return this.gl_},t.prototype.init=function(t){var e=this.getGL(),n=[e.drawingBufferWidth*this.scaleRatio_,e.drawingBufferHeight*this.scaleRatio_];if(e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer()),e.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;var r=e.RGBA,o=e.RGBA,i=e.UNSIGNED_BYTE;e.bindTexture(e.TEXTURE_2D,this.renderTargetTexture_),e.texImage2D(e.TEXTURE_2D,0,r,n[0],n[1],0,o,i,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.renderTargetTexture_,0)}},t.prototype.apply=function(t,e,n,r){var o=this.getGL(),a=t.size;if(o.bindFramebuffer(o.FRAMEBUFFER,e?e.getFrameBuffer():null),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,this.renderTargetTexture_),!e){var s=i(o.canvas);if(!t.renderTargets[s]){var l=o.getContextAttributes();l&&l.preserveDrawingBuffer&&(o.clearColor(0,0,0,0),o.clear(o.COLOR_BUFFER_BIT)),t.renderTargets[s]=!0}}o.enable(o.BLEND),o.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA),o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.bindBuffer(o.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),o.useProgram(this.renderTargetProgram_),o.enableVertexAttribArray(this.renderTargetAttribLocation_),o.vertexAttribPointer(this.renderTargetAttribLocation_,2,o.FLOAT,!1,0,0),o.uniform2f(this.renderTargetUniformLocation_,a[0],a[1]),o.uniform1i(this.renderTargetTextureLocation_,0);var c=t.layerStatesArray[t.layerIndex].opacity;o.uniform1f(this.renderTargetOpacityLocation_,c),this.applyUniforms(t),n&&n(o,t),o.drawArrays(o.TRIANGLES,0,6),r&&r(o,t)},t.prototype.getFrameBuffer=function(){return this.frameBuffer_},t.prototype.applyUniforms=function(t){var e,n=this.getGL(),r=1;this.uniforms_.forEach((function(o){if((e="function"==typeof o.value?o.value(t):o.value)instanceof HTMLCanvasElement||e instanceof ImageData)o.texture||(o.texture=n.createTexture()),n.activeTexture(n["TEXTURE".concat(r)]),n.bindTexture(n.TEXTURE_2D,o.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),e instanceof ImageData?n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,e.width,e.height,0,n.UNSIGNED_BYTE,new Uint8Array(e.data)):n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e),n.uniform1i(o.location,r++);else if(Array.isArray(e))switch(e.length){case 2:return void n.uniform2f(o.location,e[0],e[1]);case 3:return void n.uniform3f(o.location,e[0],e[1],e[2]);case 4:return void n.uniform4f(o.location,e[0],e[1],e[2],e[3]);default:return}else"number"==typeof e&&n.uniform1f(o.location,e)}))},t}();const ME=IE;function RE(t,e){return t[0]=e[0],t[1]=e[1],t[4]=e[2],t[5]=e[3],t[12]=e[4],t[13]=e[5],t}var ZE=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),DE="u_projectionMatrix",kE="u_offsetScaleMatrix",NE="u_offsetRotateMatrix",FE="u_time",UE="u_zoom",GE="u_resolution",BE={UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126},jE={};function WE(t){return"shared/"+t}var qE=0;var HE=function(t){function e(e){var n,r=t.call(this)||this,o=e||{};r.boundHandleWebGLContextLost_=r.handleWebGLContextLost.bind(r),r.boundHandleWebGLContextRestored_=r.handleWebGLContextRestored.bind(r),r.canvasCacheKey_=o.canvasCacheKey?WE(o.canvasCacheKey):(n="unique/"+qE,qE+=1,n),r.canvas_=function(t){var e=jE[t];if(!e){var n=document.createElement("canvas");n.style.position="absolute",n.style.left="0",e={users:0,canvas:n},jE[t]=e}return e.users+=1,e.canvas}(r.canvasCacheKey_),r.gl_=bE(r.canvas_),r.bufferCache_={},r.extensionCache_={},r.currentProgram_=null,r.canvas_.addEventListener(OE,r.boundHandleWebGLContextLost_),r.canvas_.addEventListener(xE,r.boundHandleWebGLContextRestored_),r.offsetRotateMatrix_=[1,0,0,1,0,0],r.offsetScaleMatrix_=[1,0,0,1,0,0],r.tmpMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r.uniformLocations_={},r.attribLocations_={},r.uniforms_=[],o.uniforms&&r.setUniforms(o.uniforms);var i=r.getGL();return r.postProcessPasses_=o.postProcesses?o.postProcesses.map((function(t){return new ME({webGlContext:i,scaleRatio:t.scaleRatio,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms})})):[new ME({webGlContext:i})],r.shaderCompileErrors_=null,r.startTime_=Date.now(),r}return ZE(e,t),e.prototype.setUniforms=function(t){for(var e in this.uniforms_=[],t)this.uniforms_.push({name:e,value:t[e]});this.uniformLocations_={}},e.prototype.canvasCacheKeyMatches=function(t){return this.canvasCacheKey_===WE(t)},e.prototype.getExtension=function(t){if(t in this.extensionCache_)return this.extensionCache_[t];var e=this.gl_.getExtension(t);return this.extensionCache_[t]=e,e},e.prototype.bindBuffer=function(t){var e=this.getGL(),n=i(t),r=this.bufferCache_[n];r||(r={buffer:t,webGlBuffer:e.createBuffer()},this.bufferCache_[n]=r);e.bindBuffer(t.getType(),r.webGlBuffer)},e.prototype.flushBufferData=function(t){var e=this.getGL();this.bindBuffer(t),e.bufferData(t.getType(),t.getArray(),t.getUsage())},e.prototype.deleteBuffer=function(t){var e=this.getGL(),n=i(t),r=this.bufferCache_[n];r&&!e.isContextLost()&&e.deleteBuffer(r.webGlBuffer),delete this.bufferCache_[n]},e.prototype.disposeInternal=function(){this.canvas_.removeEventListener(OE,this.boundHandleWebGLContextLost_),this.canvas_.removeEventListener(xE,this.boundHandleWebGLContextRestored_),function(t){var e=jE[t];if(e&&(e.users-=1,!(e.users>0))){var n=bE(e.canvas).getExtension("WEBGL_lose_context");n&&n.loseContext(),delete jE[t]}}(this.canvasCacheKey_),delete this.gl_,delete this.canvas_},e.prototype.prepareDraw=function(t,e){var n=this.getGL(),r=this.getCanvas(),o=t.size,i=t.pixelRatio;r.width=o[0]*i,r.height=o[1]*i,r.style.width=o[0]+"px",r.style.height=o[1]+"px",n.useProgram(this.currentProgram_);for(var a=this.postProcessPasses_.length-1;a>=0;a--)this.postProcessPasses_[a].init(t);n.bindTexture(n.TEXTURE_2D,null),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,e?n.ZERO:n.ONE_MINUS_SRC_ALPHA),n.useProgram(this.currentProgram_),this.applyFrameState(t),this.applyUniforms(t)},e.prototype.prepareDrawToRenderTarget=function(t,e,n){var r=this.getGL(),o=e.getSize();r.bindFramebuffer(r.FRAMEBUFFER,e.getFramebuffer()),r.viewport(0,0,o[0],o[1]),r.bindTexture(r.TEXTURE_2D,e.getTexture()),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.enable(r.BLEND),r.blendFunc(r.ONE,n?r.ZERO:r.ONE_MINUS_SRC_ALPHA),r.useProgram(this.currentProgram_),this.applyFrameState(t),this.applyUniforms(t)},e.prototype.drawElements=function(t,e){var n=this.getGL();this.getExtension("OES_element_index_uint");var r=n.UNSIGNED_INT,o=e-t,i=4*t;n.drawElements(n.TRIANGLES,o,r,i)},e.prototype.finalizeDraw=function(t,e,n){for(var r=0,o=this.postProcessPasses_.length;r<o;r++)r===o-1?this.postProcessPasses_[r].apply(t,null,e,n):this.postProcessPasses_[r].apply(t,this.postProcessPasses_[r+1])},e.prototype.getCanvas=function(){return this.canvas_},e.prototype.getGL=function(){return this.gl_},e.prototype.applyFrameState=function(t){var e=t.size,n=t.viewState.rotation,r=R(this.offsetScaleMatrix_);N(r,2/e[0],2/e[1]);var o=R(this.offsetRotateMatrix_);0!==n&&function(t,e){var n=Math.cos(e),r=Math.sin(e);Z(t,D(M,n,r,-r,n,0,0))}(o,-n),this.setUniformMatrixValue(kE,RE(this.tmpMat4_,r)),this.setUniformMatrixValue(NE,RE(this.tmpMat4_,o)),this.setUniformFloatValue(FE,.001*(Date.now()-this.startTime_)),this.setUniformFloatValue(UE,t.viewState.zoom),this.setUniformFloatValue(GE,t.viewState.resolution)},e.prototype.applyUniforms=function(t){var e,n=this.getGL(),r=0;this.uniforms_.forEach(function(o){if((e="function"==typeof o.value?o.value(t):o.value)instanceof HTMLCanvasElement||e instanceof HTMLImageElement||e instanceof ImageData)o.texture||(o.prevValue=void 0,o.texture=n.createTexture()),n.activeTexture(n["TEXTURE".concat(r)]),n.bindTexture(n.TEXTURE_2D,o.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),(!(e instanceof HTMLImageElement)||e.complete)&&o.prevValue!==e&&(o.prevValue=e,n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e)),n.uniform1i(this.getUniformLocation(o.name),r++);else if(Array.isArray(e)&&6===e.length)this.setUniformMatrixValue(o.name,RE(this.tmpMat4_,e));else if(Array.isArray(e)&&e.length<=4)switch(e.length){case 2:return void n.uniform2f(this.getUniformLocation(o.name),e[0],e[1]);case 3:return void n.uniform3f(this.getUniformLocation(o.name),e[0],e[1],e[2]);case 4:return void n.uniform4f(this.getUniformLocation(o.name),e[0],e[1],e[2],e[3]);default:return}else"number"==typeof e&&n.uniform1f(this.getUniformLocation(o.name),e)}.bind(this))},e.prototype.useProgram=function(t){return t!=this.currentProgram_&&(this.getGL().useProgram(t),this.currentProgram_=t,this.uniformLocations_={},this.attribLocations_={},!0)},e.prototype.compileShader=function(t,e){var n=this.getGL(),r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r},e.prototype.getProgram=function(t,e){var n=this.getGL(),r=this.compileShader(t,n.FRAGMENT_SHADER),o=this.compileShader(e,n.VERTEX_SHADER),i=n.createProgram();if(n.attachShader(i,r),n.attachShader(i,o),n.linkProgram(i),!n.getShaderParameter(r,n.COMPILE_STATUS)){var a="Fragment shader compliation failed: ".concat(n.getShaderInfoLog(r));throw new Error(a)}if(n.deleteShader(r),!n.getShaderParameter(o,n.COMPILE_STATUS)){a="Vertex shader compilation failed: ".concat(n.getShaderInfoLog(o));throw new Error(a)}if(n.deleteShader(o),!n.getProgramParameter(i,n.LINK_STATUS)){a="GL program linking failed: ".concat(n.getShaderInfoLog(o));throw new Error(a)}return i},e.prototype.getUniformLocation=function(t){return void 0===this.uniformLocations_[t]&&(this.uniformLocations_[t]=this.getGL().getUniformLocation(this.currentProgram_,t)),this.uniformLocations_[t]},e.prototype.getAttributeLocation=function(t){return void 0===this.attribLocations_[t]&&(this.attribLocations_[t]=this.getGL().getAttribLocation(this.currentProgram_,t)),this.attribLocations_[t]},e.prototype.makeProjectionTransform=function(t,e){var n=t.size,r=t.viewState.rotation,o=t.viewState.resolution,i=t.viewState.center;return R(e),F(e,0,0,2/(o*n[0]),2/(o*n[1]),-r,-i[0],-i[1]),e},e.prototype.setUniformFloatValue=function(t,e){this.getGL().uniform1f(this.getUniformLocation(t),e)},e.prototype.setUniformFloatVec4=function(t,e){this.getGL().uniform4fv(this.getUniformLocation(t),e)},e.prototype.setUniformMatrixValue=function(t,e){this.getGL().uniformMatrix4fv(this.getUniformLocation(t),!1,e)},e.prototype.enableAttributeArray_=function(t,e,n,r,o){var i=this.getAttributeLocation(t);i<0||(this.getGL().enableVertexAttribArray(i),this.getGL().vertexAttribPointer(i,e,n,!1,r,o))},e.prototype.enableAttributes=function(t){for(var e=function(t){for(var e=0,n=0;n<t.length;n++){var r=t[n];e+=r.size*VE(r.type)}return e}(t),n=0,r=0;r<t.length;r++){var o=t[r];this.enableAttributeArray_(o.name,o.size,o.type||5126,e,n),n+=o.size*VE(o.type)}},e.prototype.handleWebGLContextLost=function(){ie(this.bufferCache_),this.currentProgram_=null},e.prototype.handleWebGLContextRestored=function(){},e.prototype.createTexture=function(t,e,n){var r=this.getGL(),o=n||r.createTexture(),i=r.RGBA,a=r.RGBA,s=r.UNSIGNED_BYTE;return r.bindTexture(r.TEXTURE_2D,o),e?r.texImage2D(r.TEXTURE_2D,0,i,a,s,e):r.texImage2D(r.TEXTURE_2D,0,i,t[0],t[1],0,a,s,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),o},e}(s);function VE(t){switch(t){case BE.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case BE.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case BE.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case BE.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}const zE=HE;var YE=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),KE="GENERATE_BUFFERS",XE=function(t){function e(e,n){var r=t.call(this,e)||this,o=n||{};return r.inversePixelTransform_=[1,0,0,1,0,0],r.pixelContext_=null,r.postProcesses_=o.postProcesses,r.uniforms_=o.uniforms,r.helper,e.addChangeListener(Ie,r.removeHelper.bind(r)),r.dispatchPreComposeEvent=r.dispatchPreComposeEvent.bind(r),r.dispatchPostComposeEvent=r.dispatchPostComposeEvent.bind(r),r}return YE(e,t),e.prototype.dispatchPreComposeEvent=function(t,e){var n=this.getLayer();if(n.hasListener(Ze.PRECOMPOSE)){var r=new nn(Ze.PRECOMPOSE,void 0,e,t);n.dispatchEvent(r)}},e.prototype.dispatchPostComposeEvent=function(t,e){var n=this.getLayer();if(n.hasListener(Ze.POSTCOMPOSE)){var r=new nn(Ze.POSTCOMPOSE,void 0,e,t);n.dispatchEvent(r)}},e.prototype.reset=function(t){this.uniforms_=t.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)},e.prototype.removeHelper=function(){this.helper&&(this.helper.dispose(),delete this.helper)},e.prototype.prepareFrame=function(t){if(this.getLayer().getRenderSource()){for(var n=!0,r=-1,o=void 0,i=0,a=t.layerStatesArray.length;i<a;i++){var s=t.layerStatesArray[i].layer,l=s.getRenderer();if(l instanceof e){var c=s.getClassName();if((n||c!==o)&&(r+=1,n=!1),o=c,l===this)break}else n=!0}var u="map/"+t.mapId+"/group/"+r;this.helper&&this.helper.canvasCacheKeyMatches(u)||(this.removeHelper(),this.helper=new zE({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:u}),o&&(this.helper.getCanvas().className=o),this.afterHelperCreated())}return this.prepareFrameInternal(t)},e.prototype.afterHelperCreated=function(){},e.prototype.prepareFrameInternal=function(t){return!0},e.prototype.disposeInternal=function(){this.removeHelper(),t.prototype.disposeInternal.call(this)},e.prototype.dispatchRenderEvent_=function(t,e,n){var r=this.getLayer();if(r.hasListener(t)){F(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);var o=new nn(t,this.inversePixelTransform_,n,e);r.dispatchEvent(o)}},e.prototype.preRender=function(t,e){this.dispatchRenderEvent_(Ze.PRERENDER,t,e)},e.prototype.postRender=function(t,e){this.dispatchRenderEvent_(Ze.POSTRENDER,t,e)},e.prototype.getDataAtPixel=function(t,e,n){var r=k([e.pixelRatio,0,0,e.pixelRatio,0,0],t.slice()),o=this.helper.getGL();if(!o)return null;var i=this.getLayer().getExtent();if(i&&!et(i,k(e.pixelToCoordinateTransform,t.slice())))return null;var a=o.getContextAttributes();if(!a||!a.preserveDrawingBuffer)return new Uint8Array;var s,l=Math.round(r[0]),c=Math.round(r[1]),u=this.pixelContext_;if(!u){var p=document.createElement("canvas");p.width=1,p.height=1,u=p.getContext("2d"),this.pixelContext_=u}u.clearRect(0,0,1,1);try{u.drawImage(o.canvas,l,c,1,1,0,0,1,1),s=u.getImageData(0,0,1,1).data}catch(t){return s}return 0===s[3]?null:s},e}(Wv);const $E=XE;var JE=new Uint8Array(4),QE=function(){function t(t,e){this.helper_=t;var n=t.getGL();this.texture_=n.createTexture(),this.framebuffer_=n.createFramebuffer(),this.size_=e||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}return t.prototype.setSize=function(t){f(t,this.size_)||(this.size_[0]=t[0],this.size_[1]=t[1],this.updateSize_())},t.prototype.getSize=function(){return this.size_},t.prototype.clearCachedData=function(){this.dataCacheDirty_=!0},t.prototype.readAll=function(){if(this.dataCacheDirty_){var t=this.size_,e=this.helper_.getGL();e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.readPixels(0,0,t[0],t[1],e.RGBA,e.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_},t.prototype.readPixel=function(t,e){if(t<0||e<0||t>this.size_[0]||e>=this.size_[1])return JE[0]=0,JE[1]=0,JE[2]=0,JE[3]=0,JE;this.readAll();var n=Math.floor(t)+(this.size_[1]-Math.floor(e)-1)*this.size_[0];return JE[0]=this.data_[4*n],JE[1]=this.data_[4*n+1],JE[2]=this.data_[4*n+2],JE[3]=this.data_[4*n+3],JE},t.prototype.getTexture=function(){return this.texture_},t.prototype.getFramebuffer=function(){return this.framebuffer_},t.prototype.updateSize_=function(){var t=this.size_,e=this.helper_.getGL();this.texture_=this.helper_.createTexture(t,null,this.texture_),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.viewport(0,0,t[0],t[1]),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture_,0),this.data_=new Uint8Array(t[0]*t[1]*4)},t}();const tw=QE;var ew=n(2486).Buffer;var nw=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const rw=function(t){function e(e,n){var r=this,o=n.uniforms||{},a=[1,0,0,1,0,0];o[DE]=a,(r=t.call(this,e,{uniforms:o,postProcesses:n.postProcesses})||this).ready=!1,r.sourceRevision_=-1,r.verticesBuffer_=new AE(CE,wE),r.hitVerticesBuffer_=new AE(CE,wE),r.indicesBuffer_=new AE(EE,wE),r.vertexShader_=n.vertexShader,r.fragmentShader_=n.fragmentShader,r.program_,r.hitDetectionEnabled_=!(!n.hitFragmentShader||!n.hitVertexShader),r.hitVertexShader_=n.hitVertexShader,r.hitFragmentShader_=n.hitFragmentShader,r.hitProgram_;var s=n.attributes?n.attributes.map((function(t){return{name:"a_"+t.name,size:1,type:BE.FLOAT}})):[];r.attributes=[{name:"a_position",size:2,type:BE.FLOAT},{name:"a_index",size:1,type:BE.FLOAT}].concat(s),r.hitDetectionAttributes=[{name:"a_position",size:2,type:BE.FLOAT},{name:"a_index",size:1,type:BE.FLOAT},{name:"a_hitColor",size:4,type:BE.FLOAT},{name:"a_featureUid",size:1,type:BE.FLOAT}].concat(s),r.customAttributes=n.attributes?n.attributes:[],r.previousExtent_=[1/0,1/0,-1/0,-1/0],r.currentTransform_=a,r.renderTransform_=[1,0,0,1,0,0],r.invertRenderTransform_=[1,0,0,1,0,0],r.renderInstructions_=new Float32Array(0),r.hitRenderInstructions_=new Float32Array(0),r.hitRenderTarget_,r.generateBuffersRun_=0,r.worker_=function(){var t='var e="function"==typeof Object.assign?Object.assign:function(e,n){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1,o=arguments.length;r<o;++r){var i=arguments[r];if(null!=i)for(var f in i)i.hasOwnProperty(f)&&(t[f]=i[f])}return t},n="GENERATE_BUFFERS",t=[],r={vertexPosition:0,indexPosition:0};function o(e,n,t,r,o){e[n+0]=t,e[n+1]=r,e[n+2]=o}function i(e,n,i,f,s,a){var u=3+s,l=e[n+0],v=e[n+1],c=t;c.length=s;for(var g=0;g<c.length;g++)c[g]=e[n+2+g];var b=a?a.vertexPosition:0,h=a?a.indexPosition:0,d=b/u;return o(i,b,l,v,0),c.length&&i.set(c,b+3),o(i,b+=u,l,v,1),c.length&&i.set(c,b+3),o(i,b+=u,l,v,2),c.length&&i.set(c,b+3),o(i,b+=u,l,v,3),c.length&&i.set(c,b+3),b+=u,f[h++]=d,f[h++]=d+1,f[h++]=d+3,f[h++]=d+1,f[h++]=d+2,f[h++]=d+3,r.vertexPosition=b,r.indexPosition=h,r}var f=self;f.onmessage=function(t){var r=t.data;if(r.type===n){for(var o,s=r.customAttributesCount,a=2+s,u=new Float32Array(r.renderInstructions),l=u.length/a,v=4*l*(s+3),c=new Uint32Array(6*l),g=new Float32Array(v),b=0;b<u.length;b+=a)o=i(u,b,g,c,s,o);var h=e({vertexBuffer:g.buffer,indexBuffer:c.buffer,renderInstructions:u.buffer},r);f.postMessage(h,[g.buffer,c.buffer,u.buffer])}};';return new Worker("undefined"==typeof Blob?"data:application/javascript;base64,"+ew.from(t,"binary").toString("base64"):URL.createObjectURL(new Blob([t],{type:"application/javascript"})))}(),r.worker_.addEventListener("message",function(t){var e=t.data;if(e.type===KE){var n=e.projectionTransform;e.hitDetection?(this.hitVerticesBuffer_.fromArrayBuffer(e.vertexBuffer),this.helper.flushBufferData(this.hitVerticesBuffer_)):(this.verticesBuffer_.fromArrayBuffer(e.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_)),this.indicesBuffer_.fromArrayBuffer(e.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=n,U(this.invertRenderTransform_,this.renderTransform_),e.hitDetection?this.hitRenderInstructions_=new Float32Array(t.data.renderInstructions):(this.renderInstructions_=new Float32Array(t.data.renderInstructions),e.generateBuffersRun===this.generateBuffersRun_&&(this.ready=!0)),this.getLayer().changed()}}.bind(r)),r.featureCache_={},r.featureCount_=0;var l=r.getLayer().getSource();return r.sourceListenKeys_=[de(l,k_.ADDFEATURE,r.handleSourceFeatureAdded_,r),de(l,k_.CHANGEFEATURE,r.handleSourceFeatureChanged_,r),de(l,k_.REMOVEFEATURE,r.handleSourceFeatureDelete_,r),de(l,k_.CLEAR,r.handleSourceFeatureClear_,r)],l.forEachFeature(function(t){this.featureCache_[i(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()},this.featureCount_++}.bind(r)),r}return nw(e,t),e.prototype.afterHelperCreated=function(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitProgram_=this.helper.getProgram(this.hitFragmentShader_,this.hitVertexShader_),this.hitRenderTarget_=new tw(this.helper))},e.prototype.handleSourceFeatureAdded_=function(t){var e=t.feature;this.featureCache_[i(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()},this.featureCount_++},e.prototype.handleSourceFeatureChanged_=function(t){var e=t.feature;this.featureCache_[i(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()}},e.prototype.handleSourceFeatureDelete_=function(t){var e=t.feature;delete this.featureCache_[i(e)],this.featureCount_--},e.prototype.handleSourceFeatureClear_=function(){this.featureCache_={},this.featureCount_=0},e.prototype.renderFrame=function(t){var e=this.helper.getGL();this.preRender(e,t);var n=this.indicesBuffer_.getSize();this.helper.drawElements(0,n),this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);var r=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderHitDetection(t),this.hitRenderTarget_.clearCachedData()),this.postRender(e,t),r},e.prototype.prepareFrameInternal=function(t){var e=this.getLayer(),n=e.getSource(),r=t.viewState,o=!t.viewHints[Ar]&&!t.viewHints[Or],i=!ut(this.previousExtent_,t.extent),a=this.sourceRevision_<n.getRevision();if(a&&(this.sourceRevision_=n.getRevision()),o&&(i||a)){var s=r.projection,l=r.resolution,c=e instanceof gv?e.getRenderBuffer():0,u=J(t.extent,c*l);n.loadFeatures(u,l,s),this.rebuildBuffers_(t),this.previousExtent_=t.extent.slice()}return this.helper.makeProjectionTransform(t,this.currentTransform_),Z(this.currentTransform_,this.invertRenderTransform_),this.helper.useProgram(this.program_),this.helper.prepareDraw(t),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0},e.prototype.rebuildBuffers_=function(t){var e=[1,0,0,1,0,0];this.helper.makeProjectionTransform(t,e);var n,r,o=(2+this.customAttributes.length)*this.featureCount_;if(this.renderInstructions_&&this.renderInstructions_.length===o||(this.renderInstructions_=new Float32Array(o)),this.hitDetectionEnabled_){var i=(7+this.customAttributes.length)*this.featureCount_;this.hitRenderInstructions_&&this.hitRenderInstructions_.length===i||(this.hitRenderInstructions_=new Float32Array(i))}var a,s,l,c,u,p=[],d=[],h=0,f=0;for(var m in this.featureCache_)if((r=(n=this.featureCache_[m]).geometry)&&r.getType()===br.POINT){p[0]=r.getFlatCoordinates()[0],p[1]=r.getFlatCoordinates()[1],k(e,p),s=f+6,l=void 0,c=void 0,u=void 0,c=256,u=255,(l=d||[])[0]=Math.floor(s/c/c/c)/u,l[1]=Math.floor(s/c/c)%c/u,l[2]=Math.floor(s/c)%c/u,l[3]=s%c/u,a=l,this.renderInstructions_[h++]=p[0],this.renderInstructions_[h++]=p[1],this.hitDetectionEnabled_&&(this.hitRenderInstructions_[f++]=p[0],this.hitRenderInstructions_[f++]=p[1],this.hitRenderInstructions_[f++]=a[0],this.hitRenderInstructions_[f++]=a[1],this.hitRenderInstructions_[f++]=a[2],this.hitRenderInstructions_[f++]=a[3],this.hitRenderInstructions_[f++]=Number(m));for(var g=void 0,y=0;y<this.customAttributes.length;y++)g=this.customAttributes[y].callback(n.feature,n.properties),this.renderInstructions_[h++]=g,this.hitDetectionEnabled_&&(this.hitRenderInstructions_[f++]=g)}var v={type:KE,renderInstructions:this.renderInstructions_.buffer,customAttributesCount:this.customAttributes.length};if(v.projectionTransform=e,v.generateBuffersRun=++this.generateBuffersRun_,this.ready=!1,this.worker_.postMessage(v,[this.renderInstructions_.buffer]),this.renderInstructions_=null,this.hitDetectionEnabled_){var _={type:KE,renderInstructions:this.hitRenderInstructions_.buffer,customAttributesCount:5+this.customAttributes.length};_.projectionTransform=e,_.hitDetection=!0,this.worker_.postMessage(_,[this.hitRenderInstructions_.buffer]),this.hitRenderInstructions_=null}},e.prototype.forEachFeatureAtCoordinate=function(t,e,n,r,o){if(x(this.hitDetectionEnabled_,66),this.hitRenderInstructions_){var i=k(e.coordinateToPixelTransform,t.slice()),a=this.hitRenderTarget_.readPixel(i[0]/2,i[1]/2),s=function(t){var e=0,n=256,r=255;return e+=Math.round(t[0]*n*n*n*r),e+=Math.round(t[1]*n*n*r),e+=Math.round(t[2]*n*r),e+Math.round(t[3]*r)}([a[0]/255,a[1]/255,a[2]/255,a[3]/255]),l=this.hitRenderInstructions_[s],c=Math.floor(l).toString(),u=this.getLayer().getSource().getFeatureByUid(c);return u?r(u,this.getLayer(),null):void 0}},e.prototype.renderHitDetection=function(t){if(this.hitVerticesBuffer_.getSize()){this.hitRenderTarget_.setSize([Math.floor(t.size[0]/2),Math.floor(t.size[1]/2)]),this.helper.useProgram(this.hitProgram_),this.helper.prepareDrawToRenderTarget(t,this.hitRenderTarget_,!0),this.helper.bindBuffer(this.hitVerticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.hitDetectionAttributes);var e=this.indicesBuffer_.getSize();this.helper.drawElements(0,e)}},e.prototype.disposeInternal=function(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach((function(t){fe(t)})),this.sourceListenKeys_=null,t.prototype.disposeInternal.call(this)},e}($E);var ow=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),iw="blur",aw="gradient",sw="radius",lw=["#00f","#0ff","#0f0","#ff0","#f00"];const cw=function(t){function e(e){var n=this,r=e||{},o=oe({},r);delete o.gradient,delete o.radius,delete o.blur,delete o.weight,(n=t.call(this,o)||this).gradient_=null,n.addChangeListener(aw,n.handleGradientChanged_),n.setGradient(r.gradient?r.gradient:lw),n.setBlur(void 0!==r.blur?r.blur:15),n.setRadius(void 0!==r.radius?r.radius:8);var i=r.weight?r.weight:"weight";return n.weightFunction_="string"==typeof i?function(t){return t.get(i)}:i,n.setRenderOrder(null),n}return ow(e,t),e.prototype.getBlur=function(){return this.get(iw)},e.prototype.getGradient=function(){return this.get(aw)},e.prototype.getRadius=function(){return this.get(sw)},e.prototype.handleGradientChanged_=function(){this.gradient_=function(t){for(var e=1,n=256,r=dn(e,n),o=r.createLinearGradient(0,0,e,n),i=1/(t.length-1),a=0,s=t.length;a<s;++a)o.addColorStop(a*i,t[a]);return r.fillStyle=o,r.fillRect(0,0,e,n),r.canvas}(this.getGradient())},e.prototype.setBlur=function(t){this.set(iw,t)},e.prototype.setGradient=function(t){this.set(aw,t)},e.prototype.setRadius=function(t){this.set(sw,t)},e.prototype.createRenderer=function(){return new rw(this,{className:this.getClassName(),attributes:[{name:"weight",callback:function(t){var e=this.weightFunction_(t);return void 0!==e?It(e,0,1):1}.bind(this)}],vertexShader:"\n        precision mediump float;\n        uniform mat4 u_projectionMatrix;\n        uniform mat4 u_offsetScaleMatrix;\n        uniform float u_size;\n        attribute vec2 a_position;\n        attribute float a_index;\n        attribute float a_weight;\n\n        varying vec2 v_texCoord;\n        varying float v_weight;\n\n        void main(void) {\n          mat4 offsetMatrix = u_offsetScaleMatrix;\n          float offsetX = a_index == 0.0 || a_index == 3.0 ? -u_size / 2.0 : u_size / 2.0;\n          float offsetY = a_index == 0.0 || a_index == 1.0 ? -u_size / 2.0 : u_size / 2.0;\n          vec4 offsets = offsetMatrix * vec4(offsetX, offsetY, 0.0, 0.0);\n          gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\n          float u = a_index == 0.0 || a_index == 3.0 ? 0.0 : 1.0;\n          float v = a_index == 0.0 || a_index == 1.0 ? 0.0 : 1.0;\n          v_texCoord = vec2(u, v);\n          v_weight = a_weight;\n        }",fragmentShader:"\n        precision mediump float;\n        uniform float u_blurSlope;\n\n        varying vec2 v_texCoord;\n        varying float v_weight;\n\n        void main(void) {\n          vec2 texCoord = v_texCoord * 2.0 - vec2(1.0, 1.0);\n          float sqRadius = texCoord.x * texCoord.x + texCoord.y * texCoord.y;\n          float value = (1.0 - sqrt(sqRadius)) * u_blurSlope;\n          float alpha = smoothstep(0.0, 1.0, value) * v_weight;\n          gl_FragColor = vec4(alpha, alpha, alpha, alpha);\n        }",hitVertexShader:"\n        precision mediump float;\n        uniform mat4 u_projectionMatrix;\n        uniform mat4 u_offsetScaleMatrix;\n        uniform float u_size;\n        attribute vec2 a_position;\n        attribute float a_index;\n        attribute float a_weight;\n        attribute vec4 a_hitColor;\n\n        varying vec2 v_texCoord;\n        varying float v_weight;\n        varying vec4 v_hitColor;\n\n        void main(void) {\n          mat4 offsetMatrix = u_offsetScaleMatrix;\n          float offsetX = a_index == 0.0 || a_index == 3.0 ? -u_size / 2.0 : u_size / 2.0;\n          float offsetY = a_index == 0.0 || a_index == 1.0 ? -u_size / 2.0 : u_size / 2.0;\n          vec4 offsets = offsetMatrix * vec4(offsetX, offsetY, 0.0, 0.0);\n          gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\n          float u = a_index == 0.0 || a_index == 3.0 ? 0.0 : 1.0;\n          float v = a_index == 0.0 || a_index == 1.0 ? 0.0 : 1.0;\n          v_texCoord = vec2(u, v);\n          v_hitColor = a_hitColor;\n          v_weight = a_weight;\n        }",hitFragmentShader:"\n        precision mediump float;\n        uniform float u_blurSlope;\n\n        varying vec2 v_texCoord;\n        varying float v_weight;\n        varying vec4 v_hitColor;\n\n        void main(void) {\n          vec2 texCoord = v_texCoord * 2.0 - vec2(1.0, 1.0);\n          float sqRadius = texCoord.x * texCoord.x + texCoord.y * texCoord.y;\n          float value = (1.0 - sqrt(sqRadius)) * u_blurSlope;\n          float alpha = smoothstep(0.0, 1.0, value) * v_weight;\n          if (alpha < 0.05) {\n            discard;\n          }\n\n          gl_FragColor = v_hitColor;\n        }",uniforms:{u_size:function(){return 2*(this.get(sw)+this.get(iw))}.bind(this),u_blurSlope:function(){return this.get(sw)/Math.max(1,this.get(iw))}.bind(this)},postProcesses:[{fragmentShader:"\n            precision mediump float;\n\n            uniform sampler2D u_image;\n            uniform sampler2D u_gradientTexture;\n            uniform float u_opacity;\n\n            varying vec2 v_texCoord;\n\n            void main() {\n              vec4 color = texture2D(u_image, v_texCoord);\n              gl_FragColor.a = color.a * u_opacity;\n              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;\n              gl_FragColor.rgb *= gl_FragColor.a;\n            }",uniforms:{u_gradientTexture:function(){return this.gradient_}.bind(this),u_opacity:function(){return this.getOpacity()}.bind(this)}}]})},e.prototype.renderDeclutter=function(){},e}(gv);function uw(t,e,n,r){return void 0!==r?(r[0]=t,r[1]=e,r[2]=n,r):[t,e,n]}function pw(t,e,n){return t+"/"+e+"/"+n}function dw(t){return pw(t[0],t[1],t[2])}var hw=[0,0,0],fw=function(){function t(t){var e,n,r,o;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,x((e=this.resolutions_,n=!0,r=function(t,e){return e-t}||l,e.every((function(t,o){if(0===o)return!0;var i=r(e[o-1],t);return!(i>0||n&&0===i)}))),17),!t.origins)for(var i=0,a=this.resolutions_.length-1;i<a;++i)if(o){if(this.resolutions_[i]/this.resolutions_[i+1]!==o){o=void 0;break}}else o=this.resolutions_[i]/this.resolutions_[i+1];this.zoomFactor_=o,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,x(this.origins_.length==this.resolutions_.length,20));var s=t.extent;void 0===s||this.origin_||this.origins_||(this.origin_=bt(s)),x(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,x(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:Ir,x(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==s?s:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map((function(t,e){var n=new sE(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1));if(s){var r=this.getTileRangeForExtentAndZ(s,e);n.minX=Math.max(r.minX,n.minX),n.maxX=Math.min(r.maxX,n.maxX),n.minY=Math.max(r.minY,n.minY),n.maxY=Math.min(r.maxY,n.maxY)}return n}),this):s&&this.calculateTileRanges_(s)}return t.prototype.forEachTileCoord=function(t,e,n){for(var r=this.getTileRangeForExtentAndZ(t,e),o=r.minX,i=r.maxX;o<=i;++o)for(var a=r.minY,s=r.maxY;a<=s;++a)n([e,o,a])},t.prototype.forEachTileCoordParentTileRange=function(t,e,n,r){var o,i,a=null,s=t[0]-1;for(2===this.zoomFactor_?(o=t[1],i=t[2]):a=this.getTileCoordExtent(t,r);s>=this.minZoom;){if(e(s,2===this.zoomFactor_?aE(o=Math.floor(o/2),o,i=Math.floor(i/2),i,n):this.getTileRangeForExtentAndZ(a,s,n)))return!0;--s}return!1},t.prototype.getExtent=function(){return this.extent_},t.prototype.getMaxZoom=function(){return this.maxZoom},t.prototype.getMinZoom=function(){return this.minZoom},t.prototype.getOrigin=function(t){return this.origin_?this.origin_:this.origins_[t]},t.prototype.getResolution=function(t){return this.resolutions_[t]},t.prototype.getResolutions=function(){return this.resolutions_},t.prototype.getTileCoordChildTileRange=function(t,e,n){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){var r=2*t[1],o=2*t[2];return aE(r,r+1,o,o+1,e)}var i=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(i,t[0]+1,e)}return null},t.prototype.getTileRangeForTileCoordAndZ=function(t,e,n){if(e>this.maxZoom||e<this.minZoom)return null;var r=t[0],o=t[1],i=t[2];if(e===r)return aE(o,i,o,i,n);if(this.zoomFactor_){var a=Math.pow(this.zoomFactor_,e-r),s=Math.floor(o*a),l=Math.floor(i*a);return e<r?aE(s,s,l,l,n):aE(s,Math.floor(a*(o+1))-1,l,Math.floor(a*(i+1))-1,n)}var c=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(c,e,n)},t.prototype.getTileRangeExtent=function(t,e,n){var r=this.getOrigin(t),o=this.getResolution(t),i=qi(this.getTileSize(t),this.tmpSize_),a=r[0]+e.minX*i[0]*o,s=r[0]+(e.maxX+1)*i[0]*o;return at(a,r[1]+e.minY*i[1]*o,s,r[1]+(e.maxY+1)*i[1]*o,n)},t.prototype.getTileRangeForExtentAndZ=function(t,e,n){var r=hw;this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,r);var o=r[1],i=r[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,r),aE(o,r[1],i,r[2],n)},t.prototype.getTileCoordCenter=function(t){var e=this.getOrigin(t[0]),n=this.getResolution(t[0]),r=qi(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*r[0]*n,e[1]-(t[2]+.5)*r[1]*n]},t.prototype.getTileCoordExtent=function(t,e){var n=this.getOrigin(t[0]),r=this.getResolution(t[0]),o=qi(this.getTileSize(t[0]),this.tmpSize_),i=n[0]+t[1]*o[0]*r,a=n[1]-(t[2]+1)*o[1]*r;return at(i,a,i+o[0]*r,a+o[1]*r,e)},t.prototype.getTileCoordForCoordAndResolution=function(t,e,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,n)},t.prototype.getTileCoordForXYAndResolution_=function(t,e,n,r,o){var i=this.getZForResolution(n),a=n/this.getResolution(i),s=this.getOrigin(i),l=qi(this.getTileSize(i),this.tmpSize_),c=a*(t-s[0])/n/l[0],u=a*(s[1]-e)/n/l[1];return r?(c=jt(c,5)-1,u=jt(u,5)-1):(c=Bt(c,5),u=Bt(u,5)),uw(i,c,u,o)},t.prototype.getTileCoordForXYAndZ_=function(t,e,n,r,o){var i=this.getOrigin(n),a=this.getResolution(n),s=qi(this.getTileSize(n),this.tmpSize_),l=(t-i[0])/a/s[0],c=(i[1]-e)/a/s[1];return r?(l=jt(l,5)-1,c=jt(c,5)-1):(l=Bt(l,5),c=Bt(c,5)),uw(n,l,c,o)},t.prototype.getTileCoordForCoordAndZ=function(t,e,n){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,n)},t.prototype.getTileCoordResolution=function(t){return this.resolutions_[t[0]]},t.prototype.getTileSize=function(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]},t.prototype.getFullTileRange=function(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null},t.prototype.getZForResolution=function(t,e){return It(u(this.resolutions_,t,e||0),this.minZoom,this.maxZoom)},t.prototype.calculateTileRanges_=function(t){for(var e=this.resolutions_.length,n=new Array(e),r=this.minZoom;r<e;++r)n[r]=this.getTileRangeForExtentAndZ(t,r);this.fullTileRanges_=n},t}();const mw=fw;var gw=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),yw=function(t){function e(e){var n=t.call(this,{attributions:e.attributions,wrapX:e.wrapX})||this;return n.resolution=void 0,n.distance=void 0!==e.distance?e.distance:20,n.minDistance=e.minDistance||0,n.interpolationRatio=0,n.features=[],n.geometryFunction=e.geometryFunction||function(t){var e=t.getGeometry();return x(e.getType()==br.POINT,10),e},n.createCustomCluster_=e.createCluster,n.source=null,n.boundRefresh_=n.refresh.bind(n),n.updateDistance(n.distance,n.minDistance),n.setSource(e.source||null),n}return gw(e,t),e.prototype.clear=function(e){this.features.length=0,t.prototype.clear.call(this,e)},e.prototype.getDistance=function(){return this.distance},e.prototype.getSource=function(){return this.source},e.prototype.loadFeatures=function(t,e,n){this.source.loadFeatures(t,e,n),e!==this.resolution&&(this.resolution=e,this.refresh())},e.prototype.setDistance=function(t){this.updateDistance(t,this.minDistance)},e.prototype.setMinDistance=function(t){this.updateDistance(this.distance,t)},e.prototype.getMinDistance=function(){return this.minDistance},e.prototype.setSource=function(t){this.source&&this.source.removeEventListener(pe.CHANGE,this.boundRefresh_),this.source=t,t&&t.addEventListener(pe.CHANGE,this.boundRefresh_),this.refresh()},e.prototype.refresh=function(){this.clear(),this.cluster(),this.addFeatures(this.features)},e.prototype.updateDistance=function(t,e){var n=0===t?0:Math.min(e,t)/t,r=t!==this.distance||this.interpolationRatio!==n;this.distance=t,this.minDistance=e,this.interpolationRatio=n,r&&this.refresh()},e.prototype.cluster=function(){if(void 0!==this.resolution&&this.source)for(var t=[1/0,1/0,-1/0,-1/0],e=this.distance*this.resolution,n=this.source.getFeatures(),r={},o=0,a=n.length;o<a;o++){var s=n[o];if(!(i(s)in r)){var l=this.geometryFunction(s);if(l){lt(l.getCoordinates(),t),J(t,e,t);var c=this.source.getFeaturesInExtent(t).filter((function(t){var e=i(t);return!(e in r)&&(r[e]=!0,!0)}));this.features.push(this.createCluster(c,t))}}}},e.prototype.createCluster=function(t,e){for(var n=[0,0],r=t.length-1;r>=0;--r){var o=this.geometryFunction(t[r]);o?Ge(n,o.getCoordinates()):t.splice(r,1)}qe(n,1/t.length);var i=_t(e),a=this.interpolationRatio,s=new _i([n[0]*(1-a)+i[0]*a,n[1]*(1-a)+i[1]*a]);return this.createCustomCluster_?this.createCustomCluster_(s,t):new Xs({geometry:s,features:t})},e}(B_);const vw=yw;var _w="1.3.0",Cw=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const Ew=function(t){function e(e,n,r,o,i,a,s){var l=this,c=e.getExtent(),u=n.getExtent(),p=u?St(r,u):r,d=tE(e,n,_t(p),o),h=new YC(e,n,p,c,.5*d,o),f=a(h.calculateSourceExtent(),d,i),m=f?Sh:Ph,g=f?f.getPixelRatio():1;return(l=t.call(this,r,o,g,m)||this).targetProj_=n,l.maxSourceExtent_=c,l.triangulation_=h,l.targetResolution_=o,l.targetExtent_=r,l.sourceImage_=f,l.sourcePixelRatio_=g,l.interpolate_=s,l.canvas_=null,l.sourceListenerKey_=null,l}return Cw(e,t),e.prototype.disposeInternal=function(){this.state==bh&&this.unlistenSource_(),t.prototype.disposeInternal.call(this)},e.prototype.getImage=function(){return this.canvas_},e.prototype.getProjection=function(){return this.targetProj_},e.prototype.reproject_=function(){var t=this.sourceImage_.getState();if(t==Lh){var e=Tt(this.targetExtent_)/this.targetResolution_,n=wt(this.targetExtent_)/this.targetResolution_;this.canvas_=eE(e,n,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_)}this.state=t,this.changed()},e.prototype.load=function(){if(this.state==Sh){this.state=bh,this.changed();var t=this.sourceImage_.getState();t==Lh||t==Th?this.reproject_():(this.sourceListenerKey_=de(this.sourceImage_,pe.CHANGE,(function(t){var e=this.sourceImage_.getState();e!=Lh&&e!=Th||(this.unlistenSource_(),this.reproject_())}),this),this.sourceImage_.load())}},e.prototype.unlistenSource_=function(){fe(this.sourceListenerKey_),this.sourceListenerKey_=null},e}(Ih);var ww=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Sw="imageloadstart",bw="imageloadend",Lw="imageloaderror",Tw=function(t){function e(e,n){var r=t.call(this,e)||this;return r.image=n,r}return ww(e,t),e}(ne),Pw=function(t){function e(e){var n=this,r=void 0===e.imageSmoothing||e.imageSmoothing;return void 0!==e.interpolate&&(r=e.interpolate),(n=t.call(this,{attributions:e.attributions,projection:e.projection,state:e.state,interpolate:r})||this).on,n.once,n.un,n.resolutions_=void 0!==e.resolutions?e.resolutions:null,n.reprojectedImage_=null,n.reprojectedRevision_=0,n}return ww(e,t),e.prototype.getResolutions=function(){return this.resolutions_},e.prototype.findNearestResolution=function(t){if(this.resolutions_){var e=u(this.resolutions_,t,0);t=this.resolutions_[e]}return t},e.prototype.getImage=function(t,e,n,r){var o=this.getProjection();if(o&&r&&!uo(o,r)){if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&uo(this.reprojectedImage_.getProjection(),r)&&this.reprojectedImage_.getResolution()==e&&ut(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new Ew(o,r,t,e,n,function(t,e,n){return this.getImageInternal(t,e,n,o)}.bind(this),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}return o&&(r=o),this.getImageInternal(t,e,n,r)},e.prototype.getImageInternal=function(t,e,n,o){return r()},e.prototype.handleImageChange=function(t){var e,n=t.target;switch(n.getState()){case bh:this.loading=!0,e=Sw;break;case Lh:this.loading=!1,e=bw;break;case Th:this.loading=!1,e=Lw;break;default:return}this.hasListener(e)&&this.dispatchEvent(new Tw(e,n))},e}(D_);function Aw(t,e){t.getImage().src=e}const Ow=Pw,xw={CARMENTA_SERVER:"carmentaserver",GEOSERVER:"geoserver",MAPSERVER:"mapserver",QGIS:"qgis"};function Iw(t,e){var n=[];Object.keys(e).forEach((function(t){null!==e[t]&&void 0!==e[t]&&n.push(t+"="+encodeURIComponent(e[t]))}));var r=n.join("&");return(t=-1===(t=t.replace(/[?&]$/,"")).indexOf("?")?t+"?":t+"&")+r}var Mw=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Rw=[101,101],Zw=function(t){function e(e){var n=this,r=e||{},o=void 0===r.imageSmoothing||r.imageSmoothing;return void 0!==r.interpolate&&(o=r.interpolate),(n=t.call(this,{attributions:r.attributions,interpolate:o,projection:r.projection,resolutions:r.resolutions})||this).crossOrigin_=void 0!==r.crossOrigin?r.crossOrigin:null,n.url_=r.url,n.imageLoadFunction_=void 0!==r.imageLoadFunction?r.imageLoadFunction:Aw,n.params_=r.params||{},n.v13_=!0,n.updateV13_(),n.serverType_=r.serverType,n.hidpi_=void 0===r.hidpi||r.hidpi,n.image_=null,n.imageSize_=[0,0],n.renderedRevision_=0,n.ratio_=void 0!==r.ratio?r.ratio:1.5,n}return Mw(e,t),e.prototype.getFeatureInfoUrl=function(t,e,n,r){if(void 0!==this.url_){var o=io(n),i=this.getProjection();i&&i!==o&&(e=tE(i,o,t,e),t=fo(t,o,i));var a=Et(t,e,0,Rw),s={SERVICE:"WMS",VERSION:_w,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};oe(s,this.params_,r);var l=Bt((t[0]-a[0])/e,4),c=Bt((a[3]-t[1])/e,4);return s[this.v13_?"I":"X"]=l,s[this.v13_?"J":"Y"]=c,this.getRequestUrl_(a,Rw,1,i||o,s)}},e.prototype.getLegendUrl=function(t,e){if(void 0!==this.url_){var n={SERVICE:"WMS",VERSION:_w,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===e||void 0===e.LAYER){var r=this.params_.LAYERS;if(!(!Array.isArray(r)||1===r.length))return;n.LAYER=r}if(void 0!==t){var o=this.getProjection()?this.getProjection().getMetersPerUnit():1;n.SCALE=t*o/28e-5}return oe(n,e),Iw(this.url_,n)}},e.prototype.getParams=function(){return this.params_},e.prototype.getImageInternal=function(t,e,n,r){if(void 0===this.url_)return null;e=this.findNearestResolution(e),1==n||this.hidpi_&&void 0!==this.serverType_||(n=1);var o=e/n,i=_t(t),a=Et(i,o,0,[jt(Tt(t)/o,4),jt(wt(t)/o,4)]),s=Et(i,o,0,[jt(this.ratio_*Tt(t)/o,4),jt(this.ratio_*wt(t)/o,4)]),l=this.image_;if(l&&this.renderedRevision_==this.getRevision()&&l.getResolution()==e&&l.getPixelRatio()==n&&nt(l.getExtent(),a))return l;var c={SERVICE:"WMS",VERSION:_w,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};oe(c,this.params_),this.imageSize_[0]=Gt(Tt(s)/o,4),this.imageSize_[1]=Gt(wt(s)/o,4);var u=this.getRequestUrl_(s,this.imageSize_,n,r,c);return this.image_=new Zh(s,e,n,u,this.crossOrigin_,this.imageLoadFunction_),this.renderedRevision_=this.getRevision(),this.image_.addEventListener(pe.CHANGE,this.handleImageChange.bind(this)),this.image_},e.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_},e.prototype.getRequestUrl_=function(t,e,n,r,o){if(x(void 0!==this.url_,9),o[this.v13_?"CRS":"SRS"]=r.getCode(),"STYLES"in this.params_||(o.STYLES=""),1!=n)switch(this.serverType_){case xw.GEOSERVER:var i=90*n+.5|0;"FORMAT_OPTIONS"in o?o.FORMAT_OPTIONS+=";dpi:"+i:o.FORMAT_OPTIONS="dpi:"+i;break;case xw.MAPSERVER:o.MAP_RESOLUTION=90*n;break;case xw.CARMENTA_SERVER:case xw.QGIS:o.DPI=90*n;break;default:x(!1,8)}o.WIDTH=e[0],o.HEIGHT=e[1];var a,s=r.getAxisOrientation();return a=this.v13_&&"ne"==s.substr(0,2)?[t[1],t[0],t[3],t[2]]:t,o.BBOX=a.join(","),Iw(this.url_,o)},e.prototype.getUrl=function(){return this.url_},e.prototype.setImageLoadFunction=function(t){this.image_=null,this.imageLoadFunction_=t,this.changed()},e.prototype.setUrl=function(t){t!=this.url_&&(this.url_=t,this.image_=null,this.changed())},e.prototype.updateParams=function(t){oe(this.params_,t),this.updateV13_(),this.image_=null,this.changed()},e.prototype.updateV13_=function(){var t=this.params_.VERSION||_w;this.v13_=function(t,e){for(var n=(""+t).split("."),r=(""+e).split("."),o=0;o<Math.max(n.length,r.length);o++){var i=parseInt(n[o]||"0",10),a=parseInt(r[o]||"0",10);if(i>a)return 1;if(a>i)return-1}return 0}(t,"1.3")>=0},e}(Ow);const Dw=Zw;const kw=function(){function t(t){this.highWaterMark=void 0!==t?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}return t.prototype.canExpireCache=function(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark},t.prototype.expireCache=function(t){for(;this.canExpireCache();)this.pop()},t.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null},t.prototype.containsKey=function(t){return this.entries_.hasOwnProperty(t)},t.prototype.forEach=function(t){for(var e=this.oldest_;e;)t(e.value_,e.key_,this),e=e.newer},t.prototype.get=function(t,e){var n=this.entries_[t];return x(void 0!==n,15),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_},t.prototype.remove=function(t){var e=this.entries_[t];return x(void 0!==e,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_},t.prototype.getCount=function(){return this.count_},t.prototype.getKeys=function(){var t,e=new Array(this.count_),n=0;for(t=this.newest_;t;t=t.older)e[n++]=t.key_;return e},t.prototype.getValues=function(){var t,e=new Array(this.count_),n=0;for(t=this.newest_;t;t=t.older)e[n++]=t.value_;return e},t.prototype.peekLast=function(){return this.oldest_.value_},t.prototype.peekLastKey=function(){return this.oldest_.key_},t.prototype.peekFirstKey=function(){return this.newest_.key_},t.prototype.pop=function(){var t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_},t.prototype.replace=function(t,e){this.get(t),this.entries_[t].value_=e},t.prototype.set=function(t,e){x(!(t in this.entries_),16);var n={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_},t.prototype.setSize=function(t){this.highWaterMark=t},t}();var Nw=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Fw=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Nw(e,t),e.prototype.expireCache=function(t){for(;this.canExpireCache();){if(this.peekLast().getKey()in t)break;this.pop().release()}},e.prototype.pruneExceptNewestZ=function(){if(0!==this.getCount()){var t=function(t){return t.split("/").map(Number)}(this.peekFirstKey()),e=t[0];this.forEach(function(t){t.tileCoord[0]!==e&&(this.remove(dw(t.tileCoord)),t.release())}.bind(this))}},e}(kw);const Uw=Fw,Gw={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};function Bw(t){var e=t.getDefaultTileGrid();return e||(e=function(t,e,n,r){return function(t,e,n,r){var o=void 0!==r?r:W,i=jw(t,e,n);return new mw({extent:t,origin:Ct(t,o),resolutions:i,tileSize:n})}(Ww(t),e,n,r)}(t),t.setDefaultTileGrid(e)),e}function jw(t,e,n,r){for(var o=void 0!==e?e:42,i=wt(t),a=Tt(t),s=qi(void 0!==n?n:Ir),l=r>0?r:Math.max(a/s[0],i/s[1]),c=o+1,u=new Array(c),p=0;p<c;++p)u[p]=l/Math.pow(2,p);return u}function Ww(t){var e=(t=io(t)).getExtent();if(!e){var n=180*Tr[Pr.DEGREES]/t.getMetersPerUnit();e=at(-n,-n,n,n)}return e}var qw=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Hw=function(t){function e(e){var n=t.call(this,{attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate})||this;n.on,n.once,n.un,n.opaque_=void 0!==e.opaque&&e.opaque,n.tilePixelRatio_=void 0!==e.tilePixelRatio?e.tilePixelRatio:1,n.tileGrid=void 0!==e.tileGrid?e.tileGrid:null;return n.tileGrid&&qi(n.tileGrid.getTileSize(n.tileGrid.getMinZoom()),[256,256]),n.tileCache=new Uw(e.cacheSize||0),n.tmpSize=[0,0],n.key_=e.key||"",n.tileOptions={transition:e.transition,interpolate:e.interpolate},n.zDirection=e.zDirection?e.zDirection:0,n}return qw(e,t),e.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},e.prototype.expireCache=function(t,e){var n=this.getTileCacheForProjection(t);n&&n.expireCache(e)},e.prototype.forEachLoadedTile=function(t,e,n,r){var o=this.getTileCacheForProjection(t);if(!o)return!1;for(var i,a,s,l=!0,c=n.minX;c<=n.maxX;++c)for(var u=n.minY;u<=n.maxY;++u)a=pw(e,c,u),s=!1,o.containsKey(a)&&(s=(i=o.get(a)).getState()===vr)&&(s=!1!==r(i)),s||(l=!1);return l},e.prototype.getGutterForProjection=function(t){return 0},e.prototype.getKey=function(){return this.key_},e.prototype.setKey=function(t){this.key_!==t&&(this.key_=t,this.changed())},e.prototype.getOpaque=function(t){return this.opaque_},e.prototype.getResolutions=function(){return this.tileGrid?this.tileGrid.getResolutions():null},e.prototype.getTile=function(t,e,n,o,i){return r()},e.prototype.getTileGrid=function(){return this.tileGrid},e.prototype.getTileGridForProjection=function(t){return this.tileGrid?this.tileGrid:Bw(t)},e.prototype.getTileCacheForProjection=function(t){return x(uo(this.getProjection(),t),68),this.tileCache},e.prototype.getTilePixelRatio=function(t){return this.tilePixelRatio_},e.prototype.getTilePixelSize=function(t,e,n){var r,o,i,a=this.getTileGridForProjection(n),s=this.getTilePixelRatio(e),l=qi(a.getTileSize(t),this.tmpSize);return 1==s?l:(r=l,o=s,void 0===(i=this.tmpSize)&&(i=[0,0]),i[0]=r[0]*o+.5|0,i[1]=r[1]*o+.5|0,i)},e.prototype.getTileCoordForTileUrlFunction=function(t,e){var n=void 0!==e?e:this.getProjection(),r=this.getTileGridForProjection(n);return this.getWrapX()&&n.isGlobal()&&(t=function(t,e,n){var r=e[0],o=t.getTileCoordCenter(e),i=Ww(n);if(et(i,o))return e;var a=Tt(i),s=Math.ceil((i[0]-o[0])/a);return o[0]+=a*s,t.getTileCoordForCoordAndZ(o,r)}(r,t,n)),function(t,e){var n=t[0],r=t[1],o=t[2];if(e.getMinZoom()>n||n>e.getMaxZoom())return!1;var i=e.getFullTileRange(n);return!i||i.containsXY(r,o)}(t,r)?t:null},e.prototype.clear=function(){this.tileCache.clear()},e.prototype.refresh=function(){this.clear(),t.prototype.refresh.call(this)},e.prototype.updateCacheSize=function(t,e){var n=this.getTileCacheForProjection(e);t>n.highWaterMark&&(n.highWaterMark=t)},e.prototype.useTile=function(t,e,n,r){},e}(D_),Vw=function(t){function e(e,n){var r=t.call(this,e)||this;return r.tile=n,r}return qw(e,t),e}(ne);const zw=Hw;function Yw(t,e){var n=/\{z\}/g,r=/\{x\}/g,o=/\{y\}/g,i=/\{-y\}/g;return function(a,s,l){return a?t.replace(n,a[0].toString()).replace(r,a[1].toString()).replace(o,a[2].toString()).replace(i,(function(){var t=a[0],n=e.getFullTileRange(t);return x(n,55),(n.getHeight()-a[2]-1).toString()})):void 0}}function Kw(t){return 1===t.length?t[0]:function(e,n,r){if(e){var o=function(t){return(t[1]<<t[0])+t[2]}(e),i=Nt(o,t.length);return t[i](e,n,r)}}}function Xw(t){var e=[],n=/\{([a-z])-([a-z])\}/.exec(t);if(n){var r=n[1].charCodeAt(0),o=n[2].charCodeAt(0),i=void 0;for(i=r;i<=o;++i)e.push(t.replace(n[0],String.fromCharCode(i)));return e}if(n=/\{(\d+)-(\d+)\}/.exec(t)){for(var a=parseInt(n[2],10),s=parseInt(n[1],10);s<=a;s++)e.push(t.replace(n[0],s.toString()));return e}return e.push(t),e}var $w=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Jw=function(t){function e(n){var r=t.call(this,{attributions:n.attributions,cacheSize:n.cacheSize,opaque:n.opaque,projection:n.projection,state:n.state,tileGrid:n.tileGrid,tilePixelRatio:n.tilePixelRatio,wrapX:n.wrapX,transition:n.transition,interpolate:n.interpolate,key:n.key,attributionsCollapsible:n.attributionsCollapsible,zDirection:n.zDirection})||this;return r.generateTileUrlFunction_=r.tileUrlFunction===e.prototype.tileUrlFunction,r.tileLoadFunction=n.tileLoadFunction,n.tileUrlFunction&&(r.tileUrlFunction=n.tileUrlFunction),r.urls=null,n.urls?r.setUrls(n.urls):n.url&&r.setUrl(n.url),r.tileLoadingKeys_={},r}return $w(e,t),e.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},e.prototype.getTileUrlFunction=function(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction},e.prototype.getUrls=function(){return this.urls},e.prototype.handleTileChange=function(t){var e,n=t.target,r=i(n),o=n.getState();o==yr?(this.tileLoadingKeys_[r]=!0,e=Gw.TILELOADSTART):r in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[r],e=o==_r?Gw.TILELOADERROR:o==vr?Gw.TILELOADEND:void 0),null!=e&&this.dispatchEvent(new Vw(e,n))},e.prototype.setTileLoadFunction=function(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()},e.prototype.setTileUrlFunction=function(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==e?this.setKey(e):this.changed()},e.prototype.setUrl=function(t){var e=Xw(t);this.urls=e,this.setUrls(e)},e.prototype.setUrls=function(t){this.urls=t;var e=t.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(function(t,e){for(var n=t.length,r=new Array(n),o=0;o<n;++o)r[o]=Yw(t[o],e);return Kw(r)}(t,this.tileGrid),e):this.setKey(e)},e.prototype.tileUrlFunction=function(t,e,n){},e.prototype.useTile=function(t,e,n){var r=pw(t,e,n);this.tileCache.containsKey(r)&&this.tileCache.get(r)},e}(zw);const Qw=Jw;var tS=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),eS=function(t){function e(e){var n=this,r=void 0===e.imageSmoothing||e.imageSmoothing;return void 0!==e.interpolate&&(r=e.interpolate),(n=t.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:nS,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:r,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection})||this).crossOrigin=void 0!==e.crossOrigin?e.crossOrigin:null,n.tileClass=void 0!==e.tileClass?e.tileClass:zC,n.tileCacheForProjection={},n.tileGridForProjection={},n.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,n.renderReprojectionEdges_=!1,n}return tS(e,t),e.prototype.canExpireCache=function(){if(this.tileCache.canExpireCache())return!0;for(var t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1},e.prototype.expireCache=function(t,e){var n=this.getTileCacheForProjection(t);for(var r in this.tileCache.expireCache(this.tileCache==n?e:{}),this.tileCacheForProjection){var o=this.tileCacheForProjection[r];o.expireCache(o==n?e:{})}},e.prototype.getGutterForProjection=function(t){return this.getProjection()&&t&&!uo(this.getProjection(),t)?0:this.getGutter()},e.prototype.getGutter=function(){return 0},e.prototype.getKey=function(){var e=t.prototype.getKey.call(this);return this.getInterpolate()||(e+=":disable-interpolation"),e},e.prototype.getOpaque=function(e){return!(this.getProjection()&&e&&!uo(this.getProjection(),e))&&t.prototype.getOpaque.call(this,e)},e.prototype.getTileGridForProjection=function(t){var e=this.getProjection();if(!this.tileGrid||e&&!uo(e,t)){var n=i(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=Bw(t)),this.tileGridForProjection[n]}return this.tileGrid},e.prototype.getTileCacheForProjection=function(t){var e=this.getProjection();if(!e||uo(e,t))return this.tileCache;var n=i(t);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new Uw(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]},e.prototype.createTile_=function(t,e,n,r,o,i){var a=[t,e,n],s=this.getTileCoordForTileUrlFunction(a,o),l=s?this.tileUrlFunction(s,r,o):void 0,c=new this.tileClass(a,void 0!==l?gr:Cr,void 0!==l?l:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=i,c.addEventListener(pe.CHANGE,this.handleTileChange.bind(this)),c},e.prototype.getTile=function(t,e,n,r,o){var i=this.getProjection();if(i&&o&&!uo(i,o)){var a=this.getTileCacheForProjection(o),s=[t,e,n],l=void 0,c=dw(s);a.containsKey(c)&&(l=a.get(c));var u=this.getKey();if(l&&l.key==u)return l;var p=this.getTileGridForProjection(i),d=this.getTileGridForProjection(o),h=this.getTileCoordForTileUrlFunction(s,o),f=new oE(i,p,o,d,s,h,this.getTilePixelRatio(r),this.getGutter(),function(t,e,n,r){return this.getTileInternal(t,e,n,r,i)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return f.key=u,l?(f.interimTile=l,f.refreshInterimChain(),a.replace(c,f)):a.set(c,f),f}return this.getTileInternal(t,e,n,r,i||o)},e.prototype.getTileInternal=function(t,e,n,r,o){var i=null,a=pw(t,e,n),s=this.getKey();if(this.tileCache.containsKey(a)){if((i=this.tileCache.get(a)).key!=s){var l=i;i=this.createTile_(t,e,n,r,o,s),l.getState()==gr?i.interimTile=l.interimTile:i.interimTile=l,i.refreshInterimChain(),this.tileCache.replace(a,i)}}else i=this.createTile_(t,e,n,r,o,s),this.tileCache.set(a,i);return i},e.prototype.setRenderReprojectionEdges=function(t){if(this.renderReprojectionEdges_!=t){for(var e in this.renderReprojectionEdges_=t,this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}},e.prototype.setTileGridForProjection=function(t,e){var n=io(t);if(n){var r=i(n);r in this.tileGridForProjection||(this.tileGridForProjection[r]=e)}},e}(Qw);function nS(t,e){t.getImage().src=e}const rS=eS,oS="KVP",iS="REST";var aS=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),sS=function(t){function e(e){var n=t.call(this,{extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes})||this;return n.matrixIds_=e.matrixIds,n}return aS(e,t),e.prototype.getMatrixId=function(t){return this.matrixIds_[t]},e.prototype.getMatrixIds=function(){return this.matrixIds_},e}(mw);var lS=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),cS=function(t){function e(e){var n=this,r=void 0===e.imageSmoothing||e.imageSmoothing;void 0!==e.interpolate&&(r=e.interpolate);var o=void 0!==e.requestEncoding?e.requestEncoding:oS,i=e.tileGrid,a=e.urls;return void 0===a&&void 0!==e.url&&(a=Xw(e.url)),(n=t.call(this,{attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:r,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:a,wrapX:void 0!==e.wrapX&&e.wrapX,transition:e.transition,zDirection:e.zDirection})||this).version_=void 0!==e.version?e.version:"1.0.0",n.format_=void 0!==e.format?e.format:"image/jpeg",n.dimensions_=void 0!==e.dimensions?e.dimensions:{},n.layer_=e.layer,n.matrixSet_=e.matrixSet,n.style_=e.style,n.requestEncoding_=o,n.setKey(n.getKeyForDimensions_()),a&&a.length>0&&(n.tileUrlFunction=Kw(a.map(n.createFromWMTSTemplate.bind(n)))),n}return lS(e,t),e.prototype.setUrls=function(t){this.urls=t;var e=t.join("\n");this.setTileUrlFunction(Kw(t.map(this.createFromWMTSTemplate.bind(this))),e)},e.prototype.getDimensions=function(){return this.dimensions_},e.prototype.getFormat=function(){return this.format_},e.prototype.getLayer=function(){return this.layer_},e.prototype.getMatrixSet=function(){return this.matrixSet_},e.prototype.getRequestEncoding=function(){return this.requestEncoding_},e.prototype.getStyle=function(){return this.style_},e.prototype.getVersion=function(){return this.version_},e.prototype.getKeyForDimensions_=function(){var t=0,e=[];for(var n in this.dimensions_)e[t++]=n+"-"+this.dimensions_[n];return e.join("/")},e.prototype.updateDimensions=function(t){oe(this.dimensions_,t),this.setKey(this.getKeyForDimensions_())},e.prototype.createFromWMTSTemplate=function(t){var e=this.requestEncoding_,n={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};e==oS&&oe(n,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),t=e==oS?Iw(t,n):t.replace(/\{(\w+?)\}/g,(function(t,e){return e.toLowerCase()in n?n[e.toLowerCase()]:t}));var r=this.tileGrid,o=this.dimensions_;return function(n,i,a){if(n){var s={TileMatrix:r.getMatrixId(n[0]),TileCol:n[1],TileRow:n[2]};oe(s,o);var l=t;return l=e==oS?Iw(l,s):l.replace(/\{(\w+?)\}/g,(function(t,e){return s[e]}))}}},e}(rS);const uS=cS;var pS=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const dS=function(t){function e(e,n,r,o,i){var a=this,s=void 0!==i?Sh:Lh;return(a=t.call(this,e,n,r,s)||this).loader_=void 0!==i?i:null,a.canvas_=o,a.error_=null,a}return pS(e,t),e.prototype.getError=function(){return this.error_},e.prototype.handleLoad_=function(t){t?(this.error_=t,this.state=Th):this.state=Lh,this.changed()},e.prototype.load=function(){this.state==Sh&&(this.state=bh,this.changed(),this.loader_(this.handleLoad_.bind(this)))},e.prototype.getImage=function(){return this.canvas_},e}(Ih);var hS=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const fS=function(t){function e(e){var n=this,r=e||{},o=void 0===r.imageSmoothing||r.imageSmoothing;return void 0!==r.interpolate&&(o=r.interpolate),(n=t.call(this,{attributions:r.attributions,interpolate:o,projection:r.projection,resolutions:r.resolutions,state:r.state})||this).canvasFunction_=r.canvasFunction,n.canvas_=null,n.renderedRevision_=0,n.ratio_=void 0!==r.ratio?r.ratio:1.5,n}return hS(e,t),e.prototype.getImageInternal=function(t,e,n,r){e=this.findNearestResolution(e);var o=this.canvas_;if(o&&this.renderedRevision_==this.getRevision()&&o.getResolution()==e&&o.getPixelRatio()==n&&nt(o.getExtent(),t))return o;Ot(t=t.slice(),this.ratio_);var i=[Tt(t)/e*n,wt(t)/e*n],a=this.canvasFunction_.call(this,t,e,n,i,r);return a&&(o=new dS(t,e,n,a)),this.canvas_=o,this.renderedRevision_=this.getRevision(),o},e}(Ow);var mS=n(7074),gS=n(5361),yS=n(4001),vS=n(7945),_S=n(2089),CS=n(1299),ES=n(2391),wS=n(6804),SS=n(1327),bS=n(6281),LS=n(9874),TS=n(6236),PS=n(9706),AS=n(4323),OS=n(2667);gS.Z.wrap=yS.Z,gS.Z.Util=vS.Z,gS.Z.Consts=_S.Z,gS.Z.Feature=CS.Z,gS.Z.feature=gS.Z.feature||{},gS.Z.feature.Point=ES.Z,gS.Z.feature.Marker=wS.Z,gS.Z.feature.Polyline=SS.Z,gS.Z.feature.Polygon=bS.Z,gS.Z.feature.MultiPoint=LS.Z,gS.Z.feature.MultiMarker=TS.Z,gS.Z.feature.MultiPolyline=PS.Z,gS.Z.feature.MultiPolygon=AS.Z,gS.Z.Geometry=OS.Z,window.ol={},ol.VERSION=a,ol.Map=ds,ol.View=ji,ol.Overlay=Es,ol.OverlayPositioning=hs,Xs.createStyleFunction=Ks,ol.Feature=Xs,ol.Collection=Vn,ol.MapEventType=cr,ol.MapBrowserEventType=rr,ol.Image=Zh,ol.array={extend:d,includes:c},ol.asserts={assert:x},ol.color={asArray:Yt,asString:Ht},ol.math={toRadians:kt},ol.string={padNumber:ws},ol.control={OverviewMap:As,ScaleLine:Us,Zoom:oa,ZoomSlider:Vs,ZoomToExtent:Bs},ol.events={EventType:pe,listen:de,unlistenByKey:fe,condition:{shiftKeyOnly:Sa}},ol.extent={getWidth:Tt,getHeight:wt,containsCoordinate:et,containsExtent:nt,buffer:J,boundingExtent:$},ol.geom={Point:_i,MultiPoint:Qs,LineString:al,MultiLineString:cl,Polygon:Zi,MultiPolygon:dl,GeometryCollection:_l,Circle:ml,GeometryType:br,GeometryLayout:Fo,flat:{deflateCoordinates:ni,inflateCoordinates:ci,linearRingLength:function(t,e,n,r){var o=nl(t,e,n,r),i=t[n-r]-t[e],a=t[n-r+1]-t[e+1];return o+=Math.sqrt(i*i+a*a)}}},ol.featureloader={xhr:Ll},ol.format={Feature:Xs,GMLBase:cc,GML:Mc,GML2:Tc,GML3:xc,GML32:Dc,GPX:_h,KML:dv,WFS:Du,WKT:ip,GeoJSON:Dd,WMSCapabilities:Rp,WMSGetFeatureInfo:Dp,WMTSCapabilities:yd,TopoJSON:Od,xsd:{readDecimal:hc,readBoolean:uc,readString:yc,readPositiveInteger:mc,readDateTime:dc,writeStringTextNode:wc,writeCDATASection:_c,writeDecimalTextNode:Cc,writeBooleanTextNode:vc,writeNonNegativeIntegerTextNode:Ec}},ol.format.Feature.transformGeometryWithOptions=Pl,ol.interaction={defaults:us,Draw:J_,Pointer:fa,Translate:iC,Snap:uC,Select:gC,Modify:AC,DragAndDrop:FC,DoubleClickZoom:ua},ol.layer={Layer:Ue,Tile:dE,Image:_E,Vector:x_,Heatmap:cw},ol.Observable={unByKey:ye},ol.Object=Ee,ol.proj={METERS_PER_UNIT:Tr,Projection:Mr,addEquivalentProjections:so,get:io,transform:fo,transformExtent:mo,getTransform:ho,Units:Pr,proj4:{register:function(t){var e,n,r,o,i,a,s,l,c=Object.keys(t.defs),u=c.length;for(e=0;e<u;++e){var p=c[e];if(!io(p)){var d=t.defs(p),h=d.units;h||"longlat"!==d.projName||(h=Pr.DEGREES),oo(new Mr({code:p,axisOrientation:d.axis,metersPerUnit:d.to_meter,units:h}))}}for(e=0;e<u;++e){var f=c[e],m=io(f);for(n=0;n<u;++n){var g=c[n],y=io(g);if(!$r(f,g))if(t.defs[f]===t.defs[g])so([m,y]);else{var v=t(f,g);r=m,o=y,i=To(m,y,v.forward),a=To(y,m,v.inverse),s=void 0,l=void 0,s=io(r),l=io(o),Xr(s,l,co(i)),Xr(l,s,co(a))}}}}},EPSG4326:{METERS_PER_UNIT:Hr,PROJECTIONS:zr}},ol.render={getVectorContext:function(t){if(!(t.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");var e,n=t.inversePixelTransform[0],r=t.frameState,o=Z(t.inversePixelTransform.slice(),r.coordinateToPixelTransform),i=w_(r.viewState.resolution,n),a=Co();return a&&(e=po(a,r.viewState.projection)),new v_(t.context,n,r.extent,o,r.viewState.rotation,i,e)},toContext:function(t,e){var n=t.canvas,r=e||{},o=r.pixelRatio||b,i=r.size;i&&(n.width=i[0]*o,n.height=i[1]*o,n.style.width=i[0]+"px",n.style.height=i[1]+"px");var a=[0,0,n.width,n.height],s=N([1,0,0,1,0,0],o,o);return new v_(t,o,a,s,0)},EventType:Ze},ol.source={Vector:B_,Cluster:vw,ImageWMS:Dw,WMTS:uS,TileEventType:Gw,VectorEventType:k_,ImageCanvas:fS,Image:{defaultImageLoadFunction:Aw},WMSServerType:xw},ol.source.WMTS.optionsFromCapabilities=function(t,e){var n=h(t.Contents.Layer,(function(t,n,r){return t.Identifier==e.layer}));if(null===n)return null;var r,o=t.Contents.TileMatrixSet;(r=n.TileMatrixSetLink.length>1?m(n.TileMatrixSetLink,"projection"in e?function(t,n,r){var i=h(o,(function(e){return e.Identifier==t.TileMatrixSet})).SupportedCRS,a=io(i),s=io(e.projection);return a&&s?uo(a,s):i==e.projection}:function(t,n,r){return t.TileMatrixSet==e.matrixSet}):0)<0&&(r=0);var i=n.TileMatrixSetLink[r].TileMatrixSet,a=n.TileMatrixSetLink[r].TileMatrixSetLimits,s=n.Format[0];"format"in e&&(s=e.format),(r=m(n.Style,(function(t,n,r){return"style"in e?t.Title==e.style:t.isDefault})))<0&&(r=0);var l=n.Style[r].Identifier,u={};"Dimension"in n&&n.Dimension.forEach((function(t,e,n){var r=t.Identifier,o=t.Default;void 0===o&&(o=t.Value[0]),u[r]=o}));var p,d=h(t.Contents.TileMatrixSet,(function(t,e,n){return t.Identifier==i})),f=d.SupportedCRS;if(f&&(p=io(f)),"projection"in e){var g=io(e.projection);g&&(p&&!uo(g,p)||(p=g))}var y=!1,v="ne"==p.getAxisOrientation().substr(0,2),_=d.TileMatrix[0],C={MinTileCol:0,MinTileRow:0,MaxTileCol:_.MatrixWidth-1,MaxTileRow:_.MatrixHeight-1};if(a){C=a[a.length-1];var E=h(d.TileMatrix,(function(t){return t.Identifier===C.TileMatrix||d.Identifier+":"+t.Identifier===C.TileMatrix}));E&&(_=E)}var w=28e-5*_.ScaleDenominator/p.getMetersPerUnit(),S=v?[_.TopLeftCorner[1],_.TopLeftCorner[0]]:_.TopLeftCorner,b=_.TileWidth*w,L=_.TileHeight*w,T=d.BoundingBox,P=[S[0]+b*C.MinTileCol,S[1]-L*(1+C.MaxTileRow),S[0]+b*(1+C.MaxTileCol),S[1]-L*C.MinTileRow];if(void 0!==T&&!nt(T,P)){var A=n.WGS84BoundingBox,O=io("EPSG:4326").getExtent();if(P=T,A)y=A[0]===O[0]&&A[2]===O[2];else{var x=mo(T,d.SupportedCRS,"EPSG:4326");y=x[0]-1e-10<=O[0]&&x[2]+1e-10>=O[2]}}var I=function(t,e,n){var r=[],o=[],i=[],a=[],s=[],l=void 0!==n?n:[],c=io(t.SupportedCRS),u=c.getMetersPerUnit(),p="ne"==c.getAxisOrientation().substr(0,2);return t.TileMatrix.sort((function(t,e){return e.ScaleDenominator-t.ScaleDenominator})),t.TileMatrix.forEach((function(e){if(!(l.length>0)||h(l,(function(n){return e.Identifier==n.TileMatrix||-1===e.Identifier.indexOf(":")&&t.Identifier+":"+e.Identifier===n.TileMatrix}))){o.push(e.Identifier);var n=28e-5*e.ScaleDenominator/u,c=e.TileWidth,d=e.TileHeight;p?i.push([e.TopLeftCorner[1],e.TopLeftCorner[0]]):i.push(e.TopLeftCorner),r.push(n),a.push(c==d?c:[c,d]),s.push([e.MatrixWidth,e.MatrixHeight])}})),new sS({extent:e,origins:i,resolutions:r,matrixIds:o,tileSizes:a,sizes:s})}(d,P,a),M=[],R=e.requestEncoding;if(R=void 0!==R?R:"","OperationsMetadata"in t&&"GetTile"in t.OperationsMetadata)for(var Z=t.OperationsMetadata.GetTile.DCP.HTTP.Get,D=0,k=Z.length;D<k;++D)if(Z[D].Constraint){var N=h(Z[D].Constraint,(function(t){return"GetEncoding"==t.name})).AllowedValues.Value;if(""===R&&(R=N[0]),R!==oS)break;c(N,oS)&&M.push(Z[D].href)}else Z[D].href&&(R=oS,M.push(Z[D].href));return 0===M.length&&(R=iS,n.ResourceURL.forEach((function(t){"tile"===t.resourceType&&(s=t.format,M.push(t.template))}))),{urls:M,layer:e.layer,matrixSet:i,format:s,projection:p,requestEncoding:R,tileGrid:I,style:l,dimensions:u,wrapX:y,crossOrigin:e.crossOrigin}},ol.tilegrid={TileGrid:mw},ol.style={Style:tf,RegularShape:Hh,Circle:Yh,Fill:Ch,Icon:Gh,Stroke:Bh,Text:of,IconAnchorUnits:Eh,IconOrigin:wh},ol.xml={parse:Zl,parseNode:Vl,createElementNS:xl,pushParseAndPop:zl,pushSerializeAndPop:Kl,makeStructureNS:Hl,getAllTextContent:Il,makeChildAppender:Gl,makeReplacer:Nl,makeSequence:ql,makeArrayPusher:kl,makeArrayExtender:Dl,makeArraySerializer:Bl,makeObjectPropertySetter:Ul,makeSimpleNodeFactory:jl,OBJECT_PROPERTY_NODE_FACTORY:Wl,XML_SCHEMA_INSTANCE_URI:Ol},Math.hypot=Math.hypot||function(){for(var t=0,e=arguments.length,n=0;n<e;n++){if(arguments[n]===1/0||arguments[n]===-1/0)return 1/0;t+=arguments[n]*arguments[n]}return Math.sqrt(t)};for(var xS=0,IS=["ms","moz","webkit","o"],MS=0;MS<IS.length&&!window.requestAnimationFrame;++MS)window.requestAnimationFrame=window[IS[MS]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[IS[MS]+"CancelAnimationFrame"]||window[IS[MS]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,e){var n=(new Date).getTime(),r=Math.max(0,16-(n-xS)),o=window.setTimeout((function(){t(n+r)}),r);return xS=n+r,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)});const RS="mousemove",ZS="mouseover",DS=ol.events.EventType.DRAGENTER,kS=ol.events.EventType.DRAGOVER,NS=ol.events.EventType.DROP,FS=ol.events.EventType.CHANGE,US=ol.MapBrowserEventType.CLICK,GS=ol.MapBrowserEventType.SINGLECLICK,BS=ol.MapBrowserEventType.POINTERMOVE,jS=ol.MapEventType.MOVEEND,WS=ol.render.EventType.POSTRENDER,qS=ol.source.VectorEventType.ADDFEATURE,HS=ol.source.VectorEventType.REMOVEFEATURE,VS=ol.source.VectorEventType.CLEAR,zS=gS.Z.Util.detectMouse()?3:10;ol.View.prototype.getValueForResolutionFunction=function(t){const e=t||2,n=this.maxResolution_,r=this.minResolution_,o=Math.log(n/r)/Math.log(e);return function(t){var r=Math.log(n/t)/Math.log(e)/o;return r=Math.max(Math.min(1,r),0)}},ol.control.OverviewMap.prototype._validateExtent_=ol.control.OverviewMap.prototype.validateExtent_,ol.control.OverviewMap.prototype.validateExtent_=function(){var t=this;t._validateExtent_(),t._wrap&&t._wrap.parent.options.alwaysCentered&&t.recenter_()},ol.control.OverviewMap.prototype._bindView_=ol.control.OverviewMap.prototype.bindView_,ol.control.OverviewMap.prototype.bindView_=function(t){const e=this,n=e.getOverviewMap().getView(),r=ol.control.OverviewMap.prototype._bindView_.call(e,t),o=e.getOverviewMap().getView(),i=e._wrap.parent.map.wrap.map.getView();return o.getCenter()||o.setCenter(i.getCenter()),o.getResolution()||o.setResolution(n.getResolution()),r},ol.control.OverviewMap.prototype._resetExtent_=ol.control.OverviewMap.prototype.resetExtent_,ol.control.OverviewMap.prototype.resetExtent_=function(){var t=this;t._resetExtent_.call(t);var e=t._wrap;if(e.is3D){var n=t.ovmap_.getView(),r=n.calculateExtent(),o=e.get3DCameraLayer().getSource().getFeatures()[0];if(o){const t=o.getGeometry().getCoordinates();var i=t[0][0],a=t[0][1];if(!ol.extent.containsCoordinate(r,i)||!ol.extent.containsCoordinate(r,a)){var s=Math.max(r[0]-i[0],r[1]-i[1],i[0]-r[2],i[1]-r[3],r[0]-a[0],r[1]-a[1],a[0]-r[2],a[1]-r[3]);n.fit(ol.extent.buffer(r,s))}}}},ol.format.GML3CRS84=function(){ol.format.GML3.call(this,{srsName:"CRS:84"})},gS.Z.inherit(ol.format.GML3CRS84,ol.format.GML3),ol.format.GML2CRS84=function(){ol.format.GML2.call(this,{srsName:"CRS:84"})},gS.Z.inherit(ol.format.GML2CRS84,ol.format.GML2);const YS="http://www.opengis.net/gml",KS="http://www.opengis.net/gml/3.2";ol.format.GML3.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS[KS]=ol.format.GML3.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS[YS],ol.format.GML3.prototype.FLAT_LINEAR_RINGS_PARSERS[KS]=ol.format.GML3.prototype.FLAT_LINEAR_RINGS_PARSERS[YS],ol.format.GML3.prototype.GEOMETRY_PARSERS[KS]=ol.format.GML3.prototype.GEOMETRY_PARSERS[YS],ol.format.GML3.prototype.MULTICURVE_PARSERS[KS]=ol.format.GML3.prototype.MULTICURVE_PARSERS[YS],ol.format.GML3.prototype.MULTISURFACE_PARSERS[KS]=ol.format.GML3.prototype.MULTISURFACE_PARSERS[YS],ol.format.GML3.prototype.CURVEMEMBER_PARSERS[KS]=ol.format.GML3.prototype.CURVEMEMBER_PARSERS[YS],ol.format.GML3.prototype.SURFACEMEMBER_PARSERS[KS]=ol.format.GML3.prototype.SURFACEMEMBER_PARSERS[YS],ol.format.GML3.prototype.SURFACE_PARSERS[KS]=ol.format.GML3.prototype.SURFACE_PARSERS[YS],ol.format.GML3.prototype.CURVE_PARSERS[KS]=ol.format.GML3.prototype.CURVE_PARSERS[YS],ol.format.GML3.prototype.ENVELOPE_PARSERS[KS]=ol.format.GML3.prototype.ENVELOPE_PARSERS[YS],ol.format.GML3.prototype.PATCHES_PARSERS[KS]=ol.format.GML3.prototype.PATCHES_PARSERS[YS],ol.format.GML3.prototype.SEGMENTS_PARSERS[KS]=ol.format.GML3.prototype.SEGMENTS_PARSERS[YS],ol.proj.proj4.register(mS.Z),ol.proj.oldGet=ol.proj.get,ol.proj.get=function(t){let e=ol.proj.oldGet.call(this,t);return e||"string"!=typeof t||(t=t.trim(),gS.Z.loadProjDef({crs:t,sync:!0}),e=ol.proj.oldGet.call(this,t)),e};const XS=gS.Z.Util.detectMobile(),$S=ol.source.WMTS.prototype.getTilePixelRatio;ol.source.WMTS.prototype.getTilePixelRatio=function(t){return XS?$S.call(this,t):$S.call(this,t)*(t||1)};const JS=ol.tilegrid.TileGrid.prototype.getZForResolution;ol.tilegrid.TileGrid.prototype.getZForResolution=function(t,e){let n=t;return XS||(n/=window.devicePixelRatio),JS.call(this,n,e)},ol.Overlay.prototype.updateRenderedPosition=function(t,e){const n=this.element.style,r=this.getOffset(),o=this.getPositioning();this.setVisible(!0);let i=r[0],a=r[1];if(o==hs.BOTTOM_RIGHT||o==hs.CENTER_RIGHT||o==hs.TOP_RIGHT){""!==this.rendered.left_&&(this.rendered.left_=n.left="");const r=Math.round(e[0]-t[0]-i)+"px";this.rendered.right_!=r&&(this.rendered.right_=n.right=r)}else{""!==this.rendered.right_&&(this.rendered.right_=n.right=""),o!=hs.BOTTOM_CENTER&&o!=hs.CENTER_CENTER&&o!=hs.TOP_CENTER||(i-=this.element.offsetWidth/2);const e=Math.round(t[0]+i)+"px";this.rendered.left_!=e&&(this.rendered.left_=n.left=e)}if(o==hs.BOTTOM_LEFT||o==hs.BOTTOM_CENTER||o==hs.BOTTOM_RIGHT){""!==this.rendered.top_&&(this.rendered.top_=n.top="");const r=Math.round(e[1]-t[1]-a)+"px";this.rendered.bottom_!=r&&(this.rendered.bottom_=n.bottom=r)}else{""!==this.rendered.bottom_&&(this.rendered.bottom_=n.bottom=""),o!=hs.CENTER_LEFT&&o!=hs.CENTER_CENTER&&o!=hs.CENTER_RIGHT||(a-=this.element.offsetHeight/2);const e=Math.round(t[1]+a)+"px";this.rendered.top_!=e&&(this.rendered.top_=n.top=e)}};const QS=ol.source.ImageWMS.prototype.getRequestUrl_;ol.source.ImageWMS.prototype.getRequestUrl_=function(t,e,n,r,o){if(1!==n){const t=90*n+.5|0;o.MAP_RESOLUTION=t,o.DPI=t}return QS.call(this,t,e,n,r,o)};const tb=function(t,e){var n;return n=t?(n=ol.color.asArray(t)).slice():[0,0,0,1],void 0!==e&&(n[3]=e),n},eb=function(t,e,n){var r=t.map.getView(),o=r.getResolution();const i=gS.Z.Util.detectMobile()?1:t.map.pixelRatio_;var a={projection:r.getProjection(),center:r.getCenter(),resolution:o,enableRotation:!1,constrainResolution:!0,showFullExtent:!0,smoothExtentConstraint:!0};t.parent.maxExtent&&(a.extent=t.parent.maxExtent);var s=e;e.type===gS.Z.Consts.layerType.VECTOR&&t.parent.getBaseLayer()&&(s=t.parent.getBaseLayer());var l,c,u=s.getResolutions?s.getResolutions():[];if(u&&u.length){l=s.maxResolution||n?.maxResolution||u[0],c=s.minResolution||n?.minResolution||u[u.length-1];var p=u.indexOf(c),d=u.indexOf(l);a.resolutions=u.slice(d,p+1),1!==i&&(a.resolutions=a.resolutions.map((t=>t*i)))}else l=s.maxResolution,c=s.minResolution;return c&&(c*=i,a.minResolution=c,o<c&&(a.resolution=c)),l&&(l*=i,a.maxResolution=l,o>l&&(a.resolution=l)),a};gS.Z.wrap.Map.prototype.setMap=function(){var t=this,e=[(t.parent.initialExtent[0]+t.parent.initialExtent[2])/2,(t.parent.initialExtent[1]+t.parent.initialExtent[3])/2],n=(0,mS.Z)(t.parent.crs);!function(){var e=t.parent.crs.substr(t.parent.crs.lastIndexOf(":")+1),r={units:n.oProj.units},o=[];"4326"!==e&&(r.code="EPSG:"+e,o.push(new ol.proj.Projection(r)),r.code="urn:ogc:def:crs:EPSG::"+e,o.push(new ol.proj.Projection(r)),ol.proj.addEquivalentProjections(o)),ol.proj.proj4.register(mS.Z)}();var r={code:t.parent.crs,units:n.oProj.units};"EPSG:4326"===t.parent.crs&&(r.axisOrientation="neu");var o=new ol.proj.Projection(r),i=ol.interaction.defaults(),a={projection:o,center:e,enableRotation:!1,constrainResolution:!0,showFullExtent:!0,smoothExtentConstraint:!0};const s=t.parent.maxExtent||t.parent.initialExtent;t.parent.maxExtent&&(a.extent=t.parent.maxExtent);var l=t.parent.div.getBoundingClientRect(),c=s[2]-s[0],u=s[3]-s[1];a.resolution=Math.max(c/l.width,u/l.height),t.map=new ol.Map({target:t.parent.div,view:new ol.View(a),controls:[],interactions:i}),t.map._wrap=t,t._promise=Promise.resolve(t.map),t.manageSize.call(t.map);let p;t.parent.one(gS.Z.Consts.event.MAPLOAD,(function(){t.updateSize()})),t.map.on(GS,(function(e){if(t.parent.view!==gS.Z.Consts.view.PRINTING){t.parent.workLayers.forEach((function(t){delete t._noFeatureClicked}));var n=t.parent.workLayers.map((function(){return!1}));t.map.forEachFeatureAtPixel(e.pixel,(function(e,r){if(e._wrap&&e._wrap.parent.showsPopup){for(var o=0;o<t.parent.workLayers.length;o++){if(t.parent.workLayers[o].wrap.layer===r){n[o]=!0;break}}return t.parent.trigger(gS.Z.Consts.event.FEATURECLICK,{feature:e._wrap.parent}),e}}),{hitTolerance:zS});for(var r=0;r<n.length;r++)n[r]||t.parent.trigger(gS.Z.Consts.event.NOFEATURECLICK,{layer:t.parent.workLayers[r]})}}));const d=function(e){const n=p.getResolution(),r=p.getProjection().getCode();t.parent.layers.filter((t=>t.type===gS.Z.Consts.layerType.WMS)).forEach((t=>{const e=t.getExtent({crs:r});if(e){const r=fb(e,n,100);t.wrap.layer.setExtent(r)}}))},h=function(){p=t.map.getView(),p.on("change:resolution",d),d()};t.map.on(jS,(function(){t.parent.trigger(gS.Z.Consts.event.ZOOM)})),h(),p.on("change:resolution",(function(e){t.parent.trigger(gS.Z.Consts.event.BEFOREZOOM)}),t.parent),t.map.on("change:view",h);const f=function(e,n){if(e){var r=eb(t,e,n),o=new ol.View(r);t.map.setView(o),t.map.render()}};t.parent.on(gS.Z.Consts.event.BEFOREBASELAYERCHANGE,(function(e){if(t.parent.crs===t.parent.options.crs&&!t.parent.on3DView&&e.newLayer.type!==gS.Z.Consts.layerType.VECTOR){const n=e.oldLayer.getResolutions();let r=e.newLayer;const o={};!e.newLayer.getResolutions()&&n&&(r=e.oldLayer,o.minResolution=e.newLayer.minResolution,o.maxResolution=e.newLayer.maxResolution),t.parent.one(gS.Z.Consts.event.BASELAYERCHANGE,(function(t){f(r,o)}))}})),t.parent.on(gS.Z.Consts.event.MAPLOAD,(function(e){f(t.parent.getBaseLayer())}));const m=t.map.getViewport();m.addEventListener(gS.Z.Consts.event.MOUSEMOVE,(function(e){var n=!1;if(!t.parent.activeControl||!t.parent.activeControl.isExclusive()){if(t.parent.view===gS.Z.Consts.view.PRINTING)return;var r=t.map.getEventPixel(e);n=t.map.forEachFeatureAtPixel(r,(function(e,n){var r=!0;return!e._wrap||e._wrap.parent.showsPopup||e._wrap.parent.options.selectable||(r=!1),r&&e._wrap&&t.parent.trigger(gS.Z.Consts.event.FEATUREOVER,{feature:e._wrap.parent}),r}),{hitTolerance:zS})}m.style.cursor=n?"pointer":""})),function e(){matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`).addEventListener("change",e,{once:!0}),t.map.pixelRatio_=window.devicePixelRatio,f(t.parent.baseLayer),t.manageSize()}()},gS.Z.wrap.Map.prototype.updateSize=function(){this.map.updateSize()};var nb=function(t,e){var n=t.getUnits();return n&&n!==ol.proj.Units.DEGREES?ol.proj.METERS_PER_UNIT[n]:gS.Z.Util.getMetersPerDegree(e)};gS.Z.wrap.Map.prototype.getMetersPerUnit=function(){return nb(ol.proj.get(this.parent.crs),this.getExtent())};var rb=function(t){t=t||{};var e=this.parent.options.crs||gS.Z.Cfg.crs,n=ol.proj.get(e),r=ol.proj.get(t.crs);return nb(r,t.extentInDegrees)/nb(n,t.extentInDegrees)},ob=function(t){var e;return(e=t.axisOrientation?new ol.proj.Projection({code:t.crs,axisOrientation:t.axisOrientation}):ol.proj.get(t.crs)).getUnits()||(e.units_=ol.proj.Units.DEGREES),e};gS.Z.wrap.Map.prototype.setProjection=function(t){const e=this,n=(t=t||{}).baseLayer||e.parent.baseLayer;var r;r=t.extent?t.extent:ol.proj.transformExtent(e.getExtent(),e.parent.crs,t.crs);const o=ol.proj.transformExtent(r,t.crs,"EPSG:4326"),i=rb.call(e,{crs:t.crs,extentInDegrees:o}),a=ob(t),s=e.map.getView(),l={projection:a,enableRotation:!1,constrainResolution:!0,showFullExtent:!0,smoothExtentConstraint:!0},c=n.getResolutions();if(c&&c.length)l.resolutions=c;else{l.minZoom=s.getMinZoom(),l.maxZoom=s.getMaxZoom();const t=n.wrap.layer.getMinResolution(),r=n.wrap.layer.getMaxResolution();var u=1;if(0===t||r===Number.POSITIVE_INFINITY){u=rb.call(e,{crs:e.parent.crs,extentInDegrees:o})/i}l.minResolution=0===t?s.getMinResolution()*u:t,r===Number.POSITIVE_INFINITY?l.maxResolution=s.getMaxResolution()*u:l.maxResolution=r}e.parent.workLayers.forEach((e=>{if(e.type===gS.Z.Consts.layerType.WMS){e.getExtent({crs:t.crs})&&e.wrap.layer.setExtent(e.getExtent())}})),l.center=ol.proj.transform(e.getCenter(),e.parent.crs,t.crs),e.parent.initialExtent=1!==i?ol.proj.transformExtent(e.parent.initialExtent,e.parent.crs,t.crs):e.parent.options.initialExtent,e.parent.options.maxExtent&&(e.parent.maxExtent=1!==i?ol.proj.transformExtent(e.parent.maxExtent,e.parent.crs,t.crs):e.parent.options.maxExtent,l.extent=e.parent.maxExtent);var p=new ol.View(l);e.map.setView(p),p.fit(r,{nearest:!0})},gS.Z.wrap.Map.prototype.insertLayer=function(t,e){for(var n=this,r=n.map.getLayers(),o=!1,i=0;i<r.getLength();i++)if(r.item(i)===t){o=!0;break}const a=t._wrap;if(!a.parent.isBase&&a.parent.type===gS.Z.Consts.layerType.WMS){const e=a.parent.getExtent();e&&t.setExtent(fb(e,n.getResolution(),100))}if(o)r.remove(t),r.insertAt(e,t);else{e<0?r.push(t):r.insertAt(e,t);var s=n.map.getView();if(n.parent.crs===n.parent.options.crs){if(t instanceof ol.layer.Tile){var l=t.getSource().getResolutions();s.maxResolution_=l[0],s.minResolution_=l[l.length-1]}}else t instanceof ol.layer.Tile&&(t.setMaxResolution(s.getMaxResolution()),t.setMinResolution(s.getMinResolution()));var c=0,u=function(e){a.parent.state=gS.Z.Layer.state.LOADING,c<=0&&(c=0,n.parent.trigger(gS.Z.Consts.event.BEFORELAYERUPDATE,{layer:a.parent})),t._loadingTileCount=t._loadingTileCount+1};a.parent.state===gS.Z.Layer.state.LOADING&&a.parent.isRaster()&&u(),a.$events.on(gS.Z.Consts.event.BEFORETILELOAD,u),a.$events.on(gS.Z.Consts.event.TILELOAD+" "+gS.Z.Consts.event.TILELOADERROR,(function(t){(c-=1)<=0&&(c=0,a.parent.state=gS.Z.Layer.state.IDLE,n.parent.trigger(gS.Z.Consts.event.LAYERUPDATE,{layer:a.parent}))}))}},gS.Z.wrap.Map.prototype.removeLayer=function(t){this.map.removeLayer(t)},gS.Z.wrap.Map.prototype.getLayerCount=function(){return this.map.getLayerGroup().getLayers().getLength()},gS.Z.wrap.Map.prototype.indexOfFirstVector=function(){var t=-1;return this.map.getLayerGroup().getLayers().forEach((function(e,n){e instanceof ol.layer.Vector&&-1===t&&(t=n)})),t},gS.Z.wrap.Map.prototype.getLayerIndex=function(t){var e=-1;return this.map.getLayerGroup().getLayers().forEach((function(n,r){n===t&&(e=r)})),e},gS.Z.wrap.Map.prototype.setLayerIndex=function(t,e){var n=this.map.getLayers().getArray().indexOf(t);n>-1&&n!==e&&(this.map.removeLayer(t),this.insertLayer(t,e))},gS.Z.wrap.Map.prototype.setBaseLayer=function(t){var e=this;return new Promise((function(n,r){var o,i,a,s=function(r){if((r=r||e.parent.getBaseLayer())&&(e.map.removeLayer(r.wrap.layer),t instanceof ol.layer.Image&&t._wrap.setProjection({crs:e.parent.crs}),t._wrap.parent.type===gS.Z.Consts.layerType.WMTS)){var o={crs:e.parent.crs,oldCrs:t.getSource().getProjection().getCode()};o.oldCrs!==o.crs&&t._wrap.parent.setProjection(o)}e.insertLayer(t,0),e.map.getControls().forEach((function(t){t instanceof ol.control.ZoomSlider&&t.initSlider_()})),n()},l=eb(e,t._wrap.parent),c=e.map.getView(),u=c.getResolution();if(!l.resolutions&&(l.minResolution||l.maxResolution)){const t=c.getResolutions();if(t){const e=t.filter((t=>!(l.minResolution&&t<l.minResolution)&&!(l.maxResolution&&t>l.maxResolution)));e.length<t.length&&(l.resolutions=e)}}if(l.resolutions){const t=new ol.View(l);var p=(o=u,i=l.resolutions,a=e.parent.options.maxResolutionError,i?i.slice().sort((function(t,e){return t-e})).reduce((function(t,e){return 0===t&&(e>o||Math.abs(1-o/e)<a)?e:t}),0):o);p!==u&&e.parent.isLoaded?c.animate({resolution:p,duration:gS.Z.Consts.ZOOM_ANIMATION_DURATION},(function(){e.map.setView(t),s(e.parent.getBaseLayer())})):(e.map.setView(t),t.setResolution(p),s())}else s()}))},gS.Z.wrap.Map.prototype.setExtent=function(t,e,n){const r=this;gS.Z.Util.isFunction(e)?(n=e,e={}):e=e||{};return Promise.resolve(r._setExtentPromise).finally((function(){!function(t){r._setExtentPromise=new Promise((function(o,i){clearTimeout(r._timeout),r._timeout=setTimeout((function(){const i={callback:function(){const t=r.getExtent();gS.Z.Util.isFunction(n)&&n(t),o(t)},nearest:!e.contain};(void 0===e.animate||e.animate)&&(i.duration=gS.Z.Consts.ZOOM_ANIMATION_DURATION),r.map.getView().fit(t,i)}),50)}))}(t)})),r._setExtentPromise},gS.Z.wrap.Map.prototype.getExtent=function(){return this.map.getView().calculateExtent(this.map.getSize())},gS.Z.wrap.Map.prototype.setCenter=function(t,e){const n=this;return new Promise((function(r,o){const i=function(){r()},a=e||{},s=n.map.getView();a.animate?s.animate({center:t,duration:gS.Z.Consts.ZOOM_ANIMATION_DURATION},i):(s.setCenter(t),r())}))},gS.Z.wrap.Map.prototype.getCenter=function(){return this.map.getView().getCenter()},gS.Z.wrap.Map.prototype.getResolution=function(){return this.map.getView().getResolution()},gS.Z.wrap.Map.prototype.setResolution=async function(t){return(await this.getMap()).getView().setResolution(t),t},gS.Z.wrap.Map.prototype.setRotation=function(t){this.getMap().then((function(e){e.getView().setRotation(t)}))},gS.Z.wrap.Map.prototype.getRotation=function(){return this.map.getView().getRotation()},gS.Z.wrap.Map.prototype.getResolutions=function(){return this.map.getView().getResolutions()||[]},gS.Z.wrap.Map.prototype.getCoordinateFromPixel=function(t){return this.map.getCoordinateFromPixel(t)},gS.Z.wrap.Map.prototype.getPixelFromCoordinate=function(t){return this.map.getPixelFromCoordinate(t)},gS.Z.wrap.Map.prototype.getViewport=function(t){const e=this;return(t||{}).synchronous?e.map.getViewport():new Promise((function(t,n){e.getMap().then((function(e){t(e.getViewport())}))}))},gS.Z.wrap.Map.prototype.getCanvas=function(){return Array.from(this.parent.div.querySelectorAll(".ol-viewport canvas:not(.tc-ctl-ovmap canvas)"))},gS.Z.wrap.Map.prototype.isNative=function(t){return t instanceof ol.Map},gS.Z.wrap.Map.prototype.isGeo=function(){var t=this.map.getView().getProjection().getUnits();return!t||t===ol.proj.Units.DEGREES},gS.Z.wrap.Map.prototype.addPopup=function(t){const e=this;return new Promise((function(n,r){var o=void 0===t.options.draggable||t.options.draggable;gS.Z.loadJS(o&&!window.Draggabilly,[gS.Z.apiLocation+gS.Z.Consts.url.DRAGGABILLY],(function(){e.getMap().then((function(n){if(!t.wrap.popup){var r=new ol.Overlay({element:t.popupDiv,positioning:ol.OverlayPositioning.BOTTOM_LEFT});n.addOverlay(r),t.wrap.popup=r;const i=n.getViewport();if(o){const e=t.popupDiv.parentElement;t.popupDiv.classList.add(gS.Z.Consts.classes.DRAGGABLE),e.addEventListener("touchmove",(function(t){var e=t.target;do{if(e.matches&&e.matches(".tc-ctl-finfo-layer-content")){t.stopPropagation();break}e=e.parentElement}while(e)}),{passive:!0});const o=new Draggabilly(e,{not:"th,td, td *,input,select,.tc-ctl-finfo-coords"});o.handleEvent=function(t){const e=this.options.not;if(e){let n=t.target,r=!1;for(;n&&!r;)r=n.matches&&n.matches(e),n=n.parentElement;if(r)return}Draggabilly.prototype.handleEvent.call(this,t)},o.on("pointerDown",(function(t,e){var n=t.target.getBoundingClientRect();if(n.left+t.target.clientWidth<e.pageX||n.top+t.target.clientHeight<e.pageY)return o._pointerCancel(t,e),!1})),o.on("dragStart",(function(e,o){if(t.setDragging(!0),t._currentOffset=r.getOffset(),t._previousContainerPosition){var i=n.getSize();r.setPosition(n.getCoordinateFromPixel([t._previousContainerPosition[0],i[1]-t._previousContainerPosition[1]])),t._currentOffset=[0,0],r.setOffset(t._currentOffset),delete t._previousContainerPosition}else t._currentOffset=r.getOffset()})),o.on("dragEnd",(function(o){t.setDragging(!1);var i=n.getCoordinateFromPixel([0,0]),a=n.getCoordinateFromPixel(r.getOffset()),s=[a[0]-i[0],a[1]-i[1]],l=r.getPosition();r.setPosition([l[0]+s[0],l[1]+s[1]]),r.setOffset([0,0]),t._currentOffset=[0,0];const c=e.getBoundingClientRect();t._previousContainerPosition=[c.left,c.bottom]}))}const a=function(t){const r=n.getViewport();var o=!1;if(!e.parent.activeControl||!e.parent.activeControl.isExclusive()){var i=n.getEventPixel(t);o=n.forEachFeatureAtPixel(i,(function(t,e){var n=!0;return t._wrap&&!t._wrap.parent.showsPopup&&(n=!1),n}),{hitTolerance:zS})}r.style.cursor=o?"pointer":""};i.removeEventListener(RS,a),i.addEventListener(RS,a)}})),n()}))}))},gS.Z.wrap.Map.prototype.hidePopup=function(t){this.parent.currentFeature=null,t.popupDiv&&t.popupDiv.classList.remove(gS.Z.Consts.classes.VISIBLE)},gS.Z.wrap.Map.prototype.manageSize=function(){const t=this;t.pixelRatio_=window.devicePixelRatio;const e=function(){t.updateSize()};gS.Z.Util.detectMobile()||(e(),window.addEventListener("resize",e))};var ib=function(t,e){switch(t){case gS.Z.Consts.layerType.KML:case gS.Z.Consts.mimeType.KML:case gS.Z.Consts.format.KMZ:return new ol.format.KML({showPointNames:!1,extractStyles:void 0===e||e});case gS.Z.Consts.layerType.GPX:case gS.Z.Consts.mimeType.GPX:return new ol.format.GPX;case gS.Z.Consts.layerType.GEOJSON:case gS.Z.Consts.mimeType.GEOJSON:case gS.Z.Consts.mimeType.JSON:case gS.Z.Consts.format.JSON:return new ol.format.GeoJSON;case gS.Z.Consts.format.GML2:return new ol.format.GML2;case gS.Z.Consts.format.GML3:return new ol.format.GML3;case gS.Z.Consts.format.GML32:return new ol.format.GML32;case gS.Z.Consts.mimeType.GML:case gS.Z.Consts.format.GML:return new ol.format.GML;case gS.Z.Consts.format.TOPOJSON:return new ol.format.TopoJSON;case gS.Z.Consts.format.WKT:return new ol.format.WKT;default:return null}};gS.Z.wrap.Map.prototype.exportFeatures=function(t,e){var n=this;e=e||{};var r=_b({styles:n.parent.options.styles}),o=t.map((function(t){var e=t.wrap.feature.clone();const n=t.getPath();n&&(e._folders=n),e.id_=t.id,e.getStyle()||e.setStyle(r);const o=kb(e).getText();if(o){o.getText()&&e.setProperties({name:o.getText()})}return e})),i=ib(e.format);if(i instanceof ol.format.KML){o=o.map((function(t){const e=t.getGeometry();if(e instanceof ol.geom.Point){var n=kb(t);const r=n.getImage();if(r instanceof ol.style.RegularShape){const o=r.getRadius(),i=r.getStroke(),a=i.getWidth(),s=2*o+a,l=document.createElement("canvas");l.width=s,l.height=s;const c=n.getText();(n=n.clone()).setText();const u=new ol.Feature(e);return u.setId(t.getId()),u.setProperties(t.getProperties()),u.setStyle(new ol.style.Style({image:new ol.style.Icon({src:"data:image/svg+xml;base64,"+window.btoa('<svg xmlns="http://www.w3.org/2000/svg" width="'+s+'" height="'+s+'"><circle cx="'+s/2+'" cy="'+s/2+'" r="'+o+'" stroke="'+i.getColor()+'" fill="none" stroke-width="'+a+'" /></svg>'),size:[s,s],imgSize:[s,s],scale:r.getScale()}),text:c})),u}}return t}));const t=[];o.forEach((function(e){var n=kb(e);const r=e.getGeometry(),o=n.getText();var i;if(o&&o.getText()){switch(!0){case r instanceof ol.geom.LineString:i=new ol.geom.Point(r.getCoordinateAt(.5));break;case r instanceof ol.geom.Polygon:i=r.getInteriorPoint();break;case r instanceof ol.geom.MultiLineString:{const t=r.getLineStrings();var a=-1;i=new ol.geom.Point(t[t.map((function(t){return t.getLength()})).reduce((function(t,e,n){return e>a?(a=e,n):t}),-1)].getCoordinateAt(.5));break}case r instanceof ol.geom.MultiPolygon:{const t=r.getPolygons();var s=-1;i=t[t.map((function(t){return t.getArea()})).reduce((function(t,e,n){return e>s?(s=e,n):t}),-1)].getInteriorPoint();break}}if(i){const e=new ol.Feature(i);e.setStyle(new ol.style.Style({text:o.clone(),image:new ol.style.Icon({crossOrigin:"anonymous",src:gS.Z.apiLocation+"TC/css/img/transparent.gif"})})),t.push(e)}}})),t.length&&(o=o.concat(t))}if(i instanceof ol.format.GMLBase){i.hasZ=t[0].getGeometryStride()>=3,i.srsName=n.parent.crs,(o=o.map((function(t){var e=t.clone();return e.id_=t.id_,e}))).forEach((function(t){const e=t.values_,n=[];for(var r in e)r.indexOf(" ")>=0&&n.push(r);n.forEach((function(t){var n=t.replace(/ /g,"_");if(/^\d/.test(n)&&(n="_"+n),t!==n)for(;void 0!==e[n];)n+="_";e[n]=e[t],delete e[t]}))})),i.featureNS="http://www.opengis.net/gml",i.featureType="feature";var a=i.writeFeaturesNode(o,{featureProjection:n.parent.crs});a.querySelectorAll("feature geometry > * *[srsName]").forEach((t=>t.removeAttribute("srsName")));var s=ol.xml.createElementNS("http://www.opengis.net/wfs","FeatureCollection");return s.setAttributeNS("http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation",i.schemaLocation),a.removeAttribute("xmlns:xsi"),a.removeAttribute("xsi:schemaLocation"),s.appendChild(a),s.outerHTML}i instanceof ol.format.GPX&&(o=o.map((function(t){const e=t.getGeometry();return e instanceof ol.geom.LineString&&(t=t.clone()).setGeometry(new ol.geom.MultiLineString([e.getCoordinates()])),t})));var l=i.writeFeatures(o,{dataProjection:"EPSG:4326",featureProjection:n.parent.crs});return i instanceof ol.format.GPX&&(l=l.replace(/<ele>NaN<\/ele>/g,"")),l};var ab=function(t){for(var e=0,n=t.dataTransfer.types.length;e<n;e++)if("Files"===t.dataTransfer.types[e])return!0;return!1},sb=function(t){ab(t)&&(this.getMap()._wrap.parent.div.classList.add(gS.Z.Consts.classes.DROP),t.preventDefault(),t.stopPropagation())},lb=function(t){if(ab(t)){var e=this.getMap()._wrap.parent;t.target===this.target&&e.div.classList.remove(gS.Z.Consts.classes.DROP)}};gS.Z.wrap.Map.prototype.enableDragAndDrop=function(t){var e=this,r=t||{},o={formatConstructors:[ol.format.KML,ol.format.GPX,ol.format.GML32,ol.format.GML2,ol.format.GML3CRS84,ol.format.GML2CRS84,ol.format.GML3,ol.format.GeoJSON,function(){return new ol.format.WKT({splitCollection:!0})},ol.format.TopoJSON]};r.dropTarget?o.target=gS.Z.Util.getDiv(r.dropTarget):o.target=e.parent.div;var i=null,a=new ol.interaction.DragAndDrop(o);if(a.on("addfeatures",(function(t){var n=t.features?t.features.map((function(t){return t.getId()||t.setId(gS.Z.getUID()),gS.Z.wrap.Feature.createFeature(t)})):[];Promise.all(n).then((function(n){var r=e.parent.getLoadingIndicator();r&&r.removeWait(e.parent._featureImportWaitId);const o=n.filter((t=>t.geometry));if(o.length){const r={features:o,file:t.file,fileHandle:a.getFileHandle(t.file),fileName:t.file.name,dropTarget:t.target.target,timeStamp:t.file.lastModified,groupIndex:t._groupIndex,groupCount:t._groupCount};if("shp"===t.file.name.substring(t.file.name.lastIndexOf(".")+1).toLowerCase()){const e=t.file.name.substring(0,t.file.name.lastIndexOf("."));r.additionalFileHandles=[".dbf",".prj",".cst",".cpg"].map((t=>a.getFileHandleByName(e+t))).filter((t=>null!==t))}if(t.file._fileSystemFile&&(r.fileSystemFile=t.file._fileSystemFile,delete t.file._fileSystemFile),a._fileLayers){const e=a._fileLayers.filter((e=>e.options.file===t.file.name&&e.options.groupIndex===t._groupIndex));e.length&&(r.targetLayers=e,e.forEach((t=>a._fileLayers.splice(a._fileLayers.indexOf(t),1))))}e.parent.trigger(gS.Z.Consts.event.FEATURESIMPORT,r),n.some((t=>!t.geometry))&&e.parent.trigger(gS.Z.Consts.event.FEATURESIMPORTWARN,{file:t.file})}else{if(i){if(++i.failed<i.total)return;{const e=a.getFileHandle(t.file);t.file=new File([],i.zipName),e&&a.setFileHandle(t.file,e)}}e.parent.trigger(gS.Z.Consts.event.FEATURESIMPORTERROR,{file:t.file})}}))})),r.once)a.map_=e.map;else{e.map.addInteraction(a);var s=a.target?a.target:e.map.getViewport();const t=a.handleResult_;var l={},c=function(t){return t.arrayBuffer?t.arrayBuffer():new Promise((function(e,n){var r=new FileReader;r.onload=function(t){e(new Uint8Array(this.result))},r.onerror=n,r.readAsArrayBuffer(t)}))};a.handleResult_=async function(r,o){var a=this;i=null;if(/\.gpkg$/gi.test(r.name)||"application/geopackage+sqlite3"===r.type)n.e(20).then(n.t.bind(n,2020,23)).then((async function(n){const o=n.GeoPackageAPI,i=function(e){e&&gS.Z.error(e,gS.Z.Consts.msgErrorMode.CONSOLE),t.apply(a,[r,{target:{result:null}}])};try{!async function(n){o.open(n).then((async function(n){const o=n.getFeatureTables(),s=o.length;var l=0,c=0,u=[];const p=function(t){if(++l===s){e.parent.off(gS.Z.Consts.event.FEATURESIMPORT,p);for(var n=0;n<u.length;n++)e.parent.trigger(gS.Z.Consts.event.FEATURESIMPORTPARTIAL,{file:r,table:u[n].table,reason:u[n].reason})}},d=a.getFileHandle(r);e.parent.on(gS.Z.Consts.event.FEATURESIMPORT,p),o.length>1&&(window.dropFilesCounter=window.dropFilesCounter+o.length-1);for(var h=0;h<o.length;h++)try{var f=[];for(let t of n.iterateGeoJSONFeatures(o[h]))Object.prototype.hasOwnProperty.call(t,"id")&&(t.id=o[h]+"."+t.id),t.geometry&&(t.type="Feature",f[f.length]=t);if(!f.length)throw"empty table";var m={type:"FeatureCollection",features:f},g=new File([],o[h]);d&&a.setFileHandle(g,d),t.apply(a,[g,{target:{result:m}}])}catch(t){c++,p({fileName:o[h]}),u.push({table:o[h],reason:t}),gS.Z.error("Error: "+t+" Table: "+o[h],gS.Z.Consts.msgErrorMode.CONSOLE)}s===c&&i("Error: No hay capas vectoriales válidas que mostrar")}),i)}(new Uint8Array(await c(r)))}catch(t){i(t)}}));else if(/\.(json|geojson|kml|kmz|wkt|gml|gml2|gpx)$/gi.test(r.name))t.apply(a,[r,o]);else{/\.(shp)$/gi.test(r.name)||window.dropFilesCounter--;const o=/(spaSITNA)*((\w|-)+)(\.\w{2,})/gi.test(r.name)?new RegExp(/(spaSITNA)*((\w|-)+)(\.\w{2,})/gi).exec(r.name)[2]:r.name,i=r.name.substring(r.name.lastIndexOf(".")+1);var s=null;if(s=Object.prototype.hasOwnProperty.call(l,o)?l[o]:l[o]={isSHP:!1,promises:[]},/\.(cst|cpg|prj)$/gi.test(r.name)){s.isSHP=!0;let t=function(t){return t.text?t.text():new Promise((function(e,n){var r=new FileReader;r.onload=function(t){e(new Uint8Array(this.result))},r.onerror=n,r.readAsText(t)}))}(r);s.promises.push(t),t.then((function(t){l[o][i]=t}))}else if(/\.(shp|dbf|str)$/gi.test(r.name)){s.isSHP=!0,/\.(shp)$/gi.test(r.name)&&(s.shpFile=r);let t=c(r);s.promises.push(t),t.then((function(t){l[o][i]=t}))}s.timer||(s.timer=new Promise((function(t){setTimeout((function(){t()}),1300)})),s.promises.push(s.timer),Promise.all(s.promises).then((function(i){s.isSHP?n.e(178).then(n.t.bind(n,7178,23)).then((async({default:n})=>{var i;let c;try{if(!s.shp||!s.prj||!s.dbf)return s.shp||window.dropFilesCounter++,e.parent.trigger(gS.Z.Consts.event.FEATURESIMPORTERROR,{file:r,message:"fileImport.shapeImcomplete"}),void delete l[o];c=s.shpFile,i=await n.combine([n.parseShp(s.shp,s.prj,s.str),n.parseDbf(s.dbf,s.cst||s.cpg||"ISO-8859-1")]),delete l[o]}catch(t){return void e.parent.trigger(gS.Z.Consts.event.FEATURESIMPORTERROR,{file:r})}(i instanceof Array?i:[i]).forEach((function(e){e.features.forEach(((t,e)=>{t.id=`${o}.${e+1}`}));var n=new File([],o+".shp");const r=a.getFileHandle(c);r&&a.setFileHandle(n,r),t.apply(a,[n,{target:{result:JSON.stringify(e)}}])}))})):("wfsrequest.txt"===r.name.toLowerCase()&&Object.keys(l).some((t=>l[t].isSHP))||(window.dropFilesCounter++,e.parent.trigger(gS.Z.Consts.event.FEATURESIMPORTERROR,{file:r})),delete l[o])})))}};var u=function(t){if(ab(t)){var n=e.parent;if(a.target===t.target){if(!p(t.dataTransfer.items)){var r=n.getLoadingIndicator();r&&(n._featureImportWaitId=r.addWait(n._featureImportWaitId))}t.stopPropagation()}else t.preventDefault();n.div.classList.remove(gS.Z.Consts.classes.DROP)}},p=function(t){for(var e=0,n=t.length;e<n;++e)if("file"===t[e].kind)return!(t[e].getAsFile()||t[e].webkitGetAsEntry()&&t[e].webkitGetAsEntry().isFile)&&p(t[e].webkitGetAsEntry());return!0};a.dropListenKeys_.push(ol.events.listen(s,DS,sb,a)),a.dropListenKeys_.push(ol.events.listen(document.body,DS,sb,a)),a.dropListenKeys_.push(ol.events.listen(s,kS,sb,a)),a.dropListenKeys_.push(ol.events.listen(document.body,kS,sb,a)),a.dropListenKeys_.push(ol.events.listen(s,NS,u,a)),a.dropListenKeys_.push(ol.events.listen(document.body,NS,u,a)),a.dropListenKeys_.push(ol.events.listen(document.body,"dragleave",lb,a)),a.dropListenKeys_.push(ol.events.listen(document.body,"dragend",lb,a)),a.dropListenKeys_.push(ol.events.listen(document.body,"dragexit",lb,a)),document.addEventListener("mouseenter",(function(t){t.buttons||e.parent.div.classList.remove(gS.Z.Consts.classes.DROP)}),!1),e.ddEnabled=!0}return a},gS.Z.wrap.Map.prototype.loadFiles=async function(t,e){const n=this;let r;if(t.length){if(n.ddEnabled?n.map.getInteractions().forEach((function(t){t instanceof ol.interaction.DragAndDrop&&(r=t)})):r=n.enableDragAndDrop({once:!0}),r&&e){var o=r.target;r.target=e.control,n.parent.one(gS.Z.Consts.event.FEATURESIMPORT,(function(t){r.target=o})),e.layers&&(r._fileLayers=(r._fileLayers||[]).concat(e.layers))}var i=n.parent.getLoadingIndicator();i&&(n.parent._featureImportWaitId=i.addWait(n.parent._featureImportWaitId));for(var a=0,s=t.length;a<s;++a){const e=t[a];r.processFile(e)}}},gS.Z.wrap.Map.prototype.linkTo=function(t){const e=this,n=function(){const n=e.map.getView(),r=t.wrap.map.getView();setTimeout((function(){n!==r&&e.map.setView(r)}),100)};t.wrap.map.on("change:view",n),e.map.on("change:view",n),n()},gS.Z.wrap.Layer.prototype.getVisibility=function(){const t=this;var e=!1;return t.layer&&(e=t.layer.getVisible()),e},gS.Z.wrap.Layer.prototype.setVisibility=function(t){this.getLayer().then((function(e){e.setVisible(t)}))},gS.Z.wrap.Layer.prototype.isNative=function(t){return t instanceof ol.layer.Layer},gS.Z.wrap.Layer.prototype.setProjection=function(t){const e=this;t=t||{};const n=e.parent;if(n.map){const i=rb.call(e,{crs:t.crs,extentInDegrees:ol.proj.transformExtent(n.map.getExtent(),n.map.crs,"EPSG:4326")});var r=n.getResolutions();if(r&&r.length)r=r.map((function(t){return t/i})),n.wrap.layer.setMaxResolution(r[0]),n.wrap.layer.setMinResolution(r[r.length-1]);else if(!t.oldCrs||ol.proj.get(t.oldCrs).getUnits()!==ol.proj.Units.METERS||ol.proj.get(t.crs).getUnits()&&ol.proj.get(t.crs).getUnits()!==ol.proj.Units.DEGREES){if(t.oldCrs&&ol.proj.get(t.oldCrs).getUnits()===ol.proj.Units.DEGREES&&ol.proj.get(t.crs).getUnits()===ol.proj.Units.METERS){var o=gS.Z.Util.getMetersPerDegree(ol.proj.transformExtent(n.map.getExtent(),n.map.crs,"EPSG:4326"));n.minResolution&&(n.minResolution=n.minResolution*o,e.layer.setMinResolution(n.minResolution)),n.maxResolution&&(n.maxResolution=n.maxResolution*o,e.layer.setMaxResolution(n.maxResolution))}}else n.minResolution&&(n.minResolution=n.minResolution/i,e.layer.setMinResolution(n.minResolution)),n.maxResolution&&(n.maxResolution=n.maxResolution/i,e.layer.setMaxResolution(n.maxResolution))}};const cb=function(t){const e=new Path2D,n=t[0];e.moveTo(n[0],n[1]);for(var r=1,o=t.length;r<o;r++){const n=t[r];e.lineTo(n[0],n[1])}return e.closePath(),e},ub=function(t){if(gS.Z.Util.detectMobile())return t;{const e=new Path2D;return e.addPath(t,new DOMMatrix("scale("+window.devicePixelRatio+")")),e}},pb=function(t,e,n,r){const o=this,i=`_${e}PrerenderHandler`,a=`_${e}PostrenderHandler`;o[i]&&(o.layer.un(ol.render.EventType.PRERENDER,o[i]),delete o[i],o.layer.un(ol.render.EventType.POSTRENDER,o[a]),delete o[a]),t&&(o[i]=n,o.layer.on(ol.render.EventType.PRERENDER,o[i]),o[a]=r,o.layer.on(ol.render.EventType.POSTRENDER,o[a])),o.parent.map.wrap.map.render()};gS.Z.wrap.Layer.prototype.clip=function(t){const e=this;pb.call(e,t,"clip",(function(n){let r=t;gS.Z.Util.isFunction(t)&&(r=t.call(e._wrap)),r instanceof Path2D||(r=cb(r)),r=ub(r);const o=n.context;o.save(),o.clip(r,"evenodd")}),(function(t){t.context.restore()}))},gS.Z.wrap.Layer.prototype.stroke=function(t,e){const n=this;pb.call(n,t,"stroke",(function(t){}),(function(r){let o=t;gS.Z.Util.isFunction(t)&&(o=t.call(n._wrap)),o instanceof Path2D||(o=cb(o)),o=ub(o);const i=r.context;e.strokeWidth&&(i.lineWidth=e.strokeWidth),e.strokeColor&&(i.strokeStyle=e.strokeColor),i.stroke(o)}))},gS.Z.wrap.layer.Raster.prototype.WmsParser=ol.format.WMSCapabilities,gS.Z.wrap.layer.Raster.prototype.WmtsParser=ol.format.WMTSCapabilities,gS.Z.wrap.Layer.prototype.addCommonEvents=function(t){var e=this;t.on("change:visible",(function(){e.parent.map&&e.parent.map.trigger(gS.Z.Consts.event.LAYERVISIBILITY,{layer:e.parent})}),e.parent.map)},gS.Z.wrap.layer.Raster.prototype.getGetMapUrl=function(){var t=null,e=this;switch(e.getServiceType()){case gS.Z.Consts.layerType.WMS:for(var n=e.parent.capabilities.Capability.Request.GetMap.DCPType,r=0;r<n.length;r++)if(n[r].HTTP&&n[r].HTTP.Get){t=n[r].HTTP.Get.OnlineResource;break}break;case gS.Z.Consts.layerType.WMTS:t=e.parent.capabilities.OperationsMetadata.GetTile.DCP.HTTP.Get[0].href}const o=document.createDocumentFragment(),i=document.createElement("textarea");return o.appendChild(i),i.innerHTML=t,t=i.textContent},gS.Z.wrap.layer.Raster.prototype.getInfoFormats=function(){var t=null,e=this.parent.capabilities;return e.Capability&&e.Capability.Request.GetFeatureInfo&&(t=e.Capability.Request.GetFeatureInfo.Format),t},gS.Z.wrap.layer.Raster.infoFormatPreference=["application/json","application/vnd.ogc.gml/3.1.1","application/vnd.ogc.gml","application/vnd.esri.wms_featureinfo_xml","text/html","text/plain","text/xml"],gS.Z.wrap.layer.Raster.prototype.getWMTSLayer=function(t){var e=null,n=this,r=n.parent.capabilities;let o;if((t=t||{}).crs&&(o=r.Contents.TileMatrixSet.filter((e=>gS.Z.Util.CRSCodesEqual(t.crs,e.SupportedCRS)))),r&&r.Contents)for(var i=0;i<r.Contents.Layer.length;i++){var a=r.Contents.Layer[i];if(n.parent.options.layerNames===a.Identifier)for(var s=0;s<a.TileMatrixSetLink.length;s++)if(t.crs){if(o.filter((t=>t.Identifier===a.TileMatrixSetLink[s].TileMatrixSet)).length>0){e=a;break}}else if((t.matrixSetId||n.parent.options.matrixSet)===a.TileMatrixSetLink[s].TileMatrixSet){e=a;break}}return e},gS.Z.wrap.layer.Raster.prototype.getTileMatrix=function(t){var e=null,n=this.parent.capabilities;if(n&&n.Contents&&n.Contents.TileMatrixSet)for(var r=0;r<n.Contents.TileMatrixSet.length;r++){var o=n.Contents.TileMatrixSet[r];if(o.Identifier===t){e=o.TileMatrix;break}}return e},gS.Z.wrap.layer.Raster.prototype.getScaleDenominators=function(t){var e=[],n=this;if(t.ScaleDenominator?e=[t.ScaleDenominator,t.ScaleDenominator]:(t.MinScaleDenominator||t.MaxScaleDenominator)&&(e=[t.MaxScaleDenominator,t.MinScaleDenominator]),!e.length&&!n.getName(t)){for(var r=n.getLayerNodes(t),o=-1/0,i=1/0,a=0,s=r.length;a<s;a++){var l=n.getScaleDenominators(r[a]);l[0]>o&&(o=l[0]),l[1]<i&&(i=l[1])}o>-1/0&&i<1/0&&(e=[o,i])}return e},gS.Z.wrap.layer.Raster.prototype.getAttribution=function(){const t={},e=gS.Z.capabilities[this.parent.url];return e&&(e.ServiceProvider?(t.name=e.ServiceProvider.ProviderName.trim(),t.site=e.ServiceProvider.ProviderSite,t.site&&t.site.href&&t.site.href.trim().length>0?t.site=t.site.href:delete t.site):e.ServiceIdentification?t.name=e.ServiceIdentification.Title.trim():t.name=e.Service.Title.trim()),t},gS.Z.wrap.layer.Raster.prototype.getInfo=function(t){var e,n=this,r={},o=n.parent.capabilities;if(o)if(o.Capability){var i=n.getAllLayerNodes();for(e=0;e<i.length;e++){var a=i[e];if(n.parent.compareNames(n.getName(a),t)){a.Title&&(r.title=a.Title),a.Abstract&&(r.abstract=a.Abstract),r.legend=[];var s=function(t,e){if(t.Layer&&t.Layer.length>0)for(var r in t.Layer)s(t.Layer[r],e);else e.apply(n,[t])};if(s(a,(function(t){var e=this.getLegend(t);e.src&&r.legend.push({src:e.src,title:t.Title})})),a.MetadataURL&&a.MetadataURL.length){r.metadata=[];for(var l=0;l<a.MetadataURL.length;l++){var c=a.MetadataURL[l];r.metadata.push({format:c.Format,type:c.type,url:c.OnlineResource})}}r.queryable=a.queryable;break}}}else if(o.Contents){const t=n.parent.names[0];for(e=0;e<o.Contents.Layer.length;e++){const n=o.Contents.Layer[e];if(n.Identifier===t){r.abstract=n.Abstract;let t=n.Metadata;t&&(Array.isArray(t)||(t=[t]),r.metadata=t.map((t=>({format:t.format,url:t.href}))));break}}}return r},gS.Z.wrap.layer.Raster.prototype.getServiceType=function(){var t=null,e=this.parent.capabilities;return e.Capability&&e.Capability.Request&&e.Capability.Request.GetMap?t=gS.Z.Consts.layerType.WMS:e.OperationsMetadata&&e.OperationsMetadata.GetTile&&(t=gS.Z.Consts.layerType.WMTS),t},gS.Z.wrap.layer.Raster.prototype.getServiceTitle=function(){var t=null,e=this.parent.capabilities;return e.Capability&&e.Service?t=e.Service.Title:e.ServiceIdentification&&(t=e.ServiceIdentification.Title),t},gS.Z.wrap.layer.Raster.prototype.getRootLayerNode=function(){var t;return this.getServiceType()===gS.Z.Consts.layerType.WMS&&(t=this.parent.capabilities.Capability.Layer),t},gS.Z.wrap.layer.Raster.prototype.getName=function(t,e){var n=t.Name;if(n&&e){var r=n.indexOf(":");r>=0&&(n=n.substr(r+1))}return n},gS.Z.wrap.layer.Raster.prototype.getIdentifier=function(t){return t.Identifier},gS.Z.wrap.layer.Raster.prototype.getLayerNodes=function(t){var e=t.Layer;return Array.isArray(e)||(e=e?[e]:[]),e},gS.Z.wrap.layer.Raster.prototype.getAllLayerNodes=function(){var t=this;if(!t._layerList)switch(t.getServiceType()){case gS.Z.Consts.layerType.WMS:var e=t.getRootLayerNode();t._layerList=e?function e(n){for(var r=[n],o=t.getLayerNodes(n),i=0;i<o.length;i++)r=r.concat(e(o[i]));return r}(e):[];break;case gS.Z.Consts.layerType.WMTS:t._layerList=t.parent.capabilities.Contents.Layer.slice();break;default:t._layerList=[]}return t._layerList},gS.Z.wrap.layer.Raster.prototype.normalizeLayerNode=function(t){return t},gS.Z.wrap.layer.Raster.prototype.normalizeCapabilities=function(t){return t};const db=document.createDocumentFragment(),hb=document.createElement("textarea");db.appendChild(hb),gS.Z.wrap.layer.Raster.prototype.getLegend=function(t){var e={},n=t.Style;if(n&&n.length&&n.length&&n[0].LegendURL&&n[0].LegendURL.length){var r=n[0].LegendURL[0];hb.innerHTML=r.OnlineResource,e.src=hb.textContent}return e},gS.Z.wrap.layer.Raster.prototype.isCompatible=function(t){var e=this,n=!0,r=e.parent;switch(e.getServiceType()){case gS.Z.Consts.layerType.WMS:if(r.capabilities&&r.capabilities.Capability&&r.capabilities.Capability.Layer&&r.names.length>0)for(var o=r.names.slice(0),i=function n(o,i,a){var s=!1;if(o)for(var l=0;l<o.length;l++){var c=o[l];const p=c.CRS||c.SRS,d=Array.isArray(p)?p:[p];var u=a||d.indexOf(t)>=0;if(r.compareNames(e.getName(c),i)){u&&(s=!0);break}if(n(c.Layer,i,u)){s=!0;break}}return s};o.length>0;)if(!i([r.capabilities.Capability.Layer],o.pop())){n=!1;break}break;case gS.Z.Consts.layerType.WMTS:if(n=!1,r.capabilities&&r.capabilities.Contents&&r.capabilities.Contents.TileMatrixSet)for(var a=r.capabilities.Contents.TileMatrixSet,s=0;s<a.length;s++)if(a[s].Identifier===r.options.matrixSet){n=gS.Z.Util.CRSCodesEqual(t,a[s].SupportedCRS);break}}return n},gS.Z.wrap.layer.Raster.prototype.getCompatibleCRS=function(){var t=[],e=this.parent;switch(this.getServiceType()){case gS.Z.Consts.layerType.WMS:if(e.capabilities&&e.capabilities.Capability&&e.capabilities.Capability.Layer&&e.names.length>0){const n=e.names.map((function(t){return e.getNodePath(t).map((function(t){const e=t.CRS||t.SRS||[],n=Array.isArray(e)?e:[e];return Array.isArray(n)?n:[n]})).reduce((function(t,e){return 0===t.length?e:(e.forEach((function(e){t.indexOf(e)<0&&(t[t.length-1]=e)})),t)}),[])}));if(1===n.length)t=n[0];else{const e=n.slice(1);t=n[0].filter((function(t){return e.every((function(e){return e.indexOf(t)>=0}))}))}}break;case gS.Z.Consts.layerType.WMTS:e.capabilities&&e.capabilities.Contents&&e.capabilities.Contents.Layer.filter((function(t){return t.Identifier===e.layerNames})).forEach((function(n){const r=n.TileMatrixSetLink.map((function(t){return t.TileMatrixSet}));t=e.capabilities.Contents.TileMatrixSet.filter((function(t){return r.indexOf(t.Identifier)>=0})).map((function(t){return t.SupportedCRS}))}))}return t},gS.Z.wrap.layer.Raster.prototype.getCompatibleLayers=function(t){var e=[],n=this.parent;switch(this.getServiceType()){case gS.Z.Consts.layerType.WMS:if(n.capabilities&&n.capabilities.Capability&&n.capabilities.Capability.Layer){var r=function(t,n,o){var i=t.CRS||t.SRS,a=Array.isArray(i)?i:[i],s=o||a.indexOf(n)>=0;if(s&&t.Name&&e.push(t.Name),t.Layer)for(var l=0;l<t.Layer.length;l++)r(t.Layer[l],n,s)};r(n.capabilities.Capability.Layer,t)}break;case gS.Z.Consts.layerType.WMTS:if(n.capabilities&&n.capabilities.Contents&&n.capabilities.Contents.TileMatrixSet)for(var o=n.capabilities.Contents.TileMatrixSet,i=0,a=o.length;i<a;i++){var s=o[i];if(gS.Z.Util.CRSCodesEqual(t,s.SupportedCRS))for(var l=s.Identifier,c=n.capabilities.Contents.Layer,u=0,p=c.length;u<p;u++)for(var d=c[u].TileMatrixSetLink,h=0,f=d.length;h<f;h++)if(d[h].TileMatrixSet===l){e.push(c[u].Identifier);break}}}return e},gS.Z.wrap.layer.Raster.prototype.getCompatibleMatrixSets=function(t){var e=[];ob({crs:t});var n=this.parent;if(this.getServiceType()===gS.Z.Consts.layerType.WMTS)for(var r=n.capabilities.Contents.Layer,o=n.capabilities.Contents.TileMatrixSet,i=0,a=r.length;i<a;i++)if(n.layerNames===r[i].Identifier)for(var s=r[i].TileMatrixSetLink,l=0,c=s.length;l<c;l++)for(var u=s[l],p=0,d=o.length;p<d;p++){var h=o[p];if(h.Identifier===u.TileMatrixSet){gS.Z.Util.CRSCodesEqual(t,h.SupportedCRS)&&e.push(h.Identifier);break}}return e},gS.Z.wrap.layer.Raster.prototype.setWMTSUrl=function(){var t=this;t.getLayer().then((function(e){t.parent.options=t.parent.options||{};var n=e.getSource().getUrls();t.parent.options.urlPattern=n[n.length-1]}))};const fb=function(t,e,n){const r=n*(e||1);return t.map(((t,e)=>e<2?t-r:t+r))};gS.Z.wrap.layer.Raster.prototype.createWMSLayer=function(t,e,n){const r=this;var o=null,i=new ol.source.ImageWMS({url:t,crossOrigin:n.map?n.map.crossOrigin:void 0,params:e,ratio:gS.Z.Cfg.imageRatio,imageLoadFunction:r.parent.getImageLoad.bind(r.parent),serverType:ol.source.WMSServerType.GEOSERVER}),a={visible:!!e.LAYERS.length||n&&n.method&&"POST"===n.method,source:i};return n.minResolution&&(a.minResolution=n.minResolution),n.maxResolution&&(a.maxResolution=n.maxResolution),(o=new ol.layer.Image(a))._wrap=r,r.addCommonEvents(o),o};var mb=function(t){var e=this,n=null,r=ol.source.WMTS.optionsFromCapabilities(e.parent.capabilities,{layer:t.layerNames,matrixSet:t.matrixSet,crossOrigin:t.map?t.map.options.crossOrigin:void 0,requestEncoding:t.encoding,format:t.format});let o;const i=e.parent.capabilities.Contents.Layer.find((e=>e.Identifier===t.layerNames));if(!i)throw new Error(`Layer '${t.layerNames}' not found`);if(o=i.TileMatrixSetLink.find((e=>e.TileMatrixSet===t.matrixSet)),!o)throw new Error(`Matrix set '${t.matrixSet}' not found`);{const t=o.TileMatrixSetLimits;t&&r.tileGrid.fullTileRanges_.forEach((function(e,n){const r=t[n];e.minX=r.MinTileCol,e.minY=r.MinTileRow,e.maxX=r.MaxTileCol,e.maxY=r.MaxTileRow}))}var a="https:";if(r){r.cacheSize=2048,location.protocol===a&&(r.urls=r.urls.map((function(t){return t.replace("http:",a)}))),r.extent=e.parent.getExtent(),r.crossOrigin=t.map?t.map.crossOrigin:void 0,(n=new ol.source.WMTS(r)).setTileLoadFunction(e.parent.getImageLoad.bind(e.parent));var s=n.getResolutions.bind(n);n.getResolutions=function(){var t=s(),n=e.parent.getLimitedMatrixSet();if(n&&n.length){var r=n[0].matrixIndex;void 0!==r&&(t=t.slice(r,n.length+r))}return t}}return n};gS.Z.wrap.layer.Raster.prototype.createWMTSLayer=function(t){const e=this;var n=null,r=mb.call(e,t);if(r){var o={source:r};t.minResolution&&(o.minResolution=t.minResolution),t.maxResolution&&(o.maxResolution=t.maxResolution),(n=new ol.layer.Tile(o))._wrap=e,e.addCommonEvents(n);var i=r.getResolutions();n.setMaxResolution(i[0]+1),n.setMinResolution(i[i.length-1])}return n},gS.Z.wrap.layer.Raster.prototype.getParams=function(){return this.layer.getSource().getParams()},gS.Z.wrap.layer.Raster.prototype.setParams=function(t){this.layer.getSource().updateParams(t)},gS.Z.wrap.layer.Raster.prototype.setMatrixSet=function(t){const e=this;if(e.parent.type===gS.Z.Consts.layerType.WMTS){const n=mb.call(e,gS.Z.Util.extend({},e.parent.options,{matrixSet:t})),r=n.getResolutions(),o=r[0],i=r[r.length-1];e.layer.setMaxResolution(o),e.layer.setMinResolution(i),e.parent.minResolution&&(e.parent.minResolution=i),e.parent.maxResolution&&(e.parent.maxResolution=o),e.layer.setSource(n)}},gS.Z.wrap.layer.Raster.prototype.getResolutions=function(){if(this.layer.getSource){var t=this.layer.getSource();return t.getResolutions?t.getResolutions():[]}return[]},gS.Z.wrap.layer.Raster.prototype.setResolutions=function(t){if(this.layer.getSource){var e=this.layer.getSource();e.resolutions_?e.resolutions_=t:e.tileGrid&&(e.tileGrid.resolutions_=t)}},gS.Z.wrap.layer.Raster.prototype.reloadSource=function(){const t=this;return new Promise((function(e,n){t.layer.getSource?(t.layer.getSource().refresh(),e()):n()}))},gS.Z.wrap.Geometry={getNearest:function(t,e){return new ol.geom.LineString(e).getClosestPoint(t)}};var gb=function(t,e,n){if(t){var r=function(r){var o=(n&&n._wrap?n._wrap.parent.options.width:null)||e;if(o<r){var i=o/r;t.setScale(i)}},o=t.getSize();if(o)r(o[0]);else{var i=t.getImage();if(!i.naturalWidth){const e=document.createDocumentFragment(),n=document.createElement("img");return n.src=t.getSrc(),e.appendChild(n),new Promise((function(t){n.addEventListener("load",(function(){r(this.naturalWidth),t(this)}))}))}r(i.naturalWidth)}}},yb=function(t,e){var n=t,r=e&&e.wrap&&e.wrap.feature;if("string"==typeof t){var o=t.match(/^\$\{(.+)\}$/);if(o&&r){for(var i=o[1].split("."),a=r.getProperties(),s=0;s<i.length&&void 0!==a;s++)a=a[i[s]];if(void 0===a)for(a=e.data,s=0;s<i.length&&void 0!==a;s++)a=a[i[s]];n=a}}else gS.Z.Util.isFunction(t)&&(n=t(e));return n};const vb=function(t){const e=gS.Z.Util.extend(!0,{},gS.Z.Cfg.styles);return t&&t.map&&gS.Z.Util.extend(!0,e,t.map.options.styles),e},_b=function(t,e){const n=[];var r,o,i,a;if(e){const t=e.getGeometry();switch(t&&t.getType()){case"Point":case"MultiPoint":o=!0;break;case"LineString":case"MultiLineString":i=!0;break;case"Polygon":case"MultiPolygon":a=!0}r=e._wrap?e._wrap.parent:{id:gS.Z.wrap.Feature.prototype.getId.call({feature:e}),features:e.get("features"),getData:function(){return gS.Z.wrap.Feature.prototype.getData.call({feature:e})}}}var s,l=r&&Array.isArray(r.features)&&r.features.length>1;const c=vb(t.layer);s=l?gS.Z.Util.extend(!0,{},c.cluster,t&&t.styles&&t.styles.cluster?t.styles.cluster:{}):gS.Z.Util.extend(!0,{},c,t.styles);var u={};return!s.line||!i&&e||((u=s.line)instanceof Array?u:[u]).forEach((function(t,e){n[e]=Object.assign(n[e]||{},{stroke:new ol.style.Stroke({color:yb(t.strokeColor,r),width:yb(t.strokeWidth,r),lineDash:t.lineDash})})})),!s.polygon||!a&&e||((u=s.polygon)instanceof Array?u:[u]).forEach((function(t,e){n[e]=Object.assign(n[e]||{},{fill:new ol.style.Fill({color:tb(yb(t.fillColor,r),yb(t.fillOpacity,r))}),stroke:new ol.style.Stroke({color:yb(t.strokeColor,r),width:yb(t.strokeWidth,r),lineDash:t.lineDash})})})),!s.point||!o&&e||((u=s.point)instanceof Array?u:[u]).forEach((function(t,e){var o={radius:yb(t.radius,r)||(yb(t.height,r)+yb(t.width,r))/4};t.fillColor&&(o.fill=new ol.style.Fill({color:tb(yb(t.fillColor,r),yb(t.fillOpacity,r))})),t.strokeColor&&(o.stroke=new ol.style.Stroke({color:yb(t.strokeColor,r),width:yb(t.strokeWidth,r),lineDash:t.lineDash})),isNaN(o.radius)||(n[e]=Object.assign(n[e]||{},{image:new ol.style.Circle(o)}))})),u.label&&(n[n.length]={text:Cb(u,r)}),!s.marker||!o&&e||((u=s.marker)instanceof Array?u:[u]).forEach((function(t,e){var o="fraction";t.url&&(n[e]=Object.assign(n[e]||{},{image:new ol.style.Icon({crossOrigin:"anonymous",anchor:u.anchor||s.marker.anchor||[.5,1],anchorXUnits:u.anchorXUnits||o,anchorYUnits:u.anchorYUnits||o,src:u.url,rotation:u.rotation?u.rotation/180*Math.PI:void 0}),text:Cb(u,r)}))})),n.map((t=>{var e=new ol.style.Style(t);return u.balloon&&(e._balloon=new ol.style.Text({text:u.balloon})),e}))},Cb=function(t,e){if(!t||!t.label)return;const n={text:""+yb(t.label,e),overflow:!0};if(t.font?n.font=t.font:t.fontSize&&(n.font=yb(t.fontSize,e)+"pt sans-serif"),t.angle&&(n.rotation=-Math.PI*yb(t.angle,e)/180),t.fontColor){const r=yb(t.fontColor,e);n.fill=new ol.style.Fill({color:tb(r,(Array.isArray(r)?r[3]:1)||1)})}if(t.labelOutlineColor){const r=yb(t.labelOutlineColor,e);n.stroke=new ol.style.Stroke({color:tb(r,(Array.isArray(r)?r[3]:1)||1),width:yb(t.labelOutlineWidth,e)})}return t.labelOffset&&(n.offsetX=t.labelOffset[0],n.offsetY=t.labelOffset[1]),t.textScale&&(n.scale=t.textScale),t.textAlign&&(n.textAlign=t.textAlign),new ol.style.Text(n)};var Eb=function(t){var e=t.toString(16);return 1===e.length&&(e="0"+e),e},wb=function(t){return"#"+Eb(t[0])+Eb(t[1])+Eb(t[2])},Sb=function(t,e){var n={};if(gS.Z.Util.isFunction(t)&&e&&(t=t(e)),Array.isArray(t)&&(t=t[0]),!gS.Z.Util.isFunction(t)){var r,o,i;if(e){const n=e.getGeometry();if(n){const e=n.getType();e!==ol.geom.GeometryType.POINT&&e!==ol.geom.GeometryType.MULTI_POINT&&t.setImage(null)}}var a=t.getImage();if(a)if(a instanceof ol.style.RegularShape)(r=(o=a.getStroke()).getColor())&&(r=ol.color.asArray(r),n.strokeColor=wb(r)),n.strokeWidth=o.getWidth(),(i=a.getFill())&&((r=i.getColor())&&(r=ol.color.asArray(r),n.fillColor=wb(r)),n.fillOpacity=r[3]);else{n.url=a.getSrc();var s=a.getSize();s&&(n.width=s[0],n.height=s[1],n.anchor=a.getAnchor(),n.anchor&&(n.anchor[0]=n.anchor[0]/n.width*(a.getScale()||1),n.anchor[1]=n.anchor[1]/n.height*(a.getScale()||1)))}else(o=t.getStroke())&&((r=o.getColor())&&(r=ol.color.asArray(r),n.strokeColor=wb(r)),n.strokeWidth=o.getWidth(),n.lineDash=o.getLineDash()),(i=t.getFill())&&((r=i.getColor())&&(r=ol.color.asArray(r),n.fillColor=wb(r)),n.fillOpacity=r[3])}return n};gS.Z.wrap.layer.Vector.prototype.getStyle=function(){return Sb(this.layer.getStyle())},gS.Z.wrap.layer.Vector.prototype.reloadSource=function(){const t=this;return new Promise((function(e,n){const r=t.createVectorSource(t.parent,t.createStyles(t.parent));if(t.parent.type===gS.Z.Consts.layerType.WFS)var o=r.source.on("change",(function(t){"ready"===r.source.getState()&&(ol.Observable.unByKey(o),e())}));var i=t.layer.getSource().getFeatures();t.layer.setSource(r.source),r.style&&t.layer.setStyle(r.style),t.parent.type!==gS.Z.Consts.layerType.WFS&&(r.source.addFeatures(i),e())}))},gS.Z.wrap.layer.Vector.prototype.import=function(t){var e=this,n=gS.Z.Util.extend({},t);n.type=t.format;var r=e.layer.getSource().getFeatures(),o=e.createVectorSource(n,e.createStyles(e.parent));e.layer.setSource(o.source),o.style&&e.layer.setStyle(o.style),o.source.addFeatures(r)},gS.Z.wrap.layer.Vector.prototype.createVectorSource=function(t,e){const n=this;var r,o,i=!1;const a=t.styles&&t.styles.heatmap;if(Array.isArray(t.url)||t.urls){var s=t.urls||t.url;s=s.map((function(t,e){return gS.Z.proxify(t)})),o={url:s,format:new ol.format.KML({showPointNames:!1,extractStyles:!a}),projection:t.crs}}else if(t.url&&t.type!==gS.Z.Consts.layerType.WFS)(o={url:t.url,projection:t.crs}).format=ib(t.format,!a)||ib(gS.Z.Util.getMimeTypeFromUrl(t.url),!a)||ib(t.type,!a),o.loader=o.format instanceof ol.format.KML?function(t,e,r){const i=o.url,a=o.format;n.parent.state=gS.Z.Layer.state.LOADING,n.parent.map&&n.parent.map.trigger(gS.Z.Consts.event.BEFORELAYERUPDATE,{layer:n.parent});new gS.Z.tool.Proxification(gS.Z.proxify).fetch(i,{method:"GET",nomanage:!0}).then((async function(t){if(t.ok){const i=await t.text();var e=a.readFeatures(i,{featureProjection:r});const s=(new DOMParser).parseFromString(i,"text/xml").querySelector("Document > name");if(n.addFeatures(e),n.parent.state=gS.Z.Layer.state.IDLE,t.headers.has("content-disposition")&&/(attachment);([^;]*)/gi.test(t.headers.get("content-disposition"))){const e=t.headers.get("content-disposition");var o;try{o=/filename\*?=\"?([\w|-]*\'\')?(.*\.\w*)\"?/gi.exec(e)[2]}catch(t){try{o=e.substring((e.lastIndexOf("'")||e.indexOf("="))+1)}catch(t){}}n.parent.title=(s?s.textContent:"")+(o?s&&s.textContent!=o?" ("+o+")":o:"")}else n.parent.title=(s?s.textContent:"")+(s&&s.textContent!=n.parent.title?" ("+n.parent.title+")":n.parent.title);n.parent.map&&n.parent.map.trigger(gS.Z.Consts.event.LAYERUPDATE,{layer:n.parent})}})).catch((function(t){n.parent.state=gS.Z.Layer.state.IDLE,n.parent.map&&n.parent.map.trigger(gS.Z.Consts.event.LAYERERROR,{layer:n.parent,reason:t})}))}:function(t,e){var r=ol.featureloader.xhr(t,e);return function(t,e,o){n.parent.state=gS.Z.Layer.state.LOADING,n.parent.map&&n.parent.map.trigger(gS.Z.Consts.event.BEFORELAYERUPDATE,{layer:n.parent}),r.call(this,t,e,o)}}(o.url,o.format),i=!0;else if(t.data)o={projection:t.crs,loader:function(e,r,o){n.parent.state=gS.Z.Layer.state.LOADING,n.parent.map&&n.parent.map.trigger(gS.Z.Consts.event.BEFORELAYERUPDATE,{layer:n.parent});var i=this.getFormat();try{var a=i.readFeatures(t.data,{featureProjection:o});this.addFeatures(a),n.parent.state=gS.Z.Layer.state.IDLE,n.parent.map&&n.parent.map.trigger(gS.Z.Consts.event.LAYERUPDATE,{layer:n.parent,newData:t.data})}catch(t){n.parent.state=gS.Z.Layer.state.IDLE,n.parent.map&&n.parent.map.trigger(gS.Z.Consts.event.LAYERERROR,{layer:n.parent,reason:t.message})}}},o.format=ib(t.format)||ib(t.type);else if(t.type===gS.Z.Consts.layerType.WFS){var l,c;switch(t.outputFormat){case gS.Z.Consts.format.JSON:l=new ol.format.GeoJSON({geometryName:t.geometryName}),c="json";break;case gS.Z.Consts.format.GML3:l=new ol.format.WFS({gmlFormat:new ol.format.GML3}),c=gS.Z.Consts.mimeType.GML;break;case gS.Z.Consts.format.GML32:l=new ol.format.WFS({gmlFormat:new ol.format.GML32}),c=gS.Z.Consts.mimeType.GML;break;default:l=new ol.format.WFS({gmlFormat:new ol.format.GML2}),c=gS.Z.Consts.mimeType.GML}o={format:l,loader:function(e,r,o){var i=this,a=t.url;if(a){n.parent.state=gS.Z.Layer.state.LOADING,n.parent.map.trigger(gS.Z.Consts.event.BEFORELAYERUPDATE,{layer:n.parent});const e=function(){return"string"==typeof t.properties},r=t=>{const e=t.data;let r;try{r=l.readFeatures(e)}catch(t){n.parent.map.trigger(gS.Z.Consts.event.LAYERERROR,{layer:n.parent,reason:t.message})}const o=function(){n.parent.map.trigger(gS.Z.Consts.event.LAYERUPDATE,{layer:n.parent,newData:e})},a=function(t){t.layer===n.parent&&(n.parent.map.off(gS.Z.Consts.event.FEATURESADD,a),o())};r&&r.length?(n.parent.map.on(gS.Z.Consts.event.FEATURESADD,a),i.addFeatures(r)):o(),n.parent.state=gS.Z.Layer.state.IDLE},s=t=>{t instanceof XMLDocument?n.parent.map.trigger(gS.Z.Consts.event.LAYERERROR,{layer:n.parent,reason:t.querySelector("ExceptionText").innerHTML}):n.parent.map.trigger(gS.Z.Consts.event.LAYERERROR,{layer:n.parent,reason:t})},u=(r,i)=>{var s={},l=o.getCode(),u=t.version||i.version||"1.1.0";i.version=u;var p=a,d=Array.isArray(t.featureType)?t.featureType:[t.featureType];const h=e();if(t.properties&&(h?t.properties.length>gS.Z.Consts.URL_MAX_LENGTH:t.properties.getText(i.version).length>gS.Z.Consts.URL_MAX_LENGTH)?(s.method="POST",s.url=p,s.data=h?t.properties:gS.Z.Util.WFSQueryBuilder(d,t.properties,i,r?null:t.outputFormat,r,l,t.maxFeatures),h||n.parent.map.trigger(gS.Z.Consts.event.BEFOREAPPLYQUERY,{layer:n.parent,query:s.data})):(s.method="GET",s.url=p,s.data={service:"WFS",request:"GetFeature",version:u,outputFormat:t.outputFormat,srsname:l},s.data["typename"+("2.0.0"===u?"s":"")]=(t.featurePrefix?t.featurePrefix+":":"")+t.featureType,r&&(s.data=Object.assign(s.data,{resultType:"hits"})),t.properties&&(t.properties instanceof gS.Z.filter.Bbox?s.data=Object.assign(s.data,{BBOX:"{0},{1},{2},{3},{4}".format(t.properties.extent.concat([l]))}):s.data=Object.assign(s.data,{filter:h?t.properties:t.properties.getText(u).replace(/(fes\:|ogc\:)/g,"")}),h||r||n.parent.map.trigger(gS.Z.Consts.event.BEFOREAPPLYQUERY,{layer:n.parent,query:t.properties.getText()})),t.maxFeatures&&(s.data=Object.assign(s.data,{maxFeatures:t.maxFeatures}))),"json"===(r?"":c))s.responseType=gS.Z.Consts.mimeType.JSON;else s.responseType=gS.Z.Consts.mimeType.XML;return s.contentType=gS.Z.Consts.mimeType.XML,gS.Z.ajax(s)};n.parent.getCapabilitiesPromise().then((o=>{const i=o;let a=null;try{a=i.Operations.GetFeature.CountDefault.DefaultValue}catch(t){}if(a){t.maxFeatures||(t.maxFeatures=a);let o=e();u(!o,i).then((t=>{if(o)r(t);else{var e=t.data.children[0];if(e.tagName.toLowerCase().indexOf("exception")>=0)n.parent.map.trigger(gS.Z.Consts.event.LAYERERROR,{layer:n.parent,reason:e.querySelector("ExceptionText").innerHTML});else if(e.tagName.toLowerCase().indexOf("featurecollection")>=0){let t=parseInt((e.attributes.numberMatched||e.attributes.numberOfFeatures).value,10);if(isNaN(t)||t>=parseInt(a,10))return void n.parent.map.trigger(gS.Z.Consts.event.LAYERERROR,{layer:n.parent,reason:gS.Z.Consts.WFSErrors.MAX_NUM_FEATURES,data:{limit:parseInt(a,10),founded:t}});if(!isNaN(t)&&0===t)return void r({data:l instanceof ol.format.GeoJSON?{type:"FeatureCollection",totalFeatures:0,features:[],crs:null}:l.writeFeatures([])});u(!1,i).then(r).catch(s)}}})).catch(s)}else u(!1,i).then(r).catch(s)})),n._requestUrl=a}},projection:t.crs}}t.features&&((o=o||{}).features=t.features.map((t=>t instanceof gS.Z.Feature?t.wrap.feature:t))),r=new ol.source.Vector(o),i&&r.on(FS,(function(t){n.parent.map&&n.parent.map.trigger(gS.Z.Consts.event.LAYERUPDATE,{layer:n.parent})})),r._tcLayer=n.parent;var u=t.style&&t.style.marker?t.style.marker:gS.Z.Cfg.styles.marker;if(t.style&&t.style.marker||(u=gS.Z.Util.extend({},u,{anchor:gS.Z.Cfg.styles.point.anchor})),t.cluster&&(r=new ol.source.Cluster({projection:t.crs,distance:t.cluster.distance,source:r}),t.cluster.animate)){var p=function(t,e){var n=Date.now(),r=t.getGeometry().getCoordinates(),o=e.getGeometry().getCoordinates();e.setGeometry(new ol.geom.Point(r));requestAnimationFrame((function i(){var a=function(t,e,n,r){var o=Math.min((Date.now()-r)/n,1),i=(e[0]-t[0])*o,a=(e[1]-t[1])*o;return[t[0]+i,t[1]+a]}(r,o,gS.Z.Consts.CLUSTER_ANIMATION_DURATION,n);e.setGeometry(new ol.geom.Point(a)),a[0]!==o[0]&&a[1]!==o[1]?requestAnimationFrame(i):d.splice(d.indexOf(t),1)}))},d=[];r.addEventListener(HS,(function(t){var e=t.feature.get("features");e&&e.length>1&&d.push(t.feature)})),r.addEventListener(qS,(function(t){var e=t.feature.get("features");if(e){var n=e[0].getGeometry().getCoordinates();if(e.length>1){var r=d.filter((function(t){var e=t.getGeometry().getCoordinates();return e[0]===n[0]&&e[1]===n[1]}));r.length&&d.splice(d.indexOf(r[0]),1)}var o=d.filter((function(t){var e=t.get("features");if(e&&e.length>0)return e.filter((function(t){var e=t.getGeometry().getCoordinates();return e[0]===n[0]&&e[1]===n[1]})).length>0}));o.length&&p(o[o.length-1],t.feature)}}))}var h=r;do{h.addEventListener(qS,(function(t){var e=t.feature,n=kb(e,!0);if(n){const r=gb(n.getImage(),u.width,e);r&&r.then((function(){if(t.feature._wrap.parent._legend){const e=t.feature._wrap.parent.layer;delete t.feature._wrap.parent._legend,e.map.trigger(gS.Z.Consts.event.VECTORUPDATE,{layer:e})}}))}})),h=gS.Z.Util.isFunction(h.getSource)?h.getSource():null}while(h);r.addEventListener(qS,(function(t){const e=t.feature,r=function(t){var r,o;switch(!0){case gS.Z.feature.Point&&t instanceof gS.Z.feature.Point:r=n.parent.addPoint;break;case gS.Z.feature.Polyline&&t instanceof gS.Z.feature.Polyline:r=n.parent.addPolyline;break;case gS.Z.feature.Polygon&&t instanceof gS.Z.feature.Polygon:r=n.parent.addPolygon;break;case gS.Z.feature.MultiPolygon&&t instanceof gS.Z.feature.MultiPolygon:r=n.parent.addMultiPolygon;break;case gS.Z.feature.MultiPolyline&&t instanceof gS.Z.feature.MultiPolyline:r=n.parent.addMultiPolyline;break;default:r=n.parent.addFeature}r&&r.call(n.parent,e).then((function(r){var i=e.get("features");Array.isArray(i)&&(r.features=i.map((function(e){return new t.constructor(e)}))),clearTimeout(o),o=setTimeout((function(){n.parent.map.trigger(gS.Z.Consts.event.FEATURESADD,{layer:n.parent,features:[r]})}),50)}))};e._wrap&&e._wrap.parent.layer||gS.Z.wrap.Feature.createFeature(e).then(r)})),r.addEventListener(HS,(function(t){var e=t.feature;if(e._wrap){var r=n.parent.features.indexOf(e._wrap.parent);r>-1&&(n.parent.map.trigger(gS.Z.Consts.event.BEFOREFEATUREREMOVE,{layer:n.parent,feature:e._wrap.parent}),n.parent.features.splice(r,1),n.parent.map.trigger(gS.Z.Consts.event.FEATUREREMOVE,{layer:n.parent,feature:e._wrap.parent}))}})),r.addEventListener(qS,(function(t){n.parent.map&&n.parent.map.trigger(gS.Z.Consts.event.VECTORUPDATE,{layer:n.parent})})),r.addEventListener(HS,(function(){n.parent.map&&n.parent.map.trigger(gS.Z.Consts.event.VECTORUPDATE,{layer:n.parent})})),r.addEventListener(VS,(function(){n.parent.map&&n.parent.map.trigger(gS.Z.Consts.event.FEATURESCLEAR,{layer:n.parent})}));var f={source:r};return t.minResolution&&(f.minResolution=t.minResolution),t.maxResolution&&(f.maxResolution=t.maxResolution),o&&o.format instanceof ol.format.KML&&!t.cluster||(f.style=e||t.styles),f},gS.Z.wrap.layer.Vector.prototype.createStyles=function(t){var e=this,n=!1;if(gS.Z.Util.isFunction(t))n=!0,e.styleFunction=function(e){return _b(t(e))};else{(t=gS.Z.Util.extend({},t)).crs=t.crs||gS.Z.Cfg.crs;const r=vb(e.parent);t.styles=gS.Z.Util.extend(!0,r,t.styles);n=!(!t.cluster||!t.cluster.styles)||function t(e){for(var n in e){var r=e[n];switch(typeof r){case"string":if(/^\$\{(.+)\}$/.test(r))return!0;break;case"object":if(t(r))return!0;break;case"function":return!0}}return!1}(t.styles);const o={};e.parent.styles&&(o.styles=Object.assign({},e.parent.styles)),t.cluster&&t.cluster.styles&&(o.styles=Object.assign({},o.styles,{cluster:t.cluster.styles})),e.styleFunction=function(t){return o.layer=e.parent,_b(o,t)}}return n?e.styleFunction:e.styleFunction()},gS.Z.wrap.layer.Vector.prototype.setStyles=function(t){const e=this;e.getLayer().then((function(n){if(t&&t.heatmap||n instanceof ol.layer.Heatmap){const r=n.getSource().getFeatures();r.forEach((t=>t.setStyle(null)));const o=gS.Z.Util.extend(!0,{features:r},e.parent.options);if(delete o.styles,e.layer=e.createVectorLayer(gS.Z.Util.extend(o,{styles:t})),e.parent.map){const t=e.parent.map.wrap;t.insertLayer(e.layer,t.getLayerIndex(n)),t.removeLayer(n)}}else n.setStyle(e.createStyles({styles:t}))}))},gS.Z.wrap.layer.Vector.prototype.createVectorLayer=function(t){const e=this;var n=null;t=t||e.parent.options;const r=e.createVectorSource(t,e.createStyles(t));if(t.styles&&t.styles.heatmap){const e=gS.Z.Util.extend({},t.styles.heatmap);if(gS.Z.Util.isFunction(e.weight)){const t=e.weight;e.weight=function(e){return t(e._wrap.parent)}}n=new ol.layer.Heatmap(gS.Z.Util.extend({source:r.source},e))}else n=new ol.layer.Vector(r);return n._wrap=e,e.addCommonEvents(n),n},gS.Z.wrap.layer.Vector.prototype.addFeatures=function(t){const e=this,n=function(e){e instanceof ol.layer.Heatmap&&t.forEach((t=>t.setStyle(null)));for(var n=e;gS.Z.Util.isFunction(n.getSource);)n=n.getSource();n.addFeatures(t)};e.layer?n(e.layer):e.getLayer().then(n)},gS.Z.wrap.layer.Vector.prototype.getFeatures=function(){var t=this.getLayer();return t instanceof ol.layer.Layer?t.getSource().getFeatures():[]},gS.Z.wrap.layer.Vector.prototype.getFeatureById=function(t){var e=this.layer;return e instanceof ol.layer.Layer?e.getSource().getFeatureById(t):null},gS.Z.wrap.layer.Vector.prototype.removeFeature=function(t){const e=this,n=function(e){if(t.wrap.feature){let n=e.getSource(),r=t.wrap.feature.getId();if(r&&n.getFeatureById(r)&&(n.removeFeature(t.wrap.feature),n.getSource&&Array.isArray(t.features))){const e=n.getSource();t.features.slice().forEach((t=>e.removeFeature(t.wrap.feature)))}}};e.layer?n(e.layer):e.getLayer().then(n)},gS.Z.wrap.layer.Vector.prototype.clearFeatures=function(){const t=this,e=function(t){var e=t.getSource();e.clearFeatures?e.clearFeatures():e.clear()};t.layer?e(t.layer):t.getLayer().then(e)},gS.Z.wrap.layer.Vector.prototype.setFeatureVisibility=function(t,e){var n=this,r={color:"rgba(0, 0, 0, 0)"},o={color:"rgba(0, 0, 0, 0)"},i=new ol.style.Style({image:new ol.style.Circle({radius:0,fill:new ol.style.Fill(r),stroke:new ol.style.Stroke(o)}),fill:new ol.style.Fill(r),stroke:new ol.style.Stroke(o)});if(n.parent.features.indexOf(t)>=0){var a=t.wrap.feature;n.getLayer().then((function(t){e&&a._originalStyle?a.setStyle(a._originalStyle):(a._originalStyle=a.getStyle()||t.getStyle(),a.setStyle(i)),n.parent.map.trigger(gS.Z.Consts.event.VECTORUPDATE,{layer:n.parent})}))}},gS.Z.wrap.layer.Vector.prototype.getRGBA=function(t,e){return tb(t,e)},gS.Z.wrap.layer.Vector.prototype.findFeature=function(t){},gS.Z.wrap.layer.Vector.prototype.getGetFeatureUrl=function(){return this._requestUrl},gS.Z.wrap.layer.Vector.prototype.sendTransaction=function(t,e,n){const r=this,o=function(t){return t.wrap.feature};return new Promise((function(i,a){const s=t.map(o),l=e.map(o),c=n.map(o);t.length||e.length||n.length?r.getLayer().then((function(){var t=new ol.format.WFS,e=r.parent.options,n=t.writeTransaction(s,l,c,{featurePrefix:e.featurePrefix,featureNS:e.featureNS,featureType:e.featureType[0]}),o={url:r.parent.url,method:"POST",contentType:gS.Z.Consts.mimeType.XML,responseType:gS.Z.Consts.mimeType.XML,data:n.outerHTML};gS.Z.ajax(o).then((function(e){const n=e.data,r="http://www.opengis.net/ows";var o=n.getElementsByTagNameNS(r,"ExceptionReport")[0],s={reason:""};if(o){var l=o.getElementsByTagNameNS(r,"Exception")[0];if(l){s.code=l.getAttribute("exceptionCode");for(var c=l.getElementsByTagNameNS(r,"ExceptionText"),u=0,p=c.length;u<p;u++)s.reason+="\n"+c[u].innerHTML}a(s)}else{var d=t.readTransactionResponse(n);i(d)}})).catch((function(t){const e={code:t.status||"",reason:t.msg||"unknown"};a(e)}))})):i(r.parent)}))},gS.Z.wrap.layer.Vector.prototype.setDraggable=function(t,e,n){var r=this;Promise.all([r.parent.map.wrap.getMap(),r.getLayer()]).then((function(o){const i=o[0],a=o[1];if(t){var s={layers:[a],features:new ol.Collection(a.getSource().getFeatures())};r.interaction=new ol.interaction.Translate(s),gS.Z.Util.isFunction(e)&&r.interaction.on("translateend",(function(t){t.features.getLength()&&e(t.features.item(0)._wrap.parent)})),gS.Z.Util.isFunction(n)&&r.interaction.on("translatestart",(function(t){t.features.getLength()&&n(t.features.item(0)._wrap.parent)})),i.addInteraction(r.interaction)}else r.interaction&&(i.removeInteraction(r.interaction),gS.Z.Util.detectIE()&&r._handlerDraggablePointerMove&&gS.Z.Util.isFunction(r._handlerDraggablePointerMove)&&(i.un("pointermove",r._handlerDraggablePointerMove),delete r._handlerDraggablePointerMove))}))},gS.Z.wrap.layer.Vector.prototype.getFeaturesInExtent=function(t,e){var n=this,r=this.layer.getSource().getFeatures(),o=[];if(e){var i=n.parent.map.getPixelFromCoordinate([t[0],t[1]]),a=n.parent.map.getPixelFromCoordinate([t[2],t[3]]);i[0]-=e[0]/2,i[1]+=e[1],a[0]+=e[0]/2,t=n.parent.map.getCoordinateFromPixel(i).concat(n.parent.map.getCoordinateFromPixel(a))}for(var s=0;s<r.length;s++){var l=r[s],c=l.getGeometry().getCoordinates();ol.extent.containsCoordinate(t,c)&&o.push(l._wrap.parent)}return o},gS.Z.wrap.layer.Vector.prototype.getAttribution=function(){return null},gS.Z.wrap.layer.Vector.prototype.getGetMapUrl=function(){var t=null;if(this.getServiceType()===gS.Z.Consts.layerType.WFS)try{t=this.parent.capabilities.Operations.GetFeature.DCP.HTTP.Get.href}catch(t){}const e=document.createDocumentFragment(),n=document.createElement("textarea");return e.appendChild(n),n.innerHTML=t,t=n.textContent},gS.Z.wrap.layer.Vector.prototype.getServiceType=function(){var t=null;return this.parent.capabilities&&(t=gS.Z.Consts.layerType.WFS),t},gS.Z.wrap.control.Click.prototype.register=function(t){var e=this;e._trigger=function(n){if(t.view!==gS.Z.Consts.view.PRINTING){var r=0;return t.wrap.map.forEachFeatureAtPixel(n.pixel,(function(t,e){t._wrap&&t._wrap.parent.showsPopup&&r++}),{hitTolerance:zS}),r||(e.parent.map.trigger(gS.Z.Consts.event.CLICK,{coordinate:n.coordinate,pixel:n.pixel}),e.parent.callback(n.coordinate,n.pixel)),0===r}}},gS.Z.wrap.control.Click.prototype.activate=function(){var t=this;t.parent.map.wrap.getMap().then((function(e){e.on(GS,t._trigger)}))},gS.Z.wrap.control.Click.prototype.deactivate=function(){var t=this;t.parent.map.wrap.getMap().then((function(e){e.un(GS,t._trigger)}))},gS.Z.wrap.control.ScaleBar.prototype.render=function(){var t=this;t.ctl?t.ctl.updateElement_():t.ctl=new ol.control.ScaleLine({target:t.parent.div})},gS.Z.wrap.control.ScaleBar.prototype.getText=function(){if(this.ctl)return this.ctl.renderedHTML_},gS.Z.wrap.control.NavBar.prototype.register=function(t){var e=this;t.wrap.getMap().then((function(n){const r=e.parent.div;e.zCtl=new ol.control.Zoom({target:r}),e.zsCtl=new ol.control.ZoomSlider({render:function(t){if(!t.frameState||!t.frameState.viewState||n.getView().getMinResolution()<=t.frameState.viewState.resolution){var r=function(){this.element.offsetWidth>this.element.offsetHeight?(e.requestSliderSize||(e.requestSliderSize=window.requestAnimationFrame(r.bind(this))),window.requestAnimationFrame(r.bind(this))):this.element.offsetWidth<this.element.offsetHeight&&(e.requestSliderSize&&(window.cancelAnimationFrame(e.requestSliderSize),delete e.requestSliderSize),ol.control.ZoomSlider.prototype.render.call(this,t))};r.call(this)}}}),e.zsCtl.setTarget(r),n.addControl(e.zsCtl),n.addControl(e.zCtl),r.querySelectorAll("button").forEach((function(t){t.classList.add("tc-ctl-btn","tc-float-btn",e.parent.CLASS+"-btn"),t.style.display="block",t.innerHTML="",t.matches(".ol-zoom-in")&&(t.classList.add(e.parent.CLASS+"-btn-zoomin"),t.setAttribute("title",e.parent.getLocaleString("zoomIn"))),t.matches(".ol-zoom-out")&&(t.classList.add(e.parent.CLASS+"-btn-zoomout"),t.setAttribute("title",e.parent.getLocaleString("zoomOut")))}));const o=r.querySelector(".ol-zoomslider");o.classList.add(e.parent.CLASS+"-bar"),o.querySelector(".ol-zoomslider-thumb").classList.add(e.parent.CLASS+"-slider"),t.on(gS.Z.Consts.event.BASELAYERCHANGE,e.refresh.bind(e))}))},gS.Z.wrap.control.NavBar.prototype.refresh=function(){var t=this,e=t.parent.map.wrap.map;t.parent.renderPromise().then((function(){if(t.zsCtl.sliderInitialized_){var n=e.getView().getResolution();t.zsCtl.setThumbPosition_(n)}else e.once(WS,(function(e){t.zsCtl.render(e)}))}))},gS.Z.wrap.control.NavBarHome.prototype.register=function(t){var e=this;t.wrap.getMap().then((function(n){const r=e.parent.div;e.z2eCtl=new ol.control.ZoomToExtent({target:r,extent:t.initialExtent,tipLabel:""}),n.addControl(e.z2eCtl),r.querySelectorAll("button").forEach((function(t){t.style.display="block",t.innerHTML=""}));const o=r.querySelector(".ol-zoom-extent button");o.classList.add("tc-ctl-btn","tc-float-btn",e.parent.CLASS+"-btn"),o.setAttribute("title",e.parent.getLocaleString("zoomToInitialExtent"))}))},gS.Z.wrap.control.NavBarHome.prototype.setInitialExtent=function(t){this.z2eCtl.extent=t},gS.Z.wrap.control.Coordinates.prototype.register=function(t){const e=this;return e.map=t,new Promise((function(n,r){e._coordsTrigger=function(t){e.parent.coordsToClick(t)},t.wrap.getMap().then((function(t){if(e.olMap=t,e.parent.map.on3DView)e.parent.crs=e.parent.map.view3D.crs,e.parent.units=gS.Z.Consts.units.DEGREES;else{var r=t.getView().getProjection();e.parent.crs=r.getCode(),e.parent.units=r.getUnits()}e.parent.isGeo=e.parent.units===ol.proj.Units.DEGREES,n()}))}))},gS.Z.wrap.control.Coordinates.prototype.onMouseMove=function(t){var e=this;if(e.map.wrap.map){var n=e.map.wrap.map.getEventCoordinate(t);n&&(e.parent.isGeo?e.parent.latLon=n.reverse():e.parent.xy=n,e.parent.update.apply(e.parent,arguments))}},gS.Z.wrap.control.Geolocation.prototype.register=function(t){var e=this;e.map=t,e._snapTrigger=function(t){t.dragging||e.initSnap(e.olMap.getEventCoordinate(t.originalEvent),t.pixel)},e._postrenderTrigger=function(t){e.duringTrackSnap(t)},t.wrap.getMap().then((function(t){e.olMap=t}))};var bb=function(){return this.parent.layerTracking.features.filter((function(t){return t instanceof gS.Z.feature.Polyline}))[0]};gS.Z.wrap.control.Geolocation.prototype.hasCoordinates=function(){return this.parent.layerTracking.features.length>0&&this.parent.layerTracking.features[0].geometry.length>=1},gS.Z.wrap.control.Geolocation.prototype.addWaypoint=function(t,e){var n=new ol.Feature({geometry:new ol.geom.Point([t[0],t[1],e.ele,e.time],"XYZM")});n.setProperties(e),this.parent.layerTracking.wrap.layer.getSource().addFeature(n)},gS.Z.wrap.control.Geolocation.prototype.addPosition=function(t,e,n,r,o,i,a){var s=this,l=t[0],c=t[1],u=bb.call(this);if(s.parent.layerTracking.features&&u){var p=u.geometry.length>0&&u.geometry[u.geometry.length-1];if(p&&0===p.length)s.parent.layerTracking.features[0].geometry.push([l,c,a,n]),u.wrap.feature.getGeometry().appendCoordinate([l,c,a,n]);else{var d=p[0],h=p[1];l===d&&c===h||(s.parent.layerTracking.features[0].geometry.push([l,c,a,n]),u.wrap.feature.getGeometry().appendCoordinate([l,c,a,n]))}gS.Z.Util.storage.setSessionLocalValue(s.parent.Const.LocalStorageKey.TRACKINGTEMP,s.formattedToStorage(s.parent.layerTracking).features)}s.parent.trigger(s.parent.Const.Event.STATEUPDATED,{moving:null!=e&&null!=r&&r>0&&e>0})},gS.Z.wrap.control.Geolocation.prototype.roundCoordinates=function(t,e){const n=Math.min(function(t){if(Math.floor(t)===t)return 0;var e=t.toString();return e.length-e.lastIndexOf(".")-1}(t),e);return Math.round(t*Math.pow(10,n))/Math.pow(10,n)},gS.Z.wrap.control.Geolocation.prototype.positionChangehandler=function(t){const e=this;var n,r,o,i,a;return bb.call(this)||e.parent.setTracking(!1),new Promise((function(s,l){if(t&&t.coords)if(e.parent.layerGPS.clearFeatures(),n=t.coords.accuracy/e.parent.map.getMetersPerUnit()||0,r=t.coords.heading||t[2]||0,o=t.coords.speed?3.6*t.coords.speed:0,i=t.coords.altitude||0,a=t.coords.altitudeAccuracy||0,e.parent.layerTracking){var c=[t.coords&&t.coords.longitude||t[0],t.coords&&t.coords.latitude||t[1]];c.every((t=>t))||s(null);var u=gS.Z.Util.reproject(c,"EPSG:4326",e.parent.map.crs);u[0]=e.roundCoordinates(u[0],e.map.wrap.isGeo()?gS.Z.Consts.DEGREE_PRECISION:gS.Z.Consts.METER_PRECISION),u[1]=e.roundCoordinates(u[1],e.map.wrap.isGeo()?gS.Z.Consts.DEGREE_PRECISION:gS.Z.Consts.METER_PRECISION),e.addPosition(u,r,(new Date).getTime(),o,n,a,i);var p=bb.call(e).geometry,d=p.length;d>=2&&(e.parent.deltaMean=(p[d-1][3]-p[0][3])/(d-1)),e.parent.trigger(e.parent.Const.Event.POSITIONCHANGE,{pd:{position:u,altitude:i,accuracy:n,heading:gS.Z.Util.radToDeg(r),speed:o}}),Promise.all([e.parent.layerGPS.addPoint(u,{radius:6,fillColor:"#00CED1",fillOpacity:1,strokeColor:"#ffffff",strokeWidth:2,showsPopup:!1}),e.parent.layerGPS.addCircle([u,n],{strokeColor:"#ffffff",strokeWidth:1,fillColor:"#00CED1",fillOpacity:.3,showsPopup:!1})]).then((function(t){const n=t[0],r=t[1];if(e.parent.geopositionTracking=!0,0==e.parent.firstPosition){if(e.parent.firstPosition=!0,!e.parent.trackCenterButton){e.parent.trackCenterButton=e.parent.div.querySelector("."+e.parent.CLASS+"-track-center"),e.parent.trackCenterButton.querySelector("button").addEventListener("click",(function(){this.classList.contains(gS.Z.Consts.classes.UNPLUGGED)?(e.parent.setFollowing(!0),e.parent.Move(e.parent.layerGPS.features[0].geometry),e.parent.getTrackInfoPanel().then((function(t){t.isVisible()||t.doVisible(),t.isMinimized()&&t.maximize()}))):e.parent.setFollowing(!1)}));var o=e.parent.map.getControlsByClass("TC.control.ControlContainer")[0];o?e.parent.trackCenterButton=o.addElement({position:o.POSITION.LEFT,htmlElement:e.parent.trackCenterButton}):e.parent.map.div.appendChild(e.parent.trackCenterButton)}e.parent.trackCenterButton.classList.remove(gS.Z.Consts.classes.HIDDEN),e.parent.setFollowing(!0),e.parent.Move(e.parent.layerGPS.features)}s({marker:n,accuracy:r})}))}else s(null);else s(null)}))},gS.Z.wrap.control.Geolocation.prototype.setTracking=function(t){var e=this;if(t){e.parent.firstPosition=!1;var n,r=[];if(e.parent.sessionTracking){var o=(new gS.Z.wrap.parser.JSON).parser.readFeatures(e.parent.sessionTracking);o&&e.parent.storageCRS!==e.parent.map.crs&&(o=o.map((function(t){var n=t.clone();return n.getGeometry().transform(e.parent.storageCRS,e.parent.map.crs),n})));var i=o.filter((function(t){var e=t.getGeometry().getType().toLowerCase();return"point"===e&&r.push(t),"linestring"===e||"multilinestring"===e}))[0].getGeometry().getCoordinates();n=new ol.Feature({geometry:new ol.geom.LineString(i,"XYZM"),tracking:!0})}else n=new ol.Feature({geometry:new ol.geom.LineString([],"XYZM"),tracking:!0});n&&gS.Z.wrap.Feature.createFeature(n).then((function(t){var n;e.parent.layerTracking.addFeature(t),t.geometry.length>1&&e.parent.map.zoomToFeatures(e.parent.layerTracking.features),r.length>0&&Promise.all(r.map((function(t){return gS.Z.wrap.Feature.createFeature(t)}))).then((function(t){t&&t.forEach((function(t){e.parent.layerTracking.addFeature(t)}))})),e.parent.currentPositionWaiting=e.parent.getLoadingIndicator().addWait(),e.currentPositionTrk||(e.currentPositionTrk=[]);var o=0,i=0,a=!1,s={enableHighAccuracy:!0,timeout:6e5};n=setInterval((function t(r){var l=o++;navigator.geolocation.getCurrentPosition((function(t){clearInterval(n),e.parent.getLoadingIndicator().removeWait(e.parent.currentPositionWaiting),e.positionChangehandler(t).then((function(t){1==e.parent.geopositionTracking&&t&&t.marker&&t.accuracy&&e.currentPositionTrk.push(navigator.geolocation.watchPosition(e.positionChangehandler.bind(e),e.parent.onGeolocateError.bind(e.parent),s))}))}),r||function(r){if(r.code===r.TIMEOUT)i>10?(clearInterval(n),e.parent.onGeolocateError.call(e.parent,r)):(i++,t((function(){clearInterval(n),a||(a=!0,e.parent.onGeolocateError.call(e.parent,r))})));else clearInterval(n),e.parent.onGeolocateError.call(e.parent,r)},{timeout:5e3+l,maximumAge:10,enableHighAccuracy:!0})}),1e3),setTimeout((function(){e.parent.layerTracking&&e.parent.layerTracking.features&&e.parent.layerTracking.features.length>0&&0==e.parent.layerTracking.features[0].geometry.length&&(clearInterval(n),e.parent.getLoadingIndicator().removeWait(e.parent.currentPositionWaiting),e.map.toast(e.parent.getLocaleString("geo.error.permission_denied"),{type:gS.Z.Consts.msgType.WARNING}),e.parent.track.activateButton.classList.remove(gS.Z.Consts.classes.HIDDEN),e.parent.track.deactivateButton.classList.add(gS.Z.Consts.classes.HIDDEN))}),s.timeout+1e3)}))}else e.parent.firstPosition=!1,e.currentPositionTrk&&(e.currentPositionTrk=e.currentPositionTrk instanceof Array?e.currentPositionTrk:[e.currentPositionTrk],e.currentPositionTrk.forEach((function(t){navigator.geolocation.clearWatch(t)})),e.currentPositionTrk=[]),e.parent.trackCenterButton&&e.parent.trackCenterButton.classList.add(gS.Z.Consts.classes.HIDDEN)},gS.Z.wrap.control.Geolocation.prototype.activateSnapping=function(){var t=this;gS.Z.Util.detectMobile()||(t.olMap.on([BS,GS],t._snapTrigger),t.parent.layerTrack.wrap.layer.on(WS,t._postrenderTrigger))},gS.Z.wrap.control.Geolocation.prototype.deactivateSnapping=function(){var t=this;t.parent.map.wrap.getMap().then((function(e){gS.Z.Util.detectMobile()||(e.un([BS,GS],t._snapTrigger),t.parent.layerTrack.wrap.layer.un(WS,t._postrenderTrigger)),t.snapInfo&&e.removeOverlay(t.snapInfo),t.snapInfoElement&&(t.snapInfoElement.style.display="none"),t.snapLine&&(delete t.snapLine,e.render())}))},gS.Z.wrap.control.Geolocation.prototype.clear=function(t){t&&t.clearFeatures(),this.deactivateSnapping.call(this)},gS.Z.wrap.control.Geolocation.prototype.duringTrackSnap=function(t){const e=ol.render.getVectorContext(t);e&&this.snapLine&&("function"==typeof e.setFillStrokeStyle&&e.setFillStrokeStyle(null,new ol.style.Stroke({color:"rgba(197, 39, 55, 1)",width:1})),"function"==typeof e.drawGeometry&&e.drawGeometry(this.snapLine.wrap.feature.getGeometry()))},gS.Z.wrap.control.Geolocation.prototype.endSnap=function(){var t=this;t.parent.map.wrap.getMap().then((function(e){t.snapInfo&&e.removeOverlay(t.snapInfo),t.snapInfoElement&&(t.snapInfoElement.style.display="none"),t.snapLine&&delete t.snapLine}))},gS.Z.wrap.control.Geolocation.prototype.initSnap=function(t,e){var n=this;if(n.parent.layerTrack){var r=n.parent.layerTrack.wrap.layer.getSource().getClosestFeatureToCoordinate(t);if(null!==r){var o=r.getGeometry().getClosestPoint(t);if(n.parent.elevationChartData&&Array.isArray(n.parent.elevationChartData.secondaryElevationProfileChartData)&&n.parent.elevationChartData.secondaryElevationProfileChartData.length>0&&n.parent.elevationChartData.secondaryElevationProfileChartData[0]){let t=n.parent.elevationChartData.secondaryElevationProfileChartData[0];if(Object.prototype.hasOwnProperty.call(t,"ele")&&Array.isArray(t.ele)&&!Object.prototype.hasOwnProperty.call(t,"eleCoordinates")){let t=[...r.getGeometry().getCoordinates()];Array.isArray(t)&&Array.isArray(t[0])&&(t.forEach(((t,e)=>{t.splice(2,1,n.parent.elevationChartData.secondaryElevationProfileChartData[0].ele[e])})),n.parent.elevationChartData.secondaryElevationProfileChartData[0].eleCoordinates=t)}}const u=n.parent.map.getPixelFromCoordinate(o);if(Math.sqrt(Math.pow(e[0]-u[0],2)+Math.pow(e[1]-u[1],2))>n.parent.snappingTolerance)n.endSnap();else{var i=[t,[o[0],o[1]]];n.snapLine?n.snapLine.wrap.feature.getGeometry().setCoordinates(i):n.snapLine=new gS.Z.feature.Polyline(i,{}),n.snapInfoElement||(n.snapInfoElement=document.getElementsByClassName("tc-ctl-geolocation-track-snap-info")[0]),n.snapInfoElement.style.display="block",n.snapInfo||(n.snapInfo=new ol.Overlay({element:n.snapInfoElement,offset:[5,18]}),n.olMap.addOverlay(n.snapInfo)),null==n.snapInfo.getMap()&&n.snapInfo.setMap(n.olMap),n.snapInfo.setPosition(t);var a={};"LineString"!=r.getGeometry().getType()&&r.getKeys().indexOf("name")>-1&&(a.n=r.get("name"));var s=n.parent.map.options.locale&&n.parent.map.options.locale.replace("_","-")||void 0;a.x=n.map.wrap.isGeo()?o[0].toLocaleString(s,{minimumFractionDigits:5}):Math.round(o[0]).toLocaleString(s),a.y=n.map.wrap.isGeo()?o[1].toLocaleString(s,{minimumFractionDigits:5}):Math.round(o[1]).toLocaleString(s),n.map.wrap.isGeo()&&(a.isGeo=!0);var l=function(t){return o[t]?(Math.round(100*o[t])/100).toLocaleString(s):void 0},c=function(t){return o[t]>0?new Date(o[t]).toLocaleString(s):void 0};if(r.getGeometry().getLayout()===ol.geom.GeometryLayout.XYZM?(a.z=l(2),a.m=c(3)):r.getGeometry().getLayout()===ol.geom.GeometryLayout.XYZ?a.z=l(2):r.getGeometry().getLayout()===ol.geom.GeometryLayout.XYM&&(a.m=c(2)),a){if(n.parent.elevationChartData&&n.parent.elevationChartData.secondaryElevationProfileChartData[0]&&n.parent.elevationChartData.secondaryElevationProfileChartData[0].eleCoordinates){let e=gS.Z.wrap.Geometry.getNearest(t,n.parent.elevationChartData.secondaryElevationProfileChartData[0].eleCoordinates),r=(Math.round(100*e[2])/100).toLocaleString(s);a.mdtz=r}n.parent.getRenderedHtml(n.parent.CLASS+"-track-snapping-node",a,(function(t){n.snapInfoElement.innerHTML=t}))}}}}n.olMap.render()},gS.Z.wrap.control.Geolocation.prototype.drawTrackingData=function(t){const e=this;return new Promise((function(n,r){const o=[],i=(new gS.Z.wrap.parser.JSON).parser.readFeatures(t.data);i.filter((function(t){return"linestring"===t.getGeometry().getType().toLowerCase()||"multilinestring"===t.getGeometry().getType().toLowerCase()})).forEach((function(e){e.getGeometry().setCoordinates(e.getGeometry().getCoordinates(),t.layout)})),e.activateSnapping.call(e);for(var a=0,s=i.length;a<s;a++)o.push(gS.Z.wrap.Feature.createFeature(i[a]));Promise.all(o).then((function(t){t.forEach((function(t){t&&e.parent.layerTrack.addFeature(t)})),(!e.parent.toShare||e.parent.toShare&&e.parent.toShare.doZoom)&&e.parent.map.zoomToFeatures(e.parent.layerTrack.features),n()}))}))},gS.Z.wrap.control.Geolocation.prototype.formattedFromStorage=function(t){const e=this;if(e.parent.storageCRS!==e.parent.map.crs){var n=(new ol.format.GeoJSON).readFeatures(t);if(n)return n=n.map((function(t){var n=t.clone();return n.getGeometry().transform(e.parent.storageCRS,e.parent.map.crs),n.setId(t.getId()),n})),(new ol.format.GeoJSON).writeFeatures(n)}return t},gS.Z.wrap.control.Geolocation.prototype.formattedToStorage=function(t,e,n){var r=this,o=new gS.Z.wrap.parser.JSON;o=o.parser;var i,a=t.wrap.layer.getSource().getFeatures();return a=a.map((function(t){if(t.getGeometry()instanceof ol.geom.LineString&&(i=t.getGeometry().getLayout()),e&&t.getProperties().tracking&&t.unset("tracking"),!n&&r.parent.map.crs!==r.parent.storageCRS){var o=t.clone();return o.getGeometry().transform(r.parent.map.crs,r.parent.storageCRS),o.setId(t.getId()),o}return t})).sort((function(t,e){return t.getGeometry()instanceof ol.geom.Point&&!(e.getGeometry()instanceof ol.geom.Point)?-1:e.getGeometry()instanceof ol.geom.Point&&!(t.getGeometry()instanceof ol.geom.Point)?2:t.getProperties().name<e.getProperties().name?-1:t.getProperties().name>e.getProperties().name?1:0})),{features:o.writeFeatures(a),layout:i}},gS.Z.wrap.control.Geolocation.prototype.export=function(t){const e=this;return new Promise((function(n,r){e.parent.getTrackingData(t).then((function(o){if(o){var i=(new ol.format.GeoJSON).readFeatures(o.data);if(0===i.length){var a=e.parent.getTrackingData(t);i=(new ol.format.GeoJSON).readFeatures(a)}Promise.all(i.map((function(t){return gS.Z.wrap.Feature.createFeature(t)}))).then((t=>{n(t)}))}else r()}))}))};var Lb,Tb,Pb=function(t){var e=[],n=[];if(t.length>1){4===t[0].length&&(t=t.sort((function(t,e){return t[0][3]==e[0][3]?0:t[0][3]<e[0][3]?-1:1})));for(var r=0;r<t.length;r++){for(var o=t[r],i=-1,a=1/0,s=o.getLastCoordinate(),l=r+1;l<t.length;l++){var c=t[l].getFirstCoordinate(),u=Math.hypot(s[0]-c[0],s[1]-c[1]);u<a&&(i=l,a=u)}e.length<t.length&&(-1===e.indexOf(r)&&(e.push(r),n=n.concat(o.getCoordinates())),-1===e.indexOf(i)&&(e.push(i),n=n.concat(t[i].getCoordinates())))}return n}return t[0].getCoordinates()};gS.Z.wrap.control.Geolocation.prototype.processImportedFeatures=function(t){for(var e=this,n=e.parent.layerTrack.wrap.layer.getSource(),r=e.parent.importedFileName,o=[],i=[],a=[],s=[],l=n.getFeatures(),c=[],u=[],p=function(t){const e=t.getProperties();Object.prototype.hasOwnProperty.call(e,"name")&&e.name.trim().length>0?o.push(e.name):o.push(r)},d=0;d<l.length;d++){var h=l[d];if(h instanceof gS.Z.Feature&&(h=l[d].wrap.feature),h.getGeometry()instanceof ol.geom.Point)u.push(h.getGeometry().getCoordinates()),s.push(h);else if(h.getGeometry()instanceof ol.geom.LineString){p(h);const t=new ol.Feature({geometry:new ol.geom.LineString(h.getGeometry().getCoordinates(),h.getGeometry().getLayout())});t.setId(h.getId()||gS.Z.getUID()),i.push(t),a.push(h)}else if(h.getGeometry()instanceof ol.geom.MultiLineString){var f=h.clone();p(f);var m=f.getGeometry().getLineStrings();const t=Pb(m),e=new ol.Feature({geometry:new ol.geom.LineString(t,h.getGeometry().getLayout())});e.setId(h.getId()||gS.Z.getUID()),i.push(e),a.push(h)}}if(c.length>0){const t=Pb(c);i.push(new ol.Feature({geometry:new ol.geom.LineString(t)}))}if(u.length>0&&s.length==l.length&&i.push(new ol.Feature({geometry:new ol.geom.LineString(u)})),a.length>0)for(var g=0;g<a.length;g++)n.removeFeature(a[g]);if(i.length>0){var y,v=0;(function(){const a=i.map((function(a,s){return new Promise((function(a,l){var c;y&&n.removeFeature(y),o.length>s&&(c=o[s],function(t,e){for(var n=[],r=t.indexOf(e);-1!==r;)if(n.push(r),r=t.indexOf(e,r+1),n.length>1)return!0;return n.length>1}(o,c)&&(c="["+(s+1)+"] "+c)),e.parent.importedFileName=c||r,y=i[s],n.addFeature(y),e.parent.saveTrack({message:e.parent.getLocaleString("geo.trk.upload.ok",{trackName:c||r}),importedFileName:c||r,notReproject:t.notReproject,fileHandle:t.fileHandle}).then((function(t){0===s&&(v=t),a()}))}))}));return Promise.all(a)})().then((function(){e.parent.layerTrack.setVisibility(!1),e.parent.layerTrack.clearFeatures(),e.parent.trigger(e.parent.Const.Event.IMPORTEDTRACK,{index:v}),delete e.parent.importedFileName,e.parent.getLoadingIndicator().removeWait(t.wait)}))}else e.parent.layerTrack&&(e.parent.map.removeLayer(e.parent.layerTrack),e.parent.layerTrack=void 0),delete e.parent.importedFileName,e.parent.getLoadingIndicator().removeWait(t.wait),gS.Z.alert(e.parent.getLocaleString("geo.trk.upload.error4"))},gS.Z.wrap.control.Geolocation.prototype.import=function(t,e,n){var r,o,i=this;if(e&&e.text){var a=i.parent.layerTrack.wrap.createVectorSource({data:e.text,type:n});r=a.source,o=r.on("change",(function(e){"ready"===r.getState()&&(ol.Observable.unByKey(o),i.processImportedFeatures(t))})),i.parent.layerTrack.wrap.layer.setSource(r)}else i.parent.layerTrack&&(i.parent.map.removeLayer(i.parent.layerTrack),i.parent.layerTrack=void 0),delete i.parent.importedFileName,i.parent.getLoadingIndicator().removeWait(t),gS.Z.alert(i.parent.getLocaleString("geo.trk.upload.error4"))},gS.Z.wrap.control.Geolocation.prototype.simulateTrackEnd=function(t){var e=this;t||(e.hasElevation=!0),e.parent.chartProgressClear(),e.simulateMarker&&(window.cancelAnimationFrame(Lb),e.simulateMarker.layer.wrap.layer.getSource().getFeatures().length>0&&e.simulateMarker.layer.removeFeature(e.simulateMarker),delete e.simulateMarker)},gS.Z.wrap.control.Geolocation.prototype.simulateTrack=function(){for(var t,e=this,n=e.parent.layerTrack.wrap.layer.getSource().getFeatures(),r=0;r<n.length;r++)if(n[r].getGeometry()instanceof ol.geom.LineString){t=n[r].getGeometry().getCoordinates();break}if(t&&t.length>0){var o=t[0];new Promise((function(t,n){e.simulateMarker?(e.simulateMarker.setCoords(o.slice(0,2)),t(e.simulateMarker)):e.parent.layerTrack.addPoint(o.slice(0,2),{radius:7,fillColor:"#ff0000",fillOpacity:.5,strokeColor:"#ffffff",strokeWidth:2}).then((function(e){t(e)}))})).then((function(n){e.simulateMarker=n;var r=function(){var n,r=!1;const o=function(t){return e.parent.map.crs!==e.parent.map.options.utmCrs?gS.Z.Util.reproject(t,e.parent.map.crs,e.parent.map.options.utmCrs):t};var i=t;if(4===i[0].length&&i[0][3]>0)n=i[0][3],r=!0;else{i[0][3]=Date.now();for(var a=1;a<i.length;a++){let t;i[a][3]=0,t=a+1<i.length?new ol.geom.LineString(o(i.slice(a-1,a+1))).getLength():new ol.geom.LineString(o(i.slice(a-1))).getLength(),i[a][3]=i[a-1][3]+36e5*t/e.parent.walkingSpeed}n=i[0][3]}var s=new ol.geom.LineString(i),l=n,c=0;c=e.parent.map.crs!==e.parent.map.options.utmCrs?new ol.geom.LineString(o(JSON.parse(JSON.stringify(i)))).getLength():s.getLength();var u=function(){if(!e.parent.simulate_paused){var t=s.getCoordinateAtM(l),n=function(t){for(var e=0;e<i.length;e++)if(i[e][3]>t)return{d:new ol.geom.LineString(o(i.slice(0,e))).getLength(),p:i[e-1].slice(0,2)}}(l);if(!t||!n){var a=e.parent.getSelectedTrack();return a&&e.parent.uiSimulate(!1,a),e.parent.hasElevation&&e.parent.chartProgressClear(),void e.simulateTrackEnd()}e.parent.hasElevation&&e.parent.chartSetProgress(n,t,c,!!r&&e.parent._getTime(i[0][3],t[3])),e.simulateMarker&&e.simulateMarker.setCoords(t),1!==e.parent.simulate_speed?l+=e.parent.delta*e.parent.simulate_speed:l+=e.parent.delta}Lb=requestAnimationFrame(u)};Lb=requestAnimationFrame(u)};new Promise((function(t,e){window.d3?t():gS.Z.loadJS(!window.d3,[gS.Z.Consts.url.D3C3],(function(){t()}))})).then((function(){Lb=requestAnimationFrame(r)}))}))}},gS.Z.wrap.control.Geolocation.prototype.headingChangehandler=function(t){var e=this;if(!e.parent.track.infoOnMap){e.parent.track.infoOnMap=document.createElement("div");const t=e.parent.track.infoOnMap.style;t.overFlowY="scroll",t.height="200px",t.width="200px",t.top="0",t.left="100px",t.backgroundColor="fuchsia",t.position="absolute",e.parent.map.div.appendChild(e.parent.track.infoOnMap)}e.parent.track.infoOnMap.style.display="",e.heading=t.target.getHeading(),e.parent.track.infoOnMap.innerHTML=e.parent.track.infoOnMap.innerHTML+"<br> <p> salta headingChangehandler </p> <br> <p> evt.target.getHeading(): "+e.heading+" </p>",e.map.wrap.getMap().then((function(t){t.getView().setRotation(-e.heading)})),e.parent.trigger(e.parent.Const.Event.STATEUPDATED,{moving:null!=e.heading&&e.heading>0})},gS.Z.wrap.control.Geolocation.prototype.orientationChangehandler=function(t){var e=this,n=e.map.wrap.map.getView(),r=n.getCenter(),o=n.getResolution(),i=t.target.getBeta()||0,a=t.target.getGamma()||0;r[0]-=o*a*25,r[1]+=o*i*25,n.setCenter(n.constrainCenter(r)),e.parent.trigger(e.parent.Const.Event.STATEUPDATED,{moving:null!=e.heading&&e.heading>0})},gS.Z.wrap.control.Geolocation.prototype.pulsate=function(t){this.pulsated=!0;var e,n=t.wrap.feature.getGeometry().getRadius(),r=(new Date).getTime();e=this.olMap.on(WS,(function(o){var i=o.vectorContext,a=o.frameState,s=a.time-r,l=t.wrap.feature.getGeometry().clone(),c=function(t){switch(!0){case t<=50:return n;case t>50&&t<=100:return 1.02*n;case t>100&&t<=150:return 1.05*n;case t>150&&t<=200:return 1.02*n;case t>200&&t<=300:return n;case t>300&&t<=350:return 1.02*n;case t>350&&t<=400:return 1.05*n;case t>400&&t<=450:return 1.02*n;case t>450&&t<=500:return 1*n;default:return n}}(s);l.setRadius(c),i.setFillStrokeStyle(new ol.style.Fill({color:"rgba(0, 0, 0, 0.1)"}),new ol.style.Stroke({color:"rgba(255, 0, 0, .8)",width:1})),i.drawCircleGeometry(l),s>500?ol.Observable.unByKey(e):a.animate=!0}))},gS.Z.wrap.control.ResultsPanel.prototype.register=function(t){const e=this;e.map=t,t.wrap.getMap().then((function(t){e.olMap=t}))},gS.Z.wrap.control.ResultsPanel.prototype.showElevationMarker=function(t){const e=this,n=(t=t||{}).data,r=t.layer,o=t.coords;if(!e.elevationMarker){const t=document.createElement("div");t.style.display="none",t.classList.add(e.parent.CLASS+"-overlay","elevation"),e.elevationMarker=new ol.Overlay({id:"ovElevationMarker",element:t,offset:[0,0],positioning:ol.OverlayPositioning.CENTER_CENTER,stopEvent:!1})}if(!r||r.getVisibility()&&r.getOpacity()>0){let t=o[n[0].index];e.parent.map.crs!==e.parent.map.options.utmCrs&&(t=gS.Z.Util.reproject(t,e.map.options.utmCrs,e.map.crs)),e.elevationMarker.getElement().style.display="",e.olMap.getOverlayById(e.elevationMarker.getId())||(e.olMap.addOverlay(e.elevationMarker),e.map.on3DView&&e.map.view3D.addElevationMarker(t,e.parent)),e.elevationMarker.setPosition(t),e.map.on3DView&&e.map.view3D.setElevationMarker(t,e.parent)}},gS.Z.wrap.control.ResultsPanel.prototype.hideElevationMarker=function(){const t=this;t.elevationMarker&&(t.elevationMarker.getElement().style.display="none",t.map.on3DView&&t.map.view3D.hideElevationMarker(t.parent))},gS.Z.wrap.control.Coordinates.prototype.coordsActivate=function(){this.olMap.on(US,this._coordsTrigger)},gS.Z.wrap.control.Coordinates.prototype.coordsDeactivate=function(){this.olMap.un(US,this._coordsTrigger)},gS.Z.wrap.Parser=function(){},gS.Z.wrap.Parser.prototype.read=function(t){var e=[];return this.parser&&(e=this.parser.readFeatures(t).map((function(t){return new gS.Z.Feature(null,{id:t.getId(),data:t.getProperties()})}))),e},gS.Z.wrap.Parser.prototype.readFeatures=function(t){var e=[];return this.parser&&(e=this.parser.readFeatures(t).map((function(t){let e=t.getGeometry().getCoordinates();const n={};let r;switch(t.getGeometry().getType()){case"LineString":r=new gS.Z.feature.Polyline(e,n);break;case"Polygon":r=new gS.Z.feature.Polygon(e,n);break;case"MultiPoint":r=new gS.Z.feature.MultiPoint(e,n);break;case"MultiLineString":r=new gS.Z.feature.MultiPolyline(e,n);break;case"MultiPolygon":r=new gS.Z.feature.MultiPolygon(e,n);break;default:r=new gS.Z.feature.Point(e,n)}return r}))),e},gS.Z.wrap.parser={WFS:function(t){this.parser=new ol.format.WFS(t)},JSON:function(t){this.parser=new ol.format.GeoJSON(t)}},gS.Z.inherit(gS.Z.wrap.parser.WFS,gS.Z.wrap.Parser),gS.Z.inherit(gS.Z.wrap.parser.JSON,gS.Z.wrap.Parser),gS.Z.wrap.control.OverviewMap.prototype.register=function(t){var e=this;e.parent.layer.wrap.getLayer().then((function(n){e.ovMap=new ol.control.OverviewMap({target:e.parent.div,collapsed:!1,collapsible:!1,className:e.parent.CLASS+" ol-overviewmap",layers:[n]}),e.ovMap._wrap=e,e.ovMap.getOverviewMap().pixelRatio_=1,e.ovMap.ovmap_.removeOverlay(e.ovMap.boxOverlay_);var r=document.createElement("DIV");r.className="ol-overviewmap-box",r.style.boxSizing="border-box",e.ovMap.boxOverlay_=new ol.Overlay({position:[0,0],positioning:ol.OverlayPositioning.CENTER_CENTER,element:r}),e.ovMap.ovmap_.addOverlay(e.ovMap.boxOverlay_),e.manageSize.call(e.ovMap.ovmap_),e._boxElm=e.ovMap.boxOverlay_.getElement(),gS.Z.loadJS(!window.Draggabilly,[gS.Z.apiLocation+gS.Z.Consts.url.DRAGGABILLY],(function(){var n=e.ovMap.ovmap_;const r=new Draggabilly(e._boxElm);r.positionDrag=function(){const t=this.element.style,e="translate3d( "+this.dragPoint.x+"px, "+this.dragPoint.y+"px, 0)";if(t.transform.length){const n=t.transform.indexOf("translate3d");if(n>=0){const r=t.transform.indexOf(")",n);t.transform=t.transform.replace(t.transform.substring(n,r+1),e)}else t.transform=e+" "+t.transform}else t.transform=e},r.on("pointerDown",(function(o){if(r.dragged=e._boxElm.cloneNode(),r.dragged.classList.add(gS.Z.Consts.classes.ACTIVE),r.dragged.style.position="absolute",e._boxElm.insertAdjacentElement("beforebegin",r.dragged),t.maxExtent){var i=n.getPixelFromCoordinate([t.maxExtent[0],t.maxExtent[1]]),a=n.getPixelFromCoordinate([t.maxExtent[2],t.maxExtent[3]]),s=n.getSize();const e=document.createElement("div");e.style.position="absolute",e.style.bottom=Math.round(s[1]-i[1])+"px",e.style.left=Math.round(i[0])+"px",e.style.top=Math.round(a[1])+"px",e.style.right=Math.round(s[0]-a[0])+"px";const o=n.getViewport();o.insertBefore(e,o.firstElementChild),r.options.containment=e}})),r.on("pointerUp",(function(e){r.dragged.parentElement.removeChild(r.dragged),t.maxExtent&&(n.getViewport().removeChild(r.options.containment),r.options.containment=null)})),r.on("dragMove",(function(t,e,n){r._delta=n})),r.on("dragEnd",(function(o,i){var a=e.ovMap.getMap().getView(),s=n.getPixelFromCoordinate(a.getCenter()),l=n.getCoordinateFromPixel([s[0]+r._delta.x,s[1]+r._delta.y]),c=t.getExtent(),u=(c[2]-c[0])/2,p=(c[3]-c[1])/2;l[0]+u>t.maxExtent[2]?l[0]=t.maxExtent[2]-u:l[0]-u<t.maxExtent[0]&&(l[0]=t.maxExtent[0]+u),l[1]+p>t.maxExtent[3]?l[1]=t.maxExtent[3]-p:l[1]-p<t.maxExtent[1]&&(l[1]=t.maxExtent[1]+p),r.setPosition(0,0),delete r._delta,t.setCenter(l,{animate:!0})}))})),t.wrap.getMap().then((function(t){e.reset();const r=e.parent.div.querySelector("."+e.parent.CLASS+"-load");n._wrap.$events.on(gS.Z.Consts.event.BEFORETILELOAD,(function(){r.classList.remove(gS.Z.Consts.classes.HIDDEN),r.classList.add(gS.Z.Consts.classes.VISIBLE)})),n._wrap.$events.on(gS.Z.Consts.event.TILELOAD,(function(){r.classList.remove(gS.Z.Consts.classes.VISIBLE),r.classList.add(gS.Z.Consts.classes.HIDDEN)})),t.addControl(e.ovMap),e.parent.isLoaded=!0,e.parent.trigger(gS.Z.Consts.event.MAPLOAD)}))}))},gS.Z.wrap.control.OverviewMap.prototype.reset=function(t){const e=this;return new Promise((function(n,r){const o=function(t,r){if(t.type===gS.Z.Consts.layerType.WMTS){var o={crs:r||e.parent.map.crs,oldCrs:t.wrap.layer.getSource().getProjection().getCode()};o.oldCrs!==o.crs&&t.setProjection(o)}t.wrap.getLayer().then((function(r){var o=new ol.View(eb(e.parent.map.wrap,r._wrap.parent));if(o.getResolutions()?(o.setResolution(o.getResolutions().filter((function(t){return t>o.getResolutionForExtent(e.parent.map.getExtent(),a.getSize())})).reverse()[0]),a.setView(o)):o.getProjection().getCode()!==a.getView().getProjection().getCode()&&a.setView(o),r._wrap.$events.one(gS.Z.Consts.event.TILELOAD,(function(){a.getLayers().getArray()[0].getSource().refresh()})),t!==e.parent.layer||-1===a.getLayers().getArray().indexOf(t)){e.parent.map.trigger(gS.Z.Consts.event.OVERVIEWBASELAYERCHANGE,{oldLayer:t!==e.parent.layer?e.parent.layer:null,newLayer:t}),a.getLayers().forEach((function(t){(t instanceof ol.layer.Image||t instanceof ol.layer.Tile)&&a.removeLayer(t)}));const n=e.parent.div.querySelector("."+e.parent.CLASS+"-load");r._wrap.$events.on(gS.Z.Consts.event.BEFORETILELOAD,(function(){n.classList.remove(gS.Z.Consts.classes.HIDDEN),n.classList.add(gS.Z.Consts.classes.VISIBLE)})),r._wrap.$events.on(gS.Z.Consts.event.TILELOAD,(function(){n.classList.remove(gS.Z.Consts.classes.VISIBLE),n.classList.add(gS.Z.Consts.classes.HIDDEN)})),a.getLayers().insertAt(0,r)}n(t)}))};var i=(t=t||{}).layer||e.parent.layer;if(e.parent.map&&i&&e.ovMap){var a=e.ovMap.ovmap_;i.getCapabilitiesPromise().then((function(){var t=i;i.isCompatible(e.parent.map.crs)||0!==i.wrap.getCompatibleMatrixSets(e.parent.map.crs).length?o(i):(i=i.getFallbackLayer()||e.parent.defaultLayer).getCapabilitiesPromise().then((function(){e.parent.map.on3DView&&!i.isCompatible(e.parent.map.crs)?e.parent.map.loadProjections({crsList:t.getCompatibleCRS(),orderBy:"name"}).then((function(e){o(t,e[0].code)})):i.isCompatible(e.parent.map.crs)&&o(i)}))}))}}))},gS.Z.wrap.control.OverviewMap.prototype.get3DCameraLayer=function(){var t,e=null,n="3DCamera";if(this.ovMap&&((t=this.ovMap.getOverviewMap()).getLayers().forEach((function(t){t.get("id")===n&&(e=t)})),!e)){var r=_b({});r[0].getFill().setColor([0,0,0,0]),e=new ol.layer.Vector({id:n,source:new ol.source.Vector,style:r}),t.addLayer(e)}return e},gS.Z.wrap.control.OverviewMap.prototype.draw3DCamera=function(t){var e=this;if(this.parent.map.isLoaded){e.is3D=!!t;var n=e.get3DCameraLayer();if(n){var r,o=(t=t||{}).fov,i=n.getSource();if(o&&o.length){var a=i.getFeatures();a.length?r=a[0]:(r=new ol.Feature,i.addFeature(r)),r.setGeometry(new ol.geom.Polygon([o]))}else i.clear();var s="number"==typeof t.heading?t.heading:0;e._boxElm.style.transform="rotate("+s+"rad)"}}},gS.Z.wrap.control.OverviewMap.prototype.enable=function(){var t=this;if(t.parent.layer&&t.parent.layer.setVisibility){t.parent.layer.setVisibility(!0),t.parent.wrap.ovMap.ovmap_.updateSize();const e=document.createEvent("HTMLEvents");e.initEvent("resize",!1,!1),t.parent.map.div.dispatchEvent(e)}},gS.Z.wrap.control.OverviewMap.prototype.disable=function(){var t=this;t.parent.layer&&t.parent.layer.setVisibility&&t.parent.layer.setVisibility(!1)},gS.Z.wrap.control.OverviewMap.prototype.manageSize=function(){gS.Z.wrap.Map.prototype.manageSize.call(this)},gS.Z.wrap.control.FeatureInfo.prototype.register=function(t){var e=this;t.wrap.getMap().then((function(n){gS.Z.wrap.control.Click.prototype.register.call(e,t);var r=e._trigger;e._trigger=function(n){var o=r.call(e,n);return o?e.parent.beforeRequest({xy:n.pixel}):t.trigger(gS.Z.Consts.event.NOFEATUREINFO,{control:e.parent}),o}}))};var Ab=function(t){var e=t.innerHTML||t.textContent;return(Tb=Tb||document.createElement("textarea")).innerHTML=e,Tb.value},Ob={readFeatures:function(t){var e=[],n=(new DOMParser).parseFromString(t,"text/xml");if("FeatureInfoResponse"===n.documentElement.tagName)for(var r=n.documentElement.getElementsByTagName("FeatureInfoCollection"),o=0,i=r.length;o<i;o++)for(var a=r[o],s=a.getAttribute("layername"),l=a.getElementsByTagName("FeatureInfo"),c=0,u=l.length;c<u;c++){for(var p=l[c].getElementsByTagName("Field"),d={},h=0,f=p.length;h<f;h++){var m=p[h];d[Ab(m.getElementsByTagName("FieldName")[0])]=Ab(m.getElementsByTagName("FieldValue")[0])}var g=new ol.Feature(d);g.setId(s+"."+gS.Z.getUID()),e.push(g)}return e}},xb=function(t,e,n){var r=e.getPath(n);t.layers.push({name:n,title:r[r.length-1],path:r.slice(1),features:[],filter:e.filter})};gS.Z.wrap.control.FeatureInfo.prototype.getFeatureInfo=function(t,e,n){var r=this,o=n||{},i=r.parent.map;return new Promise((function(n,a){i.wrap.getMap().then((function(a){var s={},l={};const c=[],u=[];var p=[],d=[],h=a.getLayers().getArray();h=h.filter((function(t){return t instanceof ol.layer.Image&&t.getVisible()}));for(var f=0;f<h.length;f++){var m=h[f],g=m._wrap.parent;const t=m.getSource();if(t.getFeatureInfoUrl&&i.workLayers.indexOf(g)>=0&&g.names.length>0&&(!o.serviceUrl||o.serviceUrl===g.url)){let e;s[g.url]?(e=s[g.url],l[g.url].source.updateParams(gS.Z.Util.extend(l[g.url].source.getParams(),t.getParams()))):(e={url:g.url,layers:[],mapLayers:[],title:g.title,request:null},s[g.url]=e,l[g.url]={source:gS.Z.Util.extend(!0,{},t),layers:[]}),e.mapLayers.push(g);var y=g.getDisgregatedLayerNames();if(o.layerName)y.indexOf(o.layerName)>=0&&m._wrap.getInfo(o.layerName).queryable&&(xb(e,g,o.layerName),l[g.url].layers.push(o.layerName));else{for(var v=0;v<y.length;v++){var _=y[v];m._wrap.getInfo(_).queryable?xb(e,g,_):(gS.Z.Util.consoleRegister('Capa "'+y[v]+'" no queryable, la eliminamos de la petición GFI'),y.splice(v,1),v-=1)}y.length>0&&(l[g.url].layers=l[g.url].layers.concat(y))}}}const C=function(t){return t&&(/<ogc:Filter.*<\/ogc:Filter>/.test(t)||t instanceof gS.Z.filter.Filter)};for(var E in s){d.push(s[E]);const n=s[E],r=l[E].source,o=l[E].layers;if(!o||0===o.length)continue;var w=r.getParams();w.filter&&(w.filter=n.layers.map((function(t){return"("+(C(t.filter)?t.filter instanceof gS.Z.filter.Filter?t.filter.getText():t.filter:"")+")"})).join("")),w.cql_filter&&(w.cql_filter=n.layers.map((function(t){return!t.filter||C(t.filter)?"INCLUDE":t.filter})).join(";")),r.params_.LAYERS=o.join(",");var S=r.getFeatureInfoUrl(t,e,i.crs,{QUERY_LAYERS:o.join(","),INFO_FORMAT:w.INFO_FORMAT,FEATURE_COUNT:1e3,radius:i.options.pixelTolerance,buffer:i.options.pixelTolerance}),b=S=S.replace(/sld_body=[a-zA-Z%0-9._]*/);const a={serviceUrl:E,requestedFormat:w.INFO_FORMAT,expandUrl:b};u.push(a),c.push(new Promise((function(t,e){const r=n.mapLayers[0];r.toolProxification.fetch(S).then((function(e){r.toolProxification.cacheHost.getAction(a.expandUrl).then((function(n){a.originalUrl=n.action.call(r.toolProxification,a.expandUrl),t(gS.Z.Util.extend({},e,a))}))})).catch((function(t){e(Error(t))}))}))),gS.Z.Util.consoleRegister("Lanzamos GFI")}if(c.length>0)Promise.all(c).then((function(a){for(var l=!1,c=0,d=[],h=0;h<a.length;h++){var f,m=a[h],g=s[u[h].serviceUrl];l=!0,g.text=m.responseText;var y=m.contentType;if(y&&y.indexOf(";")>-1&&(y=y.substr(0,y.indexOf(";")).trim()),y||(y=m.requestedFormat),y===m.requestedFormat){switch(y){case"application/json":f=new ol.format.GeoJSON;break;case"application/vnd.ogc.gml":f=m.responseText.indexOf("FeatureCollection")>-1?new ol.format.WFS({gmlFormat:new ol.format.GML2({srsName:i.crs})}):new ol.format.WMSGetFeatureInfo;break;case"application/vnd.ogc.gml/3.1.1":f=new ol.format.GML3({srsName:i.crs});break;case"application/vnd.esri.wms_featureinfo_xml":f=Ob;break;default:f=null}if(f){var v;try{v=f.readFeatures(m.responseText,{featureProjection:ol.proj.get(i.crs)})}catch(t){gS.Z.error(r.parent.getLocaleString("featureInfo.error.badResponse",{url:m.serviceUrl})+": "+t.message),v=[];continue}c+=v.length;for(var _=function(t,e,n){var r=!1;if(e===n)r=!0;else{var o=t.getNodePath(e),i=t.getNodePath(n);if(o.length>0&&i.length>=o.length){r=!0;for(var a=0;a<o.length;a++)if(t.wrap.getName(o[a])!==t.wrap.getName(i[a])){r=!1;break}}}return r},C={},E=0;E<v.length;E++){var w=v[E];if(w instanceof ol.Feature){for(var S,b=w.getId()||gS.Z.getUID(),L=!1,T=b.substr(0,b.lastIndexOf(".")),P=0;P<g.layers.length;P++){var A=g.layers[P],O=A.name.substr(A.name.indexOf(":")+1);if(g.mapLayers.some((t=>_(t,O,T)))){L=!0,o.featureId&&w.getId()!==o.featureId||(p.push(gS.Z.wrap.Feature.createFeature(w,{showsPopup:!1})),d.push(A.features));break}}if(!L)C[T]?S=C[T]:(S={name:T,title:T,path:[T],features:[]},C[T]=S,g.layers.push(S)),o.featureId&&w.getId()!==o.featureId||(p.push(gS.Z.wrap.Feature.createFeature(w,{showsPopup:!1})),d.push(S.features))}}}else{const t={name:"layer"+gS.Z.getUID(),title:"Datos en el punto",features:[{rawUrl:m.originalUrl,expandUrl:m.expandUrl,rawContent:m.responseText,rawFormat:y}]};g.layers.push(t),c+=1}}else gS.Z.Util.consoleRegister("Respuesta GFI: lo más probable es que el servidor esté devolviendo una excepción"),gS.Z.Util.consoleRegister("Lanzamos los eventos que corresponde y mostramos tostada"),r.parent.responseError({message:m.responseText,status:m.status}),i.toast(r.parent.getLocaleString("featureInfo.error"),{type:gS.Z.Consts.msgType.ERROR})}l?Promise.all(p).then((function(o){var i;o.forEach((function(e,n){for(var o in e.attributes=[],e.data){var a=e.data[o];"object"!=typeof a?e.attributes.push({name:o,value:"number"==typeof a?a.toLocaleString(gS.Z.Util.getMapLocale(r.parent.map)):a}):e.attributes.push({name:o,value:a})}!i&&gS.Z.Geometry.isInside(t,e.geometry)&&(i=e);const s=d[n];s.some((t=>t.id===e.id))||s.push(e)}));var a=[];for(let t in s)Object.prototype.hasOwnProperty.call(s,t)&&a.push(s[t]);r.parent.responseCallback({coords:t,resolution:e,services:a,featureCount:c,defaultFeature:i}),n()})):n()}),(function(o,a,l){if(d&&0===d.length)for(let t in s)d.push(s[t]);r.parent.responseCallback({coords:t,resolution:e,services:d,featureCount:0}),i.toast(r.parent.getLocaleString("featureInfo.error"),{type:gS.Z.Consts.msgType.ERROR}),n()}));else{if(i.workLayers.filter((function(t){return t instanceof gS.Z.layer.Raster})).length>0&&i.toast(r.parent.getLocaleString("featureInfo.notQueryableLayers"),{type:gS.Z.Consts.msgType.INFO}),d&&0===d.length)for(let t in s)d.push(s[t]);i.on(gS.Z.Consts.event.BEFOREFEATUREINFO,(function(){r.parent.responseCallback({coords:t,resolution:e,services:d,featureCount:0})})),r.parent.responseCallback({coords:t,resolution:e,services:d,featureCount:0}),n()}}))}))},gS.Z.wrap.control.GeometryFeatureInfo.prototype.register=function(t){var e=this;t.wrap.getMap().then((function(n){gS.Z.wrap.control.Click.prototype.register.call(e,t);var r=e._trigger;e._trigger=function(t){e.hasSuitableLayers().then((function(n){n&&(e.parent._isSearching||t.type!==GS||e.parent._isDrawing||e.parent._isSearching||r.call(e,t))}))}}))},gS.Z.wrap.control.GeometryFeatureInfo.prototype.hasSuitableLayers=function(){const t=this;return new Promise((function(e,n){const r=t.parent.map;var o=!1;r.wrap.getMap().then((function(t){t.getLayers().forEach((function(t){var e=t._wrap.parent;if(t.getSource().getFeatureInfoUrl&&r.workLayers.indexOf(e)>=0)return o=!0,!1})),e(o)}))}))},gS.Z.wrap.control.GeometryFeatureInfo.prototype.beginDraw=function(t){var e=this,n=(t=t||{}).xy,r=t.layer||e.parent.filterLayer,o=t.callback,i=t.geometryType,a=!1;e.drawCtrl?(e.drawCtrl.setActive(!0),e.drawCtrl.startDrawing_(n)):r.wrap.getLayer().then((function(t){var r;if(i===gS.Z.Consts.geom.POLYLINE)r=ol.geom.GeometryType.LINE_STRING;else r=ol.geom.GeometryType.POLYGON;const s=t.getStyle();e.drawCtrl=new ol.interaction.Draw({source:t.getSource(),type:r,style:function(t){return t&&t.getGeometry().getType()===r?gS.Z.Util.isFunction(s)?s(t):s:null}});var l=function(t){t.parent.showsPopup=!1};t.getSource().on(qS,(function(t){const e=t.feature;e._wrap?l(e._wrap):gS.Z.wrap.Feature.createFeature(e).then((t=>l(t.wrap)))})),e.drawCtrl.handleEvent=function(t){if(t.type===GS){var e=r===ol.geom.GeometryType.POLYGON?this.sketchCoords_[0]:this.sketchCoords_;a&&2===e.length&&null!==this.sketchFeature_?this.addToDrawing_(t):a=!0}return ol.interaction.Draw.prototype.handleEvent.call(this,t)};const c=e.parent.map.wrap.map;c.addInteraction(e.drawCtrl),e.drawCtrl.on("drawstart",(function(t){e.parent._isDrawing=!0,c.getInteractions().forEach((function(t,e){t instanceof ol.interaction.DoubleClickZoom&&t.setActive(!1)}))})),e.drawCtrl.startDrawing_(n),e.drawCtrl.on("drawend",(function(n){e.parent._isDrawing=!1,c.getInteractions().forEach((function(t,e){t instanceof ol.interaction.DoubleClickZoom&&t.setActive(!1)})),c.removeInteraction(e.drawCtrl),this.setActive(!1),e.drawCtrl=null,t.getSource().clear(),e.parent._drawToken=!0,setTimeout((function(){e.parent._drawToken=!1}),500),n.feature.setId(e.parent.getUID()),gS.Z.wrap.Feature.createFeature(n.feature,{showsPopup:!1}).then((function(t){e.parent.filterFeature=t,t.layer=e.parent.filterLayer,o&&o(t)}))}))}))},gS.Z.wrap.control.GeometryFeatureInfo.prototype.cancelDraw=function(t,e,n){var r=this;r.drawCtrl&&r.parent._isDrawing&&(r.parent._isDrawing=!1,r.drawCtrl.setActive(!1),r.drawCtrl.source_.clear())};var Ib=function(t,e,n){var r,o=n;switch(o&&o.indexOf(";")>-1&&(o=o.substr(0,o.indexOf(";")).trim()),o||(o=e.requestedFormat),o){case"application/json":r=new ol.format.GeoJSON;break;case"application/vnd.ogc.gml":r=e.responseText.indexOf("FeatureCollection")>-1?new ol.format.WFS({gmlFormat:new ol.format.GML2({srsName:t.crs})}):new ol.format.WMSGetFeatureInfo;break;case"application/vnd.ogc.gml/3.1.1":r=new ol.format.GML3({srsName:t.crs});break;case"text/xml":case"application/xml":{const t=e.querySelector("ServiceException");t&&gS.Z.error(t),r=null;break}default:r=null}return r?r.readFeatures(e,{featureProjection:ol.proj.get(t.crs)}):null},Mb=function(t,e){for(var n=[],r=[],o=function(t,e,n){var r=!1;if(e===n||0===e.indexOf(n))r=!0;else{var o=t.getPath(e),i=t.getPath(n);if(o.length>0&&i.length>=o.length){r=!0;for(var a=0;a<o.length;a++)if(o[a]!==i[a]){r=!1;break}}}return r},i={},a=0;a<t.length;a++){var s=t[a];if(s instanceof ol.Feature){for(var l,c=s.getId()||gS.Z.getUID(),u=!1,p=c.substr(0,c.lastIndexOf(".")),d=0;d<e.layers.length;d++){var h=e.layers[d],f=h.name.substr(h.name.indexOf(":")+1);if(e.mapLayers.some((t=>o(t,f,p)))){u=!0,n.push(gS.Z.wrap.Feature.createFeature(s)),r[s.id_]=h.features;break}}if(!u)i[p]?l=i[p]:(l={name:p,title:p,features:[]},i[p]=l,e.layers.push(l)),n.push(gS.Z.wrap.Feature.createFeature(s)),r.push(s.id_)}}return new Promise((function(t,o){Promise.all(n).then((function(n){n.forEach((function(t){for(var e in t.attributes=[],t.data){var n=t.data[e];t.attributes.push({name:e,value:n})}r[t.id].push(t)})),t({service:e})}))}))};gS.Z.wrap.control.GeometryFeatureInfo.prototype.getFeaturesByGeometry=function(t,e){var n=this;return new Promise((function(r,o){var i=n.parent.map;i.wrap.getMap().then((function(o){var a=t.wrap.feature.getGeometry(),s=a.stride,l=a.getFlatCoordinates();if(!e){for(var c=null,u=1,p=l.length;u<p;u+=s)(!c||c[1]<l[u])&&(c=[l[u-1],l[u]]);e=o.getPixelFromCoordinate(new ol.geom.Point(c).getCoordinates())}n.parent.beforeRequest({xy:e});var d=i.extractFeatures({filter:new gS.Z.filter.intersects(t,i.crs),outputFormat:gS.Z.Consts.format.JSON});const h=[];Promise.all(d).then((function(t){for(var o=[],a=0,s=0;s<t.length;s++){const e=t[s];if(e){h.push(new Promise((function(t,r){if(e.errors&&e.errors.length){for(var o=0;o<e.errors.length;o++){var a,s=gS.Z.Consts.msgType.WARNING,l=e.errors[o];switch(l.key){case gS.Z.Consts.WFSErrors.MAX_NUM_FEATURES:a=n.parent.getLocaleString("wfs.tooManyFeatures",l.params);break;case gS.Z.Consts.WFSErrors.GETCAPABILITIES:a=n.parent.getLocaleString("wfsGFI.inValidService",l.params);break;case gS.Z.Consts.WFSErrors.NO_FEATURES:continue;case gS.Z.Consts.WFSErrors.INDETERMINATE:a=n.parent.getLocaleString("wfs.IndeterminateError"),gS.Z.error("Error:{error} \r\n Descripcion:{descripcion} \r\n Servicio:{serviceName}".format({error:l.params.err,descripcion:l.params.errorThrown,serviceName:l.params.serviceTitle}),gS.Z.Consts.msgErrorMode.CONSOLE),s=gS.Z.Consts.msgType.ERROR;break;default:a=n.parent.getLocaleString("wfsGFI."+l.key,l.params)}i.toast(a,{type:s})}e.response||t()}})));var l=e.response?Ib(i,e.response.responseText,e.response.contentType):[];h[h.length-1]=Mb(l,e.service),e.service&&o.push(e.service),a+=l.length}}Promise.all(h).then((function(){n.parent.responseCallback({xy:e||null,services:o,featureCount:a}),r()}))}),(function(t){n.parent.responseCallback({}),r()}))}))}))},gS.Z.wrap.control.Popup.prototype=function(){this.popup=null},gS.Z.Consts.event.PANANIMATIONSTART="pananimationstart.tc",gS.Z.Consts.event.PANANIMATIONEND="pananimationend.tc",gS.Z.wrap.control.Popup.prototype.fitToView=function(){var t=this,e=t.parent.map,n=t.parent.map.wrap.map,r=t.parent.popupDiv.getBoundingClientRect(),o=e.div.getBoundingClientRect(),i=n.getCoordinateFromPixel([r.left-o.left,r.top-o.top]),a=n.getCoordinateFromPixel([r.right-o.left,r.bottom-o.top]),s=i[0],l=i[1],c=a[0],u=[s,a[1],c,l],p=e.getExtent();if(!ol.extent.containsExtent(p,u)){var d={left:Math.max(p[0]-u[0],0),bottom:Math.max(p[1]-u[1],0),right:Math.max(u[2]-p[2],0),top:Math.max(u[3]-p[3],0)};if(t.parent.dragged){var h=t.popup.getPosition();d.right?h[0]=h[0]-d.right:d.left&&(h[0]=h[0]+d.left),d.top?h[1]=h[1]-d.top:d.bottom&&(h[1]=h[1]+d.bottom);var f=n.getPixelFromCoordinate(h);f[1]=n.getSize()[1]-f[1],t.parent._previousContainerPosition=f,(t.popup._oldUpdatePixelPosition||t.popup.updatePixelPosition).call(t.popup,h)}else if(t.parent.isVisible()){var m=n.getView(),g=m.getCenter().slice();d.top?g[1]+=d.top:d.bottom&&(g[1]-=d.bottom),d.right?g[0]+=d.right:d.left&&(g[0]-=d.left),m.animate({center:g,easing:function(e){return 0===e&&t.parent.map.trigger(gS.Z.Consts.event.PANANIMATIONSTART),1===e&&t.parent.map.trigger(gS.Z.Consts.event.PANANIMATIONEND),e}})}}},gS.Z.wrap.control.Popup.prototype.setDragged=function(t){const e=this;var n=e.popup;if(t)n._oldUpdatePixelPosition||(n._oldUpdatePixelPosition=n.updatePixelPosition,n.updatePixelPosition=function(){}),n._newHandleOffsetChanged||(n._newHandleOffsetChanged=function(){n._oldUpdatePixelPosition()},e._offsetChangeListenerKey&&ol.events.unlistenByKey(e._offsetChangeListenerKey),e._offsetChangeListenerKey=ol.events.listen(n,"change:offset",n._newHandleOffsetChanged,n));else{const t=n.getElement().parentElement.style;t.setProperty("top",n.rendered.top_),t.setProperty("bottom",n.rendered.bottom_),t.setProperty("left",n.rendered.left_),t.setProperty("right",n.rendered.right_),delete e.parent._previousContainerPosition,n._oldUpdatePixelPosition&&(n.updatePixelPosition=n._oldUpdatePixelPosition,delete n._oldUpdatePixelPosition),n._newHandleOffsetChanged&&(e._offsetChangeListenerKey&&ol.events.unlistenByKey(e._offsetChangeListenerKey),e._offsetChangeListenerKey=ol.events.listen(n,"change:offset",n.handleOffsetChanged,n),delete n._newHandleOffsetChanged)}},gS.Z.wrap.Feature.prototype.getLegend=function(){var t=this,e={},n=kb(t.feature,!0);if(n){var r=n.getImage();if(r){if(r instanceof ol.style.Icon){e.src=r.getSrc();var o=r.getScale(),i=r.getImage();o?i.width?(e.width=i.width*o,e.height=i.height*o):e.scale=o:i.width&&(e.width=i.width,e.height=i.height)}else r instanceof ol.style.Circle&&(e.src=r.getImage().toDataURL());t.parent.options.radius?e.height=e.width=2*t.parent.options.radius:(e.width=e.width||t.parent.options.width,e.height=e.height||t.parent.options.height)}else{let r;switch(t.feature.getGeometry().getType()){case ol.geom.GeometryType.MULTI_POLYGON:case ol.geom.GeometryType.POLYGON:r=gS.Z.Consts.geom.POLYGON;break;case ol.geom.GeometryType.MULTI_LINE_STRING:case ol.geom.GeometryType.LINE_STRING:r=gS.Z.Consts.geom.POLYLINE;break;default:r=gS.Z.Consts.geom.POINT}e.src=gS.Z.Util.getLegendImageFromStyle(Sb(n),{geometryType:r})}}return e};const Rb=function(t,e){const n=this;n.feature=new ol.Feature,n.parent.id&&n.feature.setId(n.parent.id),e.geometryName&&n.feature.setGeometryName(e.geometryName),n.feature._wrap=n,n.parent.setCoords(t),n.parent.setData(n.parent.data)};gS.Z.wrap.Feature.prototype.createPoint=function(t,e){const n=this;Rb.call(n,t,e=e||{}),gS.Z.Util.hasStyleOptions(e)&&n.feature.setStyle(_b({styles:{point:e}},n.feature))},gS.Z.wrap.Feature.prototype.createMultiPoint=function(t,e){const n=this;Rb.call(n,t,e=e||{}),gS.Z.Util.hasStyleOptions(e)&&n.feature.setStyle(_b({styles:{point:e}},n.feature))},gS.Z.wrap.Feature.prototype.createMarker=function(t,e){const n=this;e=e||{};var r=gS.Z.Util.getPointIconUrl(e);r?(e.url=r,Rb.call(n,t,e),gS.Z.Util.hasStyleOptions(e)&&n.feature.setStyle(_b({styles:{marker:e}},n.feature))):n.createPoint(t,e)},gS.Z.wrap.Feature.prototype.createMultiMarker=function(t,e){const n=this;e=e||{};var r=gS.Z.Util.getPointIconUrl(e);r?(e.url=r,Rb.call(n,t,e),gS.Z.Util.hasStyleOptions(e)&&n.feature.setStyle(_b({styles:{marker:e}},n.feature))):n.createMultiPoint(t,e)},gS.Z.wrap.Feature.prototype.createPolyline=function(t,e){const n=this;Rb.call(n,t,e=e||{}),gS.Z.Util.hasStyleOptions(e)&&n.feature.setStyle(_b({styles:{line:e}},n.feature))},gS.Z.wrap.Feature.prototype.createPolygon=function(t,e){const n=this;Rb.call(n,t,e=e||{}),gS.Z.Util.hasStyleOptions(e)&&n.feature.setStyle(_b({styles:{polygon:e}},n.feature))},gS.Z.wrap.Feature.prototype.createMultiPolyline=function(t,e){const n=this;Rb.call(n,t,e=e||{}),gS.Z.Util.hasStyleOptions(e)&&n.feature.setStyle(_b({styles:{line:e}},n.feature))},gS.Z.wrap.Feature.prototype.createMultiPolygon=function(t,e){const n=this;Rb.call(n,t,e=e||{}),gS.Z.Util.hasStyleOptions(e)&&n.feature.setStyle(_b({styles:{polygon:e}},n.feature))},gS.Z.wrap.Feature.prototype.createCircle=function(t,e){const n=this;Rb.call(n,t,e=e||{}),e&&n.feature.setStyle(new ol.style.Style({stroke:new ol.style.Stroke({color:e.strokeColor,width:e.strokeWidth,lineDash:e.lineDash}),fill:new ol.style.Fill({color:tb(e.fillColor,e.fillOpacity)})}))},gS.Z.wrap.Feature.createFeature=function(t,e){return t._featurePromise||(t._featurePromise=new Promise((function(n,r){var o=t.getGeometry();(e=e||{}).id=t.getId();let i,a,s=t.getStyle();switch(s&&gS.Z.Util.extend(e,Sb(s,t)),!0){case o instanceof ol.geom.Point:case o instanceof ol.geom.MultiPoint:gS.Z.Util.isFunction(s)&&(s=s(t));for(var l=s?Array.isArray(s)?s:[s]:[],c=0,u=l.length;c<u;c++)if(s=l[c],s.getImage()instanceof ol.style.Icon){i="Marker";break}i=i||"Point",o instanceof ol.geom.MultiPoint&&("Point"===i&&(i="MultiPoint"),"Marker"===i&&(i="MultiMarker"));break;case o instanceof ol.geom.LineString:i="Polyline";break;case o instanceof ol.geom.Polygon:i="Polygon";break;case o instanceof ol.geom.MultiLineString:i="MultiPolyline";break;case o instanceof ol.geom.MultiPolygon:i="MultiPolygon"}a=i?new gS.Z.feature[i](t,e):new gS.Z.Feature(t,e),a.data=a.wrap.getData(),n(a)}))),t._featurePromise},gS.Z.wrap.Feature.prototype.cloneFeature=function(){return this.feature.clone()},gS.Z.wrap.Feature.prototype.getStyle=function(){var t=this,e={},n=t.feature.getStyle();gS.Z.Util.isFunction(n)&&(n=n(t.feature));var r=n?Array.isArray(n)?n:[n]:[];const o=function(t,e){if(t){const n=t.getFill();n&&(e.fillColor=n.getColor(),Array.isArray(e.fillColor)&&(e.fillOpacity=e.fillColor[3]))}},i=function(t,e){if(t){const n=t.getStroke();n&&(e.strokeColor=n.getColor(),e.strokeWidth=n.getWidth())}};for(var a=0,s=r.length;a<s;a++){o(n=r[a],e),i(n,e);const t=n.getImage();if(t instanceof ol.style.Icon){e.url=t.getSrc();const n=t.getSize(),r=t.getScale()||1;n&&(e.width=n[0]*r,e.height=n[1]*r);const o=t.getRotation();o&&(e.rotation=180*o/Math.PI);var l=t.getAnchor();l&&(e.anchor=[l[0]*r,l[1]*r],n&&(e.anchor[0]=e.anchor[0]/e.width,e.anchor[1]=e.anchor[1]/e.height))}else o(t,e),i(t,e);var c=n.getText();if(c){e.label=c.getText();var u=c.getFont();u&&(e.fontSize=parseInt(u.match(/\d+pt/))||.75*parseInt(u.match(/\d+px/)),e.font=u);var p=c.getRotation();p&&(e.angle=-180*p/Math.PI);var d=c.getScale();d&&(e.textScale=d);var h=c.getTextAlign();h&&(e.textAlign=h),e.labelOffset=[c.getOffsetX(),c.getOffsetY()];var f=c.getFill();f&&(e.fontColor=f.getColor());var m=c.getStroke();m&&(e.labelOutlineColor=m.getColor(),e.labelOutlineWidth=m.getWidth())}n._balloon&&n._balloon.getText()&&(e.balloon=n._balloon.getText())}return gS.Z.Util.extend(t.parent.options,e),e},gS.Z.wrap.Feature.prototype.getGeometry=function(){var t,e=this;if(e.feature&&e.feature.getGeometry){var n=e.feature.getGeometry();n&&(n.getCoordinates?t=n.getCoordinates():n instanceof ol.geom.Circle&&(t=[n.getCenter(),n.getRadius()]))}return t},gS.Z.wrap.Feature.prototype.setGeometry=function(t){const e=this;if(e.feature&&e.feature.getGeometry){var n,r,o,i,a,s,l,c,u=e.feature.getGeometry();switch(!0){case gS.Z.feature.MultiPolygon&&e.parent instanceof gS.Z.feature.MultiPolygon:s=!0,n=ol.geom.MultiPolygon,a=t,Array.isArray(a)&&(i=t[0]);case gS.Z.feature.Polygon&&e.parent instanceof gS.Z.feature.Polygon||gS.Z.feature.MultiPolyline&&e.parent instanceof gS.Z.feature.MultiPolyline:l=!0,n=n||(gS.Z.feature.Polygon&&e.parent instanceof gS.Z.feature.Polygon?ol.geom.Polygon:ol.geom.MultiLineString),i=s?i:t,Array.isArray(i)&&(o=i[0]);case gS.Z.feature.Polyline&&e.parent instanceof gS.Z.feature.Polyline||gS.Z.feature.MultiPoint&&e.parent instanceof gS.Z.feature.MultiPoint:c=!0,n=n||(gS.Z.feature.Polyline&&e.parent instanceof gS.Z.feature.Polyline?ol.geom.LineString:ol.geom.MultiPoint),o=l?o:t,Array.isArray(o)&&(r=o[0]);case gS.Z.feature.Point&&e.parent instanceof gS.Z.feature.Point:if(n=n||ol.geom.Point,r=c?r:t,Array.isArray(r)&&"number"==typeof r[0]&&"number"==typeof r[1]){let o;switch(r.length){case 3:o=ol.geom.GeometryLayout.XYZ;break;case 4:o=ol.geom.GeometryLayout.XYZM;break;default:o=ol.geom.GeometryLayout.XY}u?u.setCoordinates(t,o):(u=new n(t,o),e.feature.setGeometry(u))}break;case gS.Z.feature.Circle&&e.parent instanceof gS.Z.feature.Circle:if(Array.isArray(t)&&Array.isArray(t[0])&&"number"==typeof t[0][0]&&"number"==typeof t[0][1]&&"number"==typeof t[1]){let n;switch(t[0].length){case 3:n=ol.geom.GeometryLayout.XYZ;break;case 4:n=ol.geom.GeometryLayout.XYZM;break;default:n=ol.geom.GeometryLayout.XY}u?u.setCenterAndRadius(t[0],t[1],n):(u=new ol.geom.Circle(t[0],t[1],n),e.feature.setGeometry(u))}}}},gS.Z.wrap.Feature.prototype.getId=function(){var t;return this.feature&&(t=this.feature.getId()),t},gS.Z.wrap.Feature.prototype.setId=function(t){this.feature&&this.feature.setId(t)};const Zb=function(t,e){const n=this;var r=0;return t.getLinearRings().forEach((function(t){let o=t.getCoordinates();e.crs&&(o=gS.Z.Util.reproject(o,n.parent.layer.map.crs,e.crs));const i=new ol.geom.Polygon([o]).getLinearRing(0);r+=ol.geom.flat.linearRingLength(i.flatCoordinates,0,i.flatCoordinates.length,i.stride)})),r},Db=function(t,e){const n=this;let r=t.getCoordinates();e.crs&&(r=gS.Z.Util.reproject(r,n.parent.layer.map.crs,e.crs));return new ol.geom.LineString(r).getLength()};gS.Z.wrap.Feature.prototype.getLength=function(t){const e=this;t=t||{};var n=0;const r=e.feature.getGeometry();switch(!0){case r instanceof ol.geom.Polygon:n=Zb.call(e,r,t);break;case r instanceof ol.geom.LineString:n=Db.call(e,r,t);break;case r instanceof ol.geom.MultiPolygon:r.getPolygons().forEach((function(r){n+=Zb.call(e,r,t)}));break;case r instanceof ol.geom.MultiLineString:r.getLineStrings().forEach((function(r){n+=Db.call(e,r,t)}))}return n},gS.Z.wrap.Feature.prototype.getArea=function(t){const e=this;t=t||{};const n=e.feature.getGeometry();var r;if(n instanceof ol.geom.Polygon){r=n.getLinearRing(0).getCoordinates(),t.crs&&(r=gS.Z.Util.reproject(r,e.parent.layer.map.crs,t.crs));return new ol.geom.Polygon([r]).getArea()}};const kb=function(t,e){var n=t.getStyle();return gS.Z.Util.isFunction(n)&&(n=n(t)),Array.isArray(n)&&(n=n.reduce((function(t,e){return t.fill_=e.fill_||t.fill_,t.image_=e.image_||t.image_,t.stroke_=e.stroke_||t.stroke_,t.text_=e.text_||t.text_,t}),new ol.style.Style)),n||e||(n=new ol.style.Style,t.setStyle(n)),n},Nb=function(t){var e=this.getStyle();return gS.Z.Util.isFunction(e)&&(e=e(t)),Array.isArray(e)&&(e=e[e.length-1]),e||(e=new ol.style.Style),e};gS.Z.wrap.Feature.prototype.setStyle=function(t){const e=this.feature;if(null===t)return void e.setStyle(null);const n=this.parent,r=e.getGeometry();let o,i=e.getStyle();n.layer&&(o=Nb.call(n.layer.wrap.layer,n.wrap.feature)),i||(i=o?o.clone():new ol.style.Style),gS.Z.Util.isFunction(i)&&(i=i(e)),Array.isArray(i)||(i=[i]);let a=i[i.length-1];if(r instanceof ol.geom.Point||r instanceof ol.geom.MultiPoint){var s;if(t.anchor||t.url||t.cssClass){s=a.getImage();const e={};if(s instanceof ol.style.Icon){if(e.src=t.url||gS.Z.Util.getBackgroundUrlFromCss(t.cssClass)||s.getSrc(),t.width&&t.height?e.size=[yb(t.width,n),yb(t.height,n)]:e.size=s.getSize(),e.anchor=yb(t.anchor,n),!e.anchor){const t=s.getAnchor();Array.isArray(t)&&(e.anchor=t.map((function(t,n){return t/e.size[n]})))}}else e.src=gS.Z.Util.getPointIconUrl(t),e.anchor=yb(t.anchor,n),e.size=[yb(t.width,n),yb(t.height,n)];t.angle&&(e.angle=t.angle),s=new ol.style.Icon(e)}else if(!a.getImage()&&a.getText())void 0!==t.label&&t.label.length?a.setText(Cb(t,n)):a.setText();else{(s=a.getImage())||(s=new ol.style.Circle);const e={radius:yb(t.radius,n)||(yb(t.height,n)+yb(t.width,n))/4};if(isNaN(e.radius)&&s.getRadius&&(e.radius=s.getRadius()),s.getFill){const r=s.getFill(),o=r.getColor(),i=Array.isArray(o)?o[3]:1;r.setColor(tb(yb(t.fillColor||o,n),yb(t.fillOpacity||i,n))),e.fill=r}e.stroke=s.getStroke?s.getStroke():new ol.style.Stroke;const r=o&&o.getStroke();if(t.strokeColor||t.strokeWidth){if(e.stroke||(e.stroke=new ol.style.Stroke),t.strokeColor)e.stroke.setColor(yb(t.strokeColor,n));else{const t=e.stroke.getColor()||r&&r.getColor()||gS.Z.Cfg.styles.point.strokeColor;e.stroke.setColor(yb(t,n))}if(t.strokeWidth)e.stroke.setWidth(yb(t.strokeWidth,n));else{const t=e.stroke.getWidth()||r&&r.getWidth()||gS.Z.Cfg.styles.point.strokeWidth;e.stroke.setWidth(yb(t,n))}}s=new ol.style.Circle(e)}a.setImage(s)}else{var l=a.getStroke(),c=!1;if(l||(l=new ol.style.Stroke),t.strokeColor&&(l.setColor(yb(t.strokeColor,n)),c=!0),t.strokeWidth&&(l.setWidth(yb(t.strokeWidth,n)),c=!0),t.lineDash&&(l.setLineDash(t.lineDash),c=!0),c&&a.setStroke(l),(r instanceof ol.geom.Polygon||r instanceof ol.geom.MultiPolygon)&&(t.fillColor||t.fillOpacity)){var u=a.getFill()||new ol.style.Fill;const e=u.getColor(),r=Array.isArray(e)?e[3]:1;u.setColor(tb(yb(t.fillColor||e,n),yb(t.fillOpacity||r,n))),a.setFill(u)}}void 0!==t.label&&(t.label.length?a.setText(Cb(t,n)):a.setText()),e.setStyle(i),e.changed()},gS.Z.wrap.Feature.prototype.toggleSelectedStyle=function(t){const e=this.feature;(void 0===t?!e._originalStyle:t)?jb(e):Wb(e)},gS.Z.wrap.Feature.prototype.getInnerPoint=function(t){var e,n=t||{},r=this.feature.getGeometry();let o,i=!1;switch(e=r.getFirstCoordinate(),r.getType()){case ol.geom.GeometryType.MULTI_POLYGON:n.clipBox&&(r=new ol.geom.MultiPolygon(r.getPolygons().map((t=>gS.Z.Geometry.clipPolygon(t.getCoordinates(),n.clipBox))).filter((t=>t.length))),i=!0);var a=0;r=r.getPolygons().reduce((function(t,e){const n=e.getArea(),r=n>a?e:t;return a=n,r}));case ol.geom.GeometryType.POLYGON:o=r.getCoordinates(),n.clipBox&&!i&&(o=gS.Z.Geometry.clipPolygon(o,n.clipBox)),e=(r=new ol.geom.Polygon(o)).getInteriorPoint().getCoordinates();for(var s=r.getLinearRings(),l=1;l<s.length;l++)if(gS.Z.Geometry.isInside(e,s[l].getCoordinates())){e=r.getClosestPoint(e);break}break;case ol.geom.GeometryType.MULTI_LINE_STRING:n.clipBox&&(r=new ol.geom.MultiLineString(r.getLineStrings().map((t=>gS.Z.Geometry.clipPolyline(t.getCoordinates(),n.clipBox))).filter((t=>t.length))),i=!0);var c=0;r=r.getLineStrings().reduce((function(t,e){const n=e.getLength(),r=n>c?e:t;return c=n,r}));case ol.geom.GeometryType.LINE_STRING:var u=[0,0];o=r.getCoordinates(),n.clipBox&&!i&&(o=gS.Z.Geometry.clipPolyline(o,n.clipBox)),r=new ol.geom.LineString(o);for(l=0;l<o.length;l++)u[0]+=o[l][0],u[1]+=o[l][1];u[0]/=o.length,u[1]/=o.length,e=r.getClosestPoint(u)}return e},gS.Z.wrap.Feature.prototype.showPopup=function(t){const e=this,n=(t=t||{})&&t instanceof gS.Z.Control?t:t.control;var r=n.map;if(r){var o=e.feature;if(o){r.currentFeature=e.parent;var i=r.getExtent();e._innerCentroid=e.getInnerPoint({clipBox:i}),n.contentDiv.innerHTML=t.html||e.parent.getInfo({locale:r.options.locale});var a,s=e.parent.options;if(gS.Z.Util.isEmptyObject(s)&&e.parent.layer&&e.parent.layer.options&&e.parent.layer.options.styles)switch(e.parent.CLASSNAME){case"TC.feature.Point":(s=e.parent.layer.options.styles.point)&&!gS.Z.Util.isEmptyObject(s)||(s=e.parent.layer.options.styles.marker);break;case"TC.feature.Marker":s=e.parent.layer.options.styles.marker;break;case"TC.feature.Circle":s=e.parent.layer.options.styles.circle;break;case"TC.feature.MultiPolygon":case"TC.feature.Polygon":s=e.parent.layer.options.styles.polygon;break;case"TC.feature.MultiPolyline":case"TC.feature.Polyline":s=e.parent.layer.options.styles.line}if(s.anchor)a=yb(s.anchor,e.parent);else{for(var l,c=o._wrap.parent,u=0;u<r.workLayers.length;u++){var p=r.workLayers[u];if(!p.isRaster()&&p.features.indexOf(c)>=0){l=p.wrap.styleFunction(o);break}}if(Array.isArray(l)){const t=l[0].getImage();a=!t||t instanceof ol.style.Icon?[.5,0]:[.5,.5]}}const h=[0,0];if(a)if(s.height)h[1]=-(yb(s.height,e.parent)||0)*a[1];else{var d=kb(o,!0);if(d){const t=d.getImage();if(t instanceof ol.style.Icon){const e=t.getImageSize();e&&(h[1]=e[1]*-t.getScale())}}}n.wrap.setDragged(!1),n.wrap.popup.setOffset(h),n.wrap.popup.setPosition(e._innerCentroid),n.popupDiv.classList.add(gS.Z.Consts.classes.VISIBLE)}else r.wrap.hidePopup(n)}},gS.Z.wrap.Feature.prototype.isNative=function(t){return t instanceof ol.Feature},gS.Z.wrap.Feature.prototype.getPath=function(){var t=[],e=this;return e.feature&&e.feature._folders&&(t=e.feature._folders),t},gS.Z.wrap.Feature.prototype.getBounds=function(){var t=null;if(this.feature){const e=this.feature.getGeometry();if(!e)return null;t=e.getExtent()}return t},gS.Z.wrap.Feature.prototype.getTemplate=function(){var t=null,e=this.feature.getStyle();return gS.Z.Util.isFunction(e)&&(e=e(this.feature)),e&&(e=Array.isArray(e)?e.find((t=>t._balloon)):e)&&e._balloon&&(t=e._balloon.getText()),t},gS.Z.wrap.Feature.prototype.getData=function(){var t=this.feature.getProperties();Array.isArray(t.features)&&(t=1===t.features.length?t.features[0].getProperties():t.features.length+" elementos");var e=this.feature.getGeometryName();for(var n in t[e]&&delete t[e],t)if(t[n]&&t[n].getType)switch(t[n].getType()){case ol.geom.GeometryType.POINT:case ol.geom.GeometryType.MULTI_POINT:case ol.geom.GeometryType.POLYGON:case ol.geom.GeometryType.MULTI_POLYGON:case ol.geom.GeometryType.LINE_STRING:case ol.geom.GeometryType.MULTI_LINE_STRING:t[n]=t[n].getCoordinates()}return t},gS.Z.wrap.Feature.prototype.setData=function(t){this.feature.setProperties(t)},gS.Z.wrap.Feature.prototype.unsetData=function(t){this.feature.unset(t)},gS.Z.wrap.Feature.prototype.clearData=function(){const t=this.feature,e=t.getGeometryName();t.getKeys().forEach((function(n){n!==e&&t.unset(n)}))},gS.Z.wrap.control.Draw.prototype.mouseMoveHandler=function(t){const e=this;e.sketch&&e.parent.trigger(gS.Z.Consts.event.MEASUREPARTIAL,e.getMeasureData())},gS.Z.wrap.control.Draw.prototype.mouseOverHandler=function(t){const e=this;e.sketch&&e.hoverCoordinate&&(e.pushCoordinate(e.hoverCoordinate),e.hoverCoordinate=null)},gS.Z.wrap.control.Draw.prototype.clickHandler=function(t){const e=this;if(e.parent.map.view!==gS.Z.Consts.view.PRINTING){if(e._mdPx){const n=e._mdPx[0]-t.clientX,r=e._mdPx[1]-t.clientY;if(n*n+r*r>e.interaction.squaredClickTolerance_)return}if(e.sketch){var n=e.sketch.getGeometry().getCoordinates();e.parent.trigger(gS.Z.Consts.event.POINT,{point:n[n.length-1]})}}},gS.Z.wrap.control.Draw.prototype.pointerdownHandler=function(t){this._mdPx=[t.clientX,t.clientY]},gS.Z.wrap.control.Draw.prototype.getMeasureData=function(){var t,e,n=this,r={units:ol.proj.Units.METERS};if(this.sketch){var o=this.sketch.getGeometry();o instanceof ol.geom.Polygon?function(t,e){t=new ol.geom.Polygon([gS.Z.Util.reproject(t.getLinearRing(0).getCoordinates(),n.parent.map.crs,n.parent.map.options.utmCrs)]),e.area=t.getArea();var r=t.getLinearRing(0);e.perimeter=ol.geom.flat.linearRingLength(r.flatCoordinates,0,r.flatCoordinates.length,r.stride)}(o,r):o instanceof ol.geom.LineString&&(t=o,e=r,t=new ol.geom.LineString(gS.Z.Util.reproject(t.getCoordinates(),n.parent.map.crs,n.parent.map.options.utmCrs)),e.length=t.getLength())}return r};const Fb=(t,e)=>{const n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]};gS.Z.wrap.control.Draw.prototype.activate=function(t){var e,n=this;switch(t){case gS.Z.Consts.geom.POLYGON:e=ol.geom.GeometryType.POLYGON;break;case gS.Z.Consts.geom.MULTIPOLYGON:e=ol.geom.GeometryType.MULTI_POLYGON;break;case gS.Z.Consts.geom.POINT:e=ol.geom.GeometryType.POINT;break;case gS.Z.Consts.geom.MULTIPOINT:e=ol.geom.GeometryType.MULTI_POINT;break;case gS.Z.Consts.geom.MULTIPOLYLINE:e=ol.geom.GeometryType.MULTI_LINE_STRING;break;default:e=ol.geom.GeometryType.LINE_STRING}n.parent.map&&Promise.all([n.parent.map.wrap.getMap(),n.parent.getLayer()]).then((function(r){const o=r[0],i=r[1];i&&i.wrap.getLayer().then((function(r){if(n.viewport||(n.viewport=o.getViewport()),n.interaction&&(o.removeInteraction(n.interaction),n._pointerdownHandler&&(n.viewport.removeEventListener("pointerdown",n._pointerdownHandler),n._pointerdownHandler=null),n._clickHandler&&(n.viewport.removeEventListener("click",n._clickHandler),n._clickHandler=null),n._mouseMoveHandler&&n._mouseOverHandler&&(n.viewport.removeEventListener(RS,n._mouseMoveHandler),n.viewport.removeEventListener(ZS,n._mouseOverHandler))),n.snapInteraction&&o.removeInteraction(n.snapInteraction),t){n._pointerdownHandler=n.pointerdownHandler.bind(n),n._clickHandler=n.clickHandler.bind(n),n.viewport.addEventListener("pointerdown",n._pointerdownHandler),n.viewport.addEventListener("click",n._clickHandler),n.parent.measure&&(n._mouseMoveHandler=n.mouseMoveHandler.bind(n),n._mouseOverHandler=n.mouseOverHandler.bind(n),n.viewport.addEventListener(RS,n._mouseMoveHandler),n.viewport.addEventListener(ZS,n._mouseOverHandler));var i={type:e,snapTolerance:0,condition:function(){if(ol.events.condition.shiftKeyOnly(arguments[0])){o.forEachFeatureAtPixel(o.getPixelFromCoordinate(arguments[0].coordinate),(function(t){return ol.geom.GeometryType.POLYGON===t.getGeometry().getType()||ol.geom.GeometryType.MULTI_POLYGON===t.getGeometry().getType()?t:null}),{hitTolerance:zS})}return n.parent.map.view!==gS.Z.Consts.view.PRINTING||null}};if(r&&(i.source=r.getSource()),t===gS.Z.Consts.geom.RECTANGLE&&(i.type=ol.geom.GeometryType.LINE_STRING,i.maxPoints=2,i.geometryFunction=function(t,e){const n=t[0],r=t[1],o=[[n,[n[0],r[1]],r,[r[0],n[1]],n]];return e?e.setCoordinates(o):e=new ol.geom.Polygon(o),e}),n.interaction=new ol.interaction.Draw(i),n.setStyle(),n.interaction.on("drawstart",(function(t){let e;if(n.sketch=t.feature,n.parent.options.extensible&&!n._extending&&(n.parent.mode===gS.Z.Consts.geom.POLYLINE||n.parent.mode===gS.Z.Consts.geom.MULTIPOLYLINE)){const r=t.feature.getGeometry().getCoordinates()[0];if(e=n.parent.layer.features.find((t=>Fb(r,t.getCoordinates()))),e){n.interaction.abortDrawing(),n._extending=!0;const t=e.wrap.feature;e.layer.removeFeature(e),n.interaction.extend(t)}}n.parent.trigger(gS.Z.Consts.event.DRAWSTART,{feature:e})}),this),n.interaction.on("drawend",(function(t){delete n._extending;const e=t.target.overlay_.getStyle();t.feature.getStyle()||t.feature.setStyle(Array.isArray(e)?e.map((function(t){return t.clone()})):e),n.parent.measure&&n.parent.trigger(gS.Z.Consts.event.MEASURE,n.getMeasureData()),gS.Z.wrap.Feature.createFeature(n.sketch).then((function(t){const e=function(){n.parent.trigger(gS.Z.Consts.event.DRAWEND,{feature:t}),n.sketch=null,n.interaction.setActive(!0)};if(n.parent.mode===gS.Z.Consts.geom.RECTANGLE){const t=400,r=n.interaction.getMap().getInteractions().getArray().filter((t=>t instanceof ol.interaction.DoubleClickZoom))[0];r&&r.getActive()&&(r.setActive(!1),setTimeout((function(){r.setActive(!0)}),t)),n.interaction.setActive(!1),setTimeout(e,t)}else e()}))}),this),n._projectionChangeHandler=function(t){!function(t,e){if(t.sketch){const r=e.oldValue.getProjection(),o=e.target.get(e.key).getProjection();if(r.getCode()!==o.getCode()){const e=t.sketch.getGeometry();e.transform(r,o),t.interaction.sketchPoint_.getGeometry().transform(r,o);const i=[];var n;n=t.parent.mode===gS.Z.Consts.geom.POLYGON?t.interaction.sketchCoords_[0]:t.interaction.sketchCoords_,ol.geom.flat.deflateCoordinates(i,0,n,e.stride),ol.proj.getTransform(r,o)(i,i,e.stride),n=ol.geom.flat.inflateCoordinates(i,0,i.length,e.stride),t.parent.mode===gS.Z.Consts.geom.POLYGON?t.interaction.sketchCoords_=[n]:t.interaction.sketchCoords_=n}}}(n,t)},o.on("change:view",n._projectionChangeHandler),o.addInteraction(n.interaction),n.parent.options.snapping||n.parent.options.extensible){var a={};r?a.source=r.getSource():n.parent.options.snapping instanceof gS.Z.Layer&&(a.source=n.parent.options.snapping.wrap.layer.getSource()),n.snapInteraction=new ol.interaction.Snap(a),o.addInteraction(n.snapInteraction)}}n.redoStack=[]}))}))},gS.Z.wrap.control.Draw.prototype.deactivate=function(){var t=this;t.parent.map&&Promise.all([t.parent.map.wrap.getMap(),t.parent.getLayer()]).then((function(e){const n=e[0],r=e[1];t.viewport&&(t._pointerdownHandler&&(t.viewport.removeEventListener("pointerdown",t._pointerdownHandler),t._pointerdownHandler=null),t._clickHandler&&(t.viewport.removeEventListener(gS.Z.Consts.event.CLICK,t._clickHandler),t._clickHandler=null)),r&&!t.parent.persistent&&r.clearFeatures(),t.interaction&&(n.removeInteraction(t.interaction),t.interaction=null),t._projectionChangeHandler&&n.un("change:view",t._projectionChangeHandler)}))},gS.Z.wrap.control.Draw.prototype.popCoordinate=function(){var t=this,e=null;if(t.interaction){var n=t.interaction.sketchFeature_;if(n){var r,o=n.getGeometry();if(o instanceof ol.geom.Polygon?r=o.getCoordinates()[0]:o instanceof ol.geom.LineString&&(r=o.getCoordinates()),r.length>1){var i;o instanceof ol.geom.Polygon?i=t.interaction.sketchCoords_[0]:o instanceof ol.geom.LineString&&(i=t.interaction.sketchCoords_);var a,s=!1;if(t.interaction.sketchPoint_)for(var l=t.interaction.sketchPoint_.getGeometry().getCoordinates(),c=0;c<r.length;c++)if(r[c][0]==l[0]&&r[c][1]==l[1]){s=!0;break}e=i[a=s?i.length-2:i.length-1],i.splice(a,1),o instanceof ol.geom.Polygon?(o.setCoordinates([i]),t.interaction.sketchLine_.getGeometry().setCoordinates(i)):o.setCoordinates(i),n.setGeometry(o)}}}return e},gS.Z.wrap.control.Draw.prototype.pushCoordinate=function(t){var e=this,n=!1;if(e.interaction){var r=e.interaction.sketchFeature_;if(r){var o,i,a=r.getGeometry();a instanceof ol.geom.Polygon?o=a.getCoordinates()[0]:a instanceof ol.geom.LineString&&(o=a.getCoordinates()),a instanceof ol.geom.Polygon?i=e.interaction.sketchCoords_[0]:a instanceof ol.geom.LineString&&(i=e.interaction.sketchCoords_);var s=!1;if(e.interaction.sketchPoint_)for(var l=e.interaction.sketchPoint_.getGeometry().getCoordinates(),c=0;c<o.length;c++)if(o[c][0]==l[0]&&o[c][1]==l[1]){s=!0;break}let u;u=s?i.length-1:i.length,i.splice(u,0,t),a instanceof ol.geom.LineString?a.setCoordinates(i,ol.geom.GeometryLayout.XY):(a.setCoordinates([i],ol.geom.GeometryLayout.XY),e.interaction.sketchLine_.getGeometry().setCoordinates(i)),n=!0}}return n},gS.Z.wrap.control.Draw.prototype.undo=function(){var t=this,e=!1,n=t.popCoordinate();return n&&(t.redoStack.push(n),e=!0),t.parent.trigger(gS.Z.Consts.event.MEASUREPARTIAL,t.getMeasureData()),e},gS.Z.wrap.control.Draw.prototype.redo=function(){var t=this,e=!1;return t.redoStack.length>0&&(t.pushCoordinate(t.redoStack.pop()),e=!0),t.parent.trigger(gS.Z.Consts.event.MEASUREPARTIAL,t.getMeasureData()),e},gS.Z.wrap.control.Draw.prototype.end=function(){var t=this;t.interaction&&t.interaction.sketchFeature_&&t.interaction.finishDrawing()},gS.Z.wrap.control.Draw.prototype.setStyle=function(){const t=this;if(t.interaction){let e;const n=t.parent.styles;switch(t.parent.mode){case gS.Z.Consts.geom.RECTANGLE:n.line&&(e=_b({styles:{line:n.line,point:!1,polygon:!1}}));break;case gS.Z.Consts.geom.POLYGON:case gS.Z.Consts.geom.MULTIPOLYGON:n.polygon&&(e=_b({styles:{polygon:n.polygon,line:!1,point:!1}}));break;case gS.Z.Consts.geom.POINT:case gS.Z.Consts.geom.MULTIPOINT:n.point&&(e=_b({styles:{point:n.point,line:!1,polygon:!1}}));break;case gS.Z.Consts.geom.MULTIPOLYLINE:default:if(n.line){const r={styles:{line:n.line,point:!1,polygon:!1}},o=_b(r);if(t.parent.options.extensible&&n.point){const r=_b({styles:{line:n.line,point:n.point,polygon:!1}});e=function(){if(t.interaction?.sketchPoint_){const e=t.interaction.sketchPoint_.getGeometry().getCoordinates();if(t.parent.layer.features.some((t=>Fb(e,t.getCoordinates()))))return r}return o}}else e=o}}t.interaction.overlay_.setStyle(e)}},gS.Z.wrap.control.Draw.prototype.setVisibility=function(t){const e=this;e.interaction&&e.interaction.getOverlay().setVisible(t)},gS.Z.wrap.control.OfflineMapMaker.prototype.getRequestSchemas=function(t){for(var e=t.extent,n=t.layers,r=new Array(n.length),o=0,i=r.length;o<i;o++){var a=n[o],s={layerId:a.id,tileMatrixSet:a.matrixSet},l=a.wrap.layer.getSource();if(l.getUrls&&(s.url=l.getUrls()[0]),l.getTileGrid){for(var c=l.getTileGrid(),u=c.getResolutions(),p=c.getMatrixIds(),d=a.getLayerNodeByName(a.layerNames),h=null,f=0,m=d.TileMatrixSetLink.length;f<m;f++){var g=d.TileMatrixSetLink[f];if(g.TileMatrixSet===a.matrixSet){h=g.TileMatrixSetLimits;break}}s.tileMatrixLimits=[],u.forEach((function(t,n){var r=c.getOrigin(n),o=c.getTileSize(n),i=o*t,a={mId:p[n],res:t,origin:r,tSize:o,cl:Math.floor((e[0]-r[0])/i),cr:Math.floor((e[2]-r[0])/i),rt:Math.floor((r[1]-e[3])/i),rb:Math.floor((r[1]-e[1])/i)};if(h){var l=h[n];l&&(a.cl=Math.max(a.cl,l.MinTileCol),a.cr=Math.min(a.cr,l.MaxTileCol),a.rt=Math.max(a.rt,l.MinTileRow),a.rb=Math.min(a.rb,l.MaxTileRow))}a.cl<=a.cr&&a.rt<=a.rb&&s.tileMatrixLimits.push(a)}))}r[o]=s}return r},gS.Z.wrap.control.OfflineMapMaker.prototype.getGetTilePattern=function(t){var e="",n=t.wrap.layer.getSource();return n.getUrls&&(e=n.getUrls()[0]),t.options.encoding!==gS.Z.Consts.WMTSEncoding.RESTFUL&&(e.indexOf("?")<0&&(e+="?"),e.indexOf("?")===e.length-1&&(e=e+"layer="+t.layerNames+"&style=default&tilematrixset="+encodeURIComponent(t.matrixSet)+"&Service=WMTS&Request=GetTile&Version=1.0.0&Format="+encodeURIComponent(t.format)+"&TileMatrix={TileMatrix}&TileCol={TileCol}&TileRow={TileRow}")),e};const Ub=function(t){return new ol.style.Stroke({color:"#ffffff",width:t+4})},Gb=function(t){return new ol.style.Stroke({color:"#000000",width:t+6})},Bb=function(t){t||(t=[]),t instanceof ol.style.Style&&(t=[t]);const e=(t=t.slice())[0];if(e){const r=e.getImage();var n;if(r instanceof ol.style.RegularShape){n=r.getStroke().getWidth();const o=r.getRadius(),i=e.clone();i.setImage(new ol.style.Circle({radius:o,stroke:Ub(n)})),t.unshift(i);const a=e.clone();a.setImage(new ol.style.Circle({radius:o,stroke:Gb(n)})),t.unshift(a)}const o=e.getStroke();return o&&(n=o.getWidth(),t.unshift(new ol.style.Style({stroke:Ub(n)})),t.unshift(new ol.style.Style({stroke:Gb(n)}))),t}return null},jb=function(t){qb.call(t),t.changed()},Wb=function(t){Object.prototype.hasOwnProperty.call(t,"_originalStyle")&&t.setStyle(t._originalStyle),delete t._originalStyle},qb=function(){this.style_=function(t){let e=t._originalStyle=t._originalStyle||t.getStyle();return!t._originalStyle&&t._wrap.parent.layer&&(e=t._wrap.parent.layer.wrap.layer.getStyle()),e||(e=_b({},t)),gS.Z.Util.isFunction(e)?function(t,n){return Bb(e(t,n))}:Bb(e)}(this),this.styleFunction_=this.style_?ol.Feature.createStyleFunction(this.style_):void 0};gS.Z.wrap.control.Modify.prototype.activate=function(){const t=this;t.parent.map&&Promise.all([t.parent.map.wrap.getMap(),t.parent.layer.wrap.getLayer()]).then((function(e){const n=e[0],r=e[1];t.selectInteraction&&n.removeInteraction(t.selectInteraction);var o=new ol.interaction.Select({layers:[r],hitTolerance:zS,style:null});t.selectInteraction=o,n.addInteraction(o);var i=function(t){return t._wrap.parent};o.on("select",(function(e){e.selected.length>0&&t.parent.trigger(gS.Z.Consts.event.FEATURESSELECT,{ctrl:t,features:e.selected.map(i)}),e.deselected.length>0&&0===e.selected.length&&t.parent.trigger(gS.Z.Consts.event.FEATURESUNSELECT,{ctrl:t.parent,features:e.deselected.map(i)})})),t.modifyInteraction&&n.removeInteraction(t.modifyInteraction);var a=new ol.interaction.Modify({features:o.getFeatures()});a.on("modifyend",(function(e){e.features.forEach((function(e){e._wrap.parent.geometry=e._wrap.getGeometry(),t.parent.trigger(gS.Z.Consts.event.FEATUREMODIFY,{feature:e._wrap.parent,layer:t.parent.layer})}))})),t.modifyInteraction=a,n.addInteraction(a),t.snapInteraction&&n.removeInteraction(t.snapInteraction),t.parent.snapping&&(t.snapInteraction=new ol.interaction.Snap({source:r.getSource()}),n.addInteraction(t.snapInteraction)),t._onMouseMove||(t._onMouseMove=function(e){const r=n.getViewport();var o,i=n.getEventPixel(e);o=n.forEachFeatureAtPixel(i,(function(e,n){return!(!t.parent.layer||n!==t.parent.layer.wrap.layer)}),{hitTolerance:zS}),r.style.cursor=o?"pointer":""}),n.getViewport().addEventListener(RS,t._onMouseMove)}))},gS.Z.wrap.control.Modify.prototype.deactivate=function(){const t=this;t.modifyInteraction&&(t.modifyInteraction.setActive(!1),t.selectInteraction.setActive(!1),t.parent.map.wrap.getMap().then((function(e){e.getViewport().removeEventListener(RS,t._onMouseMove),e.removeInteraction(t.modifyInteraction),e.removeInteraction(t.selectInteraction),t.modifyInteraction=null,t.selectInteraction=null})))},gS.Z.wrap.control.Modify.prototype.getSelectedFeatures=function(){var t=[];return this.selectInteraction&&this.selectInteraction.getFeatures().forEach((function(e){t.push(e._wrap.parent)})),t},gS.Z.wrap.control.Modify.prototype.setSelectedFeatures=function(t){var e=this;e.selectInteraction&&(e.selectInteraction.features_.clear(),e.selectInteraction.features_.extend(t.map((t=>t.wrap.feature))))},gS.Z.wrap.control.Modify.prototype.unselectFeatures=function(t){t=t||[];const e=this,n=e.selectInteraction?e.selectInteraction.getFeatures():null;if(n){const r=[];n.getArray().slice().forEach((function(e){(!t.length||t.indexOf(e)>=0)&&(n.remove(e),r.push(e._wrap.parent))})),r.length&&e.parent.trigger(gS.Z.Consts.event.FEATURESUNSELECT,{features:r})}},gS.Z.wrap.control.Edit.prototype.cancel=function(t,e){var n=this;if(n.points=[],n.histPoints=[],n.selectInteraction){var r=n.selectInteraction.getFeatures();n.parent.trigger(gS.Z.Consts.event.FEATURESUNSELECT,{ctrl:n.parent,feature:r.get(0)}),r.clear(),n.selectInteraction.setActive(!1)}},gS.Z.wrap.control.Edit.prototype.deleteFeatures=function(t){var e=this;if(Array.isArray(t)){var n=t.map((function(t){return t.wrap.feature}));e.parent.layer.wrap.getLayer().then((function(t){for(var r=e.selectInteraction?e.selectInteraction.getFeatures():null,o=0,i=n.length;o<i;o++){var a=n[o];r&&(r.remove(a),e.parent.trigger(gS.Z.Consts.event.FEATURESUNSELECT,{feature:a._wrap.parent})),t.getSource().removeFeature(a),e.parent.trigger(gS.Z.Consts.event.FEATUREREMOVE,{feature:a._wrap.parent})}}))}},gS.Z.wrap.Feature.prototype.toGML=function(t,e){var n=new ol.format.GML({srsName:e}).writeGeometryNode(this.feature.getGeometry()),r=n.querySelector("MultiSurface,MultiPolygon,Polygon");return r&&r.querySelectorAll("Polygon,LinearRing").forEach((t=>t.removeAttribute("srsName"))),n.firstChild.setAttribute("gml:id",n.firstChild.tagName+"."+gS.Z.getUID()),(new XMLSerializer).serializeToString(n.firstChild).replace(/\<\/?\w/gm,(function(t){var e=t.indexOf("/")>0?t.indexOf("/")+1:1;return t.substring(0,e)+"gml:"+t.substring(e)}))},gS.Z.wrap.Feature.prototype.toGeoJSON=function(){return(new ol.format.GeoJSON).writeGeometry(this.feature.getGeometry())},gS.Z.wrap.Geometry.write=function(t){var e;switch((t=t||{}).format,t.parser=new ol.format.GeoJSON,t.type){case gS.Z.Consts.geom.POLYLINE:e=new ol.geom.LineString(t.coordinates);break;case gS.Z.Consts.geom.POLYGON:e=new ol.geom.Polygon(t.coordinates);break;case gS.Z.Consts.geom.MULTIPOINT:e=new ol.geom.MultiPoint(t.coordinates);break;case gS.Z.Consts.geom.MULTIPOLYLINE:e=new ol.geom.MultiLineString(t.coordinates);break;case gS.Z.Consts.geom.MULTIPOLYGON:e=new ol.geom.MultiPolygon(t.coordinates);break;case gS.Z.Consts.geom.POINT:default:e=new ol.geom.Point(t.coordinates)}return t.parser.writeGeometry(e)},gS.Z.wrap.Geometry.toGeoJSON=function(t){return gS.Z.wrap.Geometry.write(t)};const Hb=yS.Z},1774:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var r=n(2089),o=o||{};o.Consts=r.Z,o.tool=o.tool||{},o.tool.Proxification=function(t,e){var n=this;if(n.Consts={url:{SPLIT_REGEX:/([^:]*:)?\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/}},void 0===t)throw new TypeError('"proxy" parameter is undefined',"TC.tool.Proxification.js");n.proxy="function"==typeof t?t:function(e){var n=t;return"http"!==e.substr(0,4)&&(n+=window.location.protocol),n+=encodeURIComponent(e)},e=e||{},n._location=e.location||window.location,n.preventMixedContent=void 0===e.allowedMixedContent||!e.allowedMixedContent},function(){window.fetch||function(t){if(!t.fetch){var e="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,r="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),o="FormData"in t,i="ArrayBuffer"in t;if(i)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(t){return t&&DataView.prototype.isPrototypeOf(t)},l=ArrayBuffer.isView||function(t){return t&&a.indexOf(Object.prototype.toString.call(t))>-1};f.prototype.append=function(t,e){t=p(t),e=d(e);var n=this.map[t];this.map[t]=n?n+","+e:e},f.prototype.delete=function(t){delete this.map[p(t)]},f.prototype.get=function(t){return t=p(t),this.has(t)?this.map[t]:null},f.prototype.has=function(t){return this.map.hasOwnProperty(p(t))},f.prototype.set=function(t,e){this.map[p(t)]=d(e)},f.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},f.prototype.keys=function(){var t=[];return this.forEach((function(e,n){t.push(n)})),h(t)},f.prototype.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),h(t)},f.prototype.entries=function(){var t=[];return this.forEach((function(e,n){t.push([n,e])})),h(t)},n&&(f.prototype[Symbol.iterator]=f.prototype.entries);var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];C.prototype.clone=function(){return new C(this,{body:this._bodyInit})},_.call(C.prototype),_.call(w.prototype),w.prototype.clone=function(){return new w(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new f(this.headers),url:this.url})},w.error=function(){var t=new w(null,{status:0,statusText:""});return t.type="error",t};var u=[301,302,303,307,308];w.redirect=function(t,e){if(-1===u.indexOf(e))throw new RangeError("Invalid status code");return new w(null,{status:e,headers:{location:t}})},t.Headers=f,t.Request=C,t.Response=w,t.fetch=function(t,e){return new Promise((function(n,o){var i=new C(t,e);e=e||{};var a=new XMLHttpRequest;a.onload=function(){if(0===a.status)return new w(null,{status:a.status});var t={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",r=new f,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(t){var e=t.split(":"),n=e.shift().trim();if(n){var o=e.join(":").trim();r.append(n,o)}})),r)};t.url="responseURL"in a?a.responseURL:t.headers.get("X-Request-URL");var e,r,o="response"in a?a.response:a.responseText;n(new w(o,t))},a.onerror=function(){o(new TypeError("Network request failed"))},a.ontimeout=function(){o(new TypeError("Network request failed"))},a.open(i.method,i.url,!e.sync),"include"===i.credentials?a.withCredentials=!0:"omit"===i.credentials&&(a.withCredentials=!1),!e.sync&&"responseType"in a&&r&&(a.responseType="blob"),i.headers.forEach((function(t,e){a.setRequestHeader(e,t)})),a.send(void 0===i._bodyInit?null:i._bodyInit)}))},t.fetch.polyfill=!0}function p(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function d(t){return"string"!=typeof t&&(t=String(t)),t}function h(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return n&&(e[Symbol.iterator]=function(){return e}),e}function f(t){this.map={},t instanceof f?t.forEach((function(t,e){this.append(e,t)}),this):Array.isArray(t)?t.forEach((function(t){this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}function m(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function g(t){return new Promise((function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}}))}function y(t){var e=new FileReader,n=g(e);return e.readAsArrayBuffer(t),n}function v(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function _(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,t)if("string"==typeof t)this._bodyText=t;else if(r&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(o&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(i&&r&&s(t))this._bodyArrayBuffer=v(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!i||!ArrayBuffer.prototype.isPrototypeOf(t)&&!l(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=v(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r&&(this.blob=function(){var t=m(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?m(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(y)}),this.text=function(){var t,e,n,r=m(this);if(r)return r;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,n=g(e),e.readAsText(t),n;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o&&(this.formData=function(){return this.text().then(E)}),this.json=function(){return this.text().then(JSON.parse)},this}function C(t,e){var n,r,o=(e=e||{}).body;if(t instanceof C){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new f(t.headers)),this.method=t.method,this.mode=t.mode,o||null==t._bodyInit||(o=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new f(e.headers)),this.method=(n=e.method||this.method||"GET",r=n.toUpperCase(),c.indexOf(r)>-1?r:n),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(o)}function E(t){var e=new FormData;return t.trim().split("&").forEach((function(t){if(t){var n=t.split("="),r=n.shift().replace(/\+/g," "),o=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(o))}})),e}function w(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new f(e.headers),this.url=e.url||"",this._initBody(t)}}(this);var t=function(t){var e=document.createElement("a");if(e.href=t,!e.origin){if(!e.protocol||!e.hostname){var n=/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/.exec(e.href);if(e.protocol=n[1],n[4].indexOf(":")>-1){var r=n[4].split(":");e.hostname=r[0],e.port=r[1]}else e.hostname=n[4]}e.origin=(0===e.protocol.length?window.location.protocol:e.protocol)+"//"+e.hostname+(e.port&&t.indexOf(e.port)>-1?":"+e.port:"")}return e};var e=o.tool.Proxification.prototype;e.cacheHost=new function(){var e=function(e){var n=t(e);return n?n.origin:null};this._hosts=[],this._hostsImage=[],this.is=function(t,n){var r=e(t);return null!==this.get(r,n)},this.get=function(t,e){if(0===this.getList(e).length)return null;var n=this.getList(e).filter((function(n){return n.key===t&&e.exportable==n.exportable}));return 0===n.length?null:n[0]},this.getList=function(t){return t.forImage?this._hostsImage:this._hosts},this.addKey=function(t,n){var r={key:e(t),action:null};return n.exportable&&(r.exportable=n.exportable),this.getList(n).push(r),this.getList(n)[this.getList(n).length-1]},this.removeKey=function(t,n){for(var r=e(t),o=0;o<this.getList(n).length;o++)if(this.getList(n)[o].key===r&&n.exportable==this.getList(n)[o].exportable){this.getList(n).splice(o,1);break}},this.getAction=function(t,n){n=n||{};var r=e(t),o=this.get(r,n);return o?o._actionPromise:Promise.reject(new Error("Cache null"))}},e._isServiceWorker=function(){return!!navigator.serviceWorker&&(!(!navigator.serviceWorker.controller||"activated"!==navigator.serviceWorker.controller.state)||(navigator.serviceWorker.ready.then((function(t){return!!t.active})).catch((()=>{console.log("Capturamos error que se produce en FF por configuración del navegador.")})),!1))},e._isSameOrigin=function(t){var e=this,n=0!==t.indexOf("http")&&0!==t.indexOf("//"),r=!n&&t.match(e.Consts.url.SPLIT_REGEX);if(r){var o=r[1];n=(o==e._location.protocol||null==o)&&r[3]==e._location.hostname;var i=r[4],a=e._location.port;(80!=i&&""!==i||"80"!=a&&""!==a)&&(n=n&&i==a)}return n},e._isSameProtocol=function(t){const e=this;var n=/^(https?:\/\/)/i,r=t.match(n);if(r&&r.length>1){var o=e._location.match(n);if(o&&o.length>1)return r[0].trim()===o[0].trim()}return!1},e._isSecureURL=function(t){return!/^(f|ht)tps?:\/\//i.test(t)||/^(f|ht)tps:\/\//i.test(t)};const n=function(t,e,n){this.status=t,this.text=e,this.url=n};var r=function(e,n){var r=t(e);return e.replace(r.protocol,n)},i=function(t){return r(t,"https:")},a=function(t){return r(t,"http:")},s=function(t,e,n,r){var o=this;t=i(t),o._image.getImgTag(t,e).then((function(t){n(t,o._actionHTTPS)}),(function(i){i===o._image.ErrorType.PROTOCOL?r(i):c.call(o,a(t),e,n,r)}))},l=function(t,e,n,r){var o=this;t=a(t),o._image.getImgTag(t,e).then((function(t){n(t,o._actionHTTP)}),(function(a){a===o._image.ErrorType.PROTOCOL?r(a):c.call(o,i(t),e,n,r)}))},c=function(t,e,n,r){var o=this;e.sameOrigin=o._isSameOrigin(o._actionProxy.call(o,t)),o._image.getImgTagByAction(t,e,o._actionProxy.bind(o)).then((function(t){n(t,o._actionProxy)}),(function(t){r(t)}))};e._actionDirect=function(t){return t},e._actionHTTP=function(t){return r(t,"http:")},e._actionHTTPS=function(t){return r(t,"https:")},e._actionProxy=function(t){return this.proxy(t)},e._image={ErrorType:{CORS:"cors",PROTOCOL:"protocol",NOTFOUNDED:"notfounded",UNEXPECTED:"unexpected",OFFLINE:"offline"},checkHttpStatus:function(t){const e=this;return navigator.onLine?fetch(t,{credentials:"omit"}).then((function(t){return{status:t.status,statusText:t.statusText}})).catch((function(t){return{statusText:e.ErrorType.UNEXPECTED}})):Promise.reject({statusText:e.ErrorType.OFFLINE})},getImgTag:function(t,n){return new Promise(function(e,r){var o=this,i=document.createElement("img");n.exportable&&!n.sameOrigin&&(i.dataset.checkCORSHeaders=!0,i.crossOrigin="string"==typeof n.exportable?n.exportable:"anonymous"),i.onload=function(){if(console.log("Load OK: "+i.src),i.onload=i.onerror=void 0,n.exportable&&!n.sameOrigin){try{var t=function(t){var e=document.createElement("CANVAS"),n=e.getContext("2d");return e.height=t.height,e.width=t.width,n.drawImage(t,0,0),e}(i);t.toDataURL("image/png");e(i)}catch(t){18===t.code?r(o.ErrorType.CORS):e(i)}}else e(i)},i.onerror=function(e){console.log("Load crossOrigin ERROR: "+i.src),i.dataset.checkCORSHeaders?(i.crossOrigin=null,i.onerror=void 0,i.onerror=function(t){console.log("Load ERROR: "+i.src),o.checkHttpStatus(i.src).then((function(t){n.ignoreProxification||400===t.status?r(o.ErrorType.PROTOCOL):r(t)})).catch(r),i.onload=i.onerror=void 0},i.src=t):(console.log("Load ERROR: "+i.src),i.onload=i.onerror=void 0,o.checkHttpStatus(i.src).then((function(t){n.ignoreProxification||400===t.status?r(o.ErrorType.PROTOCOL):r(t)})).catch(r))};try{i.src=t}catch(t){console.log("Load ERROR: "+i.src),r(o.ErrorType.UNEXPECTED)}}.bind(e._image))},getImgTagByAction:function(t,n,r){return new Promise(function(e,o){var i=this,a=document.createElement("img");n.sameOrigin||n.exportable&&(a.crossOrigin="anonymous"),a.onload=function(){a.onload=a.onerror=void 0,e(a)},a.onerror=function(t){console.log("Load ERROR: "+a.src),a.onload=a.onerror=void 0,i.checkHttpStatus(a.src).then((function(t){n.ignoreProxification||400===t.status?o(i.ErrorType.PROTOCOL):o(t)})).catch(o)},a.src=r(t)}.bind(e._image))}},e._fetch={Headers:{CONTENTTYPE:"content-type",CONTENTDISPOSITION:"content-disposition"},ErrorType:{CORS:"cors",PROTOCOL:"protocol",NOTFOUNDED:"Not_Founded",UNEXPECTED:"Un_Expected",UNEXPECTEDCONTENTTYPE:"Un_Expected_ContentType"},validateResponse:function(t){if(!t.ok)throw new n(t.status,t.statusText,t.url);return t},validateContentType:function(t,e){const n=this;if(!t)return e;var r=e.headers.get(n._fetch.Headers.CONTENTTYPE);if(r&&-1===r.indexOf(t))throw Error(n._fetch.ErrorType.UNEXPECTEDCONTENTTYPE);return e}},e.fetchImage=function(t,e){var n=this;return(e=e||{}).forImage=!0,new Promise((function(r,o){if(n.cacheHost.is(t,e))n.cacheHost.getAction(t,e).then((function(i){e.sameOrigin=n._isSameOrigin(i.action(t)),n._image.getImgTagByAction(t,e,i.action).then((function(t){r(t)}),(function(t){o(t)}))})).catch((t=>o(t)));else{var i=n.cacheHost.addKey(t,e);i._actionPromise=new Promise((function(a,u){const p=function(t,o){i.action=o.bind(n),i.exportable=e.exportable,a({action:i.action}),r(t)},d=function(r){u(r),r.status,n.cacheHost.removeKey(t,e),o(r)};!function(e){n._isSameOrigin(t)?(e.sameOrigin=!0,n._image.getImgTag(t,e).then((function(t){p(t,n._actionDirect)}),d)):n._isSecureURL(t)?n._image.getImgTag(t,e).then((function(t){p(t,n._actionDirect)}),(function(r){e.exportable&&r===n._image.ErrorType.CORS||n._isServiceWorker()||n._isSecureURL(n._location)&&n.preventMixedContent?r===n._image.ErrorType.PROTOCOL&&e.ignoreProxification?d(r):c.call(n,t,e,p,d):l.call(n,t,e,p,d)})):n._isServiceWorker()||n._isSecureURL(n._location)&&n.preventMixedContent?s.call(n,t,e,p,d):n._image.getImgTag(t,e).then((function(t){p(t,n._actionDirect)}),(function(r){e.exportable&&r===n._image.ErrorType.CORS||!n._isSecureURL(n._location)?r===n._image.ErrorType.PROTOCOL&&e.ignoreProxification?d(r):c.call(n,t,e,p,d):s.call(n,t,e,p,d)}))}(e)}))}}))},e.fetchRetry=function(t,e,n){const r=this;var o=fetch;return e.sync&&(o=r.fetchSync),o(t,e).catch((function(o){if(1===n)throw o;return r.fetchRetry(t,e,n-1)}))},e.fetchSync=function(t,e){var n=this;return new Promise((function(r,o){"Symbol"in n&&Symbol;var i="FileReader"in n&&"Blob"in n&&function(){try{return new Blob,!0}catch(t){return!1}}();var a=new Request(t,e),s=new XMLHttpRequest;s.onload=function(){var t,e,n={status:s.status,statusText:s.statusText,headers:(t=s.getAllResponseHeaders()||"",e=new Headers,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(t){var n=t.split(":"),r=n.shift().trim();if(r){var o=n.join(":").trim();e.append(r,o)}})),e)};n.url="responseURL"in s?s.responseURL:n.headers.get("X-Request-URL");var o="response"in s?s.response:s.responseText;r(new Response(o,n))},s.onerror=function(){o(new TypeError("Network request failed"))},s.ontimeout=function(){o(new TypeError("Network request failed"))},s.open(a.method,a.url,!1),"include"===a.credentials?s.withCredentials=!e.sync:"omit"===a.credentials&&(s.withCredentials=!1),!e.sync&&"responseType"in s&&i&&(s.responseType="blob"),a.headers.forEach((function(t,e){s.setRequestHeader(e,t)})),s.send(void 0===a._bodyInit?null:a._bodyInit)}))},e.fetchXML=function(t,e){return(e=e||{}).responseType="xml",this.fetch(t,e)},e.fetchJSON=function(t,e){return(e=e||{}).responseType=o.Consts.mimeType.JSON,this.fetch(t,e)},e.fetchBlob=function(t,e){return(e=e||{}).responseType="blob",this.fetch(t,e)},e.fetchImageAsBlob=function(t,e){return(e=e||{}).responseType="image",this.fetch(t,e)},e.fetch=function(e,n){const r=this;(n=n||{}).type&&(n.method=n.type,delete n.type),n.data&&(n.body=n.data,delete n.data),n.contentType&&(n.headers=new Headers,n.headers.append("Content-Type",n.contentType),delete n.contentType),n.responseType||(n.responseType="");var i=function(t,e,n,a){return(e.retryAttempts?r.fetchRetry(n[0].call(r,t),e,e.retryAttempts):fetch(n[0].call(r,t),e)).then(r._fetch.validateResponse).then(r._fetch.validateContentType.bind(r,e.responseType)).then((function(t){a&&(a.action=n[0].bind(r));const i=t.headers.get(r._fetch.Headers.CONTENTTYPE);if(e.nomanage)return Promise.resolve(t);const s=function(e){return t.blob().then((function(t){const n=new FileReader;return new Promise((function(r,o){n.addEventListener("error",(function(){n.abort(),o(new DOMException("Problem decoding"))})),n.addEventListener("loadend",(function(){r(n.result)})),n.readAsText(t,e)}))})).catch((function(t){throw t}))};let l;switch(!0){case e.responseType.indexOf("xml")>-1:case e.responseType.indexOf("text/xml")>-1:case e.responseType.indexOf(o.Consts.mimeType.XML)>-1:return l=/charset=([^;]*)/i.exec(i),l&&2===l.length&&"UTF-8"!==l[1]?s(l[1]).then((function(t){return(new window.DOMParser).parseFromString(t,"text/xml")})).catch((function(t){throw t})):t.text().then((function(t){return(new window.DOMParser).parseFromString(t,"text/xml")})).catch((function(t){throw t}));case e.responseType.indexOf("arraybuffer")>-1:return t.arrayBuffer();case e.responseType.indexOf("image")>-1:case e.responseType.indexOf("blob")>-1:case e.responseType.indexOf("application/zip")>-1:case e.responseType.indexOf("application/x-zip-compressed")>-1:case e.responseType.indexOf("application/vnd.google-earth.kmz")>-1:case e.responseType.indexOf("application/octet-stream")>-1:case e.responseType.indexOf("application/geopackage+sqlite3")>-1:return t.blob().then((function(t){return new Blob([t],{type:i})})).catch((function(t){throw t}));case e.responseType.indexOf("document")>-1:throw new DeveloperError("Unhandled responseType: "+e.responseType);case e.responseType.indexOf(o.Consts.mimeType.JSON)>-1:return t.json();case""==e.responseType:case e.responseType.indexOf("text")>-1:default:return l=/charset=([^;]*)/i.exec(i),l&&2===l.length&&"UTF-8"!==l[1]?s(l[1]).then((function(t){return""==e.responseType?{responseText:t,contentType:i}:t})).catch((function(t){throw t})):t.text().then((function(t){return""==e.responseType?{responseText:t,contentType:i}:t})).catch((function(t){throw t}))}})).catch((function(r){return 1===n.length||r.status&&500===r.status?(console.log("request failed",r),Promise.reject(r)):(n.shift(),i(t,e,n,a))}))};if(r.cacheHost.is(e,n))return new Promise((function(t,o){r.cacheHost.getAction(e,n).then((function(r){t(i(e,n,[r.action]))})).catch((function(i){!i.status||i.status>=400?o(i):t(r.fetch(e,n))}))}));var a=r.cacheHost.addKey(e,n);return new Promise((function(o,s){a._actionPromise=new Promise((function(l,c){e=t(e).href;const u=function(t){l({action:a.action}),o(t)},p=function(t){r.cacheHost.removeKey(e,n),c(t),s(t)};r._isSameOrigin(e)?i(e,n,[r._actionDirect,r._actionProxy],a).then(u).catch(p):r._isSecureURL(e)?r._isServiceWorker()?i(e,n,[r._actionDirect,r._actionProxy],a).then(u).catch(p):i(e,n,r._isSecureURL(r._location)?[r._actionDirect,r._actionProxy]:[r._actionDirect,r._actionHTTP,r._actionProxy],a).then(u).catch(p):r._isServiceWorker()?i(e,n,[r._actionHTTPS,r._actionProxy],a).then(u).catch(p):i(e,n,r._isSecureURL(r._location)?[r._actionHTTPS,r._actionProxy]:[r._actionDirect,r._actionHTTPS,r._actionProxy],a).then(u).catch(p)})),a._actionPromise.catch((function(t){!t.status||t.status>=400?s(t):o(r.fetch(e,n))}))}))},e.fetchFile=function(t,e){const n=this;return(e=e||{}).nomanage=!0,new Promise((function(r,o){n.fetch(t,e).then((function(e){const o=e.headers.get(n._fetch.Headers.CONTENTDISPOSITION);var i=new RegExp(/[\w|\-|\.]+.\w{1,}$/gi).exec(t)[0];if(o&&/(attachment);([^;]*)/gi.test(o))try{i=/filename\*?=\"?([\w|\-|\.]*\'\')?(.*\.\w*)\"?/gi.exec(o)[2]}catch(t){try{i=o.substring((o.lastIndexOf("'")||o.indexOf("="))+1)}catch(t){}}e.blob().then((function(t){r(new File([t],i,{type:e.headers.get(n._fetch.Headers.CONTENTTYPE)}))}))})).catch(o)}))}}();const i=o.tool.Proxification},7364:(t,e,n)=>{"use strict";n.d(e,{Z:()=>o});var r=n(5361);r.Z.UI=r.Z.UI||{},function(){var t=function(t){return"[object Object]"===Object.prototype.toString.call(t)},e=function(){var t={},n=!1,r=0;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(n=arguments[0],r++);for(var o=function(r){for(var o in r)r.hasOwnProperty(o)&&(n&&"[object Object]"===Object.prototype.toString.call(r[o])?t[o]=e(t[o],r[o]):t[o]=r[o])};r<arguments.length;r++)o(arguments[r]);return t},n=function(e,n,r){var i=[];if(n)if(r.buildHTML)r.target.innerHTML=r.buildHTML({results:n});else{for(var a=0;a<n.length;a++){var s=n[a];t(s)?i.push(`<li><a href="${r.link}${encodeURIComponent(s.id)}">${s.label}</a></li>`):i.push(`<li><a href="${r.link}${encodeURIComponent(s)}">${s}</a></li>`)}var l=document.createElement("template");l.innerHTML=i.join(""),r.target.appendChild(l.content?l.content.firstChild:l.firstChild)}null!==r.callback&&"function"==typeof r.callback&&o(r),e.value.length>0?e.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")):e.dispatchEvent(new CustomEvent("targetCleared.autocomplete"))},o=function(t){t.target.querySelectorAll("li a").forEach((function(e){e.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault(),t.callback(e)}))}))},i=function(t,e){e.innerHTML="",t.dispatchEvent(new CustomEvent("targetCleared.autocomplete"))},a=function(e){var r,o,a,s,l=e.target,c=(l.getAttribute("id"),l.getAttribute("autocomplete"));if(c){var u=this.settings;c.openXHR;if((r=l.value).length<u.minLength)i(l,u.target);else if(Array.isArray(u.source))o=u.source.sort().filter((function(e){return s=u.matchFromStart?new RegExp("^"+r,"i"):new RegExp(r,"i"),a=t(e)?e.label:e,s.test(a)})),n(l,o,u);else if("function"==typeof u.source){if(arguments&&arguments[0]&&[37,39].indexOf(arguments[0].keyCode)>-1)return;u.source(r,(function(t){n(l,t,u)}))}}},s={init:function(t){var n=this,r={settings:null};r.settings=e({},r.defaults,t),n.setAttribute("autocomplete",!0);var o=r.settings;return n.removeEventListener("keyup",a),n.addEventListener("keyup",a),n.parentNode.querySelector(".ui-input-clear")&&n.parentNode.querySelector(".ui-input-clear").addEventListener("click",(function(t){i(n,o.target)})),n},update:function(t,n){return this.getAttribute("autocomplete")&&(this.settings=e(this.settings,n)),this},clear:function(t){return this.getAttribute("autocomplete")&&i(this,this.settings.target),this},destroy:function(){return this.getAttribute("autocomplete")&&(i(this,this.settings.target),this.removeAttribute("autocomplete"),this.removeEventListener("keyup",a)),this}};r.Z.UI.autocomplete=function(t){return s[t]?s[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void 0:(this.settings=arguments[0],s.init.apply(this,arguments))}}(r.Z);const o=r.Z.UI.autocomplete},9540:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>i});var r=n(5361),o=n(6595);r.Z.view=r.Z.view||{},r.Z.control=r.Z.control||{},r.Z.control.MapContents=o.default,r.Z.Consts=r.Z.Consts||{},r.Z.Consts.CESIUMNS="cesium";const i=r.Z.view.ThreeD=function(){const t=Object.prototype.hasOwnProperty;var e={VIEWNAME:"ThreeD",CLASS:"tc-view-3d",Consts:{BLANK_BASE:"blank",DEFAULT_TILE_SIZE:256},classes:{MAP3D:"tc-map-3d",LOADING:"tc-loading",CAMERACTRARROWDISABLED:"disabled-arrow",FOCUS:"focus",HIGHLIGHTED:"highlighted",DISABLED:"disabled",OUTFOCUS:"outfocus"},allowedControls:[],template:{},viewer:null,mapView:null,terrainProvider:null,getLocaleString:function(t,e){var n=this,o=n.map?n.map.options.locale:r.Z.Cfg.locale;return r.Z.Util.getLocaleString(o,t,e)},getRenderedHtml:function(t,e,n){return r.Z.Control.prototype.getRenderedHtml.call(this,t,e,n)}};r.Z.Consts.classes.THREED=r.Z.Consts.classes.THREED||"tc-3d",r.Z.Consts.classes.THREED_HIDDEN=r.Z.Consts.classes.THREED_HIDDEN||"tc-3d-hidden",r.Z.Consts.event.TERRAINLOADED=r.Z.Consts.event.TERRAINLOADED||"terrainloaded.tc.threed",r.Z.Consts.event.TERRAINRECEIVING=r.Z.Consts.event.TERRAINRECEIVING||"terrainreceiving.tc.threed",r.Z.Consts.event.TERRAIN404=r.Z.Consts.event.TERRAIN404||"terrain404.tc.threed",e.template[e.CLASS]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<button type="button" class="tc-ctl-3d-btn tc-beta-button tc-float-btn" title="'+t.escapeExpression(i(n,"i18n").call(null!=e?e:t.nullContext||{},"threed.tip",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:79},end:{line:1,column:100}}}))+'"></button>'},useData:!0},e.template[e.CLASS+"-overlay"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){return'<div class="tc-view-3d-overlay" hidden>\r\n    <svg class="tc-view-3d-overlay-svg">\r\n        <defs>\r\n            <filter id="fGaussian" x="0" y="0">\r\n                <feGaussianBlur in="SourceGraphic" stdDeviation="3" />\r\n            </filter>\r\n        </defs>\r\n        <rect width="100%" height="100%" fill="white" fill-opacity="0.1" filter="url(#fGaussian)" />  \r\n    </svg>    \r\n</div>'},useData:!0},e.template[e.CLASS+"-cm-ctls"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div>\r\n    <svg xmlns:dc="http://purl.org/dc/elements/1.1/"\r\n         xmlns:cc="http://creativecommons.org/ns#"\r\n         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"\r\n         xmlns:svg="http://www.w3.org/2000/svg"\r\n         xmlns="http://www.w3.org/2000/svg"\r\n         xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\r\n         xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\r\n         width="220"\r\n         height="135"\r\n         viewBox="0 0 63.40233 35.531682"\r\n         version="1.1"\r\n         id="threedControls">\r\n        <g inkscape:groupmode="layer"\r\n           id="backgroundLayer"\r\n           inkscape:label="backgroundLayer"\r\n           transform="translate(-2.3693123,-42.387899)">\r\n            <path style="fill:#ffffff;fill-opacity:0.23999999;stroke:none;stroke-width:0.2;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:0.3169643;paint-order:stroke fill markers"\r\n                  d="M 48.005285,42.387899 A 17.766048,17.766048 0 0 0 34.067635,49.16888 17.754217,17.754217 0 0 0 20.123267,42.399784 17.754217,17.754217 0 0 0 2.3693123,60.153739 a 17.754217,17.754217 0 0 0 17.7539547,17.75447 17.754217,17.754217 0 0 0 13.923699,-6.76961 17.766048,17.766048 0 0 0 13.958319,6.78098 17.766048,17.766048 0 0 0 17.766357,-17.76584 17.766048,17.766048 0 0 0 -17.766357,-17.76584 z"\r\n                  id="background"\r\n                  inkscape:connector-curvature="0" />\r\n        </g>\r\n        <g inkscape:label="tiltLayer"\r\n           inkscape:groupmode="layer"\r\n           id="tiltLayer"\r\n           transform="translate(-26.69084,-42.254264)"\r\n           style="display:inline">\r\n            <g class="tc-view-3d-cm-tilt-indicator">\r\n                <path class="tc-view-3d-cm-tilt-inner"\r\n                      id="tiltInner"\r\n                      d="m 44.44423,52.861576 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z"\r\n                      inkscape:connector-curvature="0">\r\n                    <title>'+a(s(n,"i18n").call(i,"threed.tilt.reset",{name:"i18n",hash:{},data:o,loc:{start:{line:33,column:27},end:{line:33,column:55}}}))+'</title>\r\n                </path>\r\n                <path class="tc-view-3d-cm-tilt-inner-image"\r\n                      d="m 40.116095,64.124648 c -0.12075,-0.119221 -0.171366,-0.928328 -0.171366,-2.739326 0,-2.143319 0.03709,-2.606753 0.223349,-2.79065 0.19727,-0.194769 0.269957,-0.196719 0.622509,-0.01671 0.219537,0.112088 0.761654,0.542242 1.204705,0.955894 l 0.805547,0.752098 v 0.939855 c 0,0.51692 -0.06955,1.085596 -0.154558,1.263727 -0.173436,0.363428 -1.919571,1.804317 -2.186551,1.804317 -0.09475,0 -0.249383,-0.07614 -0.343635,-0.169192 z m 3.287741,-0.05029 c -0.307698,-0.212789 -0.317387,-0.295835 -0.317387,-2.721198 0,-1.757783 0.05096,-2.552024 0.171366,-2.670904 0.120776,-0.119243 0.941399,-0.169194 2.779684,-0.169194 2.432612,0 2.618273,0.01838 2.756146,0.27272 0.08484,0.156511 0.147831,1.267987 0.147831,2.608402 0,3.088986 0.189068,2.899662 -2.895738,2.899662 -1.872744,0 -2.3862,-0.04266 -2.641902,-0.219488 z m 0.586357,-6.180807 c -0.314529,-0.267117 -0.397432,-0.458143 -0.397432,-0.915756 0,-0.785501 0.427643,-1.207722 1.223233,-1.207722 1.162181,0 1.675866,1.23538 0.851939,2.048861 -0.522115,0.515494 -1.126934,0.542392 -1.67774,0.07462 z m 2.780604,-0.09201 c -0.374474,-0.369724 -0.423284,-0.501051 -0.3506,-0.943285 0.118405,-0.72038 0.53618,-1.088187 1.236028,-1.088187 0.699848,0 1.117624,0.367807 1.236028,1.088187 0.07269,0.442234 0.02388,0.573561 -0.3506,0.943285 -0.300932,0.297119 -0.573881,0.429526 -0.885428,0.429526 -0.311544,0 -0.584496,-0.132407 -0.885428,-0.429526 z"\r\n                      id="tiltImage"\r\n                      inkscape:connector-curvature="0">\r\n                    <title>'+a(s(n,"i18n").call(i,"threed.tilt.reset",{name:"i18n",hash:{},data:o,loc:{start:{line:39,column:27},end:{line:39,column:55}}}))+'</title>\r\n                </path>\r\n                <path class="tc-view-3d-cm-tilt-outer tc-view-3d-cm-tilt-outer-circle"\r\n                      id="tiltOuter"\r\n                      d="m 44.44423,48.705554 c -6.246102,0 -11.312196,5.070128 -11.312196,11.324146 0,6.254017 5.066094,11.330914 11.312196,11.330914 6.246102,0 11.312196,-5.076897 11.312196,-11.330914 0,-6.254018 -5.066094,-11.324146 -11.312196,-11.324146 z m 0,4.156022 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z"\r\n                      inkscape:connector-curvature="0">\r\n                    <title>'+a(s(n,"i18n").call(i,"threed.tilt.drag",{name:"i18n",hash:{},data:o,loc:{start:{line:45,column:27},end:{line:45,column:54}}}))+'</title>\r\n                </path>\r\n                <path class="tc-view-3d-cm-tilt-outer tc-view-3d-cm-tilt-outer-shell-circle"\r\n                      sodipodi:nodetypes="ssssssccccsccccssccsssccscccccccsccssscsssssccccccccccccccc"\r\n                      inkscape:connector-curvature="0"\r\n                      id="tiltShell"\r\n                      d="m 44.44423,48.705554 c -6.246102,0 -11.312196,5.070128 -11.312196,11.324146 0,6.254017 5.066094,11.330914 11.312196,11.330914 6.246102,0 11.312196,-5.076897 11.312196,-11.330914 0,-6.254018 -5.066094,-11.324146 -11.312196,-11.324146 z m 0,0.379051 c 2.995132,0 5.705501,1.203885 7.681205,3.154245 l -2.386853,2.382605 0.135232,0.135376 2.386853,-2.382606 c 1.930016,1.972963 3.12387,4.674054 3.12387,7.655475 0,2.981421 -1.193854,5.680844 -3.12387,7.655474 l -2.386853,-2.382605 -0.135232,0.135375 2.386853,2.382606 c -1.975664,1.951759 -4.686314,3.161013 -7.681205,3.161013 -1.94179,0 -3.766282,-0.506879 -5.347316,-1.395323 -0.850442,-0.477894 -1.630441,-1.06619 -2.320365,-1.745384 l 2.407138,-2.402912 c 1.358381,1.325983 3.214811,2.145699 5.260543,2.145699 4.163407,0 7.545972,-3.385283 7.545972,-7.553943 0,-4.168661 -3.382565,-7.547175 -7.545972,-7.547175 -2.045732,0 -3.902162,0.81461 -5.260543,2.13893 l -2.407138,-2.402912 c 1.972594,-1.940536 4.681097,-3.133938 7.667681,-3.133938 z m -0.189325,0.182756 v 3.01887 h 0.378651 v -3.01887 z m -7.606826,3.086558 2.400376,2.402912 C 37.721509,56.11715 36.90502,57.97796 36.90502,60.0297 c 0,2.05174 0.816489,3.910884 2.143435,5.272869 l -2.400376,2.402912 c -0.435151,-0.44326 -0.832923,-0.923297 -1.188195,-1.435068 -0.462681,-0.666492 -0.853281,-1.386809 -1.160484,-2.149815 -0.508689,-1.263436 -0.788715,-2.64392 -0.788715,-4.090898 0,-2.99182 1.197141,-5.70104 3.137394,-7.675781 z m 7.796151,0.507657 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z m -10.744219,6.978598 v 0.379051 h 3.022445 v -0.379051 z m 18.513325,0 v 0.379051 h 3.029207 v -0.379051 z m -7.931385,7.932994 v 3.01887 h 0.37189 v -3.01887 z">\r\n                    <title>'+a(s(n,"i18n").call(i,"threed.tilt.drag",{name:"i18n",hash:{},data:o,loc:{start:{line:52,column:27},end:{line:52,column:54}}}))+'</title>\r\n                </path>\r\n            </g>\r\n        </g>\r\n        <g id="rotateLayer"\r\n           inkscape:groupmode="layer"\r\n           inkscape:label="rotateLayer"\r\n           style="display:inline"\r\n           transform="translate(-2.3693123,-42.387899)">\r\n            <path class="tc-view-3d-cm-rotate-right"\r\n                  sodipodi:nodetypes="cccccccc"\r\n                  inkscape:connector-curvature="0"\r\n                  id="right"\r\n                  d="m 53.241331,72.907368 0.900176,1.930847 c 3.602027,-1.827343 6.291427,-4.493353 8.092762,-8.066897 l 0.969844,0.452626 -0.663464,-4.788009 -3.222445,2.974451 0.983506,0.459005 c -1.447339,3.107391 -3.949649,5.598011 -7.060379,7.037977 z">\r\n                <title>'+a(s(n,"i18n").call(i,"threed.rotate.right",{name:"i18n",hash:{},data:o,loc:{start:{line:66,column:23},end:{line:66,column:53}}}))+'</title>\r\n            </path>\r\n            <path class="tc-view-3d-cm-rotate-left"\r\n                  sodipodi:nodetypes="cccccccc"\r\n                  inkscape:connector-curvature="0"\r\n                  id="left"\r\n                  d="m 42.795431,72.906221 -0.900176,1.930846 c -3.602027,-1.827342 -6.291427,-4.493352 -8.092762,-8.066896 l -0.969844,0.452626 0.663465,-4.788009 3.222444,2.974451 -0.983506,0.459005 c 1.44734,3.107391 3.949649,5.598011 7.060379,7.037977 z">\r\n                <title>'+a(s(n,"i18n").call(i,"threed.rotate.left",{name:"i18n",hash:{},data:o,loc:{start:{line:73,column:23},end:{line:73,column:52}}}))+'</title>\r\n            </path>\r\n            <path class="tc-view-3d-cm-tilt-up"\r\n                  sodipodi:nodetypes="cccccccc"\r\n                  inkscape:connector-curvature="0"\r\n                  id="up"\r\n                  d="M 7.737296,54.610066 5.80645,53.70989 c 1.827342,-3.602027 4.493352,-6.291427 8.066896,-8.092762 l -0.452626,-0.969844 4.788009,0.663465 -2.974451,3.222444 -0.459005,-0.983506 c -3.107391,1.44734 -5.598011,3.949649 -7.037977,7.060379 z">\r\n                <title>'+a(s(n,"i18n").call(i,"threed.tilt.left",{name:"i18n",hash:{},data:o,loc:{start:{line:80,column:23},end:{line:80,column:50}}}))+'</title>\r\n            </path>\r\n            <path class="tc-view-3d-cm-tilt-down"\r\n                  sodipodi:nodetypes="cccccccc"\r\n                  inkscape:connector-curvature="0"\r\n                  id="down"\r\n                  d="m 7.684579,65.708846 -1.930847,0.900176 c 1.827343,3.602027 4.493353,6.291427 8.066897,8.092762 l -0.452626,0.969844 4.788009,-0.663464 -2.974451,-3.222445 -0.459005,0.983506 C 11.615165,71.321886 9.124545,68.819576 7.684579,65.708846 Z">\r\n                <title>'+a(s(n,"i18n").call(i,"threed.tilt.right",{name:"i18n",hash:{},data:o,loc:{start:{line:87,column:23},end:{line:87,column:51}}}))+'</title>\r\n            </path>\r\n            <g class="tc-view-3d-cm-rotate-indicator">\r\n                <path class="tc-view-3d-cm-rotate-inner"\r\n                      inkscape:connector-curvature="0"\r\n                      d="m 48.010487,52.995444 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z"\r\n                      id="rotateInner">\r\n                    <title>'+a(s(n,"i18n").call(i,"threed.rotate.reset",{name:"i18n",hash:{},data:o,loc:{start:{line:94,column:27},end:{line:94,column:57}}}))+'</title>\r\n                </path>\r\n                <path class="tc-view-3d-cm-rotate-inner-image"\r\n                      d="m 45.461645,60.604061 c 0.860585,-1.857231 1.777009,-3.864779 2.036499,-4.461218 0.471802,-1.084433 0.471802,-1.084433 0.66474,-0.667935 2.070474,4.46957 3.86201,8.443545 3.825603,8.485934 -0.02561,0.02982 -0.943964,-0.165127 -2.040793,-0.433206 -1.994234,-0.487419 -1.994234,-0.487419 -3.881098,-0.01711 -1.037775,0.258673 -1.950491,0.470314 -2.028258,0.470314 -0.07777,0 0.562721,-1.519553 1.423307,-3.376784 z m 1.23418,2.027617 c 1.353421,-0.310159 1.353421,-0.310159 1.353421,-2.998288 0,-1.534227 -0.05572,-2.627602 -0.129797,-2.547123 -0.101525,0.110295 -2.316061,4.831583 -2.659547,5.670031 -0.09645,0.23543 -0.15884,0.240844 1.435923,-0.12462 z"\r\n                      id="rotateImage"\r\n                      inkscape:connector-curvature="0">\r\n                    <title>'+a(s(n,"i18n").call(i,"threed.rotate.reset",{name:"i18n",hash:{},data:o,loc:{start:{line:100,column:27},end:{line:100,column:57}}}))+'</title>\r\n                </path>\r\n                <path class="tc-view-3d-cm-rotate-outer tc-view-3d-cm-rotate-outer-circle"\r\n                      inkscape:connector-curvature="0"\r\n                      d="m 48.010487,48.839422 c -6.246102,0 -11.312196,5.070128 -11.312196,11.324146 0,6.254017 5.066094,11.330914 11.312196,11.330914 6.246102,0 11.312196,-5.076897 11.312196,-11.330914 0,-6.254018 -5.066094,-11.324146 -11.312196,-11.324146 z m 0,4.156022 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z"\r\n                      id="rotateOuter">\r\n                    <title>'+a(s(n,"i18n").call(i,"threed.rotate.drag",{name:"i18n",hash:{},data:o,loc:{start:{line:106,column:27},end:{line:106,column:56}}}))+'</title>\r\n                </path>\r\n                <path class="tc-view-3d-cm-rotate-outer tc-view-3d-cm-rotate-outer-shell-circle"\r\n                      d="m 48.010487,48.839422 c -6.246102,0 -11.312196,5.070128 -11.312196,11.324146 0,6.254017 5.066094,11.330914 11.312196,11.330914 6.246102,0 11.312196,-5.076897 11.312196,-11.330914 0,-6.254018 -5.066094,-11.324146 -11.312196,-11.324146 z m 0,0.379051 c 2.995132,0 5.705501,1.203885 7.681205,3.154245 l -2.386853,2.382605 0.135232,0.135376 2.386853,-2.382606 c 1.930016,1.972963 3.12387,4.674054 3.12387,7.655475 0,2.981421 -1.193854,5.680844 -3.12387,7.655474 l -2.386853,-2.382605 -0.135232,0.135375 2.386853,2.382606 c -1.975664,1.951759 -4.686314,3.161013 -7.681205,3.161013 -1.94179,0 -3.766282,-0.506879 -5.347316,-1.395323 -0.850442,-0.477894 -1.630441,-1.06619 -2.320365,-1.745384 l 2.407138,-2.402912 c 1.358381,1.325983 3.214811,2.145699 5.260543,2.145699 4.163407,0 7.545972,-3.385283 7.545972,-7.553943 0,-4.168661 -3.382565,-7.547175 -7.545972,-7.547175 -2.045732,0 -3.902162,0.81461 -5.260543,2.13893 l -2.407138,-2.402912 c 1.972594,-1.940536 4.681097,-3.133938 7.667681,-3.133938 z m -0.189325,0.182756 v 3.01887 h 0.378651 v -3.01887 z m -7.606826,3.086558 2.400376,2.402912 c -1.326946,1.360319 -2.143435,3.221129 -2.143435,5.272869 0,2.05174 0.816489,3.910884 2.143435,5.272869 l -2.400376,2.402912 c -0.435151,-0.44326 -0.832923,-0.923297 -1.188195,-1.435068 -0.462681,-0.666492 -0.853281,-1.386809 -1.160484,-2.149815 -0.508689,-1.263436 -0.788715,-2.64392 -0.788715,-4.090898 0,-2.99182 1.197141,-5.70104 3.137394,-7.675781 z m 7.796151,0.507657 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z m -10.744219,6.978598 v 0.379051 h 3.022445 v -0.379051 z m 18.513325,0 v 0.379051 H 58.8088 v -0.379051 z m -7.931385,7.932994 v 3.01887 h 0.37189 v -3.01887 z"\r\n                      id="rotateShell"\r\n                      inkscape:connector-curvature="0"\r\n                      sodipodi:nodetypes="ssssssccccsccccssccsssccscccccccsccssscsssssccccccccccccccc">\r\n                    <title>'+a(s(n,"i18n").call(i,"threed.rotate.drag",{name:"i18n",hash:{},data:o,loc:{start:{line:113,column:27},end:{line:113,column:56}}}))+"</title>\r\n                </path>\r\n            </g>            \r\n        </g>\r\n    </svg>\r\n</div>"},useData:!0};const n=function(t,e){var n=this;n.map=t,n.parent=e,Promise.resolve(n.map.getViewHTML()).then(function(t){n.viewHTML=t}.bind(n)),n.metersPerUnit=t.getMetersPerUnit(),n.maxResolution=null,n._oldMapSetCenter=t.setCenter,t.setCenter=function(r,o){t.on3DView?t.view3D.flyToMapCoordinates.call(e,r):n._oldMapSetCenter.call(t,r,o)}};n.prototype.getCenter=function(){return this.map.getCenter()},n.prototype.getExtent=function(){return this.map.getExtent()},n.prototype.getResolution=function(){return this.map.getResolution()},n.prototype.getRotation=function(){return this.map.getRotation()},n.prototype.getMaxResolution=function(){if(this.maxResolution)return this.maxResolution;if(null!==this.map.getResolutions())this.maxResolution=this.map.getResolutions()[0];else{var t=this.map.options.baselayerExtent;this.maxResolution=(t[2]-t[0])/this.parent.Consts.DEFAULT_TILE_SIZE}return this.maxResolution},n.prototype.getPixelFromCoordinate=function(t){return this.map.getPixelFromCoordinate(t)},n.prototype.setCenter=function(t){this._oldMapSetCenter.call(this.map,t)},n.prototype.setExtent=function(t){this.map.setExtent(t)},n.prototype.setResolution=function(t){this.map.setResolution(t)},n.prototype.setRotation=function(t){this.map.setRotation(t)};const o=function(t,e){return t.type===r.Z.Consts.layerType.WMTS?t.wrap.getCompatibleMatrixSets(e).length>0:t.isCompatible(e)},i=function(t,e){var n=1e6,r=e[0]-t[0],o=e[1]-t[1],i=Math.atan(o/r);return r<0&&(i+=Math.PI),[t[0]+n*Math.cos(i),t[1]+n*Math.sin(i)]},a=function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r},s=function(t){var e=this;if((t=t||{}).nearMapCoords){var n=t.bottomPixel.clone();n.y=Math.round(9*n.y/10);var r=l.call(e,n);if(r){var o=[t.nearMapCoords,r].sort((function(e,n){return a(t.cameraPosition,e)-a(t.cameraPosition,n)}));return i.apply(this,o)}}return null},l=function(t){var e=this,n=d(e.viewer.scene,t);return n?(n=cesium.Cartographic.fromCartesian(n),e.view3D.crs!==e.view3D.view2DCRS?r.Z.Util.reproject([cesium.Math.toDegrees(n.longitude),cesium.Math.toDegrees(n.latitude)],e.view3D.crs,e.view3D.view2DCRS):[cesium.Math.toDegrees(n.longitude),cesium.Math.toDegrees(n.latitude)]):null},c=function(t,e){var n=this,r=n.viewer.camera.frustum.fovy,o=t*n.mapView.viewHTML.getBoundingClientRect().height,i=Math.cos(Math.abs(e));return o*n.mapView.metersPerUnit*i/2/Math.tan(r/2)},u=function(t,e){var n=this,r=n.viewer.scene.canvas,o=n.viewer.camera.frustum.fovy,i=2*t*Math.tan(o/2),a=Math.cos(Math.abs(e)),s=i/n.mapView.metersPerUnit/a/r.clientHeight,l=n.map.getResolutions();if(null===l)for(var c=0,u=(l=new Array(22)).length;c<u;++c)l[c]=n.mapView.getMaxResolution()/Math.pow(2,c);for(c=0;c<l.length;c++){if(l[c]<Math.abs(s)){s=l[c-1];break}if(l[c]===Math.abs(s)){s=l[c];break}c===l.length-1&&(s=l[c])}return s},p=function(t,e,n,r,o){var i,a=cesium.Math.clamp,s=cesium.defaultValue,l=o||{},c=s(l.duration,500),u=function(t){return t},p=s(l.easing,u),d=l.callback,h=0,f=new cesium.Matrix4;return new Promise((function(o,s){function l(s){i||(i=s);var u=p(a((s-i)/c,0,1));t.transform.clone(f);var m=(u-h)*e;h=u,t.lookAtTransform(r),t.rotate(n,m),t.lookAtTransform(f),u<1?requestAnimationFrame(l):(d&&d(),o())}requestAnimationFrame(l)}))},d=function(t,e){var n=t.camera.getPickRay(e);return t.globe.pick(n,t)||t.camera.pickEllipsoid(e)},h=function(t){var e=t.canvas,n=new cesium.Cartesian2(e.clientWidth/2,e.clientHeight/2);return d(t,n)},f=function(t){var e=t.canvas,n=new cesium.Cartesian2(e.clientWidth/2,e.clientHeight);return d(t,n)},m=function(t){var e=t.camera,n=e.frustum.fovy/2,r=e.direction,o=cesium.Quaternion.fromAxisAngle(e.right,n),i=cesium.Matrix3.fromQuaternion(o),a=new cesium.Cartesian3;return cesium.Matrix3.multiplyByVector(i,r,a),new cesium.Ray(e.position,a)},g=function(t,e,n,r){var o=t.camera,i=v(t,n),a=o.right,s=cesium.Quaternion.fromAxisAngle(a,i),l=cesium.Matrix3.fromQuaternion(s),c=new cesium.Cartesian3;cesium.Cartesian3.subtract(o.position,n,c);var u=new cesium.Cartesian3;cesium.Matrix3.multiplyByVector(l,c,u),cesium.Cartesian3.add(u,n,u);var d=cesium.Matrix4.fromTranslation(u);p(o,e,u,d,r)},y=function(t,e,n){var r=new cesium.Cartesian3,o=new cesium.Cartesian3,i=new cesium.Cartesian3;cesium.Cartesian3.normalize(t,r),cesium.Cartesian3.normalize(e,o),cesium.Cartesian3.cross(r,o,i);var a=cesium.Cartesian3.dot(r,o),s=cesium.Cartesian3.magnitude(i),l=cesium.Cartesian3.dot(n,i),c=Math.atan2(s,a);return l>=0?c:-c},v=function(t,e){var n=t.camera,r=n.frustum.fovy/2,o=m(t),i=cesium.Cartesian3.clone(o.direction);cesium.Cartesian3.negate(i,i);var a=new cesium.Cartesian3;cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(e,a);var s=new cesium.Cartesian3;return cesium.Cartesian3.negate(n.right,s),y(a,i,s)+r},_=function(t,e,n,o,i,a){const s=this;return new Promise((function(i,l){var c=t.map((function(t){var e=t;return s.view3D.view2DCRS!==s.view3D.crs&&(e=r.Z.Util.reproject(t,s.view3D.view2DCRS,s.view3D.crs)),cesium.Cartographic.fromDegrees(e[0],e[1])}));cesium.when(s.viewer.terrainProvider.sampleTerrainMostDetailed(c),(function(r){var s,l,c=0;if(e===ol.geom.GeometryLayout.XYZM)s=t[0][3],l=t[t.length-1][3];else if(e===ol.geom.GeometryLayout.XYM)s=t[0][2],l=t[t.length-1][2];else{t[0][3]=r[0].time=Date.now();for(var u=1;u<r.length;u++){var p;let e=[];r[u].time=0,e=u+1<r.length?r.slice(u-1,u+1):r.slice(u-1),c+=p=new cesium.EllipsoidGeodesic(e[0],e[1]).surfaceDistance,t[u][3]=r[u].time=r[u-1].time+36e5*p/a}s=r[0].time,l=r[r.length-1].time}if(0===c)for(u=1;u<r.length;u++){let t=[];t=u+1<r.length?r.slice(u-1,u+1):r.slice(u-1),c+=new cesium.EllipsoidGeodesic(t[0],t[1]).surfaceDistance}s=new Date(s).toISOString(),l=new Date(l).toISOString();var d=[{id:"document",name:"CZML Model",version:"1.0"},{id:"path",name:n,availability:s+"/"+l,position:{epoch:s,cartographicRadians:r.map((function(n,r){return e===ol.geom.GeometryLayout.XYZM?[new Date(t[r][3]).toISOString(),n.longitude,n.latitude,n.height]:e===ol.geom.GeometryLayout.XYM?[new Date(t[r][2]).toISOString(),n.longitude,n.latitude,n.height]:[new Date(n.time).toISOString(),n.longitude,n.latitude,n.height]})).reduce((function(t,e){return t.concat(e)}))},point:{heightReference:"CLAMP_TO_GROUND",pixelSize:o.radius,color:{rgba:o.fillColor},outlineColor:{rgba:o.strokeColor},outlineWidth:o.strokeWidth}}];i({czml:d,totalDistance:c,coordinates2D:t})}))}))},C=function(t){var e=this;e.parent=t;var n=function(t){this.isFocusingCameraCtrls=!1},o=function(){var t=this;t.isFocusingCameraCtrls=!0,t.lastFocused=performance.now(),t.div.classList.contains(t.parent.classes.OUTFOCUS)&&(t.div.classList.remove(t.parent.classes.OUTFOCUS),t.tiltIndicatorOuterCircle.classList.remove(t.parent.classes.OUTFOCUS),t.tiltIndicatorOuterShellCircle.classList.remove(t.parent.classes.OUTFOCUS),t.rotateIndicatorOuterCircle.classList.remove(t.parent.classes.OUTFOCUS),t.rotateIndicatorOuterShellCircle.classList.remove(t.parent.classes.OUTFOCUS))},i=function(){this.moving=!0},a=function(){this.moving=!1},c=function(){var t=this,e=t.parent;t.parent.view3D.isLoadingTiles.call(t.parent)&&t.customCollisionDetection();var n=t.getCamera(),o=n.positionCartographic;t.moving&&(p(t.tiltIndicator,n.pitch),p(t.rotateIndicator,-n.heading),t.disableRotate(),t.disableTilt(5),e.view3D.crs!==e.view3D.view2DCRS?t._coordsXY=r.Z.Util.reproject([cesium.Math.toDegrees(o.longitude),cesium.Math.toDegrees(o.latitude)],e.view3D.crs,e.view3D.view2DCRS):t._coordsXY=[cesium.Math.toDegrees(o.longitude),cesium.Math.toDegrees(o.latitude)],e.mapView.setCenter(t._coordsXY),e.mapView.setResolution(u.call(e,o.height,o.latitude))),t._coordsXY&&(e._ovMap=e._ovMap||e.map.getControlsByClass("TC.control.OverviewMap")[0],e._ovMap&&e._ovMap.renderPromise().then((function(){var r=e.viewer.scene.canvas,o=new cesium.Cartesian2(0,r.clientHeight-1),i=new cesium.Cartesian2(r.clientWidth-1,r.clientHeight-1),a=[o,i,new cesium.Cartesian2(r.clientWidth-1,0),new cesium.Cartesian2(0,0)].map((function(t){return l.call(e,t)})).filter((function(t){return null!==t}));if(a.length&&a.length<4){var c=s.call(e,{nearMapCoords:a[0],bottomPixel:o,cameraPosition:t._coordsXY}),u=s.call(e,{nearMapCoords:a[1],bottomPixel:i,cameraPosition:t._coordsXY});c&&u&&(a[2]=u,a[3]=c)}e._ovMap.wrap.draw3DCamera({position:t._coordsXY,heading:n.heading,fov:a})})))},p=function(t,e){var n=t.getBBox();const r="rotate("+cesium.Math.toDegrees(e)+" "+(n.x+n.width/2)+" "+(n.y+n.height/2)+")";document.getElementsByClassName(t.className.baseVal)[0].setAttribute("transform",r)};e.outControlsEvents=r.Z.Util.detectMouse()?["mouseleave"]:["touchleave","touchend"],e.outControls=n.bind(e),e.inControlsEvents=r.Z.Util.detectMouse()?["mouseenter"]:["touchmove","touchstart"],e.inControls=o.bind(e),e.moveStart=i.bind(e),e.moveEnd=a.bind(e),e.postRender=c.bind(e),e.selectors={tilt:"-cm-tilt",rotate:"-cm-rotate",indicator:"-indicator",leftArrow:"-left",rightArrow:"-right",downArrow:"-down",upArrow:"-up"},e.MIN_TILT=cesium.Math.toRadians(-89),e.MAX_TILT=cesium.Math.toRadians(-1),e.render()};C.prototype.bind=function(){var t=this;function e(){t.lastFocused||(t.lastFocused=performance.now()),performance.now()-t.lastFocused>5e3&&!0!==t.isFocusingCameraCtrls&&(t.div.classList.contains(t.parent.classes.OUTFOCUS)||(t.div.classList.add(t.parent.classes.OUTFOCUS),t.tiltIndicatorOuterCircle.classList.add(t.parent.classes.OUTFOCUS),t.tiltIndicatorOuterShellCircle.classList.add(t.parent.classes.OUTFOCUS),t.rotateIndicatorOuterCircle.classList.add(t.parent.classes.OUTFOCUS),t.rotateIndicatorOuterShellCircle.classList.add(t.parent.classes.OUTFOCUS))),t.rAFInOutControls=requestAnimationFrame(e)}t.getCamera().moveStart.addEventListener(t.moveStart),t.getCamera().moveEnd.addEventListener(t.moveEnd),t.parent.viewer.scene.postRender.addEventListener(t.postRender),t.outControlsEvents.forEach((function(e){t.div.addEventListener(e,t.outControls)})),t.inControlsEvents.forEach((function(e){t.div.addEventListener(e,t.inControls)})),t.rAFInOutControls=requestAnimationFrame(e)},C.prototype.unbind=function(){var t=this;t.div.classList.add(r.Z.Consts.classes.HIDDEN),t.getCamera().moveStart.removeEventListener(t.moveStart),t.getCamera().moveEnd.removeEventListener(t.moveEnd),t.parent.viewer.scene.postRender.removeEventListener(t.postRender),t.outControlsEvents.forEach((function(e){t.div.removeEventListener(e,t.outControls)})),t.inControlsEvents.forEach((function(e){t.div.removeEventListener(e,t.inControls)})),window.cancelAnimationFrame(t.rAFInOutControls),t.lastFocused=void 0,t.rAFInOutControls=void 0},C.prototype.getCamera=function(){return this.parent.viewer.scene.camera},C.prototype.getCameraState=function(){var t=this;if(t.parent.viewer){var e=t.parent.viewer.scene.camera,n=e.positionCartographic,r=f(t.parent.viewer.scene);if(r){var o=cesium.Cartesian3.distance(e.position,r);return{cp:[n.longitude,n.latitude,n.height],chpr:[e.heading,e.pitch,e.roll],bcpd:o}}}},C.prototype.render=function(){var t=this;t.div?(t.div.classList.remove(r.Z.Consts.classes.HIDDEN),t.bind()):t.parent.getRenderedHtml(t.parent.CLASS+"-cm-ctls",{},function(e){t.div=document.createElement("div"),t.div.classList.add(t.parent.CLASS+"-cm-ctls"),t.div.innerHTML=e,t.parent.map.div.appendChild(t.div);var n="."+t.parent.CLASS+t.selectors.tilt;t.tiltIndicatorInner=t.div.querySelector("[class^="+n.replace(".","")+"-inner]"),t.tiltIndicatorInner.addEventListener(r.Z.Consts.event.CLICK,t.resetTilt.bind(t)),t.tiltIndicator=t.div.querySelector(n+"-indicator"),t.tiltIndicatorOuterCircle=t.div.querySelector(n+"-outer-circle"),t.tiltIndicatorOuterShellCircle=t.div.querySelector(n+"-outer-shell-circle"),t.tiltIndicatorCircle=t.div.querySelector("[class^="+n.replace(".","")+"-outer]"),t.tiltIndicatorCircle.addEventListener("mousedown",function(t){var e=this;t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault();var n=new cesium.Cartesian2,r=t.currentTarget,o=t.currentTarget.getBoundingClientRect(),i=new cesium.Cartesian2((o.right-o.left)/2,(o.bottom-o.top)/2),a=new cesium.Cartesian2(t.clientX-o.left,t.clientY-o.top),s=cesium.Cartesian2.subtract(a,i,n);return e.draggingTilt.call(e,r,s),t.cancelBubble=!0,t.returnValue=!1,!1}.bind(t)),t.tiltUp=t.div.querySelector(n+t.selectors.upArrow),t.tiltUp.addEventListener(r.Z.Util.detectMouse()?"mousedown":"touchstart",function(e){if(e.target.disabled)return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,!1;e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),t.inControls(e);var n=r.Z.Util.detectMouse()?"mouseup":"touchend";return document.removeEventListener(n,t.tiltUpMouseUpFunction,!1),t.tiltUpMouseUpFunction=void 0,t.tilt.call(t,5),t.tiltUpInterval=setInterval(function(){t.isTiltUpDisabled?t.tiltUpMouseUpFunction():t.tilt.call(t,5)}.bind(t),101),t.tiltUpMouseUpFunction=function(){clearInterval(t.tiltUpInterval),t.tiltUpInterval=void 0,document.removeEventListener(n,t.tiltUpMouseUpFunction,!1),t.tiltUpMouseUpFunction=void 0},document.addEventListener(n,t.tiltUpMouseUpFunction,!1),e.cancelBubble=!0,e.returnValue=!1,!1}.bind(t)),t.tiltDown=t.div.querySelector(n+t.selectors.downArrow),t.tiltDown.addEventListener(r.Z.Util.detectMouse()?"mousedown":"touchstart",function(e){if(e.target.disabled)return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,!1;e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),t.inControls(e);var n=r.Z.Util.detectMouse()?"mouseup":"touchend";return document.removeEventListener(n,t.tiltDownMouseUpFunction,!1),t.tiltDownMouseUpFunction=void 0,t.tilt.call(t,-5),t.tiltDownInterval=setInterval(function(){t.isTiltDownDisabled?t.tiltDownMouseUpFunction():t.tilt.call(t,-5)}.bind(t),101),t.tiltDownMouseUpFunction=function(){clearInterval(t.tiltDownInterval),t.tiltDownInterval=void 0,document.removeEventListener(n,t.tiltDownMouseUpFunction,!1),t.tiltDownMouseUpFunction=void 0},document.addEventListener(n,t.tiltDownMouseUpFunction,!1),e.cancelBubble=!0,e.returnValue=!1,!1}.bind(t));var o="."+t.parent.CLASS+t.selectors.rotate;t.rotateIndicatorInner=t.div.querySelector("[class^="+o.replace(".","")+"-inner]"),t.rotateIndicatorInner.addEventListener(r.Z.Consts.event.CLICK,t.resetRotation.bind(t)),t.rotateIndicator=t.div.querySelector(o+"-indicator"),t.rotateIndicatorOuterCircle=t.div.querySelector(o+"-outer-circle"),t.rotateIndicatorOuterShellCircle=t.div.querySelector(o+"-outer-shell-circle"),t.rotateIndicatorCircle=t.div.querySelector("[class^="+o.replace(".","")+"-outer]"),t.rotateIndicatorCircle.addEventListener("mousedown",function(t){var e=this;t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault();var n=new cesium.Cartesian2,r=t.currentTarget,o=t.currentTarget.getBoundingClientRect(),i=new cesium.Cartesian2((o.right-o.left)/2,(o.bottom-o.top)/2),a=new cesium.Cartesian2(t.clientX-o.left,t.clientY-o.top),s=cesium.Cartesian2.subtract(a,i,n);return e.draggingRotate.call(e,r,s),t.cancelBubble=!0,t.returnValue=!1,!1}.bind(t)),t.rotateLeft=t.div.querySelector(o+t.selectors.leftArrow),t.rotateLeft.addEventListener(r.Z.Util.detectMouse()?"mousedown":"touchstart",function(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),t.inControls(e);var n=r.Z.Util.detectMouse()?"mouseup":"touchend";return document.removeEventListener(n,t.rotateLeftMouseUpFunction,!1),t.rotateLeftMouseUpFunction=void 0,t.rotate.call(t,-15),t.rotateLeftInterval=setInterval(function(){t.rotate.call(t,-15)}.bind(t),101),t.rotateLeftMouseUpFunction=function(){clearInterval(t.rotateLeftInterval),t.rotateLeftInterval=void 0,document.removeEventListener(n,t.rotateLeftMouseUpFunction,!1),t.rotateLeftMouseUpFunction=void 0},document.addEventListener(n,t.rotateLeftMouseUpFunction,!1),e.cancelBubble=!0,e.returnValue=!1,!1}.bind(t)),t.rotateRight=t.div.querySelector(o+t.selectors.rightArrow),t.rotateRight.addEventListener(r.Z.Util.detectMouse()?"mousedown":"touchstart",function(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),t.inControls(e);var n=r.Z.Util.detectMouse()?"mouseup":"touchend";return document.removeEventListener(n,t.rotateRightMouseUpFunction,!1),t.rotateRightMouseUpFunction=void 0,t.rotate.call(t,15),t.rotateRightInterval=setInterval(function(){t.rotate.call(t,15)}.bind(t),101),t.rotateRightMouseUpFunction=function(){clearInterval(t.rotateRightInterval),t.rotateRightInterval=void 0,document.removeEventListener(n,t.rotateRightMouseUpFunction,!1),t.rotateRightMouseUpFunction=void 0},document.addEventListener(n,t.rotateRightMouseUpFunction,!1),e.cancelBubble=!0,e.returnValue=!1,!1}.bind(t)),t.bind()}.bind(this))},C.prototype.disableTilt=function(t){var e=this,n=cesium.Math.toRadians(t),r=e.getCamera().pitch;e.isTiltDownDisabled=r+-n<e.MIN_TILT,e.isTiltUpDisabled=r+n>e.MAX_TILT,e.tiltUp.disabled=e.isTiltUpDisabled,e.tiltUp.classList.toggle(e.parent.classes.CAMERACTRARROWDISABLED,e.isTiltUpDisabled),e.tiltDown.disabled=e.isTiltDownDisabled,e.tiltDown.classList.toggle(e.parent.classes.CAMERACTRARROWDISABLED,e.isTiltDownDisabled)},C.prototype.disableRotate=function(){var t=this,e=!0,n=t.parent.viewer.scene.canvas,r=[new cesium.Cartesian2(0,n.clientHeight-1),new cesium.Cartesian2(n.clientWidth-1,n.clientHeight-1),new cesium.Cartesian2(n.clientWidth-1,0),new cesium.Cartesian2(0,0)].map(function(t){return l.call(this,t)}.bind(t.parent)).filter((function(t){return null!==t}));return r.length&&r.length>=2&&(e=!1),t.rotateIndicatorInner.disabled=e,t.rotateLeft.disabled=e,t.rotateLeft.classList.toggle(t.parent.classes.CAMERACTRARROWDISABLED,e),t.rotateRight.disabled=e,t.rotateRight.classList.toggle(t.parent.classes.CAMERACTRARROWDISABLED,e),e},C.prototype.tilt=function(t){var e=this;if(e.disableTilt(t),e.parent.viewer&&e.parent.viewer.trackedEntity)e.getCamera().rotateUp(cesium.Math.toRadians(t));else{if(null==h(e.parent.viewer.scene)&&(t>0?e.getCamera().lookUp():e.getCamera().lookDown()),t>=cesium.Math.PI_OVER_TWO&&e.isTiltUpDisabled||t<=-cesium.Math.PI_OVER_TWO&&e.isTiltDownDisabled)return;var n=cesium.Math.toRadians(t),r=h(e.parent.viewer.scene);if(r){var o=cesium.Matrix4.fromTranslation(r);e.parent.view3D.rotateAroundAxis(e.getCamera(),-n,e.getCamera().right,o,{duration:100})}}},C.prototype.rotate=function(t){var e=this;if(t=cesium.Math.toRadians(t),e.parent.viewer&&e.parent.viewer.trackedEntity)e.getCamera().rotateRight(-t);else{var n=f(e.parent.viewer.scene);n&&g(e.parent.viewer.scene,t,n,{duration:100})}},C.prototype.draggingTilt=function(t,e){var n=this;n.tiltIndicatorOuterCircle.classList.add(n.parent.classes.HIGHLIGHTED);var r=new cesium.Matrix4,o=new cesium.Matrix4,i=new cesium.Cartesian2;document.removeEventListener("mousemove",n.tiltMouseMoveFunction,!1),document.removeEventListener("mouseup",n.tiltMouseUpFunction,!1),n.tiltMouseMoveFunction=void 0,n.tiltMouseUpFunction=void 0,n.isTilting=!0;var a=n.parent.viewer.scene,s=a.camera,l=h(a);l?(n.tiltFrame=cesium.Transforms.northUpEastToFixedFrame(l,cesium.Ellipsoid.WGS84,o),n.tiltIsLook=!1):(n.tiltFrame=cesium.Transforms.northUpEastToFixedFrame(s.positionWC,cesium.Ellipsoid.WGS84,o),n.tiltIsLook=!0),n.startCursorAngle=Math.atan2(-e.y,e.x);var c=cesium.Matrix4.clone(s.transform,r);s.lookAtTransform(n.tiltFrame),n.initialCameraAngle=Math.atan2(s.position.y,s.position.x),s.lookAtTransform(c),n.tiltMouseMoveFunction=function(e){var n=this;a=n.parent.viewer.scene,s=a.camera;var o=t.getBoundingClientRect();const l=new cesium.Cartesian2((o.right-o.left)/2,(o.bottom-o.top)/2);var u=new cesium.Cartesian2(e.clientX-o.left,e.clientY-o.top),p=cesium.Cartesian2.subtract(u,l,i);console.log("Entra: "+p.toString());var d=Math.atan2(-p.y,p.x)-n.startCursorAngle,h=cesium.Math.zeroToTwoPi(n.initialCameraAngle-d);try{c=cesium.Matrix4.clone(s.transform,r),s.lookAtTransform(n.tiltFrame);var f=h-Math.atan2(s.position.y,s.position.x),m=s.pitch;(m+=f)<n.MIN_TILT?s.rotate(s.right,s.pitch-n.MIN_TILT):m>n.MAX_TILT?s.rotate(s.right,s.pitch-n.MAX_TILT):s.rotate(s.right,-f),n.disableTilt(5),s.lookAtTransform(c)}catch(e){n.tiltMouseUpFunction()}}.bind(n),n.tiltMouseUpFunction=function(t){n.tiltIndicatorOuterCircle.classList.remove(n.parent.classes.HIGHLIGHTED),n.isTilting=!1,document.removeEventListener("mousemove",n.tiltMouseMoveFunction,!1),document.removeEventListener("mouseup",n.tiltMouseUpFunction,!1),n.tiltMouseMoveFunction=void 0,n.tiltMouseUpFunction=void 0},document.addEventListener("mousemove",n.tiltMouseMoveFunction,!1),document.addEventListener("mouseup",n.tiltMouseUpFunction,!1)},C.prototype.draggingRotate=function(t,e){var n=this;if(document.removeEventListener("mousemove",n.rotateMouseMoveFunction,!1),document.removeEventListener("mouseup",n.rotateMouseUpFunction,!1),n.rotateMouseMoveFunction=void 0,n.rotateMouseUpFunction=void 0,n.rotateMouseMoveFunction=function(e){var o=t.getBoundingClientRect(),s=new cesium.Cartesian2((o.right-o.left)/2,(o.bottom-o.top)/2),c=new cesium.Cartesian2(e.clientX-o.left,e.clientY-o.top),u=cesium.Cartesian2.subtract(c,s,i),p=Math.atan2(-u.y,u.x)-n.rotateInitialCursorAngle,d=cesium.Math.zeroToTwoPi(n.rotateInitialCameraAngle-p);a=n.parent.viewer.scene.camera;try{l=cesium.Matrix4.clone(a.transform,r),a.lookAtTransform(n.rotateFrame);var h=Math.atan2(a.position.y,a.position.x);a.rotateRight(d-h),a.lookAtTransform(l)}catch(e){n.rotateMouseUpFunction()}},n.rotateMouseUpFunction=function(t){n.isRotating=!1,n.rotateIndicatorOuterCircle.classList.remove(n.parent.classes.HIGHLIGHTED),document.removeEventListener("mousemove",n.rotateMouseMoveFunction,!1),document.removeEventListener("mouseup",n.rotateMouseUpFunction,!1),n.rotateMouseMoveFunction=void 0,n.rotateMouseUpFunction=void 0},n.disableRotate())n.rotateMouseUpFunction();else{n.rotateIndicatorOuterCircle.classList.add(n.parent.classes.HIGHLIGHTED);var r=new cesium.Matrix4,o=new cesium.Matrix4,i=new cesium.Cartesian2;n.isRotating=!0,n.rotateInitialCursorAngle=Math.atan2(-e.y,e.x);var a=n.parent.viewer.scene.camera,s=h(n.parent.viewer.scene);null!=s&&null!=s||null!=(s=f(n.parent.viewer.scene))&&null!=s?(n.rotateFrame=cesium.Transforms.eastNorthUpToFixedFrame(s,cesium.Ellipsoid.WGS84,o),n.rotateIsLook=!1):(n.rotateFrame=cesium.Transforms.eastNorthUpToFixedFrame(a.positionWC,cesium.Ellipsoid.WGS84,o),n.rotateIsLook=!0);try{var l=cesium.Matrix4.clone(a.transform,r);a.lookAtTransform(n.rotateFrame),n.rotateInitialCameraAngle=Math.atan2(a.position.y,a.position.x),n.rotateInitialCameraDistance=cesium.Cartesian3.magnitude(new cesium.Cartesian3(a.position.x,a.position.y,0)),a.lookAtTransform(l)}catch(t){n.rotateMouseUpFunction()}document.addEventListener("mousemove",n.rotateMouseMoveFunction,!1),document.addEventListener("mouseup",n.rotateMouseUpFunction,!1)}},C.prototype.resetTilt=function(){var t=this,e=-t.getCamera().pitch-cesium.Math.toRadians(50);t.tilt(cesium.Math.toDegrees(e))},C.prototype.resetRotation=function(t){const e=this;return new Promise((function(n,r){var o;for(o=-e.getCamera().heading;o<-Math.PI;)o+=2*Math.PI;for(;o>Math.PI;)o-=2*Math.PI;t?t.callback=function(){n()}:n(),e.parent.viewer&&e.parent.viewer.trackedEntity&&e.parent.view3D.linked2DControls.geolocation.videoControls.call(e,{target:{className:"stop"},custom:!0});var i=f(e.parent.viewer.scene);i&&g(e.parent.viewer.scene,o,i,t)}))},C.prototype.customCollisionDetection=function(){var t,e,n=this,r=new cesium.Matrix4,o=new cesium.Cartographic,i=n.parent.viewer.scene,a=n.parent.viewer.scene.camera,s=i.screenSpaceCameraController,l=(s.enableCollisionDetection,s.minimumCollisionTerrainHeight),c=s.minimumZoomDistance,u=i.globe,p=u.ellipsoid;i.mapProjection,cesium.Matrix4.equals(a.transform,cesium.Matrix4.IDENTITY)||(t=cesium.Matrix4.clone(a.transform,r),e=cesium.Cartesian3.magnitude(a.position),a._setTransform(cesium.Matrix4.IDENTITY));var d=o;p.cartesianToCartographic(a.position,d);var h=!1;if(d.height<l){var f=u.getHeight(d);null!=f&&(f+=c,d.height<f&&(d.height=f,p.cartographicToCartesian(d,a.position),h=!0))}null!=t&&(a._setTransform(t),h&&(cesium.Cartesian3.normalize(a.position,a.position),cesium.Cartesian3.negate(a.position,a.direction),cesium.Cartesian3.multiplyByScalar(a.position,Math.max(e,c),a.position),cesium.Cartesian3.normalize(a.direction,a.direction),cesium.Cartesian3.cross(a.direction,a.up,a.right),cesium.Cartesian3.cross(a.right,a.direction,a.up)))},C.prototype.limitCameraToInitExtent=function(){var t=this,e=t.viewer.camera.positionCartographic.clone();if(!(e.longitude>=t.initExtent.west&&e.longitude<=t.initExtent.east&&e.latitude>=t.initExtent.south&&e.latitude<=t.initExtent.north)){var n=t.viewer.scene.screenSpaceCameraController.maximumZoomDistance,r=.05*e.height/n;e.longitude=Math.max(t.initExtent.west-r,e.longitude),e.latitude=Math.max(t.initExtent.south-r,e.latitude),e.longitude=Math.min(t.initExtent.east+r,e.longitude),e.latitude=Math.min(t.initExtent.north+r,e.latitude),t.viewer.camera.setView({destination:cesium.Ellipsoid.WGS84.cartographicToCartesian(e),orientation:{heading:t.viewer.camera.heading,pitch:t.viewer.camera.pitch}})}t.viewer.scene.screenSpaceCameraController.minimumZoomDistance=e.height>1800?400:200};const E=function(t){var e,n=!1,o=null,i=null,a=null,s=t.map.getResolution,l=function(e){if(i)return Promise.resolve();{const a={content:"table",titles:{main:r.Z.Util.getLocaleString(t.map.options.locale,"threed.rs.panel.gfi"),max:r.Z.Util.getLocaleString(t.map.options.locale,"threed.rs.panel.gfi")}};var n,o=t.map.getControlsByClass("TC.control.ControlContainer")[0];return o?(a.position=o.POSITION.RIGHT,n=o.addControl("resultsPanel",a)):(a.div=document.createElement("div"),t.map.div.appendChild(a.div),n=t.map.addControl("resultsPanel",a)),n.then((function(t){t.caller=e,i=t,e.resultsPanel=i}))}},c=function(e){if(o)o.position=e;else{var n={position:e,billboard:{image:r.Z.Util.getBackgroundUrlFromCss(t.CLASS+"-marker"),eyeOffset:new cesium.Cartesian3(0,0,-100),verticalOrigin:cesium.VerticalOrigin.BOTTOM,heightReference:cesium.HeightReference.CLAMP_TO_GROUND}};o=t.view3D.addNativeFeature.call(t,n)}t.viewer.scene.requestRender()},u=function(){t.view3D.removeFeature.call(t,o),o=null};(a=t.map.getControlsByClass(r.Z.control.FeatureInfo)[0])&&(e=a.displayMode,l(a).then((function(){a.setDisplayMode(r.Z.Consts.infoContainer.RESULTS_PANEL),t.map.on(r.Z.Consts.event.RESULTSPANELCLOSE,(function(t){t.control===a.getDisplayControl()&&(a.querying||u())}))}))),this.clear=function(){a.closeResults(),u()},this.reset=function(){this.clear(),a.setDisplayMode(e),t.map.getResolution=s},this.send=function(e){return new Promise((function(o,i){n=!0,a.displayMode!==r.Z.Consts.infoContainer.RESULTS_PANEL&&a.setDisplayMode(r.Z.Consts.infoContainer.RESULTS_PANEL),a.resultsPanel&&a.resultsPanel.close(),t.waiting||(t.waiting=t.map.getLoadingIndicator().addWait()),c(e),l(a).then((function(){var i,s=cesium.Ellipsoid.WGS84.cartesianToCartographic(e);i=t.view3D.crs!==t.view3D.view2DCRS?r.Z.Util.reproject([cesium.Math.toDegrees(s.longitude),cesium.Math.toDegrees(s.latitude)],t.view3D.crs,t.view3D.view2DCRS):[cesium.Math.toDegrees(s.longitude),cesium.Math.toDegrees(s.latitude)],t.map.options.pixelTolerance||r.Z.Cfg.pixelTolerance;for(var l,c=t.viewer.scene.globe._surface._tilesToRender,p=0;!l&&p<c.length;++p){var d=c[p];cesium.Rectangle.contains(d.rectangle,s)&&(l=d)}if(l){for(var h=l.data.imagery,f=h.length-1;f>=0;--f)if(!h[f].readyImagery)return void o();var m=l.tilingScheme.tileXYToNativeRectangle(l.x,l.y,l.level),g=(h.filter((function(t){return t.readyImagery.imageryLayer.isBaseLayer()}))[0]||{}).readyImagery;t.map.getResolution=function(){var e=t.view3D.crs!==t.view3D.view2DCRS?r.Z.Util.reproject([m.west,m.south],t.view3D.crs,t.view3D.view2DCRS):[m.west,m.south],n=t.view3D.crs!==t.view3D.view2DCRS?r.Z.Util.reproject([m.east,m.north],t.view3D.crs,t.view3D.view2DCRS):[m.east,m.north],o=(n[0]-e[0])/(g&&g.imageryLayer.imageryProvider.tileWidth||256),i=(n[1]-e[1])/(g&&g.imageryLayer.imageryProvider.tileHeight||256);return Math.max(o,i)}.bind(t,g,m),t.map.one(r.Z.Consts.event.NOFEATUREINFO,function(t){n=!1,o(t)}.bind(a)),t.map.one(r.Z.Consts.event.FEATUREINFO,(function(t){n=!1,o(t)})),t.map.on(r.Z.Consts.event.FEATURECLICK,(function(t){u(),o(t)})),a.isActive=!0,a.beforeRequest({xy:[0,0]}),a.callback(i)}else o()}))}))},this.get2DMarker=function(){return a.filterFeature},this.isPending=function(){return n}},w=function(e){this.layerCrs=null;var n,o={CRS:["Capability","Layer","CRS"],TILEMATRIXSET:["Contents","TileMatrixSet","Identifier"],TILEMATRIXSETLABELS:["Contents","TileMatrixSet"]},i=function(e,n,r){if(r<n.length-1)return t.call(e,n[r])?i(e[n[r]],n,++r):null;if(e instanceof Array){for(var o=[],a=0;a<e.length;a++)t.call(e[a],n[r])&&o.push(e[a][n[r]]);return o}return e[n[r]]},a=function(t,e){let n;if(n=r.Z.Util.isOnCapabilities(t.url)){let t;if(t=r.Z.capabilities[n])for(var a=i(t,o.TILEMATRIXSETLABELS,0),s=0;s<a.length;s++)if(r.Z.Util.CRSCodesEqual(e,a[s].SupportedCRS))return{id:a[s].Identifier,labels:i(a[s],["TileMatrix","Identifier"],0)}}return null},s=function(t){const e=this;return new Promise((function(n,o){let i,s,l=a(t,e.layerCrs);if(r.Z.Consts.WMTSEncoding.KVP===t.encoding)i=new cesium.Resource({url:t.url,request:new cesium.Request({type:cesium.RequestType.IMAGERY})});else if(r.Z.Consts.WMTSEncoding.RESTFUL===t.encoding){const n=t.wrap.getWMTSLayer({crs:e.layerCrs});n&&n.ResourceURL&&n.ResourceURL.length>0&&(s=n.ResourceURL[0],i=new cesium.Resource({url:s.template,request:new cesium.Request({type:cesium.RequestType.IMAGERY})}))}if(i&&l){i.tcLayer=t;let e={url:i,layer:t.layerNames,style:"default",format:s&&s.format||t.format||t.options.format,tilingScheme:new cesium.GeographicTilingScheme};r.Z.Consts.WMTSEncoding.RESTFUL===t.encoding?e.tileMatrixSetID=l.id:r.Z.Consts.WMTSEncoding.KVP===t.encoding&&l&&(e.tileMatrixSetID=l.id,e.tileMatrixLabels=l.labels),l&&l.labels&&(e.maximumLevel=parseInt(l.labels[l.labels.length-1])),n(new cesium.WebMapTileServiceImageryProvider(e))}else o("Faltan datos para instanciar la capa")}))},l=function(t){return new Promise((function(e,n){let r=new cesium.Resource({url:t.url,request:new cesium.Request({type:cesium.RequestType.IMAGERY})});r.tcLayer=t;let o={url:r,layers:t.layerNames,parameters:{version:"1.3.0",transparent:!0,format:t.format||t.options.format}};var i=function(){var e=[];if(t.capabilities&&t.capabilities.Capability&&t.capabilities.Capability.Layer&&t.names.length>0)for(var n=t.names.slice(0),r=function e(n,r){if(n){let i;for(var o=0;o<n.length;o++)if(i=n[o],t.compareNames(t.wrap.getName(i),r))return i.EX_GeographicBoundingBox;return e(i.Layer,r)}};n.length>0;){var o=r([t.capabilities.Capability.Layer],n.pop());null!==o&&e.push(o)}return e}();i&&(t.geoBBox=i),e(new cesium.WebMapServiceImageryProvider(o))}))},c=function(){(n=function(t,e){cesium.Resource.call(this,t),this.layer=e}).prototype.constructor=n,n.prototype=Object.create(cesium.Resource.prototype,{}),n.prototype.clone=function(t){var e=cesium.Resource.prototype.clone.call(this,t);return cesium.defined(t)||(t=new n({url:this._url},this.layer)),t._url=e._url,t._queryParameters=e._queryParameters,t._templateValues=e._templateValues,t.headers=e.headers,t.proxy=e.proxy,t.retryCallback=e.retryCallback,t.retryAttempts=e.retryAttempts,t._retryCount=0,t.request=e.request,t},n.prototype.fetchImage=f},u=function(){try{var t=new XMLHttpRequest;return t.open("GET","#",!0),t.responseType="blob","blob"===t.responseType}catch(t){return!1}}();function p(t){if(t.state===cesium.RequestState.ISSUED||t.state===cesium.RequestState.ACTIVE)throw new cesium.RuntimeError("The Resource is already being fetched.");t.state=cesium.RequestState.UNISSUED,t.deferred=void 0}function d(t,e,n,r){var o=function(e){var o=new Image;o.onload=function(t){r.resolve(o)}.bind(o,t),o.onerror=function(t,e){r.reject(e)}.bind(o,t),n&&(cesium.TrustedServers.contains(e)?o.crossOrigin="use-credentials":o.crossOrigin=""),o.src=e};t.getWebGLUrl.call(t,e).then(o,(function(t){r.reject(t)}))}function h(t,e){var n=t.request;n.url=t.url,n.requestFunction=function(){var n=t.url,r=!1;t.isDataUri||t.isBlobUri||(r=t.isCrossOriginUrl);var o=cesium.when.defer();return d(t.layer,n,r&&e,o),o.promise};var r=cesium.RequestScheduler.request(n);if(cesium.defined(r))return r.otherwise((function(t){return cesium.when.reject(t)}))}var f=function(t,e){if(cesium.defined(e)&&cesium.deprecationWarning("Resource.fetchImage.allowCrossOrigin","The allowCrossOrigin parameter has been deprecated and will be removed in cesium 1.44. It no longer needs to be specified."),t=cesium.defaultValue(t,!1),e=cesium.defaultValue(e,!0),p(this.request),!u||this.isDataUri||this.isBlobUri||!this.hasHeaders&&!t)return h(this,e);var n,r,o=this.fetchBlob();return cesium.defined(o)?o.then((function(t){if(cesium.defined(t)){r=t;var e=window.URL.createObjectURL(t);return h(n=new cesium.Resource({url:e}))}})).then((function(t){if(cesium.defined(t))return window.URL.revokeObjectURL(n.url),t.blob=r,t})).otherwise((function(t){return cesium.defined(n)&&window.URL.revokeObjectURL(n.url),cesium.when.reject(t)})):void 0};this.convert=function(t,e){switch(this.layerCrs=e,n||c(),!0){case r.Z.Consts.layerType.WMTS==t.type:return s.call(this,t);case r.Z.Consts.layerType.WMS==t.type:return l.call(this,t)}}},S=function(){var e=null,n=function(t,e){t instanceof Array&&(t="rgba("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")");var n=cesium.Color.fromCssColorString(t);return void 0!==e?n.withAlpha(e):n},o=function(t,e,n){for(var r in e){var o=t[e[r].prop];if(void 0!==o)if("function"==typeof o){var i=o(n);i&&(e[r].val=i)}else e[r].val=o}},i=function(t){var n;if(1==t.length){var r,o,i,a,s=t[0],l=1e3;r=new cesium.Cartesian3(s.x-l,s.y,s.z),o=new cesium.Cartesian3(s.x,s.y-l,s.z),i=new cesium.Cartesian3(s.x+l,s.y,s.z),a=new cesium.Cartesian3(s.x,s.y+l,s.z),n=cesium.Rectangle.fromCartesianArray([r,o,i,a],cesium.Ellipsoid.WGS84)}else n=cesium.Rectangle.fromCartesianArray(t,cesium.Ellipsoid.WGS84);var c=e.camera.getRectangleCameraCoordinates(n),u=cesium.Cartesian3.distance(c,cesium.BoundingSphere.fromPoints(t).center),p=e.camera.frustum.getPixelDimensions(e.drawingBufferWidth,e.drawingBufferHeight,u,e.pixelRatio,new cesium.Cartesian2);return p=Math.max(p.x,p.y),0==Math.round(p)?1:p},a=function(e){var n;return n=null==(n=!e.layer||e.layer&&!t.call(e.layer,"styles")?r.Z.Defaults.styles:e.layer.styles)[e.STYLETYPE]?n["polyline"===e.STYLETYPE?"line":e.STYLETYPE]:n["multipolygon"===e.STYLETYPE?"polygon":e.STYLETYPE],n=r.Z.Util.extend({},n,e.options,e.getStyle())};function s(t,e,n,r){r(new cesium.Entity({name:t,polyline:{positions:e,width:n.width,material:n.material,clampToGround:!0}}))}var l=function(e){var r={},i=a(e);return r.options=function(){var r,a={},s={color:{prop:"strokeColor"},opacity:{prop:"fillOpacity"},outlineColor:{prop:"fillColor"},outlineOpacity:{prop:"strokeOpacity"},width:{prop:"strokeWidth"}};return o(i,s,e),t.call(s.color,"val")&&(r=t.call(s.opacity,"val")?n(s.color.val,s.opacity.val):n(s.color.val)),a.color=cesium.ColorGeometryInstanceAttribute.fromColor(r),t.call(s.outlineColor,"val")&&(r=t.call(s.outlineOpacity,"val")?n(s.outlineColor.val,s.outlineOpacity.val):n(s.outlineColor.val)),a.outlineColor=cesium.ColorGeometryInstanceAttribute.fromColor(r),t.call(s.width,"val")&&(a.width=s.width.val),a},r.geometryType=function(t,n){return new cesium.GroundPrimitive({releaseGeometryInstances:!1,geometryInstances:new cesium.GeometryInstance({id:e.id,geometry:new cesium.CircleGeometry({center:t[0],radius:e.geometry[1]}),attributes:{color:n.color}})})},r},c=function(e){var i={},l=a(e);return i.options=function(){var r,i={},a={color:{prop:"fillColor"},opacity:{prop:"fillOpacity"},outlineColor:{prop:"strokeColor"},outlineOpacity:{prop:"strokeOpacity"},width:{prop:"strokeWidth"}};return o(l,a,e),t.call(a.color,"val")&&(r=t.call(a.opacity,"val")?n(a.color.val,a.opacity.val):n(a.color.val)),i.color=cesium.ColorGeometryInstanceAttribute.fromColor(r),t.call(a.outlineColor,"val")&&(r=t.call(a.outlineOpacity,"val")?n(a.outlineColor.val,a.outlineOpacity.val):n(a.outlineColor.val)),i.outlineColor=r,t.call(a.width,"val")&&(i.width=a.width.val),i},r.Z.feature.MultiPolygon&&"TC.feature.MultiPolygon"==e.CLASSNAME?i.geometryType=function(t,n){return new Promise((function(r,o){for(var i=[],a=[],l=[],c=function(t){return new cesium.GeometryInstance({id:e.id,geometry:new cesium.PolygonGeometry({polygonHierarchy:t}),attributes:{color:n.color}})},u=function(t){return new Promise((function(r,o){s(e.id,t,{material:n.outlineColor,width:n.width},(function(t){l.push(t),r()}))}))},p=0;p<t.length;p++){let e;for(var d=0;d<t[p].length;d++)0==d?(i.push(u.call(this,t[p][0])),e=new cesium.PolygonHierarchy(t[p][0])):(i.push(u.call(this,t[p][d])),e.holes.push(new cesium.PolygonHierarchy(t[p][d])));a.push(c(e))}Promise.all(i).then((function(){i=[],r([new cesium.GroundPrimitive({releaseGeometryInstances:!1,geometryInstances:a}),l])})).catch(o)}))}:r.Z.feature.Polygon&&"TC.feature.Polygon"==e.CLASSNAME&&(i.geometryType=function(t,n){return new Promise((function(r,o){Array.isArray(t)&&1===t.length&&Array.isArray(t[0])&&(t=t[0]),s(e.id,t,{material:n.outlineColor,width:n.width},(function(o){r([new cesium.GroundPrimitive({releaseGeometryInstances:!1,geometryInstances:new cesium.GeometryInstance({id:e.id,geometry:new cesium.PolygonGeometry({polygonHierarchy:new cesium.PolygonHierarchy(t)}),attributes:{color:n.color}})}),o])}))}))}),i},u=function(e){var l={},c=a(e);return l.options=function(){var r,i={},a={color:{prop:"strokeColor"},opacity:{prop:"strokeOpacity"},width:{prop:"strokeWidth"}};return o(c,a,e),t.call(a.width,"val")&&(i.width=a.width.val),t.call(a.color,"val")&&(r=t.call(a.opacity,"val")?n(a.color.val,a.opacity.val):n(a.color.val)),i.color=r,i},r.Z.feature.MultiPolyline&&"TC.feature.MultiPolyline"==e.CLASSNAME?l.geometryType=function(t,n){return new Promise((function(r,o){var a=[],l=[];if(1==t.length)t=t[0],l.push(new Promise((function(r,o){s(e.id,t,{material:n.color,width:n.width},(function(t){a.push(t),r()}))})));else{t=t.sort((function(t,e){return t.length>e.length?-1:t.length<e.length?1:0})),i(t[0]);for(var c=0;c<t.length;c++)l.push(new Promise((function(r,o){s(e.id,t[c],{material:n.color,width:n.width},(function(t){a.push(t),r()}))})))}Promise.all(l).then((function(){l=[],r(a)})).catch(o)}))}:r.Z.feature.Polyline&&"TC.feature.Polyline"==e.CLASSNAME&&(l.geometryType=function(t,n){return new Promise((function(r,o){s(e.id,t,{material:n.color,width:n.width},(function(t){r(t)}))}))}),l},p=function(e){var i={},s=a(e);if(i.options=function(){var r={},i={rotation:{prop:"angle"},label:{prop:"label"},fontSize:{prop:"fontSize"},fontColor:{prop:"fontColor"},outlineLabelColor:{prop:"labelOutlineColor"},outlineLabelWidth:{prop:"labelOutlineWidth"},anchor:{prop:"anchor"},height:{prop:"height"},width:{prop:"width"},url:{prop:"url"},color:{prop:"fillColor"},opacity:{prop:"fillOpacity"},outlineColor:{prop:"strokeColor"},outlineOpacity:{prop:"strokeOpacity"},outlineWidth:{prop:"strokeWidth"},radius:{prop:"radius"}};return o(s,i,e),t.call(i.anchor,"val")&&(!t.call(i.url,"val")&&e.options.url?r.url=e.options.url:r.url=i.url.val,r.anchor=i.anchor.val),t.call(i.height,"val")&&(r.height=i.height.val),t.call(i.width,"val")&&(r.width=i.width.val),t.call(i.rotation,"val")&&(r.rotation=i.rotation.val),t.call(i.label,"val")&&(r.label=i.label.val),t.call(i.fontSize,"val")&&(r.fontSize=i.fontSize.val),t.call(i.fontColor,"val")&&(r.fontColor=n(i.fontColor.val)),t.call(i.outlineLabelColor,"val")&&(r.outlineLabelColor=n(i.outlineLabelColor.val)),t.call(i.outlineLabelWidth,"val")&&(r.outlineLabelWidth=i.outlineLabelWidth.val),t.call(i.color,"val")&&(t.call(i.opacity,"val")?r.color=n(i.color.val,i.opacity.val):r.color=n(i.color.val)),t.call(i.outlineColor,"val")&&(t.call(i.outlineOpacity,"val")?r.outlineColor=n(i.outlineColor.val,i.outlineOpacity.val):r.outlineColor=n(i.outlineColor.val)),t.call(i.outlineWidth,"val")&&(r.outlineWidth=i.outlineWidth.val),t.call(i.radius,"val")&&(r.radius=i.radius.val),r},r.Z.feature.Marker&&"TC.feature.Marker"==e.CLASSNAME)i.geometryType=function(t,n){var r={name:e.id,position:t[0],billboard:{image:n.url,width:n.width,height:n.height,eyeOffset:new cesium.Cartesian3(0,0,-100),verticalOrigin:cesium.VerticalOrigin.BOTTOM,heightReference:cesium.HeightReference.CLAMP_TO_GROUND}};return n.anchor&&n.anchor.length>0&&(r.billboard.pixelOffset=new cesium.Cartesian2(n.anchor[0],n.anchor[1])),n.label?(r.label={text:n.label,font:"14pt sans-serif",heightReference:cesium.HeightReference.CLAMP_TO_GROUND,horizontalOrigin:cesium.HorizontalOrigin.LEFT,verticalOrigin:cesium.VerticalOrigin.BOTTOM,fillColor:n.fontColor,showBackground:!0,eyeOffset:new cesium.Cartesian3(3e3,0,-100)},new cesium.Entity(r)):new cesium.Entity(r)};else if(r.Z.feature.Point&&"TC.feature.Point"==e.CLASSNAME){var l=new cesium.PinBuilder;i.geometryType=function(t,n){var o=n.label;switch(!0){case o&&/^([A-Z])\w+$/gi.test(o):case o&&!/^[0-9]*\-{0,1}[a-z]{0,4}$/gi.test(o):return new cesium.Entity({name:e.id,position:t[0],label:{text:n.label,eyeOffset:new cesium.Cartesian3(0,0,-100),heightReference:cesium.HeightReference.CLAMP_TO_GROUND,horizontalOrigin:cesium.HorizontalOrigin.CENTER,verticalOrigin:cesium.VerticalOrigin.BASELINE,font:"16px san-serif Helvetica",fillColor:cesium.Color.BLACK,outlineColor:cesium.Color.WHITE,outlineWidth:5,style:cesium.LabelStyle.FILL_AND_OUTLINE}});case/^[0-9]*\-{0,1}[a-z]{0,4}$/gi.test(o):return new cesium.Entity({name:e.id,position:t[0],billboard:{image:l.fromText(o,n.fontColor,48).toDataURL(),eyeOffset:new cesium.Cartesian3(0,0,-100),verticalOrigin:cesium.VerticalOrigin.BOTTOM,heightReference:cesium.HeightReference.CLAMP_TO_GROUND}});case n.radius&&n.radius>0:var i=new Array(2);const a=function(t,e,n){var r=(e=e.darken(.15,new cesium.Color)).toCssColorString().replace("rgb","rgba").replace(")",",0)");t.save(),t.scale(n/24,n/24),t.strokeStyle=r,t.miterLimit=4,t.font="normal normal 400 normal 15px / 21.4286px ''",t.font="   15px ",t.save(),t.restore(),t.save(),t.restore(),t.save(),t.font="   15px ",t.save(),t.fillStyle="#b3b3b3",t.fillStyle="rgba(179, 179, 179, 1)",t.strokeStyle=r,t.lineWidth=1.5,t.lineJoin="round",t.miterLimit="4",t.font="   15px ",t.beginPath(),t.moveTo(11.578125,11.71875),t.lineTo(12.421875,11.71875),t.lineTo(12.421875,24),t.lineTo(11.578125,24),t.closePath(),t.fill(),t.stroke(),t.restore(),t.save(),t.fillStyle=e.toCssColorString().replace("rgb","rgba").replace(")",", 1)"),t.strokeStyle=r,t.lineWidth=1.5,t.lineJoin="round",t.miterLimit="4",t.font="   15px ",t.beginPath(),t.moveTo(17,7),t.translate(12,7),t.rotate(0),t.arc(0,0,5,0,1.5707963267948966,0),t.rotate(0),t.translate(-12,-7),t.translate(12,7),t.rotate(0),t.arc(0,0,5,1.5707963267948966,3.141592653589793,0),t.rotate(0),t.translate(-12,-7),t.translate(12,7),t.rotate(0),t.arc(0,0,5,3.141592653589793,4.71238898038469,0),t.rotate(0),t.translate(-12,-7),t.translate(12,7),t.rotate(0),t.arc(0,0,5,-1.5707963267948966,0,0),t.rotate(0),t.translate(-12,-7),t.closePath(),t.fill(),t.stroke(),t.restore()},s=function(t,e){l._cache||(l._cache={}),i[0]=t,i[1]=e;var n=JSON.stringify(i),r=l._cache[n];if(r)return r;var o=document.createElement("canvas");o.width=e,o.height=e;var s=o.getContext("2d");return a(s,t,e),l._cache[n]=o,o};return new cesium.Entity({name:e.id,position:t[0],billboard:{image:s(cesium.Color.fromCssColorString(e.options.strokeColor?e.options.strokeColor:r.Z.Cfg.styles.point.strokeColor),48).toDataURL(),eyeOffset:new cesium.Cartesian3(0,0,-100),verticalOrigin:cesium.VerticalOrigin.BOTTOM,horizontalOrigin:cesium.HorizontalOrigin.CENTER,heightReference:cesium.HeightReference.CLAMP_TO_GROUND}});default:return new cesium.Entity({name:e.id,position:t[0],billboard:{image:l.fromColor(cesium.Color.fromCssColorString(e.options.fillColor?e.options.fillColor:r.Z.Cfg.styles.point.fillColor),32).toDataURL(),eyeOffset:new cesium.Cartesian3(0,0,-100),verticalOrigin:cesium.VerticalOrigin.BOTTOM,horizontalOrigin:cesium.HorizontalOrigin.CENTER,heightReference:cesium.HeightReference.CLAMP_TO_GROUND}})}}}return i};this.convert=function(t,n,o,i){const a=this;e=t;var s,d,h,f,m,g=!1,y=[],v=function(t,e){Array.isArray(t)&&(o!==i&&(t=r.Z.Util.reproject(t,o,i)),e.push(t.length>2?cesium.Cartesian3.fromDegrees(t[0],t[1],t[2]):cesium.Cartesian3.fromDegrees(t[0],t[1])))},_=n.geometry,C=function(t,e){if(Array.isArray(t))for(var n=0;n<t.length;n++)v(t[n],e)},E=function(t,e){if(Array.isArray(t))for(var n=0;n<t.length;n++)e.push([]),C(t[n],e[e.length-1])},w=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)y.push([]),E(t[e],y[y.length-1])};switch(!0){case r.Z.feature.Circle&&"TC.feature.Circle"==n.CLASSNAME:C(_,y),d=l.call(a,n);break;case r.Z.feature.MultiPolygon&&"TC.feature.MultiPolygon"==n.CLASSNAME:m=_,Array.isArray(m)&&(w(m),d=c.call(a,n),g=!0);break;case r.Z.feature.Polygon&&"TC.feature.Polygon"==n.CLASSNAME||r.Z.feature.MultiPolyline&&"TC.feature.MultiPolyline"==n.CLASSNAME:f=_,Array.isArray(f)&&(E(f,y),"TC.feature.Polygon"==n.CLASSNAME?(d=c(n),g=!0):"TC.feature.MultiPolyline"==n.CLASSNAME&&(d=u(n),g=!0));break;case r.Z.feature.Polyline&&"TC.feature.Polyline"==n.CLASSNAME:h=_,Array.isArray(h)&&(C(h,y),d=u(n),g=!0);break;case r.Z.feature.Marker&&"TC.feature.Marker"==n.CLASSNAME:case r.Z.feature.Point&&"TC.feature.Point"==n.CLASSNAME:C(h=[_],y),d=p(n)}return 0==y.length?null:((s={id:n.id,attributes:n.data,boundigSphere:cesium.BoundingSphere.fromPoints(y)}).geometry=g?function(t){return d.provider=t,d.geometryType(y,d.options())}:d.geometryType(y,d.options()),s)}},b={baseMap:"",baseMaps:[],baseVector:""},L=function(t){const e=this;return new Promise((function(n,i){var a=t.baseLayer instanceof r.Z.layer.Raster;if(a){if(!o(t.baseLayer,e.view3D.crs)){var s=t.baseLayer.getFallbackLayer();s&&s._capabilitiesPromise.then((function(){s.isCompatible(e.view3D.crs)||t.toast(e.getLocaleString("threed.baseLayerNoCompatible",{name:t.baseLayer.layerNames}))}))}}else b.baseVector=t.baseLayer;0===b.baseMaps.length&&Promise.all(t.baseLayers.map((function(t){if(o(t,e.view3D.crs))return Promise.resolve(!1);var n=t.getFallbackLayer();return n?n._capabilitiesPromise.then((function(){return!n.isCompatible(e.view3D.crs)})):Promise.resolve(!0)}))).then((function(e){if(e.length>0)for(var r=0;r<t.baseLayers.length;r++)t.baseLayers[r]&&(t.baseLayers[r].mustReproject=e[r]);n()})).catch(i),b.baseMap=a?t.baseLayer:e.Consts.BLANK_BASE}))};return e.init=function(t){const e=this;e.events=e.map.$events,e.selectors={divThreedMap:t.div},t.terrain?e.terrain=t.terrain:e.terrain={url:"//idena.navarra.es/cesiumTerrain/2017/epsg4326/5m/",noDataValue:0,attributions:{name:"Álvaro Huarte",site:"https://github.com/ahuarte47"}},t.terrainFallback&&t.terrainFallback.url&&t.terrainFallback.coverageName&&t.terrainFallback.noDataValue?e.terrainFallback={url:t.terrainFallback.url.trim(),layerName:t.terrainFallback.coverageName,format:t.terrainFallback.format,noDataValue:t.terrainFallback.noDataValue}:!t.terrainFallback||t.terrainFallback.url&&t.terrainFallback.coverageName&&t.terrainFallback.noDataValue||(e.terrainFallback={url:"https://image.discomap.eea.europa.eu/arcgis/services/Elevation/EUElev_DEM_V11/MapServer/WCSServer",coverageName:"1",format:"GeoTIFF",noDataValue:-32767}),t.controls&&(e.allowedControls=t.controls),e.mapView=new n(e.map,e),e.map.on(r.Z.Consts.event.PROJECTIONCHANGE,(function(t){e.mapView.metersPerUnit=e.map.getMetersPerUnit()})),e.map.view3D=e.view3D,e.getRenderedHtml(e.CLASS+"-overlay",{},(function(t){const n=new DOMParser;e.overlay=n.parseFromString(t,"text/html").body.firstChild}))},e.apply=function(e){const n=this;if(!(e=e||{}).map)throw Error("Falta referencia al mapa 2D");if(n.map=e.map,!n.map.view3D){var o=n.VIEWNAME=n.VIEWNAME.substr(0,1).toLowerCase()+n.VIEWNAME.substr(1);if(!n.map.options.views||!t.call(n.map.options.views,o))throw Error("Falta configuración de la vista");n.init(n.map.options.views[o])}if(n.view3D.view2DCRS=e.map.crs,e.map.on(r.Z.Consts.event.PROJECTIONCHANGE,(function(t){n.view3D.view2DCRS=t.newCrs})),e.state&&n.map.toast(r.Z.Util.getLocaleString(n.map.options.locale,"threed.apply3DState"),{type:r.Z.Consts.msgType.INFO}),n.waiting||(n.waiting=n.map.getLoadingIndicator().addWait()),!n.ctrlsToMng){for(var i=[],a=0,s=n.allowedControls.length;a<s;a++){var l=n.allowedControls[a];l=l.substr(0,1).toUpperCase()+l.substr(1);var c=n.map.getControlsByClass("TC.control."+l);0===c.length&&(l=l.toUpperCase(),c=n.map.getControlsByClass("TC.control."+l)),0===c.length&&n.map.on(r.Z.Consts.event.CONTROLADD,function(t,e){try{new Function("return new "+t+"()")().CLASS===e.control.CLASS&&n.ctrlsToMng.push(e.control)}catch(t){console.warn("Error al obtener la clase CSS de un control soportado")}}.bind(n,"TC.control."+l)),i=i.concat(c)}n.ctrlsToMng=i}n.map.on3DView=!0,n.map.div.classList.add(r.Z.Consts.classes.THREED),n.divThreedMap=document.querySelector("#"+n.selectors.divThreedMap),n.divThreedMap.classList.add(n.classes.MAP3D,n.classes.LOADING),n.view3D.container=n.divThreedMap;const u=function(){console.log("Llega a applyEnd"),n.map.getLoadingIndicator().removeWait(n.waiting),delete n.waiting,e.callback&&e.callback()};try{n.view3D.loadViewer.call(n).then((function(){n.divThreedMap.classList.remove(n.CLASS+"-div-fadeOut"),n.divThreedMap.classList.add(n.CLASS+"-div-fadeIn"),n.mapView.viewHTML.classList.remove(n.CLASS+"-div-fadeIn"),n.mapView.viewHTML.classList.add(n.CLASS+"-div-fadeOut"),e.state||n.divThreedMap.classList.remove(n.classes.LOADING),L.call(n,n.map).then((function(){n.view3D.setCameraFromMapView.call(n),n.view3D.setBaseLayer.call(n,n.map.baseLayer),n.map.workLayers.filter((function(t){return t.type===r.Z.Consts.layerType.WMTS||t.type===r.Z.Consts.layerType.WMS})).reverse().forEach((function(t){n.view3D.addLayer.call(n,t)})),n.viewer.readyPromise.then(function(){if(n.view3D.cameraControls?n.view3D.cameraControls.render.call(n.view3D.cameraControls):n.view3D.cameraControls=new C(n),e.animateRendering||e.state||(e.animateRendering=!0),e.state)n.divThreedMap.classList.remove(n.classes.LOADING),n.view3D.cameraControls.getCamera().flyTo({destination:cesium.Cartesian3.fromRadians(e.state.cp[0],e.state.cp[1],e.state.cp[2]),orientation:{heading:e.state.chpr[0],pitch:e.state.chpr[1],roll:e.state.chpr[2]},complete:u});else if(e.animateRendering){let t=cesium.Math.toRadians(50),e=f(n.viewer.scene);const o=function(e){let r=cesium.Matrix4.fromTranslation(e);n.view3D.rotateAroundAxis(n.viewer.scene.camera,-t,n.viewer.scene.camera.right,r,{duration:2e3,callback:i})},i=function(){cesium.Camera.DEFAULT_VIEW_RECTANGLE=n.view3D.initialRectangle=n.viewer.camera.computeViewRectangle(),cesium.Camera.DEFAULT_VIEW_FACTOR=0,u()};if(e)o(e);else{let t,e=(new Date).getTime();t=setInterval((function(){let a=f(n.viewer.scene);if(a)clearInterval(t),o(a);else if((new Date).getTime()-e>15e3){clearInterval(t);let e=document.querySelectorAll("."+r.Z.control.NavBarHome.prototype.CLASS+"-btn");return e&&e.length>0&&e[0].click(),void i()}}),50)}}else u();n.map.trigger(r.Z.Consts.event.VIEWCHANGE,{view:r.Z.Consts.view.THREED}),n.events.on(r.Z.Consts.event.TERRAINLOADED,(function(){const t=function(t){var e=cesium.Ellipsoid.WGS84.cartesianToCartographic(t),r=n.viewer.scene.globe.getHeight(e)||0,o={longitude:e.longitude,latitude:e.latitude,height:e.height+r};return cesium.Ellipsoid.WGS84.cartographicToCartesian(o)};var e=n.viewer.entities.values.filter((function(t){return t.billboard}));if(e.length>0&&e.forEach((function(e){e.position=t(cesium.Property.getValueOrUndefined(e.position,cesium.JulianDate.now))})),n.viewer.billboardCollection){for(var r=0;r<n.viewer.billboardCollection.length;r++)n.viewer.billboardCollection.get(r).position=t(n.viewer.billboardCollection.get(r).position);n.viewer.scene.requestRender()}}))}.bind(n)).catch((()=>{console.log("3051"),u()}))})).catch((()=>{console.log("3053"),u()}))})).catch((()=>{console.log("3055"),u()}))}catch(t){throw u(),t}},e.unapply=function(t){const e=this;e.waiting||(e.waiting=e.map.getLoadingIndicator().addWait()),e.map.on3DView=!1,e.viewer&&e.viewer.trackedEntity&&e.view3D.linked2DControls.geolocation.wrap.simulateTrackEnd(),e.view3D.cameraControls.resetRotation({duration:1e3}).then((function(){var n=function(){e.map.div.classList.remove(r.Z.Consts.classes.THREED),e.map.trigger(r.Z.Consts.event.TERRAINPROVIDERREMOVE,{terrainProvider:e.viewer.scene.terrainProvider}),e.viewer.scene.terrainProvider.fallbackProvider&&e.viewer.scene.terrainProvider.fallbackProvider.forEach((function(t){e.map.trigger(r.Z.Consts.event.TERRAINPROVIDERREMOVE,{terrainProvider:t})})),e.view3D.setViewFromCameraView.call(e).then((function(){e.divThreedMap.classList.remove(e.classes.MAP3D,e.CLASS+"-div-fadeIn"),e.divThreedMap.classList.add(e.CLASS+"-div-fadeOut"),e.mapView.viewHTML.classList.remove(e.CLASS+"-div-fadeOut"),e.mapView.viewHTML.classList.add(e.CLASS+"-div-fadeIn"),e.view3D.destroy.call(e),e.map.getLoadingIndicator().removeWait(e.waiting),delete e.waiting,t.callback&&t.callback()})),e.mapView.setRotation(0),e._ovMap&&e._ovMap.wrap.draw3DCamera(null)},o=f(e.viewer.scene),i=cesium.Matrix4.fromTranslation(o),a=v(e.viewer.scene,o);e.view3D.rotateAroundAxis(e.viewer.scene.camera,-a,e.viewer.scene.camera.right,i,{duration:1500,callback:n})})).catch((function(t){throw t}))},e.view3D=function(){const n=new w(/(EPSG\:?4326)/i),i=new S,a=function(e){var n=e;switch(!0){case e instanceof cesium.GroundPrimitive:this.viewer.scene.groundPrimitives.add(e);break;case e instanceof Object&&t.call(e,"billboard"):this.viewer.billboardCollection||(this.viewer.billboardCollection=this.viewer.scene.primitives.add(new cesium.BillboardCollection({scene:this.viewer.scene}))),n=this.viewer.billboardCollection.add({position:e.position,image:e.billboard.image,verticalOrigin:e.billboard.verticalOrigin,heightReference:e.billboard.heightReference});break;case e instanceof Object:(n=this.viewer.entities.getById(e.id))||(n=this.viewer.entities.add(e))}return this.viewer.scene.requestRender(),n},s=function(e,n,r,o){t.call(e.vector2DFeatures,n)?t.call(e.vector2DFeatures[n],o)?e.vector2DFeatures[n][o].push(r):e.vector2DFeatures[n][o]=[r]:(e.vector2DFeatures[n]={},e.vector2DFeatures[n][o]=[r])},l=[r.Z.Consts.event.BEFOREBASELAYERCHANGE,r.Z.Consts.event.BASELAYERCHANGE,r.Z.Consts.event.LAYERADD,r.Z.Consts.event.LAYERREMOVE,r.Z.Consts.event.LAYERVISIBILITY,r.Z.Consts.event.LAYEROPACITY,r.Z.Consts.event.LAYERORDER,r.Z.Consts.event.FEATUREADD,r.Z.Consts.event.FEATUREREMOVE,r.Z.Consts.event.FEATURESCLEAR,r.Z.Consts.event.ZOOMTO],d=function(e){var n=this;switch(!0){case e.type==r.Z.Consts.event.BEFOREBASELAYERCHANGE:n.waiting||(n.waiting=n.map.getLoadingIndicator().addWait());break;case e.type==r.Z.Consts.event.BASELAYERCHANGE:n.view3D.setBaseLayer.call(n,e.layer);break;case e.type==r.Z.Consts.event.LAYERADD:n.view3D.addLayer.call(n,e.layer);break;case e.type==r.Z.Consts.event.LAYERREMOVE:n.view3D.removeLayer.call(n,e.layer);break;case e.type==r.Z.Consts.event.LAYERVISIBILITY:n.view3D.setRenderOptionsLayer.call(n,e.layer,{visibility:e.layer.getVisibility()});break;case e.type==r.Z.Consts.event.LAYEROPACITY:n.view3D.setRenderOptionsLayer.call(n,e.layer,{opacity:e.layer.getOpacity()}),n.viewer.scene.requestRender();break;case e.type==r.Z.Consts.event.LAYERORDER:for(var o=0;o<n.view3D.workLayers.length;o++)if(n.view3D.workLayers[o].imageryProvider&&n.view3D.workLayers[o].imageryProvider.layers.join(",")===e.layer.names.join(",")){if(e.oldIndex>e.newIndex){const t=e.oldIndex-e.newIndex;for(var i=0;i<t;i++)n.viewer.scene.imageryLayers.lower(n.view3D.workLayers[o])}else{const t=e.newIndex-e.oldIndex;for(i=0;i<t;i++)n.viewer.scene.imageryLayers.raise(n.view3D.workLayers[o])}n.view3D.workLayers.splice(e.newIndex,0,n.view3D.workLayers.splice(e.oldIndex,1)[0]);break}break;case e.type==r.Z.Consts.event.FEATUREADD:n.view3D.addFeature.call(n.view3D,e.feature);break;case e.type==r.Z.Consts.event.FEATUREREMOVE:if(n.view3D.vector2DFeatures&&t.call(n.view3D.vector2DFeatures,e.layer.id)){const r=function(r){if(t.call(n.view3D.vector2DFeatures[e.layer.id],r.id)){for(var o=n.view3D.vector2DFeatures[e.layer.id][r.id],i=0;i<o.length;i++)n.view3D.removeFeature.call(n,o[i]);delete n.view3D.vector2DFeatures[e.layer.id][r.id]}};e.feature instanceof Array?e.feature.forEach(r):r(e.feature)}break;case e.type==r.Z.Consts.event.FEATURESCLEAR:if(n.view3D.vector2DFeatures&&t.call(n.view3D.vector2DFeatures,e.layer.id))for(var a in n.view3D.vector2DFeatures[e.layer.id]){var s=n.view3D.vector2DFeatures[e.layer.id][a];for(o=0;o<s.length;o++)n.view3D.removeFeature.call(n,s[o]);delete n.view3D.vector2DFeatures[e.layer.id][a]}break;case e.type==r.Z.Consts.event.ZOOM:if(n.view3D.cameraControls&&!n.view3D.cameraControls.moving){var l=n.view3D.viewer.scene.canvas.clientWidth,c=n.view3D.viewer.scene.canvas.clientHeight;if(!n.view3D._canvasClientHeight||!n.view3D._canvasClientWidth||l!==n.view3D._canvasClientWidth||c!==n.view3D._canvasClientHeight)return n.view3D._canvasClientWidth||(n.view3D._canvasClientWidth=n.view3D.viewer.scene.canvas.clientWidth),n.view3D._canvasClientHeight||(n.view3D._canvasClientHeight=n.view3D.viewer.scene.canvas.clientHeight),n.view3D._canvasClientWidth=l,void(n.view3D._canvasClientHeight=c);n.view3D.flyToMapCoordinates.call(n,n.mapView.getCenter())}break;case e.type==r.Z.Consts.event.ZOOMTO:{if(n.lastZoom&&performance.now()-n.lastZoom<50)return;n.lastZoom=performance.now();let t=cesium.Rectangle.fromDegrees(...e.extent);n.view3D.flyToRectangle.call(n,t);break}}},m=function(){var t=this;if(t.map.on3DView&&!t.view3D.trackingEntity){var e=t.view3D.linked2DControls.geolocation,n=e.layerTracking.features.filter((function(t){return"TC.feature.Polyline"==t.CLASSNAME}));if(n&&n.length>0){var o=[];const a=new cesium.CallbackProperty(function(t,e){if(n[0].geometry.length>o.length){var i=n[0].geometry.slice(o.length).map(function(t){var e=t;return this.view3D.view2DCRS!==this.view3D.crs&&(e=r.Z.Util.reproject(t,this.view3D.view2DCRS,this.view3D.crs)),cesium.Cartographic.fromDegrees(e[0],e[1],t[2])}.bind(this)),a=[];return a=i instanceof Array?cesium.Ellipsoid.WGS84.cartographicArrayToCartesianArray(i):[cesium.Ellipsoid.WGS84.cartographicToCartesian(i)],o=o.concat(a)}return o}.bind(this),!1);var i=new cesium.Entity({id:"trackingEntity",polyline:{positions:a,clampToGround:!0,width:3,material:new cesium.PolylineDashMaterialProperty({color:new cesium.CallbackProperty(function(n,r){return t.viewer.scene.requestRender(),cesium.Color.fromAlpha(new cesium.Color(0,255,209),e.track.renderTrack.checked?1:0)}.bind(this),!1),gapColor:cesium.Color.TRANSPARENT})}});t.view3D.trackingEntity=t.viewer.entities.add(i),t.viewer.scene.requestRender()}}},g=function(t){var e=this,n=e.view3D.linked2DControls.geolocation;switch(!0){case n.Const.Event.IMPORTEDTRACK.indexOf(t.type)>-1:case t.target.className.indexOf("draw")>-1&&t.target.parentElement.classList.contains(n.Const.Classes.SELECTEDTRACK):case!(t.target.parentElement&&t.target.parentElement.classList.contains(n.Const.Classes.SELECTEDTRACK)):case t.target.className.indexOf("stop")>-1:if(e.map.on3DView&&(e.viewer.clock.shouldAnimate=!1,e.viewer.clock.currentTime=cesium.JulianDate.fromDate(new Date)),e.view3D.trackDataSource){if(e.view3D.trackDataSource.length>0){var r=e.view3D.trackDataSource.get(0).entities.values[0];e.viewer.entities.removeById(r.id)}e.view3D.trackDataSource.destroy(),delete e.view3D.trackDataSource}if(n.chartProgressClear(),t.custom){const t=n.getSelectedTrack();t&&t.querySelector(n.Const.Selector.STOP).click()}break;case t.target.className.indexOf("play")>-1:e.viewer.clock.shouldAnimate=!1;break;case t.target.className.indexOf("pause")>-1:e.viewer.clock.shouldAnimate=!0;break;case t.target.className.indexOf("back")>-1:case t.target.className.indexOf("for")>-1:e.viewer.clock.multiplier=n.simulate_speed}},y=function(e){var n=this;const o=n.ctrlsToMng.map((function(t){return t.CLASS}));switch(n.map.controls.forEach((function(t){if(o.indexOf(t.CLASS)<0)switch(!0){case r.Z.Consts.view.DEFAULT==e:t.enable();break;case r.Z.Consts.view.THREED==e:t.disable()}})),!0){case r.Z.Consts.view.DEFAULT==e:document.querySelectorAll("[data-no-3d]").forEach((function(t){t.classList.remove(r.Z.Consts.classes.THREED_HIDDEN)})),n.ctrlsToMng.forEach((function(t){t.div.classList.remove(r.Z.Consts.classes.THREED)}));break;case r.Z.Consts.view.THREED==e:document.querySelectorAll("[data-no-3d]").forEach((function(t){t.classList.add(r.Z.Consts.classes.THREED_HIDDEN)})),n.ctrlsToMng.forEach((function(t){t.div.classList.add(r.Z.Consts.classes.THREED)}))}const i=e=>{if(n.viewer.trackedEntity)return;const o=function(){var t=n.viewer.camera.getPickRay(e.position),r=n.viewer.scene.globe.pick(t,n.viewer.scene);r&&n.view3D.getInfoOnPickedPosition.call(n,r)};var i=n.viewer.scene.pick(e.position);if(i&&i.id){var a=i.id instanceof cesium.Entity?i.id.name:i.id,s=!1;for(var l in n.view3D.vector2DFeatures)if(t.call(n.view3D.vector2DFeatures[l],a)){var c=n.map.workLayers.filter((function(t){return t.id===l}))[0].features.filter((function(t){return a.indexOf(t.id)>-1&&t.showsPopup}));if(c&&c.length>0){if(s=!0,"TC.feature.Point"!==c.CLASSNAME&&"TC.feature.Marker"!==c.CLASSNAME){var u=n.viewer.camera.getPickRay(e.position),p=n.viewer.scene.globe.pick(u,n.viewer.scene),d=n.map.view3D.addNativeFeature.call(n.map,{position:p,billboard:{image:r.Z.Util.getBackgroundUrlFromCss(n.CLASS+"-marker"),eyeOffset:new cesium.Cartesian3(0,0,-100),verticalOrigin:cesium.VerticalOrigin.BOTTOM,heightReference:cesium.HeightReference.CLAMP_TO_GROUND}});const t=function(e){if(e.control){const o=e.control,i=function(t){t.control===o&&(n.map.off(r.Z.Consts.event.RESULTSPANELCLOSE,i),n.map.view3D.removeFeature.call(n,d))};n.map.on(r.Z.Consts.event.RESULTSPANELCLOSE,i),n.map.off(r.Z.Consts.event.DRAWTABLE,t)}};n.map.on(r.Z.Consts.event.DRAWTABLE,t)}n.map.trigger(r.Z.Consts.event.FEATURECLICK,{feature:c[0]});break}}s||o()}else o()},a=t=>{if(!n.viewer.trackedEntity){var e=n.viewer.scene.pick(t.endPosition);e&&e.id?n.viewer.canvas.style.cursor="pointer":n.viewer.canvas.style.cursor="default"}};if(r.Z.Consts.view.THREED===e?(!n.view3D.linked2DControls.featureInfo&&Object.keys(n.map.options.controls).indexOf("featureInfo")>-1&&n.allowedControls.indexOf("featureInfo")>-1&&(n.view3D.linked2DControls.featureInfo=new E(n)),n.eventHandlers||(n.eventHandlers={}),n.eventHandlers.handlerOfFeatures=new cesium.ScreenSpaceEventHandler(n.viewer.scene.canvas),n.eventHandlers.handlerOfFeatures.setInputAction(i,cesium.ScreenSpaceEventType.LEFT_CLICK),n.eventHandlers.handlerOfFeatures.setInputAction(a,cesium.ScreenSpaceEventType.MOUSE_MOVE)):r.Z.Consts.view.DEFAULT===e&&n.eventHandlers.handlerOfFeatures&&n.eventHandlers.handlerOfFeatures.destroy(),!n.view3D.linked2DControls.geolocation&&Object.keys(n.map.options.controls).indexOf("geolocation")>-1&&n.allowedControls.indexOf("geolocation")>-1&&(n.view3D.linked2DControls.geolocation=n.ctrlsToMng.filter((function(t){return t instanceof r.Z.control.Geolocation}))[0]),n.view3D.linked2DControls.geolocation){var s=n.view3D.linked2DControls.geolocation;if(r.Z.Consts.view.THREED===e){var l=[s.Const.Selector.STOP,s.Const.Selector.PAUSE,s.Const.Selector.BACKWARD,s.Const.Selector.FORWARD,s.Const.Selector.DRAW],c=g.bind(n);n.view3D.linked2DControls.geolocation.videoControls=c;var u=function(t){l.some((function(e){return t.target.classList.contains(e.replace(".",""))}))&&c(t)};s.reset=function(){r.Z.wrap.control.Geolocation.prototype.setTracking=s._setTracking,r.Z.wrap.control.Geolocation.prototype.simulateTrack=s._wrap_simulateTrack,s.simulateTrack=s._simulateTrack,s.elevationTrack=s._elevationTrack,l.forEach((function(t){document.removeEventListener("click",u)})),s.off(s.Const.Event.IMPORTEDTRACK,c)},document.addEventListener("click",u),s.on(s.Const.Event.IMPORTEDTRACK,c),s._setTracking=r.Z.wrap.control.Geolocation.prototype.setTracking,r.Z.wrap.control.Geolocation.prototype.setTracking=function(t){s._setTracking.call(s.wrap,t),t?s.on(s.Const.Event.POSITIONCHANGE,m.bind(n)):(s.off(s.Const.Event.POSITIONCHANGE,m.bind(n)),n.view3D.trackingEntity&&(n.viewer.entities.removeById(n.view3D.trackingEntity.id),delete n.view3D.trackingEntity))},s._elevationTrack=s.elevationTrack,s.elevationTrack=function(t,e){return e&&g.call(n,{target:{className:"stop"},custom:!0}),s._elevationTrack.call(s,t,e)};const t=s.getSelectedTrack();var p;t&&s.hasElevation&&s.elevationTrack.call(n,t,!0),s._simulateTrack=s.simulateTrack,s.simulateTrack=function(t){var e=this.view3D.linked2DControls.geolocation;e.map.toast(e.getLocaleString("threed.interactionSimulation"),{type:r.Z.Consts.msgType.INFO}),this.viewer.clock.shouldAnimate&&this.view3D.trackDataSource&&(p(),g.call(this,{target:{className:"stop"},custom:!0})),e.simulate_speed=1,e.drawTrack(t,!1).then(function(){if(e.wrap.simulateTrack(),e.layerTrack&&e.layerTrack.features){var n=e.layerTrack.features.filter((function(t){return"TC.feature.Polyline"==t.CLASSNAME}))[0];n&&_.call(this,n.geometry,n.wrap.feature.getGeometry().layout,"track",e.markerStyle,e.lineStyle,e.walkingSpeed).then(function(e){var o=e.czml,i=e.totalDistance,a=e.coordinates2D;this.view3D.trackDataSource=new cesium.DataSourceCollection;var s=new cesium.DataSourceDisplay({scene:this.viewer.scene,dataSourceCollection:this.view3D.trackDataSource});this.viewer.scene.preRender.addEventListener((function(t,e){s.update(e)})),this.view3D.trackDataSource.add(cesium.CzmlDataSource.load(o)).then(function(e,n,o){var a,s;this.viewer.clock.shouldAnimate=!1,a=o.clock.startTime,s=o.clock.stopTime,this.viewer.clock.startTime=a.clone(),this.viewer.clock.stopTime=s.clone(),this.viewer.clock.currentTime=a.clone(),this.viewer.clock.clockStep=cesium.ClockStep.TICK_DEPENDENT,this.viewer.clock.clockRange=cesium.ClockRange.CLAMPED,this.viewer.clock.multiplier=1;var l=o.entities.values[0];l.layout=e,l.tagLI=t,l.availability=new cesium.TimeIntervalCollection([new cesium.TimeInterval({start:a,stop:s})]),this.viewer.trackedEntity&&(this.viewer.entities.removeById(this.viewer.trackedEntity.id),this.viewer.trackedEntity=null),this.viewer.entities.add(l),this.viewer.flyTo(l).then(function(){function t(t,e){for(var n,o=0,i=this.view3D.view2DCRS!==this.view3D.crs?r.Z.Util.reproject(t[0],this.view3D.view2DCRS,this.view3D.crs):t[0],a=new cesium.Cartographic.fromDegrees(i[0],i[1]),s=1;s<t.length;s++){i=this.view3D.view2DCRS!==this.view3D.crs?r.Z.Util.reproject(t[s],this.view3D.view2DCRS,this.view3D.crs):t[s];var c=new cesium.Cartographic.fromDegrees(i[0],i[1]);if(o+=new cesium.EllipsoidGeodesic(a,c).surfaceDistance,a=c,o>e){n=t[s-1];break}}if(n){var u=l.layout===ol.geom.GeometryLayout.XYZM||l.layout===ol.geom.GeometryLayout.XYZ?2:-1;if(u>-1)return n[u]}return 0}this.viewer.trackedEntity=l;var e,o=0;p=this.viewer.scene.preUpdate.addEventListener(function(r,a){const s=this.view3D.linked2DControls.geolocation.getSelectedTrack();if(!s||s.getAttribute("data-id")!==l.tagLI.getAttribute("data-id")||cesium.JulianDate.greaterThanOrEquals(a,l.availability.stop))p(),g.call(this,{target:{className:"stop"},custom:!0});else if(this.viewer.clock.shouldAnimate&&l.isAvailable(a)){e||(e=cesium.Cartographic.fromCartesian(cesium.Property.getValueOrUndefined(l.position,l.availability.start)));const r=cesium.Cartographic.fromCartesian(cesium.Property.getValueOrUndefined(l.position,a));this.view3D.linked2DControls.geolocation.hasElevation&&(l.layout===ol.geom.GeometryLayout.XYZM||(l.layout,ol.geom.GeometryLayout.XYM),this.view3D.linked2DControls.geolocation.chartSetProgress({p:[e.longitude,e.latitude,e.height],d:o},[r.longitude,r.latitude,t.call(this,n,o)],i,(l.layout===ol.geom.GeometryLayout.XYZM||l.layout===ol.geom.GeometryLayout.XYM)&&this.view3D.linked2DControls.geolocation._getTime(cesium.JulianDate.toDate(l.availability.start),cesium.JulianDate.toDate(a)))),o+=new cesium.EllipsoidGeodesic(e,r).surfaceDistance,e=r,this.viewer.scene.requestRender()}}.bind(this)),this.viewer.clock.shouldAnimate=!0}.bind(this)),this.viewer.scene.requestRender()}.bind(this,n.wrap.feature.getGeometry().layout,a))}.bind(this))}}.bind(this))}.bind(n),s._wrap_simulateTrack=r.Z.wrap.control.Geolocation.prototype.simulateTrack,r.Z.wrap.control.Geolocation.prototype.simulateTrack=function(){}}else{const t=n.view3D.linked2DControls.geolocation.getSelectedTrack();t&&n.view3D.linked2DControls.geolocation.hasElevation&&s._elevationTrack.call(n.view3D.linked2DControls.geolocation,t,!0)}}},v=function(){var t=this;t.map.workLayers.filter((function(t){return t instanceof r.Z.layer.Vector})).forEach((function(e){e.features.forEach((function(e){t.view3D.addFeature.call(t.view3D,e)}))}))};var C,L,T;const P=function(t){var e=this,n=200,o=function(t){var e=this,n=new cesium.Cartesian2(e.viewer.scene.canvas.clientWidth/2,e.viewer.scene.canvas.clientHeight/2);e.view3D.zoomToCartesian.call(e,{endPosition:n},t)};t?(C=function(t){var e=this;t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault();var n=e.view3D.view2DCRS;e.map.options.crs!==e.view3D.view2DCRS&&(n=e.map.options.crs);var o=r.Z.Util.reproject(e.map.options.initialExtent.slice(0,2),n,e.view3D.crs),i=r.Z.Util.reproject(e.map.options.initialExtent.slice(2),n,e.view3D.crs),a=cesium.Rectangle.fromDegrees(o[0],o[1],i[0],i[1]);return e.view3D.flyToRectangle.call(e,a,{duration:.1}),!1}.bind(e),L=function(t){o.call(e,n)}.bind(e),T=function(t){o.call(e,-n)}.bind(e),document.querySelectorAll("."+r.Z.control.NavBarHome.prototype.CLASS+"-btn").forEach((function(t){t.addEventListener("click",C)})),document.querySelectorAll("."+r.Z.control.NavBar.prototype.CLASS+"-btn-zoomin").forEach((function(t){t.addEventListener("click",L)})),document.querySelectorAll("."+r.Z.control.NavBar.prototype.CLASS+"-btn-zoomout").forEach((function(t){t.addEventListener("click",T)}))):(document.querySelectorAll("."+r.Z.control.NavBarHome.prototype.CLASS+"-btn").forEach((function(t){t.removeEventListener("click",C)})),document.querySelectorAll("."+r.Z.control.NavBar.prototype.CLASS+"-btn-zoomin").forEach((function(t){t.removeEventListener("click",L)})),document.querySelectorAll("."+r.Z.control.NavBar.prototype.CLASS+"-btn-zoomout").forEach((function(t){t.removeEventListener("click",T)})))},A=function(t){return r.Z.Consts.event.MOUSEMOVE===t?r.Z.Util.detectMobile()?cesium.ScreenSpaceEventType.LEFT_CLICK:cesium.ScreenSpaceEventType.MOUSE_MOVE:r.Z.Consts.event.CLICK===t?cesium.ScreenSpaceEventType.LEFT_CLICK:t};return{container:null,crs:"EPSG:4326",crsPattern:/(EPSG\:?4326)/i,view2DCRS:null,customRender:null,baseLayer:null,workLayers:[],vector2DLayers:[],vector2DFeatures:{},linked2DControls:{},isLoadingTiles:function(){var t=this.viewer.scene.globe._surface;return!t._tileProvider.ready||t._tileLoadQueueHigh.length>0||t._tileLoadQueueMedium.length>0||t._tileLoadQueueLow.length>0||t._debug.tilesWaitingForChildren>0},loadViewer:function(){const t=this;return new Promise((function(e,n){t.viewer?e(t.viewer):r.Z.loadJSInOrder(!window[r.Z.Consts.CESIUMNS],[r.Z.apiLocation+r.Z.Consts.url.CESIUM,r.Z.apiLocation+r.Z.Consts.url.CESIUM_CONNECTOR],(function(){var n=cesium.Resource.fetchJson({url:r.Z.apiLocation+"/dataSource/contornoNavarra.json"}).then((function(t){return t&&t.features&&t.features.length>0?t.features[0].geometry.coordinates[0]:[]}));cesium.when.all([cesium.ApproximateTerrainHeights.initialize(),n],(function(){var n,o,i=Array.prototype.slice.call(arguments[0])[1];t.terrainFallback&&(n={url:t.terrainFallback.url.trim(),layerName:t.terrainFallback.layerName,format:t.terrainFallback.format,noDataValue:t.terrainFallback.noDataValue}),n?o=new cesium.MergeTerrainProvider(t.terrain,t,{boundaries:i,fallback:[n]}):((o=new cesium.CesiumTerrainProvider({url:t.terrain.url.trim()})).sampleTerrainMostDetailed=function(t){return cesium.sampleTerrainMostDetailed(o,t)},o.attributions={},t.terrain.attributions&&(o.getAttribution=function(){return o.attributions},o.attributions=t.terrain.attributions,t.map.trigger(r.Z.Consts.event.TERRAINPROVIDERADD,{terrainProvider:o})));var a=new cesium.Globe;a.baseColor=cesium.Color.WHITE,a.enableLighting=!1,a.tileCacheSize=1e3,a.maximumScreenSpaceError=5,t.viewer=t.view3D.viewer=new cesium.Viewer(t.selectors.divThreedMap,{terrainProvider:o,terrainExaggeration:1,animation:!1,timeline:!1,fullscreenButton:!1,baseLayerPicker:!1,imageryProvider:!1,navigationInstructionsInitiallyVisible:!1,navigationHelpButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,selectionIndicator:!1,globe:a,requestRenderMode:!0,maximumRenderTimeChange:1/0}),t.viewer.scene.backgroundColor=cesium.Color.WHITE,t.viewer.scene.screenSpaceCameraController.enableCollisionDetection=!0,t.viewer.scene.screenSpaceCameraController.maximumZoomDistance=1e6,t.viewer.scene.imageryLayers.removeAll(),t.viewer.terrainProvider.errorEvent.addEventListener((function(t){if(t.error)switch(t.error.statusCode){case 403:case 404:console.log("es un 404 de terreno")}}),t),t.viewer.scene.renderError.addEventListener((function(t,e){var n=this;e&&18===e.code||(n.divThreedMap.classList.remove(n.classes.LOADING),n.map.toast(n.getLocaleString("fi.error"),{type:r.Z.Consts.msgType.ERROR}),n.unapply())}),t),t.viewer.readyPromise=new Promise((function(e,n){t.view3D.tileLoadingHandler=new cesium.EventHelper,t.view3D.tileLoadingHandler.add(t.viewer.scene.globe.tileLoadProgressEvent,function(n){t.waiting||(t.waiting=t.map.getLoadingIndicator().addWait()),(t.viewer.scene.terrainProvider.allReady||!t.viewer.scene.terrainProvider.allReady&&t.viewer.scene.terrainProvider.ready)&&0===n?(t.map.getLoadingIndicator().removeWait(t.waiting),delete t.waiting,e(),t.events.trigger(r.Z.Consts.event.TERRAINLOADED,{})):t.events.trigger(r.Z.Consts.event.TERRAINRECEIVING,{})}.bind(t))})),P.call(t,!0),document.querySelectorAll(".cesium-viewer-bottom").forEach((function(t){t.parentElement.removeChild(t)})),t.view3D._event2DHandler=d.bind(t),t.map.on(l.join(" "),t.view3D._event2DHandler),y.call(t,r.Z.Consts.view.THREED),t.viewer.readyPromise.then((function(){v.call(t)})),e(t.viewer)}))}))}))},setBaseLayer:function(t){var e=this,n=function(t){return o(t,e.view3D.crs)||(null!==t.getFallbackLayer()&&o(t.getFallbackLayer(),e.view3D.crs)?t=t.getFallbackLayer():(e.map.toast(e.getLocaleString("threed.crsNoCompatible",{name:t.title})),t=null)),t};e.view3D.baseLayer?(e.viewer.scene.imageryLayers.contains(e.view3D.baseLayer)&&(e.viewer.scene.imageryLayers.raiseToTop(e.view3D.baseLayer),e.viewer.scene.imageryLayers.remove(e.view3D.baseLayer,!0)),t instanceof r.Z.layer.Vector?(e.view3D.baseLayer=e.Consts.BLANK_BASE,e.map.getLoadingIndicator().removeWait(e.waiting),delete e.waiting):(t=n(t))&&(t.map=e.map,t.isBase=!0,e.view3D.addLayer.call(e,t))):t.type===r.Z.Consts.layerType.WMTS||t.type===r.Z.Consts.layerType.WMS?t.options.relatedWMTS?(e.map.baseLayer=t=e.map.getLayer(t.options.relatedWMTS),e.map.trigger(r.Z.Consts.event.BASELAYERCHANGE,{layer:e.map.baseLayer})):(t=n(t))&&(t.isBase||(t.isBase=!0),e.view3D.addLayer.call(e,t)):e.view3D.baseLayer=e.Consts.BLANK_BASE,b.baseMap=e.map.baseLayer},addLayer:function(t){var e=this;switch(!0){case r.Z.Consts.layerType.VECTOR==t.type:e.view3D.vector2DLayers.push(t);break;case r.Z.Consts.layerType.WMTS==t.type:case r.Z.Consts.layerType.WMS==t.type:t.isBase||t.isCompatible(e.view3D.crs)?n.convert(t,e.view3D.crs).then((function(n){if(n){void 0!==n.enablePickFeatures&&(n.enablePickFeatures=!1,n.tcLayer=t),t.isBase&&e.view3D.baseLayer&&e.viewer.scene.imageryLayers.contains(e.view3D.baseLayer)&&(e.viewer.scene.imageryLayers.raiseToTop(e.view3D.baseLayer),e.viewer.scene.imageryLayers.remove(e.view3D.baseLayer,!0));var r=e.viewer.scene.imageryLayers.addImageryProvider(n);t.isBase?(e.view3D.baseLayer=r,e.viewer.scene.imageryLayers.lowerToBottom(r)):(r.show=t.getVisibility(),r.alpha=t.getOpacity(),e.view3D.workLayers.push(r))}})):e.map.toast(e.getLocaleString("threed.crsNoCompatible",{name:t.layerNames}))}},removeLayer:function(e){var n=this;switch(!0){case r.Z.Consts.layerType.VECTOR==e.type:if(n.view3D.vector2DFeatures&&t.call(n.view3D.vector2DFeatures,e.id)){for(var o in n.view3D.vector2DFeatures[e.id])for(var i=n.view3D.vector2DFeatures[e.id][o],a=0;a<i.length;a++)n.view3D.removeFeature.call(n,i[a]);delete n.view3D.vector2DFeatures[e.id]}break;case r.Z.Consts.layerType.WMTS==e.type:case r.Z.Consts.layerType.WMS==e.type:for(a=0;a<n.view3D.workLayers.length;a++)if(e.names&&n.view3D.workLayers[a].imageryProvider.layers.join(",")===e.names.join(",")||e.title&&n.view3D.workLayers[a].imageryProvider.layers.join(",")===e.title){n.viewer.scene.imageryLayers.raiseToTop(n.view3D.workLayers[a]),n.viewer.scene.imageryLayers.remove(n.view3D.workLayers[a],!0),n.view3D.workLayers.splice(a,1);break}}},setRenderOptionsLayer:function(e,n){var o=this;switch(!0){case r.Z.Consts.layerType.VECTOR==e.type:if(o.view3D.vector2DFeatures[e.id]){for(var i in o.view3D.vector2DFeatures[e.id])for(var a=o.view3D.vector2DFeatures[e.id][i],s=0;s<a.length;s++)o.view3D.setRenderOptionsFeature(a[s],{show:e.getVisibility()});o.viewer.scene.requestRender()}break;case r.Z.Consts.layerType.WMTS==e.type:case r.Z.Consts.layerType.WMS==e.type:for(s=0;s<o.view3D.workLayers.length;s++){const r=Array.isArray(o.view3D.workLayers[s].imageryProvider.layers)?o.view3D.workLayers[s].imageryProvider.layers.join(","):o.view3D.workLayers[s].imageryProvider.layers;if(e.names&&r===e.names.join(",")||e.title&&r===e.title){t.call(n,"visibility")&&(o.view3D.workLayers[s].show=n.visibility),t.call(n,"opacity")&&(o.view3D.workLayers[s].alpha=n.opacity);break}}o.viewer.scene.requestRender()}},flyToMapCoordinates:function(t){var e=this,n=e.view3D.view2DCRS!==e.view3D.crs?r.Z.Util.reproject(t,e.view3D.view2DCRS,e.view3D.crs):t,o=cesium.Cartesian3.fromDegrees(n[0],n[1],e.viewer.camera.positionCartographic.height),i=e.viewer.camera;i.flyTo({destination:o,orientation:{heading:i.heading,pitch:i.pitch}})}.bind(e),flyToRectangle:function(t,e){const n=this;return n.viewer.scene.camera.cancelFlight(),new Promise((function(r,o){e=e||{};var i=cesium.Math.EPSILON3;t.east===t.west&&(t.east+=i,t.west-=i),t.north===t.south&&(t.north+=i,t.south-=i);var a=.2,s=t.width*a/2,l=t.height*a/2;t.east-=s,t.west+=l,t.north+=l,t.south-=l;var c=n.viewer.scene,u=c.camera,p=u.getRectangleCameraCoordinates(t),d=cesium.Ellipsoid.WGS84.cartesianToCartographic(p);cesium.when(c.globe.terrainProvider.sampleTerrainMostDetailed([cesium.Rectangle.center(t)]),(function(t){var o={longitude:d.longitude,latitude:d.latitude,height:d.height+t[0].height||0};u.flyTo({duration:e.duration||1,destination:cesium.Ellipsoid.WGS84.cartographicToCartesian(o),complete:function(){var t=cesium.Math.toRadians(50),e=f(this.viewer.scene);e=cesium.Matrix4.fromTranslation(e),this.view3D.rotateAroundAxis(this.viewer.scene.camera,-t,this.viewer.scene.camera.right,e,{duration:250,callback:function(){r()}})}.bind(n)})}))}))}.bind(e),zoomToCartesian:function(t,e){var n=this,r=n.viewer.scene;if(!t||!t.endPosition){var o=r.canvas,i=new cesium.Cartesian2(o.clientWidth/2,o.clientHeight/2);t={endPosition:i}}var a=r.camera.getPickRay(t.endPosition),s=r.globe.pick(a,r);if(s){var l=cesium.Cartesian3.distance(a.origin,s);if(l<1)return;n.view3D._zoomTo||(n.view3D._zoomTo={amount:0}),n.view3D._zoomTo.direction=e>0?1:0,n.view3D._zoomTo.amount+=5*l/100,n.view3D._zoomTo.endPosition=t.endPosition}var c=function(e){var n=this,r=n.viewer.scene,o=r.camera.getPickRay(t.endPosition||e.endPosition),i=r.globe.pick(o,r);if(i){if(cesium.Cartesian3.distance(o.origin,i)<1)return;var a=r.camera.position,s=(r.camera.direction,new cesium.Cartesian3),l=s;cesium.Cartesian3.multiplyByScalar(o.direction,1==e.direction?e.amount:-e.amount,l),cesium.Cartesian3.add(a,l,s);var c=new cesium.Ray(s,o.direction),u=r.globe.pick(c,r);if(u){var p=function(){this.view3D._zoomTo={direction:1,amount:0,endPosition:{}}};cesium.Cartesian3.distance(s,u)<1||Math.abs(cesium.Ellipsoid.WGS84.cartesianToCartographic(s).height)<r.screenSpaceCameraController.minimumZoomDistance?p.call(n):n.viewer.camera.flyTo({destination:s,orientation:{heading:r.camera.heading,pitch:r.camera.pitch,roll:r.camera.roll},duration:1,easingFunction:cesium.EasingFunction.LINEAR_NONE,complete:function(t){this.view3D._zoomTo={direction:1,amount:0,endPosition:{}}}.bind(n,cesium.Cartesian3.distance(s,u))})}}};setTimeout(function(){c.call(n,n.view3D._zoomTo)}.bind(n),50)},rotateAroundAxis:function(t,e,n,r,o){return p(t,e,n,r,o)},addFeature:function(t,e){var n=this,o=function(){var e=i.convert(n.viewer.scene,t,n.view2DCRS,n.crs);if(e)if("function"==typeof e.geometry)e.geometry(n.viewer.terrainProvider).then((function(e){if(e instanceof Array)e.forEach((function(e){e instanceof Array?e.forEach((function(e){e=a.call(n,e),s(n,t.layer.id,e,t.id)})):(e=a.call(n,e),s(n,t.layer.id,e,t.id))}));else{var r=a.call(n,e);s(n,t.layer.id,r,t.id)}}));else if(e.geometry instanceof Array)e.geometry.forEach((function(e){e=a.call(n,e),s(n,t.layer.id,e,t.id)}));else{var r=a.call(n,e.geometry);s(n,t.layer.id,r,t.id)}};if(n.linked2DControls.featureInfo&&n.linked2DControls.featureInfo.get2DMarker()===t||n.linked2DControls.featureInfo&&n.linked2DControls.featureInfo.isPending())setTimeout((function(){n.linked2DControls.featureInfo.get2DMarker()!==t&&o()}),5);else{if(n.linked2DControls.geolocation&&n.linked2DControls.geolocation.layerTracking===t.layer&&t instanceof r.Z.feature.Polyline)return;o()}},removeFeature:function(t){var e=this;if(e.viewer&&t){switch(!0){case t instanceof cesium.GroundPrimitive:e.viewer.scene.groundPrimitives.remove(t);break;case t instanceof cesium.Billboard:e.viewer.billboardCollection.remove(t);break;case t instanceof Object:e.viewer.entities.removeById(t.id)}e.viewer.scene.requestRender()}},setRenderOptionsFeature:function(t,e){t&&(t.show=e.show)},addNativeFeature:function(t){return a.call(this.view3D,t)},setCameraFromMapView:function(){var t=this;t.viewer.scene.globe.terrainProvider.readyPromise.then((function(){var e=t.mapView.getCenter();if(e){var n=t.view3D.view2DCRS!==t.view3D.crs?r.Z.Util.reproject(e,t.view3D.view2DCRS,t.view3D.crs):e,o=c.call(t,t.mapView.getResolution()||0,cesium.Math.toRadians(n[0])),i=(n=t.view3D.view2DCRS!==t.view3D.crs?r.Z.Util.reproject(e,t.view3D.view2DCRS,t.view3D.crs):e,new cesium.Cartographic(cesium.Math.toRadians(n[0]),cesium.Math.toRadians(n[1])));t.viewer.scene.globe&&(i.height=t.viewer.scene.globe.getHeight(i)||0);var a=function(){if(t.map.on3DView){var e=cesium.Ellipsoid.WGS84.cartographicToCartesian(i),n={pitch:cesium.Math.toRadians(-90),heading:-t.mapView.getRotation(),roll:0};t.viewer.camera.setView({destination:e,orientation:n}),t.viewer.camera.moveBackward(o)}};0===i.height?r.Z.loadJS(!r.Z.tool||!r.Z.tool.Elevation,r.Z.apiLocation+"TC/tool/Elevation",(function(){t.view3D.elevationTool=new r.Z.tool.Elevation,t.view3D.elevationTool.getElevation({crs:t.view3D.crs,coordinates:[n]}).then((function(t){t&&t.length>0&&(i.height=t[0][2]?t[0][2]:0,a())})).catch((t=>console.log(t)))})):a()}}))},setViewFromCameraView:function(){const t=this;var e=cesium.Ellipsoid.WGS84,n=t.viewer.scene,o=h(n);if(!o){var i=t.viewer.scene.globe,a=t.viewer.camera.positionCartographic.clone(),s=i.getHeight(a);a.height=s||0,o=cesium.Ellipsoid.WGS84.cartographicToCartesian(a)}var l=cesium.Cartesian3.distance(o,t.viewer.camera.position),c=e.cartesianToCartographic(o),p=t.view3D.crs!==t.view3D.view2DCRS?r.Z.Util.reproject([cesium.Math.toDegrees(c.longitude),cesium.Math.toDegrees(c.latitude)],t.view3D.crs,t.view3D.view2DCRS):[cesium.Math.toDegrees(c.longitude),cesium.Math.toDegrees(c.latitude)];return t.mapView.setCenter(p),t.mapView.setResolution(u.call(t,l,c?c.latitude:0)),Promise.resolve()},lookAt:function(t){const e=this;e.crs!==e.view2DCRS&&(t=r.Z.Util.reproject(t,e.view2DCRS,e.crs));var n=e.viewer.camera,o=n.positionCartographic.height,i=new cesium.Cartographic(cesium.Math.toRadians(t[0]),cesium.Math.toRadians(t[1]),o);n.flyTo({destination:cesium.Cartesian3.fromRadians(i.longitude,i.latitude,i.height),duration:1})},getInfoOnPickedPosition:function(t){var e=this;t&&(e.map.one(r.Z.Consts.event.DRAWTABLE,(function(t){e.map.getLoadingIndicator().removeWait(e.waiting),delete e.waiting})),e.view3D.linked2DControls.featureInfo.send.call(e,t).then((function(t){e.map.getLoadingIndicator().removeWait(e.waiting),delete e.waiting})))},on:function(t,e){const n=this,r=function(t){if(n.viewer&&n.viewer.cesiumWidget){var e=n.viewer.camera.getPickRay(t.endPosition||t.position),r=n.viewer.scene.globe.pick(e,n.viewer.scene);if(r){var o,i=cesium.Ellipsoid.WGS84.cartesianToCartographic(r);return o=cesium.Math.toDegrees(i.latitude),{lon:cesium.Math.toDegrees(i.longitude),lat:o,ele:Math.round(i.height)}}}return null};n.eventHandlers||(n.eventHandlers={}),n.eventHandlers.handlerOfMovementConversion=new cesium.ScreenSpaceEventHandler(n.viewer.scene.canvas),n.eventHandlers.handlerOfMovementConversion.setInputAction((function(t){if(t.endPosition||t.position){if(n.viewer.trackedEntity)return;e(r(t))}else e(t)}),A(t))},getHeightFromMDT:function(t){const e=this;var n=new cesium.Cartographic(cesium.Math.toRadians(t[0]),cesium.Math.toRadians(t[1]));return e.viewer.scene.globe.getHeight(n)||0},addElevationMarker:function(t,e){const n=this;n.viewer&&!n.viewer.view3DElevationMarkerPromise&&(n.viewer.view3DElevationMarkerPromise=!0,n.viewer.readyPromise.then((function(){delete n.viewer.view3DElevationMarkerPromise;const o=n.view2DCRS!==n.crs?r.Z.Util.reproject(t,n.view2DCRS,n.crs):t;let i=new cesium.Entity({position:cesium.Cartesian3.fromDegrees(o[0],o[1]),name:"elevationMarker",point:{show:!0,color:cesium.Color.RED.withAlpha(.5),pixelSize:10,outlineColor:cesium.Color.WHITE,outlineWidth:2,heightReference:cesium.HeightReference.CLAMP_TO_GROUND}});e.view3DElevationMarker=a.call(n,i)})))},setElevationMarker:function(t,e){const n=this;n.viewer&&n.viewer.readyPromise.then((function(){if(e.view3DElevationMarker){const o=n.view2DCRS!==n.crs?r.Z.Util.reproject(t,n.view2DCRS,n.crs):t;e.view3DElevationMarker.position=cesium.Cartesian3.fromDegrees(o[0],o[1],n.viewer.camera.positionCartographic.height),e.view3DElevationMarker.show||(e.view3DElevationMarker.show=!0),n.viewer.scene.requestRender()}else n.addElevationMarker(t,e)}))},hideElevationMarker:function(t){const e=this;e.viewer&&t.view3DElevationMarker&&e.viewer.readyPromise.then((function(){e.removeFeature.call(e,t.view3DElevationMarker),delete t.view3DElevationMarker}))},destroy:function(){var t=this;t.map.on3DView=!1,t.view3D.vector2DLayers=[],t.view3D.vector2DFeatures={},t.map.off(l.join(" "),t.view3D._event2DHandler),y.call(t,r.Z.Consts.view.DEFAULT),P.call(t,!1),Promise.all(t.map.baseLayers.map((function(e){return Promise.resolve(!o(e,t.view3D.view2DCRS))}))).then((function(e){let n;if(e.length>0){for(var o,i=0;i<t.map.baseLayers.length;i++)o||e[i]||(o=t.map.baseLayers[i]),t.map.baseLayers[i]&&(t.map.baseLayers[i].mustReproject=e[i]);n=!0;const s=function(e,o,i){const a={layer:o};i&&(a.fallbackLayer=i);var s=t.map.getControlsByClass(e?r.Z.control.BasemapSelector:r.Z.control.Coordinates);s.length>0&&(s[0]instanceof r.Z.control.Coordinates&&(n=!1),a.closeCallback=function(){t.map.trigger(r.Z.Consts.event.VIEWCHANGE,{view:r.Z.Consts.view.DEFAULT})},s[0].showProjectionChangeDialog(a))};var a=b.baseMap==t.Consts.BLANK_BASE?b.baseVector:b.baseMap;a.isCompatible(t.map.getCRS())?t.map.setBaseLayer(a):a.fallbackLayer?(a.getFallbackLayer(),a.getFallbackLayer().isCompatible(t.map.getCRS())?r.Z.confirm(t.getLocaleString("threed.changeBaselayer"),(function(){s(!1,a,a.fallbackLayer)}),(function(){t.map.setBaseLayer(a.fallbackLayer)})):s(!0,a)):s(!0,a)}b.baseMap="",t.view3D.baseLayer=null,t.view3D.workLayers=[],t.view3D.cameraControls.unbind(),t.view3D.linked2DControls.featureInfo&&t.view3D.linked2DControls.featureInfo.reset(),t.view3D.linked2DControls.geolocation&&(t.view3D.linked2DControls.geolocation.isGeo=!1,t.view3D.linked2DControls.geolocation.reset()),t.view3D.tileLoadingHandler.removeAll(),delete t.view3D.tileLoadingHandler,t.viewer.destroy(),t.viewer=null,n&&t.map.trigger(r.Z.Consts.event.VIEWCHANGE,{view:r.Z.Consts.view.DEFAULT})}))}}}(),{init:e.init.bind(e),apply:e.apply.bind(e),unapply:e.unapply.bind(e),VIEWNAME:e.VIEWNAME}}()},4001:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});var r=n(5361),o=n(4769);const i={Map:function(t){var e=this;e.parent=t,e.map=null,e.getMap=function(){return e._promise}},Layer:function(t){var e=this;e.parent=t,e.layer=null,o.Z.call(e),e.getLayer=function(){return e.layer?Promise.resolve(e.layer):e._promise},e.setLayer=function(t){e.layer=t}},layer:{Raster:function(){i.Layer.apply(this,arguments)},Vector:function(){i.Layer.apply(this,arguments)}},Control:function(t){this.parent=t},control:{Click:function(){i.Control.apply(this,arguments)},ScaleBar:function(){i.Control.apply(this,arguments)},NavBar:function(){i.Control.apply(this,arguments)},NavBarHome:function(){i.Control.apply(this,arguments)},Coordinates:function(){i.Control.apply(this,arguments)},Search:function(){i.Control.apply(this,arguments)},Measure:function(){i.Control.apply(this,arguments)},OverviewMap:function(){i.Control.apply(this,arguments)},FeatureInfo:function(){i.Control.apply(this,arguments)},Popup:function(){i.Control.apply(this,arguments)},GeometryFeatureInfo:function(){i.Control.apply(this,arguments)},Geolocation:function(){i.Control.apply(this,arguments)},Draw:function(){i.Control.apply(this,arguments)},Modify:function(){i.Control.apply(this,arguments)},OfflineMapMaker:function(){i.Control.apply(this,arguments)},Edit:function(){i.Control.apply(this,arguments)},ResultsPanel:function(){i.Control.apply(this,arguments)}},Feature:function(){},Geometry:function(){}};r.Z.inherit(i.Layer,o.Z),r.Z.inherit(i.layer.Raster,i.Layer),r.Z.inherit(i.layer.Vector,i.Layer),r.Z.inherit(i.control.Click,i.Control),r.Z.inherit(i.control.ScaleBar,i.Control),r.Z.inherit(i.control.NavBar,i.Control),r.Z.inherit(i.control.NavBarHome,i.Control),r.Z.inherit(i.control.Coordinates,i.Control),r.Z.inherit(i.control.Measure,i.Control),r.Z.inherit(i.control.OverviewMap,i.Control),r.Z.inherit(i.control.Popup,i.Control),r.Z.inherit(i.control.FeatureInfo,i.control.Click),r.Z.inherit(i.control.GeometryFeatureInfo,i.control.Click),r.Z.inherit(i.control.Geolocation,i.Control),r.Z.inherit(i.control.Draw,i.Control),r.Z.inherit(i.control.OfflineMapMaker,i.Control),r.Z.inherit(i.control.Edit,i.Control),r.Z.inherit(i.control.ResultsPanel,i.Control);const a=i}},__webpack_module_cache__={},leafPrototypes,getProto,inProgress,dataWebpackPrefix;function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var n=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t].call(n.exports,n,n.exports,__webpack_require__),n.exports}__webpack_require__.m=__webpack_modules__,__webpack_require__.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return __webpack_require__.d(e,{a:e}),e},getProto=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,__webpack_require__.t=function(t,e){if(1&e&&(t=this(t)),8&e)return t;if("object"==typeof t&&t){if(4&e&&t.__esModule)return t;if(16&e&&"function"==typeof t.then)return t}var n=Object.create(null);__webpack_require__.r(n);var r={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var o=2&e&&t;"object"==typeof o&&!~leafPrototypes.indexOf(o);o=getProto(o))Object.getOwnPropertyNames(o).forEach((e=>r[e]=()=>t[e]));return r.default=()=>t,__webpack_require__.d(n,r),n},__webpack_require__.d=(t,e)=>{for(var n in e)__webpack_require__.o(e,n)&&!__webpack_require__.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},__webpack_require__.f={},__webpack_require__.e=t=>Promise.all(Object.keys(__webpack_require__.f).reduce(((e,n)=>(__webpack_require__.f[n](t,e),e)),[])),__webpack_require__.u=t=>"chunks/"+t+".sitna.js",__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),inProgress={},dataWebpackPrefix="SITNA:",__webpack_require__.l=(t,e,n,r)=>{if(inProgress[t])inProgress[t].push(e);else{var o,i;if(void 0!==n)for(var a=document.getElementsByTagName("script"),s=0;s<a.length;s++){var l=a[s];if(l.getAttribute("src")==t||l.getAttribute("data-webpack")==dataWebpackPrefix+n){o=l;break}}o||(i=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,__webpack_require__.nc&&o.setAttribute("nonce",__webpack_require__.nc),o.setAttribute("data-webpack",dataWebpackPrefix+n),o.src=t),inProgress[t]=[e];var c=(e,n)=>{o.onerror=o.onload=null,clearTimeout(u);var r=inProgress[t];if(delete inProgress[t],o.parentNode&&o.parentNode.removeChild(o),r&&r.forEach((t=>t(n))),e)return e(n)},u=setTimeout(c.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=c.bind(null,o.onerror),o.onload=c.bind(null,o.onload),i&&document.head.appendChild(o)}},__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;__webpack_require__.g.importScripts&&(t=__webpack_require__.g.location+"");var e=__webpack_require__.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");n.length&&(t=n[n.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpack_require__.p=t})(),(()=>{var t={179:0};__webpack_require__.f.j=(e,n)=>{var r=__webpack_require__.o(t,e)?t[e]:void 0;if(0!==r)if(r)n.push(r[2]);else{var o=new Promise(((n,o)=>r=t[e]=[n,o]));n.push(r[2]=o);var i=__webpack_require__.p+__webpack_require__.u(e),a=new Error;__webpack_require__.l(i,(n=>{if(__webpack_require__.o(t,e)&&(0!==(r=t[e])&&(t[e]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;a.message="Loading chunk "+e+" failed.\n("+o+": "+i+")",a.name="ChunkLoadError",a.type=o,a.request=i,r[1](a)}}),"chunk-"+e,e)}};var e=(e,n)=>{var r,o,[i,a,s]=n,l=0;if(i.some((e=>0!==t[e]))){for(r in a)__webpack_require__.o(a,r)&&(__webpack_require__.m[r]=a[r]);if(s)s(__webpack_require__)}for(e&&e(n);l<i.length;l++)o=i[l],__webpack_require__.o(t,o)&&t[o]&&t[o][0](),t[o]=0},n=self.webpackChunkSITNA=self.webpackChunkSITNA||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})();var __webpack_exports__={};(()=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Cfg:()=>o.v,Consts:()=>n.Z,Map:()=>c,feature:()=>y});var t=__webpack_require__(5361),e=__webpack_require__(7945),n=__webpack_require__(2089),r=__webpack_require__(5798),o=__webpack_require__(1468),i=__webpack_require__(9774),a=__webpack_require__(907),s=__webpack_require__(4496),l=window.SITNA||{};t.Z.Map=i.Z,l.Consts=n.Z,l.Cfg=t.Z.Cfg=o.v,t.Z.Util=e.Z,t.Z.filter=s.Z,t.Z.control=t.Z.control||{},t.Z.control.Search=a.default,l.Map=function(e,n){const r=this;if(t.Z.Cfg.controls.search&&(t.Z.Cfg.controls.search.allowedSearchTypes=t.Z.Util.extend(t.Z.Cfg.controls.search.allowedSearchTypes,{urban:{},street:{},number:{},cadastral:{}}),n&&n.controls&&n.controls.search)){const e=Object.keys(n.controls.search),r=t.Z.Util.extend(n.controls.search,{allowedSearchTypes:{}});e.forEach((function(e){if("boolean"==typeof n.controls.search[e]||t.Z.Util.isPlainObject(n.controls.search[e])){if(n.controls.search[e])switch(!0){case"placeName"===e:r.allowedSearchTypes[t.Z.Consts.searchType.PLACENAME]=t.Z.Util.isPlainObject(n.controls.search[e])?n.controls.search[e]:{};break;case"placeNameMunicipality"===e:r.allowedSearchTypes[t.Z.Consts.searchType.PLACENAMEMUNICIPALITY]=t.Z.Util.isPlainObject(n.controls.search[e])?n.controls.search[e]:{};break;case"postalAddress"===e:r.allowedSearchTypes[t.Z.Consts.searchType.NUMBER]=t.Z.Util.isPlainObject(n.controls.search[e])?n.controls.search[e]:{};break;case"cadastralParcel"===e:r.allowedSearchTypes[t.Z.Consts.searchType.CADASTRAL]=t.Z.Util.isPlainObject(n.controls.search[e])?n.controls.search[e]:{};break;case"town"===e:r.allowedSearchTypes[t.Z.Consts.searchType.URBAN]=t.Z.Util.isPlainObject(n.controls.search[e])?n.controls.search[e]:{};break;default:r.allowedSearchTypes[e]=t.Z.Util.isPlainObject(n.controls.search[e])?n.controls.search[e]:{}}delete r[e]}})),n.controls.search=r}t.Z.Cfg.controls.threeD&&l.Cfg.views&&l.Cfg.views.threeD&&(l.Cfg.views.threeD.controls=["search","toc","attribution","basemapSelector","workLayerManager","layerCatalog","featureInfo","fullScreen","loadingIndicator","navBarHome","navBar","overviewMap","legend","threeD","coordinates","geolocation","resultsPanel","share"]),t.Z.Map.call(r,e,n),r.search=null,r.loaded((async function(){const e=r._searchControl=new t.Z.control.Search;if(e.register(r),!r.activeControl){const t=r.getControlsByClass("TC.control.FeatureInfo")[0];t&&t.activate()}r._searchLayer=await e.getLayer()}))},t.Z.inherit(l.Map,t.Z.Map),function(){const e=l.Map.prototype;e.getQueryableData=async function(e,n){const r=this,o=r._searchControl.availableSearchTypes[e];if(o.queryableData)n&&n(o.queryableData);else{const e={request:"GetFeature",service:"WFS",typename:o.featurePrefix+":"+o.featureType,version:o.version,propertyname:(o.dataIdProperty instanceof Array?o.dataIdProperty:[o.dataIdProperty]).concat(o.outputProperties instanceof Array?o.outputProperties:[o.outputProperties]).join(","),outputformat:t.Z.Consts.format.JSON},p=o.url+"?"+t.Z.Util.getParamString(e),d=(await t.Z.ajax({url:p,responseType:t.Z.Consts.mimeType.JSON})).data;if(o.queryableData=[],d.features){const t=d.features;for(var i=0,a=t.length;i<a;i++){const e=t[i],n={id:[]};Array.isArray(o.dataIdProperty)||(o.dataIdProperty=[o.dataIdProperty]);for(var s=0,l=o.dataIdProperty.length;s<l;s++){const t=o.dataIdProperty[s];Object.prototype.hasOwnProperty.call(e.properties,t)&&n.id.push(e.properties[t])}n.id=o.idPropertiesIdentifier?n.id.join(o.idPropertiesIdentifier):n.id.join(""),n.label=[],Array.isArray(o.outputProperties)||(o.outputProperties=[o.outputProperties]);for(var c=0,u=o.outputProperties.length;c<u;c++){const t=o.outputProperties[c];Object.prototype.hasOwnProperty.call(e.properties,t)&&n.label.push(e.properties[t])}const r=(Array.isArray(n.label)?n.label.join(""):n.label).trim().length>0;n.label=o.outputFormatLabel?o.outputFormatLabel.tcFormat(n.label):n.label.join("-"),r&&o.queryableData.push(n)}}o.queryableData=o.queryableData.sort((function(t,e){const n=r._searchControl;return o.idPropertiesIdentifier&&-1===t.id.indexOf(o.idPropertiesIdentifier)?n.removePunctuation(t.label)<n.removePunctuation(e.label)?-1:n.removePunctuation(t.label)>n.removePunctuation(e.label)?1:0:n.removePunctuation(t.label.split(" ")[0])<n.removePunctuation(e.label.split(" ")[0])?-1:n.removePunctuation(t.label.split(" ")[0])>n.removePunctuation(e.label.split(" ")[0])?1:0})),o.queryableData=o.queryableData.filter((function(t,e,n){return e<1||t.id!==n[e-1].id&&t.label!==n[e-1].label})),n&&n(o.queryableData)}return o.queryableData},e.getMunicipalities=function(t){return this.getQueryableData(l.Consts.mapSearchType.MUNICIPALITY,t)},e.getUrbanAreas=function(t){return this.getQueryableData(l.Consts.mapSearchType.URBAN,t)},e.getCommonwealths=function(t){return this.getQueryableData(l.Consts.mapSearchType.COMMONWEALTH,t)},e.getCouncils=function(t){return this.getQueryableData(l.Consts.mapSearchType.COUNCIL,t)},e.searchCommonwealth=function(t,e){return this.searchTyped(l.Consts.mapSearchType.COMMONWEALTH,t,e)},e.searchCouncil=function(t,e){return this.searchTyped(l.Consts.mapSearchType.COUNCIL,t,e)},e.searchUrbanArea=function(t,e){return this.searchTyped(l.Consts.mapSearchType.URBAN,t,e)},e.searchMunicipality=function(t,e){return this.searchTyped(l.Consts.mapSearchType.MUNICIPALITY,t,e)},e.searchTyped=function(e,n,r){const o=this,i=t.Z.getUID(),a=o._searchControl,s=a.availableSearchTypes[e];return Array.isArray(n)&&s.goToIdFormat&&(n=s.goToIdFormat.tcFormat(n)),a.data=a.data||[],a.data.push({dataLayer:s.featureType,dataRole:e,id:n,label:"",text:""}),o.removeSearch(),a.availableSearchTypes[e]&&!a.getSearchTypeByRole(e)&&(a.availableSearchTypes[e].goTo||(a.availableSearchTypes[e].goTo=function(e){return{params:{type:t.Z.Consts.layerType.WFS,url:this.url,version:this.version,geometryName:this.geometryName,featurePrefix:this.featurePrefix,featureType:this.featureType,properties:function(e){let n=[];s.idPropertiesIdentifier&&(e=e.split(s.idPropertiesIdentifier)),Array.isArray(e)||(e=[e]);for(var r=0,o=s.dataIdProperty.length;r<o;r++)n.push(new t.Z.filter.equalTo(s.dataIdProperty[r],e[r].trim()));return n=n.length>1?new t.Z.filter.and(n):n[0],n}(e),outputFormat:this.outputFormat,styles:this.styles}}}.bind(s)),a.addAllowedSearchType(e,a.availableSearchTypes[e],a)),new Promise((function(s,l){o.one(t.Z.Consts.event.SEARCHQUERYEMPTY,(function(e){o.toast(a.EMPTY_RESULTS_LABEL,{type:t.Z.Consts.msgType.INFO,duration:5e3}),r&&r(null),s(null)})),o.one(t.Z.Consts.event.FEATURESADD,(function(t){t.layer===o._searchLayer&&t.layer.features&&t.layer.features.length>0&&o.zoomToFeatures(t.layer.features),o.search={layer:t.layer,type:e};const n=t.layer.id!==i?t.layer.id:i;r&&r(n),s(n)})),a.goToResult(n,e)}))},e.searchFeature=function(e,n,r,o){const i=this,a=t.Z.getUID();let s=i._searchControl.featurePrefix;if(i.removeSearch(),e=(e||"").trim(),n=(n||"").trim(),r=(r||"").trim(),0!==e.length&&0!==n.length&&0!==r.length){e.indexOf(":")>-1&&(s=e.split(":")[0],e=e.split(":")[1]);const c=function(e){if(Array.isArray(e)){const n=e.map((function(e){return Object.prototype.hasOwnProperty.call(e,"type")?!0==(e.type===t.Z.Consts.comparison.EQUAL_TO)?new t.Z.filter.equalTo(e.name,e.value):void 0:new t.Z.filter.equalTo(e.name,e.value)}));return n.length>1?t.Z.filter.and.apply(null,n):n[0]}},u={id:a,type:l.Consts.layerType.WFS,url:i._searchControl.url,version:i._searchControl.version,stealth:!0,geometryName:"the_geom",featurePrefix:s,featureType:e,maxFeatures:1,properties:c([{name:n,value:r,type:t.Z.Consts.comparison.EQUAL_TO}]),outputFormat:t.Z.Consts.format.JSON};let p;return i.addLayer(u).then((function(t){p=t,i.search={layer:t,type:l.Consts.mapSearchType.GENERIC}})),i.on(t.Z.Consts.event.FEATURESADD,(function(t){const e=t.layer;if(e===p&&e.features&&e.features.length>0){for(var n=0,r=e.features.length;n<r;n++)e.features[n].showsPopup!=i._searchControl.queryableFeatures&&(e.features[n].showsPopup=i._searchControl.queryableFeatures);i.zoomToFeatures(e.features)}})),new Promise((function(e,n){i.on(t.Z.Consts.event.LAYERUPDATE,(function(n){const r=n.layer,s=n.newData;r===p&&s&&s.features&&0===s.features.length&&i.toast(i._searchControl.EMPTY_RESULTS_LABEL,{type:t.Z.Consts.msgType.INFO,duration:5e3});const l=r===p&&s&&s.features&&0===s.features.length?null:a;o&&o(l),e(l)}))}))}i.toast(i._searchControl.EMPTY_RESULTS_LABEL,{type:t.Z.Consts.msgType.INFO,duration:5e3}),o&&o(null)},e.removeSearch=function(t){const e=this;if(e.search){const t=e._searchControl.availableSearchTypes[e.search.type];if(t&&Object.prototype.hasOwnProperty.call(t,"goTo")){for(var n=0,r=e.search.layer.features.length;n<r;n++)e.search.layer.removeFeature(e.search.layer.features[n]);e.search=null}else e.removeLayer(e.search.layer).then((function(){e.search=null}))}t&&t()}}();const c=l.Map;var u=__webpack_require__(6804);const p={};p.feature=p.feature||{},t.Z.feature=t.Z.feature||{},t.Z.feature.Marker=u.Z,p.feature.Marker=function(e,n){t.Z.feature.Marker.apply(this,e,n)},t.Z.inherit(p.feature.Marker,t.Z.feature.Marker);const d=p.feature.Marker;var h=__webpack_require__(1774),f=__webpack_require__(4001),m=__webpack_require__(2641);__webpack_require__(3908),__webpack_require__(8325);
/**
 * @overview API SITNA: API JavaScript para la visualización de datos georreferenciados en aplicaciones web.
 * @version 3.0.0
 * @copyright 2019 Gobierno de Navarra
 * @license BSD-2-Clause
 * @author Fernando Lacunza <flacunza@itracasa.es>
 */
t.Z.isDebug=!1,t.Z.Util=e.Z,t.Z.Consts=n.Z,t.Z.i18n=r.Z,t.Z.Cfg=o.v,t.Z.Map=i.Z,t.Z.wrap=f.Z,t.Z.tool={Proxification:h.Z},globalThis.TC=t.Z;var g=g||{};g.feature=g.feature||{},g.feature.Marker=d,t.Z.version="3.0.0 [2022-12-7 13:49:08]",t.Z.loadCSS(t.Z.apiLocation+"TC/css/tcmap.css"),t.Z.loadProjDef({crs:"EPSG:25830",name:"ETRS89 / UTM zone 30N",def:"+proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs"}),t.Z.loadProjDef({crs:"EPSG:4258",name:"ETRS89",def:"+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs +axis=neu"}),t.Z.loadProjDef({crs:"EPSG:3040",name:"ETRS89 / UTM zone 28N (N-E)",def:"+proj=utm +zone=28 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"}),t.Z.loadProjDef({crs:"EPSG:3041",name:"ETRS89 / UTM zone 29N (N-E)",def:"+proj=utm +zone=29 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"}),t.Z.loadProjDef({crs:"EPSG:3042",name:"ETRS89 / UTM zone 30N (N-E)",def:"+proj=utm +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"}),t.Z.loadProjDef({crs:"EPSG:3043",name:"ETRS89 / UTM zone 31N (N-E)",def:"+proj=utm +zone=31 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"}),t.Z.loadProjDef({crs:"EPSG:4230",name:"ED50",def:"+proj=longlat +ellps=intl +towgs84=-87,-98,-121,0,0,0,0 +no_defs +axis=neu"}),t.Z.loadProjDef({crs:"EPSG:25828",name:"ETRS89 / UTM zone 28N",def:"+proj=utm +zone=28 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"}),t.Z.loadProjDef({crs:"EPSG:25829",name:"ETRS89 / UTM zone 29N",def:"+proj=utm +zone=29 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"}),t.Z.loadProjDef({crs:"EPSG:25831",name:"ETRS89 / UTM zone 31N",def:"+proj=utm +zone=31 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"}),t.Z.loadJS(!t.Z.browserFeatures.urlParser(),t.Z.apiLocation+t.Z.Consts.url.URL_POLYFILL,(function(){})),document.addEventListener("DOMContentLoaded",(function(){var e,n,r="Unknown library";if(window.ol&&(r="OpenLayers "+ol.VERSION),t.Z.version=t.Z.version+" ("+r+"; @ "+t.Z.apiLocation+")",t.Z.browser=t.Z.Util.getBrowser(),t.Z.loadJS(!t.Z.Cfg.acceptedBrowserVersions,t.Z.apiLocation+"TC/config/browser-versions.js",(function(e){t.Z._isSupported=!0;var n=t.Z.Cfg.acceptedBrowserVersions.filter((function(e){return e.name.toLowerCase()===t.Z.browser.name.toLowerCase()}));if(n.length>0&&n[0].expired)t.Z.Cfg.loggingErrorsEnabled=!1;else if(n.length>0&&!isNaN(n[0].version)&&t.Z.browser.version<n[0].version&&(t.Z._isSupported=!1),t.Z.Cfg.oldBrowserAlert&&!t.Z._isSupported){t.Z.Cfg.loggingErrorsEnabled=!1;const e=t.Z.Map.get(document.querySelector("."+t.Z.Consts.classes.MAP));t.Z.i18n.loadResources(!t.Z.i18n[e.options.locale],t.Z.apiLocation+"TC/resources/",e.options.locale).then((function(){t.Z.error(t.Z.Util.getLocaleString(e.options.locale,"outdatedBrowser"),t.Z.Consts.msgErrorMode.TOAST)}))}})),/ip(ad|hone|od)/i.test(navigator.userAgent)&&(t.Z.Consts.event.CLICK="touchstart"),t.Z.Cfg.loggingErrorsEnabled){m.JL.setOptions({defaultAjaxUrl:t.Z.Consts.url.ERROR_LOGGER.includes("//localhost")?"":t.Z.Consts.url.ERROR_LOGGER});const r=(n=0,function(r){if(!(e=e||t.Z.Map.get(document.querySelector("."+t.Z.Consts.classes.MAP))))return!1;var o,i,a,s="",l=-1,c=-1;if("unhandledrejection"===r.type?(o=r.reason?r.reason instanceof XMLDocument?r.reason.firstElementChild.outerHTML:r.reason.message:"",a=!r.reason||!r.reason.stack||r.reason.stack.indexOf(t.Z.apiLocation)>=0,i=r.reason):(o=r.message,s=r.filename,l=r.lineno,c=r.colno,i=r.error,a=s.indexOf(t.Z.apiLocation)>=0),(t.Z.Cfg.notifyApplicationErrors||a)&&n<t.Z.Cfg.maxErrorCount&&t.Z.Cfg.loggingErrorsEnabled){const r=e.getPreviousMapState(),p=function(e){var u=a?t.Z.Consts.text.API_ERROR:t.Z.Consts.text.APP_ERROR;(0,m.JL)("onerrorLogger").fatalException({msg:u,errorMsg:o,url:s,lineNumber:l,column:c,appUrl:e,apiVersion:t.Z.version,prevState:r,userAgent:navigator.userAgent},i),n++};let d=location.href;const h=e.exportControlStates()||[];if(h.length>0){var u=location.href;const t=u.indexOf("#");t>0&&(u=u.substring(0,t)),e.getMapState({extraStates:{ctl:h}}).then((t=>{d=u.concat("#",t),p(d)}))}else p(d);t.Z.isDebug||t.Z.i18n.loadResources(!t.Z.i18n[e.options.locale],t.Z.apiLocation+"TC/resources/",e.options.locale).then((function(){t.Z.error(t.Z.Util.getLocaleString(e.options.locale,"genericError")+(e.options.contactEmail||"webmaster@itracasa.es"),{type:t.Z.Consts.msgType.ERROR})}))}return!1});window.addEventListener("error",r,!1),window.addEventListener("unhandledrejection",r,!1)}})),g.Map=c,o.v.layout=t.Z.apiLocation+"TC/layout/responsive";const y=g.feature})(),SITNA=__webpack_exports__})();
//# sourceMappingURL=maps/sitna.js.map
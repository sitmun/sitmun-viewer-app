var SITNA;(()=>{var __webpack_modules__={837:(e,t,r)=>{var n={"./Attribution":9753,"./Attribution.js":9753,"./BasemapSelector":7687,"./BasemapSelector.js":7687,"./CacheBuilder":3041,"./CacheBuilder.js":3041,"./Click":5669,"./Click.js":5669,"./Container":3678,"./Container.js":3678,"./ControlContainer":9524,"./ControlContainer.js":9524,"./Coordinates":6188,"./Coordinates.js":6188,"./DataLoader":8002,"./DataLoader.js":8002,"./Download":658,"./Download.js":658,"./Draw":1235,"./Draw.js":1235,"./DrawMeasureModify":4975,"./DrawMeasureModify.js":4975,"./Edit":4916,"./Edit.js":4916,"./Elevation":2212,"./Elevation.js":2212,"./ExternalWMS":2429,"./ExternalWMS.js":2429,"./FeatureDownloadDialog":3697,"./FeatureDownloadDialog.js":3697,"./FeatureInfo":2863,"./FeatureInfo.js":2863,"./FeatureInfoCommons":4094,"./FeatureInfoCommons.js":4094,"./FeatureStyler":9717,"./FeatureStyler.js":9717,"./FeatureTools":1497,"./FeatureTools.js":1497,"./FileEdit":8127,"./FileEdit.js":8127,"./FileImport":7622,"./FileImport.js":7622,"./FullScreen":707,"./FullScreen.js":707,"./Geolocation":5573,"./Geolocation.js":5573,"./GeometryFeatureInfo":1885,"./GeometryFeatureInfo.js":1885,"./LanguageSelector":4743,"./LanguageSelector.js":4743,"./LayerCatalog":4997,"./LayerCatalog.js":4997,"./Legend":6460,"./Legend.js":6460,"./LineFeatureInfo":9186,"./LineFeatureInfo.js":9186,"./ListTOC":9886,"./ListTOC.js":9886,"./LoadingIndicator":9945,"./LoadingIndicator.js":9945,"./MapContents":8239,"./MapContents.js":8239,"./MapInfo":3784,"./MapInfo.js":3784,"./Measure":3965,"./Measure.js":3965,"./Measurement":895,"./Measurement.js":895,"./Modify":5516,"./Modify.js":5516,"./MultiFeatureInfo":1391,"./MultiFeatureInfo.js":1391,"./NavBar":4234,"./NavBar.js":4234,"./NavBarHome":2855,"./NavBarHome.js":2855,"./OfflineMapMaker":6994,"./OfflineMapMaker.js":6994,"./OverviewMap":6436,"./OverviewMap.js":6436,"./PolygonFeatureInfo":9889,"./PolygonFeatureInfo.js":9889,"./Popup":5590,"./Popup.js":5590,"./Print":674,"./Print.js":674,"./PrintMap":4283,"./PrintMap.js":4283,"./ProjectionSelector":7292,"./ProjectionSelector.js":7292,"./ResultsPanel":8644,"./ResultsPanel.js":8644,"./SWCacheClient":5515,"./SWCacheClient.js":5515,"./Scale":8792,"./Scale.js":8792,"./ScaleBar":9510,"./ScaleBar.js":9510,"./ScaleSelector":6161,"./ScaleSelector.js":6161,"./Search":9085,"./Search.js":9085,"./SelectContainer":333,"./SelectContainer.js":333,"./Share":2749,"./Share.js":2749,"./StreetView":3510,"./StreetView.js":3510,"./TOC":2006,"./TOC.js":2006,"./TabContainer":3640,"./TabContainer.js":3640,"./ThreeD":7885,"./ThreeD.js":7885,"./WFSEdit":5122,"./WFSEdit.js":5122,"./WFSQuery":6564,"./WFSQuery.js":6564,"./WebComponentControl":2461,"./WebComponentControl.js":2461,"./WorkLayerManager":849,"./WorkLayerManager.js":849,"./infoShare":7167,"./infoShare.js":7167,"./itemToolContainer":5198,"./itemToolContainer.js":5198,"./layerOwner":2416,"./layerOwner.js":2416};function i(e){return o(e).then(r)}function o(e){return Promise.resolve().then((()=>{if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}))}i.keys=()=>Object.keys(n),i.resolve=o,i.id=837,e.exports=i},8949:(e,t,r)=>{var n={"./Attribution":9753,"./Attribution.js":9753,"./BasemapSelector":7687,"./BasemapSelector.js":7687,"./CacheBuilder":3041,"./CacheBuilder.js":3041,"./Click":5669,"./Click.js":5669,"./Container":3678,"./Container.js":3678,"./ControlContainer":9524,"./ControlContainer.js":9524,"./Coordinates":6188,"./Coordinates.js":6188,"./DataLoader":8002,"./DataLoader.js":8002,"./Download":658,"./Download.js":658,"./Draw":1235,"./Draw.js":1235,"./DrawMeasureModify":4975,"./DrawMeasureModify.js":4975,"./Edit":4916,"./Edit.js":4916,"./Elevation":2212,"./Elevation.js":2212,"./ExternalWMS":2429,"./ExternalWMS.js":2429,"./FeatureDownloadDialog":3697,"./FeatureDownloadDialog.js":3697,"./FeatureInfo":2863,"./FeatureInfo.js":2863,"./FeatureInfoCommons":4094,"./FeatureInfoCommons.js":4094,"./FeatureStyler":9717,"./FeatureStyler.js":9717,"./FeatureTools":1497,"./FeatureTools.js":1497,"./FileEdit":8127,"./FileEdit.js":8127,"./FileImport":7622,"./FileImport.js":7622,"./FullScreen":707,"./FullScreen.js":707,"./Geolocation":5573,"./Geolocation.js":5573,"./GeometryFeatureInfo":1885,"./GeometryFeatureInfo.js":1885,"./LanguageSelector":4743,"./LanguageSelector.js":4743,"./LayerCatalog":4997,"./LayerCatalog.js":4997,"./Legend":6460,"./Legend.js":6460,"./LineFeatureInfo":9186,"./LineFeatureInfo.js":9186,"./ListTOC":9886,"./ListTOC.js":9886,"./LoadingIndicator":9945,"./LoadingIndicator.js":9945,"./MapContents":8239,"./MapContents.js":8239,"./MapInfo":3784,"./MapInfo.js":3784,"./Measure":3965,"./Measure.js":3965,"./Measurement":895,"./Measurement.js":895,"./Modify":5516,"./Modify.js":5516,"./MultiFeatureInfo":1391,"./MultiFeatureInfo.js":1391,"./NavBar":4234,"./NavBar.js":4234,"./NavBarHome":2855,"./NavBarHome.js":2855,"./OfflineMapMaker":6994,"./OfflineMapMaker.js":6994,"./OverviewMap":6436,"./OverviewMap.js":6436,"./PolygonFeatureInfo":9889,"./PolygonFeatureInfo.js":9889,"./Popup":5590,"./Popup.js":5590,"./Print":674,"./Print.js":674,"./PrintMap":4283,"./PrintMap.js":4283,"./ProjectionSelector":7292,"./ProjectionSelector.js":7292,"./ResultsPanel":8644,"./ResultsPanel.js":8644,"./SWCacheClient":5515,"./SWCacheClient.js":5515,"./Scale":8792,"./Scale.js":8792,"./ScaleBar":9510,"./ScaleBar.js":9510,"./ScaleSelector":6161,"./ScaleSelector.js":6161,"./Search":9085,"./Search.js":9085,"./SelectContainer":333,"./SelectContainer.js":333,"./Share":2749,"./Share.js":2749,"./StreetView":3510,"./StreetView.js":3510,"./TOC":2006,"./TOC.js":2006,"./TabContainer":3640,"./TabContainer.js":3640,"./ThreeD":7885,"./ThreeD.js":7885,"./WFSEdit":5122,"./WFSEdit.js":5122,"./WFSQuery":6564,"./WFSQuery.js":6564,"./WebComponentControl":2461,"./WebComponentControl.js":2461,"./WorkLayerManager":849,"./WorkLayerManager.js":849,"./infoShare":7167,"./infoShare.js":7167,"./itemToolContainer":5198,"./itemToolContainer.js":5198,"./layerOwner":2416,"./layerOwner.js":2416};function i(e){return Promise.resolve().then((()=>{if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r(n[e])}))}i.keys=()=>Object.keys(n),i.id=8949,e.exports=i},9180:(e,t,r)=>{"use strict";r.d(t,{Z:()=>l});var n=r(330),i=r(6204),o=r(9529);function a(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class s extends i.Z{constructor(e,t){super(e,t),a(this,"STYLETYPE",n.Z.geom.POLYGON);const r=this;r.wrap.isNative(e)||r.wrap.createCircle(s.parseGeometry(e),t)}static parseGeometry(e){let t=e;Object.prototype.hasOwnProperty.call(e,"center")&&Object.prototype.hasOwnProperty.call(e,"radius")&&(t=[e.center,[e.center[0]+e.radius,e.center[1]]]);const r=t[0],n=t[1];if(Array.isArray(t)&&Array.isArray(r)&&!isNaN(r[0])&&!isNaN(r[1])&&Array.isArray(n)&&!isNaN(n[0])&&!isNaN(n[1]))return t;throw new Error("Coordinates not valid for circle")}setCoordinates(e){return e&&(e=s.parseGeometry(e)),super.setCoordinates.call(this,e)}getCenter(){return this.wrap.getGeometry()[0]}getRadius(e){const[t,r]=this.getCoordinates(e);return Math.hypot(r[0]-t[0],r[1]-t[1])}getCoords(){return this.getCoordinates()}setCoords(e){return this.setCoordinates(e)}getCoordsArray(){return this.getCoordinates()}toPolygon(e=72){const t=this,r=t.getRadius(),n=t.getCenter(),i=new Array(e),a=2*Math.PI/e;let s=0;for(var l=0;l<e;l++)i[l]=[n[0]+r*Math.cos(s),n[1]+r*Math.sin(s)],s+=a;return new o.Z([i],Object.assign({},t.options))}}const l=s},6204:(e,t,r)=>{"use strict";r.d(t,{Z:()=>m});var n=r(688),i=r(330),o=r(268),a=r(9967),s=r(7497),l=r(9524);function c(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}function u(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,d(e,t,"set"),r),r}function h(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,d(e,t,"get"))}function d(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}var f=new WeakMap,g=new WeakMap,y=new WeakMap;const m=class{constructor(e,t){u(this,"STYLETYPE",i.Z.geom.POLYGON),c(this,f,{writable:!0,value:!1}),c(this,g,{writable:!0,value:!1}),c(this,y,{writable:!0,value:i.Z.visibility.VISIBLE}),u(this,"toggleSelectedStyle",(function(e){const t=this;return h(t,f)!==e&&(p(t,f,e),t.wrap.toggleSelectedStyle(e)),t})),u(this,"getLegend",(function(){const e=this;return e._legend||(e._legend=e.wrap.getLegend()),e._legend})),u(this,"getGeometryStride",(function(){const e=this.getCoordsArray()[0];return e?e.length:0}));const r=this;let a;r.wrap=new n.Z.wrap.Feature,r.wrap.parent=r,r.wrap.isNative(e)&&(r.wrap.feature=e,e._wrap=r.wrap,a=r.wrap.getId(),r.geometry=r.wrap.getGeometry(),e._folders&&(r.folders=e._folders),r.setData(r.wrap.getData()));var s=r.options=o.Z.extend(!0,{},t);r.id=a||s.id||n.Z.getUID(),r.wrap.feature&&!a&&r.wrap.feature.setId(r.id),r.data=s.data||r.data||null,void 0===s.showsPopup?r.showsPopup=!0:r.showsPopup=s.showsPopup,s.showPopup&&(r.autoPopup=!0),r.layer=s.layer||null,s.selected&&r.select()}getPath(){const e=this;let t=[];return e.folders?t=e.folders:e.options.group&&(t=[e.options.group]),t}setVisibility(e){const t=this;if(!e&&t.showsPopup&&t.layer){var r=t.layer.map.getControlsByClass("TC.control.Popup").filter((function(e){return e.currentFeature===t}));if(r.length>0){const e=r[0];e.isVisible()&&e.hide()}}return(e&&h(t,y)===i.Z.visibility.NOT_VISIBLE||!e&&h(t,y)===i.Z.visibility.VISIBLE)&&(p(t,y,e?i.Z.visibility.VISIBLE:i.Z.visibility.NOT_VISIBLE),t.layer.wrap.setFeatureVisibility(t,e)),t}getVisibilityState(){return h(this,y)}getId(){return this.wrap.getId()}setId(e){const t=this;return t.id=e,t.wrap.setId(e),t}getBounds(){return this.wrap.getBounds()}setStyle(e){const t=this;let r;if(null===e)r=null;else{var n,i,s,l,c;const u=[t.getStyle(),e];null!==(n=t.layer)&&void 0!==n&&null!==(i=n.styles)&&void 0!==i&&i[t.STYLETYPE]&&u.unshift(t.layer.styles[t.STYLETYPE]),null!==(s=t.layer)&&void 0!==s&&null!==(l=s.map.options.styles)&&void 0!==l&&l[t.STYLETYPE]&&u.unshift(t.layer.map.options.styles[t.STYLETYPE]),null!==a.Z&&void 0!==a.Z&&null!==(c=a.Z.styles)&&void 0!==c&&c[t.STYLETYPE]&&u.unshift(a.Z.styles[t.STYLETYPE]),r=o.Z.mergeStyles(...u)}return t.wrap.setStyle(r),t}getCoordinates(e){var t,r,i,o,s,l;const c=this,u=(null==e?void 0:e.geometryCrs)||(null!==(t=c.layer)&&void 0!==t&&null!==(r=t.map)&&void 0!==r&&r.on3DView?c.layer.map.view3D.crs:null===(i=c.layer)||void 0===i||null===(o=i.map)||void 0===o?void 0:o.crs),p=(null==e?void 0:e.crs)||(null===(s=c.layer)||void 0===s||null===(l=s.map)||void 0===l?void 0:l.getCRS())||a.Z.utmCrs;return c.geometry=c.wrap.getGeometry(),u&&p?n.Z.Util.reproject(c.geometry,u,p):c.geometry}setCoordinates(e){const t=this,r=function(e){e.forEach((function(t,n){Array.isArray(t)?r(t):null===t?e[n]=0:"number"!=typeof t&&(console.log("Warning: coordinate does not have number type"),e[n]=parseFloat(t))}))};return Array.isArray(e)&&r(e),t.geometry=e,t.wrap.setGeometry(e),t}getCoords(){return this.getCoordinates()}setCoords(e){return this.setCoordinates(e)}getCoordsArray(){const e=function(e){return Array.isArray(e)&&e.length>=2&&"number"==typeof e[0]&&"number"==typeof e[1]},t=function(t){return e(t)?[t]:t.reduce(r,[])},r=function(r,n){return e(n)?r.push(n):r=r.concat(t(n)),r};return t(this.getCoordinates())}removeZ(){var e;const t=this,r=t.getCoordsArray();return(null===(e=r[0])||void 0===e?void 0:e.length)>2&&(r.forEach((e=>e.length=2)),t.setCoordinates(t.geometry)),t}getData(){const e=this;let t=null;return t=e.data?e.data:e.wrap.getData(),t}setData(e){const t=this;if("string"==typeof e)t.data=e;else{for(var r in t.data=o.Z.extend(t.data,e),t.attributes=t.attributes||[],e){let n=t.attributes.find((e=>e.name===r));n?n.value=e[r]:t.attributes.push({name:r,value:e[r]})}t.wrap.setData(e)}return t}unsetData(e){const t=this;delete t.data[e];const r=(t.attributes||[]).find((t=>t.name===e));return r&&t.attributes.splice(t.attributes.indexOf(r),1),t.wrap.unsetData(e),t}clearData(){const e=this;return e.data={},e.attributes=[],e.wrap.clearData(),e}getInfo(e){var t;const r=this;let i=null;const a=(null==e?void 0:e.locale)||(null===(t=r.layer)||void 0===t?void 0:t.map)&&o.Z.getMapLocale(r.layer.map),s=r.getData();if("object"==typeof s){var l=r.wrap.getTemplate();if(l)i=l.replace(/\$\[?(?:\w+\/)*([^><]+)\]/g,(function(e,t){return s[t]instanceof Object&&Object.prototype.hasOwnProperty.call(s[t],"value")?s[t].value:s[t]}));else{var c=[];const e=[],t=o.Z.getLocaleString(a,"open"),r=o.Z.getLocaleString(a,"linkInNewWindow"),l=function(e){let i;return i=o.Z.isURL(e)?`<a href="${e}" target="_blank" title="${r}">${t}</a>`:void 0!==e?"number"==typeof e?n.Z.Util.formatNumber(e,a):e:"&mdash;",i},p=function(e){var t=[];if(e instanceof Array){const r="complexAttr_"+n.Z.getUID();t.push(`<div class="tc-complex-attr"><input type="checkbox" id="${r}" /><div><label for="${r}" title="" class="tc-plus"></label>`),t.push(`<label for="${r}" title="" class="tc-title">${e.length} ${o.Z.getLocaleString(a,"featureInfo.complexData.array")}</label><br/>`),t.push('<table class="tc-complex-attr"><tbody>'),e.forEach((e=>{t.push("<tr><td>"),(t=t.concat(p(e))).push("</td></tr>")})),t.push("</tbody></table></div></div>")}else if(e instanceof Object)if(e.getType){const r={type:e.getType(),coordinates:e.getCoordinates()};t=t.concat(p(r))}else{for(var r in t.push('<table class="tc-complex-attr"><tbody>'),e){if(t.push("<tr>"),e[r]&&e[r]instanceof Array){const i="complexAttr_"+n.Z.getUID();t.push(`<th style="display:none">${r}</th>\n                                           <td><label for="${i}" class="tc-title">${r}</label><br/>`),(t=t.concat(p(e[r]))).push("</div></td>")}else if(e[r]&&e[r]instanceof Object){const i="complexAttr_"+n.Z.getUID();t.push(`<th style="display:none">${r}</th>\n                                           <td><input type="checkbox" id="${i}" /><div><label for="${i}" title="" class="tc-plus"></label>`),t.push(`<label for="${i}" title="" class="tc-title">${r}</label><br/>`),(t=t.concat(p(e[r]))).push("</div></td>")}else t.push(`<th class="key">${r}</th>\n                                           <td class="value">`),(t=t.concat(p(e[r]))).push("</td>");t.push("</tr>")}t.push("</tbody></table>")}else t.push(l(e));return t};for(var u in s){const t=s[u],r=u.match(/^h(\d)_/i);r?e[r[1]]=t:"string"==typeof t||"number"==typeof t||void 0===t?c.push(`<tr><th>${u}</th><td>${l(t)}</td></tr>`):(c.push(`<tr><th>${u}</th><td>`),(c=c.concat(p(t))).push("</td></tr>"))}const h=e.map((function(e,t){if(e)return`<h${t}>${e}</h${t}>`})).filter((function(e){return e}));h.length&&(c=h.concat(c)),c.length>0&&(c.unshift('<table class="tc-attr">'),c.push("</table>"),i=c.join(""))}}else"string"==typeof s&&(i=s);return i||(i=r.title,r.group&&(i+=" "+r.group)),i||(i=o.Z.getLocaleString(a,"noData")),i}getTemplate(){let e=this.wrap.getTemplate();return e||null}clone(){const e=this,t=e.wrap.cloneFeature();t._wrap=e.wrap;const r=new e.constructor(t,e.options);return e.folders&&(r.folders=e.folders.slice()),r}getStyle(){return this.wrap.getStyle()}async showPopup(e){var t;const r=this,n=(e=e||{})instanceof s.Z?e:e.control,o=(null===(t=r.layer)||void 0===t?void 0:t.map)||(null==n?void 0:n.map);if(o){let t=n||r.popup;if(!t)for(var a=o.getControlsByClass("TC.control.Popup"),l=0,c=a.length;l<c;l++){var u=a[l];if(!u.caller){t=u;break}}return t||(t=await o.addControl("popup")),t.currentFeature=r,o.getControlsByClass("TC.control.Popup").filter((e=>e!==t&&e.isVisible())).forEach((e=>e.hide())),t.getContainerElement()||await t.renderPromise(),t.setDragged(!1),r.wrap.showPopup(Object.assign({},e,{control:t})),o.trigger(i.Z.event.POPUP,{control:t}),t.fitToView(!0),t.contentDiv.querySelectorAll("img").forEach((e=>e.addEventListener("load",(()=>t.fitToView())))),t}return null}async showResultsPanel(e){var t;const r=this,o=(e=e||{})instanceof s.Z?e:e.control,a=(null===(t=r.layer)||void 0===t?void 0:t.map)||(null==o?void 0:o.map);if(a){let t;var c={content:"table",titles:{main:n.Z.Util.getLocaleString(a.options.locale,"rsp.title"),max:n.Z.Util.getLocaleString(a.options.locale,"rsp.title")}},u=a.getControlsByClass(l.default)[0];u?(c.position=u.POSITION.RIGHT,t=a.getControlsByClass("TC.control.ResultsPanel").find((e=>e.currentFeature===r)),t||(t=await u.addControl("resultsPanel",c))):(c.div=document.createElement("div"),a.div.appendChild(c.div),t=a.getControlsByClass("TC.control.ResultsPanel").find((e=>e.currentFeature===r)),t||(t=await a.addControl("resultsPanel",c))),t.currentFeature=r,0===a.getControlsByClass(l.default).length&&a.getControlsByClass("TC.control.ResultsPanel").filter((e=>"table"===e.options.content)).forEach((function(e){e.close()}));a.getControlsByClass("TC.control.ResultsPanel").filter((e=>t!==e)).forEach((function(e){e.currentFeature&&!e.chart&&e.close()})),t.menuDiv.innerHTML="",t.open(e.html||r.getInfo({locale:a.options.locale}),t.getInfoContainer());new ResizeObserver((e=>{for(let t of e)t.target.querySelectorAll("h3, h4").forEach((function(e){e.addEventListener("mouseenter",(function(e){this.offsetWidth<this.scrollWidth?this.title=this.childNodes.item(0).textContent:this.title=""}),{passive:!0})}))})).observe(t.infoDiv);var p=function(e){a.off(i.Z.event.VIEWCHANGE,p),t.close()};return a.on(i.Z.event.VIEWCHANGE,p),t}return null}async showInfo(e){const t=this;if(e=e||{},!n.Z.control||!n.Z.control.FeatureInfoCommons){const e=await Promise.resolve().then(r.bind(r,4094));n.Z.control=n.Z.control||{},n.Z.control.FeatureInfoCommons=e.default}let a;a=t.getTemplate()?t.getInfo():"string"==typeof t.data?t.data:await n.Z.control.FeatureInfoCommons.renderFeatureAttributeTable({attributes:t.attributes,singleFeature:!0});const s=o.Z.extend({},e,{html:a});let l;if(e.control&&n.Z.control){const n=e.control,i=(await Promise.resolve().then(r.bind(r,5590))).default,o=(await Promise.resolve().then(r.bind(r,8644))).default;n instanceof i?l=await t.showPopup(s):n instanceof o&&(l=await t.showResultsPanel(s))}else l=t.layer.map.on3DView||t.layer.map.defaultInfoContainer===i.Z.infoContainer.RESULTS_PANEL?await t.showResultsPanel(s):await t.showPopup(s);t.infoControl=l,t.layer.features.filter((e=>e!==t)).forEach((e=>e.toggleSelectedStyle(!1))),t.toggleSelectedStyle(!0),n.Z.control.FeatureInfoCommons.addSpecialAttributeEventListeners(l.getContainerElement())}select(){const e=this;p(e,g,!0),e.layer&&e.layer.selectedFeatures.push(e);var t=e.options.selection||{};return e.setStyle(o.Z.extend({},a.Z.styles.selection[e.STYLETYPE],t[e.STYLETYPE])),e}unselect(){const e=this;if(p(e,g,!1),e.setStyle(e.options),e.layer){const t=e.layer.selectedFeatures.indexOf(e);t>=0&&e.layer.selectedFeatures.splice(t,1)}return e}isSelected(){return h(this,g)}toGML(e,t){return this.wrap.toGML(e,t)}}},6382:(e,t,r)=>{"use strict";r.d(t,{Z:()=>u});var n=r(688),i=r(3048),o=r(330),a=r(9967),s=r(3089);function l(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}n.Z.i18n=n.Z.i18n||s.Z;class c extends i.Z{constructor(e,t){super(e,t),l(this,"STYLETYPE","marker");const r=this;if(!r.wrap.isNative(e)){const i=r.layer&&r.layer.map?r.layer.map.options.locale:a.Z.locale;r.title=r.options.title||n.Z.i18n[i][o.Z.MARKER],r.wrap.createMarker(e,t)}}}const u=c},1848:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var n=r(8033);function i(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class o extends n.Z{constructor(e,t){super(e,t),i(this,"STYLETYPE","marker");const r=this;r.wrap.isNative(e)||(r.wrap.feature=e,r.wrap.createMultiMarker(e,t))}getCoordinates(e){return super.getCoordinates.call(this,e)}setCoordinates(e){if(e){if(!Array.isArray(e))throw new TypeError("Coordinates not valid for multimarker");Array.isArray(e[0])||(e=[e])}return super.setCoordinates.call(this,e)}getCoords(e){return this.getCoordinates(e)}setCoords(e){return this.setCoordinates(e)}}const a=o},8033:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var n=r(6204),i=r(330);function o(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class a extends n.Z{constructor(e,t){super(e,t),o(this,"STYLETYPE",i.Z.geom.POINT);const r=this;r.wrap.isNative(e)||(r.wrap.feature=e,r.wrap.createMultiPoint(e,t))}getCoordinates(e){return super.getCoordinates.call(this,e)}setCoordinates(e){if(e){if(!Array.isArray(e))throw new TypeError("Coordinates not valid for multipoint");Array.isArray(e[0])||(e=[e])}return super.setCoordinates.call(this,e)}getCoords(e){return this.getCoordinates(e)}setCoords(e){return this.setCoordinates(e)}getCoordsArray(){return this.getCoordinates()}}const s=a},5265:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var n=r(6204),i=r(330);function o(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class a extends n.Z{constructor(e,t){super(e,t),o(this,"STYLETYPE",i.Z.geom.POLYGON);const r=this;r.wrap.isNative(e)||r.wrap.createMultiPolygon(e,t)}getCoordinates(e){const t=super.getCoordinates.call(this,e);return null!=e&&e.pointArray?[].concat.apply([],[].concat.apply([],t)):t}setCoordinates(e){if(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new TypeError("Coordinates not valid for multipolygon");Array.isArray(e[0][0])?Array.isArray(e[0][0][0])||(e=[e]):e=[[e]],e.forEach((function(e){e.forEach((function(e){const t=e[0],r=e[e.length-1];t[0]===r[0]&&t[1]===r[1]||(e[e.length]=t)}))}))}return super.setCoordinates.call(this,e)}getCoords(e){return this.getCoordinates(e)}setCoords(e){return this.setCoordinates(e)}getCoordsArray(){return this.getCoordinates().flat(2)}getLength(e){return this.wrap.getLength({coordinates:this.getCoordinates(e)})}getArea(e){return this.wrap.getArea({coordinates:this.getCoordinates(e)})}}const s=a},1872:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var n=r(6204),i=r(8683);function o(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class a extends n.Z{constructor(e,t){super(e,t),o(this,"STYLETYPE","line"),o(this,"getLength",(function(e){return this.wrap.getLength({coordinates:this.getCoordinates(e)})}));const r=this;r.wrap.isNative(e)||r.wrap.createMultiPolyline(e,t)}getCoordinates(e){return null!=e&&e.pointArray?this.getCoordsArray():super.getCoordinates.call(this,e)}setCoordinates(e){return Array.isArray(e)&&Array.isArray(e[0])&&!Array.isArray(e[0][0])&&(e=[e]),super.setCoordinates.call(this,e)}getCoords(e){return this.getCoordinates(e)}setCoords(e){return this.setCoordinates(e)}getCoordsArray(){return this.getCoordinates().flat()}appendPolyline(e){const t=this;if(e instanceof i.Z){const r=t.getCoordinates();r.push(e.getCoordinates()),t.setCoordinates(r)}return t}}const s=a},3048:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c});var n=r(330),i=r(9967),o=r(268),a=r(6204);function s(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class l extends a.Z{constructor(e,t){super(e,t),s(this,"STYLETYPE",n.Z.geom.POINT);const r=this;r.wrap.isNative(e)||(r.wrap.feature=e,r.wrap.createPoint(e,t))}getCoordinates(e){const t=super.getCoordinates.call(this,e);return null!=e&&e.pointArray?[t]:t}getCoords(e){return this.getCoordinates(e)}getCoordsArray(){return[this.getCoordinates()]}setStyle(e){const t=this;if(Array.isArray(t.features)&&t.features.length>1){var r,n,a,s,l;const e=[];null!==(r=t.layer)&&void 0!==r&&null!==(n=r.styles)&&void 0!==n&&n.cluster&&e.unshift(t.layer.styles.cluster),null!==(a=t.layer)&&void 0!==a&&null!==(s=a.map.options.styles)&&void 0!==s&&s.cluster&&e.unshift(t.layer.map.options.styles.cluster),null!==i.Z&&void 0!==i.Z&&null!==(l=i.Z.styles)&&void 0!==l&&l.cluster&&e.unshift(i.Z.styles.cluster);const c=o.Z.mergeStyles(...e);return t.wrap.setStyle(c)}return super.setStyle.call(t,e)}}const c=l},9529:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var n=r(330),i=r(6204);function o(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class a extends i.Z{constructor(e,t){super(e,t),o(this,"STYLETYPE",n.Z.geom.POLYGON);const r=this;r.wrap.isNative(e)||r.wrap.createPolygon(e,t)}getCoordinates(e){const t=super.getCoordinates.call(this,e);return null!=e&&e.pointArray?[].concat.apply([],t):t}setCoordinates(e){if(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new TypeError("Coordinates not valid for polygon");Array.isArray(e[0][0])||(e=[e]),e.forEach((function(e){const t=e[0],r=e[e.length-1];t[0]===r[0]&&t[1]===r[1]||(e[e.length]=t)}))}return super.setCoordinates.call(this,e)}getCoords(e){return this.getCoordinates(e)}setCoords(e){return this.setCoordinates(e)}getCoordsArray(){return this.getCoordinates().flat()}getLength(e){return this.wrap.getLength({coordinates:this.getCoordinates(e)})}getArea(e){return this.wrap.getArea({coordinates:this.getCoordinates(e)})}}const s=a},8683:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var n=r(6204);function i(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class o extends n.Z{constructor(e,t){super(e,t),i(this,"STYLETYPE","line");const r=this;r.wrap.isNative(e)||r.wrap.createPolyline(e,t)}setCoordinates(e){return Array.isArray(e)&&!Array.isArray(e[0])&&(e=[e]),super.setCoordinates.call(this,e)}setCoords(e){return this.setCoordinates(e)}getCoordsArray(){return this.getCoordinates()}getLength(e){return this.wrap.getLength({coordinates:this.getCoordinates(e)})}}const a=o},52:(e,t,r)=>{"use strict";r.d(t,{Z:()=>P});var n=r(688),i=r(330),o=r(268),a=r(1466),s=r.n(a),l=r(4676);const c=new Blob([String.raw`
/**
 * @author: Tobias Nickel
 * @created: 06.04.2015
 * I needed a small xmlparser chat can be used in a worker.
 */

/**
 * parseXML / html into a DOM Object. with no validation and some failur tolerance
 * @params S {string} your XML to parse
 * @param options {object} all other options:
 * searchId {string} the id of a single element, that should be returned. using this will increase the speed rapidly
 * filter {function} filter method, as you know it from Array.filter. but is goes throw the DOM.
 * simplify {bool} to use tXml.simplify.
 */


function tXml(S, options) {
    "use strict";
    options = options || {};

    var pos = 0;

    var openBracket = "<";
    var openBracketCC = "<".charCodeAt(0);
    var closeBracket = ">";
    var closeBracketCC = ">".charCodeAt(0);
    var minus = "-";
    var minusCC = "-".charCodeAt(0);
    var slash = "/";
    var slashCC = "/".charCodeAt(0);
    var exclamation = '!';
    var exclamationCC = '!'.charCodeAt(0);
    var singleQuote = "'";
    var singleQuoteCC = "'".charCodeAt(0);
    var doubleQuote = '"';
    var doubleQuoteCC = '"'.charCodeAt(0);
    var openSquareBracket = "[";
    var openSquareBracketCC = "[".charCodeAt(0);
    var closeSquareBracket = "]";
    var closeSquareBracketCC = "]".charCodeAt(0);

    /**
     * parsing a list of entries
     */

    function parseChildren() {
        var children = [];
        while (S[pos]) {
            if (S.charCodeAt(pos) == openBracketCC) {
                if (S.charCodeAt(pos + 1) === slashCC) {
                    pos = S.indexOf(closeBracket, pos);
                    return children;
                } else if (S.charCodeAt(pos + 1) === exclamationCC) {
                    var char2 = S.charCodeAt(pos + 2);
                    if (char2 == openSquareBracketCC) {
                        // cdata support
                    }
                    else {
                        if (char2 == minusCC) {
                            //comment support
                            while (pos !== -1 && !(S.charCodeAt(pos) === closeBracketCC && S.charCodeAt(pos - 1) == minusCC && S.charCodeAt(pos - 2) == minusCC && pos != -1)) {
                                pos = S.indexOf(closeBracket, pos + 1);
                            }
                            if (pos === -1)
                                pos = S.length
                        } else {
                            // doctypesupport
                            pos += 2;
                            while (S.charCodeAt(pos) !== closeBracketCC) {
                                pos++;
                            }
                        }
                        pos++;
                        continue;
                    }
                }
                var node = parseNode();
                children.push(node);
            } else {
                var text = parseText()
                if (text.trim().length > 0)
                    children.push(text);
            }
            pos++;
        }
        return children;
    }

    /**
     *    returns the text outside of texts until the first '<'
     */

    function parseText() {
        var start = pos;
        pos = S.indexOf(openBracket, pos) - 1;
        if (pos === -2)
            pos = S.length;
        return S.slice(start, pos + 1);
    }
    /**
     *    returns text until the first nonAlphebetic letter
     */
    var nameSpacer = '\n\t>/= ';

    function parseName() {
        var start = pos;
        var c = S[pos];
        while (nameSpacer.indexOf(c) === -1) {
            c = S[++pos];
            // flacunza: Ignoramos los prefijos
            if (c === ':') {
                pos++;
                start = pos;
            }
        }
        return S.slice(start, pos);
    }
    /**
     *    is parsing a node, including tagName, Attributes and its children,
     * to parse children it uses the parseChildren again, that makes the parsing recursive
     */
    var NoChildNodes = ['img', 'br', 'input', 'meta', 'link'];

    function parseNode() {
        var node = {};
        pos++;
        if (S.charCodeAt(pos) === exclamationCC && S.charCodeAt(pos + 1) === openSquareBracketCC) {
            // parse cdata
            var start = pos + 8;
            while (!(S.charCodeAt(pos) === closeBracketCC && S.charCodeAt(pos - 1) === closeSquareBracketCC && S.charCodeAt(pos - 2) === closeSquareBracketCC)) {
                pos++;
            }
            return S.slice(start, pos - 2);
        }

        node.tagName = parseName();

        // parsing attributes
        var attrFound = false;
        let name;
        while (S.charCodeAt(pos) !== closeBracketCC) {
            var c = S.charCodeAt(pos);
            if ((c > 64 && c < 91) || (c > 96 && c < 123)) {
                //if('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'.indexOf(S[pos])!==-1 ){
                name = parseName();
                // search beginning of the string
                var code = S.charCodeAt(pos);
                while (code !== singleQuoteCC && code !== doubleQuoteCC && !((code > 64 && code < 91) || (code > 96 && code < 123)) && code !== closeBracketCC) {
                    pos++;
                    code = S.charCodeAt(pos);
                }
                if (!attrFound) {
                    node.attributes = {};
                    attrFound = true;
                }
                let value;
                if (code === singleQuoteCC || code === doubleQuoteCC) {
                    value = parseString();
                } else {
                    value = null;
                    pos--;
                }
                node.attributes[name] = value;
            }
            pos++;

        }
        // optional parsing of children
        if (S.charCodeAt(pos - 1) !== slashCC) {
            if (node.tagName == "script") {
                const start = pos + 1;
                pos = S.indexOf('</script>', pos);
                node.children = [S.slice(start, pos - 1)];
                pos += 8;
            } else if (node.tagName == "style") {
                const start = pos + 1;
                pos = S.indexOf('</style>', pos);
                node.children = [S.slice(start, pos - 1)];
                pos += 7;
            } else if (NoChildNodes.indexOf(node.tagName) == -1) {
                pos++;
                node.children = parseChildren(name);
            }
        }
        return node;
    }

    /**
     *    is parsing a string, that starts with a char and with the same usually  ' or "
     */

    function parseString() {
        var startChar = S[pos];
        var startpos = ++pos;
        pos = S.indexOf(startChar, startpos)
        return S.slice(startpos, pos);
    }

    /**
     *
     */

    function findElements() {
        var r = new RegExp('\\s' + options.attrName + '\\s*=[\'"]' + options.attrValue + '[\'"]').exec(S)
        if (r) {
            return r.index;
        } else {
            return -1;
        }
    }

    var out = null;
    if (options.attrValue !== undefined) {
        options.attrName = options.attrName || 'id';
        out = [];

        while ((pos = findElements()) !== -1) {
            pos = S.lastIndexOf('<', pos);
            if (pos !== -1) {
                out.push(parseNode());
            }
            S = S.substr(pos);
            pos = 0;
        }
    } else {
        out = parseChildren();
    }

    if (options.filter) {
        out = tXml.filter(out, options.filter);
    }

    if (options.simplify) {
        out = tXml.simplify(out);
    }
    return out;
}
/**
 * transform the DomObject to an object that is like the object of PHPs simplexmp_load_*() methods.
 * this format helps you to write that is more likely to keep your programm working, even if there a small changes in the XML schema.
 * be aware, that it is not possible to reproduce the original xml from a simplified version, because the order of elements is not saved.
 * therefore your programm will be more flexible and easyer to read.
 *
 * @param {array} the childrenList
 */
tXml.simplify = function simplify(children) {
    var out = {};
    if (!children || !children.length) {
        return '';
    }

    if (children.length === 1 && typeof children[0] == 'string') {
        return children[0];
    }
    // map each object
    children.forEach(function (child) {
        if (typeof child !== 'object') {
            return;
        }
        if (!out[child.tagName])
            out[child.tagName] = [];
        var kids = tXml.simplify(child.children);
        out[child.tagName].push(kids);
        if (child.attributes) {
            kids._attributes = child.attributes;
        }
    });

    for (var i in out) {
        if (out[i].length == 1) {
            out[i] = out[i][0];
        }
    }

    return out;
};

/**
 * behaves the same way as Array.filter, if the filter method return true, the element is in the resultList
 * @params children{Array} the children of a node
 * @param f{function} the filter method
 */
tXml.filter = function (children, f) {
    var out = [];
    children.forEach(function (child) {
        if (typeof (child) === 'object' && f(child)) out.push(child);
        if (child.children) {
            var kids = tXml.filter(child.children, f);
            out = out.concat(kids);
        }
    });
    return out;
};

/**
 * stringify a previously parsed string object.
 * this is useful,
 *  1. to remove whitespaces
 * 2. to recreate xml data, with some changed data.
 * @param O{tXMLDomObject} the object to Stringify
 */
tXml.stringify = function TOMObjToXML(O) {
    var out = '';

    function writeChildren(O) {
        if (O)
            for (var i = 0; i < O.length; i++) {
                if (typeof O[i] == 'string') {
                    out += O[i].trim();
                } else {
                    writeNode(O[i]);
                }
            }
    }

    function writeNode(N) {
        out += "<" + N.tagName;
        for (var i in N.attributes) {
            if (N.attributes[i] === null) {
                out += ' ' + i;
            } else if (N.attributes[i].indexOf('"') === -1) {
                out += ' ' + i + '="' + N.attributes[i].trim() + '"';
            } else {
                out += ' ' + i + "='" + N.attributes[i].trim() + "'";
            }
        }
        out += '>';
        writeChildren(N.children);
        out += '</' + N.tagName + '>';
    }
    writeChildren(O);

    return out;
};


/**
 * use this method to read the textcontent, of some node.
 * It is great if you have mixed content like:
 * this text has some <b>big</b> text and a <a href=''>link</a>
 */
tXml.toContentString = function (tDom) {
    if (Array.isArray(tDom)) {
        var out = '';
        tDom.forEach(function (e) {
            out += ' ' + tXml.toContentString(e);
            out = out.trim();
        });
        return out;
    } else if (typeof tDom === 'object') {
        return tXml.toContentString(tDom.children)
    } else {
        return ' ' + tDom;
    }
};

tXml.getElementById = function (S, id, simplified) {
    var out = tXml(S, {
        attrValue: id,
        simplify: simplified
    });
    return simplified ? out : out[0];
};
/**
 * A fast parsing method, that not realy finds by classname,
 * more: the class attribute contains XXX
 * @param
 */
tXml.getElementsByClassName = function (S, classname, simplified) {
    return tXml(S, {
        attrName: 'class',
        attrValue: '[a-zA-Z0-9\-\s ]*' + classname + '[a-zA-Z0-9\-\s ]*',
        simplify: simplified
    });
};

if ('object' === typeof module) {
    module.exports = tXml;
}

//console.clear();
//console.log('here:',tXml.getElementById('<some><xml id="test">dada</xml><that id="test">value</that></some>','test'));
//console.log('here:',tXml.getElementsByClassName('<some><xml id="test" class="sdf test jsalf">dada</xml><that id="test">value</that></some>','test'));

/*
console.clear();
tXml(d,'content');
 //some testCode
var s = document.body.innerHTML.toLowerCase();
var start = new Date().getTime();
var o = tXml(s,'content');
var end = new Date().getTime();
//console.log(JSON.stringify(o,undefined,'\t'));
console.log("MILLISECONDS",end-start);
var nodeCount=document.querySelectorAll('*').length;
console.log('node count',nodeCount);
console.log("speed:",(1000/(end-start))*nodeCount,'Nodes / second')
//console.log(JSON.stringify(tXml('<html><head><title>testPage</title></head><body><h1>TestPage</h1><p>this is a <b>test</b>page</p></body></html>'),undefined,'\t'));
var p = new DOMParser();
var s2='<body>'+s+'</body>'
var start2= new Date().getTime();
var o2 = p.parseFromString(s2,'text/html').querySelector('#content')
var end2=new Date().getTime();
console.log("MILLISECONDS",end2-start2);
// */


(function () {

    var simplify = function simplify(children, attributes) {
        var out = {};
        if ((!children || !children.length) && !attributes) {
            return '';
        }
        children = children || [];

        if (children.length === 1 && typeof children[0] == 'string') {
            return children[0];
        }
        // map each object
        children.forEach(function (child) {
            if (typeof child !== 'object') {
                return;
            }
            var prefixIdx = child.tagName.indexOf('ows:');
            var tagName = prefixIdx < 0 ? child.tagName : child.tagName.substr(prefixIdx + 4);
            if (!out[tagName])
                out[tagName] = [];
            var kids = simplify(child.children, child.attributes);
            out[tagName].push(kids);
            if (child.attributes) {
                for (var key in child.attributes) {
                    kids[key] = child.attributes[key];
                }
            }
        });

        for (var i in out) {
            if (out[i].length == 1) {
                out[i] = out[i][0];
            }
        }

        return out;
    };

    var flattenOnlineResource = function (olr) {
        return olr.href;
    };

    var flattenLayerUrls = function (layer, tag) {
        if (Object.prototype.hasOwnProperty.call(layer, tag)) {
            var tagObj = layer[tag];
            var urls = tagObj.length ? tagObj : [tagObj];
            for (var i = 0, len = urls.length; i < len; i++) {
                var url = urls[i];
                url.OnlineResource = flattenOnlineResource(url.OnlineResource);
            }
            layer[tag] = urls;
        }
    };

    var processDCPType = function (node) {
        if (node) {
            var dcpts = node.DCPType.length ? node.DCPType : [node.DCPType];
            for (var i = 0, len = dcpts.length; i < len; i++) {
                var dcpt = dcpts[i];
                for (var protocol in dcpt) {
                    var dcptp = dcpt[protocol];
                    for (var verb in dcptp) {
                        var dcptpv = dcptp[verb];
                        dcptpv.OnlineResource = flattenOnlineResource(dcptpv.OnlineResource);
                    }
                }
            }
            node.DCPType = dcpts;
        }
    };

    var booleanValues = [false, true];
    var processWMSLayer = function processWMSLayer(layer, crsList) {
        // Transformamos booleanos
        if (Object.prototype.hasOwnProperty.call(layer, 'queryable')) {
            layer.queryable = booleanValues[layer.queryable];
        }
        var bbox;
        // Convertimos EX_GeographicBoundingBox a array
        if (Object.prototype.hasOwnProperty.call(layer, 'EX_GeographicBoundingBox')) {
            bbox = layer.EX_GeographicBoundingBox;
            layer.EX_GeographicBoundingBox = [
                parseFloat(bbox.westBoundLongitude),
                parseFloat(bbox.southBoundLatitude),
                parseFloat(bbox.eastBoundLongitude),
                parseFloat(bbox.northBoundLatitude)
            ]
        }
        // Convertimos BoundingBox a array
        if (Object.prototype.hasOwnProperty.call(layer, 'BoundingBox')) {
            bbox = layer.BoundingBox;
            bbox = layer.BoundingBox.length ? layer.BoundingBox : [layer.BoundingBox];
            layer.BoundingBox = bbox.map(function (elm) {
                return {
                    crs: elm.CRS || elm.SRS,
                    extent: [
                        parseFloat(elm.minx),
                        parseFloat(elm.miny),
                        parseFloat(elm.maxx),
                        parseFloat(elm.maxy)
                    ],
                    res: new Array(2)
                }
            });
        }
        // Convertimos OnlineResource a string
        if (Object.prototype.hasOwnProperty.call(layer, 'Attribution') && layer.Attribution.OnlineResource) {
            layer.Attribution.OnlineResource = flattenOnlineResource(layer.Attribution.OnlineResource);
        }
        flattenLayerUrls(layer, 'AuthorityURL');
        flattenLayerUrls(layer, 'MetadataURL');
        // Convertimos Style a array
        if (layer.Style) {
            if (!layer.Style.length) {
                layer.Style = [layer.Style];
            }
            // Convertimos OnlineResource a string
            for (var i = 0, len = layer.Style.length; i < len; i++) {
                flattenLayerUrls(layer.Style[i], 'LegendURL');
            }
        }
        // Hacemos heredar la lista de CRS
        var newCrsList = typeof layer.CRS === 'string' ? [layer.CRS] : layer.CRS;
        if (crsList) {
            if (layer.CRS) {
                layer.CRS = newCrsList.concat(crsList);
            }
        }
        if (layer.Layer) {
            var children = layer.Layer[1] ? layer.Layer : [layer.Layer];
            layer.Layer = children;
            for (var i = 0, len = children.length; i < len; i++) {
                children[i].parent = layer;
                processWMSLayer(children[i], newCrsList);
            }
        }
    };

    var cornerSeparator = ' ';
    var parseCorner = function (cornerString) {
        return cornerString.split(cornerSeparator).map(function (elm) {
            return parseFloat(elm);
        });
    };

    var processWMTSLayers = function (contents) {
        if (!contents.Layer.length) {
            contents.Layer = [contents.Layer];
        }
        var layers = contents.Layer;
        for (var i = 0, len = layers.length; i < len; i++) {
            var layer = layers[i];
            if (typeof layer.Format === 'string') {
                layer.Format = [layer.Format];
            }
            if (layer.ResourceURL && !layer.ResourceURL.length) {
                layer.ResourceURL = [layer.ResourceURL];
            }
            if (layer.Style && !Array.isArray(layer.Style)) {
                layer.Style = [layer.Style];
            }
            if (!layer.TileMatrixSetLink.length) {
                layer.TileMatrixSetLink = [layer.TileMatrixSetLink];
            }
            for (var j = 0, lenj = layer.TileMatrixSetLink.length; j < lenj; j++) {
                var tmsl = layer.TileMatrixSetLink[j];
                if (tmsl.TileMatrixSetLimits) {
                    tmsl.TileMatrixSetLimits = tmsl.TileMatrixSetLimits.TileMatrixLimits;
                    for (var k = 0, lenk = tmsl.TileMatrixSetLimits.length; k < lenk; k++) {
                        var tmslm = tmsl.TileMatrixSetLimits[k];
                        tmslm.MaxTileCol = parseInt(tmslm.MaxTileCol);
                        tmslm.MaxTileRow = parseInt(tmslm.MaxTileRow);
                        tmslm.MinTileCol = parseInt(tmslm.MinTileCol);
                        tmslm.MinTileRow = parseInt(tmslm.MinTileRow);
                    }
                }
            }
            if (layer.WGS84BoundingBox) {
                var lowerCorner = parseCorner(layer.WGS84BoundingBox.LowerCorner);
                var upperCorner = parseCorner(layer.WGS84BoundingBox.UpperCorner);
                layer.WGS84BoundingBox = [
                    lowerCorner[0],
                    lowerCorner[1],
                    upperCorner[0],
                    upperCorner[1]
                ];
            }
        }
    };

    var processTMS = function (contents) {
        if (!contents.TileMatrixSet.length) {
            contents.TileMatrixSet = [contents.TileMatrixSet];
        }
        var tileMatrixSets = contents.TileMatrixSet;
        tileMatrixSets.forEach(function (tileMatrixSet) {
            tileMatrixSet.SupportedCRS = tileMatrixSet.SupportedCRS.trim();
            if (tileMatrixSet.BoundingBox) {
                var lowerCorner = parseCorner(tileMatrixSet.BoundingBox.LowerCorner);
                var upperCorner = parseCorner(tileMatrixSet.BoundingBox.UpperCorner);
                tileMatrixSet.BoundingBox = [
                    lowerCorner[0],
                    lowerCorner[1],
                    upperCorner[0],
                    upperCorner[1]
                ];
            }
            tileMatrixSet.TileMatrix.forEach(function (tileMatrix) {
                tileMatrix.MatrixHeight = parseInt(tileMatrix.MatrixHeight);
                tileMatrix.MatrixWidth = parseInt(tileMatrix.MatrixWidth);
                tileMatrix.TileHeight = parseInt(tileMatrix.TileHeight);
                tileMatrix.TileWidth = parseInt(tileMatrix.TileWidth);
                tileMatrix.ScaleDenominator = parseFloat(tileMatrix.ScaleDenominator);
                tileMatrix.TopLeftCorner = parseCorner(tileMatrix.TopLeftCorner);
            });
        });
    };

    var processDCPVerb = function (dcpVerb) {
        var verbs = dcpVerb.length ? dcpVerb : [dcpVerb];
        var result = new Array(verbs.length);
        for (var i = 0, len = verbs.length; i < len; i++) {
            var verb = verbs[i];
            if (!verb.Constraint.length) {
                verb.Constraint = [verb.Constraint];
                for (var j = 0, lenj = verb.Constraint.length; j < lenj; j++) {
                    var allowedValues = verb.Constraint[j].AllowedValues;
                    if (typeof allowedValues.Value === 'string') {
                        allowedValues.Value = [allowedValues.Value];
                    }
                }
            }
            result[i] = {
                Constraint: verb.Constraint,
                href: verb.href
            };
        }
        return result;
    };

    var processOM = function (om) {
        var operations = om.Operation.length ? om.Operation : [om.Operation];
        for (var i = 0, len = operations.length; i < len; i++) {
            var operation = operations[i];
            for (var protocol in operation.DCP) {
                var protocolProp = operation.DCP[protocol];
                for (var verb in protocolProp) {
                    protocolProp[verb] = processDCPVerb(protocolProp[verb]);
                }
            }
            om[operation.name] = {
                DCP: operation.DCP
            }
        }
        delete om.Operation;
    };

    var wfsParser = function () {
        var keys = ["name", "Name"],
            parameters = ["Parameter", "Constraint"],
            a2o = function (a) {
                return a.reduce(function (result, item, index) {
                    if (keys.some(k => { return Object.prototype.hasOwnProperty.call(item, k); })) {
                        var key = keys.find(k => { return Object.prototype.hasOwnProperty.call(item, k); });
                        var objName = (item[key].substring(item[key].indexOf(":") + 1));
                        delete item[key];
                        result[objName] = Object.prototype.hasOwnProperty.call(item, "AllowedValues") && item.AllowedValues.Value || item
                        return result;
                    }
                    else {
                        return (index === 0 ? [] : result).concat(item);
                    }
                }, {});
            },
            pp = function (p) {
                var o = {};
                if (p instanceof Array) {
                    o = a2o(p);
                }
                else {
                    o = Object.prototype.hasOwnProperty.call(p, "AllowedValues") &&
                        p.AllowedValues.Value && keys.find(k => { return Object.prototype.hasOwnProperty.call(p, k) }) &&
                        (o[p[keys.find(k => { return Object.prototype.hasOwnProperty.call(p, k) })]] = p.AllowedValues.Value) && o || p
                }
                return o;

            },
            e = {
                V1_0_0: "1.0.0",
                V1_1_0: "1.1.0",
                V2_0_0: "2.0.0"
            },
            r = function () {
                var r, n = [],
                    u = [],
                    p = [],
                    capabilites = arguments[0];
                switch (capabilites.version) {
                    case e.V1_0_0:
                        r = e.V1_0_0;
                        break;
                    case e.V1_1_0:
                        r = e.V1_1_0;
                        break;
                    case e.V2_0_0:
                        r = e.V2_0_0
                }
                n = t(capabilites, r), u = a(capabilites, r), p = i(capabilites, r);
                var o = s(capabilites, r),
                    l = {
                        Operations: n,
                        FeatureTypes: u,
                        Filters: p
                    };
                return Object.assign(l, o), l
            },
            t = function (r, t) {
                switch (t) {
                    case e.V1_0_0:
                        var a = r.Capability.Request;
                        if (a.GetFeature) {
                            var i = [];
                            for (var s in a.GetFeature.ResultFormat) i.push(s.toLowerCase());
                            a.GetFeature.outputFormat = i, delete a.GetFeature.ResultFormat, a.GetFeature.Operations = r.FeatureTypeList.Operations
                        }
                        return a;
                    case e.V1_1_0:
                        return {};
                    case e.V2_0_0:
                        var n = {};
                        for (var s in r.OperationsMetadata) {
                            var u = {};
                            if (!(r.OperationsMetadata[s] instanceof Array)) continue;
                            u[s] = a2o(r.OperationsMetadata[s]);
                            for (var p in u[s]) {
                                u[s][p] = ((o) => {
                                    var r = {};
                                    if (o instanceof Array)
                                        return a2o(o);
                                    for (var k in o) {
                                        if (parameters.find((i) => { return k === i })) {
                                            r = Object.assign(r, pp(o[parameters.find((i) => { return k === i })]));
                                        }
                                        else
                                            r[k] = o[k];
                                    } return r;
                                })(u[s][p]);
                            }
                            n = Object.assign(n, u[s]);
                        }
                        return n
                }
                return null
            },
            a = function (r, t) {
                switch (t) {
                    case e.V1_0_0:
                        r.FeatureTypeList.FeatureType = (r.FeatureTypeList.FeatureType instanceof Array) ? r.FeatureTypeList.FeatureType : [r.FeatureTypeList.FeatureType];
                        for (var a = {}, i = 0; i < r.FeatureTypeList.FeatureType.length; i++) {
                            var s = r.FeatureTypeList.FeatureType[i].Name;
                            a[s.substring(s.indexOf(":") + 1)] = r.FeatureTypeList.FeatureType[i]
                        }
                        return a;
                    case e.V1_1_0:
                        return {};
                    case e.V2_0_0:
                        r.FeatureTypeList.FeatureType = (r.FeatureTypeList.FeatureType instanceof Array) ? r.FeatureTypeList.FeatureType : [r.FeatureTypeList.FeatureType];
                        for (var a = {}, i = 0; i < r.FeatureTypeList.FeatureType.length; i++) {
                            var s = r.FeatureTypeList.FeatureType[i].Name;
                            a[s.substring(s.indexOf(":") + 1)] = r.FeatureTypeList.FeatureType[i]
                        }
                        return a
                }
                return null
            },
            i = function (r, t) {
                switch (t) {
                    case e.V1_0_0:
                        return r.Filter_Capabilities;
                    case e.V1_1_0:
                        return {};
                    case e.V2_0_0:
                        var a = r.Filter_Capabilities;
                        return a
                }
                return null
            },
            s = function (r, t) {
                switch (t) {
                    case e.V1_0_0:
                        var a = {};
                        for (var i in r) "string" == typeof r[i] && (a[i] = r[i]);
                        return a;
                    case e.V1_1_0:
                        return {};
                    case e.V2_0_0:
                        var a = {};
                        for (var i in r) "string" == typeof r[i] && (a[i] = r[i]);
                        return a
                }
                return {}
            }
        return {
            Parse: r
        }
    }();

    var postprocessWMS = function (xml) {
        var capabilities = xml.WMS_Capabilities || (xml['?xml'] && (xml['?xml'].WMS_Capabilities || xml['?xml'].WMT_MS_Capabilities));
        if (capabilities) {
            processWMSLayer(capabilities.Capability.Layer);
            var request = capabilities.Capability.Request;
            processDCPType(request.GetMap);
            if (request.GetFeatureInfo) {
                request.GetFeatureInfo.Format = typeof request.GetFeatureInfo.Format === 'string' ? [request.GetFeatureInfo.Format] : request.GetFeatureInfo.Format;
            }
        }
        return capabilities;
    };

    var postprocessWMTS = function (xml) {
        var capabilities = xml['?xml'] && xml['?xml'].Capabilities;
        if (capabilities) {
            processWMTSLayers(capabilities.Contents);
            processTMS(capabilities.Contents);
            processOM(capabilities.OperationsMetadata);
        }
        return capabilities;
    };
    var postprocessWFS = function (xml) {
        var capabilities = xml.WFS_Capabilities || (xml['?xml'] && (xml['?xml'].WFS_Capabilities));
        if (capabilities) {
            capabilities = wfsParser.Parse(capabilities);
            //aadir prefijo a los atributos simples y pue empiecen por http
            for (var attr in capabilities) {
                if (typeof (capabilities[attr]) === "string" && capabilities[attr].indexOf("http") === 0) {
                    capabilities["xmlns:" + attr] = capabilities[attr];
                    delete capabilities[attr];
                }
            }
            delete capabilities.updateSequence;
        }
        return capabilities;
    };

    onmessage = function (e) {

        //if (e.data.url)
        //    this.importScripts(e.data.url + 'TC/workers/tXml.js');
        //else
        //    this.importScripts('tXml.js');
        var xml = simplify(tXml(e.data.text));
        var capabilities;
        switch (e.data.type) {
            case "WMS":
                capabilities = postprocessWMS(xml);
                break;
            case "WMTS":
                capabilities = postprocessWMTS(xml);
                break;
            case "WFS":
                capabilities = postprocessWFS(xml);
                break;
        }
        postMessage({
            state: capabilities ? 'success' : 'error',
            capabilities: capabilities
        });
    };

})();
`],{type:"text/javascript; charset=utf-8"});function u(e,t){h(e,t),t.add(e)}function p(e,t,r){h(e,t),t.set(e,r)}function h(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function d(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,y(e,t,"get"))}function g(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,y(e,t,"set"),r),r}function y(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}function m(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}const v=Object.prototype.hasOwnProperty.call(window,"Worker"),_=function(e){const t=document.createElement("a");if(t.href=e,!t.origin){if(!t.protocol||!t.hostname){var r=/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/.exec(t.href);if(t.protocol=r[1],r[4].indexOf(":")>-1){var n=r[4].split(":");t.hostname=n[0],t.port=n[1]}else t.hostname=r[4]}t.origin=0===t.protocol.length?window.location.protocol:t.protocol+"//"+t.hostname+(t.port&&e.indexOf(t.port)>-1?":"+t.port:"")}return t};var w=new WeakMap,S=new WeakMap,E=new WeakSet,b=new WeakSet,C=new WeakSet;class L{constructor(e){u(this,C),u(this,b),u(this,E),d(this,"id",void 0),d(this,"map",void 0),d(this,"type",void 0),d(this,"url",void 0),d(this,"capabilities",null),d(this,"tree",null),d(this,"wrap",null),p(this,w,{writable:!0,value:"TC.capabilities."}),p(this,S,{writable:!0,value:void 0});const t=this;this.options=e||{},o.Z.extend(t,t.options),t.id=t.options.id||n.Z.getUID(),t.type=t.options.type||i.Z.layerType.WMS;const r=t.options.isBase?i.Z.mimeType.JPEG:i.Z.mimeType.PNG;t.format=t.options.format||r,Object.prototype.hasOwnProperty.call(t.options,"hideTree")||(t.hideTree=!0),Object.prototype.hasOwnProperty.call(t.options,"hideTitle")||(t.hideTitle=!1),t.proxificationTool=new l.default(n.Z.proxify)}setVisibility(e){return this.wrap.setVisibility(e),this}getVisibility(){const e=this;return!(!e.map||e.isBase&&e.map.getBaseLayer()!==e)&&e.wrap.getVisibility()}getOpacity(){const e=this;return!e.map||e.isBase&&e.map.getBaseLayer()!==e?1:e.wrap.layer.getOpacity()}async setOpacity(e,t){const r=this;await r.wrap.setOpacity(e),r.opacity=e,r.map&&!t&&r.map.trigger(i.Z.event.LAYEROPACITY,{layer:r,opacity:e})}isCompatible(e){return!0}isValidFromNames(){return!0}isRaster(){switch(this.type){case i.Z.layerType.VECTOR:case i.Z.layerType.KML:case i.Z.layerType.WFS:case i.Z.layerType.GROUP:return!1;default:return!0}}isVisibleByScale(){return!0}isVisibleByName(e){return!0}getTree(){return{name:this.name,title:this.title}}findNode(e,t){const r=this;let n=null;if(t.uid==e)n=t;else for(var i=0;i<t.children.length;i++){const o=r.findNode(e,t.children[i]);if(o){n=o;break}}return n}setNodeVisibility(e,t){const r=this,n=r.getTree(!0),o=r.findNode(e,n);if(!r.isRoot(o)){const e=function(t,r){t.visibilityState=r,t.children&&t.children.forEach((t=>e(t,r)))};if(t){e(o,i.Z.visibility.VISIBLE);let t=o.parent;do{t.visibilityState!==i.Z.visibility.VISIBLE&&(t.visibilityState=i.Z.visibility.HAS_VISIBLE),t=t.parent}while(t)}else{e(o,i.Z.visibility.NOT_VISIBLE);let t=o.parent;do{t.visibilityState===i.Z.visibility.HAS_VISIBLE&&t.children.every((e=>e.visibilityState===i.Z.visibility.NOT_VISIBLE))&&(t.visibilityState=i.Z.visibility.NOT_VISIBLE),t=t.parent}while(t)}}return o}isRoot(e){const t=this.tree||this.getTree(!0);return e.uid===t.uid}getNodeVisibility(e,t){const r=this;let n=t||r.tree;n||(n=r.getTree(!0));const i=r.findNode(e,n);return i?i.visibilityState:i}getResolutions(){return this.wrap.getResolutions?this.wrap.getResolutions():[]}setProjection(){}clone(){const e=this,t=o.Z.extend(!0,{},e.options,{id:e.id+"_clone"});return new e.constructor(t)}getBySSL_(e){return e.replace(/^(f|ht)tp?:\/\//i,"https://")}clip(e){this.wrap.clip(e)}stroke(e,t){this.wrap.stroke(e,t)}getCapabilitiesOnline(){const e=this;return g(e,S,f(e,S)||new Promise((function(t,r){const n=e.getGetCapabilitiesUrl();e.proxificationTool.fetch(n,{retryAttempts:2}).then((function(n){m(e,E,T).call(e,n.responseText).then((function(n){n.error?r(Error(m(e,b,A).call(e,n.error))):t(n)})).catch((function(t){delete e._onlineCapabilitesPromise,r(Error(t))}))})).catch((function(t){delete e._onlineCapabilitesPromise,r(Error(m(e,b,A).call(e,t)))}))})))}async getCapabilitiesFromStorage(){const e=this,t=_(e.url),r=await s().getItem(f(e,w)+e.type+"."+t.href);if(r)return r;throw Error("Capabilities not in storage: "+t.href)}getGetMapUrl(){return function(e){var t=e;if(e){var r=e.match(/\??SERVICE=\w+&/i);r&&(t=t.replace(r[0],""))}return t}(this.wrap.getGetMapUrl())}}function T(e){const t=this;let r;if(e.documentElement){const c=e.getElementsByTagName("ServiceException")[0];if(c)r={error:c.textContent};else{var o=t.type===i.Z.layerType.WMTS?new t.wrap.WmtsParser:new t.wrap.WmsParser;if(r=o.read(e),t.type===i.Z.layerType.WMTS&&r.Contents&&r.Contents.Layer){const t=e.getElementsByTagName("Layer");for(var a=0,s=t.length;a<s;a++){const e=t[a];var l=n.Z.Util.getElementByNodeName(e,"ows:Identifier")[0].firstChild.data,u=r.Contents.Layer.filter((function(e){return e.Identifier==l}));if(u.length){u=u[0];for(var p=0;p<u.TileMatrixSetLink.length;p++){var h=u.TileMatrixSetLink[p];let t=h.TileMatrixSet;var d;const r=e.getElementsByTagName("TileMatrixSetLink");for(var f=0,g=r.length;f<g;f++){const e=r[f];if(e.querySelector("TileMatrixSet:first").textContent==t){d=e;break}}if(d){h.TileMatrixSetLimits=[];Array.from(d.getElementsByTagName("TileMatrixLimits")).forEach((e=>{h.TileMatrixSetLimits.push({TileMatrix:e.getElementsByTagName("TileMatrix")[0].textContent,MinTileRow:parseInt(e.getElementsByTagName("MinTileRow")[0].textContent),MinTileCol:parseInt(e.getElementsByTagName("MinTileCol")[0].textContent),MaxTileRow:parseInt(e.getElementsByTagName("MaxTileRow")[0].textContent),MaxTileCol:parseInt(e.getElementsByTagName("MaxTileCol")[0].textContent)})}))}}}}}}return m(t,C,x).call(t,r),Promise.resolve(r)}return new Promise((function(i,o){if(v&&"string"==typeof e){const s=URL.createObjectURL(c);var a=new Worker(s);a.onmessage=function(e){"success"===e.data.state?(r=e.data.capabilities,m(t,C,x).call(t,r)):(r={error:"Web worker error: "+t.url},o(r.error)),i(r),a.terminate()},a.postMessage({type:t.type,text:e,url:n.Z.apiLocation.indexOf("http")>=0?n.Z.apiLocation:document.location.protocol+n.Z.apiLocation})}else r=e,i(r)}))}function A(e){return"No se pudo obtener el documento de capacidades del servicio "+this.url+": ["+e+"]"}function x(e){const t=this,r=_(t.options.url);var n=f(t,w)+t.type+"."+r.href,i=function(){Object.prototype.hasOwnProperty.call(e,"error")||t.getCapabilitiesPromise().then((function(){s().setItem(n,e).catch((e=>console.warn(e)))}))};t.map?t.map.loaded(i):i()}d(L,"state",{IDLE:"idle",LOADING:"loading"});const P=L},4115:(e,t,r)=>{"use strict";r.d(t,{Z:()=>ie});var n=r(688),i=r(268),o=r(330),a=r(9967),s=r(52),l=r(8197);function c(e,t){p(e,t),t.add(e)}function u(e,t,r){p(e,t),t.set(e,r)}function p(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function h(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function d(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,y(e,t,"get"))}function f(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}function g(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,y(e,t,"set"),r),r}function y(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}n.Z.layer=n.Z.layer||{},o.Z.BLANK_IMAGE="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7";const m={},v={},_=new Map,w={},S=function e(t,r,n){var i=!1;if(n.count=n.count+1,t.name===r)i=!0;else for(var o=t.children.length-1;o>=0;o--)if(e(t.children[o],r,n)){i=!0;break}return i};var E=function(e){return i.Z.extend({aggregate:!0,lazy:!1},e)},b=function(e,t,r){var n,i,o=[];n=t||[],i=r||[];for(var a=(e||[]).concat(n),s=0;s<a.length;s++)a.indexOf(a[s])===s&&-1===i.indexOf(a[s])&&o.push(a[s]);return o},C=function(e,t,r,n){return r.some((function(r){return e.compareNames(t,r,n)}))};const L=function(e,t,r){const n=i.Z.reproject([e[0],e[3]],t,r),o=i.Z.reproject([e[0],e[1]],t,r),a=i.Z.reproject([e[2],e[3]],t,r),s=i.Z.reproject([e[2],e[1]],t,r),l=new Array(4);return l[0]=Math.min(n[0],o[0]),l[1]=Math.min(o[1],s[1]),l[2]=Math.max(a[0],s[0]),l[3]=Math.max(n[1],a[1]),l};var T=new WeakMap,A=new WeakMap,x=new WeakMap,P=new WeakMap,O=new WeakMap,I=new WeakSet,R=new WeakSet,M=new WeakSet,D=new WeakSet,N=new WeakSet,Z=new WeakSet,k=new WeakSet,F=new WeakSet,U=new WeakSet,B=new WeakSet,G=new WeakSet,j=new WeakSet,W=new WeakSet;class H extends s.Z{constructor(){super(...arguments),c(this,W),c(this,j),c(this,G),c(this,B),c(this,U),c(this,F),c(this,k),c(this,Z),c(this,N),c(this,D),c(this,M),c(this,R),c(this,I),h(this,"transparent",void 0),h(this,"names",void 0),h(this,"availableNames",void 0),u(this,T,{writable:!0,value:void 0}),u(this,A,{writable:!0,value:null}),u(this,x,{writable:!0,value:void 0}),u(this,P,{writable:!0,value:new Map}),u(this,O,{writable:!0,value:void 0});const e=this;if(g(e,T,null),e.wrap=new n.Z.wrap.layer.Raster(e),e.transparent=!1!==e.options.transparent,e.url=e.options.url,e.capabilities=n.Z.capabilities[e.url],e.params=e.options.params,"string"==typeof e.options.layerNames)e.names=e.availableNames=e.options.layerNames.split(",");else if(e.names=[],e.availableNames=[],Array.isArray(e.options.layerNames))for(var t=0;t<e.options.layerNames.length;t++){const r=e.options.layerNames[t];"string"==typeof r?(e.names.push(r),e.availableNames.push(r)):Object.prototype.hasOwnProperty.call(r,"name")&&(e.availableNames.push(r.name),(void 0===r.isVisible||r.isVisible)&&e.names.push(r.name))}else{var r=e.options.params?e.options.params.sld_body:null;if(r){const t=new DOMParser;var a;try{a=t.parseFromString(r,"text/xml")}catch(e){n.Z.error(e.message),a=null}if(a){var s=i.Z.getElementByNodeName(a,"sld:NamedLayer");if(s&&s.length>0){var l=i.Z.getElementByNodeName(s[0],"sld:Name");if(l&&l.length>0){const t=l[0].textContent;e.names.push(t),e.availableNames.push(t)}}}}}e.ignorePrefixes=void 0===e.options.ignorePrefixes||e.options.ignorePrefixes,e.wrap._promise=new Promise((function(t,r){const i=function(n){e.wrap.setLayer(n),n?t(n):r(Error('Could not create native layer for "'+e.id+'"'))},a=function(t){e.capabilities=e.capabilities||t;var a=e.getGetMapUrl();n.Z.capabilities[e.options.url]=n.Z.capabilities[e.options.url]||t,n.Z.capabilities[a]=n.Z.capabilities[a]||t,function(){let t;if(!e.wrap.layer)switch(e.type){case o.Z.layerType.GROUP:i(t);break;case o.Z.layerType.WMTS:try{t=f(e,R,V).call(e),i(t)}catch(n){e.getCapabilitiesOnline().then((function(n){e.capabilities=n;try{t=f(e,R,V).call(e),i(t)}catch(e){r(e)}}))}break;default:t=f(e,I,q).call(e),i(t)}}()};if(e.capabilities)return a(e.capabilities),void g(e,T,Promise.resolve(e.capabilities));g(e,T,_.get(e.url)||new Promise((function(t,r){const n=e.getCapabilitiesOnline(),i=e.getCapabilitiesFromStorage();n.then((function(e){t(e)})).catch((function(e){i.catch((function(){r(e)}))})),i.then((function(e){t(e)})).catch((function(){n.catch((function(e){r(e)}))}))}))),_.set(e.url,d(e,T)),e.getCapabilitiesPromise().then((function(e){a(e)})).catch((function(t){e.map&&e.map.trigger(o.Z.event.LAYERERROR,{layer:e,reason:"couldNotGetCapabilities"}),r(t)}))})),g(e,x,null),o.Z.layerType.WMTS===e.type&&e.wrap.setWMTSUrl()}setVisibility(e){this.tree=null,super.setVisibility.call(this,e)}getLimitedMatrixSet(){const e=this,t=e.layerNames,r=e.matrixSet;var n=e.capabilities;const o=n.Contents.TileMatrixSet.find((e=>e.Identifier===r));if(o){const e=n.Contents.Layer.find((e=>e.Identifier===t));if(e.TileMatrixSetLink){const t=e.TileMatrixSetLink.find((e=>e.TileMatrixSet===r));if(t&&t.TileMatrixSetLimits&&t.TileMatrixSetLimits.length){const e=[];return t.TileMatrixSetLimits.forEach((function(t){const r=o.TileMatrix.find((e=>e.Identifier===t.TileMatrix));r&&e.push(i.Z.extend({matrixIndex:o.TileMatrix.indexOf(r)},r,t))})),e}return o.TileMatrix}return o.TileMatrix}return null}async setLayerNames(e,t){const r=this;await r.wrap.getLayer();let n=Array.isArray(e)?e:e.split(",");r.names=n;var a=E(t);a.aggregate&&(n=f(r,M,z).call(r,n)),g(r,x,null);var s={LAYERS:n.join(","),TRANSPARENT:!0};if(a.lazy){var l=d(r,O)||r.wrap.getParams();g(r,O,i.Z.extend(l,s))}else r.map&&r.map.trigger(o.Z.event.BEFOREUPDATEPARAMS,{layer:r}),r.tree=null,r.wrap.setParams(s),!a.reset&&r.map||(r.availableNames=r.names),r.map&&r.map.trigger(o.Z.event.UPDATEPARAMS,{layer:r});return r.names}async setFilter(e){const t=this;await t.wrap.getLayer();var r=t.wrap.getParams();return delete r.filter,delete r.cql_filter,e instanceof n.Z.filter.Filter?t.filter=r.filter=e.getText():(new DOMParser).parseFromString(e,"text/xml").querySelector("parsererror")?t.filter=r.cql_filter=e:t.filter=r.filter=e,t.wrap.setParams(r),e}async addLayerNames(e,t){const r=this;await r.wrap.getLayer();const n=E(t);let i=Array.isArray(e)?e:e.split(","),o=r.wrap.getParams().LAYERS?r.wrap.getParams().LAYERS.split(","):[];n.aggregate&&(i=f(r,N,K).call(r,i),o=r.getDisgregatedLayerNames());return await r.setLayerNames(f(r,k,$).call(r,b(o,i,null)),t)}async removeLayerNames(e,t){const r=this;await r.wrap.getLayer();const n=E(t);let i=Array.isArray(e)?e:e.split(","),o=r.wrap.getParams().LAYERS;n.aggregate&&(i=f(r,N,K).call(r,i),o=r.getDisgregatedLayerNames());return await r.setLayerNames(f(r,k,$).call(r,b(o,null,i)),t)}async toggleLayerNames(e,t){const r=this;await r.wrap.getLayer();const n=E(t);let i=Array.isArray(e)?e:e.split(","),o=r.wrap.getParams().LAYERS;n.aggregate&&(i=f(r,N,K).call(r,i),o=r.getDisgregatedLayerNames());const a=[],s=[];for(var l=0;l<i.length;l++){var c=i[l];o.indexOf(c)<0?a.push(c):s.push(c)}var u=[];a.length>0&&u.push(r.addLayerNames(a,n)),s.length>0&&u.push(r.removeLayerNames(s,n));const p=await Promise.all(u),h=p[0],d=p[1];return h?d?h.concat(d):h:[]}getDisgregatedLayerNames(){const e=this,t=e.wrap.layer;if(e.wrap.isNative(t)&&e.type===o.Z.layerType.WMS){if(!d(e,x)){var r=e.wrap.getParams().LAYERS;r=Array.isArray(r)?r:r.split(","),g(e,x,f(e,N,K).call(e,r))}}else g(e,x,e.names);return d(e,x).slice()}isValidFromNames(){const e=this;for(var t=0,r=e.names.length;t<r;t++)if(!e.getLayerNodeByName(e.names[t]))return!1;return!0}isCompatible(e){const t=this;switch(t.type){case o.Z.layerType.WMTS:return t.wrap.isCompatible(e)||t.wrap.getCompatibleMatrixSets(e).length>0;case o.Z.layerType.WMS:return t.wrap.isCompatible(e)}return!1}getCompatibleCRS(e){const t=this;e=e||{};let r=t.wrap.getCompatibleCRS();if(e.includeFallback&&t.fallbackLayer){const e=t.getFallbackLayer();e instanceof s.Z&&(r=r.concat(e.wrap.getCompatibleCRS()))}return e.normalized&&(r=r.map((function(e){return i.Z.getCRSCode(e)})).filter((function(e){return null!==e})).reduce((function(e,t){return e.indexOf(t)<0&&e.push(t),e}),[]).map((function(e){return"EPSG:"+e}))),r}getProjection(){const e=this;switch(e.type){case o.Z.layerType.WMTS:return e.wrap.layer.getSource().getProjection().getCode();case o.Z.layerType.WMS:return e.map.crs}}setProjection(e){const t=this;if((e=e||{}).crs)switch(t.type){case o.Z.layerType.WMTS:var r=t.wrap.getCompatibleMatrixSets(e.crs)[0];r?(t.matrixSet=r,t.wrap.setMatrixSet(r)):t.wrap.setProjection(e),t.mustReproject=!r;break;case o.Z.layerType.WMS:t.wrap.setProjection(e),t.mustReproject=!t.isCompatible(e.crs)}}isVisibleByScale(e,t){const r=this;let n;const i=function(){return r.map.wrap.getResolution()*r.map.getMetersPerUnit()/28e-5};var a,s;switch(r.type){case o.Z.layerType.WMTS:n=!1;var l=r.wrap.getTileMatrix(r.options.matrixSet);if(l)for(a=i(),s=0;s<l.length;s++){if(r.wrap.getScaleDenominators(l[s])[0]===a){n=!0;break}}break;case o.Z.layerType.WMS:n=!0;var c=r.wrap.getAllLayerNodes();if(c.length>0){var u;a=i(),parseInt(e).toString()===e&&(u=d(r,P).get(e)),u||(u=c.find((n=>r.compareNames(r.wrap.getName(n),e,t))));const o=function(e){const t=r.wrap.getScaleDenominators(e);return!(parseFloat(t[1])>a||parseFloat(t[0])<a)};if(u&&(n=o(u),!n&&u.Layer&&u.Layer.length>0))return u.Layer.some(o)}break;default:n=!0}return n}isVisibleByName(e,t){const r=this;let n=!1;switch(r.type){case o.Z.layerType.WMTS:if(r.wrap.getWMTSLayer()){n=!0;break}break;case o.Z.layerType.WMS:{const i=function(e){return o(e,r.wrap.getRootLayerNode())},o=function e(n,i){let o=[];const a=r.wrap.getName(i);if(r.compareNames(a,n,t))o.push(a);else{const t=r.wrap.getLayerNodes(i);let s=!1;t.forEach((t=>{const r=e(n,t);r.length&&(s=!0,o=o.concat(r))})),s&&o.push(a)}return o};n=i(e).some((e=>C(r,e,r.names)));break}default:n=!0}return n}isVisibleByNode(e){const t=this;let r=!1;switch(t.type){case o.Z.layerType.WMTS:if(t.wrap.getWMTSLayer()){r=!0;break}break;case o.Z.layerType.WMS:{const o=function(e,t){return e===t||e.Layer&&e.Layer.some((e=>o(e,t)))};for(var n=0,i=t.names.length;n<i;n++){if(t.getLayerNodesByName(t.names[n]).some((t=>o(t,e)))){r=!0;break}}break}default:r=!0}return r}getNestedTree(){return this.getTree(!1,!0)}getFullTree(){return this.getTree(!0)}getTree(e,t=!1){const r=this;void 0===e&&(e=!r.hideTree);var a=!e&&!t&&r.tree;if(!a){let s;const l=function e(t,o,a,l){let c;for(var u of d(r,P).keys())if(d(r,P).get(u)===t){c=u;break}c||(c=n.Z.getUID(),d(r,P).set(c,t));let p={name:r.wrap.getName(t),title:t.title||t.Title,uid:c,children:[],abstract:!!t.Abstract,metadata:!!t.MetadataURL};if(a&&(s=p),C(r,p.name,r.availableNames)&&(o=!0),l){if(!a&&!f(r,B,ee).call(r,p.name||p.title))return null;o=!0}if(r.options.isBase)p.name=r.names.join(","),p.title=r.title||p.title,p.isBase=r.isDefault,r.options.thumbnail&&(p.legend=[{src:r.options.thumbnail}]);else{var h;p.isVisible=p===s?r.getVisibility():r.isVisibleByName(p.name);var g=r.wrap.getLayerNodes(t);for(h=0;h<g.length;h++){const t=e(g[h],o,void 0,l);t&&(y=p,(m=t).parent=y,r.options.inverseTree?i.Z.fastUnshift(y.children,m):y.children.push(m))}p.legend=r.wrap.getLegend(t),o||a||(s.children=s.children.concat(p.children),p=null)}var y,m;return p};switch(r.type){case o.Z.layerType.WMTS:a=l(r.wrap.getWMTSLayer(),!r.hideTree,!0);break;case o.Z.layerType.WMS:if(r.capabilities){!function e(t){let n=o.Z.visibility.NOT_VISIBLE;if(t){if(t.children)for(var i=0,a=t.children.length;i<a;i++){var l=e(t.children[i]);if(l===o.Z.visibility.VISIBLE||l===o.Z.visibility.HAS_VISIBLE){n=o.Z.visibility.HAS_VISIBLE;break}}t.isVisible&&(t===s&&r.layerNames&&r.layerNames.length&&t.isVisible||t!==s)&&(n=o.Z.visibility.VISIBLE),t.visibilityState=n}return n}(a=l(r.wrap.getRootLayerNode(),e||!r.hideTree,!0,t)),r.hideTree&&f(r,U,Q).call(r,a)}}a||(a={name:r.name,title:r.title}),a.title=r.title||a.title,a.customLegend=r.customLegend||a.customLegend,e||(r.tree=a)}return a}setNodeVisibility(e,t){const r=this,n=super.setNodeVisibility,i=[];(e=Array.isArray(e)?e:[e]).forEach((function(e){i.push(n.call(r,e,t))}));var o=function e(t){var r=[];if(t.name)r[0]=t.name;else for(var n=0;n<t.children.length;n++)r=r.concat(e(t.children[n]));return r};if(i.some((e=>r.isRoot(e))))t&&0===r.names.length?r.addLayerNames(r.availableNames).then((function(){r.setVisibility(!0)})):r.setVisibility(t);else{var a=i.map((e=>o(e))).join(",");t?r.addLayerNames(a):r.removeLayerNames(a)}return i.length>1?i:i[0]}getNodePath(e,t){const r=this;let n=[];if(r.type===o.Z.layerType.WMS&&r.capabilities){e=e||r.names[0];n=function n(o){var a=[],s=r.wrap.getName(o);if(r.compareNames(s,e,t))a.push(o);else for(var l=r.wrap.getLayerNodes(o),c=0;c<l.length;c++){var u=n(l[c]);if(u.length){a=u,i.Z.fastUnshift(a,o);break}}return a}(r.wrap.getRootLayerNode())}return n}getPath(e,t){return this.getNodePath(e,t).map((function(e){return e.title||e.Title}))}getLayerNodesByName(e){const t=[],r=this,n=r.wrap.getServiceType()===o.Z.layerType.WMTS?r.wrap.getIdentifier:r.wrap.getName,i=r.wrap.getAllLayerNodes();for(var a=0,s=i.length;a<s;a++)r.compareNames(n(i[a]),e)&&t.push(i[a]);return t}getLayerNodeByName(e){const t=this.getLayerNodesByName(e);return t.length?t[0]:null}getChildrenLayers(e){const t=[],r=function(e,t){if(e&&e.Layer&&e.Layer.length)for(var n=0;n<e.Layer.length;n++)t.push(e.Layer[n]),r(e.Layer[n],t)};return r(e,t),t}compareNames(e,t,r){let n=e===t;const i=void 0!==r?r:this.ignorePrefixes;if(!n&&i&&e&&t){var o=e.indexOf(":"),a=t.indexOf(":");o>=0&&a<0?n=e.substr(o+1)===t:a>=0&&o<0&&(n=e===t.substr(a+1))}return n}getCapabilitiesPromise(){return d(this,T)}getResolutions(){return this.wrap.getResolutions()}setResolutions(e){this.wrap.setResolutions(e)}getExtent(e){const t=this;e=e||{};let r=null;if(t.type===o.Z.layerType.WMS){const o=e.crs||t.map&&t.map.getCRS()||"EPSG:4326",s=i.Z.getCRSCode(o),l=function(e){let r=null,n=!1;if(e.BoundingBox){r=Array.isArray(e.BoundingBox)?e.BoundingBox:[e.BoundingBox];const t=r.filter((e=>i.Z.getCRSCode(e.crs)===s));t.length&&(n=!0,r=t)}return r||e.EX_GeographicBoundingBox||!e.parent||(r=l(e.parent)),"1.3.0"===t.capabilities.version&&r&&(r=r.map((function(e){if("EPSG:4326"===e.crs){const t=e.extent;return{crs:e.crs,extent:[t[1],t[0],t[3],t[2]]}}return"CRS:84"===e.crs?{crs:"EPSG:4326",extent:e.extent}:e})),!n&&e.EX_GeographicBoundingBox&&r.unshift({crs:"EPSG:4326",extent:e.EX_GeographicBoundingBox})),r},c=new Array(t.names.length);for(var n=0,a=c.length;n<a;n++){const e=t.getLayerNodeByName(t.names[n]);if(!e)return null;const r=l(e);if(!r)return null;c[n]=r}r=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],c.map((function(e){const t={};let r,n;return e.forEach((function(e,t){0===t&&(r=e),i.Z.getCRSCode(e.crs)===s&&(n=e)})),n?(t.crs=o,t.extent=n.extent):(t.crs=r.crs,t.extent=r.extent),t})).reduce((function(e,t){let r=e.get(t.crs);const n=t.extent;return r?(r[0]=Math.min(r[0],n[0]),r[1]=Math.min(r[1],n[1]),r[2]=Math.max(r[2],n[2]),r[3]=Math.max(r[3],n[3])):r=n,e.set(t.crs,r),e}),new Map).forEach((function(e,t){if(i.Z.getCRSCode(t)===s)r[0]=Math.min(e[0],r[0]),r[1]=Math.min(e[1],r[1]),r[2]=Math.max(e[2],r[2]),r[3]=Math.max(e[3],r[3]);else{const n=L(e,t,o);r[0]=Math.min(n[0],r[0]),r[1]=Math.min(n[1],r[1]),r[2]=Math.max(n[2],r[2]),r[3]=Math.max(n[3],r[3])}}))}else if(t.type===o.Z.layerType.WMTS){const e=t.names[0],n=t.capabilities.Contents.Layer.find((t=>t.Identifier===e));if(n){const e=t.capabilities.Contents.TileMatrixSet.find((e=>e.Identifier===t.matrixSet));if(e&&(n.BoundingBox||n.WGS84BoundingBox)){let t;if(t=Array.isArray(n.BoundingBox)?n.BoundingBox.find((t=>i.Z.CRSCodesEqual(t.crs,e.SupportedCRS))):n.BoundingBox,t){const e=e=>e.split(" ").map((e=>parseFloat(e))),n=e(t.LowerCorner),i=e(t.UpperCorner);r=[n[0],n[1],i[0],i[1]]}!r&&n.WGS84BoundingBox&&(r=L(n.WGS84BoundingBox,"EPSG:4326",e.SupportedCRS))}}}return r}getInfo(e){const t=this,r=t.wrap.getInfo(e);return r.metadata&&r.metadata.forEach((function(e){t.map?e.formatDescription=w[e.format]=w[e.format]||i.Z.getLocaleString(t.map.options.locale,i.Z.getSimpleMimeType(e.format))||i.Z.getLocaleString(t.map.options.locale,"viewMetadata"):e.formatDescription=w[e.format]})),r}searchSubLayers(e){if(e&&e.length&&e.length>=3){var t=this,r=null;if(this.lastPattern&&e.indexOf(this.lastPattern)>=0)r=this.lastMatches;else if(t.availableNames&&t.availableNames.length>0){r=[];for(var o=0;o<t.availableNames.length;o++){var a=t.getLayerNodeByName(t.availableNames[o]);a&&(r.push(a),r=r.concat(t.getChildrenLayers(a)))}}else r=t.wrap.getAllLayerNodes();var s=n.Z.Util.patternFn(e),l=new RegExp(s,"i"),c=r.map((function(e,r){delete e.tcScore,e.tcPosition=r,t.wrap.normalizeLayerNode(e);var n=e.Title.trim(),i=l.exec(n),o=i?i.index:-1,a=-1;if(e.Abstract){var s=e.Abstract.trim(),c=l.exec(s);a=c?c.index:-1}return i&&n==i[0]?e.tcScore=20:0==o?e.tcScore=15:o>-1?e.tcScore=10:0==a?e.tcScore=5:a>-1&&(e.tcScore=1),e.tcScore?e:null})).filter((function(e){return null!=e})).sort((function(e,t){if(t.tcScore===e.tcScore){var r=i.Z.replaceSpecialCharacters(e.Title),n=i.Z.replaceSpecialCharacters(t.Title);return r<n?-1:r>n?1:0}return t.tcScore-e.tcScore}));return this.lastPattern=e,this.lastMatches=c,c}return[]}getGetCapabilitiesUrl(){const e=this;var t;const r=e.url,n={};if(e.type===o.Z.layerType.WMTS)if(e.options.encoding===o.Z.WMTSEncoding.RESTFUL){var a="/1.0.0/WMTSCapabilities.xml";const e=r.indexOf(a);e<0||e<r.length-a.length?("/"===r[r.length-1]&&(a=a.substr(1)),t=r+a):t=r}else t=r,n.SERVICE="WMTS",n.VERSION="1.0.0",n.REQUEST="GetCapabilities";else t=r,n.SERVICE="WMS",n.VERSION="1.3.0",n.REQUEST="GetCapabilities";return t=t+"?"+i.Z.getParamString(i.Z.extend(n,e.queryParams))}getPreferredInfoFormat(){var e=null;const t=this.wrap.getInfoFormats();if(t)for(var r=0;r<n.Z.wrap.layer.Raster.infoFormatPreference.length;r++){var i=n.Z.wrap.layer.Raster.infoFormatPreference[r];if(t.indexOf(i)>=0){e=i;break}}return e}getLegendGraphicImage(){const e=this;return new Promise((function(t,r){if(e.options.params.base64LegendSrc)return t(e.options.params.base64LegendSrc);if("function"==typeof window.btoa){for(var n=e.names[0],i=e.wrap.getInfo(n),o=new XMLHttpRequest,a=i.legend[0].src.split("?"),s=a[1].split("&"),l=e.options.params.sld_body?"sld_body="+e.options.params.sld_body:"",c=0;c<s.length;c++){var u=s[c].split("=");u&&u.length>1&&u[1]&&(l+="&"+s[c])}e.options.params.env&&(l+="&"+e.options.params.env),o.open("POST",a[0],!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.responseType="arraybuffer",o.onload=function(r){if(200===this.status){for(var n=new Uint8Array(this.response),i=n.length,a=new Array(i);i--;)a[i]=String.fromCharCode(n[i]);var s,l=a.join(""),c=o.getResponseHeader("content-type");if(0===c.indexOf("image"))s="data:"+c+";base64,"+window.btoa(l),e.options.params.base64LegendSrc=s,t(s)}},o.send(l)}else r(Error("Funcin window.btoa no soportada por el navegador"))}))}async getWebGLUrl(e){const t=this,r=!i.Z.isSecureURL(e)&&i.Z.isSecureURL(i.Z.toAbsolutePath(t.url))?t.getBySSL_(e):e;if(t.ignoreProxification)return r;{const e={exportable:!0,ignoreProxification:t.ignoreProxification},n=await t.proxificationTool.fetchImage(r,e);let i=t.proxificationTool.cacheHost.getAction(r,e),o=n;if(!i)throw Error("No action to "+r);{const e=await i;if(e&&e.action)return{url:e.action.call(t.proxificationTool,r),image:o}}}}getImageLoad(e,t){const r=this,n=function(t){const n=e.getImage();i.Z.isSameOrigin(t.src)||r.map&&!r.map.crossOrigin||(n.crossOrigin=null!==t.crossOrigin?t.crossOrigin:r.map?r.map.crossOrigin:"anonymous"),n.setAttribute("src",t.src),n.onload=function(){f(r,G,te).call(r).trigger(o.Z.event.TILELOAD,{tile:e})},n.onerror=function(t){n.setAttribute("src",o.Z.BLANK_IMAGE),f(r,G,te).call(r).trigger(o.Z.event.TILELOADERROR,{tile:e,error:{code:t.status,text:t.statusText}})}};if(r.names&&r.names.length>0){const y=function(t){f(r,G,te).call(r).trigger(o.Z.event.TILELOADERROR,{tile:e,error:{code:t.status,text:t.statusText}}),n({src:o.Z.BLANK_IMAGE})};if(r.type===o.Z.layerType.WMTS){var a,s,l;if("KVP"!==r.encoding){var c=t.replace("."+r.format.split("/")[1],"");const e=c.split("/").slice(c.split("/").length-3).map((function(e){return parseInt(e)}));a=e[0],s=e[1],l=e[2]}else{let e=/.*TileMatrix=(\d*)&TileCol=(\d*)&TileRow=(\d*)/i.exec(t);e&&4===e.length&&(e=e.slice(1).map((function(e){return parseInt(e)})),a=e[0],s=e[2],l=e[1])}if(a&&s&&l){var u=r.wrap.getWMTSLayer();if(u){const e=u.TileMatrixSetLink.find((e=>e.TileMatrixSet===r.matrixSet));if(e&&e.TileMatrixSetLimits&&e.TileMatrixSetLimits.length>0){var p=e.TileMatrixSetLimits.sort((function(e,t){return parseInt(e.TileMatrix)>parseInt(t.TileMatrix)?1:parseInt(e.TileMatrix)<parseInt(t.TileMatrix)?-1:0}))[a];if(p&&r.map&&r.map.on3DView&&!(p.MinTileRow<=s&&p.MaxTileRow>=s&&p.MinTileCol<=l&&p.MaxTileCol>=l))return console.log("Prevenimos peticin fuera de matrix set, cargamos imagen en blanco"),void n({src:o.Z.BLANK_IMAGE})}}}}f(r,G,te).call(r).trigger(o.Z.event.BEFORETILELOAD,{tile:e});var h="";if("POST"===r.options.method){var d=t.split("?");h=d[1].split("&").filter((function(e){const t=e.split("=");return t.length>1&&t[1].trim().length>0&&"layers"!==t[0].trim().toLowerCase()})).join("&"),r.proxificationTool.fetchImageAsBlob(d[0],{type:"POST",data:h,contentType:"application/x-www-form-urlencoded"}).then((function(t){const r=URL.createObjectURL(t);e.getImage().onload=function(e){URL.revokeObjectURL(r)},n({src:r})})).catch(y)}else if(r.ignoreProxification){n({src:t});var g=e.getImage();i.Z.isSameOrigin(t)||r.map&&!r.map.crossOrigin||(g.crossOrigin=r.map?r.map.crossOrigin:"anonymous"),g.onload=function(){f(r,G,te).call(r).trigger(o.Z.event.TILELOAD,{tile:e})},g.onerror=function(t){g.src=o.Z.BLANK_IMAGE,f(r,G,te).call(r).trigger(o.Z.event.TILELOADERROR,{tile:e,error:{code:t.status,text:t.statusText}})},g.src=r.names.length?t:o.Z.BLANK_IMAGE}else r.proxificationTool.fetchImage(t,{exportable:!r.map||r.map.crossOrigin}).then((function(e){n(e)})).catch(y)}else n({src:o.Z.BLANK_IMAGE}),f(r,G,te).call(r).trigger(o.Z.event.TILELOAD,{tile:e})}async getWFSURL(){const e=this;if(m[e.options.url])return await m[e.options.url];const t=await f(e,j,re).call(e);if("WFS"!==t.owsType)return e.options.url.replace(/wms/gi,"wfs");const r=t.owsURL.substr(0,t.owsURL.length+(t.owsURL.endsWith("?")?-1:0));try{await e.proxificationTool.fetch(r,{method:"HEAD"})}catch(t){return e.options.url.replace(/wms/gi,"wfs")}return r}async getWFSFeatureType(){const e=this;if(m[e.options.url])return await m[e.options.url];const t=await f(e,j,re).call(e);return"WFS"!==t.owsType?"":t.typeName}async getWFSCapabilities(){const e=this,t=await f(e,W,ne).call(e,await e.getWFSURL());return await t.getCapabilitiesPromise()}async getDescribeFeatureTypeUrl(){const e=this;return(await f(e,W,ne).call(e,await e.getWFSURL())).getDescribeFeatureTypeUrl()}getFallbackLayer(){const e=this;if(e.fallbackLayer instanceof s.Z)return e.fallbackLayer;if(e.options.fallbackLayer){var t=e.options.fallbackLayer;if("string"==typeof t){(e.map?e.map.options.availableBaseLayers:a.Z.availableBaseLayers).forEach((function(t){e.options.fallbackLayer===t.id&&(e.fallbackLayer=new H(i.Z.extend({},t,{isBase:!0,stealth:!0,map:e.map})),e.fallbackLayer.firstOption=e)}))}else t instanceof s.Z?(e.fallbackLayer=t,e.fallbackLayer.firstOption=e):(e.fallbackLayer=new H(i.Z.extend({},t,{id:n.Z.getUID(),isBase:!0,stealth:!0,title:e.title,map:e.map})),e.fallbackLayer.firstOption=e);return e.fallbackLayer}return null}async describeFeatureType(e){const t=this;return(await f(t,W,ne).call(t,await t.getWFSURL())).describeFeatureType(e||t.layerNames[0])}refresh(){return this.wrap.reloadSource()}}function q(){const e=this,t=Array.isArray(e.names)?e.names.join(","):e.names,r=e.format,o=e.options;var a={LAYERS:t,FORMAT:r,TRANSPARENT:e.transparent,VERSION:e.capabilities.version||"1.3.0"};e.params&&i.Z.extend(a,e.params),e.queryParams&&i.Z.extend(a,e.queryParams);var s=e.getPreferredInfoFormat();return null!==s&&(a.INFO_FORMAT=s),o.filter&&(o.filter instanceof n.Z.filter.Filter?a.filter=o.filter.getText():(new DOMParser).parseFromString(o.filter,"text/xml").querySelector("parsererror")?a.cql_filter=o.filter:a.filter=o.filter),e.wrap.createWMSLayer(e.getGetMapUrl(),a,o)}function V(){return this.wrap.createWMTSLayer(this.options)}function z(e){const t=this;if(t.type!==o.Z.layerType.WMS)return e;var r=e.slice();return f(t,D,Y).call(t,r,t.wrap.getRootLayerNode()),r}function Y(e,t){const r=this;var n=!1,i=r.wrap.getLayerNodes(t);if(i.length){i.forEach((t=>{f(r,D,Y).call(r,e,t)&&(n=!0)}));var o,a,s=i.map((function(e){return r.wrap.getName(e)})).reverse(),l=!1;if(a=o=e.indexOf(s[0]),o<0)l=!0;else for(var c=1,u=s.length;c<u;c++)if(s[c]!=e[++o]){l=!0;break}if(!l){var p=r.wrap.getName(t);p&&s.length>1&&(e.splice(a,s.length,p),n=!0)}}return n}function K(e){const t=this;let r=[];const n=e.slice(),i=t.wrap.getRootLayerNode();for(var o=0,a=n.length;o<a;o++)r=r.concat(f(t,Z,X).call(t,n[o],i));return r}function X(e,t,r){const n=this;let i=[];const o=n.wrap.getName(t),a=n.compareNames(e,o);let s=!1;const l=n.wrap.getLayerNodes(t);for(var c=0;c<l.length;c++){var u=f(n,Z,X).call(n,e,l[c],r||a);u.length?i=i.concat(u):s=!0}return l.length&&!s||(r||a)&&(i=[o]),i}function $(e){const t=this;var r="string"==typeof e?e.split(","):e;if(t.capabilities){t.tree=null;var n=t.getTree();r.sort((function(e,t){var r={count:0},i={count:0};return S(n,e,r),S(n,t,i),i.count-r.count}))}return r}function J(e){const t=this;var r=t.availableNames.indexOf(e.name);if(-1===r)for(var n=0,i=e.children.length;n<i&&-1===(r=f(t,F,J).call(t,e.children[n]));n++);return r}function Q(e){const t=this;e.children.sort((function(e,r){return f(t,F,J).call(t,r)-f(t,F,J).call(t,e)}));for(var r=0,n=e.children.length;r<n;r++)f(t,U,Q).call(t,e.children[r])}function ee(e){const t=this;return t.getDisgregatedLayerNames().some((r=>t.getNodePath(r).some((t=>t.Name===e||!t.Name&t.Title===e))))}function te(){const e=this;return e.wrap&&e.wrap.$events?e.wrap.$events:null}async function re(){const e=this,t=new URL(e.url,document.location.href),r=e.layerNames instanceof Array?e.layerNames[0]:e.layerNames;t.search=new URLSearchParams({request:"DescribeLayer",service:"WMS",version:"1.1.1",Layers:r,outputFormat:"application/json"});let n=v[e.options.url];n||(n=v[e.options.url]=new Map),n.has(r)||n.set(r,e.proxificationTool.fetch(t.toString(),{method:"GET"}));const i=await n.get(r);if(i.contentType.startsWith("application/json"))return JSON.parse(i.responseText).layerDescriptions[0];{let e=(new DOMParser).parseFromString(i.responseText,"text/xml"),t=e.querySelector("Exception ExceptionText")||e.querySelector("ServiceException");if(t)throw Error(t.textContent);return e.querySelector("LayerDescription")}}async function ne(e){const t=this;return d(t,A)&&d(t,A).options.url===e&&d(t,A).featureType===t.layerNames[0]||g(t,A,new l.Z({type:o.Z.layerType.WFS,url:e,featureType:t.layerNames[0],stealth:!0})),d(t,A)}n.Z.layer.Raster=H;const ie=H},8197:(e,t,r)=>{"use strict";r.d(t,{Z:()=>N});var n=r(688),i=r(9967),o=r(268),a=r(330),s=r(52),l=r(6204),c=r(3048),u=r(6382),p=r(8683),h=r(9529),d=r(8033),f=r(1848),g=r(1872),y=r(5265),m=r(9180);const v=new Blob([String.raw`
/**
 * @author: Tobias Nickel
 * @created: 06.04.2015
 * I needed a small xmlparser chat can be used in a worker.
 */

/**
 * parseXML / html into a DOM Object. with no validation and some failur tolerance
 * @params S {string} your XML to parse
 * @param options {object} all other options:
 * searchId {string} the id of a single element, that should be returned. using this will increase the speed rapidly
 * filter {function} filter method, as you know it from Array.filter. but is goes throw the DOM.
 * simplify {bool} to use tXml.simplify.
 */

//importScripts('./loquesea.js');

function tXml(S, options) {
    "use strict";
    options = options || {};

    var pos = 0;

    var openBracket = "<";
    var openBracketCC = "<".charCodeAt(0);
    var closeBracket = ">";
    var closeBracketCC = ">".charCodeAt(0);
    var minus = "-";
    var minusCC = "-".charCodeAt(0);
    var slash = "/";
    var slashCC = "/".charCodeAt(0);
    var exclamation = '!';
    var exclamationCC = '!'.charCodeAt(0);
    var singleQuote = "'";
    var singleQuoteCC = "'".charCodeAt(0);
    var doubleQuote = '"';
    var doubleQuoteCC = '"'.charCodeAt(0);
    var openSquareBracket = "[";
    var openSquareBracketCC = "[".charCodeAt(0);
    var closeSquareBracket = "]";
    var closeSquareBracketCC = "]".charCodeAt(0);

    /**
     * parsing a list of entries
     */

    function parseChildren() {
        var children = [];
        while (S[pos]) {
            if (S.charCodeAt(pos) == openBracketCC) {
                if (S.charCodeAt(pos + 1) === slashCC) {
                    pos = S.indexOf(closeBracket, pos);
                    return children;
                } else if (S.charCodeAt(pos + 1) === exclamationCC) {
                    var char2 = S.charCodeAt(pos + 2);
                    if (char2 == openSquareBracketCC) {
                        // cdata support
                    }
                    else {
                        if (char2 == minusCC) {
                            //comment support
                            while (pos !== -1 && !(S.charCodeAt(pos) === closeBracketCC && S.charCodeAt(pos - 1) == minusCC && S.charCodeAt(pos - 2) == minusCC && pos != -1)) {
                                pos = S.indexOf(closeBracket, pos + 1);
                            }
                            if (pos === -1)
                                pos = S.length
                        } else {
                            // doctypesupport
                            pos += 2;
                            while (S.charCodeAt(pos) !== closeBracketCC) {
                                pos++;
                            }
                        }
                        pos++;
                        continue;
                    }
                }
                var node = parseNode();
                children.push(node);
            } else {
                var text = parseText()
                if (text.trim().length > 0)
                    children.push(text);
            }
            pos++;
        }
        return children;
    }

    /**
     *    returns the text outside of texts until the first '<'
     */

    function parseText() {
        var start = pos;
        pos = S.indexOf(openBracket, pos) - 1;
        if (pos === -2)
            pos = S.length;
        return S.slice(start, pos + 1);
    }
    /**
     *    returns text until the first nonAlphebetic letter
     */
    var nameSpacer = '\n\t>/= ';

    function parseName() {
        var start = pos;
        var c = S[pos];
        while (nameSpacer.indexOf(c) === -1) {
            c = S[++pos];
            // flacunza: Ignoramos los prefijos
            if (c === ':') {
                pos++;
                start = pos;
            }
        }
        return S.slice(start, pos);
    }
    /**
     *    is parsing a node, including tagName, Attributes and its children,
     * to parse children it uses the parseChildren again, that makes the parsing recursive
     */
    var NoChildNodes = ['img', 'br', 'input', 'meta', 'link'];

    function parseNode() {
        var node = {};
        pos++;
        if (S.charCodeAt(pos) === exclamationCC && S.charCodeAt(pos + 1) === openSquareBracketCC) {
            // parse cdata
            var start = pos + 8;
            while (!(S.charCodeAt(pos) === closeBracketCC && S.charCodeAt(pos - 1) === closeSquareBracketCC && S.charCodeAt(pos - 2) === closeSquareBracketCC)) {
                pos++;
            }
            return S.slice(start, pos - 2);
        }

        node.tagName = parseName();

        // parsing attributes
        var attrFound = false;
        let name;
        while (S.charCodeAt(pos) !== closeBracketCC) {
            var c = S.charCodeAt(pos);
            if ((c > 64 && c < 91) || (c > 96 && c < 123)) {
                //if('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'.indexOf(S[pos])!==-1 ){
                name = parseName();
                // search beginning of the string
                var code = S.charCodeAt(pos);
                while (code !== singleQuoteCC && code !== doubleQuoteCC && !((code > 64 && code < 91) || (code > 96 && code < 123)) && code !== closeBracketCC) {
                    pos++;
                    code = S.charCodeAt(pos);
                }
                if (!attrFound) {
                    node.attributes = {};
                    attrFound = true;
                }
                let value;
                if (code === singleQuoteCC || code === doubleQuoteCC) {
                    value = parseString();
                } else {
                    value = null;
                    pos--;
                }
                node.attributes[name] = value;
            }
            pos++;

        }
        // optional parsing of children
        if (S.charCodeAt(pos - 1) !== slashCC) {
            if (node.tagName == "script") {
                var start = pos + 1;
                pos = S.indexOf('</script>', pos);
                node.children = [S.slice(start, pos - 1)];
                pos += 8;
            } else if (node.tagName == "style") {
                var start = pos + 1;
                pos = S.indexOf('</style>', pos);
                node.children = [S.slice(start, pos - 1)];
                pos += 7;
            } else if (NoChildNodes.indexOf(node.tagName) == -1) {
                pos++;
                node.children = parseChildren(name);
            }
        }
        return node;
    }

    /**
     *    is parsing a string, that starts with a char and with the same usually  ' or "
     */

    function parseString() {
        var startChar = S[pos];
        var startpos = ++pos;
        pos = S.indexOf(startChar, startpos)
        return S.slice(startpos, pos);
    }

    /**
     *
     */

    function findElements() {
        var r = new RegExp('\\s' + options.attrName + '\\s*=[\'"]' + options.attrValue + '[\'"]').exec(S)
        if (r) {
            return r.index;
        } else {
            return -1;
        }
    }

    var out = null;
    if (options.attrValue !== undefined) {
        options.attrName = options.attrName || 'id';
        var out = [];

        while ((pos = findElements()) !== -1) {
            pos = S.lastIndexOf('<', pos);
            if (pos !== -1) {
                out.push(parseNode());
            }
            S = S.substr(pos);
            pos = 0;
        }
    } else {
        out = parseChildren();
    }

    if (options.filter) {
        out = tXml.filter(out, options.filter);
    }

    if (options.simplify) {
        out = tXml.simplify(out);
    }
    return out;
}
/**
 * transform the DomObject to an object that is like the object of PHPs simplexmp_load_*() methods.
 * this format helps you to write that is more likely to keep your programm working, even if there a small changes in the XML schema.
 * be aware, that it is not possible to reproduce the original xml from a simplified version, because the order of elements is not saved.
 * therefore your programm will be more flexible and easyer to read.
 *
 * @param {array} the childrenList
 */
tXml.simplify = function simplify(children) {
    var out = {};
    if (!children || !children.length) {
        return '';
    }

    if (children.length === 1 && typeof children[0] == 'string') {
        return children[0];
    }
    // map each object
    children.forEach(function (child) {
        if (typeof child !== 'object') {
            return;
        }
        if (!out[child.tagName])
            out[child.tagName] = [];
        var kids = tXml.simplify(child.children);
        out[child.tagName].push(kids);
        if (child.attributes) {
            kids._attributes = child.attributes;
        }
    });

    for (var i in out) {
        if (out[i].length == 1) {
            out[i] = out[i][0];
        }
    }

    return out;
};

/**
 * behaves the same way as Array.filter, if the filter method return true, the element is in the resultList
 * @params children{Array} the children of a node
 * @param f{function} the filter method
 */
tXml.filter = function (children, f) {
    var out = [];
    children.forEach(function (child) {
        if (typeof (child) === 'object' && f(child)) out.push(child);
        if (child.children) {
            var kids = tXml.filter(child.children, f);
            out = out.concat(kids);
        }
    });
    return out;
};

/**
 * stringify a previously parsed string object.
 * this is useful,
 *  1. to remove whitespaces
 * 2. to recreate xml data, with some changed data.
 * @param O{tXMLDomObject} the object to Stringify
 */
tXml.stringify = function TOMObjToXML(O) {
    var out = '';

    function writeChildren(O) {
        if (O)
            for (var i = 0; i < O.length; i++) {
                if (typeof O[i] == 'string') {
                    out += O[i].trim();
                } else {
                    writeNode(O[i]);
                }
            }
    }

    function writeNode(N) {
        out += "<" + N.tagName;
        for (var i in N.attributes) {
            if (N.attributes[i] === null) {
                out += ' ' + i;
            } else if (N.attributes[i].indexOf('"') === -1) {
                out += ' ' + i + '="' + N.attributes[i].trim() + '"';
            } else {
                out += ' ' + i + "='" + N.attributes[i].trim() + "'";
            }
        }
        out += '>';
        writeChildren(N.children);
        out += '</' + N.tagName + '>';
    }
    writeChildren(O);

    return out;
};


/**
 * use this method to read the textcontent, of some node.
 * It is great if you have mixed content like:
 * this text has some <b>big</b> text and a <a href=''>link</a>
 */
tXml.toContentString = function (tDom) {
    if (Array.isArray(tDom)) {
        var out = '';
        tDom.forEach(function (e) {
            out += ' ' + tXml.toContentString(e);
            out = out.trim();
        });
        return out;
    } else if (typeof tDom === 'object') {
        return tXml.toContentString(tDom.children)
    } else {
        return ' ' + tDom;
    }
};

tXml.getElementById = function (S, id, simplified) {
    var out = tXml(S, {
        attrValue: id,
        simplify: simplified
    });
    return simplified ? out : out[0];
};
/**
 * A fast parsing method, that not realy finds by classname,
 * more: the class attribute contains XXX
 * @param
 */
tXml.getElementsByClassName = function (S, classname, simplified) {
    return tXml(S, {
        attrName: 'class',
        attrValue: '[a-zA-Z0-9\-\s ]*' + classname + '[a-zA-Z0-9\-\s ]*',
        simplify: simplified
    });
};

if ('object' === typeof module) {
    module.exports = tXml;
}

//console.clear();
//console.log('here:',tXml.getElementById('<some><xml id="test">dada</xml><that id="test">value</that></some>','test'));
//console.log('here:',tXml.getElementsByClassName('<some><xml id="test" class="sdf test jsalf">dada</xml><that id="test">value</that></some>','test'));

/*
console.clear();
tXml(d,'content');
 //some testCode
var s = document.body.innerHTML.toLowerCase();
var start = new Date().getTime();
var o = tXml(s,'content');
var end = new Date().getTime();
//console.log(JSON.stringify(o,undefined,'\t'));
console.log("MILLISECONDS",end-start);
var nodeCount=document.querySelectorAll('*').length;
console.log('node count',nodeCount);
console.log("speed:",(1000/(end-start))*nodeCount,'Nodes / second')
//console.log(JSON.stringify(tXml('<html><head><title>testPage</title></head><body><h1>TestPage</h1><p>this is a <b>test</b>page</p></body></html>'),undefined,'\t'));
var p = new DOMParser();
var s2='<body>'+s+'</body>'
var start2= new Date().getTime();
var o2 = p.parseFromString(s2,'text/html').querySelector('#content')
var end2=new Date().getTime();
console.log("MILLISECONDS",end2-start2);
// */


(function () {

    var simplify = function simplify(children, attributes) {
        var out = {};
        if ((!children || !children.length) && !attributes) {
            return '';
        }
        children = children || [];

        if (children.length === 1 && typeof children[0] == 'string') {
            return children[0];
        }
        // map each object
        children.forEach(function (child) {
            if (typeof child !== 'object') {
                return;
            }
            var prefixIdx = child.tagName.indexOf('ows:');
            var tagName = prefixIdx < 0 ? child.tagName : child.tagName.substr(prefixIdx + 4);
            if (!out[tagName])
                out[tagName] = [];
            var kids = simplify(child.children, child.attributes);
            out[tagName].push(kids);
            if (child.attributes) {
                for (var key in child.attributes) {
                    kids[key] = child.attributes[key];
                }
            }
        });

        for (var i in out) {
            if (out[i].length == 1) {
                out[i] = out[i][0];
            }
        }

        return out;
    };
    const removePreffix = function (str) {
        return str.substring(str.indexOf(":") + 1);
    }
    const copySchema = function (schema1, schema2) {
        for (var key in schema2.attributes) {
            schema1.attributes[key] = schema2.attributes[key];
        }
        schema1.children = schema1.children.concat(schema2.children.filter(function (e) { return e.tagName === "element" || e.tagName === "complexType" || e.tagName === "import" }));
    }
    const findByTagName = function (node, tagName) {
        if (node.tagName === tagName)
            return [node];
        else if (node.children) {
            const nodes = node.children.filter(function (node) { return node.tagName === tagName })
            if (nodes.length > 0) return nodes;
            else
                return node.children.reduce(function (vi, va) {
                    return vi.concat(findByTagName(va, tagName));
                }, [])
        }
        return [];
    }
    const proccessIncludes = async function (schema, url) {
        var include = schema.children.filter(function (node) { return node.tagName === "include" })
        if (include.length > 0) {
            for (var i = 0; i < include.length; i++) {
                var _url = include[i].attributes.schemaLocation;
                _url = _url.startsWith("http") ? _url : url.substring(0, url.lastIndexOf("/") + 1) + _url;
                if (IncludesUsed.indexOf(_url) >= 0) continue;
                var schema2;
                try {
                    schema2 = await proxifyUrl(_url);
                } catch (err) {
                    return schema
                }
                copySchema(schema, schema2);
                IncludesUsed.push(_url);
                proccessIncludes(schema, _url);
                return schema;
            }
        }
        return schema;
    }
    const searchHierarchyTypes = async function (schema, type, urlBegin) {
        let IncludesUsed = [];
        const prom = new Promise(async function (resolve) {
            const getRecursive = async function (schema, type, url) {
                var temp = schema.children.find(function (node) { return node.tagName === "complexType" && node.attributes.name === removePreffix(type) });
                if (!temp) {
                    IncludesUsed.push(url);
                    var include = schema.children.filter(function (node) { return node.tagName === "include" });
                    if (include.length > 0) {
                        for (var i = 0; i < include.length; i++) {
                            var _url = include[i].attributes.schemaLocation;
                            _url = _url.startsWith("http") ? _url : url.substring(0, url.lastIndexOf("/") + 1) + _url;
                            if (IncludesUsed.indexOf(_url) >= 0) continue;
                            var schema;
                            try {
                                schema = await proxifyUrl(_url);
                            } catch (err) {
                                console.log(err)
                                throw err;
                            }
                            await getRecursive({ ...schema }, type, _url);
                        }
                    }
                }
                else {
                    var subType = null;
                    var extension = findByTagName(temp, "extension")[0];
                    var subelement = findByTagName(temp, "element")[0]
                    if (extension && extension.attributes.base)
                        subType = extension.attributes.base;
                    if (subelement && subelement.attributes.ref)
                        subType = subelement.attributes.ref;
                    if (subType) {
                        if (subType.indexOf(":") > 0) {
                            IncludesUsed = [];
                            temp = await getRecursive({ ...schema }, subType, urlBegin);
                        }
                        else
                            resolve(subType);
                    }
                    else {
                        resolve(temp)
                    }

                }
            }
            await getRecursive({ ...schema }, type, urlBegin);
            resolve(null);
        });

        return await prom;
    }

    const getExternalType = async function (schema, type, depth) {
        //miro si ya est en la coleccin
        if (collection[type])
            return collection[type];
        //miro si est en el schema actual
        else if (schema.children && schema.children.filter(function (node) { return node.tagName === "element" && node.attributes.name === removePreffix(type) }).length > 0) {
            if (type.endsWith("Type"))
                collection[type] = await processType(schema, type, ++depth);
            else
                collection[type] = await processElement(schema, type, ++depth);
            return collection[type];
        }
        else {
            //miro si tiene prefijo y busco un import para ese prefijo
            if (type.indexOf(":") > 0) {
                const preffix = type.substring(0, type.indexOf(":"));
                const schemaLocation = schema.children.find(function (_import) { return _import.tagName === "import" && _import.attributes.namespace === schema.attributes[preffix]; }).attributes.schemaLocation;
                var schema2 = await proxifyUrl(schemaLocation.startsWith("http") ? schemaLocation : self.location.origin + "/" + schemaLocation);
                IncludesUsed.push(schemaLocation);
                copySchema(schema, schema2);
                if (type.endsWith("Type")) {
                    let ret = null;
                    if (findByTagName(type, "element").length === 1 && findByTagName(type, "element")[0].attributes.ref)
                        ret = await processElement(schema, findByTagName(type, "element")[0].attributes.ref, ++depth);
                    else
                        ret = await processType(schema, type, ++depth);
                    if (!ret || Object.keys(ret).length === 0)
                        ret = await searchHierarchyTypes(schema2, type, schemaLocation);
                    collection[type] = ret;
                    return ret;
                }
                else {
                    collection[type] = await processElement(schema, type, ++depth);
                    return collection[type];
                }
            }
            return type;
        }

    }

    const geometryTypes = [
        "gml:PointPropertyType",
        "gml:MultiPointPropertyType",
        "gml:LineStringPropertyType",
        "gml:MultiLineStringPropertyType",
        "gml:LinearRingPropertyType",
        "gml:PolygonPropertyType",
        "gml:MultiPolygonPropertyType",
        "gml:MultiSurfacePropertyType",
        "gml:GeometryPropertyType",
        "gml:GeometryCollectionPropertyType",
        "gml:GeometryAssociationType",
        "gml:MultiCurvePropertyType",
        "gml:CurvePropertyType",
        "gml:BoxPropertyType"
    ]

    const requestCache = {};
    const functionsCallback = {};

    const proxifyUrl = async function (url) {
        if (requestCache[url]) {
            if (!(requestCache[url] instanceof Promise))
                return requestCache[url];
            else {
                return await requestCache[url];
            }
        }
        requestCache[url] = new Promise(function (resolve) {
            functionsCallback[url] = resolve;
        });
        self.postMessage(url);
        return await requestCache[url];
    }
    const getComplexType = function (schema, element) {
        var complexType;
        if (!element.children && element.attributes.type) {
            var type = element.attributes.type;
            complexType = schema.children.filter(function (node) { return node.tagName === "complexType" && node.attributes.name === removePreffix(type) });
        }
        else if (element.children && element.attributes.type) {
            var type = element.attributes.type;
            complexType = schema.children.filter(function (node) { return node.tagName === "complexType" && node.attributes.name === removePreffix(type) });
        }
        if (complexType.length > 0) {
            return complexType = complexType[0];
        }
        return null;
    }
    const processElement = async function (schema, element, depth, preffix) {
        if (depth === MAX_DEPTH) return null;
        //busco los includes
        schema = await proccessIncludes(schema);
        //busco los elements con el nombre de la capa en cuestin
        var currentElement = schema.children.filter(function (node) { return node.tagName === "element" && node.attributes.name === removePreffix(element) });

        if (currentElement.length > 0) {
            //si tiene un tipo compuesto lo busco				
            var complexType = getComplexType(schema, currentElement[0])
            collection[element] = await processType(schema, complexType, depth, preffix);
            return collection[element];
        }
        else {
            collection[element] = null;
            return null;
        }
    }
    const processType = async function (schema, complexType, depth, preffix) {

        if (!(complexType instanceof Object))
            complexType = schema.children.find(function (item) { return item.tagName === "complexType" && item.attributes.name === removePreffix(complexType) })
        if (!complexType) return null;
        //Recorro recursivamente buscando nodos element debajo del nodo complexType
        const elements = findByTagName(complexType, "element");
        var objFeature = {};
        //recorro los nodos element que son los atributos de la feature
        for (var j = 0; j < elements.length; j++) {
            let element = elements[j];
            let type = element.attributes.type;
            if (!element.attributes.name && element.attributes.ref) {
                let aux = {}, preffix = element.attributes.ref.substring(0, element.attributes.ref.indexOf(":"));
                aux[removePreffix(element.attributes.ref)] = { "type": await processElement(schema, element.attributes.ref, ++depth, preffix), "name": element.attributes.ref };
                return aux;
            }
            const nodeName = removePreffix(element.attributes.name);
            //declaro un objeto cuyo key es el nombre de la entidad y sus hijos los atributos
            let current = objFeature[nodeName] = {};

            //cada atributo ser un objeto cuyo key ser el nombre del atributo y dentro un objeto infromacin de cada atribut como tipo si es nullable etc 
            for (var i in element.attributes) {
                switch (i) {
                    case "minOccurs":
                    case "maxOccurs":
                        current[i] = parseInt(element.attributes[i], 10);
                        if (isNaN(current[element.attributes[i]]))
                            current[i] = element.attributes[i];
                        break;
                    case "nillable":
                        current[i] = element.attributes[i] === "true" ? true : false;
                        break;
                    default:
                        current[i] = (preffix ? preffix + ":" : "") + element.attributes[i];
                        break;
                }
            }
            if (geometryTypes.includes(type)) { continue; }//no procesamos las geometras
            if (type) {
                current.type = type;
                if (type.startsWith("xsd"))
                    type = removePreffix(type);
                if (type === "gml:ReferenceType") {
                    var targetElement = findByTagName(element, "targetElement");
                    if (targetElement.length > 0 && targetElement[0].children.length > 0) {
                        current.type = await getExternalType(schema, targetElement[0].children[0], depth);
                    }
                }
                else if (type.indexOf(":") > 0) {
                    complexType = schema.children.find(function (node) { return (node.tagName === "complexType" || node.tagName === "element") && node.attributes.name === removePreffix(type) })
                    if (!complexType) {
                        current.type = await getExternalType(schema, type, depth);
                    }
                    else {
                        if (complexType.tagName === "complexType") {
                            current.type = await processType(schema, complexType, depth);
                        }
                        else {
                            current.type = null;//Esto no se haba dado hasta ahora;
                        }
                    }

                }
            }
            else {
                //si el atributo es un dato complejo
                var attrComplex = element.children.find((a) => a.tagName === "complexType");
                var extension = findByTagName(attrComplex, "extension")[0];
                var subelement = findByTagName(attrComplex, "element")[0]
                if (extension && extension.attributes.base) {
                    if (extension.attributes.base.indexOf(":") < 0) {
                        current.type = extension.attributes.base;
                    }
                    else {
                        current.type = await getExternalType(schema, extension.attributes.base);
                    }
                }
                if (subelement && subelement.attributes.ref) {
                    current.type = await getExternalType(schema, subelement.attributes.ref);
                }
            }
        }
        return objFeature;
    }

    const processDFT = async function (json, layerName, preffix) {
        //coger nodo esquema
        var schema = json.find(function (node) { return node.tagName === "schema" });
        return new Promise(async function (resolve) {
            await processElement(schema, layerName, 0);
            resolve();
        });
    }
    var collection = {};
    var IncludesUsed = [];
    var MAX_DEPTH = 5;

    onmessage = async function (e) {
        if (e.data.xml) {
            var json = tXml(e.data.xml);

            const arrTypes = (e.data.layerName instanceof Array ? e.data.layerName : e.data.layerName.split(","));
            let result;
            try {
                for (var i = 0; i < arrTypes.length; i++) {
                    await processDFT(json, arrTypes[i]);
                }
                result = true;
            }
            catch (error) {
                result = false;
            }
            postMessage({
                state: result ? 'success' : 'error',
                DFTCollection: (e.data.layerName instanceof Array ? e.data.layerName : e.data.layerName.split(",")).reduce(function (vi, va) {
                    let temp = {};
                    temp[va] = (collection[va] || collection[va.replace(/^\w{1,}:/, function (a) { return (a.toLowerCase()) })]);
                    return Object.assign(vi, temp);
                }, {})
            });
        }
        else {
            functionsCallback[e.data.url](tXml(e.data.response)[0]);
            delete functionsCallback[e.data.url];
        }

    };

})();
`],{type:"text/javascript; charset=utf-8"});function _(e,t){w(e,t),t.add(e)}function w(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function S(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function E(e,t,r){var n=function(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}(e,t,"set");return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,n,r),r}function b(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}n.Z.Layer=s.Z,n.Z.Util=o.Z,n.Z.layer=n.Z.layer||{};const C={};C.Point=c.Z,C.Marker=u.Z,C.Polyline=p.Z,C.Polygon=h.Z,C.MultiPoint=d.Z,C.MultiMarker=f.Z,C.MultiPolyline=g.Z,C.MultiPolygon=y.Z,C.Circle=m.Z;const L={},T=new Map,A=function(e){let t=0;const r=e.map((e=>e.replace("data:image/svg+xml,",""))).map((e=>decodeURIComponent(e))),n=r.map((e=>parseFloat(e.match(/ width="([\d\.]*)"/)[1]))),i=r.map((e=>parseFloat(e.match(/ height="([\d\.]*)"/)[1]))),o=n.reduce(((e,t)=>e+t+2),0),a=Math.max.apply(Math,i),s=r.map(((e,r)=>{const o=e.replace('<svg xmlns="http://www.w3.org/2000/svg"',`<svg x="${t}" y="${(a-i[r])/2}" `);return t+=n[r]+2,o}));return"data:image/svg+xml,"+encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="${o}" height="${a}">${s.join("")}</svg>`)},x=function(e,t,r=!0){const n=function(e,t,r){return r?e!==t:e===t};for(let i in t){const o=t[i];if(Array.isArray(o)){let t=e[i];t=t?Array.isArray(t)?t:[t]:[],Object.prototype.hasOwnProperty.call(e,i)&&n(o.join(),t.join(),r)&&delete e[i]}else"object"==typeof o?e[i]=x(e[i],o):Object.prototype.hasOwnProperty.call(e,i)&&n(o,e[i],r)&&delete e[i]}return e};var P=new WeakMap,O=new WeakSet,I=new WeakSet;class R extends s.Z{constructor(){var e,t,r;super(...arguments),_(this,I),_(this,O),S(this,"features",[]),S(this,"selectedFeatures",[]),r={writable:!0,value:null},w(e=this,t=P),t.set(e,r),S(this,"addMultiPoints",(function(e,t){return b(this,I,D).call(this,e,"MultiPoint","point",t)})),S(this,"import",(function(e){this.wrap.import(e)}));const i=this;i.type=i.options.type||a.Z.layerType.VECTOR,i.featureType=i.options.featureType;const o=(s=i.url,((l=(s=s||"").indexOf("?"))>=0||(l=s.indexOf("#"))>=0)&&(s=s.substr(0,l)),s.substr(s.lastIndexOf(".")).toLowerCase());var s,l;const c=function(e){switch(e){case a.Z.mimeType.KML:return a.Z.format.KML;case a.Z.mimeType.GPX:return a.Z.format.GPX;case a.Z.mimeType.JSON:case a.Z.mimeType.GEOJSON:return a.Z.format.GEOJSON;case a.Z.mimeType.GML:return a.Z.format.GML;default:return null}}(i.format)||n.Z.Util.getFormatFromFileExtension(o);if(c||i.type===a.Z.layerType.KML){c===a.Z.format.KML&&(i.type=a.Z.layerType.KML);i.title=i.options.title||function(e){for(var t=e=e||"",r=new RegExp("([\\w|\\-|\\.]+\\"+o+")","i"),n=0;n<3;n++){e=decodeURIComponent(e);var i=r.exec(e);if(i.length>1){t=i[1];break}}return t}(i.url)}i.wrap=new n.Z.wrap.layer.Vector(i),i.wrap._promise=new Promise(((e,t)=>{var r;r=i.wrap.createVectorLayer(),i.wrap.setLayer(r),e(r)}))}getTree(){const e=this;if(e.tree)return e.tree;let t=null;if(!e.options.stealth){t={children:[]};const c=new Set;if(e.features.forEach((e=>{const r=e.getPath();if(r.length){const i=n.Z.Util.addArrayToTree(r,t);c.has(i)||(c.add(i),e.getVisibilityState()===a.Z.visibility.NOT_VISIBLE?Object.prototype.hasOwnProperty.call(i,"visibilityState")||(i.visibilityState=a.Z.visibility.NOT_VISIBLE):i.visibilityState=a.Z.visibility.VISIBLE,i.legend=[]);const o=e.getLegend();let s=i.legend.find((e=>e.src===o.src));s||(s=Object.assign({},o),s.features=[],i.legend.push(s)),s.features.push(e)}})),c.forEach((function(e){if(e.legend.length>1){const t=[];e.legend.forEach((function(e){const r=e.features.map((e=>e.getData())).reduce((function(e,t){for(var r in e){const n=t[r];n&&Object.prototype.hasOwnProperty.call(n,"value")?n.value!==e[r].value&&delete e[r]:n!==e[r]&&delete e[r]}return e}),Object.assign({},e.features[0].getData())),n={};for(var i in r){const e=r[i];n[(null==e?void 0:e.displayName)||i]=(null==e?void 0:e.value)||e}t.push(n)}));const r=Object.keys(t[0]),n=[];r.forEach((function(e){const r=t.map((t=>t[e]));new Set(r).size<r.length||n.push(e)}));const i=n[0];i&&(e.legendTitle=i,e.legend.forEach((function(e,r){e.value=t[r][i]})))}})),e.styles||e.cluster){var r,o,s;const c=[];var l;if(e.cluster)c.push(n.Z.Util.getLegendImageFromStyle(n.Z.Util.extend({},null===(l=e.cluster.styles)||void 0===l?void 0:l.point,{radius:i.Z.styles.point.radius+2,offset:[0,6]}),{geometryType:a.Z.geom.POINT}));null!==(r=e.styles)&&void 0!==r&&r.point&&c.push(n.Z.Util.getLegendImageFromStyle(e.styles.point,{geometryType:a.Z.geom.POINT})),null!==(o=e.styles)&&void 0!==o&&o.line&&c.push(n.Z.Util.getLegendImageFromStyle(e.styles.line,{geometryType:a.Z.geom.POLYLINE})),null!==(s=e.styles)&&void 0!==s&&s.polygon&&c.push(n.Z.Util.getLegendImageFromStyle(e.styles.polygon,{geometryType:a.Z.geom.POLYGON})),t.legend={src:A(c)}}t.name=e.name||t.name,t.customLegend=e.options.customLegend,t.title=e.title||t.title,t.uid=e.id}return e.tree=t,t}addPoint(e,t){return b(this,O,M).call(this,this.addPoints,e,t)}addPoints(e,t){return b(this,I,D).call(this,e,"Point",a.Z.geom.POINT,t)}addMultiPoint(e,t){return b(this,O,M).call(this,this.addMultiPoints,e,t)}addMarker(e,t){return b(this,O,M).call(this,this.addMarkers,e,t)}addMarkers(e,t){return b(this,I,D).call(this,e,"Marker","marker",t)}addMultiMarker(e,t){return b(this,O,M).call(this,this.addMultiMarkers,e,t)}addMultiMarkers(e,t){return b(this,I,D).call(this,e,"MultiMarker","marker",t)}addPolyline(e,t){return b(this,O,M).call(this,this.addPolylines,e,t)}addPolylines(e,t){return b(this,I,D).call(this,e,"Polyline","line",t)}addMultiPolyline(e,t){return b(this,O,M).call(this,this.addMultiPolylines,e,t)}addMultiPolylines(e,t){return b(this,I,D).call(this,e,"MultiPolyline","line",t)}addPolygon(e,t){return b(this,O,M).call(this,this.addPolygons,e,t)}addPolygons(e,t){return b(this,I,D).call(this,e,"Polygon",a.Z.geom.POLYGON,t)}addMultiPolygon(e,t){return b(this,O,M).call(this,this.addMultiPolygons,e,t)}addMultiPolygons(e,t){return b(this,I,D).call(this,e,"MultiPolygon",a.Z.geom.POLYGON,t)}addCircle(e,t){return b(this,O,M).call(this,this.addCircles,e,t)}addCircles(e,t){return b(this,I,D).call(this,e,"Circle",a.Z.geom.POLYGON,t)}addFeature(e){const t=this;return e instanceof c.Z?t.addPoint(e):e instanceof p.Z?t.addPolyline(e):e instanceof h.Z?t.addPolygon(e):e instanceof y.Z?t.addMultiPolygon(e):e instanceof g.Z?t.addMultiPolyline(e):e instanceof m.Z?t.addCircle(e):b(t,I,D).call(t,[e])}addFeatures(e){return b(this,I,D).call(this,e)}removeFeature(e){const t=this;e.layer&&t.features.indexOf(e)>=0&&(t.wrap.removeFeature(e),e.layer=null)}getFeature(e){const t=this;return e instanceof l.Z?t.features.includes(e)?e:null:t.getFeatureById(e)}getFeatureById(e){let t=null;var r=this.wrap.getFeatureById(e);return r&&(t=r._wrap.parent),t}clearFeatures(){const e=this;if(e.features&&e.wrap){if(e.map){e.map.getControlsByClass("TC.control.Popup").forEach((function(t){t.isVisible()&&e.features.indexOf(t.currentFeature)>=0&&t.hide()}))}e.features.length=0,e.wrap.clearFeatures()}}getDescribeFeatureTypeUrl(e){const t=this,r=t.options.version||t.capabilities.version||"1.1.0";let n=e||t.featureType;return n=Array.isArray(n)?n:[n],t.url+"?service=WFS&version="+r+"&request=DescribeFeatureType&typename="+n.join(",")+"&outputFormat="+encodeURIComponent(t.capabilities.Operations.DescribeFeatureType.outputFormat)}describeFeatureType(e,t,r){const i=this;e||(e=i.featureType);const o=new Promise((function(t,r){i.getCapabilitiesPromise().then((function(o){if(o.Operations.DescribeFeatureType)if(Object.prototype.hasOwnProperty.call(window,"Worker")){const o=function(){if(!i.WebWorkerDFT){const e=URL.createObjectURL(v);i.WebWorkerDFT=new Worker(e)}i.WebWorkerDFT.onmessage=async function(e){if(e.data instanceof Object){if("success"!==e.data.state)throw"Ha habido problemas procesando el Describe feature type";{let t=Object.keys(e.data.DFTCollection).join(",");if(!n.Z.describeFeatureType[t])throw"No se encuentra la clave "+t+" en la coleccin";"function"==typeof n.Z.describeFeatureType[t]&&n.Z.describeFeatureType[t].call(null,e.data.DFTCollection),n.Z.describeFeatureType=Object.assign(n.Z.describeFeatureType,e.data.DFTCollection)}}else{var t=await i.proxificationTool.fetchXML(e.data);i.WebWorkerDFT.postMessage({url:e.data,response:t.documentElement.outerHTML})}}},s=async function(e,t){var r=await i.proxificationTool.fetchXML(i.getDescribeFeatureTypeUrl(e||i.featureType));if(r.querySelector("Exception")||r.querySelector("exception"))throw(r.querySelector("Exception")||r.querySelector("exception")).textContent.trim();i.WebWorkerDFT.postMessage({layerName:e,xml:r.documentElement.outerHTML,url:n.Z.apiLocation.indexOf("http")>=0?n.Z.apiLocation:document.location.protocol+n.Z.apiLocation}),n.Z.describeFeatureType[e instanceof Array?e.join(","):e]=t};try{o()}catch(e){r(e)}e instanceof Array||(e=e.split(","));var a=Object.entries(e.reduce((function(e,t){let r=t.substring(0,t.indexOf(":"));if(e[r])return e[r].push(t),e;{let n={};return n[r]=[t],Object.assign(e,n)}}),{})).map((function(e){var t=e[1];return new Promise((async function(e,r){if(n.Z.describeFeatureType[t])e(function(e,t){return e instanceof Array||(e=e.split(",")),e.reduce((function(e,r){var n=[];return n[r]=t[r],Object.assign(e,n)}),{})}(t,n.Z.describeFeatureType));else try{await s(t,(function(t){e(t)}))}catch(e){r(e)}}))}));Promise.all(a).then((function(e){let r=e.reduce((function(e,t){return Object.assign(e,t)}),{});t(1===Object.keys(r).length?r[Object.keys(r)[0]]:r)})).catch(r)}else r("No esta disponible el WebWorker");else r("No esta disponible el mtodo describeFeatureType")})).catch((e=>r(e)))}));return o.then((function(e){n.Z.Util.isFunction(t)&&t(e)}),(function(e){n.Z.Util.isFunction(r)&&r(e)})),o}setNodeVisibility(e,t){const r=this,n=[];return e=Array.isArray(e)?e:[e],r.state=s.Z.state.LOADING,r.map.trigger(a.Z.event.BEFOREUPDATE),r.map.trigger(a.Z.event.BEFORELAYERUPDATE,{layer:r}),e.forEach((function(e){n.push(s.Z.prototype.setNodeVisibility.call(r,e,t))})),n.some((e=>!e.parent))?r.setVisibility(t):n.forEach((n=>{if(T.set(n.uid,t?a.Z.visibility.VISIBLE:a.Z.visibility.NOT_VISIBLE),n.children.forEach((e=>{r.setNodeVisibility(e.uid,t)})),n.parent){T.get(n.parent.uid)!==a.Z.visibility.NOT_VISIBLE&&n.parent.children.length>0&&n.parent.children.every((e=>T.get(e.uid)===a.Z.visibility.NOT_VISIBLE))&&r.setNodeVisibility(n.parent.uid,!1)}var i,o,s=!1;for(i=0;i<r.features.length;i++)if((o=r.features[i]).id==e){s=!0,o.setVisibility(t);break}if(!s)for(i=0;i<r.features.length;i++)void 0===(o=r.features[i])._path&&(o._path="/"+o.getPath().join("/")),(o._path===e||o._path.startsWith(e))&&o.setVisibility(t)})),r.state=s.Z.state.IDLE,r.map.trigger(a.Z.event.LAYERUPDATE,{layer:r}),r.map.trigger(a.Z.event.UPDATE),n.length>1?n:n[0]}getNodeVisibility(e){var t=this,r=super.getNodeVisibility.call(t,e),n=t.findNode(e,t.getTree());if(n){if(n===t.getTree())(r=t.getVisibility()?a.Z.visibility.VISIBLE:a.Z.visibility.NOT_VISIBLE)===a.Z.visibility.VISIBLE&&Array.from(T.values()).some((e=>e===a.Z.visibility.NOT_VISIBLE))&&(r=a.Z.visibility.HAS_VISIBLE);else{var i=T.get(e);if(void 0!==i){r=i;Array.from(T.entries()).some((t=>t[0]!==e&&t[0].startsWith(e)&&t[1]!==r))&&(r=a.Z.visibility.HAS_VISIBLE)}else{const t=Array.from(T.entries()).some((t=>t[0]!==e&&t[0].startsWith(e)&&!t[1])),i=n.children.length>0&&n.children.every((e=>T.get(e.uid)===a.Z.visibility.NOT_VISIBLE));r=i?a.Z.visibility.NOT_VISIBLE:t?a.Z.visibility.HAS_VISIBLE:a.Z.visibility.VISIBLE}}return r}}setModifiable(e){this.wrap.setModifiable(e)}applyEdits(e,t,r){return this.wrap.sendTransaction(e,t,r)}refresh(){return this.clearFeatures(),this.wrap.reloadSource()}getFeaturesInCurrentExtent(e){const t=this.map.getExtent();return this.getFeaturesInExtent(t,e)}getFeaturesInExtent(e,t){return this.wrap.getFeaturesInExtent(e,t)}setProjection(e){const t=this;t.wrap.setProjection(e),e.crs&&e.oldCrs&&(t.map.trigger(a.Z.event.BEFORELAYERUPDATE,{layer:t}),t.features.forEach((function(t){t.setCoordinates(t.getCoordinates({geometryCrs:e.oldCrs,crs:e.crs}))})),t.map.trigger(a.Z.event.LAYERUPDATE,{layer:t}))}setStyles(e){this.styles=o.Z.extend({},e),this.wrap.setStyles(e)}exportState(e){const t=this;e=e||{};const r={id:t.id};t.map&&t.map.crs!==t.map.options.crs&&(r.crs=t.map.crs);var i=Math.pow(10,(t.map.wrap.isGeo()?a.Z.DEGREE_PRECISION:a.Z.METER_PRECISION)+1);let o=null;const s=e.features||t.features;return r.features=s.map((function(r){var s,l,f,v,_,w,S;let E={};var b;switch(!0){case r instanceof u.Z:E.type=a.Z.geom.POINT,b=null===(s=t.styles)||void 0===s?void 0:s.marker;break;case r instanceof c.Z:E.type=a.Z.geom.POINT,b=null===(l=t.styles)||void 0===l?void 0:l.point;break;case r instanceof d.Z:E.type=a.Z.geom.MULTIPOINT;break;case r instanceof p.Z:E.type=a.Z.geom.POLYLINE,b=null===(f=t.styles)||void 0===f?void 0:f.line;break;case r instanceof g.Z:E.type=a.Z.geom.MULTIPOLYLINE,b=null===(v=t.styles)||void 0===v?void 0:v.line;break;case r instanceof h.Z:E.type=a.Z.geom.POLYGON,b=null===(_=t.styles)||void 0===_?void 0:_.polygon;break;case r instanceof y.Z:E.type=a.Z.geom.MULTIPOLYGON,b=null===(w=t.styles)||void 0===w?void 0:w.polygon;break;case r instanceof m.Z:E.type=a.Z.geom.CIRCLE,b=null===(S=t.styles)||void 0===S?void 0:S.polygon}if(E.id=r.id,E.geom=n.Z.Util.compactGeometry(r.geometry,i),E.data=r.getData(),E.autoPopup=r.autoPopup,E.showsPopup=r.showsPopup,void 0===e.exportStyles||e.exportStyles){for(var C in b=n.Z.Util.extend({},b)){var L=b[C];n.Z.Util.isFunction(L)&&(b[C]=L(r))}E.style=n.Z.Util.extend(b,r.getStyle()),o=o?x(o,E.style):Object.assign({},E.style)}return E})),!e.features&&o&&Object.keys(o).length&&(r.features.forEach((function(e){e.style=x(e.style,o,!1)})),r.style=o),r}async importState(e){const t=this,r=new Array(e.features.length);e.features.forEach((function(i,o){let s=n.Z.Util.extend({},e.style||{},i.style);const l=n.Z.Util.extend({},s,{data:i.data,id:i.id,showsPopup:i.showsPopup,showPopup:i.autoPopup});var c;switch(i.type){case a.Z.geom.POLYGON:c=t.addPolygon;break;case a.Z.geom.MULTIPOLYGON:c=t.addMultiPolygon;break;case a.Z.geom.POLYLINE:c=t.addPolyline;break;case a.Z.geom.MULTIPOLYLINE:c=t.addMultiPolyline;break;case a.Z.geom.CIRCLE:c=t.addCircle;break;case a.Z.geom.MULTIPOINT:c=i.style&&(i.style.url||i.style.className)?t.addMultiMarker:t.addMultiPoint;break;case a.Z.geom.POINT:c=s&&(s.url||s.className)?t.addMarker:t.addPoint}if(c){var u=n.Z.Util.explodeGeometry(i.geom);e.crs&&t.map.crs!==e.crs?r[o]=new Promise((function(e,r){t.map.one(a.Z.event.PROJECTIONCHANGE,(function(n){c.call(t,u,l).then((function(){e()}),(function(){r(Error("addFn failed"))}))}))})):r[o]=c.call(t,u,l)}})),await Promise.all(r)}clone(){const e=super.clone.call(this);return this.features.forEach((t=>e.addFeature(t.clone()))),e}getGetCapabilitiesUrl(){const e=this;if(e.type===a.Z.layerType.WFS){const r=()=>e.options.url||e.url;var t={SERVICE:"WFS",VERSION:"2.0.0",REQUEST:"GetCapabilities"};return(!n.Z.Util.isSecureURL(r())&&n.Z.Util.isSecureURL(n.Z.Util.toAbsolutePath(r()))?e.getBySSL_(r()):r())+"?"+n.Z.Util.getParamString(t)}return null}getCapabilitiesPromise(){const e=this;return e.type===a.Z.layerType.WFS?new Promise(((t,r)=>{var i=(e.options.url||e.url).replace(/https ?:/gi,"");e.capabilities&&(t(e.capabilities),E(e,P,Promise.resolve(e.capabilities))),n.Z.capabilitiesWFS[i]&&(t(n.Z.capabilitiesWFS[i]),E(e,P,Promise.resolve(n.Z.capabilitiesWFS[i])));const o=L[i];L[i]=E(e,P,o||new Promise((function(t,r){const n=e.getCapabilitiesOnline(),i=e.getCapabilitiesFromStorage();n.then((function(e){t(e)})).catch((function(e){i.catch((function(){r(e)}))})),i.then((function(e){t(e)})).catch((function(){n.catch((function(e){r(e)}))}))}))),L[i].then((function(r){!function(r){e.capabilities=e.capabilities||r,n.Z.capabilitiesWFS[e.options.url||e.url]=n.Z.capabilitiesWFS[e.options.url||e.url]||r,n.Z.capabilitiesWFS[i]=n.Z.capabilitiesWFS[i]||r,t(r)}(r)})).catch((function(t){e.map&&e.map.trigger(a.Z.event.LAYERERROR,{layer:e,reason:"couldNotGetCapabilities"}),r(t)}))})):Promise.reject(new Error(`Layer "${e.id}" does not have capabilities document`))}}async function M(e,t,r){const n=this,i=await e.call(n,[t],r);return n.map&&n.map.trigger(a.Z.event.FEATUREADD,{layer:n,feature:i[0]}),i[0]}async function D(e,t,r,a){const s=this;let c;c=t?C[t]:l.Z;for(var u=new Array(e.length),p=[],h=0,d=e.length;h<d;h++){const t=n.Z.Util.extend(!0,{},a);let l,d=e[h];const f=n.Z.wrap.Feature.prototype.isNative(d);if(d instanceof c)l=d;else if(f&&(l=d._wrap&&d._wrap.parent),!l){t.layer=s;const e=s.styles&&s.styles[r];if(o.Z.hasStyleOptions(t)||!e){const n=Object.assign({},i.Z.styles,s.map?s.map.options.styles:null);Object.assign(t,n[r],e,a)}l=new c(d,t)}l.layer=s,u[h]=l,s.features.push(l),f||p.push(l.wrap.feature),l.options.showPopup&&l.showInfo()}return p.length&&s.wrap.addFeatures(p),u}n.Z.layer.Vector=R;const N=R},9988:(e,t,r)=>{"use strict";r.d(t,{Z:()=>m});var n=r(6314);function i(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t,r){a(e,t),t.set(e,r)}function a(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function s(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}function l(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,u(e,t,"get"))}function c(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,u(e,t,"set"),r),r}function u(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}const p="sitna-button";var h=new WeakMap,d=new WeakMap,f=new WeakSet;class g extends n.Z{constructor(){var e,t;super(),a(e=this,t=f),t.add(e),o(this,h,{writable:!0,value:void 0}),o(this,d,{writable:!0,value:!1});const r=this;c(r,h,document.createElement("button")),l(r,h).setAttribute("type","button"),r.shadowRoot.appendChild(l(r,h))}connectedCallback(){const e=this;e.text=e.text,e.variant=e.variant,e.active=e.active,e.disabled=e.disabled,e.icon=e.icon,e.iconText=e.iconText}static get observedAttributes(){return["text","icon","variant","disabled","active","icon-text","title"]}attributeChangedCallback(e,t,r){if(t===r)return;const n=this;if("disabled"===e?n.disabled=n.hasAttribute(e):"active"===e&&(n.active=n.hasAttribute(e)),t!==r)switch(e){case"text":n.text=r;break;case"icon":n.icon=r;break;case"variant":n.variant=r;break;case"icon-text":n.iconText=r;break;case"title":n.hasAttribute(e)?l(n,h).hasAttribute("title")&&l(n,h).setAttribute("title",r):l(n,h).hasAttribute("title")&&(n.text=n.text)}}get elementName(){return p}get variant(){return this.getAttribute("variant")||g.variant.DEFAULT}set variant(e){const t=this;e=e||g.varian.DEFAULT,l(t,h).classList.remove(t.variant),e!==g.variant.DEFAULT?(l(t,h).classList.add(e),t.setAttribute("variant",e)):t.removeAttribute("variant");const r=t.text;!r||e!==g.variant.ICON&&e!==g.variant.MINIMAL&&e!==g.variant.LINK?l(t,h).removeAttribute("title"):l(t,h).setAttribute("title",r)}get text(){return this.getAttribute("text")}set text(e){const t=this;l(t,h).innerHTML=null!=e?e:"",e?t.setAttribute("text",e):t.removeAttribute("text");const r=t.variant;r!==g.variant.ICON&&r!==g.variant.MINIMAL&&r!==g.variant.LINK||(e?l(t,h).setAttribute("title",e):l(t,h).removeAttribute("title"))}get iconText(){return this.getAttribute("icon-text")}set iconText(e){s(this,f,y).call(this,"icon-text",e)}get icon(){return this.getAttribute("icon")}set icon(e){s(this,f,y).call(this,"icon",e)}get disabled(){return this.hasAttribute("disabled")}set disabled(e){const t=!!e;this.toggleAttribute("disabled",t),l(this,h).disabled=t}get active(){return this.hasAttribute("active")}set active(e){const t=!!e;this.toggleAttribute("active",t),l(this,h).classList.toggle("active",t)}}function y(e,t){const r=this;t?(l(r,h).setAttribute("data-"+e,t),r.setAttribute(e,t)):(l(r,h).removeAttribute("data-"+e),r.removeAttribute(e))}i(g,"variant",{DEFAULT:"default",ICON:"icon",ICONLEFT:"iconleft",LINK:"link",MINIMAL:"minimal"}),i(g,"action",{CLOSE:"close",DELETE:"delete",DOWNLOAD:"download",DOWNLOAD_ALL:"download_all",EDIT:"edit",SHARE:"share"}),customElements.get(p)||(n.Z.preloadStyle(p),customElements.define(p,g));const m=g},6314:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var n=r(688);function i(e,t,r){return function(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}(e,t),r}class o extends HTMLElement{constructor(){super();const e=this;e.attachShadow({mode:"open"});const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.href=`${i(o,o,a).call(o)}${e.elementName}.css`,e.shadowRoot.appendChild(t)}get elementName(){return"sitna-component"}static preloadStyle(e){if(globalThis.document){const t=document.createElement("link");t.setAttribute("rel","preload"),t.setAttribute("as","style"),t.href=`${i(o,o,a).call(o)}${e}.css`,document.head.appendChild(t)}}}function a(){return`${n.Z.apiLocation}css/ui/`}const s=o},4109:(e,t,r)=>{"use strict";r.d(t,{Z:()=>f});var n=r(6314);function i(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function o(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}function a(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,l(e,t,"get"))}function s(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,l(e,t,"set"),r),r}function l(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}const c="sitna-toggle";var u=new WeakMap,p=new WeakSet;class h extends n.Z{constructor(){var e,t;super(),i(e=this,t=p),t.add(e),function(e,t,r){i(e,t),t.set(e,r)}(this,u,{writable:!0,value:void 0});const r=this;s(r,u,document.createElement("input")),a(r,u).setAttribute("type","checkbox"),a(r,u).addEventListener("change",(function(e){r.checked=a(r,u).checked;const t=new Event("change",{bubbles:!0});r.dispatchEvent(t)})),r.shadowRoot.appendChild(a(r,u))}connectedCallback(){const e=this;e.text=e.text,e.checked=e.checked,e.checkedIconText=e.checkedIconText,e.uncheckedIconText=e.uncheckedIconText,e.disabled=e.disabled}static get observedAttributes(){return["text","disabled","checked","checked-icon-text","unchecked-icon-text"]}attributeChangedCallback(e,t,r){if(t===r)return;const n=this;"disabled"===e?n.disabled=n.disabled:"checked"===e&&(n.checked=n.checked),t!==r&&("text"===e&&(n.text=r),"checked-icon-text"===e&&(n.checkedIconText=r),"unchecked-icon-text"===e&&(n.uncheckedIconText=r))}get elementName(){return c}get text(){return this.getAttribute("text")}set text(e){a(this,u).setAttribute("title",e),this.setAttribute("text",e)}get checkedIconText(){return this.getAttribute("checked-icon-text")}get uncheckedIconText(){return this.getAttribute("unchecked-icon-text")}set checkedIconText(e){o(this,p,d).call(this,"checked-icon-text",e)}set uncheckedIconText(e){o(this,p,d).call(this,"unchecked-icon-text",e)}get checked(){return this.hasAttribute("checked")}set checked(e){const t=!!e;this.toggleAttribute("checked",t),a(this,u).checked=t}get disabled(){return this.hasAttribute("disabled")}set disabled(e){const t=!!e;this.toggleAttribute("disabled",t),a(this,u).disabled=t}}function d(e,t){const r=this;t?(a(r,u).setAttribute("data-"+e,t),r.setAttribute(e,t)):(a(r,u).removeAttribute("data-"+e),r.removeAttribute(e))}customElements.get(c)||(n.Z.preloadStyle(c),customElements.define(c,h));const f=h},688:(e,t,r)=>{"use strict";r.d(t,{Z:()=>S});var n=r(330),i=r(5915),o=r.n(i),a=r(9409),s=s||{};!function(){if(!s.apiLocation)if("undefined"!=typeof SITNA_BASE_URL)s.apiLocation=SITNA_BASE_URL,s.apiLocation.endsWith("/")||(s.apiLocation=s.apiLocation+"/");else{const e=document.currentScript.getAttribute("src");s.apiLocation=e.substr(0,e.lastIndexOf("/")+1),globalThis.SITNA_BASE_URL=s.apiLocation}}(),s.control={},s.capabilities={},s.capabilitiesWFS={},s.describeFeatureType={},s.tool={},s.cache={},"boolean"!=typeof s.isDebug&&(s.isDebug=!0),s.alert=function(e){alert(e)},s.prompt=function(e,t,r){var n=prompt(e,t);s.Util.isFunction(r)&&r(n)},s.confirm=function(e,t,r){confirm(e)?s.Util.isFunction(t)&&t():s.Util.isFunction(r)&&r()},s.error=function(e){window.console&&console.error(e)},s.proxify=function(e){var t=e=e.trim();const r=window.TC.Cfg.proxy;if(r){var n=!1;const o=window.TC.Cfg.proxyExceptions;if(o)for(var i=0;i<o.length;i++)if(e.indexOf(o[i])>-1){n=!0;break}n||s.Util.isSameOrigin(e)||("function"==typeof r?t=r(e):(t=r,"http"!==e.substr(0,4)&&(t+=window.location.protocol),t+=encodeURIComponent(e)))}return t};var l=function(e){let t="";try{throw new Error}catch(e){t=e&&e.stack?e.stack:e.toString()}const r=s.Map.get(document.querySelector("."+n.Z.classes.MAP)),i="Error al cargar "+e,o=s.Util.getLocaleString(r?r.options.locale:"es-ES","urlFailedToLoad",{url:e});s.error(o,[n.Z.msgErrorMode.TOAST],i),s.error(`${o}. Pila de la llamada al recurso: \n${t&&t.length>0?t:""}`,[n.Z.msgErrorMode.EMAIL],i)};s.syncLoadJS=function(e){var t=function(e,t){var r,n=new XMLHttpRequest;n.open("GET",e,!1),n.onreadystatechange=function(e){4===n.readyState&&(404===n.status?(r=!1,t(!0)):200!==n.status?(t(),r=!1):r=n.responseText)};try{n.send(null)}catch(e){r=!1,t()}return r};/(\.js|\/)$/i.test(e)||(e+=s.isDebug?".js":".min.js");var r,n,i,o=t(e,(function(r){return r?(l(e),!1):t(e,(function(){l(e)}))}));if(o){var a=document.createElement("script");a.type="text/javascript",a.text=o,(n=document,i=n.getElementsByTagName("head"),0===i.length?(r=n.createElement("head"),n.documentElement.insertBefore(r,document.body)):r=i[0],r).appendChild(a)}},s.loadJSInOrder=function(e,t,r){return s.loadJS(e,t,r,!0)};const c=function(e,t){s.Util.isSameOrigin(e)||(t.crossOrigin="anonymous")};s.loadJS=function(e,t,r,n=!1,i){return new Promise((function(a,u){const p=function(){s.Util.isFunction(r)&&r(),a()};var h=Array.isArray(t)?t:[t];if(h=h.map((function(e){return/\.js$/i.test(e)||0!==e.indexOf(s.apiLocation)?e:e+(s.isDebug?".js":".min.js")})),e){var d="";const e=function(e){return e.split("/").reverse().slice(0,2).reverse().join("_").toLowerCase()};if((h=h instanceof Array?h:[h]).length>1){var f=h.slice(0).filter((function(t,r){return!o().isDefined(e(t))||(h.splice(r,1),o().ready(e(t),p),!1)}));1===f.length?d=e(f[0]):f.length>0&&(d=f.reduce((function(t,r){return e(t)+"_"+e(r)})))}else d=e(h[0]);if(d.length>0)if(o().isDefined(d))o().ready(d,p);else{var g={async:!n,numRetries:1};i||s.Util.detectIE()||(g.before=c),o()(h,d,g),o().ready(d,{success:function(){p()},error:function(e){l(e)}})}}else p()}))},s.loadCSS=function(e){const t=e.split("/").reverse().slice(0,2).reverse().join("_").toLowerCase();o().isDefined(t)?o().ready(t,{}):o()(e,t,{error:function(e){l(e)},numRetries:1})},s.ajax=function(e){return new Promise((function(t,r){const i=(e=e||{}).method||"GET",o="GET"===i;var a;if(e.data)if("string"==typeof e.data)a=e.data;else if("object"==typeof e.data)if(o&&(e.contentType||"boolean"==typeof e.contentType))a=s.Util.getParamString(e.data);else{const t=[];for(var l in e.data)t.push(l+"="+e.data[l].toString());a=t.join("&")}var c=e.url;o&&a&&(c=c+"?"+a),!1===e.cache&&(c+=(c.indexOf("?")<0?"?":"&")+"ts="+Date.now());const u={method:i,headers:new Headers};e.contentType||"boolean"==typeof e.contentType?e.contentType&&u.headers.append("Content-Type",e.contentType+"; charset=UTF-8"):u.headers.append("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),"POST"===i&&(u.body=a),fetch(c,u).then((async i=>{if(i.ok)try{let r;switch(e.responseType){case n.Z.mimeType.JSON:r=await i.json();break;case n.Z.mimeType.XML:r=await i.text(),r=(new DOMParser).parseFromString(r,"application/xml");break;default:r=await i.text()}t({data:r,contentType:i.headers.get("Content-type")})}catch(e){r(e)}else r({status:i.status,msg:i.statusText,url:c})})).catch((e=>r(e)))}))};var u={};s.getProjectionData=async function(e){const t=((e=e||{}).crs||"").match(/\d{4,5}$/g);let i=t?t[0]:"";const o=n.Z.url.EPSG+"?format=json&q="+i;let a=u[i];if(a)return e.sync?a:Promise.resolve(a);if(e.sync){let e;const t=new XMLHttpRequest;t.onreadystatechange=function(r){4==t.readyState&&(e=404!=t.status&&(200==t.status&&t.responseText))},t.open("GET",o,!1);try{t.send(null)}catch(t){e=!1}return e&&(e=JSON.parse(e)),e}s.tool.Proxification||(s.tool.Proxification=(await Promise.resolve().then(r.bind(r,4676))).default);const l=new s.tool.Proxification(s.proxify),c=await l.fetchJSON(o,e);return u[i]=c,c},s.loadProjDef=function(e){const t=(e=e||{}).crs,r="urn:ogc:def:crs:EPSG::",n="http://www.opengis.net/gml/srs/epsg.xml#";var i;i=function(e){return e=function(e){var t=/http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/\d\/(\d{4,5})/.exec(e);return t&&2===t.length?r+t[1]:e}(e),a.Z.defs(e)};const o=function(e){return"function"==typeof e},l=function(o,l,c){const u="EPSG:"+o,p=r+o,h="urn:x-ogc:def:crs:EPSG:"+o,d=n+o,f="http://www.opengis.net/def/crs/EPSG/0/"+o;var g;"object"==typeof l?(g=s.Util.extend({},l),l=s.Util.extend({},l),g.axis&&delete g.axis):"string"==typeof l&&(g=l.replace("+axis=neu","")),a.Z.defs(u,l),a.Z.defs(p,l),a.Z.defs(h,l),a.Z.defs(d,g),a.Z.defs(f,l),0===t.indexOf(n)&&(a.Z.defs(t,g),i(t).name=c),window.ol&&ol.proj&&!e.silent&&ol.proj.proj4.register(a.Z),i(u).name=c,i(d).name=c,i(f).name=c};var c=t.lastIndexOf("#");c<0&&(c=t.lastIndexOf("/")),c<0&&(c=t.lastIndexOf(":"));var u=t.substr(c+1),p=i(t);if(p)l(u,p,e.name),o(e.callback)&&e.callback();else if(e.def)l(u,e.def,e.name),o(e.callback)&&e.callback();else{const t=function(t){(function(e){const t=e&&"ok"===e.status&&1===e.number_result;if(t){var r=e.results[0];l(r.code,r.proj4,r.name)}return t})(t)&&o(e.callback)&&e.callback()};if(e.sync){t(s.getProjectionData(e))}else s.getProjectionData(e).then(t).catch((e=>console.error(e)))}},s.inherit=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e._super=t.prototype},s.mix=function(e,...t){Object.assign(e.prototype,...t)};const p=new Map;s.getUID=function(e){const t=e||{},r=t.prefix||"";let n=p.get(r);n||(n=1);var i=r+n;return p.set(r,n+1),t.banlist&&t.banlist.includes(i)?s.getUID(e):i},s.setUIDStart=function(e,t){const r=(t||{}).prefix||"";let n=p.get(r);return n||(n=1),e>n?(p.set(r,e),e):n};const h=["","-webkit-","-moz-","-o-","-ms-"],d="http://sitna.tracasa.es/";var f,g,y;const m={touch:function(){if(void 0===f){if("ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch)return f=!0,!0;const e=h.map((function(e){return"("+e+"touch-enabled)"})).join();f=matchMedia(e).matches}return f},inputTypeColor:function(){if(void 0===g){const e=document.createElement("input");e.setAttribute("type","color"),(g="text"!==e.type&&"style"in e)&&(e.value=":-)",g=":-)"!==e.value)}return g},urlParser:function(){if(void 0===y)try{const e=new URL(d);y=e.href===d}catch(e){y=!1}return y}};s.browserFeatures=m;const v=/\+/g;function _(e){return e}function w(e){return decodeURIComponent(e.replace(v," "))}s.cookie=function(e,t,r){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(t))||null===t)){if(r=s.Util.extend({},r),null===t&&(r.expires=-1),"number"==typeof r.expires){var n=r.expires,i=r.expires=new Date;i.setDate(i.getDate()+n)}return t=String(t),document.cookie=[encodeURIComponent(e),"=",r.raw?t:encodeURIComponent(t),r.expires?";expires="+r.expires.toUTCString():"",r.path?";path="+r.path:"",r.domain?";domain="+r.domain:"",r.secure?";secure":""].join("")}for(var o,a=(r=t||{}).raw?_:w,l=document.cookie.split("; "),c=0;o=l[c]&&l[c].split("=");c++)if(a(o.shift())===e)return a(o.join("="));return null};const S=s},9967:(e,t,r)=>{"use strict";r.d(t,{Z:()=>l,k:()=>a});var n=r(688),i=r(330),o=r(268);n.Z.Util=o.Z;const a=(s={},{imageRatio:1.05,proxy:"",acceptedBrowserVersions:[],crs:"EPSG:25830",utmCrs:"EPSG:25830",geoCrs:"EPSG:4326",initialExtent:[541084.221,4640788.225,685574.4632,4796618.764],maxExtent:!1,baselayerExtent:[480408,4599748,742552,4861892],resolutions:[1024,512,256,128,64,32,16,8,4,2,1,.5,.25],pointBoundsRadius:30,extentMargin:.2,mouseWheelZoom:!0,attribution:'<a href="http://sitna.navarra.es/" target="_blank">SITNA</a>',oldBrowserAlert:!0,notifyApplicationErrors:!1,loggingErrorsEnabled:!0,maxErrorCount:10,locale:"es-ES",view:i.Z.view.DEFAULT,screenSize:27,pixelTolerance:10,maxResolutionError:.01,toastDuration:5e3,averageTileSize:31e3,availableBaseLayers:[{id:i.Z.layer.IDENA_BASEMAP,title:"Mapa base",type:i.Z.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830extended",layerNames:"mapabase",encoding:i.Z.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!0,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-basemap.png",fallbackLayer:i.Z.layer.IDENA_DYNBASEMAP,overviewMapLayer:i.Z.layer.IDENA_BASEMAP},{id:i.Z.layer.IDENA_BASEMAP_GREY,title:"Mapa base gris",type:i.Z.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830extended",layerNames:"mapaBaseGris",encoding:i.Z.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-basemap-grey.png",fallbackLayer:i.Z.layer.IDENA_DYNBASEMAP_GREY,overviewMapLayer:i.Z.layer.IDENA_BASEMAP},{id:i.Z.layer.IDENA_ORTHOPHOTO,title:"Ortofoto mxima actualidad",type:i.Z.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto_maxima_actualidad",encoding:i.Z.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-orthophoto.jpg",fallbackLayer:i.Z.layer.IDENA_DYNORTHOPHOTO,overviewMapLayer:i.Z.layer.IDENA_BASEMAP},{id:i.Z.layer.IDENA_ORTHOPHOTO2022,title:"Ortofoto 2022",type:i.Z.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2022",encoding:i.Z.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-ortho2022.jpg",fallbackLayer:i.Z.layer.IDENA_DYNORTHOPHOTO2022,overviewMapLayer:i.Z.layer.IDENA_BASEMAP},{id:i.Z.layer.IDENA_ORTHOPHOTO2021,title:"Ortofoto 2021",type:i.Z.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2021",encoding:i.Z.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-ortho2021.jpg",fallbackLayer:i.Z.layer.IDENA_DYNORTHOPHOTO2021,overviewMapLayer:i.Z.layer.IDENA_BASEMAP},{id:i.Z.layer.IDENA_ORTHOPHOTO2020,title:"Ortofoto 2020",type:i.Z.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2020",encoding:i.Z.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-ortho2020.jpg",fallbackLayer:i.Z.layer.IDENA_DYNORTHOPHOTO2020,overviewMapLayer:i.Z.layer.IDENA_BASEMAP},{id:i.Z.layer.IDENA_ORTHOPHOTO2019,title:"Ortofoto 2019",type:i.Z.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2019",encoding:i.Z.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-ortho2019.jpg",fallbackLayer:i.Z.layer.IDENA_DYNORTHOPHOTO2019,overviewMapLayer:i.Z.layer.IDENA_BASEMAP},{id:i.Z.layer.IDENA_ORTHOPHOTO2018,title:"Ortofoto 2018",type:i.Z.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2018",encoding:i.Z.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-ortho2018.jpg",fallbackLayer:i.Z.layer.IDENA_DYNORTHOPHOTO2018,overviewMapLayer:i.Z.layer.IDENA_BASEMAP},{id:i.Z.layer.IDENA_ORTHOPHOTO2017,title:"Ortofoto 2017",type:i.Z.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2017",encoding:i.Z.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-ortho2017.jpg",fallbackLayer:i.Z.layer.IDENA_DYNORTHOPHOTO2017,overviewMapLayer:i.Z.layer.IDENA_BASEMAP},{id:i.Z.layer.IDENA_ORTHOPHOTO2014,title:"Ortofoto 2014",type:i.Z.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830reduced",layerNames:"ortofoto2014",encoding:i.Z.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-ortho2014.jpg",fallbackLayer:i.Z.layer.IDENA_DYNORTHOPHOTO2014,overviewMapLayer:i.Z.layer.IDENA_BASEMAP},{id:i.Z.layer.IDENA_ORTHOPHOTO2012,title:"Ortofoto 2012",type:i.Z.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2012",encoding:i.Z.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-ortho2012.jpg",fallbackLayer:i.Z.layer.IDENA_DYNORTHOPHOTO2012,overviewMapLayer:i.Z.layer.IDENA_BASEMAP},{id:i.Z.layer.IDENA_PAMPLONA_ORTHOPHOTO2020,title:"Ortofoto comarca de Pamplona 2020",type:i.Z.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830deep",layerNames:"ortofotoPamplona2020",encoding:i.Z.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-ortho-pamplona2020.jpg",fallbackLayer:i.Z.layer.IDENA_PAMPLONA_DYNORTHOPHOTO2020,overviewMapLayer:i.Z.layer.IDENA_BASEMAP},{id:i.Z.layer.IDENA_CARTO,title:"Cartografa topogrfica",type:i.Z.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830extended",layerNames:"mapaTopografico",encoding:i.Z.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-bta.png",fallbackLayer:i.Z.layer.IDENA_DYNCARTO,overviewMapLayer:i.Z.layer.IDENA_BASEMAP},{id:i.Z.layer.IDENA_PAMPLONA_CARTO,title:"Cartografa topogrfica Pamplona",type:i.Z.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830deep",layerNames:"mapaTopograficoPamplona",encoding:i.Z.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-topo-pamplona.jpg",fallbackLayer:i.Z.layer.IDENA_PAMPLONA_DYNCARTO,overviewMapLayer:i.Z.layer.IDENA_BASEMAP},{id:i.Z.layer.IDENA_CADASTER,title:"Catastro",type:i.Z.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"catastro,regionesFronterizas",format:"image/png",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-cadaster.png",overviewMapLayer:i.Z.layer.IDENA_BASEMAP},{id:i.Z.layer.IDENA_BW_RELIEF,title:"Relieve",type:i.Z.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"IDENA:mapa_relieve_bn",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-relief_bw.jpg",overviewMapLayer:i.Z.layer.IDENA_BASEMAP},{id:i.Z.layer.IDENA_BASEMAP_ORTHOPHOTO,title:"Mapa base/ortofoto",type:i.Z.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"mapaBase_orto",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-base_ortho.png",overviewMapLayer:i.Z.layer.IDENA_BASEMAP},{id:i.Z.layer.IDENA_DYNBASEMAP,title:"Mapa base",type:i.Z.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"mapaBase,regionesFronterizas",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-basemap.png",overviewMapLayer:i.Z.layer.IDENA_DYNBASEMAP},{id:i.Z.layer.IDENA_DYNBASEMAP_GREY,title:"Mapa base gris",type:i.Z.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"mapaBaseGris,regionesFronterizas",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-basemap-grey.png",overviewMapLayer:i.Z.layer.IDENA_DYNBASEMAP},{id:i.Z.layer.IDENA_DYNORTHOPHOTO,title:"Ortofoto mxima actualidad",type:i.Z.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_maxima_actualidad",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-orthophoto.jpg",overviewMapLayer:i.Z.layer.IDENA_DYNBASEMAP},{id:i.Z.layer.IDENA_DYNORTHOPHOTO2022,title:"Ortofoto 2022",type:i.Z.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2022",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-ortho2022.jpg",overviewMapLayer:i.Z.layer.IDENA_DYNBASEMAP},{id:i.Z.layer.IDENA_DYNORTHOPHOTO2021,title:"Ortofoto 2021",type:i.Z.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2021",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-ortho2021.jpg",overviewMapLayer:i.Z.layer.IDENA_DYNBASEMAP},{id:i.Z.layer.IDENA_DYNORTHOPHOTO2020,title:"Ortofoto 2020",type:i.Z.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2020",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-ortho2020.jpg",overviewMapLayer:i.Z.layer.IDENA_DYNBASEMAP},{id:i.Z.layer.IDENA_DYNORTHOPHOTO2019,title:"Ortofoto 2019",type:i.Z.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2019",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-ortho2019.jpg",overviewMapLayer:i.Z.layer.IDENA_DYNBASEMAP},{id:i.Z.layer.IDENA_DYNORTHOPHOTO2018,title:"Ortofoto 2018",type:i.Z.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2018",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-ortho2018.jpg",overviewMapLayer:i.Z.layer.IDENA_DYNBASEMAP},{id:i.Z.layer.IDENA_DYNORTHOPHOTO2017,title:"Ortofoto 2017",type:i.Z.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2017",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-ortho2017.jpg",overviewMapLayer:i.Z.layer.IDENA_DYNBASEMAP},{id:i.Z.layer.IDENA_DYNORTHOPHOTO2014,title:"Ortofoto 2014",type:i.Z.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2014",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-ortho2014.jpg",overviewMapLayer:i.Z.layer.IDENA_DYNBASEMAP},{id:i.Z.layer.IDENA_DYNORTHOPHOTO2012,title:"Ortofoto 2012",type:i.Z.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2012",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-ortho2012.jpg",overviewMapLayer:i.Z.layer.IDENA_DYNBASEMAP},{id:i.Z.layer.IDENA_PAMPLONA_DYNORTHOPHOTO2020,title:"Ortofoto comarca de Pamplona 2020",type:i.Z.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_500_Pamplona_2020",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-ortho-pamplona2020.jpg",overviewMapLayer:i.Z.layer.IDENA_DYNBASEMAP},{id:i.Z.layer.IDENA_DYNCARTO,title:"Cartografa topogrfica 2017",type:i.Z.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"MTNa5_BTA",format:"image/png",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-bta.png",overviewMapLayer:i.Z.layer.IDENA_DYNBASEMAP},{id:i.Z.layer.IDENA_PAMPLONA_DYNCARTO,title:"Cartografa topogrfica Pamplona",type:i.Z.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"MTNa05_BTU_201",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-topo-pamplona.jpg",overviewMapLayer:i.Z.layer.IDENA_DYNBASEMAP},{id:i.Z.layer.IGN_ES_CARTO,type:i.Z.layerType.WMTS,title:"Cartografa raster \r\n (IGN ES)",url:"//www.ign.es/wmts/mapa-raster",encoding:i.Z.WMTSEncoding.KVP,layerNames:"MTN",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:n.Z.apiLocation+"css/img/thumb-carto_ign.png",fallbackLayer:i.Z.layer.IGN_ES_DYNCARTO,overviewMapLayer:i.Z.layer.IGN_ES_BASEMAP},{id:i.Z.layer.IGN_ES_BASEMAP,title:"Callejero \r\n (IGN ES)",type:i.Z.layerType.WMTS,url:"//www.ign.es/wmts/ign-base",encoding:i.Z.WMTSEncoding.KVP,layerNames:"IGNBaseTodo",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:n.Z.apiLocation+"css/img/thumb-basemap_ign.png",fallbackLayer:i.Z.layer.IGN_ES_DYNBASEMAP,overviewMapLayer:i.Z.layer.IGN_ES_BASEMAP},{id:i.Z.layer.IGN_ES_BASEMAP_GREY,title:"Callejero gris \r\n (IGN ES)",type:i.Z.layerType.WMTS,url:"//www.ign.es/wmts/ign-base",encoding:i.Z.WMTSEncoding.KVP,layerNames:"IGNBase-gris",matrixSet:"GoogleMapsCompatible",format:"image/jpeg",thumbnail:n.Z.apiLocation+"css/img/thumb-basemap_grey_ign.png",fallbackLayer:i.Z.layer.IGN_ES_DYNBASEMAP_GREY,overviewMapLayer:i.Z.layer.IGN_ES_BASEMAP},{id:i.Z.layer.IGN_ES_RELIEF,title:"Relieve \r\n (IGN ES)",type:i.Z.layerType.WMTS,url:"//servicios.idee.es/wmts/mdt",encoding:i.Z.WMTSEncoding.KVP,layerNames:"Relieve",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:n.Z.apiLocation+"css/img/thumb-relief_ign.jpg",overviewMapLayer:i.Z.layer.IGN_ES_BASEMAP},{id:i.Z.layer.IGN_ES_ORTHOPHOTO,title:"Ortofoto PNOA",type:i.Z.layerType.WMTS,url:"//www.ign.es/wmts/pnoa-ma",encoding:i.Z.WMTSEncoding.KVP,layerNames:"OI.OrthoimageCoverage",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:n.Z.apiLocation+"css/img/thumb-orthophoto_pnoa.jpg",fallbackLayer:i.Z.layer.IGN_ES_DYNORTHOPHOTO,overviewMapLayer:i.Z.layer.IGN_ES_BASEMAP},{id:i.Z.layer.IGN_ES_LIDAR,title:"Modelo digital LIDAR (IGN ES)",type:i.Z.layerType.WMTS,url:"//wmts-mapa-lidar.idee.es/lidar",encoding:i.Z.WMTSEncoding.KVP,layerNames:"EL.GridCoverageDSM",matrixSet:"GoogleMapsCompatible",format:"image/png",thumbnail:n.Z.apiLocation+"css/img/thumb-lidar_ign.jpg",fallbackLayer:i.Z.layer.IGN_ES_DYNLIDAR,overviewMapLayer:i.Z.layer.IGN_ES_BASEMAP},{id:i.Z.layer.IGN_ES_DYNBASEMAP,title:"Callejero \r\n (IGN ES)",type:i.Z.layerType.WMS,url:"//www.ign.es/wms-inspire/ign-base",layerNames:"IGNBaseTodo",thumbnail:n.Z.apiLocation+"css/img/thumb-basemap_ign.png",overviewMapLayer:i.Z.layer.IGN_ES_BASEMAP},{id:i.Z.layer.IGN_ES_DYNBASEMAP_GREY,title:"Callejero gris \r\n (IGN ES)",type:i.Z.layerType.WMS,url:"//www.ign.es/wms-inspire/ign-base",layerNames:"IGNBaseTodo-gris",thumbnail:n.Z.apiLocation+"css/img/thumb-basemap_grey_ign.png",overviewMapLayer:i.Z.layer.IGN_ES_BASEMAP},{id:i.Z.layer.IGN_ES_DYNORTHOPHOTO,title:"Ortofoto PNOA",type:i.Z.layerType.WMS,url:"//www.ign.es/wms-inspire/pnoa-ma",layerNames:"OI.OrthoimageCoverage",thumbnail:n.Z.apiLocation+"css/img/thumb-orthophoto_pnoa.jpg",overviewMapLayer:i.Z.layer.IGN_ES_BASEMAP},{id:i.Z.layer.IGN_ES_DYNCARTO,title:"Cartografa raster \r\n (IGN ES)",type:i.Z.layerType.WMS,url:"//www.ign.es/wms-inspire/mapa-raster",layerNames:"mtn_rasterizado",thumbnail:n.Z.apiLocation+"css/img/thumb-carto_ign.png",overviewMapLayer:i.Z.layer.IGN_ES_BASEMAP},{id:i.Z.layer.IGN_ES_DYNLIDAR,title:"Modelo digital LIDAR (IGN ES)",type:i.Z.layerType.WMS,url:"//wms-mapa-lidar.idee.es/lidar",layerNames:"EL.GridCoverage",thumbnail:n.Z.apiLocation+"css/img/thumb-lidar_ign.jpg",overviewMapLayer:i.Z.layer.IGN_ES_BASEMAP},{id:i.Z.layer.IGN_FR_BASEMAP,title:"Mapa base \r\n (IGN FR)",type:i.Z.layerType.WMTS,url:"//wxs.ign.fr/essentiels/geoportail/wmts",encoding:i.Z.WMTSEncoding.KVP,layerNames:"GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2",matrixSet:"PM",format:"image/png",thumbnail:n.Z.apiLocation+"css/img/thumb-base-fr-ign.png",fallbackLayer:i.Z.layer.IGN_FR_DYNBASEMAP,ignoreProxification:!0,overviewMapLayer:i.Z.layer.IGN_FR_BASEMAP},{id:i.Z.layer.IGN_FR_RELIEF,title:"Relieve \r\n (IGN FR)",type:i.Z.layerType.WMTS,url:"//wxs.ign.fr/altimetrie/geoportail/wmts",encoding:i.Z.WMTSEncoding.KVP,layerNames:"ELEVATION.ELEVATIONGRIDCOVERAGE.SHADOW",matrixSet:"PM",format:"image/png",thumbnail:n.Z.apiLocation+"css/img/thumb-estom-fr-ign.jpg",fallbackLayer:i.Z.layer.IGN_FR_DYNRELIEF,ignoreProxification:!0,overviewMapLayer:i.Z.layer.IGN_FR_BASEMAP},{id:i.Z.layer.IGN_FR_ORTHOPHOTO,title:"Ortofoto \r\n (IGN FR)",type:i.Z.layerType.WMTS,url:"//wxs.ign.fr/essentiels/geoportail/wmts",encoding:i.Z.WMTSEncoding.KVP,layerNames:"ORTHOIMAGERY.ORTHOPHOTOS",matrixSet:"PM",format:"image/jpeg",thumbnail:n.Z.apiLocation+"css/img/thumb-ortho-fr-ign.jpg",fallbackLayer:i.Z.layer.IGN_FR_DYNORTHOPHOTO,ignoreProxification:!0,overviewMapLayer:i.Z.layer.IGN_FR_BASEMAP},{id:i.Z.layer.IGN_FR_DYNBASEMAP,title:"Mapa base \r\n (IGN FR)",type:i.Z.layerType.WMS,url:"//wxs.ign.fr/essentiels/geoportail/r/wms",layerNames:"GEOGRAPHICALGRIDSYSTEMS.PLANIGN",thumbnail:n.Z.apiLocation+"css/img/thumb-base-fr-ign.png",ignoreProxification:!0,overviewMapLayer:i.Z.layer.IGN_FR_BASEMAP},{id:i.Z.layer.IGN_FR_DYNRELIEF,title:"Relieve \r\n (IGN FR)",type:i.Z.layerType.WMS,url:"//wxs.ign.fr/altimetrie/geoportail/r/wms",layerNames:"ELEVATION.ELEVATIONGRIDCOVERAGE.SHADOW",thumbnail:n.Z.apiLocation+"css/img/thumb-estom-fr-ign.jpg",ignoreProxification:!0,overviewMapLayer:i.Z.layer.IGN_FR_BASEMAP},{id:i.Z.layer.IGN_FR_DYNORTHOPHOTO,title:"Ortofoto \r\n (IGN FR)",type:i.Z.layerType.WMS,url:"//wxs.ign.fr/essentiels/geoportail/r/wms",layerNames:"ORTHOIMAGERY.ORTHOPHOTOS",thumbnail:n.Z.apiLocation+"css/img/thumb-ortho-fr-ign.jpg",ignoreProxification:!0,overviewMapLayer:i.Z.layer.IGN_FR_BASEMAP},{id:i.Z.layer.OSM,title:"OSM",type:i.Z.layerType.WMTS,url:n.Z.apiLocation+"wmts/osm/",matrixSet:"WorldWebMercatorQuad",layerNames:"osm",encoding:i.Z.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-osm.png",overviewMapLayer:i.Z.layer.OSM},{id:i.Z.layer.OPENTOPOMAP,title:"OpenTopoMap",type:i.Z.layerType.WMTS,url:n.Z.apiLocation+"wmts/opentopomap/",matrixSet:"WorldWebMercatorQuad",layerNames:"opentopomap",encoding:i.Z.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-opentopomap.png",overviewMapLayer:i.Z.layer.OSM},{id:i.Z.layer.CARTO_VOYAGER,title:"CARTO Voyager",type:i.Z.layerType.WMTS,url:n.Z.apiLocation+"wmts/carto/",matrixSet:"WorldWebMercatorQuad",layerNames:"voyager",encoding:i.Z.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-carto-voyager.png",overviewMapLayer:i.Z.layer.CARTO_VOYAGER},{id:i.Z.layer.CARTO_LIGHT,title:"CARTO light",type:i.Z.layerType.WMTS,url:n.Z.apiLocation+"wmts/carto/",matrixSet:"WorldWebMercatorQuad",layerNames:"light_all",encoding:i.Z.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-carto-light.png",overviewMapLayer:i.Z.layer.CARTO_VOYAGER},{id:i.Z.layer.CARTO_DARK,title:"CARTO dark",type:i.Z.layerType.WMTS,url:n.Z.apiLocation+"wmts/carto/",matrixSet:"WorldWebMercatorQuad",layerNames:"dark_all",encoding:i.Z.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-carto-dark.png",overviewMapLayer:i.Z.layer.CARTO_VOYAGER},{id:i.Z.layer.MAPBOX_STREETS,title:"Mapbox Streets",type:i.Z.layerType.WMTS,url:n.Z.apiLocation+"wmts/mapbox/",matrixSet:"WorldWebMercatorQuad",layerNames:"streets",encoding:i.Z.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-mapbox-streets.png",overviewMapLayer:i.Z.layer.MAPBOX_STREETS},{id:i.Z.layer.MAPBOX_SATELLITE,title:"Mapbox Satellite",type:i.Z.layerType.WMTS,url:n.Z.apiLocation+"wmts/mapbox/",matrixSet:"WorldWebMercatorQuad",layerNames:"satellite",encoding:i.Z.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:n.Z.apiLocation+"css/img/thumb-mapbox-satellite.jpg",overviewMapLayer:i.Z.layer.MAPBOX_STREETS},{id:i.Z.layer.BLANK,title:"Mapa en blanco",type:i.Z.layerType.VECTOR}],baseLayers:[i.Z.layer.IDENA_BASEMAP,i.Z.layer.IDENA_ORTHOPHOTO,i.Z.layer.IDENA_CADASTER,i.Z.layer.IDENA_CARTO],defaultBaseLayer:i.Z.layer.IDENA_BASEMAP,workLayers:[],controls:{loadingIndicator:!0,navBar:!1,scaleBar:!1,scale:!1,scaleSelector:!1,overviewMap:!1,basemapSelector:!1,attribution:!0,TOC:!1,workLayerManager:!1,layerCatalog:!1,coordinates:!0,legend:!1,popup:!1,search:{url:"https://idena.navarra.es/ogc/wfs",allowedSearchTypes:{coordinates:{},municipality:{},urban:{},street:{},number:{},cadastral:{}}},measure:!1,streetView:!1,click:!1,printMap:!1,featureInfo:{active:!0,persistentHighlights:!0},featureTools:!0},layout:null,styles:{point:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#ff0000",strokeWidth:2,strokeOpacity:1,radius:6,labelOutlineWidth:2,labelOutlineColor:"#ffffff",labelOffset:[0,-16],fontColor:"#000000",fontSize:10},marker:{classes:[i.Z.classes.MARKER+1,i.Z.classes.MARKER+2,i.Z.classes.MARKER+3,i.Z.classes.MARKER+4,i.Z.classes.MARKER+5],anchor:[.5,1],width:32,height:32,labelOutlineWidth:2,labelOutlineColor:"#ffffff",labelOffset:[0,-32],fontColor:"#000000",fontSize:10},line:{strokeColor:"#ff0000",strokeWidth:2,strokeOpacity:1,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10},polygon:{strokeColor:"#ff0000",strokeWidth:2,strokeOpacity:1,fillColor:"#000000",fillOpacity:.3,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10},label:{strokeColor:"#ffffff",strokeWidth:1,fillColor:"#000000"},cluster:{point:{fillColor:"#333366",fillOpacity:.6,radius:function(e){var t=e.features.length,r=s[t];return r||(r=2+Math.round(5*Math.sqrt(t)),s[t]=r),r},label:"${features.length}",fontColor:"#ffffff",fontSize:9}},selection:{point:{fillColor:"#008000",fillOpacity:.5,strokeColor:"#008000",strokeWidth:2,radius:6,labelOutlineWidth:2,labelOutlineColor:"#ffffff",labelOffset:[0,-16],fontColor:"#000000",fontSize:10,zIndex:1},line:{strokeColor:"#008000",strokeWidth:2,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10,zIndex:1},polygon:{strokeColor:"#008000",strokeWidth:2,fillColor:"#000000",fillOpacity:.3,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10,zIndex:1}},snapping:{point:{fillColor:"#00ffff",fillOpacity:.3,strokeColor:"#00ffff",strokeWidth:2,radius:6,labelOutlineWidth:2,labelOutlineColor:"#ffffff",labelOffset:[0,-16],fontColor:"#000000",fontSize:10,zIndex:1}}}});var s;const l=n.Z.Util.extend(!0,{},a)},330:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});const n={OLNS:"ol",PROJ4JSOBJ:"proj4",GEOGRAPHIC:"geographic",UTM:"UTM",OLD_BROWSER_ALERT:"TC.oldBrowserAlert",CLUSTER_ANIMATION_DURATION:200,ZOOM_ANIMATION_DURATION:300,URL_MAX_LENGTH:2048,METER_PRECISION:0,DEGREE_PRECISION:5,EXTENT_TOLERANCE:.9998,SRSDOWNLOAD_GEOJSON_KML:"urn:ogc:def:crs:OGC::CRS84",url:{SPLIT_REGEX:/([^:]*:)?\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,EPSG:"https://epsg.io/"}};if("undefined"!=typeof SITNA_BASE_URL)n.url.ERROR_LOGGER=SITNA_BASE_URL+"errors/logger.ashx";else{const e=document.currentScript.getAttribute("src"),t=e.substr(0,e.lastIndexOf("/")+1);n.url.ERROR_LOGGER=t+"errors/logger.ashx"}n.classes={MAP:"tc-map",POINT:"tc-point",MARKER:"tc-marker",VISIBLE:"tc-visible",HIDDEN:"tc-hidden",COLLAPSED:"tc-collapsed",COLLAPSED_LEFT:"tc-collapsed-left",COLLAPSED_RIGHT:"tc-collapsed-right",CHECKED:"tc-checked",DISABLED:"tc-disabled",ACTIVE:"tc-active",HIGHLIGHTED:"tc-highlighted",DEFAULT:"tc-default",LASTCHILD:"tc-lastchild",TRANSPARENT:"tc-transparent",DROP:"tc-drop",LOADING:"tc-loading",IPAD_IOS7_FIX:"tc-ipad-ios7-fix",INFO:"tc-msg-info",WARNING:"tc-msg-warning",ERROR:"tc-msg-error",THREED:"tc-3d",TOAST:"tc-toast",TOAST_CONTAINER:"tc-toast-container",LEFT_PANEL:"tc-left-panel",RIGHT_PANEL:"tc-right-panel",SLIDE_PANEL:"tc-slide-panel",TOOLS_PANEL:"tc-tools-panel",LEGEND_PANEL:"tc-legend-panel",OVERVIEW_MAP_PANEL:"tc-ovmap-panel",PANEL_CONTENT:"tc-panel-content",PANEL_TAB:"tc-panel-tab",FULL_SCREEN:"tc-fullscreen"},n.msgType={INFO:"info",WARNING:"warning",ERROR:"error"},n.msgErrorMode={TOAST:"toast",CONSOLE:"console",EMAIL:"email"},n.event={MAPLOAD:"mapload.tc",MAPREADY:"mapready.tc",MAPCHANGE:"mapchange.tc",BEFORELAYERADD:"beforelayeradd.tc",LAYERADD:"layeradd.tc",LAYERREMOVE:"layerremove.tc",LAYERORDER:"layerorder.tc",BEFORELAYERUPDATE:"beforelayerupdate.tc",LAYERUPDATE:"layerupdate.tc",LAYERERROR:"layererror.tc",BEFOREBASELAYERCHANGE:"beforebaselayerchange.tc",BASELAYERCHANGE:"baselayerchange.tc",BEFOREUPDATE:"beforeupdate.tc",UPDATE:"update.tc",BEFOREZOOM:"beforezoom.tc",ZOOM:"zoom.tc",BEFOREUPDATEPARAMS:"beforeupdateparams.tc",UPDATEPARAMS:"updateparams.tc",VECTORUPDATE:"vectorupdate.tc",FEATUREADD:"featureadd.tc",BEFOREFEATURESADD:"beforefeaturesadd.tc",FEATURESADD:"featuresadd.tc",BEFOREFEATUREREMOVE:"beforefeatureremove.tc",FEATUREREMOVE:"featureremove.tc",FEATURESCLEAR:"featuresclear.tc",FEATURESIMPORT:"featuresimport.tc",FEATURESIMPORTERROR:"featuresimporterror.tc",FEATURESIMPORTPARTIAL:"featuresimportpartial.tc",FEATURESIMPORTWARN:"featuresimportwarn.tc",FILESAVE:"filesave.tc",BEFORETILELOAD:"beforetileload.tc",TILELOAD:"tileload.tc",TILELOADERROR:"tileloaderror.tc",CONTROLADD:"controladd.tc",CONTROLACTIVATE:"controlactivate.tc",CONTROLDEACTIVATE:"controldeactivate.tc",BEFORECONTROLRENDER:"beforecontrolrender.tc",CONTROLRENDER:"controlrender.tc",CONTROLHIGHLIGHT:"controlhighlight.tc",CONTROLUNHIGHLIGHT:"controlunhighlight.tc",BEFORELAYOUTLOAD:"beforelayoutload.tc",LAYOUTLOAD:"layoutload.tc",LAYERVISIBILITY:"layervisibility.tc",LAYEROPACITY:"layeropacity.tc",FEATURECLICK:"featureclick.tc",NOFEATURECLICK:"nofeatureclick.tc",FEATUREOVER:"featureover.tc",FEATUREOUT:"featureout.tc",BEFOREFEATUREINFO:"beforefeatureinfo.tc",FEATUREINFO:"featureinfo.tc",NOFEATUREINFO:"nofeatureinfo.tc",FEATUREINFOERROR:"featureinfoerror.tc",CLICK:"click",MOUSEUP:"mouseup",MOUSEMOVE:"mousemove",MOUSELEAVE:"mouseleave",STARTLOADING:"startloading.tc",STOPLOADING:"stoploading.tc",EXTERNALSERVICEADDED:"externalserviceadded.tc",ZOOMTO:"zoomto.tc",PROJECTIONCHANGE:"projectionchange.tc",VIEWCHANGE:"viewchange.tc",CAMERACHANGE:"camerachange.tc",TERRAINPROVIDERADD:"terrainprovideradd.tc",TERRAINPROVIDERREMOVE:"terrainproviderremove.tc",OVERVIEWBASELAYERCHANGE:"overviewbaselayerchange.tc",POPUP:"popup.tc",BEFOREAPPLYQUERY:"beforeapplyquery.tc",RECENTFILEADD:"recentfileadd.tc"},n.layer={IDENA_ORTHOPHOTO:"ortofoto",IDENA_BASEMAP:"mapabase",IDENA_BASEMAP_GREY:"mapabase_gris",IDENA_CADASTER:"catastro",IDENA_CARTO:"cartografia",IDENA_ORTHOPHOTO2022:"ortofoto2022",IDENA_ORTHOPHOTO2021:"ortofoto2021",IDENA_ORTHOPHOTO2020:"ortofoto2020",IDENA_ORTHOPHOTO2019:"ortofoto2019",IDENA_ORTHOPHOTO2018:"ortofoto2018",IDENA_ORTHOPHOTO2017:"ortofoto2017",IDENA_ORTHOPHOTO2014:"ortofoto2014",IDENA_ORTHOPHOTO2012:"ortofoto2012",IDENA_PAMPLONA_ORTHOPHOTO2020:"ortofoto_pamplona2020",IDENA_PAMPLONA_CARTO:"cartografia_pamplona",IDENA_DYNBASEMAP:"mapabase_dinamico",IDENA_DYNBASEMAP_GREY:"mapabase_gris_dinamico",IDENA_DYNORTHOPHOTO:"ortofoto_dinamico",IDENA_DYNORTHOPHOTO2022:"ortofoto2022_dinamico",IDENA_DYNORTHOPHOTO2021:"ortofoto2021_dinamico",IDENA_DYNORTHOPHOTO2020:"ortofoto2020_dinamico",IDENA_DYNORTHOPHOTO2019:"ortofoto2019_dinamico",IDENA_DYNORTHOPHOTO2018:"ortofoto2018_dinamico",IDENA_DYNORTHOPHOTO2017:"ortofoto2017_dinamico",IDENA_DYNORTHOPHOTO2014:"ortofoto2014_dinamico",IDENA_DYNORTHOPHOTO2012:"ortofoto2012_dinamico",IDENA_PAMPLONA_DYNORTHOPHOTO2020:"ortofoto_pamplona2020_dinamico",IDENA_PAMPLONA_DYNCARTO:"cartografia_pamplona_dinamico",IDENA_DYNCARTO:"cartografia_dinamico",IDENA_BW_RELIEF:"relieve_bn",IDENA_BASEMAP_ORTHOPHOTO:"base_orto",IGN_ES_CARTO:"ign-raster",IGN_ES_BASEMAP:"ign-base",IGN_ES_BASEMAP_GREY:"ign-base-gris",IGN_ES_RELIEF:"ign-mtn",IGN_ES_ORTHOPHOTO:"ign-pnoa",IGN_ES_LIDAR:"ign-lidar",IGN_ES_DYNCARTO:"ign-raster-dyn",IGN_ES_DYNBASEMAP:"ign-base-dyn",IGN_ES_DYNBASEMAP_GREY:"ign-base-gris-dyn",IGN_ES_DYNORTHOPHOTO:"ign-pnoa-dyn",IGN_ES_DYNLIDAR:"ign-lidar-dyn",IGN_FR_BASEMAP:"ign-fr-base",IGN_FR_RELIEF:"ign-fr-estompage",IGN_FR_ORTHOPHOTO:"ign-fr-orto",IGN_FR_DYNBASEMAP:"ign-fr-base-dyn",IGN_FR_DYNRELIEF:"ign-fr-estompage-dyn",IGN_FR_DYNORTHOPHOTO:"ign-fr-orto-dyn",OSM:"osm",OPENTOPOMAP:"opentopomap",CARTO_VOYAGER:"carto_voyager",CARTO_LIGHT:"carto_light",CARTO_DARK:"carto_dark",MAPBOX_STREETS:"mapbox_streets",MAPBOX_SATELLITE:"mapbox_satellite",BLANK:"ninguno"},n.text={API_ERROR:"Error API SITNA",APP_ERROR:"Error de aplicacin"},n.layerType={WMS:"WMS",WMTS:"WMTS",WFS:"WFS",VECTOR:"vector",KML:"KML",GPX:"GPX",GML:"GML",GEOJSON:"GeoJSON",GROUP:"group"},n.geom={POINT:"point",MULTIPOINT:"multipoint",POLYLINE:"polyline",POLYGON:"polygon",MULTIPOLYLINE:"multipolyline",MULTIPOLYGON:"multipolygon",CIRCLE:"circle",RECTANGLE:"rectangle"},n.searchType={CADASTRAL:"cadastral",COORDINATES:"coordinates",MUNICIPALITY:"municipality",COUNCIL:"council",LOCALITY:"locality",STREET:"street",NUMBER:"number",URBAN:"urban",COMMONWEALTH:"commonwealth",ROAD:"road",ROADMILESTONE:"roadmilestone",PLACENAME:"placename",PLACENAMEMUNICIPALITY:"placenamemunicipality"},n.mapSearchType={MUNICIPALITY:n.searchType.MUNICIPALITY,COUNCIL:n.searchType.COUNCIL,URBAN:n.searchType.URBAN,COMMONWEALTH:n.searchType.COMMONWEALTH,GENERIC:"generic"},n.comparison={EQUAL_TO:"==",NOT_EQUAL_TO:"!=",LESS_THAN:"<",GREATER_THAN:">",LESS_THAN_EQUAL_TO:"=<",GREATER_THAN_EQUAL_TO:">=",LIKE:"is"},n.logicalOperator={AND:"and",OR:"or"},n.WMTSEncoding={KVP:"KVP",RESTFUL:"RESTful"},n.mimeType={PNG:"image/png",JPEG:"image/jpeg",JSON:"application/json",GEOJSON:"application/vnd.geo+json",KML:"application/vnd.google-earth.kml+xml",KMZ:"application/vnd.google-earth.kmz",GML:"application/gml+xml",GPX:"application/gpx+xml",XML:"application/xml",GEOPACKAGE:"application/geopackage+sqlite3",SHAPEFILE:"x-gis/x-shapefile",ZIP:"application/x-zip"},n.format={JSON:"JSON",KML:"KML",KMZ:"KMZ",GML:"GML",GML2:"GML2",GML3:"GML3",GML32:"GML32",GEOJSON:"GeoJSON",TOPOJSON:"TopoJSON",GPX:"GPX",WKT:"WKT",WKB:"WKB",SHAPEFILE:"SHP",ZIP:"ZIP",GEOPACKAGE:"GPKG"},n.WFSErrors={GETFEATURE_NOT_AVAILABLE:"GetFeatureNotAvailable",LAYERS_NOT_AVAILABLE:"LayersNotAvailable",NO_LAYERS:"NoLayers",NO_VALID_LAYERS:"noValidLayers",QUERY_NOT_AVAILABLE:"QueryNotAvailable",MAX_NUM_FEATURES:"NumMaxFeatures",GETCAPABILITIES:"GetCapabilities",INDETERMINATE:"Indeterminate",NO_FEATURES:"NoFeatures"},n.visibility={NOT_VISIBLE:0,NOT_VISIBLE_AT_RESOLUTION:1,HAS_VISIBLE:2,VISIBLE:4},n.view={DEFAULT:0,THREED:1,PRINTING:2},n.units={DEGREES:"degrees",METERS:"m"},n.MARKER="marker",n.infoContainer={POPUP:"popup",RESULTS_PANEL:"resultsPanel"},n.DownloadError={MIMETYPE_NOT_SUPORTED:"MimeTypeNotSupported"};const i=n},7497:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c});var n=r(688),i=r(330),o=r(9967),a=r(4436),s=r(3089),l=r(1455);n.Z.i18n=n.Z.i18n||s.Z,n.Z._hbs=l.Z,n.Z.control=n.Z.control||{},n.Z.Control=function(){const e=this;a.Z.call(e),e.map=null,e.isActive=!1,e.isDisabled=!1,e.CLASS=e.getClassName();var t=arguments.length;e.options=n.Z.Util.extend({},t>1?arguments[1]:arguments[0]),e.id=e.options.id||n.Z.getUID({prefix:e.CLASS.substr(n.Z.Control.prototype.CLASS.length+1)+"-"}),e.div=n.Z.Util.getDiv(e.options.div?e.options.div:arguments[0]),e.div.classList.add(n.Z.Control.prototype.CLASS,e.CLASS),e.template=e.options.template||e.template,e.exportsState=!1},n.Z.inherit(n.Z.Control,a.Z),function(){const e=n.Z.Control.prototype;e.CLASS="tc-ctl",e.template=void 0,e.show=function(){this.div.style.display=""},e.hide=function(){this.div.style.display="none",this.unhighlight()},e.render=function(e){const t=this;return t._set1stRenderPromise(t.renderData(null,(function(){t.addUIEventListeners(),"function"==typeof e&&e()})))},e.loadTemplates=async function(){},e.getClassName=function(){return this.CLASS},e._set1stRenderPromise=function(e){const t=this;return t._firstRender||(t._firstRender=e),e},e.renderData=async function(e,t){const r=this;let o;r.map&&r.trigger(i.Z.event.BEFORECONTROLRENDER,{dataObject:e}),r.div.classList.toggle(i.Z.classes.DISABLED,r.isDisabled),r.template||await r.loadTemplates(),"object"!=typeof r.template||r.template.compiler?(o=r.template,r.template={},r.template[r.CLASS]=o):o=r.template[r.CLASS];const a=await r.getRenderedHtml(r.CLASS,e);r.div.innerHTML=a,r.map&&r.trigger(i.Z.event.CONTROLRENDER),n.Z.Util.isFunction(t)&&t()};e.getRenderedHtml=async function(e,t,r){const i=this,o=function(e){if(void 0===e)return"";const i=e(t);return n.Z.Util.isFunction(r)&&r(i),i};i.template||await i.loadTemplates();const a=i.template[e];return"function"!=typeof a?(await async function(e,t){t=t||{};const r=[];for(var i in e){const t=i;let o=e[t];"string"==typeof o?r.push(new Promise((function(r,i){n.Z.ajax({url:o,method:"GET",responseType:"text"}).then((function(n){e[t]=o=l.Z.compile(n.data),r(o)})).catch((function(e){console.log("Error fetching template: "+e),i(e)}))}))):"object"==typeof o&&(e[i]=o=l.Z.template(o))}for(var o in await Promise.all(r),e)e[o]&&o!==t.className&&l.Z.registerPartial(o,e[o])}(i.template,{locale:i.map&&i.map.options.locale,className:i.CLASS}),o(i.template[e])):o(a)},e.register=async function(e){const t=this;return t.map=e,await t.render(),t.options.active&&t.activate(),t},e.activate=function(){const e=this;e.map&&e.map.activeControl&&e.map.activeControl!==e&&(e.map.previousActiveControl=e.map.activeControl,e.map.activeControl.deactivate()),e.isActive=!0,e.map&&(e.map.activeControl=e,e.map.trigger(i.Z.event.CONTROLACTIVATE,{control:e}),e.trigger(i.Z.event.CONTROLACTIVATE,{control:e}))},e.deactivate=function(e){0===arguments.length&&(e=!1);const t=this;if(t.isActive=!1,t.map){if(t.map.activeControl=null,!e){var r=t.map.getDefaultControl();r===t||t.map.previousActiveControl===t?r=null:r||(r=t.map.previousActiveControl),r&&r.activate()}t.map.trigger(i.Z.event.CONTROLDEACTIVATE,{control:t}),t.trigger(i.Z.event.CONTROLDEACTIVATE,{control:t})}},e.enable=function(){const e=this;e.isDisabled=!1,e.div&&(e.div.classList.remove(i.Z.classes.DISABLED),delete e.div.dataset.tcMessage),e.containerControl&&e.containerControl.onControlEnable&&e.containerControl.onControlEnable(e)},e.disable=function(e){const t=this;if(e=e||{},t.isDisabled=!0,t.div){t.div.classList.add(i.Z.classes.DISABLED);let r=t.getLocaleString("disabledControl");e.reason&&(r=`${r} - ${e.reason}`),t.div.dataset.tcMessage=r}t.containerControl&&t.containerControl.onControlDisable&&t.containerControl.onControlDisable(t)},e.highlight=function(){const e=this;e.div&&e.div.classList.add(i.Z.classes.HIGHLIGHTED),e.map&&e.map.trigger(i.Z.event.CONTROLHIGHLIGHT,{control:e})},e.unhighlight=function(){const e=this;e.div&&e.div.classList.remove(i.Z.classes.HIGHLIGHTED),e.map&&e.map.trigger(i.Z.event.CONTROLUNHIGHLIGHT,{control:e})},e.isHighlighted=function(){const e=this;return!!e.div&&e.div.classList.contains(i.Z.classes.HIGHLIGHTED)},e.renderPromise=function(){const e=this;return e._firstRender||new Promise((function(t,r){e.one(i.Z.event.CONTROLRENDER,(function(){t(e)}))}))},e.addUIEventListener=function(e,t,r){(e?this.div.querySelectorAll(e):[this.div]).forEach((function(e){e.addEventListener(t,r)}))},e.addUIEventListeners=function(){},e.isExclusive=function(){return!1},e.getLocaleString=function(e,t){var r=this.map?this.map.options.locale:o.Z.locale;return n.Z.Util.getLocaleString(r,e,t)},e.getUID=function(){return n.Z.getUID({prefix:this.id+"-"})},e.exportState=function(){return this.exportsState?{}:null},e.importState=function(e){},e.getDownloadDialog=async function(){const e=this;return e._downloadDialog=e._downloadDialog||e.map.getControlsByClass("TC.control.FeatureDownloadDialog")[0],e._downloadDialog||(e._downloadDialog=await e.map.addControl("FeatureDownloadDialog")),e._downloadDialog.caller=e,e._downloadDialog},e.getElevationTool=async function(){const e=this;if(!e.displayElevation&&!e.options.displayElevation)return null;if(e.elevation)return e.elevation;if(n.Z.tool.Elevation||await r.e(4759).then(r.bind(r,2331)),"boolean"==typeof e.options.displayElevation)if(e.map){const t=await e.map.getElevationTool();e.elevation=t||new n.Z.tool.Elevation}else e.elevation=new n.Z.tool.Elevation;else if(e.map){const t=await e.map.getElevationTool();e.elevation=t?new n.Z.tool.Elevation(n.Z.Util.extend(!0,{},t.options,e.options.displayElevation)):new n.Z.tool.Elevation(e.options.displayElevation)}else e.elevation=new n.Z.tool.Elevation(e.options.displayElevation);return e.elevation}}(),n.Z.Control.create=async function(e,t){const i=e.substr(0,1).toUpperCase()+e.substr(1);if(!n.Z.control[i]){const e=await r(8949)("./"+i);n.Z.control[i]=e.default}return new n.Z.control[i](null,t)};const c=n.Z.Control},4436:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});const n=function(e,t){const r=function(e){const r={type:e.type,target:this,currentTarget:this};return e.detail&&Object.keys(e.detail).forEach((function(t){t in r||(r[t]=e.detail[t])})),t.call(this,r)}.bind(this);return(this._listeners[e]=this._listeners[e]||new Map).set(t,r),r},i=function(e,t,r){const i=this;return e.split(" ").forEach((function(e){i.$events.addEventListener(e,n.call(i,e,t),r)})),i},o=function(){const e=this;e._listeners={},e.$events=document.createDocumentFragment();const t=["addEventListener","dispatchEvent","removeEventListener"];t.forEach((function(t){this[t]=e.$events[t].bind(e.$events)}),e);t.push("on"),t.push("one"),t.push("off"),t.push("trigger"),t.forEach((function(t){e.$events[t]=e[t].bind(e)}),e)},a=o.prototype;a.on=function(e,t){return i.call(this,e,t)},a.one=function(e,t){return i.call(this,e,t,{once:!0})},a.off=function(e,t){const r=this,n=e.split(" ");return t?n.forEach((function(e){const n=r._listeners[e];n&&n.has(t)&&r.$events.removeEventListener(e,n.get(t))})):n.forEach((function(e){const t=r._listeners[e];t&&(t.forEach((function(t){r.$events.removeEventListener(e,t)})),t.clear())})),r},a.trigger=function(e,t){var r;window.$&&$.Event&&e instanceof $.Event&&(t={},Object.keys(e).forEach((function(r){"type"!==r&&(t[r]=e[r])})),e=e.type),t&&(r={detail:t});const n=new CustomEvent(e,r);this.dispatchEvent(n)},o._onBySelectorMap=new WeakMap,o.listenerBySelector=function(e,t){return function(r){const n=this,i=r.type;var a=o._onBySelectorMap.get(n);a||(a={},o._onBySelectorMap.set(n,a));var s=a[i];if(s||(a[i]=s={}),s[e]||(s[e]=t),!r._listenerBySelectorCalled)for(var l,c=!1,u=r.target;u&&u!==n;){for(e in s)u.matches&&u.matches(e)&&(c=!0,l=s[e].call(n,r),r._listenerBySelectorCalled=!0);if(c)return l;u=u.parentNode}}};const s=o},1399:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var n=r(688);const i=function(e,t,r,n){return 8&r?[e[0]+(t[0]-e[0])*(n[3]-e[1])/(t[1]-e[1]),n[3]]:4&r?[e[0]+(t[0]-e[0])*(n[1]-e[1])/(t[1]-e[1]),n[1]]:2&r?[n[2],e[1]+(t[1]-e[1])*(n[2]-e[0])/(t[0]-e[0])]:1&r?[n[0],e[1]+(t[1]-e[1])*(n[0]-e[0])/(t[0]-e[0])]:null},o=function(e,t){let r=0;return e[0]<t[0]?r|=1:e[0]>t[2]&&(r|=2),e[1]<t[1]?r|=4:e[1]>t[3]&&(r|=8),r},a={isPoint:function(e){return Array.isArray(e)&&e.length>=2&&"number"==typeof e[0]&&"number"==typeof e[1]},isRing:function(e){return Array.isArray(e)&&(0===e.length||a.isPoint(e[0]))},isRingCollection:function(e){return Array.isArray(e)&&(0===e.length||a.isRing(e[0]))},isMultiRingCollection:function(e){return Array.isArray(e)&&(0===e.length||a.isRingCollection(e[0]))},getNearest:function(e,t){return n.Z.wrap.Geometry.getNearest(e,t)},isInside:function e(t,r){var n=!1;if(a.isPoint(t))if(a.isPoint(r))n=t[0]===r[0]&&t[1]===r[1];else if(a.isRing(r))for(var i=0,o=r.length-1;i<r.length;o=i++){var s=r[i][0],l=r[i][1],c=r[o][0],u=r[o][1];l>t[1]!=u>t[1]&&t[0]<(c-s)*(t[1]-l)/(u-l)+s&&(n=!n)}else if(a.isRingCollection(r)&&r.length>0){if(e(t,r[0])){var p=!1;for(i=1;i<r.length;i++)if(e(t,r[i])){p=!0;break}p||(n=!0)}}else if(a.isMultiRingCollection(r)&&r.length>0)for(i=0;i<r.length;i++)if(e(t,r[i])){n=!0;break}return n},equals:function(e,t){return Array.isArray(e)&&Array.isArray(t)?e.length===t.length&&e.every(((e,r)=>a.equals(e,t[r]))):!Array.isArray(e)&&!Array.isArray(t)&&e===t},getSquaredDistance:function(e,t){const r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n},getDistance:function(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])},getFlatCoordinates:function(e){const t=function(e,t){return e.concat(t)};switch(!0){case a.isPoint(e):return[e];case a.isRing(e):return e;case a.isRingCollection(e):return e.reduce(t);case a.isMultiRingCollection(e):return e.reduce(t).reduce(t);default:return[]}},iterateCoordinates:function*e(t){if(Array.isArray(t))if(a.isPoint(t))yield t;else for(var r=0,n=t.length;r<n;r++)yield*e(t[r])},intersects:function(e,t){const r=function(e,t){for(var r=0,n=e.length;r<n;r++)if(a.isInside(e[r],t))return!0;return!1};return!(!r(a.getFlatCoordinates(e),t)&&!r(a.getFlatCoordinates(t),e))},clipPolygon:function(e,t){return e.map((e=>a.clipRing(e,t))).filter((e=>e.length))},clipRing:function(e,t){let r,n,a,s,l;for(n=1;n<=8&&(r=[],a=e[e.length-1],s=!(o(a,t)&n),e.forEach((e=>{l=!(o(e,t)&n),l!==s&&r.push(i(a,e,n,t)),l&&r.push(e),a=e,s=l})),(e=r).length);n*=2);return r},clipPolyline:function(e,t){let r,n,a,s,l,c=e.length,u=o(e[0],t),p=[],h=[];for(r=1;r<c;r++){for(n=e[r-1],a=e[r],s=l=o(a,t);;){if(!(u|s)){p.push(n),s!==l?(p.push(a),r<c-1&&(h=h.concat(p),p=[])):r===c-1&&p.push(a);break}if(u&s)break;u?(n=i(n,a,u,t),u=o(n,t)):(a=i(n,a,s,t),s=o(a,t))}u=l}return p.length&&(h=h.concat(p)),h},interpolate:function(e,t){let r=e;if(!(1===r.length))if(t.resolution){const e=[];r.forEach((function(r,n,i){if(n){const s=i[n-1],l=a.getDistance(s,r);if(l>t.resolution){let n=l%t.resolution/2,i=Math.ceil(l/t.resolution);0===n&&(i-=1,n=t.resolution);const a=r[0]-s[0],c=(r[1]-s[1])/l,u=a/l;let p=s[0]+n*u,h=s[1]+n*c,d=t.resolution*u,f=t.resolution*c;for(var o=0;o<i;o++)e.push([p,h]),p+=d,h+=f}}e.push(r)})),r=e}else if(t.sampleNumber){const e=r.length;if(e>t.sampleNumber){const e=[];let i=0;r.forEach((function(t,r,o){r&&(i+=n.Z.Geometry.getDistance(o[r-1],t)),e.push({index:r,distance:i})}));const o=i/t.sampleNumber;let a=0;e.forEach((function(e,t,r){const n=e.distance-a;if(0===n)e.included=!0;else if(n>0){if(e.index){const i=r[t-1];a-i.distance<n?i.included=!0:e.included=!0}for(;e.distance>a;)a+=o}})),e.filter((e=>!e.included)).forEach((function(e){r[e.index]=null})),r=r.filter((e=>null!==e))}else if(e<t.sampleNumber){const a=function(e,t,r){const n=e[t-1],i=e[t],o=r+1;let a=n[0],s=n[1];const l=(i[0]-a)/o,c=(i[1]-s)/o,u=new Array(r+2);u[0]=t,u[1]=0;for(var p=2,h=u.length;p<h;p++)a+=l,s+=c,u[p]=[a,s];e.splice.apply(e,u)};let s=0;const l=r.map((function(e,t,r){let i=0;return t&&(i=n.Z.Geometry.getDistance(r[t-1],e),s+=i),{index:t,distance:i}}));r=r.slice();const c=t.sampleNumber-e;let u=c,p=0;for(var i=0,o=l.length;u&&i<o;i++){const e=l[i];if(0!==e.distance){const t=Math.min(Math.round(c*e.distance/s),u)||1;u-=t,a(r,e.index+p,t),p+=t}}}}return r}},s=a},4571:(e,t,r)=>{"use strict";r.d(t,{Z:()=>L});var n=r(1466),i=r.n(n),o=r(688),a=r(330),s=r(9967),l=r(268),c=r(4436),u=r(3089),p=r(52),h=r(4115),d=r(8197),f=r(8834),g=(r(9753),r(7687),r(3041),r(5669),r(3678),r(9524),r(6188),r(8002),r(658),r(1235),r(4975),r(4916),r(2212),r(2429),r(3697),r(2863),r(4094),r(1497),r(8127),r(7622),r(707),r(5573),r(1885),r(7167),r(4743),r(4997),r(6460),r(9186),r(9886),r(9945),r(8239),r(3784),r(3965),r(895),r(5516),r(1391),r(4234),r(2855),r(6994),r(6436),r(9889),r(5590),r(674),r(4283),r(7292),r(8644),r(8792),r(9510),r(6161),r(9085),r(333),r(2749),r(3510),r(5515),r(3640),r(7885),r(2006),r(5122),r(6564),r(849),r(2641)),y=r(3048),m=r(8033),v=r(6382),_=r(1848),w=r(8683),S=r(1872),E=r(9529),b=r(5265);const C=new Blob([String.raw`/*
 Copyright (c) 2013, Rodrigo Gonzlez, Sapienlab All Rights Reserved.
 Available via MIT LICENSE. See https://github.com/rgcl/jsonpack/blob/master/LICENSE.md for details.
 */
(function (n) { n([], function () { var f = -1, e = -2, i = -3, n = -4, r = -5, h = function (s, h) { var l, c, a; h = h || {}; l = h.verbose || !1; l && console.log("Normalize the JSON Object"); s = typeof s == "string" ? this.JSON.parse(s) : s; l && console.log("Creating a empty dictionary"); c = { strings: [], integers: [], floats: [] }; l && console.log("Creating the AST"); var y = function v(s) { var y, w, a, p, h; if (l && console.log("Calling recursiveAstBuilder with " + this.JSON.stringify(s)), y = typeof s, s === null) return { type: "null", index: i }; if (typeof s == "undefined") return { type: "undefined", index: r }; if (s instanceof Array) { a = ["@"]; for (w in s) s.hasOwnProperty(w) && a.push(v(s[w])); return a } if (y === "object") { a = ["$"]; for (p in s) s.hasOwnProperty(p) && (a.push(v(p)), a.push(v(s[p]))); return a } if (s === "") return { type: "empty", index: n }; if (y === "string") return h = u.call(c.strings, s), h == -1 && (c.strings.push(o(s)), h = c.strings.length - 1), { type: "strings", index: h }; if (y === "number" && s % 1 == 0) return h = u.call(c.integers, s), h == -1 && (c.integers.push(t(s)), h = c.integers.length - 1), { type: "integers", index: h }; if (y === "number") return h = u.call(c.floats, s), h == -1 && (c.floats.push(s), h = c.floats.length - 1), { type: "floats", index: h }; if (y === "boolean") return { type: "boolean", index: s ? f : e }; throw new Error("Unexpected argument of type " + typeof s); }(s), p = c.strings.length, w = c.integers.length, k = c.floats.length; return (l && console.log("Parsing the dictionary"), a = c.strings.join("|"), a += "^" + c.integers.join("|"), a += "^" + c.floats.join("|"), l && console.log("Parsing the structure"), a += "^" + function b(u) { var e, s, f, o; if (l && console.log("Calling a recursiveParser with " + this.JSON.stringify(u)), u instanceof Array) { e = u.shift(); for (s in u) u.hasOwnProperty(s) && (e += b(u[s]) + "|"); return (e[e.length - 1] === "|" ? e.slice(0, -1) : e) + "]" } if (f = u.type, o = u.index, f === "strings") return t(o); if (f === "integers") return t(p + o); if (f === "floats") return t(p + w + o); if (f === "boolean") return u.index; if (f === "null") return i; if (f === "undefined") return r; if (f === "empty") return n; throw new TypeError("The item is alien!"); }(y), l && console.log("Ending parser"), h.debug) ? { dictionary: c, ast: y, packed: a } : a }, c = function (t, u) { var p, v, o, w, h, a, k, c; if (u = u || {}, p = t.split("^"), u.verbose && console.log("Building dictionary"), v = [], o = p[0], o !== "") for (o = o.split("|"), u.verbose && console.log("Parse the strings dictionary"), h = 0, w = o.length; h < w; h++) v.push(l(o[h])); if (o = p[1], o !== "") for (o = o.split("|"), u.verbose && console.log("Parse the integers dictionary"), h = 0, w = o.length; h < w; h++) v.push(s(o[h])); if (o = p[2], o !== "") for (o = o.split("|"), u.verbose && console.log("Parse the floats dictionary"), h = 0, w = o.length; h < w; h++) v.push(parseFloat(o[h])); o = null; u.verbose && console.log("Tokenizing the structure"); var b = "", y = [], g = p[3].length; for (h = 0; h < g; h++) a = p[3].charAt(h), a === "|" || a === "$" || a === "@" || a === "]" ? (b && (y.push(s(b)), b = ""), a !== "|" && y.push(a)) : b += a; return k = y.length, c = 0, u.verbose && console.log("Starting recursive parser"), function d() { var h = y[c++], t, s, o; if (u.verbose && console.log("Reading collection type " + (h === "$" ? "object" : "Array")), h === "@") { for (t = []; c < k; c++) { if (o = y[c], u.verbose && console.log("Read " + o + " symbol"), o === "]") return t; if (o === "@" || o === "$") t.push(d()); else switch (o) { case f: t.push(!0); break; case e: t.push(!1); break; case i: t.push(null); break; case r: t.push(undefined); break; case n: t.push(""); break; default: t.push(v[o]) } } return u.verbose && console.log("Parsed " + this.JSON.stringify(t)), t } if (h === "$") { for (t = {}; c < k; c++) { if (s = y[c], s === "]") return t; if (s = s === n ? "" : v[s], o = y[++c], o === "@" || o === "$") t[s] = d(); else switch (o) { case f: t[s] = !0; break; case e: t[s] = !1; break; case i: t[s] = null; break; case r: t[s] = undefined; break; case n: t[s] = ""; break; default: t[s] = v[o] } } return u.verbose && console.log("Parsed " + this.JSON.stringify(t)), t } throw new TypeError("Bad token " + h + " isn't a type"); }() }, a = function (s, h) { var c = typeof h, l; if (c === "boolean") return h ? f : e; if (h === null) return i; if (typeof h == "undefined") return r; if (h === "") return n; if (c === "string" && (h = o(h), l = u.call(s.strings, h), l === -1 && (s.strings.push(h), l = s.strings.length - 1)), c !== "string" && c !== "number") throw new Error("The type is not a JSON type"); return c === "string" ? h = o(h) : h % 1 == 0 && (h = t(h)), h = c === "number" ? t(h) : o(h), l = u.call(s[c], h), l === -1 && (s[c].push(h), l = s[c].length - 1), c === "number" ? "+" + l : l }, o = function (n) { return typeof n != "string" ? n : n.replace(/[\+ \|\^\%]/g, function (n) { return { " ": "+", "+": "%2B", "|": "%7C", "^": "%5E", "%": "%25" }[n] }) }, l = function (n) { return typeof n != "string" ? n : n.replace(/\+|%2B|%7C|%5E|%25/g, function (n) { return { "+": " ", "%2B": "+", "%7C": "|", "%5E": "^", "%25": "%" }[n] }) }, t = function (n) { return Number.prototype.toString.call(n, 36).toUpperCase() }, s = function (n) { return parseInt(n, 36) }, u = Array.prototype.indexOf || function (n, t) { for (var i = t || 0, r = this.length; i < r; i++) if (this[i] === n) return i; return -1 }; return { JSON: JSON, pack: h, unpack: c } }) })(typeof define == "undefined" || !define.amd ? function (n, t) { var i = t(), r; if (typeof exports != "undefined") for (r in i) exports[r] = i[r]; else self.jsonpack = i } : define);

onmessage = function (e) {
    if (e.data.action) {
        try {
            const result = jsonpack[e.data.action](e.data.object);
            postMessage({
                id: e.data.id,
                action: e.data.action,
                result: result
            });
        }
        catch (error) {
            postMessage({
                id: e.data.id,
                action: e.data.action,
                error: error.toString()
            });
        }
    }
};
`],{type:"text/javascript; charset=utf-8"});o.Z.EventTarget=c.Z,o.Z.i18n=o.Z.i18n||u.Z,o.Z.wrap=f.Z,o.Z.control=o.Z.control||{},o.Z.inherit=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e._super=t.prototype},o.Z.mix=function(e,...t){Object.assign(e.prototype,...t)},function(){(this||{}).CustomEvent="function"==typeof CustomEvent?CustomEvent:function(e){return t[e]=new t("").constructor[e],t;function t(e,t){t||(t={});var r=document.createEvent("CustomEvent");return r.initCustomEvent(e,!!t.bubbles,!!t.cancelable,t.detail),r}}("prototype"),Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector);var e=null,t=null;let n=0,c=0;const u=function(){const e=this;var t=[a.Z.event.LAYERADD,a.Z.event.LAYERORDER,a.Z.event.LAYERREMOVE,a.Z.event.LAYERVISIBILITY,a.Z.event.ZOOM,a.Z.event.BASELAYERCHANGE,a.Z.event.UPDATEPARAMS].join(" ");let r=[a.Z.event.LAYERUPDATE,a.Z.event.FEATUREADD,a.Z.event.FEATUREREMOVE,a.Z.event.FEATUREMODIFY,a.Z.event.FEATURESADD,a.Z.event.FEATURESCLEAR,a.Z.event.UPDATEPARAMS].join(" ");e.on(r,(()=>e.trigger(a.Z.event.MAPCHANGE))),e.replaceCurrent=!0,x.call(e);const n=x.bind(e);var i;e.on(t,n),e.on(a.Z.event.LAYEROPACITY,(function(t){clearTimeout(i),i=setTimeout((function(){x.call(e,t)}),500)})),window.addEventListener("popstate",(function(r){var i;i=e.loadingCtrl&&e.loadingCtrl.addWait(),setTimeout((async function(){if(r){e.off(t,n);var o=r.state;"[object Object]"===Object.prototype.toString.call(o)&&(o=await e.checkLocation()),O.call(e,o).then((function(){setTimeout((function(){e.on(t,n)}),200),e.loadingCtrl&&e.loadingCtrl.removeWait(i)}))}}),4)}))},f={},L=function(e,t){return new Promise((function(r,n){const i=function(){const e=URL.createObjectURL(C),t=new Worker(e);return t.onmessage=function(e){const r=f[e.data.id];r&&(e.data.error?r.reject(e.data.error):r.resolve(e.data.result),t.terminate(),delete f[e.data.id])},t}(),a=o.Z.getUID();f[a]={resolve:r,reject:n},i.postMessage({id:a,action:e,object:t})}))},T=o.Z.Util.isFunction(DataTransferItem.prototype.getAsFileSystemHandle),A=function(e){return e.type===a.Z.layerType.WMS||T&&e.type===a.Z.layerType.VECTOR&&e.options.file},x=async function(r){const n=this;var{state:i,index:s}=await P.call(n);if(n.replaceCurrent)return window.history.replaceState(i,null,null),void delete n.replaceCurrent;var l=function(){t=e,(e=o.Z.Util.utf8ToBase64(i))!==t&&s>c&&(c=s,window.history.pushState(i,null,window.location.href.split("#").shift()+"#"+e))};if(r){switch(n.lastEventType=r.type,!0){case r.type===a.Z.event.BASELAYERCHANGE:case r.type===a.Z.event.LAYERORDER:case r.type===a.Z.event.ZOOM:l();break;case r.type===a.Z.event.UPDATEPARAMS:r.layer.type===a.Z.layerType.WMS&&l();break;case r.type.toLowerCase().indexOf("LAYER".toLowerCase())>-1:A(r.layer)&&l()}n.trigger(a.Z.event.MAPCHANGE)}},P=async function(e){const t=this;e=e||{};var r={};let i=n++;t.crs!==t.options.crs&&(r.crs=t.crs);for(var s=t.getExtent(),l=0;l<s.length;l++)Math.abs(s[l])>180&&(s[l]=Math.floor(1e3*s[l])/1e3);r.ext=s;var c=[];if(t.baseLayers&&(c=t.baseLayers.filter((function(e){return e.isRaster()&&e.fallbackLayer})).map((function(e){return{baseLayer:e,fallbackLayerID:e.fallbackLayer.id}})).filter((function(e){return e.fallbackLayerID===(t.baseLayer?t.baseLayer.id:t.baseLayers[0].id)}))),c.length>0?r.base=c[0].baseLayer.id:(t.baseLayer||t.baseLayers&&t.baseLayers[0])&&(r.base=(t.baseLayer||t.baseLayers[0]).id),r.layers=[],t.workLayers.forEach((function(e){if(e.type!==a.Z.layerType.WMS||e.options.stateless){if(T&&e.type===a.Z.layerType.VECTOR&&e.options.file){const t={o:e.getOpacity(),v:e.getVisibility(),h:e.options.hideTitle,ur:e.unremovable,fn:e.options.file,t:e.title,i:e.id};r.layers.push(t)}}else if(e.layerNames=e.names||e.layerNames,e.layerNames&&e.layerNames.length||!1===e.hideTree){const t={u:o.Z.Util.isOnCapabilities(e.url),n:Array.isArray(e.names)?e.names.join(","):e.names,o:e.getOpacity(),v:e.getVisibility(),h:e.options.hideTitle,ur:e.unremovable,f:e.filter&&(e.filter instanceof o.Z.filter.Filter?e.filter.getText():e.filter),t:e.title,i:e.id};!1===e.hideTree&&(t.x=0);const n=Array.isArray(e.availableNames)?e.availableNames.join(","):e.availableNames;t.n!==n&&(t.a=n),r.layers.push(t)}})),t.on3DView&&t.view3D.cameraControls&&(r.vw3=t.view3D.cameraControls.getCameraState()),e.extraStates&&o.Z.Util.extend(r,e.extraStates),!e.cacheResult&&t._controlStatesCache&&delete t._controlStatesCache,t._controlStatesCache)return{state:t._controlStatesCache,index:i};const u=await L("pack",r);return e.cacheResult&&(t._controlStatesCache=u),{state:u,index:i}},O=function(e){const t=this,r=[];return e?(t.loadingctrl||(t.loadingCtrl=t.getControlsByClass("TC.control.LoadingIndicator")[0]),t.hasWait||(t.hasWait=t.loadingCtrl&&t.loadingCtrl.addWait()),new Promise((function(n,i){var s=function(){t.loadingCtrl&&t.loadingCtrl.removeWait(t.hasWait),delete t.hasWait,n()};let l;l="string"==typeof e?new Promise((function(r,n){L("unpack",e).then((e=>r(e))).catch((t=>r(JSON.parse(e)))).catch((e=>{o.Z.error(o.Z.Util.getLocaleString(t.options.locale,"mapStateNotValid")),n(e)}))})):Promise.resolve(e),l.then((function(e){if(e.crs&&e.crs!==t.crs||void 0===e.crs&&t.crs!==t.options.crs)r.push(t.setProjection({crs:e.crs||t.options.crs,oldCrs:t.crs,extent:e.ext,baseLayer:t.getLayer(e.base)}));else{if(e.base!=t.getBaseLayer().id){t.getLayer(e.base)&&t.setBaseLayer(e.base);const n=t.baseLayers.filter((function(t){return t.options.fallbackLayer===e.base}))[0];if(n){const e=t.addLayer(n.getFallbackLayer());r.push(e),e.then((function(e){t.setBaseLayer(e)}))}}e.ext&&r.push(t.setExtent(e.ext,{animate:!1}))}if(e.layers=e.layers||e.capas||[],e.layers.length>0)for(var n=0;n<e.layers.length;n++){var i=e.layers[n],l=!1;let s;for(var c=0;c<t.options.workLayers.length;c++)s=o.Z.Util.extend({},t.options.workLayers[c],{map:t}),i.u===s.url&&i.i===s.id&&(l=!0,s.renderOptions={opacity:i.o,hide:!i.v},s.unremovable=i.ur,s.title=i.t,s.hideTree=!Object.prototype.hasOwnProperty.call(i,"x")||!!i.x,i.n&&(s.layerNames=i.n),i.a&&(s.availableNames=i.a),r.push(t.addOrUpdateLayer(s).then(function(e){e.setVisibility(this.v),e.setOpacity(this.o,!0)}.bind(i))));if(!l){const e={id:i.i||o.Z.getUID(),hideTitle:i.h,unremovable:i.ur,title:i.t,hideTree:!Object.prototype.hasOwnProperty.call(i,"x")||!!i.x,renderOptions:{opacity:i.o,hide:!i.v}};i.fn?(e.type=a.Z.layerType.VECTOR,e.file=i.fn):(e.url=o.Z.Util.isOnCapabilities(i.u,i.u.indexOf(window.location.protocol)<0)||i.u,e.layerNames=i.n?i.n.split(","):[]),r.push(t.addOrUpdateLayer(e).then(function(e){var t=e.wrap.getRootLayerNode();e.title=t.Title||t.title,e.setOpacity(this.o,!0),e.setVisibility(this.v)}.bind(i)))}}t.workLayers.filter((t=>A(t)&&!e.layers.some((e=>e.i===t.id)))).forEach((e=>t.removeLayer(e))),Promise.all(r).then((function(){s()})).catch((function(){s()}))})).catch((function(){s()}))}))):Promise.resolve()},I=function(e,t){return function(r,n,i){return n[e]===t?i:r}},R=function(e){return(this instanceof o.Z.Map?this.options.availableBaseLayers:o.Z.Cfg.availableBaseLayers).filter((function(t){return t.id===e}))[0]};o.Z.Map=o.Z.Map||function(e,n){const i=this;o.Z.EventTarget.call(i),o.Z.Map._instances.push(i),i.isReady=!1,i.isLoaded=!1,i.controls=[],i.activeControl=null,i.layers=[],i.baseLayers=[],i.workLayers=[],i.baseLayer=null,i.vectors=null;var l=0;if(i.div=o.Z.Util.getDiv(e),i.RECENT_FILES_STORE_KEY_PREFIX="TC.fileImportRecent.",i.recentFiles=[],i.recentFileCount=8,i.div.classList.add(a.Z.classes.LOADING,a.Z.classes.MAP),i._markerPromises=[],i._layerBuffer={layers:[],contains:function(e){return this.layers.some((function(t){return t.id===e}))},getIndex:function(e){return this.layers.reduce(I("id",e),-1)},add:function(e,t,r){const n={id:e,pending:!0,zIndex:t,isBase:r};this.layers.splice(this.getIndexForZIndex(t),0,n)},remove:function(e){this.layers.splice(this.getIndex(e),1)},getMapLayers:function(){return this.layers.filter((e=>!1===e.pending)).filter((e=>!e.rejected)).map((e=>e.mapLayer))},resolve:function(e,t,r){const n=this.layers[this.getIndex(t.id)];if(n.mapLayer=t,n.pending=!1,e.layers=this.getMapLayers(),r){0===e.baseLayers.length&&(e.baseLayers=new Array(e.options.baseLayers.length));var i=e.options.baseLayers.map((e=>e.id)).indexOf(t.id);i<0?(i=e.baseLayers.map((e=>e.type)).indexOf(a.Z.layerType.VECTOR))<0?e.baseLayers.push(t):e.baseLayers.splice(i,0,t):e.baseLayers.splice(i,1,t)}else e.workLayers=e.layers.filter((function(e){return!e.isBase}))},reject:function(e,t){const r=this.layers[this.getIndex(t.layerId)];r.mapLayer=null,r.pending=!1,r.rejected=!0;var n=e.options.baseLayers.map((e=>e.id)).indexOf(t.layerId);n>=0&&e.baseLayers.splice(n,1)},getResolvedWorkLayerIndex:function(e,t){return this.layers.filter((function(e){return e.id===t||!e.isBase&&!1===e.pending})).reduce(I("id",t),-1)},getResolvedVisibleLayerIndex:function(e,t){var r=this.getResolvedWorkLayerIndex(e,t);return e.baseLayer&&(r+=1),r},getIndexForZIndex:function(e){return this.layers.reduce(function(e){return function(t,r,n){return r.zIndex<=e?n:t}}(e),-1)+1},checkMapLoad:function(e){const t=this;if(e.options.baseLayers.concat(e.options.workLayers).every((function(e){return t.contains(e.id||e)}))&&!this.layers.some((function(e){return!0===e.pending}))){const t=async function(){if(!e.isLoaded){const t=function(){e.options.stateful&&u.call(e),e.isLoaded=!0,e.ready((()=>e.div.classList.remove(a.Z.classes.LOADING))),e.trigger(a.Z.event.MAPLOAD)};if(e.state&&e.state.vw3){if(!e.div.classList.contains(a.Z.classes.THREED)){if(e.div.classList.add(a.Z.classes.THREED),!o.Z.view||!o.Z.view.ThreeD){const e=await Promise.resolve().then(r.bind(r,4859));o.Z.view=o.Z.view||{},o.Z.view.ThreeD=e.default}o.Z.view.ThreeD.apply({map:e,state:e.state.vw3,callback:function(){t(),e.getControlsByClass(o.Z.control.ThreeD)[0].button.removeAttribute("disabled")}})}}else t()}};if(e.baseLayer)t();else{var n=[];if(e.state&&e.state.base&&(n=o.Z.Cfg.availableBaseLayers.filter((t=>t.id===e.state.base))),n.length>0)n[0].isBase=!0,e.addLayer(n[0]).then((function(e){t()}));else{const r=e.baseLayers.filter((function(e){return!e.mustReproject})).filter((function(e){return e.wrap&&e.wrap.layer}));r.length>0&&(e.wrap.setBaseLayer(r[0].wrap.layer),e.baseLayer=r[0]),t()}}}}},i._layerBuffer.layers=[],i._fileHandles=new WeakMap,o.Z.ready||(o.Z.Cfg=o.Z.Util.extend({},o.Z.Defaults,s.Z),o.Z.ready=!0),n&&n.controls&&n.controls.search&&n.controls.search.allowedSearchTypes)for(var c in o.Z.Cfg.controls.search.allowedSearchTypes)Object.prototype.hasOwnProperty.call(n.controls.search.allowedSearchTypes,c)||(n.controls.search.allowedSearchTypes[c]=!1);n=n||{},Z.call(i,n),i.id=n.id||o.Z.getUID({prefix:"map-"}),i.crossOrigin=i.options.crossOrigin;var p=async function(){if(i.state=await i.checkLocation(),i.options.layout&&i.trigger(a.Z.event.LAYOUTLOAD,{map:i}),n&&void 0!==n.workLayers&&(i.options.workLayers=n.workLayers),n&&void 0!==n.baseLayers&&(i.options.baseLayers=n.baseLayers),i.options.zoomToFeatures){i.on(a.Z.event.FEATURESADD,(function e(t){clearTimeout(i._zoomToFeaturesTimeout),i._zoomToFeaturesTimeout=setTimeout((function(){i.zoomToFeatures(t.layer.features,{animate:!1}),i.off(a.Z.event.FEATURESADD,e)}),100)}))}i.on(a.Z.event.LAYERADD,(function e(t){t.layer.isBase&&(t.layer===i.baseLayer||i.baseLayer&&t.layer.fallbackLayer&&t.layer.fallbackLayer.id===i.baseLayer.id)&&(void 0!==i.state&&(i.state.crs?i.loaded((function(){i.setProjection({crs:i.state.crs,extent:i.state.ext})})):i.setExtent(i.state.ext,{animate:!1})),i.off(a.Z.event.LAYERADD,e))})),i.crs=i.options.crs,i.initialExtent=i.options.initialExtent,i.maxExtent=i.options.maxExtent,i.defaultInfoContainer=i.defaultInfoContainer||i.options.defaultInfoContainer,!i.defaultInfoContainer&&window.matchMedia("screen and (max-width: 40em), screen and (max-height: 40em)").matches&&(i.defaultInfoContainer=a.Z.infoContainer.RESULTS_PANEL),i.wrap=new o.Z.wrap.Map(i),o.Z.loadProjDef({crs:i.options.crs,callback:function(){i.wrap.setMap();const e=[];for(var t in i.options.controls){var r=i.options.controls[t];r&&("string"==typeof(r="boolean"==typeof r?{}:o.Z.Util.extend(!0,{},r)).div&&(r.div=i.div.querySelector("#"+r.div)||r.div),e.push(i.addControl(t,r)))}var n,s;for(i.on(a.Z.event.BEFORELAYERUPDATE,h),i.on(a.Z.event.LAYERUPDATE,d),i.on(a.Z.event.LAYERERROR,d),n=0;n<i.options.baseLayers.length;n++)"string"==typeof(s=i.options.baseLayers[n])&&(s=R.call(i,s)),i.addLayer(o.Z.Util.extend({},s,{isBase:!0,map:i}));(i.state&&i.state.layers?i.state.layers.map((function(e){const t={id:e.i||o.Z.getUID(),hideTitle:e.h,unremovable:e.ur,title:e.t,filter:e.f,hideTree:0!==e.x,renderOptions:{opacity:e.o,hide:!e.v}};return e.u?(t.url=o.Z.Util.isOnCapabilities(e.u,e.u.indexOf(window.location.protocol)<0)||e.u,t.layerNames=e.a||e.n?(e.a||e.n).split(","):void 0):(t.type=a.Z.layerType.VECTOR,t.file=e.fn),t})):[]).concat(i.options.workLayers.filter((function(e){return!i.state||!i.state.layers||!i.state.layers.some((t=>e.url===t.u&&e.id===t.i))})).map((function(e){return o.Z.Util.extend({},e,{map:i})}))).forEach((e=>{i.addLayer(e).then(function(t){if(t.wrap.getRootLayerNode)var r=t.wrap.getRootLayerNode();t.title=e.title||r&&(r.Title||r.title),e.renderOptions&&e.renderOptions.opacity<1&&t.setOpacity(e.renderOptions.opacity),e.renderOptions&&e.renderOptions.hide&&t.setVisibility(!e.renderOptions.hide);const n=(i.state&&i.state.layers||[]).find((t=>t.u===e.url&&t.i===e.id));n&&n.n&&n.a&&n.n!==n.a&&t.setLayerNames(n.n)}.bind()).catch((function(e){i.toast(e.message,{type:a.Z.msgType.ERROR})}))})),Promise.all(e).finally((function(){i.state&&i.state.ctl&&i.importControlStates(i.state.ctl),i.isReady=!0,i.trigger(a.Z.event.MAPREADY)})),W(i.div)}}),i.on(a.Z.event.FEATURECLICK,(function(e){i.activeControl&&i.activeControl.isExclusive()||e.feature.showInfo()})),i.on(a.Z.event.NOFEATURECLICK,(function(e){e.layer._noFeatureClicked=!0;for(var t=!0,r=0,n=i.workLayers.length;r<n;r++)if(!i.workLayers[r]._noFeatureClicked){t=!1;break}t&&(i.workLayers.forEach((function(e){delete e._noFeatureClicked})),i.getControlsByClass(o.Z.control.Popup).forEach((function(e){e.isVisible()&&e.hide()})))}))};k.getMapState=async function(e){var t=await P.call(this,e);return o.Z.Util.utf8ToBase64(t.state)},k.getPreviousMapState=function(){return t},k.checkLocation=async function(){const e=this;var t=window.location.hash;if(t&&t.length>1){var r;t=t.substr(1);try{r=await L("unpack",o.Z.Util.base64ToUtf8(t))}catch(n){try{r=JSON.parse(o.Z.Util.base64ToUtf8(t))}catch(t){return void o.Z.error(o.Z.Util.getLocaleString(e.options.locale,"mapStateNotValid"),a.Z.msgErrorMode.TOAST)}}if(o.Z.Util.detectIE()&&2047===window.location.href.length&&o.Z.error(o.Z.Util.getLocaleString(e.options.locale,"mapStateNotValidForEdge"),a.Z.msgErrorMode.TOAST),r){var n=!1;if(Object.prototype.hasOwnProperty.call(r,"ext")||(n=!0,r.ext=e.options.initialExtent),Object.prototype.hasOwnProperty.call(r,"base")||(n=!0,r.base=e.options.defaultBaseLayer),Object.prototype.hasOwnProperty.call(r,"layers"))for(var i=r.layers.length-1;i>=0;i--){const e=r.layers[i];e&&(Object.prototype.hasOwnProperty.call(e,"u")&&Object.prototype.hasOwnProperty.call(e,"n")||Object.prototype.hasOwnProperty.call(e,"fn"))?Object.prototype.hasOwnProperty.call(e,"o")&&Object.prototype.hasOwnProperty.call(e,"v")&&Object.prototype.hasOwnProperty.call(e,"h")||(n=!0,o.Z.Util.extend(e,{o:e.o||1,v:e.v||!0,h:e.h||!1})):(n=!0,r.layers.length=r.layers.length-1)}else n=!0,r.layers=[];return Object.prototype.hasOwnProperty.call(r,"vw3")&&(r.vw3&&r.vw3.cp&&3===r.vw3.cp.length&&r.vw3.chpr&&3===r.vw3.chpr.length&&r.vw3.bcpd||(n=!0)),n&&o.Z.error(o.Z.Util.getLocaleString(e.options.locale,"mapStateNotValid"),a.Z.msgErrorMode.TOAST),r}o.Z.error(o.Z.Util.getLocaleString(e.options.locale,"mapStateNotValid"),a.Z.msgErrorMode.TOAST)}};var h=function(e){l<=0&&(l=0,i.trigger(a.Z.event.BEFOREUPDATE)),l+=1},d=function(e){(l-=1)<=0&&(l=0,i.trigger(a.Z.event.UPDATE))};const f=i.options.locale;o.Z.i18n.loadResources(!o.Z.i18n[f],o.Z.apiLocation+"resources/",f).finally((function(){if(0===i.div.getBoundingClientRect().height&&(document.querySelectorAll("html,body").forEach((e=>e.classList.add(a.Z.classes.FULL_SCREEN))),i.div.classList.add(a.Z.classes.FULL_SCREEN)),i.options.layout){var e=i.options.layout;i.trigger(a.Z.event.BEFORELAYOUTLOAD,{map:i});var t={},r=!1;if("string"==typeof e){var s=e.trim();s+=s.match(/\/$/)?"":"/",t.config=s+"config.json",t.markup=s+"markup.html",t.style=s+"style.css",t.script=s+"script.js",t.i18n=s+"resources",r=!0}else(Object.prototype.hasOwnProperty.call(e,"config")||Object.prototype.hasOwnProperty.call(e,"markup")||Object.prototype.hasOwnProperty.call(e,"style")||Object.prototype.hasOwnProperty.call(e,"script")||Object.prototype.hasOwnProperty.call(e,"href")||Object.prototype.hasOwnProperty.call(e,"i18n"))&&(t=o.Z.Util.extend({},e));t.i18n&&(t.i18n+=t.i18n.match(/\/$/)?"":"/"),i.layout=t;const l=[],c=function(e,t){this.status=e,this.url=t},u=function(e){if(!r||404!=e.status){const t=o.Z.Map.get(document.querySelector("."+a.Z.classes.MAP));o.Z.error(o.Z.Util.getLocaleString(t.options.locale,"urlFailedToLoad",{url:e.url}),[a.Z.msgErrorMode.TOAST,a.Z.msgErrorMode.EMAIL],"Error al cargar "+e.url)}},h=new Promise((function(e,r){t.config?l.push(fetch(t.config).then((function(e){if(!e.ok)throw new c(e.status,t.config);return e.json()})).then((function(t){e(t.i18n),Z.call(i,t,n)})).catch((function(t){t.status&&u(t),e(!1)}))):e(!1)}));l.push(h),t.style&&l.push(new Promise((function(e,r){i.div.classList.add("tc-lo"),fetch(t.style,{method:"GET"}).then((function(e){if(!e.ok)throw new c(e.status,t.style);return e})).then((function(){var r=document.createElement("link");r.rel="stylesheet",r.href=t.style,document.head.appendChild(r),e()})).catch((function(t){t.status&&u(t),e()}))}))),t.markup&&l.push(new Promise((function(e,r){fetch(t.markup).then((function(e){if(!e.ok)throw new c(e.status,t.markup);return e.text()})).then((function(r){h.then((function(n){n&&f&&t.i18n?o.Z.i18n.loadResources(!0,t.i18n,f).finally((function(){r=r.replace(/\{\{i18n "([^\}\{]+)"\}\}|\{\{([^\}\{]+)\}\}|\{@i18n \$key="([^\}\{]+)"\/\}/g,(function(e,t,r,n){return o.Z.Util.getLocaleString(f,t||r||n)})),i.div.insertAdjacentHTML("beforeend",r),e()})):(i.div.insertAdjacentHTML("beforeend",r),e())}))})).catch((function(t){t.status&&u(t),e()}))}))),Promise.all(l).finally((function(){t.script?fetch(t.script).then((function(e){if(!e.ok)throw new c(e.status,t.script);return e.blob()})).then((function(e){var t=URL.createObjectURL(e),r=document.createElement("script");r.src=t,r.onload=function(){W(i.div),p()},document.head.appendChild(r)})).catch((function(e){e.status&&u(e),p()})):p()}))}else p()})),i.on(a.Z.event.UPDATEPARAMS,(function(e){M(e.layer)})),i.on(a.Z.event.ZOOM,(function(){for(var e=0;e<i.workLayers.length;e++)M(i.workLayers[e])}));var y=o.Z.error;o.Z.error=function(e,t,r){if(o.Z.isDebug&&console.trace&&console.trace(),t){var n=function(e,t,r){switch(t){case a.Z.msgErrorMode.TOAST:if(!i.toast)return void console.warn("No existe el objeto Toast");i.toast(e,{type:a.Z.msgType.ERROR,duration:2*o.Z.Cfg.toastDuration});break;case a.Z.msgErrorMode.EMAIL:o.Z.Cfg.loggingErrorsEnabled&&(0,g.JL)("onerrorLogger").fatalException(r?{msg:r,errorMsg:e}:e,null);break;case a.Z.msgErrorMode.CONSOLE:default:console.error(e)}};if(Array.isArray(t))for(var s=0;s<t.length;s++)n(e,t[s],r);else n(e,t,r)}else y(e),i.toast(e,{type:a.Z.msgType.ERROR,duration:2*o.Z.Cfg.toastDuration})}},o.Z.Map._instances=[],o.Z.Map.get=function(e){for(var t=0,r=o.Z.Map._instances.length;t<r;t++){const r=o.Z.Map._instances[t];if(r.div===e)return r}},o.Z.inherit(o.Z.Map,o.Z.EventTarget);var M=function(e){e.type===a.Z.layerType.WMS&&(e.tree=null)},D=function(e,t){const r=this;var n=Array.prototype.slice.call(e).map((function(e){var r={};return e&&(r[t]=e[t]),r}));"availableBaseLayers"===t&&console.log("layerOptions",n);var i={};if(i[t]=o.Z.Cfg[t],n.unshift(i),"baseLayers"===t&&n[1].baseLayers){i=n[1];for(var a=0;a<i.baseLayers.length;a++)"object"==typeof i.baseLayers[a]&&o.Z.Util.extend(i.baseLayers[a],R.call(r,i.baseLayers[a].id))}else n.unshift(!0),i=o.Z.Util.extend.apply(this,n),"availableBaseLayers"===t&&console.log("layerOption",i);return i[t]};const N=function(e){return e.controlContainer&&(Array.isArray(e.controlContainer.controls)?e.controlContainer.controls.forEach((t=>{Object.keys(t).filter((e=>"position"!==e)).forEach((r=>{void 0!==e[r]&&("boolean"==typeof t[r]&&(t[r]={}),o.Z.Util.extend(t[r],e[r]),delete e[r])}))})):Object.keys(e).filter((function(t){return Object.keys(e.controlContainer.controls).indexOf(t)>-1})).forEach((function(t){const r=e.controlContainer.controls[t];"boolean"==typeof r.options&&(r.options={}),o.Z.Util.extend(r.options,e[t]),delete e[t]}))),e},Z=function(){const e=[!0,{},o.Z.Cfg].concat(Array.prototype.slice.call(arguments)),t=this.options=o.Z.Util.extend.apply(this,e);t.availableBaseLayers=o.Z.Cfg.availableBaseLayers.concat.apply(o.Z.Cfg.availableBaseLayers,Array.prototype.map.call(arguments,(function(e){return e.availableBaseLayers||[]}))),t.baseLayers=D.call(this,arguments,"baseLayers"),t.workLayers=D.call(this,arguments,"workLayers");const r=Array.prototype.slice.call(arguments).filter((e=>e.controls)).map((e=>e.controls));return r.length>0&&(t.controls=o.Z.Util.extend(!0,t.controls,N(o.Z.Util.extend(!0,r[0],r[1])))),t};var k=o.Z.Map.prototype,F=function(e,t){var r,n='Layer "'+t.title+'" ("'+t.names+'"): ';r=t.isValidFromNames()?"layerSrsNotCompatible":"layerNameNotValid",n+=o.Z.Util.getLocaleString(e.options.locale,r),o.Z.error(n),e.trigger(a.Z.event.LAYERERROR,{layer:t,reason:r});const i=Error(n);return i.layerId=t.id,i};k.getCrs=k.getCRS=function(){const e=this;return e.on3DView?e.view3D.crs:e.crs},k.setCrs=async function(e,t){return await this.setProjection({crs:e}),o.Z.Util.isFunction(t)&&t(e),e};k.addLayer=function(e,t){const r=this,n=new Promise((function(t,n){if("object"==typeof e)if(e.id){const t=/(?<ctl>[-_\p{Letter}]+(\u002D\d)?\u002D)?(?<num>[\d]*)?/gu.exec(e.id).groups;t.num&&t.ctl&&o.Z.setUIDStart(parseInt(t.num)+1,{prefix:t.ctl})}else e.id=o.Z.getUID();let s=e.options?e.options.zIndex:e.zIndex;if("number"!=typeof s&&(s=e.stealth?1:0),r._layerBuffer.add(e.id||e,s,e.isBase),r.getLayer(e.id)){const t=Error(`Layer "${e.id}" already exists`);return t.layerId=e.id,void n(t)}var l;"string"==typeof e?l=new h.Z(o.Z.Util.extend({},R.call(r,e),{map:r})):e instanceof p.Z?(l=e).map=r:(e.map=r,l=e.type===a.Z.layerType.VECTOR||e.type===a.Z.layerType.KML||e.type===a.Z.layerType.WFS?new d.Z(e):new h.Z(e)),Promise.all([r.wrap.getMap(),l.wrap.getLayer()]).then((function(){var e;r.trigger(a.Z.event.BEFORELAYERADD,{layer:l}),H(l)&&(!function(e){e.wrap.$events.on(a.Z.event.TILELOADERROR,(function(t){if(t.error.code&&"404"!=t.error.code.toString()&&"offline"!=t.error.text){const r=this;if(!r._tileloaderror){const n=e.getPath(),i=n.length?n[n.length-1]:e.title;e.map.toast(o.Z.Util.getLocaleString(e.map.options.locale,"tileload.error",{name:i,error:t.error.text}),{type:a.Z.msgType.ERROR}),r._tileloaderror=!0;const s=function(e){e.tile.src&&e.tile.src!==a.Z.BLANK_IMAGE&&(delete r._tileloaderror,r.$events.off(a.Z.event.TILELOAD,s))};r.$events.on(a.Z.event.TILELOAD,s)}}}))}(l),e=r.wrap.indexOfFirstVector()),-1===e&&(e=r.wrap.getLayerCount());const s=r.state&&r.state.crs?r.state.crs:r.getCRS();o.Z.loadProjDef({crs:s,callback:function(){const e=l.isCompatible(s);if(l.isBase){const o=function(){var e;(r.state?l.isDefault=r.state.base===l.id||r.state.base===l.options.fallbackLayer:"string"==typeof r.options.defaultBaseLayer?l.isDefault=r.options.defaultBaseLayer===l.id:"number"==typeof r.options.defaultBaseLayer&&(l.isDefault=r.options.defaultBaseLayer===r.baseLayers.length),l.isDefault)?!l.mustReproject||l.type===a.Z.layerType.WMTS&&l.wrap.getCompatibleMatrixSets(s)[0]?(e=null===r.baseLayer,l.wrap.getLayer().then((function(n){r.wrap.setBaseLayer(n),r.baseLayer=l,i(e),t(l)}))):l.options.fallbackLayer&&l.getFallbackLayer?r.addLayer(l.getFallbackLayer()).then((function(n){r.wrap.setBaseLayer(n.wrap.layer),r.baseLayer=n.wrap.parent,i(e),t(l)})):n(F(r,l)):t(l)};e?o():l.getCapabilitiesOnline().then((function(e){if(l.capabilities=e,!l.isCompatible(s))if(l.type!==a.Z.layerType.WMTS)l.mustReproject=!0;else{const e=l.wrap.getCompatibleMatrixSets(s)[0];e?l.wrap.setMatrixSet(e):l.mustReproject=!0}o()}))}else e?l.wrap.getLayer().then((function(e){t(l)})):l.getCapabilitiesOnline().then((function(e){l.capabilities=e,l.isCompatible(s)?l.wrap.getLayer().then((function(e){t(l)})):n(F(r,l))}))}})}),(function(t){var r=new Error(t);r.layerId=e.id,n(r)}))}));n.then((function(e){r._layerBuffer.resolve(r,e,e.isBase),e.isBase||r.wrap.insertLayer(e.wrap.layer,r._layerBuffer.getResolvedVisibleLayerIndex(r,e.id)),r.trigger(a.Z.event.LAYERADD,{layer:e}),r._layerBuffer.checkMapLoad(r),o.Z.Util.isFunction(t)&&t(e)}),(function(e){r._layerBuffer.reject(r,e),r._layerBuffer.checkMapLoad(r)}));const i=function(e){e&&r.setExtent(r.initialExtent,{animate:!1,contain:!0})};return n},k.addOrUpdateLayer=async function(e,t){const r=this.getLayer(e.id);if(r){const t=Array.isArray(e.layerNames)?e.layerNames:e.layerNames?e.layerNames.split(","):[];switch(r.type){case a.Z.layerType.WFS:break;case a.Z.layerType.WMS:r.layerNames!==t&&await r.setLayerNames(t)}return null!=e.visibility&&r.visibility!==e.visibility&&(r.setVisibility(e.visibility),r.renderOptions=Object.assign(e.renderOptions,{hide:e.visibility})),void 0!==e.opacity&&r.opacity!==e.opacity&&(r.setOpacity(e.opacity,!0),r.renderOptions=Object.assign(e.renderOptions,{opacity:e.opacity})),r.unremovable=e.unremovable,r.title=e.title,r.hideTree=e.hideTree,r}return await this.addLayer(e,t)},k.removeLayer=async function(e){const t=this;if(e.unremovable)throw Error("Unremovable");let r=!1;for(var n=0;n<t.layers.length;n++)if(t.layers[n]===e){t.layers.splice(n,1),r=!0;break}if(!r)throw Error(`Layer ${e.id} not found in map`);if(e.isBase){for(n=0;n<t.baseLayers.length;n++)if(t.baseLayers[n]===e){t.baseLayers.splice(n,1),t.baseLayer===e&&t.setBaseLayer(t.baseLayers[0]);break}}else{for(n=0;n<t.workLayers.length;n++)if(t.workLayers[n]===e){t.workLayers.splice(n,1);break}e===t.vectors&&(t.vectors=null)}const i=await e.wrap.getLayer();return t.wrap.removeLayer(i),t._layerBuffer.remove(e.id),t.trigger(a.Z.event.LAYERREMOVE,{layer:e}),t._layerBuffer.checkMapLoad(t),e},k.insertLayer=async function(e,t,r){const n=this;for(var i=-1,s=0;s<n.layers.length;s++)if(e===n.layers[s]){i=s;break}const l=e.wrap.getLayer(),c=n.layers[t];let u;c&&(u=await c.wrap.getLayer());const p=await l;var h=-1;return(h=u?n.wrap.getLayerIndex(u):n.wrap.getLayerCount())>=0&&(e.map=n,n.wrap.insertLayer(p,h),i>-1&&n.layers.splice(i,1),n.layers.splice(t,0,e),n.workLayers=n.layers.filter((function(e){return!e.isBase})),n.trigger(a.Z.event.LAYERORDER,{layer:e,oldIndex:i,newIndex:t})),o.Z.Util.isFunction(r)&&r(),e},k.setLayerIndex=function(e,t){const r=t-this.baseLayers.length+1;this.wrap.setLayerIndex(e.wrap.layer,r)},k.putLayerOnTop=function(e){var t=this.wrap.getLayerCount();this.wrap.setLayerIndex(e.wrap.layer,t-1)},k.setBaseLayer=async function(e,t){var r=this,n=null,i=!1;if("string"==typeof e){var s;for(s=0;s<r.layers.length;s++)if(r.layers[s].id===e){e=r.layers[s],i=!0;break}i||(e=R.call(r,e))&&(e=await r.addLayer(o.Z.Util.extend(!0,{},e,{isDefault:!0,isBase:!0,map:r})),i=!0)}else r.layers.indexOf(e)<0&&(e.isDefault=!0,e.isBase=!0,e.map=r,r.addLayer(e)),i=!0;if(i)if(e.isCompatible(r.getCRS())||e.fallbackLayer&&(!e.fallbackLayer||e.fallbackLayer.isCompatible(r.getCRS()))){r.trigger(a.Z.event.BEFOREBASELAYERCHANGE,{oldLayer:r.getBaseLayer(),newLayer:e}),n=e,await r.wrap.getMap();const i=await e.wrap.getLayer();await r.wrap.setBaseLayer(i),r.baseLayer=e,r.trigger(a.Z.event.BASELAYERCHANGE,{layer:e}),o.Z.Util.isFunction(t)&&t()}else o.Z.error("Base layer must be reprojected");else o.Z.error("Base layer is not available");return n},k.setView=function(e){this.view=e,this.trigger(a.Z.event.VIEWCHANGE,{view:e})},k.ready=function(e){o.Z.Util.isFunction(e)&&(this.isReady?e():this.one(a.Z.event.MAPREADY,e))},k.loaded=function(e){const t=this;return o.Z.Util.isFunction(e)&&(t.isLoaded?e():t.one(a.Z.event.MAPLOAD,e)),new Promise((e=>{t.isLoaded?e():t.one(a.Z.event.MAPLOAD,e)}))},k.getLayerTree=function(){const e=this,t={baseLayers:[],workLayers:[]};e.baseLayer&&(t.baseLayers[0]=e.baseLayer.getTree());for(var r=0;r<e.workLayers.length;r++){const n=e.workLayers[r].getTree();n&&t.workLayers.unshift(n)}return t},k.addControl=function(e,t){const n=this;return new Promise((function(i,s){const l=function(e){return n.controls.push(e),Promise.resolve(e.register(n)).then((function(t){return e.div&&(e.div.parentNode||n.div.appendChild(e.div)),n.trigger(a.Z.event.CONTROLADD,{control:e}),t})).catch((function(e){s(e instanceof Error?e:Error(e))}))};if("string"==typeof e){const n=e.substr(0,1).toUpperCase()+e.substr(1),a=()=>l(new o.Z.control[n](null,t)).then(i);o.Z.Control&&o.Z.control[n]?a():r(837)("./"+n).then((function(e){o.Z.control[n]=e.default,a()}))}else l(e).then((function(e){i(e)}))}))},k.getControlsByClass=function(e){const t=this;let r=[],n=e;if("string"==typeof e){let t=e;t.indexOf(".")<0&&(t="TC.control."+t),n=window;const r=t.split(".");for(var i=0;i<r.length&&(n=n[r[i]],n);i++);}return o.Z.Util.isFunction(n)&&t.controls.forEach((e=>{e instanceof n&&r.push(e)})),r},k.getControlById=function(e){const t=this;for(var r=0,n=t.controls.length;r<n;r++){const n=t.controls[r];if(n.id===e)return n}return null},k.getDefaultControl=function(){const e=this;var t;return e.options.defaultActiveControl&&(t=e.getControlsByClass("TC.control."+e.options.defaultActiveControl.substr(0,1).toUpperCase()+e.options.defaultActiveControl.substr(1))[0]),t||(t=(t=e.getControlsByClass("TC.control.MultiFeatureInfo")[0])?t.lastCtrlActive:e.getControlsByClass("TC.control.FeatureInfo")[0]),t},k.getLoadingIndicator=function(){var e=null,t=this.getControlsByClass("TC.control.LoadingIndicator");return t.length&&(e=t[0]),e},k.addResultsPanel=function(e){const t=this,r=Object.assign({},e),n=t.getControlsByClass(o.Z.control.ControlContainer)[0];return n?(r.position=n.POSITION.RIGHT,n.addControl("resultsPanel",r)):t.addControl("resultsPanel",r)},k.setExtent=function(e,t,r){return this.wrap.setExtent(e,t,r)},k.getExtent=function(){return this.wrap.getExtent()},k.getMaxExtent=function(){return this.maxExtent||null},k.setCenter=function(e,t){return this.wrap.setCenter(e,t)},k.getCenter=function(){return this.wrap.getCenter()},k.setRotation=function(e){this.wrap.setRotation(e)},k.getRotation=function(){return this.wrap.getRotation()},k.getViewHTML=function(){return this.wrap.getViewport()},k.getCompatibleCRS=function(e){const t=((e=e||{}).layers||this.workLayers.concat(this.baseLayer)).filter((function(e){return e.isRaster()})).map((function(t){return t.getCompatibleCRS({normalized:!0,includeFallback:e.includeFallbacks})})),r=t.slice(1);return t[0].filter((function(e){return r.every((function(t){return t.indexOf(e)>=0}))}))},k.loadProjections=async function(e){const t=(e=e||{}).crsList||[];var r=(await Promise.all(t.map((function(e){return o.Z.getProjectionData({crs:o.Z.Util.getCRSCode(e)})})))).filter((function(e){return"ok"===e.status&&e.number_result>0})).map((function(e,t,r){const n=e.results[0],i="EPSG:"+n.code;return o.Z.loadProjDef({crs:i,def:n.def,name:n.name,silent:t<r.length-1}),{code:i,name:n.name,proj4:n.proj4,unit:n.unit}}));return e.orderBy&&(r=r.sort(o.Z.Util.getSorterByProperty(e.orderBy))),r},k.setProjection=function(e){const t=this;e=e||{};const r=t.crs;return new Promise((function(n,i){var s;if(e.crs){t.isReprojecting=!0,e.baseLayer?s=e.baseLayer:e.allowFallbackLayer&&(t.baseLayer.isCompatible(e.crs)||0!==t.baseLayer.wrap.getCompatibleMatrixSets(e.crs).length?t.baseLayer.firstOption&&(t.baseLayer.firstOption.isCompatible(e.crs)||t.baseLayer.firstOption.wrap.getCompatibleMatrixSets(e.crs).length>0)&&(s=t.baseLayer.firstOption):t.baseLayer.options.fallbackLayer&&(s=t.baseLayer.getFallbackLayer())),s||(s=t.baseLayer);const l=()=>t.isReprojecting=!1,c=async function(){e.extent&&await t.setExtent(e.extent)},u=async function(){l(),t.trigger(a.Z.event.PROJECTIONCHANGE,{oldCrs:r,newCrs:e.crs}),await c(),n()},p=function(){o.Z.loadProjDef({crs:e.crs,callback:function(){const r=function(n){const s=function(){const a=o.Z.Util.extend({},e,{oldCrs:t.crs}),s=function(e){e.setProjection(a)};n.isCompatible(e.crs)||n.wrap.getCompatibleMatrixSets(e.crs).length>0?(n.setProjection(a),t.wrap.setProjection(o.Z.Util.extend({},e,{baseLayer:n})),t.crs=e.crs,t.baseLayers.filter((function(e){return e!==n})).forEach(s),t.workLayers.forEach(s),n&&n!==t.baseLayer?t.setBaseLayer(n,u):u()):n.fallbackLayer?r(n.fallbackLayer):(l(),i(Error("Layer has no fallback")))};n.type===a.Z.layerType.WMS||n.type===a.Z.layerType.WMTS?n.getCapabilitiesPromise().then(s).catch(l):s()};r(s)}})};t.baseLayers.indexOf(s)<0?t.addLayer(s).then(p).catch(l):p()}}))},k.getMetersPerUnit=function(){return this.wrap.getMetersPerUnit()},k.getCoordinateFromPixel=function(e){return this.wrap.getCoordinateFromPixel(e)},k.getPixelFromCoordinate=function(e){return this.wrap.getPixelFromCoordinate(e)},k.zoomToFeatures=function(e,t){const r=this;if(e.length>0){let n;const i=()=>{n=[1/0,1/0,-1/0,-1/0];var i=t||{};i.contain=!0;var o=i.pointBoundsRadius||r.options.pointBoundsRadius;o/=r.getMetersPerUnit();var a=i.extentMargin;"number"!=typeof a&&(a=r.options.extentMargin);for(var s=0;s<e.length;s++){var l=e[s].getBounds();l&&(n[0]=Math.min(n[0],l[0]),n[1]=Math.min(n[1],l[1]),n[2]=Math.max(n[2],l[2]),n[3]=Math.max(n[3],l[3]))}if(n[2]-n[0]==0&&(n[0]=n[0]-o,n[2]=n[2]+o),n[3]-n[1]==0&&(n[1]=n[1]-o,n[3]=n[3]+o),a){var c=(n[2]-n[0])*a/2,u=(n[3]-n[1])*a/2;n[0]=n[0]-c,n[1]=n[1]-u,n[2]=n[2]+c,n[3]=n[3]+u}r.maxExtent&&(n[0]=Math.max(n[0],r.maxExtent[0]),n[1]=Math.max(n[1],r.maxExtent[1]),n[2]=Math.min(n[2],r.maxExtent[2]),n[3]=Math.min(n[3],r.maxExtent[3])),r.setExtent(n,i)};r.isReprojecting?r.one(a.Z.event.PROJECTIONCHANGE,i):i(),r.on3DView&&r._on3DZoomTo({extent:n})}},k._on3DZoomTo=function(e){const t=this;if(e=e||{},t.on3DView&&e.extent&&4===e.extent.length)if(e.reprojected)t.trigger(a.Z.event.ZOOMTO,e);else{let r=e.extent,n=t.view3D.view2DCRS!==t.view3D.crs?o.Z.Util.reproject(r.slice(0,2),t.view3D.view2DCRS,t.view3D.crs):r.slice(0,2),i=t.view3D.view2DCRS!==t.view3D.crs?o.Z.Util.reproject(r.slice(2),t.view3D.view2DCRS,t.view3D.crs):r.slice(2);e.extent=n.concat(i),t.trigger(a.Z.event.ZOOMTO,e)}},k.zoomToMarkers=function(e){var t=this;Promise.all(t._markerPromises).then((function(){for(var r=[],n=0;n<t.workLayers.length;n++){var i=t.workLayers[n];if(i.type===a.Z.layerType.VECTOR)for(var o=0;o<i.features.length;o++){var s=i.features[o];s instanceof v.Z&&r.push(s)}}t.zoomToFeatures(r,e),t._markerPromises=[]}))},k.zoomToLayer=function(e,t){const r=this;if((e=r.getLayer(e)).isRaster()){const n=e.getExtent();n&&((t=t||{}).contain=!0,"number"!=typeof t.extentMargin&&(t.extentMargin=r.options.extentMargin),r.setExtent(n,t),r.on3DView&&r._on3DZoomTo({extent:n,reprojected:!0}))}else e.features&&e.features.length&&r.zoomToFeatures(e.features,t)},k.getLayer=function(e){const t=this;return"string"==typeof e?t.layers.find((t=>t.id===e))||null:e instanceof p.Z&&e.map===t?e:null};var U=function(e){var t;return e.vectors?t=Promise.resolve(e.vectors):(t=e.addLayer({id:o.Z.getUID(),title:o.Z.i18n[e.options.locale].vectorLayer,type:a.Z.layerType.VECTOR}),e.vectors=t,t.then((function(t){e.vectors=t}))),t};k.addPoint=function(e,t){if(t&&t.layer){var r=this.getLayer(t.layer);if(!r)throw new Error('Layer "'+t.layer+'" not found');r.addPoint(e,o.Z.Util.extend(!0,{},t,{layer:r}))}else U(this).then((function(r){r.addPoint(e,t)}))},k.addMarker=async function(e,t,r){const n=this;let i;if(o.Z.Util.isFunction(t)?(r=t,t={}):t=t||{},t&&t.layer){var a=n.getLayer(t.layer);if(!a)throw new Error('Layer "'+t.layer+'" not found');i=a.addMarker(e,o.Z.Util.extend(!0,{},t,{layer:a}))}else{const r=U(n);n._markerPromises.push(r);i=(await r).addMarker(e,t)}n._markerPromises.push(i);const s=await i;return o.Z.Util.isFunction(r)&&r(s),s},k.addPolyline=function(e,t){if(t&&t.layer){var r=this.getLayer(t.layer);if(!r)throw new Error('Layer "'+t.layer+'" not found');r.addPolyline(e,o.Z.Util.extend(!0,{},t,{layer:r}))}else U(this).then((function(r){r.addPolyline(e,t)}))},k.addPolygon=function(e,t){if(t&&t.layer){var r=this.getLayer(t.layer);if(!r)throw new Error('Layer "'+t.layer+'" not found');r.addPolygon(e,o.Z.Util.extend(!0,{},t,{layer:r}))}else U(this).then((function(r){r.addPolygon(e,t)}))},k.removeFeatures=function(e){this.workLayers.filter((e=>e instanceof d.Z)).map((function(t){return{layer:t,features:t.features.filter((t=>e.includes(t)))}})).forEach((e=>e.features.forEach((t=>e.layer.removeFeature(t)))))},k.getBaseLayer=function(){return this.baseLayer||this.baseLayers[0]},k.getResolutions=function(){return this.wrap.getResolutions()},k.getResolution=function(){return this.wrap.getResolution()},k.setResolution=function(e){return this.wrap.setResolution(e)},k.exportFeatures=async function(e,t){var n=this;t=t||{};const i=e.filter((e=>!e.options.noExport));var s=n.getLoadingIndicator(),l=s&&s.addWait();const c=t.format===a.Z.format.GPX?Number.NaN:0;i.forEach((function(e,t){const r=e.getData();for(let t in r)if(/&(\w+|#\d{2,4});/g.test(t)){const n=r[t],i={},o=document.createElement("div");o.innerHTML=t,i[o.innerText]=n,e.unsetData(t),e.setData(i)}var n=e.getCoords({pointArray:!0});if(n.some((function(e){return null===e[2]}))){const r=e.clone();r.setId(e.id),i[t]=e=r,(n=e.getCoords({pointArray:!0})).forEach((function(e){null===e[2]&&(e[2]=c)}))}}));const u=t.format||"",p=function(e,t){const r=t.constructor;let n=e.get(r);return n||(n=[],e.set(r,n)),n.push(t),e};if(u===a.Z.format.SHAPEFILE){const e="ISO-8859-1",t=i.reduce((function(e,t){var r=t.id.substr(0,t.id.lastIndexOf("."));return!r&&t.folders&&t.folders.length&&(r=t.folders[t.folders.length-1]),!r&&t.layer&&t.layer.title&&(r=t.layer.title.substr(0,t.layer.title.lastIndexOf("."))),(e[r]=e[r]||[]).push(t),e}),{}),a=function(e){switch(!0){case e===y.Z:case e===v.Z:return"POINT";case e===E.Z:case e===b.Z:return"POLYGON";case e===w.Z:case e===S.Z:return"POLYLINE"}return"NULL"},c=await o.Z.getProjectionData({crs:n.crs}),u=[],d=(await Promise.all([r.e(9621),r.e(267)]).then(r.t.bind(r,9621,19))).default;let f;for(f in t){t[f].reduce(p,new Map).forEach((function(e,t,r){u.push(new Promise((function(n){const i=e.reduce((function(e,t){const r={};for(var n in t.data){const e=t.data[n];r[n]="string"==typeof e?e.replace(//g,"&bull;").replace(//g,"&rsaquo;"):e}return t.getStyle().label&&!t.data.name&&(r.name=t.getStyle().label),e.concat([r])}),[]),o=e.reduce((function(e,t){return t instanceof w.Z&&(t=new S.Z(t.getCoords(),t.options)),e.concat([t.geometry])}),[]);d.write(i,a(t),o,(function(e,i){const o=f+(r.size>1?"_"+a(t):"");n({fileName:o,content:i})}))})))}))}const g=[];for(var h=0;h<u.length;h++)g[h]=await u[h];const m=new(0,(await Promise.resolve().then(r.t.bind(r,3837,23))).default);g.forEach((t=>{m.file(t.fileName+".shp",t.content.shp.buffer),m.file(t.fileName+".shx",t.content.shx.buffer),m.file(t.fileName+".dbf",t.content.dbf.buffer),m.file(t.fileName+".prj",c.results[0].wkt),m.file(t.fileName+".cst",e),m.file(t.fileName+".cpg",e)}));try{const e=await m.generateAsync({type:"blob"});return s&&s.removeWait(l),e}catch(e){throw s&&s.removeWait(l),e}}if(u===a.Z.format.GEOPACKAGE){const e=function(e,t){var r="";switch(typeof t){case"string":default:r=e.DataTypes.TEXT;break;case"number":r=t%1==0?e.DataTypes.INT:e.DataTypes.FLOAT;break;case"boolean":r=e.DataTypes.BOOLEAN}return r},a=n.crs;await o.Z.loadJS(!window.geopackage,o.Z.apiLocation+"lib/geopackagejs/dist/geopackage-browser.js");const c=window.geopackage,u=(await Promise.all([r.e(981),r.e(6862)]).then(r.t.bind(r,981,19))).default,h=c.GeoPackageAPI,D=c.FeatureColumn,N=c.GeometryColumns,Z=await h.create();var d=a.substr(a.indexOf(":")+1);if(!Z.spatialReferenceSystemDao.queryForId(d)){var f=Z.spatialReferenceSystemDao.createObject(),g=await o.Z.getProjectionData({crs:a});f.srs_name=a,f.srs_id=g.results[0].code,f.organization=a.substr(0,a.indexOf(":")),f.organization_coordsys_id=g.results[0].code,f.definition=g.results[0].proj4.trim(),f.definition_12_063=g.results[0].wkt.trim(),f.description=g.results[0].name,Z.spatialReferenceSystemDao.create(f)}const k=i.reduce((function(e,r){var n="string"==typeof r.id?r.id.substr(0,r.id.lastIndexOf(".")):t.fileName;return(e[n]=e[n]||[]).push(r),e}),{});let F,U;for(F in k){const t=k[F].reduce(p,new Map);for(let r of t.values()){let n,o=0;const a=r[0];switch(!0){case a instanceof w.Z:n="LineString";break;case a instanceof S.Z:n="MultiLineString";break;case a instanceof v.Z:case a instanceof y.Z:n="Point";break;case a instanceof _.Z:case a instanceof m.Z:n="MultiPoint";break;case a instanceof E.Z:n="Polygon";break;case a instanceof b.Z:n="MultiPolygon"}const s=F+(t.size>1?"_"+n:"");var C=[],L="id";(Object.prototype.hasOwnProperty.call(i[0],"id")||Object.prototype.hasOwnProperty.call(i[0],"ID"))&&C.push(D.createPrimaryKeyColumnWithIndexAndName(o++,L)),C.push(D.createGeometryColumn(o++,"geometry",n.toUpperCase(),!0,null));for(var T=[1/0,1/0,-1/0,-1/0],A=0;A<r.length;A++){var x=r[A].getBounds();x&&(T[0]=Math.min(T[0],x[0]),T[1]=Math.min(T[1],x[1]),T[2]=Math.max(T[2],x[2]),T[3]=Math.max(T[3],x[3]))}for(var P in a.data||a.attributes){var O=a.attributes&&a.attributes[P]?a.attributes[P].name:P;if("id"===O.toLowerCase())continue;var I=a.data[O];const t=D.createColumn(o++,O,e(c,I));C.push(t)}if(r.some((e=>e.getStyle().label&&!e.data.name))){const e=D.createColumn(o++,"name",c.DataTypes.TEXT);C.push(e)}var R=new N;R.table_name=s,R.column_name="geometry",R.geometry_type_name=n.toUpperCase(),R.z=a.getGeometryStride(),R.m=2,R.srs_id=d,o=0;const l=new c.BoundingBox(T[0],T[2],T[1],T[3]);await Z.createFeatureTable(s,R,C,l,d);const p=Z.getFeatureDao(s);for(let e=0;e<r.length;e++){const t=r[e],n=p.newRow(),i=new c.GeometryData;i.setSrsId(d);const o=u.Geometry.parse("SRID="+d+";"+(new ol.format.WKT).writeFeature(t.wrap.feature));for(var M in i.setGeometry(o),n.setValueWithColumnName(n.geometryColumn.name,i),(Object.prototype.hasOwnProperty.call(t,"id")||Object.prototype.hasOwnProperty.call(t,"ID")||Object.prototype.hasOwnProperty.call(t.data,"id")||Object.prototype.hasOwnProperty.call(t.data,"ID"))&&n.setValueWithColumnName(L,"string"==typeof t.id?t.id.substring(t.id.lastIndexOf(".")+1):t.id),t.data||t.attributes){const e=a.attributes&&a.attributes[M]?a.attributes[P].name:M;if("id"===e.toLowerCase())continue;const r=t.data[e];n.setValueWithColumnName(e,r)}p.columns.indexOf("name")>=0&&!t.data.name&&n.setValueWithColumnName("name",t.getStyle().label),p.create(n)}}}try{return U=await Z.export(),s&&s.removeWait(l),U}catch(e){console.log(e),s&&s.removeWait(l)}return}const D=n.wrap.exportFeatures(i,t),N=a.Z.mimeType[t.format];if(u===a.Z.format.KMZ){const e=new(0,(await Promise.resolve().then(r.t.bind(r,3837,23))).default);e.file((t.fileName||"doc")+".kml",D);const n=await e.generateAsync({type:"blob",mimeType:N,compression:"DEFLATE"});return s&&s.removeWait(l),n}return s&&s.removeWait(l),D},k.exportControlStates=function(){return this.controls.map((function(e){return e.exportState()})).filter((function(e){if(e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!0;return!1}))},k.importControlStates=function(e){const t=this;e.forEach((function(e){const r=t.getControlById(e.id);r&&t.loaded((function(){r.importState(e)}))}))};var B={},G=function(){const e=this;var t=e;do{t=t.parentElement}while(t&&!t.matches("."+a.Z.classes.TOAST_CONTAINER));const r=e.innerHTML;e.classList.add(a.Z.classes.HIDDEN),void 0!==B[r]&&(B[r]=void 0),setTimeout((function(){e.parentElement&&e.parentElement.removeChild(e),t&&!t.querySelector("."+a.Z.classes.TOAST)&&t.parentElement&&t.parentElement.removeChild(t)}),1e3)};k.toastHide=function(e){var t=B[e];t&&(clearTimeout(t.timeout),t.toast&&t.toast.parentElement&&t.toast.parentElement.removeChild(t.toast),t.toast=null)},k.toast=function(e,t){const r=this;var n=t||{},i=n.duration||o.Z.Cfg.toastDuration,s=B[e];s&&(clearTimeout(s.timeout),s.toast&&s.toast.parentElement&&s.toast.parentElement.removeChild(s.toast),s.toast=null);var l=r.div.querySelector("."+a.Z.classes.TOAST_CONTAINER);l||((l=document.createElement("div")).classList.add(a.Z.classes.TOAST_CONTAINER),(n.container?n.container:r.div).appendChild(l));const c=document.createElement("div"),u=document.createElement("span");c.classList.add(a.Z.classes.TOAST),c.appendChild(u);const p=document.createElement("p");p.innerHTML=e,c.appendChild(p),c.addEventListener(a.Z.event.CLICK,G,{passive:!0}),l.appendChild(c),s=B[e]={toast:c};var h="";switch(n.type){case a.Z.msgType.INFO:h=a.Z.classes.INFO;break;case a.Z.msgType.WARNING:h=a.Z.classes.WARNING;break;case a.Z.msgType.ERROR:h=a.Z.classes.ERROR}h.length&&s.toast.classList.add(h),s.timeout=setTimeout((function(){G.call(s.toast)}),i)};var j=!1,W=function(e){if(/iPad/i.test(navigator.userAgent)){var t=window.innerHeight;e.getBoundingClientRect.height===t+(matchMedia("only screen and (orientation : landscape)").matches?20:0)&&(j=!0)}var r=function(){e.classList.toggle(a.Z.classes.IPAD_IOS7_FIX,matchMedia("only screen and (orientation : landscape)").matches)};j?(r(),window.addEventListener("resize",r)):window.removeEventListener("resize",r)},H=function(e){return"string"==typeof e||e.type!==a.Z.layerType.VECTOR&&e.type!==a.Z.layerType.KML&&e.type!==a.Z.layerType.WFS};k.exportImage=function(){var e=null,t="El mapa actual no es compatible con la exportacin de imgenes",r=this.wrap.getViewport({synchronous:!0}).getElementsByTagName("canvas")[0];if(r&&this.crossOrigin)try{e=r.toDataURL()}catch(e){o.Z.error(t+": "+e.message)}else o.Z.error(t);return e},k.loadFiles=function(e,t){this.wrap.loadFiles(e,t)},k.getElevationTool=async function(){const e=this;if(!e.elevation&&!e.options.elevation)return null;if(e.elevation)return e.elevation;if(await r.e(4759).then(r.bind(r,2331)),e.options.elevation){const t="boolean"==typeof e.options.elevation?{}:e.options.elevation;t.services&&e.options.googleMapsKey&&(t.services=t.services.map((function(t){const r="string"==typeof t,n=r?t:t.name;return"elevationServiceGoogle"===n?o.Z.Util.extend({name:n,googleMapsKey:e.options.googleMapsKey},r?{}:t):t}))),e.elevation=new o.Z.tool.Elevation(t)}else e.elevation=null;return e.elevation};const q=async function(e,t,r){let n=await e.describeFeatureType(t);var i={};if(1===t.length){var a={};a[t[0]]=n,n=a}for(var s in n){let e;var l=[];for(var c in n[s])!o.Z.Util.isGeometry(n[s][c].type)||n[s][c].nillable||n[s][c].minOccurs||l.push(c);if(l.length<=1){const t=(e,r)=>{if(e instanceof o.Z.filter.LogicalNary)e.conditions.forEach((e=>t(e,r)));else if(e instanceof o.Z.filter.Spatial)return e.geometryName=r,e};e=Object.assign(new r.constructor,t(r,0===l.length?null:l[0]))}else if(l.length>1){const t=(e,r)=>{if(e instanceof o.Z.filter.LogicalNary)e.conditions.forEach((e=>t(e,r)));else if(e instanceof o.Z.filter.Spatial)return o.Z.filter.or.apply(null,r.reduce(((t,r)=>(t.push(new(o.Z.filter[e.getTagName()])(r,e.geometry,e.srsName)),t)),[]))};e=Object.assign(new r.constructor,t(r,l))}i[s]=e}return i};k.extractFeatures=function(e){const t=this,r=[],n=(e=e||{}).filter,i=e.outputFormat,s=e.download,l=e.layers||t.layers,c={},u=function(e){const t=e.mapLayers[0];return e.title||e.mapLayers.reduce((function(e,t){return e||t.title}),"")||t.tree&&t.tree.title||t.capabilities.Service.Title},p=function(){return!s||i!==a.Z.mimeType.JSON&&i!==a.Z.mimeType.KML?o.Z.Util.toURNCRS(t.getCRS()):a.Z.SRSDOWNLOAD_GEOJSON_KML},h=function(e,t){return new Promise((function(r){s?e.mapLayer.proxificationTool.cacheHost.getAction(e.url).then((function(n){r({url:n.action(e.url),data:t})})):function(e,t){return new Promise((function(r){e.mapLayer.proxificationTool.fetch(e.url,{data:t,contentType:"application/xml",type:"POST"}).then((function(e){if(e instanceof XMLDocument){const t=e.querySelector("ExceptionReport Exception");if(t)return void r({errors:[{key:a.Z.WFSErrors.INDETERMINATE,params:{err:t.getAttribute("exceptionCode"),errorThrown:t.querySelector("ExceptionText").textContent}}]})}r({response:e})})).catch((function(e){r({errors:[{key:a.Z.WFSErrors.INDETERMINATE,params:{err:e.name,errorThrown:e.message}}]})}))}))}(e,t).then((function(t){t.errors&&t.errors.length>0?(t.errors[0].params.serviceTitle=e.service.mapLayers.reduce((function(e,t){return e||t.title}),"")||u(e.service),r(t)):r(t)}))}))};return l.forEach((function(e){if(!e.getVisibility()||t.workLayers.indexOf(e)<0||e.type!==a.Z.layerType.WMS)return;var l=e.getDisgregatedLayerNames()||e.availableNames;const d=e.url.toLowerCase();var f=c[d];f||(f=c[d]={url:d,layers:[],mapLayers:[e],layerNames:[]});for(var g=0;g<l.length;g++){var y=l[g];if(e.wrap.getInfo(y).queryable){f.layerNames.push(y);var m=e.getPath(y);f.layers.push({name:y,title:m[m.length-1],path:m.slice(1),features:[]})}}0!==f.layerNames.length&&void 0===f.request&&(f.request=f.request||e.getWFSCapabilities(),r.push(new Promise((function(e,t){f.request.then((function(t){var r=null,l=[];for(var d in c)c[d].request&&c[d].request===f.request&&(r=c[d]);var g=null,y=r.layerNames;if(!(y instanceof Array&&y.length))return;if(void 0===t.Operations.GetFeature)return l.push({key:a.Z.WFSErrors.GETFEATURE_NOT_AVAILABLE,params:{serviceTitle:u(r)}}),void e({errors:l});for(var m=[],v=0;v<y.length;v++){for(var _=y[v];"_"===_[_.length-1];)_=_.substring(0,_.lastIndexOf("_"));if(Object.prototype.hasOwnProperty.call(t.FeatureTypes,_.substring(y[v].indexOf(":")+1)))m.indexOf(_)<0&&m.push(_);else{var w=r.mapLayers[0].getPath(_.substring(y[v].indexOf(":")+1));l.push({key:a.Z.WFSErrors.LAYERS_NOT_AVAILABLE,params:{serviceTitle:u(r),layerName:w[w.length-1]}})}}if(0===m.length)return l.push({key:a.Z.WFSErrors.NO_VALID_LAYERS,params:{serviceTitle:u(r)}}),void e({errors:l});if(t.Operations.GetFeature.CountDefault&&(g=t.Operations.GetFeature.CountDefault.DefaultValue),"1.0.0"===t.version&&!Object.prototype.hasOwnProperty.call(t.Operations.GetFeature.Operations,"Query")||("2.0.0"===t.version||"1.1.0"===t.version)&&t.Operations.QueryExpressions.indexOf("wfs:Query")<0)return l.push({key:a.Z.WFSErrors.QUERY_NOT_AVAILABLE,params:{serviceTitle:u(r)}}),void e({errors:l});const S=t.Operations.GetFeature.DCPType?t.Operations.GetFeature.DCPType[1].HTTP.Post.onlineResource:t.Operations.GetFeature.DCP.HTTP.Post.href;Promise.all([q(r.mapLayers[0],m,n)]).then((function(n){var c,d,f,y=n[0];g?(c=g,d={url:S,mapLayer:r.mapLayers[0]},f=o.Z.Util.WFSQueryBuilder(y,null,t,i,!0,p()),new Promise((function(e){d.mapLayer.proxificationTool.fetchXML(d.url,{data:f,contentType:"application/xml",type:"POST"}).then((function(t){if(t instanceof XMLDocument){const r=t.querySelector("ExceptionReport Exception");if(r)return void e({errors:[{key:a.Z.WFSErrors.INDETERMINATE,params:{err:r.getAttribute("exceptionCode"),errorThrown:r.querySelector("ExceptionText").textContent}}]})}var r=parseInt(t.querySelector("FeatureCollection").getAttribute("numberMatched")||t.querySelector("FeatureCollection").getAttribute("numberOfFeatures"),10);isNaN(r)||r>parseInt(c,10)?e({errors:[{key:a.Z.WFSErrors.MAX_NUM_FEATURES}]}):e(0!==r?r:{errors:[{key:a.Z.WFSErrors.NO_FEATURES}]})})).catch((function(t){e({errors:[{key:a.Z.WFSErrors.INDETERMINATE,params:{err:t.name,errorThrown:t.message}}]})}))}))).then((function(n){if(n.errors&&n.errors.length>0){switch(n.errors[0].key){case a.Z.WFSErrors.INDETERMINATE:n.errors[0].params.serviceTitle=r.mapLayers.reduce(((e,t)=>e||t.title),"")||u(r);break;case a.Z.WFSErrors.MAX_NUM_FEATURES:n.errors[0].params={limit:g,serviceTitle:u(r)};break;case a.Z.WFSErrors.NO_FEATURES:n.errors[0].params={serviceTitle:u(r)}}e(n)}else h({url:S,mapLayer:r.mapLayers[0],service:r},o.Z.Util.WFSQueryBuilder(y,null,t,s?i:a.Z.mimeType.JSON,!1,p())).then((function(t){e(Object.assign({service:r,errors:l},t))}))})):h({url:S,mapLayer:r.mapLayers[0],service:r},o.Z.Util.WFSQueryBuilder(y,null,t,s?i:a.Z.mimeType.JSON,!1,p())).then((function(t){e(Object.assign({service:r,errors:l},t))}))})).catch((function(t){e({errors:[{key:a.Z.WFSErrors.INDETERMINATE,params:{err:t.name,errorThrown:t.message,serviceTitle:u(r)}}]})}))}),(function(t){var r=null;for(var n in c)c[n].request&&c[n].request===f.request&&(r=c[n]);e({errors:[{key:a.Z.WFSErrors.GETCAPABILITIES,params:{err:t.name,serviceTitle:u(r)}}]})}))}))))})),r},k.updateSize=function(){this.wrap.updateSize()},k.linkTo=function(e){this.wrap.linkTo(e)},k.loadRecentFiles=async function(){const e=this,t=[];for(var r=0;r<e.recentFileCount;r++)t.push(i().getItem(e.RECENT_FILES_STORE_KEY_PREFIX+r).catch((e=>console.warn(e))));const n=[];for await(const e of t)e&&n.push(e);return e.recentFiles=n,n},k.storeRecentFiles=async function(e){const t=this;e=e||t.recentFiles;for(var r=0;r<t.recentFileCount;r++)if(r<e.length){const n=e[r];await i().setItem(t.RECENT_FILES_STORE_KEY_PREFIX+r,n).catch((e=>console.warn(e)))}else await i().removeItem(t.RECENT_FILES_STORE_KEY_PREFIX+r).catch((e=>console.warn(e)));t.recentFiles=e};const V=l.Z.createSemaphore();k.addRecentFileEntry=async function(e){await V.acquire();const t=this;let r=!1;for await(const n of t.recentFiles.map((t=>(t.mainHandle||t).isSameEntry(e.mainHandle))))if(n){r=!0;break}if(r){const r=t.recentFiles.findIndex((t=>{var r;return((null===(r=t.mainHandle)||void 0===r?void 0:r.name)||t.name)===e.mainHandle.name}));t.recentFiles.splice(r,1)}else t.recentFiles.length>=t.recentFileCount&&t.recentFiles.pop();t.recentFiles.unshift(e),await t.storeRecentFiles(t.recentFiles),t.trigger(a.Z.event.RECENTFILEADD,{file:e}),V.release()},k.removeRecentFileEntry=async function(e){const t=this;t.recentFiles.splice(e,1),await t.storeRecentFiles(t.recentFiles)},k.loadRecentFileEntry=async function(e){const t=this,r=t.recentFiles[e];if(r){for await(const e of t.workLayers.filter((e=>e._fileHandle)).map((e=>{const t=r.mainHandle||r;return e._fileHandle.isSameEntry(t)})))e&&t.toast(o.Z.Util.getLocaleString(t.options.locale,"fileLoadedMoreThanOnce"),{type:a.Z.msgType.WARNING});let e=[r.mainHandle||r];r.additionalHandles&&(e=e.concat(r.additionalHandles));const i=[];for await(let t of e.map((e=>e.queryPermission())))i.push(t);for(var n=0;n<i.length;n++){"prompt"===i[n]&&(i[n]=await e[n].requestPermission())}if(i.every((e=>"granted"===e)))return t.loadFiles(e),r}return null}}();const L=o.Z.Map},268:(e,t,r)=>{"use strict";r.d(t,{Z:()=>L});var n=r(688),i=r(330),o=r(3089),a=r(9409),s=r(3819),l=r.n(s),c=r(1455);n.Z.i18n=n.Z.i18n||o.Z,String.prototype.soundex=function(){var e=this.toLowerCase().split(""),t=e.shift(),r={a:"",e:"",i:"",o:"",u:"",b:1,f:1,p:1,v:1,c:2,g:2,j:2,k:2,q:2,s:2,x:2,z:2,d:3,t:3,l:4,m:5,n:5,r:6};return(t+e.map((function(e,t,n){return r[e]})).filter((function(e,n,i){return 0===n?e!==r[t]:e!==i[n-1]})).join("")+"000").slice(0,4).toUpperCase()};var u=Number.prototype.toLocaleString;Number.prototype.toLocaleString=function(e,t){if("eu-ES"!==e||n.Z.Util.detectIE())return u.apply(this,arguments);var r=u.apply(this,arguments);return r=r.replace(/,/g,"."),Math.floor(this)===this&&Number.isInteger(Math.floor(this))||(r=r.replace(/.([^.]*)$/,",$1")),r};var p={},h={},d=["Capability","Request","GetMap","DCPType","0","HTTP","Get","OnlineResource"],f=["OperationsMetadata","GetTile","DCP","HTTP","Get","0","href"],g=function(e,t,r){return r<t.length-1?Object.prototype.hasOwnProperty.call(e,t[r])?g(e[t[r]],t,++r):null:e[t[r]]};const y=new WeakMap,m=new WeakMap,v={}.hasOwnProperty,_=new Map,w=e=>Math.floor(e)!==e&&e.toString().split(".")[1].length||0,S=new Set(["strokeColor","strokeWidth","fillColor","strokeOpacity","fillOpacity","url","radius","anchor","width","height","label","labelKey","labelOutlineWidth","labelOutlineColor","labelOffset","fontColor","fontSize"]);var E={getElevationGain:function(e){const t=(e=e||{}).coords;if(t&&t.length>0&&t[0].length>2){var r=0,n=0;const p=e.hillDeltaThreshold||0;for(var i,o,a,s=!0,l=0;l<t.length;l++){var c=t[l][2];if(null!==c){void 0===i&&(i=c,o=c,a=c),o=Math.min(o,c),a=Math.max(a,c);var u=c-i;u>p||u>0&&l===t.length-1?(s?r+=u:(n-=o-i,r+=c-o,s=!0),i=c,o=c,a=c):(u<-p||u<0&&l===t.length-1)&&(s?(r+=a-i,n-=c-a,s=!1):n-=u,i=c,o=c,a=c)}}return{upHill:Math.round(r),downHill:Math.round(n)}}return null},isPlainObject:function(e){return"object"==typeof e&&!e.nodeType&&e.window!==e&&!(e.constructor&&!v.call(e.constructor.prototype,"isPrototypeOf"))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},isFunction:function(e){return"function"==typeof e},extend:function(){var e,t=arguments[0]||{},r=1,n=!1;"boolean"==typeof t&&(n=t,t=arguments[r]||{},r++),"object"==typeof t||E.isFunction(t)||(t={});for(var i=arguments.length;r<i;r++){const i=arguments[r];if(null!=i)for(var o in i){const r=t[o],a=i[o];if(t===a)continue;const s=Array.isArray(a);n&&a&&(E.isPlainObject(a)||s)?(e=s?r&&Array.isArray(r)?r:[]:r&&E.isPlainObject(r)?r:{},t[o]=E.extend(n,e,a)):void 0!==a&&(t[o]=a)}}return t},getMapLocale:function(e){return e.options&&e.options.locale&&e.options.locale.replace("_","-")||"es-ES"},regex:{PROTOCOL:/(^https?:)/i},isOnCapabilities:function(e){var t=2!=arguments.length||arguments[1],r=t?e:e.replace(E.regex.PROTOCOL,"");let i;if(t){if(n.Z.capabilities[r])return e}else for(i in n.Z.capabilities)if(i.replace(E.regex.PROTOCOL,"")==r)return i;for(i in n.Z.capabilities){var o=g(n.Z.capabilities[i],d,0)||g(n.Z.capabilities[i],f,0);if(o&&t&&e==o)return o;if(o&&e.replace(E.regex.PROTOCOL,"")==o.replace(E.regex.PROTOCOL,""))return o}return e},reqGetMapOnCapabilities:function(e){var t=2!==arguments.length||arguments[1],r=function(e){var r=g(e,d,0)||g(e,f,0);return r?t?r.split("?")[0]:r.split("?")[0].replace(E.regex.PROTOCOL,""):null};return n.Z.capabilities[e]?r(n.Z.capabilities[e]):null},getFnFromString:function(e){for(var t=window,r=e.split("."),n=0;n<r.length-1;n++)if(null==(t=t[r[n]]))return;return t[r[r.length-1]]},isURL:function(e){return/^(http|https|ftp|mailto):\/\//i.test(e)},isSecureURL:function(e){return!/^(f|ht)tps?:\/\//i.test(e)||/^(f|ht)tps:\/\//i.test(e)},isSameOrigin:function(e){var t=0!==e.indexOf("http")&&0!==e.indexOf("//"),r=!t&&e.match(i.Z.url.SPLIT_REGEX);if(r){var n=window.location,o=r[1];t=(o==n.protocol||null==o)&&r[3]==n.hostname;var a=r[4],s=n.port;(80!=a&&""!==a||"80"!=s&&""!==s)&&(t=t&&a==s)}return t},formatNumber:function(e,t){var r=typeof e;if("number"===r)return e.toLocaleString(t,{maximumFractionDigits:Math.min(6,w(e))});if("string"===r){const r=parseFloat(e);if(r===new Number(e).valueOf())return r.toLocaleString(t,{maximumFractionDigits:Math.min(6,w(r))})}return e},addProtocol:function(e){var t=e;return e&&0===e.indexOf("//")&&(t=location.protocol+e),t},getDiv:function(e){return"string"==typeof e?document.getElementById(e):e instanceof HTMLElement?e:e&&"$"in window&&e instanceof $&&e.length?e[0]:document.createElement("div")},getScriptLocation:function(){var e,t;if(document.currentScript)t=document.currentScript;else{var r=document.getElementsByTagName("script");t=r[r.length-1]}return(e=t.getAttribute("src"))?e.substr(0,e.lastIndexOf("/")+1):""},getBackgroundUrlFromCss:function(e){var t="";if(e)if(void 0!==p[e])t=p[e];else{const n=document.createElement("div");n.style.display="none",n.classList.add(e),document.body.appendChild(n);var r=/^url\(['"]?(.*?)['"]?\)$/gi.exec(window.getComputedStyle(n,null).backgroundImage);r&&r.length>1&&(t=r[r.length-1]),n.parentElement.removeChild(n),p[e]=t}return t},getPointIconUrl:function e(t){var r=null;if(t.url)r=t.url,/Firefox/.test(navigator.userAgent)&&"https:"===location.protocol&&r.startsWith("http:")&&(r=r.replace("http:","https:"));else{var i;if("string"==typeof t.cssClass)i=t.cssClass;else{var o=t.classes||n.Z.Cfg.styles.marker.classes;if(i=o[0],t.group){if(!Object.prototype.hasOwnProperty.call(h,t.group)){let e=Object.keys(h).length;e%=o.length,h[t.group]=o[e]}i=h[t.group]}}r=E.getBackgroundUrlFromCss(i)}return r||t===n.Z.Cfg.styles.point||""===t.cssClass||(r=e(n.Z.Cfg.styles.point)),r},getLegendImageFromStyle:function(e,t){let r=null;if(t=t||{},e.url)r=e.url;else{let n=t.width||32,o=t.height||16;const a=e.strokeWidth||0,s=a/2,l=e.fillColor||"transparent",c=e.fillOpacity||1,u=2*(e.radius||0)+a,p=e.lineDash?`stroke-dasharray="${e.lineDash.join(" ")}" `:"";let h;switch(n=Math.max(n,u),o=Math.max(o,u),t.geometryType){case i.Z.geom.POINT:h=`<circle cx="${n/2}" cy="${o/2}" r="${e.radius}" stroke="${e.strokeColor}" stroke-width="${a}" fill="${l}" fill-opacity="${c}" ${p}/>`;break;case i.Z.geom.POLYLINE:h=`<polyline points="${s},${o-s} ${n-s},${s}" style="stroke:${e.strokeColor};stroke-width:${a}" ${p}/>`;break;case i.Z.geom.POLYGON:h=`<polygon points="${s},${o-s} ${s},${s} ${s+.8*n},${s} ${n-s},${o-s}" style="stroke:${e.strokeColor};stroke-width:${a};fill:${l};fill-opacity:${c}" ${p}/>`;break;default:h=`<rect x="${s}" x="${s}" width="${n-a}" height="${o-a}" style="stroke:${e.strokeColor};stroke-width:${a};fill:${l};fill-opacity:${c}" ${p}/>`}r="data:image/svg+xml,"+encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${o}">${h}</svg>`)}return r},addArrayToTree:function e(t,r,n){var i=null,o=!1,a=t[n=n||0];if(a){for(var s,l=0,c=r.children.length;l<c;l++)if((s=r.children[l]).name===a){if(o=!0,n===t.length-1)i=s;else{const r=e(t,s,n+1);r&&(i=r)}break}if(!o){s={name:a,title:a,uid:"/"+t.slice(0,n+1).join("/"),children:[]};const o=e(t,s,n+1);i=o||s,s.parent=r,r.children.push(s)}}return i},parseCoords:function(e){var t=null,r=function(e){var t=e,r={};r.type=i.Z.GEOGRAPHIC;var n=t.indexOf("");if(r.value=parseFloat(t.substr(0,n)),(n=(t=t.substr(n+1)).indexOf("'"))>=0){var o=parseFloat(t.substr(0,n))/60;r.value>=0?r.value+=o:r.value-=o,(n=(t=t.substr(n+1)).indexOf("'"))>=0&&(o=parseFloat(t.substr(0,n).replace(",","."))/3600,r.value>=0?r.value+=o:r.value-=o)}return r},n=function(e){var t=e.trim();if(t.match(/^1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?\s*[NnSsWwOoEe]$/g)){switch(t[t.length-1]){case"S":case"s":case"W":case"w":case"O":case"o":t="-"+t}return t=t.substr(0,t.length-1),r(t)}if(t.match(/^[+-]?1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?$/g))return r(t);if(t.match(/^1?\d{0,2}([.,]\d+)?\s*\u00B0?\s*[NnSsWwOoEe]$/g)){var n={type:i.Z.GEOGRAPHIC,value:parseFloat(t.substr(0,t.length-1).replace(",","."))};return t.match(/[SsWwOo]$/)&&(n.value=-n.value),n}return t.match(/^[+-]?1?\d{0,2}([.,]\d+)?\s*\u00B0?$/g)?{type:i.Z.GEOGRAPHIC,value:parseFloat(t.replace(",","."))}:t.match(/^[-+]?\d{6,7}([.,]\d+)?$/g)?{type:i.Z.UTM,value:parseFloat(t.replace(",","."))}:null},o=(e=e.trim().toUpperCase()).split(",");if(4===o.length?o=[o.slice(0,1).join("."),o.slice(2,3).join(".")]:1!==o.length&&3!==o.length||(o=e.split(" ")),2===o.length){var a=n(o[0]),s=n(o[1]);null!==a&&null!==s&&(t=[a,s])}return t},reproject:function(e,t,r){var i,o=!0,s=!0,l=!0;Array.isArray(e[0])?Array.isArray(e[0][0])?Array.isArray(e[0][0][0])||(l=!1,e=[e]):(s=!1,e=[[e]]):(o=!1,s=!1,l=!1,e=[[[e]]]);const c=function(e){let t;const r=a.Z.defs[e];return r&&(t=(0,a.Z)(r)),t||(n.Z.loadProjDef({crs:e,sync:!0}),t=(0,a.Z)(a.Z.defs[e])),t};var u=c(t),p=c(r);return i=new Array(e.length),e.forEach((function(e,t){const r=i[t]=[];e.forEach((function(e,t){const n=r[t]=[];e.forEach((function(e,t){if(Array.isArray(e)&&e.length>1){var r=(0,a.Z)(u,p,{x:e[0],y:e[1]});if(n[t]=[r.x,r.y],e.length>2)for(var i=2;i<e.length;i++)n[t][i]=e[i]}else n[t]=e}))}))})),o?s?l||(i=i[0]):i=i[0][0]:i=i[0][0][0],i},getMetersPerDegree:function(e){let t;const r=6370997;if(Array.isArray(e)&&e.length>=4)if(e[3]===e[1])t=Math.PI*r*Math.cos(this.degToRad(e[1]))/180;else{const n=this.degToRad(e[3]-e[1]),i=Math.sin(n/2),o=i*i;t=r*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))/(e[3]-e[1])}return t},radToDeg:function(e){return 180*e/Math.PI},degToRad:function(e){return e*Math.PI/180},mod:function(e){const t=2*Math.PI;return(e%t+t)%t},getCRSCode:function(e){var t=null;if(e=e.trim(),/^EPSG:\d{4,6}$/g.test(e)||/^urn:ogc:def:crs:EPSG:.*:\d{4,6}/g.test(e)||/http:\/\/www.opengis.net\/gml\/srs\/epsg.xml#\d{4,6}$/g.test(e)){var r=e.trim().match(/^.+[:#](\d{4,6})$/);r&&(t=r[1])}return t},toURNCRS:function(e){return e.replace(/^(?<epsg>EPSG):(?<code>\d{4,6})$/g,"urn:ogc:def:crs:$<epsg>::$<code>")},CRSCodesEqual:function(e,t){if(e===t)return!0;var r=this.getCRSCode(e),n=this.getCRSCode(t);return null!==r&&null!==n&&r===n},getLocaleString:function(e,t,r){var i=t;if(n.Z.i18n&&n.Z.i18n[e]){var o=n.Z.i18n[e][t];if(o&&(i=o,r))for(var a in r)i=i.replace("{"+a+"}",r[a])}return i},getRenderedHtml:async function(e,t,r){const i=async function(e){let t=_.get(e);if(t)return t;{let t;_.set(e,!0);try{t=await n.Z.ajax({url:n.Z.apiLocation+`TC/templates/${e}.hbs`,method:"GET",responseType:"text"})}catch(e){throw console.log("Error fetching template: "+e.message),e}const r=t.data.match(/{{> ([a-zA-Z\-]+)(?:(?:\s[a-zA-Z]+)\s*)?}}/);return r&&await Promise.all(r.slice(1).map((e=>i(e.trim())))),function(e,t){const r=c.Z.compile(t);return c.Z.registerPartial(e,r),_.set(e,r),r}(e,t.data)}},o=function(e){const n=e(t);return E.isFunction(r)&&r(n),n};if(E.isFunction(e))return o(e);return o(await i(e))},getSimpleMimeType:function(e){var t="";if(e){var r=e.indexOf(";");r>0&&(e=e.substring(0,r)),t=e}return t},getMimeTypeFromUrl:function(e){let t=e.indexOf("?");switch(t>=0?e=e.substr(0,t):(t=e.indexOf("#"),t>=0&&(e=e.substr(0,t))),e.substr(e.lastIndexOf(".")+1).toLowerCase()){case"kml":return i.Z.mimeType.KML;case"kmz":return i.Z.mimeType.KMZ;case"json":case"geojson":return i.Z.mimeType.GEOJSON;case"gml":return i.Z.mimeType.GML;case"gpx":return i.Z.mimeType.GPX;case"gpkg":return i.Z.mimeType.GEOPACKAGE;case"shp":case"dbf":case"prj":case"cst":case"cpg":return i.Z.mimeType.SHAPEFILE;case"zip":return i.Z.mimeType.ZIP;default:return null}},getQueryStringParams:function(e){var t;if(e){var r=e.indexOf("?");if(r>=0){var n=(t=e.substr(r)).indexOf("#");n>=0&&(t=t.substr(0,n))}else t="?"}else t=location.search;var i=t.replace(/(^\?)/,"").split("&").map(function(e){return this[(e=e.split("="))[0]]=e[1],this}.bind({}))[0];return delete i[""],i},getParamString:function(e){const t=[];for(var r in e)t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&").replace(/%20/g,"+")},fastUnshift:function(e,t){for(var r=e.length;r;)e[r]=e[r-1],r--;e[0]=t},storage:{getCookie:function(e){return n.Z.cookie(e)},setCookie:function(e,t,r){return n.Z.cookie(e,t,r)},getLocalValue:function(e){return localStorage&&localStorage instanceof Storage?localStorage.getItem(e):E.storage.getCookie(e)},setLocalValue:function(e,t){if(localStorage&&localStorage instanceof Storage)void 0===t?localStorage.removeItem(e):localStorage.setItem(e,t);else if(void 0===t){var r=new Date;r.setDate(r.getDate()-1),E.storage.setCookie(e,"",{expires:r})}else E.storage.setCookie(e,t);return e},getSessionLocalValue:function(e){return sessionStorage&&sessionStorage instanceof Storage?sessionStorage.getItem(e):E.storage.getCookie(e)},setSessionLocalValue:function(e,t){if(sessionStorage&&sessionStorage instanceof Storage)void 0===t?sessionStorage.removeItem(e):sessionStorage.setItem(e,t);else if(void 0===t){var r=new Date;r.setDate(r.getDate()-1),E.storage.setCookie(e,"",{expires:r})}else E.storage.setCookie(e,t);return e}},detectFirefox:function(){return!!/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&new Number(RegExp.$1)},detectIE:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(e.indexOf("Trident/")>0){var r=e.indexOf("rv:");return parseInt(e.substring(r+3,e.indexOf(".",r)),10)}var n=e.indexOf("Edge/");return n>0&&parseInt(e.substring(n+5,e.indexOf(".",n)),10)},detectChrome:function(){return window.chrome},detectSafari:function(){return!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)},detectMouse:function(){const e=matchMedia("(pointer:coarse)").matches,t=matchMedia("(pointer:fine)").matches;if(e&&t)return!0;if(e&&!t){return i="(hover: hover)",o=!n.Z.browserFeatures.touch(),(r=window.matchMedia(i)).media===i&&(o=r.matches),!!o}var r,i,o;return!(e||!t)||!matchMedia("(pointer:none)").matches&&(!n.Z.browserFeatures.touch()||void 0)},detectAndroid:function(){return navigator.userAgent.match(/Android/i)},detectBlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},detectIOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},detectMobileWindows:function(){return navigator.userAgent.match(/IEMobile/i)},detectMobile:function(){return E.detectAndroid()||E.detectIOS()||E.detectMobileWindows()||E.detectBlackBerry()},getBrowser:function(){var e=(new(l())).getBrowser();return{name:e.name,version:e.major}},getElementByNodeName:function(e,t){for(var r=t.indexOf(":"),n=t.substr(r+1),i=e.getElementsByTagNameNS("*",n),o=0;o<i.length;o++)if(i[o].nodeName==t)return i},addURLParameters:function(e,t){if(!t)return e;let r,n=!1;try{r=new URL(e)}catch(t){t instanceof TypeError&&(n=!0,r=new URL(e,window.location.href))}for(var i in t){const e=t[i];r.searchParams.set(i,e)}const o=r.href;return n?o.substr(o.indexOf(r.host)+r.host.length):o},removeURLParameter:function(e,t){var r=e.split("?");if(r.length>=2){for(var n=encodeURIComponent(t.toLowerCase())+"=",i=r[1].toLowerCase().split(/[&;]/g),o=i.length;o-- >0;)-1!==i[o].lastIndexOf(n,0)&&i.splice(o,1);return e=r[0]+"?"+i.join("&")}return e},showModal:function(e,t){t=t||{},e.hidden=!1,e.classList.add(i.Z.classes.VISIBLE);const r=e.querySelectorAll(".tc-modal-close");if(r&&r.length>0)for(var o=0;o<r.length;o++){var a=m.get(r[o]);a?m.delete(r[o]):(a=function(e){return e.stopPropagation(),n.Z.Util.closeModal(t.closeCallback,e.target)},m.set(r[o],a)),m.set(r[o],a),r[o].addEventListener("click",a)}E.isFunction(t.openCallback)&&t.openCallback()},closeModal:function(e,t){const r=function(e){e.classList.remove(i.Z.classes.VISIBLE)};var n;if(t){for(n=t;n&&!n.matches(".tc-modal");)n=n.parentElement;r(n)}else Array.prototype.forEach.call(document.querySelectorAll(".tc-modal"),(function(e){r(e)}));e&&e()},closeAlert:function(e){var t=e;do{(t=t.parentElement).matches(".tc-alert")&&(t.style.display="none")}while(t)},swipe:function(e,t){const r=function(t){e.addEventListener("mousedown",t.start),e.addEventListener("touchstart",t.start,{passive:!0}),e.addEventListener("mouseup",t.end),e.addEventListener("touchend",t.end,{passive:!0})};if("disable"===t){const t=y.get(e);return void(t&&(e.removeEventListener("mousedown",t.start),e.removeEventListener("touchstart",t.start),e.removeEventListener("mouseup",t.end),e.removeEventListener("touchend",t.end)))}if("enable"===t){const t=y.get(e);return void(t&&r(t))}const n=(t=t||{}).minDistance||30,i=t.maxCrossDistance||30,o=t.maxAllowedTime||1e3;var a={x:-1,y:-1},s={x:-1,y:-1},l=0;const c={start:function(r){(function(r){if(t.noSwipe)for(var n=r.target;n&&n!==e;){if(n.matches&&n.matches(t.noSwipe))return!1;n=n.parentNode}return!0})(r)&&(r="changedTouches"in r?r.changedTouches[0]:r,a.x=r.pageX,a.y=r.pageY,l=(new Date).getTime())},end:function(r){if(l){if(r="changedTouches"in r?r.changedTouches[0]:r,s.x=r.pageX,s.y=r.pageY,(new Date).getTime()-l<=o){const r=t[function(e,t){const r=t.x-e.x,o=t.y-e.y,a=Math.abs(r),s=Math.abs(o);return a>s&&a>n&&s<=i?r<0?"left":"right":s>a&&s>n&&a<=i?o<0?"up":"down":"none"}(a,s)];r&&r.call(e)}l=0}}};y.set(e,c),r(c)},getParameterByName:function(e){const t=new URLSearchParams(location.search),r=Array.from(t).find((([t,r])=>t.toLowerCase()===e.toLowerCase()));return r?r[1]:""},getLocaleUserChoice:function(e){var t="en-US",r=(e=e||{}).cookieName||"SITNA.language",i=e.paramName||"lang",o=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language||navigator.userLanguage,a=n.Z.Util.getParameterByName(i)||n.Z.Util.storage.getCookie(r)||o,s=a.indexOf("-");s>=0&&(a=a.substr(0,s));var l=new Date((new Date).getTime()+31536e6);switch(n.Z.Util.storage.setCookie(r,a,{expires:l}),a){case"eu":t="eu-ES";break;case"es":t="es-ES";break;default:t="en-US"}return t},getValidFilename:function(e){return(e||"").replace(/[/\\?%*:|"<>]/g,"-")},getFormatFromFileExtension:function(e){switch(e){case".kml":return i.Z.format.KML;case".kmz":return i.Z.format.KMZ;case".gpx":return i.Z.format.GPX;case".json":case".geojson":return i.Z.format.GEOJSON;case".gml":return i.Z.format.GML;case".wkt":return i.Z.format.WKT;case".wkb":return i.Z.format.WKB;case".topojson":return i.Z.format.TOPOJSON;case".gpkg":return i.Z.format.GEOPACKAGE;case".shp":return i.Z.format.SHAPEFILE;default:return null}},downloadBlob:function(e,t){var r=document.createElement("a");if(void 0!==r.download){var i=URL.createObjectURL(t);r.setAttribute("href",i),r.setAttribute("download",n.Z.Util.getValidFilename(e)),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)}},downloadFile:function(e,t,r){var i=new Blob([r],{type:t});e=n.Z.Util.getValidFilename(e),navigator.msSaveBlob?navigator.msSaveBlob(i,e):n.Z.Util.downloadBlob(e,i)},downloadDataURI:function(e,t,r){for(var i=atob(r.split(",")[1]),o=[],a=0;a<i.length;a++)o.push(i.charCodeAt(a));var s=new Blob([new Uint8Array(o)],{type:t});e=n.Z.Util.getValidFilename(e),navigator.msSaveBlob?navigator.msSaveBlob(s,e):n.Z.Util.downloadBlob(e,s)},shortenUrl:function(e){return new Promise((function(t,r){n.Z.ajax({url:"https://api-ssl.bitly.com/v3/shorten",data:{access_token:"6c466047309f44bd8173d83e81491648b243ee3d",longUrl:e}}).then((function(e){t(e.data)})).catch((function(e){r(e)}))}))},utf8ToBase64:function(e){return window.btoa(unescape(encodeURIComponent(e)))},base64ToUtf8:function(e){var t;try{t=decodeURIComponent(escape(window.atob(e)))}catch(e){t=null}return t},colorArrayToString:function(e){return Array.isArray(e)&&(e=e.slice(0,3).reduce((function(e,t){const r=t.toString(16);return e+"00".substring(0,2-r.length)+r}),"#")),e},operation:function(e,t,r,n){for(var i=[],o=0;o<e.length;o++){for(var a=e[o],s=!1,l=0;l<t.length;l++)if(r(a,t[l])){s=!0;break}s===n&&i.push(a)}return i},inBoth:function(e,t,r){return this.operation(e,t,r,!0)},inFirstOnly:function(e,t,r){return this.operation(e,t,r,!1)},inSecondOnly:function(e,t,r){return this.inFirstOnly(t,e,r)},toDataUrl:function(e,t){var r={type:"image/png",encoderOptions:.92},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r,i=n.type,o=n.encoderOptions,a=e.getContext("2d");if(!a)return"";var s=e.width,l=e.height,c=a.getImageData(0,0,s,l),u=a.globalCompositeOperation;t&&(a.globalCompositeOperation="destination-over",a.fillStyle=t,a.fillRect(0,0,s,l));var p=e.toDataURL(i,o);return t&&(a.clearRect(0,0,s,l),a.putImageData(c,0,0),a.globalCompositeOperation=u),p},imgToDataUrl:function(e,t){var r=function(e){var t=document.createElement("CANVAS"),r=t.getContext("2d");return t.height=e.height,t.width=e.width,r.drawImage(e,0,0),t};return new Promise((function(i,o){if(!t)switch(e.substr(e.lastIndexOf(".")+1).toLowerCase()){case"svg":t="image/svg+xml";break;case"png":t="image/png";break;case"gif":t="image/gif";break;default:t="image/jpeg"}var a=new Image;a.crossOrigin="anonymous",a.onload=function(){var o,s=r(a);try{o=n.Z.Util.toDataUrl(s,"#ffffff",{type:t,encoderOptions:1}),i({dataUrl:o,canvas:s})}catch(t){a.src=n.Z.proxify(e)}},a.onerror=function(s){var l=new XMLHttpRequest;l.open("GET",n.Z.proxify(e),!0),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.responseType="arraybuffer",l.onload=function(e){if(200===this.status){for(var o=new Uint8Array(this.response),s=o.length,c=new Array(s);s--;)c[s]=String.fromCharCode(o[s]);var u=c.join(""),p=l.getResponseHeader("content-type");0===p.indexOf("image")&&(a.src="data:"+p+";base64,"+window.btoa(u),a.onload=function(){const e=r(a),o=n.Z.Util.toDataUrl(e,"#ffffff",{type:t||"image/jpeg",encoderOptions:1});i({dataUrl:o,canvas:e})})}},l.onreadystatechange=function(){4===l.readyState&&200!==l.status&&o(Error("HTTP error "+l.status))},l.send()},a.src=e,(a.complete||void 0===a.complete)&&(a.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",a.src=e)}))},imgTagToDataUrl:function(e,t){var r=function(e){var t=document.createElement("CANVAS"),r=t.getContext("2d");return t.height=e.height,t.width=e.width,r.drawImage(e,0,0),t}(e);try{return{base64:n.Z.Util.toDataUrl(r,"#ffffff",{type:t||"image/jpeg",encoderOptions:1}),canvas:r}}catch(e){return null}},addToCanvas:function(e,t,r,i){var o=n.Z.Util.cloneCanvas(e),a=o.getContext("2d");return new Promise((function(e,n){var s=new Image;s.crossOrigin="anonymous",s.src=t,s.onload=function(){i?a.drawImage(s,r.x||0,r.y||0,i.width,i.height):a.drawImage(s,r.x||0,r.y||0),e(o)}}))},cloneCanvas:function(e){var t=document.createElement("canvas"),r=t.getContext("2d");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),t},mergeCanvases:function(e){const t=e.map((e=>e.parentElement?e.getBoundingClientRect():{top:0,left:0,bottom:e.height,right:e.width})),r=t.reduce((function(e,t){return[Math.min(e[0],t.left),Math.min(e[1],t.top),Math.max(e[2],t.right),Math.max(e[3],t.bottom)]}),[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY]),n=r[0],i=r[1],o=document.createElement("canvas"),a=o.getContext("2d");return o.width=r[2]-n,o.height=r[3]-i,e.forEach((function(e,r){const o=t[r];a.drawImage(e,o.left-n,o.top-i,o.right-o.left,o.bottom-o.top)})),o},calculateAspectRatioFit:function(e,t,r,n){var i=Math.min(r/e,n/t);return{width:e*i,height:t*i}},getFormattedDate:function(e,t){function r(e){return e<10?"0"+e:e}var n=new Date(e);return[n.getFullYear(),r(n.getMonth()+1),r(n.getDate())].concat(t?["_",r(n.getHours()),r(n.getMinutes()),r(n.getSeconds())]:[]).join("")},replaceSpecialCharacters:function(e){var t=new Map([["","a"],["","o"],["","u"],["","A"],["","O"],["","U"],["","a"],["","e"],["i","i"],["","o"],["","u"],["","A"],["","E"],["","I"],["","O"],["","U"],["","n"],["","N"]]);return e.replace(/[]/g,(function(e){return t.get(e)}))},downloadFileForm:async function(e,t){var r,o=async function(e,t){var r=await new Promise((function(r,n){const i=new XMLHttpRequest;i.responseType="blob",i.open("POST",e),i.setRequestHeader("Content-Type","application/xml; charset=UTF-8"),i.onreadystatechange=function(t){if(4===i.readyState)if(200!==i.status)n({status:i.status,msg:i.statusText,url:e});else try{const e=i.getResponseHeader("Content-disposition");var o="";e&&(o=e.split("; ")[1].substring(9),"attachment"!==e.split("; ")[0]&&(o=o.substring(0,o.lastIndexOf("."))));const t=i.getResponseHeader("Content-type");r({data:i.response,contentType:t||("blob"===i.responseType?"application/zip":""),filename:o})}catch(e){n(e)}};try{i.send(t)}catch(e){n(e)}})),o="";if(r.data.type.indexOf("kml")>=0)o=".kml";else if(r.data.type.indexOf("json")>=0)o=".geojson";else if(r.data.type.indexOf("xml")>=0&&(o=".gml",/outputFormat="\S{1,}"/.exec(t)[0].includes(".kml")||/outputFormat="\S{1,}"/.exec(t)[0].includes("shape-zip")))throw{key:i.Z.DownloadError.MIMETYPE_NOT_SUPORTED,url:e,data:t,format:/outputFormat="\S{1,}"/.exec(t)[0]};n.Z.Util.downloadFile((r.filename?r.filename:n.Z.getUID())+o,r.contentType,r.data)};if(Array.isArray(e)){for(var a=e,s=0;s<a.length;s++)try{await o(a[s].url,a[s].data)}catch(e){r=e}if(r)throw r}else await o(e,t)},WFSQueryBuilder:function(e,t,r,i,o,a,s,l){const c=function(){return a?' srsName="'+a+'"':""},u=function(){if(!l)return"";var e="";switch(r.version){case"1.0.0":e="ogc:PropertyName";break;case"1.1.0":e="wfs:PropertyName";break;case"2.0.0":e="wfs:PropertyName"}return(l instanceof Array?l:[l]).reduce((function(t,r){return t+"<"+e+">"+r+"</"+e+">"}),"")};Array.isArray(e)||e instanceof Object||(e=[e]);let p,h="<wfs:GetFeature "+b(r).format({resultType:o?'resultType="hits"':"",format:'outputFormat="'+i+'"'})+("2.0.0"!==r.version&&s?' maxFeatures="'+s+'"':"")+">",d="";if(Array.isArray(e))p="<wfs:Query typeName"+("2.0.0"===r.version?"s":"")+'="{typeName}"'+c()+">{fields}{filter}</wfs:Query>",e.forEach((function(e){d+=p.format({typeName:e,filter:t&&t instanceof n.Z.filter.Filter?t.getText(r.version):"",fields:u()})}));else for(var f in p="",e){p="<wfs:Query typeName"+("2.0.0"===r.version?"s":"")+'="{typeName}"'+c()+">{fields}{filter}</wfs:Query>";let t=e[f];d+=p.format({typeName:f,filter:t&&t instanceof n.Z.filter.Filter?t.getText(r.version):"",fields:u()})}return h+=d+"</wfs:GetFeature>",h},WFGetPropertyValue:function(e,t,r,i){return n.Z.Util.WFSQueryBuilder([e],r,i,"JSON",!1,null,null,t)},WFSFilterBuilder:function(e,t,r){var i="";if(E.isPlainObject(e))i='<{prefix}:Filter><{prefix}:Intersects><fes:ValueReference></fes:ValueReference><{prefix}:Function name="querySingle"><{prefix}:Literal>{clipLayer}</{prefix}:Literal><{prefix}:Literal>{geometryName}</{prefix}:Literal><{prefix}:Literal>{where}</{prefix}:Literal></{prefix}:Function></{prefix}:Intersects></{prefix}:Filter>'.format({prefix:"2.0.0"===t?"fes":"ogc",clipLayer:e.clipLayer,geometryName:e.geometryName,where:e.where});else switch(!0){case!e:break;case Array.isArray(e):var o="<gml:Envelope><gml:lowerCorner>{lowerCorner}</gml:lowerCorner><gml:upperCorner>{upperCorner}</gml:upperCorner></gml:Envelope>".format({lowerCorner:e[0]+" "+e[1],upperCorner:e[2]+" "+e[3]});switch(!0){case"1.0.0"===t:case"1.1.0"===t:i+="<ogc:Filter><ogc:BBOX>"+o+"</ogc:BBOX></ogc:Filter>";break;case"2.0.0"===t:i+="<fes:Filter><fes:BBOX>"+o+"</fes:BBOX></fes:Filter>"}break;case e instanceof n.Z.Feature:switch(!0){case"1.0.0"===t:case"1.1.0"===t:i+="<ogc:Filter><ogc:Intersects><ogc:PropertyName></ogc:PropertyName>"+n.Z.Util.writeGMLGeometry(e,{version:"2.0",srsName:r})+"</ogc:Intersects></ogc:Filter>";break;case"2.0.0"===t:i+="<fes:Filter><fes:Intersects><fes:ValueReference></fes:ValueReference>"+n.Z.Util.writeGMLGeometry(e,{version:"3.2",srsName:r})+"</fes:Intersects></fes:Filter>"}break;default:n.Z.error("Geometra no vlida")}return i},writeGMLGeometry:function(e,t){const r=(t=t||{}).version,i=function(){return t.srsName?' srsName="'+t.srsName+'"':""};var o=function(e){var t;if(0===r.indexOf("3"))for(t=e.toString();t.indexOf(",")>=0;)t=t.replace(","," ");else t=e.map((function(e){return e.join(",")})).join(" ");return t};switch(r){case"3.1.1":break;case"3.2":return!0===(n.Z.feature.Polyline&&e instanceof n.Z.feature.Polyline)?'<gml:LineString srsDimension="2"'+i()+"><gml:posList>"+o(e.geometry)+"</gml:posList></gml:LineString>":'<gml:Polygon srsDimension="2"'+i()+"><gml:exterior><gml:LinearRing><gml:posList>"+o(e.geometry[0])+"</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>";default:return!0===(n.Z.feature.Polyline&&e instanceof n.Z.feature.Polyline)?"<gml:LineString"+i()+"><gml:coordinates>"+o(e.geometry[0])+"</gml:coordinates></gml:LineString>":"<gml:Polygon"+i()+"><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>"+o(e.geometry[0])+"</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs></gml:Polygon>"}},isServiceWorker:function(){return!!navigator.serviceWorker&&!(!navigator.serviceWorker.controller||"activated"!==navigator.serviceWorker.controller.state)},isSameOriginByLocation:function(e,t){var r=0!==e.indexOf("http")&&0!==e.indexOf("//"),n=!r&&e.match(i.Z.url.SPLIT_REGEX);if(n){var o=n[1];r=(o==t.protocol||null==o)&&n[3]==t.hostname;var a=n[4],s=t.port;(80!=a&&""!==a||"80"!=s&&""!==s)&&(r=r&&a==s)}return r},isSameProtocol:function(e,t){if(e.match(/^(\/\/)/i))return!0;var r=/^(https?:\/\/)/i,n=e.match(r);if(n&&n.length>1){var i=t.match(r);if(i&&i.length>1)return n[0].trim()===i[0].trim()}return!1},consoleRegister:function(e){n.Z.isDebug&&console.log(e)},getSorterByProperty:function(e){return function(t,r){return t[e]>r[e]?1:t[e]<r[e]?-1:0}},getSoundexDifference:function(e,t){for(var r=0,n=0;n<e.length;n++)e.charAt(n)===t.charAt(n)&&r++;return r},toAbsolutePath:function(e){var t=document.createElement("a");return t.href=e,t.href},explodeGeometry:function(e){const t=e.origin,r=function(e,n,i){Array.isArray(e)?e.forEach(r):(0===n&&(i[0]=e+t[0]),1===n&&(i[1]=e+t[1]))};return e.geom.forEach(r),e.geom},cloneMappingFunction:function(e){return Array.isArray(e)?e.map(n.Z.Util.cloneMappingFunction):e},isGeometry:function(e){switch(e){case"gml:LinearRingPropertyType":case"gml:PolygonPropertyType":case"gml:MultiPolygonPropertyType":case"gml:MultiSurfacePropertyType":case"gml:LineStringPropertyType":case"gml:MultiLineStringPropertyType":case"gml:PointPropertyType":case"gml:MultiPointPropertyType":case"gml:BoxPropertyType":case"gml:GeometryCollectionPropertyType":case"gml:GeometryAssociationType":case"gml:GeometryPropertyType":case"gml:MultiCurvePropertyType":case"gml:CurvePropertyType":return!0;default:return!1}},compactGeometry:function(e,t){const r=[Number.MAX_VALUE,Number.MAX_VALUE],i=e.map(n.Z.Util.cloneMappingFunction),o=function(e,t){Array.isArray(e)?e.forEach(o):0===t&&e<r[0]?r[0]=e:1===t&&e<r[1]&&(r[1]=e)};i.forEach(o);const a=function(e){return Math.round(e*t)/t};r[0]=a(r[0]),r[1]=a(r[1]);const s=function(e,t,n){Array.isArray(e)?e.forEach(s):(0===t&&(n[0]=a(e-r[0])),1===t&&(n[1]=a(e-r[1])))};return i.forEach(s),{origin:r,geom:i}},isStyleOption:function(e){return S.has(e)},hasStyleOptions:function(e){for(let t of S.values())if(Object.prototype.hasOwnProperty.call(e,t))return!0;return!1},mergeStyles(){const e=Array.from(arguments);return e.some((e=>E.isFunction(e)))?function(t){return Object.assign({},...e.map((e=>E.isFunction(e)?e(t):e)))}:Object.assign({},...e)},formatCoord:function(e,t){return e.toLocaleString(n.Z.Util.getLocaleUserChoice(),{maximumFractionDigits:t})},formatString:function(e,...t){const r=t.length?t:[""];return e.replace(/{(\d+)}/g,(function(e,t){return void 0!==r[t]?r[t]:e}))},getWebWorkerCrossOriginURL:function(e){return new Promise((function(t,r){Object.prototype.hasOwnProperty.call(window,"Worker")?n.Z.Util.isSameOrigin(e)?t(e):n.Z.ajax({url:e,method:"GET",responseType:"text"}).then((function(e){const r=e.data;var n=new Blob([r],{type:"text/javascript"}),i=window.URL.createObjectURL(n);t(i)}),(function(e){r(Error(e))})):r(new Error("No support for service workers"))}))},createSemaphore:function(e=1){let t=0,r=[];return{acquire:function(){return t<e?(t++,Promise.resolve()):new Promise(((e,t)=>{r.push({resolve:e,reject:t})}))},release:function(){if(t--,r.length>0&&t<e){t++,r.shift().resolve()}},purge:function(){let e=r.length;for(let t=0;t<e;t++)r[t].reject("Task has been purged.");return t=0,r=[],e}}},patternFn:function(e){return e=(e=(e=(e=(e=(e=(e=e.replace(/[^a-z\d]/gi,"\\$&")).replace(/(a|)/gi,"(a|)")).replace(/(e|)/gi,"(e|)")).replace(/(i|)/gi,"(i|)")).replace(/(o|)/gi,"(o|)")).replace(/(u||)/gi,"(u||)")).replace(/n/gi,"(n|)")}};String.prototype.format=function(){var e=this.toString();if(!arguments.length)return e;var t=typeof arguments[0];for(var r in t="string"===t||"number"===t?arguments:arguments[0])e=e.replace(RegExp("\\{"+r+"\\}","gi"),t[r]);return e};const b=function(e){var t='xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"  service="WFS" {resultType} {format} ';switch(e.version){case"1.0.0":case"1.1.0":t+='xmlns:gml="http://www.opengis.net/gml" xmlns:wfs="http://www.opengis.net/wfs" ';break;case"2.0.0":t+='xmlns:wfs="http://www.opengis.net/wfs/2.0" xmlns:gml="http://www.opengis.net/gml/3.2" '}for(var r in e)"string"==typeof e[r]&&r.indexOf("gml")<0&&e[r].indexOf("wfs")<0&&(t+=r+'="'+e[r]+'" ');return t};var C=function(e,t,r){return r(e.getBoundingClientRect(),t.getBoundingClientRect())};window.HTMLElement&&(HTMLElement.prototype.colliding=function(e){return C(this,e,(function(e,t){return!(e.top>t.bottom||e.right<t.left||e.bottom<t.top||e.left>t.right)}))},HTMLElement.prototype.containing=function(e){C(this,e,(function(e,t){return!(e.left<=t.left&&t.left<e.width&&e.top<=t.top&&t.top<e.height)}))},HTMLElement.prototype.inside=function(e){return C(this,e,(function(e,t){return t.top<=e.top&&e.top<=t.bottom&&t.top<=e.bottom&&e.bottom<=t.bottom&&t.left<=e.left&&e.left<=t.right&&t.left<=e.right&&e.right<=t.right}))});const L=E},9753:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(688),i=r(330),o=r(7497),a=r(52);n.Z.control=n.Z.control||{},n.Z.Control=o.Z;class s extends o.Z{constructor(){super(...arguments);const e=this;e.div.classList.add(e.CLASS),e.apiAttribution="",e.mainDataAttribution=null,e.dataAttributions=[],e.options.dataAttributions&&(e.dataAttributions=e.options.dataAttributions instanceof Array?e.options.dataAttributions:[e.options.dataAttributions])}getClassName(){return"tc-ctl-attrib"}register(e){const t=this,r=o.Z.prototype.register.call(t,e);t.apiAttribution=t.map.options.attribution||t.apiAttribution;var n=function(e){if(e){var r=e.getAttribution();if(r)if(/IDENA/.test(r.name)||/Tracasa Instrumental/.test(r.name))t.mainDataAttribution={name:"IDENA",site:"https://idena.navarra.es/"};else{for(var n=!1,i=0;i<t.dataAttributions.length;i++)if(r.name===t.dataAttributions[i].name){n=!0;break}n||t.dataAttributions.push(r)}}},s=function(e){if(e){if(!(e instanceof a.Z)||function(){if(e.map.workLayers.length>0){const r=e.map.workLayers.slice().reverse();for(var t=0;t<r.length;t++){const n=r[t];if(n.url==e.url&&n.getVisibility())return!1}return!0}return!0}()){var r=e.getAttribution();if(r){var n=t.dataAttributions.reduce((function(e,t,n){return t.name===r.name?n:e}),-1);const o=function(e){return(/IDENA/.test(r.name)||/Tracasa Instrumental/.test(r.name))&&(/IDENA/.test(e)||/Tracasa Instrumental/.test(e))||r.name===e};if(t.map.baseLayer&&t.map.baseLayer.wrap.getAttribution()&&o(t.map.baseLayer.wrap.getAttribution().name)&&e.parent.id!==t.map.baseLayer.id)return;if(t.map.workLayers.filter((function(e){return e.type===i.Z.layerType.WMS||e.type===i.Z.layerType.WMTS})).some((function(e){var t=e.wrap.getAttribution();return t&&o(t.name)})))return;n>-1?t.dataAttributions.splice(n,1):(/IDENA/.test(r.name)||/Tracasa Instrumental/.test(r.name))&&(t.mainDataAttribution=null)}}}};return e.loaded((function(){e.baseLayer.wrap.getAttribution&&(n(e.baseLayer.wrap),t.render())})),e.on(i.Z.event.LAYERADD,(function(e){const r=e.layer;!r.isBase&&r.wrap.getAttribution&&r.wrap.getAttribution()&&(n(r.wrap),t.render())})),e.on(i.Z.event.BEFOREBASELAYERCHANGE+" "+i.Z.event.OVERVIEWBASELAYERCHANGE,(function(e){const r=e.type,o=e.newLayer,a=e.oldLayer;i.Z.event.OVERVIEWBASELAYERCHANGE.indexOf(r)>-1&&(t.ignoreLayer=o),a&&a.wrap.getAttribution&&s(a.wrap),o&&o.wrap.getAttribution&&n(o.wrap),t.render()})),e.on(i.Z.event.LAYERREMOVE,(function(e){const r=e.layer;r.wrap.getAttribution&&(s(r.wrap),t.render())})),e.on(i.Z.event.TERRAINPROVIDERADD,(function(e){const r=e.terrainProvider;r.getAttribution&&(n(r),t.render())})),e.on(i.Z.event.TERRAINPROVIDERREMOVE,(function(e){const r=e.terrainProvider;r.getAttribution&&(s(r),t.render())})),e.on(i.Z.event.LAYERVISIBILITY,(function(e){const r=e.layer;t.ignoreLayer!==r&&r.wrap.getAttribution&&(r.getVisibility()?n(r.wrap):s(r.wrap),t.render())})),r}async loadTemplates(){const e=await r.e(3095).then(r.bind(r,3095));this.template=e.default}render(e){var t;const r=this;return r._set1stRenderPromise(r.renderData({api:"function"==typeof r.apiAttribution?r.apiAttribution.apply(r):r.getLocaleString(r.apiAttribution),mainData:r.mainDataAttribution,otherData:r.dataAttributions,isCollapsed:!r.div.querySelector("."+r.CLASS+"-other")||r.div.querySelector("."+r.CLASS+"-other").classList.contains(i.Z.classes.COLLAPSED),lang:null===(t=r.map)||void 0===t?void 0:t.options.locale},(function(){const t=r.div.querySelector("."+r.CLASS+"-cmd");t&&t.addEventListener(i.Z.event.CLICK,(function(){r.toggleOtherAttributions()}),{passive:!0}),"function"==typeof e&&e()})))}toggleOtherAttributions(){this.div.querySelector("."+this.CLASS+"-other").classList.toggle(i.Z.classes.COLLAPSED)}}n.Z.control.Attribution=s;const l=s},7687:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var n=r(688),i=r(330),o=r(8239),a=r(4115),s=r(8197);n.Z.control=n.Z.control||{};const l=function(){var e=this;o.default.apply(e,arguments),e.layerInfos={},e._cssClasses={LOAD_CRS_BUTTON:e.CLASS+"-crs-btn-load",CRS_DIALOG:e.CLASS+"-crs-dialog",CRS_LIST:e.CLASS+"-crs-list",VIEW_BTN:e.CLASS+"-btn-view",CURRENT_CRS_NAME:e.CLASS+"-cur-crs-name",CURRENT_CRS_CODE:e.CLASS+"-cur-crs-code",TREE:e.CLASS+"-tree",DETAILS:"tc-details",GRID:"tc-grid"},e._dialogDiv=n.Z.Util.getDiv(e.options.dialogDiv),window.$&&(e._$dialogDiv=$(e._dialogDiv)),e.options.dialogDiv||document.body.appendChild(e._dialogDiv),e._dialogDiv.addEventListener(i.Z.event.CLICK,n.Z.EventTarget.listenerBySelector("button:not(.tc-modal-close)",(function(t){if(t.target.classList.contains(e._cssClasses.LOAD_CRS_BUTTON))return void e.loadFallbackProjections();n.Z.Util.closeModal();const r=t.target,o=r.dataset.crsCode,a=e._dialogDiv.querySelector("."+e.CLASS+"-crs-dialog");a.classList.add(i.Z.classes.HIDDEN);const s=e.getLayer(a.dataset.layerId);if(s)if(o)n.Z.loadProjDef({crs:o,callback:function(){e.map.setProjection({crs:o,baseLayer:s})}});else{const t=e.getFallbackLayer(r.dataset.fallbackLayerId);t&&e.map.setBaseLayer(t)}})),{passive:!0})};n.Z.inherit(l,o.default),function(){var e=l.prototype;e.CLASS="tc-ctl-bms";const t=function(e,t){for(;e&&!e.matches(t);)e=e.parentElement;return e},c=function(e,r){const n=this;var o=!0,a=e.target,s=n.getLayer(t(a,"li").dataset.layerId);if(n.options.dialogMore&&t(a,"."+n.CLASS+"-more-dialog")){const e=n.div.querySelectorAll("input[type=radio]");for(var l=0,c=e.length;l<c;l++){const r=n.getLayer(t(e[l],"li").dataset.layerId);if(r&&!0==(r.id===s.id))s=r}}if(s!=n.map.getBaseLayer())if(s.mustReproject)if(n.map.on3DView){if(!s.getFallbackLayer())return n._currentSelection.checked=!0,void e.stopPropagation();if(s.getFallbackLayer()){const e=s.getFallbackLayer();e&&e.getCapabilitiesPromise().then((function(){e.isCompatible(n.map.getCRS())&&n.map.setBaseLayer(s)})),o=!0}}else{n._currentSelection&&(n._currentSelection.checked=!0);const e={layer:s},t=s.getFallbackLayer();t?t.getCapabilitiesPromise().then((function(){t.isCompatible(n.map.getCRS())&&(e.fallbackLayer=t),n.showProjectionChangeDialog(e)})):n.showProjectionChangeDialog(e),o=!1}else(s.type===i.Z.layerType.WMS||s.type===i.Z.layerType.WMTS&&s.getProjection()!==n.map.crs)&&s.setProjection({crs:n.map.crs}),n.map.setBaseLayer(s);this._currentSelection&&(this._currentSelection.checked=!0),r&&r(o)};e.register=async function(e){const t=this,r=await o.default.prototype.register.call(t,e);return t.div.querySelector(`.${t._cssClasses.VIEW_BTN}`).addEventListener(i.Z.event.CLICK,(function(e){t.toggleView(),e.target.blur()}),{passive:!0}),t.options.dialogMore&&e.on(i.Z.event.VIEWCHANGE,(function(){t._getMoreBaseLayers()})),e.on(i.Z.event.BASELAYERCHANGE+" "+i.Z.event.PROJECTIONCHANGE+" "+i.Z.event.VIEWCHANGE,(function(e){t.update(t.div,e.layer)})),t.div.addEventListener("change",n.Z.EventTarget.listenerBySelector("input[type=radio]",(function(e){"moreLayers"===e.target.value?t.showMoreLayersDialog():c.call(t,e),e.stopPropagation()}))),r},e.loadTemplates=async function(){const t=r.e(8291).then(r.bind(r,8291)),n=r.e(638).then(r.bind(r,638)),i=r.e(3080).then(r.bind(r,3080)),o={};o[e.CLASS]=(await t).default,o[e.CLASS+"-node"]=(await n).default,o[e.CLASS+"-dialog"]=(await i).default,this.template=o},e.render=function(e){const t=this,r=o.default.prototype.render.call(t,e,n.Z.Util.extend({},t.options,{controlId:t.id}));return t.getRenderedHtml(t.CLASS+"-dialog",null,(function(e){if(t._dialogDiv.innerHTML=e,t.options.dialogMore){const e=t._dialogDiv.querySelector("."+t.CLASS+"-more-dialog");e.querySelector(`.${t._cssClasses.VIEW_BTN}`).addEventListener(i.Z.event.CLICK,(function(e){t.toggleMoreLayersDialogView(),e.target.blur(),e.stopPropagation()}),{passive:!0}),e.addEventListener("change",n.Z.EventTarget.listenerBySelector("input[type=radio]",(function(e){c.call(t,e,(function(e){e&&n.Z.Util.closeModal()})),e.stopPropagation()})))}})),r},e.update=async function(e,t){const r=this;e=e||r.div,await(r._moreBaseLayersPromise||r._getMoreBaseLayers()),Array.from(e.querySelectorAll(`ul.${r.CLASS}-branch li`)).forEach((function(e,n,o){const a=r.getLayer(e.dataset.layerId);if(a){const n=t||r.map.baseLayer,s=e.querySelector("input[type=radio]"),l=a.getFallbackLayer&&a.getFallbackLayer();let c=n&&(n===a||n.id===a.id);if(!c){const t=l&&o.filter((t=>t!==e)).some((e=>e.dataset.layerId===l.id));c=!t&&n&&(n===l||l&&n.id===l.id)}r.map.on3DView&&a.mustReproject&&l?l.getCapabilitiesPromise().then((function(){var t=!a.getFallbackLayer().isCompatible(r.map.getCRS());s.checked=c,t?(s.classList.add(i.Z.classes.DISABLED),e.setAttribute("title",r.map.on3DView?r.getLocaleString("notAvailableTo3D"):r.getLocaleString("reprojectionNeeded"))):(s.classList.remove(i.Z.classes.DISABLED),e.removeAttribute("title"))})):(s.checked=c,a.mustReproject?(s.classList.add(i.Z.classes.DISABLED),e.setAttribute("title",r.map.on3DView?r.getLocaleString("notAvailableTo3D"):r.getLocaleString("reprojectionNeeded"))):(s.classList.remove(i.Z.classes.DISABLED),e.removeAttribute("title"))),c&&(r._currentSelection=s)}})),r.updateScale()},e.updateLayerTree=function(e){const t=this;if(e.isBase&&(!e.options.stealth||e.firstOption&&!e.firstOption.options.stealth)){o.default.prototype.updateLayerTree.call(t,e);const r=e.firstOption||e;r!==e&&(t.layerTrees[r.id]=r.getTree()),r.getInfo&&(t.layerInfos[r.id]=r.getInfo(r.names[0])),t.getRenderedHtml(t.CLASS+"-node",{layer:t.layerTrees[r.id],info:t.layerInfos[r.id],controlId:t.id}).then((function(e){const n=(new DOMParser).parseFromString(e,"text/html").body.firstChild;var i=n.dataset.layerUid;const o=t.div.querySelector("."+t.CLASS+"-branch"),a=o.querySelector('li[data-layer-uid="'+i+'"]');if(a)a.innerHTML=n.innerHTML;else{n.dataset.layerId=r.id;const e=t.map.baseLayers.map((e=>e.firstOption||e)).filter((e=>e&&!e.stealth)).map((e=>e.id)),i=e.indexOf(r.id);let a,s=!1;for(a=i-1;a>=0;a--){const t=o.querySelector(`li[data-layer-id="${e[a]}"]`);if(t){t.insertAdjacentElement("afterend",n),s=!0;break}}if(!s){for(a=i+1;a<e.length;a++){const t=o.querySelector(`li[data-layer-id="${e[a]}"]`);if(t){t.insertAdjacentElement("beforebegin",n),s=!0;break}}if(!s){const e=o.querySelector(`.${t.CLASS}-more-node`);e?e.parentElement.insertAdjacentElement("beforebegin",n):o.appendChild(n)}}t.update()}})).catch((function(e){n.Z.error(e)}))}},e.updateLayerOrder=function(e,t,r){},e.removeLayer=function(e){const t=this;if(e.isBase){const i=t.div.querySelector("."+t.CLASS+"-branch").querySelectorAll("li");for(var r=0,n=i.length;r<n;r++){const t=i[r];if(t.dataset.layerId===e.id){t.parentElement.removeChild(t);break}}}},e.onErrorLayer=function(e){const t=this;e.isBase&&!e.options.stealth&&t.map.toast(t.getLocaleString("baseLayerNotAvailable",{mapName:e.title}),{type:i.Z.msgType.ERROR})},e.getFallbackLayer=function(e){const t=this,r=function(t){return t.fallbackLayer&&t.fallbackLayer.id===e};let n=t.map.baseLayers.filter(r),i=n.length?n[0].fallbackLayer:null;return!i&&t._moreBaseLayers&&(n=t._moreBaseLayers.filter(r),i=n.length?n[0].fallbackLayer:null),i},e.loadFallbackProjections=function(){const e=this;e._dialogDiv.querySelector("."+e._cssClasses.CRS_DIALOG).querySelectorAll("ul."+e._cssClasses.CRS_LIST+" li").forEach((function(t){t.classList.remove(i.Z.classes.HIDDEN),t.querySelector("button."+e._cssClasses.LOAD_CRS_BUTTON)&&t.classList.add(i.Z.classes.HIDDEN)}))},e.showProjectionChangeDialog=function(e){const t=this,r=(e=e||{}).layer,o=t._dialogDiv.querySelector("."+t.CLASS+"-crs-dialog"),a=o.querySelector(".tc-modal-body");a.classList.add(i.Z.classes.LOADING);const s=r.getCompatibleCRS();o.classList.remove(i.Z.classes.HIDDEN),o.dataset.layerId=r.id;const l=o.querySelector("ul."+t.CLASS+"-crs-list");l.innerHTML="",t.map.loadProjections({crsList:t.map.getCompatibleCRS({layers:t.map.workLayers.concat(r),includeFallbacks:!0}),orderBy:"name"}).then((function(r){var o=!1;const c=document.createDocumentFragment();if(r.forEach((function(r){const a=document.createElement("li"),l=document.createElement("button");l.setAttribute("type","button"),0===s.filter((function(e){return n.Z.Util.CRSCodesEqual(e,r.code)})).length?(o=!0,l.innerHTML=r.name+" ("+r.code+")",e.layer.fallbackLayer&&(l.dataset.fallbackLayerId=e.layer.fallbackLayer.id),l.dataset.crsCode=r.code,l.classList.add(i.Z.classes.WARNING),a.classList.add(i.Z.classes.HIDDEN)):(l.innerHTML=t.getLocaleString("changeMapToCrs",{crs:r.name+" ("+r.code+")"}),l.dataset.crsCode=r.code),a.appendChild(l),c.appendChild(a)})),e.fallbackLayer){const r=document.createElement("li"),n=document.createElement("button");n.setAttribute("type","button"),n.innerHTML=t.getLocaleString("reprojectOnTheFly"),n.dataset.fallbackLayerId=e.fallbackLayer.id,r.appendChild(n),c.appendChild(r)}if(o){const e=document.createElement("li"),r=document.createElement("button");r.setAttribute("type","button"),r.classList.add(t._cssClasses.LOAD_CRS_BUTTON),r.innerHTML=t.getLocaleString("showOnTheFlyProjections"),e.appendChild(r),c.appendChild(e)}l.appendChild(c),a.classList.remove(i.Z.classes.LOADING)})),o.querySelector("."+t.CLASS+"-name").innerHTML=r.title||r.name,n.Z.Util.showModal(o)},e.showMoreLayersDialog=function(){const e=this,t=e._dialogDiv.querySelector("."+e.CLASS+"-more-dialog");t.classList.toggle(i.Z.classes.THREED,!!e.map.on3DView);const r=t.querySelector(".tc-modal-body");r.innerHTML="",r.classList.add(i.Z.classes.LOADING),t.classList.remove(i.Z.classes.HIDDEN),n.Z.Util.showModal(t,{closeCallback:function(){this.update().then((()=>this._currentSelection.checked=!0))}.bind(e)});const o=e.div.querySelector(`.${e._cssClasses.TREE}`).classList.contains(e._cssClasses.GRID),a=t.querySelector(`.${e._cssClasses.VIEW_BTN}`);a.classList.toggle(e._cssClasses.DETAILS,o),a.classList.toggle(e._cssClasses.GRID,!o),a.setAttribute("title",e.getLocaleString(o?"showDetailsView":"showGridView"));const s=t=>{if(t){const r=t.getInfo?t.getInfo(t.names[0]):null;return{layer:t,info:r,controlId:e.id}}return{}},l=function(){const n=t.querySelector(`.${e._cssClasses.VIEW_BTN}`).classList.contains(e._cssClasses.DETAILS),o=e._moreBaseLayers.slice();for(var a=0,l=o.length;a<l;a++)o[a]||(o[a]=!1);e.getRenderedHtml(e.CLASS,{baseLayers:o.map(s),controlId:e.id},(function(t){r.innerHTML=t;const o=r.querySelector(`.${e._cssClasses.TREE}`);o.classList.toggle(e._cssClasses.DETAILS,!n),o.classList.toggle(e._cssClasses.GRID,n),r.classList.remove(i.Z.classes.LOADING),e.update(r)}))};e._getMoreBaseLayers((function(t){if(r.classList.contains(i.Z.classes.LOADING))l();else{const n=r.querySelector(`li.${e.CLASS}-node:nth-child(${t+1})`),i=e._moreBaseLayers[t];i&&e.getRenderedHtml(e.CLASS+"-node",s(i),(function(t){n.insertAdjacentHTML("beforebegin",t),n.remove(),e.update(r)}))}})).then((function(){l()}))};const u=function(e,t){const r=t.querySelector(`.${e._cssClasses.TREE}`);if(r){const n=t.querySelector(`.${e._cssClasses.VIEW_BTN}`),i=n.classList.toggle(e._cssClasses.DETAILS);n.setAttribute("title",e.getLocaleString(n.classList.toggle(e._cssClasses.GRID)?"showGridView":"showDetailsView")),r.classList.remove(e._cssClasses.DETAILS,e._cssClasses.GRID),setTimeout((()=>r.classList.add(i?e._cssClasses.GRID:e._cssClasses.DETAILS)),20)}};e.toggleView=function(){u(this,this.div)},e.toggleMoreLayersDialogView=function(){const e=this;e._dialogDiv&&u(e,e._dialogDiv)},e.getLayer=function(e){const t=this;return t.map&&(t.map.getLayer(e)||t._moreBaseLayers&&t._moreBaseLayers.find((t=>t.id===e)))};const p=function(e){return Promise.all([e.getCapabilitiesPromise(),e.getFallbackLayer()?e.getFallbackLayer().getCapabilitiesPromise():Promise.resolve()])};e._getMoreBaseLayers=function(e){const t=this;if(t._moreBaseLayers||t._moreBaseLayersPromise){if(t._moreBaseLayers)return new Promise((function(e,r){Promise.all(t._moreBaseLayers.filter((function(e){return e.type===i.Z.layerType.WMS||e.type===i.Z.layerType.WMTS})).map((function(e){return t.map.on3DView?p(e):e.getCapabilitiesPromise()}))).then((function(){t._moreBaseLayers=t._moreBaseLayers.map((function(e){if(e.type===i.Z.layerType.WMTS){var r=e.wrap.getCompatibleMatrixSets(t.map.getCRS())[0];e.mustReproject=!r}else e.type===i.Z.layerType.WMS&&(e.mustReproject=!e.isCompatible(t.map.getCRS()));return t.map.on3DView&&e.mustReproject&&e.getFallbackLayer&&e.getFallbackLayer()?(e.mustReproject=!e.getFallbackLayer().isCompatible(t.map.getCRS()),e):e})),e(t._moreBaseLayers)}))}))}else t._moreBaseLayersPromise=new Promise((function(r,o){var l=n.Z.Cfg.availableBaseLayers.filter((function(e){return-1===n.Z.Cfg.availableBaseLayers.filter((e=>e.fallbackLayer)).map((e=>e.fallbackLayer)).indexOf(e.id)})).map((function(e){return e.type===i.Z.layerType.WMS||e.type===i.Z.layerType.WMTS?new a.Z(e):e.type===i.Z.layerType.VECTOR?new s.Z(e):void 0}));t._moreBaseLayers=new Array(l.length);const c=async function(r){const o=this;if(o.map=t.map,o.isBase=o.options.isBase=!0,o.type===i.Z.layerType.WMTS){await o.getCapabilitiesPromise();var a=o.wrap.getCompatibleMatrixSets(t.map.getCRS())[0];o.mustReproject=!a}else o.type===i.Z.layerType.WMS&&(await o.getCapabilitiesPromise(),o.mustReproject=!o.isCompatible(t.map.getCRS()));if(t.map.on3DView&&o.mustReproject&&o.getFallbackLayer){const e=o.getFallbackLayer();e&&(await e.getCapabilitiesPromise(),o.mustReproject=!e.isCompatible(t.map.getCRS()))}t._moreBaseLayers.splice(r,1,o),n.Z.Util.isFunction(e)&&e(r)};Promise.all(l.map((function(r,o){return new Promise((function(a,s){r.type===i.Z.layerType.WMS||r.type===i.Z.layerType.WMTS?(t.map.on3DView?p(r):r.getCapabilitiesPromise()).then((function(){c.call(r,o).then(a)}),(function(r){t._moreBaseLayers.splice(o,1,null),n.Z.Util.isFunction(e)&&e(o),a()})):c.call(r,o).then(a)}))}))).finally((function(){t._moreBaseLayers=t._moreBaseLayers.filter((function(e){return null!==e})),r(t._moreBaseLayers)}))}));return t._moreBaseLayersPromise}}(),n.Z.control.BasemapSelector=l;const c=l},3041:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var n=r(688),i=r(6994);n.Z.control=n.Z.control||{},n.Z.control.CacheBuilder=i.default;const o=n.Z.control.CacheBuilder},5669:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(688),i=r(8834),o=r(7497);n.Z.control=n.Z.control||{},n.Z.wrap=i.Z;const a=function(){var e=this;o.Z.apply(e,arguments),e.options&&e.options.callback&&(e.callback=e.options.callback),e.wrap=new n.Z.wrap.control.Click(e)};var s;n.Z.inherit(a,o.Z),(s=a.prototype).CLASS="tc-ctl-click",s.register=function(e){return this.wrap.register(e),o.Z.prototype.register.call(this,e)},s.activate=function(){o.Z.prototype.activate.call(this),this.wrap.activate()},s.deactivate=function(){this.wrap.deactivate(),o.Z.prototype.deactivate.call(this)},s.callback=function(e,t){console.log("[Click]["+e[0]+", "+e[1]+"]["+t[0]+", "+t[1]+"]")},n.Z.control.Click=a;const l=a},3678:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var n=r(688),i=r(7497);n.Z.control=n.Z.control||{};const o=function(){var e=this;i.Z.apply(e,arguments),e.controlOptions=e.options.controls||[],e.ctlCount=e.controlOptions instanceof Array?e.controlOptions.length:Object.keys(e.controlOptions).length,e.defaultSelection=e.options.defaultSelection,e._ctlPromises=new Array(e.ctlCount)};var a;n.Z.inherit(o,i.Z),(a=o.prototype).register=async function(e){const t=this,r=i.Z.prototype.register.call(t,e);return t.uids=new Array(t.ctlCount),t.uids.forEach((function(e,r,n){n[r]=t.getUID()})),await Promise.all([r,t.renderPromise()]),await t.onRender()},a.onRender=function(){return Promise.resolve(this)},a.render=function(e){},a.getControl=function(e){var t=this._ctlPromises[e];return t||Promise.reject(Error("No control found"))},a.getControls=function(){return Promise.all(this._ctlPromises)},a.onControlDisable=function(e){},a.onControlEnable=function(e){},n.Z.control.Container=o;const s=o},9524:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var n=r(688),i=r(3678);n.Z.control=n.Z.control||{};const o=function(){var e=this;if(i.default.apply(e,arguments),!Array.isArray(e.controlOptions)){console.log("Gestionamos config de controlContainer antiguo");var t=[];Object.keys(e.controlOptions).forEach((r=>{const n=e.controlOptions[r];var i={position:n.side};i[r]=n.options,t.push(i)})),e.controlOptions=t}};var a;n.Z.inherit(o,i.default),(a=o.prototype).CLASS="tc-ctl-cctr",a.POSITION={LEFT:"left",RIGHT:"right"},a.SIDE=a.POSITION,a.onRender=async function(){const e=this;e.controlOptions.forEach((function(t,r){const i=Object.keys(t).find((e=>["position","index"].indexOf(e)<0));e._ctlPromises[r]=e.map.addControl(i,n.Z.Util.extend({id:e.uids[r],div:e.div.querySelector("."+e.CLASS+"-elm-"+r).querySelector("div")},t[i]))})),await Promise.all(e._ctlPromises);for(var t=0,r=arguments.length;t<r;t++){var i=arguments[t];i.containerControl=e}return e},a.loadTemplates=async function(){const e=r.e(6869).then(r.bind(r,6869)),t=r.e(6717).then(r.bind(r,6717)),n={};n[a.CLASS]=(await e).default,n[a.CLASS+"-node"]=(await t).default,this.template=n},a.render=function(e){const t=this;return t._set1stRenderPromise(t.renderData({controls:Object.keys(t.controlOptions).map((function(e,r){return n.Z.Util.extend(t.controlOptions[e],{index:r})}))},e))},a.addControl=async function(e,t){const r=this;t.position=t.position||t.side||r.POSITION.LEFT;const i=++r.ctlCount;await r.renderPromise();const o=await r.getRenderedHtml(r.CLASS+"-node",{index:i});var a=document.createElement("template");return a.innerHTML=o.trim(),r.div.querySelector("ul."+r.CLASS+"-"+t.position).appendChild(a.content?a.content.firstChild:a.firstChild),await r.map.addControl(e,n.Z.Util.extend({id:r.getUID(),div:r.div.querySelector("."+r.CLASS+"-elm-"+i).querySelector("div")},t))},a.addElement=function(e){const t=this;e.position=e.position||e.side||t.POSITION.LEFT;var r=document.createElement("li");r.setAttribute("class",t.CLASS+"-elm "+t.CLASS+"-elm-"+t.ctlCount+++" "),t.div.querySelector("ul."+t.CLASS+"-"+e.position).appendChild(r);var n=r.appendChild(e.htmlElement);return n.setAttribute("class",n.getAttribute("class")+" tc-ctl"),n},n.Z.control.ControlContainer=o;const s=o},6188:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var n=r(688),i=r(330),o=r(9967),a=r(268),s=r(7292);function l(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}function c(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,p(e,t,"get"))}function u(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,p(e,t,"set"),r),r}function p(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}n.Z.control=n.Z.control||{};var h=new WeakMap;class d extends s.default{constructor(){super(...arguments),l(this,h,{writable:!0,value:void 0});const e=this;e.div.classList.remove(super.CLASS),e.div.classList.add(e.CLASS),e.crs="",e.xy=[0,0,0],e.latLon=[0,0,0],e.x=0,e.y=0,e.lat=0,e.lon=0,e.units=i.Z.units.METERS,e.isGeo=!1,e.allowReprojection=!Object.prototype.hasOwnProperty.call(e.options,"allowReprojection")||e.options.allowReprojection,u(e,h,{CRS:e.CLASS+"-crs",GEOCRS:e.CLASS+"-geocrs",MAIN:e.CLASS+"-main",ALTERNATE:e.CLASS+"-alt",XY:e.CLASS+"-xy",X:e.CLASS+"-x",Y:e.CLASS+"-y",LATLON:e.CLASS+"-latlon",LAT:e.CLASS+"-lat",LON:e.CLASS+"-lon",ELEVATION:e.CLASS+"-elevation",ELEVATION_CONTAINER:e.CLASS+"-elev-container",THREEDMARKER:e.CLASS+"-threed"}),e.geoCrs=e.options.geoCrs||o.Z.geoCrs,e.wrap=new n.Z.wrap.control.Coordinates(e)}getClassName(){return"tc-ctl-coords"}async register(e){const t=this;return await super.register.call(t,e),t.crs=t.map.crs,t.clear(),e.on(i.Z.event.VIEWCHANGE,(function(e){const r=e.view;if(r===i.Z.view.PRINTING)return;const n=function(e){t.isPointerOver(e)||t.clear()};r===i.Z.view.THREED?(t.isGeo=!0,t.units=i.Z.units.DEGREES,t.crs=t.map.view3D.crs,t.map.view3D.container.addEventListener("mouseout",n),t.map.view3D.on(i.Z.event.MOUSEMOVE,(function(e){if(e){if(a.Z.detectMobile()&&(t.clear(),t.coordsToClick({coordinate:[e.lon,e.lat,e.ele],cssClass:t._cssClasses.THREEDMARKER})),t.latLon=[e.lat,e.lon],e.ele>0){var r=a.Z.getMapLocale(t.map);t.latLon.push(e.ele.toLocaleString(r)+"m")}t.update()}else t.clear()}))):r===i.Z.view.DEFAULT&&(t.isGeo=t.map.wrap.isGeo(),t.units=i.Z.units.METERS,t.crs=t.map.crs,t.map.view3D&&t.map.view3D.container.removeEventListener("mouseout",n)),t.map.view3D&&(t.geoCrs=t.map.view3D.crs,t.render())})),e.loaded((function(){t.wrap.register(e).then((function(){t.render((function(){t.clear()}))})),a.Z.detectMobile()&&t.renderPromise().then((function(){t.getLayer(),t.activateCoords()})),e.on(i.Z.event.PROJECTIONCHANGE,(function(r){e.on3DView||(t.isGeo=e.wrap.isGeo(),t.crs=r.newCrs,t.render())})),t.map.wrap.getViewport().then((function(e){t.renderPromise().then((function(){e.addEventListener(i.Z.event.MOUSEMOVE,(function(e){t.map.on3DView||t.onMouseMove(e)})),e.addEventListener(i.Z.event.MOUSELEAVE,(function(e){t.onMouseLeave(e)}))}))}))})),t}async loadTemplates(){const e=this,t=r.e(7007).then(r.bind(r,7007)),n=r.e(1008).then(r.bind(r,1008)),i={};i[e.CLASS]=(await t).default,i[e.CLASS+"-dialog"]=(await n).default,e.template=i}async render(e){const t=this,r=t.getRenderedHtml(t.CLASS+"-dialog",null);t._set1stRenderPromise(r);const o=await r;t._dialogDiv.innerHTML=o,await n.Z.Control.prototype.renderData.call(t,{x:t.x,y:t.y,lat:t.lat,lon:t.lon,ele:t.isGeo&&t.latLon.length>2?t.latLon[2]:!t.isGeo&&t.xy.length>2?t.xy[2]:null,crs:t.crs,geoCrs:t.geoCrs,isGeo:t.isGeo,showGeo:!t.isGeo&&t.options.showGeo,allowReprojection:t.allowReprojection});const s=t.div.querySelector("button."+c(t,h).CRS);s&&s.addEventListener(i.Z.event.CLICK,(function(e){t.showProjectionChangeDialog()}),{passive:!0});const l=t.div.querySelector('sitna-button[icon="close"]');a.Z.detectMobile()?(l.addEventListener("click",(function(){t.div.classList.add(i.Z.classes.HIDDEN),t.clear()})),l.style.display=""):(t.div.classList.remove(i.Z.classes.HIDDEN),t.div.style.visibility="visible",l.style.display="none"),a.Z.isFunction(e)&&e()}onMouseMove(e){this.wrap.onMouseMove(e)}onMouseLeave(e){const t=this;setTimeout((function(){t.isPointerOver(e)||(t.div.style.visibility="hidden",t.clear())}),200)}isPointerOver(e){const t=this.div.getBoundingClientRect();return t.left<=e.clientX&&t.left+t.width>=e.clientX&&t.top<=e.clientY&&t.top+t.height>=e.clientY}update(){const e=this;e.renderPromise().then((function(){!e.isGeo&&e.options.showGeo&&(e.latLon=a.Z.reproject(e.xy,e.crs,e.geoCrs).reverse());const t=e.div.querySelector(`.${c(e,h).MAIN}`),r=t.querySelector(`.${c(e,h).XY}`),n=t.querySelector(`.${c(e,h).LATLON}`);if(r.classList.toggle(i.Z.classes.HIDDEN,e.isGeo),n.classList.toggle(i.Z.classes.HIDDEN,!e.isGeo),(e.isGeo||e.options.showGeo)&&(e.lat=a.Z.formatCoord(e.latLon[0],i.Z.DEGREE_PRECISION),e.lon=a.Z.formatCoord(e.latLon[1],i.Z.DEGREE_PRECISION)),e.isGeo?(n.querySelector(`.${c(e,h).LAT}`).innerHTML=e.lat,n.querySelector(`.${c(e,h).LON}`).innerHTML=e.lon,n.querySelector(`.${c(e,h).ELEVATION_CONTAINER}`).classList.toggle(i.Z.classes.HIDDEN,e.latLon.length<=2)||(e.ele=e.latLon[2],n.querySelector(`.${c(e,h).ELEVATION}`).innerHTML=e.ele)):(e.x=a.Z.formatCoord(e.xy[0],i.Z.METER_PRECISION),e.y=a.Z.formatCoord(e.xy[1],i.Z.METER_PRECISION),e.div.querySelector(`.${c(e,h).X}`).innerHTML=e.x,e.div.querySelector(`.${c(e,h).Y}`).innerHTML=e.y,r.querySelector(`.${c(e,h).ELEVATION_CONTAINER}`).classList.toggle(i.Z.classes.HIDDEN,e.xy.length<=2)||(e.ele=e.xy[2],r.querySelector(`.${c(e,h).ELEVATION}`).innerHTML=e.ele)),!e.isGeo&&e.options.showGeo){const t=e.div.querySelector(`.${c(e,h).ALTERNATE}`);t.querySelector(`.${c(e,h).LAT}`).innerHTML=e.lat,t.querySelector(`.${c(e,h).LON}`).innerHTML=e.lon}a.Z.detectMobile()||(e.div.classList.remove(i.Z.classes.HIDDEN),e.div.style.visibility="visible")}))}clear(){const e=this;e.div.classList.add(i.Z.classes.HIDDEN),e.div.style.visibility="hidden",delete e.currentCoordsMarker,e.getLayer().then((function(e){e.features.length&&e.clearFeatures()}))}deactivateCoords(){const e=this;e.div.classList.add(i.Z.classes.HIDDEN),e.clear(),e.wrap.coordsDeactivate()}activateCoords(){this.wrap.coordsActivate()}getCoords(){const e=this,t=e.map.getControlsByClass("TC.control.Popup");(null==t?void 0:t.length)>0&&t[0].isVisible()?e.coordsToPopup(t[0]):(e.updateCoordsCtrl([(e.map.getExtent()[0]+e.map.getExtent()[2])/2,(e.map.getExtent()[1]+e.map.getExtent()[3])/2]),e.coordsToClick.call(e,{coordinate:e.xy}))}coordsToPopup(e){e&&this.updateCoordsCtrl(e.wrap.popup.getPosition())}updateCoordsCtrl(e){const t=this;e&&(t.isGeo||(t.x=e[0],t.y=e[1],t.xy=[t.x,t.y],e.length>2&&t.xy.push(e[2])),(t.isGeo||t.options.showGeo)&&(t.lat=e[0],t.lon=e[1],t.latLon=[t.lat,t.lon],e.length>2&&t.latLon.push(e[2])),t.update())}coordsToClick(e){const t=this;if(!t.map.div.classList.contains("tc-ctl-sv-active")||!t.map.div.classList.contains(i.Z.classes.COLLAPSED)){var r=t.div.getBoundingClientRect();if(r.left<=e.clientX&&e.clientX<=r.right&&r.top<=e.clientY&&e.clientY<=r.bottom)return t.div.classList.add(i.Z.classes.HIDDEN),void t.clear();t.div.classList.remove("tc-fading"),setTimeout((function(){t.div.classList.add("tc-fading");let e=0,r=getComputedStyle(t.div).getPropertyValue("animation-duration").match(/^(\d+)(m?s)$/i);r&&(e=parseInt(r[1]),"s"===r[2]&&(e*=1e3)),0!==e&&(clearTimeout(t._markerRemoveTimeout),t._markerRemoveTimeout=setTimeout((()=>{t.currentCoordsMarker&&t.getLayer().then((e=>{e.removeFeature(t.currentCoordsMarker),t.currentCoordsMarker=null}))}),e))}),10),t.updateCoordsCtrl(e.coordinate),t.map.on3DView||t.coordsMarkerAdd(e.coordinate,e.cssClass),t.div.classList.remove(i.Z.classes.HIDDEN)}}coordsMarkerAdd(e,t){const r=this;r.currentCoordsMarker?r.currentCoordsMarker.setCoords(e):r.getLayer().then((function(n){n.addMarker(e,{title:"Coord",showsPopup:!1,cssClass:t||i.Z.classes.POINT,anchor:[.5,.5]}).then((function(e){r.currentCoordsMarker=e}))}))}async getLayer(){const e=this;return null==e.layer&&(e.layer=await e.map.addLayer({id:e.getUID(),type:i.Z.layerType.VECTOR,stealth:!0,owner:e,title:"Coordenadas"}),e.layer.map.putLayerOnTop(e.layer)),e.layer}}n.Z.control.Coordinates=d;const f=d},8002:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var n=r(688),i=r(3640);n.Z.control=n.Z.control||{};class o extends i.default{constructor(){super(...arguments);const e=this;e.controlOptions=[{title:"addWMS",externalWMS:{suggestions:e.options.wmsSuggestions}},{fileImport:{enableDragAndDrop:e.options.enableDragAndDrop}}],e.defaultSelection=0}async register(e){const t=this;t.map=e,t.title=t.getLocaleString("addMaps");const r=await super.register.call(t,e);return r.div.classList.add(t.CLASS+"-datldr"),r}}n.Z.control.DataLoader=o;const a=o},658:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var n=r(688),i=r(330),o=r(7497),a=r(3784),s=r(5394);n.Z.control=n.Z.control||{},n.Z.filter=s.Z;const l=function(e){var t=this;t._classSelector="."+t.CLASS,o.Z.apply(t,arguments),t._hiddenElms=[];var r=e||{};t._dialogDiv=n.Z.Util.getDiv(r.dialogDiv),window.$&&(t._$dialogDiv=$(t._dialogDiv)),r.dialogDiv||document.body.appendChild(t._dialogDiv)};n.Z.inherit(l,a.default),function(){var e=l.prototype;e.CLASS="tc-ctl-download",e.loadTemplates=async function(){const t=r.e(8399).then(r.bind(r,8399)),n=r.e(9165).then(r.bind(r,9165)),i={};i[e.CLASS]=(await t).default,i[e.CLASS+"-dialog"]=(await n).default,this.template=i},e.render=function(e){const t=this;return t._set1stRenderPromise(t.getRenderedHtml(t.CLASS+"-dialog",null,(function(e){t._dialogDiv.innerHTML=e})).then((function(){return o.Z.prototype.renderData.call(t,{controlId:t.id,deselectableTabs:t.options.deselectableTabs},(function(){t.div.querySelectorAll(".tc-ctl-tctr-select sitna-tab").forEach((function(e){e.callback=function(){const e=this.target;e&&(t._activeElm=e)}}));const r=t.div.querySelector(".tc-ctl-tctr-select sitna-tab:first-of-type");r&&r.attributes.for&&(t._activeElm=document.getElementById(r.attributes.for.value)),n.Z.Util.isFunction(e)&&e()}))})))};const t=function(e){let t=e.toFixed(20);return t.indexOf(".")>=0&&(t=t.replace(/0+$/,"").replace(/\.$/,"")),t};e.register=function(e){var o=this;const l=a.default.prototype.register.call(o,e);o.map.crossOrigin="anonymous";var c=function(e,t){const r=o.div.querySelector(".tc-alert-warning:not(."+o.CLASS+"-alert)");var a;switch(e.key){case i.Z.WFSErrors.MAX_NUM_FEATURES:a=r.querySelector("#zoom-msg-"+o.id).innerHTML.format({serviceName:e.params.serviceTitle});break;case i.Z.WFSErrors.NO_LAYERS:a=o.getLocaleString("noLayersLoaded");break;case i.Z.WFSErrors.GETCAPABILITIES:a=r.querySelector("#novalid-msg-"+o.id).innerHTML.format({serviceName:e.params.serviceTitle});break;case i.Z.WFSErrors.NO_FEATURES:a=r.querySelector("#noFeatures-msg-"+o.id).innerHTML;break;case i.Z.WFSErrors.INDETERMINATE:return a=o.getLocaleString("wfs.IndeterminateError"),o.map.toast(a,{type:i.Z.msgType.ERROR}),n.Z.error("Error:{error} \r\n Descripcion:{descripcion} \r\n Servicio:{serviceName}".format({error:e.params.err,descripcion:e.params.errorThrown,serviceName:e.params.serviceTitle}),i.Z.msgErrorMode.CONSOLE),void o.map.getLoadingIndicator().removeWait(t);default:a=o.getLocaleString("wfs."+e.key,e.params)}o.map.toast(a,{type:i.Z.msgType.WARNING}),o.map.getLoadingIndicator().removeWait(t)};return o.div.addEventListener(i.Z.event.CLICK,n.Z.EventTarget.listenerBySelector(".tc-ctl-download-btn",(function(){var e="";o._activeElm&&(e=o._activeElm.querySelector("select").value),e.indexOf("image")>-1?function(e){const i=o.map.getLoadingIndicator(),a=i&&i.addWait(),s=o.map.getExtent();new Promise((function(e,t){var r=o.map.wrap.getCanvas(),s=r.length>1?n.Z.Util.mergeCanvases(r):r[0];if(o.map.getControlsByClass(n.Z.control.ScaleBar)&&!o.map.on3DView&&o.drawScaleBarIntoCanvas({canvas:s,fill:!0}),!o._activeElm.querySelector(`.${o.CLASS}-image-qr:disabled`)&&o._activeElm.querySelector(`.${o.CLASS}-image-qr:checked`)){const t="qrcode";var l=document.getElementById(t);l?l.innerHTML="":((l=document.createElement("div")).setAttribute("id",t),document.body.appendChild(l)),l.style.top="-200px",l.style.left="-200px",l.style.position="absolute",o.makeQRCode(l,87).then((function(t){if(t){var r=s.getContext("2d");r.fillStyle="#ffffff",r.fillRect(s.width-91,s.height-91,91,91),n.Z.Util.addToCanvas(s,t,{x:s.width-88,y:s.height-88}).then((function(t){e(t)}))}else i&&i.removeWait(a)}))}else e(s)})).then((function(l){const c=window.location.hostname+"_"+o.map.crs.replace(":","")+"_"+n.Z.Util.getFormattedDate((new Date).toString(),!0),u="."+e.split("/")[1],p=e===n.Z.Consts.mimeType.JPEG?".jgw":".pgw";if(o._activeElm.querySelector(`.${o.CLASS}-image-wld:checked`)&&!o.map.on3DView)Promise.resolve().then(r.t.bind(r,3837,23)).then((r=>{const h=r.default,d=(s[2]-s[0])/l.width,f=(s[1]-s[3])/l.height,g=s[0],y=s[3],m=new h;l.toBlob((function(e){m.file(c+u,e),m.file(c+p,`${t(d)}\n${(0).toFixed(1)}\n${(0).toFixed(1)}\n${t(f)}\n${t(g)}\n${t(y)}`),m.generateAsync({type:"blob"}).then((function(e){n.Z.Util.downloadBlob(c+".zip",e),i&&i.removeWait(a)}),(function(e){n.Z.error(o.getLocaleString("dl.export.map.error")+": "+e.message),i&&i.removeWait(a)}))}),e)}));else{try{const t=l.toDataURL(e);n.Z.Util.downloadDataURI(c+u,e,t)}catch(e){n.Z.error(o.getLocaleString("dl.export.map.error")+": "+e.message)}i&&i.removeWait(a)}}))}(e):function(e){const t=o.map.getLoadingIndicator(),r=t&&t.addWait(),a=o.map.extractFeatures({filter:o.map.on3DView?new s.Z.Within(null,new polygon(o.map.view3D.getFovCoords(o.map.view3D.crs)),o.map.view3D.crs):new s.Z.bbox(o.map.getExtent(),o.map.getCRS()),outputFormat:e,download:!0});Promise.all(a).then((async function(a){var s=a.filter((e=>!!e));if(0!==s.length){for(var l=[],u=0;u<s.length;u++)if(s[u].errors&&s[u].errors.length)for(var p=0;p<s[u].errors.length;p++){var h=s[u].errors[p];c(h,r)}else{var d=s[u].data,f=s[u].url;d&&f&&l.push({url:f+"?download=zip",data:d})}try{await n.Z.Util.downloadFileForm(l)}catch(t){if(t.key===i.Z.DownloadError.MIMETYPE_NOT_SUPORTED){const r=a.find((e=>e.data===t.data)).service,n={plural:r.layers.length>1?o.getLocaleString("dl.format.notSupported.plural"):"",layerNames:r.layers.reduce((function(e,t,r,n){return(e instanceof Array?e:[e]).concat([t.title]).join(r<n.length-1?", ":" "+o.getLocaleString("dl.format.notSupported.conjunction")+" ")}),[]),serviceTitle:r.mapLayers[0].title,format:e};o.map.toast(o.getLocaleString("dl.format.notSupported").format(n),{type:i.Z.msgType.ERROR})}}t&&t.removeWait(r)}else c({key:i.Z.WFSErrors.NO_LAYERS},r)}))}(e)})),{passive:!0}),o.div.addEventListener(i.Z.event.CLICK,n.Z.EventTarget.listenerBySelector(".tc-ctl-download-help",(function(e){e.stopPropagation(),n.Z.Util.showModal(o._dialogDiv.querySelector(o._classSelector+"-help-dialog"))})),{passive:!0}),o.div.addEventListener("change",n.Z.EventTarget.listenerBySelector(`.${o.CLASS}-image-qr`,(function(e){e.target.checked?o.generateLink():o.div.querySelector("."+o.CLASS+"-alert").classList.add(i.Z.classes.HIDDEN)}))),o.div.addEventListener("click",n.Z.EventTarget.listenerBySelector("h2",(function(e){o.registeredListeners||o.generateLink(),o.registerListeners()}))),l},e.manageMaxLengthExceed=function(e){const t=this,r=t.div.querySelector("."+t.CLASS+"-alert"),n=t.div.querySelector(`.${t.CLASS}-image-qr`);n.disabled=e.qr,n.checked?r.classList.toggle(i.Z.classes.HIDDEN,!e.qr):r.classList.add(i.Z.classes.HIDDEN)},e.generateLink=async function(){const e=this,t=e.div.querySelector(`.${e.CLASS}-div input.${e.CLASS}-image-qr`),r=e.div.querySelector(`label.${e.CLASS}-image-qr-label`);t.disabled=!0,r.classList.add(i.Z.classes.LOADING);const n=await a.default.prototype.generateLink.call(e);return r.classList.remove(i.Z.classes.LOADING),n}}(),n.Z.control.Download=l;const c=l},1235:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>q});var n=r(688),i=r(330),o=r(9967),a=r(268),s=r(2461);r(9717);function l(e,t){u(e,t),t.add(e)}function c(e,t,r){u(e,t),t.set(e,r)}function u(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function p(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,g(e,t,"get"))}function d(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}function f(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,g(e,t,"set"),r),r}function g(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}n.Z.control=n.Z.control||{},i.Z.event.DRAWSTART="drawstart.tc",i.Z.event.DRAWEND="drawend.tc",i.Z.event.DRAWCANCEL="drawcancel.tc",i.Z.event.DRAWUNDO="drawundo.tc",i.Z.event.DRAWREDO="drawredo.tc",i.Z.event.POINT="point.tc",i.Z.event.MEASURE="measure.tc",i.Z.event.MEASUREPARTIAL="measurepartial.tc",i.Z.event.STYLECHANGE="stylechange.tc",i.Z.event.CHANGE="change";const y="tc-ctl-draw",m="sitna-draw";var v=new WeakMap,_=new WeakMap,w=new WeakMap,S=new WeakMap,E=new WeakMap,b=new WeakMap,C=new WeakMap,L=new WeakMap,T=new WeakMap,A=new WeakMap,x=new WeakMap,P=new WeakMap,O=new WeakMap,I=new WeakMap,R=new WeakMap,M=new WeakMap,D=new WeakSet,N=new WeakSet,Z=new WeakSet,k=new WeakSet,F=new WeakSet;class U extends s.default{constructor(){super(...arguments),l(this,F),l(this,k),l(this,Z),l(this,N),l(this,D),p(this,"CLASS",y),c(this,v,{writable:!0,value:"."+y}),c(this,_,{writable:!0,value:void 0}),c(this,w,{writable:!0,value:void 0}),c(this,S,{writable:!0,value:y+"-point"}),c(this,E,{writable:!0,value:y+"-line"}),c(this,b,{writable:!0,value:y+"-polygon"}),c(this,C,{writable:!0,value:y+"-rectangle"}),c(this,L,{writable:!0,value:void 0}),c(this,T,{writable:!0,value:void 0}),c(this,A,{writable:!0,value:void 0}),c(this,x,{writable:!0,value:void 0}),c(this,P,{writable:!0,value:void 0}),c(this,O,{writable:!0,value:void 0}),c(this,I,{writable:!0,value:void 0}),c(this,R,{writable:!0,value:void 0}),c(this,M,{writable:!0,value:new WeakMap});const e=this;e.styles=e.options.styles||a.Z.extend(!0,{},o.k.styles),e.initProperty("measurer").initProperty("stylable").initProperty("singleSketch").initProperty("extensibleSketch").initProperty("snapping").initProperty("mode"),f(e,L,!(!1===e.options.layer)),e.history=[],e.historyIndex=0,e.exportsState=!0,f(e,T,null),e.on(i.Z.event.DRAWSTART,(function(t){e.resetValues(),t.feature&&(e.history=t.feature.getCoordinates(),e.historyIndex=e.history.length)})).on(i.Z.event.POINT,(function(t){e.layer&&e.singleSketch&&e.layer.features&&e.layer.features.length>0&&e.layer.clearFeatures(),e.history.length=e.historyIndex,e.history[e.historyIndex++]=t.point,d(e,k,W).call(e)})).on(i.Z.event.DRAWEND,(function(t){d(e,F,H).call(e);const r=n.Z.getUID({prefix:e.getLocaleString("sketch")+".",banlist:e.layer.features.map((e=>e.getId()))});t.feature.setId(r),e.callback&&e.callback(t.feature)}))}connectedCallback(){super.connectedCallback();f(this,L,!this.hasAttribute("borrowed-layer"))}static get observedAttributes(){return["mode","stylable"]}attributeChangedCallback(e,t,r){if(t===r)return;const n=this;"stylable"===e&&d(n,N,G).call(n),"mode"===e&&d(n,D,B).call(n)}getClassName(){return y}get mode(){const e=this;return e.hasAttribute("mode")?e.getAttribute("mode"):i.Z.geom.POLYLINE}set mode(e){const t=this;e?t.setAttribute("mode",e):t.removeAttribute("mode")}get stylable(){return this.hasAttribute("stylable")}set stylable(e){this.toggleAttribute("stylable",!!e)}get measurer(){return this.hasAttribute("measurer")}set measurer(e){this.toggleAttribute("measurer",!!e)}get singleSketch(){return this.hasAttribute("single-sketch")}set singleSketch(e){this.toggleAttribute("single-sketch",!!e)}get extensibleSketch(){return this.hasAttribute("extensible-sketch")}set extensibleSketch(e){this.toggleAttribute("extensible-sketch",!!e)}async loadTemplates(){const e=await r.e(7918).then(r.bind(r,7918));this.template=e.default}render(e){const t=this;let r;switch(t.mode){case i.Z.geom.POLYLINE:case i.Z.geom.MULTIPOLYLINE:r=t.getLocaleString("drawLine"),t.classList.add(h(t,E));break;case i.Z.geom.POLYGON:case i.Z.geom.MULTIPOLYGON:r=t.getLocaleString("drawPolygon"),t.classList.add(h(t,b));break;case i.Z.geom.POINT:case i.Z.geom.MULTIPOINT:r=t.getLocaleString("drawPoint"),t.classList.add(h(t,S));break;case i.Z.geom.RECTANGLE:r=t.getLocaleString("drawRectangle"),t.classList.add(h(t,C));break;default:r=t.getLocaleString("draw")}const o={tooltip:r,stylable:t.stylable};return t._set1stRenderPromise(t.renderData(o,(function(){t.reset=!0,t.callback=null,f(t,A,!1),a.Z.isFunction(t.options.callback)&&(t.callback=t.options.callback),t.wrap=new n.Z.wrap.control.Draw(t),t.getStyler().then((e=>{e.setStyles(t.styles),e.addEventListener(i.Z.event.STYLECHANGE,(e=>{t.wrap.setStyle();const r={};r[e.detail.property]=e.detail.value,t.trigger(i.Z.event.STYLECHANGE,r)}))})),f(t,x,t.querySelector(h(t,v)+"-btn-new")),h(t,x).addEventListener(i.Z.event.CLICK,(function(){t.new()}),{passive:!0}),f(t,P,t.querySelector(h(t,v)+"-btn-cancel")),h(t,P).addEventListener(i.Z.event.CLICK,(function(){t.cancel()}),{passive:!0}),f(t,O,t.querySelector(h(t,v)+"-btn-end")),h(t,O).addEventListener(i.Z.event.CLICK,(function(){t.end()}),{passive:!0}),f(t,I,t.querySelector(h(t,v)+"-btn-undo")),h(t,I).addEventListener(i.Z.event.CLICK,(function(){t.undo()}),{passive:!0}),f(t,R,t.querySelector(h(t,v)+"-btn-redo")),h(t,R).addEventListener(i.Z.event.CLICK,(function(){t.redo()}),{passive:!0}),a.Z.isFunction(e)&&e()})))}async register(e){const t=this;t.styles=a.Z.extend(!0,{},e.options.styles,t.options.styles),await super.register(e);return(await t.getStyler()).setStyles(t.styles),t.map.on(i.Z.event.VIEWCHANGE,(function(){t.map.view===i.Z.view.PRINTING&&t.end()})).on(i.Z.event.PROJECTIONCHANGE,(function(e){t.history.forEach((function(t,r,n){n[r]=a.Z.reproject(t,e.oldCrs,e.newCrs)}))})),f(t,T,new Promise((function(r,n){e.loaded((function(){t.options.layer?(t.setLayer(t.options.layer),r(t.layer)):h(t,L)?e.addLayer({id:t.getUID(),title:"DrawControl",stealth:!0,owner:t,type:i.Z.layerType.VECTOR,styles:{point:Object.assign({},t.styles.point),line:Object.assign({},t.styles.line),polygon:Object.assign({},t.styles.polygon)}}).then((function(n){e.putLayerOnTop(n),t.setLayer(n),r(t.layer)})):r(null)}))}))),t}new(){const e=this;return e.layer&&e.singleSketch&&e.layer.clearFeatures(),h(e,P).disabled=!1,e.setMode(e.mode,!0),e}undo(){const e=this;let t=e.wrap.undo();return t&&(e.historyIndex--,d(e,k,W).call(e),e.historyIndex<=0&&e.resetValues(),e.trigger(i.Z.event.DRAWUNDO)),t}redo(){const e=this;let t=this.wrap.redo();return t&&(e.historyIndex++,d(e,k,W).call(e),e.trigger(i.Z.event.DRAWREDO)),t}cancel(){const e=this;return f(e,A,!0),e.resetValues(),d(e,F,H).call(e),h(e,P).disabled=!0,e.trigger(i.Z.event.DRAWCANCEL,{ctrl:e}),e}activate(){const e=this;switch(h(e,x).classList.add(i.Z.classes.ACTIVE),h(e,P).disabled=!1,super.activate.call(e),e.wrap.activate(e.mode),e.classList.remove(h(e,S),h(e,E),h(e,b),h(e,C)),e.getStyler().then((t=>t.mode=e.mode)),e.mode){case i.Z.geom.POINT:e.classList.add(h(e,S));break;case i.Z.geom.POLYLINE:e.classList.add(h(e,E));break;case i.Z.geom.POLYGON:e.classList.add(h(e,b));break;case i.Z.geom.RECTANGLE:e.classList.add(h(e,C))}return e}deactivate(){const e=this;return h(e,x)&&h(e,x).classList.remove(i.Z.classes.ACTIVE),h(e,P)&&(h(e,P).disabled=!0),super.deactivate.call(e,!h(e,A)),e.wrap&&e.wrap.deactivate(),e.resetValues(),f(e,A,!1),e}clear(){const e=this;return e.layer&&e.layer.clearFatures(),e.resetValues(),e}isExclusive(){return!0}end(){const e=this;return e.wrap.end(),e.resetValues(),e}setMode(e,t){const r=this;return r.mode=e,t&&e?r.activate():r.isActive&&r.deactivate(),r}setStyle(e){const t=this;switch(e=a.Z.extend(h(t,_),e),t.mode){case i.Z.geom.POLYLINE:case i.Z.geom.MULTIPOLYLINE:case i.Z.geom.RECTANGLE:t.styles.line=e;break;case i.Z.geom.POLYGON:case i.Z.geom.MULTIPOLYGON:t.styles.polygon=e;break;case i.Z.geom.POINT:case i.Z.geom.MULTIPOINT:t.styles.point=e;break;default:e={}}t.getStyler().then((e=>{e.setStyles(styles),t.wrap.setStyle()}))}getStyle(){var e;return null===(e=h(this,w))||void 0===e?void 0:e.getStyle()}resetStyle(){return this.getStyler().then((e=>e.resetStyle())),this}setStrokeColor(e){return this.styler.setStrokeColor(e),this}setFillColor(e){return this.styler.setFillColor(e),this}setFillOpacity(e){return this.styler.setFillOpacityWatch(e),this}setStrokeWidth(e){return this.styler.setStrokeWidth(e),this}toggleStyleTools(e){const t=this;return d(t,Z,j).call(t,t.querySelector(`.${t.CLASS}-style`),e),t}getLayer(){const e=this;return e.layer?Promise.resolve(e.layer):h(this,T)}setLayer(e){const t=this;return t.map&&(t.layer&&h(t,M).set(t.layer,Object.assign({},h(t,_))),t.layer="string"==typeof e?t.map.getLayer(e):e,t.getStyler().then((function(t){t.setLayer(e)})),!e&&t.isActive&&t.deactivate()),t}setFeature(e){return this.getStyler().then((t=>t.setFeature(e))),self}resetValues(){const e=this;return e.history.length=0,e.historyIndex=0,d(e,k,W).call(e),e}async getStyler(){const e=this;return await e.renderPromise(),f(e,w,e.querySelector("sitna-feature-styler")),h(e,w)}exportState(){const e=this;return e.exportsState&&e.layer?{id:e.id,layer:e.layer.exportState()}:null}importState(e){return this.getLayer().then((function(t){t.importState(e.layer)})),this}}async function B(){const e=this,t=e.mode;await e.renderPromise(),(await e.getStyler()).mode=t}async function G(){const e=this;await e.renderPromise(),e.querySelector(`.${e.CLASS}-style`).classList.toggle(i.Z.classes.HIDDEN,!e.stylable)}function j(e,t){if(e){const r=void 0!==t?!t:void 0;e.classList.toggle(i.Z.classes.HIDDEN,r)}}async function W(){const e=this;await e.renderPromise();const t=e.mode;h(e,O).disabled=0===e.historyIndex||t===i.Z.geom.POLYGON&&e.historyIndex<3||t===i.Z.geom.POLYLINE&&e.historyIndex<2||t===i.Z.geom.RECTANGLE,h(e,R).disabled=e.history.length===e.historyIndex,h(e,I).disabled=0===e.historyIndex||e.mode===i.Z.geom.RECTANGLE}async function H(){const e=this;await e.renderPromise(),e.resetValues(),h(e,O).disabled=!0,h(e,P).disabled=!1}p(U,"extensibility",{DISABLED:"disabled",ENABLED:"enabled",EXTEND_ONLY:"extend_only"}),customElements.get(m)||customElements.define(m,U),n.Z.control.Draw=U;const q=U},4975:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var n=r(688),i=r(330),o=r(3965),a=(r(5516),r(895),r(3048)),s=r(8033),l=r(8683),c=r(1872),u=r(9529),p=r(5265);n.Z.control=n.Z.control||{};const h=function(){var e=this;o.default.apply(e,arguments),e._dialogDiv=n.Z.Util.getDiv(e.options.dialogDiv),window.$&&(e._$dialogDiv=$(e._dialogDiv)),e.options.dialogDiv||document.body.appendChild(e._dialogDiv);const t=e._classSelector="."+e.CLASS;e._selectors={ELEVATION_CHECKBOX:t+"-dialog-elev input[type=checkbox]",MODE_RADIO_BUTTON:`input[type=radio][name="${e.id}-mode"]`},e.persistentDrawControls=!0,e.renderPromise().then((function(){e._1stCoordText=e.div.querySelector(".tc-ctl-meas-val-coord-1-t"),e._2ndCoordText=e.div.querySelector(".tc-ctl-meas-val-coord-2-t"),e._1stCoordValue=e.div.querySelector(".tc-ctl-meas-val-coord-1-v"),e._2ndCoordValue=e.div.querySelector(".tc-ctl-meas-val-coord-2-v"),e._elevationText=e.div.querySelector(".tc-ctl-meas-val-coord-ele-t"),e._elevationValue=e.div.querySelector(".tc-ctl-meas-val-coord-ele-v")}))};n.Z.inherit(h,o.default),function(){var e=h.prototype;e.CLASS="tc-ctl-dmm",i.Z.event.RESULTSPANELCLOSE=i.Z.event.RESULTSPANELCLOSE||"resultspanelclose.tc",i.Z.event.FEATURESSELECT=i.Z.event.FEATURESSELECT||"featuresselect.tc",e.loadTemplates=async function(){const e=await r.e(604).then(r.bind(r,604));this.template=e.default},e.render=function(e){const t=this;return t._set1stRenderPromise(o.default.prototype.render.call(t,(function(){t.pointMeasurementControl=t.div.querySelector('sitna-measurement[mode="point"]'),t.pointMeasurementControl.containerControl=t,t._clearBtn=t.div.querySelector(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-clr"),t._clearBtn.addEventListener(i.Z.event.CLICK,(function(e){n.Z.confirm(t.getLocaleString("deleteAll.confirm"),(function(){t.clear(),d.apply(t)}))}),{passive:!0}),t._downloadBtn=t.div.querySelector(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-dl"),t._downloadBtn.addEventListener(i.Z.event.CLICK,(function(e){t.showSketchDownloadDialog()}),{passive:!0});t.div.querySelector(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-hide").addEventListener(i.Z.event.CLICK,(function(e){const r=!e.target.classList.contains(i.Z.classes.ACTIVE);t.drawControls.forEach((function(e){e.layer.setVisibility(r),e.isActive&&e.wrap.setVisibility(r)})),e.target.title=t.getLocaleString(r?"hideSketch":"showSketch"),e.target.classList.toggle(i.Z.classes.ACTIVE)}),{passive:!0}),n.Z.Util.isFunction(e)&&e()})))},e.register=async function(e){const r=this;await o.default.prototype.register.call(r,e);const s=r.getUID(),c=r.getUID(),u=await Promise.all([r.layerPromise,r.renderPromise(),r.getElevationTool()]),p=u[0];r.elevationProfileActive=!!u[2],p&&(p.title=r.getLocaleString("sketch"));const h=await r.getModifyControl();r.modify=h,h.containerControl=r,h.id=s,h.snapping=r.snapping,h.setLayer(p),h.on(i.Z.event.FEATURESSELECT,(function(e){const t=e.features[e.features.length-1];r.displayFeatureMode(t),r.getElevationControl().then((function(t){t.resultsPanel&&!e.features.some((function(e){return t.resultsPanel.currentFeature===e}))&&t.resultsPanel.setCurrentFeature(null)}))})).on(i.Z.event.FEATURESUNSELECT,(function(e){r.getElevationControl().then((function(e){e.resetElevationProfile(),e.resultsPanel&&e.resultsPanel.close()}))})).on(i.Z.event.FEATUREMODIFY,(function(e){if(e.layer===r.layer){const t=function(e){const t=r.getFeatureMeasurementData(e);r.displayMeasurements(t),r.setFeatureMeasurementData(e)};t(e.feature),e.feature instanceof a.Z&&r.getElevationTool().then((function(n){n&&n.setGeometry({features:[e.feature],crs:r.map.getCRS()}).then((function(e){t(e[0])}),(function(e){console.warn(e.message)}))}));r.map.getControlsByClass("TC.control.Popup").forEach((function(t){t.currentFeature===e.feature&&t.isVisible()&&t.hide()}))}})),e.on(i.Z.event.CONTROLDEACTIVATE,(function(e){const t=e.control;t!==r.modify&&t!==r.lineDrawControl||r.getElevationControl().then((function(e){e.resetElevationProfile(),e.resultsPanel&&(t===r.modify&&e.resultsPanel.setCurrentFeature(null),e.resultsPanel.close())}))})).on(i.Z.event.POPUP+" "+i.Z.event.DRAWTABLE,(function(e){const t=e.control.currentFeature;t instanceof l.Z&&r.layer.features.indexOf(t)>=0&&r.elevationProfileActive&&(e.control.hide(),r.getElevationControl().then((function(e){e.resultsPanel&&(e.resultsPanel.setCurrentFeature(t),e.resultsPanel.isMinimized()&&e.resultsPanel.maximize()),e.displayElevationProfile(t)})))})).on(i.Z.event.PROJECTIONCHANGE,(function(e){r.elevationChartData&&(r.elevationChartData.coords=n.Z.Util.reproject(r.elevationChartData.coords,e.oldCrs,e.newCrs))}));(await r.getLineDrawControl()).on(i.Z.event.DRAWSTART,(function(){r.getElevationControl().then((function(e){e.resultsPanel&&e.resultsPanel.currentFeature&&e.resultsPanel.setCurrentFeature(null),r.resetValues()}))})).on(i.Z.event.DRAWUNDO+" "+i.Z.event.DRAWREDO,(function(){const e=this;r.getElevationControl().then((function(t){r.elevationProfileActive&&(e.historyIndex?t.displayElevationProfile(e.history.slice(0,e.historyIndex)):t.closeElevationProfile())})),d.apply(r)})).on(i.Z.event.DRAWEND,(function(e){r.getElevationControl().then((function(t){t.resultsPanel&&(t.resultsPanel.currentFeature=e.feature)}))})).on(i.Z.event.POINT,(function(e){const n=this.history.slice(0,this.historyIndex),i=n[n.length-1];i[0]===e.point[0]&&i[1]===e.point[1]||n.push(e.point),r.getElevationControl().then((function(e){r.elevationProfileActive&&(navigator.onLine?e.displayElevationProfile(n):e.closeElevationProfile())})),1===e.target.historyIndex&&t.apply(r)})).on(i.Z.event.STYLECHANGE,(function(e){r.onStyleChange(e)})).on(i.Z.event.DRAWCANCEL,(function(){d.apply(r)}));(await r.getPolygonDrawControl()).on(i.Z.event.DRAWSTART,(function(){r.resetValues()})).on(i.Z.event.POINT,(function(e){1===e.target.historyIndex&&t.apply(r)})).on(i.Z.event.STYLECHANGE,(function(e){r.onStyleChange(e)})).on(i.Z.event.DRAWCANCEL+" "+i.Z.event.DRAWUNDO,(function(){d.apply(r)}));const f=await r.getPointDrawControl();return f.containerControl=r,f.id=c,f.snapping=r.snapping,f.setLayer(r.layer),r.drawControls.push(f),r.pointDrawControl=f,r.resetValues(),f.on(i.Z.event.DRAWEND,(function(n){const i=function(t){r.displayMeasurements({coordinates:t.geometry,units:e.wrap.isGeo()||e.on3DView?"degrees":"m"}),r.setFeatureMeasurementData(t)};i(n.feature),r.getElevationTool().then((function(e){e&&e.setGeometry({features:[n.feature],crs:r.map.getCRS()}).then((function(e){i(e[0])}),(function(e){console.log(e.message)}))})),t.apply(r)})).on(i.Z.event.DRAWCANCEL,(function(e){setTimeout((function(){r.cancel()}),100),d.apply(r)})).on(i.Z.event.STYLECHANGE,(function(e){r.onStyleChange(e)})),f.exportsState=!1,r._elevationControlPromise=e.addControl("elevation",r.options.displayElevation),r.setMode(r.options.mode),e.on(i.Z.event.FEATUREADD,(function(e){const t=e.layer,n=e.feature;t===r.layer&&(r.setFeatureMeasurementData(n),r.getModifyControl().then((function(e){e.displayLabelText(n.getStyle().label)})),r._clearBtn.disabled=!1,r._downloadBtn.disabled=!1)})).on(i.Z.event.FEATUREREMOVE+" "+i.Z.event.FEATURESCLEAR,(function(e){e.layer===r.layer&&0===r.layer.features.length&&(r._clearBtn.disabled=!0,r._downloadBtn.disabled=!0,r.resetValues(),d.apply(r))})).on(i.Z.event.RESULTSPANELCLOSE,(function(e){r.getElevationControl().then((function(t){t===e.control&&t.setCurrentFeature(null)}))})),r},e.displayMode=function(e){const t=this;return e===i.Z.geom.POINT&&(t._activeMode=t.div.querySelector(".tc-ctl-meas-pt")),t.modify&&t.modify.div.classList.remove(i.Z.classes.COLLAPSED),o.default.prototype.displayMode.call(t,e)},e.displayFeatureMode=function(e){const t=this;if(e)switch(t.displayMeasurements(t.getFeatureMeasurementData(e)),!0){case e instanceof u.Z:case e instanceof p.Z:t.displayMode(i.Z.geom.POLYGON),t.polygonDrawControl.setFeature(e);break;case e instanceof l.Z:case e instanceof c.Z:t.displayMode(i.Z.geom.POLYLINE),t.lineDrawControl.setFeature(e),t.elevationProfileActive&&t.getElevationControl().then((t=>t.displayElevationProfile(e)));break;case e instanceof a.Z:case e instanceof s.Z:t.displayMode(i.Z.geom.POINT),t.pointDrawControl.setFeature(e)}},e.setMode=function(e){const t=this;e===i.Z.geom.POINT?t.getPointDrawControl().then((function(r){r.activate(),o.default.prototype.setMode.call(t,e),d.apply(t)})):(o.default.prototype.setMode.call(t,e),d.apply(t))},e.constrainModes=function(e){const t=this;Array.isArray(e)||(e=[]),e.indexOf(t.mode)<0&&t.setMode(null);const r=e.map((e=>`[value=${e}]`)).join()||"[value]";t.div.querySelectorAll(t._selectors.MODE_RADIO_BUTTON).forEach((function(e){e.disabled=!e.matches(r)}))},e.setLayer=async function(e){var t;const r=this;await o.default.prototype.setLayer.call(r,e);for await(const e of[r.getPointDrawControl(),r.getModifyControl()])e.setLayer(r.layer);null!==(t=r.layer)&&void 0!==t&&t.features.length&&r.displayFeatureMode(r.layer.features[0])},e.setFeatureMeasurementData=function(e){const t=this;switch(t.mode){case i.Z.geom.POINT:t.pointMeasurementControl.setFeatureMeasurementData(e);break;case i.Z.geom.POLYLINE:t.lineMeasurementControl.setFeatureMeasurementData(e);break;case i.Z.geom.POLYGON:t.polygonMeasurementControl.setFeatureMeasurementData(e)}return t},e.getFeatureMeasurementData=function(e){const t=this,r={units:t.map.wrap.isGeo()||t.map.on3DView?"degree":"m"},n={crs:t.map.options.utmCrs};switch(!0){case e instanceof u.Z:case e instanceof p.Z:r.area=e.getArea(n),r.perimeter=e.getLength(n);break;case e instanceof l.Z:case e instanceof c.Z:r.length=e.getLength(n),t.getElevationControl().then((r=>{t.elevationProfileActive&&r.displayElevationProfile(e)}));break;case e instanceof a.Z:r.coordinates=e.geometry}return r},e.getPointMeasurementControl=async function(){return await this.renderPromise(),this.div.querySelector('sitna-measurement[mode="point"]')},e.displayMeasurements=function(e){const t=this;return o.default.prototype.displayMeasurements.call(t,e),(e=e||{}).coordinates&&t.pointMeasurementControl.displayMeasurement(e),t},e.resetValues=function(){const e=this;return o.default.prototype.resetValues.call(e),e.getPointMeasurementControl().then((e=>e.clearMeasurement())),e},e.clear=function(){const e=this;return e.resetValues(),e.layer.clearFeatures(),e.modify.isActive&&e.modify.deactivate(),e.options.displayElevation&&e.getElevationControl().then((function(e){e.resetElevationProfile(),e.resultsPanel&&e.resultsPanel.close()})),e._clearBtn.disabled=!0,e._downloadBtn.disabled=!0,e},e.showSketchDownloadDialog=function(e){const t=this;return t.getDownloadDialog().then((function(e){var r={title:t.getLocaleString("downloadSketch"),fileName:t.getLocaleString("sketch").toLowerCase().replace(" ","_")+"_"+n.Z.Util.getFormattedDate((new Date).toString(),!0)};(t.map.elevation||t.options.displayElevation)&&(r=Object.assign({},r,{elevation:Object.assign({},t.map.elevation&&t.map.elevation.options,t.options.displayElevation)})),e.open(t.layer.features,r)})),t},e.onStyleChange=function(e){const t=this;var r;switch(e.target.mode){case i.Z.geom.POLYGON:r=u.Z;break;case i.Z.geom.POLYLINE:r=l.Z;break;case i.Z.geom.POINT:r=a.Z}r&&t.modify.getSelectedFeatures().forEach((function(t){if(t instanceof r){const r={};e.strokeWidth&&(r.strokeWidth=e.strokeWidth),e.strokeColor&&(r.strokeColor=e.strokeColor),e.fillColor&&(r.fillColor=e.fillColor),e.fillOpacity&&(r.fillOpacity=e.fillOpacity),e.fontColor&&(r.fontColor=e.fontColor),e.fontSize&&(r.fontSize=e.fontSize),e.labelOutlineColor&&(r.labelOutlineColor=e.labelOutlineColor),e.labelOutlineWidth&&(r.labelOutlineWidth=e.labelOutlineWidth),t.setStyle(r)}}))},e.activateElevationProfile=async function(){const e=this;e.elevationProfileActive=!0;var t=!1;const r=await e.getElevationControl();if(e.lineDrawControl.historyIndex>1)r.displayElevationProfile(e.lineDrawControl.history.slice(0,e.lineDrawControl.historyIndex)),t=!0;else{const n=e.modify.getActiveFeatures().filter((function(e){return e instanceof l.Z}));if(n.length){const e=n[n.length-1];r.displayElevationProfile(e.geometry),t=!0}}t||r.resetElevationProfile(),r.resultsPanel&&r.resultsPanel.show()},e.deactivateElevationProfile=async function(){this.elevationProfileActive=!1;const e=await this.getElevationControl();e.resetElevationProfile(),e.resultsPanel&&e.resultsPanel.close()},e.resetElevationProfile=function(){const e=this;e.options.displayElevation&&e.resultsPanelChart&&(e.elevationChartData={x:[0],ele:[0],coords:[0,0,0],upHill:0,downHill:0},e.resultsPanelChart.openChart(e.elevationChartData))},e.getElevationControl=function(){return this._elevationControlPromise},e.getPointDrawControl=async function(){return await this.renderPromise(),this.div.querySelector("."+o.default.prototype.CLASS+"-pt sitna-draw")},e.getModifyControl=async function(){const e=this;return await e.renderPromise(),e.div.querySelector("."+e.CLASS+"-mod sitna-modify")};const t=function(){const e=this.div.querySelector(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-hide");e&&(e.disabled=!1)},d=function(){const e=this,t=e.div.querySelector(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-hide");if(t){const r=this.drawControls.reduce((function(e,t){return e.concat([t.getLayer()])}),[]);Promise.all(r).then((function(){t.disabled=!e.drawControls.some((e=>e.layer.features.length||e.isActive&&e.historyIndex>0)),t.classList.add(i.Z.classes.ACTIVE),t.title=e.getLocaleString("hideSketch")}))}}}(),n.Z.control.DrawMeasureModify=h;const d=h},4916:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>Q});var n=r(688),i=r(330),o=r(9967),a=r(268),s=r(8834),l=(r(1235),r(5516),r(895),r(1399)),c=r(3048),u=r(8683),p=r(1872),h=r(9529),d=r(5265),f=r(2461);function g(e,t){m(e,t),t.add(e)}function y(e,t,r){m(e,t),t.set(e,r)}function m(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function v(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,E(e,t,"get"))}function w(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}function S(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,E(e,t,"set"),r),r}function E(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}n.Z.wrap=s.Z;const b="tc-ctl-edit",C="sitna-edit";var L=new WeakMap,T=new WeakMap,A=new WeakMap,x=new WeakMap,P=new WeakMap,O=new WeakMap,I=new WeakMap,R=new WeakSet,M=new WeakSet,D=new WeakSet,N=new WeakSet,Z=new WeakSet,k=new WeakSet,F=new WeakSet,U=new WeakSet,B=new WeakSet,G=new WeakSet;class j extends f.default{constructor(){super(...arguments),g(this,G),g(this,B),g(this,U),g(this,F),g(this,k),g(this,Z),g(this,N),g(this,D),g(this,M),g(this,R),v(this,"CLASS",b),y(this,L,{writable:!0,value:void 0}),y(this,T,{writable:!0,value:void 0}),y(this,A,{writable:!0,value:void 0}),y(this,x,{writable:!0,value:void 0}),y(this,P,{writable:!0,value:void 0}),y(this,O,{writable:!0,value:void 0}),y(this,I,{writable:!0,value:new WeakMap});const e=this;S(e,L,"."+e.CLASS),S(e,T,{MODE_TAB:`.${e.CLASS}-mode sitna-tab`}),e.mode=e.options.mode,e.initProperty("stylable").initProperty("snapping").initProperty("mode").initProperty("otherToolsIncluded"),e.wrap=new n.Z.wrap.control.Edit(e),e.layer=null,e.callback=a.Z.isFunction(arguments[2])?arguments[2]:e.options.callback?e.options.callback:null,e.cancelActionConfirmTxt=e.options.cancelText?e.options.eraseText:"Si continua todos los cambios se perdern. Desea continuar?",e.layersEditData={},e.pointDrawControl=null,e.lineDrawControl=null,e.polygonDrawControl=null,e.modifyControl=null}static get observedAttributes(){return["mode","stylable"]}attributeChangedCallback(e,t,r){if(t===r)return;const n=this;"stylable"===e&&w(n,R,W).call(n),"mode"===e&&w(n,D,q).call(n),"snapping"==e&&w(n,M,H).call(n)}getClassName(){return b}get stylable(){return this.hasAttribute("stylable")}set stylable(e){this.toggleAttribute("stylable",!!e)}get snapping(){return this.hasAttribute("snapping")}set snapping(e){this.toggleAttribute("snapping",!!e)}get mode(){const e=this;return e.hasAttribute("mode")?e.getAttribute("mode"):j.mode.MODIFY}set mode(e){this.setAttribute("mode",e||"")}get otherToolsIncluded(){return!this.hasAttribute("no-other-tools")}set otherToolsIncluded(e){this.toggleAttribute("no-other-tools",!e)}async register(e){const t=this;return await super.register.call(t,e),S(t,O,t.querySelector("sitna-measurement")),_(t,O).displayElevation=t.options.displayElevation,Array.isArray(t.options.modes)&&1==t.options.modes.length&&(t.mode=t.options.modes[0]),e.loaded((function(){t.setLayer(t.options.layer)})),e.on(i.Z.event.RESULTSPANELCLOSE,(function(e){e.control===t.featureImportPanel&&(t.featuresToImport=[],t.getHighlightsLayer().then((e=>e.clearFeatures())))})).on(i.Z.event.LAYERREMOVE+" "+i.Z.event.FEATURESCLEAR,(function(e){t.featureImportPanel&&!t.featureImportPanel.div.classList.contains(i.Z.classes.HIDDEN)&&t.getHighlightsLayer().then((function(r){for(let n=t.featuresToImport.length-1;n>=0;n--){const i=t.featuresToImport[n];(i.layer===e.layer||i.original&&i.original.layer===e.layer)&&(t.featuresToImport.splice(n,1),r.removeFeature(i))}const n=t.featureImportPanel.getInfoContainer().querySelector(`li[data-layer-id="${e.layer.id}"]`);n&&n.remove()}))})).on(i.Z.event.FEATUREREMOVE,(function(e){t.featureImportPanel&&!t.featureImportPanel.div.classList.contains(i.Z.classes.HIDDEN)&&t.getHighlightsLayer().then((function(r){for(var n=0,i=t.featuresToImport.length;n<i;n++){const i=t.featuresToImport[n];if(i===e.feature||i.original===e.feature){t.featuresToImport.splice(n,1),r.removeFeature(i);const o=t.featureImportPanel.getInfoContainer().querySelector(`li[data-layer-id="${e.layer.id}"]`);if(o){const t=o.querySelector(`#tc-ctl-edit-import-list-cb-${e.layer.id}-${e.feature.id}`);t&&t.remove(),o.children.length||o.remove()}break}}}))})).on(i.Z.event.LAYERUPDATE,(function(e){if(t.featureImportPanel&&!t.featureImportPanel.div.classList.contains(i.Z.classes.HIDDEN)){const r=t.getAvailableFeaturesToImport().find((t=>t.id===e.layer.id));r&&t.getRenderedHtml(t.CLASS+"-import-layer",r,(function(r){const n=t.featureImportPanel.getInfoContainer().querySelector(`.${t.CLASS}-import-list .tc-layers`);n.querySelector(`li[data-layer-id="${e.layer.id}"]`)||n.insertAdjacentHTML("beforeend",r)}))}})).on(i.Z.event.FEATUREADD+" "+i.Z.event.FEATURESADD,(function(e){if(t.featureImportPanel&&!t.featureImportPanel.div.classList.contains(i.Z.classes.HIDDEN)){const r=e.layer,n=(e.feature?[e.feature]:e.features).filter((e=>t.isFeatureAllowed(e)));n.length&&t.displayLayerToImport({id:r.id,title:r.title,features:n})}})).on(i.Z.event.CONTROLACTIVATE,(function(e){switch(e.control){case t.pointDrawControl:_(t,O).setMode(i.Z.geom.POINT);break;case t.lineDrawControl:_(t,O).setMode(i.Z.geom.POLYLINE);break;case t.polygonDrawControl:_(t,O).setMode(i.Z.geom.POLYGON);break;default:_(t,O).clear()}})),t}async loadTemplates(){const e=this,t=r.e(5090).then(r.bind(r,5090)),n=r.e(57).then(r.bind(r,57)),i=r.e(8645).then(r.bind(r,8645)),o=r.e(1306).then(r.bind(r,1306)),a=r.e(1954).then(r.bind(r,1954)),s={};s[e.CLASS]=(await t).default,s[e.CLASS+"-attr"]=(await n).default,s[e.CLASS+"-import"]=(await i).default,s[e.CLASS+"-import-layer"]=(await o).default,s[e.CLASS+"-import-feature"]=(await a).default,e.template=s}async render(e){const t=this;await t._set1stRenderPromise(super.renderData.call(t,{controlId:t.id,stylable:t.stylable,snapping:t.snapping,otherToolsIncluded:t.otherToolsIncluded}));const r=await Promise.all([t.getPointDrawControl(),t.getLineDrawControl(),t.getPolygonDrawControl(),t.getModifyControl()]);t.pointDrawControl=r[0],t.lineDrawControl=r[1],t.polygonDrawControl=r[2],t.pointDrawControl.id=t.getUID(),t.lineDrawControl.id=t.getUID(),t.polygonDrawControl.id=t.getUID(),t.pointDrawControl.snapping=t.snapping,t.lineDrawControl.snapping=t.snapping,t.polygonDrawControl.snapping=t.snapping,t.modifyControl=r[3],t.modifyControl.id=t.getUID();const n=async function(e){if(t.map.options.elevation&&e.getGeometryStride()>2){let r,n=!1;for(const i of l.Z.iterateCoordinates(e.geometry))if(!i[2]){r=r||await t.map.getElevationTool();const e=await r.getElevation({coordinates:[i]});null!=e&&e.length&&(n=!0,i[2]=e[0][2])}n&&e.setCoordinates(e.geometry)}},o=function(e){_(t,O).clearMeasurement(),e.feature&&w(t,G,J).call(t,e.feature)},s=async function(e){await n(e.feature),t.trigger(i.Z.event.DRAWEND,{feature:e.feature})},c=function(){t.cancel()},u=function(e){_(t,O).displayMeasurement(e)};if(t.pointDrawControl.on(i.Z.event.DRAWEND,s).on(i.Z.event.DRAWCANCEL,c).on(i.Z.event.MEASURE+" "+i.Z.event.MEASUREPARTIAL,u),t.lineDrawControl.on(i.Z.event.DRAWSTART,o).on(i.Z.event.DRAWEND,s).on(i.Z.event.DRAWCANCEL,c).on(i.Z.event.MEASURE+" "+i.Z.event.MEASUREPARTIAL,u),t.polygonDrawControl.on(i.Z.event.DRAWSTART,o).on(i.Z.event.DRAWEND,s).on(i.Z.event.DRAWCANCEL,c).on(i.Z.event.MEASURE+" "+i.Z.event.MEASUREPARTIAL,u),t.modifyControl.on(i.Z.event.FEATUREMODIFY,(async function(e){e.layer===t.layer&&_(t,O).displayMeasurement(e.feature),await n(e.feature),t.trigger(i.Z.event.FEATUREMODIFY,{feature:e.feature,layer:e.layer})})).on(i.Z.event.FEATUREADD,(function(e){t.trigger(i.Z.event.FEATUREADD,{feature:e.feature,layer:e.layer})})).on(i.Z.event.FEATUREREMOVE,(function(e){t.trigger(i.Z.event.FEATUREREMOVE,{feature:e.feature,layer:e.layer})})).on(i.Z.event.FEATURESSELECT+" "+i.Z.event.FEATURESUNSELECT,(function(e){const r=t.modifyControl.getSelectedFeatures();r.length?_(t,O).displayMeasurement(r[r.length-1]):_(t,O).clearMeasurement()})),t.modifyControl.displayAttributes=function(){const e=t.getSelectedFeatures(),r=e[e.length-1];if(r){const e=r.getData()||{};t.modifyControl.querySelector("."+t.modifyControl.CLASS+"-btn-attr").classList.add(i.Z.classes.ACTIVE);let o=t.getLayerEditData(r.layer).attributes;if(!Object.keys(o).length){if(t.getSelectedFeatures()[0]&&Object.keys(e).length)for(var n in o={},e)o[n]={name:n,value:e[n]}}const a=Object.keys(o).map((e=>o[e])),s=t._joinedFeatureAttributes||[];a.forEach((function(t){t.value=e[t.name],"id"===t.name&&(t.readOnly=!0),t.availableValues=[],s.forEach((function(e){const r=e[t.name];void 0!==r&&""!==r&&t.availableValues.push(r)}))})),a.forEach((function(e){"date"===e.type?e.value&&(e.value=new Date(e.value).toISOString().substr(0,10)):"dateTime"===e.type&&e.value&&(e.value=new Date(e.value).toISOString().substr(0,19))})),a.sort((function(e,t){return(e.readOnly?!t.readOnly:t.readOnly)?!e.readOnly-!t.readOnly:e.name>t.name?1:e.name<t.name?-1:0})),t.getRenderedHtml(t.CLASS+"-attr",{data:a},(function(e){const r=t.getAttributeDisplayTarget();r.classList.remove(i.Z.classes.HIDDEN),r.innerHTML=e;const n=r.querySelectorAll("input"),o=r.querySelectorAll("select");n.forEach((function(e){e.addEventListener("input",(function(e){const t=e.target;for(var r=0,n=o.length;r<n;r++){const n=o[r];if(n.matches(`[name=${e.target.getAttribute("name")}]`)&&n.value!==t.value){n.value="";break}}}))})),o.forEach((function(e){e.addEventListener("change",(function(e){const t=e.target;for(var r=0,i=n.length;r<i;r++){const i=n[r];if(i.matches(`[name=${e.target.getAttribute("name")}]`)){i.value=t.value;break}}}))})),r.querySelector(`.${t.modifyControl.CLASS}-btn-attr-ok`).addEventListener(i.Z.event.CLICK,(function(e){t.modifyControl._onAttrOK()}),{passive:!0}),r.querySelector(`.${t.modifyControl.CLASS}-btn-attr-cancel`).addEventListener(i.Z.event.CLICK,(function(e){t.modifyControl.closeAttributes()}),{passive:!0})}))}},t.modifyControl._onAttrOK=function(){const e=this,r=e.getSelectedFeatures()[0];if(r){const n={},o=t.getLayerEditData(r.layer).attributes,a=Object.keys(o).length>0;e.getAttributeDisplayTarget().querySelectorAll("input").forEach((function(e){var t=e.getAttribute("name"),r=e.value;if(a)switch(o[t].type){case"int":case"integer":case"byte":case"long":case"negativeInteger":case"nonNegativeInteger":case"nonPositiveInteger":case"positiveInteger":case"short":case"unsignedLong":case"unsignedInt":case"unsignedShort":case"unsignedByte":r=parseInt(r),Number.isNaN(r)||(n[t]=r);break;case"double":case"float":case"decimal":r=parseFloat(r),Number.isNaN(r)||(n[t]=r);break;case"date":n[t]=r?new Date(r).toISOString().substr(0,10):r;break;case"dateTime":n[t]=r?new Date(r).toISOString().substr(0,19):r;break;case"boolean":n[t]=!!r;break;case void 0:break;default:n[t]=r}else n[t]=r})),r.setData(n),e.trigger(i.Z.event.FEATUREMODIFY,{feature:r,layer:e.layer}),e.closeAttributes()}},Array.isArray(t.options.modes)&&t.options.modes.length>0){for(var p in j.mode)if("string"==typeof p&&t.options.modes.indexOf(j.mode[p])<0){const e=w(t,N,V).call(t,j.mode[p]),r=e.target;r.parentElement.removeChild(r),e.parentElement.removeChild(e)}if(1===t.options.modes.length){var h=t.options.modes[0];const e=w(t,N,V).call(t,h);e.parentElement.removeChild(e)}}return t.querySelectorAll(_(t,T).MODE_TAB).forEach((function(e){e.callback=function(){var e;const r=null===(e=this.target)||void 0===e?void 0:e.getAttribute("id");if(r){const e=r.substr(r.lastIndexOf("-")+1);t.mode=this.selected?e:null}}})),t.querySelector(_(t,L)+"-btn-import").addEventListener(i.Z.event.CLICK,(function(e){t.showFeatureImportPanel()}),{passive:!0}),t.querySelector(_(t,L)+"-btn-dl").addEventListener(i.Z.event.CLICK,(function(e){t.getDownloadDialog().then((function(e){const r={title:t.getLocaleString("download"),fileName:t.layer.id.toLowerCase().replace(" ","_")+"_"+a.Z.getFormattedDate((new Date).toString(),!0),elevation:t.options.downloadElevation};e.open(t.layer.features,r)}))}),{passive:!0}),a.Z.isFunction(e)&&e(),t}getGeometryType(e){switch(e){case"gml:LinearRingPropertyType":case"gml:PolygonPropertyType":case"LinearRingPropertyType":case"PolygonPropertyType":return i.Z.geom.POLYGON;case"gml:MultiPolygonPropertyType":case"gml:MultiSurfacePropertyType":case"MultiPolygonPropertyType":case"MultiSurfacePropertyType":return i.Z.geom.MULTIPOLYGON;case"gml:LineStringPropertyType":case"gml:CurvePropertyType":case"LineStringPropertyType":case"CurvePropertyType":return i.Z.geom.POLYLINE;case"gml:MultiLineStringPropertyType":case"gml:MultiCurvePropertyType":case"MultiLineStringPropertyType":case"MultiCurvePropertyType":return i.Z.geom.MULTIPOLYLINE;case"gml:PointPropertyType":case"gml:MultiPointPropertyType":case"PointPropertyType":case"MultiPointPropertyType":return i.Z.geom.POINT;case"gml:BoxPropertyType":case"BoxPropertyType":return i.Z.geom.RECTANGLE;case"gml:GeometryCollectionPropertyType":case"gml:GeometryAssociationType":case"gml:GeometryPropertyType":case"GeometryCollectionPropertyType":case"GeometryAssociationType":case"GeometryPropertyType":return!0;default:return!1}}setLayer(e){const t=this;t.modifyControl&&t.modifyControl.unselectFeatures(t.getSelectedFeatures()),t.layer=t.map.getLayer(e),t.layer&&e.describeFeatureType().then((function(r){const n={attributes:{}};let i;for(i in r){const e=r[i],o=t.getGeometryType(e.type);o?(n.geometryName=e.name,n.geometryType="boolean"==typeof o?null:o):n.attributes[i]=e}for(i in n.attributes){const e=n.attributes[i];e.type=e.type.substr(e.type.indexOf(":")+1)}t.layersEditData[e.id]=n})).catch((function(r){t.layersEditData[e.id]={geometryType:null,attributes:{}}}));const r=e=>e.setLayer(t.layer);return t.getModifyControl().then(r),t.getPointDrawControl().then(r),t.getLineDrawControl().then(r),t.getPolygonDrawControl().then(r),t.mode=t.layer?j.mode.MODIFY:null,w(t,k,Y).call(t,t.layer),t}constrainModes(e){const t=this;Array.isArray(e)||(e=[]),e.length||(e=Object.values(j.mode)),t.modes=e.filter((function(e){for(var t in j.mode)if(j.mode[t]===e)return!0;return!1})).filter((function(e){return!Array.isArray(t.options.modes)||t.options.modes.indexOf(e)>=0})),t.modes.indexOf(t.mode)<0&&(t.mode=null);const r=t.modes.map((e=>`[for="${t.id}-mode-${e}"]`)).join()||"[for]";return t.querySelectorAll(_(t,T).MODE_TAB).forEach((function(e){e.disabled=!e.matches(r)})),t}isFeatureAllowed(e){const t=this;switch(!0){case e instanceof c.Z:return t.modes.includes(j.mode.ADDPOINT);case e instanceof u.Z:return t.modes.includes(j.mode.ADDLINE);case e instanceof p.Z:return t.modes.includes(j.mode.ADDLINE)&&t.isMultiple;case e instanceof h.Z:return t.modes.includes(j.mode.ADDPOLYGON);case e instanceof d.Z:return t.modes.includes(j.mode.ADDPOLYGON)&&t.isMultiple;default:return!0}}async setComplexGeometry(e){const t=this;t.isMultiple=e,(await t.getLineDrawControl()).setMode(e?i.Z.geom.MULTIPOLYLINE:i.Z.geom.POLYLINE),(await t.getPolygonDrawControl()).setMode(e?i.Z.geom.MULTIPOLYGON:i.Z.geom.POLYGON)}getLayerEditData(e){const t=this,r=e||t.layer;return r?t.layersEditData[r.id]=t.layersEditData[r.id]||{checkedOut:!1}:null}cancel(){const e=this;return Array.isArray(e.options.modes)&&1==e.options.modes.length?e.mode=e.options.modes[0]:e.mode=null,e.wrap.cancel(!0,e.cancelActionConfirmTxt),e}async activate(e){const t=this;let r;switch((e=e||{}).mode){case j.mode.ADDPOINT:r=await t.getPointDrawControl();break;case j.mode.ADDLINE:r=await t.getLineDrawControl();break;case j.mode.ADDPOLYGON:r=await t.getPolygonDrawControl();break;default:r=await t.getModifyControl()}r!==t.map.activeControl&&S(t,A,t.map.activeControl)}deactivate(){const e=this;if(_(e,A))switch(e.map.previousActiveControl=_(e,A),e.map.activeControl){case e.pointDrawControl:e.pointDrawControl.deactivate();break;case e.lineDrawControl:e.lineDrawControl.deactivate();break;case e.polygonDrawControl:e.polygonDrawControl.deactivate();break;case e.modifyControl:e.modifyControl.deactivate()}return e.modifyControl&&e.modifyControl.closeAttributes(),e}isExclusive(){return!0}getAttributeDisplayTarget(){var e;return null===(e=this.modifyControl)||void 0===e?void 0:e.getAttributeDisplayTarget()}getSelectedFeatures(){var e;return null===(e=this.modifyControl)||void 0===e?void 0:e.getSelectedFeatures()}setSelectedFeatures(e){var t;return null===(t=this.modifyControl)||void 0===t?void 0:t.setSelectedFeatures(e)}async getLayer(){const e=this;return e.layer?e.layer:await e.layerPromise}async getModifyControl(){const e=this;return await e.renderPromise(),e.querySelector(`.${e.CLASS}-modify sitna-modify`)}async getPointDrawControl(){const e=this;return await e.renderPromise(),e.querySelector(`.${e.CLASS}-point sitna-draw`)}async getLineDrawControl(){const e=this;return await e.renderPromise(),e.querySelector(`.${e.CLASS}-line sitna-draw`)}async getPolygonDrawControl(){const e=this;return await e.renderPromise(),e.querySelector(`.${e.CLASS}-polygon sitna-draw`)}async getFeatureImportPanel(){const e=this;return _(e,x)||(S(e,x,e.map.addControl("resultsPanel",{titles:{main:e.getLocaleString("importFromOtherLayer")}})),e.featureImportPanel=await _(e,x)),await _(e,x)}async getHighlightsLayer(){const e=this;return _(e,P)||(S(e,P,e.map.addLayer({id:e.getUID(),type:i.Z.layerType.VECTOR,title:"Highlights Layer",stealth:!0,styles:e.map.options.styles.selection||o.Z.styles.selection})),e.highlightsLayer=await _(e,P)),_(e,P)}async highlightFeatures(e){const t=await this.getHighlightsLayer(),r=this.featuresToImport.concat(e);t.features.slice().forEach((function(e){(!e.original||r.indexOf(e.original)<0)&&t.removeFeature(e)})),await t.addFeatures(r.filter((function(e){return!t.features.some((function(t){return t.original&&t.original===e}))})).map((function(e){const t=e.clone();return t.toggleSelectedStyle(!0),t.original=e,t})))}getAvailableFeaturesToImport(){const e=this;return e.map.workLayers.filter((e=>!e.isRaster())).filter((t=>t!==e.layer)).filter((t=>t!==e.highlightsLayer)).map((function(t){return{id:t.id,title:t.title,features:t.features.filter((function(t){return e.isFeatureAllowed(t)}))}})).filter((e=>e.features.length))}importFeatures(e){const t=this;let r=!1;const n=t.getLayerEditData();return(e||t.featuresToImport||[]).filter((e=>{const n=t.isFeatureAllowed(e);return n||(r=!0),n})).map((function(e){let r;const i={data:e.data,geometryName:n.geometryName};if(t.isMultiple)switch(!0){case e instanceof h.Z:r=new d.Z([e.geometry],i);break;case e instanceof u.Z:r=new p.Z([e.geometry],i);break;default:r=e.clone()}else switch(!0){case e instanceof d.Z:r=new h.Z(e.geometry[0],i);break;case e instanceof p.Z:r=new u.Z(e.geometry[0],i);break;default:r=e.clone()}return r.setStyle(null),r})).forEach((function(e){t.layer.addFeature(e),t.trigger(i.Z.event.FEATUREADD,{feature:e,layer:t.layer})})),r&&t.map.toast(t.getLocaleString("importFromOtherLayer.warning"),{type:i.Z.msgType.WARNING}),t}showFeatureImportPanel(){const e=this;e.featuresToImport=[],e.getFeatureImportPanel().then((function(t){const r=t.getInfoContainer();e.getRenderedHtml(e.CLASS+"-import",{layers:e.getAvailableFeaturesToImport()},(function(n){t.open(n,r),r.querySelector("ul").addEventListener("mouseout",(function(t){e.highlightFeatures([])})),r.querySelectorAll("li.tc-layer").forEach((function(t){w(e,U,X).call(e,t)})),r.querySelector(`.${e.CLASS}-import-btn-ok`).addEventListener(i.Z.event.CLICK,(function(t){e.importFeatures(),e.featureImportPanel.close()}),{passive:!0})}))}))}async displayLayerToImport(e){const t=this;if(t.featureImportPanel&&!t.featureImportPanel.div.classList.contains(i.Z.classes.HIDDEN)){const r=t.featureImportPanel.getInfoContainer().querySelector(`.${t.CLASS}-import-list .tc-layers`),n=`li[data-layer-id="${e.id}"]`,i=r.querySelector(n);if(i)return e.features.forEach((function(r){t.isFeatureAllowed(r)&&t.getRenderedHtml(t.CLASS+"-import-feature",e,(function(e){i.insertAdjacentHTML("beforeend",e),w(t,B,$).call(t,i.querySelector("li:last-child"))}))})),i;{const i=await t.getRenderedHtml(t.CLASS+"-import-layer",{id:e.id,title:e.title,features:e.features});r.insertAdjacentHTML("beforeend",i);const o=r.querySelector(n);return w(t,U,X).call(t,o),o}}return null}}async function W(){const e=this,t=await Promise.all([e.getModifyControl(),e.getPointDrawControl(),e.getLineDrawControl(),e.getPolygonDrawControl()]),r=e.stylable;t.forEach((e=>e.stylable=r))}async function H(){const e=this,t=e.snapping;(await e.getPointDrawControl()).snapping=t,(await e.getLineDrawControl()).snapping=t,(await e.getPolygonDrawControl()).snapping=t}function q(){const e=this,t=e.mode;var r=function(t){t&&(e.snapping&&(t.snapping=e.layer),t.activate())};Promise.all([e.getPointDrawControl(),e.getLineDrawControl(),e.getPolygonDrawControl(),e.getModifyControl()]).then((function(n){const o=n[0],a=n[1],s=n[2],l=n[3];switch(t){case j.mode.MODIFY:l.activate();break;case j.mode.ADDPOINT:r(o),_(e,O).mode=i.Z.geom.POINT;break;case j.mode.ADDLINE:r(a),_(e,O).mode=i.Z.geom.POLYLINE;break;case j.mode.ADDPOLYGON:r(s),_(e,O).mode=i.Z.geom.POLYGON;break;case j.mode.OTHER:default:n.indexOf(e.map.activeControl)>=0&&e.map.activeControl.deactivate()}if(t){e.querySelector(`${_(e,T).MODE_TAB}[for="${e.id}-mode-${t}"]`).selected=!0}else e.querySelectorAll(_(e,T).MODE_TAB).forEach((function(e){e.selected=!1}))}))}function V(e){return this.querySelector(`sitna-tab[for="${this.id}-mode-${e}"]`)}function z(e){const t=e.querySelector("input"),r=this.map.getLayer(e.parentElement.parentElement.dataset.layerId);return r?r.getFeatureById(t.value):null}function Y(e){this.querySelectorAll(_(this,T).MODE_RADIO_BUTTON).forEach((t=>t.disabled=!e))}function K(e){const t=this,r=w(t,Z,z).call(t,e.parentElement);if(e.checked)t.featuresToImport.push(r);else{const e=t.featuresToImport.indexOf(r);e>=0&&t.featuresToImport.splice(e,1)}}function X(e){const t=this;e.querySelector("input").addEventListener("change",(function(e){const r=this;r.parentElement.querySelectorAll("li.tc-feature input").forEach((function(e){e.checked!==r.checked&&(e.checked=r.checked,w(t,F,K).call(t,e))})),t.highlightFeatures([])})),e.querySelectorAll("li.tc-feature").forEach((function(e){w(t,B,$).call(t,e)}))}function $(e){const t=this,r=function(e){const r=w(t,Z,z).call(t,this);r&&t.highlightFeatures([r])};e.addEventListener(i.Z.event.CLICK,r,{passive:!0}),e.addEventListener("mouseover",r),e.querySelector("input").addEventListener("change",(function(e){w(t,F,K).call(t,this)}))}function J(e){_(this,I).set(e,e.clone())}v(j,"mode",{MODIFY:"modify",ADDPOINT:"addpoint",ADDLINE:"addline",ADDPOLYGON:"addpolygon",CUT:"cut",OTHER:"other"}),customElements.get(C)||customElements.define(C,j);const Q=j},2212:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var n=r(688),i=r(330),o=r(9967),a=r(268),s=r(7497),l=r(6204),c=r(3048),u=r(8683),p=r(1872),h=r(1399);n.Z.control=n.Z.control||{};const d=function(){const e=this;s.Z.apply(e,arguments),e.displayElevation=!0,e.resultsPanel=null};n.Z.inherit(d,s.Z),function(){const e=d.prototype;e.CLASS="tc-ctl-elev";const t=new WeakMap,f=new Map,g=function(e){if(e){const t=e.getCoords();t&&f.delete(t.toString())}};e.loadTemplates=async function(){const e=this,t=r.e(8178).then(r.bind(r,8178)),n=r.e(9365).then(r.bind(r,9365)),i={};i[e.CLASS]=(await t).default,i[e.CLASS+"-val"]=(await n).default,e.template=i},e.register=async function(e){const r=this;return await s.Z.prototype.register.call(r,e),e.on(i.Z.event.FEATUREMODIFY+" "+i.Z.event.FEATUREREMOVE,(function(e){g(e.feature)})).on(i.Z.event.FEATUREREMOVE,(function(e){g(e.feature)})).on(i.Z.event.LAYERREMOVE,(function(e){e.layer.features&&e.layer.features.forEach((e=>g(e)))})).on(i.Z.event.POPUP+" "+i.Z.event.DRAWTABLE,(function(e){t.has(e.control.currentFeature)&&r.displayElevationValue(e.control.currentFeature)})),r},e.getElevationTool=async function(){const e=this,t={options:{displayElevation:e.options||!0},elevation:e.elevation,map:e.map},r=await s.Z.prototype.getElevationTool.call(t);return e.elevation=r,r},e.setElevationToolOptions=function(e){const t=this;a.Z.extend(t.options,e),t.elevation&&a.Z.extend(t.elevation.options,t.options)},e.displayElevationValue=async function(e,r){const i=this;if(r=r||{},e instanceof c.Z){let s;if(r.ignoreCache?t.delete(e):s=t.get(e),!s){const r=await i.getElevationTool(),n=await r.getElevation({crs:i.map.crs,coordinates:[e.geometry]});if(n.length){const r=n[0];s={elevation:r[2],height:r.length>3?r[3]:null},t.set(e,s)}}if(s){const t=[];let r;const l=i.map.options.locale||o.Z.locale,c=i.map.getControlsByClass("TC.control.Popup").concat(i.map.getControlsByClass("TC.control.ResultsPanel"));c.filter((t=>t.caller&&t.caller.highlightedFeature===e)).forEach((function(n){const i=n.caller.getFeatureElement(e);i&&(r=i.querySelector("tbody"),t.push(r))})),c.filter((t=>t.currentFeature===e)).forEach((function(e){let i;switch(!0){case n.Z.control.Popup&&e instanceof n.Z.control.Popup:i=e.getContainerElement();break;case n.Z.control.ResultsPanel&&e instanceof n.Z.control.ResultsPanel:i=e.getInfoContainer()}i&&(r=i.querySelector("tbody"),t.push(r))}));const u={elevationValue:null!==s.elevation?a.Z.formatNumber(Math.round(s.elevation),l):"",heightValue:s.height?s.height.toLocaleString(l,{maximumFractionDigits:1}):""},p=e.geometry[2];"number"==typeof p&&p!==s.elevation&&(u.originalValue=a.Z.formatNumber(Math.round(p))),t.forEach((function(e){i.getRenderedHtml(i.CLASS+"-val",u,(function(t){e.querySelectorAll(`tr[class|=${i.CLASS}-pair]`).forEach((e=>e.remove())),e.insertAdjacentHTML("beforeend",t)}))}))}}},e.displayElevationProfile=async function(e,t){const r=this,i=t||{};let o;switch(!0){case e instanceof u.Z:o=[e.geometry];break;case e instanceof p.Z:o=e.geometry;break;case e instanceof l.Z:return;default:o=[e]}r.getProfilePanel().then((function(e){e.open()}));const s=function(e){r.getProfilePanel().then((function(t){t.renderPromise().then((function(){r.renderElevationProfile(e)}))}))};if(e instanceof l.Z){r.getProfilePanel().then((function(t){t.setCurrentFeature(e)}));const t=function(e){if(e){const t=e.getCoords();return t?f.get(t.toString()):null}}(e);if(t)return void s(t)}const c=r.map.getLoadingIndicator(),d=c&&c.addWait(),g=function(t,i){let o=t,c=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY;r.map.getCRS()!==r.map.options.utmCrs&&(o=a.Z.reproject(t,r.map.getCRS(),r.map.options.utmCrs));const p=o.map((e=>{let t=0;return e.map((function(e,r,n){let i=0===r?e:n[r-1];t+=Math.hypot(e[0]-i[0],e[1]-i[1]);var o=e[2]||0;return"number"==typeof o&&(c=Math.max(o,c),u=Math.min(o,u)),[t,o]}))})).reduce((function(e,t){const r=e[e.length-1][0];return t.forEach((e=>e[0]+=r)),e.concat(t)}));1===p.length&&p.push(p[0]);const h=o.flat();let d={x:p.map((function(e){return e[0]})),ele:p.map((function(e){return e[1]||0})),coords:h,min:u,max:c};const g={coords:h};"object"==typeof r.options&&r.map.options.elevation&&(g.hillDeltaThreshold=r.options.hillDeltaThreshold||r.map.options.elevation.hillDeltaThreshold),0===u&&0===c&&i.onlyOriginalElevation&&(d={msg:r.getLocaleString("geo.trk.chart.chpe.empty")}),a.Z.extend(d,n.Z.tool.Elevation.getElevationGain(g),i),i.isSecondary&&r.elevationProfileChartData&&(r.elevationProfileChartData.secondaryElevationProfileChartData?r.elevationProfileChartData.secondaryElevationProfileChartData[0]=d:(r.elevationProfileChartData.showLegend=!0,r.elevationProfileChartData.secondaryElevationProfileChartData=[],r.elevationProfileChartData.secondaryElevationProfileChartData.push(d))),e instanceof l.Z&&!i.ignoreCaching&&function(e,t){if(e){const r=e.getCoords();r&&f.set(r.toString(),t)}}(e,d),s(d)},y=await r.getElevationTool();if(i.originalElevation&&g(o,i),i.onlyOriginalElevation)return void(c&&c.removeWait(d));const m=Date.now();r._depTimestamp=m;const v={crs:r.map.getCRS()};Object.prototype.hasOwnProperty.call(y.options,"resolution")&&(v.resolution=y.options.resolution);const _=Object.prototype.hasOwnProperty.call(y.options,"sampleNumber")?y.options.sampleNumber:0;_>0&&(v.resolution=0);const w=new Array(o.length);if(w.fill(_),_>0){const e=new Array(o.length);let t=0;o.forEach(((r,n)=>{const i=new u.Z(r).getLength();e[n]=i,t+=i})),w.forEach(((r,n,i)=>{i[n]=Math.floor(r*e[n]/t)}))}const S=o.map(((e,t)=>{const r=Object.assign({},v,{sampleNumber:w[t]});return h.Z.interpolate(e,r)})),E=S.map(((e,t)=>{const n=Object.assign({},v,{coordinates:e,partialCallback:function(e){m===r._depTimestamp&&(S[t]=e,g(S,{isSecondary:0!==Object.keys(i).length,ignoreCaching:i.ignoreCaching}))},resolution:0,sampleNumber:0});return y.getElevation(n)}));try{await Promise.all(E),i.callback&&a.Z.isFunction(i.callback)&&i.callback(),null==c||c.removeWait(d)}catch(e){r.resetElevationProfile(),null==c||c.removeWait(d)}},e.createProfilePanel=async function(){const t=this,r={id:t.getUID(),content:"chart",titles:{main:t.getLocaleString("geo.trk.chart.chpe"),max:t.getLocaleString("geo.trk.chart.chpe")},chart:{ctx:t,onmouseout:e.removeElevationTooltip,tooltip:e.getElevationTooltip}};let n;if(t.options.displayOn){let e=t.map.getControlsByClass("TC.control."+t.options.displayOn[0].toUpperCase()+t.options.displayOn.substring(1))[0];e||(e=await t.map.addControl(t.options.displayOn)),function(e){r.position=e.POSITION.RIGHT,n=e.addControl("resultsPanel",r)}(e)}else r.div=document.createElement("div"),t.map.div.appendChild(r.div),n=t.map.addControl("resultsPanel",r);const i=await n;return i.caller=t,t.resultsPanel=i,t._decorateChartPanel(),i},e.getProfilePanel=async function(){const e=this;return e._resultsPanelPromise||(e._resultsPanelPromise=e.createProfilePanel()),await e._resultsPanelPromise},e.resetElevationProfile=function(){const e=this;e.options.displayElevation&&e.resultsPanel&&(e.elevationProfileChartData={x:[0],ele:[0],coords:[0,0,0],upHill:0,downHill:0},e.resultsPanel.openChart(e.elevationProfileChartData))},e.renderElevationProfile=function(e){const t=this;e.isSecondary||(t.elevationProfileChartData=e||t.elevationProfileChartData),t.getProfilePanel().then((function(r){r.div.classList.contains(i.Z.classes.HIDDEN)||(e.isSecondary?r.loadDataOnChart(t.elevationProfileChartData):r.openChart(t.elevationProfileChartData),r.isMinimized()||r.doVisible())}))},e.closeElevationProfile=function(){this.getProfilePanel().then((function(e){e.close()}))},e._decorateChartPanel=function(){const e=this;e.resultsPanel.setCurrentFeature=function(e){const t=this;t.currentFeature&&t.currentFeature.toggleSelectedStyle(!1),t.currentFeature=e,e&&e.toggleSelectedStyle(!0)};const t=e.resultsPanel.close;e.resultsPanel.close=function(){const e=this;e.currentFeature&&e.currentFeature.toggleSelectedStyle(!1),t.call(e)}},e.getElevationTooltip=function(e){const t=this;return t.resultsPanel.wrap.showElevationMarker({data:e,layer:t.resultsPanel.currentFeature&&t.resultsPanel.currentFeature.layer,coords:t.elevationProfileChartData.coords}),t.resultsPanel.getElevationChartTooltip(e)},e.removeElevationTooltip=function(){const e=this;e.resultsPanel&&(e.resultsPanel.chart&&e.resultsPanel.chart.chart&&e.resultsPanel.chart.chart.tooltip.hide(),e.resultsPanel.wrap.hideElevationMarker())}}(),n.Z.control.Elevation=d;const f=d},2429:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var n=r(688),i=r(330),o=r(7497),a=r(4115);function s(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}function l(e,t){var r=function(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}(e,t,"get");return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,r)}n.Z.control=n.Z.control||{};var c=new WeakMap;class u extends o.Z{constructor(){super(...arguments),s(this,c,{writable:!0,value:[]});const e=this;e.div.classList.add(e.CLASS),e.count=0,e.allowReprojection=!Object.prototype.hasOwnProperty.call(e.options,"allowReprojection")||e.options.allowReprojection}getClassName(){return"tc-ctl-xwms"}async register(e){const t=this;await super.register.call(t,e),t.div.addEventListener("change",n.Z.EventTarget.listenerBySelector("select",(function(e){if(""!==e.target.value){var r=e.target.value;0===r.indexOf("//")&&(r=location.protocol+r),t.div.querySelector("input").value=r,e.target.value=""}})));const r=function(){var e=t.div.querySelector("input").value.trim();if(e)if(/^((https?|ftp):)?(\/\/)?(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e))if(l(t,c).some((function(t){return t.replace(/https?:\/\/|\/\//,"")===e.replace(/https?:\/\/|\/\//,"")})))n.Z.alert(t.getLocaleString("serviceAlreadyAdded"));else{var r=t.map.getControlsByClass("TC.control.LoadingIndicator")[0];r.show();var o=n.Z.Util.getQueryStringParams(e);/https?:\/\/|\/\//i.test(e)||(e="//"+e);var s=["version","service","request"],u=function(e,t){for(var r=0;r<t.length;r++)e=n.Z.Util.removeURLParameter(e,t[r]);return e.match(/\?$/)&&(e=e.substr(0,e.length-1)),e}(e,Object.keys(o));for(var p in o)s.indexOf(p.toLowerCase())>=0&&delete o[p];const y=t.div.querySelector("button");y.setAttribute("type","button"),y.disabled=!0;for(var h={id:"xwms"+ ++t.count,type:"WMS",url:u,hideTree:!1,queryParams:o},d=0;d<t.options.suggestions.length;d++){var f=t.options.suggestions[d].items.filter((t=>t.url===e));if(f.length>0&&f[0].layerNames){h.layerNames=f[0].layerNames;break}}var g=new a.Z(h);g.getCapabilitiesPromise().then((function(o){if(void 0===o.Capability)return n.Z.alert(t.getLocaleString("noLayersFoundInService")),r.hide(),void(y.disabled=!1);{var a=o.Capability.Layer;if(a.CRS&&-1===a.CRS.indexOf(t.map.crs)&&!t.allowReprojection)return n.Z.alert(t.getLocaleString("serviceSrsNotCompatible")),r.hide(),void(y.disabled=!1);t.map.trigger(i.Z.event.EXTERNALSERVICEADDED,{layer:g}),t.div.querySelector("input").value="";const s=[];t.div.querySelectorAll("select option").forEach((function(t){t.value.replace(/https?:\/\/|\/\//,"")===e.replace(/https?:\/\/|\/\//,"")&&s.push(t)})),t.markServicesAsSelected(s),l(t,c).push(e),r.hide(),y.disabled=!1}}),(function(e){n.Z.alert(t.getLocaleString("serviceCouldNotBeLoaded")+":\n"+e),r.hide(),y.disabled=!1}))}else n.Z.alert(t.getLocaleString("typeAValidAddress"));else n.Z.alert(t.getLocaleString("typeAnAddress"))};return await t.renderPromise(),t.div.querySelector("input").addEventListener("keyup",(e=>{e.key&&"enter"===e.key.toLowerCase()&&t.div.querySelector("input").value.trim().length>0&&r()})),t.div.addEventListener("click",n.Z.EventTarget.listenerBySelector('button[name="agregar"]',r)),e.on(i.Z.event.LAYERADD,(function(e){const r=e.layer;if(r&&!r.isBase){var n=r.url;if(n){t.pending_markServicesAsSelected=t.pending_markServicesAsSelected||[],0===t.div.querySelectorAll("select option").length&&n&&-1===t.pending_markServicesAsSelected.indexOf(n)&&t.pending_markServicesAsSelected.push(n);const e=[];t.div.querySelectorAll("select option").forEach((function(t){t.value.replace(/https?:\/\/|\/\//,"")===n.replace(/https?:\/\/|\/\//,"")&&e.push(t)})),t.markServicesAsSelected(e),l(t,c).push(n)}}})),t}async loadTemplates(){const e=await r.e(1830).then(r.bind(r,1830));this.template=e.default}render(e){const t=this;return t._set1stRenderPromise(t.renderData(t.options,(function(){t.pending_markServicesAsSelected=t.pending_markServicesAsSelected||[],t.pending_markServicesAsSelected.forEach((function(e){const r=[];t.div.querySelectorAll("select option").forEach((function(t){n.Z.Util.addProtocol(t.value)===n.Z.Util.addProtocol(e)&&r.push(t)})),t.markServicesAsSelected(r),l(t,c).push(e)})),t.pending_markServicesAsSelected=[],"function"==typeof e&&e()})))}markServicesAsSelected(e){if(e.length>0){const t=e[0];t.disabled=!0,t.classList.add("tc-ctl-xwms-option-selected")}}}n.Z.control.ExternalWMS=u;const p=u},3697:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>M});var n=r(688),i=r(268),o=r(330),a=r(7497),s=r(3048),l=r(8033),c=r(8683),u=r(1872),p=r(9529),h=r(5265);function d(e,t){g(e,t),t.add(e)}function f(e,t,r){g(e,t),t.set(e,r)}function g(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function y(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,v(e,t,"set"),r),r}function m(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,v(e,t,"get"))}function v(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}function _(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}n.Z.control=n.Z.control||{};var w=new WeakMap,S=new WeakMap,E=new WeakMap,b=new WeakMap,C=new WeakSet,L=new WeakSet,T=new WeakSet,A=new WeakSet;class x extends a.Z{constructor(){super(...arguments),d(this,A),d(this,T),d(this,L),d(this,C),f(this,w,{writable:!0,value:void 0}),f(this,S,{writable:!0,value:!1}),f(this,E,{writable:!0,value:null}),f(this,b,{writable:!0,value:["KMZ","GML","GeoJSON","WKT","WKB","GPX","SHP","GPKG"]});const e=this;e.title=e.options.title,e.cssClass=e.options.cssClass||"",e._selectors={ELEVATION_CHECKBOX:"."+e.CLASS+"-elev input[type=checkbox]",INTERPOLATION_PANEL:"."+e.CLASS+"-ip",INTERPOLATION_RADIO:`input[type=radio][name=${e.id}-finfo-ip-coords]`,INTERPOLATION_DISTANCE:"."+e.CLASS+"-ip-m"},e.features=[],e.options={}}getClassName(){return"tc-ctl-dldlog"}async loadTemplates(){const e=await r.e(5131).then(r.bind(r,5131));this.template=e.default}render(e){return super.renderData.call(this,{controlId:this.id},e)}open(e,t){const r=this;r.close(),r.setFeatures(e),t=t||{};const i=(t=Object.assign({},{controlId:r.id,cssClass:r.cssClass,checkboxId:r.getUID(),elevation:t.elevation},t)).excludedFormats?t.excludedFormats.slice():[];_(r,C,P).call(r,r)||_(r,L,O).call(r,r)||!_(r,T,I).call(r,r)||i.push(o.Z.format.GPX),t.formats=m(r,b).filter((e=>i.indexOf(e)<0)),r.setOptions(t),r.getRenderedHtml(r.CLASS,t,(function(e){const i=document.createElement("template");i.innerHTML=e,r.modal=i.content?i.content.firstChild:i.firstChild,document.body.appendChild(r.modal);const a=r.modalBody=r.modal.getElementsByClassName("tc-modal-body")[0];a.addEventListener(o.Z.event.CLICK,n.Z.EventTarget.listenerBySelector("button[data-format]",(function(e){var i=m(r,w)&&m(r,S)?parseFloat(a.querySelector(r._selectors.INTERPOLATION_DISTANCE+" input[type=number]").value)||(r.options.elevation||r.map.elevation&&r.map.elevation.options).resolution:0;const s=async(e,a)=>{var s=!1;if(l!==o.Z.format.GEOJSON&&a.format!==o.Z.format.WKT&&e.some((function(e){for(var t in e.getData())if(e.data[t]instanceof Object)return!0;return!1}))&&await n.Z.confirm(r.getLocaleString("dl.export.complexAttr").format(l),null,(function(){s=!0})),s)return;const c=r.map.getLoadingIndicator(),u=c&&c.addWait();n.Z.Util.closeModal(),_(r,A,R).call(r,e,{displayElevation:m(r,w),elevation:m(r,w)?Object.assign({},a.elevation||r.map.elevation&&r.map.elevation.options,{resolution:i}):null}).then((function(e){const i=a.fileName||(a.title?a.title.toLowerCase().replace(/ /g,"_"):"download");let s=a.fileName||i+" "+n.Z.Util.getFormattedDate((new Date).toString(),!0);r.map.exportFeatures(e,{fileName:i,format:l}).then((e=>{switch(s=s||n.Z.getUID(),l){case o.Z.format.SHAPEFILE:n.Z.Util.downloadBlob(s+".zip",e);break;case o.Z.format.GEOPACKAGE:n.Z.Util.downloadFile(s+".gpkg","application/geopackage+sqlite3",e);break;case o.Z.format.KMZ:n.Z.Util.downloadBlob(s+".kmz",e);break;default:{const r=o.Z.mimeType[t.format];n.Z.Util.downloadFile(s+"."+l.toLowerCase(),r,e);break}}}))}),(function(t){r.open(e,a),n.Z.tool.Elevation&&t.message===n.Z.tool.Elevation.errors.MAX_COORD_QUANTITY_EXCEEDED?n.Z.alert(r.getLocaleString("tooManyCoordinatesForElevation.warning")):n.Z.error(r.getLocaleString("elevation.error"))})).finally((function(){c&&c.removeWait(u)}))},l=e.target.dataset.format;l===o.Z.format.GPX&&_(r,T,I).call(r)?n.Z.confirm(r.getLocaleString("gpxNotCompatible.confirm"),(function(){s(r.getFeatures().filter((function(e){return!(e instanceof p.Z||e instanceof h.Z)})),r.getOptions())})):s(r.getFeatures(),r.getOptions())})),{passive:!0});const s=a.querySelector(r._selectors.INTERPOLATION_PANEL),l=a.querySelector(r._selectors.ELEVATION_CHECKBOX);t.elevation&&(y(r,w,t.elevation.checked?t.elevation.checked:m(r,w)),l.checked=m(r,w),s&&(m(r,w)?s.classList.remove(o.Z.classes.HIDDEN):s.classList.contains(o.Z.classes.HIDDEN)||s.classList.add(o.Z.classes.HIDDEN),m(r,w)&&(_(r,L,O).call(r)||_(r,T,I).call(r))&&t.elevation.resolution?s.classList.remove(o.Z.classes.HIDDEN):s.classList.contains(o.Z.classes.HIDDEN)||s.classList.add(o.Z.classes.HIDDEN),a.querySelectorAll(r._selectors.INTERPOLATION_RADIO)[m(r,S)?1:0].checked=!0,m(r,S)&&(a.querySelector(r._selectors.INTERPOLATION_DISTANCE).classList.remove(o.Z.classes.HIDDEN),a.querySelector(r._selectors.INTERPOLATION_DISTANCE+" input").value=m(r,E)||a.querySelector(r._selectors.INTERPOLATION_DISTANCE+" input").value))),a.addEventListener("change",n.Z.EventTarget.listenerBySelector(r._selectors.ELEVATION_CHECKBOX,(function(e){y(r,w,!m(r,w)),s&&(m(r,w)?s.classList.remove(o.Z.classes.HIDDEN):s.classList.contains(o.Z.classes.HIDDEN)||s.classList.add(o.Z.classes.HIDDEN),m(r,w)&&(_(r,L,O).call(r)||_(r,T,I).call(r))?s.classList.remove(o.Z.classes.HIDDEN):s.classList.contains(o.Z.classes.HIDDEN)||s.classList.add(o.Z.classes.HIDDEN))}))),a.addEventListener("change",n.Z.EventTarget.listenerBySelector(r._selectors.INTERPOLATION_RADIO,(function(e){a.querySelector(r._selectors.INTERPOLATION_DISTANCE).classList.toggle(o.Z.classes.HIDDEN),y(r,S,!m(r,S)),m(r,S)&&(a.querySelector(r._selectors.INTERPOLATION_DISTANCE+" input").value=m(r,E)||a.querySelector(r._selectors.INTERPOLATION_DISTANCE+" input").value)}))),a.addEventListener("change",n.Z.EventTarget.listenerBySelector(r._selectors.INTERPOLATION_DISTANCE,(function(e){y(r,E,e.target.value)})));let c={closeCallback:function(){r.modal.parentElement.removeChild(r.modal)}};t.openCallback&&(c.openCallback=t.openCallback),n.Z.Util.showModal(r.modal,c)}))}close(e){const t=this;t.modal&&t.modal.parentElement&&(i.Z.closeModal(),t.modal.parentElement.removeChild(t.modal))}setFeatures(e){this.features=Array.isArray(e)?e:[e]}getFeatures(){return this.features}setOptions(e){this.options=Object.assign(this.options,e)}getOptions(){return this.options}}function P(){return this.getFeatures().some((e=>e instanceof s.Z||e instanceof l.Z))}function O(){return this.getFeatures().some((e=>e instanceof c.Z||e instanceof u.Z))}function I(){return this.getFeatures().some((e=>e instanceof p.Z||e instanceof h.Z))}async function R(e,t){const r=this,i=function(e){const t=e.clone();return t.id=e.id,t};if(!(t=t||{}).displayElevation)return e.map((function(e){if(e.getGeometryStride()>2){const t=i(e);return t.id=e.id,t.layer=e.layer,t.removeZ(),t}return e}));let o=t.elevation&&t.elevation.resolution,a=o?e.map((e=>i(e))):e.map((e=>e.getCoordsArray().every((e=>!e[2]))?i(e):null));if(o||a.some((e=>null!==e))){const i={crs:r.map.getCRS(),features:a,maxCoordQuantity:t.elevation&&t.elevation.maxCoordQuantity,resolution:t.elevation.resolution,sampleNumber:t.elevation.sampleNumber||0},o=await(r.map.elevation||new n.Z.tool.Elevation("boolean"==typeof t.elevation?{}:t.elevation)).setGeometry(i);return o.forEach(((t,r)=>{t||(o[r]=e[r])})),o}return e}n.Z.control.FeatureDownloadDialog=x;const M=x},2863:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var n=r(688),i=r(330),o=r(9967),a=r(4094),s=r(9614),l=r.n(s);n.Z.control=n.Z.control||{};const c=function(){var e=this;a.default.apply(this,arguments),e.wrap=new n.Z.wrap.control.FeatureInfo(e),i.Z.classes.FROMLEFT="tc-fromleft",i.Z.classes.FROMRIGHT="tc-fromright"};var u,p;n.Z.inherit(c,a.default),p=function e(t,r){var n;if(Array.isArray(t))for(var i=0,o=(n=t.slice()).length;i<o;i++)n[i]=e(n[i]);else n="number"==typeof t?Math.round(t.toFixed(r)):t;return n},(u=c.prototype).register=async function(e){const t=await a.default.prototype.register.call(this,e);return document.createElement("div").appendChild(this.div),t},u.callback=function(e,t){const r=this;return r.querying=!0,new Promise((function(t,o){const a=r.getElevationTool();if(a.then((function(t){t&&(r.elevationRequest=t.getElevation({crs:r.map.crs,coordinates:[e]}))})),r.map&&r.filterLayer){var s=r.getLocaleString("featureInfo"),l=n.Z.Util.extend({},r.map.options.styles.marker,r.markerStyle,{title:s,set:s,showsPopup:!1});r.filterLayer.clearFeatures(),r.highlightedFeature=null,r.filterFeature=null,r.filterLayer.addMarker(e,l).then((function(n){r.map.putLayerOnTop(r.filterLayer),r.filterFeature=n,a.then((function(e){r.renderResults({coords:n.geometry,displayElevation:e,loading:!0},(function(){r.displayResults()}))}));for(var o=!1,s=0;s<r.map.workLayers.length;s++){var l=r.map.workLayers[s];if(l.type===i.Z.layerType.WMS&&l.getVisibility()&&l.names.length>0){o=!0;break}}r.queryResolution=r.map.getResolution(),o?r.wrap.getFeatureInfo(e,r.queryResolution).then((()=>t())):setTimeout((function(){r.responseCallback({coords:e}),t()}))}))}else t()}))},u.sendRequest=function(e){return this.callback(e.getCoordinates())},u.responseCallback=function(e){const t=this;if(a.default.prototype.responseCallback.call(t,e),t.filterFeature){var r=e.services;if(r)for(var o=0;o<r.length;o++){for(var s=r[o],c=0;c<s.layers.length;c++)s.layers[c].features.length||(s.layers.splice(c,1),c-=1);s.layers.length||(r.splice(o,1),o-=1)}t.info.defaultFeature=e.defaultFeature,t.elevationRequest&&(e.displayElevation=!0),t.renderResults(e,(function(){if(t.insertLinks(),t.sharedFeatureInfo){var e;t.div.querySelectorAll("ul."+t.CLASS+"-services li").forEach((function(e){e.classList.add(i.Z.classes.CHECKED)}));for(var r=t.sharedFeatureInfo,o=0,a=t.info.services.length;o<a;o++){var s=t.info.services[o];if(s.mapLayers.some((e=>e.url===r.s))){for(var c=0,u=s.layers.length;c<u;c++){var h=s.layers[c];if(h.name===r.l){for(var d=0,f=h.features.length;d<f;d++){var g=h.features[d];if(g.id===r.f){e=g;var y=l()(JSON.stringify({data:g.getData(),geometry:p(g.geometry,i.Z.DEGREE_PRECISION)}));r.h!==y&&n.Z.alert(t.getLocaleString("finfo.featureChanged.warning"));break}}break}}break}}e&&(t.highlightedFeature=e,t.map.addLayer({id:t.getUID(),type:i.Z.layerType.VECTOR,title:t.getLocaleString("foi"),owner:t,stealth:!0}).then((function(r){t.sharedFeatureLayer=r,t.filterLayer.clearFeatures(),t.filterFeature=null,r.addFeature(e),t.map.zoomToFeatures([e])}))),delete t.sharedFeatureInfo}else t.displayResults();t.div.querySelectorAll("ul."+t.CLASS+"-services label, ul."+t.CLASS+"-services a").forEach((function(e){e.addEventListener(i.Z.event.CLICK,(function(e){e.stopPropagation()}),{passive:!0})}))}))}},u.displayResultsCallback=function(){const e=this;if(a.default.prototype.displayResultsCallback.call(e),e.elevationRequest){const t=e.getDisplayControl();e.getDisplayTarget().querySelectorAll(`.${e.CLASS}-elev,.${e.CLASS}-height`).forEach((e=>e.classList.add(i.Z.classes.HIDDEN))),e.elevationRequest.then((function(r){if(t.currentFeature&&null!=r&&r.length){const n=t.currentFeature.geometry,i=r[0];if(n[0]===i[0]&&n[1]===i[1]){const t=r.length?r[0].slice(2):null;e.displayElevationValues(t)}}}))}new ResizeObserver((t=>{for(let r of t)r.target.querySelectorAll("ul."+e.CLASS+"-services label, ul."+e.CLASS+"-services h4, ul."+e.CLASS+"-services h3 span").forEach((function(e){e.addEventListener("mouseenter",(function(e){this.offsetWidth<this.scrollWidth?this.title=this.childNodes.item("H4"===this.tagName?2:0).textContent:this.title=""}),{passive:!0})}))})).observe(e.getDisplayTarget())},u.renderResults=function(e,t){const r=this;if(r.filterFeature){const o=r.filterFeature.geometry;e.coords&&o[0]===e.coords[0]&&o[1]===e.coords[1]&&(e.isGeo=r.map.wrap.isGeo(),e.coords&&(e.crs=r.map.crs,e.coords=e.coords.map((function(t){const r=e.isGeo?i.Z.DEGREE_PRECISION:i.Z.METER_PRECISION;return n.Z.Util.formatCoord(t,r)}))),r.renderData(e,t))}},u.displayElevationValues=function(e){const t=this;let r,a;Array.isArray(e)?(r=e[0],a=e.length>1?e[1]:null):(r=e,a=null);const s=t.map.options.locale||o.Z.locale;let l=null===r?"-":n.Z.Util.formatNumber(Math.round(r),s)+" m",c=a?a.toLocaleString(s,{maximumFractionDigits:1})+" m":"-";const u=t.getDisplayTarget().querySelector(`.${t.CLASS}-elev`),p=t.getDisplayTarget().querySelector(`.${t.CLASS}-height`);u&&p&&(u.classList.toggle(i.Z.classes.HIDDEN,null===r),p.classList.toggle(i.Z.classes.HIDDEN,!a),u.querySelector(`.${t.CLASS}-coords-val`).innerHTML=l,p.querySelector(`.${t.CLASS}-coords-val`).innerHTML=c)},u.loadSharedFeature=function(e){const t=this;if(e){if(0===t.map.workLayers.filter((function(t,r){return t.type===i.Z.layerType.WMS&&t.url===e.s&&t.getDisgregatedLayerNames().indexOf(e.l)>=0})).length)return void n.Z.error(t.getLocaleString("sharedFeatureNotValid"),i.Z.msgErrorMode.TOAST);t.sharedFeatureInfo=e;const r=[-100,-100];t.beforeRequest({xy:r}),t.filterLayer.clearFeatures(),t.filterFeature=null,t.filterLayer.addMarker(r).then((function(r){t.filterFeature=r,t.wrap.getFeatureInfo(e.xy,e.r,{serviceUrl:e.s,layerName:e.l,featureId:e.f})}))}},u.exportQuery=function(){const e=a.default.prototype.exportQuery.call(this);return e.res=this.queryResolution,e},u.importQuery=function(e){const t=this;e.filter&&t.map.setResolution(e.res).then((()=>a.default.prototype.importQuery.call(t,e)))},n.Z.control.FeatureInfo=c;const h=c},4094:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var n=r(688),i=r(330),o=r(7497),a=r(5669),s=r(674),l=r(7167),c=r(6204),u=r(3048);n.Z.control=n.Z.control||{},i.Z.event.POPUP=i.Z.event.POPUP||"popup.tc",i.Z.event.POPUPHIDE=i.Z.event.POPUPHIDE||"popuphide.tc",i.Z.event.DRAWCHART=i.Z.event.DRAWCHART||"drawchart.tc",i.Z.event.DRAWTABLE=i.Z.event.DRAWTABLE||"drawtable.tc",i.Z.event.RESULTSPANELCLOSE=i.Z.event.RESULTSPANELCLOSE||"resultspanelclose.tc",i.Z.event.FEATUREHIGHLIGHT="featurehighlight.tc",i.Z.event.FEATUREDOWNPLAY="featuredownplay.tc";const p=function(){const e=this;a.default.apply(e,arguments),e._selectors={LIST_ITEM:`ul.${e.CLASS}-features li`,SHOW_ALL_CHECKBOX:`.${e.CLASS}-btn input[type="checkbox"].${e.CLASS}-btn-show-all`,ZOOM_ALL_BUTTON:`.${e.CLASS}-btn .${e.CLASS}-btn-zoom-all`,DEL_ALL_BUTTON:`.${e.CLASS}-btn .${e.CLASS}-btn-del-all`},e.resultsLayer=null,e.filterLayer=null,e._layersPromise=null,e.filterFeature=null,e.info=null,e._infoHistory={},e.popup=null,e.resultsPanel=null,e.lastFeatureCount=null,e.exportsState=!0,e._dialogDiv=n.Z.Util.getDiv(e.options.dialogDiv),window.$&&(e._$dialogDiv=$(e._dialogDiv)),e.options.dialogDiv||document.body.appendChild(e._dialogDiv)};!function(){n.Z.inherit(p,a.default),n.Z.mix(p,l.default);var e=p.prototype;e.CLASS="tc-ctl-finfo",e.CURRENT_CLASS="tc-current",e.TITLE_SEPARATOR="  ",e.DEFAULT_STROKE_COLOR="#0000ff";const t=function(){const e=this,t=e.getMenuTarget(),r=t.querySelector(e._selectors.SHOW_ALL_CHECKBOX);if(r){r.checked=!0;const t=e.getLocaleString("doNotShowOnMapAllResults");r.innerHTML=t,r.setAttribute("title",t)}t.querySelector(e._selectors.ZOOM_ALL_BUTTON).classList.remove(i.Z.classes.HIDDEN),t.querySelector(e._selectors.DEL_ALL_BUTTON).classList.remove(i.Z.classes.HIDDEN)},h=function(){const e=this,t=e.getMenuTarget(),r=t.querySelector(e._selectors.SHOW_ALL_CHECKBOX);if(r){r.checked=!1;const n=e.getLocaleString("showOnMapAllResults");r.innerHTML=n,r.setAttribute("title",n),t.querySelector(e._selectors.ZOOM_ALL_BUTTON).classList.add(i.Z.classes.HIDDEN),t.querySelector(e._selectors.DEL_ALL_BUTTON).classList.add(i.Z.classes.HIDDEN)}};e.register=async function(e){const t=this,r=a.default.prototype.register.call(t,e);return t._createLayers(),e.loaded((function(){const r=e.getControlsByClass("TC.control.Share")[0];r&&t.loadSharedFeature(r.loadParamFeature()),t.setDisplayMode(t.options.displayMode||e.defaultInfoContainer||i.Z.infoContainer.POPUP)})),e.on(i.Z.event.POPUPHIDE+" "+i.Z.event.RESULTSPANELCLOSE,(function(e){var r;null==t||null===(r=t.highlightedFeature)||void 0===r||r.toggleSelectedStyle(!1),e.control===t.getDisplayControl()&&t.resultsLayer&&(t.highlightedFeature&&!t.options.persistentHighlights&&(t.downplayFeature(t.highlightedFeature),t.highlightedFeature=null),!t.querying&&e.feature&&t.filterLayer.removeFeature(e.feature))})).on(i.Z.event.POPUP+" "+i.Z.event.DRAWTABLE+" "+i.Z.event.DRAWCHART,(function(e){const r=e.control;r.currentFeature!==t.filterFeature&&(t.highlightedFeature=r.currentFeature),e.control.caller===t&&t._decorateDisplay(r)})).on(i.Z.event.DRAWCHART,(function(e){setTimeout((function(){t.highlightedFeature=e.control.currentFeature}),50)})).on(i.Z.event.LAYERREMOVE,(function(){if(Object.keys(t._infoHistory).length){const e={};t.map.workLayers.filter((function(e){return e.type===i.Z.layerType.WMS})).forEach((function(t){const r=e[t.url]||[];e[t.url]=r.concat(t.getDisgregatedLayerNames())}));let r=!1;for(let n in t._infoHistory){const i=t._infoHistory[n];if(Object.prototype.hasOwnProperty.call(e,n)){const o=e[n];for(let e in i){const n=i[e];o.indexOf(e)<0&&(n.slice().forEach((e=>t.downplayFeature(e))),n.length=0,r=!0)}}else{for(let e in i){i[e].slice().forEach((e=>t.downplayFeature(e))),r=!0}delete t._infoHistory[n]}}r&&t.closeResults()}})).on(i.Z.event.FEATUREREMOVE,(function(e){if(e.layer===t.resultsLayer)for(let r in t._infoHistory){const n=t._infoHistory[r];for(let t in n){const r=n[t];n[t]=r.filter((t=>t!==e.feature))}}})).on(i.Z.event.FEATURESCLEAR,(function(e){e.layer===t.resultsLayer&&(t._infoHistory={})})).on(i.Z.event.VIEWCHANGE,(function(e){t.closeResults()})),await r,t.options.share&&await t.getShareDialog(),t},e.loadTemplates=async function(){const e=this,t=r.e(9404).then(r.bind(r,9404)),n=r.e(4782).then(r.bind(r,4782)),i=r.e(2620).then(r.bind(r,2620)),o=r.e(4671).then(r.bind(r,4671)),a=r.e(5387).then(r.bind(r,5387)),s=r.e(8026).then(r.bind(r,8026)),l=r.e(7625).then(r.bind(r,7625)),c=r.e(6800).then(r.bind(r,6800)),u=r.e(512).then(r.bind(r,512)),p=r.e(4288).then(r.bind(r,4288)),h={};h[e.CLASS]=(await t).default,h[e.CLASS+"-attr"]=(await n).default,h[e.CLASS+"-object"]=(await i).default,h[e.CLASS+"-buttons"]=(await o).default,h[e.CLASS+"-dialog"]=(await a).default,h[e.CLASS+"-attr-val"]=(await s).default,h[e.CLASS+"-attr-video"]=(await l).default,h[e.CLASS+"-attr-image"]=(await c).default,h[e.CLASS+"-attr-audio"]=(await u).default,h[e.CLASS+"-attr-embed"]=(await p).default,e.template=h},e.render=function(){const e=this;return e.div.classList.add(i.Z.classes.HIDDEN),e._set1stRenderPromise(e.getRenderedHtml(e.CLASS+"-dialog",{checkboxId:e.getUID(),elevation:e.options.displayElevation},(function(t){e._dialogDiv.innerHTML=t})))},e.responseCallback=function(e){const t=this;if(t.querying=!1,t.filterFeature&&(t.info={services:e.services},t.options.persistentHighlights))for(let e in t._infoHistory){const r=(t.info.services||[]).find((t=>t.url===e));if(r){const n=t._infoHistory[e];for(let e in n){const t=r.layers.find((t=>t.name===e));if(t){n[e].forEach((function(e){const r=e.wrap.getId(),n=t.features.findIndex((e=>e.wrap.getId()===r));-1!==n&&t.features.splice(n,1)}))}}}}e.featureCount?(t._addSourceAttributes(),t.lastFeatureCount=e.featureCount,t.map.trigger(i.Z.event.FEATUREINFO,n.Z.Util.extend({control:t},e))):(t.lastFeatureCount=0,t.map.trigger(i.Z.event.NOFEATUREINFO,{control:t}))},e.responseError=function(e){const t=this;404===e.status&&t.map.toast(t.getLocaleString("featureInfo.tooManyLayers"),{type:i.Z.msgType.ERROR}),t.responseCallback({})},e.markerStyle={cssClass:i.Z.classes.POINT,anchor:[.5,.5],width:15,height:15,noPrint:!0},e.setDisplayMode=async function(e){const t=this;if(t.displayMode=e,e===i.Z.infoContainer.RESULTS_PANEL)await t.getResultsPanel();else t.displayMode=i.Z.infoContainer.POPUP,await t.getPopup()},e.getPopup=async function(){const e=this;return e.popup||(e.popup=await e.map.addControl("popup",{closeButton:!0,draggable:e.options.draggable,share:e.options.share}),e.popup.caller=e,e.map.on(i.Z.event.POPUP,(function(t){e.onShowPopup(t)}))),e.popup},e.getResultsPanel=async function(){const e=this;if(!e.resultsPanel){let t;const r={content:"table",titles:{main:e.getLocaleString("threed.rs.panel.gfi"),max:e.getLocaleString("threed.rs.panel.gfi")},share:e.options.share},n=e.map.getControlsByClass("TC.control.ControlContainer")[0];n?(r.position=n.POSITION.RIGHT,t=n.addControl("resultsPanel",r)):(r.div=document.createElement("div"),e.map.div.appendChild(r.div),t=e.map.addControl("resultsPanel",r)),e.resultsPanel=await t,e.resultsPanel.caller=e}return e.resultsPanel},e.getDisplayControl=function(){var e=this;return e.displayMode===i.Z.infoContainer.RESULTS_PANEL?e.resultsPanel:e.popup},e.getDisplayTarget=function(e){var t=this;if((e=e||{}).control)switch(!0){case n.Z.control.Popup&&e.control instanceof n.Z.control.Popup:return e.control.getContainerElement();case n.Z.control.ResultsPanel&&e.control instanceof n.Z.control.ResultsPanel:return e.control.getInfoContainer();default:return null}return t.displayMode===i.Z.infoContainer.RESULTS_PANEL?t.resultsPanel.getInfoContainer():t.popup.getContainerElement()},e.getMenuTarget=function(){var e=this;return e.displayMode===i.Z.infoContainer.RESULTS_PANEL?e.resultsPanel.getMenuElement():e.popup.getMenuElement()},e.displayResults=function(){var e=this;const t=e.div.cloneNode(!0);if(t.classList.remove(i.Z.classes.HIDDEN),e.filterFeature.data=t.outerHTML,e.displayMode===i.Z.infoContainer.RESULTS_PANEL){if(e.resultsPanel){0===e.map.getControlsByClass(n.Z.control.ControlContainer).length&&e.map.getControlsByClass(n.Z.control.ResultsPanel).forEach((function(e){e.isVisible()&&e.close()}));e.map.getControlsByClass("TC.control.ResultsPanel").forEach((function(t){t!==e.resultsPanel&&t.currentFeature&&!t.chart&&t.close()})),e.resultsPanel.currentFeature=e.filterFeature,e.resultsPanel.open(e.filterFeature.data,e.resultsPanel.getInfoContainer()),e.getMenuTarget().innerHTML="",e.displayResultsCallback()}}else e.getPopup().then((t=>e.filterFeature.showPopup(t)))};const d=function(e){return Array.from(e.parentElement.children).indexOf(e)},f=function(e,t){var r=e;do{r=r.parentElement}while(r&&r.tagName!==t);return r},g=function(e,t){const r=t,n=f(t,"LI"),i=f(n,"LI");return e.getFeature(d(i),d(n),d(r))};e.getFeatureElement=function(e){const t=this;let r;const n=t.getDisplayTarget().querySelectorAll(t._selectors.LIST_ITEM);for(var i=0,o=n.length;i<o;i++){const o=n[i];if(g(t,o)===e){r=o;break}}return r},e.getNextFeatureElement=function(e){const t=this,r=t.getDisplayTarget().querySelectorAll("ul."+t.CLASS+"-features > li"),n=r.length;for(var i=0;i<n;i++)if(r[i].matches("."+t.CURRENT_CLASS))return r[(i+e+n)%n];return null},e.getFeaturePath=function(e){const t=this;if(t.info&&t.info.services)for(var r=0,n=t.info.services.length;r<n;r++){const n=t.info.services[r];for(var i=0,o=n.layers.length;i<o;i++){const t=n.layers[i];for(var a=0,s=t.features.length;a<s;a++)if(t.features[a]===e)return{service:n.title||n.mapLayers.reduce((function(e,t){return e||t.title}),""),layer:t.path}}}return null},e.closeResults=function(){var e=this;if(e.displayMode===i.Z.infoContainer.RESULTS_PANEL)e.resultsPanel&&e.resultsPanel.isVisible()&&e.resultsPanel.close();else e.popup&&e.popup.isVisible()&&e.popup.hide()},e.displayResultsCallback=function(){var e=this;const t=e.getDisplayTarget().querySelector("."+e.CLASS),r=t.querySelector(`.${e.CLASS}-btn-next`);r&&r.addEventListener(i.Z.event.CLICK,(function(t){return e.highlightFeature(e.getNextFeatureElement(1),1),!1}),{passive:!0});const o=t.querySelector(`.${e.CLASS}-btn-prev`);o&&o.addEventListener(i.Z.event.CLICK,(function(t){return e.highlightFeature(e.getNextFeatureElement(-1),-1),!1}),{passive:!0});const a=function(r){const n=f(r.target,"LI");if(n.classList.contains(i.Z.classes.CHECKED)){const r=t.querySelector(`.${e.CLASS}-layers li:not(.tc-checked)`);r&&"none"!==getComputedStyle(r).display&&e.downplayFeatures()}else e.highlightFeature(n.querySelector(e._selectors.LIST_ITEM)),e.displayMode===i.Z.infoContainer.POPUP&&e.popup.fitToView(!0)};if(t.querySelectorAll(`ul.${e.CLASS}-layers h4`).forEach((e=>e.addEventListener(i.Z.event.CLICK,a,{passive:!0}))),e.displayMode===i.Z.infoContainer.POPUP&&t.querySelectorAll("img").forEach((t=>t.addEventListener("load",(()=>e.popup.fitToView())))),e.info){const r=e.getFeatures(),n=e.getMenuTarget();if(r.length>1)e.getRenderedHtml(`${e.CLASS}-buttons`,{id:e.id}).then((function(t){n.querySelector(`.${e.CLASS}-btn-dl`)||(n.insertAdjacentHTML("beforeend",t),n.querySelector(`.${e.CLASS}-btn-dl`).addEventListener(i.Z.event.CLICK,(async function(t){const r=await e.getDownloadDialog();let n={title:e.getLocaleString("featureInfo")+" - "+e.getLocaleString("download"),fileName:e._getFileName()};(e.map.elevation||e.options.displayElevation)&&(n=Object.assign({},n,{elevation:Object.assign({},e.map.elevation&&e.map.elevation.options,e.options.displayElevation)})),r.open(e.getFeatures(),n)}),{passive:!0}),n.querySelector(e._selectors.SHOW_ALL_CHECKBOX).addEventListener("change",(function(t){t.target.checked?e.showAllFeatures():e.hideAllFeatures()}),{passive:!0}),n.querySelector(e._selectors.ZOOM_ALL_BUTTON).addEventListener(i.Z.event.CLICK,(function(t){e.map.zoomToFeatures(r)}),{passive:!0}),n.querySelector(e._selectors.DEL_ALL_BUTTON).addEventListener(i.Z.event.CLICK,(function(t){e.downplayFeatures(),e.filterLayer.removeFeature(e.filterFeature)}),{passive:!0}))}));else{const t=n.querySelector(`.${e.CLASS}-btn`);t&&t.remove()}e.info.defaultFeature&&e.getFeatureElement(e.info.defaultFeature)?(e.getFeatureElement(e.info.defaultFeature).classList.add(i.Z.classes.DEFAULT),e.highlightFeature(e.info.defaultFeature)):t.querySelector(e._selectors.LIST_ITEM)&&e.highlightFeature(t.querySelector(e._selectors.LIST_ITEM))}if(t.querySelectorAll("table:not(.tc-complex-attr)").forEach((function(t){t.parentElement.classList.contains(i.Z.classes.CHECKED)||t.setAttribute("title",e.getLocaleString("clickToShowOnMap")),t.addEventListener("click",(function(t){const r=this.parentElement;if(!r.classList.contains(i.Z.classes.DISABLED)){if(r.classList.contains(i.Z.classes.CHECKED)){const t=g(e,r);if(t&&window.getSelection()&&0===window.getSelection().toString().trim().length){e.map.on(i.Z.event.ZOOM,(function t(){e._zooming=!1,e.map.off(i.Z.event.ZOOM,t)})),e._zooming=!0,e.map.zoomToFeatures([t],{animate:!0})}}else e.highlightFeature(r);t.stopPropagation()}}),{passive:!0})})),t.querySelectorAll("table a, table label, table input").forEach((function(e){e.addEventListener(i.Z.event.CLICK,(function(e){e.stopPropagation()}),{passive:!0})})),n.Z.browserFeatures.touch()&&e.displayMode===i.Z.infoContainer.RESULTS_PANEL){const r=t.querySelector("."+e.CLASS+"-btn-prev");r&&"none"===r.style.display||(e.resultsPanel&&n.Z.Util.swipe(e.resultsPanel.div,"disable"),((s=e).info&&s.info.services?s.info.services.reduce((function(e,t){return e+t.layers.reduce((function(e,t){return e+1}),0)}),0):0)>1&&n.Z.Util.swipe(t,{left:function(){e.highlightFeature(e.getNextFeatureElement(1),1)},right:function(){e.highlightFeature(e.getNextFeatureElement(-1),-1)}}))}var s},e.onShowPopup=function(e){const t=this;e.control===t.popup&&t.displayResultsCallback()},e.loadSharedFeature=function(e){},e.insertLinks=function(){var e=this;const t=e.getLocaleString("open"),r=e.getLocaleString("linkInNewWindow");e.div.querySelectorAll("td."+e.CLASS+"-val").forEach((function(e){const i=e.textContent;n.Z.Util.isURL(i)&&(e.innerHTML='<a href="'+i+'" target="_blank" title="'+r+'">'+t+"</a>")}))},e.highlightFeature=function(e,t){const r=this;var n;if(!r._zooming){var o;if(e instanceof c.Z)n=e,o=r.getFeatureElement(n);else for(o=e;o&&"LI"!==o.tagName;)o=o.parentElement;const a=f(o,"LI"),s=f(a,"LI"),l=d(s),u=d(a),p=d(o);n=n||r.getFeature(l,u,p),r.downplayFeatures({exception:n});const h=r.info.services[l];Object.prototype.hasOwnProperty.call(r._infoHistory,h.url)||(r._infoHistory[h.url]={});const g=r._infoHistory[h.url],y=h.layers[u],m=g[y.name]||[];m.includes(n)||(g[y.name]=m.concat(n));const v=r.getDisplayTarget();if(v.querySelectorAll("li").forEach((e=>e.classList.remove(r.CURRENT_CLASS))),o.classList.add(i.Z.classes.CHECKED,r.CURRENT_CLASS),a.classList.add(i.Z.classes.CHECKED,r.CURRENT_CLASS),s.classList.add(i.Z.classes.CHECKED,r.CURRENT_CLASS),t>0?(o.classList.add(i.Z.classes.FROMLEFT),a.classList.add(i.Z.classes.FROMLEFT),s.classList.add(i.Z.classes.FROMLEFT)):t<0&&(o.classList.add(i.Z.classes.FROMRIGHT),a.classList.add(i.Z.classes.FROMRIGHT),s.classList.add(i.Z.classes.FROMRIGHT)),o.querySelector("table")&&o.querySelector("table").setAttribute("title",r.getLocaleString("clickToCenter")),n instanceof c.Z||(n=null),n&&n===r.highlightedFeature)return;r.highlightedFeature=n;const _=v.querySelector("."+r.CLASS+"-counter-current");if(_&&(_.innerHTML=r.getFeatureIndex(l,u,p)+1),r.options.persistentHighlights||r.resultsLayer.features.slice().forEach((e=>{e!==n&&r.downplayFeature(e)})),n){const e=e=>r.map.trigger(i.Z.event.FEATUREHIGHLIGHT,{feature:e,control:r});if(n.geometry){let t;n.showsPopup=r.options.persistentHighlights,r.options.persistentHighlights&&(t=r.resultsLayer.getFeatureById(n.wrap.getId()),t&&e(t)),t||r.resultsLayer.addFeature(n).then((function(t){e(n)}))}else o.classList.add(i.Z.classes.DISABLED),e(n)}}},e.downplayFeature=function(e){const t=this,r=t.getFeatureElement(e);let n;for(var o in r&&r.classList.remove(i.Z.classes.CHECKED),t.options.persistentHighlights&&(n=t.resultsLayer.getFeatureById(e.wrap.getId())),t.resultsLayer.removeFeature(n||e),t._infoHistory){const r=t._infoHistory[o];for(var a in r){let t=r[a];t=r[a]=t.filter((t=>t!==e)),t.length||delete r[a]}}t.highlightedFeature===e&&(t.highlightedFeature=null),t.map.trigger(i.Z.event.FEATUREDOWNPLAY,{feature:e,control:t})},e.downplayFeatures=function(e){const t=this;e=e||{};const r=t.highlightedFeature;r&&r!==e.exception&&(t.downplayFeature(r),t.highlightedFeature=null),t.getFeatures().filter((e=>e!==r)).forEach((e=>t.resultsLayer.removeFeature(e)));const n=e.exception?t.getFeatureElement(e.exception):void 0;var o,a;n&&(o=f(n,"LI"),a=f(o,"LI"));const s=t.getDisplayTarget();Array.from(s.querySelectorAll("ul."+t.CLASS+"-services li")).filter((function(e){return e!==n&&e!==o&&e!==a})).forEach((function(e){e.classList.remove(i.Z.classes.CHECKED,i.Z.classes.DISABLED,i.Z.classes.FROMLEFT,i.Z.classes.FROMRIGHT)})),s.querySelectorAll("."+t.CLASS+"-features table:not(.tc-complex-attr)").forEach((function(e){e.setAttribute("title",t.getLocaleString("clickToShowOnMap"))})),h.call(t)},e.showAllFeatures=function(){const e=this;e.highlightedFeature&&e.downplayFeature(e.highlightedFeature);for(var r=0,n=e.info.services.length;r<n;r++){const t=e.info.services[r],n=e._infoHistory[t.url]=e._infoHistory[t.url]||{};for(var i=0,o=t.layers.length;i<o;i++){const r=t.layers[i];let o=n[r.name]||[];for(var a=0,s=r.features.length;a<s;a++){const t=r.features[a];t.showsPopup=e.options.persistentHighlights,o.includes(t)||(n[r.name]=o=o.concat(t)),e.resultsLayer.features.includes(t)||e.resultsLayer.addFeature(t)}}}t.call(e)},e.hideAllFeatures=function(){const e=this,t=e.getDisplayTarget().querySelector(`ul.${e.CLASS}-layers > li.${i.Z.classes.CHECKED}`);e.downplayFeatures(),t&&t.classList.add(i.Z.classes.CHECKED)},e.getFeature=function(e,t,r){var n;const i=this.info;return i&&i.services&&(n=i.services[e])&&(n=n.layers[t])&&(n=n.features[r]),n},e.getFeatures=function(){let e=[];const t=this.info;return t&&t.services&&(e=t.services.reduce(((e,t)=>e.concat(t.layers.reduce(((e,t)=>e.concat(t.features)),[]))),e)),e},e.getFeatureIndex=function(e,t,r){var n=-1;const i=this.info;if(i)for(var o=0;o<=e;o++)for(var a=i.services[o],s=o===e?t:a.layers.length-1,l=0;l<=s;l++)for(var c=a.layers[l],u=l===t&&o===e?r:c.features.length-1,p=0;p<=u;p++)n+=1;return n},e.removeFeature=function(e){const t=this;if(t.info){let i=t.getFeatures();const o=i.indexOf(e);for(var r=0;r<t.info.services.length;r++)for(var n=0;n<t.info.services[r].layers.length;n++){const a=t.info.services[r].layers[n].features.findIndex((t=>t.id===e.id));if(a>=0&&t.info.services[r].layers[n].features.splice(a,1).length)return i=t.getFeatures(),t.responseCallback(Object.assign(t.info,{coords:t.filterFeature.geometry,defaultFeature:i[o===i.length?o-1:o],featureCount:i.length})),!0}}return!1},e.beforeRequest=function(e){var t=this;t.querying=!0,t.map.trigger(i.Z.event.BEFOREFEATUREINFO,{xy:e.xy,control:t}),t.closeResults(),t.map&&t.resultsLayer&&(t.lastFeatureCount=null,t.options.persistentHighlights||t.resultsLayer.features.slice().forEach((e=>t.downplayFeature(e))),t.info=null)},e.activate=function(){var e=this;e.wrap&&e.wrap.activate(),o.Z.prototype.activate.call(e)},e.deactivate=function(e){var t=this;t.popup&&t.popup.isVisible()&&t.popup.hide(),t.options.persistentHighlights||(t.resultsLayer.features.slice().forEach((e=>t.downplayFeature(e))),t.info=null,t._infoHistory={}),t.filterLayer&&t.filterLayer.clearFeatures(),t.filterFeature=null,t.wrap&&t.wrap.deactivate(),o.Z.prototype.deactivate.call(t,e)},e.exportState=function(){const e=this;if(e.exportsState&&e.resultsLayer){const t={};return e.toShare&&(t.features=[]),{id:e.id,layer:e.resultsLayer.exportState(t),query:e.toShare}}return null},e.importState=function(e){const t=this;t._layersPromise.then((function(){t.resultsLayer.importState(e.layer),e.query&&t.importQuery(e.query)}))},e._createLayers=function(){const e=this;var t,r;if(t=e.options.resultsLayer?e.options.resultsLayer:{id:e.getUID(),title:e.CLASS+": Results layer",type:i.Z.layerType.VECTOR,owner:e,stealth:!0},e.options.filterLayer)r=e.options.filterLayer;else{const t={};e.geometryType===i.Z.geom.POLYLINE&&(t.line=e.style),e.geometryType===i.Z.geom.POLYGON&&(t.polygon=e.style),r={id:e.getUID(),title:e.CLASS+": Filter layer",owner:e,stealth:!0,type:i.Z.layerType.VECTOR,styles:t}}const n=e.map;return e._layersPromise=new Promise((function(i,o){n.loaded((function(){const o=n.layers.indexOf(t)>=0?Promise.resolve(t):n.addLayer(t),a=n.layers.indexOf(r)>=0?Promise.resolve(r):n.addLayer(r);Promise.all([o,a]).then((function(t){e.resultsLayer=t[0],e.filterLayer=t[1],i()}))}))})),e._layersPromise},e._decorateDisplay=function(e){const t=this,r=t.getMenuTarget({control:e}),o=r.querySelector("."+s.default.prototype.CLASS+"-btn");if(o)t.lastFeatureCount||e.currentFeature&&!0===e.currentFeature.showsPopup||o.remove();else{var a=t.getLocaleString("feature");if(e===t.getDisplayControl())if(t.filterFeature instanceof u.Z){const e=t.filterFeature.geometry;a=t.getLocaleString("featuresAt",{crs:t.map.crs,x:n.Z.Util.formatCoord(e[0],t.map.wrap.isGeo()?i.Z.DEGREE_PRECISION:i.Z.METER_PRECISION),y:n.Z.Util.formatCoord(e[1],t.map.wrap.isGeo()?i.Z.DEGREE_PRECISION:i.Z.METER_PRECISION)})}else a=t.getLocaleString("spatialQueryResults");else e.currentFeature&&(a=e.currentFeature.id);(t.lastFeatureCount||e.currentFeature&&!0===e.currentFeature.showsPopup)&&new s.default({target:r,printableElement:t.getDisplayTarget({control:e}),title:a})}p.addSpecialAttributeEventListeners(e.getContainerElement())},e._addSourceAttributes=function(){const e=this,t="h3_"+e.getLocaleString("service"),r="h4_"+e.getLocaleString("layer");e.info&&e.info.services&&e.info.services.forEach((function(i){i.layers.forEach((function(i){i.features.forEach((function(i){if(i instanceof c.Z){const o=e.getFeaturePath(i);if(o){const a={};a[t]=o.service,o.layer&&(a[r]=o.layer.join(e.TITLE_SEPARATOR));const s=n.Z.Util.extend(a,i.getData());i.clearData(),i.setData(s)}}}))}))}))},e._getFileName=function(){return this.getLocaleString("featureInfo").toLowerCase().replace(/\s/gi,"_")+"_"+n.Z.Util.getFormattedDate((new Date).toString(),!0)},e.showShareDialog=function(e){const t=this;return t.toShare=t.exportQuery(),l.default.showShareDialog.call(t,e)},e.exportQuery=function(){const e=this,t={};if(e.filterFeature){const r=e.filterLayer.exportState();r.features.forEach((e=>delete e.data)),t.filter=r,e.highlightedFeature&&(t.hlf=e.highlightedFeature.getId())}return t},e.importQuery=function(e){const t=this;e.filter&&(t.activate(),t.filterLayer.importState(e.filter).then((function(){t.filterFeature=t.filterLayer.features[0],t.sendRequest(t.filterFeature);const r=function(n){if(n.control===t){const n=t.getFeatures().find((t=>t.getId()===e.hlf));n?t.highlightFeature(n):Object.prototype.hasOwnProperty.call(e,"hlf")||setTimeout((()=>t.showAllFeatures()),100),t.map.off(i.Z.event.FEATUREHIGHLIGHT,r)}};t.map.on(i.Z.event.FEATUREHIGHLIGHT,r)})))};const y={CLASS:e.CLASS};p.renderFeatureAttributeTable=async function(t){return y.template||await e.loadTemplates.call(y),await e.getRenderedHtml.call(y,e.CLASS+"-attr",t)},p.renderFeatureAttribute=async function(t){return y.template||await e.loadTemplates.call(y),await e.getRenderedHtml.call(y,e.CLASS+"-attr-val",t)},p.showImageDialog=async function(t){y.template||await e.loadTemplates.call(y);const r=await e.getRenderedHtml.call(y,e.CLASS+"-dialog",{src:t.getAttribute("src")}),o=document.createElement("div");return document.body.appendChild(o),o.innerHTML=r,n.Z.Util.showModal(o.querySelector(`.${e.CLASS}-img-dialog`),{closeCallback:()=>o.remove()}),o.querySelector(".tc-modal-img img").addEventListener(i.Z.event.CLICK,(function(e){n.Z.Util.closeModal()}),{passive:!0}),o},p.addSpecialAttributeEventListeners=function(e){e.querySelectorAll("img.tc-img-attr").forEach((function(e){e.addEventListener(i.Z.event.CLICK,(function(e){setTimeout((()=>p.showImageDialog(e.target)),50),e.stopPropagation()}),{passive:!0})}))}}(),n.Z.control.FeatureInfoCommons=p;const h=p},9717:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>ae});var n=r(688),i=r(330),o=r(9967),a=r(268),s=r(2461),l=r(3048),c=r(8033),u=r(8683),p=r(1872),h=r(9529),d=r(5265);function f(e,t){y(e,t),t.add(e)}function g(e,t,r){y(e,t),t.set(e,r)}function y(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function m(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function v(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}function _(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,S(e,t,"get"))}function w(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,S(e,t,"set"),r),r}function S(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}i.Z.event.STYLECHANGE="stylechange.tc";const E="tc-ctl-fstyler",b="sitna-feature-styler",C=function(e){if(e){const t=e.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);if(t&&t.length)return"#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]}return e};var L=new WeakMap,T=new WeakMap,A=new WeakMap,x=new WeakMap,P=new WeakMap,O=new WeakMap,I=new WeakMap,R=new WeakMap,M=new WeakMap,D=new WeakMap,N=new WeakSet,Z=new WeakSet,k=new WeakSet,F=new WeakSet,U=new WeakSet,B=new WeakSet,G=new WeakSet,j=new WeakSet,W=new WeakSet,H=new WeakSet,q=new WeakSet,V=new WeakSet;class z extends s.default{constructor(){super(...arguments),f(this,V),f(this,q),f(this,H),f(this,W),f(this,j),f(this,G),f(this,B),f(this,U),f(this,F),f(this,k),f(this,Z),f(this,N),m(this,"CLASS",E),g(this,L,{writable:!0,value:"."+E}),g(this,T,{writable:!0,value:void 0}),g(this,A,{writable:!0,value:void 0}),g(this,x,{writable:!0,value:void 0}),g(this,P,{writable:!0,value:void 0}),g(this,O,{writable:!0,value:void 0}),g(this,I,{writable:!0,value:void 0}),g(this,R,{writable:!0,value:void 0}),g(this,M,{writable:!0,value:void 0}),g(this,D,{writable:!0,value:new WeakMap});const e=this;w(e,M,e.options.styles||a.Z.extend(!0,{},o.k.styles)),e.styles=_(e,M),e.initProperty("mode"),e.setStyle(e.getModeStyle())}static get observedAttributes(){return["mode","disabled"]}attributeChangedCallback(e,t,r){if(t===r)return;const n=this;"mode"===e&&v(n,N,Y).call(n),"disabled"===e&&v(n,Z,K).call(n)}getClassName(){return E}get mode(){const e=this;return e.hasAttribute("mode")?e.getAttribute("mode"):i.Z.geom.POINT}set mode(e){const t=this;e?t.setAttribute("mode",e):t.removeAttribute("mode")}get disabled(){return this.hasAttribute("disabled")}set disabled(e){this.toggleAttribute("disabled",!!e)}async loadTemplates(){const e=await r.e(3287).then(r.bind(r,3287));this.template=e.default}render(e){var t,r,n,o,s;const l=this;let c,u,p,h,d;const f=l.styles;switch(l.mode){case i.Z.geom.POLYLINE:case i.Z.geom.MULTIPOLYLINE:c=f.line.strokeColor,u=f.line.strokeWidth;break;case i.Z.geom.POLYGON:case i.Z.geom.MULTIPOLYGON:c=f.polygon.strokeColor,u=f.polygon.strokeWidth,p=f.polygon.fillColor,h=f.polygon.fillOpacity;break;case i.Z.geom.POINT:case i.Z.geom.MULTIPOINT:c=f.point.strokeColor,u=f.point.strokeWidth,p=f.point.fillColor,h=f.point.fillOpacity,d=f.point.radius;break;case i.Z.geom.RECTANGLE:c=f.line.strokeColor,u=f.line.strokeWidth,p=null===(t=f.polygon)||void 0===t?void 0:t.fillColor,h=0;break;default:c=null===(r=f.line)||void 0===r?void 0:r.strokeColor,u=null===(n=f.line)||void 0===n?void 0:n.strokeWidth,p=null===(o=f.polygon)||void 0===o?void 0:o.fillColor,h=null===(s=f.polygon)||void 0===s?void 0:s.fillOpacity}const g={strokeColor:C(c),strokeWidth:u,fillColor:C(p),fillOpacity:100*(h||0),radius:d};return l._set1stRenderPromise(l.renderData(g,(function(){v(l,N,Y).call(l),v(l,Z,K).call(l),w(l,A,l.querySelector(_(l,L)+"-str-c")),_(l,A).addEventListener(i.Z.event.CHANGE,(function(e){l.setStrokeColor(e.target.value)})),w(l,x,l.querySelector(_(l,L)+"-str-w")),_(l,x).addEventListener(i.Z.event.CHANGE,(function(e){l.setStrokeWidth(e.target.value)})),w(l,P,l.querySelector(_(l,L)+"-str-w-watch")),w(l,O,l.querySelector(_(l,L)+"-fll-c")),_(l,O).addEventListener(i.Z.event.CHANGE,(function(e){l.setFillColor(e.target.value)})),w(l,I,l.querySelector(_(l,L)+"-fll-w")),_(l,I).addEventListener(i.Z.event.CHANGE,(function(e){l.setFillOpacity(parseFloat(e.target.value)/100)})),w(l,R,l.querySelector(_(l,L)+"-rad-w")),_(l,R).addEventListener(i.Z.event.CHANGE,(function(e){l.setRadius(parseFloat(e.target.value))})),a.Z.isFunction(e)&&e()})))}setStyles(e){const t=this;return t.styles=a.Z.extend(!0,{},e),t.setStyle(t.getModeStyle()),t}setStyle(e){const t=this,r=a.Z.extend(_(t,T),e);let n={};for(var o in r)v(t,F,$).call(t,o)&&(n[o]=r[o]);switch(w(t,T,n),t.mode){case i.Z.geom.POLYLINE:case i.Z.geom.MULTIPOLYLINE:case i.Z.geom.RECTANGLE:t.styles.line=n;break;case i.Z.geom.POLYGON:case i.Z.geom.MULTIPOLYGON:t.styles.polygon=n;break;case i.Z.geom.POINT:case i.Z.geom.MULTIPOINT:t.styles.point=n;break;default:n={}}return t.renderPromise().then((function(){switch(t.mode){case i.Z.geom.POLYLINE:case i.Z.geom.MULTIPOLYLINE:case i.Z.geom.RECTANGLE:const e=t.styles.line;e.strokeColor&&t.setStrokeColor(e.strokeColor),e.strokeWidth&&t.setStrokeWidth(e.strokeWidth);break;case i.Z.geom.POLYGON:case i.Z.geom.MULTIPOLYGON:const r=t.styles.polygon;r.strokeColor&&t.setStrokeColor(r.strokeColor),r.strokeWidth&&t.setStrokeWidth(r.strokeWidth),r.fillColor&&t.setFillColor(r.fillColor),r.fillOpacity&&t.setFillOpacity(r.fillOpacity);break;case i.Z.geom.POINT:case i.Z.geom.MULTIPOINT:const n=t.styles.point;n.strokeColor&&t.setStrokeColor(n.strokeColor),n.strokeWidth&&t.setStrokeWidth(n.strokeWidth),n.fillColor&&t.setFillColor(n.fillColor),n.fillOpacity&&t.setFillOpacity(n.fillOpacity)}v(t,k,X).call(t)})),t}getStyle(){return _(this,T)}resetStyle(){const e=this;return e.setStyle(e.getModeStyle()),e}getModeStyle(e){const t=this;switch(e=e||t.mode){case i.Z.geom.POLYLINE:case i.Z.geom.MULTIPOLYLINE:case i.Z.geom.RECTANGLE:return t.styles.line;case i.Z.geom.POLYGON:case i.Z.geom.MULTIPOLYGON:return t.styles.polygon;case i.Z.geom.POINT:case i.Z.geom.MULTIPOINT:return t.styles.point;default:return null}}setLayer(e){const t=this;if(t.layer=e,!e)return t;let r=_(t,D).get(e);return r||(r=e.styles?[{},_(t,M),e.styles]:[{},_(t,M)].concat(e.features.map((e=>{const t=e.getStyle();if(0===Object.keys(t).length)return null;const r={};switch(!0){case e instanceof u.Z:case e instanceof p.Z:r.line=t;break;case e instanceof h.Z:case e instanceof d.Z:r.polygon=t;break;case e instanceof l.Z:case e instanceof c.Z:r.point=t;break;default:return null}return r})).filter((e=>!!e))),r=n.Z.Util.extend(...r)),t.setStyles(r),t}setFeature(e){const t=this;t.layer=null;const r=null==e?void 0:e.getStyle();switch(!0){case e instanceof u.Z:case e instanceof p.Z:t.mode=i.Z.geom.POLYLINE;break;case e instanceof l.Z:case e instanceof c.Z:t.mode=i.Z.geom.POINT;break;default:t.mode=i.Z.geom.POLYGON}return r&&Object.keys(r).length>0&&t.setStyle(r),t}setStrokeColorWatch(e){const t=this;return void 0===e&&(e=t.getModeStyle().strokeColor),v(t,U,J).call(t,_(t,A),e),t}setFillColorWatch(e){const t=this;return void 0===e&&(e=t.getModeStyle().fillColor),v(t,U,J).call(t,_(t,O),e),t}setStrokeColor(e){const t=this;return v(t,B,Q).call(t,"strokeColor",t.setStrokeColorWatch,e)}setFillColor(e){const t=this;return v(t,B,Q).call(t,"fillColor",t.setFillColorWatch,e)}setFillOpacityWatch(e){const t=this;return void 0===e&&(e=Math.round(100*t.getModeStyle().fillOpacity)),e=parseInt(e,10),Number.isNaN(e)||(_(t,I).value=e),t}setFillOpacity(e){const t=this;if(!Number.isNaN(e)){t.setFillOpacityWatch(Math.round(100*e));const r=_(t,T);if(r){if(r.fillOpacity===e)return t;r.fillOpacity=e}v(t,V,oe).call(t,{property:"fillOpacity",value:e})}return t}setStrokeWidthWatch(e){const t=this;return void 0===e&&(e=t.getModeStyle().strokeWidth),e=parseInt(e,10),Number.isNaN(e)||(_(t,x).value=e,_(t,P).style.borderBottomWidth=e+"px"),t}setStrokeWidth(e){const t=this;if(e=parseInt(e,10),!Number.isNaN(e)){t.setStrokeWidthWatch(e);const r=_(t,T);if(r){if(r.strokeWidth===e)return t;r.strokeWidth=e}v(t,V,oe).call(t,{property:"strokeWidth",value:e})}return t}setRadiusWatch(e){const t=this;return void 0===e&&(e=t.getModeStyle().radius),e=parseInt(e,10),Number.isNaN(e)||(_(t,R).value=e),t}setRadius(e){const t=this;if(e=parseInt(e,10),!Number.isNaN(e)){t.setRadiusWatch(e);const r=_(t,T);if(r){if(r.radius===e)return t;r.radius=e}v(t,V,oe).call(t,{property:"radius",value:e})}return t}}function Y(){const e=this,t=e.mode;w(e,T,e.getModeStyle(t)),v(e,H,ne).call(e,t!==i.Z.geom.POLYLINE&&t!==i.Z.geom.MULTIPOLYLINE&&t!==i.Z.geom.RECTANGLE),v(e,q,ie).call(e,t===i.Z.geom.POINT||t===i.Z.geom.MULTIPOINT)}function K(){const e=this;e.querySelectorAll("input").forEach((t=>t.disabled=e.disabled))}function X(){const e=this;e.layer&&_(e,D).set(e.layer,e.styles)}function $(e){return"strokeColor"===e||"strokeWidth"===e||"fillColor"===e||"fillOpacity"===e||"radius"===e}function J(e,t){const r=e=>new Number(e).toString(16).padStart(2,"0");if(Array.isArray(t))t=`#${r(t[0])}${r(t[1])}${r(t[2])}`;else{const e=t.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);e&&e.length&&(t="#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3])}if(e.value=t,!n.Z.browserFeatures.inputTypeColor()){const r=e;r.style.backgroundColor=t,r.blur()}}function Q(e,t,r){const n=this,i=_(n,T);if(i){t.call(n,r);if(i[e]===r)return n;i[e]=r}return v(n,V,oe).call(n,{property:e,value:r}),n}function ee(e,t){if(e){const r=void 0!==t?!t:void 0;e.classList.toggle(i.Z.classes.HIDDEN,r)}}function te(){return this.querySelector(`.${this.CLASS}-fill`)}function re(){return this.querySelector(`.${this.CLASS}-radius`)}function ne(e){const t=this;return v(t,G,ee).call(t,v(t,j,te).call(t),e),t}function ie(e){const t=this;return v(t,G,ee).call(t,v(t,W,re).call(t),e),t}function oe(e){const t=new CustomEvent(i.Z.event.STYLECHANGE,{detail:e});this.dispatchEvent(t)}customElements.get(b)||customElements.define(b,z),n.Z.control.FeatureStyler=z;const ae=z},1497:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>P});var n=r(688),i=r(330),o=r(7497),a=r(7167),s=r(674),l=r(3048),c=r(8683),u=r(1872);function p(e,t){d(e,t),t.add(e)}function h(e,t,r){d(e,t),t.set(e,r)}function d(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function f(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function g(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}function y(e,t,r){var n=function(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}(e,t,"set");return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,n,r),r}n.Z.control=n.Z.control||{},n.Z.control.infoShare=a.default,n.Z.control.Print=s.default,n.Z.Control=o.Z,i.Z.event.POPUP=i.Z.event.POPUP||"popup.tc",i.Z.event.POPUPHIDE=i.Z.event.POPUPHIDE||"popuphide.tc",i.Z.event.DRAWCHART=i.Z.event.DRAWCHART||"drawchart.tc",i.Z.event.DRAWTABLE=i.Z.event.DRAWTABLE||"drawtable.tc",i.Z.event.DIALOG=i.Z.event.DIALOG||"dialog.tc",i.Z.event.FEATUREHIGHLIGHT=i.Z.event.FEATUREHIGHLIGHT||"featurehighlight.tc",i.Z.event.FEATUREDOWNPLAY=i.Z.event.FEATUREDOWNPLAY||"featuredownplay.tc";const m=function(e){return e&&Array.isArray(e.features)?1===e.features.length?e.features[0]:null:e};var v=new WeakMap,_=new WeakMap,w=new WeakSet,S=new WeakSet,E=new WeakSet,b=new WeakSet;class C extends o.Z{constructor(){super(...arguments),p(this,b),p(this,E),p(this,S),p(this,w),f(this,"TITLE_SEPARATOR","  "),f(this,"FILE_TITLE_SEPARATOR","__"),h(this,v,{writable:!0,value:void 0}),h(this,_,{writable:!0,value:void 0}),f(this,"_dialogDiv",void 0),f(this,"_parentCtl",void 0);const e=this;e.div.classList.add(e.CLASS),e.exportsState=!0;const t=y(e,_,"."+e.CLASS);y(e,v,{ELEVATION_CHECKBOX:t+"-dialog-elev input[type=checkbox]",INTERPOLATION_RADIO:"input[type=radio][name=finfo-ip-coords]",INTERPOLATION_DISTANCE:t+"-dialog-ip-m"}),e._dialogDiv=n.Z.Util.getDiv(e.options.dialogDiv),e.options.dialogDiv||document.body.appendChild(e._dialogDiv)}getClassName(){return"tc-ctl-ftools"}async register(e){const t=this;return e.on(i.Z.event.POPUP+" "+i.Z.event.DRAWTABLE+" "+i.Z.event.DRAWCHART,(function(e){const r=e.control;(r.caller||r.currentFeature)&&t.addUI(r)})).on(i.Z.event.FEATUREHIGHLIGHT,(function(e){t.addUI(e.control.getDisplayControl()),e.feature.toggleSelectedStyle(!0)})).on(i.Z.event.FEATUREDOWNPLAY,(function(e){t.updateUI(e.control.getDisplayControl()),e.feature.toggleSelectedStyle(!1)})),await Promise.all([n.Z.Control.prototype.register.call(t,e),t.renderPromise()]),await t.getShareDialog(),t}async loadTemplates(){const e=this,t=r.e(8178).then(r.bind(r,8178)),n=r.e(2165).then(r.bind(r,2165)),i={};i[e.CLASS]=(await t).default,i[e.CLASS+"-dialog"]=(await n).default,e.template=i}render(){const e=this;return e._set1stRenderPromise(Promise.all([e.renderData({elevation:e.options.displayElevation}),e.getRenderedHtml(e.CLASS+"-dialog",{checkboxId:e.getUID(),elevation:e.options.displayElevation},(function(t){e._dialogDiv.innerHTML=t}))]))}addUI(e){const t=this;t._parentCtl=e;const r=e.getMenuElement(),i=function(){return r&&!r.querySelector("."+t.CLASS)};t.getCurrentFeature(e)&&(i()?t.getRenderedHtml(t.CLASS,null,(function(o){if(i()){let a=Promise.resolve();const s=e.getContainerElement();if(!s.querySelectorAll("."+n.Z.control.Print.prototype.CLASS+"-btn").length){const i=!e.caller&&e.currentFeature?e.currentFeature:e.caller.highlightedFeature;i&&!0===i.showsPopup&&(t.printControl=new n.Z.control.Print({target:r,printableElement:s,title:i.id}),a=t.printControl.renderPromise())}a.then((function(){if(i()){const n=(new DOMParser).parseFromString(o,"text/html").body.firstChild;r.appendChild(n),t.updateUI(e),g(t,S,T).call(t,e),g(t,w,L).call(t,e)}}))}})):t.updateUI(e))}updateUI(e){const t=this,r=e.getMenuElement().querySelector("."+t.CLASS),n=t.getCurrentFeature(e),o=n&&n.layer&&n.layer.owner?n.layer.owner.filterLayer!==n.layer:n&&!!n.layer;if(o)if(n){r.dataset.layerId=n.layer.id,r.dataset.featureId=n.id;const o=!!n.layer.cluster&&n.features.length>1,a=r.querySelector(`.${t.CLASS}-share-btn`);a&&a.classList.toggle(i.Z.classes.HIDDEN,o),r.querySelector(`.${t.CLASS}-dl-btn`).classList.toggle(i.Z.classes.HIDDEN,o),r.querySelector(`.${t.CLASS}-del-btn`).classList.toggle(i.Z.classes.HIDDEN,o),t.getElevationTool().then((function(a){const s=r.querySelector(`.${t.CLASS}-prof-btn`);s&&s.classList.toggle(i.Z.classes.HIDDEN,!a||!(n instanceof c.Z||n instanceof u.Z)||!!e.chart);const p=r.querySelector(`.${t.CLASS}-elev-btn`);p&&p.classList.toggle(i.Z.classes.HIDDEN,!a||!(n instanceof l.Z)||o)}))}else delete r.dataset.layerId,delete r.dataset.featureId;t.printControl&&n&&(t.printControl.title=n.id),r&&(r.classList.remove(i.Z.classes.ACTIVE),setTimeout((function(){r.classList.toggle(i.Z.classes.ACTIVE,!!o)}),100))}onDownloadButtonClick(e){const t=this,r=m(t.getFeatureFromElement(e.target.parentElement));r&&t.showDownloadDialog(r)}onShareButtonClick(e){const t=this,r=m(t.getFeatureFromElement(e.target.parentElement));if(!r)throw Error("FeatureTools: there is no feature to share");g(t,E,A).call(t,{feature:r}).then((async function(e){t.toShare={feature:e},t.showShareDialog()}))}onZoomButtonClick(e){const t=this,r=(n=t.getFeatureFromElement(e.target.parentElement))?Array.isArray(n.features)?n.features:[n]:[];var n;r.length&&t.zoomToFeatures(r)}onDeleteButtonClick(e){this.removeFeature(this.getFeatureFromElement(e.target.parentElement))}onProfileButtonClick(e){const t=this,r=m(t.getFeatureFromElement(e.target.parentElement)),n={};r&&t.getElevationControl().then((function(e){e&&(r.getGeometryStride()>2?(n.originalElevation=!0,n.onlyOriginalElevation=!1,e.setElevationToolOptions({resolution:t.options.resolution||0,sampleNumber:t.options.sampleNumber||0})):e.setElevationToolOptions(Object.assign({},t.map.elevation&&t.map.elevation.options,t.options.displayElevation)),e.displayElevationProfile(r,n))}))}onElevationButtonClick(e){const t=this;t.getElevationControl().then((r=>r&&r.displayElevationValue(m(t.getFeatureFromElement(e.target.parentElement)),{ignoreCache:!0})))}async getElevationControl(){const e=this;return e.options.displayElevation?(e.elevationControl||(e.elevationControl=await e.map.addControl("elevation",e.options.displayElevation)),e.elevationControl):null}async showDownloadDialog(e){const t=this,r=await t.getDownloadDialog();var n={title:t.getLocaleString("feature")+" - "+t.getLocaleString("download"),fileName:g(t,b,x).call(t,e)};(t.map.elevation||t.options.displayElevation)&&(n=Object.assign({},n,{elevation:Object.assign({},t.map.elevation&&t.map.elevation.options,t.options.displayElevation)})),n.openCallback=function(){t.map.trigger(i.Z.event.DIALOG,{control:r,action:"download"})},r.open(e,n)}getCurrentFeature(e){var t;return(null==e||null===(t=e.caller)||void 0===t?void 0:t.highlightedFeature)||(null==e?void 0:e.currentFeature)}getFeatureFromElement(e){const t=this.map.getLayer(e.dataset.layerId);return t?t.getFeatureById(e.dataset.featureId):null}zoomToFeatures(e){const t=this;t.map&&t.map.zoomToFeatures(e,{animate:!0})}removeFeature(e){const t=this,r=function(){e&&e.layer&&e.layer.removeFeature(e)};var i,o,a,s;e&&e.layer&&e.layer.owner&&e.layer===e.layer.owner.resultsLayer?(r(),null!==(i=t._parentCtl)&&void 0!==i&&null!==(o=i.caller)&&void 0!==o&&o.removeFeature&&(null===(a=t._parentCtl)||void 0===a||null===(s=a.caller)||void 0===s||s.removeFeature(e))):n.Z.confirm(t.getLocaleString("deleteFeature.confirm"),(function(){var n,i,o,a;r(),null!==(n=t._parentCtl)&&void 0!==n&&null!==(i=n.caller)&&void 0!==i&&i.removeFeature&&(null===(o=t._parentCtl)||void 0===o||null===(a=o.caller)||void 0===a||a.removeFeature(e))}))}getFeatureTitle(e){var t="";return e&&(t=e.id),t}exportState(){const e=this;if(e.toShare){const t={};if(e.toShare.doZoom&&(t.doZoom=e.toShare.doZoom),t.id=e.id,e.toShare.feature){let r;const n=e.toShare.feature.clone();n.showsPopup=!0,n.autoPopup=!0,r=e.toShare.feature.layer.exportState({features:[n]}),t.features=r.features,r.crs&&(t.crs=r.crs)}else if(e.toShare.features){if(t.features=e.toShare.features,e.sharedFeaturesLayer){let r=e.sharedFeaturesLayer.exportState();t.features=r.features}e.toShare.crs&&(t.crs=e.toShare.crs)}return t}return null}importState(e){const t=this;t.map&&e.features&&e.features.length&&(t.toShare={features:e.features},e.crs&&(t.toShare.crs=e.crs),t.map.addLayer({id:t.getUID(),owner:t,type:i.Z.layerType.VECTOR,title:t.getLocaleString("foi"),stealth:!0}).then((function(r){t.sharedFeaturesLayer=r,r.importState({features:e.features,crs:e.crs}).then((function(){e.doZoom&&t.map.zoomToFeatures(r.features)}))})))}}function L(e){const t=this;e.getContainerElement().querySelectorAll("table.tc-attr").forEach((function(r){!e.caller&&e.currentFeature&&(r.addEventListener(i.Z.event.CLICK,(function(r){t.zoomToFeatures([t.getCurrentFeature(e)])}),{passive:!0}),r.classList.add(t.CLASS+"-zoom"),r.setAttribute("title",t.getLocaleString("clickToCenter"))),r.querySelectorAll("a, label, input, video, audio").forEach((function(e){e.addEventListener(i.Z.event.CLICK,(function(e){e.stopPropagation()}),{passive:!0})}))}));const r=e.getContainerElement().querySelector(`.${e.CLASS}-body > table`);r&&r.parentElement.classList.add(t.CLASS+"-zoom")}function T(e){const t=this,r=e.getMenuElement();r.querySelector("."+t.CLASS+"-dl-btn").addEventListener(i.Z.event.CLICK,(function(e){t.onDownloadButtonClick(e)}),{passive:!0}),r.querySelector("."+t.CLASS+"-share-btn").addEventListener(i.Z.event.CLICK,(function(e){t.onShareButtonClick(e)}),{passive:!0}),r.querySelector("."+t.CLASS+"-zoom-btn").addEventListener(i.Z.event.CLICK,(function(e){t.onZoomButtonClick(e)}),{passive:!0});const n=r.querySelector(`.${t.CLASS}-prof-btn`);n&&n.addEventListener(i.Z.event.CLICK,(function(e){t.onProfileButtonClick(e)}),{passive:!0});const o=r.querySelector(`.${t.CLASS}-elev-btn`);o&&o.addEventListener(i.Z.event.CLICK,(function(e){t.onElevationButtonClick(e)}),{passive:!0}),r.querySelector("."+t.CLASS+"-del-btn").addEventListener(i.Z.event.CLICK,(function(e){t.onDeleteButtonClick(e)}),{passive:!0})}async function A(e){const t=this,r=(e=e||{}).feature;if(r){const o=r.clone();if(o.setId(r.id),o.layer=r.layer,e.elevation){var n=!0;if(!e.elevation.resolution&&o.getGeometryStride()>2&&(n=!1),n){var i;const r={crs:t.map.crs,features:[o],maxCoordQuantity:null===(i=t.options.displayElevation)||void 0===i?void 0:i.maxCoordQuantity,resolution:e.elevation.resolution,sampleNumber:0},n=await t.getElevationTool();return(await n.setGeometry(r))[0]}return o}return o.removeZ(),o}return null}function x(e){const t=this;return(t.getFeatureTitle(e).toString().replace(new RegExp(t.TITLE_SEPARATOR,"g"),t.FILE_TITLE_SEPARATOR)||t.getLocaleString("feature")).toLowerCase().replace(/\s/gi,"_")+"_"+n.Z.Util.getFormattedDate((new Date).toString(),!0)}n.Z.mix(C,a.default),n.Z.control.FeatureTools=C;const P=C},8127:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var n=r(688),i=r(330),o=r(2461),a=r(4916),s=r(1399),l=r(268),c=r(5394),u=r(4109),p=r(3048),h=(r(6382),r(8683)),d=(r(9529),r(8033),r(1848),r(1872));r(5265);function f(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function g(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function y(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}n.Z.control=n.Z.control||{},n.Z.Geometry=s.Z,n.Z.filter=c.Z;const m=new Set;window.addEventListener("beforeunload",(function(e){m.size>0&&(e.preventDefault(),e.returnValue="")}),{capture:!0});const v="sitna-file-edit";var _=new WeakSet,w=new WeakSet,S=new WeakSet,E=new WeakSet;class b extends o.default{constructor(){super(...arguments),f(this,E),f(this,S),f(this,w),f(this,_),g(this,"TITLE_SEPARATOR","  ");this.initProperty("snapping"),this.layer=null}static get observedAttributes(){return["stylable"]}attributeChangedCallback(e,t,r){if(t===r)return;const n=this;"stylable"===e&&y(n,_,C).call(n),"snapping"==e&&y(n,w,L).call(n)}getClassName(){return"tc-ctl-fedit"}get stylable(){return this.hasAttribute("stylable")}set stylable(e){this.toggleAttribute("stylable",!!e)}get snapping(){return this.hasAttribute("snapping")}set snapping(e){this.toggleAttribute("snapping",!!e)}async register(e){const t=this,r=await super.register.call(t,e);t.editControl=await t.getEditControl(),t.editControl&&(t.editControl.styles=t.options.styles),e.on(i.Z.event.RESULTSPANELCLOSE,(function(e){e.control===t.panel&&t.closeEditSession()})).on(i.Z.event.LAYERREMOVE+" "+i.Z.event.FEATURESCLEAR,(function(e){m.delete(e.layer),t.getLayer().then((function(r){e.layer===r&&t.closeEditSession()}))})).on(i.Z.event.FEATUREADD,(function(e){t.getLayer().then((function(t){if(e.layer===t){const t=e.layer.features[0];var r;if(t!==e.feature)e.feature.folders=null==t||null===(r=t.folders)||void 0===r?void 0:r.slice(),e.feature.wrap.feature._folders=e.feature.folders}}))})).on(i.Z.event.FEATUREADD+" "+i.Z.event.FEATUREREMOVE,(function(e){t.getLayer().then((function(t){e.layer===t&&(m.has(e.layer)||m.add(e.layer))}))}));return t.getEditControl().then((e=>{e.on(i.Z.event.FEATUREMODIFY+" "+i.Z.event.DRAWEND,(function(e){e.feature.layer&&!m.has(e.feature.layer)&&m.add(e.feature.layer)}))})),e.ready((function(){t.options.caller?y(t,S,T).call(t,t.options.caller):e.getControlsByClass(n.Z.control.WorkLayerManager).concat(e.getControlsByClass(n.Z.control.Geolocation)).forEach((function(e){y(t,S,T).call(t,e)}))})),r}async loadTemplates(){const e=r.e(6970).then(r.bind(r,6970)),t={};t[this.CLASS]=(await e).default,this.template=t}async render(e){const t=this,r=!!window.showSaveFilePicker;return t._set1stRenderPromise(new Promise((function(n,o){t.renderData({editControlId:t.getUID(),stylable:t.stylable,snapping:t.snapping,includeSaveAs:r},(function(){t.map&&t.map.addResultsPanel({resize:!1,content:"table",titles:{main:t.getLocaleString("editFeatures")}}).then((o=>{t.panel=o,t.panel.div.querySelector("."+t.panel.CLASS+"-info").insertAdjacentElement("beforeend",t),t.saveButton=t.panel.div.querySelector(`.${t.CLASS}-actions sitna-button.${t.CLASS}-btn-save`),t.saveButton.addEventListener(i.Z.event.CLICK,(function(e){t.getEditControl().then((function(e){e.getModifyControl().then((function(e){e.unselectFeatures(e.getSelectedFeatures()),t.save()}))}))}),{passive:!0}),r&&(t.saveAsButton=t.panel.div.querySelector(`.${t.CLASS}-actions sitna-button.${t.CLASS}-btn-saveas`),t.saveAsButton.addEventListener(i.Z.event.CLICK,(function(e){t.getEditControl().then((function(e){e.getModifyControl().then((function(e){e.unselectFeatures(e.getSelectedFeatures()),t.save({showDialog:!0})}))}))}),{passive:!0})),"function"==typeof e&&e(),n()}))}))})))}async getEditControl(){var e;const t=this;return await t.renderPromise(),null===(e=t.panel)||void 0===e?void 0:e.div.querySelector(`.${t.CLASS}-edit sitna-edit`)}async openEditSession(e){var t;const r=this,o=null==e?void 0:e.modes;await r.renderPromise();const a=await r.getLayer(),s=await r.getEditControl(),l=await s.getLineDrawControl();if(null!=e&&e.extensibleSketch){let t=a.features.some((e=>e instanceof h.Z)),r=a.features.some((e=>e instanceof d.Z));if(t&&r)return void n.Z.Error("extensibleSketch option is not possible on this file");t?(l.setMode(i.Z.geom.POLYLINE),l.extensibleSketch=null==e?void 0:e.extensibleSketch):r&&(l.setMode(i.Z.geom.MULTIPOLYLINE),l.extensibleSketch=null==e?void 0:e.extensibleSketch)}s.constrainModes(o),r.stylable=null===(t=null==e?void 0:e.stylable)||void 0===t||t,y(r,E,A).call(r),r.panel.open()}closeEditSession(){const e=this;e.editControl&&e.editControl.setLayer(null),e.panel&&!e.panel.div.classList.contains(i.Z.classes.HIDDEN)&&e.panel.close()}setLayer(e){const t=this;return t.editControl?(t.editControl.setLayer(e),Promise.resolve()):Promise.reject(new Error("Edit control not initialized"))}async getLayer(){return await(await this.getEditControl()).getLayer()}isStylable(e){var t;const r=null===(t=e._fileHandle)||void 0===t?void 0:t.name;return!r||r.endsWith(".kml")||r.endsWith(".kmz")}async save(e){const t=this,r=(e=e||{}).layer||await t.getLayer();let o,a,s,c,u,p,h,d;const f=async function(){(await a(t.map.workLayers)).forEach((e=>m.delete(e)))};if(r._fileHandle){d=r._fileHandle,h=d,s=h.name,a=async function(e){const t=await Promise.all(e.map((e=>{var t;return null===(t=e._fileHandle)||void 0===t?void 0:t.isSameEntry(d)})));return e.filter(((e,r)=>t[r]))};const g=async function(e){const t={mode:"readwrite"};let r=await e.queryPermission(t);return"granted"!==r&&(r=await e.requestPermission(t)),r};e.showDialog||(p=await g(h)),o=async function(){if(e.showDialog&&window.showSaveFilePicker){const e=l.Z.getMimeTypeFromUrl(h.name),t=h.name.substr(h.name.lastIndexOf("."));try{h=await window.showSaveFilePicker({suggestedName:h.name,types:[{accept:{[e]:[t]}}]}),p=await g(h)}catch(e){return void console.log(e.message)}}if("granted"===p){const r=await h.createWritable(),o=await t.map.exportFeatures(u,{fileName:s,format:c});try{await r.write(o),r.close();const n={fileHandle:h};e.showDialog&&(n.oldFileHandle=d),t.map.trigger(i.Z.event.FILESAVE,n),await f();let s=0;(await a(t.map.workLayers)).forEach((async t=>{e.showDialog&&(t._fileHandle=h),t.options.groupIndex=s++})),e.showDialog&&await t.map.addRecentFileEntry({mainHandle:h}),t.map.toast(t.getLocaleString("fileSaved"),{type:i.Z.msgType.INFO})}catch(e){n.Z.error(e.message)}}}}else s=r.options.fileSystemFile||r.options.file,a=async function(e){return e.filter((e=>r.options.fileSystemFile?e.options.fileSystemFile===r.options.fileSystemFile:e.options.file===r.options.file))},o=async function(){const e=await t.map.exportFeatures(u,{fileName:s,format:c});switch(f(),c){case i.Z.format.SHAPEFILE:n.Z.Util.downloadBlob(s,e);break;case i.Z.format.GEOPACKAGE:n.Z.Util.downloadFile(s,"application/geopackage+sqlite3",e);break;case i.Z.format.KMZ:n.Z.Util.downloadBlob(s,e);break;default:{const t=i.Z.mimeType[c];n.Z.Util.downloadFile(s,t,e);break}}};if(s){c=n.Z.Util.getFormatFromFileExtension(s.substr(s.lastIndexOf("."))),c||(c=n.Z.Util.getFormatFromFileExtension(r.options.file.substr(r.options.file.lastIndexOf("."))));const e=await a(t.map.workLayers);u=e.map((e=>e.features)).flat();const i=await a(t.map.workLayers.filter((e=>e!==r)));i.length?n.Z.confirm(t.getLocaleString("fileSave.otherLayers.confirm",{layerList:i.map((e=>e.features.length?e.features[0].getPath().join(t.TITLE_SEPARATOR):e.title)).join(", ")}),o):o()}}}async function C(){(await this.getEditControl()).stylable=this.stylable}async function L(){const e=this.snapping;(await this.getEditControl()).snapping=e}function T(e){const t=this;if(e.options.fileEditing){let r;const o=getComputedStyle(document.querySelector(":root")).getPropertyValue("--icon-edit"),s=o.match(/\\([a-f0-9]+)/i);if(r=s?String.fromCharCode(parseInt(s[1],16)):o.replace(/['"]/g,""),e instanceof n.Z.control.WorkLayerManager)e.addItemTool({renderFn:function(e,n){if(t.map.getLayer(n).type!==i.Z.layerType.VECTOR)return;const o=t.CLASS+"-btn-edit";let a=e.querySelector("sitna-toggle."+o);if(!a){const e=t.getLocaleString("editFeatures");a=new u.Z,a.text=e,a.checkedIconText=r,a.uncheckedIconText=r,a.dataset.layerId=n}return a},updateEvents:[i.Z.event.CONTROLACTIVATE,i.Z.event.CONTROLDEACTIVATE],updateFn:function(e){const r=this,n=t.map.getLayer(r.dataset.layerId);t.getLayer().then((function(e){r.checked=e===n}))},actionFn:function(){const e=this,r=t.map.getLayer(e.dataset.layerId);r.isRaster()||(t.closeEditSession(),e.checked&&t.setLayer(r).then((()=>{t.openEditSession()})))}});else if(e instanceof n.Z.control.Geolocation){const o=t.getEditControl();o.then((function(t){t.on(i.Z.event.DRAWEND+" "+i.Z.event.FEATUREMODIFY,(function(t){if(t.feature.layer===e.trackLayer&&(t.feature instanceof h.Z||t.feature instanceof d.Z)){e.updateEndMarkers();const t=e.getSelectedTrackItem();t&&e.displayTrackProfile(t,{forceRefresh:!0})}})),t.on(i.Z.event.DRAWEND,(function(t){if(t.feature.layer===e.trackLayer&&t.feature instanceof p.Z){var r,n;t.feature.setData({name:""});const i=t.feature.getStyle()||{};i.label=null===(r=e.trackLayer.styles)||void 0===r||null===(n=r.point)||void 0===n?void 0:n.label,t.feature.setStyle(i)}})),t.getLineDrawControl().then((function(t){t.on(i.Z.event.POINT+" "+i.Z.event.DRAWUNDO+" "+i.Z.event.DRAWREDO+" "+i.Z.event.DRAWCANCEL,(function(r){e.displayTrackProfile(e.getSelectedTrackItem(),{forceRefresh:!0,feature:t.wrap.getSketch()})}))}))})),e.addItemTool({renderFn:function(n){const i=t.CLASS+"-btn-edit";let o=n.querySelector("sitna-toggle."+i);if(!o){const n=t.getLocaleString("editTrack");o=new u.Z,o.text=n,o.checkedIconText=r,o.uncheckedIconText=r,t.getLayer().then((function(t){o.checked=t===e.trackLayer}))}return o},updateEvents:[i.Z.event.CONTROLACTIVATE,i.Z.event.CONTROLDEACTIVATE,,i.Z.event.LAYERUPDATE],updateFn:function(r){const n=this;t.getLayer().then((function(t){n.checked=t===e.trackLayer}))},actionFn:function(){const r=this,i=async function(){t.closeEditSession(),await t.setLayer(e.trackLayer),t.openEditSession({stylable:!1,extensibleSketch:!0,modes:[a.default.mode.MODIFY,a.default.mode.ADDPOINT,a.default.mode.ADDLINE]})};if(r.checked){e.trackLayer.features.some((e=>e.getGeometryStride()>2))?n.Z.confirm(t.getLocaleString("elevationsWillBeRequested.confirm"),i,(()=>r.checked=!r.checked)):i()}else t.closeEditSession()}}),o.then((r=>{r.getLineDrawControl().then((r=>{r.on(i.Z.event.DRAWSTART,(function(n){r.layer===e.trackLayer&&!n.extending&&e.trackLayer.features.some((e=>e instanceof h.Z||e instanceof d.Z))&&(r.new(),t.map.toast(t.getLocaleString("cannotAddSeparateLines.warning"),{type:i.Z.msgType.WARNING}))}))}))}))}}}async function A(){const e=this,t=await e.getLayer(),r=!t||!(t._fileHandle&&!t._additionaFileHandles||t.options.fileSystemFile||t.options.file);e.saveButton.disabled=r,e.saveAsButton&&(e.saveAsButton.disabled=r)}customElements.get(v)||customElements.define(v,b),n.Z.control.FileEdit=b;const x=b},7622:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>E});var n=r(688),i=r(330),o=r(2461),a=r(9988),s=r(2416),l=r(268),c=r(1466),u=r.n(c),p=r(3048),h=r(8033),d=r(8683),f=r(1872),g=r(9529),y=r(5265);function m(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}function v(e,t){var r=function(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}(e,t,"get");return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,r)}n.Z.control=n.Z.control||{},n.Z.Util=l.Z;const _="sitna-file-import";var w=new WeakMap;class S extends o.default{constructor(){super(...arguments),m(this,w,{writable:!0,value:new Map});const e=this;if(e.LAYER_METADATA_STORE_KEY_PREFIX="TC.fileLayerMetadata.",e._dialogDiv=n.Z.Util.getDiv(e.options.dialogDiv),e.options.dialogDiv||document.body.appendChild(e._dialogDiv),e.fileTypes=[{accept:{[i.Z.mimeType.KML]:["."+i.Z.format.KML]}},{accept:{[i.Z.mimeType.KMZ]:["."+i.Z.format.KMZ]}},{accept:{[i.Z.mimeType.GML]:["."+i.Z.format.GML,"."+i.Z.format.GML2]}},{accept:{[i.Z.mimeType.GEOJSON]:["."+i.Z.format.GEOJSON,"."+i.Z.format.JSON]}},{accept:{"text/plain":["."+i.Z.format.WKT]}},{accept:{"text/plain":["."+i.Z.format.WKB]}},{accept:{[i.Z.mimeType.ZIP]:[".zip"]}},{accept:{[i.Z.mimeType.GEOPACKAGE]:["."+i.Z.format.GEOPACKAGE]}},{accept:{[i.Z.mimeType.SHAPEFILE]:[".shp",".dbf",".prj",".cst",".cpg"]}},{accept:{[i.Z.mimeType.GPX]:["."+i.Z.format.GPX]}}],Array.isArray(e.options.formats)){e.formats=e.options.formats;const t=e.format.map((e=>n.Z.Util.getMimeTypeFromUrl(e)));e.fileTypes=e.fileTypes.filter((e=>{e.accept.keys.some((e=>t.includes(e)))}))}else e.formats=e.fileTypes.reduce(((e,t)=>{for(var r in t.accept)e=e.concat(t.accept[r].map((e=>e.substr(1))));return e}),[]);e.apiAttribution="",e.mainDataAttribution="",e.dataAttributions=[],e.exportsState=!0}getClassName(){return"tc-ctl-file"}register(e){const t=this,r=super.register.call(t,e);return t.registerLayerAdd(),t.options.enableDragAndDrop&&e.wrap.enableDragAndDrop(t.options),e._bufferFeatures=[],document.addEventListener("paste",(async r=>{if(r.clipboardData.files&&r.clipboardData.files.length){let e=r.clipboardData.files;if(DataTransferItem.prototype.getAsFileSystemHandle){e=[];for(var n=0,o=r.clipboardData.items.length;n<o;++n){const t=r.clipboardData.items[n],i=await t.getAsFileSystemHandle();i&&e.push(i)}}t.loadFiles(e)}else r.clipboardData.items.length||e.toast(t.getLocaleString("fileImport.pasteNotSupported"),{type:i.Z.msgType.WARNING})})),e.on(i.Z.event.FEATURESIMPORT,(async function(r){const o=r.fileName,a=r.fileHandle,s=r.dropTarget,l=r.features,c=r.timeStamp,u=r.groupIndex,m=r.fileSystemFile&&r.fileSystemFile.name,v=function(e){const r=e.geometry;if(r){var i;switch(!0){case e instanceof p.Z:i=[r];break;case e instanceof h.Z:case e instanceof d.Z:i=r;break;case e instanceof f.Z:case e instanceof g.Z:i=r.flat();break;case e instanceof y.Z:i=r.flat(2)}i&&i.every((function(e){return Math.abs(e[0])<=180&&Math.abs(e[1])<=90}))&&e.setCoords(n.Z.Util.reproject(r,"EPSG:4326",t.map.crs))}return e};var _="."+i.Z.format.GPX.toLowerCase();if(o.toLowerCase().indexOf(_)===o.length-_.length||s&&s!==t.map.div&&s!==t)return void t.renderRecentFileList();const w=r=>{if(!r)do{r=t.getUID(a||c)}while(t.map.getLayer(r));return e.addLayer({id:r,title:o,owner:t,type:i.Z.layerType.VECTOR,file:o,groupIndex:u,fileSystemFile:m})};let S=r.targetLayers||[];S.length||S.push(await w());for(var E=0;E<S.length;E++){const e=S[E],r=t.map.getLayer(e)||await w(e.id),n=await t.loadLayerMetadata(r);n&&n.groupIndex!==u?S[E]=!1:S[E]=r}S=S.filter((e=>e)),e._fileDropLoadingIndicator=e.getLoadingIndicator().addWait(e._fileDropLoadingIndicator),S.forEach((async function(i){a&&(i._fileHandle=a,r.additionalFileHandles&&(i._additionalFileHandles=r.additionalFileHandles),await t.saveLayerMetadata(i)),i._timeStamp=c,i.owner=t,t.getLayers().push(i);const o=i.id+".",s=l.map((e=>e.getId()));i.addFeatures(l.map(v).map((function(e,t){const r=e.getId();if(s.filter(((e,r)=>r!==t)).includes(r)){const r=n.Z.getUID({prefix:o,banlist:s});s[t]=r,e.setId(r)}return e}))).then((()=>t.subtrackPendingFile())),r.targetLayer||(e._bufferFeatures=e._bufferFeatures.concat(i.features))})),t.renderRecentFileList()})).on(i.Z.event.FEATURESIMPORTERROR,(function(e){var r,o=e.file.name;r=".kmz"===o.toLowerCase().substr(o.length-4)?"fileImport.error.reasonKmz":"fileImport.error.reasonUnknown",n.Z.error(e.message?t.getLocaleString(e.message):t.getLocaleString(r,{fileName:o}),i.Z.msgErrorMode.TOAST),(new FileReader).onload=function(e){n.Z.error("Nombre del archivo: "+o+" \n Contenido del archivo: \n\n"+e.target.result,i.Z.msgErrorMode.EMAIL,"Error en la subida de un archivo")},t.subtrackPendingFile()})).on(i.Z.event.FEATURESIMPORTPARTIAL,(function(e){t.map.toast(t.getLocaleString("fileImport.partial.problem",{fileName:e.file.name,table:e.table,reason:e.reason}),{type:i.Z.msgType.ERROR})})).on(i.Z.event.FEATURESIMPORTWARN,(function(e){t.map.toast(t.getLocaleString("fileImport.geomEmpty",{fileName:e.file.name}),{type:i.Z.msgType.WARNING})})).on(i.Z.event.RECENTFILEADD,(function(e){t.renderRecentFileList()})).on(i.Z.event.LAYERADD,(function(e){t.loadLayersFromFile([e.layer])})).on(i.Z.event.LAYERREMOVE,(function(e){e.layer.owner===t&&t.deleteLayerMetadata(e.layer);const r=t.getLayers(),n=r.indexOf(e.layer);n>=0&&r.splice(n,1)})),e.loaded((()=>{t.loadLayersFromFile(e.workLayers)})),r}async loadTemplates(){const e=this,t=r.e(4068).then(r.bind(r,4068)),n=r.e(5996).then(r.bind(r,5996)),i={};i[e.CLASS]=(await t).default,i[e.CLASS+"-dialog"]=(await n).default,e.template=i}render(){const e=this;return e._set1stRenderPromise(new Promise((function(t,r){e.renderData({formats:e.formats},(function(){const r=e.querySelector("input[type=file]");r.addEventListener(i.Z.event.CLICK,(async function(t){const r=this,n=document.createElement("form"),o=r.parentElement;if(o.insertBefore(n,r),n.appendChild(r),n.reset(),n.insertAdjacentElement("afterend",r),o.removeChild(n),l.Z.isFunction(window.showOpenFilePicker)){let r;t.preventDefault();try{r=await window.showOpenFilePicker({multiple:!0})}catch(t){if(t instanceof DOMException&&window.parent!==window){let t=e.getLocaleString("cannotOpenFileIfEmbedded");e.options.enableDragAndDrop&&(t+="<br/><br/>"+e.getLocaleString("alternativelyYouCanDropFile")),e.map.toast(t,{type:i.Z.msgType.WARNING})}else if("AbortError"!==t.name)throw t}r&&e.loadFiles(r)}})),r.addEventListener("change",(function(t){e.map&&e.loadFiles(t.target.files)})),e.renderRecentFileList(),e.getRenderedHtml(e.CLASS+"-dialog",null,(function(r){e._dialogDiv.innerHTML=r,t(e)}))}))})))}loadFiles(e){const t=this;return t.map.loadFiles(e,{control:t}),t}async loadLayersFromFile(e){const t=this,r=e.filter((e=>t.getIdCount(e.id)&&!e.options.owner&&e.options.file));if(r.length){const a=[],s=Math.max(...r.map((e=>t.getIdCount(e.id))));n.Z.setUIDStart(s+1,{prefix:t.id+"-"});const c=await Promise.all(r.map((e=>t.loadLayerMetadata(e))));r.forEach(((e,t)=>{var r;e.options.groupIndex=null===(r=c[t])||void 0===r?void 0:r.groupIndex}));const u=new Map,p=new Map;for(var i=0;i<c.length;i++){const n=c[i];if(null!=n&&n.fileHandle){let e;for(const[t,r]of u.entries())if(await t.isSameEntry(n.fileHandle)){e=r;break}e||(e=[],u.set(n.fileHandle,e),a.push(n.fileHandle),n.additionalFileHandles&&p.set(n.fileHandle,n.additionalFileHandles)),e.push(r[i])}else{const r=e[i];t.map.getLayer(r)&&t.map.removeLayer(r)}}await t.renderPromise();const h=t._dialogDiv.querySelector(".tc-ctl-file-dialog"),d=h.querySelector("h3"),f=t._dialogDiv.querySelector("sitna-button.tc-ctl-file-dialog-ok"),g=e=>{t.map.loadFiles(e,{layers:u.get(e[0]),target:t})};for(const e of u.keys()){let r=[e];const n=p.get(e);n&&(r=r.concat(n));const i=[];for await(let e of r.map((e=>e.queryPermission())))i.push(e);let a=!1;for(var o=0;o<i.length;o++){if("prompt"===i[o]){a=!0;const e=r[o];if(d.innerHTML.length){const t=",<br>";d.innerHTML.split(t).includes(e.name)||(d.innerHTML=d.innerHTML+t+e.name)}else d.innerHTML=e.name}}const s=e=>"granted"===e;if(a){const n=async function(n){for(var o=0;o<i.length;o++)i[o]=await r[o].requestPermission();if(i.every(s))g(r);else{u.get(e).forEach((e=>t.map.removeLayer(e)))}d.innerHTML="",l.Z.closeModal()};l.Z.showModal(h,{closeCallback:n}),f.addEventListener("click",n)}else i.every(s)&&g(r)}}}exportState(){const e=this;return e.exportsState&&e.getLayers().length?{id:e.id,layers:e.getLayers().map((function(e){var t;const r={title:e.title,state:n.Z.Util.extend(e.exportState(),{path:null!==(t=e.features)&&void 0!==t&&t.length?e.features[0].getPath():void 0})};return e._fileHandle&&(r.file=e._fileHandle.name),r}))}:null}async importState(e){const t=this;if(t.map){const o=[];await t.loadLayersFromFile(t.map.workLayers),e.layers.filter((function(e){return!t.map.workLayers.some((t=>t.options.file&&e.file===t.options.file))})).forEach((function(e){o.push(t.map.addLayer({id:t.getUID(),title:e.title,owner:t,type:i.Z.layerType.VECTOR}))}));const a=await Promise.all(o);for(var r=0,n=a.length;r<n;r++){const n=a[r],i=r;n.importState(e.layers[r].state).then((function(){for(var t=0;t<n.features.length;t++)n.features[t].folders=e.layers[i].state.path})),t.getLayers().push(n)}}}async saveLayerMetadata(e){const t=this,r={fileHandle:e._fileHandle,groupIndex:e.options.groupIndex};return e._additionalFileHandles&&(r.additionalFileHandles=e._additionalFileHandles),v(t,w).set(e.id,r),await u().setItem(t.LAYER_METADATA_STORE_KEY_PREFIX+t.map.id+"-"+e.id,r).catch((e=>console.warn(e)))}async loadLayerMetadata(e){const t=this;let r=await u().getItem(t.LAYER_METADATA_STORE_KEY_PREFIX+t.map.id+"-"+e.id).catch((e=>console.warn(e)));return r?v(t,w).set(e.id,r):r=v(t,w).get(e.id),r}deleteLayerMetadata(e){const t=this;return u().removeItem(t.LAYER_METADATA_STORE_KEY_PREFIX+t.map.id+"-"+e.id).catch((function(e){console.warn(e.message)})),t}async addRecentFileEntry(e){await this.map.addRecentFileEntry(e)}async removeRecentFileEntry(e){await this.map.removeRecentFileEntry(e),this.renderRecentFileList()}async renderRecentFileList(e){const t=this,r=function(e){t.map.loadRecentFileEntry(e.target.dataset.fileIndex)},n=function(e){t.removeRecentFileEntry(e.target.dataset.fileIndex)},o=t.querySelector(".tc-ctl-file-recent");if(o){const s=t.getLocaleString("removeFromList"),l=await(e?Promise.resolve(e):t.map&&t.map.loadRecentFiles()||[]);if(o.replaceChildren?o.replaceChildren():o.innerHTML="",l.length){const e=document.createElement("li"),r=document.createElement("h3");r.innerHTML=t.getLocaleString("recentFiles"),e.appendChild(r),o.appendChild(e)}l.forEach(((e,t)=>{var l;const c=document.createElement("li"),u=document.createElement("sitna-button");u.dataset.fileIndex=t,u.addEventListener(i.Z.event.CLICK,r),u.setAttribute("variant",a.Z.variant.LINK),u.setAttribute("text",(null===(l=e.mainHandle)||void 0===l?void 0:l.name)||e.name),c.appendChild(u);const p=document.createElement("sitna-button");p.text=s,p.dataset.fileIndex=t,p.addEventListener(i.Z.event.CLICK,n),p.setAttribute("variant",a.Z.variant.MINIMAL),p.setAttribute("icon",a.Z.action.CLOSE),c.appendChild(p),o.appendChild(c)}))}}subtrackPendingFile(){const e=this;window.dropFilesCounter--,0===window.dropFilesCounter&&(e.map.zoomToFeatures(e.map._bufferFeatures),e.map._bufferFeatures=[],delete window.dropFilesCounter);var t=e.map.getLoadingIndicator();return t&&(e.map._featureImportWaitId&&t.removeWait(e.map._featureImportWaitId),e.map._fileDropLoadingIndicator&&t.removeWait(e.map._fileDropLoadingIndicator)),e}getUID(e){const t=this;if(e){const r=Object.prototype.hasOwnProperty.call(window,"FileSystemFileHandle")?"_fileHandle":"_timeStamp",i=t.getLayers().reduce(((e,t)=>e.findByProperty(r,t[r])&&e.some((e=>/^[\w]*-\d-\d/gi.exec(t.id)[0]===/^[\w]*-\d-\d/gi.exec(e.id)[0]))?e:e.concat(t)),[]);return n.Z.getUID({prefix:`${t.id}-${i.filter((t=>t[r]!=e)).length+1}-`})}return n.Z.getUID({prefix:t.id+"-"})}}n.Z.mix(S,s.default),customElements.get(_)||customElements.define(_,S),n.Z.control.FileImport=S;const E=S},707:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(688),i=r(330),o=r(7497),a=r(268);n.Z.control=n.Z.control||{};const s=function(){var e=this;o.Z.apply(e,arguments)};n.Z.inherit(s,o.Z),function(){var e=s.prototype;e.CLASS="tc-ctl-fscreen";const t={fullscreenEnabled:0,fullscreenElement:1,requestFullscreen:2,exitFullscreen:3,fullscreenchange:4,fullscreenerror:5},n=["webkitFullscreenEnabled","webkitFullscreenElement","webkitRequestFullscreen","webkitExitFullscreen","webkitfullscreenchange","webkitfullscreenerror"],l=["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozfullscreenerror"],c=["msFullscreenEnabled","msFullscreenElement","msRequestFullscreen","msExitFullscreen","MSFullscreenChange","MSFullscreenError"],u="undefined"!=typeof window&&void 0!==window.document?window.document:{},p="fullscreenEnabled"in u&&Object.keys(t)||n[0]in u&&n||l[0]in u&&l||c[0]in u&&c||[];e.fscreen={inFullscreen:!1,requestFullscreen:e=>e[p[t.requestFullscreen]](),requestFullscreenFunction:e=>e[p[t.requestFullscreen]],get exitFullscreen(){return u[p[t.exitFullscreen]].bind(u)},addEventListener:(e,r,n)=>u.addEventListener(p[t[e]],r,n),removeEventListener:(e,r,n)=>u.removeEventListener(p[t[e]],r,n),get fullscreenEnabled(){return Boolean(u[p[t.fullscreenEnabled]])},set fullscreenEnabled(e){},get fullscreenElement(){return u[p[t.fullscreenElement]]},set fullscreenElement(e){},get onfullscreenchange(){return u[("on"+p[t.fullscreenchange]).toLowerCase()]},set onfullscreenchange(e){return u[("on"+p[t.fullscreenchange]).toLowerCase()]=e},get onfullscreenerror(){return u["on"+p[t.fullscreenerror].toLowerCase()]},set onfullscreenerror(e){return u["on"+p[t.fullscreenerror].toLowerCase()]=e}},e.loadTemplates=async function(){const e=await r.e(933).then(r.bind(r,933));this.template=e.default},e.register=function(e){const t=this,r=o.Z.prototype.register.call(t,e);return r.then((function(){const e=t.div.querySelector("."+t.CLASS+"-btn");if(t.fscreen.fullscreenEnabled){const r=()=>{e.classList.toggle(i.Z.classes.ACTIVE,t.fscreen.inFullscreen),e.setAttribute("title",t.fscreen.inFullscreen?t.getLocaleString("fscreen.tip.return"):t.getLocaleString("fscreen.tip"))};t.fscreen.addEventListener("fullscreenchange",(()=>{t.fscreen.inFullscreen=null!==t.fscreen.fullscreenElement,r()}),!1),e.addEventListener("click",(function(){t.byBtn=!0,t.fscreen.inFullscreen?t.fscreen.exitFullscreen():t.fscreen.requestFullscreen(u.body)}),!1),a.Z.detectMobile()||window.addEventListener("resize",(()=>{if(t.byBtn)return void(t.byBtn=!1);const n=window.innerWidth*window.devicePixelRatio,i=window.innerHeight*window.devicePixelRatio,o=window.screen.width,a=window.screen.height;t.fscreen.inFullscreen=n/o>=.95&&i/a>=.95,r();let s=u.body.getElementsByTagName("header");t.fscreen.inFullscreen?(e.setAttribute("disabled","disabled"),s.length>0&&s[0].classList.add("tc-ctl-fscreenToHeader"),t.map.div.classList.add("tc-ctl-fscreenToMap"),t.map.view3D&&t.map.view3D.container.classList.add("tc-ctl-fscreenToMap")):(e.removeAttribute("disabled"),s.length>0&&s[0].classList.remove("tc-ctl-fscreenToHeader"),t.map.div.classList.remove("tc-ctl-fscreenToMap"),t.map.view3D&&t.map.view3D.container.classList.remove("tc-ctl-fscreenToMap")),e.setAttribute("title",t.fscreen.inFullscreen?t.getLocaleString("fscreen.tip.keyboard"):t.getLocaleString("fscreen.tip"));const l=u.createEvent("HTMLEvents");l.initEvent("resize",!1,!1),t.map.div.dispatchEvent(l)}))}else t.disable()})),r}}(),n.Z.control.FullScreen=s;const l=s},5573:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>nt});var n=r(1466),i=r.n(n),o=r(688),a=r(330),s=r(7497),l=r(9945),c=r(268),u=r(7167),p=r(5198),h=r(6204),d=r(8683),f=r(1872),g=r(3048),y=r(6382),m=r(9614),v=r.n(m);function _(e,t){S(e,t),t.add(e)}function w(e,t,r){S(e,t),t.set(e,r)}function S(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function E(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function b(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}function C(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,T(e,t,"get"))}function L(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,T(e,t,"set"),r),r}function T(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}o.Z.control=o.Z.control||{},a.Z.event.TOOLSCLOSE=a.Z.event.TOOLSCLOSE||"toolsclose.tc",a.Z.event.TOOLSOPEN=a.Z.event.TOOLSOPEN||"toolsopen.tc",a.Z.event.DIALOG=a.Z.event.DIALOG||"dialog.tc",a.Z.classes.UNPLUGGED="tc-unplugged";const A=e=>e instanceof f.Z,x=e=>(e=>e instanceof d.Z)(e)||A(e),P=e=>A(e)?e.geometry[0][0]:e.geometry[0];let O=null,I=!1;const R=function(){(!O||O[0]!==this.getCenter()[0]&&O[1]!==this.getCenter()[1])&&(O=this.getCenter(),I||this.getControlsByClass(Pe)[0].setFollowing(!1))},M="wakeLock"in navigator;let D=null,N=null;const Z=function(e){var t=[];for(var r in e)e[r]&&"object"==typeof e[r]&&(t.push(e[r]),t.sort((function(e,t){return"string"==typeof e.name&&c.Z.isFunction(e.name.localeCompare)?e.name.localeCompare(t.name):0})));return t};var k=new WeakMap,F=new WeakMap,U=new WeakMap,B=new WeakMap,G=new WeakMap,j=new WeakMap,W=new WeakMap,H=new WeakMap,q=new WeakMap,V=new WeakMap,z=new WeakMap,Y=new WeakMap,K=new WeakMap,X=new WeakMap,$=new WeakMap,J=new WeakSet,Q=new WeakSet,ee=new WeakSet,te=new WeakSet,re=new WeakMap,ne=new WeakSet,ie=new WeakSet,oe=new WeakMap,ae=new WeakSet,se=new WeakSet,le=new WeakSet,ce=new WeakSet,ue=new WeakSet,pe=new WeakSet,he=new WeakSet,de=new WeakSet,fe=new WeakSet,ge=new WeakSet,ye=new WeakSet,me=new WeakMap,ve=new WeakSet,_e=new WeakSet,we=new WeakSet,Se=new WeakSet,Ee=new WeakSet,be=new WeakSet,Ce=new WeakSet,Le=new WeakSet,Te=new WeakSet,Ae=new WeakMap,xe=new WeakSet;class Pe extends s.Z{constructor(){super(...arguments),_(this,xe),_(this,Te),_(this,Le),_(this,Ce),_(this,be),_(this,Ee),_(this,Se),_(this,we),_(this,_e),_(this,ve),_(this,ye),_(this,ge),_(this,fe),_(this,de),_(this,he),_(this,pe),_(this,ue),_(this,ce),_(this,le),_(this,se),_(this,ae),_(this,ie),_(this,ne),_(this,te),_(this,ee),_(this,Q),_(this,J),E(this,"const",{className:{ACTIVE:"tc-ctl-geolocation-active",DRAWACTIVATED:"draw-activated",SIMULATIONACTIVATED:"simulation-activated",PLAY:"tc-play",PAUSE:"tc-pause"},selector:{ACTIVATOR:'sitna-button[variant="link"]',EDIT:".tc-btn-edit",DELETE:".tc-btn-delete",DELETEALL:".tc-btn-delete-all",SAVE:".tc-btn-save",CANCEL:".tc-btn-cancel",EXPORT:".tc-btn-export",SHARE:".tc-btn-share",STOP:".tc-btn-stop",PAUSE:".tc-btn-pause",BACKWARD:".tc-btn-backward",FORWARD:".tc-btn-forward",SPEED:".tc-spn-speed",VISIBILITY:"sitna-toggle.tc-chk-track-visibility"},localStorageKey:{GEOTRACKING:"trk",GEOTRACKINGTEMP:"trktemp",GEOTRACKINGSHOWADVERTISEMENT:"trkAdvertisement",GPSSHOWADVERTISEMENT:"gpsAdvertisement",TEST:"test"},event:{POSITIONCHANGE:"positionchange.tc.geolocation",GPSPOSITIONCHANGE:"gpspositionchange.tc.geolocation",GPSPOSITIONERROR:"positionerror.tc.geolocation",STATEUPDATED:"stateupdated.tc.geolocation",GPSADD:"gpsadd.tc.geolocation",TRACKSNAPPING:"tracksnapping.tc.geolocation",DRAWTRACK:"drawtrack.tc.geolocation",CLEARTRACK:"cleartrack.tc.geolocation",IMPORTEDTRACK:"importedtrack.tc.geolocation"},supportedFileExtensions:[".gpx",".kml",".kmz"],layer:{GPS:"gps",TRACK:"track",GEOTRACKING:"geotracking"}}),E(this,"markerStyle",{radius:10,fillColor:[255,0,0,100],strokeColor:[255,255,255,255],strokeWidth:2}),E(this,"lineStyle",{strokeWidth:2,strokeColor:[0,206,209,255]}),E(this,"delta",500),E(this,"walkingSpeed",5e3),E(this,"notificationConfig",{}),E(this,"storageCrs","EPSG:4326"),E(this,"snappingTolerance",void 0),E(this,"featuresToShare",[]),w(this,k,{writable:!0,value:void 0}),w(this,F,{writable:!0,value:void 0}),w(this,U,{writable:!0,value:void 0}),w(this,B,{writable:!0,value:void 0}),w(this,G,{writable:!0,value:!0}),w(this,j,{writable:!0,value:!0}),w(this,W,{writable:!0,value:void 0}),w(this,H,{writable:!0,value:void 0}),w(this,q,{writable:!0,value:void 0}),w(this,V,{writable:!0,value:void 0}),w(this,z,{writable:!0,value:new Map}),w(this,Y,{writable:!0,value:[]}),w(this,K,{writable:!0,value:void 0}),w(this,X,{writable:!0,value:void 0}),w(this,$,{writable:!0,value:function(e){var t=e.querySelector(this.const.selector.ACTIVATOR).text,r=new RegExp(this.const.supportedFileExtensions.join("|"),"gi");return t.replace(r,"")+"_"+c.Z.getFormattedDate(new Date,!0)}}),w(this,re,{writable:!0,value:function(){this.map.toast(this.div.querySelector(".tc-alert-warning").innerHTML,{duration:1e4})}}),w(this,oe,{writable:!0,value:function(){return this.trackLayer.features.filter((e=>e instanceof g.Z))}}),E(this,"renderInfoNewPosition",(function(e){const t=this;t.getRenderedHtml(t.CLASS+"-tracking-toast",b(t,se,ke).call(t,e.pd),(function(e){t.getTrackInfoPanel().then((function(t){t.isMinimized()||t.renderPromise().then((function(){t.options.collidingPriority=t.COLLIDING_PRIORITY.IGNORE,t.open(e)}))}))}))})),w(this,me,{writable:!0,value:function(){const e=this;window.removeEventListener("visibilitychange",C(e,q),!1),L(e,q,null),"onpagehide"in window?window.removeEventListener("pagehide",C(e,W),!1):window.removeEventListener("blur",C(e,W),!1),"onpageshow"in window?window.removeEventListener("pageshow",C(e,H),!1):window.removeEventListener("focus",C(e,H),!1)}}),E(this,"setChartProgress",(function(e,t,r,n){const i=this;if(!i.elevationControl||!i.elevationControl.resultsPanel||i.elevationControl.resultsPanel.isVisible()&&!i.elevationControl.resultsPanel.isMinimized()){var o=e.d;if(i.elevationChartData){i.setSecondaryElevationProfileCoordinates(i.elevationChartData.coords);let e=0;for(;i.elevationChartData.x[e]<=o;)e++;i.getElevationControl().then((t=>t&&t.getProfilePanel().then((function(t){t&&(t.chart.chart.tooltip.show({x:i.elevationChartData.x[0===e?0:e-1]}),t.wrap.hideElevationMarker())}))))}}})),w(this,Ae,{writable:!0,value:function(e,t){const r=this;let n=b(r,Te,tt).call(r,e);return n||(n={feature:e},C(r,Y).push(n)),n.data=t,n}}),E(this,"removeTrack",(function(e,t){const r=this;return new Promise((function(n,a){r.getAvailableTracks().then((function(a){if(a){var s=e.dataset.id;if(a[s]){var l=a[s].uid;const e=function(){const e=r.getSelectedTrackItem();e&&e.dataset.id===s&&r.clear(r.const.layer.TRACK),i().removeItem(r.const.localStorageKey.GEOTRACKING+"#"+l).then((function(){r.getStoredTracks().then((function(){b(r,Ee,$e).call(r).then((()=>n(!0)))}))})).catch((function(e){console.warn(e),n(!1)}))};null!=t&&t.silent?e():o.Z.confirm(r.getLocaleString("geo.trk.delete.alert"),e,(()=>n(!1)))}}}))}))})),E(this,"removeAllTracks",(function(e){const t=this;o.Z.confirm(t.getLocaleString("geo.trk.delete.all.alert"),(function(){t.div.querySelectorAll(`.${t.CLASS}-track-available-lst li[data-id]`).forEach((function(r){t.removeTrack(r,{silent:!0}),e.disabled=!0}))}))})),E(this,"setSelectedTrack",(function(e){const t=this;t.isActive||t.activate(),t.track.trackList.querySelectorAll("li").forEach((function(e){var r;e.classList.remove(a.Z.classes.CHECKED),null===(r=e.querySelector(t.const.selector.ACTIVATOR))||void 0===r||r.removeAttribute("title")})),e.classList.add(a.Z.classes.CHECKED);const r=e.querySelector(t.const.selector.ACTIVATOR),n=function(t){e.scrollIntoView({behavior:"smooth",block:"end"}),e.removeEventListener("transitionend",n,!1)};e.addEventListener("transitionend",n,!1),e.setAttribute("title",t.getLocaleString("tr.lst.clear")+" "+r.text),r.setAttribute("title",e.getAttribute("title")),t.loadingState||delete t.toShare})),E(this,"getSelectedTrackItem",(function(){return this.track.trackList.querySelector("li."+a.Z.classes.CHECKED)}));const e=this;e.div.classList.add(e.CLASS),L(e,k,c.Z.getDiv(e.options.dialogDiv)),e.options.dialogDiv||document.body.appendChild(C(e,k)),L(e,F,c.Z.getDiv({})),document.body.appendChild(C(e,F)),e.snappingTolerance=e.options.snappingTolerance||50,e.exportsState=!0,e.simulationStopped=!0,e._uiElementSelector="ol > li[data-id]",e._toolContainerSelector=`.${e.CLASS}-tools-active`}getClassName(){return"tc-ctl-geolocation"}async register(e){const t=this;await super.register(e),t.wrap=new o.Z.wrap.control.Geolocation(t),t.wrap.register(e),t.options.fileEditing&&await e.addControl("fileEdit",{caller:t,snapping:!0}),e._bufferFeatures=[],t.hillDeltaThreshold=t.options&&t.options.hillDeltaThreshold||t.map.options.elevation&&t.map.options.elevation.hillDeltaThreshold||20;const r=e.addLayer({id:t.getUID(),type:a.Z.layerType.VECTOR,owner:t,stealth:!0,title:"Posicionar.GPS"}),n=e.addLayer({id:t.getUID(),type:a.Z.layerType.VECTOR,owner:t,stealth:!0,title:"Posicionar.Geotracking",styles:function(e){let r=e.getData().name;return r=r&&(r+"").trim().length>0?(r+"").trim().toLowerCase():"",{point:{radius:6,fillColor:"#00ced1",fillOpacity:t.track.renderTrack.checked?1:0,strokeColor:"#ffffff",fontColor:"#00ced1",labelOutlineColor:"#ffffff",labelOutlineWidth:1,label:r},line:[{strokeOpacity:t.track.renderTrack.checked?1:0,strokeWidth:8,strokeColor:"#ffffff"},{strokeOpacity:t.track.renderTrack.checked?1:0,strokeWidth:4,strokeColor:"#00ced1"}]}}}),i=e.addLayer({id:t.getUID(),type:a.Z.layerType.VECTOR,owner:t,stealth:!0,title:"Posicionar.Track",styles:{line:{strokeWidth:2,strokeColor:"#C52737"},point:{radius:6,fillColor:"#C52737",fillOpacity:.5,strokeColor:"#27C537",strokeWidth:2,fontColor:"#C52737",fontSize:10,labelOutlineColor:"#ffffff",labelOutlineWidth:2,labelOffset:[0,-12],label:"${name}"}}}),s=e.addLayer({id:t.getUID(),type:a.Z.layerType.VECTOR,owner:t,stealth:!0,title:"Posicionar.Extremos"});e.on(a.Z.event.FEATURESIMPORT,function(e){const t=this,r=function(e){const r=e.fileName,n=e.dropTarget;var i="."+a.Z.format.KML.toLowerCase(),o="."+a.Z.format.GPX.toLowerCase();if(r.toLowerCase().indexOf(o)===r.length-o.length||r.toLowerCase().indexOf(i)===r.length-i.length&&n===t){t.clear(t.const.layer.TRACK);const n=function(){setTimeout((function(){if(t.map._bufferFeatures=t.map._bufferFeatures.concat(e.features),window.dropFilesCounter--,0===window.dropFilesCounter){t.map.zoomToFeatures(t.map._bufferFeatures),t.map._bufferFeatures=[],delete window.dropFilesCounter;var r=t.map.getLoadingIndicator();r&&r.removeWait(t.map._fileDropLoadingIndicator),t.off(t.const.event.IMPORTEDTRACK,n)}}),0)};t.on(t.const.event.IMPORTEDTRACK,n),t.importTrack(e),/.kml$/g.test(r.toLowerCase())&&t.trackLayer&&t.trackLayer.styles&&t.trackLayer.features.forEach((function(e){e.getStyle()||(e instanceof g.Z&&t.trackLayer.styles.point?e.setStyle(t.trackLayer.styles.point):x(e)&&t.trackLayer.styles.line&&e.setStyle(t.trackLayer.styles.line))}))}};t.working&&c.Z.isFunction(t.working.then)?t.working.then(r(e)):(t.working=!0,r(e))}.bind(t)),e.on(a.Z.event.PROJECTIONCHANGE,(function(e){t.elevationChartData&&(t.elevationChartData.coords=c.Z.reproject(t.elevationChartData.coords,e.oldCrs,e.newCrs),t.elevationChartData.secondaryElevationProfileChartData&&t.elevationChartData.secondaryElevationProfileChartData.length&&t.elevationChartData.secondaryElevationProfileChartData.forEach((t=>{t.eleCoordinates=c.Z.reproject(t.eleCoordinates,e.oldCrs,e.newCrs)})))})),e.on(a.Z.event.DIALOG,(function(e){if(e.control)switch(e.action){case"share":e.control.caller!==t&&b(t,ee,Re).call(t,e.control.caller);break;case"download":b(t,te,Me).call(t,e.control.caller)}})),e.on(a.Z.event.FILESAVE,(function(e){const r=Object.prototype.hasOwnProperty.call(e,"oldFileHandle"),n=r?e.oldFileHandle:e.fileHandle;t.trackLayer._fileHandle&&t.trackLayer._fileHandle.isSameEntry(n).then((n=>{if(n){const n=t.getSelectedTrackItem(),i={uid:n.dataset.uid};r&&(i.fileHandle=e.fileHandle),t.saveTrack(i).then((function(){var o;r&&(t.availableTracks=null,n.querySelector("input").value===(null===(o=e.oldFileHandle)||void 0===o?void 0:o.name)&&t.editTrackName(i.uid,i.fileHandle.name))}))}}))})),e.on(a.Z.event.FEATUREREMOVE,(function(e){e.layer===t.trackLayer&&x(e.feature)&&t.updateEndMarkers()})),t.notificationConfig=Object.assign(t.options.notification||{},{tag:"Geolocation Track",vibrate:[200],renotify:!0,requireInteraction:!0,body:t.getLocaleString("geo.trk.notification.body")},{title:t.options.notification&&t.options.notification.title?t.getLocaleString(t.options.notification.title):document.title}),t.gpsLayer=await r,t.geotrackingLayer=await n,t.trackLayer=await i,t.endPointLayer=await s;const l=t.map.layers.indexOf(t.trackLayer);return t.map.insertLayer(t.gpsLayer,l),t}async loadTemplates(){const e=this,t=r.e(2208).then(r.bind(r,2208)),n=r.e(4848).then(r.bind(r,4848)),i=r.e(2710).then(r.bind(r,2710)),o=r.e(8638).then(r.bind(r,8638)),a=r.e(9179).then(r.bind(r,9179)),s=r.e(6952).then(r.bind(r,6952)),l=r.e(1835).then(r.bind(r,1835)),c={};c[e.CLASS]=(await t).default,c[e.CLASS+"-track-node"]=(await n).default,c[e.CLASS+"-track-snapping-node"]=(await i).default,c[e.CLASS+"-dialog"]=(await o).default,c[e.CLASS+"-tracking-toast"]=(await a).default,c[e.CLASS+"-ext-dldlog"]=(await s).default,c[e.CLASS+"-share-dialog"]=(await l).default,e.template=c}async render(e){const t=this;C(t,k).innerHTML=await t.getRenderedHtml(t.CLASS+"-dialog",null),await t.getDownloadDialog(),t._downloadDialog.caller=t;const r=document.createElement("template");return r.innerHTML=await t.getRenderedHtml(t.CLASS+"-ext-dldlog",{controlId:t.id}),t._downloadDialogExtNode=r.content?r.content.firstChild:r.firstChild,C(t,F).innerHTML=await t.getRenderedHtml(t.CLASS+"-share-dialog",{}),await t._set1stRenderPromise(t.renderData({controlId:t.id},(function(){t.div.querySelector(t.const.selector.DELETEALL).addEventListener("click",(function(e){t.removeAllTracks(e.target),e.stopPropagation()})),c.Z.isFunction(e)&&e()})))}async getElevationControl(){const e=this;if(!e.elevationControl){let t={};!e.options.displayElevation&&e.options.displayOn?t.displayOn=e.options.displayOn:e.options.displayElevation&&(t=e.options.displayElevation),Object.prototype.hasOwnProperty.call(e.options,"resolution")?t.resolution=e.options.resolution:t.resolution=0,e.elevationControl=await e.map.addControl("elevation",t),e.elevationControl._decorateChartPanel=function(){this.resultsPanel.setCurrentFeature=function(t){const r=this;r.currentFeature=e.trackLayer.features.find((e=>!(e instanceof y.Z||e instanceof g.Z)));const n=e.getSelectedTrackItem();n&&r.currentFeature&&(r.currentFeature.uid=n.dataset.uid,r.currentFeature.fileName=C(e,$).call(e,n))}}}return e.elevationControl}importTrack(e){const t=this;if(t.isDisabled)/.gpx$/g.test(e.fileName.toLowerCase())&&t.map.toast(t.getLocaleString("geo.trk.import.disabled"),{type:a.Z.msgType.WARNING});else if(e.fileName&&e.features&&e.features.length>0){const i=t.getLoadingIndicator().addWait();t.importedFileName=e.fileName;const o=[];for(var r=0,n=e.features.length;r<n;r++)o.push(t.trackLayer.addFeature(e.features[r]));Promise.all(o).then((function(){t.wrap.processImportedFeatures({wait:i,notReproject:e.notReproject,fileHandle:e.fileHandle}),t.trackLayer&&(t.highlight(),e.fileHandle&&(t.trackLayer._fileHandle=e.fileHandle),t.div.querySelector(`sitna-tab[for="${t.id}-tracks-panel"]`).selected=!0,e.isShared||t.map.trigger(a.Z.event.TOOLSOPEN))}))}}getDownloadDialogOptions(e){const t=this,r={title:t.getLocaleString("download"),fileName:e,openCallback:function(){b(t,te,Me).call(t,t,!0)}};return t.options.displayElevation?r.elevation={resolution:t.options.displayElevation&&t.options.displayElevation.resolution||t.map.options.elevation&&t.map.options.elevation.resolution||20,sampleNumber:t.options.displayElevation&&t.options.displayElevation.sampleNumber||t.map.options.elevation&&t.map.options.elevation.sampleNumber||0,checked:!0}:r.elevation={checked:!0},r}renderData(e,t){const r=this,n=r.const.selector;return super.renderData(e,(function(){r.track={activateButton:r.div.querySelector(`.${r.CLASS}-track-ui-activate`),deactivateButton:r.div.querySelector(`.${r.CLASS}-track-ui-deactivate`),trackSearch:r.div.querySelector(`.${r.CLASS}-track-available-srch`),trackImportFile:r.div.querySelector(`.${r.CLASS}-track-import`),trackSave:r.div.querySelector(`.${r.CLASS}-track-save`),trackAdd:r.div.querySelector(`.${r.CLASS}-track-add-wpt`),trackContinue:C(r,k).querySelector(`.${r.CLASS}-track-continue`),trackRenew:C(r,k).querySelector(`.${r.CLASS}-track-new`),trackClose:C(r,k).querySelector(`.${r.CLASS}-continue-track-dialog button.tc-modal-close`),trackAdvertisementOK:C(r,k).querySelector(`.${r.CLASS}-track-advert-ok`)},r.track.trackList=r.div.querySelector(`.${r.CLASS}-track-available-lst`),r.track.trackToolPanelOpened=r.div.querySelector(`.${r.CLASS}-track-panel-block input[type="checkbox"]`),r.div.querySelector("."+r.CLASS+"-track-panel-help").addEventListener("click",(function(){C(r,re).call(r)})),r.track.trackName=r.div.querySelector(`.${r.CLASS}-track-title`),r.track.trackWPT=r.div.querySelector(`.${r.CLASS}-track-waypoint`),c.Z.detectMobile()&&matchMedia("screen and (max-height: 50em) and (max-width: 50em)").matches&&(r.track.trackToolPanelOpened.checked=!1),window.File&&window.FileReader&&window.FileList&&window.Blob?(r.track.trackImportFile.disabled=!1,r.track.trackImportFile.addEventListener(a.Z.event.CLICK,(async function(e){if(c.Z.isFunction(window.showOpenFilePicker)){let t;e.preventDefault();try{t=await window.showOpenFilePicker({types:r.const.supportedFileExtensions.map((e=>{const t={accept:{}};return t.accept[a.Z.mimeType[e.substr(1).toUpperCase()]]=[e],t}))})}catch(e){if(e instanceof DOMException&&window.parent!==window){let e=r.getLocaleString("cannotOpenFileIfEmbedded");r.map.toast(e,{type:a.Z.msgType.WARNING})}else if("AbortError"!==e.name)throw e}t&&r.loadFile(t[0],{control:r})}const t=this,n=document.createElement("form"),i=t.parentElement;i.insertBefore(n,t),n.appendChild(t),n.insertAdjacentElement("afterend",t),i.removeChild(n)})),r.track.trackImportFile.addEventListener("change",(function(e){r.loadFile(e.target.files[0])}))):console.log("no es posible la importacin"),r.track.activateButton.addEventListener("click",(function(){r.activateGeotracking()})),r.track.deactivateButton.addEventListener("click",(function(){r.deactivateGeotracking()}));const e=function(){!function(e){e=e.toLowerCase();const t=Array.from(r.track.trackList.querySelectorAll("li"));t.forEach((function(e){e.style.display="none"}));const n=t.filter((function(e){return e.matches("li:not([class]),li."+a.Z.classes.CHECKED)})),i=r.div.querySelector(`.${r.CLASS}-track-search-icon`);if(0===e.length)n.forEach((function(e){e.style.display=""})),i.style.visibility="visible";else{i.style.visibility="hidden";var o=new RegExp(e,"i");n.forEach((function(e){e.style.display=o.test(e.querySelector(r.const.selector.ACTIVATOR).text)?"":"none"})),n.some((function(e){return""===e.style.display}))||t.forEach((function(e){e.matches('[class^="tc-ctl-geolocation-track-not"]')&&(e.style.display="")}))}}(this.value.toLowerCase().trim())};r.track.trackSearch.addEventListener("keyup",e),r.track.trackSearch.addEventListener("search",e),r.track.trackSave.addEventListener("click",r.saveTrack.bind(r)),r.track.trackAdd.addEventListener("click",r.addWaypoint.bind(r));const s=r.div.querySelector(`.${r.CLASS}-track-available-lst`),l=function(e,t){"LI"!==t.tagName&&(t=t.parentElement.parentElement);const i=t.querySelector("input"),o=t.querySelector(r.const.selector.ACTIVATOR);e?(i.classList.remove(a.Z.classes.HIDDEN),i.focus(),i.value=o.text,o.classList.add(a.Z.classes.HIDDEN),t.dataset.title=t.title,t.title="",t.querySelector(n.EDIT).classList.add(a.Z.classes.HIDDEN),t.querySelector(n.DELETE).classList.add(a.Z.classes.HIDDEN),t.querySelector(n.ACTIVATOR).classList.add(a.Z.classes.HIDDEN),t.querySelector(n.EXPORT).classList.add(a.Z.classes.HIDDEN),t.querySelector(n.SHARE).classList.add(a.Z.classes.HIDDEN),t.querySelector(n.SAVE).classList.remove(a.Z.classes.HIDDEN),t.querySelector(n.CANCEL).classList.remove(a.Z.classes.HIDDEN)):(i.classList.add(a.Z.classes.HIDDEN),o.classList.remove(a.Z.classes.HIDDEN),t.title=t.dataset.title,delete t.dataset.title,t.querySelector(n.EDIT).classList.remove(a.Z.classes.HIDDEN),t.querySelector(n.DELETE).classList.remove(a.Z.classes.HIDDEN),t.querySelector(n.ACTIVATOR).classList.remove(a.Z.classes.HIDDEN),t.querySelector(n.EXPORT).classList.remove(a.Z.classes.HIDDEN),t.querySelector(n.SHARE).classList.remove(a.Z.classes.HIDDEN),t.querySelector(n.SAVE).classList.add(a.Z.classes.HIDDEN),t.querySelector(n.CANCEL).classList.add(a.Z.classes.HIDDEN))};r.uiSimulate=function(e,t){if(t){const e=("LI"===t.tagName?t:t.parentNode).querySelector(n.PAUSE);e.classList.add(r.const.className.PLAY),e.setAttribute("title",r.getLocaleString("tr.lst.start")),r.simulationStopped=!0}},s.addEventListener("click",o.Z.EventTarget.listenerBySelector(n.ACTIVATOR,(function(e){var t=r.getLoadingIndicator().addWait();p(r,e.target).then((function(){r.getLoadingIndicator().removeWait(t)}))}))),r.on(r.const.event.IMPORTEDTRACK,(function(e){if(r.isDisabled)r.map.toast(r.getLocaleString("geo.trk.import.disabled"),{type:a.Z.msgType.WARNING});else{const t=r.track.trackList.querySelector('li[data-id="'+e.index+'"]');p(r,t.querySelector(n.ACTIVATOR)).then((function(){r.loadingState&&(delete r.loadingState,delete r.toShare)}));const i=function(n){HTMLElement.prototype.scrollIntoView?t.scrollIntoView({behavior:"smooth",block:"end"}):r.track.trackList.scrollTop=e.index*t.offsetHeight,t.removeEventListener("transitionend",i,!1)};t.addEventListener("transitionend",i,!1)}}));const u=function(e,t){e.track.trackList.querySelectorAll("li[data-id]").forEach((function(r){if(r.dataset.id!==t){const t=r.querySelector(n.PAUSE);e.simulationStopped=!0,t.classList.add(e.const.className.PLAY),t.setAttribute("title",e.getLocaleString("tr.lst.start")),l(!1,r)}}))},p=function(e,t){return new Promise((function(r,n){const i=t.parentElement.parentElement;setTimeout((function(){i.classList.contains(a.Z.classes.CHECKED)?(e.clear(e.const.layer.TRACK),t.removeAttribute("title")):e.getSelectedTrackItem()?(u(e,i.dataset.id),e.working=e.drawTrack(i)):e.working=e.drawTrack(i),i.classList.contains(a.Z.classes.CHECKED)?b(e,Q,Ie).call(e,{uid:i.dataset.uid,setFeaturesToShare:!0}).then((function(){r()})):r()}),0)}))},h=function(e){let t=e;for(;"LI"!==t.tagName;)t=t.parentElement;return t};s.addEventListener("click",o.Z.EventTarget.listenerBySelector(`.${r.CLASS} ${n.EDIT}`,(function(e){l(!0,e.target)}))),s.addEventListener("click",o.Z.EventTarget.listenerBySelector(`.${r.CLASS} ${n.DELETE}`,(function(e){r.removeTrack(h(e.target)).then((function(e){e&&!r.availableTracks.length&&(r.div.querySelector(r.const.selector.DELETEALL).disabled=!0)}))}))),s.addEventListener("click",o.Z.EventTarget.listenerBySelector(`.${r.CLASS} ${n.SAVE}`,(function(e){const t=h(e.target);0===t.querySelector("input").value.trim().length?o.Z.alert(r.getLocaleString("geo.trk.edit.alert")):(r.editTrackName(t.dataset.uid,t.querySelector("input").value),l(!1,e.target))}))),s.addEventListener("click",o.Z.EventTarget.listenerBySelector(`.${r.CLASS} ${n.CANCEL}`,(function(e){l(!1,e.target)}))),s.addEventListener("click",o.Z.EventTarget.listenerBySelector(`.${r.CLASS} ${n.SHARE}`,(function(e){b(r,ae,Ze).call(r,h(e.target)).then((function(){r.showShareDialog(C(r,F))}))}))),s.addEventListener("click",o.Z.EventTarget.listenerBySelector(`.${r.CLASS} ${n.EXPORT}`,(function(e){const t=h(e.target);e.target.setAttribute("disabled",""),r.export(t).then((n=>{r.getDownloadDialog().then((function(i){const o=r.getDownloadDialogOptions(C(r,$).call(r,t));i.open(n.map((e=>(e.uid=t.dataset.uid,e))),o),e.target.removeAttribute("disabled")}))}))}))),s.addEventListener("click",o.Z.EventTarget.listenerBySelector(`.${r.CLASS} ${n.STOP}`,(function(e){r.wrap.simulateTrackEnd();const t=e.target.parentElement.querySelector(n.PAUSE);t.classList.add(r.const.className.PLAY),t.setAttribute("title",r.getLocaleString("tr.lst.start")),r.simulationStopped||(e.target.parentElement.querySelector(n.SPEED).textContent="x 1"),r.simulationSpeed=1,r.simulationStopped=!0}))),s.addEventListener("click",o.Z.EventTarget.listenerBySelector(`.${r.CLASS} ${n.PAUSE}`,(function(e){if(r.simulate_paused=!e.target.classList.contains(r.const.className.PLAY),r.simulate_paused)r.simulate_pausedElapse=-1;else if(r.simulationStopped){var t=r.getLoadingIndicator().addWait();e.target.parentElement.querySelector(n.SPEED).textContent="x 1",function(e,t){return new Promise((function(r,n){setTimeout((function(){const n=t.closest("li"),i=e.getSelectedTrackItem();u(e,n.dataset.id),i&&n.dataset.id!==i.dataset.id&&e.clear(e.const.layer.TRACK),e.simulate_paused=!1,e.simulateTrack(n),r()}),0)}))}(r,e.target).then((function(){r.getLoadingIndicator().removeWait(t),r.simulationStopped=!1}))}e.target.setAttribute("title",r.getLocaleString(r.simulate_paused?"tr.lst.play":"tr.lst.pause")),e.target.classList.toggle(r.const.className.PLAY,!!r.simulate_paused)})));s.addEventListener("click",o.Z.EventTarget.listenerBySelector(`.${r.CLASS} ${n.BACKWARD}`,(function(e){1===r.simulationSpeed?r.simulationSpeed=.5:r.simulationSpeed=r.simulationSpeed/2,e.target.parentElement.querySelector(`.${r.CLASS} ${n.FORWARD}`).disabled=!1,e.target.parentElement.querySelector(n.SPEED).textContent=r.simulationSpeed<1?"/ "+1/r.simulationSpeed:"x "+r.simulationSpeed,.000244140625===r.simulationSpeed&&(e.target.disabled=!0)}))),s.addEventListener("click",o.Z.EventTarget.listenerBySelector(`.${r.CLASS} ${n.FORWARD}`,(function(e){r.simulationSpeed=r.simulationSpeed/.5,e.target.parentElement.querySelector(n.SPEED).textContent=r.simulationSpeed<1?"/ "+1/r.simulationSpeed:"x "+r.simulationSpeed,e.target.parentElement.querySelector(`.${r.CLASS} ${n.BACKWARD}`).disabled=!1,4096===r.simulationSpeed&&(e.target.disabled=!0)}))),r.track.trackContinue.addEventListener("click",(function(){c.Z.closeModal(),r.setGeotracking()})),r.track.trackRenew.addEventListener("click",(function(){delete r.geotrackingSession,c.Z.storage.setSessionLocalValue(r.const.localStorageKey.GEOTRACKINGTEMP,void 0),i().removeItem(r.const.localStorageKey.GEOTRACKINGTEMP).catch((e=>console.warn(e))),c.Z.closeModal(),r.setGeotracking()})),r.track.trackClose.addEventListener("click",(function(){b(r,ie,Ne).call(r)})),r.track.trackAdvertisementOK.addEventListener("click",(function(){const e=document.body.querySelectorAll('input[name*="Advertisement"]:checked');e.length>0&&i().setItem(e[0].getAttribute("name"),!1).catch((e=>console.warn(e))),c.Z.closeModal()})),r.track.renderTrack=r.div.querySelector("#tc-ctl-geolocation-track-render-"+r.id),r.track.renderTrack.addEventListener("change",(function(){r.track.activateButton.classList.contains(a.Z.classes.HIDDEN)&&r.geotrackingLayer.setVisibility(this.checked),L(r,G,this.checked)})),b(r,Ee,$e).call(r),c.Z.isFunction(t)&&t()}))}activate(){}deactivate(){c.Z.closeModal(),this.clearSelection(),this.deactivateGeotracking()}getTrackInfoPanel(){const e=this;return e.track._infoPanelPromise||(e.track._infoPanelPromise=new Promise((function(t,r){if(e.track.infoPanel)t(e.track.infoPanel);else{const r={content:"table",resize:!1,titles:{main:e.getLocaleString("geo.mylocation"),max:e.getLocaleString("geo.mylocation.show")},classes:{collapsed:"tc-tracking"}};let n;const i=function(e){r.position=e.POSITION.RIGHT,n=e.addControl("resultsPanel",r)};let o;if(!e.options.displayElevation&&e.options.displayOn?o=e.options.displayOn:e.options.displayElevation&&(o=e.options.displayElevation.displayOn),o){const t=e.map.getControlsByClass("TC.control."+o[0].toUpperCase()+o.substring(1))[0];t?i(t):e.map.addControl(o).then(i)}else r.div=document.createElement("div"),e.map.div.appendChild(r.div),n=e.map.addControl("resultsPanel",r);n.then((function(r){e.track.infoPanel=r,t(r)}))}}))),e.track._infoPanelPromise}setFollowing(e){const t=this;if(L(t,j,e),t.trackCenterButton){const r=t.trackCenterButton.querySelector("button");r.classList.toggle(a.Z.classes.UNPLUGGED,!e),r.title=t.getLocaleString(e?"geo.trk.notCenter":"geo.trk.center")}!e&&t.trackCenterButton&&t.trackCenterButton.querySelector("button").classList.add(a.Z.classes.UNPLUGGED),e&&t.trackCenterButton&&t.trackCenterButton.querySelector("button").classList.remove(a.Z.classes.UNPLUGGED)}async moveTo(e){const t=this;e&&Array.isArray(e)&&e.length>0&&(I=!0,e[0]instanceof h.Z?await t.map.zoomToFeatures(e,{animate:!1}):await t.map.setCenter(e,{animate:!1}),setTimeout((function(){I=!1}),300))}setGeotracking(){const e=this;e.activate(),L(e,j,!0),b(e,ne,De).call(e),b(e,le,Fe).call(e),e.map.on(a.Z.event.ZOOM,R),e.on(e.const.event.POSITIONCHANGE,(function(t){e.currentPoint&&e.currentPoint.position[0]!==t.pd.position[0]&&e.currentPoint.position[1]!==t.pd.position[1]&&C(e,j)&&e.moveTo(t.pd.position),e.currentPoint=t.pd,e.renderInfoNewPosition(t),e.track.trackName.disabled=!1,e.track.trackSave.disabled=!1,e.track.trackWPT.disabled=!1,e.track.trackAdd.disabled=!1,c.Z.storage.setSessionLocalValue(e.const.localStorageKey.GEOTRACKINGTEMP,e.wrap.formattedToStorage(e.geotrackingLayer).features)})),e.on(e.const.event.STATEUPDATED,(function(e){})),e.clear(e.const.layer.GEOTRACKING),b(e,we,Ke).call(e,e.const.localStorageKey.GEOTRACKINGSHOWADVERTISEMENT),e.wrap.setGeotracking(!0)}activateGeotracking(){const e=this;b(e,ne,De).call(e);var t=!0;e.isActive||e.activate(),e.clear(e.const.layer.GEOTRACKING);try{c.Z.storage.setSessionLocalValue(e.const.localStorageKey.TEST,e.const.localStorageKey.TEST)}catch(r){r.code===DOMException.QUOTA_EXCEEDED_ERR?o.Z.alert(e.getLocaleString("geo.error.trackinglocalstorage")):o.Z.error(r),t=!1}if(t){if(window.Notification||window.webkitNotifications){const e=window.Notification||window.webkitNotifications;"denied"===e.permission?N=null:"granted"===e.permission?N=e:e.requestPermission((function(t){"granted"===t&&(N=e)}))}if(b(e,ce,Ue).call(e),b(e,ye,Ve).call(e),e.geotrackingSession=c.Z.storage.getSessionLocalValue(e.const.localStorageKey.GEOTRACKINGTEMP),e.geotrackingSession)b(e,Se,Xe).call(e,(function(){b(e,ie,Ne).call(e)}))||e.track.trackRenew.click();else e.setGeotracking()}else b(e,ie,Ne).call(e)}deactivateGeotracking(){const e=this,t=function(){return e.getTrackInfoPanel().then((e=>e.close())),b(e,ve,ze).call(e),e.wrap.setGeotracking(!1),delete e.geotrackingPosition,C(e,G)||e.div.querySelector(`.${e.CLASS}-track-render`).querySelector("label").click(),b(e,ue,Be).call(e),C(e,me).call(e),e.off(e.const.event.POSITIONCHANGE),e.off(e.const.event.STATEUPDATED),b(e,ie,Ne).call(e),e.track.trackName.value="",e.track.trackName.disabled=!0,e.track.trackSave.disabled=!0,e.track.trackWPT.value="",e.track.trackWPT.disabled=!0,e.track.trackAdd.disabled=!0,e.clear(e.const.layer.GEOTRACKING),e.clear(e.const.layer.GPS),e.map.off(a.Z.event.ZOOM,R),!0};return e.wrap.hasCoordinates()?(e.map.toast(e.getLocaleString("geo.trk.deactivate.alert"),{duration:1e4}),t()):t()}async getStoredTracks(){var e;const t=this;let r=[];const n=function(e){return 0===C(t,z).size&&e.filter((e=>e.profile)).forEach((e=>C(t,z).set(e.uid,JSON.parse(e.profile)))),e};let a;try{a=await i().keys()}catch(e){console.log("Capturamos error que se produce por configuracin del navegador."),o.Z.error(t.getLocaleString("couldNotAccessLocalStorage"))}if(a=null===(e=a)||void 0===e?void 0:e.filter((function(e){return 0!==e.indexOf(t.const.localStorageKey.GEOTRACKINGTEMP)&&0===e.indexOf(t.const.localStorageKey.GEOTRACKING)&&/trk#\d/i.exec(e)})),!a||0===a.length)return t.availableTracks=r,n(r);const s=new Array(a.length);a.forEach((function(e,t){s[t]=i().getItem(e)}));const l=await Promise.all(s);if(l&&l.length){l.forEach((function(e){"string"==typeof e&&(e=JSON.parse(e)),e instanceof Array?r=r.concat(e):r.push(e)}));const e=r.length>1?Z(r):r;return t.availableTracks=e,n(e)}}async setStoredTracks(e){const t=this,r=[];e.forEach((function(e){r.push(i().setItem(t.const.localStorageKey.GEOTRACKING+"#"+e.uid,e).catch((e=>{console.warn(e)})))})),await Promise.all(r),await t.getStoredTracks(),b(t,Ee,$e).call(t)}async getAvailableTracks(){const e=this;return e.availableTracks?e.availableTracks:await e.getStoredTracks()}clearChartProgress(){this.getElevationControl().then((e=>e&&e.removeElevationTooltip()))}setSecondaryElevationProfileCoordinates(e){var t,r;const n=null===(t=this.elevationChartData)||void 0===t||null===(r=t.secondaryElevationProfileChartData)||void 0===r?void 0:r[0];if(null!=n&&n.ele&&(null==n||!n.eleCoordinates)){let t=-2,r=e;do{t++,r=r[0]}while(Array.isArray(r));n.eleCoordinates=e.flat(t).map(((e,t)=>[e[0],e[1],n.ele[t]]))}}getTimeInterval(e,t){let r=t-e;const n={};var i=Math.floor(r/1e3/60/60/24);r-=1e3*i*60*60*24;var o=Math.floor(r/1e3/60/60);r-=1e3*o*60*60,n.h=o+24*i;var a=Math.floor(r/1e3/60);return r-=1e3*a*60,n.m=a,n.s=Math.floor(r/1e3),c.Z.extend({},n,{toString:("00000"+n.h).slice(-2)+":"+("00000"+n.m).slice(-2)+":"+("00000"+n.s).slice(-2)})}async simulateTrack(e){const t=this,r=await t.getElevationControl();r.removeElevationTooltip(),t.simulationSpeed=1,t.getSelectedTrackItem()===e&&r.resultsPanel&&r.resultsPanel.chart&&r.resultsPanel.chart.chart?(t.hasElevation||(t.hasElevation=0!==r.elevationProfileChartData.min||0!==r.elevationProfileChartData.max),t.wrap.simulateTrack()):t.drawTrack(e,!1).then((function(){t.elevationChartData&&0===t.elevationChartData.min&&0===t.elevationChartData.max?(t.map.toast(t.getLocaleString("geo.trk.simulate.empty"),{duration:1e4}),t.hasElevation=!1):0===t.elevationChartData.min&&0===t.elevationChartData.max||(t.hasElevation=!0),t.wrap.simulateTrack()}))}async drawTrack(e,t){const r=this;r.clear(r.const.layer.TRACK),b(r,le,Fe).call(r),r.setSelectedTrack(e),await r.drawTrackData(e),await r.displayTrackProfile(e),r.activate()}async displayTrackProfile(e,t){const r=this;if(null!=t&&t.resized)return void r.wrap.simulateTrackEnd(t.resized);C(r,V)||(L(r,V,r.displayTrackProfile.bind(r,e,{resize:!0})),window.addEventListener("resize",C(r,V),!1));const n=await r.getElevationControl();var i;if(!n)throw Error("No elevation control");{let s;if(null!=t&&t.forceRefresh?b(r,Le,et).call(r,e.dataset.uid):s=b(r,be,Je).call(r,e.dataset.uid),s){r.options.displayElevation||delete s.secondaryElevationProfileChartData[0],r.elevationChartData=s;const e=await n.getProfilePanel();await e.renderPromise(),e.doVisible(),n.renderElevationProfile(r.elevationChartData),e.setCurrentFeature()}else{var o;const s=await r.getTrackData(e);if(null===(o=r.trackLayer)||void 0===o||!o.features)throw Error("No features available");{const o=s.layout===ol.geom.GeometryLayout.XYZM||s.layout===ol.geom.GeometryLayout.XYM,l=o||r.options.displayElevation;let c=r.trackLayer.features.filter((e=>l&&x(e))),u=(null==t?void 0:t.feature)||c[0];if(!u)throw Error("No features have compatible geometry layout");{let t={};if(o){let e=0;const r=P(u),n=A(i=u)?i.geometry[0][i.geometry[0].length-1]:i.geometry[i.geometry.length-1];e=s.layout===ol.geom.GeometryLayout.XYZM?n[3]-r[3]:n[2]-r[2],t={s:Math.floor(e/1e3%60),m:Math.floor(e/6e4%60),h:Math.floor(e/36e5%24)}}let l={originalElevation:!0,onlyOriginalElevation:!r.options.displayElevation,ignoreCaching:!0,time:t,callback:function(){r.elevationChartData=n.elevationProfileChartData,r.hasElevation=0!==n.elevationProfileChartData.min||0!==n.elevationProfileChartData.max,b(r,Ce,Qe).call(r,n.elevationProfileChartData,e.dataset.uid),r.resultsPanelChart.div.addEventListener("mouseover",(function(e){r.trackLayer&&r.trackLayer.getVisibility()&&r.trackLayer.getOpacity()>0&&r.wrap.activateSnapping.call(r.wrap)})),r.resultsPanelChart.div.addEventListener("mouseout",(function(e){r.trackLayer&&!r.trackLayer.getVisibility()&&0==r.trackLayer.getOpacity()&&r.wrap.deactivateSnapping.call(r.wrap)})),r.map.on(a.Z.event.RESULTSPANELMIN,(function(){r.clearChartProgress()})).on(a.Z.event.RESULTSPANELCLOSE,(function(){r.clearChartProgress()})),n.getProfilePanel().then((function(e){let t=r.getSelectedTrackItem();t&&(e.currentFeature.fileName=C(r,$).call(r,t))}))}};n.displayElevationProfile(u,l)}}}}}clear(e){const t=this;C(t,V)&&(window.removeEventListener("resize",C(t,V),!1),L(t,V,void 0)),e===t.const.layer.TRACK?(t.trackLayer.clearFeatures(),t.endPointLayer.clearFeatures(),L(t,K,null),L(t,X,null),delete t.trackLayer._fileHandle,t.getElevationControl().then((e=>e&&e.closeElevationProfile())),delete t.elevationChartData,t.wrap.simulateTrackEnd(),t.wrap.clear(),t.track.trackList.querySelectorAll("li").forEach((function(e){e.classList.remove(a.Z.classes.CHECKED)})),t.map.trigger(t.const.event.CLEARTRACK),t.featuresToShare=[],t.loadingState||delete t.toShare):(t.geotrackingLayer.clearFeatures(),t.gpsLayer.clearFeatures())}loadFile(e){const t=this;return t._cleaning||(t.clear(t.const.layer.TRACK),t.map&&(t.map.on(a.Z.event.LAYERERROR,b(t,xe,rt)),t.map.wrap.loadFiles([e],{control:t}))),t}async saveTrack(e){const t=this;let r=e.message||t.getLocaleString("geo.trk.save.alert");const n=async function(n){let i;i=t.getLoadingIndicator().addWait();let s,l=e.importedFileName||t.track.trackName.value.trim(),u=await t.getAvailableTracks(),p=t.wrap.formattedToStorage(n,!0,e.notReproject),h=function(e){t.track.trackName.value="",t.track.trackName.disabled=!0,t.track.trackSave.disabled=!0,t.track.trackWPT.value="",t.track.trackWPT.disabled=!0,t.track.trackAdd.disabled=!0,t.getLoadingIndicator().removeWait(e),b(t,le,Fe).call(t)},d=!1;if(e.uid)s=u.find((t=>t.uid==e.uid));else if(e.fileHandle)for(var f=0,g=u.length;f<g;f++){if(await e.fileHandle.isSameEntry(u[f].fileHandle)){s=u[f];break}}s||(d=!0,s={name:l,layout:p.layout,crs:t.storageCrs}),s.data=p.features,e.fileHandle&&(s.fileHandle=e.fileHandle);const y=function(e){let t=JSON.parse(JSON.stringify(e));return t.data=t.data.replace(/(\"id\"\s?\:\s?\"[a-z0-9]+\")/gi,'""'),v()(JSON.stringify(t))},m=new ol.format.GeoJSON;let _,w=y(s);d&&(_=u.map((function(e){let t=JSON.parse(JSON.stringify(e));return delete t.uid,delete t.profile,w===y(t)?e.uid:(t.data=function(e){let t=Math.pow(10,a.Z.DEGREE_PRECISION+1);return e.forEach((function(e){let r=c.Z.explodeGeometry(c.Z.compactGeometry(e.getGeometry().getCoordinates(),t));e.getGeometry().setCoordinates(r)})),m.writeFeatures(e)}(m.readFeatures(t.data)),w===v()(JSON.stringify(t))?e.uid:null)})).find((function(e){return null!==e})));const S=async function(e){let r;await t.getStoredTracks(),await b(t,Ee,$e).call(t);for(var n=0;n<t.availableTracks.length;n++)if(t.availableTracks[n].uid===e){r=n;break}return r};if(_){console.log("Ya existe un track con ese mismo hash"),h(i);return await S(_)}d&&(s.uid=e.uid||Date.now()+Math.random(),u.push(s)),u=Z(u);try{await t.setStoredTracks(u),t.map.toast(r,{duration:3e3}),h(i);return await S(s.uid)}catch(e){throw o.Z.alert(t.getLocaleString("geo.error.savelocalstorage")+": "+e.message),h(i),e}};return t.importedFileName||e.uid?await n(t.trackLayer):0===t.track.trackName.value.trim().length?(t.track.trackName.value=(new Date).toLocaleString(),await n(t.geotrackingLayer)):await n(t.geotrackingLayer)}addWaypoint(){const e=this;let t=e.track.trackWPT.value.trim();t||(t=(new Date).toLocaleString());const r=e.getLoadingIndicator().addWait();b(e,le,Fe).call(e),e.wrap.addWaypoint(e.currentPoint.position,{name:t,ele:e.currentPoint.heading,time:(new Date).getTime()}),e.track.trackWPT.value="",e.track.trackWPT.disabled=!0,e.track.trackAdd.disabled=!0,c.Z.storage.setSessionLocalValue(e.const.localStorageKey.GEOTRACKINGTEMP,e.wrap.formattedToStorage(e.geotrackingLayer).features),e.getLoadingIndicator().removeWait(r)}async editTrackName(e,t){const r=this,n=await r.getAvailableTracks();if(n){const i=n.find((t=>t.uid==e));i&&(i.name=t,await r.setStoredTracks(n))}}clearSelectedTrack(){const e=this,t=e.getSelectedTrackItem();t&&(C(e,V)&&(window.removeEventListener("resize",C(e,V),!1),L(e,V,void 0)),t.classList.remove(a.Z.classes.CHECKED),t.setAttribute("title",t.textContent),t.querySelector(e.const.selector.ACTIVATOR).removeAttribute("title"),delete e.toShare)}clearSelection(){self.wrap.deactivateSnapping(),self.getSelectedTrackItem()&&self.clearSelectedTrack(),self.resultsPanelChart&&(self.resultsPanelChart.div.removeEventListener("mouseover",self.resultsPanelChart.deactivateSnapping),self.resultsPanelChart.div.removeEventListener("mouseout",self.resultsPanelChart.activateSnapping),self.resultsPanelChart.close()),self.clear(self.const.layer.TRACK)}async drawTrackData(e){const t=this;t.wrap.clear();const r=await t.getTrackData(e);r&&r.data&&(await t.wrap.drawTrackData(r),t.updateEndMarkers(),r.fileHandle&&(t.trackLayer._fileHandle=r.fileHandle),t.trackLayer.setVisibility(!0))}async getTrackData(e){const t=this,r=await t.getAvailableTracks();if(r){const n=r[e.dataset.id];if(n){let e=n.data;return e=t.wrap.formattedFromStorage(e),{data:e,layout:n.layout,fileHandle:n.fileHandle}}}return null}async updateEndMarkers(){const e=this;var t=e.trackLayer.features;if(t&&t.length>0){t.forEach((e=>{e.showsPopup=e instanceof g.Z}));const r=t.find((function(e){return!!x(e)}));if(r){let t;t=A(r)?r.geometry.flat():r.geometry;const n=t[0],i=t[t.length-1];if(n&&n!==i){const t=n.slice().splice(0,2);C(e,K)?C(e,K).setCoordinates(t):L(e,K,await e.endPointLayer.addMarker(t,{showsPopup:!1,width:32,height:32,cssClass:e.CLASS+"-track-marker-icon-end",anchor:[.5,1],noExport:!0}))}if(i){const t=i.slice().splice(0,2);C(e,X)?C(e,X).setCoordinates(t):L(e,X,await e.endPointLayer.addMarker(t,{showsPopup:!1,width:32,height:32,cssClass:e.CLASS+"-track-marker-icon",anchor:[.5,1],noExport:!0}))}}else C(e,K)&&(e.endPointLayer.removeFeature(C(e,K)),L(e,K,null)),C(e,X)&&(e.endPointLayer.removeFeature(C(e,X)),L(e,X,null))}}export(e){return this.wrap.export(e)}clearFileInput(e){const t=document.createElement("form"),r=e.parentElement;r.insertBefore(t,e),t.appendChild(e),t.reset(),t.insertAdjacentElement("afterend",e),r.removeChild(t)}getLoadingIndicator(){const e=this;return e.loading||(e.loading=e.map.getControlsByClass(l.default),e.loading&&e.loading.length>0&&(e.loading=e.loading[0])),e.loading}onGeolocateError(e){const t=this;var r;switch(navigator.geolocation&&(t.currentPosition&&navigator.geolocation.clearWatch(t.currentPosition),t.currentPositionTrk&&(t.currentPositionTrk=t.currentPositionTrk instanceof Array?t.currentPositionTrk:[t.currentPositionTrk],t.currentPositionTrk.forEach((function(e){navigator.geolocation.clearWatch(e)})),t.currentPositionTrk=[])),t.currentPositionWaiting&&t.getLoadingIndicator().removeWait(t.currentPositionWaiting),e.code){case e.PERMISSION_DENIED:r=t.getLocaleString("geo.error.permission_denied");break;case e.POSITION_UNAVAILABLE:r=t.getLocaleString("geo.error.position_unavailable");break;case e.TIMEOUT:r=t.getLocaleString("geo.error.timeout");break;default:r=t.getLocaleString("geo.error.default")}t.map.toast(r,{type:a.Z.msgType.WARNING}),!t.geotrackingPosition&&t.track&&(t.track.activateButton.classList.remove(a.Z.classes.HIDDEN),t.track.deactivateButton.classList.add(a.Z.classes.HIDDEN))}exportState(){const e=this;if(e.trackLayer&&e.track||e.toShare){let t={id:e.id};if(!e.toShare||e.toShare&&!e.toShare.doZoom){e.toShare={doZoom:!1};let r=Object.assign({},e.toShare),n=e.trackLayer.features;if(n.length>0&&e.featuresToShare&&e.featuresToShare.length>0)r.features=e.featuresToShare;else{const t=e.trackLayer.exportState({features:n});r.features=t.features}const i=e.getSelectedTrackItem();i&&(r.trackName=i.querySelector(e.const.selector.ACTIVATOR).text),t.trackResult=JSON.stringify(r)}else t.trackResult=JSON.stringify(e.toShare);return t}return null}importState(e){const t=this;if(t.map&&e.trackResult&&e.trackResult.length){t.enable();let r=JSON.parse(e.trackResult);if(r.features&&r.features.length>0){const e=new Array(r.features.length);r.features.forEach((function(t,r){const n={data:t.data,id:t.id,showsPopup:t.showsPopup};var i=t.geom;switch(t.type){case a.Z.geom.POLYLINE:e[r]=new d.Z(i,n);break;case a.Z.geom.MULTIPOLYLINE:e[r]=new f.Z(i,n);break;case a.Z.geom.MARKER:e[r]=new y.Z(i,n);break;case a.Z.geom.POINT:e[r]=new g.Z(i,n)}})),Object.prototype.hasOwnProperty.call(r,"doZoom")&&(t.loadingState=!0,t.toShare={doZoom:r.doZoom}),Promise.all(e).then((function(e){var n={features:e,fileName:r.trackName,notReproject:!0,isShared:!0};t.availableTracks?t.importTrack(n):t.getStoredTracks().then((function(){t.importTrack(n)}))}))}}}}async function Oe(e){const t=this;let r=b(t,Te,tt).call(t,e);if(r)return console.log("Tengo datos en cache"),r.data;{console.log("NO tengo datos en cache");const r=await t.getElevationTool();if(r){let n=e.clone();try{let i=await r.setGeometry({features:[n],crs:t.map.crs});return C(t,Ae).call(t,e,i[0]),i[0]}catch(e){return null}}}}async function Ie(e){const t=this;let r=e.uid;if(r){const n=(await t.getAvailableTracks()).find((function(e){return e.uid.toString()===r.toString()})).data;let i=(new ol.format.GeoJSON).readFeatures(n).map((e=>o.Z.wrap.Feature.createFeature(e))).map((function(e){const t={};switch(!0){case e instanceof y.Z:t.type=a.Z.geom.MARKER;break;case e instanceof g.Z:t.type=a.Z.geom.POINT;break;case e instanceof d.Z:t.type=a.Z.geom.POLYLINE;break;case e instanceof f.Z:t.type=a.Z.geom.MULTIPOLYLINE}return t.id=e.id,t.geom=e.geometry,t.data=e.getData(),t}));return e.setFeaturesToShare&&(t.featuresToShare=i),i}throw Error("No track uid")}function Re(e){const t=this;return e instanceof Element||e instanceof HTMLDocument?e.classList.contains(t.CLASS+"-share-dialog")?u.default.onShowShareDialog.call(t):Promise.resolve():e===t?u.default.onShowShareDialog.call(t):void(e!==t&&e.toShare&&e.toShare.feature&&e.toShare.feature.layer===t.trackLayer&&c.Z.closeModal((function(){u.default.onCloseShareDialog.call(e);const r=t.getSelectedTrackItem();return r?b(t,ae,Ze).call(t,r).then((function(){const e=C(t,F).querySelector("."+t.CLASS+"-share-dialog");c.Z.showModal(e,{openCallback:function(){return u.default.onShowShareDialog.call(t)},closeCallback:function(){u.default.onCloseShareDialog.call(t)}})})):Promise.resolve()})))}function Me(e,t){const r=this,n=r._downloadDialog.getFeatures();if(e!==r&&r._downloadDialog.getFeatures().every((e=>e&&e.layer===r.trackLayer))){let e=r._downloadDialog.getOptions(),t=r.getDownloadDialogOptions();e.elevation=t.elevation,delete e.openCallback,r._downloadDialog.open(r._downloadDialog.getFeatures(),e)}if(1===n.length&&n.every((e=>e&&e.fileName))&&r._downloadDialog.setOptions({fileName:n[0].fileName}),r.options.displayElevation&&(e===r||r._downloadDialog.getFeatures().every((e=>e&&e.layer===r.trackLayer)))&&!r._downloadDialog.modalBody.querySelector("."+r.CLASS+"-ext-dldlog")){let e=r._downloadDialog.modalBody.querySelector("."+r._downloadDialog.CLASS+"-ext");if(e){e.appendChild(r._downloadDialogExtNode),L(r,B,r._downloadDialog.modalBody.querySelector("."+r._downloadDialog.CLASS+"-elev input[type='checkbox']")),L(r,U,r._downloadDialog.modalBody.querySelector("."+r._downloadDialog.CLASS+"-ip"));const i=r._downloadDialog.modalBody.querySelectorAll(`input[type=radio][name="${r.id}-dldlog-source"]`),o=function(e){const t=i[0];e?t.classList.contains(a.Z.classes.DISABLED)||t.classList.add(a.Z.classes.DISABLED):t.classList.remove(a.Z.classes.DISABLED)};let s=n.filter(x)[0];const l=P(s);let c=2===l.length;if(c)o(c);else if(l.length>2){o((A(s)?s.geometry.flat():s.geometry).map((e=>e[2])).every((e=>0===e)))}const u=function(){return C(r,U)&&C(r,U).classList.contains(a.Z.classes.HIDDEN)},p=function(){if(i[0].checked&&!u())C(r,U).classList.add(a.Z.classes.HIDDEN);else if(i[0].checked){let e=new MutationObserver((function(t){t.filter((e=>"class"===e.attributeName)).forEach((function(t){t.oldValue.indexOf(a.Z.classes.HIDDEN)>-1&&(i[0].checked?(C(r,U).classList.add(a.Z.classes.HIDDEN),e.disconnect()):e.disconnect())}))})),t={attributes:!0,attributeOldValue:!0};e.observe(C(r,U),t)}else u()&&C(r,B).checked&&C(r,U).classList.remove(a.Z.classes.HIDDEN)};if(C(r,B)&&(C(r,B).checked?(p(),r._downloadDialogExtNode.classList.remove(a.Z.classes.HIDDEN)):r._downloadDialogExtNode.classList.contains(a.Z.classes.HIDDEN)||r._downloadDialogExtNode.classList.add(a.Z.classes.HIDDEN),C(r,B).addEventListener("change",(function(){p(),r._downloadDialogExtNode.classList.toggle(a.Z.classes.HIDDEN)}))),i&&(p(),i.forEach((e=>{e.dataset.hasChangeEvent||(e.dataset.hasChangeEvent=!0,e.addEventListener("change",(async function(e){if(e.target.checked){let o;if(p(),"track"===e.target.value)o=n;else{let e=n,s=e.filter(x)[0];t&&(o=e.filter((e=>e instanceof g.Z)));let l=s.uid,c=b(r,be,Je).call(r,l);if(c){let e=s.clone();e.setCoords(c.secondaryElevationProfileChartData[0].coords),t?(o||(o=C(r,oe).call(r)||[]),o.push(e)):o=e}else{r._downloadDialog.modalBody.classList.add(a.Z.classes.LOADING);let e=await b(r,J,Oe).call(r,s);e?t?o.push(e):o=e:(r.map.toast(r.getLocaleString("elevation.error"),{type:a.Z.msgType.ERROR,duration:5e3}),i[0].checked=!0),r._downloadDialog.modalBody.classList.remove(a.Z.classes.LOADING)}}r._downloadDialog.setFeatures(o)}})))})),i[0].classList.contains(a.Z.classes.DISABLED)||"mdt"===document.querySelector("."+r.CLASS+"-ext-dldlog input[type=radio]:checked").value)){const e=i[1];e.checked=!0,e.dispatchEvent(new Event("change"))}1===n.length&&n[0].fileName&&r._downloadDialog.setOptions({fileName:n[0].fileName})}}}function De(){this.track.activateButton.classList.add(a.Z.classes.HIDDEN),this.track.deactivateButton.classList.remove(a.Z.classes.HIDDEN)}function Ne(){this.track.activateButton.classList.remove(a.Z.classes.HIDDEN),this.track.deactivateButton.classList.add(a.Z.classes.HIDDEN)}async function Ze(e){const t=this;await t.getShareDialog(C(t,F));const r=await b(t,Q,Ie).call(t,{uid:e.dataset.uid,setFeaturesToShare:!1});t.toShare={trackName:e.querySelector(t.const.selector.ACTIVATOR).text,features:r}}function ke(e){const t=this,r={},n=c.Z.getMapLocale(t.map);if(t.map.on3DView){var i=t.map.crs!==t.map.view3D.crs?c.Z.reproject(e.position,t.map.crs,t.map.view3D.crs):e.position;r.x=i[0].toLocaleString(n),r.y=i[1].toLocaleString(n),r.mdt=Math.round(t.map.view3D.getHeightFromMDT(i)).toLocaleString(n),r.isGeo=!0}else r.x=e.position[0].toLocaleString(n),r.y=e.position[1].toLocaleString(n);return r.z=Math.round(e.altitude).toLocaleString(n),r.accuracy=Math.round(e.accuracy).toLocaleString(n),r.speed=e.speed.toLocaleString(n,{minimumFractionDigits:1,maximumFractionDigits:1}),r}function Fe(){const e=this;e.track.trackToolPanelOpened.checked||e.map.trigger(a.Z.event.TOOLSCLOSE)}function Ue(){const e=this;if(M){(async()=>{try{D=await navigator.wakeLock.request("screen"),console.log("Wake Lock active"),D.addEventListener("release",(()=>{console.log("Wake Lock released")}))}catch(e){console.error(e)}})()}else b(e,pe,Ge).call(e)}function Be(){const e=this;M?D.release().then((()=>{D=null})):b(e,he,je).call(e)}function Ge(){const e=this;if(!e.videoScreenOn){var t={WebM:"data:video/webm;base64,GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA/vz0AAA=",MP4:"data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAAG21kYXQAAAGzABAHAAABthADAowdbb9/AAAC6W1vb3YAAABsbXZoZAAAAAB8JbCAfCWwgAAAA+gAAAAAAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIVdHJhawAAAFx0a2hkAAAAD3wlsIB8JbCAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAIAAAACAAAAAABsW1kaWEAAAAgbWRoZAAAAAB8JbCAfCWwgAAAA+gAAAAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAAVxtaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAEcc3RibAAAALhzdHNkAAAAAAAAAAEAAACobXA0dgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAIAAgASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAAFJlc2RzAAAAAANEAAEABDwgEQAAAAADDUAAAAAABS0AAAGwAQAAAbWJEwAAAQAAAAEgAMSNiB9FAEQBFGMAAAGyTGF2YzUyLjg3LjQGAQIAAAAYc3R0cwAAAAAAAAABAAAAAQAAAAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAAAEwAAAAEAAAAUc3RjbwAAAAAAAAABAAAALAAAAGB1ZHRhAAAAWG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAK2lsc3QAAAAjqXRvbwAAABtkYXRhAAAAAQAAAABMYXZmNTIuNzguMw=="};e.videoScreenOn=document.createElement("video"),e.videoScreenOn.setAttribute("loop",""),e.videoScreenOn.setAttribute("muted",""),e.videoScreenOn.setAttribute("webkit-playsinline",""),e.videoScreenOn.setAttribute("playsinline",""),e.videoScreenOn.setAttribute("style","transform: translateZ(0px);");var r=document.createElement("source");r.src=t.WebM,r.type="video/webm",e.videoScreenOn.appendChild(r);var n=document.createElement("source");n.src=t.MP4,n.type="video/mp4",e.videoScreenOn.appendChild(n)}e.videoScreenOn.play()}function je(){const e=this;e.videoScreenOn&&e.videoScreenOn.pause()}function We(){const e=this;C(e,W)||L(e,W,function(){b(this,ve,ze).call(this)}.bind(e)),"onpagehide"in window?window.addEventListener("pagehide",C(e,W),!1):window.addEventListener("blur",C(e,W),!1)}function He(){const e=this;C(e,H)||L(e,H,function(){const e=this;e.videoScreenOn&&e.videoScreenOn.paused&&e.videoScreenOn.play(),b(e,_e,Ye).call(e)}.bind(e)),"onpageshow"in window?window.addEventListener("pageshow",C(e,H),!1):window.addEventListener("focus",C(e,H),!1)}function qe(){const e=this;C(e,q)||L(e,q,async function(){var e=this,t=function(){const e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null}();if(document[t]){if(N)if(navigator.serviceWorker&&(navigator.serviceWorker.controller||e.map.getControlsByClass(o.Z.control.SWCacheClient).length&&"activated"===(await e.map.getControlsByClass(o.Z.control.SWCacheClient)[0].getServiceWorker()).state))try{(await navigator.serviceWorker.ready).showNotification(e.notificationConfig.title,Object.assign(e.notificationConfig,{actions:[{action:"back",title:e.getLocaleString("geo.trk.notification.backButton")}],data:{url:document.location.href}}))}catch(t){new Notification(e.notificationConfig.title,e.notificationConfig)}else new Notification(e.notificationConfig.title,e.notificationConfig)}else null!==D?b(e,ce,Ue).call(e):C(e,H).call(e);!D&&e.videoScreenOn&&console.log("video is: "+e.videoScreenOn.paused)}.bind(e)),window.addEventListener("visibilitychange",C(e,q),!1)}function Ve(){const e=this;b(e,ge,qe).call(e),b(e,de,We).call(e),b(e,fe,He).call(e)}function ze(){var e=c.Z.storage.getSessionLocalValue(this.const.localStorageKey.GEOTRACKINGTEMP);e&&e.length>0&&i().setItem(this.const.localStorageKey.GEOTRACKINGTEMP,"string"==typeof e?e:JSON.stringify(e)).catch((e=>console.warn(e)))}function Ye(){const e=this;i().getItem(e.const.localStorageKey.GEOTRACKINGTEMP).then((function(t){null!==t&&"null"!==t&&t.length>0&&c.Z.storage.setSessionLocalValue(e.const.localStorageKey.GEOTRACKINGTEMP,t)}),(e=>console.warn(e)))}function Ke(e){const t=this;i().getItem(e).then((function(r){if(null==r){const r=C(t,k).querySelector(".tc-ctl-geolocation-track-advert-dialog"),n=r.querySelector('input[type="checkbox"]');n.setAttribute("name",e),n.checked=!1,document.querySelector("#pageBlurMsg").textContent=c.Z.detectMobile()?t.getLocaleString("geo.trk.page.blur"):t.getLocaleString("geo.trk.page.blur.desktop"),r.querySelector("h3").textContent=e===t.const.localStorageKey.GPSSHOWADVERTISEMENT?t.getLocaleString("geo.track.activate")+" "+t.getLocaleString("geo.gps"):t.getLocaleString("geo.track.activate.title"),c.Z.showModal(C(t,k).querySelector(".tc-ctl-geolocation-track-advert-dialog"))}}),(e=>console.warn(e))),t.map.toast(c.Z.detectMobile()?t.getLocaleString("geo.trk.page.blur"):t.getLocaleString("geo.trk.page.blur.desktop"),{type:a.Z.msgType.WARNING})}function Xe(e){return c.Z.showModal(C(this,k).querySelector(".tc-ctl-geolocation-continue-track-dialog"),{closeCallback:function(){c.Z.isFunction(e)&&e()}}),!0}async function $e(){const e=this;e.track.trackList.querySelectorAll("li").forEach((function(e){e.style.display="none"}));const t=await e.getAvailableTracks();if((o=t)&&0!==o.length){const o=e.getSelectedTrackItem();var r;o&&(r=o.dataset.uid),e.track.trackList.querySelectorAll("li[data-id]").forEach((function(t){e.track.trackList.removeChild(t)}));const a=new DOMParser;for(var n=0;n<t.length;n++){var i=t[n];if(i&&"object"==typeof i){const t=await e.getRenderedHtml(e.CLASS+"-track-node",{id:n,uid:i.uid,name:i.name?i.name.trim():""}),r=a.parseFromString(t,"text/html").body.firstChild;e.getItemTools().forEach((t=>e.addItemToolUI(r,t))),e.track.trackList.appendChild(r),r.querySelector(e.const.selector.VISIBILITY).addEventListener("change",(function(t){e.trackLayer.setVisibility(t.target.checked),e.endPointLayer.setVisibility(t.target.checked)}))}}e.div.querySelector(e.const.selector.DELETEALL).disabled=!1,r&&e.setSelectedTrack(e.track.trackList.querySelector('li[data-uid="'+r+'"]')),e.track.trackSearch.disabled=!1}else e.track.trackList.querySelectorAll('li[class^="tc-ctl-geolocation-track-available-empty"]').forEach((function(e){e.style.display=""})),e.track.trackSearch.disabled=!0;var o}function Je(e){return C(this,z).get(e)}function Qe(e,t){const r=this;let n=b(r,be,Je).call(r,t);return n||(C(r,z).set(t,e),r.getAvailableTracks().then((function(n){if(n){let i=n.findIndex((e=>e.uid.toString()===t));i>-1&&(n[i].profile=JSON.stringify(e),r.setStoredTracks(n))}})),n=e),n}function et(e){C(this,z).delete(e)}function tt(e){const t=this,r=C(t,Y).find((function(t){return t.feature===e}));if(!r){const r=function(e,t){for(var r=[],n=[],i=0;i<e.length;i++)r[e[i]]=!0;for(i=0;i<t.length;i++)r[t[i]]?delete r[t[i]]:r[t[i]]=!0;for(var o in r)n.push(o);return n};return C(t,Y).find((function(t){return 0===r(t.feature.geometry,e.geometry).length}))}return r}function rt(){const e=this;e.map.off(a.Z.event.LAYERERROR,b(e,xe,rt)),e.clearFileInput(e.track.trackImportFile),o.Z.alert(e.getLocaleString("geo.trk.upload.error3"))}o.Z.mix(Pe,u.default),o.Z.mix(Pe,p.default),o.Z.control.Geolocation=Pe;const nt=Pe},1885:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(688),i=r(330),o=r(4094),a=r(5394);n.Z.control=n.Z.control||{},n.Z.filter=a.Z;class s extends o.default{constructor(){super(...arguments);const e=this;e.wrap=new n.Z.wrap.control.GeometryFeatureInfo(e),e._isDrawing=!1,e._isSearching=!1,e._drawToken=!1}async register(e){const t=this,r=super.register.call(t,e);return t.on(i.Z.event.CONTROLDEACTIVATE,(function(e){t.wrap.cancelDraw()})),await r}callback(e,t){const r=this;return new Promise((function(t,n){if(r._drawToken)t();else{r.closeResults(),r.filterFeature&&(r.filterLayer.removeFeature(r.filterFeature),r.filterFeature=null),r.highlightedFeature=null;for(var o=!1,a=0;a<r.map.workLayers.length;a++){var s=r.map.workLayers[a];if(s.type===i.Z.layerType.WMS&&s.getVisibility()&&s.names.length>0){o=!0;break}}o?(r.closeResults(),r.wrap.beginDraw({geometryType:r.geometryType,xy:e,layer:r.filterLayer,callback:function(e){r.wrap.getFeaturesByGeometry(e).then(t)}})):t()}}))}sendRequest(e){return this.wrap.getFeaturesByGeometry(e)}responseCallback(e){const t=this;if(super.responseCallback.call(t,e),t.filterFeature){for(var r=e.services,n=0;n<r.length;n++){var o=r[n];if(o.hasLimits)delete o.layers;else{for(var a=0;a<o.layers.length;a++)o.layers[a].features.length||(o.layers.splice(a,1),a-=1);o.layers.length||(r.splice(n,1),n-=1)}}t.renderData(e,(function(){r.length&&t.insertLinks(),t.div.querySelector(`.${t.CLASS}-coords`).classList.add(i.Z.classes.HIDDEN),t.info&&t.info.services.length?t.displayResults():t.map.toast(t.getLocaleString("query.msgNoResults"),{type:i.Z.msgType.INFO})}))}}}n.Z.control.GeometryFeatureInfo=s;const l=s},4743:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>b});var n=r(2461),i=r(330),o=r(268),a=r(688);function s(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t,r){return u(e,t),c(r,"get"),d(e,r)}function c(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function u(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}function p(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}function h(e,t){return d(e,g(e,t,"get"))}function d(e,t){return t.get?t.get.call(e):t.value}function f(e,t,r){return y(e,g(e,t,"set"),r),r}function g(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}function y(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}const m="sitna-language-option";var v=new WeakMap;class _ extends HTMLElement{constructor(e){super(),p(this,v,{writable:!0,value:void 0});const t=this;t.CLASS="tc-ctl-lang-link",f(t,v,t.querySelector(`a.${t.CLASS}`)),h(t,v)||(f(t,v,document.createElement("a")),h(t,v).classList.add(t.CLASS),t.appendChild(h(t,v))),e&&(t.fullCode=e.fullCode,t.shortCode=e.shortCode,t.description=e.description)}connectedCallback(){const e=this;e.fullCode=e.fullCode,e.shortCode=e.shortCode,e.description=e.description}static get observedAttributes(){return["full-code","short-code","description","href"]}get fullCode(){return this.getAttribute("full-code")}set fullCode(e){this.setAttribute("full-code",e)}get shortCode(){return this.getAttribute("short-code")}set shortCode(e){var t;const r=this;r.setAttribute("short-code",e),h(r,v).dataset.langCode=e;let n=r;do{n=n.parentElement}while(n&&!(n instanceof S));h(r,v).href=null===(t=n)||void 0===t?void 0:t.getUrl(e),h(r,v).innerHTML=e}get description(){return this.getAttribute("description")}set description(e){this.setAttribute("description",e),h(this,v).setAttribute("title",e)}get href(){return h(this,v).getAttribute("href")}set href(e){h(this,v).setAttribute("href",e)}}customElements.get(m)||customElements.define(m,_);const w="sitna-language-select";class S extends n.default{constructor(){super(...arguments);const e=this;e.languages=[],e.options.static&&(e.static=!0),e.tagAttributeName=e.options.tagAttributeName||"data-sitna-i18n"}connectedCallback(){const e=this;if(super.connectedCallback(),e.languages=Array.from(e.querySelectorAll("sitna-language-option")),!e.languages.length){const t=e.options.languages||[{fullCode:"es-ES",shortCode:"es",description:"Ver en castellano"},{fullCode:"eu-ES",shortCode:"eu",description:"Euskaraz ikusi"},{fullCode:"en-US",shortCode:"en",description:"View in English"}];e.languages=t.map((e=>new _(e))),e.render()}e.static=e.static,e.static||(e.collapsed=e.collapsed||!0);const t=Array.from(e.querySelectorAll("sitna-language-option"));t.length&&(e.languages=t)}static get observedAttributes(){return["static","collapsed"]}attributeChangedCallback(e,t,r){if(t===r)return;const n=this;"static"===e&&(n.static=n.hasAttribute(e)),"collapsed"===e&&(n.collapsed=n.hasAttribute(e))}getClassName(){return"tc-ctl-lang-select"}get static(){return this.hasAttribute("static")}set static(e){const t=this;e?t.setAttribute("static",""):t.removeAttribute("static")}get collapsed(){return this.hasAttribute("collapsed")}set collapsed(e){const t=this;e?t.setAttribute("collapsed",""):t.removeAttribute("collapsed")}register(e){const t=super.register.call(this,e);return e.ready((()=>S.setDocumentTexts())),t}async loadTemplates(){const e=await r.e(1198).then(r.bind(r,1198));this.template=e.default}render(){const e=this;return e._set1stRenderPromise(new Promise((function(t,r){e.renderData({languages:e.languages},(function(){var r,n,o;const a=e.querySelector(`.${e.CLASS}-links`);let s;e.languages.forEach((t=>{a.appendChild(t);const r=t.querySelector(`a.${t.CLASS}`);r.addEventListener(i.Z.event.CLICK,(function(t){t.preventDefault(),e.setLanguage(t.target.dataset.langCode)})),S.currentLocale===t.fullCode&&(s=r)})),null!==(r=s)&&void 0!==r||(s=null===(n=e.languages[0])||void 0===n?void 0:n.querySelector(`a.${language.CLASS}`)),null===(o=s)||void 0===o||o.classList.add(i.Z.classes.ACTIVE),e.toggle=e.querySelector(`.${e.CLASS}-toggle`),e.toggle.addEventListener(i.Z.event.CLICK,(function(t){e.collapsed=!e.collapsed})),t(e)}))})))}getUrl(e){return o.Z.addURLParameters(window.location.href,{[S.PARAMETER_NAME]:e})}setLanguage(e){var t;const r=this.languages.map((e=>e.querySelector(`a.${e.CLASS}`)));r.forEach((e=>e.classList.remove(i.Z.classes.ACTIVE))),null===(t=r.find((t=>t.dataset.langCode===e)))||void 0===t||t.classList.add(i.Z.classes.ACTIVE),window.location.href=this.getUrl(e)}static setDocumentTexts(){document.querySelectorAll(`[${self.tagAttributeName}]`).forEach((function(e){let t=e.innerHTML;const r=t.match(/\{\{([^\{\}]+)\}\}/g);if(r)for(var n=0,i=r.length;n<i;n++){const e=r[n],i=e.match(/[^\{\}]+/)[0];t=t.replace(e,o.Z.getLocaleString(S.currentLocale,i))}e.innerHTML!==t&&(e.innerHTML=t)}))}static get currentLocale(){var e,t,r,n;return l(S,S,E)||(e=S,t=S,r=E,n=o.Z.getLocaleUserChoice({cookieName:S.COOKIE_NAME,paramName:S.PARAMETER_NAME}),u(e,t),c(r,"set"),y(e,r,n)),l(S,S,E)}}s(S,"PARAMETER_NAME","lang"),s(S,"COOKIE_NAME","SITNA.language");var E={writable:!0,value:void 0};S.currentLocale,a.Z.control=a.Z.control||{},a.Z.control.LanguageSelector=S,customElements.get(w)||customElements.define(w,S);const b=S},4997:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var n=r(688),i=r(330),o=r(7292),a=r(52),s=r(4115),l=r(8288);n.Z.control=n.Z.control||{},n.Z.UI=n.Z.UI||{},n.Z.UI.autocomplete=l.Z;const c=function(){var e=this;e.layers=[],e.searchInit=!1,o.default.apply(e,arguments),e._selectors={LAYER_ROOT:"div."+e.CLASS+"-tree > ul."+e.CLASS+"-branch > li."+e.CLASS+"-node"},i.Z.classes.SELECTABLE||(i.Z.classes.SELECTABLE="tc-selectable"),i.Z.classes.INCOMPATIBLE||(i.Z.classes.INCOMPATIBLE="tc-incompatible"),i.Z.classes.ACTIVE||(i.Z.classes.ACTIVE="tc-active")};n.Z.inherit(c,o.default),function(){var e=c.prototype;e.CLASS="tc-ctl-lcat";e.register=async function(e){const t=this;await o.default.prototype.register.call(t,e);const r=function(e,r){if(Array.isArray(t.options.layers)){for(var o=0;o<t.options.layers.length;o++){var a=t.options.layers[o];a.type&&a.type!==i.Z.layerType.WMS||(a.id||(a.id=n.Z.getUID()),n.Z.Util.isPlainObject(a)&&(a=new s.Z(a)),t.layers.push(a))}t.render((function(){e()}))}else e()};t._readyPromise=new Promise((function(t,n){const o=function(n){n.layer===e.baseLayer&&(r(t),e.off(i.Z.event.LAYERUPDATE,o))};e.loaded((function(){e.baseLayer.state&&e.baseLayer.state!==a.Z.state.IDLE?e.on(i.Z.event.LAYERUPDATE,o):r(t)}))}));var l=t.getLocaleString("clickToAddToMap");return e.on(i.Z.event.BEFORELAYERADD+" "+i.Z.event.BEFOREUPDATEPARAMS,(function(e){t.getLayerNodes(e.layer).forEach((function(e){e.classList.add(i.Z.classes.LOADING),delete e.querySelector("span").dataset.tooltip}))})).on(i.Z.event.LAYERADD+" "+i.Z.event.UPDATEPARAMS,(function(e){const r=e.layer;r.isBase||r.type!==i.Z.layerType.WMS||t.loaded().then((function(){if(t.getLayerRootNode(r))h.call(t,r);else{for(var e=!1,n=0,i=t.layers.length;n<i;n++){var o=t.layers[n];if(o.type===r.type&&o.options.url===r.options.url){e=!0;break}}e?(t.layersToSetChecked||(t.layersToSetChecked=[]),t.layersToSetChecked.push(r)):t.addLayer(new s.Z({url:r.options.url,type:r.type,layerNames:[],title:r.title||r.wrap.getServiceTitle(),hideTitle:!0,hideTree:!1})).then((function(){h.call(t,r)}))}}))})).on(i.Z.event.LAYERERROR,(function(e){const r=e.reason;t.layers.some((t=>t===e.layer))&&(r&&n.Z.alert(t.getLocaleString(r,{url:e.layer.url})),t.getLayerNodes(e.layer).forEach((function(e){e.classList.remove(i.Z.classes.LOADING)})))})).on(i.Z.event.LAYERREMOVE,(function(e){const r=e.layer;t.getLayerNodes(r).forEach((function(e){e.classList.remove(i.Z.classes.CHECKED),e.querySelector("span").dataset.tooltip=l})),function(e){const r=[];if(!e.isBase){var n=e.options.url;t.list&&t.list.querySelectorAll("li").forEach((function(i){const o=t.getLayer(i.dataset.layerId);if(o&&o.type===e.type&&o.options.url===n)for(var a=0;a<e.names.length;a++)if(i.dataset.layerName===e.names[a]){r.push(i);break}}))}return r}(r).forEach((function(e){e.classList.remove(i.Z.classes.CHECKED),e.querySelector("h5").dataset.tooltip=l})),function(e){var r=t.map.getControlsByClass(n.Z.control.WorkLayerManager)[0];if(r)for(var o=r.layers,a=0;a<o.length;a++){var s=o[a];s!==e&&t.getLayerNodes(s).forEach((function(e){e.classList.add(i.Z.classes.CHECKED),e.querySelector("span").dataset.tooltip=t.getLocaleString("layerAlreadyAdded")}))}}(r),p.call(t)})).on(i.Z.event.EXTERNALSERVICEADDED,(function(e){e&&e.layer&&(t.addLayer(e.layer),t.div.classList.remove(i.Z.classes.COLLAPSED))})).on(i.Z.event.PROJECTIONCHANGE,(function(e){t.update()})),t};const t=function(t){t.target.blur(),t.stopPropagation();const r=t.target.parentElement;if("LI"===r.tagName&&!r.classList.contains(e.CLASS+"-leaf")){r.classList.toggle(i.Z.classes.COLLAPSED);r.querySelector("ul").classList.toggle(i.Z.classes.COLLAPSED)}},l=function(e,t,r){const o=e.target.closest("li");if(!o.classList.contains(i.Z.classes.LOADING)&&!o.classList.contains(i.Z.classes.CHECKED)){e.preventDefault;var a=o.dataset.layerName;a=void 0!==a?a.toString():"";var s=r.call(t,o);if(s&&a){var l=1;/iPad/i.test(navigator.userAgent)?l=10:n.Z.Util.detectFirefox()&&(l=250),s.title||(s.title=s.getTree().title),o.classList.add(i.Z.classes.LOADING),o.querySelector("span,h5").dataset.tooltip="";(function(e){return new Promise((function(t,r){setTimeout((function(){e.setAttribute("offsetHeight",e.offsetHeight),e.setAttribute("offsetWidth",e.offsetWidth),t()}),l)}))})(o).then((function(){t.addLayerToMap(s,a)})),e.stopPropagation()}}},u=function(){const e=this;e.textInput=e.div.querySelector("."+e.CLASS+"-input"),e.list=e.div.querySelector("."+e.CLASS+"-search ul"),e.textInput.addEventListener("mouseup",(function(t){""!==e.textInput.value&&setTimeout((function(){""===e.textInput.value&&(e.list.innerHTML="")}),1)}));var t=[];if(n.Z._search=n.Z._search||{},n.Z._search.retryTimeout=null,n.Z.UI.autocomplete.call(e.textInput,{link:"#",target:e.list,minLength:0,source:function(r,o){t=[],e._roots.forEach((function(e){e.querySelectorAll("li."+i.Z.classes.CHECKED).forEach((function(e){t.push(e.dataset.layerName)}))})),(r=r.trim()).length<3?e.list.innerHTML="":r.length>=3&&(n.Z._search.retryTimeout&&clearTimeout(n.Z._search.retryTimeout),n.Z._search.retryTimeout=setTimeout((function(){for(var t=[],n=0,i=e.sourceLayers.length;n<i;n++){const i=e.sourceLayers[n];var a=i.searchSubLayers(r);a.length&&t.push({service:{id:i.id,title:i.title||i.id},founds:a})}o({servicesFound:t,servicesLooked:e.sourceLayers.length})}),n.Z._search.interval))},callback:function(t){e.textInput.value=t.target.text||t.target.innerText,n.Z._search.lastPattern=e.textInput.value,e.goToResult(unescape(t.target.hash).substring(1)),n.Z.UI.autocomplete.call(e.textInput,"clear")},buildHTML:function(r){var o=this.target;if(r.results&&r.results.servicesFound.length>0)for(var a=e.map.getLayerTree().workLayers,s=0;s<r.results.servicesFound.length;s++){for(var l=r.results.servicesFound[s].founds,c=0;c<l.length;c++){delete l[c].alreadyAdded;for(var u=0;u<a.length;u++)if(t.indexOf(l[c].Name)>=0){l[c].alreadyAdded=!0;break}l[c].Name||(l.splice(c,1),c--)}r.results.servicesFound[s].founds.length?e.div.querySelectorAll(".tc-ctl-lcat-search-group")[s]&&(r.results.servicesFound[s].service.isCollapsed=e.div.querySelectorAll(".tc-ctl-lcat-search-group")[s].classList.contains(i.Z.classes.COLLAPSED)):r.results.servicesFound.splice(s,1)}var p="";return e.getRenderedHtml(e.CLASS+"-results",r.results).then((function(t){const r=new RegExp("(?<pre>[\\;|\\>][\\w\\s\\\\r\\\\n\\t\\(\\)\\.\\:\\\\(-]*)(?<match>"+n.Z.Util.patternFn(e.textInput.value)+")(?<post>[\\w\\s\\\\r\\n\\t\\(\\)\\.\\:\\\\-)]*[\\<|\\&])","gi");o.innerHTML=p=t.replace(r,"$<pre><strong>$<match></strong>$<post>");const i=e.div.querySelector(`.${e.CLASS}-info`);if(i){const t=i.dataset.serviceId;let r=`li[data-layer-name="${i.dataset.layerName}"] input[type="checkbox"].${e.CLASS}-search-btn-info`;e.sourceLayers.length>1&&(r=`li[data-service-id="${t}"] ${r}`);const n=o.querySelector(r);n&&(n.checked=!0)}})),p}}),!e.searchInit){e.div.querySelector("h2 button").addEventListener(i.Z.event.CLICK,(function(t){t.target.blur();const r=e.div.querySelector("."+e.CLASS+"-search"),n=e.div.querySelector("."+e.CLASS+"-tree"),o=e.div.querySelector("."+e.CLASS+"-info"),a=r.classList.contains(i.Z.classes.HIDDEN);if(r.classList.toggle(i.Z.classes.HIDDEN,!a),n.classList.toggle(i.Z.classes.HIDDEN,a),t.target.classList.toggle(e.CLASS+"-btn-tree",a),t.target.classList.toggle(e.CLASS+"-btn-search",!a),a)e.textInput.focus(),t.target.setAttribute("title",e.getLocaleString("viewAvailableLayersTree"));else{t.target.setAttribute("title",e.getLocaleString("searchLayersByText"));e.div.querySelectorAll(".tc-ctl-lcat-tree li input[type=checkbox]:checked").length>0&&o.classList.remove(i.Z.classes.HIDDEN)}}),{passive:!0}),e.div.addEventListener("change",n.Z.EventTarget.listenerBySelector("."+e.CLASS+"-search input[type=checkbox]."+e.CLASS+"-search-btn-info",(function(t){t.stopPropagation();const r=t.target;if(r.checked){const t=r.parentElement;var n=t;do{n=n.parentElement}while(n&&"LI"!==n.tagName);e.showLayerInfo(e.layers.length>1?e.layers.filter((e=>e.id===n.dataset.serviceId))[0]:e.layers[0],t.dataset.layerName)}else e.hideLayerInfo()}))),e.div.addEventListener("click",n.Z.EventTarget.listenerBySelector("."+e.CLASS+"-search input[type=checkbox]."+e.CLASS+"-search-btn-info",(function(e){e.stopPropagation()})));const t="."+e.CLASS+"-search li";e.div.addEventListener("click",n.Z.EventTarget.listenerBySelector(t,(function(r){r.stopPropagation();for(var n=r.target;n&&!n.matches(t);)n=n.parentElement;n.classList.contains(e.CLASS+"-no-results")||(n.classList.contains(e.CLASS+"-search-group")?n.classList.toggle(i.Z.classes.COLLAPSED):l(r,e,(function(){return 1===this.layers.length?this.layers[0]:this.getLayer(n.closest(".tc-ctl-lcat-search-group")&&n.closest(".tc-ctl-lcat-search-group").dataset.serviceId)})))}))),e.searchInit=!0}},p=function(){const e=this;if("createEvent"in document){var t=document.createEvent("HTMLEvents");t.initEvent("keyup",!1,!0),e.textInput&&e.textInput.dispatchEvent(t)}else e.textInput&&e.textInput.fireEvent("keyup")},h=function(e){const t=this,r=t.map.workLayers.filter((t=>t.type===e.type&&t.url===e.url)).map((e=>t.getLayerNodes(e))).flat();r.forEach((function(e){e.classList.remove(i.Z.classes.LOADING),e.classList.add(i.Z.classes.CHECKED),e.querySelector("span").dataset.tooltip=t.getLocaleString("layerAlreadyAdded")})),t.getLayerRootNode(e).querySelectorAll("li.tc-ctl-lcat-node.tc-ctl-lcat-leaf.tc-checked").forEach((function(e){r.find((t=>t===e))||(e.classList.remove(i.Z.classes.CHECKED),e.querySelector("span").dataset.tooltip=t.getLocaleString("clickToAddToMap"))})),p.call(t)},d=function(){const e=this;e.layersToSetChecked&&e.layersToSetChecked.length>0&&e.layersToSetChecked.forEach((function(t,r,n){e.getLayerRootNode(t)&&(h.call(e,t),n.splice(r,1))}))},f=function(e,r){const n=this;e.querySelectorAll("li > button."+n.CLASS+"-collapse-btn").forEach((function(e){e.addEventListener("click",t)})),e.querySelectorAll("span").forEach((function(e){e.addEventListener("click",(function(e){l(e,n,(function(e){for(var t=0,r=this._roots.length;t<r;t++){const r=this._roots[t];if(r.contains(e))return this.getLayer(r.dataset.layerId)}return n.getLayer(e.dataset.layerId)}))}))})),n._roots=n.div.querySelectorAll(n._selectors.LAYER_ROOT),e.dataset.layerId=r.id,e.querySelectorAll("."+n.CLASS+"-btn-info").forEach((function(e){const t=e.parentElement.querySelector("span"),o=e.parentElement.dataset.layerName;if(o){t.classList.add(i.Z.classes.SELECTABLE);var a=r.getInfo(o);if(Object.prototype.hasOwnProperty.call(a,"abstract")||Object.prototype.hasOwnProperty.call(a,"legend")||Object.prototype.hasOwnProperty.call(a,"metadata")?(e.addEventListener("change",(function(e){e.stopPropagation();this.checked?n.showLayerInfo(r,o):n.hideLayerInfo()}),{passive:!0}),e.addEventListener(i.Z.event.CLICK,(function(e){e.stopPropagation()}),{passive:!0})):e.parentElement.removeChild(e),r.compatibleLayers&&r.compatibleLayers.indexOf(o)<0&&(t.classList.add(i.Z.classes.INCOMPATIBLE),t.setAttribute("title",n.getLocaleString("reprojectionNeeded"))),n.map)for(var s=0,l=n.map.workLayers.length;s<l;s++){var c=n.map.workLayers[s];c.type===i.Z.layerType.WMS&&c.url===r.url&&1===c.names.length&&c.names[0]===o&&(t.parentElement.classList.add(i.Z.classes.CHECKED),t.dataset.tooltip=n.getLocaleString("layerAlreadyAdded"))}}else e.addEventListener("change",(function(e){e.stopPropagation();this.checked?n.showLayerInfo(r,o,t.innerText):n.hideLayerInfo()}),{passive:!0}),e.addEventListener(i.Z.event.CLICK,(function(e){e.stopPropagation()}),{passive:!0})})),d.call(n),n.getRenderedHtml(n.CLASS+"-dialog",null,(function(e){n._dialogDiv.innerHTML=e}))};e.renderBranch=function(e,t,r){const o=this;o.sourceLayers.unshift(e),e.getCapabilitiesPromise().then(function(e){o.getRenderedHtml(o.CLASS+"-branch",function(e){var t=e.getTree();const r=function(t,n){if(e.options.expandedNodeLevel>n){t.expanded=!0;for(var i=0;i<t.children.length;i++)r(t.children[i],n+1)}};return function t(r){for(var n=!1,i=0;i<r.children.length;i++)t(r.children[i])&&(n=!0);return Object.prototype.hasOwnProperty.call(r,"isVisible")&&(r.isVisible=!e.names||!e.names.length||n||r.isVisible),r.isVisible}(t),r(t,0),t}(this),function(e){var i=document.createElement("template");i.innerHTML=e;const a=o.div.querySelector("."+o.CLASS+"-branch");var s=i.content?i.content.firstChild:i.firstChild,l=a.querySelector("li."+o.CLASS+'-loading-node[data-layer-id="'+this.id+'"]');l?a.replaceChild(s,l):a.insertAdjacentElement("afterbegin",s),f.call(o,s,this),1===a.childElementCount&&r(),n.Z.Util.isFunction(t)&&t(o.sourceLayers[o.sourceLayers.map((e=>e&&e.id)).indexOf(this.id)])}.bind(this))}.bind(e)).catch(function(e){var t=o.layers.map((e=>e.id)).indexOf(this.id);o.layers.splice(t,1);var r=o.getLocaleString("lyrCtlg.errorLoadingNode",{serviceName:this.title}),n=o.div.querySelector("."+o.CLASS+"-branch").querySelector("li."+o.CLASS+'-loading-node[data-layer-id="'+this.id+'"]');n.classList.add("tc-error"),n.setAttribute("title",r),o.map.toast(r,{type:i.Z.msgType.ERROR})}.bind(e))},e.loadTemplates=async function(){const e=this,t=r.e(1989).then(r.bind(r,1989)),n=r.e(1128).then(r.bind(r,1128)),i=r.e(7546).then(r.bind(r,7546)),o=r.e(4502).then(r.bind(r,4502)),a=r.e(6854).then(r.bind(r,6854)),s=r.e(5644).then(r.bind(r,5644)),l=r.e(841).then(r.bind(r,841)),c={};c[e.CLASS]=(await t).default,c[e.CLASS+"-branch"]=(await n).default,c[e.CLASS+"-node"]=(await i).default,c[e.CLASS+"-info"]=(await o).default,c[e.CLASS+"-results"]=(await a).default,c[e.CLASS+"-results-path"]=(await s).default,c[e.CLASS+"-dialog"]=(await l).default,e.template=c},e.render=function(e){const t=this;return t.sourceLayers=[],t._set1stRenderPromise(new Promise((function(r,i){0===t.layers.length?t.renderData({layerTrees:[],enableSearch:!1},(function(){n.Z.Util.isFunction(e)&&e(),r()})):t.renderData({layers:t.layers,enableSearch:!0},(function(){u.call(t),t.layers.forEach((function(n){t.renderBranch(n,e,r)}))}))})))},e.getLayerRootNode=function(e){const t=this;var r=null;if(!e.isBase){var n=e.options.url;t._roots&&t._roots.forEach((function(i){const o=t.getLayer(i.dataset.layerId);o&&o.type===e.type&&o.options.url.toLowerCase()===n.toLowerCase()&&(r=i)}))}return r},e.getLayerNodes=function(e){const t=[],r=this.getLayerRootNode(e);if(r)for(var n=0;n<e.names.length;n++){const i=r.querySelector('li[data-layer-name="'+e.names[n]+'"]');i&&(t.push(i),i.querySelectorAll("li").forEach((function(e){t.push(e)})))}return t},e.showLayerInfo=function(e,t,r){const o=this;var a=null,s=o.div.querySelector("."+o.CLASS+"-info");const l=function(t,r){var a=!1;return r&&(a=!0,s.dataset.serviceId=e.id,s.dataset.layerName=t,s.classList.remove(i.Z.classes.HIDDEN),o.getRenderedHtml(o.CLASS+"-info",r).then((function(e){s.innerHTML=e,s.querySelector("."+o.CLASS+"-info-close").addEventListener(i.Z.event.CLICK,(function(){o.hideLayerInfo()}),{passive:!0})})).catch((function(e){n.Z.error(e)}))),a};o.div.querySelectorAll("."+o.CLASS+"-btn-info, ."+o.CLASS+"-search-btn-info").forEach((function(e){e.checked=!1}));const c=function(e,t){if(e.Title===t)return{title:t,abstract:e.Abstract,metadata:e.MetadataURL?e.MetadataURL.reduce((function(e,t){return e.push({format:t.Format,formatDescription:n.Z.Util.getLocaleString(o.map.options.locale,n.Z.Util.getSimpleMimeType(t.Format))||n.Z.Util.getLocaleString(o.map.options.locale,"viewMetadata"),type:t.type,url:t.OnlineResource}),e}),[]):null};if(e.Layer)for(var r=0;r<e.Layer.length;r++){const n=c(e.Layer[r],t);if(n)return n}};for(var u=0,p=o._roots.length;u<p;u++){const n=o._roots[u];if(n.dataset.layerId===e.id){const i=n.querySelectorAll("."+o.CLASS+"-btn-info");for(var h=0,d=i.length;h<d;h++){const n=i[h];var f=n.parentElement.dataset.layerName;if(t&&f===t){const r=e.getInfo(t),n=o.div.querySelector('li[data-layer-name="'+f+'"] > input[type="checkbox"].'+o.CLASS+"-btn-info");n.checked=l(f,r);const i=o.div.querySelector('li[data-layer-name="'+f+'"] > input[type="checkbox"].'+o.CLASS+"-search-btn-info");i&&(i.checked=n.checked),a=r;break}const s=n.parentElement.querySelector("span").innerText;if(!t&&r&&s===r){const t=c(e.capabilities.Capability.Layer,r);n.checked=l(s,t),a=t;break}}break}}return a},e.update=function(){const e=this;e.sourceLayers.forEach((function(t){t.getCapabilitiesPromise().then((function(){t.compatibleLayers=t.wrap.getCompatibleLayers(e.map.crs);const r=e.getLayerRootNode(t);r&&r.querySelectorAll("li[data-layer-name]").forEach((function(r){const n=r.dataset.layerName,o=r.querySelector("span."+i.Z.classes.SELECTABLE);t.compatibleLayers.indexOf(n)<0?(o.classList.add(i.Z.classes.INCOMPATIBLE),o.setAttribute("title",e.getLocaleString("reprojectionNeeded"))):(o.classList.remove(i.Z.classes.INCOMPATIBLE),o.removeAttribute("title"))}))}))}))},e.hideLayerInfo=function(){var e=this;e.div.querySelectorAll("."+e.CLASS+"-btn-info, ."+e.CLASS+"-search-btn-info").forEach((function(e){e.checked=!1}));const t=e.div.querySelector("."+e.CLASS+"-info");delete t.dataset.serviceId,delete t.dataset.layerName,t.classList.add(i.Z.classes.HIDDEN)},e.addLayer=function(e){const t=this;return new Promise((function(r,i){var o=[];t.options.layers&&t.options.layers.length&&(o=t.options.layers.filter((function(t){var r=n.Z.Util.reqGetMapOnCapabilities(t.url);return r&&r.replace(n.Z.Util.regex.PROTOCOL)===e.url.replace(n.Z.Util.regex.PROTOCOL)}))),0===o.length&&(o=t.layers.filter((function(t){return t.url.replace(n.Z.Util.regex.PROTOCOL)===e.url.replace(n.Z.Util.regex.PROTOCOL)}))),0===o.length?(t.layers.unshift(e),e.getCapabilitiesPromise().then((function(){e.compatibleLayers=e.wrap.getCompatibleLayers(t.map.crs),e.title=e.title||e.wrap.getServiceTitle(),t.renderBranch(e,(function(){r()}))}))):r()}))},e.getLayer=function(e){const t=this;for(var r=0,n=t.layers.length;r<n;r++){const n=t.layers[r];if(n.id===e){var i=t.options.layers.filter((t=>t.id===e));return i.length>0?n.hideTitle=n.options.hideTitle=i[0].hideTitle:n.hideTitle=n.options.hideTitle=!1,n}}return null},e.addLayerToMap=function(e,t){const r=this,o=n.Z.Util.extend({},e.options);o.id=r.getUID(),o.layerNames=[t],o.title=e.title,o.hideTree=!0;const a=new s.Z(o);a.isCompatible(r.map.crs)?r.map.addLayer(o):function(e,t){e.showProjectionChangeDialog({layer:t,closeCallback:function(){e.getLayerNodes(e._layerToAdd).forEach((function(t){t.classList.remove(i.Z.classes.LOADING),t.querySelector("span").dataset.tooltip=e.getLocaleString("clickToAddToMap")}))}})}(r,a)},e.loaded=function(){return this._readyPromise},e.getAvailableCRS=function(e){const t=this;return e=e||{},t.map.getCompatibleCRS({layers:t.map.workLayers.concat(t.map.baseLayer,e.layer),includeFallbacks:!0})},e.setProjection=function(e){const t=this;e=e||{},n.Z.loadProjDef({crs:e.crs,callback:function(){t.map.setProjection(e).then((function(){t._layerToAdd&&t.map.addLayer(t._layerToAdd),n.Z.Util.closeModal()}))}})},e.showProjectionChangeDialog=function(e){this._layerToAdd=e.layer,o.default.prototype.showProjectionChangeDialog.call(this,e)}}(),n.Z.control.LayerCatalog=c;const u=c},6460:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(688),i=r(330),o=r(8239);n.Z.control=n.Z.control||{};const a=function(){o.default.apply(this,arguments)};var s;n.Z.inherit(a,o.default),(s=a.prototype).CLASS="tc-ctl-legend",s.register=function(e){const t=this;return e.on(i.Z.event.VIEWCHANGE,(function(r){const n=r.view,o=t.loadGraphics.bind(t);n===i.Z.view.THREED?e.on(i.Z.event.LAYERADD,o):n===i.Z.view.DEFAULT&&e.off(i.Z.event.LAYERADD,o)})),o.default.prototype.register.call(t,e)},s.loadTemplates=async function(){const e=this,t=r.e(4977).then(r.bind(r,4977)),n=r.e(8990).then(r.bind(r,8990)),i={};i[e.CLASS]=(await t).default,i[e.CLASS+"-node"]=(await n).default,e.template=i},s.loadGraphics=function(){const e=this;e.getLayerUIElements().forEach((function(t){const r=e.map.getLayer(t.dataset.layerId);r&&t.querySelectorAll("li."+e.CLASS+"-node-visible").forEach((function(t){t.querySelectorAll("img").forEach((function(t){t&&t.hasAttribute("src")&&0===t.getAttribute("src").length&&e.styleLegendImage(t,r)}))}))}))},s.updateScale=function(){const e=this,t=e.CLASS+"-node-inscale",r=e.CLASS+"-node-outofscale";e.getLayerUIElements().forEach((function(n){const i=e.map.getLayer(n.dataset.layerId);if(i&&!i.customLegend){let o=!1;const a=n.querySelectorAll("li");a.forEach((function(n){if(n.classList.contains(e.CLASS+"-node-visible")){const a=n.dataset.layerUid;i.isVisibleByScale(a)?(o=!0,n.classList.remove(r),n.classList.add(t),n.querySelectorAll("img").forEach((function(t){e.styleLegendImage(t,i)}))):(n.classList.add(r),n.classList.remove(t))}})),o=o||!a.length,a.length||n.querySelectorAll("img").forEach((function(t){e.styleLegendImage(t,i)})),n.classList.toggle(t,o),n.classList.toggle(r,!o)}}))},s.update=function(){const e=this;e.getLayerUIElements().forEach((function(t){const r=e.map.getLayer(t.dataset.layerId);if(r&&(!r.customLegend||!r.getVisibility())){const n=r.getTree(!1,!0);t.querySelectorAll("li").forEach((function(t){const o=e.CLASS+"-node-visible",a=e.CLASS+"-node-notvisible",s=e.CLASS+"-node-hasvisible";switch(r.getNodeVisibility(t.dataset.layerUid,n)){case i.Z.visibility.VISIBLE:t.classList.remove(a,s),t.classList.add(o);break;case i.Z.visibility.NOT_VISIBLE:t.classList.remove(o,s),t.classList.add(a);break;case i.Z.visibility.HAS_VISIBLE:t.classList.remove(o,a),t.classList.add(s);break;case null:t.classList.remove(o,s),t.classList.add(a);break;default:t.classList.remove(a,s),t.classList.add(o)}})),e.updateLayerVisibility(r)}})),e.updateScale()},s.updateLayerTree=function(e){var t=this;if(!e.isBase&&!e.options.stealth){e.hideTree||e.options.hideTree,t.div.querySelector("."+t.CLASS+"-empty").classList.add(i.Z.classes.HIDDEN);var r=e.getNestedTree?e.getNestedTree():e.getTree();e._title&&e._title!==e.title&&(r=Object.assign(r,{title:e._title})),t.getRenderedHtml(t.CLASS+"-node",r).then((function(r){const n=(new DOMParser).parseFromString(r,"text/html").body.firstChild,i=n.dataset.layerUid,o=t.div.querySelector("ul."+t.CLASS+"-branch"),a=o.querySelectorAll('li[data-layer-uid="'+i+'"]');if(1===a.length){const e=a[0];e.innerHTML!==n.innerHTML&&(e.innerHTML=n.innerHTML,e.setAttribute("class",n.getAttribute("class")))}else n.dataset.layerId=e.id,o.insertBefore(n,o.firstChild);t.update()})).catch((function(e){n.Z.error(e)}))}},s.removeLayer=function(e){e.isBase||o.default.prototype.removeLayer.call(this,e)},s.updateLayerVisibility=function(e){var t=this;t.getLayerUIElements().forEach((function(r){r.dataset.layerId===e.id&&r.classList.toggle(t.CLASS+"-node-notvisible",!e.getVisibility())}))},s.getLayerUIElements=function(){const e=this;return e.div.querySelector("ul."+e.CLASS+"-branch").querySelectorAll("li."+e.CLASS+"-node")},n.Z.control.Legend=a;const l=a},9186:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var n=r(688),i=r(330),o=r(1885);n.Z.control=n.Z.control||{};class a extends o.default{constructor(){super(...arguments);const e=this;e.geometryType=i.Z.geom.POLYLINE,e.style=n.Z.Util.extend(!0,{strokeColor:e.DEFAULT_STROKE_COLOR,strokeWidth:2},e.options.style)}}n.Z.control.LineFeatureInfo=a;const s=a},9886:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var n=r(688),i=r(849);n.Z.control=n.Z.control||{},n.Z.control.ListTOC=i.default;const o=n.Z.control.ListTOC},9945:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var n=r(688),i=r(330),o=r(7497);function a(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}function s(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,c(e,t,"set"),r),r}function l(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,c(e,t,"get"))}function c(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}n.Z.control=n.Z.control||{};var u=new WeakMap;class p extends o.Z{constructor(){super(...arguments),a(this,u,{writable:!0,value:{}});const e=this;e.div.classList.add(e.CLASS),window.addEventListener("error",(function(){return e.reset(),!1}),!1)}getClassName(){return"tc-ctl-load"}async loadTemplates(){const e=await r.e(696).then(r.bind(r,696));this.template=e.default}async register(e){const t=this;return await super.register.call(t,e),e.on(i.Z.event.BEFORELAYERADD+" "+i.Z.event.BEFORELAYERUPDATE+" "+i.Z.event.BEFOREFEATURESADD,(function(e){t.startWait(e)})).on(i.Z.event.LAYERADD+" "+i.Z.event.LAYERERROR+" "+i.Z.event.LAYERUPDATE+" "+i.Z.event.FEATURESADD,(function(e){t.stopWait(e)})).on(i.Z.event.BEFOREFEATUREINFO,(function(){t.addWait(i.Z.event.FEATUREINFO)})).on(i.Z.event.FEATUREINFO+" "+i.Z.event.NOFEATUREINFO+" "+i.Z.event.FEATUREINFOERROR,(function(){t.removeWait(i.Z.event.FEATUREINFO)})).on(i.Z.event.LAYERREMOVE,(function(e){t.endWait(e)})),n.Z.isDebug||window.addEventListener("error",(function(e,r,n,i,o){return t.reset(),!1})),t}startWait(e){const t=this,r=e.layer.id;void 0===l(t,u)[r]&&(l(t,u)[r]=0),l(t,u)[r]=l(t,u)[r]+1,t.show(),t.map.trigger(i.Z.event.STARTLOADING)}stopWait(e){const t=this,r=e.layer.id;var n=l(t,u)[r];n>0&&(n=l(t,u)[r]=n-1),n||delete l(t,u)[r];Object.keys(l(t,u)).length||(t.hide(),t.map.trigger(i.Z.event.STOPLOADING))}endWait(e){const t=this,r=e.layer.id;l(t,u)[r]>0&&delete l(t,u)[r];Object.keys(l(t,u)).length||(t.hide(),t.map.trigger(i.Z.event.STOPLOADING))}reset(e){const t=this;s(t,u,{}),t.hide(),t.map&&t.map.trigger(i.Z.event.STOPLOADING)}addWait(e){const t=e||n.Z.getUID();return this.startWait({layer:{id:t}}),t}removeWait(e){this.stopWait({layer:{id:e}})}}n.Z.control.LoadingIndicator=p;const h=p},8239:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(688),i=r(330),o=r(7497),a=r(4676);n.Z.control=n.Z.control||{};const s=function(){var e=this;o.Z.apply(e,arguments),e.layerTrees={}};n.Z.inherit(s,o.Z),function(){var e=s.prototype;e.CLASS="tc-ctl-mc",e.render=function(e,t){const r=this;return r._set1stRenderPromise(r.map?r.renderData(t?n.Z.Util.extend(r.map.getLayerTree(),t):r.map.getLayerTree(),(function(){r.addUIEventListeners(),"function"==typeof e&&e()})):Promise.reject(Error("Cannot render: control has no map")))},e.register=async function(e){const t=this;await Promise.all([o.Z.prototype.register.call(t,e),t.renderPromise()]);for(var r=0,a=e.layers.length;r<a;r++)t.updateLayerTree(e.layers[r]);return e.on(i.Z.event.ZOOM+" "+i.Z.event.PROJECTIONCHANGE,(function(){t.updateScale()})).on(i.Z.event.UPDATEPARAMS,(function(e){const r=e.layer;var i=r.names;!function e(t){var r=!1;if(t)if(i.indexOf(t.name)>=0)r=!0;else for(var n=0;n<t.children.length;n++)if(e(t.children[n])){r=!0;break}return r}(t.layerTrees[r.id])&&0!==i.length?t.updateLayerTree(r):t.update(t instanceof n.Z.control.BasemapSelector?void 0:r)})).on(i.Z.event.LAYERVISIBILITY,(function(e){t.updateLayerVisibility(e.layer)})).on(i.Z.event.LAYERADD,(function(e){t.updateLayerTree(e.layer)})).on(i.Z.event.VECTORUPDATE+" "+i.Z.event.FEATUREADD+" "+i.Z.event.FEATURESADD,(function(e){const r=e.layer;t._updateLayerTreeTimeouts=t._updateLayerTreeTimeouts||{},t._updateLayerTreeTimeouts[r.id]&&clearTimeout(t._updateLayerTreeTimeouts[r.id]),t._updateLayerTreeTimeouts[r.id]=setTimeout((function(){t.map.workLayers.indexOf(r)>-1&&(t.updateLayerTree(r),delete t._updateLayerTreeTimeouts[r.id])}),100)})).on(i.Z.event.LAYERREMOVE,(function(e){t.removeLayer(e.layer)})).on(i.Z.event.LAYERORDER,(function(e){t.updateLayerOrder(e.layer,e.oldIndex,e.newIndex)})).on(i.Z.event.LAYERERROR,(function(e){t.onErrorLayer(e.layer)})),t},e.updateScale=function(){},e.updateLayerVisibility=function(e){},e.updateLayerTree=function(e){e.tree=null,this.layerTrees[e.id]=e.getTree()},e.updateLayerOrder=function(e,t,r,n){const i=this;if(t>=0&&t!==r){var o,a;const t=i.getLayerUIElements();for(var s=(n=n||i.map.workLayers).length-1;s>=0;s--){const r=n[s];a=o;for(var l=0,c=t.length;l<c;l++){const e=t[l];if(e.dataset.layerId===r.id){o=e;break}}if(r===e){o&&(a?a.insertAdjacentElement("afterend",o):o.parentElement.firstChild.insertAdjacentElement("beforebegin",o));break}}}},e.removeLayer=function(e){const t=this,r=t.getLayerUIElements();for(var n=0,o=r.length;n<o;n++){const t=r[n];if(t.dataset.layerId===e.id){t.parentElement.removeChild(t);break}}0===t.getLayerUIElements().length&&t.div.querySelector("."+t.CLASS+"-empty").classList.remove(i.Z.classes.HIDDEN)},e.onErrorLayer=function(e){},e.getLayerUIElements=function(){return this.div.querySelector("ul").children};e.styleLegendImage=function(e,t){if(!e.getAttribute("src")){var r=e.dataset.img;const p=new a.default(n.Z.proxify);if(t&&t.options.method&&"POST"===t.options.method)t.getLegendGraphicImage().then((function(t){e.src=t})).catch((function(e){n.Z.error(e.statusText||e)}));else{if(/[&?]REQUEST=getLegendGraphic/i.test(r)){const i=e.parentElement;var o=i.style.color,s=o.indexOf("("),l=o.indexOf(")");if(s>=0&&l>s){let e=o.substr(0,l).substr(s+1).split(",");o="0x";for(var c=0;c<3;c++){var u=parseInt(e[c]).toString(16);o+=1===u.length?"0"+u:u}}else o.replace("#","0x");r+="&LEGEND_OPTIONS=fontName:"+i.style.fontFamily+";fontSize:"+parseInt(i.style.fontSize)+";fontColor:"+o+";fontAntiAliasing:true",t.params&&t.params.sld_body&&(r=n.Z.Util.addURLParameters(r,{sld_body:t.params.sld_body})),p.fetchImage(r).then((function(e){e.dataset.img=e.src})).catch((function(e){n.Z.error(e.statusText||e)}))}p.fetchImage(r).then((function(t){e.src=t.src})).catch((function(o){!o.status||404!==o.status&&401!==o.status?p._image.ErrorType.UNEXPECTEDCONTENTTYPE===o.message?(n.Z.error(n.Z.Util.getLocaleString(t.map.options.locale,"simbologyNotCompatible")),e.src=i.Z.BLANK_IMAGE):n.Z.error(o):n.Z.error(n.Z.Util.getLocaleString(t.map.options.locale,"simbologyImgNotFound",{url:r}))}))}}}}(),n.Z.control.MapContents=s;const l=s},3784:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var n=r(688),i=r(330),o=r(7497),a=r(4676);n.Z.control=n.Z.control||{};const s=function(){var e=this;o.Z.apply(e,arguments)};var l;n.Z.inherit(s,o.Z),(l=s.prototype).CLASS="tc-ctl-mi",l.register=function(e){const t=this,r=o.Z.prototype.register.call(t,e);return t.QR_MAX_URL_LENGTH=150,t.SHORTEN_URL_LENGTH=16e3,t.exportsState=!1,t.includeControls=void 0===t.options.includeControls||t.options.includeControls,r},l.exportControlStates=function(){const e=this;return e.map?e.map.exportControlStates():[]},l.importControlStates=function(e){const t=this;t.map&&t.map.importControlStates(e)},l.exportState=function(){const e=this;if(e.exportsState){const r={};if(e.featureToShare||e.sharedFeaturesLayer){var t;if(r.id=e.id,e.featureToShare){const r=e.featureToShare.clone();r.showsPopup=!0,t=e.featureToShare.layer.exportState({features:[r]})}else t=e.sharedFeaturesLayer.exportState();r.features=t.features,t.crs&&(r.crs=t.crs)}return r}return null},l.importState=function(e){const t=this;t.map&&e.features.length&&t.map.addLayer({id:t.getUID(),owner:t,type:i.Z.layerType.VECTOR,title:t.getLocaleString("foi"),stealth:!0}).then((function(r){t.sharedFeaturesLayer=r,r.importState({features:e.features,crs:e.crs}).then((function(){t.map.zoomToFeatures(r.features)}))}))},l.manageMaxLengthExceed=function(){throw"Falta implementacin del mtodo manageMaxLengthExceed"},l.generateLink=async function(){var e=this,t=window.location.href,r=t.indexOf("#");if(r>0&&(t=t.substring(0,r)),e.extraParams){var o=n.Z.Util.getQueryStringParams(t);n.Z.Util.extend(o,e.extraParams);var a=t.indexOf("?");a>=0&&(t=t.substring(0,a)),t=t.concat("?",n.Z.Util.getParamString(o))}else{var s=t.indexOf("?");s>0&&(t=t.replace(t.substring(s),""))}const l=e.includeControls?e.exportControlStates():[];!e.includeControls&&e.exportsState&&(e.featureToShare||e.sharedFeaturesLayer||e.caller&&e.caller.toShare)&&(e.caller&&e.caller.toShare?l.push(e.caller.exportState()):l.push(e.exportState()));const c=l.length?{ctl:l}:void 0;var u=await e.map.getMapState({extraStates:c,cacheResult:e.includeControls}),p=t.concat("#",u);return e.manageMaxLengthExceed({browser:p.length>i.Z.URL_MAX_LENGTH,qr:p.length>e.SHORTEN_URL_LENGTH}),p},l.shortenedLink=async function(){const e=this;var t;const r=function(){return e.map.toast(e.getLocaleString("urlTooLongForShortener"),{type:i.Z.msgType.ERROR}),e.map.getLoadingIndicator().removeWait(t),""},o=await e.generateLink();if(o.length>e.QR_MAX_URL_LENGTH&&o.length<e.SHORTEN_URL_LENGTH){t=e.map.getLoadingIndicator().addWait();const i=await function(e){var t=new FormData;return t.append("url",e),new a.default(n.Z.proxify,{allowedMixedContent:!1}).fetch("https://tinyurl.com/api-create.php",{type:"POST",data:t}).then((function(e){return e})).catch((function(e){return null}))}(o);return i&&i.responseText?(e.map.getLoadingIndicator().removeWait(t),i.responseText.replace("http://","https://")):r()}return o.length>=e.SHORTEN_URL_LENGTH?r():""},l.makeQRCode=async function(e,t){const n=r.e(2366).then(r.t.bind(r,2366,19)),i=await this.shortenedLink()||"";if(i.length>0){const r={text:i,margin:2};t&&(r.width=t),e.innerHTML="";const o=document.createElement("img"),a=(await n).default;return o.src=await a.toDataURL(i,r),e.appendChild(o),o.src}},l.drawScaleBarIntoCanvas=function(e){var t,r=this.map.getControlsByClass(n.Z.control.ScaleBar);if(0===r.length)return null;var i=(t=(e=e||{}).canvas?e.canvas:document.createElement("CANVAS")).getContext("2d");i.save();var o,a,s=document.getElementsByClassName("ol-scale-line-inner").item(0),l=n.Z.Util.extend({},s.getBoundingClientRect()),c=s.textContent;i.beginPath(),i.strokeStyle=window.getComputedStyle(s).borderColor,l.width>l.height?(o=l.width,a=l.height):(o=l.height,a=l.width),e.setSize&&(t.width=o,t.height=a),l.left=void 0!==e.left?e.left:15,l.top=void 0!==e.top?e.top:15,i.moveTo(l.left,l.top),i.lineTo(l.left,l.top+a),i.lineTo(l.left+o,l.top+a),i.lineTo(l.left+o,l.top),i.stroke();var u={x:l.left+o/2,y:l.top+a/2};return e.fill&&function(t,i,o){var a=document.getElementsByClassName(r[0].CLASS).item(0),s=n.Z.Util.extend({},a.getBoundingClientRect());s.left=(e.left||15)-2,s.top=e.top||15,s.top--,t.globalAlpha=.5,t.fillStyle=window.getComputedStyle(a).backgroundColor,i+=4,o+=4,t.fillRect(s.left,s.top,i,o)}(i,o,a),i.globalAlpha=1,i.fillStyle=void 0!==e.textColor?e.textColor:window.getComputedStyle(s).color,i.font=void 0!==e.font?e.font:window.getComputedStyle(s).fontSize+" "+window.getComputedStyle(s).fontFamily,i.textAlign="center",i.textBaseline="middle",i.fillText(c,u.x,u.y),t},l.registerListeners=function(){const e=this;if(!e.registeredListeners){let t;const r=function(r){clearTimeout(t),t=setTimeout((function(){delete e.map._controlStatesCache,e.renderPromise().then((function(){e.generateLink()}))}),100)};e.map.on(i.Z.event.LAYERADD,r).on(i.Z.event.LAYERREMOVE,r).on(i.Z.event.FEATUREADD,r).on(i.Z.event.FEATUREREMOVE+" "+i.Z.event.FEATURESCLEAR,r),e.registeredListeners=!0}},n.Z.control.MapInfo=s;const c=s},3965:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(688),i=r(330),o=r(7497);r(1235);n.Z.control=n.Z.control||{};const a=function(){var e=this;o.Z.apply(e,arguments),e.snapping=e.options.snapping,e.drawControls=[],e.persistentDrawControls=!1,e.NOMEASURE="-",e.exportsState=!0,this.renderPromise().then((function(){e.measureMode=e.options.mode,e.history=[],e.historyIndex=0,e.reset=!0,e.wrap=new n.Z.wrap.control.Measure(e)}))};var s;n.Z.inherit(a,o.Z),(s=a.prototype).CLASS="tc-ctl-meas",s.loadTemplates=async function(){const e=await r.e(9049).then(r.bind(r,9049));this.template=e.default},s.render=function(e){const t=this;return t._set1stRenderPromise(o.Z.prototype.renderData.call(t,{controlId:t.id,displayElevation:t.options.displayElevation,singleSketch:!t.persistentDrawControls,extensibleSketch:t.persistentDrawControls,stylable:t.persistentDrawControls},(function(){t.options.mode&&t.div.querySelector(".tc-ctl-meas-select").classList.add(i.Z.classes.HIDDEN),t.lineMeasurementControl=t.div.querySelector('sitna-measurement[mode="polyline"]'),t.polygonMeasurementControl=t.div.querySelector('sitna-measurement[mode="polygon"]'),t.lineMeasurementControl.containerControl=t,t.lineMeasurementControl.displayElevation=t.options.displayElevation,t.polygonMeasurementControl.containerControl=t,t.div.querySelectorAll(`.${a.prototype.CLASS}-select sitna-tab`).forEach((function(e){e.callback=function(){const e=this.target;e&&t.setMode(e.id.substr(e.id.indexOf("-mode-")+6),!0)}})),n.Z.Util.isFunction(e)&&e()})))},s.register=async function(e){const t=this;await o.Z.prototype.register.call(t,e),t.map.on(i.Z.event.VIEWCHANGE,(function(){t.map.view===i.Z.view.PRINTING&&t.trigger(i.Z.event.DRAWEND)}));const r=t.getUID(),n=t.getUID(),a=t.getUID();t.units=t.options.units?t.options.units:["m","km"],t.options.layerLess?t.layerPromise=Promise.resolve(null):t.layerPromise=e.addLayer({id:r,title:t.getLocaleString("measure"),owner:t,stealth:!0,type:i.Z.layerType.VECTOR,styles:{point:e.options.styles.point,line:e.options.styles.line,polygon:e.options.styles.polygon}}),t.layer=await t.layerPromise,await t.renderPromise(),t.layer&&e.putLayerOnTop(t.layer);const s=await Promise.all([t.getLineDrawControl(),t.getPolygonDrawControl()]);return t.lineDrawControl=s[0],t.polygonDrawControl=s[1],t.lineDrawControl.id=n,t.polygonDrawControl.id=a,t.lineDrawControl.setLayer(t.layer),t.polygonDrawControl.setLayer(t.layer),t.lineDrawControl.snapping=t.snapping,t.polygonDrawControl.snapping=t.snapping,s.forEach((function(e){e.containerControl=t,t.drawControls.push(e),e.on(i.Z.event.DRAWSTART,(function(e){t.resetValues()})).on(i.Z.event.MEASURE+" "+i.Z.event.MEASUREPARTIAL,(function(e){t.displayMeasurements(e)})).on(i.Z.event.DRAWCANCEL,(function(e){setTimeout((function(){t.cancel()}),100)})),e.exportsState=!1})),t.setMode(t.options.mode),t},s.displayMode=function(e){const t=this,r=[];switch(t.div.querySelectorAll(".tc-ctl-meas-mode").forEach((function(e){r.push(e)})),e){case i.Z.geom.POLYLINE:t._activeMode=r.find((function(e){return e.matches(".tc-ctl-meas-len")}));break;case i.Z.geom.POLYGON:t._activeMode=r.find((function(e){return e.matches(".tc-ctl-meas-area")}));break;case null:case void 0:t._activeMode=null}const n=r.filter((function(e){return e!==t._activeMode}));return e?t.div.querySelector(`sitna-tab[group="${t.id}-mode"][for="${t.id}-mode-${e}"]`).selected=!0:t.div.querySelectorAll(`sitna-tab[group="${t.id}-mode"]`).forEach((function(e){e.selected=!1})),t._activeMode&&(t._activeMode.classList.remove(i.Z.classes.HIDDEN),t._activeMode.querySelector(".tc-ctl").classList.remove(i.Z.classes.COLLAPSED)),n.forEach((function(e){e.classList.add(i.Z.classes.HIDDEN)})),t},s.setMode=function(e){const t=this;var r;switch(t.mode=e,t.displayMode(e),e){case i.Z.geom.POLYLINE:t.lineDrawControl.activate(),r=i.Z.event.CONTROLACTIVATE;break;case i.Z.geom.POLYGON:t.polygonDrawControl.activate(),r=i.Z.event.CONTROLACTIVATE;break;case null:case void 0:t.drawControls.forEach((function(e){e.isActive&&e.deactivate()})),r=i.Z.event.CONTROLDEACTIVATE;break;default:r=i.Z.event.CONTROLACTIVATE}t.resetValues(),r&&t.map&&t.map.trigger(r,{control:t})},s.cancel=function(){return this.setMode(null,!1),this},s.displayMeasurements=function(e){const t=this;return e=e||{},Object.prototype.hasOwnProperty.call(e,"area")&&t.polygonMeasurementControl.displayMeasurement(e),Object.prototype.hasOwnProperty.call(e,"length")&&t.lineMeasurementControl.displayMeasurement(e),t},s.getLineMeasurementControl=async function(){return await this.renderPromise(),this.div.querySelector('sitna-measurement[mode="polyline"]')},s.getPolygonMeasurementControl=async function(){return await this.renderPromise(),this.div.querySelector('sitna-measurement[mode="polygon"]')},s.resetValues=function(){const e=this;return e.getLineMeasurementControl().then((e=>e.clearMeasurement())),e.getPolygonMeasurementControl().then((e=>e.clearMeasurement())),e},s.getDrawLines=function(){},s.getLayer=function(){const e=this;return e.layer?Promise.resolve(e.layer):e.layerPromise},s.setLayer=async function(e){const t=this;t.layer=e;for await(const e of[t.getLineDrawControl(),t.getPolygonDrawControl()])e.setLayer(t.layer)},s.getLineDrawControl=async function(){return await this.renderPromise(),this.div.querySelector(".tc-ctl-meas-len sitna-draw")},s.getPolygonDrawControl=async function(){return await this.renderPromise(),this.div.querySelector(".tc-ctl-meas-area sitna-draw")},s.exportState=function(){const e=this;return e.exportsState&&e.layer?{id:e.id,layer:e.layer.exportState()}:null},s.importState=function(e){this.layerPromise.then((function(t){t.importState(e.layer)}))},n.Z.control.Measure=a;const l=a},895:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>B});var n=r(2461),i=r(688),o=r(6204),a=r(3048),s=r(8683),l=r(9529),c=r(8033),u=r(1872),p=r(5265),h=r(9967),d=r(330),f=r(268);function g(e,t){m(e,t),t.add(e)}function y(e,t,r){m(e,t),t.set(e,r)}function m(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function v(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,S(e,t,"get"))}function w(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,S(e,t,"set"),r),r}function S(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}function E(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}i.Z.control=i.Z.control||{};const b="sitna-measurement";var C=new WeakMap,L=new WeakMap,T=new WeakMap,A=new WeakMap,x=new WeakMap,P=new WeakMap,O=new WeakMap,I=new WeakMap,R=new WeakMap,M=new WeakMap,D=new WeakMap,N=new WeakSet,Z=new WeakSet;class k extends n.default{constructor(){super(...arguments),g(this,Z),g(this,N),v(this,"NOMEASURE","-"),y(this,C,{writable:!0,value:void 0}),y(this,L,{writable:!0,value:void 0}),y(this,T,{writable:!0,value:void 0}),y(this,A,{writable:!0,value:void 0}),y(this,x,{writable:!0,value:void 0}),y(this,P,{writable:!0,value:void 0}),y(this,O,{writable:!0,value:void 0}),y(this,I,{writable:!0,value:void 0}),y(this,R,{writable:!0,value:void 0}),y(this,M,{writable:!0,value:void 0}),y(this,D,{writable:!0,value:void 0});this.initProperty("enabledProfile").initProperty("mode").initProperty("units")}static get observedAttributes(){return["mode","enabled-profile"]}attributeChangedCallback(e,t,r){if(t===r)return;const n=this;"enabled-profile"===e&&E(n,N,F).call(n),"mode"===e&&E(n,Z,U).call(n)}getClassName(){return"tc-ctl-msmt"}get enabledProfile(){return this.hasAttribute("enabled-profile")}set enabledProfile(e){this.toggleAttribute("enabled-profile",!!e)}get mode(){return this.getAttribute("mode")}set mode(e){e?this.setAttribute("mode",e):this.removeAttribute("mode")}setMode(e){const t=this;return new Promise((function(r,n){t.mode===e&&t.renderPromise().then((()=>r(e))),t.mode=e,t.render().then((()=>r(e)))}))}get units(){const e=this.getAttribute("units");return e?e.split(","):["m","km"]}set units(e){const t=this;Array.isArray(e)?t.setAttribute("units",e.join()):t.setAttribute("units",e)}async loadTemplates(){const e=await r.e(4629).then(r.bind(r,4629));this.template=e.default}render(e){const t=this,r={enabledProfile:t.enabledProfile},n=t.mode;return n&&(r[n]=!0),t._set1stRenderPromise(new Promise((function(n,i){t.renderData(r,(function(){w(t,L,t.querySelector(`.${t.CLASS}-val-coord-1-t`)),w(t,C,t.querySelector(`.${t.CLASS}-val-coord-1-v`)),w(t,A,t.querySelector(`.${t.CLASS}-val-coord-2-t`)),w(t,T,t.querySelector(`.${t.CLASS}-val-coord-2-v`)),w(t,x,t.querySelector(`.${t.CLASS}-val-coord-ele-t`)),w(t,P,t.querySelector(`.${t.CLASS}-val-coord-ele-v`)),w(t,O,t.querySelector(`.${t.CLASS}-val-len`)),w(t,R,t.querySelector(`.${t.CLASS}-val-area`)),w(t,I,t.querySelector(`.${t.CLASS}-val-peri`)),w(t,M,t.querySelector("sitna-toggle.tc-ctl-msmt-prof-btn")),t.addUIEventListeners(),t.clearMeasurement(),"function"==typeof e&&e(),n()}))})))}addUIEventListeners(){var e;const t=this;null===(e=_(t,M))||void 0===e||e.addEventListener("change",(function(e){const r=t.containerControl;e.target.checked?(r.activateElevationProfile(),e.target.setAttribute("text",t.getLocaleString("deactivateElevationProfile"))):(r.deactivateElevationProfile(),e.target.setAttribute("text",t.getLocaleString("activateElevationProfile")))}),{passive:!0})}getFeatureMeasurementData(e){const t=this,r={units:"m"},n={crs:t.map.options.utmCrs};switch(!0){case e instanceof l.Z:case e instanceof p.Z:r.area=e.getArea(n),r.perimeter=e.getLength(n);break;case e instanceof s.Z:case e instanceof u.Z:r.length=e.getLength(n);break;case e instanceof a.Z:r.coordinates=e.geometry,r.units=t.map.wrap.isGeo()?"degrees":"m";break;case e instanceof c.Z:r.coordinates=e.geometry[0],r.units=t.map.wrap.isGeo()?"degrees":"m"}return r}setFeatureMeasurementData(e){const t=this,r={};switch(!0){case e instanceof a.Z:{const n=_(t,D).coord1Text,i=_(t,D).coord2Text,o=_(t,D).elevationText;Object.prototype.hasOwnProperty.call(_(t,D),"coord1")&&Object.prototype.hasOwnProperty.call(_(t,D),"coord2")&&(r.CRS=t.map.getCRS(),r[n.substr(0,n.indexOf(":"))]=_(t,D).coord1,r[i.substr(0,i.indexOf(":"))]=_(t,D).coord2,o&&(r[t.getLocaleString("ele")]=_(t,D).elevation),e.setData(r));break}case e instanceof s.Z:Object.prototype.hasOwnProperty.call(_(t,D),"length")&&(r[t.getLocaleString("2dLength")]=_(t,D).length,e.setData(r));break;case e instanceof l.Z:Object.prototype.hasOwnProperty.call(_(t,D),"area")&&Object.prototype.hasOwnProperty.call(_(t,D),"perimeter")&&(r[t.getLocaleString("area")]=_(t,D).area,r[t.getLocaleString("2dPerimeter")]=_(t,D).perimeter,e.setData(r))}return t}displayMeasurement(e){const t=this;let r,n,i,a=e;e instanceof o.Z&&(i=e,a=t.getFeatureMeasurementData(e)),t.currentFeature=i,w(t,D,{});let s=a.units;if(a.coordinates){r=d.Z.geom.POINT;const e=function(e,t){const r=Math.pow(10,t);return Math.round(e*r)/r};"m"===s?(n=d.Z.METER_PRECISION,_(t,D).coord1=a.coordinates[0],_(t,D).coord2=a.coordinates[1],_(t,D).coord1Text="x: ",_(t,D).coord2Text="y: "):(n=d.Z.DEGREE_PRECISION,_(t,D).coord1=a.coordinates[1],_(t,D).coord2=a.coordinates[0],_(t,D).coord1Text="lat: ",_(t,D).coord2Text="lon: "),_(t,D).coord1=e(_(t,D).coord1,n),_(t,D).coord2=e(_(t,D).coord2,n),a.coordinates.length>2&&(_(t,D).elevation=Math.round(a.coordinates[2]),_(t,D).elevationText=t.getLocaleString("ele").toLowerCase()+": ")}else Object.prototype.hasOwnProperty.call(a,"area")?(r=d.Z.geom.POLYGON,_(t,D).area=a.area,_(t,D).perimeter=a.perimeter):(r=d.Z.geom.POLYLINE,_(t,D).length=a.length);return t.setMode(r).then((function(){const e=t.map.options.locale||h.Z.locale;if(r===d.Z.geom.POLYGON){let r=_(t,D).area;t.units.forEach((function(n,i,o){const a=n.trim(),s=k.units[a].weight-k.units.m.weight;let l=k.units[a].precision?k.units[a].precision:0;(1===o.length||r>=Math.pow(100,s)/Math.pow(10,l?l-1:l))&&(_(t,R).innerHTML=f.Z.formatNumber((r/Math.pow(100,s)).toFixed(l),e)+" "+k.units[n].abbr)}));let i=_(t,D).perimeter;i>1e3&&(i/=1e3,s="km"),n="m"===s?0:3,_(t,I).innerHTML=f.Z.formatNumber(i.toFixed(n),e)+" "+s}else if(r===d.Z.geom.POLYLINE){let r=_(t,D).length;r>1e3&&(r/=1e3,s="km"),n="m"===s?0:3,_(t,O).innerHTML=f.Z.formatNumber(r.toFixed(n),e)+" "+s}else r===d.Z.geom.POINT&&(_(t,L).innerHTML=_(t,D).coord1Text,_(t,A).innerHTML=_(t,D).coord2Text,_(t,C).innerHTML=f.Z.formatNumber(_(t,D).coord1.toFixed(n),e),_(t,C).dataset.value=_(t,D).coord1,_(t,T).innerHTML=f.Z.formatNumber(_(t,D).coord2.toFixed(n),e),_(t,T).dataset.value=_(t,D).coord2,Object.prototype.hasOwnProperty.call(_(t,D),"elevation")?(_(t,x).innerHTML=_(t,D).elevationText,_(t,P).innerHTML=f.Z.formatNumber(_(t,D).elevation.toFixed(d.Z.METER_PRECISION),e)+" m",_(t,P).dataset.value=_(t,D).elevation):(_(t,x).innerHTML="",_(t,P).innerHTML="",_(t,P).dataset.value=""))})),t}getFormattedCoordinates(){}clearMeasurement(){const e=this;_(e,C)&&(_(e,C).innerHTML=e.NOMEASURE),_(e,T)&&(_(e,T).innerHTML=e.NOMEASURE),_(e,x)&&(_(e,x).innerHTML=""),_(e,P)&&(_(e,P).innerHTML=""),_(e,O)&&(_(e,O).innerHTML=e.NOMEASURE),_(e,I)&&(_(e,I).innerHTML=e.NOMEASURE),_(e,R)&&(_(e,R).innerHTML=e.NOMEASURE)}clear(){this.mode=null}}function F(){this.render()}function U(){this.render()}v(k,"units",{m:{weight:0,abbr:"m&sup2;"},dam:{weight:1,abbr:"dam&sup2;",precision:2},hm:{weight:2,abbr:"hm&sup2;",precision:2},ha:{weight:2,abbr:"ha",precision:3},km:{weight:3,abbr:"km&sup2;",precision:3}}),customElements.get(b)||customElements.define(b,k),i.Z.control.Measurement=k;const B=k},5516:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>$});var n=r(688),i=r(330),o=r(9967),a=r(2461),s=r(3048),l=r(8033),c=r(8683),u=r(1872),p=r(9529),h=r(5265);r(9717);function d(e,t){g(e,t),t.add(e)}function f(e,t,r){g(e,t),t.set(e,r)}function g(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function y(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function m(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,_(e,t,"set"),r),r}function v(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,_(e,t,"get"))}function _(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}function w(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}n.Z.control=n.Z.control||{},i.Z.event.BEFOREFEATUREMODIFY="beforefeaturemodify.tc",i.Z.event.FEATUREMODIFY="featuremodify.tc",i.Z.event.FEATURESSELECT="featuresselect.tc",i.Z.event.FEATURESUNSELECT="featuresunselect.tc",i.Z.event.CHANGE="change";const S=function(e){var t=!1;return(e instanceof h.Z||e instanceof u.Z)&&e.geometry.length>1&&(t=!0),t},E=function(e){return e instanceof p.Z||e instanceof c.Z||e instanceof h.Z||e instanceof u.Z},b="tc-ctl-mod",C="sitna-modify";var L=new WeakMap,T=new WeakMap,A=new WeakMap,x=new WeakMap,P=new WeakMap,O=new WeakMap,I=new WeakMap,R=new WeakMap,M=new WeakMap,D=new WeakMap,N=new WeakMap,Z=new WeakMap,k=new WeakMap,F=new WeakMap,U=new WeakMap,B=new WeakSet,G=new WeakSet,j=new WeakSet,W=new WeakSet,H=new WeakSet;class q extends a.default{constructor(){super(...arguments),d(this,H),d(this,W),d(this,j),d(this,G),d(this,B),y(this,"CLASS",b),f(this,L,{writable:!0,value:".tc-ctl-mod"}),f(this,T,{writable:!0,value:void 0}),f(this,A,{writable:!0,value:void 0}),f(this,x,{writable:!0,value:void 0}),f(this,P,{writable:!0,value:void 0}),f(this,O,{writable:!0,value:void 0}),f(this,I,{writable:!0,value:void 0}),f(this,R,{writable:!0,value:void 0}),f(this,M,{writable:!0,value:void 0}),f(this,D,{writable:!0,value:void 0}),f(this,N,{writable:!0,value:void 0}),f(this,Z,{writable:!0,value:void 0}),f(this,k,{writable:!0,value:void 0}),f(this,F,{writable:!0,value:void 0}),f(this,U,{writable:!0,value:void 0});const e=this;e.wrap=new n.Z.wrap.control.Modify(e),e.initProperty("mode").initProperty("snapping").initProperty("stylable")}static get observedAttributes(){return["mode","stylable"]}attributeChangedCallback(e,t,r){if(t===r)return;const n=this;"stylable"===e&&w(n,G,z).call(n),"mode"===e&&w(n,B,V).call(n)}getClassName(){return b}get snapping(){return this.hasAttribute("snapping")}set snapping(e){this.toggleAttribute("snapping",!!e)}get mode(){const e=this;return e.hasAttribute("mode")?e.getAttribute("mode"):q.mode.SELECT}set mode(e){this.setAttribute("mode",e||q.mode.SELECT)}get stylable(){return this.hasAttribute("stylable")}set stylable(e){this.toggleAttribute("stylable",!!e)}register(e){var t,r,a;const s=this;s.styles=n.Z.Util.extend(!0,{},o.Z.styles.selection,null===(t=e.options.styles)||void 0===t?void 0:t.selection,s.options.styles),s.styles.snapping=n.Z.Util.extend(!0,{},o.Z.styles.snapping,null===(r=e.options.styles)||void 0===r?void 0:r.snapping,null===(a=s.options.styles)||void 0===a?void 0:a.snapping),s.styles.text=s.styles.text||{fontSize:s.styles.line.fontSize,fontColor:s.styles.line.fontColor,labelOutlineColor:s.styles.line.labelOutlineColor,labelOutlineWidth:s.styles.line.labelOutlineWidth};const l=super.register.call(s,e);return s.options.layer&&s.setLayer(s.options.layer),e.on(i.Z.event.FEATUREADD+" "+i.Z.event.FEATURESADD,(function(e){Promise.all([s.getLayer(),s.renderPromise()]).then((function(t){const r=t[0];e.layer===r&&s.setSelectableState(!0)}))})).on(i.Z.event.FEATUREREMOVE+" "+i.Z.event.FEATURESCLEAR,(function(e){const t=e.layer,r=e.feature;Promise.all([s.getLayer(),s.renderPromise()]).then((function(e){t===e[0]&&(r?s.unselectFeatures([r]):s.unselectFeatures(),w(s,W,K).call(s,s.getSelectedFeatures()),0===t.features.length&&(s.setSelectableState(!1),s.setTextMode(!1)))}))})).on(i.Z.event.LAYERUPDATE,(function(e){const t=e.layer;Promise.all([s.getLayer(),s.renderPromise()]).then((function(e){t===e[0]&&w(s,W,K).call(s,s.getSelectedFeatures())}))})),s.on(i.Z.event.FEATURESSELECT+" "+i.Z.event.FEATURESUNSELECT,(function(){const e=s.getSelectedFeatures();w(s,W,K).call(s,e);s.layer.features.filter((function(t){return e.indexOf(t)<0})).forEach((function(e){e.toggleSelectedStyle(!1)})),e.forEach((function(e){e.toggleSelectedStyle(!0)})),s.getAttributeDisplayTarget().classList.contains(i.Z.classes.HIDDEN)||s.displayAttributes(),e.length||s.closeAttributes()})),l}async loadTemplates(){const e=this,t=r.e(4077).then(r.bind(r,4077)),n=r.e(4359).then(r.bind(r,4359)),i={};i[e.CLASS]=(await t).default,i[e.CLASS+"-attr"]=(await n).default,e.template=i}render(e){var t,r,o,a;const s=this,l=s.styles||{},c={stylable:s.stylable,fontSize:null===(t=l.text)||void 0===t?void 0:t.fontSize,fontColor:null===(r=l.text)||void 0===r?void 0:r.fontColor,labelOutlineColor:null===(o=l.text)||void 0===o?void 0:o.labelOutlineColor,labelOutlineWidth:null===(a=l.text)||void 0===a?void 0:a.labelOutlineWidth};return s._set1stRenderPromise(s.renderData(c,(function(){m(s,A,s.querySelector("."+s.CLASS+"-btn-select")),v(s,A).addEventListener(i.Z.event.CLICK,(function(e){e.target.disabled||(s.isActive?s.mode!==q.mode.VERTEX_DELETE?s.deactivate():s.setMode(q.mode.SELECT,!0):s.activate())}),{passive:!0}),m(s,T,s.querySelector("."+s.CLASS+"-btn-delete")),v(s,T).addEventListener(i.Z.event.CLICK,(function(){s.deleteSelectedFeatures()}),{passive:!0}),m(s,x,s.querySelector("."+s.CLASS+"-btn-del-vertex")),v(s,x).addEventListener(i.Z.event.CLICK,(function(){const e=s.mode===q.mode.VERTEX_DELETE?q.mode.SELECT:q.mode.VERTEX_DELETE;s.setMode(e,!0)}),{passive:!0}),m(s,M,s.querySelector("."+s.CLASS+"-btn-text")),v(s,M).addEventListener(i.Z.event.CLICK,(function(){s.setTextMode(!s.textActive)}),{passive:!0}),m(s,I,s.querySelector("."+s.CLASS+"-btn-join")),m(s,R,s.querySelector("."+s.CLASS+"-btn-split")),m(s,P,s.querySelector("."+s.CLASS+"-btn-attr")),v(s,P).addEventListener(i.Z.event.CLICK,(function(){s.toggleAttributes()}),{passive:!0}),m(s,D,s.querySelector("input."+s.CLASS+"-txt")),v(s,D).addEventListener("input",(function(e){s.labelFeatures(e.target.value)})),m(s,Z,s.querySelector("."+s.CLASS+"-style-label")),m(s,N,s.querySelector(v(s,L)+"-fnt-c")),v(s,N).addEventListener(i.Z.event.CHANGE,(function(e){s.setFontColor(e.target.value)})),m(s,F,s.querySelector("."+s.CLASS+"-fnt-s")),v(s,F).addEventListener(i.Z.event.CHANGE,(function(e){s.setFontSize(e.target.value)})),m(s,O,s.querySelector("."+s.CLASS+"-attr")),s.getStyler().then((e=>e.addEventListener(i.Z.event.STYLECHANGE,(e=>{s.getSelectedFeatures().forEach((t=>{const r={};r[e.detail.property]=e.detail.value;const n=Object.assign({},t.getStyle(),r);t.setStyle(n)}))})))),n.Z.Util.isFunction(e)&&e()})))}activate(){const e=this;v(e,A).classList.add(i.Z.classes.ACTIVE),super.activate.call(e),e.wrap.activate(e.mode),w(e,H,X).call(e,e.getSelectedFeatures())}deactivate(){const e=this;super.deactivate.call(e),v(e,A)&&w(e,W,K).call(e,[]),v(e,A)&&(v(e,A).classList.remove(i.Z.classes.ACTIVE),e.layer&&e.unselectFeatures(e.getSelectedFeatures())),e.wrap&&e.wrap.deactivate(),e.mode=q.mode.SELECT}clear(){const e=this;return e.layer&&e.layer.clearFatures(),e}isExclusive(){return!0}end(){return this.wrap.end(),this}setMode(e,t){const r=this;return e&&(r.mode=e),t&&e?(r.layer&&r.layer.map.putLayerOnTop(r.layer),r.activate()):r.deactivate(),r}getLayer(){var e=this;return e.options&&"boolean"==typeof e.options.layer&&!e.options.layer?Promise.resolve(null):e.layer?Promise.resolve(e.layer):v(e,U)}setLayer(e){const t=this;t.map&&(t.setSelectedFeatures([]),m(t,U,new Promise((function(r,n){"string"==typeof e?t.map.loaded((function(){t.layer=t.map.getLayer(e),r(t.layer)})):(!e&&t.isActive&&t.deactivate(),t.layer=e,r(t.layer))}))),Promise.all([v(t,U),t.renderPromise()]).then((function(e){const r=e[0];t.setSelectableState(r&&r.features.length>0)})))}setSelectableState(e){v(this,A).disabled=!e,v(this,M).disabled=!e}getSelectedFeatures(){return this.wrap.getSelectedFeatures()}setSelectedFeatures(e){const t=this.wrap.setSelectedFeatures(e);return this.displayLabelText(),t}getActiveFeatures(){const e=this,t=e.getSelectedFeatures();return!t.length&&e.layer.features.length&&t.push(e.layer.features[e.layer.features.length-1]),t}unselectFeatures(e){return e=e||[],this.wrap.unselectFeatures(e.map((function(e){return e.wrap.feature}))),this}deleteSelectedFeatures(){const e=this,t=e.getSelectedFeatures();return e.wrap.unselectFeatures(t),t.forEach((function(t){e.layer.removeFeature(t),e.trigger(i.Z.event.FEATUREREMOVE,{feature:t})})),e}styleFunction(e,t){var r;const i=this.map.options.styles.selection;switch(!0){case e instanceof p.Z:case e instanceof h.Z:r=n.Z.Util.extend({},i.polygon);break;case e instanceof s.Z:case e instanceof l.Z:r=n.Z.Util.extend({},i.point);break;default:r=n.Z.Util.extend({},i.line)}const o=e.getStyle();return o.label&&(r.label=o.label,r.fontSize=o.fontSize,r.fontColor=o.fontColor,r.labelOutlineColor=o.labelOutlineColor,r.labelOutlineWidth=o.labelOutlineWidth),r}setTextMode(e){const t=this;return t.textActive=e,e?(v(t,M).classList.add(i.Z.classes.ACTIVE,e),v(t,Z).classList.remove(i.Z.classes.HIDDEN)):(v(t,M).classList.remove(i.Z.classes.ACTIVE,e),v(t,Z).classList.add(i.Z.classes.HIDDEN)),t.displayLabelText(),t}setFontColorWatch(e,t){const r=this;return void 0===e&&(e=r.styles.text.fontColor),e=n.Z.Util.colorArrayToString(e),t=t||r.getLabelOutlineColor(e),r.renderPromise().then((function(){v(r,N).value=e,v(r,D).style.color=e,v(r,D).style.textShadow="0 0 "+r.styles.text.labelOutlineWidth+"px "+t,n.Z.browserFeatures.inputTypeColor()||(v(r,N).style.backgroundColor=e,v(r,N).blur())})),r}setFontColor(e){const t=this;t.styles.text.fontColor=e,t.styles.text.labelOutlineColor=t.getLabelOutlineColor(e),t.setFontColorWatch(e,t.styles.text.labelOutlineColor);return t.getActiveFeatures().forEach((function(r){const n=r.getStyle();n.fontColor=e,n.labelOutlineColor=t.styles.text.labelOutlineColor,r.setStyle(n)})),t}setFontSizeWatch(e){const t=this;void 0===e&&(e=t.styles.text.fontSize);const r=parseInt(e);return Number.isNaN(r)||t.renderPromise().then((function(){v(t,F).value=r,v(t,D).style.fontSize=r+"pt"})),t}setFontSize(e){const t=this,r=parseInt(e);if(!Number.isNaN(r)){t.styles.text.fontSize=r,t.setFontSizeWatch(r);t.getActiveFeatures().forEach((function(e){const t=e.getStyle();t.fontSize=r,t.font&&(t.font=t.font.replace(/^\d+/,r)),e.setStyle(t)}))}return t}getLabelOutlineColor(e){if(e){const t=(e=n.Z.Util.colorArrayToString(e)).match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);t&&t.length&&(e="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]);const r=e.match(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i);if(r&&r.length){return(parseInt(r[1],16)+parseInt(r[2],16)+parseInt(r[3],16))/3<128?"#ffffff":"#000000"}}return"#ffffff"}displayLabelText(){const e=this,t=e.getSelectedFeatures();var r,n,i;if(e.isActive&&t.length){const e=t[t.length-1].getStyle();r=e.label,i=e.fontColor,n=e.fontSize}else r="",i=e.styles.text.fontColor,n=e.styles.text.fontSize;return e.renderPromise().then((function(){v(e.setFontSizeWatch(n).setFontColorWatch(i),D).value=r||""})),e}labelFeatures(e){const t=this,r=t.getActiveFeatures();if(r.length){const i=r[0].getStyle();r.forEach((function(r){const o=n.Z.Util.extend({},t.styles.text,i);i.label=e,i.labelOffset=o.labelOffset,i.fontColor=o.fontColor,i.fontSize=o.fontSize,i.labelOutlineColor=o.labelOutlineColor,i.labelOutlineWidth=o.labelOutlineWidth,r.setStyle(i)}))}return t}getAttributeDisplayTarget(){return v(this,O)}async getStyler(){const e=this;return await e.renderPromise(),m(e,k,e.querySelector("sitna-feature-styler")),v(e,k)}displayAttributes(){const e=this,t=e.getSelectedFeatures(),r=t[t.length-1];r&&e.getRenderedHtml(e.CLASS+"-attr",{data:r.getData()},(function(t){const r=e.getAttributeDisplayTarget();r.innerHTML=t,r.classList.remove(i.Z.classes.HIDDEN),v(e,P).classList.add(i.Z.classes.ACTIVE),r.querySelector(`${e.CLASS}-btn-attr-ok`).addEventListener(i.Z.event.CLICK,(function(t){e._onAttrOK()}),{passive:!0}),r.querySelector(`.${e.modifyControl.CLASS}-btn-attr-cancel`).addEventListener(i.Z.event.CLICK,(function(){e.closeAttributes()}),{passive:!0})}))}closeAttributes(){var e,t;null===(e=v(this,O))||void 0===e||e.classList.add(i.Z.classes.HIDDEN),null===(t=v(this,P))||void 0===t||t.classList.remove(i.Z.classes.ACTIVE)}toggleAttributes(){const e=this;v(e,P).classList.toggle(i.Z.classes.ACTIVE)?e.displayAttributes():e.closeAttributes()}_onAttrOK(){const e=this,t=e.getSelectedFeatures()[0];if(t){const r={};e.getAttributeDisplayTarget().querySelectorAll("input").forEach((function(e){r[e.getAttribute("name")]=e.value})),t.setData(r),e.trigger(i.Z.event.FEATUREMODIFY,{feature:t,layer:e.layer}),e.closeAttributes()}}joinFeatures(e){const t=this;if(t.geometryType===i.Z.geom.MULTIPOLYLINE||t.geometryType===i.Z.geom.MULTIPOLYGON||t.geometryType===i.Z.geom.MULTIPOINT){let s;if(t._joinedFeatureAttributes=[],e.length>1){var r=e.map((function(e){return t._joinedFeatureAttributes.push(e.getData()),e.geometry})).reduce((function(e,t){return e.concat(t)}));s=new e[0].constructor(r);for(var n=0,o=e.length;n<o;n++){var a=e[n];t.layer.removeFeature(a),t.trigger(i.Z.event.FEATUREREMOVE,{feature:a})}t.layer.addFeature(s).then((function(e){t.setSelectedFeatures([s]),t.trigger(i.Z.event.FEATUREADD,{feature:e}),e.showPopup(t.attributeEditor)}))}w(t,W,K).call(t,[s])}}}async function V(){const e=this;await e.renderPromise(),w(e,H,X).call(e,e.getSelectedFeatures())}function z(){var e;const t=this;null===(e=w(t,j,Y).call(t))||void 0===e||e.classList.toggle(i.Z.classes.HIDDEN,!(t.stylable&&t.getSelectedFeatures().length))}function Y(){return this.querySelector(`.${this.CLASS}-style`)}function K(e){const t=this;v(t,T).disabled=0===e.length,v(t,x).disabled=!e.some(E),v(t,P).disabled=1!==e.length,v(t,I).disabled=e.length<2,v(t,R).disabled=!e.some(S),t.displayLabelText(),w(t,G,z).call(t),t.getStyler().then((t=>t.setFeature(e[0])))}function X(e){const t=this;v(t,x).disabled=!e.some(E);const r=t.mode;v(t,x).classList.toggle(i.Z.classes.ACTIVE,r===q.mode.VERTEX_DELETE),v(t,A).classList.toggle(i.Z.classes.ACTIVE,r!==q.mode.VERTEX_DELETE)}y(q,"mode",{SELECT:"select",VERTEX_DELETE:"vertex_delete"}),customElements.get(C)||customElements.define(C,q),n.Z.control.Modify=q;const $=q},1391:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var n=r(688),i=r(330),o=r(268),a=r(7497),s=r(4094);n.Z.control=n.Z.control||{};const l=function(e,t){return e?(!0===e&&(e={}),o.Z.extend(!0,e,t)):e};class c extends s.default{constructor(){super(...arguments);const e=this;e.div.classList.remove(super.CLASS),e.div.classList.add(e.CLASS),e.modes=e.options.modes||{},void 0===e.modes[i.Z.geom.POINT]&&(e.modes[i.Z.geom.POINT]=!0),void 0===e.modes[i.Z.geom.POLYGON]&&(e.modes[i.Z.geom.POLYGON]=!0),e.featureInfoControl=null,e.lineFeatureInfoControl=null,e.polygonFeatureInfoControl=null,e.featureInfoControls=[],e.lastCtrlActive=null,e.popup=null,e.exportsState=!1}getClassName(){return"tc-ctl-m-finfo"}async register(e){const t=this;t.div.querySelectorAll("input[type=radio]").forEach((function(e){e.checked=!1}));const r=[a.Z.prototype.register.call(t,e)],n=t.options.styles||{},o=t.modes[i.Z.geom.POINT],s=t.modes[i.Z.geom.POLYLINE],c=t.modes[i.Z.geom.POLYGON];return o&&r.push(e.addControl("featureInfo",l(t.modes[i.Z.geom.POINT],{id:t.getUID(),displayMode:t.options.displayMode,persistentHighlights:t.options.persistentHighlights,share:t.options.share})).then((function(e){return t.featureInfoControl=e,t.featureInfoControls.push(e),e}))),t.modes[i.Z.geom.POLYLINE]&&r.push(e.addControl("lineFeatureInfo",l(t.modes[i.Z.geom.POLYLINE],{id:t.getUID(),active:s.active,displayMode:t.options.displayMode,persistentHighlights:t.options.persistentHighlights,share:t.options.share,style:s.filterStyle||n.line})).then((function(e){return t.lineFeatureInfoControl=e,t.featureInfoControls.push(e),e}))),t.modes[i.Z.geom.POLYGON]&&r.push(e.addControl("polygonFeatureInfo",l(t.modes[i.Z.geom.POLYGON],{id:t.getUID(),active:c.active,displayMode:t.options.displayMode,persistentHighlights:t.options.persistentHighlights,share:t.options.share,style:c.filterStyle||n.polygon})).then((function(e){return t.polygonFeatureInfoControl=e,t.featureInfoControls.push(e),e}))),e.on(`${i.Z.event.LAYERADD} ${i.Z.event.LAYERREMOVE} ${i.Z.event.LAYERVISIBILITY}`,(function(e){t.updateUI()})),e.on(`${i.Z.event.CONTROLACTIVATE} ${i.Z.event.CONTROLDEACTIVATE}`,(function(e){e.control!==t.featureInfoControl&&e.control!==t.lineFeatureInfoControl&&e.control!==t.polygonFeatureInfoControl||t.updateUI()})),await Promise.all(r),t.featureInfoControl&&(t.featureInfoControl.activate(),t.lastCtrlActive=t.featureInfoControl),t.updateUI(),t}async loadTemplates(){const e=await r.e(9389).then(r.bind(r,9389));this.template=e.default}render(e){const t=this;var r={controlId:t.id};return t.modes[i.Z.geom.POINT]&&(r.pointSelectValue=i.Z.geom.POINT),t.modes[i.Z.geom.POLYLINE]&&(r.lineSelectValue=i.Z.geom.POLYLINE),t.modes[i.Z.geom.POLYGON]&&(r.polygonSelectValue=i.Z.geom.POLYGON),t._set1stRenderPromise(t.renderData(r,(function(){var r=function(){switch(this.value){case i.Z.geom.POLYLINE:t.lineFeatureInfoControl.activate(),t.lastCtrlActive=t.lineFeatureInfoControl;break;case i.Z.geom.POLYGON:t.polygonFeatureInfoControl.activate(),t.lastCtrlActive=t.polygonFeatureInfoControl;break;default:t.featureInfoControl.activate(),t.lastCtrlActive=t.featureInfoControl}};t.div.querySelectorAll("input[type=radio]").forEach((function(e){e.addEventListener("change",r)}));t.div.querySelector(`.${t.CLASS}-btn-remove`).addEventListener(i.Z.event.CLICK,(function(e){t.featureInfoControls.forEach((e=>{e.resultsLayer.features.slice().forEach((t=>e.downplayFeature(t))),e.filterLayer.features.slice().forEach((e=>e.layer.removeFeature(e)))}))}),{passive:!0}),t.div.querySelector(`.${t.CLASS}-btn-dl`).addEventListener(i.Z.event.CLICK,(async function(e){const r=await t.getDownloadDialog();let n={title:t.getLocaleString("featureInfo")+" - "+t.getLocaleString("download"),fileName:t._getFileName()};(t.map.elevation||t.options.displayElevation)&&(n=Object.assign({},n,{elevation:Object.assign({},t.map.elevation&&t.map.elevation.options,t.options.displayElevation)})),r.open(Array.prototype.concat.apply([],t.featureInfoControls.map((e=>e.resultsLayer.features))),n)}),{passive:!0}),t.div.querySelector(`.${t.CLASS}-btn-zoom`).addEventListener(i.Z.event.CLICK,(function(e){var r=t.featureInfoControls.reduce(((e,t)=>e.concat(t.resultsLayer.features)),[]);t.map.zoomToFeatures(r)}),{passive:!0}),t.map.on(i.Z.event.FEATUREREMOVE,(function(e){t.featureInfoControls.some((t=>t.resultsLayer===e.layer||t.filterLayer===e.layer))&&t.updateUI()})).on(i.Z.event.FEATUREADD+" "+i.Z.event.FEATURESADD,(function(e){t.featureInfoControls.some((t=>t.resultsLayer===e.layer||t.filterLayer===e.layer))&&t.updateUI()})),o.Z.isFunction(e)&&e()})))}activate(){const e=this;e.lastCtrlActive&&e.lastCtrlActive.activate()}deactivate(){this.lastCtrlActive.deactivate(!1)}updateUI(){const e=this;e.renderPromise().then((function(){const t=e.map.workLayers.some((e=>e.type===i.Z.layerType.WMS&&e.getVisibility()));if(e.div.querySelectorAll("input").forEach((function(e){e.disabled=!t})),e.featureInfoControl){const r=e.div.querySelector(`input[value=${i.Z.geom.POINT}]`);r&&(t||!e.lineFeatureInfoControl.isActive&&!e.polygonFeatureInfoControl.isActive||e.featureInfoControl.activate(),r.checked=e.featureInfoControl.isActive)}if(e.lineFeatureInfoControl){const t=e.div.querySelector(`input[value=${i.Z.geom.POLYLINE}]`);t&&(t.checked=e.lineFeatureInfoControl.isActive)}if(e.polygonFeatureInfoControl){const t=e.div.querySelector(`input[value=${i.Z.geom.POLYGON}]`);t&&(t.checked=e.polygonFeatureInfoControl.isActive)}const r=e.featureInfoControls.some((e=>e.options.persistentHighlights)),n=e.featureInfoControls.every((e=>!(e.resultsLayer&&0!==e.resultsLayer.features.length||e.filterLayer&&0!==e.filterLayer.features.length))),o=e.div.querySelector(`.${e.CLASS}-btn-remove`);o.classList.toggle(i.Z.classes.HIDDEN,!r),o.disabled=n;const a=e.div.querySelector(`.${e.CLASS}-btn-dl`);a.classList.toggle(i.Z.classes.HIDDEN,!r),a.disabled=n;const s=e.div.querySelector(`.${e.CLASS}-btn-zoom`);s.classList.toggle(i.Z.classes.HIDDEN,!r),s.disabled=n;const l=e.div.style.display;e.div.style.display="none",l?e.div.style.display=l:e.div.style.removeProperty("display")}))}}n.Z.control.MultiFeatureInfo=c;const u=c},4234:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var n=r(688),i=r(7497);n.Z.control=n.Z.control||{};class o extends i.Z{constructor(){super(...arguments);this.div.classList.add(this.CLASS)}getClassName(){return"tc-ctl-nav"}render(){const e=this;return e.wrap||(e.wrap=new n.Z.wrap.control.NavBar(e)),e._set1stRenderPromise(Promise.resolve())}async register(e){const t=this,r=super.register.call(t,e);return t.wrap.register(e),(void 0===t.options.home||t.options.home)&&await e.addControl("navBarHome"),e.loaded((function(){t.wrap.refresh()})),await r,t}}n.Z.control.NavBar=o;const a=o},2855:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var n=r(688),i=r(330),o=r(7497);n.Z.control=n.Z.control||{};class a extends o.Z{constructor(){super(...arguments);this.div.classList.add(this.CLASS)}getClassName(){return"tc-ctl-nav-home"}render(){const e=this;return e.wrap||(e.wrap=new n.Z.wrap.control.NavBarHome(e)),Promise.resolve()}async register(e){const t=this;return await super.register.call(t,e),t.wrap.register(e),e.on(i.Z.event.PROJECTIONCHANGE,(function(r){const i=r.newCrs,o=n.Z.Util.reproject([e.options.initialExtent[0],e.options.initialExtent[1]],e.options.crs,i),a=n.Z.Util.reproject([e.options.initialExtent[2],e.options.initialExtent[3]],e.options.crs,i);t.wrap.setInitialExtent([o[0],o[1],a[0],a[1]])})),t}}n.Z.control.NavBarHome=a;const s=a},6994:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var n=r(688),i=r(330),o=r(9967),a=r(7497),s=r(5515),l=r(9614),c=r.n(l);n.Z.control=n.Z.control||{};const u=function(e){return decodeURIComponent(e).split(",").map((function(e){return parseFloat(e)}))},p=function(){var e=this;s.default.apply(this,arguments);var t=e._classSelector="."+e.CLASS;e._selectors={DRAW:t+"-draw",DRAWING:t+"-drawing",PROGRESS:t+"-progress",NEW:t+"-new",LIST:t+"-list",LISTITEM:t+"-list > li",OKBTN:t+"-btn-ok",NEWBTN:t+"-btn-new",SAVEBTN:".tc-btn-save",CANCELBTN:".tc-btn-cancel",EDITBTN:".tc-btn-edit",VIEWBTN:".tc-btn-view",DELETEBTN:".tc-btn-delete",TILECOUNT:t+"-tile-count",NAMETB:t+"-txt-name",TEXTBOX:"input.tc-textbox",EXIT:t+"-link-exit",OFFPANEL:t+"-off-panel",RESOLUTIONPANEL:t+"-res-panel",BLLIST:t+"-bl-list",BLLISTITEM:t+"-bl-list > li",BLLISTTEXT:t+"-bl-panel-txt",RNGMAXRES:t+"-rng-maxres",SEARCH:t+"-map-available-srch",EMPTYLIST:t+"-map-available-empty",OFFLINEHIDDEN:"[data-no-cb]"},e.storedMaps=[];const r=n.Z.Util.getParameterByName(e.MAP_DEFINITION_PARAM_NAME),l=n.Z.Util.getParameterByName(e.MAP_EXTENT_PARAM_NAME);e.mapIsOffline=!!r,r&&(e.currentMapDefinition=JSON.parse(window.atob(decodeURIComponent(r)))),l&&(e.currentMapExtent=u(l));try{e.localStorage=window.localStorage;const t="__delete_me__";e.localStorage.setItem(t,t),e.localStorage.removeItem(t)}catch(t){e.localStorage=null,n.Z.error(e.getLocaleString("couldNotAccessLocalStorage"))}if(e.localStorage){for(var c=0,p=e.localStorage.length;c<p;c++){var h=e.localStorage.key(c);if(0===h.indexOf(e.LOCAL_STORAGE_KEY_PREFIX)&&h!==e.LOCAL_STORAGE_KEY_PREFIX+e.ROOT_CACHE_NAME+".hash"){var d=e.localStorage.getItem(h).split(" "),f=u(d.shift()),g=d.join(" "),y={name:g,extent:f,url:decodeURIComponent(h.substr(e.LOCAL_STORAGE_KEY_PREFIX.length))};e.storedMaps.push(y)}}e.storedMaps.sort((function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}))}var m=n.Z.Util.extend({},arguments.length>1?arguments[1]:arguments[0]);e._dialogDiv=n.Z.Util.getDiv(m.dialogDiv),window.$&&(e._$dialogDiv=$(e._dialogDiv)),m.dialogDiv||document.body.appendChild(e._dialogDiv),e.mapIsOffline&&document.querySelectorAll(e._selectors.OFFLINEHIDDEN).forEach((function(e){e.classList.add(i.Z.classes.HIDDEN)})),a.Z.apply(e,arguments),e.wrap=new n.Z.wrap.control.OfflineMapMaker(e),e.isDownloading=!1,e.baseLayers=[],e.options.averageTileSize=e.options.averageTileSize||o.Z.averageTileSize,e.requestSchemas=[],e.minResolution=0,e.currentMap=null,e._loadedCount=0;var v=history.pushState;history.pushState=function(t){var r;return r=v.apply(history,arguments),e._offlineMapHintDiv&&e._offlineMapHintDiv.querySelector(e._selectors.EXIT).setAttribute("href",e.getOnlineMapUrl()),r};var _=navigator.connection||navigator.mozConnection||navigator.webkitConnection||{};const w=function(){if(e._offlineMapHintDiv){const t=e._offlineMapHintDiv.querySelector(e._selectors.OFFPANEL);switch(t.classList.remove(i.Z.classes.CONNECTION_OFFLINE,i.Z.classes.CONNECTION_MOBILE,i.Z.classes.CONNECTION_WIFI),_.type){case 1:case 2:case void 0:t.classList.add(i.Z.classes.CONNECTION_WIFI);break;default:t.classList.add(i.Z.classes.CONNECTION_MOBILE)}}},S=function(){if(e._offlineMapHintDiv){const t=e._offlineMapHintDiv.querySelector(e._selectors.OFFPANEL);t.classList.add(i.Z.classes.CONNECTION_OFFLINE),t.classList.remove(i.Z.classes.CONNECTION_MOBILE,i.Z.classes.CONNECTION_WIFI)}};_.addEventListener&&_.addEventListener("typechange",w),window.addEventListener("online",w),window.addEventListener("offline",S),e.renderPromise().then((()=>{navigator.onLine||S()}))};n.Z.inherit(p,s.default),function(){i.Z.classes.CONNECTION_OFFLINE=i.Z.classes.CONNECTION_OFFLINE||"tc-conn-offline",i.Z.classes.CONNECTION_WIFI=i.Z.classes.CONNECTION_WIFI||"tc-conn-wifi",i.Z.classes.CONNECTION_MOBILE=i.Z.classes.CONNECTION_MOBILE||"tc-conn-mobile",i.Z.classes.OFFLINE=i.Z.classes.OFFLINE||"tc-offline";var e=p.prototype;e.CLASS="tc-ctl-omm",e.MAP_DEFINITION_PARAM_NAME="map-def",e.MAP_EXTENT_PARAM_NAME="map-extent",e.LOCAL_STORAGE_KEY_PREFIX="TC.offline.map.",e.ROOT_CACHE_NAME="root",e.SERVICE_WORKER_FLAG="sw",e._states={READY:"ready",EDIT:"editing",DOWNLOADING:"downloading",DELETING:"deleting"},e._actions={CREATE:"create",DELETE:"delete"},e.offlineControls=["attribution","basemapSelector","offlineMapMaker","click","coordinates","dataLoader","draw","edit","fileImport","fullScreen","geolocation","loadingIndicator","measure","modify","navBar","popup","print","scale","scaleBar","scaleSelector","state","workLayerManager"],i.Z.event.MAPCACHEDOWNLOAD=i.Z.event.MAPCACHEDOWNLOAD||"mapcachedownload.tc",i.Z.event.MAPCACHEDELETE=i.Z.event.MAPCACHEDELETE||"mapcachedelete.tc",i.Z.event.MAPCACHEPROGRESS=i.Z.event.MAPCACHEPROGRESS||"mapcacheprogress.tc",i.Z.event.MAPCACHEERROR=i.Z.event.MAPCACHEERROR||"mapcacheerror.tc";const t=function(e,t){t.querySelector("span").classList.remove(i.Z.classes.HIDDEN),t.querySelector(e._selectors.TEXTBOX).classList.add(i.Z.classes.HIDDEN),t.querySelector(e._selectors.SAVEBTN).classList.add(i.Z.classes.HIDDEN),t.querySelector(e._selectors.CANCELBTN).classList.add(i.Z.classes.HIDDEN),t.querySelector(e._selectors.EDITBTN).classList.remove(i.Z.classes.HIDDEN),t.querySelector(e._selectors.VIEWBTN).classList.remove(i.Z.classes.HIDDEN),t.querySelector(e._selectors.DELETEBTN).classList.remove(i.Z.classes.HIDDEN)};var a=function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")},l=function(e,t){var r=t||{};const n=e._dialogDiv.querySelector(e._classSelector+"-res"),a=e._dialogDiv.querySelector(e._selectors.RNGMAXRES);var s,l,c,u=e.getResolutions();if(u.length){if(a.setAttribute("max",u.length-1),e.minResolution){if(void 0===r.rangeValue)for(var p=0,h=u.length;p<h;p++)if(e.minResolution>=u[p]){a.value=p;break}}else if(void 0===r.rangeValue){const t=e.map.getResolution();a.value=u.filter((e=>e>t)).length}l=parseInt(a.value);var d=Math.floor(1e3*new Number(u[l]))/1e3;s=e.getLocaleString("metersPerPixel",{value:d.toLocaleString((e.map?e.map.options.locale:o.Z.locale).replace("_","-"))}),c=100*(l+1)/(u.length+1)+"%",a.disabled=!1,e.minResolution=u[a.value]}else l=0,s="",a.value=0,c="0",e.minResolution=0,a.disabled=!0;e._dialogDiv.querySelector(e._selectors.RESOLUTIONPANEL).classList.toggle(i.Z.classes.HIDDEN,!!a.disabled),e._dialogDiv.querySelector(e._selectors.TILECOUNT).classList.toggle(i.Z.classes.HIDDEN,!!a.disabled),n.style.left=c,n.innerHTML=s};const h=function(e){e._dialogDiv.querySelectorAll(e._classSelector+"-bl-node input[type=checkbox]").forEach((function(t,r){if(t.checked){var n=e.requestSchemas.find((function(e){return e.layerId===t.value}));if(n){var i=function(e,t){for(var r=null,n=0,i=e.tileMatrixLimits.length;n<i&&!((r=e.tileMatrixLimits[n]).res<=t);n++);return r}(n,e.minResolution);if(i){const r="{TileMatrixSet}",u="{TileMatrix}",p="{TileRow}",h="{TileCol}";var o=n.url;if(o.indexOf(u)<0){var a=o.indexOf("?");a>=0&&(o=o.substr(0,a));for(var s=0,l=e.baseLayers.length;s<l;s++){var c=e.baseLayers[s];if(c.id===n.layerId){o=o+"?layer="+c.layerNames+"&style=default&tilematrixset="+r+"&Service=WMTS&Request=GetTile&Version=1.0.0&Format="+c.format+"&TileMatrix="+u+"&TileRow="+p+"&TileCol="+h;break}}}for(;t&&"LABEL"!==t.tagName;)t=t.parentElement;t&&(t.style.backgroundSize="auto",t.style.backgroundPosition="left bottom",t.style.backgroundImage="url("+o.replace(r,n.tileMatrixSet).replace(u,i.mId).replace(p,i.rt).replace(h,i.cl)+")")}}}}))},d=function(e,t){return t<1?e.getLocaleString("lessThan1Mb"):e.getLocaleString("approxXMb",{quantity:a(t)})},f=function(e){var t="";e.tileCount=0;for(var r=0,n=e.requestSchemas.length;r<n;r++)for(var i=e.requestSchemas[r],o=0,s=i.tileMatrixLimits.length;o<s;o++){var l=i.tileMatrixLimits[o];if(l.res<e.minResolution)break;e.tileCount+=(l.cr-l.cl+1)*(l.rb-l.rt+1)}e.tileCount&&(e.estimatedMapSize=Math.round(e.tileCount*e.options.averageTileSize/1048576),t=e.getLocaleString("xTiles",{quantity:a(e.tileCount)})+" ("+d(e,e.estimatedMapSize)+")"),e._dialogDiv.querySelector(e._selectors.TILECOUNT).innerHTML=t},g=function(e,t){var r=t.indexOf("#");r>=0&&(t=t.substr(0,r));const n=e.div.querySelectorAll(e._selectors.LISTITEM);for(var i=0,o=n.length;i<o;i++){const e=n[i],r=e.querySelector("a");if(r&&r.getAttribute("href")===t)return e}return null};var y=function(e,t){var r=!1;return e.localStorage&&(e.localStorage.setItem(e.LOCAL_STORAGE_KEY_PREFIX+encodeURIComponent(t.url),t.extent+" "+t.name),r=!0),r};const m=function(e,t){const r=e.findStoredMap({url:t});if(r){if(function(e,t){var r=!1;return e.localStorage&&(e.localStorage.removeItem(e.LOCAL_STORAGE_KEY_PREFIX+encodeURIComponent(t)),r=!0),r}(e,t)){const t=function(e,t){const r=e.div.querySelectorAll(e._selectors.LISTITEM);for(var n=0,i=r.length;n<i;n++){const e=r[n],i=e.querySelector("a");if(i&&i.innerHTML===t)return e}return null}(e,r.name);t&&t.parentElement.removeChild(t)}var n=e.storedMaps.indexOf(r);return e.storedMaps.splice(n,1),e.storedMaps.length||(e.div.querySelector(e._selectors.SEARCH).disabled=!0,e.div.querySelector(e._selectors.EMPTYLIST).removeAttribute("hidden")),e.layer.features.filter((e=>e.data.map===r.name)).forEach((t=>e.layer.removeFeature(t))),r.name}return null};e.loadTemplates=async function(){const e=this,t=r.e(7507).then(r.bind(r,7507)),n=r.e(8278).then(r.bind(r,8278)),i=r.e(898).then(r.bind(r,898)),o=r.e(5181).then(r.bind(r,5181)),a=r.e(580).then(r.bind(r,580)),s={};s[e.CLASS]=(await t).default,s[e.CLASS+"-map-node"]=(await n).default,s[e.CLASS+"-bl-node"]=(await i).default,s[e.CLASS+"-dialog"]=(await o).default,s[e.CLASS+"-off-panel"]=(await a).default,e.template=s},e.render=function(e){const r=this;return r._set1stRenderPromise(new Promise((function(o,a){var s={storedMaps:r.storedMaps,listId:r.CLASS+"-list-"+n.Z.getUID()};r.getRenderedHtml(r.CLASS+"-dialog",null,(function(e){r._dialogDiv.innerHTML=e,r._dialogDiv.querySelector(r._selectors.NAMETB).addEventListener(i.Z.event.CLICK,(function(e){e.preventDefault(),this.selectionStart=0,this.selectionEnd=this.value.length,this.focus()}))})).then((function(){r.renderData(s,(function(){r._dialogDiv.querySelector(r._selectors.OKBTN).addEventListener(i.Z.event.CLICK,(function(){r.generateCache()}),{passive:!0}),r._dialogDiv.querySelector(r._selectors.NAMETB).addEventListener("input",(function(){r._updateReadyState()})),r.div.querySelector(r._selectors.NEWBTN).addEventListener(i.Z.event.CLICK,(function(){r.setEditState()}),{passive:!0}),r.div.querySelector(r._classSelector+"-btn-cancel-draw").addEventListener(i.Z.event.CLICK,(function(){r.setReadyState()}),{passive:!0}),r.div.querySelector(r._classSelector+"-btn-cancel-dl").addEventListener(i.Z.event.CLICK,(function(){r.cancelCacheRequest()}),{passive:!0});const o=r.div.querySelector(r._selectors.LIST);o.addEventListener(i.Z.event.CLICK,n.Z.EventTarget.listenerBySelector(r._selectors.DELETEBTN,(function(e){r.startDeleteMap(e.target.parentElement.querySelector("a").innerHTML)})),{passive:!0}),o.addEventListener(i.Z.event.CLICK,n.Z.EventTarget.listenerBySelector(r._selectors.EDITBTN,(function(e){!function(e,t){t.querySelector("span").classList.add(i.Z.classes.HIDDEN);const r=t.querySelector(e._selectors.TEXTBOX);r.classList.remove(i.Z.classes.HIDDEN),r.value=t.querySelector("span a").innerHTML,r.focus(),t.querySelector(e._selectors.SAVEBTN).classList.remove(i.Z.classes.HIDDEN),t.querySelector(e._selectors.CANCELBTN).classList.remove(i.Z.classes.HIDDEN),t.querySelector(e._selectors.EDITBTN).classList.add(i.Z.classes.HIDDEN),t.querySelector(e._selectors.VIEWBTN).classList.add(i.Z.classes.HIDDEN),t.querySelector(e._selectors.DELETEBTN).classList.add(i.Z.classes.HIDDEN)}(r,e.target.parentElement)})),{passive:!0}),o.addEventListener(i.Z.event.CLICK,n.Z.EventTarget.listenerBySelector(r._selectors.CANCELBTN,(function(e){const n=e.target.parentElement;n.querySelector(r._selectors.TEXTBOX).value=n.querySelector("a").innerHTML,t(r,n)})),{passive:!0}),o.addEventListener(i.Z.event.CLICK,n.Z.EventTarget.listenerBySelector(r._selectors.SAVEBTN,(function(e){const n=e.target.parentElement;t(r,n);const i=n.querySelector("a"),o=n.querySelector(r._selectors.TEXTBOX).value,a=r.findStoredMap({url:i.getAttribute("href")});a&&(a.name=o,i.innerHTML=o,i.setAttribute("title",o),y(r,a))})),{passive:!0}),o.addEventListener(i.Z.event.CLICK,n.Z.EventTarget.listenerBySelector(r._selectors.VIEWBTN,(function(e){const t=e.target;var n=!t.classList.contains(i.Z.classes.ACTIVE);r.div.querySelectorAll(r._selectors.VIEWBTN).forEach((e=>e.classList.remove(i.Z.classes.ACTIVE)));const o=t.parentElement.querySelector("a").innerHTML;if(o){var a=r.findStoredMap({name:o});if(a){var s=u(a.extent);r.layer.clearFeatures(),n&&(r.layer.addPolygon([[[s[0],s[1]],[s[0],s[3]],[s[2],s[3]],[s[2],s[1]]]],{showsPopup:!1,data:{map:a.name}}).then((function(){r.layer.map.zoomToFeatures(r.layer.features)})),t.classList.add(i.Z.classes.ACTIVE),t.setAttribute("title",r.getLocaleString("removeMapExtent")))}}})),{passive:!0});const a=r.div.querySelector(r._selectors.SEARCH),s=function(){!function(e){e=e.toLowerCase();const t=r.div.querySelectorAll(r._selectors.LISTITEM);t.forEach((function(e){e.style.display="none"}));const n=[];if(t.forEach((function(e){e.matches("li:not([class]),li."+i.Z.classes.ACTIVE)&&n.push(e)})),0===e.length)n.forEach((function(e){e.style.removeProperty("display")})),r.div.querySelector(r._classSelector+"-map-search-icon").style.visibility="visible";else{r.div.querySelector(r._classSelector+"-map-search-icon").style.visibility="hidden";var o=new RegExp(e,"i");n.forEach((function(e){e.style.display=o.test(e.querySelector("a").textContent)?"":"none"})),n.some((function(e){return!e.hidden}))||t.forEach((function(e){e.matches('[class^="tc-ctl-omm-map-not"]')&&e.style.removeProperty("display")}))}}(this.value.toLowerCase().trim())};a.addEventListener("keyup",s),a.addEventListener("search",s),r._dialogDiv.querySelector(r._selectors.BLLIST).addEventListener("change",n.Z.EventTarget.listenerBySelector("input[type=checkbox]",(function(e){const t=e.target;if(t.checked)r.baseLayers.push(r.map.getLayer(t.value));else for(var n=0,i=r.baseLayers.length;n<i;n++){if(r.baseLayers[n].id===t.value){r.baseLayers.splice(n,1);break}}r.updateRequestSchemas(),l(r),h(r),r._updateReadyState(),f(r)})));const c=r._dialogDiv.querySelector(r._selectors.RNGMAXRES),p=function(e){l(r,{rangeValue:e.target.value}),h(r),f(r)};c.addEventListener("input",p),c.addEventListener("change",p);const d=g(r,location.href);d&&d.classList.add(i.Z.classes.ACTIVE),n.Z.Util.isFunction(e)&&e()})).then((function(){o()})).catch((function(e){a(e instanceof Error?e:Error(e))}))})),window.addEventListener("beforeunload",(function(e){if(r.isDownloading){var t=r.getLocaleString("cb.mapDownloading.warning");return e.returnValue=t,t}}),!0)})))},e.register=async function(e){const t=this,r=s.default.prototype.register.call(t,e);t.getServiceWorker().then((function(){navigator.serviceWorker.ready.then((function(){navigator.serviceWorker.addEventListener("message",(function(e){switch(e.data.event){case"progress":t.trigger(i.Z.event.MAPCACHEPROGRESS,{url:e.data.name,requestId:e.data.requestId,loaded:e.data.count,total:e.data.total});break;case"cached":t.trigger(i.Z.event.MAPCACHEDOWNLOAD,{url:e.data.name,requestId:e.data.requestId});break;case"deleted":t.trigger(i.Z.event.MAPCACHEDELETE,{url:e.data.name});break;case"error":e.data.action===t._actions.CREATE&&n.Z.error(t.getLocaleString("cb.resourceDownload.error",{url:e.data.url}))}}))})),navigator.onLine&&async function(){const e=document.documentElement.getAttribute("manifest")||"manifest.appcache";let t=(await n.Z.ajax({url:n.Z.Util.addURLParameters(e,{ts:Date.now()}),method:"GET",responseType:"text"})).data.normalize();var r=c()(t),i=t.indexOf("NETWORK:");i>=0&&(t=t.substr(0,i)),(i=t.indexOf("FALLBACK:"))>=0&&(t=t.substr(0,i)),(i=t.indexOf("SETTINGS:"))>=0&&(t=t.substr(0,i));var o=t.split(/[\n\r]/).filter((function(e){return e.length>0&&0!==e.indexOf("#")&&"CACHE:"!==e}));return o.shift(),{hash:r,urls:o}}().then((function(e){const r=t.LOCAL_STORAGE_KEY_PREFIX+t.ROOT_CACHE_NAME+".hash";var o;if(t.localStorage&&(o=t.localStorage.getItem(r)),o!==e.hash){const a=!o,s=t.cacheUrlList(e.urls),l=function(o){o.requestId===s&&(t.localStorage&&t.localStorage.setItem(r,e.hash),a||n.Z.confirm(t.getLocaleString("newAppVersionAvailable"),(function(){location.reload()})),t.off(i.Z.event.MAPCACHEDOWNLOAD,l))};t.on(i.Z.event.MAPCACHEDOWNLOAD,l)}}))}),(function(e){t.renderPromise().then((function(){const r=t.div.querySelector(`.${t.CLASS}-new`),n=document.createElement("div");n.classList.add("tc-alert","tc-alert-warning");const o=document.createElement("p"),a=document.createElement("strong");a.innerHTML=t.getLocaleString("offlineMap.error"),o.appendChild(a);const s=document.createElement("p");s.innerHTML=e.message,n.appendChild(o),n.appendChild(s),r.querySelector(t._selectors.NEWBTN).classList.add(i.Z.classes.HIDDEN),r.appendChild(n)}))})).catch((()=>console.log("No SW available: no events handled"))),t.mapIsOffline&&(e.div.classList.add(i.Z.classes.OFFLINE),t.getRenderedHtml(t.CLASS+"-off-panel",{url:t.getOnlineMapUrl()},(function(r){if(t._offlineMapHintDiv=n.Z.Util.getDiv(t.options.offlineMapHintDiv),t.options.offlineMapHintDiv||e.div.appendChild(t._offlineMapHintDiv),t._offlineMapHintDiv.innerHTML=r,!navigator.onLine){const e=t._offlineMapHintDiv.querySelector(t._selectors.OFFPANEL);e.classList.add(i.Z.classes.CONNECTION_OFFLINE),e.classList.remove(i.Z.classes.CONNECTION_MOBILE,i.Z.classes.CONNECTION_WIFI)}t._offlineMapHintDiv.querySelector(t._selectors.EXIT).addEventListener(i.Z.event.CLICK,(function(e){n.Z.confirm(t.getLocaleString("offlineMapExit.confirm"),null,(function(){e.preventDefault()}))}))})));const o=t.getUID(),a=t.getUID();t.layerPromise=e.addLayer({id:a,type:i.Z.layerType.VECTOR,stealth:!0,owner:t,styles:{line:e.options.styles.line}}),t.layer=null;const l=await Promise.all([t.layerPromise,t.renderPromise()]),u=t.layer=l[0];t.boxDraw=await e.addControl("draw",{id:o,div:t.div.querySelector(t._selectors.DRAW),mode:i.Z.geom.RECTANGLE,singleSketch:!0}),t.boxDraw.setLayer(u),t.boxDraw.on(i.Z.event.DRAWSTART,(function(e){t.map.toast(t.getLocaleString("clickOnDownloadAreaOppositeCorner"),{type:i.Z.msgType.INFO})})).on(i.Z.event.DRAWEND,(function(r){var o=r.feature.geometry[0],a=o[0],s=o[2],l=Math.min(a[0],s[0]),c=Math.max(a[0],s[0]),u=Math.min(a[1],s[1]),p=Math.max(a[1],s[1]);t.setExtent([l,u,c,p]);const d=t._dialogDiv.querySelectorAll("input[type=checkbox]");d.forEach((function(r){const n=t.map.getLayer(r.value);for(var o=r;o&&"LI"!==o.tagName;)o=o.parentElement;if(n.wrap.getCompatibleMatrixSets(e.crs).includes(n.matrixSet)){const e=t.wrap.getRequestSchemas({extent:t.extent,layers:[n]})[0].tileMatrixLimits;o.classList.toggle(i.Z.classes.HIDDEN,!e.length)}else o.classList.add(i.Z.classes.HIDDEN)}));const g=t._dialogDiv.querySelector(t._selectors.BLLISTITEM+":not(."+i.Z.classes.HIDDEN+")");t._dialogDiv.querySelector(t._selectors.BLLISTTEXT).innerHTML=t.getLocaleString(g?"selectAtLeastOne":"cb.noMapsAtSelectedExtent"),h(t),f(t),n.Z.Util.showModal(t._dialogDiv.querySelector(t._classSelector+"-dialog"),{openCallback:function(){var e;if(setTimeout((function(){d.forEach((function(e){e.disabled=!1}))}),100),Date.prototype.toLocaleString){var r={};r.year=r.month=r.day=r.hour=r.minute=r.second="numeric",e=(new Date).toLocaleString(t.map.options.locale.replace("_","-"),r)}else e=(new Date).toString();t._dialogDiv.querySelector(t._selectors.NAMETB).value=e,t._updateReadyState()},closeCallback:function(){d.forEach((function(e){e.disabled=!0})),t.boxDraw.layer.clearFeatures()}})})),e.on(i.Z.event.CONTROLDEACTIVATE,(function(e){t.boxDraw===e.control&&t._state===t._states.EDITING&&t.setReadyState()}));var p=function(e){var r=!1;const o=t._dialogDiv.querySelector(t._selectors.BLLIST),a=function(){return!!o.querySelector('li[data-layer-uid="'+e.id+'"]')};var s=e.type===i.Z.layerType.WMTS&&!e.mustReproject;return n.Z.Util.detectSafari()&&n.Z.Util.detectIOS()&&(s=s&&n.Z.Util.isSameOrigin(e.url)),s&&!a()&&(r=!0,t.getRenderedHtml(t.CLASS+"-bl-node",e,(function(e){if(!a()){const t=new DOMParser;o.appendChild(t.parseFromString(e,"text/html").body.firstChild)}}))),r};const d=function(e){if(e.isBase&&t.mapIsOffline){const r=e.getResolutions();if(r){const n=r.filter((e=>e>=t.currentMapDefinition.res));n.length&&e.setResolutions(n)}}t.renderPromise().then((function(){p(e)}))};return e.on(i.Z.event.LAYERADD,(function(e){d(e.layer)})).on(i.Z.event.LAYERREMOVE,(function(e){t.renderPromise().then((function(){const r=e.layer;if(r.type===i.Z.layerType.WMTS){const e=t._dialogDiv.querySelector(t._selectors.BLLIST).querySelector('li[data-layer-uid="'+r.id+'"]');e.parentElement.removeChild(e)}}))})).on(i.Z.event.PROJECTIONCHANGE,(function(t){e.baseLayers.forEach((e=>d(e)))})),e.ready((function(){if(t.mapIsOffline){var r=[];t.offlineControls.forEach((function(t){t=t.substr(0,1).toUpperCase()+t.substr(1),r=r.concat(e.getControlsByClass("TC.control."+t))}));const n=t.getLocaleString("thisControlCannotBeUsedInOfflineMode");e.controls.forEach((function(e){r.indexOf(e)<0&&e.disable({reason:n})})),document.querySelectorAll(t._selectors.OFFLINEHIDDEN).forEach((function(e){e.classList.add(i.Z.classes.HIDDEN)}))}})),e.loaded((function(){if(t.layerPromise.then((function(t){e.putLayerOnTop(t)})),t.renderPromise().then((function(){t.div.querySelector(t._selectors.NEWBTN).disabled=!1,e.baseLayers.forEach(p)})),t.mapIsOffline){const r=t.currentMapDefinition,o=function(e,t){return(0===e.url.indexOf("//")?location.protocol+e.url:e.url)===r.url[t.urlIdx]&&e.layerNames===t.id&&e.matrixSet===r.tms[t.tmsIdx]},a=e.options.availableBaseLayers.filter((e=>e.type===i.Z.layerType.WMTS)).filter((e=>r.layers.some((t=>o(e,t))))).filter((t=>!e.baseLayers.some((e=>e.id===t.id))));Promise.all(a.map((t=>e.addLayer(n.Z.Util.extend({},t,{isBase:!0}))))).finally((function(){const n=[];for(var a=0,s=r.layers.length;a<s;a++)for(var l=0,c=e.baseLayers.length;l<c;l++){const t=e.baseLayers[l];if(t&&t.type===i.Z.layerType.WMTS&&o(t,r.layers[a])){n.push(t);break}}n.length&&e.setBaseLayer(n[0],(function(){for(var r=e.baseLayers.length-1;r>=0;r--){const t=e.baseLayers[r];t&&t.type!==i.Z.layerType.VECTOR&&!n.includes(t)&&e.removeLayer(t)}e.setExtent(t.currentMapExtent,{animate:!1,contain:!0})}))}))}})),t.on(i.Z.event.MAPCACHEDOWNLOAD,(function(r){t.isDownloading=!1;const o=function(e){const t=e.indexOf("#");return t>=0?e.substr(0,t):e}(r.url),a=g(t,o);a&&!t.serviceWorkerEnabled?(a.classList.remove(i.Z.classes.DISABLED),n.Z.alert(t.getLocaleString("cb.delete.error"))):t.currentMap&&o===t.currentMap.url&&(!function(e){const t=e.currentMap;y(e,t)&&(e.getRenderedHtml(e.CLASS+"-map-node",{name:t.name,url:t.url},(function(t){const r=new DOMParser;e.div.querySelector(e._selectors.LIST).appendChild(r.parseFromString(t,"text/html").body.firstChild),e.div.querySelector(e._selectors.EMPTYLIST).setAttribute("hidden","hidden"),e.div.querySelector(e._selectors.SEARCH).disabled=!1})),e.storedMaps.push(t))}(t),e.toast(t.getLocaleString("mapDownloaded",{mapName:t.currentMap.name}))),t.currentMap=null,t.setReadyState()})).on(i.Z.event.MAPCACHEDELETE,(function(r){t.isDownloading=!1;var n=m(t,r.url)||t.currentMap&&t.currentMap.name;t.currentMap=null,n&&e.toast(t.getLocaleString("mapDeleted",{mapName:n})),t.setReadyState()})).on(i.Z.event.MAPCACHEPROGRESS,(function(e){var r=e.total;!r&&t.requestSchemas&&(r=t.requestSchemas[0].tileCount);var n=e.loaded;n?t._loadedCount=n:(t._loadedCount+=1,n=t._loadedCount),t.showDownloadProgress(n,r)})).on(i.Z.event.MAPCACHEERROR,(function(e){t.isDownloading=!1,t.setReadyState();var r=t.getLocaleString("cb.mapCreation.error"),i=!0;switch(e.reason){case"quota":r+=". "+t.getLocaleString("cb.mapCreation.error.reasonQuota");break;case"resource":r+=". "+t.getLocaleString("cb.mapCreation.error.reasonResource");break;case"manifest":"410"==e.status&&m(t,e.url),i=!1;break;case"already_exists":r+=". "+t.getLocaleString("cb.mapCreation.error.reasonAlreadyExists")}i&&(n.Z.Util.detectIE()?(n.Z.error(r),n.Z.alert(t.getLocaleString("cb.mapCreation.error.reasonEdge"))):n.Z.alert(r)),t.currentMap=null})),await r,t},e.setExtent=function(e){Array.isArray(e)&&e.length>=4&&(this.extent=e,this.updateRequestSchemas())},e._updateReadyState=function(){const e=this;e._dialogDiv.querySelector(e._selectors.OKBTN).disabled=!e.extent||0===e._dialogDiv.querySelector(e._selectors.NAMETB).value.length||e._dialogDiv.querySelector(e._selectors.RNGMAXRES).disabled},e.setReadyState=function(){const e=this;e._state=e._states.READY,e.showDownloadProgress(0,1),e.div.querySelector(e._selectors.DRAWING).classList.add(i.Z.classes.HIDDEN),e.div.querySelector(e._selectors.PROGRESS).classList.add(i.Z.classes.HIDDEN),e.div.querySelector(e._selectors.NEW).classList.remove(i.Z.classes.HIDDEN),e.div.querySelectorAll(e._selectors.LISTITEM).forEach((function(e){e.classList.remove(i.Z.classes.DISABLED)})),e._dialogDiv.querySelector(e._selectors.OKBTN).disabled=!0,e.div.querySelector(e._selectors.NEWBTN).disabled=!1,e._dialogDiv.querySelector(e._selectors.TILECOUNT).innerHTML="",e.extent=null,e._loadedCount=0,e.boxDraw&&e.boxDraw.cancel()},e.setEditState=function(){const e=this;e._state=e._states.EDITING,e.showDownloadProgress(0,1),e.div.querySelector(e._selectors.NEW).classList.add(i.Z.classes.HIDDEN),e.div.querySelector(e._selectors.PROGRESS).classList.add(i.Z.classes.HIDDEN),e.div.querySelector(e._selectors.DRAWING).classList.remove(i.Z.classes.HIDDEN),e.map.toast(e.getLocaleString("clickOnDownloadAreaFirstCorner"),{type:i.Z.msgType.INFO}),e._dialogDiv.querySelector(e._selectors.OKBTN).disabled=!0,e.div.querySelector(e._selectors.NEWBTN).disabled=!0,e._dialogDiv.querySelector(e._selectors.NAMETB).value="",e.boxDraw.activate()},e.generateCache=function(){const e=this,t={mapName:e._dialogDiv.querySelector(e._selectors.NAMETB).value};if(e.findStoredMap({name:t.mapName}))n.Z.alert(e.getLocaleString("cb.mapNameAlreadyExists.error",t));else{var r=function(){var r;e.div.querySelector(e._classSelector+"-name").innerHTML=t.mapName,e.map.toast(e.getLocaleString("downloadingMap",{mapName:t.mapName})),(r=e)._state=r._states.DOWNLOADING,n.Z.Util.closeModal(),r.showDownloadProgress(0,1),r.div.querySelector(r._selectors.NEW).classList.add(i.Z.classes.HIDDEN),r.div.querySelector(r._selectors.DRAWING).classList.add(i.Z.classes.HIDDEN),r.div.querySelector(r._selectors.PROGRESS).classList.remove(i.Z.classes.HIDDEN),r._dialogDiv.querySelector(r._selectors.OKBTN).disabled=!0,r.div.querySelector(r._selectors.NEWBTN).disabled=!0,r.layer.clearFeatures(),r.boxDraw.cancel(),e.requestCache(t)};navigator.storage&&navigator.storage.estimate?navigator.storage.estimate().then((function(i){const o=(i.quota-i.usage)/1048576;e.estimatedMapSize<o?r():n.Z.confirm(e.getLocaleString("cb.mapCreation.warning.reasonSize",{mapName:t.mapName,mapSize:d(e,e.estimatedMapSize),availableStorage:d(e,Math.round(o))}),r)})):r()}},e.cacheUrlList=function(e,t){var r=this,n=t||{};const i=Date.now().toString();return r.createCache(n.name||r.LOCAL_STORAGE_KEY_PREFIX+r.ROOT_CACHE_NAME,{requestId:i,urlList:e,silent:n.silent}),i},e.requestCache=function(e){var t=this,r=e||{};if(t.map){var o=r.extent||t.extent||t.map.getExtent();if(t.updateRequestSchemas({extent:o}),t.requestSchemas){var a=function(e,r,n){var i=e.res>=t.minResolution;return!i&&r>0&&(i=n[r-1].res>t.minResolution),i},s=function(e){return{mId:e.mId,cl:e.cl,cr:e.cr,rt:e.rt,rb:e.rb}},l=t.requestSchemas.map((function(e){return{layerId:e.layerId,tileMatrixSet:e.tileMatrixSet,tileMatrixLimits:e.tileMatrixLimits.filter(a)}})),c=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];l.forEach((function(e){const t=e.tileMatrixLimits[e.tileMatrixLimits.length-1],r=t.res*t.tSize;c[0]=Math.min(c[0],t.origin[0]+r*t.cl),c[1]=Math.min(c[1],t.origin[1]-r*(t.rb+1)),c[2]=Math.max(c[2],t.origin[0]+r*(t.cr+1)),c[3]=Math.max(c[3],t.origin[1]-r*t.rt),e.tileMatrixLimits=e.tileMatrixLimits.map(s)}));var u=Math.pow(10,t.map.wrap.isGeo()?i.Z.DEGREE_PRECISION:i.Z.METER_PRECISION),p={bBox:c=c.map((function(e,t){return(t<3?Math.ceil:Math.floor)(e*u)/u})),res:Math.floor(1e3*t.minResolution)/1e3,url:[],tms:[],format:[],layers:new Array(t.baseLayers.length)};t.baseLayers.forEach((function(e,t){var r=0===e.url.indexOf("//")?location.protocol+e.url:e.url,n=p.url.indexOf(r);n<0&&(n=p.url.push(r)-1);var i=p.tms.indexOf(e.matrixSet);i<0&&(i=p.tms.push(e.matrixSet)-1);var o=e.format.substr(e.format.indexOf("/")+1),a=p.format.indexOf(o);a<0&&(a=p.format.push(o)-1),p.layers[t]={urlIdx:n,id:e.layerNames,tmsIdx:i,formatIdx:a}}));var h=n.Z.Util.getQueryStringParams(),d=h[t.MAP_EXTENT_PARAM_NAME]=c.toString();h[t.MAP_DEFINITION_PARAM_NAME]=btoa(JSON.stringify(p)),t.serviceWorkerEnabled&&(h[t.SERVICE_WORKER_FLAG]=1);const e=location.origin+location.pathname+"?"+n.Z.Util.getParamString(h);if(t.currentMap={name:r.mapName,extent:d,url:e},t.isDownloading=!0,t.serviceWorkerEnabled){const r=[];for(var f=0,g=l.length;f<g;f++){for(var y=l[f],m=null,v=0,_=t.baseLayers.length;v<_;v++){var w=t.baseLayers[v];if(w.id===y.layerId){m=t.wrap.getGetTilePattern(w),w.getFallbackLayer&&w.getFallbackLayer(),w.thumbnail&&r.push(w.thumbnail);break}}if(m)for(var S=0,E=y.tileMatrixLimits.length;S<E;S++){const e=y.tileMatrixLimits[S];for(var b=e.rt;b<=e.rb;b++)for(var C=e.cl;C<=e.cr;C++)r.push(m.replace("{TileMatrixSet}",y.tileMatrixSet).replace("{TileMatrix}",e.mId).replace("{TileCol}",C).replace("{TileRow}",b))}}r.push(e),t.cacheUrlList(r,{name:e})}}}},e.cancelCacheRequest=function(){var e=this;e.currentMap&&e.deleteCache(e.currentMap.url).then((function(t){t||(e.currentMap=null)})),e.isDownloading=!1,e.setReadyState()},e.deleteMap=function(e){var t=this.findStoredMap({name:e});t&&this.deleteCache(t.url)},e.startDeleteMap=function(e){const t=this;if(navigator.onLine){if(e){var r=t.getLocaleString("cb.delete.confirm",{mapName:e});t.serviceWorkerEnabled||(r=r+" "+t.getLocaleString("cb.delete.confirm.connect.warning")),confirm(r)&&(navigator.onLine?((o=t)._state=o._states.DELETING,o.showDownloadProgress(0,1),o.div.querySelector(o._selectors.DRAWING).classList.add(i.Z.classes.HIDDEN),o.div.querySelector(o._selectors.PROGRESS).classList.add(i.Z.classes.HIDDEN),o.div.querySelector(o._selectors.NEW).classList.remove(i.Z.classes.HIDDEN),o.div.querySelectorAll(o._selectors.LISTITEM).forEach((function(e){e.classList.add(i.Z.classes.DISABLED)})),o._dialogDiv.querySelector(o._selectors.OKBTN).disabled=!0,o.div.querySelector(o._selectors.NEWBTN).disabled=!1,o._dialogDiv.querySelector(o._selectors.TILECOUNT).innerHTML="",o.boxDraw.cancel(),t.deleteMap(e)):n.Z.alert(t.getLocaleString("cb.delete.conn.alert")))}}else n.Z.alert(t.getLocaleString("cb.delete.conn.alert"));var o},e.findStoredMap=function(e){return this.storedMaps.find((function(t){var r=!0;return e.name&&e.name!==t.name&&(r=!1),r&&e.url&&e.url!==t.url&&(r=!1),r}))},e.showDownloadProgress=function(e,t){const r=this,n=r._classSelector,o=r.div.querySelector(n+"-progress-count");if(t){var a=Math.min(Math.round(100*e/t),100)+"%";const i=r.div.querySelector(n+"-progress-ratio");i&&(i.style.width=a),o&&(o.innerHTML=a)}else{const t=r.div.querySelector(n+"-progress-bar");t&&t.classList.add(i.Z.classes.HIDDEN),o&&(o.innerHTML=r.getLocaleString("xFiles",{quantity:e}))}},e.updateRequestSchemas=function(e){var t=this,r=e||{};return r.extent=r.extent||t.extent,r.layers=r.layers||t.baseLayers,t.requestSchemas=t.wrap.getRequestSchemas(r),t.requestSchemas},e.getResolutions=function(){var e=[];const t=function(e){return e.res},r=this.requestSchemas.map((function(e){return e.tileMatrixLimits.map(t)}));return e=e.concat.apply(e,r).sort(((e,t)=>t-e)).filter(((e,t,r)=>0===t||r[t-1]!==e))},e.getOnlineMapUrl=function(){const e=this,t=n.Z.Util.getQueryStringParams();delete t[e.MAP_DEFINITION_PARAM_NAME],delete t[e.MAP_EXTENT_PARAM_NAME],delete t[e.SERVICE_WORKER_FLAG];var r=n.Z.Util.getParamString(t);return r.length&&(r="?"+r),location.pathname+r+location.hash}}(),n.Z.control.OfflineMapMaker=p;const h=p},6436:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var n=r(688),i=r(330),o=r(268),a=r(7497),s=r(4115),l=r(8197);function c(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function u(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,h(e,t,"set"),r),r}function p(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,h(e,t,"get"))}function h(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}function d(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}n.Z.control=n.Z.control||{},n.Z.Control=a.Z;var f=new WeakMap,g=new WeakSet;class y extends a.Z{constructor(){var e,t;super(...arguments),c(e=this,t=g),t.add(e),function(e,t,r){c(e,t),t.set(e,r)}(this,f,{writable:!0,value:void 0});const r=this;r.div.classList.add(r.CLASS),r.isLoaded=!1,r.layer=null}getClassName(){return"tc-ctl-ovmap"}async loadTemplates(){const e=await r.e(9545).then(r.bind(r,9545));this.template=e.default}async register(e){const t=this,r=function(t){var r;return r=function(t){var r,n=function(e,t){for(var r=null,n=0;n<t.length;n++){var i=t[n];if((i.id||i)===e){r=i;break}}return r};if("string"==typeof t){var a=n(t,e.options.availableBaseLayers);o.Z.isPlainObject(a)||(a=n(t,e.options.baseLayers)),o.Z.isPlainObject(a)&&(r=new s.Z(a))}else r=t instanceof s.Z||t instanceof l.Z?t:t.type===i.Z.layerType.VECTOR||t.type===i.Z.layerType.KML||t.type===i.Z.layerType.WFS?new l.Z(t):new s.Z(t);return r}(t),r},a=function(e){const t=this;if(t.map.baseLayer.type===i.Z.layerType.WMS||t.map.baseLayer.type===i.Z.layerType.WMTS||t.options.layer){var n=t.map.baseLayer.overviewMapLayer||t.options.layer;let o;t.layer.id!==n?o=r(n):i.Z.event.PROJECTIONCHANGE.includes(e.type)&&(o=t.layer),o&&t.wrap.reset({layer:o}).then((function(e){t.layer=e}))}},c=await super.register.call(t,e);return t.wrap=new n.Z.wrap.control.OverviewMap(t),e.loaded((function(){t.defaultLayer=r(t.options.layer),t.layer=r(e.baseLayer.overviewMapLayer||t.options.layer||e.options.baseLayers[0]||e.options.availableBaseLayers[0]),d(t,g,m).call(t).then((()=>function(r){const n={};t.layer.getCapabilitiesPromise().then((function(){t.layer.isCompatible(e.crs)||0!==t.layer.wrap.getCompatibleMatrixSets(e.crs).length||(n.layer=t.layer.getFallbackLayer()),t.wrap.reset(n)}))}(e.crs))),e.on(i.Z.event.PROJECTIONCHANGE+" "+i.Z.event.BASELAYERCHANGE,a.bind(t))})),c}loaded(e){const t=this;o.Z.isFunction(e)&&(t.isLoaded&&t.map&&t.map.isLoaded?e():t.on(i.Z.event.MAPLOAD,e))}activate(){this.enable()}deactivate(){this.disable()}enable(){const e=this;super.enable.call(e),d(e,g,m).call(e).then((()=>e.wrap.enable()))}disable(){const e=this;super.disable.call(e),d(e,g,m).call(e).then((()=>e.wrap.disable()))}}function m(){const e=this;return!p(e,f)&&e.map&&u(e,f,e.wrap.register(e.map)),p(e,f)}n.Z.control.OverviewMap=y;const v=y},9889:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var n=r(688),i=r(330),o=r(1885);n.Z.control=n.Z.control||{};class a extends o.default{constructor(){super(...arguments);const e=this;e.geometryType=i.Z.geom.POLYGON,e.style=n.Z.Util.extend(!0,{strokeColor:e.DEFAULT_STROKE_COLOR,strokeWidth:2,fillColor:"#000",fillOpacity:.3},e.options.style)}}n.Z.control.PolygonFeatureInfo=a;const s=a},5590:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(688),i=r(330),o=r(7497);n.Z.control=n.Z.control||{},i.Z.event.POPUP=i.Z.event.POPUP||"popup.tc",i.Z.event.POPUPHIDE=i.Z.event.POPUPHIDE||"popuphide.tc",i.Z.classes.DRAG=i.Z.classes.DRAG||"tc-drag",i.Z.classes.DRAGGED=i.Z.classes.DRAGGED||"tc-dragged",i.Z.classes.DRAGGABLE=i.Z.classes.DRAGGABLE||"tc-draggable";const a=function(){var e=this;o.Z.apply(e,arguments),e.currentFeature=null,e.wrap=new n.Z.wrap.control.Popup(e)};var s;n.Z.inherit(a,o.Z),(s=a.prototype).CLASS="tc-ctl-popup",s.render=function(e){const t=this;return t._set1stRenderPromise(new Promise((function(r,i){o.Z.prototype.renderData.call(t,{closeButton:t.options.closeButton||void 0===t.options.closeButton,shareButton:t.options.share}).then((function(){t.popupDiv=t.div.querySelector(`.${s.CLASS}`),t.contentDiv=t.popupDiv.querySelector(`.${s.CLASS}-content`),t.menuDiv=t.popupDiv.querySelector(`.${s.CLASS}-menu`),t.addUIEventListeners(),t.map.wrap.addPopup(t).then((function(){n.Z.Util.isFunction(e)&&e(),r()}))})).catch((e=>i(e instanceof Error?e:Error(e))))})))},s.loadTemplates=async function(){const e=await r.e(1631).then(r.bind(r,1631));this.template=e.default},s.register=async function(e){const t=this;return await o.Z.prototype.register.call(t,e),await t.renderPromise(),e.on(i.Z.event.VIEWCHANGE,(function(){e.view===i.Z.view.PRINTING&&t.isVisible()&&t.hide()})),e.on(i.Z.event.LAYERVISIBILITY,(function(e){t.currentFeature&&t.currentFeature.layer===e.layer&&!e.layer.getVisibility()&&t.isVisible()&&t.hide()})),e.on(i.Z.event.LAYERREMOVE+" "+i.Z.event.FEATURESCLEAR,(function(e){t.currentFeature&&t.currentFeature.layer===e.layer&&t.isVisible()&&t.hide()})),e.on(i.Z.event.UPDATE,(function(){t.currentFeature&&t.currentFeature.getVisibilityState()!==i.Z.visibility.NOT_VISIBLE||t.isVisible()&&t.hide()})),e.on(i.Z.event.FEATUREREMOVE,(function(e){t.currentFeature===e.feature&&t.isVisible()&&t.hide()})),t},s.addUIEventListeners=function(){const e=this,t=e.menuDiv.querySelector(`.${e.CLASS}-close`);t&&t.addEventListener(i.Z.event.CLICK,(function(){e.hide()}),{passive:!0});const r=e.menuDiv.querySelector(`.${e.CLASS}-share`);r&&r.addEventListener(i.Z.event.CLICK,(function(){e.caller&&e.caller.showShareDialog()}),{passive:!0})},s.fitToView=function(e){var t=this;e?setTimeout((function(){t.wrap.fitToView()}),1e3):t.wrap.fitToView()},s.hide=function(){var e=this;if(e.map){const t={control:e,feature:e.currentFeature};e.setDragged(!1),e.map.wrap.hidePopup(e),e.getContainerElement().innerHTML="",e.map.trigger(i.Z.event.POPUPHIDE,t)}},s.getContainerElement=function(){return this.contentDiv||null},s.getMenuElement=function(){return this.menuDiv||null},s.setDragged=function(e){const t=this;t.dragged=e,t.popupDiv&&t.popupDiv.classList.toggle(i.Z.classes.DRAGGED,!!e),t.wrap.setDragged(e)},s.setDragging=function(e){const t=this;e?(t.setDragged(!0),t.popupDiv.classList.add(i.Z.classes.DRAG)):t.popupDiv.classList.remove(i.Z.classes.DRAG)},s.isVisible=function(){return this.popupDiv&&this.popupDiv.classList.contains(i.Z.classes.VISIBLE)},n.Z.control.Popup=a;const l=a},674:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(688),i=r(330),o=r(9967),a=r(7497);n.Z.control=n.Z.control||{},i.Z.classes.PRINTABLE="tc-printable";const s=function(e){const t=this;t.options=e||{},t.ready=!1,t.title=t.options.title||n.Z.Util.getLocaleString(o.Z.locale,"printPage"),t.cssUrl=t.options.cssUrl||n.Z.apiLocation+"css/print.css",t.options.target&&((t.options.printableElement||t.options.target).classList.add(i.Z.classes.PRINTABLE),t.render())};n.Z.inherit(s,a.Z),function(){const e=s.prototype;e.CLASS="tc-ctl-print",e.renderPrintPage=function(){const e=this,t=open(null,e.CLASS),r=(e.options.printableElement||e.options.target).innerHTML;e.getRenderedHtml(e.CLASS+"-page",{title:e.title,content:r,cssUrl:e.cssUrl}).then((function(e){t.document.write(e),t.document.close(),t.focus()})).catch((function(e){n.Z.error(e)}))},e.getRenderTarget=function(){return this.options.target||this.div},e.addUIEventListeners=function(){const e=this;if(e._mustAddListeners){const t=e.getRenderTarget();if(t){const r=t.querySelector("."+e.CLASS+"-btn");r&&(r.addEventListener("click",(function(t){e.renderPrintPage()})),delete e._mustAddListeners)}}},e.loadTemplates=async function(){const e=this,t=r.e(7313).then(r.bind(r,7313)),n=r.e(9776).then(r.bind(r,9776)),i={};i[e.CLASS]=(await t).default,i[e.CLASS+"-page"]=(await n).default,e.template=i},e.renderData=async function(e,t){const r=this;if(r.div)return void await a.Z.prototype.renderData.call(r,e,t);const i=r.getRenderTarget();if(i){const e=await r.getRenderedHtml(r.CLASS,null);i.querySelector("."+r.CLASS+"-btn")||(r._mustAddListeners=!0,i.insertAdjacentHTML("beforeend",e))}n.Z.Util.isFunction(t)&&t()}}(),n.Z.control.Print=s;const l=s},4283:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>T});var n=r(688),i=r(268),o=r(330),a=r(3784),s=r(4676);function l(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function c(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}n.Z.control=n.Z.control||{};const u="portrait",p="landscape",h="A4",d="A3",f={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:595,height:842},pageMargins:[29.5,14,29.5,22.5],content:[{columns:[{image:null,height:22,margin:[0,0,0,6]},{text:"",width:489,alignment:"center",margin:[0,10,0,0]},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:534,height:775.5}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,margin:[0,0,0,6]},{text:"",width:489,alignment:"center",margin:[0,10,0,0]},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:534,height:775.5}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]}},g={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:842,height:595},pageMargins:[30,14,30,22],content:[{columns:[{image:null,height:22,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:528}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:528}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]}},y={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:841.89,height:1190.55},pageMargins:[29.954,14,29.954,21.55],content:[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",width:489,margin:[0,10,0,0],alignment:"center"},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:1125}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",width:489,margin:[0,10,0,0],alignment:"center"},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:1125}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]}},m={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:1190.55,height:841.89},pageMargins:[28.775,14,28.775,14.89],content:[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:1131,height:783}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:1131,height:783}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]}},v=function(e,t){switch(e){case u:switch(t){case h:return f;case d:return y}break;case p:switch(t){case h:return g;case d:return m}break;default:return f}},_=function(e){return e.layoutPDF.content[0].columns[0]},w={sideLength:85};var S=new WeakSet,E=new WeakSet;class b extends a.default{constructor(){super(...arguments),l(this,E),l(this,S);this.div.classList.add(this.CLASS)}getClassName(){return"tc-ctl-prnmap"}async loadTemplates(){const e=this,t=r.e(9504).then(r.bind(r,9504)),n=r.e(5788).then(r.bind(r,5788)),i=r.e(5119).then(r.bind(r,5119)),o={};o[e.CLASS]=(await t).default,o[e.CLASS+"-view"]=(await n).default,o[e.CLASS+"-tools"]=(await i).default,e.template=o}render(e){const t=this;return t._set1stRenderPromise(super.renderData.call(t,{controlId:t.id},e))}register(e){const t=this,r=super.register.call(t,e);t.map.crossOrigin="anonymous";const a=function(){v(t.orientation||u,t.format.toString().toUpperCase()||"A4").reset()};return t.div.addEventListener("click",n.Z.EventTarget.listenerBySelector("."+t.CLASS+"-btn",(function(){const e=t.getContainer();t.map.setView(o.Z.view.PRINTING);var r=document.querySelector("."+t.CLASS+"-qrcode");const n=t.div.querySelector(`.${t.CLASS}-image-qr`);!n.disabled&&n.checked?(r||((r=document.createElement("div")).classList.add(t.CLASS+"-qrcode"),t.getContainer().appendChild(r)),r.innerHTML="",t.makeQRCode(r,w.sideLength)):r&&(r.innerHTML="");const s="."+t.CLASS+"-btn";t.map.on(o.Z.event.STARTLOADING,(function(){const e=t.div.querySelector(s);e.classList.add(o.Z.classes.DISABLED),e.disabled=!0})),t.map.on(o.Z.event.STOPLOADING,(function(){const e=t.div.querySelector(s);e.classList.remove(o.Z.classes.DISABLED),e.disabled=!1})),c(t,S,C).call(t)&&t.map.on(o.Z.event.ZOOM,a);const l=function(r){if(r){e.classList.add(r);var n=e.getBoundingClientRect();Number.isInteger(n.width)||(e.style.width=Math.round(n.width)+"px"),Number.isInteger(n.height)||(e.style.height=Math.round(n.height)+"px");const i=`calc(50% - ${n.width/2}px)`;if(t._viewDiv.querySelector(`.${t.CLASS}-view-left`).style.width=i,t._viewDiv.querySelector(`.${t.CLASS}-view-right`).style.width=i,t._viewDiv.querySelector(`.${t.CLASS}-view-bottom`).style.top=n.height+"px",t.map.toast(t.getLocaleString("print.advice.title")+": "+t.getLocaleString("print.advice.desc"),{type:o.Z.msgType.INFO,duration:7e3}),n=e.getBoundingClientRect(),window.screen.width<n.width){const e=window.screen.width/n.width,r=n.width/window.screen.width,i=document.querySelector('meta[name="viewport"]');t._viewportMeta=i.getAttribute("content"),i.setAttribute("content",`user-scalable=yes, initial-scale=${e}, minimum-scale=${e}`);const a=t.getToolsElement().style;t._toolsTransform=a.transform,t._toolsTransformOrigin=a.transformOrigin,a.transform=`scale(${r}, ${r})`,a.transformOrigin="100% 0%";const s=document.querySelector("."+o.Z.classes.TOAST_CONTAINER);if(s){const e=s.style;t._toastTransform=e.transform,t._toastTransformOrigin=e.transformOrigin,e.transform=`scale(${r}, ${r})`,e.transformOrigin="0% 100%"}}}t.map.on3DView?t.map.view3D.getScene().render():t.map.wrap.map.updateSize()},p=function(){if(Object.prototype.hasOwnProperty.call(t,"_viewportMeta")){document.querySelector('meta[name="viewport"]').setAttribute("content",t._viewportMeta),delete t._viewportMeta;const e=t.getToolsElement().style;e.transform=t._toolsTransform,e.transformOrigin=t._toolsTransformOrigin,delete t._toolsTransform,delete t._toolsTransformOrigin;const r=document.querySelector("."+o.Z.classes.TOAST_CONTAINER);r&&(r.style.transform=t._toastTransform,r.style.transformOrigin=t._toastTransformOrigin),delete t._toastTransform,delete t._toastTransformOrigin}v(t.orientation||u,t.format.toString().toUpperCase()||"A4").reset(),c(t,S,C).call(t)&&t.map.off(o.Z.event.ZOOM,a),t.map.toastHide(t.getLocaleString("print.advice.title")+": "+t.getLocaleString("print.advice.desc"));const e=t.getContainer();e.classList.remove(t.currentFormat,t.CLASS+"-printing"),e.style.removeProperty("width"),e.style.removeProperty("height"),l(),t.map.setView(o.Z.view.DEFAULT),t._viewDiv.classList.add(o.Z.classes.HIDDEN)};t._viewDiv||(t._viewDiv=i.Z.getDiv(),document.body.appendChild(t._viewDiv),t.getRenderedHtml(t.CLASS+"-view",null,(function(e){t._viewDiv.innerHTML=e})),t.getRenderedHtml(t.CLASS+"-tools",null,(function(r){e.insertAdjacentHTML("beforeend",r),e.querySelector("."+t.CLASS+"-btn-close").addEventListener("click",p),e.querySelector("."+t.CLASS+"-btn-pdf").addEventListener("click",t.createPdf.bind(t))}))),t.orientation=t.div.querySelector("#print-design").value,t.format=t.div.querySelector("#print-size").value,t.currentFormat=t.CLASS+"-"+t.orientation+"-"+t.format,t._viewDiv.classList.remove(o.Z.classes.HIDDEN),t.getContainer().classList.add(t.CLASS+"-printing"),l(t.currentFormat)}))),t.div.addEventListener("click",n.Z.EventTarget.listenerBySelector(`.${t.CLASS}-image-qr`,(function(e){t.generateLink()}))),t.div.addEventListener("click",n.Z.EventTarget.listenerBySelector("h2",(function(e){t.registeredListeners||t.generateLink(),t.registerListeners()}))),r}getContainer(){return this.map.on3DView?this.map.view3D.container:this.map.div}async createPdf(){const e=this;var t=e.map.getControlsByClass(n.Z.control.LoadingIndicator)[0],a=t.addWait();await r.e(746).then(r.t.bind(r,746,23));let l,p=await r.e(3340).then(r.t.bind(r,3340,19));pdfMake.vfs=p.pdfMake.vfs;var h=e.map.wrap.getCanvas();e.canvas=i.Z.mergeCanvases(h);var d=v(e.orientation||u,e.format.toString().toUpperCase()||"A4"),f=d.layoutPDF;const g=function(r){var s=window.location.host+"_",l=e.div.querySelector("."+e.CLASS+"-title").value.trim();l?s+=l:s+=i.Z.getFormattedDate((new Date).toString(),!0);try{pdfMake.createPdf(r).download(s.replace(/[\\\/:*?"<>\|]/g,"")+".pdf")}catch(t){e.map.toast(e.getLocaleString("print.error"),{type:o.Z.msgType.ERROR}),n.Z.error(t.message+"  "+t.stack,o.Z.msgErrorMode.EMAIL)}t.removeWait(a)},y=function(t){n.Z.error(e.getLocaleString("print.error")),n.Z.error("No se ha podido generar el base64 correspondiente a la imagen: "+t,o.Z.msgErrorMode.EMAIL,"Error en la impresin")},m=function(){var t=[],r=e.map.workLayers.filter((function(e){return e.type===o.Z.layerType.WMS&&e.getVisibility()})),a=[],c=function(e,t,r){var n,i;t.isVisibleByScale(e.name)&&(t.options&&t.options.params&&t.options.params.base64LegendSrc?i=t.options.params.base64LegendSrc:e.legend&&(n=e.legend.src),l.push({src:n,title:e.title,level:r,srcBase64:i}))},u=function(e,t,r,n){if(Array.isArray(e))for(var i=0;i<e.length;i++)u(e[i],t,r,n);else e&&Object.prototype.hasOwnProperty.call(e,"children")&&e.children.length>0&&((e.title||e.name)&&l.push({header:e.title||e.name,level:n}),u(e.children,t,r,++n));e&&Object.prototype.hasOwnProperty.call(e,"children")&&0===e.children.length&&(t.apply(this,[e,r,n]),n--)};return r.forEach((function(e){if(l=[],e.layerNames&&0!==e.layerNames.length){var t=e.hideTree;e.tree=null,e.hideTree=!0,u(e.getNestedTree(),c,e,0),e.hideTree=t,l.length>0&&a.push({title:e.title,layers:l})}})),new Promise((function(e,r){Promise.all(function(){for(var e=[],t=0;t<a.length;t++)for(var r=a[t].layers,o=0;o<r.length;o++)!function(t,r){var o=a[t].layers[r],l=o.src||o.srcBase64;l&&e.push(new Promise((function(e,t){new s.default(n.Z.proxify,{allowedMixedContent:!0}).fetchImage(l,{exportable:!0}).then((function(t){if(t.complete){var r=i.Z.imgTagToDataUrl(t,"image/png");o.image={base64:r.base64,canvas:r.canvas,height:t.height,width:t.width}}else y(l);e()}),(function(e){y(l),t(e)}))})))}(t,o);return e}()).then((function(){a.map((function(e,t){return{groupIndex:t,height:e.layers.filter((function(e){return e.image&&e.image.canvas})).reduce((function(e,t,r,n){return e+n[r].image.canvas.height}),0)}})).sort((function(e,t){return e.height>t.height?1:e.height<t.height?-1:0})).forEach((function(e,r){!function(e,r){var n=[[{text:e.title,fontSize:13,style:["tablegroup"],margin:[0,r>0?10:0,0,2]}]];const i=(n=n.concat(e.layers.filter((function(t){return Object.prototype.hasOwnProperty.call(t,"header")&&t.header.trim().toLowerCase()!==e.title.trim().toLowerCase()})).map((function(e,t){return[{text:e.header.trim(),fontSize:Math.max(9,14-e.level),margin:[10*e.level,0,0,2]}]})))).length;var o=null,a=null;e.layers.forEach((function(e,t){if(e.header)o=e,a&&(a=null);else{var r;if(a||(a=1),o){var i=n.map((e=>e[0].text||"")).indexOf(o.header);r=i+a++}if(e.image){a++;var s=.75*e.image.width,l=.75*e.image.height;const t=[{ul:[{text:e.title,fontSize:Math.max(9,14-e.level),margin:[-10,0,0,5]},{image:e.image.base64,width:s,height:l,margin:[0,0,0,2]}],type:"none",margin:[10*e.level,0,0,2]}];r?n.splice(r,0,t):n.push(t)}else{const t=[{text:e.title,fontSize:11,margin:[10*e.level,0,0,2]}];r?n.splice(r,0,t):n.push(t)}}})),t.push({layout:"noBorders",table:{dontBreakRows:!0,keepWithHeaderRows:1,headerRows:i,body:n}})}(a[e.groupIndex],r)})),e(t)}),(function(){r([])}))}))},S=[function(){const t=function(){var e=_(d);return delete e.image,e.text="",e.width=0,e};return e.options.logo?i.Z.imgToDataUrl(e.options.logo).then((function(e){const t=e.canvas,r=e.dataUrl;var n=_(d);return n.width||(n.width=t.width/t.height*n.height),n.image=r,n}),(function(){return y(e.options.logo),t()})):t()},function(){var t=function(e){return e.layoutPDF.content[0].columns[1]}(d);return t.text=e.div.querySelector("."+e.CLASS+"-title").value.trim(),t},function(){var t=function(e){return e.layoutPDF.content[0].columns[2]}(d);const r=function(){return delete t.image,t.text="",t.width="auto",t};if(e.map.on3DView)t.table={widths:[0],body:[{border:[!1,!1,!1,!1],text:""}]};else{let c=e.map.getControlsByClass(n.Z.control.ScaleBar)[0];if(!c)return r();var i=document.getElementsByClassName("ol-scale-line-inner"),o=i[0].getBoundingClientRect();if(!o)return r();var a=getComputedStyle(i[0],null),s=parseInt(a.getPropertyValue("border-left-width").replace("px",""))||0,l=parseInt(a.getPropertyValue("border-right-width").replace("px",""))||0;t.table={widths:[.75*((o.width>o.height?o.width:o.height)-s-l)],body:[[{border:[!0,!1,!0,!0],text:c.getText(),fontSize:10,alignment:"center"}]]},t.layout={paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}return t},function(){const t=e.div.querySelector(`.${e.CLASS}-image-qr`);if(!t.disabled&&t.checked){const t=document.querySelector("."+e.CLASS+"-qrcode");return t.innerHTML="",e.makeQRCode(t,w.sideLength).then((function(t){return t?i.Z.addToCanvas(e.canvas,t,{x:e.canvas.width-w.sideLength,y:e.canvas.height-w.sideLength},{width:w.sideLength,height:w.sideLength}).then((function(e){return e})):e.canvas}))}return e.canvas}];Promise.all(S.map((function(e){return e()}))).then((function(t){if(t[2].table){const e=d.layoutPDF.pageSize.width-(d.layoutPDF.pageMargins[0]+d.layoutPDF.pageMargins[2]),t=d.layoutPDF.content[0].columns[0].width||0,r=d.layoutPDF.content[0].columns[2],n=r.table.widths[0]+2,i=d.layoutPDF.content[0].columns[1];i.width=e-t-n,0===t&&(i.alignment="left",r.margin[3]=2)}var r=function(e){return e.layoutPDF.content[1].table.body[0][0]}(d),n=t[3]||e.canvas;if(r.image=n.toDataURL(),c(e,E,L).call(e)&&2===f.content.length){const t=e.div.querySelector("."+e.CLASS+"-title").value.trim();f.content.push({pageBreak:"before",pageOrientation:e.options.legend&&e.options.legend.orientation||u,text:t.length>0?t:"",fontSize:14,margin:[0,20,0,10]}),f.styles={tablegroup:{bold:!0}},f.defaultStyle={alignment:"left"},m().then((function(e){f.content=f.content.concat(e),g(f)}))}else g(f)}))}manageMaxLengthExceed(e){const t=this,r=t.div.querySelector("."+t.CLASS+"-alert"),n=t.div.querySelector(`.${t.CLASS}-image-qr`);n.disabled=e.qr,n.checked?r.classList.toggle(o.Z.classes.HIDDEN,!e.qr):r.classList.add(o.Z.classes.HIDDEN)}async generateLink(){const e=this,t=e.div.querySelector(`.${e.CLASS}-div input.${e.CLASS}-image-qr`),r=e.div.querySelector(`label.${e.CLASS}-image-qr-label`);t.disabled=!0,r.classList.add(o.Z.classes.LOADING);const n=await a.default.prototype.generateLink.call(e);return r.classList.remove(o.Z.classes.LOADING),n}getToolsElement(){return this.getContainer().querySelector(`.${this.CLASS}-tools`)}}function C(){return this.map.workLayers.some((function(e){return e.type===o.Z.layerType.WMS&&e.getVisibility()}))}function L(){return this.map.workLayers.some((function(e){if(e.type===o.Z.layerType.WMS&&e.getVisibility()){for(var t=0;t<e.names.length;t++)if(e.isVisibleByScale(e.names[t]))return!0;return!1}return!1}))}n.Z.control.PrintMap=b;const T=b},7292:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var n=r(688),i=r(330),o=r(7497);n.Z.control=n.Z.control||{};const a=function(){const e=this;o.Z.apply(e,arguments),e._cssClasses={LOAD_CRS_BUTTON:e.CLASS+"-crs-btn-load",CRS_DIALOG:e.CLASS+"-crs-dialog",CRS_LIST:e.CLASS+"-crs-list",CURRENT_CRS_NAME:e.CLASS+"-cur-crs-name",CURRENT_CRS_CODE:e.CLASS+"-cur-crs-code",CHANGE:e.CLASS+"-change",NO_CHANGE:e.CLASS+"-no-change"},e._dialogDiv=n.Z.Util.getDiv(e.options.dialogDiv),window.$&&(e._$dialogDiv=$(e._dialogDiv)),e.options.dialogDiv||document.body.appendChild(e._dialogDiv),e._dialogDiv.addEventListener(i.Z.event.CLICK,n.Z.EventTarget.listenerBySelector("button:not(."+e._cssClasses.LOAD_CRS_BUTTON+")",(function(t){const r=t.target.dataset.crsCode;r&&e.setProjection({crs:r,allowFallbackLayer:!0})})),{passive:!0}),e._dialogDiv.addEventListener(i.Z.event.CLICK,n.Z.EventTarget.listenerBySelector("button."+e._cssClasses.LOAD_CRS_BUTTON,(function(){e.loadFallbackProjections()})),{passive:!0})};n.Z.inherit(a,o.Z),function(){const e=a.prototype;e.CLASS="tc-ctl-projs",e.render=async function(e){const t=this;await o.Z.prototype.render.call(t,e),t._dialogDiv.innerHTML=await t.getRenderedHtml(t.CLASS+"-dialog",null)},e.getAvailableCRS=function(e){return this.map.getCompatibleCRS(n.Z.Util.extend(e||{},{includeFallbacks:!0}))},e.showProjectionChangeDialog=function(e){const t=this,r=t._dialogDiv.querySelector("."+t._cssClasses.CRS_DIALOG),o=r.querySelector(".tc-modal-body");o.classList.add(i.Z.classes.LOADING);const a=o.querySelector("ul."+t._cssClasses.CRS_LIST);a.innerHTML="";const s=t.map.baseLayer.firstOption||t.map.baseLayer,l=s.isRaster()?s.getFallbackLayer():null,c=function(){var l=[],c=[];if(e=e||{},s.isRaster())c=s.getCompatibleCRS(),l=t.getAvailableCRS(n.Z.Util.extend(e,{}));else{c=t.map.baseLayers.filter((e=>e.isRaster())).map((e=>e.getCompatibleCRS({normalized:!0,includeFallback:!0}))).reduce(((e,t)=>e.concat(t.filter((t=>e.indexOf(t)<0)))));const r=(e.layer?t.map.workLayers.concat(e.layer):t.map.workLayers).filter((function(e){return e.isRaster()})).map((function(e){return e.getCompatibleCRS({normalized:!0,includeFallback:!0})}));l=c.filter((e=>r.every((t=>t.indexOf(e)>-1))))}t.map.loadProjections({crsList:l,orderBy:"name"}).then((function(e){var s=!1,l=r.querySelector("."+t._cssClasses.CURRENT_CRS_NAME),u=r.querySelector("."+t._cssClasses.CURRENT_CRS_CODE);if(e.forEach((function(e){if(l&&u&&n.Z.Util.CRSCodesEqual(t.map.crs,e.code))l.textContent=e.name,u.textContent=e.code;else{const t=document.createElement("button");t.setAttribute("type","button"),t.textContent=e.name+" ("+e.code+")",t.dataset.crsCode=e.code;const r=document.createElement("li");r.appendChild(t),0===c.filter((function(t){return n.Z.Util.CRSCodesEqual(t,e.code)})).length&&(s=!0,r.classList.add(i.Z.classes.HIDDEN),t.classList.add(i.Z.classes.WARNING)),a.appendChild(r)}})),s){const e=document.createElement("li"),r=document.createElement("button");r.setAttribute("type","button"),r.classList.add(t._cssClasses.LOAD_CRS_BUTTON),r.innerHTML=t.getLocaleString("showOnTheFlyProjections"),e.appendChild(r),a.appendChild(e)}if(0===a.querySelectorAll("li").length){const e=document.createElement("li");e.innerHTML=t.getLocaleString("thereAreNoCompatibleCRS"),a.appendChild(e)}const p=a.querySelectorAll("li:not(."+i.Z.classes.HIDDEN+")");r.querySelectorAll("."+t._cssClasses.CHANGE).forEach((function(e){e.style.display=p.length>1?"":"none"})),r.querySelectorAll("."+t._cssClasses.NO_CHANGE).forEach((function(e){e.style.display=p.length>1?"none":""})),r.querySelector("ul."+t._cssClasses.CRS_LIST).style.display=p.length>0||s?"":"none",o.classList.remove(i.Z.classes.LOADING)}))};l?l.getCapabilitiesPromise().then(c):c(),n.Z.Util.showModal(r,e)},e.setProjection=function(e){const t=this;e=e||{},n.Z.loadProjDef({crs:e.crs,callback:function(){t.map.setProjection(e)}})},e.loadFallbackProjections=function(){const e=this,t=e._dialogDiv.querySelector("."+e._cssClasses.CRS_DIALOG).querySelectorAll("ul."+e._cssClasses.CRS_LIST+" li");t.forEach((function(t){t.classList.remove(i.Z.classes.HIDDEN),t.querySelector("button."+e._cssClasses.LOAD_CRS_BUTTON)&&t.classList.add(i.Z.classes.HIDDEN)})),e._dialogDiv.querySelectorAll("p."+i.Z.classes.WARNING).forEach((function(e){e.classList.remove(i.Z.classes.HIDDEN)})),e._dialogDiv.querySelectorAll("."+e._cssClasses.CHANGE).forEach((function(e){e.style.display=t.length>1?"":"none"})),e._dialogDiv.querySelectorAll("."+e._cssClasses.NO_CHANGE).forEach((function(e){e.style.display=t.length>1?"none":""}))}}(),n.Z.control.ProjectionSelector=a;const s=a},8644:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _TC__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(688),_Consts__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(330),_Control__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(7497),_SITNA_feature_Point__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(3048),_itemToolContainer__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(5198),_SITNA_ui_Button__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(9988);_TC__WEBPACK_IMPORTED_MODULE_0__.Z.control=_TC__WEBPACK_IMPORTED_MODULE_0__.Z.control||{},_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.event.DRAWCHART="drawchart.tc",_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.event.DRAWTABLE="drawtable.tc",_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.event.RESULTSPANELMIN="resultspanelmin.tc",_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.event.RESULTSPANELMAX="resultspanelmax.tc",_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.event.RESULTSPANELCLOSE="resultspanelclose.tc",_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.event.RESULTSPANELRESIZE="resultspanelresize.tc";const ResultsPanel=function(){var e=this;_Control__WEBPACK_IMPORTED_MODULE_2__.Z.apply(e,arguments),e.wrap=new _TC__WEBPACK_IMPORTED_MODULE_0__.Z.wrap.control.ResultsPanel(e),e.data={},e.classes={SHOW_IN:"tc-show-in",SHOW_OUT:"tc-show-out",RESIZABLE:"tc-resizable",POSITION_BOTTOM:"tc-pos-bottom",POSITION_TOP:"tc-pos-top"},e.content=e.contentType.TABLE,e._toolContainerSelector=`.${e.CLASS}-tools`,_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.isEmptyObject(e.options)&&(e.options={content:"table"}),e.options,e.options.content&&(e.content=e.contentType[e.options.content.toUpperCase()]),e.options.chart&&(e.chart=e.options.chart),e.options.table&&(e.table=e.options.table),e.options.save&&(e.save=e.options.save),e.options.share&&(e.share=e.options.share)};_TC__WEBPACK_IMPORTED_MODULE_0__.Z.inherit(ResultsPanel,_Control__WEBPACK_IMPORTED_MODULE_2__.Z),function(){const ctlProto=ResultsPanel.prototype;ctlProto.CLASS="tc-ctl-rpanel",ctlProto.COLLIDING_PRIORITY={IGNORE:0,LOW:1,MEDIUM:2,HIGH:3},ctlProto.CHART_SIZE={MIN_HEIGHT:75,MAX_HEIGHT:128,MIN_WIDTH:215,MEDIUM_WIDTH:310,MAX_WIDTH:445};const isElementVisible=function(e){const t=getComputedStyle(e);return e&&!e.hidden&&"none"!==t.display&&"hidden"!==t.visibility};ctlProto.isVisible=function(){const e=this.div.querySelector(".tc-ctl-rpanel-sidebar-body"),t=this.div.querySelector(".tc-ctl-rpanel-minimized-max");return isElementVisible(e)||isElementVisible(t)},ctlProto.isMinimized=function(){const e=this.div.querySelector(".tc-ctl-rpanel-sidebar-body"),t=this.div.querySelector(".tc-ctl-rpanel-minimized-max");return isElementVisible(t)&&!isElementVisible(e)};const manageClassList=function(e,t,r){const n=this.div.querySelector("."+e);n&&(n.classList.add(t),n.classList.remove(r))};ctlProto.show=function(e){const t=this,r=t.div.querySelector("."+e);r&&"none"===r.style.display&&(r.style.display=""),manageClassList.call(t,e,t.classes.SHOW_IN,t.classes.SHOW_OUT)},ctlProto.hide=function(e){const t=this;manageClassList.call(t,e,t.classes.SHOW_OUT,t.classes.SHOW_IN);const r=t.div.querySelector("."+e);r&&(r.style.display="none")},ctlProto.doVisible=function(){this.div.classList.remove(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.classes.HIDDEN),this.show("tc-ctl-rpanel-sidebar-body")};const hideResizeHandlers=function(e){document.querySelectorAll("."+e.CLASS+"-resize-handler").forEach((e=>{e.classList.add(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.classes.HIDDEN)}))};ctlProto.loadTemplates=async function(){const e=this,t=__webpack_require__.e(8226).then(__webpack_require__.bind(__webpack_require__,8226)),r=__webpack_require__.e(8685).then(__webpack_require__.bind(__webpack_require__,2096)),n=__webpack_require__.e(3837).then(__webpack_require__.bind(__webpack_require__,2011)),i={};i[e.CLASS]=(await t).default,i[e.CLASS+"-table"]=(await r).default,i[e.CLASS+"-chart"]=(await n).default,e.template=i};const _addItemTool=function(e,t,r){const n=this;n.addItemTool({renderFn:function(r){const i=n.CLASS+e;let o=r.querySelector("sitna-button."+i);o&&(o.remove(),o=null);const a=n.getLocaleString(t);return o=new _SITNA_ui_Button__WEBPACK_IMPORTED_MODULE_5__.Z,o.variant=_SITNA_ui_Button__WEBPACK_IMPORTED_MODULE_5__.Z.variant.MINIMAL,o.text=a,o.classList.add(i),o},actionFn:r})};ctlProto.render=function(e){const t=this;return t.div.classList.add(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.classes.HIDDEN),_Control__WEBPACK_IMPORTED_MODULE_2__.Z.prototype.render.call(t,(function(){if(t.mainTitleElm=t.div.querySelector(".tc-ctl-rpanel-title-text")||t.div.querySelector(".prpanel-title-text"),t.minimizeButton=t.div.querySelector(".tc-ctl-rpanel-btn-min")||t.div.querySelector(".prcollapsed-slide-submenu-min"),t.minimizeButton.addEventListener("click",(function(){t.minimize()})),t.closeButton=t.div.querySelector(".tc-ctl-rpanel-btn-close")||t.div.querySelector(".prcollapsed-slide-submenu-close"),t.closeButton.addEventListener("click",(function(){t.close();const e=t.div.querySelector(`${t.classes.RESIZABLE}.tc-ctl-rpanel-main`);e&&(e.style.removeProperty("width"),e.style.removeProperty("height"),delete e.dataset.chartSizeWidth,delete e.dataset.chartSizeHeight,delete e.dataset.panelSizeWidth,delete e.dataset.panelSizeHeight)})),t.maximizeButton=t.div.querySelector(".tc-ctl-rpanel-minimized-max")||t.div.querySelector(".prcollapsed-max"),t.maximizeButton.addEventListener("click",(function(){t.maximize()})),t.save&&_addItemTool.apply(t,["-btn-csv","export.excel",function(){t.exportToExcel()}]),t.options.download&&"table"===t.options.content&&_addItemTool.apply(t,["-btn-dwn","download",function(){_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.isFunction(t.options.download)&&t.options.download.apply(t,[])}]),t.options.share&&_addItemTool.apply(t,["-btn-share","shareQuery",function(){t.caller&&t.caller.showShareDialog()}]),t.content&&(t.content=t.content,t.options.titles?(t.options.titles.main&&(t.mainTitleElm.setAttribute("title",t.options.titles.main),t.mainTitleElm.innerHTML=t.options.titles.main),t.options.titles.max&&t.maximizeButton.setAttribute("title",t.options.titles.max)):(t.mainTitleElm.setAttribute("title",t.getLocaleString("rsp.title")),t.mainTitleElm.innerHTML=t.getLocaleString("rsp.title"))),t.infoDiv=t.div.querySelector(".tc-ctl-rpanel-info")||t.div.querySelector(".tc-ctl-p-result-info"),t.tableDiv=t.div.querySelector(".tc-ctl-rpanel-table")||t.div.querySelector(".tc-ctl-p-result-table"),t.menuDiv=t.div.querySelector(".tc-ctl-rpanel-menu")||t.div.querySelector(".tc-ctl-p-result-menu"),_TC__WEBPACK_IMPORTED_MODULE_0__.Z.browserFeatures.touch()&&_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.swipe(t.div,{left:function(){t.minimize()}}),_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.detectMobile())hideResizeHandlers(t);else{const e=!(Object.prototype.hasOwnProperty.call(t.options,"resize")&&!t.options.resize);switch(!0){case"chart"===t.options.content&&e:case t.options.resize:case"table"===t.options.content&&t.infoDiv&&t.infoDiv.childElementCount>0&&e:t.resizable=!0,t.div.classList.add(t.classes.RESIZABLE);break;default:t.resizable=!1}}e&&"function"==typeof e&&e()}))},ctlProto.renderPanelResizable=function(e){const t=this;e=e||{},__webpack_require__.e(6709).then(__webpack_require__.t.bind(__webpack_require__,6709,23)).then((function(r){const n=r.default,i="."+t.classes.RESIZABLE,o=".tc-ctl-rpanel-main",a=e.target&&e.target.querySelector(o)||document.querySelector(o);if(a.classList.add(t.classes.RESIZABLE),a.closest(".tc-ctl-rpanel").classList.add(t.classes.RESIZABLE),!n.isSet(i)){const r=document.querySelector(".tc-chart.c3 svg");r&&(r.parentElement.style.maxHeight="unset",r.removeAttribute("max-height"),r.removeAttribute("max-width"),r.removeAttribute("min-height"),r.removeAttribute("min-width"));n(i).resizable({preserveAspectRatio:e.preserveAspectRatio||!0,edges:{right:".tc-ctl-rpanel-resize-handler",bottom:".tc-ctl-rpanel-resize-handler"},cursorChecker(e,t,r,n){let i="";return r.querySelectorAll(":hover").forEach((function(e){switch(!0){case e.classList.value.indexOf("tc-resizable-grid-handlerRight")>-1:i="w-resize";break;case e.classList.value.indexOf("tc-resizable-grid-handlerBottom")>-1:i="n-resize";break;case e.classList.value.indexOf("tc-resizable-grid-handlerDiagonal")>-1:i="nw-resize";break;default:i="pointer"}})),i},listeners:{end:function(e){t.onResize(e)},move(e){switch(!0){case"w-resize"===e.target.style.cursor:Object.assign(e.target.style,{width:`${e.rect.width}px`,height:`${e.target.getBoundingClientRect().height}px`});break;case"nw-resize"===e.target.style.cursor:Object.assign(e.target.style,{width:`${e.rect.width}px`,height:`${e.rect.height}px`});break;case"n-resize"===e.target.style.cursor:Object.assign(e.target.style,{width:`${e.target.getBoundingClientRect().width}px`,height:`${e.rect.height}px`})}e.target.querySelector(".tc-chart.c3")&&e.target.classList.add(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.classes.LOADING)}},modifiers:[n.modifiers.restrict({restriction:"body"})]});e.callback&&_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.isFunction(e.callback)&&e.callback()}}))},ctlProto.getResizableChartSize=function(e){if(e){let t=e.querySelector(".tc-chart.c3").getBoundingClientRect();return{width:t.width,height:t.height}}},ctlProto.getResultsPanelFromElement=function(e){const t=this;let r=t.map.getControlsByClass(ResultsPanel);for(var n=0;n<r.length;n++)if(r[n].div.querySelector(`.${t.classes.RESIZABLE}.tc-ctl-rpanel-main`)===e)return r[n];return null},ctlProto.onResize=function(e){const t=this,r=e.target;if(r.querySelector(".tc-chart.c3")){r.classList.remove(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.classes.LOADING);const e=t.getResizableChartSize(r);if(e){let n=t.getResultsPanelFromElement(r);n&&n.chart.chart.resize(e)}}t.map.trigger(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.event.RESULTSPANELRESIZE,{control:t,size:{width:r.getBoundingClientRect().width,height:r.getBoundingClientRect().height}})},ctlProto.minimize=function(){const e=this,t=e.div.querySelector(e.content.collapsedClass);t.classList.contains(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.classes.HIDDEN)&&(t.classList.remove(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.classes.HIDDEN),e.hide("tc-ctl-rpanel-sidebar-body"),e.show("tc-ctl-rpanel-minimized-max"),e.map.trigger(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.event.RESULTSPANELMIN,{control:e}),collidingManagement.remove(e))},ctlProto.maximize=function(){const e=this,t=e.div.querySelector(e.content.collapsedClass);t.classList.contains(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.classes.HIDDEN)||(t.classList.add(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.classes.HIDDEN),e.show("tc-ctl-rpanel-sidebar-body"),e.hide("tc-ctl-rpanel-minimized-max"),e.map.trigger(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.event.RESULTSPANELMAX,{control:e}),collidingManagement.add(e))},ctlProto.close=function(){const e=this;if(e.div.classList.add(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.classes.HIDDEN),e.chart&&e.chart.chart){const t=e.div.querySelector(`${e.classes.RESIZABLE}.tc-ctl-rpanel-main`);if(t&&t.style&&t.style.width&&t.style.height){const e=t.querySelector(".tc-chart").getBoundingClientRect();parseInt(e.width)>0&&parseInt(e.height)>0&&(t.dataset.chartSizeWidth=e.width,t.dataset.chartSizeHeight=e.height),t.dataset.panelSizeWidth=t.style.width,t.dataset.panelSizeHeight=t.style.height}e.chart.chart=e.chart.chart.destroy()}const t=e.getContainerElement();if(t){t.style.display="none",e.div.querySelector(".tc-ctl-rpanel-minimized-max").style.display="none",t.querySelectorAll("video,audio,iframe").forEach((e=>e.remove()));e.div.querySelector(e.content.collapsedClass).classList.add(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.classes.HIDDEN);let r=document.querySelector("."+e.classes.RESIZABLE);r&&(r.style=""),e.map.trigger(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.event.RESULTSPANELCLOSE,{control:e,feature:e.currentFeature}),collidingManagement.remove(e)}},ctlProto.openChart=function(e){const t=this;t.onOpen(),t.div.classList.remove(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.classes.HIDDEN),t.map.getControlsByClass(ResultsPanel).filter((function(e){return e!==t})).filter((function(e){return"chart"===e.options.content})).forEach((function(e){e.close()})),e&&(e.msg?(t.map.toast(e.msg),t.isVisible()&&t.hide("tc-ctl-rpanel-sidebar-body")):(t.elevationProfileChartData=e,t.renderElevationProfileChart({data:e,div:t.div.querySelector("."+ctlProto.CLASS+"-chart")})))};const formatYAxis=function(e,t){return(parseInt(e.toFixed(0))||0).toLocaleString(t)+" m"};ctlProto.renderElevationProfileChart=async function(options){const self=this;options=options||{};const c3=(await __webpack_require__.e(5327).then(__webpack_require__.t.bind(__webpack_require__,5327,23))).default,data=options.data;data.ele=data.ele.map((e=>null===e?0:e));const div=options.div;let locale=_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.getMapLocale(self.map);const titleBar=self.div.querySelector(".tc-ctl-rpanel-title");self.getItemTools().forEach((e=>self.addItemToolUI(titleBar,e)));var templateData={upHill:data.upHill?data.upHill.toLocaleString(locale):"0",downHill:data.downHill?data.downHill.toLocaleString(locale):"0"};const hasSecondaryElevationProfileChartData=data.secondaryElevationProfileChartData&&Array.isArray(data.secondaryElevationProfileChartData)&&data.secondaryElevationProfileChartData.length>0&&data.secondaryElevationProfileChartData[0];hasSecondaryElevationProfileChartData&&(templateData.min=formatYAxis(data.min,locale),templateData.max=formatYAxis(data.max,locale),templateData.secondChart={upHill:data.secondaryElevationProfileChartData[0].upHill?data.secondaryElevationProfileChartData[0].upHill.toLocaleString(locale):"0",downHill:data.secondaryElevationProfileChartData[0].downHill?data.secondaryElevationProfileChartData[0].downHill.toLocaleString(locale):"0",min:formatYAxis(data.secondaryElevationProfileChartData[0].min,locale),max:formatYAxis(data.secondaryElevationProfileChartData[0].max,locale)}),self.getRenderedHtml(ctlProto.CLASS+"-chart",templateData,(function(out){if(div.innerHTML=out,div.style.display="",self.options.titles){if(self.options.titles.main){const e=self.div.querySelector(".tc-ctl-rpanel-title-text");e.setAttribute("title",self.options.titles.main),e.innerHTML=self.options.titles.main}self.options.titles.max&&self.div.querySelector(".tc-ctl-rpanel-minimized-max").setAttribute("title",self.options.titles.max)}var legendOptions={show:!1};hasSecondaryElevationProfileChartData&&(legendOptions={position:"inset",inset:{anchor:"bottom-left",x:-55,y:-30,step:1}});let chartOptions=_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.extend({bindto:div.querySelector(".tc-chart"),padding:{top:13,right:15,bottom:0,left:45},legend:legendOptions},self.createChartOptions(data));const resizedTarget=self.div.querySelector(`${self.classes.RESIZABLE}.tc-ctl-rpanel-main`);resizedTarget&&resizedTarget.dataset.chartSizeWidth&&parseInt(resizedTarget.dataset.chartSizeWidth)>0&&resizedTarget.dataset.chartSizeHeight&&parseInt(resizedTarget.dataset.chartSizeHeight)>0&&(_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.extend(chartOptions.size,{width:resizedTarget.dataset.chartSizeWidth,height:resizedTarget.dataset.chartSizeHeight}),resizedTarget.dataset.panelSizeWidth&&parseInt(resizedTarget.dataset.panelSizeWidth)>0&&resizedTarget.dataset.panelSizeHeight&&parseInt(resizedTarget.dataset.panelSizeHeight)>0&&(resizedTarget.style.width=resizedTarget.dataset.panelSizeWidth,resizedTarget.style.height=resizedTarget.dataset.panelSizeHeight)),self.chart.tooltip&&(chartOptions.tooltip={position:function(e,t,r,n){let i=document.querySelector(".c3-tooltip-container"),o=document.querySelector(".c3").getBoundingClientRect().left,a=document.querySelector(".c3 g.c3-axis-y").getBoundingClientRect().right,s=i.clientWidth,l=parseInt(d3.mouse(n)[0])+a-o-Math.floor(s/2),c=document.querySelector(".c3 g.c3-axis-x").getBoundingClientRect().height+2,u=i.querySelector(`.${self.classes.POSITION_BOTTOM}`);return u&&c&&(u.style.height=c+"px"),{top:0,left:l}},contents:function(d){var fn=self.chart.tooltip;return"function"!=typeof fn&&(fn=_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.getFnFromString(self.chart.tooltip)),fn.call(eval(self.chart.ctx),d)}}),self.chart&&self.chart.onmouseout&&(chartOptions.onmouseout=function(){var fn=self.chart.onmouseout;"function"!=typeof fn&&(fn=_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.getFnFromString(self.chart.onmouseout)),fn.call(eval(self.chart.ctx))}),chartOptions.onrendered=function(){_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.isFunction(chartOptions._onrendered)&&chartOptions._onrendered.call(this),self.map.trigger(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.event.DRAWCHART,{control:self,svg:this.svg[0][0],chart:this})},c3._isOverriden||(c3.chart.internal.fn.generateDrawLine=function(e,t){var r=this,n=r.config,i=r.d3.svg.line(),o=r.generateGetLinePoints(e,t),a=t?r.getSubYScale:r.getYScale,s=function(e){return(t?r.subxx:r.xx).call(r,e)},l=function(e,t){return n.data_groups.length>0?o(e,t)[0][1]:a.call(r,e.id)(e.value)};return i=n.axis_rotated?i.x(l).y(s):i.x(s).y(l),n.line_connectNull||(i=i.defined((function(e){return null!=e.value}))),function(e){var o,s=n.line_connectNull?r.filterRemoveNull(e.values):e.values,l=t?r.x:r.subX,c=a.call(r,e.id),u=0,p=0;return r.isLineType(e)?n.data_regions[e.id]?o=r.lineWithRegions(s,l,c,n.data_regions[e.id]):(r.isStepType(e)&&(s=r.convertValuesToStep(s)),o=i.interpolate("linear")(s)):(s[0]&&(u=l(s[0].x),p=c(s[0].value)),o=n.axis_rotated?"M "+p+" "+u:"M "+u+" "+p),o||"M 0 0"}},c3.chart.internal.fn.generateDrawArea=function(e,t){var r=this,n=r.config,i=r.d3.svg.area(),o=r.generateGetAreaPoints(e,t),a=t?r.getSubYScale:r.getYScale,s=function(e){return(t?r.subxx:r.xx).call(r,e)},l=function(e,t){return n.data_groups.length>0?o(e,t)[0][1]:a.call(r,e.id)(0)},c=function(e,t){return n.data_groups.length>0?o(e,t)[1][1]:a.call(r,e.id)(e.value)};return i=n.axis_rotated?i.x0(l).x1(c).y(s):i.x(s).y0(l).y1(c),n.line_connectNull||(i=i.defined((function(e){return null!==e.value}))),function(e){var t,o=n.line_connectNull?r.filterRemoveNull(e.values):e.values,a=0,s=0;return r.isAreaType(e)?(r.isStepType(e)&&(o=r.convertValuesToStep(o)),t=i.interpolate("linear")(o)):(o[0]&&(a=r.x(o[0].x),s=r.getYScale(e.id)(o[0].value)),t=n.axis_rotated?"M "+s+" "+a:"M "+a+" "+s),t||"M 0 0"}},c3._isOverriden=!0),self.chart.chart=c3.generate(chartOptions)}))};const closeOpenedTableResultsPanel=function(){const e=this;e.map.getControlsByClass(ResultsPanel).filter((function(t){return t!==e&&t.isVisible()})).filter((function(e){return"chart"!==e.options.content})).forEach((function(e){e.close()}))};ctlProto.openTable=function(){var e=this;e.onOpen(),e.div.classList.remove(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.classes.HIDDEN);var t=arguments[0];if(t){var r;t.css&&(r=t.css);var n=t.callback,i=t.columns;if(t.data&&t.data.length>0){if(!i)for(var o in i=[],t.data[0])i.push(o);e.tableData={columns:i,results:t.data,css:r,callback:n,sort:t.sort?{}:null};var a=null;const s=(t,r,n)=>{var i=t;if(r){const o=e.tableData.results.map((function(e,t){return{index:t,properties:e}}));o.sort(((e,t)=>{const i=e.properties[r]||"",o=t.properties[r]||"";return n?"string"==typeof i?i.localeCompare(o):i<o?-1:i==o?0:1:"string"==typeof o?o.localeCompare(i):i<o?1:i==o?0:-1})),(i=Object.assign({},t,{results:o.map((function(e){return Object.assign({},e.properties,{index:e.index})}))})).sort={field:r,order:n}}e.getRenderedHtml(e.CLASS+"-table",i).then((function(r){const n=e.div.querySelector(".tc-ctl-rpanel-table"),o=n.parentElement;o.removeChild(n),n.innerHTML=r,o.appendChild(n),t.callback&&t.callback(n),i.sort&&n.querySelectorAll("thead th").forEach((e=>{e.addEventListener("click",(e=>{a=e.target.offsetParent.scrollLeft;const r=e.target.dataset.orderField||e.target.innerText;i.sort.field===r&&i.sort.order?s(t,r,!1):(i.sort.field!==r||i.sort.order,s(t,r,!0))}))})),closeOpenedTableResultsPanel.call(e);const l=e.div.querySelector(".tc-ctl-rpanel-title");e.getItemTools().forEach((t=>e.addItemToolUI(l,t))),e.map.trigger(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.event.DRAWTABLE,{control:e}),a&&(n.scrollLeft=a)}))};s(e.tableData),e.div.querySelector(".tc-ctl-rpanel-chart").style.display="none",e.div.querySelector(".tc-ctl-rpanel-info").style.display="none",e.show("tc-ctl-rpanel-sidebar-body")}}};const collidingManagement={add:function(e){const t=e.div.querySelector(".tc-ctl-rpanel-sidebar-body");t.style.bottom="";const r=e.map.getControlsByClass(ResultsPanel).filter((t=>t.content===t.contentType.TABLE&&t!==e)).filter((e=>t.colliding(e.div.querySelector(".tc-ctl-rpanel-sidebar-body")))).reduce(((e,t)=>e+t.div.querySelector(".tc-ctl-rpanel-sidebar-body").clientHeight),0);r&&(t.style.bottom=r+"px")},remove:function(e){e.map.getControlsByClass(ResultsPanel).filter((t=>t.content===t.contentType.TABLE&&t!==e)).forEach((e=>{e.div.querySelector(".tc-ctl-rpanel-sidebar-body").style.bottom=""}))}};ctlProto.open=function(e,t){const r=this;r.onOpen(),r.div.classList.remove(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.classes.HIDDEN);const n=t||r.div.querySelector(".tc-ctl-rpanel-table");r.requestIsRendered=window.requestAnimationFrame(function(){var e=n.getBoundingClientRect();if(e&&e.width>100){window.cancelAnimationFrame(this.requestIsRendered);const e=r.div.querySelector(".tc-ctl-rpanel-title");r.getItemTools().forEach((t=>r.addItemToolUI(e,t))),this.map.trigger(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.event.DRAWTABLE,{control:r})}}.bind(r));const i=r.div.querySelector(".tc-ctl-rpanel-chart");i.style.display="none";const o=r.div.querySelector(".tc-ctl-rpanel-table");o.style.display="none";const a=r.div.querySelector(".tc-ctl-rpanel-info");a.style.display="none",e?t?(r.getTableContainer=function(){return t},t.innerHTML=e,t.style.display=""):(o.innerHTML=e,o.style.display=""):i.childElementCount?i.style.display="":o.childElementCount?o.style.display="":a.childElementCount&&(a.style.display="");const s=r.div.querySelector(".tc-ctl-rpanel-minimized-max");if(r.options.titles){if(r.options.titles.main){const e=r.div.querySelector(".tc-ctl-rpanel-title-text");e.setAttribute("title",r.options.titles.main),e.innerHTML=r.options.titles.main}r.options.titles.max&&s.setAttribute("title",r.options.titles.max)}r.options.classes&&r.options.classes.collapsed&&s.querySelector("span.tc-ctl-rpanel-minimized-max-table").classList.add(r.options.classes.collapsed);const l=r.div.querySelector(r.content.collapsedClass);isElementVisible(l)&&r.maximize(),r.show("tc-ctl-rpanel-sidebar-body"),r.hide("tc-ctl-rpanel-minimized-max"),collidingManagement.add(r)},ctlProto.onOpen=function(){const e=this;e.resizable?e.renderPanelResizable({target:e.div,preserveAspectRatio:!0}):hideResizeHandlers(e)},ctlProto.loadDataOnChart=function(e){const t=this,r=function(){t.elevationProfileChartData=e,t.renderElevationProfileChart({data:e,div:t.div.querySelector("."+ctlProto.CLASS+"-chart")})};t.chart&&t.chart.chart?t.chart.chart.unload({done:r}):r()},ctlProto.createChartOptions=function(e){const t=this;var r={};const n=(e=e||{}).locale||_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.getMapLocale(t.map);if(e.chartType,null!=e.ele){const o=function(){const r=getComputedStyle(t.getContainerElement()),n=document.documentElement.clientWidth/100*40,i={height:n>445?e.maxHeight||t.CHART_SIZE.MAX_HEIGHT:e.minHeight||t.CHART_SIZE.MIN_HEIGHT};return r.width===getComputedStyle(t.map.div).width?i.width=.95*parseFloat(r.width):i.width=n>445?e.maxWidth||t.CHART_SIZE.MAX_WIDTH:n>310?e.mediumWidth||t.CHART_SIZE.MEDIUM_WIDTH:e.minWidth||t.CHART_SIZE.MIN_WIDTH,i},a=["grad"+_TC__WEBPACK_IMPORTED_MODULE_0__.Z.getUID()];let s=Number.NEGATIVE_INFINITY,l=Number.POSITIVE_INFINITY;e.ele.forEach((function(e){"number"==typeof e&&(s=Math.max(e,s),l=Math.min(e,l))}));let c=[...e.x],u=[...e.ele];r={data:{x:"x",columns:[["x"].concat(c),["ele"].concat(u)],types:{ele:"area-spline"},colors:{ele:"url(#"+a[0]+")"}},size:o(),point:{show:!1},axis:{x:{tick:{outer:!1,count:5,format:function(e){var t,r;return(e/=1e3)<1?(t=Math.round(1e3*e),r=" m"):(t=Math.round(100*e)/100,r=" km"),(t=t.toLocaleString(n))+r}}},y:{padding:{top:0,bottom:0},max:s,min:l,tick:{count:2,format:function(e){return formatYAxis(e,n)}}}},onresize:function(){let e,r=this.config.bindto.closest(`${t.classes.RESIZABLE}.tc-ctl-rpanel-main`);e=r?t.getResizableChartSize(r):o(),e&&this.api.resize(e)}};const p=e.secondaryElevationProfileChartData&&Array.isArray(e.secondaryElevationProfileChartData)&&e.secondaryElevationProfileChartData.length>0&&e.secondaryElevationProfileChartData[0];p&&(r.data.names={ele:t.getLocaleString("geo.profile.fromTrack"),ele2:t.getLocaleString("mdt")},r.data.columns.push(["ele2"].concat(e.secondaryElevationProfileChartData[0].ele)),r.data.types.ele2=r.data.types.ele,a.push("grad"+_TC__WEBPACK_IMPORTED_MODULE_0__.Z.getUID()),r.data.colors.ele2="url(#"+a[a.length-1]+")",r.data.axes={ele:"y"},u.every((e=>0===e))?(r.axis.y.min=e.secondaryElevationProfileChartData[0].min,r.axis.y.max=e.secondaryElevationProfileChartData[0].max):e.secondaryElevationProfileChartData[0].ele.every((e=>0===e))?(r.axis.y.min=Math.min(...u),r.axis.y.max=Math.max(...u)):(r.axis.y.min=Math.min(...u.concat(e.secondaryElevationProfileChartData[0].min)),r.axis.y.max=Math.max(...u.concat(e.secondaryElevationProfileChartData[0].max)))),e.time&&(r.time=("00000"+e.time.h).slice(-2)+":"+("00000"+e.time.m).slice(-2)+":"+("00000"+e.time.s).slice(-2));var i=!1;r._onrendered=function(){if(i||(i=!0,p&&(document.querySelectorAll(".c3-legend-item-tile").forEach((e=>{e.setAttribute("rx",5),e.setAttribute("ry",1)})),document.querySelectorAll(".c3-legend-item").forEach((e=>{var r=document.createElementNS("http://www.w3.org/2000/svg","title");r.textContent=t.getLocaleString("hide"),e.appendChild(r),e.addEventListener(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.event.CLICK,(function(){e.classList.contains(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.classes.HIDDEN)?e.querySelector("title").textContent=t.getLocaleString("hide"):e.querySelector("title").textContent=t.getLocaleString("show"),e.classList.toggle(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.classes.HIDDEN)}),{passive:!0})})))),!this.svg)return;const r=this.svg[0][0];var n=r.getElementsByTagName("defs")[0],o="http://www.w3.org/2000/svg";const s=function(e,t){var r=document.createElementNS(o,"linearGradient");r.setAttributeNS(null,"id",e),r.setAttributeNS(null,"x1","0%"),r.setAttributeNS(null,"x2","0%"),r.setAttributeNS(null,"y1","0%"),r.setAttributeNS(null,"y2","100%"),r.setAttributeNS(null,"gradientUnits","userSpaceOnUse");const i=document.createElementNS(o,"stop");i.setAttributeNS(null,"offset","0%"),i.setAttributeNS(null,"stop-color",t[0]),i.setAttributeNS(null,"stop-opacity","0.7"),r.appendChild(i);const a=document.createElementNS(o,"stop");a.setAttributeNS(null,"offset","50%"),a.setAttributeNS(null,"stop-color",t[1]),a.setAttributeNS(null,"stop-opacity","0.9"),r.appendChild(a);const s=document.createElementNS(o,"stop");s.setAttributeNS(null,"offset","100%"),s.setAttributeNS(null,"stop-color",t[2]),s.setAttributeNS(null,"stop-opacity","1"),r.appendChild(s),n.appendChild(r)};s(a[0],["red","orange","green"]),e.secondaryElevationProfileChartData&&s(a[a.length-1],["blue","cian","green"]);const l=d3.select(".c3-brush").node();l&&l.parentNode.removeChild(l),d3.select(".c3-event-rects,.c3-event-rects-single").selectAll("rect").style("cursor","pointer").on("click",(function(e){d3.event.stopPropagation();let r=t.elevationProfileChartData.coords[e.index];r&&(r=r.slice(0,2),t.map.crs!==t.map.options.utmCrs&&(r=_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.reproject(r,t.map.options.utmCrs,t.map.crs)),t.map.zoomToFeatures([new _SITNA_feature_Point__WEBPACK_IMPORTED_MODULE_3__.Z(r,{})]))}));const c=d3.select(".c3-axis.c3-axis-x").select("path");if(!c.empty()){let e=c.attr("d");if(/^M\d\,(\d)V\dH\d{3}V(\d)$/i.exec(e))e=e.replace(/(M\d\,)\d/i,"$10").replace(/(H\d{3}V)(\d)/i,"$10"),c.attr("d",e);else{/^M\s\d\s(\d)\sV\s\d\sH\s\d{3}\sV\s(\d)$/i.exec(e)&&(e=e.replace(/(M\s\d\s)\d/i,"$10").replace(/(H\s\d{3}\sV\s)(\d)/i,"$10"),c.attr("d",e))}}const u=r.getBoundingClientRect(),h={width:u.width,height:u.height};var d=function(){var e=d3.scale.ordinal().rangeRoundBands([0,h.width],.1,.3);d3.select(".c3-axis-x").selectAll("text:not(.c3-axis-x-label)").call((function(e,t){e.each((function(){e.each((function(e,t){if(0===t)return;const r=d3.select(this);if(1===r.node().childNodes.length){var n=r.select("tspan").node().cloneNode(),i=r.text().split(" ");r.select("tspan").text(i[0]),n.textContent=i[1];var o=n.getAttribute("dy");o=(o=o?parseFloat(n.getAttribute("dy")):.71)+.18+"em",n.setAttribute("dy",o),r.node().appendChild(n)}}))}))}),e.rangeBand())};const f=d3.select(".c3-axis-x").node().getBoundingClientRect();if(f.width){const e=d3.select(".c3-axis-y").node().getBoundingClientRect();(f.width>=h.width-e.width||100*f.width/(h.width-e.width)>90)&&d()}else{t.elevationChartLabelsRAF&&(window.cancelAnimationFrame(t.elevationChartLabelsRAF),t.elevationChartLabelsRAF=void 0);const e=function(){const r=d3.select(".c3-axis-x"),n=r.node();if(r.length&&!n)t.elevationChartLabelsRAF=requestAnimationFrame(e);else if(r.length&&n&&!n.getBoundingClientRect().width)t.elevationChartLabelsRAF=requestAnimationFrame(e);else{window.cancelAnimationFrame(t.elevationChartLabelsRAF),t.elevationChartLabelsRAF=void 0;const e=n.getBoundingClientRect(),r=d3.select(".c3-axis-y").node().getBoundingClientRect();(e.width>=h.width-r.width||100*e.width/(h.width-r.width)>90)&&d()}};t.elevationChartLabelsRAF=requestAnimationFrame(e)}d3.select("svg").select(".c3-chart-lines").selectAll(".c3-target-ele").each((function(){this.parentNode.appendChild(this)})),t.isMinimized()||(t.show("tc-ctl-rpanel-sidebar-body"),t.hide("tc-ctl-rpanel-minimized-max")),t.div.querySelector(".tc-ctl-rpanel-table").style.display="",t.div.querySelector(".tc-ctl-rpanel-info").style.display=""}}else r={msg:t.getLocaleString("geo.trk.chart.chpe.empty")};return r};const getTime=function(e,t){var r=t-e,n={},i=Math.floor(r/1e3/60/60/24);r-=1e3*i*60*60*24;var o=Math.floor(r/1e3/60/60);r-=1e3*o*60*60,n.h=o+24*i;var a=Math.floor(r/1e3/60);return r-=1e3*a*60,n.m=a,n.s=Math.floor(r/1e3),_TC__WEBPACK_IMPORTED_MODULE_0__.Z.Util.extend({},n,{toString:("00000"+n.h).slice(-2)+":"+("00000"+n.m).slice(-2)+":"+("00000"+n.s).slice(-2)})};ctlProto.getElevationChartTooltip=function(e){const t=this,r=t.map.options.locale&&t.map.options.locale.replace("_","-")||void 0,n=t.elevationProfileChartData.coords,i=function(e){return e.value?parseInt(e.value.toFixed(0)).toLocaleString(r):"0"},o=n[e[0].index];let a;4===n[0].length&&n[0][3]>0&&o&&(a=getTime(n[0][3],o[3]));let s=e[0].x/1e3,l=(s<1?Math.round(1e3*s):Math.round(100*s)/100).toLocaleString(r)+(s<1?" m":" km");return`<div class="${t.classes.POSITION_TOP}"><span>`+e.map(((e,t)=>e?0===t?'<span data-isNumber class="'+("ele"===e.id?"tc-original":"tc-mdt")+'">'+i(e)+" m</span>":'<span data-isNumber class="'+("ele"===e.id?"tc-original":"tc-mdt")+'">'+i(e)+" m </span>":"")).join("")+"</span ></div>"+(`<div class="${t.classes.POSITION_BOTTOM}"><span>${l} </span>`+(a?"<span>"+a.toString+"</span><div/>":"<div/>"))},ctlProto.getTableContainer=function(){return this.tableDiv},ctlProto.getInfoContainer=function(){return this.infoDiv},ctlProto.getMenuElement=function(){return this.menuDiv},ctlProto.getContainerElement=function(){return this.div.querySelector(".tc-ctl-rpanel-sidebar-body")},ctlProto.register=function(e){const t=this,r=_Control__WEBPACK_IMPORTED_MODULE_2__.Z.prototype.register.call(t,e);return t.wrap.register(e),t.openOn&&t.map.one(t.openOn,(function(e,r){t.content.fnOpen.call(t,e.data)})),t.closeOn&&t.map.one(t.closeOn,(function(e,r){t.close()})),t.options.openOn&&t.map.on(t.options.openOn,(function(e,r){t.content.fnOpen.call(t,e.data)})),t.options.closeOn&&t.map.on(t.options.closeOn,(function(e,r){t.close()})),e.on(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.event.FEATUREREMOVE,(function(e){t.currentFeature===e.feature&&t.isVisible()&&t.close()})).on(_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.event.FEATURESCLEAR+" "+_Consts__WEBPACK_IMPORTED_MODULE_1__.Z.event.LAYERREMOVE,(function(e){t.currentFeature&&t.currentFeature.layer===e.layer&&t.isVisible()&&t.close()})),r},ctlProto.exportToExcel=function(){const e=this;var t=[e.tableData.columns];e.tableData.results.forEach((function(e){var r=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&"Id"!==n&&"Geom"!==n&&r.push(e[n]);t.push(r)})),Promise.resolve().then(__webpack_require__.bind(__webpack_require__,1446)).then((function(r){const n=new(0,r.default);var i=e.save.fileName?e.save.fileName:"resultados.xls",o=e.options.titles&&e.options.titles.main?e.options.titles.main:null;n.Save(i,t,o)}))},ctlProto.contentType={TABLE:{fnOpen:ctlProto.openTable,collapsedClass:`.${ctlProto.CLASS}-minimized-max-table`},CHART:{fnOpen:ctlProto.openChart,collapsedClass:`.${ctlProto.CLASS}-minimized-max-chart`}}}(),_TC__WEBPACK_IMPORTED_MODULE_0__.Z.control.ResultsPanel=ResultsPanel,_TC__WEBPACK_IMPORTED_MODULE_0__.Z.mix(ResultsPanel,_itemToolContainer__WEBPACK_IMPORTED_MODULE_4__.default);const __WEBPACK_DEFAULT_EXPORT__=ResultsPanel},5515:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var n=r(688),i=r(330),o=r(7497);n.Z.control=n.Z.control||{};const a=function(){const e=this;o.Z.apply(this,arguments),e.serviceWorkerEnabled=!1,e.serviceWorkerIsRequired=e.options.serviceWorkerIsRequired||!0};n.Z.inherit(a,o.Z),function(){var e=a.prototype;e.CLASS="tc-ctl-swcc",e.SW_URL="tc-cb-service-worker.js",e.register=function(e){const t=this,r=o.Z.prototype.register.call(t,e);return t._swPromise=new Promise((function(e,r){navigator.serviceWorker?navigator.serviceWorker.register(t.SW_URL,{scope:"./"}).then((function(r){t.serviceWorkerEnabled=!0,r.installing?e(r.installing):r.waiting?e(r.waiting):r.active&&e(r.active),console.log(r.scope,"register")}),(function(e){t.serviceWorkerEnabled=!1,r(new Error(e)),console.error("Could not register service worker: "+e)})):r(new Error("Browser does not support service workers"))})),t._swPromise.catch((()=>{let r=!1;const n=window.parent!==window;for(var o=window;!r;o=o.parent){try{"https:"!==o.location.protocol&&(r=!0)}catch(e){}if(o===o.parent)break}r?e.toast(t.getLocaleString("httpsRequired.warning",{url:location.href.replace(location.protocol,"")}),{type:i.Z.msgType.WARNING}):n?e.toast(t.getLocaleString("frameOrNotCompatible.warning"),{type:i.Z.msgType.WARNING}):t.serviceWorkerIsRequired&&e.toast(t.getLocaleString("browserNotCompatible.warning"),{type:i.Z.msgType.WARNING})})),r},e.getServiceWorker=function(){return this._swPromise?this._swPromise:Promise.reject(new Error("No service worker available"))};var t=function(e,t,r,n,i){var o="message";navigator.serviceWorker.addEventListener(o,(function a(s){s.data.name===r&&(s.data.action===n&&s.data.event===i?e(r):"error"===s.data.event&&t(Error(`Error message from service worker [${s.data.url} - ${s.data.action} - ${s.data.name}]`)),"progress"!==s.data.event&&navigator.serviceWorker.removeEventListener(o,a))}))};e.createCache=function(e,r){var n=this;return new Promise((function(i,o){n.getServiceWorker().then((function(n){var a="create",s=r||{};t(i,o,e,a,"cached"),n.postMessage({action:a,name:e,requestId:s.requestId,list:s.urlList||[],silent:s.silent})}),(function(){i(!1)}))}))},e.deleteCache=function(e,r){var n=this;return new Promise((function(i,o){n.getServiceWorker().then((function(n){var a="delete",s=r||{};t(i,o,e,a,"deleted"),n.postMessage({action:a,requestId:s.requestId,name:e,silent:s.silent})}),(function(){i(!1)}))}))}}(),n.Z.control.SWCacheClient=a;const s=a},8792:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var n=r(688),i=r(330),o=r(9967),a=r(268),s=r(7497);n.Z.control=n.Z.control||{},i.Z.SCREEN_SIZE_KEY="TC.Map.screenSize";class l extends s.Z{constructor(){super(...arguments);this.div.classList.add(this.CLASS)}getClassName(){return"tc-ctl-scl"}async loadTemplates(){const e=await r.e(3153).then(r.bind(r,3153));this.template=e.default}render(e){const t=this;return t._set1stRenderPromise(t.renderData({scale:t.getScale(),screenSize:o.Z.screenSize},(function(){const r=t.div.querySelector("span");r.textContent="1:"+t.format(r.textContent.substr(2)),t.div.querySelector('input[type="button"]').addEventListener(i.Z.event.CLICK,(function(){t.setScreenSize()}),{passive:!0}),a.Z.isFunction(e)&&e()})))}register(e){const t=this,r=super.register.call(t,e);let n=a.Z.storage.getLocalValue(i.Z.SCREEN_SIZE_KEY);return n&&(o.Z.screenSize=n),t.render((function(){e.on(i.Z.event.ZOOM,(function(){delete t.metersPerDegree,t.update()}))})),r}update(){this.render()}setScreenSize(){const e=this;n.Z.prompt(e.getLocaleString("selectScreenSize"),o.Z.screenSize,(function(t){t&&(o.Z.screenSize=parseFloat(t),a.Z.storage.setLocalValue(i.Z.SCREEN_SIZE_KEY,o.Z.screenSize),e.update())}))}getScale(e){const t=this;var r=0,n=!e&&t.map?t.map.wrap.getResolution():e;if(n&&(r=n*t.getDpi(o.Z.screenSize)/.0254,window.devicePixelRatio&&(r*=window.devicePixelRatio)),t.map&&t.map.wrap.isGeo()){if(!t.metersPerDegree){var i=t.map.getExtent();i&&(t.metersPerDegree=a.Z.getMetersPerDegree(i))}t.metersPerDegree&&(r*=t.metersPerDegree)}return r}getDpi(e){return this.dpi=Math.sqrt(screen.width*screen.width+screen.height*screen.height)/e,this.dpi}format(e){for(var t=new Number(e).toFixed(0),r=[];t.length>3;){var n=t.length-3;r.unshift(t.substr(n)),t=t.substr(0,n)}return t&&r.unshift(t),r.join(".")}}n.Z.control.Scale=l;const c=l},9510:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var n=r(688),i=r(7497);n.Z.control=n.Z.control||{};class o extends i.Z{constructor(){super(...arguments);this.div.classList.add(this.CLASS)}getClassName(){return"tc-ctl-sb"}render(){const e=this;return e.wrap||(e.wrap=new n.Z.wrap.control.ScaleBar(e)),e.wrap.render(),e._set1stRenderPromise(Promise.resolve())}async register(e){const t=this;return(await Promise.all([super.register.call(t,e),e.wrap.getMap()]))[1].addControl(t.wrap.ctl),t}getText(){return this.wrap.getText()}}n.Z.control.ScaleBar=o;const a=o},6161:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var n=r(688),i=r(330),o=r(9967),a=r(268),s=r(8792);function l(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}n.Z.control=n.Z.control||{};class c extends s.default{constructor(){super(...arguments),l(this,"scales",null);this.div.classList.add(this.CLASS)}getClassName(){return"tc-ctl-ss"}async loadTemplates(){const e=await r.e(824).then(r.bind(r,824));this.template=e.default}render(e){const t=this;return t._set1stRenderPromise(new Promise((function(r,n){if(t.map){!t.scales&&t.map.options.resolutions&&(t.scales=t.map.options.resolutions.map(t.getScale,t));var s=function(){t.scales=t.map.wrap.getResolutions().map(t.getScale,t),t.renderData({scale:t.getScale(),screenSize:o.Z.screenSize,scales:t.scales},(function(){t.div.querySelectorAll("option").forEach((function(e){e.textContent="1:"+t.format(e.textContent.substr(2))})),t.div.querySelector('input[type="button"]').addEventListener(i.Z.event.CLICK,(function(){t.setScreenSize()}),{passive:!0}),t.div.querySelector("select").addEventListener("change",(function(){t.setScale(this.value)})),a.Z.isFunction(e)&&e(),r()})).catch((function(e){n(e instanceof Error?e:Error(e))}))};t.scales?s():t.map.wrap.getMap().then(s)}else n(Error("ScaleSelector no registrado"))})))}setScale(e){const t=this;let r=.0254*e/t.getDpi(o.Z.screenSize);return window.devicePixelRatio&&(r/=window.devicePixelRatio),t.metersPerDegree&&(r/=t.metersPerDegree),t.map.wrap.setResolution(r),r}}n.Z.control.ScaleSelector=c;const u=c},9085:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var n=r(688),i=r(330),o=r(9967),a=r(7497),s=r(6204),l=r(7167),c=r(5394),u=r(8288);n.Z.control=n.Z.control||{},n.Z.filter=c.Z,n.Z.UI=n.Z.UI||{},n.Z.UI.autocomplete=u.Z,n.Z.Defaults=o.k,n.Z.control.infoShare=l.default,n.Z.Control=a.Z,window.performance?window.performance&&!window.performance.now&&(window.performance.offset=Date.now(),window.performance.now=function(){return Date.now()-window.performance.offset}):window.performance={offset:Date.now(),now:function(){return Date.now()-this.offset}};const p=function(e,t,r){var o=this;o.parent=r,o._featureTypes=[],n.Z.Util.extend(o,t),o.typeName=e,o._throwConfigError=function(){throw new Error("Error en la configuracin de la bsqueda: "+this.typeName)},o.getFeatureTypes=function(e){var t=this;if(e)return t.featureType instanceof Array?t.featureType:[t.featureType];if(0===t._featureTypes.length){var r=t.featureType instanceof Array?t.featureType:[t.featureType],n=t.renderFeatureType?t.renderFeatureType instanceof Array?t.renderFeatureType:[t.renderFeatureType]:[];t._featureTypes=r.concat(n)}return t._featureTypes},o.isFeatureOfThisType=function(e){return this.getFeatureTypes().indexOf(e)>-1},o.getStyleByFeatureType=function(e){var t=this;return t.getFeatureTypes().indexOf(e)>-1?t.styles[t.getFeatureTypes().indexOf(e)]:null};var a=function(e,t,r){var n=this,i=function(e,t,r){if(t){if(Object.prototype.hasOwnProperty.call(e,t)&&Object.prototype.hasOwnProperty.call(e[t],r))return e[t][r]}else for(var n in e)if(Object.prototype.hasOwnProperty.call(e[n],r))return e[n][r]};if(r){return i(n.getStyleByFeatureType(r),t,e)}for(var o=0;o<n.styles.length;o++){const r=i(n.styles[o],t,e);if(r)return r}};o.getSuggestionListHead=function(){var e,t,r,n=this;if("function"==typeof n.suggestionListHead)e=n.suggestionListHead(),t=e.label,r=[{color:e.color,title:e.label}];else if(e=n.suggestionListHead,t=n.parent.getLocaleString(e.label),"string"==typeof e.color)r=[{color:a.call(n,e.color),title:t}];else if(e.color instanceof Array){var i=n.getFeatureTypes();e.color.length===i.length?r=e.color.map((function(e,r){return{color:a.call(n,e[i[r]].color.css,e[i[r]].color.geomType,i[r]),title:n.parent.getLocaleString(e[i[r]].title)||t}})):n._throwConfigError()}else"object"==typeof e.color&&(r=[{color:a.call(n,e.color.css,e.color.geomType),title:t}]);if(t&&r){var o='<li header><span class="tc-header">'+t+"</span>";return o+=r.map((function(e){if(e.color)return'<span class="tc-header-color" title="'+e.title+'" style="color: '+e.color+';"></span>'})).join("")+"</li>"}n._throwConfigError()},o.getSuggestionListElements=function(e){var t=this,r=[],n=function(e,t){switch(!0){case"number"==typeof e:if(e===t)return!0;break;case"string"==typeof e:if(isNaN(e)&&isNaN(t)){if(e.trim()===t.trim())return!0}else if(e===t)return!0}return!1},i=function(e){for(var t=[],r=0;r<e.length;r++)-1===t.indexOf(e[r])&&t.push(e[r]);return t};return t.parseFeatures(e).forEach((function(e){var o=[],a=[],s="",l=t.outputProperties,c=t.dataIdProperty,u=t.outputFormatLabel,p=e.id.split(".").slice(0,1).shift();t.outputProperties instanceof Array||(l=t.outputProperties[p],c=t.dataIdProperty[p],u=u[p]);for(var h=0;h<l.length;h++)o.push(e.data[l[h]]);for(h=0;h<c.length;h++)a.push(e.data[c[h]]);for(var d={},f=0;f<t.outputProperties.length;f++)d[t.outputProperties[f]]=o[f];o instanceof Array&&u&&i(o).length>1?s=u.tcFormat(o):o instanceof Array&&1===i(o).length&&(s=o[0]);var g=s.toCamelCase();(function(e){for(var t=0;t<r.length;t++){var i=0,o=[];for(var a in e)o.push(n(e[a],r[t].properties[a])),i++;if(o.filter((function(e){return e})).length===i)return!0}return!1})(d)||r.push({text:g,label:g,id:a.join("#"),dataRole:t.typeName,dataLayer:p,properties:d})})),r},o.parseFeatures=function(e){return(o.outputFormat===i.Z.format.JSON?new n.Z.wrap.parser.JSON:new n.Z.wrap.parser.WFS({featureNS:o.featurePrefix,featureType:o.featureType})).read(e)},o.getPattern=function(){var e=this;return"function"==typeof e.pattern?e.pattern():e.pattern},o.filter=function(e){const t=function(t,r){var n=[];if(r!=e.parent.rootCfg.active.root)if(-1!==r.indexOf("#")||e.parent.rootCfg.active.limit){const t=r.split("#");e.parent.rootCfg.active.dataIdProperty.forEach((function(r,i,o){0===i&&o.length>1&&n.push("<ogc:And>"),n.push(e.filter.getFilterNode(r,t.length>i?t[i]:t[0])),i===o.length-1&&o.length>1&&n.push("</ogc:And>")}))}else{var i=e.parent.rootCfg.active.queryProperties.firstQueryWord.map((function(t){return e.filter.getFilterNode(t,e.parent._LIKE_PATTERN+r+e.parent._LIKE_PATTERN)}));i.length>1?(n.push("<ogc:And>"),(n=n.concat(i)).push("</ogc:And>")):n=n.concat(i)}else e.parent.rootCfg.active.root.forEach((function(t,r,i){0===r&&i.length>1&&n.push("<ogc:Or>"),e.parent.rootCfg.active.dataIdProperty.forEach((function(r,i,o){0===i&&o.length>1&&n.push("<ogc:And>"),n.push(e.filter.getFilterNode(r,t.length>i?t[i]:t[0])),i===o.length-1&&o.length>1&&n.push("</ogc:And>")}))})),e.parent.rootCfg.active.root.length>1&&n.push("</ogc:Or>");return t.concat(n)};return{getPropertyValue:function(t,r){return e.getSearchTypeByRole(t)[r]},getIsLikeNode:function(t,r){var n=/([\-\"\.\xba\(\)\/])/g;return n.test(r)&&(r=r.replace(n,"\\$1")),r.toString().indexOf(e.parent._LIKE_PATTERN)>-1?'<Or><PropertyIsLike escape="\\" singleChar="_" wildCard="*" matchCase="false"><PropertyName>'+t+"</PropertyName><Literal>"+r.toLowerCase().replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+'</Literal></PropertyIsLike><PropertyIsLike escape="\\" singleChar="_" wildCard="*" matchCase="false"><PropertyName>'+t+"</PropertyName><Literal>"+r.toUpperCase().replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsLike></Or>":"<PropertyIsEqualTo><PropertyName>"+t+"</PropertyName><Literal>"+r.replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsEqualTo>"},getFunctionStrMatches:function(t,r){var n=/([\-\"\xba\(\)\/])/g;if(n.test(r)&&(r=r.replace(n,"\\$1")),r.toString().indexOf(e.parent._LIKE_PATTERN)>-1){var i=r;return'<ogc:PropertyIsEqualTo> <ogc:Function name="strMatches"> <ogc:PropertyName>'+t+"</ogc:PropertyName> <ogc:Literal>(?i)"+(i=(i=(i=(i=(i=i.replace(/a/gi,"[a]")).replace(/e/gi,"[e]")).replace(/i/gi,"[i]")).replace(/o/gi,"[o]")).replace(/u/gi,"[u]")).replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</ogc:Literal> </ogc:Function> <ogc:Literal>true</ogc:Literal> </ogc:PropertyIsEqualTo>"}return"<PropertyIsEqualTo><PropertyName>"+t+"</PropertyName><Literal>"+r.replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsEqualTo>"},getFilterNode:function(t,r){var n,i=e.filter.getIsLikeNode;if(e.filterByMatch){i=e.filter.getFunctionStrMatches;var o=new RegExp("\\"+e.parent._LIKE_PATTERN,"gi");r=r.replace(o,e.parent._MATCH_PATTERN)}if(t instanceof Array||"string"==typeof t)return t instanceof Array&&t.length>1?(n="<ogc:Or>",t.forEach((e=>{n+=i(e.trim(),r)})),n+="</ogc:Or>"):i(t instanceof Array&&1===t.length?t[0].trim():t.trim(),r);var a=[];for(var s in t)if(t[s]instanceof Array&&t[s].length>1)n="<Or>",t[s].forEach((e=>{n+=i(e.trim(),r)})),n+="</Or>",a.push('(<Filter xmlns="http://www.opengis.net/ogc">'+n+"</Filter>)");else{var l=t[s];t[s]instanceof Array&&1===t[s].length&&(l=t[s][0]),a.push('(<Filter xmlns="http://www.opengis.net/ogc"><Or>'+i(l.trim(),r)+"</Or></Filter>)")}return a.join("")},getFilter:function(r){var n,o={};switch(o.multiL=!1,o.f="",!0){case e.typeName===i.Z.searchType.NUMBER:if(n=[],e.parent.rootCfg.active||!/(\<|\>|\<\>)/gi.exec(r.t)&&!/(\<|\>|\<\>)/gi.exec(r.s))e.parent.rootCfg.active?n=t(n,r.t):n.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+r.t+e.parent._LIKE_PATTERN)),n.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+r.s+e.parent._LIKE_PATTERN));else{let i=/(\<|\>|\<\>)/gi.exec(r.t);i?n.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+r.t.substring(0,r.t.indexOf(i[0])).trim()+e.parent._LIKE_PATTERN)):e.parent.rootCfg.active?n=t(n,r.t):n.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+r.t+e.parent._LIKE_PATTERN)),i=/(\<|\>|\<\>)/gi.exec(r.s),i?n.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+r.s.substring(0,r.s.indexOf(i[0])).trim()+e.parent._LIKE_PATTERN)):n.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+r.s+e.parent._LIKE_PATTERN))}n.push(e.filter.getFilterNode(e.queryProperties.thirdQueryWord,r.p+e.parent._LIKE_PATTERN)),o.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+n.join("")+"</ogc:And></ogc:Filter>";break;case e.typeName===i.Z.searchType.STREET:if(n=[],e.parent.rootCfg.active||!/(\<|\>|\<\>)/gi.exec(r.t)&&!/(\<|\>|\<\>)/gi.exec(r.s))e.parent.rootCfg.active?n=t(n,r.t):n.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+r.t+e.parent._LIKE_PATTERN)),n.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+r.s+e.parent._LIKE_PATTERN));else{let i=/(\<|\>|\<\>)/gi.exec(r.t);i?n.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+r.t.substring(0,r.t.indexOf(i[0])).trim()+e.parent._LIKE_PATTERN)):e.parent.rootCfg.active?n=t(n,r.t):n.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+r.t+e.parent._LIKE_PATTERN)),i=/(\<|\>|\<\>)/gi.exec(r.s),i?n.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+r.s.substring(0,r.s.indexOf(i[0])).trim()+e.parent._LIKE_PATTERN)):n.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+r.s+e.parent._LIKE_PATTERN))}o.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+n.join("")+"</ogc:And></ogc:Filter>";break;case e.typeName===i.Z.searchType.LOCALITY:o.f=e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+r.t+e.parent._LIKE_PATTERN),o.multiL=!0;break;case Object.prototype.hasOwnProperty.call(e.queryProperties,"secondQueryWord"):(n=[]).push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+r.t+e.parent._LIKE_PATTERN)),n.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+r.s+e.parent._LIKE_PATTERN)),o.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+n.join("")+"</ogc:And></ogc:Filter>";break;default:o.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc">'+e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+r.t+e.parent._LIKE_PATTERN)+"</ogc:Filter>"}return o},getParams:function(t){var r=e.filter.getFilter(t),i={REQUEST:"GetFeature",SERVICE:"WFS",MAXFEATURES:500,VERSION:e.version,OUTPUTFORMAT:e.outputFormat},o=e.getFeatureTypes(!0);if(o instanceof Array){var a=o.map((t=>e.featurePrefix?e.featurePrefix+":"+t.trim():t.trim()));i.TYPENAME=a.join(",")}else i.TYPENAME=e.featurePrefix?e.featurePrefix+":"+o.trim():o.trim();var s=function(e){if(""!==(e||"")){if(e instanceof Array)return e.join(",");var t=[];if(e instanceof Object)for(var r in e){var n=e[r][0];e[r].length>1&&(n=e[r].join(",")),t.push(n)}return t}},l=s(e.outputProperties),c=s(e.dataIdProperty);const u=e=>{const t=e.split(",");return t.filter(((e,r)=>t.indexOf(e)===r)).join(",")};if(l instanceof Array&&c instanceof Array){i.PROPERTYNAME="";for(var p=0;p<l.length;p++)i.PROPERTYNAME+="("+u(l[p]+","+c[p])+")"}else i.PROPERTYNAME=u(l+","+c);return i.FILTER=r.f,n.Z.Util.getParamString(i)},getGoToFilter:function(t){var r=[],n=t.split("#"),i=e.dataIdProperty,o=e.getFeatureTypes();if(i&&o)if(t.indexOf("#")>-1&&o instanceof Array&&o.length>1)o.forEach((e=>{i[e].forEach(((e,t)=>{r.push({name:e,value:n[t]})}))}));else if(-1===t.indexOf("#")&&o instanceof Array){let e=i;o.forEach((t=>{Object.prototype.hasOwnProperty.call(r,t)||(e instanceof Object&&Object.prototype.hasOwnProperty.call(i,t)&&(e=i[t]),e.forEach(((e,t)=>{t<n.length&&r.push({name:e,value:n[t]})})))}))}else i instanceof Object&&Object.prototype.hasOwnProperty.call(i,o)&&(i=i[o]),i.forEach(((e,t)=>{r.push({name:e,value:n[t]})}));return e.filter.transformFilter(r)},transformFilter:function(e){if(e&&e instanceof Array){var t=e.map((function(e){return Object.prototype.hasOwnProperty.call(e,"type")?!0==(e.type===i.Z.comparison.EQUAL_TO)?new n.Z.filter.equalTo(e.name,e.value):void 0:new n.Z.filter.equalTo(e.name,e.value)}));return t.length>1?n.Z.filter.and.apply(null,t):t[0]}}}}(o)};n.Z.control.Search=function(){var e=this;if(n.Z.Control.apply(e,arguments),e._dialogDiv=n.Z.Util.getDiv(e.options.dialogDiv),e.options.dialogDiv||document.body.appendChild(e._dialogDiv),e.exportsState=!0,i.Z.event.TOOLSCLOSE=i.Z.event.TOOLSCLOSE||"toolsclose.tc",e.url="//idena.navarra.es/ogc/wfs",e.version="1.1.0",e.featurePrefix="IDENA",e.options&&e.options.url&&(e.url=e.options.url),e._LIKE_PATTERN="*",e._MATCH_PATTERN=".*",e.UTMX="X",e.UTMY="Y",e.LON="Lon",e.LAT="Lat",e.UTMX_LABEL="X: ",e.UTMY_LABEL="Y: ",e.LON_LABEL="Lon: ",e.LAT_LABEL="Lat: ",e.MUN="Mun",e.POL="Pol",e.PAR="Par",e.MUN_LABEL="Mun: ",e.POL_LABEL="Pol: ",e.PAR_LABEL="Par: ",e._search={data:[]},e.EMPTY_RESULTS_LABEL=e.getLocaleString("noResults"),e.EMPTY_RESULTS_TITLE=e.getLocaleString("checkCriterion"),e.OUTBBX_LABEL=e.getLocaleString("outsideOfLimits"),e.WFS_TYPE_ATTRS=["url","version","geometryName","featurePrefix","featureType","properties","outputFormat"],e.availableSearchTypes={},e.availableSearchTypes[i.Z.searchType.CADASTRAL]={suggestionRoot:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.Z.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",searchWeight:3,featureType:["CATAST_Pol_ParcelaUrba","CATAST_Pol_ParcelaRusti","CATAST_Pol_ParcelaMixta"],municipality:{featureType:"CATAST_Pol_Municipio",labelProperty:"MUNICIPIO",idProperty:"CMUNICIPIO"},queryProperties:{firstQueryWord:"CMUNICIPIO",secondQueryWord:"POLIGONO",thirdQueryWord:"PARCELA"},suggestionListHead:{label:"search.list.cadastral",color:[{CATAST_Pol_ParcelaUrba:{title:"search.list.cadastral.urban",color:{geomType:"polygon",css:"strokeColor"}}},{CATAST_Pol_ParcelaRusti:{title:"search.list.cadastral.rustic",color:{geomType:"polygon",css:"strokeColor"}}},{CATAST_Pol_ParcelaMixta:{title:"search.list.cadastral.mixed",color:{geomType:"polygon",css:"strokeColor"}}}]},styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#136278",strokeWidth:2,strokeOpacity:1}},{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#0c8b3d",strokeWidth:2,strokeOpacity:1}},{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#e5475f",strokeWidth:2,strokeOpacity:1}}],parser:e.getCadastralRef,goTo:e.goToCadastralRef,goToIdFormat:e.MUN+"{0}"+e.POL+"{1}"+e.PAR+"{2}",idPropertiesIdentifier:"#"},e.availableSearchTypes[i.Z.searchType.COORDINATES]={parser:e.getCoordinates,goTo:e.goToCoordinates,searchWeight:4,label:null,suggestionListHead:function(t){return{label:e.availableSearchTypes[i.Z.searchType.COORDINATES].label||e.getLocaleString("search.list.coordinates")}}},e.queryProperties={QUERYWORD:"QueryWord",FIRST:"first",SECOND:"second",THIRD:"third"},e.availableSearchTypes[i.Z.searchType.MUNICIPALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.Z.format.JSON,featurePrefix:"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Municipio",dataIdProperty:["CMUNICIPIO"],queryProperties:{firstQueryWord:["MUNINOAC","MUNICIPIO"]},suggestionListHead:{label:"search.list.municipality",color:"strokeColor"},outputProperties:["MUNICIPIO"],outputFormatLabel:"{0}",searchWeight:1,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#fe06a5",strokeWidth:2,strokeOpacity:1}}],parser:e.getStringPattern.bind(this,[i.Z.searchType.MUNICIPALITY]),stringPatternToCheck:e.stringPatternsValidators.s_or_t,goTo:e.goToStringPattern},e.availableSearchTypes[i.Z.searchType.COUNCIL]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.Z.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Concejo",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CCONCEJO"],queryProperties:{firstQueryWord:["CONCEJO"]},outputProperties:["MUNICIPIO","CONCEJO"],outputFormatLabel:"{1} ({0})",searchWeight:4,parser:e.getStringPattern.bind(this,[i.Z.searchType.COUNCIL]),stringPatternToCheck:e.stringPatternsValidators.s_or_t,goTo:e.goToStringPattern,idPropertiesIdentifier:"#",suggestionListHead:{label:"search.list.council",color:"strokeColor"},styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#49006a",strokeWidth:2,strokeOpacity:1}}]},e.availableSearchTypes[i.Z.searchType.STREET]={root:null,limit:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.Z.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",renderFeatureType:"CATAST_Txt_Calle",featureType:"CATAST_Lin_CalleEje",dataIdProperty:["CVIA"],searchWeight:5,queryProperties:{firstQueryWord:["ENTINOAC","ENTIDADC"],secondQueryWord:["VIA","VIANOAC"]},suggestionListHead:{label:"search.list.street",color:"strokeColor"},outputProperties:["ENTIDADC","VIA","CVIA","CENTIDADC","CMUNICIPIO"],outputFormatLabel:"{1}, {0}",styles:[{line:{strokeColor:"#CB0000",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid"}},{point:{label:"VIA",labelRotationKey:"CADANGLE",fontColor:"#000000",fontSize:10,fontWeight:"bold",labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:e.getStringPattern.bind(this,[i.Z.searchType.STREET]),goTo:e.goToStringPattern},e.availableSearchTypes[i.Z.searchType.NUMBER]={root:null,limit:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.Z.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Txt_Portal",renderFeatureType:"",searchWeight:6,dataIdProperty:["CMUNICIPIO","CENTIDADC","CVIA","PORTAL"],queryProperties:{firstQueryWord:["ENTIDADC","ENTINOAC"],secondQueryWord:["VIA","VIANOAC"],thirdQueryWord:["PORTAL"]},suggestionListHead:{label:"search.list.number",color:"fontColor"},outputProperties:["ENTIDADC","VIA","PORTAL","CVIA","CENTIDADC","CMUNICIPIO"],outputFormatLabel:"{1} {2}, {0}",styles:[{point:{radius:0,label:"PORTAL",labelRotationKey:"CADANGLE",fontColor:"#CB0000",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:e.getStringPattern.bind(this,[i.Z.searchType.NUMBER]),goTo:e.goToStringPattern},e.availableSearchTypes[i.Z.searchType.URBAN]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.Z.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"ESTADI_Pol_EntidadPob",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CENTIDAD"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["ENTINOAC","ENTIDAD"]},suggestionListHead:{label:"search.list.urban",color:"strokeColor"},outputProperties:["MUNICIPIO","ENTIDAD"],outputFormatLabel:"{1} ({0})",searchWeight:2,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#feba1e",strokeWidth:2,strokeOpacity:1}}],parser:e.getStringPattern.bind(this,[i.Z.searchType.URBAN]),stringPatternToCheck:e.stringPatternsValidators.s_or_t,goTo:e.goToStringPattern},e.availableSearchTypes[i.Z.searchType.PLACENAME]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.Z.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"TOPONI_Txt_Toponimos",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CTOPONIMO"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["TOPONIMO","TOPONINOAC"]},suggestionListHead:{label:"search.list.placeName",color:"fontColor"},outputProperties:["MUNICIPIO","TOPONIMO","CMUNICIPIO","CTOPONIMO"],outputFormatLabel:"{1} ({0})",searchWeight:7,styles:[{point:{radius:0,label:"TOPONIMO",labelRotationKey:"CADANGLE",fontColor:"#ff5722",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:e.getStringPattern.bind(this,[i.Z.searchType.PLACENAME]),stringPatternToCheck:e.stringPatternsValidators.s_or_t,goTo:e.goToStringPattern},e.availableSearchTypes[i.Z.searchType.PLACENAMEMUNICIPALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.Z.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"TOPONI_Txt_Toponimos",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CTOPONIMO"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["MUNICIPIO","MUNINOAC"],secondQueryWord:["TOPONIMO","TOPONINOAC"]},suggestionListHead:{label:"search.list.placeName",color:"fontColor"},outputProperties:["MUNICIPIO","TOPONIMO","CMUNICIPIO","CTOPONIMO"],outputFormatLabel:"{1} ({0})",searchWeight:8,styles:[{point:{radius:0,label:"TOPONIMO",labelRotationKey:"CADANGLE",fontColor:"#ff5722",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:e.getStringPattern.bind(this,[i.Z.searchType.PLACENAMEMUNICIPALITY]),stringPatternToCheck:[e.stringPatternsValidators.ts,e.stringPatternsValidators.st],goTo:e.goToStringPattern},e.availableSearchTypes[i.Z.searchType.COMMONWEALTH]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.Z.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["POLUCI_Pol_MancoRSUg"],renderFeatureType:"",dataIdProperty:["CMANCOMUNI"],queryProperties:{firstQueryWord:["MANCOMUNID"]},outputProperties:["MANCOMUNID"],outputFormatLabel:"{0}",searchWeight:9,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#fc4e2a",strokeWidth:2,strokeOpacity:1}}]},e.availableSearchTypes[i.Z.searchType.ROAD]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.Z.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"INFRAE_Lin_CtraEje",dataIdProperty:["DCARRETERA"],queryProperties:{firstQueryWord:["DCARRETERA"]},suggestionListHead:{label:"search.list.road",color:"strokeColor"},outputProperties:["DCARRETERA"],outputFormatLabel:e.getLocaleString("search.list.road.shorter")+": {0}",searchWeight:10,styles:[{polygon:{strokeColor:"#00b2fc",strokeOpacity:1,strokeWidth:5},line:{strokeColor:"#00b2fc",strokeOpacity:1,strokeWidth:5,strokeLinecap:"round",strokeDashstyle:"solid"}}],parser:e.getRoad,goTo:e.goToRoad,pattern:function(){return new RegExp("^(?:(?:"+e.getLocaleString("search.list.road")+"|"+e.getLocaleString("search.list.road.shorter")+")\\:?)?\\s*((A?|AP?|N?|R?|E?|[A-Z]{2}?|[A-Z]{1}?)\\s*\\-?\\s*(\\d{1,4})\\s*\\-?\\s*(A?|B?|C?|R?))$","i")}},e.availableSearchTypes[i.Z.searchType.ROADMILESTONE]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.Z.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"INFRAE_Sym_CtraPK",dataIdProperty:["DCARRETERA","CPK"],queryProperties:{firstQueryWord:["DCARRETERA"],secondQueryWord:["PK"]},suggestionListHead:{label:"search.list.milestone.larger",color:"fontColor"},outputProperties:["DCARRETERA","PK"],outputFormatLabel:e.getLocaleString("search.list.road.shorter")+": {0} "+e.getLocaleString("search.list.milestone")+": {1}",searchWeight:11,styles:[{point:{label:["DCARRETERA","PK"],fontColor:"#00b2fc",fontSize:14,labelOutlineColor:"#ffffff",labelOutlineWidth:2}}],parser:e.getMilestone,goTo:e.goToMilestone,pattern:function(){return new RegExp("^(?:(?:"+e.getLocaleString("search.list.road")+"|"+e.getLocaleString("search.list.road.shorter")+")\\:?)?\\s*((A?|AP?|N?|R?|E?|[A-Z]{2}?|[A-Z]{1}?)\\s*\\-?\\s*(\\d{1,4})\\s*\\-?\\s*(A?|B?|C?|R?))\\s*\\,*\\s*(?:(?:"+e.getLocaleString("search.list.milestone")+"\\:?)|(?:P\\:?)|(?:K\\:?)|(?:KM\\:?)|(?:\\s+|\\,+))\\s*(\\d{1,4})$","i")}},e.rootCfg={},e.rootCfg[i.Z.searchType.MUNICIPALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.Z.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Municipio",dataIdProperty:["CMUNICIPIO"],queryProperties:{firstQueryWord:["MUNICIPIO"]},outputProperties:["MUNICIPIO"],outputFormatLabel:"{0}",getRootLabel:function(){return new Promise((function(t,r){if(e.rootCfg.active&&!e.rootCfg[i.Z.searchType.MUNICIPALITY].rootLabel){var o={SERVICE:"WFS"};o.VERSION=e.rootCfg[i.Z.searchType.MUNICIPALITY].version,o.REQUEST="GetFeature",o.TYPENAME=e.rootCfg[i.Z.searchType.MUNICIPALITY].featurePrefix+":"+e.rootCfg[i.Z.searchType.MUNICIPALITY].featureType,o.OUTPUTFORMAT=e.rootCfg[i.Z.searchType.MUNICIPALITY].outputFormat,o.PROPERTYNAME=["CMUNICIPIO"].concat(e.rootCfg[i.Z.searchType.MUNICIPALITY].outputProperties).join(","),o.CQL_FILTER=e.rootCfg[i.Z.searchType.MUNICIPALITY].root.map((function(e){return["CMUNICIPIO"].map((function(t,r){return t+"="+e[r]})).join(" AND ")})),o.CQL_FILTER=o.CQL_FILTER.join(" OR "),n.Z.ajax({url:e.rootCfg[i.Z.searchType.MUNICIPALITY].url+"?"+n.Z.Util.getParamString(o),method:"GET",responseType:i.Z.mimeType.JSON}).then((function(r){const n=r.data;n.totalFeatures>0?(e.rootCfg[i.Z.searchType.MUNICIPALITY].rootLabel=n.features.map((function(t){return{id:["CMUNICIPIO"].map((function(e){return t.properties[e]})).join("#"),label:t.properties[e.rootCfg[i.Z.searchType.MUNICIPALITY].outputProperties[0]].toLowerCase()}})),t(e.rootCfg[i.Z.searchType.MUNICIPALITY].rootLabel)):(e.rootCfg[i.Z.searchType.MUNICIPALITY].rootLabel=[],t(e.rootCfg[i.Z.searchType.MUNICIPALITY].rootLabel))})).catch((function(){t([])}))}else t(e.rootCfg[i.Z.searchType.MUNICIPALITY].rootLabel)}))}},e.rootCfg[i.Z.searchType.LOCALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.Z.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["ESTADI_Pol_EntidadPob"],renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CENTIDADC"],queryProperties:{firstQueryWord:["ENTINOAC"]},outputProperties:["ENTINOAC"],getRootLabel:function(){return new Promise((function(t,r){if(e.rootCfg.active&&!e.rootCfg[i.Z.searchType.LOCALITY].rootLabel){var o={SERVICE:"WFS"};o.VERSION=e.rootCfg[i.Z.searchType.LOCALITY].version,o.REQUEST="GetFeature",o.TYPENAME=e.rootCfg[i.Z.searchType.LOCALITY].featurePrefix+":"+e.rootCfg[i.Z.searchType.LOCALITY].featureType,o.OUTPUTFORMAT=e.rootCfg[i.Z.searchType.LOCALITY].outputFormat,o.PROPERTYNAME=["CMUNICIPIO","CENTIDAD"].concat(e.rootCfg[i.Z.searchType.LOCALITY].outputProperties).join(","),o.CQL_FILTER=e.rootCfg[i.Z.searchType.LOCALITY].root.map((function(e){return["CMUNICIPIO","CENTIDAD"].map((function(t,r){return t+"="+e[r]})).join(" AND ")})),o.CQL_FILTER=o.CQL_FILTER.join(" OR "),n.Z.ajax({url:e.rootCfg[i.Z.searchType.LOCALITY].url+"?"+n.Z.Util.getParamString(o),method:"GET",responseType:i.Z.mimeType.JSON}).then((function(r){const n=r.data;n.totalFeatures>0?(e.rootCfg[i.Z.searchType.LOCALITY].rootLabel=n.features.map((function(t){return{id:["CMUNICIPIO","CENTIDAD"].map((function(e){return t.properties[e]})).join("#"),label:t.properties[e.rootCfg[i.Z.searchType.LOCALITY].outputProperties[0]].toLowerCase()}})),t(e.rootCfg[i.Z.searchType.LOCALITY].rootLabel)):(e.rootCfg[i.Z.searchType.LOCALITY].rootLabel=[],t(e.rootCfg[i.Z.searchType.LOCALITY].rootLabel))})).catch((function(){t([])}))}else t(e.rootCfg[i.Z.searchType.LOCALITY].rootLabel)}))}},e.allowedSearchTypes=[],e.options.allowedSearchTypes)for(var t in e.options.allowedSearchTypes)e.availableSearchTypes[t]&&!n.Z.Util.isEmptyObject(e.options.allowedSearchTypes[t])&&(e.availableSearchTypes[t].renderFeatureType&&e.availableSearchTypes[t].renderFeatureType.length>0&&e.options.allowedSearchTypes[t].featureType&&!e.options.allowedSearchTypes[t].renderFeatureType&&(delete e.availableSearchTypes[t].renderFeatureType,e.availableSearchTypes[t].styles=e.availableSearchTypes[t].styles.slice(0,e.availableSearchTypes[t].styles.length-1)),n.Z.Util.extend(e.availableSearchTypes[t],e.options.allowedSearchTypes[t]),(e.options.allowedSearchTypes[t].root&&t!==i.Z.searchType.MUNICIPALITY&&e.options.allowedSearchTypes[t].rootType===i.Z.searchType.MUNICIPALITY||t!==i.Z.searchType.LOCALITY&&e.options.allowedSearchTypes[t].rootType===i.Z.searchType.LOCALITY)&&(e.rootCfg.active=e.rootCfg[e.options.allowedSearchTypes[t].rootType],e.rootCfg.active.root=e.options.allowedSearchTypes[t].root,e.rootCfg.active.limit=e.options.allowedSearchTypes[t].limit,e.availableSearchTypes[i.Z.searchType.STREET].queryProperties.firstQueryWord=e.availableSearchTypes[i.Z.searchType.NUMBER].queryProperties.firstQueryWord=e.rootCfg.active.dataIdProperty)),e.options.allowedSearchTypes[t]?e.addAllowedSearchType(t,e.availableSearchTypes[t]?e.availableSearchTypes[t]:e.options.allowedSearchTypes[t],e):delete e.options.allowedSearchTypes[t];e.rootCfg.active&&e.rootCfg.active.getRootLabel(),e.queryableFeatures=e.options.queryableFeatures||!1,e.UTMX_LEN=6,e.UTMY_LEN=7,e.wrap=new n.Z.wrap.control.Search(e),e.interval=500,e.NORMAL_PATTERNS={ROMAN_NUMBER:/M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3}){1,}?\S?\./i,ABSOLUTE_NOT_DOT:/[`~!@#$%^&*_|+\=?;:'"\{\}\[\]\\]/gi,ABSOLUTE:/[`~!@#$%^&*_|+\=?;:'.\{\}\[\]\\]/gi}},n.Z.inherit(n.Z.control.Search,n.Z.Control),n.Z.mix(n.Z.control.Search,n.Z.control.infoShare),function(){var e=n.Z.control.Search.prototype;e.CLASS="tc-ctl-search",i.Z.event.SEARCHQUERYEMPTY=i.Z.event.SEARCHQUERYEMPTY||"searchqueryempty.tc",e.register=function(e){const t=this;return new Promise((function(r,i){Promise.all([n.Z.Control.prototype.register.call(t,e),t.renderPromise()]).then((function(){t.options&&t.options.share?t.getShareDialog().then((function(){r(t)})).catch((function(e){i(e instanceof Error?e:Error(e))})):r(t)}))}))};const t=function(e){const t=this;var r=e.label,n=[];0===t.lastPattern.trim().length&&t.textInput.value.trim().length>0&&(t.lastPattern=t.textInput.value.trim());var o=t.lastPattern,a=[],s=",";if(-1===(o=t.NORMAL_PATTERNS.ROMAN_NUMBER.test(o)?o.replace(t.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT,""):o.replace(t.NORMAL_PATTERNS.ABSOLUTE,"")).indexOf(s)&&(s=" "),a=o.trim().split(s),e.label.indexOf(t.LAT_LABEL)>-1&&e.label.indexOf(t.LON_LABEL)>-1||e.label.indexOf(t.UTMX_LABEL)>-1&&e.label.indexOf(t.UTMY_LABEL)>-1){a=t.lastPattern.split(" ");for(var l=0;l<a.length;l++)","===a[l].trim().slice(-1)&&(a[l]=a[l].slice(0,-1))}for(var c=0;c<a.length;c++)if(a[c].trim().length>0){n.push("("+a[c].trim().replace(/\(/gi,"").replace(/\)/gi,"")+")");if(/((\<)|(\>)|(\<\>))/gi.exec(a[c].trim()))for(var u=a[c].trim().replace(/((\<)|(\>)|(\<\>))/gi,"").split(" "),p=0;p<u.length;p++)u[p].trim().length>0&&n.push("("+u[p].trim().replace(/\(/gi,"\\(").replace(/\)/gi,"\\)")+")")}if(e.dataRole===i.Z.searchType.ROAD||e.dataRole===i.Z.searchType.ROADMILESTONE){const r=t.getSearchTypeByRole(e.dataRole).getPattern().exec(t.lastPattern);r&&(n=[],r[2]&&r[3]&&r[4]?n.push("("+r[2]+"-"+r[3]+"-"+r[4]+")"):r[2]&&r[3]?n.push("("+r[2]+"-"+r[3]+")"):r[3]&&r[4]?n.push("("+r[3]+"-"+r[4]+")"):(r[2]||r[3])&&n.push("("+(r[2]||r[3])+")"),r[5]&&n.push("(?:"+t.getLocaleString("search.list.milestone")+"\\:\\s\\d*)("+r[5]+")\\d*"))}var h="("+n.join("|")+")";h=(h=(h=(h=(h=(h=(h=(h=(h=(h=(h=h.replace(/|/gi,"a")).replace(/|/gi,"e")).replace(/|/gi,"i")).replace(/|/gi,"o")).replace(/|/gi,"u")).replace(//gi,"u")).replace(/a/gi,"[a||]")).replace(/e/gi,"[e||]")).replace(/i/gi,"[i||]")).replace(/o/gi,"[o||]")).replace(/u/gi,"[u|||]");var d=new RegExp(h,"gi"),f=e.label;return r=e.dataRole!==i.Z.searchType.ROAD||e.dataRole!==i.Z.searchType.ROADMILESTONE?f.replace(d,(function(){var e=Array.prototype.slice.call(arguments,0);return e[e.length-3]?e[0].replace(e[e.length-3],"<b>"+e[e.length-3]+"</b>"):"<b>"+e[0]+"</b>"})):f.replace(d,"<b>$1</b>"),r},a=function(e){const t=this;var r=e.target;if("a"!==r.tagName.toLowerCase()){let t=e.target;const n=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;for(;t;){if(n.call(t,"a")){r=t;break}t=t.parentElement}}r.querySelector("span[hidden]")&&(t.textInput.value=r.querySelector("span[hidden]").textContent,t.lastPattern=t.textInput.value,t._goToResult(unescape(r.getAttribute("href")).substring(1),r.parentNode.getAttribute("dataRole")),n.Z.UI.autocomplete.call(t.textInput,"clear"),t.shareButton&&t.shareButton.classList.remove(i.Z.classes.HIDDEN))},l=function(e,t){const r=/[^a-zA-Z]/g,n=/[^0-9]/g;var i=parseInt(e,10),o=parseInt(t,10);if(isNaN(i)&&isNaN(o)){var a=e.replace(r,""),s=t.replace(r,"");if(a===s){var l=parseInt(e.replace(n,""),10),c=parseInt(t.replace(n,""),10);return l===c?0:l>c?1:-1}return a>s?1:-1}return isNaN(i)?1:isNaN(o)?-1:i>o?1:-1},c=function(e,t){const r=this;return r.getSearchTypeByRole(e.dataRole).searchWeight&&r.getSearchTypeByRole(t.dataRole).searchWeight?(r.getSearchTypeByRole(e.dataRole).searchWeight||0)>(r.getSearchTypeByRole(t.dataRole).searchWeight||0)?1:(r.getSearchTypeByRole(e.dataRole).searchWeight||0)<(r.getSearchTypeByRole(t.dataRole).searchWeight||0)?-1:l(e.label,t.label):e.dataRole>t.dataRole?1:e.dataRole<t.dataRole?-1:l(e.label,t.label)},u=function(e,t){const r=this,n=function(){var n,i,o=r.rootCfg.active.root[0]instanceof Array?r.rootCfg.active.root[0].join("-"):r.rootCfg.active.root[0];return e.properties&&e.properties.length>0&&t.properties&&t.properties.length>0?(n=r.rootCfg.active.dataIdProperty.map((function(t){return e.properties[t].toString()})).join("-"),i=r.rootCfg.active.dataIdProperty.map((function(e){return t.properties[e].toString()})).join("-")):(n=e.id,i=t.id),n!==o&&i===o?1:n===o&&i!==o?-1:l(e.label,t.label)}.bind(this);return r.getSearchTypeByRole(e.dataRole).searchWeight&&r.getSearchTypeByRole(t.dataRole).searchWeight?(r.getSearchTypeByRole(e.dataRole).searchWeight||0)>(r.getSearchTypeByRole(t.dataRole).searchWeight||0)?1:(r.getSearchTypeByRole(e.dataRole).searchWeight||0)<(r.getSearchTypeByRole(t.dataRole).searchWeight||0)?-1:n():n()},h=function(e){const r=this;var n=[],i=[],o=e.results.sort(c.bind(r));r.rootCfg.active&&(o=o.sort(u.bind(r)));for(var a=0;a<o.length;a++){var s=o[a];-1===i.indexOf(s.dataRole)&&(n.push(r.getSearchTypeByRole(s.dataRole).getSuggestionListHead()),i.push(s.dataRole)),n.push(`<li dataRole="${s.dataRole}"><a href="#${encodeURIComponent(s.id)}"><span hidden>${s.label}</span>${t.call(r,s)}</a></li>`)}return Array.prototype.map.call(r.resultsList.querySelectorAll("li[dataRole]"),(e=>e.getAttribute("dataRole"))).filter(((e,t,r)=>r.indexOf(e)===t&&!i.includes(e))).forEach((e=>{n.push(r.getSearchTypeByRole(e).getSuggestionListHead()),n.push(`<li dataRole="${e}"><a class="tc-ctl-search-li-loading" href="#">${r.getLocaleString("searching")}<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>`)})),n.join("")};e.loadTemplates=async function(){const e=this,t=r.e(7496).then(r.bind(r,7496)),n=r.e(1615).then(r.bind(r,3141)),i={};i[e.CLASS]=(await t).default,i[e.CLASS+"-dialog"]=(await n).default,e.template=i},e.render=function(){const e=this;return e._set1stRenderPromise(Promise.all([e.renderData(),e.getRenderedHtml(e.CLASS+"-dialog",{},(function(t){e._dialogDiv.innerHTML=t}))]))},e.renderData=function(e,t){var r=this;r._search=r._search||{};var l=function(){r.search(r.textInput.value,(function(e){1===e.length?(r.textInput.value=e[0].label,r._goToResult(e[0].id,r.resultsList.querySelector("li:not([header])").getAttribute("dataRole")),r.resultsList.classList.add(i.Z.classes.HIDDEN)):0===e.length&&r.resultsList.classList.add(i.Z.classes.HIDDEN)}))};return r.layerStyleFN=function(){function e(e){return e.indexOf(".")>-1?e.split(".")[0]:e}function t(t,n,i){var a=r.getSearchTypeByFeature(i);if(a){var s=a.getStyleByFeatureType(e(i));if(s&&Object.prototype.hasOwnProperty.call(s,n))return s[n][t]}return o.Z.styles[n][t]}return function(r,n,o,a){a instanceof s.Z||this.map.trigger(i.Z.event.FEATURESADD,{layer:this.layer,geom:a.geom});var l=t(n,r,e(a.id));if(o){if(l instanceof Array){var c=l.map((function(e){const t=a.getData();return Object.prototype.hasOwnProperty.call(t,e)?t[e]:""})),u=this.getSearchTypeByFeature(e(a.id));return u?u.outputFormatLabel.tcFormat(c):c.join(" ")}{const e=a.getData();return Object.prototype.hasOwnProperty.call(e,l)?e[l]:""}}return l}}(),new Promise((function(o,s){n.Z.Control.prototype.renderData.call(r,Object.assign(e||{},{share:r.options.share}),(function(){r.map?r.layerPromise=r.map.addLayer({id:r.getUID(),title:"Bsquedas",owner:r,stealth:!0,declutter:!0,type:i.Z.layerType.VECTOR,styles:{polygon:{fillColor:r.layerStyleFN.bind(r,"polygon","fillColor",!1),fillOpacity:r.layerStyleFN.bind(r,"polygon","fillOpacity",!1),strokeColor:r.layerStyleFN.bind(r,"polygon","strokeColor",!1),strokeOpacity:r.layerStyleFN.bind(r,"polygon","strokeOpacity",!1),strokeWidth:r.layerStyleFN.bind(r,"polygon","strokeWidth",!1)},line:{strokeColor:r.layerStyleFN.bind(r,"line","strokeColor",!1),strokeOpacity:r.layerStyleFN.bind(r,"line","strokeOpacity",!1),strokeWidth:r.layerStyleFN.bind(r,"line","strokeWidth",!1)},marker:{anchor:n.Z.Defaults.styles.marker.anchor,height:n.Z.Defaults.styles.marker.height,width:n.Z.Defaults.styles.marker.width},point:{radius:r.layerStyleFN.bind(r,"point","radius",!1),height:r.layerStyleFN.bind(r,"point","height",!1),width:r.layerStyleFN.bind(r,"point","width",!1),fillColor:r.layerStyleFN.bind(r,"point","fillColor",!1),fillOpacity:r.layerStyleFN.bind(r,"point","fillOpacity",!1),strokeColor:r.layerStyleFN.bind(r,"point","strokeColor",!1),strokeWidth:r.layerStyleFN.bind(r,"point","strokeWidth",!1),fontSize:r.layerStyleFN.bind(r,"point","fontSize",!1),fontColor:r.layerStyleFN.bind(r,"point","fontColor",!1),labelOutlineColor:r.layerStyleFN.bind(r,"point","labelOutlineColor",!1),labelOutlineWidth:r.layerStyleFN.bind(r,"point","labelOutlineWidth",!1),label:r.layerStyleFN.bind(r,"point","label",!0),labelRotationKey:r.layerStyleFN.bind(r,"point","labelRotationKey",!0)}}}).then((function(e){return r.layer=e,r.layer})):r.layerPromise=Promise.reject(new Error("Control not registered to map"));var e,c=function(){r.textInput.value=r.resultsList.label||r.resultsList.querySelector("li:not([header]) > a > span").textContent,r.lastPattern=r.textInput.value,r._goToResult(r.resultsList.id||unescape(r.resultsList.querySelector("li:not([header]) > a").getAttribute("href")).substring(1),r.resultsList.querySelector("li:not([header])").getAttribute("dataRole")),r.resultsList.classList.add(i.Z.classes.HIDDEN)};r.textInput=r.div.querySelector("input."+r.CLASS+"-txt"),r.options&&r.options.placeHolder&&r.textInput.setAttribute("placeHolder",r.options.placeHolder.trim()),r.resultsList=r.div.querySelector("."+r.CLASS+"-list"),r.button=r.div.querySelector("."+r.CLASS+"-btn"),r.button.addEventListener(i.Z.event.CLICK,(function(){r.getLayer().then((function(e){r.resultsList.querySelectorAll("li > a:not(.tc-ctl-search-li-loading):not(.tc-ctl-search-li-empty)").length>1||(e.features.length>0?e.map.zoomToFeatures(e.features):1===r.resultsList.querySelectorAll("li > a:not(.tc-ctl-search-li-loading):not(.tc-ctl-search-li-empty)").length?c():r.textInput.dispatchEvent(new Event("keyup")))}))}),{passive:!0}),r.options.instructions&&(r.textInput.setAttribute("title",r.options.instructions.trim()),r.button.setAttribute("title",r.options.instructions.trim())),r.resultsList.addEventListener(i.Z.event.CLICK,n.Z.EventTarget.listenerBySelector("a."+r.CLASS+"-li-empty",(function(){r.resultsList.classList.add(i.Z.classes.HIDDEN),r.textInput.focus()})),{passive:!0}),r.textInput.addEventListener("keypress",(function(e){if(13==e.which)return e.preventDefault(),e.stopPropagation(),r.lastPattern="",1===r.resultsList.querySelectorAll("li > a:not(.tc-ctl-search-li-loading):not(.tc-ctl-search-li-empty)").length?c():l(),!1})),r.textInput.addEventListener("search",(function(){0===r.textInput.value.length&&(delete r.toShare,r.shareButton&&r.shareButton.classList.add(i.Z.classes.HIDDEN),r.resultsList.classList.add(i.Z.classes.HIDDEN),l())})),r.textInput.addEventListener("input",(function(){0===r.textInput.value.length&&(r.shareButton&&r.shareButton.classList.add(i.Z.classes.HIDDEN),r.resultsList.classList.add(i.Z.classes.HIDDEN),l())})),r.textInput.addEventListener("targetCleared.autocomplete",(function(){r.shareButton&&r.shareButton.classList.add(i.Z.classes.HIDDEN),r.resultsList.classList.add(i.Z.classes.HIDDEN)})),r.textInput.addEventListener("targetUpdated.autocomplete",(function(){r.resultsList.querySelectorAll("li").length>0&&r.resultsList.classList.remove(i.Z.classes.HIDDEN)})),r.options.share&&(r.shareButton=r.div.querySelector("."+r.CLASS+"-share-btn"),r.shareButton.addEventListener(i.Z.event.CLICK,(function(){r.showShareDialog()}),{passive:!0})),r.lastPattern="",r.retryTimeout=null;n.Z.UI.autocomplete.call(r.textInput,{link:"#",target:r.resultsList,minLength:2,ctx:r,source:function(t,n){if(r.lastpress=performance.now(),!e){const t=function(){var o=r.textInput.value.trim();o.length>0&&(!r.lastPattern||o!==r.lastPattern)&&performance.now()-r.lastpress>r.interval?(window.cancelAnimationFrame(e),e=void 0,r.resultsList.classList.add(i.Z.classes.HIDDEN),r.lastPattern=o,r.search(o,n)):e=requestAnimationFrame(t)};e=requestAnimationFrame(t)}},callback:a.bind(r),buildHTML:h.bind(r)});const u=function(e){e.ctrlKey||e.altKey||e.shiftKey||(40===e.keyCode?(r.textInput==document.activeElement&&r.resultsList.querySelector("li:not([header]) a")?r.resultsList.querySelector("li:not([header]) a").focus():r.resultsList.querySelector("li:not([header]):last-child a")===document.activeElement?r.textInput.focus():function(e,t){var r=e.nextElementSibling;if(!t)return r;for(;r;){if(r.matches(t))return r;r=r.nextElementSibling}}(document.activeElement.parentElement,"li:not([header])").querySelector("a").focus(),e.preventDefault(),e.stopPropagation()):38===e.keyCode&&(r.textInput==document.activeElement||document.activeElement==r.resultsList.querySelector("li:not([header]) a")?r.resultsList.querySelector("li:not([header]):last-child a").focus():function(e,t){var r=e.previousElementSibling;if(!t)return r;for(;r;){if(r.matches(t))return r;r=r.previousElementSibling}}(document.activeElement.parentElement,"li:not([header])").querySelector("a").focus(),e.preventDefault(),e.stopPropagation())),e.stopPropagation()};r.textInput.addEventListener("keydown",u),r.resultsList.addEventListener("keydown",u),n.Z.Util.isFunction(t)&&t(),r.layerPromise.then(o).catch(s)}))}))},e.addAllowedSearchType=function(e,t){this.allowedSearchTypes.push(new p(e,t,this))},e.getSearchTypeByRole=function(e){return this.allowedSearchTypes.filter((function(t){return t.typeName==e}))[0]},e.getSearchTypeByFeature=function(e){var t=this.allowedSearchTypes.filter((function(t){return t.isFeatureOfThisType(e)}));return t.length>0?t[0]:null},e.getElementOnSuggestionList=function(e,t){const r=this;for(var n=0;n<r.searchRequestsResults.length;n++)if(r.searchRequestsResults[n].id==e&&(!t||t&&r.searchRequestsResults[n].dataRole===t))return r.searchRequestsResults[n]},e.getLayer=function(){return this.layerPromise},e.getFeatures=function(){return this.layer.features},e.cleanMap=function(){const e=this;if(e.layer){const n=e.layer;var t=n.features.slice();n.clearFeatures(),t&&t.length>0&&e.map.trigger(i.Z.event.FEATUREREMOVE,{layer:n,feature:t[0]});for(var r=0;r<e.WFS_TYPE_ATTRS.length;r++)Object.prototype.hasOwnProperty.call(n,e.WFS_TYPE_ATTRS[r])&&delete n[e.WFS_TYPE_ATTRS[r]]}},e.getMunicipalities=function(){var e=this;return n.Z.cache.search=n.Z.cache.search||{},e._municipalitiesPromise=new Promise((function(t,r){if(n.Z.cache.search.municipalities)t(n.Z.cache.search.municipalities);else{var o=e.getSearchTypeByRole(i.Z.searchType.CADASTRAL);if(!(o.municipality&&o.municipality.featureType&&o.municipality.labelProperty&&o.municipality.idProperty))throw new Error("Error en la configuracin de la bsqueda: "+o.typeName+". Error en el objeto municipality");var a={REQUEST:"GetFeature",SERVICE:"WFS",TYPENAME:o.municipality.featureType,VERSION:o.version,PROPERTYNAME:o.municipality.labelProperty+","+o.municipality.idProperty,OUTPUTFORMAT:o.outputFormat};o.featurePrefix&&(a.TYPENAME=o.featurePrefix+":"+a.TYPENAME);var s=o.url+"?"+n.Z.Util.getParamString(a);n.Z.ajax({url:s,method:"GET",responseType:"text"}).then((function(e){const r=e.data;var a=(o.outputFormat===i.Z.format.JSON?new n.Z.wrap.parser.JSON:new n.Z.wrap.parser.WFS({featureNS:o.municipality.featurePrefix,featureType:o.municipality.featureType})).read(r);n.Z.cache.search.municipalities=[];for(var s=0;s<a.length;s++){var l=a[s];n.Z.cache.search.municipalities.push({label:l.data[o.municipality.labelProperty],id:l.data[o.municipality.idProperty]})}n.Z.cache.search.municipalities.sort((function(e,t){return e.label<t.label?-1:e.label>t.label?1:0})),t(n.Z.cache.search.municipalities)})).catch((function(){t()}))}})),e._municipalitiesPromise},e.getCoordinates=function(e){const t=this;return new Promise((function(r,o){var a=e.match(new RegExp("^"+t.UTMX_LABEL.trim().toLowerCase()+"*\\s*([-+]?[0-9]{"+t.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*"+t.UTMY_LABEL.trim().toLowerCase()+"*\\s*([-+]?[0-9]{"+t.UTMY_LEN+"}(?:[.,]\\d+)?)$"));if(a&&(e=a[1]+" "+a[2]),(a=e.match(new RegExp("^"+t.LAT_LABEL.trim().toLowerCase()+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+t.LON_LABEL.trim().toLowerCase()+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$")))&&(e=a[1]+" "+a[3]),/\d/.test(e)&&(new RegExp("^([-+]?[0-9]{"+t.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*([-+]?[0-9]{"+t.UTMY_LEN+"}(?:[.,]\\d+)?)$").test(e)||/^([-+]?\d{1,3}([.,]\d+)?)\,?\s*([-+]?\d{1,2}([.,]\d+)?)$/.test(e)))if((a=/^([-+]?\d{1,3}([.,]\d+)?)\,?\s*([-+]?\d{1,2}([.,]\d+)?)$/.exec(e))&&(a[1].indexOf(",")>-1||a[3].indexOf(",")>-1)&&(a[1]=a[1].replace(",","."),a[3]=a[3].replace(",","."),e=a[1]+" "+a[3]),!a||a&&(a[1].indexOf(",")>-1?a[1].replace(",","."):a[1])<=180&&(a[3].indexOf(",")>-1?a[3].replace(",","."):a[3])<=90){(a=new RegExp("^([-+]?[0-9]{"+t.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*([-+]?[0-9]{"+t.UTMY_LEN+"}(?:[.,]\\d+)?)$").exec(e))&&(a[1].indexOf(",")>-1||a[2].indexOf(",")>-1)&&(a[1]=a[1].replace(",","."),a[2]=a[2].replace(",","."),e=a[1]+" "+a[2]),e=e.replace(t.UTMX_LABEL,"").replace(t.UTMY_LABEL,"").replace(t.LON_LABEL,"").replace(t.LAT_LABEL,"");var s=n.Z.Util.parseCoords(e);if(s){var l=s[0].value,c=s[1].value,u=s[0].type===i.Z.UTM?t.UTMX:t.LAT,p=s[1].type===i.Z.UTM?t.UTMY:t.LON,h=u+l+p+c,d=t.getPoint(h);d&&!t.insideLimit(d)&&(l=s[1].value,c=s[0].value,h=(u=s[1].type===i.Z.UTM?t.UTMX:t.LAT)+l+(p=s[0].type===i.Z.UTM?t.UTMY:t.LON)+c,d=t.getPoint(h)),d?(t.availableSearchTypes[i.Z.searchType.COORDINATES].label=/^X([-+]?\d+(?:\.\d+)?)Y([-+]?\d+(?:\.\d+)?)$/.test(h)?t.getLocaleString("search.list.coordinates.utm")+t.map.crs:t.getLocaleString("search.list.coordinates.geo"),r([{id:h,label:t.getLabel(h),dataRole:i.Z.searchType.COORDINATES}])):o()}else o()}else o();else o()}))},e.getCadastralRef=function(e){const t=this;return new Promise((function(r,n){var o=e.match(new RegExp(t.MUN_LABEL.trim().toLowerCase()+"?\\s(.*)\\,\\s?"+t.POL_LABEL.trim().toLowerCase()+"?\\s(\\d{1,2})\\,\\s?"+t.PAR_LABEL.trim().toLowerCase()+"?\\s(\\d{1,4})"));o&&(e=o[1]+", "+o[2]+", "+o[3]);var a=e;!/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.test(e)&&t.getSearchTypeByRole(i.Z.searchType.CADASTRAL).suggestionRoot&&(a=t.getSearchTypeByRole(i.Z.searchType.CADASTRAL).suggestionRoot+", "+e),/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.test(a)&&!new RegExp("^([-+]?[0-9]{"+t.UTMX_LEN+"})\\s*\\,\\s*([-+]?[0-9]{"+t.UTMY_LEN+"})$").test(e)?t.getMunicipalities().then((function(e){var n=/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.exec(a);if(n){var o=new RegExp(n[1].trim().replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),s=[];const a=function(e,r,n,o){var a=[];return a.push[t.MUN]=e,a.push[t.POL]=n,a.push[t.PAR]=o,{id:t.MUN+e+t.POL+n+t.PAR+o,label:t.getLabel(t.MUN+r+t.POL+n+t.PAR+o),dataRole:i.Z.searchType.CADASTRAL,properties:a}};if((s=e.filter((function(e){return e=e.label||e.id||e,o.test(e)||o.test(t.removePunctuation(e))}))).length>0)for(var l=0;l<s.length;l++)s[l]=a(s[l].id,s[l].label,n[2].trim(),n[3].trim());if(/^[0-9]*$/g.test(n[1])){if(n[1].trim()===t.getSearchTypeByRole(i.Z.searchType.CADASTRAL).suggestionRoot){var c=e.filter((function(e){return parseInt(e.id)===parseInt(t.getSearchTypeByRole(i.Z.searchType.CADASTRAL).suggestionRoot)}))[0];c&&r([a(c.id,c.label,n[2].trim(),n[3].trim())])}s.push(a(n[1].trim(),n[1].trim(),n[2].trim(),n[3].trim()))}r(s)}})):n()}))},e.stringPatternsValidators={tsp:function(e,t,r,n){const i=this;var o=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e);if(o&&o[1]&&o[2]){var a=function(){return f.call(i,(o[3]||o[4]||o[5]||o[6]).trim())};return/^([^0-9]+)$/i.test(o[1].trim())&&/^([^0-9]+)$/i.test(o[2].trim())?(t.push({t:o[1].trim(),s:o[2].trim(),p:a()}),t.push({t:o[2].trim(),s:o[1].trim(),p:a()})):/^([^0-9]+)$/i.test(o[1].trim())?t.push({t:o[1].trim(),s:o[2].trim(),p:a()}):t.push({s:o[1].trim(),t:o[2].trim(),p:a()}),g.call(this,t,r,n),!0}return!1},spt:function(e,t,r,n){const i=this;var o=/^(?:([^\,][a-z\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))(?:\s*\,\s*)([^0-9\,]+)$/i.exec(e);if(o&&o[6]&&o[1]){var a=function(){return f.call(i,(o[2]||o[3]||o[4]||o[5]).trim())};return/^([^0-9]+)$/i.test(o[6].trim())&&/^([^0-9]+)$/i.test(o[1].trim())?(t.push({t:o[6].trim(),s:o[1].trim(),p:a()}),t.push({t:o[1].trim(),s:o[6].trim(),p:a()})):/^([^0-9]+)$/i.test(o[6].trim())?t.push({t:o[6].trim(),s:o[1].trim(),p:a()}):t.push({s:o[6].trim(),t:o[1].trim(),p:a()}),g.call(this,t,r,n),!0}return!1},tnsp:function(e,t,r,n){const i=this;var o=/^(?:([^\,][a-z\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)([^0-9\,]+)(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e);return!!(o&&o[1]&&o[2])&&(t.push({t:o[2].trim(),s:o[1].trim(),p:f.call(i,(o[3]||o[4]||o[5]||o[6]).trim())}),g.call(this,t,r,n),!0)},ts:function(e,t,r,n){const i=this;var o=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z"\s*\-\.\(\)\/0-9]+))$/i.exec(e);if(!o&&/^[^0-9]*$/i.test(e.trim())){var a=e.split(",").reverse();o=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z"\s*\-\.\(\)\/0-9]+))$/i.exec(a.join(","))}if(o&&o[1]&&o[2]){if(/^([^0-9]+)$/i.test(o[1].trim())&&/^([^0-9]+)$/i.test(o[2].trim()))t.push({t:o[1].trim(),s:o[2].trim()}),t.push({s:o[1].trim(),t:o[2].trim()}),g.call(this,t,r,n);else{var s=function(e){for(var t=e.split(" ").reverse(),r=[],n=0;n<t.length;n++)1===t[n].length&&(r.push(t[n]),t[n]="");return r.length>0?t.reverse().join(" ").trim()+i._LIKE_PATTERN+r.reverse().join(i._LIKE_PATTERN):t.reverse().join(" ").trim()};/^([^0-9]+)$/i.test(o[1].trim())?t.push({t:o[1].trim(),s:s(o[2].trim())}):t.push({s:s(o[1].trim()),t:o[2].trim()}),g.call(this,t,r,n,!0)}return!0}return!1},st:function(e,t,r,n){const i=this;var o=/^(?:([^\,][a-z\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)([^0-9\,]+)$/i.exec(e);if(!o){const t=e.split(",").reverse();o=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z"\s*\-\.\(\)\/0-9]+))$/i.exec(t.join(","))}if(o){var a={};const o=e.split(",").reverse();for(var s=0;s<o.length;s++)if(/^([^0-9\,]+)$/i.test(o[s].trim()))a.t=o[s].trim();else if(/(\s*\d+)/i.test(o[s].trim()))if(-1===o[s].trim().indexOf(" "))a.s=o[s].trim();else{for(var l=o[s].trim().split(" ").reverse(),c=function(e){return!!/^(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e.trim())&&(a.p=f.call(i,e.trim()),!0)},u=0,p=l[u].trim();u<l.length&&!c(p);)++u<l.length&&(p+=l[u]);if(a.p){for(var h=l,d=0;d<h.length;d++){for(var y=!1,m=0;m<h[d].split("").length;m++)a.p.indexOf(h[d][m])>-1&&(y=!0);if(y&&(h[d]="",a.p==f.call(i,p)))break}if(/^([^\,][a-z\s*\-\.\(\)\/0-9]+)$/i.test(l.reverse().join(" ").trim())){for(var v=[],_=l.reverse(),w=0;w<_.length;w++)1===_[w].trim().length&&(v.push(_[w].trim()),_[w]="");a.s=v.length>0?_.reverse().join(" ").trim()+i._LIKE_PATTERN+v.reverse().join(i._LIKE_PATTERN):_.reverse().join(" ").trim()}t.push({t:a.t,s:a.s+" "+a.p})}else a.s=o[s].trim()}return t.push(a),g.call(this,t,r,n),!0}return!1},s_or_t:function(e,t,r,n){var i=/^([^\,][a-z\s*\-\.\(\)\/0-9\<\>]+)$/i.exec(e);return!(!i||!i[1])&&(r?(t.push({t:i[1].trim()}),t.push({t:r,s:i[1].trim()})):t.push({t:i[1].trim()}),!0)},sp:function(e,t,r,n){const i=this;var o=/^([^\,][a-z\s*\-\.\(\)\/]+)\s*\,?\s*((\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e);return!!(o&&o[1]&&o[2])&&(r?t.push({t:r,s:o[1].trim(),p:f.call(i,o[2].trim())}):t.push({t:o[1].trim(),s:o[2].trim()}),!0)},snp:function(e,t,r,n){const i=this;var o=/^([^\,][0-9\s*\-\.\(\)\/]+)\s*\,?\s*(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.exec(e);return!!(o&&o[1]&&o[2]&&r)&&(t.push({t:r,s:o[1].trim(),p:f.call(i,o[2].trim())}),!0)}};const d=function(e){const t=this;return e=t.removePunctuation(e),(e=t.NORMAL_PATTERNS.ROMAN_NUMBER.test(e)?e.replace(t.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT,""):e.replace(t.NORMAL_PATTERNS.ABSOLUTE,"")).toLowerCase()},f=function(e){const t=this;for(var r=[function(e){return/^(\d{1,3})\s?\-?\s?([a-z]{0,4})\s?\-?\s?([a-z]{0,4})$/i.test(e)},function(e){return/^([a-z]{1,4})\s?\-?\s?(\d{1,3})$/i.test(e)},function(e){return/^(sn|S\/N|s\/n|s\-n)$/i.test(e)},function(e){return/^([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.test(e)}],n=[function(e){var r=[],n=/^(\d{1,3})\s?\-?\s?([a-z]{0,4})\s?\-?\s?([a-z]{0,4})$/i.exec(e);if(n){for(var i=1;i<n.length;i++)n[i].trim().length>0&&r.push(n[i].trim());return r.join(t._LIKE_PATTERN)}return e},function(e){var r=[],n=/^([a-z]{1,4})\s?\-?\s?(\d{1,3})$/i.exec(e);if(n){for(var i=1;i<n.length;i++)n[i].trim().length>0&&r.push(n[i].trim());return r.join(t._LIKE_PATTERN)}return e},function(e){return/^(sn|S\/N|s\/n|s\-n)$/i.exec(e)?"s*n":e},function(e){/^([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.exec(e);return e}],i=0;i<n.length&&!r[i].call(t,e);)i++;return i<n.length?n[i].call(t,e):e},g=function(e,t,r,i){const o=this;if(t)for(var a=e.length;a--;)if(i)e.push(n.Z.Util.extend({},e[a],{t}));else if(e[a].t){var s=o.rootCfg.active.rootLabel.filter(function(t){return t.label.indexOf(o.removePunctuation(e[a].t).toLowerCase())>-1}.bind(o));1===s.length?e[a].t=s[0].id:s.length>1?s.map((function(t){var r=n.Z.Util.extend({},e[a]);r.t=t.id,e.push(r)})):0===s.length&&r&&e.splice(a,1)}},y=function(e,t){const r=this,o=r.rootCfg.active&&r.rootCfg.active.root||"",a=r.rootCfg.active&&r.rootCfg.active.limit||!1;var s=[];if(","===(t=t.trim()).charAt(t.length-1)&&(t=t.substring(0,t.length-1)),function(){for(var e=[function(e){return e.length>=3},function(e){return!/^\d+$/.test(e)&&!/^\d+\,\s*\d+$/.test(e)}],n=0;n<e.length;n++)if(!e[n].call(r,t))return!1;return!0}()){var l=[];0===(l=e.map((function(e){return r.getSearchTypeByRole(e)})).filter((function(e){return e.stringPatternToCheck})).map((function(e){return e.stringPatternToCheck})).flat()).length&&(l=[r.stringPatternsValidators.tsp,r.stringPatternsValidators.spt,r.stringPatternsValidators.tnsp,r.stringPatternsValidators.ts,r.stringPatternsValidators.st],l=o&&t.split(",").length<3?[r.stringPatternsValidators.sp,r.stringPatternsValidators.snp,r.stringPatternsValidators.s_or_t].concat(l):l.concat([r.stringPatternsValidators.sp,r.stringPatternsValidators.snp,r.stringPatternsValidators.s_or_t]));var c=0;try{for(;c<l.length&&!l[c].call(r,t,s,o,a);)c++}catch(e){n.Z.error("Error segn el patrn: "+t,i.Z.msgErrorMode.EMAIL,"Error en la bsqueda del callejero")}return s}return null},m=function(e,t,r,i){return fetch(e.url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:e.filter.getParams(i),signal:t}).then((function(e){if(e.ok)return e.text();throw"Search: error requestToWFS"})).then(r).catch((function(e){if("AbortError"!==e.name)throw n.Z.error(e),e;console.log("Search: peticin abortada")}))};e.getStringPattern=function(e,t){const r=this;return new Promise(((n,i)=>{let o=[],a=[];t=d.call(r,t);let s=/(.*)\((.*)\)?/.exec(t);if(s&&s.length>2){o=y.call(r,e,s[1])||[];let t=y.call(r,e,s[1]+","+s[2])||[];o=o.concat(t)}else o=y.call(r,e,t)||[];if(o.length>0){let t=[],s=t=>e.filter((function(e){return Object.keys(r.getSearchTypeByRole(e).queryProperties).length===Object.keys(t).length})),u=[];for(var l=0;l<o.length;l++){let e=o[l],n=s(e);for(var c=0;c<n.length;c++){let i=r.getSearchTypeByRole(n[c]);u.indexOf(i.typeName)<0&&(t.push(i.getSuggestionListHead()),t.push('<li dataRole="'+i.typeName+'"><a class="tc-ctl-search-li-loading" href="#">'+r.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>'),u.push(i.typeName));let o=e=>i.getSuggestionListElements(e);a.push(m.call(r,i,r.searchRequestsAbortController.signal,o,e))}}a.length>0?(r.resultsList.innerHTML+=t.join(""),r.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")),Promise.all(a).then((e=>{n([].concat.apply([],e))})).catch((e=>{i()}))):i()}else i()}))},e.getRoad=function(e){const t=this;return new Promise((function(r,n){if((e=e.trim()).length<2)r([]);else{var o=t.getSearchTypeByRole(i.Z.searchType.ROAD),a=o.getPattern().exec(e);if(a&&a[3]){var s=a[2]?a[2].trim()+"-"+a[3].trim():a[3].trim();a[4]&&a[4].length>0&&(s=s+"-"+a[4].trim()),t.resultsList.innerHTML=o.getSuggestionListHead()+'<li dataRole="'+o.typeName+'"><a class="tc-ctl-search-li-loading" href="#">'+t.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>',t.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")),fetch(o.url+"?"+o.filter.getParams({t:s}),{signal:t.searchRequestsAbortController.signal}).then((e=>{if(e.ok)return e.text();throw"Search: error getRoad"})).then((e=>{let t=[],i=o.parseFeatures(e);i.length>0?(i.map((function(e){var r=o.outputProperties;if(!t.some((function(t){return t.text==e.data[r[0]]}))){var n=o.outputFormatLabel.tcFormat(o.outputProperties.map((function(t){return e.data[t]}))),i=o.outputProperties.map((function(t){return e.data[t]})).join("-");t.push({id:o.dataIdProperty.map((function(t){return e.data[t]})).join("#"),label:n,text:i,dataLayer:e.id.split(".")[0],dataRole:o.typeName})}})),r(t)):n()})).catch((function(e){n()}))}else n()}}))},e.getMilestone=function(e){var t=this;return new Promise((function(r,n){if((e=e.trim()).length<3)r([]);else{var o=t.getSearchTypeByRole(i.Z.searchType.ROADMILESTONE),a=o.getPattern().exec(e);if(a&&a[3]&&a[5]){var s=a[2]?a[2].trim()+"-"+a[3].trim():a[3].trim();a[4]&&a[4].length>0&&(s=s+"-"+a[4].trim()),t.resultsList.innerHTML=o.getSuggestionListHead()+'<li dataRole="'+o.typeName+'"><a class="tc-ctl-search-li-loading" href="#">'+t.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>',t.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")),fetch(o.url+"?"+o.filter.getParams({t:s,s:a[5].trim()}),{signal:t.searchRequestsAbortController.signal}).then((e=>{if(e.ok)return e.text();throw"Search: error getMilestone"})).then((function(e){let t=[],i=o.parseFeatures(e);i.length>0?(i.map((function(e){var r=o.outputProperties;if(!t.some((function(t){return t.label==e.data[r[0]]}))){var n=o.outputFormatLabel.tcFormat(o.outputProperties.map((function(t){return e.data[t]})));t.push({id:o.dataIdProperty.map((function(t){return e.data[t]})).join("#"),label:n,text:n,dataLayer:e.id.split(".")[0],dataRole:o.typeName})}})),r(t)):n()})).catch((function(e){n()}))}else n()}}))},e.search=function(e,t){var r=this;if((e=e.trim()).length>0){e=e.toLowerCase(),r.searchRequestsAbortController&&r.searchRequestsAbortController.abort(),r.resultsList.innerHTML="",r.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")),r.searchRequestsResults=[];let n=()=>{r.searchRequestsAbortController.signal.removeEventListener("abort",n)};r.searchRequestsAbortController=new AbortController,r.searchRequestsAbortController.signal.addEventListener("abort",n);let i=0,o=()=>{if(i--,0===i){if(e!==r.textInput.value.trim().toLowerCase())return;0===r.searchRequestsResults.length&&(r.cleanMap(),r.layer&&0!==r.layer.features.length||(r.resultsList.innerHTML='<li><a title="'+r.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+r.EMPTY_RESULTS_LABEL+"</a></li>",r.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")))),r.lastPattern=""}},a=()=>{r.searchRequestsResults&&(r.searchRequestsResults=r.searchRequestsResults.sort((function(e,t){var r,n=/(\d+)/,i="";return n.test(e.label)&&n.test(t.label)?(r=e.label.match(n)[1],i=t.label.match(n)[1]):(r=e.label,i=t.label),r>i?1:r<i?-1:0})),r._search.data=r.searchRequestsResults,t&&t(r.searchRequestsResults))};r.allowedSearchTypes.forEach((function(t){t.parser?(i++,t.parser.call(r,e).then(function(e,t){let n=()=>{let t=r.resultsList.querySelector('li[dataRole="'+e+'"]');if(t){let e=Array.prototype.indexOf.call(t.parentElement.childNodes,t),n=r.resultsList.childNodes[e-1];r.resultsList.removeChild(n),r.resultsList.removeChild(t)}};if(t&&t.length>0){let e=t.filter((e=>-1===r.searchRequestsResults.findIndex((t=>t.id===e.id))));e.length===t.length?(r.searchRequestsResults=r.searchRequestsResults.concat(e),a()):1===t.length&&n()}else n();o()}.bind(r,t.typeName)).catch(function(e){o()}.bind(r,t.typeName))):console.log("Falta implementacin del mtodo parser")}))}else r.lastPattern="",r.cleanMap()};var v=function(e){const t=this;if(e&&e.length>0){const r=function(e){for(var r=0;r<e.length;r++)e[r].showsPopup!=t.queryableFeatures&&(e[r].showsPopup=t.queryableFeatures)};r(e),r(t.layer.features)}};e._goToResult=function(e,t){const r=this;r.toShare={id:e,dataRole:t};var n=null;return r.searchRequestsAbortController&&r.searchRequestsAbortController.abort(),new Promise((function(o,a){var s;r.loading||(r.loading=r.map.getControlsByClass("TC.control.LoadingIndicator")[0]),s=r.loading.addWait(),matchMedia("(max-width: 30em)").matches&&(r.textInput.blur(),r.map.trigger(i.Z.event.TOOLSCLOSE)),r.cleanMap();for(var l=!1,c=0,u=r.allowedSearchTypes.length;c<u;c++){const i=r.allowedSearchTypes[c];if(r.availableSearchTypes[i.typeName]){const i=t||r.getElementOnSuggestionList.call(r,e).dataRole;if(i){const t=r.getSearchTypeByRole(i);if(r.availableSearchTypes[i]&&t&&t.goTo){if(null!==(n=t.goTo.call(r,e,i)))break}else if(!r.availableSearchTypes[i]&&t&&t.goTo){if(l=!0,null!==(n=t.goTo.call(r,e,i)))break}else console.log("Falta implementacin del mtodo goTo")}}else if(i.goTo){if(l=!0,null!==(n=i.goTo.call(r,e)))break}else console.log("Falta implementacin del mtodo goTo")}r.loading.removeWait(s),n?r.getLayer().then((function(e){var t;switch(!0){case n.params.type===i.Z.layerType.VECTOR:for(t=0;t<r.WFS_TYPE_ATTRS.length;t++)Object.prototype.hasOwnProperty.call(e,r.WFS_TYPE_ATTRS[t])&&delete e[r.WFS_TYPE_ATTRS[t]];break;case n.params.type===i.Z.layerType.WFS:for(t=0;t<r.WFS_TYPE_ATTRS.length;t++)e[r.WFS_TYPE_ATTRS[t]]=n.params[r.WFS_TYPE_ATTRS[t]]}e.type=n.params.type;const a=function(e){e.layer===r.layer&&(r.map.off(i.Z.event.FEATURESADD,a),v.call(r,e.features))};r.map.on(i.Z.event.FEATURESADD,a);const l=function(t){t.layer===e&&(r.map.off(i.Z.event.LAYERUPDATE,l),r.map.one(i.Z.event.FEATURESADD,(function(t){if(t.layer===e)if(!t.layer.features||0===t.layer.features.length&&t.layer.wrap.layer.getSource().getFeatures()){r.resultsList.classList.add(i.Z.classes.HIDDEN);var o=t.layer.wrap.layer.getSource().getExtent(),a=t.layer.map.options.pointBoundsRadius;o[2]-o[0]==0&&(o[0]=o[0]-a,o[2]=o[2]+a),o[3]-o[1]==0&&(o[1]=o[1]-a,o[3]=o[3]+a),t.layer.map.setExtent(o),r.map.on3DView&&!r.loadingState&&r.map._on3DZoomTo({extent:o,layer:t.layer})}else t.layer.features&&t.layer.features.length>0?(r.resultsList.classList.add(i.Z.classes.HIDDEN),r.loadingState||r.layer.map.zoomToFeatures(t.layer.features),r.map.trigger(i.Z.event.FEATURESADD,{layer:r.layer,features:r.layer.features})):t.layer.features&&0===t.layer.features.length&&n.params.type===i.Z.layerType.WFS&&(r.resultsList.inner=n.emptyResultHTML,r.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")),r.map.trigger(i.Z.event.SEARCHQUERYEMPTY));r.loading.removeWait(s)})),t.layer.features&&t.layer.features.length>0?(r.resultsList.classList.add(i.Z.classes.HIDDEN),r.loadingState||r.layer.map.zoomToFeatures(r.layer.features),r.map.trigger(i.Z.event.FEATURESADD,{layer:r.layer,features:r.layer.features}),r.loading.removeWait(s)):t.layer.features&&0===t.layer.features.length&&n.params.type===i.Z.layerType.WFS&&(r.resultsList.innerHTML=n.emptyResultHTML,r.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")),t.newData&&t.newData.features&&t.newData.features.length>0||r.map.trigger(i.Z.event.SEARCHQUERYEMPTY),r.loading.removeWait(s)),o(n))};r.map.on(i.Z.event.LAYERUPDATE,l),e.wrap.reloadSource()})):(a(Error("Method goTo has no implementation")),l||r.map.trigger(i.Z.event.SEARCHQUERYEMPTY))}))},e.goToResult=function(e,t){var r=this;return r.getSearchTypeByRole(t)?r._goToResult(e,t):r.availableSearchTypes[t]?(r.addAllowedSearchType(t,r.availableSearchTypes[t],r),r._goToResult(e,t)):void alert("No se reconoce el tipo de bsqueda: "+t)};var _=function(e){var t=this;let r=t.loading.addWait();var o,a,s=t.getPoint(e);if(s)o=t.getLabel(e),a=t.layer.addMarker(s,n.Z.Util.extend({},t.map.options.styles.point,{title:o,group:o}));else{var l=/^Lat((?:[+-]?)\d+(?:\.\d+)?)Lon((?:[+-]?)\d+(?:\.\d+)?)$/.exec(e);e=t.LAT+l[2]+t.LON+l[1],(s=t.getPoint(e))&&(o=t.getLabel(e),a=t.layer.addMarker(s,n.Z.Util.extend({},t.map.options.styles.point,{title:o,group:o})),t.textInput.value=o)}const c=new Promise((e=>{setTimeout((()=>{e()}),100)}));Promise.all([a,c]).then((function(e){t.map.trigger(i.Z.event.LAYERUPDATE,{layer:t.layer,newData:e[0]}),t.map.trigger(i.Z.event.FEATURESADD,{layer:t.layer,features:[e[0]]}),t.map.zoomToFeatures([e[0]]),t.loading.removeWait(r)}))};e.goToCoordinates=function(e){var t=this,r={};return/^X([-+]?\d+(?:[\.\,]\d+)?)Y([-+]?\d+(?:[\.\,]\d+)?)$/.test(e)||/^Lat((?:[+-]?)\d+(?:[.,]\d+)?)Lon((?:[+-]?)\d+(?:[.,]\d+)?)$/.test(e)?(r.params={type:i.Z.layerType.VECTOR,styles:{marker:{url:t.layerStyleFN.bind(t,"marker","url",!0)}}},r.emptyResultHTML='<li><a class="tc-ctl-search-li-empty">'+t.OUTBBX_LABEL+"</a></li>",_.call(t,e),r):null},e.goToCadastralRef=function(e){var t=this,r={},o=new RegExp("^"+t.MUN+"(\\d+)"+t.POL+"(\\d{1,2})"+t.PAR+"{1}(\\d{1,4})");if(o.test(e)){var a=o.exec(e),s=t.getSearchTypeByRole(i.Z.searchType.CADASTRAL);return r.params={type:i.Z.layerType.WFS,url:s.url,version:s.version,geometryName:s.geometryName,featurePrefix:s.featurePrefix,featureType:s.featureType,properties:new n.Z.filter.and(new n.Z.filter.equalTo(s.queryProperties.firstQueryWord,a[1].trim()),new n.Z.filter.equalTo(s.queryProperties.secondQueryWord,a[2].trim()),new n.Z.filter.equalTo(s.queryProperties.thirdQueryWord,a[3].trim())),outputFormat:s.outputFormat,styles:s.styles},r.emptyResultHTML='<li><a title="'+t.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+t.EMPTY_RESULTS_LABEL+"</a></li>",r}return null},e.goToRoad=function(e){var t=this,r={},n=t.getSearchTypeByRole(i.Z.searchType.ROAD);return r.params={type:i.Z.layerType.WFS,url:n.url,version:n.version,geometryName:n.geometryName,featurePrefix:n.featurePrefix,featureType:n.getFeatureTypes(),maxFeatures:3e3,properties:n.filter.getGoToFilter(e),outputFormat:n.outputFormat,styles:n.styles},r.emptyResultHTML='<li><a title="'+t.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+t.EMPTY_RESULTS_LABEL+"</a></li>",r},e.goToMilestone=function(e){var t=this,r={},n=t.getSearchTypeByRole(i.Z.searchType.ROADMILESTONE);return r.params={type:i.Z.layerType.WFS,url:n.url,version:n.version,geometryName:n.geometryName,featurePrefix:n.featurePrefix,featureType:n.getFeatureTypes(),maxFeatures:3e3,properties:n.filter.getGoToFilter(e),outputFormat:n.outputFormat,styles:n.styles},r.emptyResultHTML='<li><a title="'+t.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+t.EMPTY_RESULTS_LABEL+"</a></li>",r},e.goToStringPattern=function(e,t){var r={},n=this.getSearchTypeByRole(t);return r.params={type:i.Z.layerType.WFS,url:n.url,version:n.version,geometryName:n.geometryName,featurePrefix:n.featurePrefix,featureType:n.getFeatureTypes(),maxFeatures:3e3,properties:n.filter.getGoToFilter(e),outputFormat:n.outputFormat,styles:n.styles},r},e.getPoint=function(e){var t,r=this,i=r.map.wrap.isGeo(),o=/^X([-+]?\d+(?:\.\d+)?)Y([-+]?\d+(?:\.\d+)?)$/.exec(e);if(o&&3===o.length)t=[parseFloat(o[1]),parseFloat(o[2])],i&&(t=n.Z.Util.reproject(t,r.map.options.utmCrs,r.map.crs));else{if((o=/^Lat((?:[+-]?)\d+(?:[.,]\d+)?)Lon((?:[+-]?)\d+(?:[.,]\d+)?)$/.exec(e))&&3===o.length&&(t=[parseFloat(o[2]),parseFloat(o[1])],!i))return n.Z.Util.reproject(t,r.map.options.geoCrs,r.map.crs);if((o=/^Lon((?:[+-]?)\d+(?:[.,]\d+)?)Lat((?:[+-]?)\d+(?:[.,]\d+)?)$/.exec(e))&&3===o.length&&(t=[parseFloat(o[2]),parseFloat(o[1])],!i))return n.Z.Util.reproject(t,r.map.options.geoCrs,r.map.crs)}return t},e.insideLimit=function(e){return!!function(e,t){return!(e instanceof Array)||t[0]>=e[0]&&t[0]<=e[2]&&t[1]>=e[1]&&t[1]<=e[3]}(this.map.options.maxExtent,e)},e.getPattern=function(){return this.textInput.value},e.getLabel=function(e){var t=this,r=e,o=n.Z.Util.getMapLocale(t.map);const a=function(e,t){let r=n.Z.Util.parseCoords(t[1]+","+t[3]);return e=(e=e.replace(t[1],r[0].value.toLocaleString(o,{minimumFractionDigits:i.Z.DEGREE_PRECISION,maximumFractionDigits:i.Z.DEGREE_PRECISION}))).replace(t[3],r[1].value.toLocaleString(o,{minimumFractionDigits:i.Z.DEGREE_PRECISION,maximumFractionDigits:i.Z.DEGREE_PRECISION}))};if(e.match(new RegExp("^(?:"+t.LAT+"[-\\d])|(?:"+t.UTMX+"[-+]?[\\d])"))){let e=(r=r.replace(t.LAT,t.LAT_LABEL).replace(t.LON," "+t.LON_LABEL).replace(t.UTMX,t.UTMX_LABEL).replace(t.UTMY," "+t.UTMY_LABEL)).match(new RegExp("^"+t.LAT_LABEL.trim()+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+t.LON_LABEL.trim()+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$"));e&&(r=a(r,e));var s=1.1.toLocaleString(o).substring(1,2);e=r.match(new RegExp("^"+t.UTMX_LABEL.trim()+"*\\s*([-+]?[0-9]{"+t.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*"+t.UTMY_LABEL.trim()+"*\\s*([-+]?[0-9]{"+t.UTMY_LEN+"}(?:[.,]\\d+)?)$")),e&&(Number.isInteger(parseFloat(e[1]))||(r=r.replace(e[1],e[1].replace(".",s))),Number.isInteger(parseFloat(e[2]))||(r=r.replace(e[2],e[2].replace(".",s))))}else if(e.match(new RegExp("^(?:"+t.LON+"[-\\d])"))){const e=(r=r.replace(t.LON,t.LON_LABEL).replace(t.LAT," "+t.LAT_LABEL)).match(new RegExp("^"+t.LON_LABEL.trim()+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+t.LAT_LABEL.trim()+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$"));e&&(r=a(r,e))}else if(e.match(new RegExp("^(?:(\\"+t.MUN+"{1})(.*)(\\"+t.POL+"{1})(\\d{1,2})(\\"+t.PAR+"{1})(\\d{1,4}))"))){const n=e.match(new RegExp("^(?:(\\"+t.MUN+"{1})(.*)(\\"+t.POL+"{1})(\\d{1,2})(\\"+t.PAR+"{1})(\\d{1,4}))"));r=t.MUN_LABEL+n[2]+", "+t.POL_LABEL+n[4]+", "+t.PAR_LABEL+n[6]}return r},e.removePunctuation=function(e){e=e||"";for(var t=new Array(e.length),r=new Map([["","a"],["","a"],["","A"],["","A"],["","e"],["","e"],["","E"],["","E"],["","i"],["","i"],["","I"],["","I"],["","o"],["","o"],["","O"],["","O"],["","u"],["","u"],["","u"],["","U"],["","U"],["","U"]]),n=0,i=e.length;n<i;n++)t[n]=r.get(e.charAt(n))||e.charAt(n);return t.join("")},e.exportState=function(){const e=this;return e.toShare?{id:e.id,searchText:e.textInput&&e.textInput.value,searchResult:JSON.stringify(e.toShare)}:null},e.importState=function(e){const t=this;if(e.searchResult){let r=JSON.parse(e.searchResult);r.id&&r.dataRole?(r.doZoom&&t.map.one(i.Z.event.FEATURESADD,(function(e){e.layer===t.layer&&t.layer.map.zoomToFeatures(e.layer.features)})),t.loadingState=!0,t.goToResult(r.id,r.dataRole).then((function(){delete t.loadingState,t.textInput.value=e.searchText,t.shareButton&&t.shareButton.classList.remove(i.Z.classes.HIDDEN),t.loading.reset()}))):alert("shared results error")}}}(),String.prototype.tcFormat||(String.prototype.tcFormat=function(){var e=(arguments||[""])[0];return this.replace(/{(\d+)}/g,(function(t,r){return void 0!==e[r]?e[r]:t}))}),String.prototype.splitRemoveWhiteSpaces||(String.prototype.splitRemoveWhiteSpaces=function(e){for(var t=[],r=this.split(e),n=0;n<r.length;n++)r[n].trim().length>0&&t.push(r[n].trim());return t}),String.prototype.toCamelCase||(String.prototype.toCamelCase=function(){var e=this.toLowerCase(),t=this.toLowerCase().match(/[^A-Za-z0-9_]+(.)/g);if(t)for(var r=0;r<t.length;r++)/[-;:.<>\{\}\[\]\/\s()]/g.test(t[r])&&(e=e.replace(t[r],t[r].toUpperCase()));return e.charAt(0).toUpperCase()+e.substring(1)}),Object.prototype.hasOwnProperty.call(Array.prototype,"findByProperty")||Object.defineProperty(Array.prototype,"findByProperty",{enumerable:!1,writable:!0,value:function(e,t){for(var r=0;r<this.length;r++)if(this[r][e]==t)return this[r]}}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var r=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>r.length)&&(t=r.length),t-=e.length;var n=r.indexOf(e,t);return-1!==n&&n===t});const h=n.Z.control.Search},333:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var n=r(688),i=r(3640);n.Z.control=n.Z.control||{},n.Z.control.SelectContainer=i.default;const o=n.Z.control.SelectContainer},2749:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>w});var n=r(688),i=r(268),o=r(330),a=r(3784);function s(e,t){l(e,t),t.add(e)}function l(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function c(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}function p(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,d(e,t,"get"))}function h(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,d(e,t,"set"),r),r}function d(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}n.Z.control=n.Z.control||{};var f=new WeakMap,g=new WeakSet,y=new WeakSet;class m extends a.default{constructor(){var e,t,r;super(...arguments),s(this,y),s(this,g),c(this,"MAILTO_MAX_LENGTH",256),c(this,"IFRAME_WIDTH","600px"),c(this,"IFRAME_HEIGHT","450px"),c(this,"FEATURE_PARAM","showfeature"),c(this,"MOBILEFAV",void 0),c(this,"NAVALERT",void 0),r={writable:!0,value:void 0},l(e=this,t=f),t.set(e,r);const n=this;n.div.classList.add(n.CLASS),h(n,f,i.Z.getDiv(n.options.dialogDiv)),n.options.dialogDiv||document.body.appendChild(p(n,f))}getClassName(){return"tc-ctl-share"}async register(e){const t=this;return await super.register.call(t,e),t.exportsState=!0,t.MOBILEFAV=t.getLocaleString("mobileBookmarks.instructions"),t.NAVALERT=t.getLocaleString("bookmarks.instructions"),t.map.on(o.Z.event.MAPCHANGE,function(e){const t=this.div.querySelector(".tc-url input[type=text]");t&&(t.dataset.update=!0),delete this.map._controlStatesCache}.bind(t)),e.loaded((()=>{t.div.classList.contains(o.Z.classes.COLLAPSED)||t.update()})),t}async loadTemplates(){const e=this,t=r.e(9246).then(r.bind(r,9246)),n=r.e(8481).then(r.bind(r,8481)),i={};i[e.CLASS]=(await t).default,i[e.CLASS+"-dialog"]=(await n).default,e.template=i}async render(e){const t=this;p(t,f).innerHTML=await t.getRenderedHtml(t.CLASS+"-dialog",null);const r=super.renderData.call(t,{controlId:t.id});t._set1stRenderPromise(r),await r,document.queryCommandSupported&&document.queryCommandSupported("copy")&&(t.div.querySelectorAll("button").forEach((function(e){e.classList.remove("hide")})),t.div.querySelectorAll("input[type=text]").forEach((function(e){delete e.dataset.dataOriginalTitle}))),t.div.querySelector("h2").addEventListener("click",(function(e){t.update()})),i.Z.detectMobile()||t.div.querySelector(`sitna-button.${t.CLASS}-btn-whatsapp`).classList.add(o.Z.classes.HIDDEN),t.div.querySelector(`.${t.CLASS}-url-box button.${t.CLASS}-btn-shorten`).addEventListener("click",(function(e){const r=e.target;u(t,g,v).call(t,r,!0)})),t.div.querySelectorAll(`.${t.CLASS}-url-box button.${t.CLASS}-btn-copy`).forEach((e=>{e.addEventListener("click",(async function(e){const r=e.target;await u(t,g,v).call(t,r),document.execCommand("copy"),r.textContent=t.getLocaleString("copied"),setTimeout((function(){r.textContent=t.getLocaleString("copy"),u(t,y,_).call(t)}),1e3)}))})),t.div.querySelector("input[type=text]").addEventListener("click",(function(e){u(t,g,v).call(t,e.target)})),t.div.querySelector(`sitna-button.${t.CLASS}-btn-email`).addEventListener("click",(async function(e){const r=await t.shortenedLink();if(r){const e=encodeURIComponent(r+"\n");e.length>t.MAILTO_MAX_LENGTH&&t.map.toast(t.getLocaleString("urlTooLongForMailto"),{type:o.Z.msgType.WARNING}),window.location.href="mailto:?body="+e}})),t.div.querySelector(`sitna-button.${t.CLASS}-btn-qr`).addEventListener("click",(function(e){const r=p(t,f).querySelector(`.${t.CLASS}-qrcode`);r.innerHTML="",p(t,f).querySelector(`.${t.CLASS}-qr-alert`).classList.contains(o.Z.classes.HIDDEN)?t.makeQRCode(r,256).then((function(e){e&&i.Z.showModal(p(t,f).querySelector(`.${t.CLASS}-qr-dialog`))})):i.Z.showModal(p(t,f).querySelector(`.${t.CLASS}-qr-dialog`))}));const a=function(e,r,i){r&&r.trim().length>0?e.location.href=i(r):(n.Z.error(t.getLocaleString("urlTooLongForShortener")),e.close())};t.div.querySelector(`sitna-button.${t.CLASS}-btn-facebook`).addEventListener("click",(function(e){const r=window.open();t.shortenedLink().then((function(e){a(r,e,(function(e){return"https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(e)}))}))})),t.div.querySelector(`sitna-button.${t.CLASS}-btn-twitter`).addEventListener("click",(function(e){const r=window.open();t.shortenedLink().then((function(e){a(r,e,(function(e){return"https://twitter.com/intent/tweet?text="+encodeURIComponent(window.document.title?window.document.title:"Visor API SITNA")+"&url="+encodeURIComponent(e)}))}))})),i.Z.detectMobile()&&t.div.querySelector(`sitna-button.${t.CLASS}-btn-whatsapp`).addEventListener("click",(function(e){t.shortenedLink().then((async function(e){var r="whatsapp://send?text=";location.href=void 0!==e?r+encodeURIComponent(e):r+encodeURIComponent(await t.generateLink())}))})),t.div.querySelector(`sitna-button.${t.CLASS}-btn-bookmark`).addEventListener("click",(async function(e){var r=await t.generateLink(),n=document.title;i.Z.detectMobile()?alert(t.MOBILEFAV):window.sidebar&&window.sidebar.addPanel?window.sidebar.addPanel(n,r,""):window.sidebar&&/Firefox/i.test(navigator.userAgent)||window.opera&&window.print?(window.location.href=r,alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+t.NAVALERT)):window.external&&"AddFavorite"in window.external?window.external.AddFavorite(r,n):(window.location.href=r,alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+t.NAVALERT))})),i.Z.isFunction(e)&&e()}getLocation(){var e=window.location.href;return window.location.hash&&(e=e.substr(0,e.indexOf(window.location.hash))),e}manageMaxLengthExceed(e){const t=this;t.div.querySelector(`.${t.CLASS}-alert`).classList.toggle(o.Z.classes.HIDDEN,!e.browser);p(t,f).querySelector(`.${t.CLASS}-qr-alert`).classList.toggle(o.Z.classes.HIDDEN,!e.qr)}async generateIframe(e){const t=this,r=e||await t.generateLink();return r?'<iframe style="width:'+t.IFRAME_WIDTH+";height:"+t.IFRAME_HEIGHT+';" src="'+r+'"></iframe>':""}loadParamFeature(){const e=this;let t=null;const r=i.Z.getParameterByName(e.FEATURE_PARAM);if(r){let i;try{i=JSON.parse(decodeURIComponent(escape(window.atob(r))))}catch(t){n.Z.error(e.getLocaleString("sharedFeatureNotValid"),o.Z.msgErrorMode.TOAST)}i&&e.map&&(i.geom?e.map.addLayer({id:e.getUID(),type:o.Z.layerType.VECTOR,title:e.getLocaleString("foi"),owner:e,stealth:!0}).then((function(t){e.paramFeatureLayer=t,t.importState({features:[i]}).then((function(){e.map.zoomToFeatures(t.features)}))})):t=i)}return t}async update(){const e=this,t=e.div.querySelector(".tc-url input[type=text]");if(0===t.value.trim().length){const r=await e.generateLink();e.registerListeners(),t.value=r,e.div.querySelector(".tc-iframe input[type=text]").value=await e.generateIframe(r)}}async generateLink(){const e=this,t=e.div.querySelector(`.${e.CLASS}-icons`),r=e.div.querySelectorAll(`.${e.CLASS}-url-box tc-textbox`),n=e.div.querySelectorAll(`.${e.CLASS}-url-box button`),i=e.div.querySelector("."+e.CLASS+"-alert");t.classList.add(o.Z.classes.LOADING),r.forEach((e=>e.disabled=!0)),n.forEach((e=>{e.classList.add(o.Z.classes.LOADING),e.disabled=!0})),i.classList.add(o.Z.classes.LOADING);const s=await a.default.prototype.generateLink.call(e);return r.forEach((e=>e.disabled=!1)),n.forEach((e=>{e.disabled=!1,e.classList.remove(o.Z.classes.LOADING)})),t.classList.remove(o.Z.classes.LOADING),i.classList.remove(o.Z.classes.LOADING),s}}async function v(e,t){const r=this,n=e.parentElement.querySelector("input[type=text]");if(t){if(n.dataset.update||!n.dataset.shortened){const t=await r.shortenedLink();t&&t.trim().length>0?(e.textContent=r.getLocaleString("shortened"),setTimeout((function(){e.textContent=r.getLocaleString("shorten"),u(r,y,_).call(r)}),1e3),delete n.dataset.update,n.dataset.shortened=!0,n.value=t,n.select()):(delete n.dataset.update,delete n.dataset.shortened,n.value=await r.generateLink())}}else n.classList.contains("tc-url")?n.dataset.update&&(delete n.dataset.update,delete n.dataset.shortened,n.value=await r.generateLink()):n.value=await r.generateIframe(),n.select()}function _(){document.getSelection().removeAllRanges(),document.getSelection().addRange(document.createRange())}n.Z.control.Share=m;const w=m},3510:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(688),i=r(330),o=r(9967),a=r(7497);n.Z.control=n.Z.control||{};const s=function(){var e=this;e._sv=null,e._mapActiveControl=null,a.Z.apply(e,arguments),e.viewDiv=null,e._startLonLat=null};n.Z.inherit(s,a.Z),function(){i.Z.url.GOOGLEMAPS="//maps.googleapis.com/maps/api/js?v=3";var e=i.Z.url.GOOGLEMAPS;o.Z.proxyExceptions=o.Z.proxyExceptions||[],o.Z.proxyExceptions.push(i.Z.url.GOOGLEMAPS);var t=s.prototype;t.CLASS="tc-ctl-sv";const l=function(){var e=document.createEvent("HTMLEvents");e.initEvent("resize",!0,!1);(this.map.div.querySelector("canvas")||window).dispatchEvent(e)};var c=function(e){const t=e.viewDiv,r=function(){t.removeEventListener("transitionend",r),l.call(e)};t.addEventListener("transitionend",r),setTimeout((function(){l.call(e)}),1e3),e.map.on3DView&&e.ThreeDMarker?(e.ThreeDMarker.show=!1,e.map.view3D.getScene().requestRender()):e.layer.clearFeatures(),e.div.querySelector("."+e.CLASS+"-btn").classList.remove(i.Z.classes.CHECKED),e.div.querySelector("."+e.CLASS+"-drag").classList.remove(i.Z.classes.HIDDEN),e.mapDiv.classList.remove(e.CLASS+"-active"),e._startLonLat=null};t.register=function(t){const o=this;o.viewDiv||(o.viewDiv=n.Z.Util.getDiv(o.options.viewDiv),o.viewDiv.classList.add(o.CLASS+"-view",i.Z.classes.HIDDEN),o.options.viewDiv||t.div.insertAdjacentElement("beforebegin",o.viewDiv));const s=a.Z.prototype.register.call(o,t);o.mapDiv=o.map.div,o.getCoordinateFromPixel=o.map.wrap.getCoordinateFromPixel;let l="SV_"+(Math.random()+1).toString(36).substring(7);window[l]=function(){delete window[l]};const u=o.options.googleMapsKey||t.options.googleMapsKey;u&&(e+="&key="+u+"&callback="+l),o.layer=null,o.ThreeDMarker=null;for(var p=o.getUID(),h=0;h<t.workLayers.length;h++){var d=t.workLayers[h];if(d.type===i.Z.layerType.VECTOR&&d.id===p){o.layer=d;break}}return o.layer||t.loaded((function(){t.addLayer({id:p,owner:o,stealth:!0,type:i.Z.layerType.VECTOR}).then((function(e){o.layer=e}))})),o.renderPromise().then((function(){r.e(4982).then(r.t.bind(r,4982,23)).then((function(e){const t=new(0,e.default)(o.div.querySelector("."+o.CLASS+"-drag"),{containment:o.getMapDiv&&o.mapDiv||o.map.div});t.on("dragStart",(function(e){var t;(t=o).div.querySelector("."+t.CLASS+"-btn").classList.add(i.Z.classes.CHECKED),t.mapDiv.classList.add(t.CLASS+"-active")})),t.on("dragEnd",(function(e){!function(e){var t=!1;const r=e.div.querySelector("."+e.CLASS+"-btn"),n=e.div.querySelector("."+e.CLASS+"-drag");var o=r.getBoundingClientRect(),a=n.getBoundingClientRect();if(n.classList.add(i.Z.classes.HIDDEN),a.top<o.top||a.top>o.bottom||a.left<o.left||a.left>o.right){t=!0;var s=e.map.getExtent(),l=[s[2],s[3]];if(!e.map.on3DView)for(var u=0;u<16;u++)e.layer.addMarker(l,{id:"pegman",cssClass:"tc-marker-sv-"+u,width:48,height:48,anchor:[0,1]});var p=e.mapDiv.getBoundingClientRect(),h=(a.left+a.right)/2-p.left,d=a.bottom-p.top,f=e.getCoordinateFromPixel([h,d]);e.callback(f)}else c(e)}(o),t.setPosition(0,0)}))}));o.viewDiv.querySelector("."+o.CLASS+"-btn-close").addEventListener(i.Z.event.CLICK,(function(e){e.stopPropagation(),o.closeView()}),{passive:!0})}),(function(){n.Z.error("Error de renderizado StreetView")})),t.on(i.Z.event.VIEWCHANGE,(function(e){const t=e.view;t===i.Z.view.THREED?(o.mapDiv=this.view3D.container,o.getCoordinateFromPixel=e=>{const t=this.view3D.Coordinates2DTo3D(e);return[t.lon,t.lat]}):t===i.Z.view.DEFAULT&&(o.mapDiv=this.div,o.getCoordinateFromPixel=o.map.wrap.getCoordinateFromPixel)})),t.on(i.Z.event.THREED_DRAG,(function(e){e.pickedFeature===o.ThreeDMarker&&(o._startLonLat=e.oldCoords,o._sv.setPosition({lng:e.newCoords[0],lat:e.newCoords[1]}))})),s},t.loadTemplates=async function(){const e=this,t=r.e(6950).then(r.bind(r,6950)),n=r.e(382).then(r.bind(r,382)),i={};i[e.CLASS]=(await t).default,i[e.CLASS+"-view"]=(await n).default,e.template=i},t.render=function(){const e=this;return e._set1stRenderPromise(new Promise((function(t,r){e.renderData(null,(function(){e.getRenderedHtml(e.CLASS+"-view",null).then((function(r){setTimeout((function(){e.viewDiv.innerHTML=r,t(e)}),300)})).catch((function(e){n.Z.error(e)}))}))})))};var u=0;t.callback=function(t){var r=this,o="EPSG:4326",a=function(e){if(r._sv){var t=e.getBounds();const i=n.Z.Util.reproject([(t[0]+t[2])/2,(t[1]+t[3])/2],r.map.getCrs(),o);r._sv.setPosition({lng:i[0],lat:i[1]})}},s=function(e){if(r._sv){var t=e.getBounds();r._startLonLat=n.Z.Util.reproject([(t[0]+t[2])/2,(t[1]+t[3])/2],r.map.getCrs(),o)}},p=r.map.getLoadingIndicator();p&&(u=p.addWait(u));const h=r.mapDiv;var d=function(e,l){var c,u;if(r.layer.clearFeatures(),e){var p=e.getPosition();c=n.Z.Util.reproject([p.lng(),p.lat()],o,r.map.getCrs()),u=e.getPov().heading}else c=t,u=0;if(r.map.on3DView?r.ThreeDMarker=r.map.view3D.setMarker(c,n.Z.Util.getBackgroundUrlFromCss("tc-marker-sv-"+(Math.round(16*u/360)+16)%16),r.ThreeDMarker):(r.map.addMarker(c,{cssClass:"tc-marker-sv-"+(Math.round(16*u/360)+16)%16,width:48,height:48,anchor:[.4791666666666667,.7083333333333333],layer:r.layer,showsPopup:!1}),Promise.all(r.map._markerPromises).then((function(){r.layer.wrap.setDraggable(!0,a,s)}))),l){var d=function(){r.map.on3DView?r.map.view3D.setCenter(c):r.map.setCenter(c)};h.classList.contains(i.Z.classes.COLLAPSED)?d():setTimeout(d,1200)}};n.Z.loadJS(!window.google||!google.maps,e,(function(){if(window.google){d();const e=r.viewDiv,a=n.Z.Util.reproject(t,r.map.getCrs(),o),s=new google.maps.LatLng(a[1],a[0]);(new google.maps.StreetViewService).getPanorama({location:s,preference:google.maps.StreetViewPreference.BEST},(function(t,o){if(o!==google.maps.StreetViewStatus.OK)p&&p.removeWait(u),setTimeout((function(){n.Z.alert(o===google.maps.StreetViewStatus.ZERO_RESULTS?r.getLocaleString("noStreetView"):r.getLocaleString("streetViewUnknownError")),r.layer.wrap.setDraggable(!1),c(r)}),100);else{const t=function(o){if(r._transitioning&&("width"===o.propertyName||"height"===o.propertyName)){r._transitioning=!1,p&&p.removeWait(u);const o=document.createEvent("HTMLEvents");o.initEvent("resize",!1,!1),h.dispatchEvent(o),l.call(r),e.removeEventListener("transitionend",t);var a={position:s,pov:{heading:0,pitch:0},zoom:1,fullscreenControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},panControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},imageDateControl:!0};r._sv?(r._sv.setOptions(a),r._sv.setVisible(!0)):(r._sv=new google.maps.StreetViewPanorama(e,a),google.maps.event.addListener(r._sv,"position_changed",(function(){d(r._sv,e.classList.contains(i.Z.classes.VISIBLE))})),r.managePOVChange=function(){var e;e=r.map.on3DView?(r._sv.getPov().heading||360)-r.map.view3D.getCameraData().heading:r._sv.getPov().heading,function(e){var t;if(r.map.on3DView)null===(t=r.ThreeDMarker)||void 0===t||t.setImage(1e3*Math.random(),n.Z.Util.getBackgroundUrlFromCss(e));else if(r.layer.features&&r.layer.features.length>0){var i=r.layer.features[0];delete i.options.url,i.options.cssClass=e,i.setStyle(i.options)}}("tc-marker-sv-"+(Math.round(16*e/360)+16)%16)},r.map.on(i.Z.event.CAMERACHANGE,r.managePOVChange),google.maps.event.addListener(r._sv,"pov_changed",r.managePOVChange),google.maps.event.addListener(r._sv,"status_changed",(function(){var e=r._sv.getStatus();e!==google.maps.StreetViewStatus.OK&&(r._sv.setVisible(!1),n.Z.alert(e===google.maps.StreetViewStatus.ZERO_RESULTS?r.getLocaleString("noStreetView"):r.getLocaleString("streetViewUnknownError")),r._startLonLat?(r._sv.setVisible(!0),r._sv.setPosition({lng:r._startLonLat[0],lat:r._startLonLat[1]})):(r.layer.wrap.setDraggable(!1),r.closeView()))})))}};if(r._transitioning=!0,e.addEventListener("transitionend",t),!r.options.viewDiv||!h.classList.contains(i.Z.classes.FULL_SCREEN)){const e=h.getBoundingClientRect();r.viewDiv.style.height=e.height+"px",r.viewDiv.style.width=e.width+"px"}const o=parseInt(window.getComputedStyle(h).zIndex,10);h.classList.add(i.Z.classes.COLLAPSED),h.style.width=r.options.ovmapW||"25vh",h.style.height=r.options.ovmapH||"25vh",r.map.on3DView&&(r.map.div.style.display="none"),e.style.left="",e.style.top="",e.classList.remove(i.Z.classes.HIDDEN),e.classList.add(i.Z.classes.VISIBLE);const a=parseInt(window.getComputedStyle(e).zIndex,10);o<=a&&(h.style.zIndex=a+1),setTimeout((function(){t({propertyName:"width"})}),1e3);const c=document.body.querySelector("header");c&&(c.style.display="none"),r.map.activeControl&&(r._previousActiveControl=r.map.activeControl,r.map.activeControl.deactivate(!0)),d(r._sv)}}))}else c(r)}),!1,!0)},t.closeView=function(){const e=this,t=e.mapDiv,r=e.viewDiv,n=function(){t.classList.remove(i.Z.classes.COLLAPSED),t.style.width=t.style.height=t.style.zIndex="",e.map.on3DView&&(e.map.div.style.display="");const r=document.createEvent("HTMLEvents");r.initEvent("resize",!1,!1),t.dispatchEvent(r),e.map.off(i.Z.event.CAMERACHANGE,e.managePOVChange)},o="transitionend",a=function(e){"width"!==e.propertyName&&"height"!==e.propertyName||(r.removeEventListener(o,a),n())};r.removeEventListener(o,a),r.addEventListener(o,a),setTimeout(n,1e3),e.options.viewDiv||(e.viewDiv.style.removeProperty("height"),e.viewDiv.style.removeProperty("width")),r.classList.add(i.Z.classes.HIDDEN),r.classList.remove(i.Z.classes.VISIBLE),r.style.height=r.style.width="",e.div.querySelector("."+e.CLASS+"-drag").classList.remove(i.Z.classes.HIDDEN),e.layer.wrap.setDraggable(!1),c(e),e._sv.setVisible(!1);const s=document.body.querySelector("header");s&&(s.style.display=""),e._previousActiveControl&&e._previousActiveControl.activate()}}(),n.Z.control.StreetView=s;const l=s},2006:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var n=r(688),i=r(330),o=r(268),a=r(7497),s=r(8239),l=r(4115),c=r(8197);n.Z.control=n.Z.control||{};const u=function(){const e=this;s.default.apply(e,arguments)};n.Z.inherit(u,s.default),function(){var e=u.prototype;e.CLASS="tc-ctl-toc";e.register=function(e){const t=this,r=s.default.prototype.register.call(t,e);return e.on(i.Z.event.EXTERNALSERVICEADDED,(function(e){t.onExternalServiceAdded(e)})),r},e.onExternalServiceAdded=function(e){const t=this;e&&e.layer&&(e.layer.map=t.map,t.map.addLayer(e.layer).then((function(r){t.updateLayerTree(e.layer)})))},e.addUIEventListeners=function(){const e=this;e.div.addEventListener("click",n.Z.EventTarget.listenerBySelector("input[type=checkbox]",(function(t){const r=t.target;var n=r;if(r.parentElement.dataset.layerId){const n=e.map.getLayer(r.parentElement.dataset.layerId);if(r.checked&&r.parentElement.querySelectorAll("ul input:not(:checked").length>0){const i="ul "+(n instanceof l.Z?"li."+e.CLASS+"-leaf ":"")+"input:not(:checked)",o=Array.from(t.target.parentElement.querySelectorAll(i)).map((e=>e.parentElement.dataset.layerUid));n.setNodeVisibility(o,r.checked)}}for(;n&&!n.matches("ul."+e.CLASS+"-wl");)n=n.parentElement;const i=[];var o;for(o=0;o<n.children.length;o++){const e=n.children[o];"LI"===e.tagName&&i.push(e)}for(o=0;o<i.length;o++){const t=i[o];if(t.contains(r)){const n=e.map.getLayer(t.dataset.layerId);var a=r;do{a=a.parentElement}while(a&&"LI"!==a.tagName&&!n.getNodeVisibility(a.dataset.layerUid));const i=a.dataset.layerUid;!n.getVisibility()&&r.checked&&n.setVisibility(r.checked),n.setNodeVisibility(i,r.checked);break}}t.stopPropagation()}))),e.div.addEventListener(i.Z.event.MOUSEUP,n.Z.EventTarget.listenerBySelector("button."+e.CLASS+"-collapse-btn",(function(t){t.target.blur();const r=t.target.parentElement;if(!r.classList.contains(e.CLASS+"-leaf")){r.classList.toggle(i.Z.classes.COLLAPSED);r.querySelector("ul").classList.toggle(i.Z.classes.COLLAPSED),t.stopPropagation()}})))},e.update=function(e){var t=function(e){for(var t=0,r=e.children.length;t<r;t++){const r=e.children[t];if(r.matches("input[type=checkbox]"))return r}return null};const r=this.getLayerUIElements().find((t=>t.dataset.layerId===e.id));if(!r)return;e.tree=null;const n=e.getTree(!1),o=t(r);o.checked=e.getVisibility(),o.checked&&e.getNodeVisibility(n.uid,n)===i.Z.visibility.HAS_VISIBLE&&(o.checked=!1,o.indeterminate=!0),o.checked&&e.getNodeVisibility(n.uid,n)===i.Z.visibility.NOT_VISIBLE&&(o.checked=o.indeterminate=!1),r.querySelectorAll("li").forEach((function(r){const o=t(r),a=r.dataset.layerUid;switch(e.getNodeVisibility(a,n)){case i.Z.visibility.VISIBLE:o.checked=!0,o.indeterminate=!1;break;case i.Z.visibility.NOT_VISIBLE:o.checked=!1,o.indeterminate=!1;break;case i.Z.visibility.NOT_VISIBLE_AT_RESOLUTION:o.checked=!0,o.indeterminate=!1;break;case i.Z.visibility.HAS_VISIBLE:case null:o.checked=!1,o.indeterminate=!0;break;default:{const t=e.findNode(a,n),r=!Object.prototype.hasOwnProperty.call(t,"isVisible")||t.isVisible;if(!t.children||!t.children.length||e instanceof c.Z)o.checked=r,o.indeterminate=!1;else{const e=t.children.every((e=>e.isVisible||e.visibilityState&&e.visibilityState===i.Z.visibility.VISIBLE)),r=t.children.every((e=>!e.isVisible||e.visibilityState&&e.visibilityState===i.Z.visibility.NOT_VISIBLE));o.checked=e,o.indeterminate=!e&&!r}}}})),Array.from(r.parentElement.querySelectorAll("li:not(."+this.CLASS+"-leaf)")).reverse().forEach((e=>{const t=!!r.parentElement.querySelector("li[data-layer-uid='"+e.dataset.layerUid+"'] > ul > li > input:checked"),n=!!r.parentElement.querySelector("li[data-layer-uid='"+e.dataset.layerUid+"'] > ul > li > input:not(:checked)"),i=!!r.parentElement.querySelector("li[data-layer-uid='"+e.dataset.layerUid+"'] > ul > li > input:indeterminate");e.querySelector("input").indeterminate=t&&n||i,e.querySelector("input").checked=t&&!n&&!i}))},e.updateScale=function(e){const t=this,r=function(e,r){e&&e.querySelectorAll("li").forEach((function(e){const n=e.dataset.layerUid;e.classList.toggle(t.CLASS+"-node-notvisible",!r.isVisibleByScale(n))}))};e?r(t.getLayerUIElements().find((t=>t.dataset.layerId===e.id)),e):t.getLayerUIElements().forEach((function(e){r(e,t.map.getLayer(e.dataset.layerId))}))},e.updateLayerTree=function(e){var t=this;e.isBase||e.options.stealth||(s.default.prototype.updateLayerTree.call(t,e),t.div.querySelector("."+t.CLASS+"-empty").classList.add(i.Z.classes.HIDDEN),t.getRenderedHtml(t.CLASS+"-branch",t.layerTrees[e.id]).then((function(r){const n=(new DOMParser).parseFromString(r,"text/html").body.firstChild,o=n.dataset.layerUid,a=t.div.querySelector("."+t.CLASS+'-wl li[data-layer-uid="'+o+'"]')||t.div.querySelector("."+t.CLASS+'-wl li[data-layer-id="'+e.id+'"]');if(a){if(e instanceof c.Z){const r="ul."+t.CLASS+"-wl",o="ul."+t.CLASS+"-branch",s="li."+t.CLASS+"-node",l="li."+t.CLASS+"-leaf",c=Array.from(a.querySelectorAll("li.tc-ctl-toc-node:not(.tc-ctl-toc-leaf):not(.tc-collapsed)")).reduce((function(e,t){return e.push(t.dataset.layerUid),e}),[]);a.innerHTML=n.innerHTML,a.setAttribute("class",n.getAttribute("class")),a.dataset.layerId||(a.dataset.layerId=e.id),a.querySelectorAll(r+" "+o+" "+o+","+r+" "+o+" "+s).forEach((function(e){e.matches(l)||"LI"===e.tagName&&c.some((t=>t===e.dataset.layerUid))||"UL"===e.tagName&&c.some((t=>t===e.parentElement.dataset.layerUid))||e.classList.add(i.Z.classes.COLLAPSED)}))}}else{n.dataset.layerId=e.id;const r=t.div.querySelector("."+t.CLASS+"-wl"),o=t.map.workLayers.indexOf(e);o?r.children[o-1].insertAdjacentElement("afterend",n):r.insertAdjacentElement("afterbegin",n);const a="ul."+t.CLASS+"-wl",s="ul."+t.CLASS+"-branch",c="li."+t.CLASS+"-node",u="li."+t.CLASS+"-leaf";n.querySelectorAll(a+" "+s+" "+s+","+a+" "+s+" "+c).forEach((function(e){e.matches(u)||e.classList.add(i.Z.classes.COLLAPSED)})),e instanceof l.Z&&n.querySelector("input[type='checkbox']").classList.add(i.Z.classes.HIDDEN)}t.update(e),t.updateScale(e)})).catch((function(e){n.Z.error(e)})))},e.removeLayer=function(e){e.isBase||s.default.prototype.removeLayer.call(this,e)},e.updateLayerVisibility=function(e){const t=this;t.getLayerUIElements().forEach((function(r){if(r.dataset.layerId===e.id){var n=!e.getVisibility();n?(r.querySelectorAll("input[type=checkbox]").forEach((function(t){t.checked=!n,e instanceof c.Z&&e.setNodeVisibility(t.parentElement.dataset.layerUid,!1)})),e instanceof l.Z&&t.map.getLayer("idena").setLayerNames("")):e instanceof l.Z&&r.querySelector("input.tc-ctl-toc-branch-cb:checked")&&e.setLayerNames(Array.from(r.querySelectorAll("li."+t.CLASS+"-leaf")).reduce(((e,t)=>e.concat(t.dataset.layerName)),[]))}}))},e.updateLayerOrder=function(e,t,r){},e.loadTemplates=async function(){const e=this,t=r.e(454).then(r.bind(r,454)),n=r.e(7895).then(r.bind(r,7895)),i=r.e(9951).then(r.bind(r,9951)),o={};o[e.CLASS]=(await t).default,o[e.CLASS+"-branch"]=(await n).default,o[e.CLASS+"-node"]=(await i).default,e.template=o},e.render=function(e){const t=this;return a.Z.prototype.render.call(t,(function(){var r=t.options.controls||[];if(r.length>0){var n=r[0],i=document.createElement("div");t.div.appendChild(i),t.map.addControl(n.name,o.Z.extend({div:i},n.options))}o.Z.isFunction(e)&&e()}))},e.getLayerUIElements=function(){const e=[],t=this.div.querySelector("ul."+this.CLASS+"-wl").children;for(var r=0,n=t.length;r<n;r++){const n=t[r];"LI"===n.tagName&&e.push(n)}return e},e.exportState=function(){},e.importState=function(e){}}(),n.Z.control.TOC=u;const p=u},3640:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(688),i=r(330),o=r(3678);n.Z.control=n.Z.control||{};const a=function(){const e=this;o.default.apply(e,arguments),e._classSelector="."+e.CLASS};var s;n.Z.inherit(a,o.default),(s=a.prototype).CLASS="tc-ctl-tctr",s.onRender=async function(){const e=this;e.title=e.title||e.getLocaleString(e.options.title||"moreControls"),e.div.querySelector("h2").innerHTML=e.title,e.controlOptions.forEach(((t,r)=>{let i="",o={};void 0!==t.name&&void 0!==t.options?(console.log("Gestionamos config de tabContainer antiguo"),i=t.name,o=t.options):(i=Object.keys(t).find((e=>"title"!==e)),o=t[i]),e._ctlPromises[r]=e.map.addControl(i,n.Z.Util.extend({id:e.uids[r],div:e.div.querySelector("."+e.CLASS+"-elm-"+r)},o))}));const t=async function(t,r){await t.renderPromise();const n=e.getLocaleString(e.controlOptions[r].title)||t.div.querySelector("h2").innerHTML;var i=t.div;do{i=i.parentElement}while(i&&!i.matches(e._classSelector));i.querySelector(`sitna-tab[for="${e.id}-sel-${r}"]`).text=n},r=await Promise.all(e._ctlPromises);for(var i=0,o=r.length;i<o;i++){const n=r[i];n.containerControl=e,await t(n,i)}return e},s.loadTemplates=async function(){const e=await r.e(3996).then(r.bind(r,3996));this.template=e.default},s.render=function(e){const t=this;return t._set1stRenderPromise(t.renderData({controlId:t.id,title:t.title,deselectableTabs:t.options.deselectableTabs,controls:t.controlOptions},(function(){t.div.querySelectorAll("sitna-tab").forEach((e=>{const t=e.target;new MutationObserver((function(e){e.forEach((function(e){e.target.classList.contains(i.Z.classes.COLLAPSED)&&e.target.classList.remove(i.Z.classes.COLLAPSED)}))})).observe(t,{attributes:!0}),e.callback=function(){this.selected&&t.classList.remove(i.Z.classes.COLLAPSED)}})),"number"==typeof t.defaultSelection&&t.div.querySelectorAll("sitna-tab")[t.defaultSelection].onClick(),"function"==typeof e&&e()})))},s.selectTab=function(e){const t=this.div.querySelectorAll("sitna-tab")[e];t&&(t.selected=!0)},s.onControlDisable=function(e){const t=this;t.getControls().then((r=>{const n=r.indexOf(e);if(n>=0){let i=n,o=e;do{i=(i+1)%r.length,o=r[i]}while(o.isDisabled&&o!==e);i!==n&&t.selectTab(i)}}))},n.Z.control.TabContainer=a;const l=a},7885:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var n=r(688),i=r(330),o=r(7497),a=r(4859);n.Z.control=n.Z.control||{},n.Z.view=n.Z.view||{},n.Z.view.ThreeD=a.default;const s=function(){o.Z.apply(this,arguments)};var l;n.Z.inherit(s,o.Z),(l=s.prototype).CLASS="tc-ctl-3d",l.register=function(e){const t=this,r=o.Z.prototype.register.call(t,e);return e.on(i.Z.event.VIEWCHANGE,(function(e){e.view===i.Z.view.THREED&&t.activate()})),r},l.loadTemplates=async function(){const e=await Promise.resolve().then(r.bind(r,7680));this.template=e.default},l.renderData=function(e,t){const r=this;return o.Z.prototype.renderData.call(r,e,(function(){r.button=r.div.querySelector("."+r.CLASS+"-btn"),r.button.addEventListener(i.Z.event.CLICK,(function(){r.button.disabled||(r.map.on3DView?(r.button.disabled=!0,n.Z.view.ThreeD.unapply({callback:function(){r.button.setAttribute("title",r.getLocaleString("threed.tip")),r.button.classList.remove(i.Z.classes.CHECKED),r.button.disabled=!1}})):r.activate())}),{passive:!0}),n.Z.Util.isFunction(t)&&t()}))},l.activate=function(){var e=this;e.map.on3DView||(e.button.disabled=!0),e.browserSupportWebGL.call(e);const t=function(){e.button.disabled=!1};e.map.view3D&&e.map.on3DView||n.Z.view.ThreeD.apply({map:e.map,options:e.options,getRenderedHtml:e.getRenderedHtml,callback:t}),e.button.setAttribute("title",e.getLocaleString("threed.two.tip")),e.button.classList.add(i.Z.classes.CHECKED)},l.deactivate=function(){o.Z.prototype.deactivate.call(this)},l.browserSupportWebGL=function(){var e=this,t=!1;if(window.WebGLRenderingContext){var r=document.createElement("canvas"),n={alpha:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};try{var o=r.getContext("webgl",n)||r.getContext("experimental-webgl",n)||r.getContext("webkit-3d",n)||r.getContext("moz-webgl",n);o?t=!0:(n.failIfMajorPerformanceCaveat=!1,(o=r.getContext("webgl",n)||r.getContext("experimental-webgl",n)||r.getContext("webkit-3d",n)||r.getContext("moz-webgl",n))?(t="slow",e.isSlower=!0):t=!1)}catch(e){console.log(e)}if("slow"===t||!t){var a="slow"===t?"threed.slowSupport.supported":"threed.not.supported";e.map.toast(e.getLocaleString(a),{type:i.Z.msgType.WARNING,duration:1e4})}return t}t=!1},n.Z.control.ThreeD=s;const c=s},5122:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>E});var n=r(1466),i=r.n(n),o=r(688),a=r(330),s=r(7497),l=r(5515),c=r(4916),u=r(1399),p=r(52),h=r(8197),d=r(5394),f=r(4109),g=r(3048),y=r(8033),m=r(8683),v=r(1872),_=r(9529),w=r(5265);o.Z.control=o.Z.control||{},o.Z.Geometry=u.Z,o.Z.filter=d.Z;const S=function(){const e=this;l.default.apply(this,arguments),e.serviceWorkerIsRequired=e.options.serviceWorkerIsRequired||!1,e._classSelector="."+e.CLASS,e.layer=null,e.callback=o.Z.Util.isFunction(arguments[2])?arguments[2]:e.options.callback?e.options.callback:null,e.layersEditData={},e.showsOriginalFeatures="boolean"==typeof e.options.showOriginalFeatures&&e.options.showOriginalFeatures,e.highlightsAdded=e.highlightsModified=e.highlightsRemoved="boolean"!=typeof e.options.highlightChanges||e.options.highlightChanges,o.Z.Util.isFunction(e.options.getBeforeEditLayerStyleFunction)||(e.getBeforeEditLayerStyleFunction=e.getBeforeEditLayerStyle),e.styles=e.options.styles||{point:{fillColor:"#0000aa",fillOpacity:.1,strokeColor:"#0000aa",strokeWidth:2,strokeOpacity:1,radius:6},line:{strokeColor:"#0000aa",strokeWidth:2,strokeOpacity:1},polygon:{fillColor:"#0000aa",fillOpacity:.1,strokeColor:"#0000aa",strokeWidth:2,strokeOpacity:1}}};o.Z.inherit(S,l.default),function(){var e=0;const t=function(e){const t=e.getLayerEditData();e._saveBtn.disabled=!(navigator.onLine&&t&&t.checkedOut)||e.isSyncing},n=function(e,t){if(e.div.querySelector(e._classSelector+"-view").classList.toggle(a.Z.classes.HIDDEN,!t||!e.layer||!(e.layer.type===a.Z.layerType.WFS||e.layer.type===a.Z.layerType.WMS)),e.layer&&e.layer.wfsLayer){const t=o.Z.filter&&o.Z.filter.Bbox&&e.layer.wfsLayer.properties instanceof o.Z.filter.Bbox;e._recropBtn.classList.toggle(a.Z.classes.HIDDEN,!t)}e.div.querySelector(e._classSelector+"-edit").classList.toggle(a.Z.classes.HIDDEN,!t)},d=function(e){t(e);const r=e.getLayerEditData();e._discardBtn.disabled=!r||!r.checkedOut},E=function(e,t){if(e.layer){const n=e.getLayerEditData();if(void 0!==t)n.checkedOut=t,d(e);else{var r=L(e);i().keys().then((function(t){if(t){for(var i=!0,o=0,a=t.length;o<a;o++)if(0===t[o].indexOf(r)){i=!1;break}n.checkedOut=!i,d(e)}}),(e=>console.warn(e)))}}else d(e)},b=async function(e,t){var r,n;switch(!0){case t instanceof _.Z:n=a.Z.geom.POLYGON;break;case t instanceof m.Z:n=a.Z.geom.POLYLINE;break;case t instanceof g.Z:n=a.Z.geom.POINT;break;case t instanceof w.Z:n=a.Z.geom.MULTIPOLYGON;break;case t instanceof v.Z:n=a.Z.geom.MULTIPOLYLINE;break;case t instanceof y.Z:n=a.Z.geom.MULTIPOINT}r={id:t.id||t.provId,attributes:t.data,type:n,geometry:t.geometry};try{return await i().setItem(e,r),{feature:t}}catch(e){throw{feature:t,error:e}}},C=async function(e){return await i().removeItem(e),e},L=function(e,t){return e.LOCAL_STORAGE_KEY_PREFIX+function(e){let t=e.options.featureType[0];return t.indexOf(":")<0&&(t=e.options.featureNS+":"+t),t+"@"+e.options.url}(t||e.layer.wfsLayer||e.layer)},T=function(e,t){return L(e,t)+e.LOCAL_STORAGE_ADDED_KEY_PREFIX},A=function(e,t){return L(e,t)+e.LOCAL_STORAGE_MODIFIED_KEY_PREFIX},x=function(e,t){return L(e,t)+e.LOCAL_STORAGE_REMOVED_KEY_PREFIX},P=function(e){return e.getPath?e.getPath().join("  "):e.title||e.id},O=S.prototype;O.CLASS="tc-ctl-wfsedit",O.LOCAL_STORAGE_KEY_PREFIX="TC.offline.edit.",O.LOCAL_STORAGE_ADDED_KEY_PREFIX=".added.",O.LOCAL_STORAGE_MODIFIED_KEY_PREFIX=".modified.",O.LOCAL_STORAGE_REMOVED_KEY_PREFIX=".removed.",O.register=async function(e){const r=this;return await l.default.prototype.register.call(r,e),window.addEventListener("online",(function(){t(r)})),window.addEventListener("offline",(function(){t(r)})),e.loaded((function(){if(r._layerSelect.disabled=!1,r.options.layer)r.setLayer(r.options.layer);else{const t=e.workLayers.filter((function(e){return e.type===a.Z.layerType.WFS&&!e.options.stealth}));1===t.length?r.setLayer(t[0].id):r.setLayer(null)}r.showOriginalFeatures(r.showsOriginalFeatures)})),e.ready((function(){e.getControlsByClass("TC.control.WorkLayerManager").forEach((function(t){t.addItemTool({renderFn:function(t,n){const i=r.CLASS+"-btn-edit";let o=t.querySelector("sitna-toggle."+i);if(!o){const t=r.getLocaleString("featureEditing");o=new f.Z,o.text=t,o.classList.add(i),o.checkedIconText=getComputedStyle(document.querySelector(":root")).getPropertyValue("--icon-edit").replaceAll('"',""),o.uncheckedIconText=o.checkedIconText,o.dataset.layerId=n;const s=e.getLayer(n);s.type===a.Z.layerType.WMS&&(o.classList.add(a.Z.classes.LOADING),s.getWFSCapabilities().catch((()=>o.classList.add(a.Z.classes.HIDDEN))).finally((()=>o.classList.remove(a.Z.classes.LOADING))))}return o},updateEvents:[a.Z.event.BEFORELAYERUPDATE,a.Z.event.LAYERUPDATE,a.Z.event.LAYERERROR,a.Z.event.CONTROLACTIVATE,a.Z.event.CONTROLDEACTIVATE],updateFn:function(t){const n=this,i=e.getLayer(n.dataset.layerId);setTimeout((()=>{n.classList.toggle(a.Z.classes.ACTIVE,r.layer===i)}),500),n.disabled=!i||i.isRaster()&&1!==i.names.length},actionFn:function(){const t=e.getLayer(this.dataset.layerId),n=r.layer;this.classList.remove(a.Z.classes.ACTIVE),(t.names&&1===t.names.length||!t.isRaster())&&(t&&n!==t?r.setLayer(t).then((()=>{r.openEditSession()})):r.setLayer(null))}})}))})),r._editPromise=e.addControl("edit",{id:r.getUID(),div:r.div.querySelector(`.${r.CLASS}-edit`),styles:r.styles,downloadElevation:r.options.downloadElevation,snapping:r.options.snapping}),r.editControl=await r._editPromise,r.editControl.getAvailableFeaturesToImport=function(){const t=Object.getPrototypeOf(r.editControl).getAvailableFeaturesToImport.call(r.editControl),n=r.getLayerEditData();return t.filter((t=>{const r=e.getLayer(t.id);return r!==n.addedFeaturesLayer&&r!==n.modifiedFeaturesLayer&&r!==n.removedFeaturesLayer&&r!==n.beforeEditLayer}))},r.editControl.importFeatures=function(e){const t=e||this.featuresToImport||[],n=r.getLayerEditData(),i=n.attributes?t.map((function(e){const t={};for(let r in n.attributes)t[r]=e.data[r];return new e.constructor(e.geometry,{geometryName:n.geometryName,data:t})})):e;Object.getPrototypeOf(r.editControl).importFeatures.call(r.editControl,i)},r.editControl.on(a.Z.event.DRAWEND,(function(e){r.getLayerEditData().serializable&&r._storeFeatureAdd(e.feature)})).on(a.Z.event.FEATUREMODIFY,(function(e){const t=e.feature,n=t.provId||t.id,i=function(){E(r,!0)},a=function(){o.Z.error(r.getLocaleString("failedWhenSavingModifyOperationInSession"))},s=r.getLayerEditData();if(s.serializable){let e=s.addedFeaturesLayer.getFeatureById(n);e?(e.setCoords(t.geometry),e.setData(t.getData()),b(T(r)+n,t).then(i,a)):(e=s.modifiedFeaturesLayer.getFeatureById(n),e?(e.setCoords(t.geometry),e.setData(t.getData())):s.modifiedFeaturesLayer.addFeature(r._createAuxFeature(t)),b(A(r)+n,t).then(i,a))}})).on(a.Z.event.FEATUREADD,(function(e){r.getLayerEditData().serializable&&r._storeFeatureAdd(e.feature)})).on(a.Z.event.FEATUREREMOVE,(function(e){r.getLayerEditData().serializable&&r._storeFeatureRemove(e.feature)})),e.workLayers.forEach((e=>r.addLayer(e))),e.on(a.Z.event.LAYERUPDATE,(function(e){const t=e.layer;t.type!==a.Z.layerType.WFS||t.options.readOnly||r.getEditableLayer(t).then((e=>r.cacheLayer(e))).catch((e=>console.log("Layer not editable: "+t.id)))})).on(a.Z.event.ZOOM,(function(t){e.workLayers.filter((e=>e.wfsLayer)).filter((e=>r.layer!==e)).forEach((function(e){e.wfsLayer=null,r.getEditableLayer(e)}))})).on(a.Z.event.LAYERADD,(function(e){r.addLayer(e.layer)})).on(a.Z.event.LAYERREMOVE,(function(e){const t=e.layer;if(r._removingLayer===t)return;(r.layer===t||t.wmsLayer&&r.layer===t.wmsLayer)&&r.setLayer(null);const n=r._layerSelect.querySelector(`option[value="${t.id}"]`);n&&n.parentElement.removeChild(n)})).on(a.Z.event.LAYERERROR,(function(t){const n=t.layer;n.type!==a.Z.layerType.WFS||n.options.readOnly||(t.reason===a.Z.WFSErrors.MAX_NUM_FEATURES&&e.toast(r.getLocaleString("query.msgTooManyResults",{limit:t.data.limit}),{type:a.Z.msgType.WARNING}),(r.layer===n||r.layer&&r.layer.wfsLayer===n)&&(delete r.layersEditData[r.layer.id],r.setLayer(null)),n.wmsLayer&&(e.removeLayer(n),n.wmsLayer.wfsLayer=null))})),r},O.loadTemplates=async function(){const e=await r.e(7523).then(r.bind(r,7523));this.template=e.default},O.render=function(e){const t=this;var r=[];if(t.map)for(var i=0,l=t.map.workLayers.length;i<l;i++){var c=t.map.workLayers[i];c.type!==a.Z.layerType.WFS||c.options.stealth||r.push({id:c.id,title:c.title||c.id})}return t._set1stRenderPromise(s.Z.prototype.renderData.call(t,{layers:r,showOriginalFeatures:t.showsOriginalFeatures,highlightChanges:t.highlightsAdded||t.highlightsModified||t.highlightsRemoved,controlId:t.id},(function(){t._layerDiv=t.div.querySelector(t._classSelector+"-layer"),t._layerSelect=t._layerDiv.querySelector(t._classSelector+"-layer-sel"),t._layerSelect.addEventListener("change",(function(e){n(t,!1),t.getEditableLayer(t._layerSelect.value).then((function(e){t.setLayer(e.wmsLayer||e).then((function(){t.layer&&t.openEditSession()}))})).catch((()=>{t.setLayer(null)}))}));const r=t.div.querySelector(t._classSelector+"-view");t._editingWatch=r.querySelector(`.${t.CLASS}-view-watch`),t._beforeEditLayerWatch=r.querySelector(`.${t.CLASS}-view-original-watch`),t._addedWatch=r.querySelector(`.${t.CLASS}-view-added-watch`),t._modifiedWatch=r.querySelector(`.${t.CLASS}-view-modified-watch`),t._removedWatch=r.querySelector(`.${t.CLASS}-view-removed-watch`),r.querySelector(`#${t.CLASS}-view-original-cb-${t.id}`).addEventListener("change",(function(e){t.showOriginalFeatures(e.target.checked)})),r.querySelector(`#${t.CLASS}-view-added-cb-${t.id}`).addEventListener("change",(function(e){t.highlightAdded(e.target.checked)})),r.querySelector(`#${t.CLASS}-view-modified-cb-${t.id}`).addEventListener("change",(function(e){t.highlightModified(e.target.checked)})),r.querySelector(`#${t.CLASS}-view-removed-cb-${t.id}`).addEventListener("change",(function(e){t.highlightRemoved(e.target.checked)}));const i=new RegExp(`${t.CLASS}-view-clr-(.+)-${t.id}`),s=function(e){const r=this.parentElement.querySelector("input[type=color]"),n=t.getLayerEditData(),o=n[r.id.match(i)[1]+"FeaturesLayer"];switch(n.geometryType){case a.Z.geom.POINT:r.value=o.styles.point.strokeColor;break;case a.Z.geom.POLYLINE:case a.Z.geom.MULTIPOLYLINE:r.value=o.styles.line.strokeColor;break;default:r.value=o.styles.polygon.strokeColor}r.click()},l=function(e){const r=e.target,n=t.getLayerEditData(),o=r.id.match(i)[1],s=n[o+"FeaturesLayer"],l=n[o+"CustomColor"]=r.value;switch(n.geometryType){case a.Z.geom.POINT:s.styles.point.strokeColor=l;break;case a.Z.geom.POLYLINE:case a.Z.geom.MULTIPOLYLINE:s.styles.line.strokeColor=l;break;default:s.styles.polygon.strokeColor=l,s.styles.polygon.fillColor=l}s.setStyles(s.styles),t[`_${o}Watch`].src=I(s,n.geometryType)},c=`${t.CLASS}-view-clr-added-${t.id}`;r.querySelector(`label[for="${c}"]`).addEventListener(a.Z.event.CLICK,s,{passive:!0}),document.getElementById(c).addEventListener("change",l);const u=`${t.CLASS}-view-clr-modified-${t.id}`;r.querySelector(`label[for="${u}"]`).addEventListener(a.Z.event.CLICK,s,{passive:!0}),document.getElementById(u).addEventListener("change",l);const p=`${t.CLASS}-view-clr-removed-${t.id}`;r.querySelector(`label[for="${p}"]`).addEventListener(a.Z.event.CLICK,s,{passive:!0}),document.getElementById(p).addEventListener("change",l),t._saveBtn=t.div.querySelector(t._classSelector+"-btn-save"),t._saveBtn.addEventListener(a.Z.event.CLICK,(function(){o.Z.confirm(t.getLocaleString("edit.applyEdits.confirm",{layerTitle:P(t.layer)}),(function(){t.applyEdits()}))}),{passive:!0}),t._discardBtn=t.div.querySelector(t._classSelector+"-btn-discard"),t._discardBtn.addEventListener(a.Z.event.CLICK,(function(){o.Z.confirm(t.getLocaleString("edit.discardEdits.confirm",{layerTitle:P(t.layer)}),(function(){t.discardEdits()}))}),{passive:!0}),t._recropBtn=t.div.querySelector(`.${t.CLASS}-view button.${t.CLASS}-btn-crop`),t._recropBtn.addEventListener(a.Z.event.CLICK,(function(){if(t.layer){const n=()=>{if(t.layer&&t.layer.wfsLayer&&o.Z.filter&&o.Z.filter.Bbox&&t.layer.wfsLayer.properties instanceof o.Z.filter.Bbox){const e=t.getLayerEditData();t.layer.wfsLayer.properties=new o.Z.filter.Bbox(null,t.map.getExtent(),t.map.getCRS()),t.layer.wfsLayer.refresh(),e.beforeEditLayer&&(e.beforeEditLayer.properties=t.layer.wfsLayer.properties,e.beforeEditLayer.refresh())}},i=t.getLayerEditData(),a=i.addedFeaturesLayer.features.concat(i.modifiedFeaturesLayer.features,i.removedFeaturesLayer.features);if(a.length){let i=!1;const s=t.map.getExtent(),l=[[s[0],s[1]],[s[0],s[3]],[s[2],s[3]],[s[2],s[1]]];for(var e=0,r=a.length;e<r;e++)if(!o.Z.Geometry.intersects(a[e].geometry,l)){i=!0;break}i?o.Z.confirm(t.getLocaleString("refreshLayerToCurrentExtent.confirm"),(function(){n()})):n()}else n()}}),{passive:!0}),o.Z.Util.isFunction(e)&&e()})))},O.addLayer=function(e){const t=this;e.isBase||e.options.readOnly||e.options.stealth||t.getEditableLayer(e).then((function(r){!e.isRaster()&&r.wmsLayer||function(e){const r=document.createElement("option");r.setAttribute("value",e.id),r.innerHTML=P(e),t.renderPromise().then((function(){t._layerSelect.appendChild(r)}))}(e)})).catch((t=>console.log(`Layer ${e.id} not editable. Reason: ${t.message}`)))},O.setLayer=function(e){const t=this;return new Promise((function(r,i){const o=t.map,a=t.div.querySelector(t._classSelector+"-layer-sel");e=o.getLayer(e);const s=o.workLayers.find((t=>t===e)),l=function(){s?t.getEditableLayer(s).then((function(e){const n=function(){t.layer=s,t._enableEditSerialization(s).then((function(){t.getEditControl().then((n=>{a.value=t.layer.id,n.mode=null,n.setLayer(e),r(t.layer)}))})).catch((e=>{t.setLayer(null),i(e)}))};o.workLayers.indexOf(e)>=0?n():o.addLayer(e).then(n)})).catch((()=>{t.setLayer(null),r(null)})):(t.layer&&t.layer.wfsLayer&&(t._removingLayer=t.layer.wfsLayer),t.getEditControl().then((e=>{n(t,!1),t.closeEditSession().then((()=>{a.value="",e.mode=null,e.setLayer(null),t.layer=null,r(null)})).finally((()=>{delete t._removingLayer}))})))};null!==e&&t.layer?(t.layer.wfsLayer&&(t._removingLayer=t.layer.wfsLayer),t.closeEditSession().then((()=>{s&&l()}))):l()}))},O._storeFeatureAdd=function(t){const r=this;t.provId="NewFeature."+e++;const n=r.getLayerEditData(),i=r._createAuxFeature(t);n.addedFeaturesLayer.addFeature(i),b(T(r)+t.provId,i).then((function(){E(r,!0)}),(function(){o.Z.error(r.getLocaleString("failedWhenSavingAddOperationInSession"))}))},O._storeFeatureRemove=function(e){const t=this;var r=e.provId||e.id,n=function(){E(t)},i=function(){o.Z.error(t.getLocaleString("failedWhenSavingRemoveOperationInSession"))};const a=t.getLayerEditData();if(a.serializable){let o=a.addedFeaturesLayer.getFeatureById(r);if(o)a.addedFeaturesLayer.removeFeature(o),C(T(t)+r).then(n,i);else{var s=x(t);o=a.modifiedFeaturesLayer.getFeatureById(r),o?(a.modifiedFeaturesLayer.removeFeature(o),a.removedFeaturesLayer.addFeature(t._createAuxFeature(e)),C(A(t)+r).then((function(){n(),b(s+r,e).then(n,i)}),i)):(o=a.removedFeaturesLayer.getFeatureById(r),o||(a.removedFeaturesLayer.addFeature(t._createAuxFeature(e)),b(s+r,e).then(n,i)))}}},O._createAuxFeature=function(e){const t=e.provId||e.id,r=this.getLayerEditData(),n=new e.constructor(e.geometry,{geometryName:r.geometryName,data:e.getData()});return n.setStyle(null),n.setId(t),n},O.getEditControl=function(){const e=this;return e._editPromise||new Promise((function(t,r){e.renderPromise().then((()=>t(e.editControl)))}))},O.cacheLayer=async function(e){const t=this;if(await t.getServiceWorker(),navigator.onLine){const r=e.wrap.getGetFeatureUrl(),n=await e.getDescribeFeatureTypeUrl();r&&n&&await t.createCache(L(t,e),{urlList:[r,n]})}},O.getFeatureType=function(e){const t=this;return new Promise((function(r,n){e=e||t.layer;const i=t.map.getLoadingIndicator(),o=i&&i.addWait();e.describeFeatureType().then((function(n){t.getEditControl().then((function(i){const o=t.getLayerEditData(e);let a;for(a in o.attributes={},n){const e=n[a],t=i.getGeometryType(e.type);t?(o.geometryName=e.name,o.geometryType="boolean"==typeof t?null:t):o.attributes[a]=e}for(a in o.attributes){const e=o.attributes[a];e.type=e.type.substr(e.type.indexOf(":")+1)}r(o)}))})).catch((function(e){n(e)})).finally((()=>i&&i.removeWait(o)))}))},O._addAuxLayersToMap=async function(e){const t=this,r=t.map;e=e||t.layer;const n=t.getLayerEditData(e),i=n.beforeEditLayer;if(!i)throw Error(`No auxiliary layers for ${e.id}`);{const o=function(e){e.layer===i&&(i.setVisibility(t.showsOriginalFeatures),i.setOpacity(1),r.off(a.Z.event.LAYERUPDATE,o))};r.on(a.Z.event.LAYERUPDATE,o);const s=n.addedFeaturesLayer,l=n.modifiedFeaturesLayer,c=n.removedFeaturesLayer;await Promise.all([i.setOpacity(0),r.addLayer(i),r.addLayer(s),r.addLayer(l),r.addLayer(c)]);const u=await t.getEditableLayer(e);let p=r.layers.indexOf(u);s.setVisibility(t.highlightsAdded),l.setVisibility(t.highlightsModified),c.setVisibility(t.highlightsRemoved),await r.insertLayer(i,++p);const h=p+1;r.insertLayer(s,h),r.insertLayer(l,h),r.insertLayer(c,h),i.setStyles(t.getBeforeEditLayerStyle(u)),s.setStyles(t.getAddedFeaturesLayerStyle(u)),l.setStyles(t.getModifiedFeaturesLayerStyle(u)),c.setStyles(t.getRemovedFeaturesLayerStyle(u)),t._editingWatch.src=I(u,n.geometryType),t._beforeEditLayerWatch.src=I(i,n.geometryType),t._addedWatch.src=I(s,n.geometryType),t._modifiedWatch.src=I(l,n.geometryType),t._removedWatch.src=I(c,n.geometryType)}},O.openEditSession=function(){const e=this;return e.layer?new Promise((function(t,r){e.getFeatureType().then((function(i){e.getEditControl().then((function(o){e.getEditableLayer(e.layer).then((function(s){switch(o.setLayer(s),i.geometryType){case a.Z.geom.MULTIPOLYLINE:case a.Z.geom.MULTIPOLYGON:o.setComplexGeometry(!0);break;default:o.setComplexGeometry(!1)}o.activate(),n(e,!0),E(e);const l=[c.default.mode.MODIFY,c.default.mode.OTHER];switch(i.geometryType){case a.Z.geom.POINT:l.push(c.default.mode.ADDPOINT);break;case a.Z.geom.POLYLINE:case a.Z.geom.MULTIPOLYLINE:l.push(c.default.mode.ADDLINE);break;case a.Z.geom.POLYGON:case a.Z.geom.MULTIPOLYGON:l.push(c.default.mode.ADDPOLYGON)}o.constrainModes(l),o.mode=c.default.mode.MODIFY,e._addAuxLayersToMap().then((()=>t())).catch((e=>r(e)))}))}))})).catch((function(i){e.layer&&e.layer.type===a.Z.layerType.VECTOR?e.getEditControl().then((function(r){r.activate(),n(e,!0),r.mode=c.default.mode.MODIFY,t()})):r(i)}))})):Promise.reject(Error("No layer set for editing"))},O.closeEditSession=async function(){const e=this;await e.renderPromise(),E(e,!1),e.getEditControl().then((e=>e.deactivate()));const t=e.getLayerEditData();if(null!=t&&t.beforeEditLayer){e._editingWatch.src=a.Z.BLANK_IMAGE,e._beforeEditLayerWatch.src=a.Z.BLANK_IMAGE,e._addedWatch.src=a.Z.BLANK_IMAGE,e._modifiedWatch.src=a.Z.BLANK_IMAGE,e._removedWatch.src=a.Z.BLANK_IMAGE;const r=e.layer,n=await e.getEditableLayer(e.layer),i=[],o=function(t){e.map.workLayers.indexOf(t)>=0&&i.push(e.map.removeLayer(t))};o(t.beforeEditLayer),o(t.beforeEditLayer),o(t.addedFeaturesLayer),o(t.modifiedFeaturesLayer),o(t.removedFeaturesLayer),r!==n&&(r.wfsLayer=null,o(n)),await Promise.all(i)}},O.getEditableLayer=async function(e){const t=this,r=`Layer ${e.id} not editable`,n=t.map;if(e=n?n.getLayer(e):e){if(e.type!==a.Z.layerType.WFS||!e.wmsLayer&&(e.options.stealth||e.options.readOnly)){if(e.type===a.Z.layerType.WMS){if(e.wfsLayer)return await e.wfsLayer.getCapabilitiesPromise(),e.wfsLayer;{const i=await e.getWFSCapabilities(),s=e.getDisgregatedLayerNames();let l=s[0],c=l.indexOf(":");c<0&&(l=await e.getWFSFeatureType(),c=l.indexOf(":"));const u=l.substr(0,c),p=l.substring(c+1);if(1!==s.length||Object.prototype.hasOwnProperty.call(i.FeatureTypes,p)){const r={id:t.getUID(),type:a.Z.layerType.WFS,url:await e.getWFSURL(),properties:n?new o.Z.filter.Bbox(null,n.getExtent(),n.getCRS()):null,outputFormat:a.Z.format.JSON,title:`${e.getPath().join("  ")} - ${t.getLocaleString("featureEditing")}`,geometryName:"geom",featureType:[p],featureNS:u,styles:t.styles,stealth:!0};return e.wfsLayer=new h.Z(r),e.wfsLayer.wmsLayer=e,e.wfsLayer}throw Error(r)}}if(e.type===a.Z.layerType.VECTOR)return e;throw Error(r)}return await e.getCapabilitiesPromise(),e}throw Error("No layer to edit")},O.isLayerEdited=async function(e){const t=L(this,e);try{const e=await i().keys();return!!e&&e.some((e=>0===e.indexOf(t)))}catch(e){return console.warn(e),!1}},O.getLayerEditData=function(e){const t=this,r=e||t.layer;return r?t.layersEditData[r.id]=t.layersEditData[r.id]||{checkedOut:!1}:null};const I=function(e,t){switch(t){case a.Z.geom.POINT:case a.Z.geom.MULTIPOINT:return o.Z.Util.getLegendImageFromStyle(e.styles.point,{geometryType:a.Z.geom.POINT});case a.Z.geom.POLYLINE:case a.Z.geom.MULTIPOLYLINE:return o.Z.Util.getLegendImageFromStyle(e.styles.line,{geometryType:a.Z.geom.POLYLINE});default:return o.Z.Util.getLegendImageFromStyle(e.styles.polygon,{geometryType:a.Z.geom.POLYGON})}};O._enableEditSerialization=function(t){const r=this;return new Promise((function(n,s){r.getEditableLayer(t).then((function(s){const l=function(){const l=r.getLayerEditData(t),c=P(t);var u=l.beforeEditLayer;u||(u=l.beforeEditLayer=new h.Z(o.Z.Util.extend({},s.options,{id:r.getUID(),title:`${c} - ${r.getLocaleString("dataBeforeEdits")}`,readOnly:!0,owner:r,stealth:!0})));var p=l.addedFeaturesLayer;let d=!0;p||(d=!1,p=l.addedFeaturesLayer=new h.Z({id:r.getUID(),title:`${c} - ${r.getLocaleString("addedFeatures")}`,owner:r,stealth:!0,zIndex:2}));var f=l.modifiedFeaturesLayer;let g=!0;f||(g=!1,f=l.modifiedFeaturesLayer=new h.Z({id:r.getUID(),title:`${c} - ${r.getLocaleString("modifiedFeatures")}`,owner:r,stealth:!0,zIndex:2}));var y=l.removedFeaturesLayer;let m=!0;y||(m=!1,y=l.removedFeaturesLayer=new h.Z({id:r.getUID(),title:`${c} - ${r.getLocaleString("removedFeatures")}`,owner:r,stealth:!0,zIndex:2}));const v=[];if(d&&g&&m)y.features.forEach((function(e){const t=s.getFeatureById(e.id);t&&s.removeFeature(t)})),f.features.forEach((function(e){const t=s.getFeatureById(e.id);t&&(t.setCoords(e.geometry),t.setData(e.getData()))})),p.features.forEach((function(e){s.getFeatureById(e.id)||v.push(s.addFeature(r._createAuxFeature(e)))})),Promise.all(v).then((()=>{l.serializable=!0,n(s)}));else{const t=L(r,s),o=T(r,s),c=A(r,s),u=x(r,s);i().keys().then((function(r){r&&r.filter((e=>0===e.indexOf(t))).forEach((function(t){v.push(new Promise((function(r,n){(async function(e){return{key:e,feature:await i().getItem(e)}})(t).then((function(t){var n,i=t.key;if(0===i.indexOf(u)){n=i.substr(u.length);const e=s.getFeatureById(n);s.removeFeature(e),y.addFeature(e).then((()=>r(e)))}else if(0===i.indexOf(c)){n=i.substr(c.length);const e=s.getFeatureById(n);if(e){e.setCoords(t.feature.geometry),e.setData(t.feature.attributes);const n=e.clone();n.setId(e.id),f.addFeature(n).then((()=>r(e)))}else r(e)}else if(0===i.indexOf(o)){n=i.substr(o.length);var l,h=parseInt(n.substr(n.lastIndexOf(".")+1));switch(e=Math.max(e,h+1),t.feature.type){case a.Z.geom.POINT:l=s.addPoint(t.feature.geometry);break;case a.Z.geom.POLYLINE:l=s.addPolyline(t.feature.geometry);break;case a.Z.geom.POLYGON:l=s.addPolygon(t.feature.geometry);break;case a.Z.geom.MULTIPOLYLINE:l=s.addMultiPolyline(t.feature.geometry);break;case a.Z.geom.MULTIPOLYGON:l=s.addMultiPolygon(t.feature.geometry)}l.then((function(e){e.provId=n,e.setData(t.feature.attributes);const i=e.clone();i.setStyle(null),i.setId(e.provId),p.addFeature(i).then((()=>r(i)))}))}}))})))})),Promise.all(v).then((()=>{l.serializable=!0,n(s)}))}))}};if(s.type===a.Z.layerType.WFS)if(s.state===p.Z.state.IDLE)l();else{const e=function(t){t.layer===s&&(l(),r.map.off(a.Z.event.LAYERUPDATE,e))};r.map.on(a.Z.event.LAYERUPDATE,e)}else n(s)}))}))},O.applyEdits=function(){const e=this;if(e.layer){const r=e.getLayerEditData();if(r.serializable){e.isSyncing=!0,t(e);const n=e.map.getLoadingIndicator(),i=n&&n.addWait(),s=r.modifiedFeaturesLayer.features.map((function(e){const t=r.beforeEditLayer.features.filter((t=>t.id===e.id))[0];let n,i;if(t){for(var o in i=u.Z.equals(e.geometry,t.geometry)?null:e.geometry,n={},e.data)if("id"!==o){const r=t.data[o],i=e.data[o];r!==i&&(n[o]=i)}}else i=e.geometry,n=e.data;const a=new e.constructor(i,{geometryName:r.geometryName});return a.setData(n),a.setId(e.id),a}));e.getEditableLayer(e.layer).then((function(l){l.applyEdits(r.addedFeaturesLayer.features,s,r.removedFeaturesLayer.features).then((function(t){e.layer.type===a.Z.layerType.WMS&&e.layer.refresh(),r.beforeEditLayer.clearFeatures(),l.features.forEach((e=>{const t=r.beforeEditLayer.features;t[t.length]=e.clone()})),e.deleteCache(L(e)).then((function(){e.cacheLayer(l).finally((function(){e.isSyncing=!1,n&&n.removeWait(i),e.discardEdits(),e.map.toast(e.getLocaleString("changesSuccessfullySyncedWithServer"),{type:a.Z.msgType.INFO})}))}))})).catch((function(r){e.isSyncing=!1,t(e),n&&n.removeWait(i),o.Z.error(e.getLocaleString("errorSyncingChanges",{code:r.code,reason:r.reason}),[a.Z.msgErrorMode.TOAST,a.Z.msgErrorMode.CONSOLE])}))}))}}},O.discardEdits=function(){var e=this;e._joinedFeatureAttributes=[];var t=L(e);i().keys().then((function(r){if(r){for(var n=0,o=r.length;n<o;n++){var a=r[n];0===a.indexOf(t)&&i().removeItem(a)}if(e.layer){const t=e.getLayerEditData();t.serializable&&(t.addedFeaturesLayer.clearFeatures(),t.modifiedFeaturesLayer.clearFeatures(),t.removedFeaturesLayer.clearFeatures(),e.editControl.setSelectedFeatures([]),e.editControl.modifyControl.closeAttributes(),e.getEditableLayer(e.layer).then((e=>e.refresh())))}E(e,!1)}}),(e=>console.warn(e))),e.editControl.mode=null},O.showOriginalFeatures=function(e){this.showsOriginalFeatures=e;const t=this.getLayerEditData();t&&t.beforeEditLayer.setVisibility(e)},O.highlightAdded=function(e){this.highlightsAdded=e;const t=this.getLayerEditData();t&&t.addedFeaturesLayer&&t.addedFeaturesLayer.setVisibility(e)},O.highlightModified=function(e){this.highlightsModified=e;const t=this.getLayerEditData();t&&t.modifiedFeaturesLayer&&t.modifiedFeaturesLayer.setVisibility(e)},O.highlightRemoved=function(e){this.highlightsRemoved=e;const t=this.getLayerEditData();t&&t.removedFeaturesLayer&&t.removedFeaturesLayer.setVisibility(e)};const R=function(e,t){const r={};switch(e.getLayerEditData(t.wmsLayer||t).geometryType){case a.Z.geom.POLYGON:case a.Z.geom.MULTIPOLYGON:r.polygon=t.map.options.styles.polygon;break;case a.Z.geom.POLYLINE:case a.Z.geom.MULTIPOLYLINE:r.line=t.map.options.styles.line;break;default:r.point=t.map.options.styles.point}return r};O.getBeforeEditLayerStyle=function(e){const t=function(t){const r=e.wrap.getRGBA(t);for(var n=0;n<3;n++)r[n]=255-r[n];return"#"+(65536*r[0]+256*r[1]+r[2]).toString(16).padStart(6,"0")},r=[1,3],n=o.Z.Util.extend(!0,{},e.options.styles||R(this,e));return n.point&&(n.point.strokeColor=t(n.point.strokeColor),n.point.lineDash=r),n.line&&(n.line.strokeColor=t(n.line.strokeColor),n.line.lineDash=r),n.polygon&&(n.polygon.strokeColor=t(n.polygon.strokeColor),n.polygon.lineDash=r),n};const M=function(e,t,r){const n=o.Z.Util.extend(!0,{},t.options.styles||R(e,t));return n.point&&(n.point.strokeColor=r,n.point.fillColor=r),n.line&&(n.line.strokeColor=r),n.polygon&&(n.polygon.strokeColor=r,n.polygon.fillColor=r),n};O.getAddedFeaturesLayerStyle=function(e){const t=this.getLayerEditData(e.wmsLayer||e);return M(this,e,t.addedCustomColor||"#00ff00")},O.getModifiedFeaturesLayerStyle=function(e){const t=this.getLayerEditData(e.wmsLayer||e);return M(this,e,t.modifiedCustomColor||"#ff7f00")},O.getRemovedFeaturesLayerStyle=function(e){const t=this.getLayerEditData(e.wmsLayer||e);return M(this,e,t.removedCustomColor||"#ff0000")}}(),o.Z.control.WFSEdit=S;const E=S},6564:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var n=r(688),i=r(330),o=r(9967),a=r(7497),s=r(7167),l=r(5394),c=r(8288),u=r(3048),p=r(8683),h=r(9529),d=r(1872),f=r(5265),g=r(9988);n.Z.control=n.Z.control||{},n.Z.control=n.Z.control||{},n.Z.UI=n.Z.UI||{},n.Z.UI.autocomplete=c.Z,n.Z.Control=a.Z,n.Z.filter=l.Z;const y=function(e){var t=this;a.Z.apply(this,arguments),t._dialogDiv=n.Z.Util.getDiv(t.options.dialogDiv),t.options.dialogDiv||document.body.appendChild(t._dialogDiv),t.exportsState=!0,t.styles=t.options.styles,t.highlightStyles=t.options.highlightStyles||t.options.highLightStyles,t.download=t.options.download,t.resultsPanel=null,t.geometryPanel=null,t.deletedFeatures=[],t.styles=n.Z.Util.extend(!0,{polygon:{strokeColor:t.DEFAULT_STROKE_COLOR,strokeWidth:2,fillColor:"#000",fillOpacity:0},line:{strokeColor:t.DEFAULT_STROKE_COLOR,strokeWidth:2,fillColor:"#000"}},t.options.styles);const r="."+t.CLASS;t._selectors={ELEVATION_CHECKBOX:r+"-dialog-elev input[type=checkbox]",INTERPOLATION_RADIO:"input[type=radio][name=finfo-ip-coords]",INTERPOLATION_DISTANCE:r+"-dialog-ip-m"}};n.Z.inherit(y,a.Z),n.Z.mix(y,s.default),function(){const e=y.prototype;e.DEFAULT_STROKE_COLOR="#0000ff";const t=i.Z.classes.LOADING,s=i.Z.classes.HIDDEN,l="tc-spatial";var c=null,m=null,v=null,_=null,w=null;const S=function(e){if(e)for(;e.children.length;)e.removeChild(e.children[0])},E={eq:{Ctor:n.Z.filter.equalTo,key:"query.equalTo"},neq:{Ctor:n.Z.filter.notEqualTo,key:"query.notEqualTo"},gt:{Ctor:n.Z.filter.greaterThan,key:"query.greaterThan"},lt:{Ctor:n.Z.filter.lessThan,key:"query.lowerThan"},gte:{Ctor:n.Z.filter.greaterThanOrEqualTo,key:"query.greaterThanOrEqualTo"},lte:{Ctor:n.Z.filter.lessThanOrEqualTo,key:"query.lowerThanOrEqualTo"},contains:{Ctor:n.Z.filter.like,key:"query.contains"},starts:{Ctor:n.Z.filter.like,key:"query.startsBy"},ends:{Ctor:n.Z.filter.like,key:"query.endsBy"},btw:{Ctor:n.Z.filter.between,key:"query.equalTo"},nbtw:{key:"query.notEqualTo"},intersects:{Ctor:n.Z.filter.like,key:"query.intersects"},within:{Ctor:n.Z.filter.between,key:"query.within"},empty:{Ctor:n.Z.filter.equalTo,key:"query.empty"},null:{Ctor:n.Z.filter.isNull,key:"query.empty"}},b={current:{layer:null,name:null,capabilities:null,title:null,URL:null,filter:[]},queried:null};var C=function(){return null},L=function(){return null},T=null,A=null;e.CLASS="tc-ctl-wfsquery";var x=function(e){var t=document.createElement("input");return t.setAttribute("type",e),t.type==e},P=null,O=null,I=function(e){x("date")?e.type="date":(e.type="search",new Promise((function(e,t){"undefined"!=typeof IMask?setTimeout((function(){e()}),10):n.Z.loadJS(!0,[n.Z.apiLocation+"/lib/polyfill/imask"],(function(){console.log("Imask loaded"),e()}))})).then((function(){P=new IMask(e,{mask:Date,pattern:w&&"es-ES"!==w?"eu-ES"===w?"Y/`m/`d":"m/`d/`Y":"d/`m/`Y",lazy:!1,format:function(e){var t=e.getDate(),r=e.getMonth()+1,n=e.getFullYear();switch(t<10&&(t="0"+t),r<10&&(r="0"+r),w){case"eu-ES":return[n,r,t].join("/");case"en-US":return[r,t,n].join("/");default:return[t,r,n].join("/")}},parse:function(e){switch(w){case"eu-ES":return new Date(e.split("/")[1]+"/"+e.split("/")[2]+"/"+e.split("/")[0]);case"en-US":return new Date(e);default:return new Date(e.split("/")[1]+"/"+e.split("/")[0]+"/"+e.split("/")[2])}},blocks:{d:{mask:IMask.MaskedRange,from:1,to:31,maxLength:2},m:{mask:IMask.MaskedRange,from:1,to:12,maxLength:2},Y:{mask:IMask.MaskedRange,from:1900,to:9999}}})})))},R=function(){if(P){var e=P.el.input;P.destroy(),P=null,e.value="",e.type="search"}};let M;var D=function(e,t){var r="";for(var i in r+='<option value="">'+T("query.chooseAttrCombo")+"</option>",e)e[i].type&&!n.Z.Util.isGeometry(e[i].type)&&(r+='<option value="'+(e[i].name||i)+'">'+i+"</option>");var o=document.createElement("div");o.insertAdjacentHTML("beforeend",'<select class="'+this.className+'" name="'+this.name+'">'+r+"</select>"),this.parentNode.parentNode.insertBefore(o,this.parentNode.nextSibling).firstElementChild.addEventListener("change",(function(){N.apply(this,[t,e])}))};const N=function(t,r){var i=this;i.parentElement.parentElement.querySelectorAll("select").forEach((function(e){i.offsetTop<e.offsetTop&&e.parentElement.parentElement.removeChild(e.parentElement)}));const o=t.querySelector(`.${e.CLASS}-numeric`),a=t.querySelector(`.${e.CLASS}-text`),c=t.querySelector(`.${e.CLASS}-date`),u=t.querySelector(`.${e.CLASS}-geom`),p=t.querySelector(`.${e.CLASS}-where`),h=t.querySelector(`.${e.CLASS}-op`);var d=p.querySelector(".tc-textbox");if(d.disabled=!1,d.dataset.autocomplete&&n.Z.UI.autocomplete.call(d,"clear"),o.classList.add(s),c.classList.add(s),a.classList.add(s),u.classList.add(s),p.classList.add(s),r[this.selectedOptions[0].value.substring(this.selectedOptions[0].value.indexOf(":")+1)])switch(A=r[this.selectedOptions[0].value.substring(this.selectedOptions[0].value.indexOf(":")+1)].type,h.classList.remove(s),n.Z.UI.autocomplete.call(d,"destroy"),function(){if(O){var e=O.el.input;O.destroy(),O=null,e.value="",e.type="search"}}(),d.type="search",!0){case!A:console.log("type es nulo");break;case A instanceof Object:D.apply(this,[A,t]);break;case n.Z.Util.isGeometry(A):u.classList.remove(s),p.classList.remove(s),p.classList.add(l),0===u.querySelectorAll("input:checked").length&&(u.firstElementChild.checked=!0),R();break;case A.indexOf("int")>=0:case A.indexOf("float")>=0:case A.indexOf("double")>=0:case A.indexOf("long")>=0:case A.indexOf("decimal")>=0:o.classList.remove(s),p.classList.remove(s,l),0===o.querySelectorAll("input:checked").length&&(o.firstElementChild.checked=!0),R(),x("number")&&(n.Z.Util.detectIE()?(d.type="text",new Promise((function(e,t){"undefined"!=typeof IMask?setTimeout((function(){e()}),10):n.Z.loadJS(!0,[n.Z.apiLocation+"/lib/polyfill/imask"],(function(){console.log("Imask loaded"),e()}))})).then((function(){O=new IMask(d,{mask:Number,scale:A.indexOf("int")>=0||A.indexOf("long")>=0?0:2,signed:!1,thousandsSeparator:w&&"en-US"===w?",":".",padFractionalZeros:!1,normalizeZeros:!0,radix:w&&"en-US"===w?".":","})}))):(d.type="number",A.indexOf("int")>=0||A.indexOf("long")>=0?d.step="1":d.step="0.0001"));break;case A.indexOf("dateTime")>=0:case A.indexOf("date")>=0:c.classList.remove(s),p.classList.remove(s,l),0===c.querySelectorAll("input:checked").length&&(c.firstElementChild.checked=!0),I(d);break;case A.indexOf("string")>=0:{a.classList.remove(s),p.classList.remove(s,l),0===a.querySelectorAll("input:checked").length&&(a.firstElementChild.checked=!0),R();const r=[].slice.call(t.querySelectorAll("select[name="+this.name+"]")).reduce((function(e,t){return e+(e?"/":"")+t.value}),"");j(d,r,t.getElementsByClassName(e.CLASS+"-list tc-ctl-search-list")[0]);break}}else h.classList.add(s)},Z=function(){const t=this,r=t.getForm(),o=r.querySelector(`.${t.CLASS}-where-list`);S(o),e.getRenderedHtml(t.CLASS+"-filter",{conditions:b.current.filter.map((e=>function(e,t){const r=t instanceof n.Z.filter.Spatial;return{field:r?e.getLocaleString("geometry"):t.propertyName,opText:e.getLocaleString(E[t._abbr].key),valueToShow:t._valueToShow,isSpatial:r}}(t,e))),locale:t.map.options.locale},(function(e){o.innerHTML=e,o.querySelectorAll(`.${t.CLASS}-where-cond-view`).forEach((function(e,r){e.addEventListener(i.Z.event.CLICK,(function(){t.map.zoomToFeatures([b.current.filter.filter((e=>e instanceof n.Z.filter.Spatial))[r].geometry]),t.showGeometryPanel()}),{passive:!0})})),r.querySelectorAll(`.${t.CLASS}-del-cond`).forEach((function(e,r){e.addEventListener(i.Z.event.CLICK,(function(){t.removeFilter(r)}),{passive:!0})}))}))};var k=function(e){const t=this;var r,n=e.querySelector('.tc-ctl-wfsquery input[type="radio"]:checked');return P&&!P.masked.isComplete?(!1===/^(?=\d)(?:(?:31(?!.(?:0?[2469]|11))|(?:30|29)(?!.0?2)|29(?=.0?2.(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00)))(?:\x20|$))|(?:2[0-8]|1\d|0?[1-9]))([-.\/])(?:1[012]|0?[1-9])\1(?:1[6-9]|[2-9]\d)?\d\d(?:(?=\x20\d)\x20|$))?(((0?[1-9]|1[012])(:[0-5]\d){0,2}(\x20[AP]M))|([01]\d|2[0-3])(:[0-5]\d){1,2})?$/.test(str)&&B.call(t,T("query.msgNoValidDate")),!1):0===n.length?(B.call(t,T("query.msgNoCondition")),!1):e.querySelectorAll("input[type='date']").length&&!e.querySelector("input[type='date']").checkValidity()?(B.call(t,T("query.msgNoValidDate")),!1):e.querySelectorAll("input[type='number']").length&&null!==(r=e.querySelector("input[type='number']"))&&!r.checkValidity()?("1"===r.step?B.call(t,T("query.msgNoValidNumberMustInt")):B.call(t,T("query.msgNoValidNumber")),!1):""!==e.querySelector("input.tc-textbox").value.trim()||"empty"===n.value||"null"===n.value||(B.call(t,T("query.msgNoValueCondition")),!1)};const F=()=>b.current.title;var U=async function(e){const t=this;var r=e;if(t.resultsPanel)t.resultsPanel.options.save.fileName=r+".xls";else{var i=t.map.getControlsByClass(n.Z.control.ControlContainer);const e={content:"table",titles:{main:"",max:""},save:{fileName:r+".xls"},download:()=>function(e,t){const r=e;r.getDownloadDialog().then((function(e){var n={title:t()};(r.map.elevation||r.options.displayElevation)&&(n=Object.assign({},n,{elevation:Object.assign({},r.map.elevation&&r.map.elevation.options,r.options.displayElevation)})),e.open(r.resultsLayer.features,n)}))}(t,F),share:!0,resize:!0};0===i.length?(t.resultsPanel=await t.map.addControl("resultsPanel",e),t.resultsPanel.caller=t):(e.position="right",t.resultsPanel=await i[0].addControl("resultsPanel",e),t.resultsPanel.caller=t),t.resultsPanel.template[t.resultsPanel.CLASS+"-table"]=t.template[t.CLASS+"-table"],t.resultsPanel.addItemTool({renderFn:function(e){const r=t.CLASS+"-btn-zoom";let n=e.querySelector("sitna-button."+r);n&&(n.remove(),n=null);const i=t.getLocaleString("query.zoomToExtent");return n=new g.Z,n.variant=g.Z.variant.MINIMAL,n.text=i,n.iconText="",n.classList.add(r),n},updateEvents:[],actionFn:function(){t.map.zoomToLayer(t.resultsLayer)}}),t.resultsPanel.addItemTool({renderFn:function(e){const r=t.CLASS+"-btn-chng";let n=e.querySelector("sitna-button."+r);n&&(n.remove(),n=null);return n=new g.Z,n.variant=g.Z.variant.MINIMAL,n.text="Cambiar criterios",n.iconText="",n.classList.add(r),n},updateEvents:[],actionFn:async function(){b.current=Object.assign({},b.queried,{filter:[...b.queried.filter]}),await $.apply(t,[b.current])}})}t.resultsPanel.options.titles.max=t.resultsPanel.getLocaleString("geo.trk.chart.exp")},B=function(e,t){if(c){var r=c.getElementsByClassName("tc-ctl-wfsquery-message")[0];if(m)clearTimeout(m);else{switch(r.innerHTML=e,t){case i.Z.msgType.INFO:r.classList.add("tc-msg-info");break;case i.Z.msgType.WARNING:r.classList.add("tc-msg-warning");break;case i.Z.msgType.ERROR:default:r.classList.add("tc-msg-error")}r.classList.remove(s)}m=setTimeout((function(){m=null,r.classList.add(s)}),3e3)}else this.map.toast(e,{type:t})},G=async function(e,t){const r=this;var o=Object.assign({},b.current.capabilities);switch(document.querySelector(".tc-ctl-wfsquery.tc-ctl-wfsquery-text input:checked").value){case"starts":t+="*";break;case"contains":case"eq":case"neq":t="*"+t+"*";break;case"ends":t="*"+t}_&&_.abort();let a=(_=new AbortController).signal;try{var s=await b.current.layer.proxificationTool.fetch(b.current.URL,{data:n.Z.Util.WFGetPropertyValue(b.current.name,!(e.indexOf("/")>=0)&&e,n.Z.filter.like(e,t,void 0,void 0,void 0,!1),o),contentType:"application/xml",method:"POST",signal:a});if(s.contentType.startsWith("application/xml")||s.contentType.startsWith("text/xml")){let e=(new DOMParser).parseFromString(s.responseText,"text/xml"),t=e.querySelector("Exception ExceptionText");if(t)return B.call(r,t.innerHTML,i.Z.msgType.ERROR),[];const n=[];return e.querySelectorAll("member > *").forEach((function(e){n.indexOf(e.innerHTML)<0&&(n[n.length]=e.innerHTML)})),n}if(s.contentType.startsWith("application/json")&&(s=JSON.parse(s.responseText)),s.features&&s.features.length>0){let t;return 1===s.features.length&&(t=[e.split("/").reduce((function(e,t){return e[t.substring(t.indexOf(":")+1)]}),s.features[0].properties)]),s.features.length>1&&(t=s.features.reduce((function(t,r){if(t&&t instanceof Array)return t.indexOf(r.properties[e])<0?t.concat(e.split("/").reduce((function(e,t){return e[t.substring(t.indexOf(":")+1)]}),r.properties)):t}),[])),t}return[]}catch(e){return e instanceof DOMException&&"AbortError"!==e.name&&B.call(r,e,i.Z.msgType.ERROR),null}},j=function(e,t,r){n.Z.UI.autocomplete.call(e,{minLength:3,target:r,source:function(e,r){var n=this;n.target.innerHTML='<li><a class="tc-ctl-search-li-loading" href="#">'+T("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>',n.target.classList.remove(s),v&&window.clearTimeout(v),v=window.setTimeout((async function(){if(!document.querySelector(".tc-ctl-wfsquery.tc-ctl-wfsquery-text").classList.contains(i.Z.classes.HIDDEN)){var o=await G.call(n,t,e);o&&(o.length?r(o.sort()):n.target.classList.add(s))}}),500)},callback:function(t){e.value=t.currentTarget.dataset.value,this.target.classList.add(s)},buildHTML:function(t){var r=e.value;return this.target.style.maxHeight="",t.results.length>1?t.results.reduce((function(e,t,n){return(n>1?e:W(e,r))+W(t,r)})):W(t.results[0],r)}}),e.addEventListener("targetCleared.autocomplete",(function(){r.classList.add(s)})),e.addEventListener("keypress",(function(t){13==t.which&&n.Z.UI.autocomplete.call(e,"clear")})),e.addEventListener("search",(function(t){0===e.value.length&&n.Z.UI.autocomplete.call(e,"clear")})),e.addEventListener("input",(function(t){0===e.value.length&&n.Z.UI.autocomplete.call(e,"clear")}))},W=function(e,t){return t=new RegExp(t.replace(/\W/g,""),"gi"),'<li><a href="#" data-value="'+e+'">'+e.replace(t,"<b>$&</b>")+"</a></li>"},H=function(e){const t=this;var r=function(e,t){var r;return t instanceof u.Z?r=e.addPoint(t.getCoords()):t instanceof p.Z?r=e.addPolyline(t.getCoords()):t instanceof h.Z?r=e.addPolygon(t.getCoords()):t instanceof f.Z?r=e.addMultiPolygon(t.getCoords()):t instanceof d.Z&&(r=e.addMultiPolyline(t.getCoords())),r};if(e.layer){var n=e.layer.map.getLayer("WFSQueryResultsHighlight");n?r(n,e):e.layer.map.addLayer({id:"WFSQueryResultsHighlight",type:i.Z.layerType.VECTOR,owner:t,stealth:!0,styles:L()},(function(t){r(t,e)}))}};e.loadTemplates=async function(){const e=this,t=r.e(5656).then(r.bind(r,5656)),n=r.e(2442).then(r.bind(r,2442)),i=r.e(6615).then(r.bind(r,6615)),o=r.e(5519).then(r.bind(r,6266)),a=r.e(8026).then(r.bind(r,8026)),s=r.e(2620).then(r.bind(r,2620)),l=r.e(9449).then(r.bind(r,9449)),c=r.e(6216).then(r.bind(r,6216)),u={};u[e.CLASS+"-dialog"]=(await t).default,u[e.CLASS+"-form"]=(await n).default,u[e.CLASS+"-filter"]=(await i).default,u[e.CLASS+"-table"]=(await o).default,u["tc-ctl-finfo-attr-val"]=(await a).default,u["tc-ctl-finfo-object"]=(await s).default,u[e.CLASS+"-geom"]=(await l).default,u[e.CLASS+"-share-dialog"]=(await c).default,e.template=u},e.render=function(e){const t=this;return t._set1stRenderPromise(Promise.all([a.Z.prototype.render.call(t,e),t.getRenderedHtml(t.CLASS+"-share-dialog",{},(function(e){t._dialogDiv.innerHTML=e}))]))},e.register=async function(e){const r=this;return e.on(i.Z.event.LAYERERROR,(e=>{if(e.layer===r.resultsLayer){if(r.modalDialog&&r.modalDialog.getElementsByClassName("tc-modal-body")[0].classList.remove(t),e.reason!==i.Z.WFSErrors.MAX_NUM_FEATURES)throw B.call(r,T("query.errorUndefined"),i.Z.msgType.ERROR),new Error(e.reason);B.call(r,T("query.msgTooManyResults",{limit:e.data.limit}),i.Z.msgType.WARNING)}})),e.on(i.Z.event.BEFOREFEATUREREMOVE,(e=>{if(e.layer===r.resultsLayer){const t=e.layer.features.indexOf(e.feature);r.deletedFeatures.push(t);const n=r.resultsPanel.div.querySelector("table tbody tr:not(."+i.Z.classes.DISABLED+")[data-index='"+t+"']");delete n.dataset.index,n.removeAttribute("title"),n.classList.add(i.Z.classes.DISABLED);for(let n=t+1;n<e.layer.features.length;n++){const e=r.resultsPanel.div.querySelector("table tbody tr[data-index='"+n+"']");e&&e.dataset.index&&(e.dataset.index=parseInt(e.dataset.index,10)-1)}}})),await a.Z.prototype.register.call(r,e),C=function(){var e=function(e,t){return this.options.styles&&this.options.styles[e]&&this.options.styles[e][t]||o.Z.styles[e][t]};return{polygon:{fillColor:e.bind(r,"polygon","fillColor"),fillOpacity:e.bind(r,"polygon","fillOpacity"),strokeColor:e.bind(r,"polygon","strokeColor"),strokeOpacity:e.bind(r,"polygon","strokeOpacity"),strokeWidth:e.bind(r,"polygon","strokeWidth")},line:{strokeColor:e.bind(r,"line","strokeColor"),strokeOpacity:e.bind(r,"line","strokeOpacity"),strokeWidth:e.bind(r,"line","strokeWidth")},point:{radius:e.bind(r,"point","radius"),height:e.bind(r,"point","height"),width:e.bind(r,"point","width"),fillColor:e.bind(r,"point","fillColor"),fillOpacity:e.bind(r,"point","fillOpacity"),strokeColor:e.bind(r,"point","strokeColor"),strokeWidth:e.bind(r,"point","strokeWidth"),fontSize:e.bind(r,"point","fontSize"),fontColor:e.bind(r,"point","fontColor"),labelOutlineColor:e.bind(r,"point","labelOutlineColor"),labelOutlineWidth:e.bind(r,"point","labelOutlineWidth"),label:e.bind(r,"point","label"),labelRotationKey:e.bind(r,"point","labelRotationKey")}}},L=function(){var e={polygon:n.Z.Util.extend(!0,{},o.Z.styles.polygon,{fillColor:"#0099FF",fillOpacity:1,strokeColor:"#0099FF",strokeWidth:2}),line:n.Z.Util.extend(!0,{},o.Z.styles.line,{strokeColor:"#0099FF",strokeWidth:2}),point:n.Z.Util.extend(!0,{},o.Z.styles.point,{strokeColor:"#0099FF"})};return r.highlightStyles?{polygon:n.Z.Util.extend(!0,{},e.polygon,r.highlightStyles.polygon?r.highlightStyles.polygon:{}),line:n.Z.Util.extend(!0,{},e.line,r.highlightStyles.line?r.highlightStyles.line:{}),point:n.Z.Util.extend(!0,{},e.point,r.highlightStyles.point?r.highlightStyles.point:{})}:e},w=e.options.locale,T=function(e,t){return n.Z.Util.getLocaleString(w,e,t)},e.ready((function(){e.getControlsByClass("TC.control.WorkLayerManager").forEach((function(n){n.addItemTool({renderFn:function(n,o){const a=r.CLASS+"-btn-open";let l=n.querySelector("sitna-button."+a);l&&(l.remove(),l=null);const c=e.getLayer(o);if(c.type===i.Z.layerType.WMS||c.type===i.Z.layerType.WFS){const e=r.getLocaleString("query.tooltipMagnifBtn");l=new g.Z,l.variant=g.Z.variant.MINIMAL,l.text=e,l.iconText="",l.classList.add(a),l.dataset.layerId=o,c.type===i.Z.layerType.WMS&&(l.classList.add(t),c.getWFSCapabilities().then((e=>{if(e.Operations.GetFeature){var t=c.getDisgregatedLayerNames?c.getDisgregatedLayerNames():c.featureType;(t=t.filter((function(t){return Object.prototype.hasOwnProperty.call(e.FeatureTypes,t.substring(t.indexOf(":")+1))}))).length||l.classList.add(s)}else l.classList.add(s)})).catch((()=>l.classList.add(s))).finally((()=>l.classList.remove(t))))}return l},updateEvents:[],actionFn:function(){var e;const t=this;if(t.classList.contains("tc-unavailable")||t.classList.contains("tc-loading"))return;const n=r.map.getLayer(t.dataset.layerId);b.queried&&(b.current=Object.assign({},b.queried,{filter:[...b.queried.filter]})),b.current.layer&&b.current.layer==n?(null===(e=b.current)||void 0===e?void 0:e.layer)!==n||b.current.filter.length||(b.current.name=""):(b.current.layer=n,b.current.name="",b.current.filter=[],r.modalDialog=null),$.apply(r,[b.current])}})}))})),await r.getShareDialog(),r};const q=function(e){const r=e.layer.owner;if(r&&e.layer===r.resultsLayer){if(e.newData&&0===e.newData.totalFeatures)return r.modalDialog.getElementsByClassName("tc-modal-body")[0].classList.remove(t),void B.call(r,T("query.msgNoResults"),i.Z.msgType.INFO);var o=e.layer.features;if(o.length>0){r.toShare&&r.toShare.doZoom&&(r._setQueryToSearch({doZoom:!1}),r.map.zoomToFeatures(o));const e="h3_"+r.getLocaleString("service"),t="h4_"+r.getLocaleString("layer"),i=r.map.getControlsByClass(n.Z.control.Click).some((e=>e.TITLE_SEPARATOR))?r.map.getControlsByClass(n.Z.control.Click).find((e=>e.TITLE_SEPARATOR)).TITLE_SEPARATOR:"  ";for(var a=0;a<o.length;a++){const r=b.current.layer.getPath(b.current.name).slice(1);if(r){const s={};s[e]=b.current.title,s[t]=r.join(i);const l=n.Z.Util.extend(s,o[a].getData());o[a].clearData(),o[a].setData(l)}}r.showResultsPanel(o.length>1?o.reduce((function(e,t){return(e instanceof Array?e:[e.data]).concat([t.data])})):[o[0].data],b.current.title)}e.layer.map.off(i.Z.event.LAYERUPDATE,q)}},V=function(e){const t=e.layer.owner;t&&e.layer===t.resultsLayer&&e.query&&t._setQueryToSearch({filter:e.query})};e._sendQuery=async function(e){const t=this;if(b.current.layer&&b.current.name&&b.current.title&&e){var r=await b.current.layer.getWFSURL();t.definitiveFilters=[e],b.queried=b.current,await U.apply(t,[b.current.title]),b.current.layer.proxificationTool.cacheHost.getAction(r).then((function(o){const a=o.action(r);t.resultsLayer&&t.resultsLayer.url!==a&&(t.map.removeLayer(t.resultsLayer),t.resultsLayer=null),t.resultsLayer?(t.map.off(i.Z.event.BEFOREAPPLYQUERY,V),t.map.on(i.Z.event.BEFOREAPPLYQUERY,V),t.resultsLayer.setVisibility(!1),t.resultsLayer.clearFeatures(),t.map.off(i.Z.event.LAYERUPDATE,q),t.map.on(i.Z.event.LAYERUPDATE,q),t.resultsLayer.url=a,t.resultsLayer.featurePrefix=b.current.name.substring(0,b.current.name.indexOf(":")),t.resultsLayer.featureType=b.current.name.substring(b.current.name.indexOf(":")+1),t.resultsLayer.properties=e,t.resultsLayer.setVisibility(!0),t.resultsLayer.refresh()):(t.map.on(i.Z.event.BEFOREAPPLYQUERY,V),t.map.addLayer({id:"WFSQueryResults",type:i.Z.layerType.WFS,url:a,owner:t,stealth:!0,geometryName:"the_geom",featurePrefix:b.current.name.substring(0,b.current.name.indexOf(":")),featureType:b.current.name.substring(b.current.name.indexOf(":")+1),properties:e,outputFormat:i.Z.format.JSON,styles:C()}).then((function(e){t.resultsLayer=e,e.map.on(i.Z.event.LAYERUPDATE,q)})),t.map.on(i.Z.event.RESULTSPANELCLOSE,(function(e){e.control===t.resultsPanel&&(n.Z.browserFeatures.touch()&&n.Z.Util.swipe(e.control.div,"enable"),t.resultsLayer.clearFeatures(),t.resultsLayer.setVisibility(!1),t.clearFilters(),b.current.name="",b.queried=null,t.modalDialog=null,t.map.off(i.Z.event.LAYERUPDATE,q),t.map.off(i.Z.event.BEFOREAPPLYQUERY,V),delete t.toShare)})))}))}},e.sendQuery=async function(){const e=this;if(!e.validateQuery())return void B.call(e,T("query.msgNoQueryFilter"));let r;if(e.modalDialog.getElementsByClassName("tc-modal-body")[0].classList.add(t),b.current.filter.length>1){const t=e.modalDialog.querySelector(".tc-ctl-wfsquery-logOpRadio:checked").value;r=n.Z.filter[i.Z.logicalOperator[t]].apply(null,b.current.filter)}else r=b.current.filter[0];e._sendQuery.call(e,r)},e._setQueryToSearch=function(e){const t=this;1===Object.keys(e).length&&Object.prototype.hasOwnProperty.call(e,"doZoom")?t.toShare=n.Z.Util.extend(t.toShare,{doZoom:e.doZoom}):(e.filter||t.resultsLayer&&t.resultsLayer.properties instanceof n.Z.filter.Filter)&&(t.toShare=n.Z.Util.extend(t.toShare,{wms:{url:b.current.layer.url,names:b.current.layer.names},title:b.current.title,name:b.current.name,filter:e.filter?e.filter:t.resultsLayer.properties.getText(),doZoom:!Object.prototype.hasOwnProperty.call(e,"doZoom")||e.doZoom}))},e._getQueryToSearch=function(){return this.toShare},e.exportState=function(){const e=this;return e.toShare?{id:e.id,queryResult:JSON.stringify(e.toShare)}:null},e.importState=function(e){const t=this;if(e.queryResult){let r=t.map.getLoadingIndicator().addWait();t.map.loaded((function(){let i=JSON.parse(e.queryResult);if(i.wms&&i.filter){let e=t.map.workLayers.filter((e=>e.url&&e.url===i.wms.url&&e.names.join()===i.wms.names.join()));e.length>0&&(b.current.layer=e[0],b.current.name=i.name,b.current.title=i.title,t._setQueryToSearch({doZoom:i.doZoom}),b.current.layer.describeFeatureType(b.current.name).then((function(e){z.apply(t,[e,!1]),t._sendQuery(i.filter),t._setQueryToSearch({filter:i.filter,doZoom:i.doZoom}),b.current.filter=[n.Z.filter.Filter.fromText(i.filter)],b.queried=b.current=Object.assign({},b.current,{filter:[...b.current.filter]}),t.map.getLoadingIndicator().removeWait(r)})))}else alert("shared query error")}))}},e.validateQuery=function(){return b.current.filter.length>0},e.showResultsPanel=function(e,t){const r=this;r.deletedFeatures=[],r.resultsPanel.div.querySelector(`.${r.resultsPanel.CLASS}-title-text`).innerText=r.resultsPanel.getLocaleString(e.length>1?"query.titleResultPaneMany":"query.titleResultPanelOne",{numero:e.length,layerName:t}),r.resultsPanel.div.classList.add("tc-ctl-wfsquery-results"),r.modalDialog&&r.modalDialog.parentElement.removeChild(r.modalDialog);const o=M();r.resultsPanel.openTable({data:e,css:{trClass:"trClass",tdClass:"tdClass",thClass:"thClass"},sort:!0,callback:function(t){r.resultsPanel.maximize(),console.log("render del panel de resultados");var a=t.querySelectorAll(".tc-table > tbody > tr"),s=1;for(var l in e[0])if(Object.prototype.hasOwnProperty.call(o,l)){const e=o[l].type;if(e&&!(e instanceof Object)&&(e.indexOf("int")>=0||e.indexOf("float")>=0||e.indexOf("double")>=0||e.indexOf("long")>=0||e.indexOf("decimal")>=0))for(var c=t.querySelectorAll("td:nth-child("+s+")"),u=0;u<c.length;u++)c[u].classList.add("tc-numeric");e&&e instanceof Object&&console.log("aki lo que sea"),s++}for(var p=0;p<a.length;p++)a[p].addEventListener("click",(function(e){if(e.stopPropagation(),!this.classList.contains(i.Z.classes.DISABLED)){var t=this.dataset.index;null!=t&&r.resultsLayer.map.zoomToFeatures([r.resultsLayer.features[t]])}})),a[p].addEventListener("mouseenter",(function(){if(!this.classList.contains(i.Z.classes.DISABLED)){var e=this.dataset.index;if(null!=e){var t=r.resultsLayer.features[e];t&&t.geometry&&H.call(r,t);var n=this.querySelectorAll("td.tc-value div");n.length>0?n.forEach((function(e){e.offsetWidth<e.scrollWidth&&(e.title=e.innerText)})):this.querySelectorAll("td").forEach((function(e){e.offsetWidth<e.scrollWidth&&(e.title=e.innerText)}))}}})),a[p].addEventListener("mouseleave",(function(){var e=this.dataset.index;if(null!=e){var t,n=r.resultsLayer.features[e];n&&n.geometry&&(t=n.layer.map.getLayer("WFSQueryResultsHighlight"))&&t.clearFeatures()}}));t.querySelectorAll(".tc-complex-attr label,.tc-complex-attr input").forEach((function(e){e.addEventListener("click",(function(e){e.stopPropagation()}))})),t.querySelectorAll(".tc-complex-attr input").forEach((function(e){e.addEventListener("change",(function(e){this.checked&&this.nextElementSibling.querySelectorAll("td.tc-value div").forEach((function(e){e.offsetWidth<e.scrollWidth&&(e.title=e.innerText)}))}))})),n.Z.control.FeatureInfoCommons.addSpecialAttributeEventListeners(t),t.querySelectorAll("td > img, td > video, td > audio, td > iframe").forEach((e=>e.parentNode.classList.add("tc-multimedia"))),t.querySelectorAll("video").forEach((e=>{e.addEventListener(i.Z.event.CLICK,(function(e){e.stopPropagation()}),{passive:!0})})),r.deletedFeatures.length>0&&(r.deletedFeatures.sort().forEach((e=>{const t=r.resultsPanel.div.querySelector("table tbody tr[data-index='"+e+"']");delete t.dataset.index,t.removeAttribute("title"),t.classList.add(i.Z.classes.DISABLED)})),Array.from(r.resultsPanel.div.querySelectorAll("table tbody tr:not(."+i.Z.classes.DISABLED+")")).forEach((e=>{const t=parseInt(e.dataset.index,10);e.dataset.index=t-r.deletedFeatures.filter((e=>e<t)).length}))),n.Z.browserFeatures.touch()&&n.Z.Util.swipe(r.resultsPanel.div,"disable")}})},e.showGeometryPanel=function(e,t=!0){const r=this;return new Promise((async function(o){if(n.Z.Util.closeModal(),r.geometryPanel)r.geometryPanel.open(),o(r.drawControl.layer);else{const e={titles:{main:r.getLocaleString("query.spatialFilter")}},t=r.map.getControlsByClass(n.Z.control.ControlContainer)[0];t?(e.position=t.POSITION.RIGHT,r.geometryPanel=await t.addControl("resultsPanel",e)):r.geometryPanel=await r.map.addControl("resultsPanel",e),r.map.on(i.Z.event.RESULTSPANELCLOSE,(function(e){e.control===r.geometryPanel&&(setTimeout((()=>r.drawControl.cancel()),500),n.Z.Util.showModal(r.modalDialog,{closeCallback:()=>r.clearFilters()}))}));const a=await r.getRenderedHtml(r.CLASS+"-geom");r.geometryPanel.open(a),r.geometryPanel.div.querySelector(`.${r.CLASS}-geom-btn-ok`).addEventListener(i.Z.event.CLICK,(function(){r.geometryPanel.close()}),{passive:!0}),r.drawControl||(r.drawControl=await r.map.addControl("draw",{div:r.geometryPanel.getTableContainer().querySelector(`.${r.CLASS}-geom-draw`),styles:r.styles}),o(r.drawControl.layer),r.drawControl.on(i.Z.event.DRAWEND,(function(e){e.feature.showsPopup=!1,r.geometryPanel.close();const t=r.modalDialog.querySelector(`input[name="${r.id}-condition"]:checked`).value;let i;if("intersects"===t)i=new n.Z.filter.Intersects(null,e.feature,r.map.crs);else i=new n.Z.filter.Within(null,e.feature,r.map.crs);switch(i._abbr=t,e.target.mode){case"polygon":i._valueToShow=r.getLocaleString("polygon");break;case"line":case"polyline":i._valueToShow=r.getLocaleString("line");break;case"rectangle":i._valueToShow=r.getLocaleString("box")}b.current.filter.push(i),Z.apply(r),n.Z.Util.showModal(r.modalDialog,{closeCallback:()=>r.clearFilters()})})),r.drawControl.on(i.Z.event.DRAWCANCEL,(function(e){e.ctrl.deactivate()})))}r.geometryPanel.div.querySelector(`.${r.CLASS}-geom-draw`).classList.toggle(i.Z.classes.HIDDEN,!e),r.geometryPanel.div.querySelector(`.${r.CLASS}-geom-btn`).classList.toggle(i.Z.classes.HIDDEN,!!e),e&&r.drawControl.setMode(e,t)}))};const z=function(r,o){const a=this;for(var s in M=function(){return r},r){const e=r[s];n.Z.Util.isGeometry(e.type)&&(e.isGeometry=!0)}if(o)return new Promise((function(o){e.getRenderedHtml(e.CLASS+"-form",{operators:E,attributes:r,controlId:a.id},(function(s){const l=a.modalDialog,u=a.getForm();S(u),u.insertAdjacentHTML("beforeend",s),c.classList.remove(t);var p=u.getElementsByClassName("tc-combo");if(0===p.length)l.getElementsByClassName("tc-button tc-ctl-wlm-btn-launch")[0].setAttribute("disabled","");else{l.getElementsByClassName("tc-button tc-ctl-wlm-btn-launch")[0].removeAttribute("disabled"),p[0].addEventListener("change",(function(){N.apply(this,[u,r])})),u.querySelectorAll(`input[name="${a.id}-condition"]`).forEach((t=>{t.addEventListener("change",(async function(t){u.querySelector(`.${e.CLASS}-geomtype-line-btn`).disabled="within"===t.target.value;const r=c.querySelector(".tc-ctl-wfsquery-value input");if(r.disabled=!1,this.parentElement.classList.contains("tc-ctl-wfsquery-text")&&"empty"===this.value&&(r.value="",r.disabled=!0,n.Z.UI.autocomplete.call(r,"clear")),this.parentElement.classList.contains("tc-ctl-wfsquery-date")&&"null"===this.value&&(r.value="",r.disabled=!0),""!==r.value.trim()&&this.parentElement.classList.contains("tc-ctl-wfsquery-text")&&"empty"!==this.value){var i=document.createEvent("HTMLEvents");i.initEvent("keyup",!1,!0),r.dispatchEvent(i)}}))})),u.querySelector(".tc-button").addEventListener(i.Z.event.CLICK,(function(){var e=u.querySelector("input.tc-textbox");if(n.Z.UI.autocomplete.call(e,"clear"),O&&O.masked.remove(),!k.call(a,u))return;var t=[].reduce.call(u.querySelectorAll(".tc-combo"),(function(e,t){return e+(e?"/":"")+t.value}),"");var r=u.querySelector('.tc-ctl-wfsquery input[type="radio"]:checked').value;Y.apply(a,[e,t,r,A]),Z.apply(a),e.value=""}),{passive:!0});const t=function(e){a.showGeometryPanel(e.target.value)};u.querySelectorAll("button[name='geometry']").forEach((e=>e.addEventListener(i.Z.event.CLICK,t,{passive:!0}))),o(u)}}))}))},Y=function(e,t,r,i){let o=(a=e,O?O.unmaskedValue:P?P.unmaskedValue.substring(4)+"-"+P.unmaskedValue.substring(2,4)+"-"+P.unmaskedValue.substring(0,2):a.value);var a;let s=function(e){if(O)return O.value;if(P)return P.value;if("date"===e.type)return new Date(e.value).toLocaleDateString(w,{timeZone:"UTC"});if("number"===e.type){var t=1.1.toLocaleString(w).substring(1,2);return e.value.replace(".",t)}return e.value}(e);switch(!0){case i.indexOf("xsd:int")>=0:s=parseInt(o,10);break;case i.indexOf("xsd:float")>=0:case i.indexOf("xsd:double")>=0:case i.indexOf("xsd:long")>=0:case i.indexOf("xsd:decimal")>=0:s=parseFloat(o,10);break;case i.indexOf("xsd:string")>=0&&"empty"!==r:s='"'+s+'"';break;case i.indexOf("xsd:date")>=0&&"null"===r:s=""}var l;if(i.indexOf("dateTime")>=0||i.indexOf("date")>=0)if(o){const e=new Date(o+"T00:00:00").toISOString(),i=new Date(o+"T23:59:59").toISOString();l="nbtw"===r?new n.Z.filter.not(n.Z.filter.between(t,e,i)):new E[r].Ctor(t,e,i)}else l=new E[r].Ctor(t);else l=new E[r].Ctor(t,("ends"===r||"contains"===r?"*":"")+o+("starts"===r||"contains"===r?"*":""));l.matchCase=!1,l._abbr=r,l._valueToShow=s,b.current.filter.push(l)},K=async function(e,r,o){const a=this;a.modalDialog=r,b.current.layer=e,b.current.capabilities=o,b.current.URL=o.Operations.DescribeFeatureType.DCP.HTTP.Get.href,new URL(b.current.URL).host===document.location.host&&(b.current.URL=b.current.URL.substring(b.current.URL.indexOf(":")+1));var l=e.getDisgregatedLayerNames?e.getDisgregatedLayerNames():e.featureType;if((l=l.filter((function(e){return Object.prototype.hasOwnProperty.call(o.FeatureTypes,e.substring(e.indexOf(":")+1))}))).length>1){c.classList.remove(t);r.getElementsByClassName("tc-combo")[0].addEventListener("change",(function(){if(this.value)r.querySelector(".tc-modal-body .tc-ctl-wfsquery-message",r).classList.add(s),b.current.title=this.options[this.selectedIndex].text,c.classList.add(t),b.current.name=this.value,X.apply(a,[b.current.layer,b.current.name,r]);else{var e=a.getForm();S(e);for(var n=0;n<e.children.length;n++)e.removeChild(e.children[n]);a.clearFilters()}}))}else if(1===l.length){if(o.FeatureTypes[l[0].substring(l[0].indexOf(":")+1)])b.current.title=o.FeatureTypes[l[0].substring(l[0].indexOf(":")+1)].Title,b.current.name=l[0],await X.apply(a,[b.current.layer,b.current.name,r]);else{var u=r.getElementsByClassName("tc-modal-body")[0];u.classList.remove(t),u.insertAdjacentHTML("beforeend",'<div class="tc-ctl-wfsquery-message tc-msg-warning">'+T("query.LayerNotAvailable")+"</div>")}}else n.Z.Util.closeModal(),e.map.toast(n.Z.Util.getLocaleString(e.map.options.locale,"query.LayerNotAvailable"),{type:i.Z.msgType.ERROR})},X=async function(e,r,n){const i=this;try{const t=await e.describeFeatureType(r);return{attributes:t,form:await z.apply(i,[t,!0])}}catch(e){var o=n.getElementsByClassName("tc-modal-body")[0];throw o.classList.remove(t),e?o.insertAdjacentHTML("beforeend",'<div class="tc-ctl-wfsquery-message tc-msg-error">'+e+"</div>"):o.insertAdjacentHTML("beforeend",'<div class="tc-ctl-wfsquery-message tc-msg-warning">'+T("query.LayerNotAvailable")+"</div>"),e}},$=async function(e){const r=this;if(r.modalDialog&&!r.modalDialog.parentElement)return document.body.appendChild(r.modalDialog),r.modalDialog.getElementsByClassName("tc-modal-body")[0].classList.remove(t),b.current=e,b.current.filter.filter((e=>e instanceof n.Z.filter.Spatial)).forEach((e=>{e.geometry instanceof SITNA.feature.Polygon&&!e.geometry.layer&&r.drawControl.layer.addPolygon(e.geometry),e.geometry instanceof SITNA.feature.Polyline&&!e.geometry.layer&&r.drawControl.layer.addPolyline(e.geometry)})),r.modalDialog;{var i;const t=await J.apply(r,[e.layer]),s=await Q.apply(r,[e.layer,t,e.name]),l=await K.apply(r,[e.layer,s,t]);if(null!==(i=e.filter)&&void 0!==i&&i.length){const t=[...e.filter];r.clearFilters();const i=await X.apply(r,[e.layer,e.name,l]),s=i.form.querySelector(".tc-combo[name='attributes']"),c=Object.entries(i.attributes).find((e=>n.Z.Util.isGeometry(e[1].type)))[0];if(s){var o=Object.keys(i.attributes).filter((e=>"FEATURE"!==e)).indexOf(t[0].propertyName||c);s.options[o+1].selected=!0,N.apply(s,[i.form,i.attributes])}const u=t[0]instanceof n.Z.filter.LogicalNary?t[0].getTagName():"And";i.form.querySelector("."+r.CLASS+"-logOpRadio[value='"+u.toUpperCase()+"']").checked=!0;const p=t.reduce(((e,t)=>e.concat(t instanceof n.Z.filter.LogicalNary?t.conditions:t)),[]);for(var a in p){const e=p[a],t=ee(e),o=i.attributes[e.propertyName||c].type,s=await te.apply(r,[e,t,i,c]);e instanceof n.Z.filter.Spatial||Y.apply(r,[s,e.propertyName,t,o])}Z.apply(r)}return s}},J=function(e){let t,r;if(e.type===i.Z.layerType.WMS){const n=e.getPath();t=n[n.length-1],r=e.getWFSCapabilities()}else{if(e.type!==i.Z.layerType.WFS)return;t=e.title,r=e.getCapabilitiesPromise()}return r},Q=async function(e,r,o){const a=this;let s,l;if(e.type===i.Z.layerType.WMS){const t=e.getPath();s=t[t.length-1]}else{if(e.type!==i.Z.layerType.WFS)return;s=e.title}return new Promise((function(i){e.getDisgregatedLayerNames?(l=[],e.getDisgregatedLayerNames().forEach((function(t,n){var i=e.getPath(t);Object.prototype.hasOwnProperty.call(r.FeatureTypes,t.substring(t.indexOf(":")+1))&&l.push({name:t,title:i[i.length-1]})})),l.sort((function(e,t){return e.title<t.title?-1:e.title>t.title?1:0}))):l=e.featureType,a.getRenderedHtml(a.CLASS+"-dialog",{layerName:T("query.titleDialog",{layerName:s}),layers:l},(function(e){document.body.querySelectorAll(`.${a.CLASS}-dialog`).forEach((e=>e.remove()));var r=document.createElement("div");r.insertAdjacentHTML("beforeEnd",e);var s=null;if(r.childNodes.length>0&&(s=r.firstChild,document.body.appendChild(s)),(c=s.getElementsByClassName("tc-modal-body")[0]).classList.add(t),n.Z.Util.showModal(s,{closeCallback:()=>a.clearFilters()}),n.Z.Util.detectIE()){var u=1;switch(!0){case document.body.clientWidth>768&&document.body.clientWidth<document.body.clientHeight:case document.body.clientWidth>1024:case document.body.clientWidth>1140:u=.7}c.style.maxHeight=document.body.clientHeight*u-c.nextElementSibling.clientHeight-c.previousElementSibling.clientHeight}a.modalDialog=s,s.getElementsByClassName("tc-button tc-ctl-wlm-btn-launch")[0].addEventListener("click",(function(){a.sendQuery()})),o&&l.length>1&&(Array.from(s.querySelector(".tc-combo[name='availableLayers']")).find((e=>e.value===o)).selected=!0),i(s)}))}))};e.removeFilter=function(e){const t=this;let r=e;if(e instanceof n.Z.filter.Filter&&(r=b.current.filter.indexOf(e)),r>=0&&r<b.current.filter.length){const e=b.current.filter.splice(r,1)[0];e instanceof n.Z.filter.Spatial&&e.geometry.layer.removeFeature(e.geometry),Z.apply(t)}},e.clearFilters=function(){b.current.filter.filter((e=>e instanceof n.Z.filter.Spatial)).forEach((e=>{var t,r;return null===(t=e.geometry)||void 0===t||null===(r=t.layer)||void 0===r?void 0:r.removeFeature(e.geometry)})),b.current.filter.length=0},e.getForm=function(){return this.modalDialog&&this.modalDialog.querySelector(".tc-modal-form")};const ee=function(e){var t,r;switch(!0){case e instanceof n.Z.filter.EqualTo:return"eq";case e instanceof n.Z.filter.NotEqualTo:return"neq";case e instanceof n.Z.filter.GreaterThan:return"gt";case e instanceof n.Z.filter.LessThan:case e instanceof n.Z.filter.GreaterThanOrEqualTo:case e instanceof n.Z.filter.LessThanOrEqualTo:return"lt";case e instanceof n.Z.filter.IsLike:var i=(null===(t=/<!\[CDATA\[(?<content>.*?)\]\]>/gm.exec(e.pattern))||void 0===t||null===(r=t.groups)||void 0===r?void 0:r.content)||e.pattern;return e.expression=i.replace(/\*/g,""),i.startsWith("*")?i.endsWith("*")?"contains":"ends":i.endsWith("*")?"starts":"";case e instanceof n.Z.filter.IsNull:return"null";case e instanceof n.Z.filter.IsBetween:return e.expression=new Date(e.LowerBoundary).getFullYear()+"-"+new Date(e.LowerBoundary).getMonth()+"1-"+new Date(e.LowerBoundary).getDate(),"btw";case e instanceof n.Z.filter.Intersects:return"intersects";case e instanceof n.Z.filter.Within:return"within"}},te=async function(e,t,r,i){var o,a;const s=this,l=document.createElement("input");l.value=(null===(o=/<!\[CDATA\[(?<content>.*?)\]\]>/gm.exec(e.expression))||void 0===o||null===(a=o.groups)||void 0===a?void 0:a.content)||e.expression;const c=r.attributes[e.propertyName||i].type;switch(!0){case n.Z.Util.isGeometry(c):var u=await s.showGeometryPanel(e.geometry.STYLETYPE,!1);s.geometryPanel.close();var p=new e.constructor(null,e.geometry,s.map.crs);switch(p._abbr=t,e.geometry.STYLETYPE){case"polygon":var h=e.geometry.getCoordinates()[0];h[0][0]===h[1][0]&&h[0][1]===h[3][1]&&h[3][0]==h[3][0]&&h[1][1]==h[1][1]?p._valueToShow=s.getLocaleString("box"):p._valueToShow=s.getLocaleString("polygon");break;case"line":p._valueToShow=s.getLocaleString("line")}b.current.filter.push(p),u.addFeature(e.geometry);break;case c.indexOf("int")>=0:case c.indexOf("float")>=0:case c.indexOf("double")>=0:case c.indexOf("long")>=0:case c.indexOf("decimal")>=0:l.type="number",c.indexOf("int")>=0||c.indexOf("long")>=0?l.step="1":l.step="0.0001";break;case c.indexOf("dateTime")>=0:case c.indexOf("date")>=0:l.type="date";break;case c.indexOf("string")>=0:l.type="text"}return l}}(),n.Z.control.WFSQuery=y;const m=y},2461:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>C});var n=r(688),i=r(4571),o=r(268),a=r(330),s=r(9967),l=r(3089),c=r(1455);function u(e,t){p(e,t),t.add(e)}function p(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function h(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function d(e,t){var r=function(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}(e,t,"get");return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,r)}function f(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}n.Z.control=n.Z.control||{},n.Z.i18n=n.Z.i18n||l.Z;const g="sitna-control";var y=new WeakMap,m=new WeakSet,v=new WeakSet,_=new WeakSet;class w extends HTMLElement{constructor(){var e,t,r;super(),u(this,_),u(this,v),u(this,m),h(this,"template",void 0),h(this,"control",void 0),e=this,t=y,r={writable:!0,value:new WeakMap},p(e,t),t.set(e,r);const n=this;n.map=null,n.isActive=!1,n.isDisabled=!1,n.CLASS=n.getClassName();var i=arguments.length;n.options=o.Z.extend({},i>1?arguments[1]:arguments[0]);const a=n.options.div||arguments[0];if(a){const e=o.Z.getDiv(a);n.div=e}else n.div=n.parentElement;n.template=n.options.template||n.template,n.exportsState=!1}connectedCallback(){const e=this;if(e.classList.add(w.CLASS,e.CLASS),e.map instanceof i.Z)return;const t=e.getAttribute("for");let r;if(t){const n=document.getElementById(t);if(n)if(r=i.Z.get(n),r)r.addControl(e);else{new MutationObserver((function(t,o){for(const a of t)"childList"===a.type&&(r=i.Z.get(n),r&&(r.addControl(e),o.disconnect()))})).observe(n,{childList:!0})}}else{let t=e;do{t=t.parentElement,!e.containerControl&&t instanceof w&&(e.containerControl=t)}while(t&&!t.classList.contains(a.Z.classes.MAP));r=i.Z.get(t),r?r.addControl(e):e.renderPromise()}}disconnectedCallback(){this.unregister()}getClassName(){return this.CLASS}initProperty(e){const t=this;return Object.prototype.hasOwnProperty.call(t.options,e)&&(t[e]=t.options[e]),t}show(){return this.style.display="",this}hide(){const e=this;return e.style.display="none",e.unhighlight(),e}render(e){const t=this;return t._set1stRenderPromise(t.renderData(null,(function(){t.addUIEventListeners(),"function"==typeof e&&e()})))}async loadTemplates(){}_set1stRenderPromise(e){const t=this;return t._firstRender||(t._firstRender=e),e}async renderData(e,t){const r=this;let i;r.map&&r.trigger(a.Z.event.BEFORECONTROLRENDER,{dataObject:e}),r.classList.toggle(a.Z.classes.DISABLED,r.isDisabled),r.template||await r.loadTemplates(),"object"!=typeof r.template||r.template.compiler?(i=r.template,r.template={},r.template[r.CLASS]=i):i=r.template[r.CLASS];const o=await r.getRenderedHtml(r.CLASS,e);r.innerHTML=o,!r.parentElement&&r.div&&r.div.appendChild(r),r.map&&r.trigger(a.Z.event.CONTROLRENDER),n.Z.Util.isFunction(t)&&t()}async getRenderedHtml(e,t,r){const i=this,o=function(e){if(void 0===e)return"";const i=e(t);return n.Z.Util.isFunction(r)&&r(i),i};i.template||await i.loadTemplates();const a=i.template[e];return"function"!=typeof a?(await f(i,m,S).call(i,{locale:i.map&&i.map.options.locale,className:i.CLASS}),o(i.template[e])):o(a)}async register(e){const t=this;return t.id||(t.id=t.options.id||n.Z.getUID({prefix:t.CLASS.substr("tc-ctl".length+1)+"-"})),t.map=e,await t.render(),t.parentElement||(e.div.appendChild(t),t.div=e.div),t.options.active&&t.activate(),t}unregister(){const e=this;if(e.map){e.map.layers.slice().forEach((t=>{t.owner===e&&e.map.removeLayer(t)}));const t=e.map.controls.indexOf(e);t>=0&&e.map.controls.splice(t,1),e.map=null}return e}activate(){const e=this;return e.map&&e.map.activeControl&&e.map.activeControl!==e&&(e.map.previousActiveControl=e.map.activeControl,e.map.activeControl.deactivate()),e.isActive=!0,e.map&&(e.map.activeControl=e,e.map.trigger(a.Z.event.CONTROLACTIVATE,{control:e}),e.trigger(a.Z.event.CONTROLACTIVATE,{control:e})),e}deactivate(e){0===arguments.length&&(e=!1);const t=this;if(t.isActive=!1,t.map){if(t.map.activeControl=null,!e){var r=t.map.getDefaultControl();r===t||t.map.previousActiveControl===t?r=null:r||(r=t.map.previousActiveControl),r&&r.activate()}t.map.trigger(a.Z.event.CONTROLDEACTIVATE,{control:t}),t.trigger(a.Z.event.CONTROLDEACTIVATE,{control:t})}return t}enable(){const e=this;return e.isDisabled=!1,e.classList.remove(a.Z.classes.DISABLED),delete e.dataset.tcMessage,e.containerControl&&e.containerControl.onControlEnable&&e.containerControl.onControlEnable(e),e}disable(e){const t=this;e=e||{},t.isDisabled=!0,t.classList.add(a.Z.classes.DISABLED);let r=t.getLocaleString("disabledControl");return e.reason&&(r=`${r} - ${e.reason}`),t.dataset.tcMessage=r,t.containerControl&&t.containerControl.onControlDisable&&t.containerControl.onControlDisable(t),t}highlight(){const e=this;return e.div&&e.div.classList.add(a.Z.classes.HIGHLIGHTED),e.map&&e.map.trigger(a.Z.event.CONTROLHIGHLIGHT,{control:e}),e}unhighlight(){const e=this;return e.div&&e.div.classList.remove(a.Z.classes.HIGHLIGHTED),e.map&&e.map.trigger(a.Z.event.CONTROLUNHIGHLIGHT,{control:e}),e}isHighlighted(){const e=this;return!!e.div&&e.div.classList.contains(a.Z.classes.HIGHLIGHTED)}renderPromise(){const e=this;return e._firstRender||new Promise((function(t,r){e.one(a.Z.event.CONTROLRENDER,(function(){t(e)}))}))}addUIEventListener(e,t,r){const n=this;return(e?n.querySelectorAll(e):[n]).forEach((function(e){e.addEventListener(t,r)})),n}addUIEventListeners(){return this}isExclusive(){return!1}getLocaleString(e,t){const r=this.map?this.map.options.locale:s.Z.locale;return o.Z.getLocaleString(r,e,t)}getUID(){return n.Z.getUID({prefix:this.id+"-"})}exportState(){return this.exportsState?{}:null}importState(e){return this}async getDownloadDialog(){const e=this;return e._downloadDialog=e._downloadDialog||e.map.getControlsByClass("TC.control.FeatureDownloadDialog")[0],e._downloadDialog||(e._downloadDialog=await e.map.addControl("FeatureDownloadDialog")),e._downloadDialog.caller=e,e._downloadDialog}async getElevationTool(){const e=this;if(!e.displayElevation&&!e.options.displayElevation)return null;if(e.elevation)return e.elevation;if(n.Z.tool.Elevation||await r.e(4759).then(r.bind(r,2331)),"boolean"==typeof e.options.displayElevation)if(e.map){const t=await e.map.getElevationTool();e.elevation=t||new n.Z.tool.Elevation}else e.elevation=new n.Z.tool.Elevation;else if(e.map){const t=await e.map.getElevationTool();e.elevation=t?new n.Z.tool.Elevation(n.Z.Util.extend(!0,{},t.options,e.options.displayElevation)):new n.Z.tool.Elevation(e.options.displayElevation)}else e.elevation=new n.Z.tool.Elevation(e.options.displayElevation);return e.elevation}on(e,t){return f(this,_,b).call(this,e,t)}one(e,t){return f(this,_,b).call(this,e,t,{once:!0})}off(e,t){const r=this,n=e.split(" ");return t?n.forEach((function(e){const n=r._listeners[e];n&&n.has(t)&&r.removeEventListener(e,n.get(t))})):n.forEach((function(e){const t=r._listeners[e];t&&(t.forEach((function(t){r.removeEventListener(e,t)})),t.clear())})),r}trigger(e,t){let r;t&&(r={detail:t});const n=new CustomEvent(e,r);this.dispatchEvent(n)}listenerBySelector(e,t){const r=this;return function(n){const i=this,o=n.type;var a=d(r,y).get(i);a||(a={},d(r,y).set(i,a));var s=a[o];if(s||(a[o]=s={}),s[e]||(s[e]=t),!n._listenerBySelectorCalled)for(var l,c=!1,u=n.target;u&&u!==i;){for(e in s)u.matches&&u.matches(e)&&(c=!0,l=s[e].call(i,n),n._listenerBySelectorCalled=!0);if(c)return l;u=u.parentNode}}}static async create(e,t){const i=e.substr(0,1).toUpperCase()+e.substr(1);if(!n.Z.control[i]){const e=await r(8949)("./"+i);n.Z.control[i]=e.default}return new n.Z.control[i](null,t)}}async function S(e){e=e||{};const t=this.template,r=[];for(var i in t){const e=i;let o=t[e];"string"==typeof o?r.push(new Promise((function(r,i){n.Z.ajax({url:o,method:"GET",responseType:"text"}).then((function(n){t[e]=o=c.Z.compile(n.data),r(o)})).catch((function(e){console.log("Error fetching template: "+e),i(e)}))}))):"object"==typeof o&&(t[i]=o=c.Z.template(o))}for(var i in await Promise.all(r),t){t[i]&&i!==e.className&&c.Z.registerPartial(i,t[i])}}function E(e,t){const r=this,n=function(e){const n={type:e.type,target:r,currentTarget:r};return e.detail&&Object.keys(e.detail).forEach((function(t){t in n||(n[t]=e.detail[t])})),t.call(r,n)}.bind(this);r._listeners=r._listeners||[];return(r._listeners[e]=this._listeners[e]||new Map).set(t,n),n}function b(e,t,r){const n=this;return e.split(" ").forEach((function(e){n.addEventListener(e,f(n,v,E).call(n,e,t),r)})),n}h(w,"CLASS","tc-ctl"),customElements.get(g)||customElements.define(g,w),n.Z.control.WebComponentControl=w;const C=w},849:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>b});var n=r(688),i=r(330),o=r(2006),a=r(9988),s=(r(4109),r(8239)),l=r(8197),c=r(5198);function u(e,t,r){h(e,t),t.set(e,r)}function p(e,t){h(e,t),t.add(e)}function h(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function d(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}function g(e,t){var r=function(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}(e,t,"get");return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,r)}n.Z.control=n.Z.control||{},i.Z.classes.DRAG=i.Z.classes.DRAG||"tc-drag",i.Z.classes.DRAGEND=i.Z.classes.DRAGEND||"tc-dragend",i.Z.event.TOOLSOPEN=i.Z.event.TOOLSOPEN||"toolsopen.tc";var y=new WeakSet,m=new WeakMap,v=new WeakSet,_=new WeakMap;class w extends o.default{constructor(){super(...arguments),p(this,v),p(this,y),d(this,"CLICKEVENT","click"),u(this,m,{writable:!0,value:function(){return!this.layers.some((e=>e.unremovable))}}),u(this,_,{writable:!0,value:function(e,t,r,n){const i=this,o=i.getLayerUIElements();var a;if(r>t)a=o[r-1];else{if(!(r<t))return;a=o[r+1]}const s=i.map.getLayer(e.dataset.layerId),l=i.map.getLayer(a.dataset.layerId),c=i.map.layers.indexOf(l);c>=1&&c<i.map.layers.length&&i.map.insertLayer(s,c,n)}});const e=this;e.div.classList.remove(super.CLASS),e.div.classList.add(e.CLASS),e.layers=[],e._uiElementSelector=`ul > li.${e.CLASS}-elm`,e._toolContainerSelector=`.${e.CLASS}-tools`,e.addItemTool({renderFn:function(t,r){const n=e.CLASS+"-btn-dl";let i=t.querySelector("sitna-button."+n);if(!i){if(e.map.getLayer(r)instanceof l.Z){const t=e.getLocaleString("downloadFeatures");i=new a.Z,i.variant=a.Z.variant.MINIMAL,i.text=t,i.icon=a.Z.action.DOWNLOAD_ALL,i.setAttribute("title",t),i.dataset.layerId=r}}return i},actionFn:function(){var t=this;do{t=t.parentElement}while(t&&"LI"!==t.tagName);const r=e.map.getLayer(this.dataset.layerId);e.getDownloadDialog().then((function(t){const n=r.title||"",i={title:`${n} - ${e.getLocaleString("downloadFeatures")}`,fileName:/\.[a-z0-9]+$/i.test(n)?n.substr(0,n.lastIndexOf(".")):n,elevation:e.map.elevation&&e.map.elevation.options};t.open(r.features,i)}))}})}getClassName(){return"tc-ctl-wlm"}async loadTemplates(){const e=this,t=r.e(7832).then(r.bind(r,7832)),n=r.e(3708).then(r.bind(r,3708)),i=r.e(7335).then(r.bind(r,7335)),o=r.e(3412).then(r.bind(r,3412)),a=r.e(9397).then(r.bind(r,9397)),s={};s[e.CLASS]=(await t).default,s[e.CLASS+"-elm"]=(await n).default,s[e.CLASS+"-type-sgl"]=(await i).default,s[e.CLASS+"-type-grp"]=(await o).default,s[e.CLASS+"-type-grp-node"]=(await a).default,e.template=s}render(e,t){const i=this;return i._set1stRenderPromise(i.map?i.renderData(t?n.Z.Util.extend(i.map.getLayerTree(),t):i.map.getLayerTree(),(function(){i.addUIEventListeners(),r.e(4958).then(r.bind(r,4958)).then((function(t){const r=t.default;i.map.workLayers.filter((function(e){return!e.stealth})).forEach((function(e){i.updateLayerTree(e)}));const o=i.div.querySelector("ul");i._sortable=r.create(o,{handle:"."+i.CLASS+"-dd",animation:150,onSort:function(e){g(i,_).call(i,e.item,e.oldIndex,e.newIndex)}}),o.addEventListener("keydown",n.Z.EventTarget.listenerBySelector("li",(function(e){for(var t=e.target;"LI"!==t.tagName;)if(!(t=t.parentElement))return;const r=function(e,r){const n=i._sortable.toArray(),o=n[e];n[e]=n[r],n[r]=o,i._sortable.sort(n),g(i,_).call(i,t,e,r)},n=i.getLayerUIElements(),o=n.indexOf(t);switch(!0){case/Up$/.test(e.key):o>0&&(r(o,o-1),t.focus(),e.stopPropagation());break;case/Down$/.test(e.key):o<n.length-1&&(r(o,o+1),t.focus(),e.stopPropagation());break;case/Enter$/.test(e.key):t.blur(),e.stopPropagation()}}))),"function"==typeof e&&e()}))})):Promise.reject(Error("Cannot render: control has no map")))}async register(e){const t=this;return await super.register(e),t.options.fileEditing&&await e.addControl("fileEdit",{caller:t,snapping:!0}),e.loaded((function(){t.updateScale()})),e.on(i.Z.event.LAYEROPACITY,(function(e){const r=f(t,y,S).call(t,e.layer);r&&(r.querySelector("input[type=range]").value=Math.round(100*e.opacity))})).on(i.Z.event.FEATURESIMPORT,(function(r){var n=r.fileName;if(r.features&&r.features.length>0){var o="."+i.Z.format.GPX.toLowerCase();if(r.fileName.toLowerCase().indexOf(o)===r.fileName.length-o.length)return;e.one(i.Z.event.LAYERADD,(function(e){e&&e.layer&&e.layer.title===n&&(t.highlight(),t.map.trigger(i.Z.event.TOOLSOPEN))}))}})),t}onExternalServiceAdded(e){}addUIEventListeners(){const e=this;e.div.addEventListener("change",n.Z.EventTarget.listenerBySelector(`sitna-toggle.${e.CLASS}-cb-visibility`,(function(t){const r=t.target;var n=r;do{n=n.parentElement}while(n&&!n.matches("li."+e.CLASS+"-elm"));e.map.getLayer(n.dataset.layerId).setVisibility(r.checked),t.stopPropagation()})));const t=function(t){const r=t.target;var n=r;do{n=n.parentElement}while(n&&"LI"!==n.tagName);e.map.getLayer(n.dataset.layerId).setOpacity(r.value/100)};e.div.addEventListener("change",n.Z.EventTarget.listenerBySelector("input[type=range]",t)),e.div.addEventListener("input",n.Z.EventTarget.listenerBySelector("input[type=range]",t)),e.div.addEventListener("change",n.Z.EventTarget.listenerBySelector(`.${e.CLASS}-cb-info`,(function(t){const r=t.target;var n=r;do{n=n.parentElement}while(n&&"LI"!==n.tagName);const o=n.querySelector("."+e.CLASS+"-info"),a=e.map.getLayer(n.dataset.layerId);o.querySelectorAll("."+e.CLASS+"-legend img").forEach((function(t){e.styleLegendImage(t,a)})),o.classList.toggle(i.Z.classes.HIDDEN,!r.checked)}))),e.div.addEventListener(e.CLICKEVENT,n.Z.EventTarget.listenerBySelector(`.${e.CLASS}-btn-del:not(:disabled)`,(function(t){var r=t.target;do{r=r.parentElement}while(r&&"LI"!==r.tagName);const n=e.map.getLayer(r.dataset.layerId);e.map.removeLayer(n)}))),e.div.addEventListener(e.CLICKEVENT,n.Z.EventTarget.listenerBySelector("."+e.CLASS+"-del-all",(function(t){n.Z.confirm(e.getLocaleString("layersRemove.confirm"),(function(){e.getLayerUIElements().map((function(t){return e.map.getLayer(t.dataset.layerId)})).forEach((function(t){e.map.removeLayer(t)}))})),t.stopPropagation()}))),e.div.addEventListener(e.CLICKEVENT,n.Z.EventTarget.listenerBySelector(`.${e.CLASS}-btn-more`,(function(t){const r=t.target,n=r.parentElement.classList.toggle("tc-expanded");r.text=e.getLocaleString(n?"collapse":"otherTools"),r.iconText=n?"":""})))}updateLayerVisibility(e){const t=this,r=f(t,y,S).call(t,e);if(r){const n=e.getVisibility();r.querySelector(`sitna-toggle.${t.CLASS}-cb-visibility`).checked=n}}updateLayerTree(e){const t=this;if(!e.isBase&&!e.options.stealth){s.default.prototype.updateLayerTree.call(t,e);for(var r=!1,o=0,a=t.layers.length;o<a;o++)if(e===t.layers[o]){r=!0;break}if(r){var l;let r=e.title||e.wrap.getServiceTitle&&e.wrap.getServiceTitle();const n=function(){return new RegExp(e.id.replace(/([\w]*-\d)(-\d)*/gi,"$1-\\d"),"gi")},i=t.layers.filter((t=>t.title===e.title)).reduce(((e,t)=>{const r=n().exec(t.id)?n().exec(t.id)[0]:t.id;return e.indexOf(r)>=0?e:e.concat(r)}),[]).findIndex((t=>{const r=/^[\w]*-\d-\d/gi.exec(e.id);return t===(r?r[0]:e.id)}));i>0&&(e._title=r=r+" ("+(i+1)+")");const o=t.div.querySelector("ul li[data-layer-id='"+e.id+"']");if(null!==(l=e.features)&&void 0!==l&&l.length)if(e.features.some((e=>e.getPath().length))){o.querySelector(".tc-ctl-wlm-lyr").innerHTML=r,o.querySelector(".tc-ctl-wlm-lyr").title=r;const t=[...new Set(e.features.map((e=>e.getPath().join(" &rsaquo; "))))];o.querySelector(".tc-ctl-wlm-path").innerHTML=t.join(" &bull; ")}else o.querySelector(".tc-ctl-wlm-path").innerHTML=r,o.querySelector(".tc-ctl-wlm-path").title=r}else{t.layers.push(e);const r=e.title||e.wrap.getServiceTitle&&e.wrap.getServiceTitle();e._title=r;var c={title:e.hideTitle?"":r,hide:!(!e.renderOptions||!e.renderOptions.hide),opacity:e.renderOptions&&e.renderOptions.opacity?100*e.renderOptions.opacity:100,customLegend:e.customLegend,unremovable:e.unremovable,id:e.id},u=e.isRaster();if(u){c.hasExtent=!!e.getExtent(),c.layerNames=e.layerNames;const t=e.names.map((t=>e.getPath(t)));t.forEach((e=>e.shift())),c.path=t,c.legend=[],c.abstract=[],c.metadata=[],e.names.forEach((function(t){var r=e.getInfo(t);r.legend&&c.legend.push(r.legend),r.abstract&&c.abstract.push(r.abstract),r.metadata&&c.metadata.push(r.metadata)}));const r=e.getInfo();c.hasInfo=Object.prototype.hasOwnProperty.call(r,"abstract")||Object.prototype.hasOwnProperty.call(r,"legend")||Object.prototype.hasOwnProperty.call(r,"metadata")}else c.hasExtent=!0,c.hasInfo=!1;(async function(e){if(e&&e.options.method&&"POST"===e.options.method)try{return await e.getLegendGraphicImage()}catch(e){n.Z.error(e)}})(e).then((function(r){t.getRenderedHtml(t.CLASS+"-elm",c).then((function(r){const n=(new DOMParser).parseFromString(r,"text/html").body.firstChild;var o,a,s=!1;if(u&&!(s=e.names.length>1)){const t=e.names[0],r=e.wrap.getAllLayerNodes();for(a=0;a<r.length;a++){var l=r[a];if(e.wrap.getName(l)===t){o=l,e.wrap.getLayerNodes(l).length>0&&(s=!0);break}}}const c=n.querySelector("."+t.CLASS+"-type"),p=s?t.CLASS+"-type-grp":t.CLASS+"-type-sgl";c.classList.add(p);const h=n.querySelector(`.${t.CLASS}-btn-zoom`);h&&h.addEventListener(i.Z.event.CLICK,(function(e){t.map.zoomToLayer(n.dataset.layerId,{animate:!0})}),{passive:!0}),o&&(e.wrap.normalizeLayerNode(o),t.getRenderedHtml(p,o).then((function(e){var r;c.addEventListener("mouseover",(function(n){const i=t.map.div,o=c.getBoundingClientRect();(r=document.createElement("div")).classList.add(t.CLASS+"-tip"),r.innerHTML=e,r.style.top=o.top-i.offsetTop+"px",r.style.right=i.offsetWidth-(o.left-i.offsetLeft)+"px",i.appendChild(r)})),c.addEventListener("mouseout",(function(e){r.parentElement.removeChild(r)}))})));const d=t.div.querySelector("ul");n.dataset.layerId=e.id;const f=t.getLayerUIElements(),g=t.map.workLayers.filter((function(e){return!e.stealth})),y=g.indexOf(e);t.getItemTools().forEach((e=>t.addItemToolUI(n,e)));var m=!1;for(a=0;a<f.length;a++){const e=f[a];if(g.indexOf(t.map.getLayer(e.dataset.layerId))<y){e.insertAdjacentElement("beforebegin",n),m=!0;break}}m||d.appendChild(n),t.updateScale()}))}));var p=f(t,v,E).call(t);const o=t.div.querySelector("."+t.CLASS+"-n"),a=t.div.querySelector("."+t.CLASS+"-empty"),s=t.div.querySelector("."+t.CLASS+"-content");o.textContent=p,p>0?(o.classList.add(i.Z.classes.VISIBLE),a.classList.add(i.Z.classes.HIDDEN),s.classList.remove(i.Z.classes.HIDDEN)):(o.classList.remove(i.Z.classes.VISIBLE),a.classList.remove(i.Z.classes.HIDDEN),s.classList.add(i.Z.classes.HIDDEN));t.div.querySelector("."+t.CLASS+"-del-all").classList.toggle(i.Z.classes.HIDDEN,!g(t,m).call(t))}}}updateScale(){const e=this;e.getLayerUIElements().forEach((function(t){var r=e.map.getLayer(t.dataset.layerId);if(r&&r.names){for(var n=!1,i=0;i<r.names.length;i++)if(r.isVisibleByScale(r.names[i])){n=!0;break}t.classList.toggle(e.CLASS+"-elm-notvisible",!n)}}))}update(){const e=this;e.getLayerUIElements().forEach((function(t){const r=e.map.getLayer(t.dataset.layerId);r&&(t.querySelector(`sitna-toggle.${e.CLASS}-cb-visibility`).checked=r.getVisibility(),r.tree=null)})),e.updateScale()}updateLayerOrder(e,t,r){const n=this;n.map.workLayers.filter((function(e){return!e.stealth})).forEach((function(e){const t=f(n,y,S).call(n,e);t&&t.parentElement.firstChild.insertAdjacentElement("beforebegin",t)}))}removeLayer(e){const t=this,r=t.layers.indexOf(e);r>=0&&t.layers.splice(r,1),t.getLayerUIElements().forEach((function(t){t.dataset.layerId===e.id&&t.parentElement.removeChild(t)}));const n=t.div.querySelector("."+t.CLASS+"-content"),o=t.div.querySelector("."+t.CLASS+"-empty"),a=t.div.querySelector("."+t.CLASS+"-n");var s=f(t,v,E).call(t);a.textContent=s,s>0?(n.classList.remove(i.Z.classes.HIDDEN),o.classList.add(i.Z.classes.HIDDEN),a.classList.add(i.Z.classes.VISIBLE)):(g(t,m).call(t)&&t.div.querySelector("."+t.CLASS+"-del-all").classList.add(i.Z.classes.HIDDEN),n.classList.add(i.Z.classes.HIDDEN),o.classList.remove(i.Z.classes.HIDDEN),a.classList.remove(i.Z.classes.VISIBLE))}getLayerUIElements(){return Array.from(this.div.querySelectorAll(`ul > li.${this.CLASS}-elm`))}}function S(e){this.getLayerUIElements().find((t=>t.dataset.layerId===e.id))}function E(){return this.layers.length}n.Z.mix(w,c.default),n.Z.control.WorkLayerManager=w;const b=w},7167:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var n=r(688),i=r(268),o=r(330);n.Z.Util=i.Z,n.Z.control=n.Z.control||{},n.Z.control.infoShare={getDiv:function(e){return e||this._dialogDiv},getShareDialog:async function(e){const t=this,r=t.getDiv(e);return t._shareCtl||(t._shareCtl=await t.map.addControl("share",{id:t.getUID(),div:r.querySelector(".tc-modal-body ."+t.CLASS+"-share-dialog-ctl"),includeControls:!1}),t._shareCtl.caller=t,t._shareCtl.extraParams=null),t._shareCtl},onShowShareDialog:async function(){const e=this;e.toShare=e.toShare||{},e.toShare.doZoom=!0,e.map.trigger(o.Z.event.MAPCHANGE);const t=e._shareCtl,r=t.div,n=await t.generateLink(),i=r.querySelector(".tc-url input[type=text]");i.value=n,delete i.dataset.update,delete i.dataset.shortened,r.querySelector(".tc-iframe input[type=text]").value=await t.generateIframe(n)},showShareDialog:function(e){const t=this,r=t.getDiv(e).querySelector("."+t.CLASS+"-share-dialog");n.Z.Util.showModal(r,{openCallback:function(){t.onShowShareDialog(r).then((function(){t.map.trigger(o.Z.event.DIALOG,{control:t._shareCtl,action:"share"})}))},closeCallback:function(){t.onCloseShareDialog()}})},onCloseShareDialog:function(){const e=this;e.toShare=e.toShare||{},e.toShare.doZoom=!1,e.map.trigger(o.Z.event.MAPCHANGE)}};const a=n.Z.control.infoShare},5198:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(688),i=r(268),o=r(330),a=r(4109);n.Z.Util=i.Z,n.Z.control=n.Z.control||{};const s={_uiElementSelector:"ul > li",_toolContainerSelector:".tc-item-tools",isItemToolContainer:!0,getItemTools:function(){const e=this;return e.itemTools||(e.itemTools=[]),e.itemTools},getItemUIElements:function(e){const t=this;return e&&(t._uiElementSelector=e),Array.from(t.div.querySelectorAll(t._uiElementSelector))},getToolContainer:function(e){return e.querySelector(this._toolContainerSelector)},addItemToolUI:function(e,t){const r=this;if(i.Z.isFunction(t.renderFn)){const n=r.getToolContainer(e),s=t.renderFn(n,e.dataset.layerId);if(s){const e=n.querySelector(".tc-item-tool-last");if(e?e.insertAdjacentElement("beforebegin",s):n.appendChild(s),i.Z.isFunction(t.actionFn)){const e=s instanceof a.Z?"change":o.Z.event.CLICK;s.addEventListener(e,(function(e){t.actionFn.call(s)}),{passive:!0})}i.Z.isFunction(t.updateFn)&&t.updateEvents&&r.map.on(t.updateEvents.join(" "),(function(e){e.layer&&e.layer.id!==s.dataset.layerId||t.updateFn.call(s,e)}))}}},addItemTool:function(e){const t=this;t.getItemTools().push(e),t.getItemUIElements().forEach((function(r){t.addItemToolUI(r,e)}))}};n.Z.control.itemToolContainer=s;const l=s},2416:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var n=r(688),i=r(330);const o={getLayers:function(){const e=this;return e.layers||(e.layers=[]),e.layers},registerLayerAdd:function(){const e=this;e.map.on(i.Z.event.LAYERADD,(function(t){const r=e.getIdCount(t.layer.id);r&&(n.Z.setUIDStart(r+1,{prefix:e.id+"-"}),t.layer.owner=e)}))},getIdCount:function(e){const t=new RegExp(`^${this.id}(-(\\d+))*$`),r=e.match(t);return r?parseInt(r[1]):0}}},5394:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o});var n=r(688);n.Z.filter={},n.Z.filter.Operators=["PropertyIsEqualTo","PropertyIsGreaterThan","PropertyIsGreaterThanOrEqualTo","PropertyIsLessThan","PropertyIsLessThanOrEqualTo","PropertyIsNotEqualTo","PropertyIsLike","PropertyIsNull","PropertyIsBetween","Within","Intersects","Bbox"],n.Z.filter.Filter=function(e){this.tagName_=e,this._defaultNSURL="http://www.opengis.net/ogc",this._defaultPrefixNS=this._wfsPrefixNS="ogc",this._fieldTitle="PropertyName",this._defaultNSURL=this._wfsNSURL="http://www.opengis.net/ogc",this._wfs2prefixNS="fes",this._wfs2NSURL="http://www.opengis.net/fes/2.0",this._wfs2FieldTitle="ValueReference",this._escapeAttrName="escape",this._wfs2EscapeAttrName="escapeChar"},n.Z.filter.Filter.prototype.getTagName=function(){return this.tagName_},n.Z.filter.Filter.prototype.setTagName=function(e){return this.tagName_},n.Z.filter.Filter.prototype.writeFilterCondition_=function(){return'<{prefix}:Filter xmlns:{prefix}="{NSURL}" xmlns:gml="http://www.opengis.net/gml{gmlversion}">{inner}</{prefix}:Filter>'.format({prefix:this._defaultPrefixNS,NSURL:this._defaultNSURL,tag:this.getTagName(),inner:this.writeInnerCondition_(this),gmlVersion:this._defaultNSURL===this._wfs2NSURL?"/3.2":""})},n.Z.filter.Filter.prototype.writeInnerCondition_=function(e){return e!=this&&(e._defaultNSURL=this._defaultNSURL,e._defaultPrefixNS=this._defaultPrefixNS,e._fieldTitle=this._fieldTitle),e instanceof n.Z.filter.LogicalNary||e instanceof n.Z.filter.ComparisonBinary||e instanceof n.Z.filter.Comparison||e instanceof n.Z.filter.Spatial||n.Z.filter.Function,e.write()},n.Z.filter.Filter.prototype.writeInnerArrayCondition_=function(e){const t=this;return t.conditions.reduce((function(e,r,i){return(e instanceof n.Z.filter.Filter?t.writeInnerCondition_(e):e)+t.writeInnerCondition_(r)}))},n.Z.filter.Filter.prototype.getText=function(e){return e&&parseFloat(e,10)>=2&&(this._defaultPrefixNS=this._wfs2prefixNS,this._defaultNSURL=this._wfs2NSURL,this._fieldTitle=this._wfs2FieldTitle,this._escapeAttrName=this._wfs2EscapeAttrName),this.writeFilterCondition_()},n.Z.filter.Filter.prototype.readText=function(e){return e.indexOf(this._wfs2prefixNS)>-1&&e.indexOf(this._wfs2NSURL)>-1&&e.indexOf(this._wfs2FieldTitle)>-1&&e.indexOf(this._wfs2EscapeAttrName)>-1&&(this._defaultPrefixNS=this._wfs2prefixNS,this._defaultNSURL=this._wfs2NSURL,this._fieldTitle=this._wfs2FieldTitle,this._escapeAttrName=this._wfs2EscapeAttrName),this.readFilterCondition_(e)},n.Z.filter.Filter.prototype.readFilterCondition_=function(e){return this.setTagName(e),this.readInnerCondition_(e)},n.Z.filter.Filter.prototype.readInnerCondition_=function(e){return i.read(e)},n.Z.filter.and=function(e){var t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(n.Z.filter.And,t))},n.Z.filter.or=function(e){var t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(n.Z.filter.Or,t))},n.Z.filter.not=function(e){return new n.Z.filter.Not(e)},n.Z.filter.intersects=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new n.Z.filter.Intersects(null,arguments[0],arguments[1]):new n.Z.filter.Intersects(arguments[0],arguments[1],arguments[2])},n.Z.filter.within=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new n.Z.filter.Within(null,arguments[0],arguments[1]):new n.Z.filter.Within(arguments[0],arguments[1],arguments[2])},n.Z.filter.equalTo=function(e,t,r){return new n.Z.filter.EqualTo(e,t,r)},n.Z.filter.notEqualTo=function(e,t,r){return new n.Z.filter.NotEqualTo(e,t,r)},n.Z.filter.lessThan=function(e,t){return new n.Z.filter.LessThan(e,t)},n.Z.filter.lessThanOrEqualTo=function(e,t){return new n.Z.filter.LessThanOrEqualTo(e,t)},n.Z.filter.greaterThan=function(e,t){return new n.Z.filter.GreaterThan(e,t)},n.Z.filter.greaterThanOrEqualTo=function(e,t){return new n.Z.filter.GreaterThanOrEqualTo(e,t)},n.Z.filter.isNull=function(e){return new n.Z.filter.IsNull(e)},n.Z.filter.between=function(e,t,r){return new n.Z.filter.IsBetween(e,t,r)},n.Z.filter.function=function(e,t){return new n.Z.filter.Function(e,t)},n.Z.filter.like=function(e,t,r,i,o,a){return new n.Z.filter.IsLike(e,t,r,i,o,a)},n.Z.filter.LogicalNary=function(e,t){n.Z.filter.Filter.call(this,e),this.conditions=Array.prototype.slice.call(arguments,1)},n.Z.inherit(n.Z.filter.LogicalNary,n.Z.filter.Filter),n.Z.filter.And=function(e){var t=["And"].concat(Array.prototype.slice.call(arguments));n.Z.filter.LogicalNary.apply(this,t)},n.Z.inherit(n.Z.filter.And,n.Z.filter.LogicalNary),n.Z.filter.Or=function(e){var t=["Or"].concat(Array.prototype.slice.call(arguments));n.Z.filter.LogicalNary.apply(this,t)},n.Z.inherit(n.Z.filter.Or,n.Z.filter.LogicalNary),n.Z.filter.LogicalNary.prototype.write=function(){return"<{prefix}:{tag}>{inner}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:this.writeInnerArrayCondition_()})},n.Z.filter.Not=function(e){this.condition=e,n.Z.filter.Filter.call(this,"Not")},n.Z.inherit(n.Z.filter.Not,n.Z.filter.Filter),n.Z.filter.Filter.prototype.write=function(){return"<{prefix}:{tag}>{inner}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:this.writeInnerCondition_(this.condition)})},n.Z.filter.Comparison=function(e,t){n.Z.filter.Filter.call(this,e),this.propertyName=t},n.Z.inherit(n.Z.filter.Comparison,n.Z.filter.Filter),n.Z.filter.Comparison.prototype.write=function(){var e="";return this.LowerBoundary&&this.UpperBoundary&&(e="<{prefix}:LowerBoundary><{prefix}:Literal>{LowerBoundary}</{prefix}:Literal></{prefix}:LowerBoundary><{prefix}:UpperBoundary><{prefix}:Literal>{UpperBoundary}</{prefix}:Literal></{prefix}:UpperBoundary>".format({prefix:this._defaultPrefixNS,LowerBoundary:this.LowerBoundary,UpperBoundary:this.UpperBoundary})),this.pattern&&(e="<{prefix}:Literal><![CDATA[{Pattern}]]></{prefix}:Literal>".format({prefix:this._defaultPrefixNS,Pattern:this.pattern})),this.params&&(e=Array.isArray(this.params)?this.params.reduce((function(e,t,r){var n=function(e){return"<{prefix}:Literal><![CDATA[{value}]]></{prefix}:Literal>".format({prefix:this._defaultPrefixNS,value:e})};return(r>0?e:n(e))+n(t)})):"<{prefix}:Literal><![CDATA[{value}]]></{prefix}:Literal>".format({prefix:this._defaultPrefixNS,value:this.params})),"<{prefix}:{tag}{matchCase}{escape}{singleChar}{wildCard}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{values}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),matchCase:void 0!==this.matchCase?' matchCase="'+this.matchCase+'"':"",escape:void 0!==this.escapeChar?" "+this._escapeAttrName+'="'+this.escapeChar+'"':"",singleChar:void 0!==this.singleChar?' singleChar="'+this.singleChar+'"':"",wildCard:void 0!==this.wildCard?' wildCard="'+this.wildCard+'"':"",name:this.propertyName,values:e,fieldTitle:this._fieldTitle})},n.Z.filter.ComparisonBinary=function(e,t,r,i){n.Z.filter.Comparison.call(this,e,t),this.expression=r,this.matchCase=i},n.Z.inherit(n.Z.filter.ComparisonBinary,n.Z.filter.Comparison),n.Z.filter.ComparisonBinary.prototype.write=function(){return("<{prefix}:{tag}{matchCase}>"+(this.propertyName instanceof n.Z.filter.Filter?"{name}":"<{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>")+"<{prefix}:Literal><![CDATA[{value}]]></{prefix}:Literal></{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),matchCase:void 0!==this.matchCase?' matchCase="'+this.matchCase+'"':"",name:this.propertyName instanceof n.Z.filter.Filter?this.propertyName.write():this.propertyName,value:this.expression,fieldTitle:this._fieldTitle})},n.Z.filter.EqualTo=function(e,t,r){n.Z.filter.ComparisonBinary.call(this,"PropertyIsEqualTo",e,t,r)},n.Z.inherit(n.Z.filter.EqualTo,n.Z.filter.ComparisonBinary),n.Z.filter.GreaterThan=function(e,t){n.Z.filter.ComparisonBinary.call(this,"PropertyIsGreaterThan",e,t)},n.Z.inherit(n.Z.filter.GreaterThan,n.Z.filter.ComparisonBinary),n.Z.filter.GreaterThanOrEqualTo=function(e,t){n.Z.filter.ComparisonBinary.call(this,"PropertyIsGreaterThanOrEqualTo",e,t)},n.Z.inherit(n.Z.filter.GreaterThanOrEqualTo,n.Z.filter.ComparisonBinary),n.Z.filter.LessThan=function(e,t){n.Z.filter.ComparisonBinary.call(this,"PropertyIsLessThan",e,t)},n.Z.inherit(n.Z.filter.LessThan,n.Z.filter.ComparisonBinary),n.Z.filter.LessThanOrEqualTo=function(e,t){n.Z.filter.ComparisonBinary.call(this,"PropertyIsLessThanOrEqualTo",e,t)},n.Z.inherit(n.Z.filter.LessThanOrEqualTo,n.Z.filter.ComparisonBinary),n.Z.filter.NotEqualTo=function(e,t,r){n.Z.filter.ComparisonBinary.call(this,"PropertyIsNotEqualTo",e,t,r)},n.Z.inherit(n.Z.filter.NotEqualTo,n.Z.filter.ComparisonBinary),n.Z.filter.IsLike=function(e,t,r,i,o,a){n.Z.filter.Comparison.call(this,"PropertyIsLike",e),this.pattern=t,this.wildCard=void 0!==r?r:"*",this.singleChar=void 0!==i?i:".",this.escapeChar=void 0!==o?o:"!",this.matchCase=a},n.Z.inherit(n.Z.filter.IsLike,n.Z.filter.Comparison),n.Z.filter.IsNull=function(e){n.Z.filter.Comparison.call(this,"PropertyIsNull",e)},n.Z.inherit(n.Z.filter.IsNull,n.Z.filter.Comparison),n.Z.filter.IsBetween=function(e,t,r){n.Z.filter.Comparison.call(this,"PropertyIsBetween",e),this.LowerBoundary=t,this.UpperBoundary=r},n.Z.inherit(n.Z.filter.IsBetween,n.Z.filter.Comparison),n.Z.filter.Function=function(e,t){n.Z.filter.Filter.call(this,e),this.params=t},n.Z.inherit(n.Z.filter.Function,n.Z.filter.Filter),n.Z.filter.Filter.fromText=function(e){var t=e=>{var r,o;const a=e.tagName.substring(e.tagName.indexOf(":")+1);var s;switch(a){case"PropertyIsEqualTo":s=new n.Z.filter.EqualTo;break;case"PropertyIsGreaterThan":s=new n.Z.filter.GreaterThan;break;case"PropertyIsGreaterThanOrEqualTo":s=new n.Z.filter.GreaterThanOrEqualTo;break;case"PropertyIsLessThan":s=new n.Z.filter.LessThan;break;case"PropertyIsLessThanOrEqualTo":s=new n.Z.filter.LessThanOrEqualTo;break;case"PropertyIsNotEqualTo":s=new n.Z.filter.NotEqualTo;break;case"PropertyIsLike":s=new n.Z.filter.IsLike;break;case"PropertyIsNull":s=new n.Z.filter.IsNull;break;case"PropertyIsBetween":s=new n.Z.filter.IsBetween;break;default:s=new n.Z.filter[a]}const l=null===(r=e.querySelector(s._fieldTitle+","+s._wfs2FieldTitle))||void 0===r?void 0:r.innerHTML,c=null===(o=e.querySelector("Literal"))||void 0===o?void 0:o.innerHTML;var u,p;(s._defaultNSURL=e.tagName.substring(0,i.indexOf(":")),l&&(s.propertyName=l),s instanceof n.Z.filter.IsLike&&(s.pattern=c),s instanceof n.Z.filter.IsBetween)&&(s.LowerBoundary=null===(u=e.querySelector("LowerBoundary > Literal"))||void 0===u?void 0:u.innerHTML,s.UpperBoundary=null===(p=e.querySelector("UpperBoundary > Literal"))||void 0===p?void 0:p.innerHTML);if(s instanceof n.Z.filter.ComparisonBinary&&(s.expression=c),s instanceof n.Z.filter.Spatial){const t=e.childNodes[1].textContent.split(" ").reduce(((e,t,r,n)=>(r%2==1&&e.push([parseFloat(n[r-1]),parseFloat(t)]),e)),[]);switch(e.childNodes[1].tagName.substr(4)){case"Polygon":s.geometry=new SITNA.feature.Polygon(t);break;case"LineString":s.geometry=new SITNA.feature.Polyline(t)}}return s.conditions=Array.from(e.childNodes).filter((e=>n.Z.filter.Operators.includes(e.tagName.substring(e.tagName.indexOf(":")+1)))).reduce((function(e,r){return e.push(t(r)),e}),[]),s},r=(new DOMParser).parseFromString(e,"application/xml");const i=r.firstElementChild.firstElementChild.tagName;return t(r.firstElementChild.firstElementChild)},n.Z.filter.Function.prototype.write=function(){var e="";if(this.params){var t=function(e,t){if("string"==typeof e)return"<{prefix}:Literal><![CDATA[{value}]]></{prefix}:Literal>".format({prefix:t,value:e});if("object"==typeof e){var r="";for(var n in e)r+="<{prefix}:{key}>{value}</{prefix}:{key}>".format({prefix:t,value:e[n],key:n});return r}};if(Array.isArray(this.params)){var r=this._defaultPrefixNS;e=this.params.reduce((function(e,n,i){var o=function(e){return t(e,r)};return(i>1?e:o(e))+o(n)}))}else e=t(this.params,this._defaultPrefixNS)}return'<{prefix}:Function name="{tag}">{inner}</{prefix}:Function>'.format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:e})},n.Z.filter.Spatial=function(e,t,r,i){n.Z.filter.Filter.call(this,e),this.geometryName=t,this.geometry=r,this.srsName=i,this.wrap=new n.Z.wrap.Filter(this)},n.Z.wrap.Filter=function(e){this.parent=e},n.Z.wrap.Filter.prototype.getAxisOrientation=function(){var e=this.parent.srsName;if(e){const t=e.match(/\d{4,6}$/);if(t){const r=t[0],n=ol.proj.get(e);if(n)return("neu"===n.axisOrientation_?"urn:x-ogc:def:crs:EPSG:":"EPSG:")+r}}return e},n.Z.inherit(n.Z.filter.Spatial,n.Z.filter.Filter),n.Z.filter.Spatial.prototype.write=function(){return(this.geometryName?"<{prefix}:{tag}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{geometry}</{prefix}:{tag}>":"<{prefix}:{tag}><{prefix}:{fieldTitle}/>{geometry}</{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),name:this.geometryName,geometry:this.geometry instanceof n.Z.filter.Function?this.writeInnerCondition_(this.geometry):this.geometry.wrap.toGML(void 0,this.wrap.getAxisOrientation()),fieldTitle:this._fieldTitle})},n.Z.filter.bbox=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new n.Z.filter.Bbox(null,arguments[0],arguments[1]):new n.Z.filter.Bbox(arguments[0],arguments[1],arguments[2])},n.Z.filter.Bbox=function(e,t,r){n.Z.filter.Filter.call(this,"BBOX"),this.geometryName=e,this.extent=t,this.srsName=r},n.Z.inherit(n.Z.filter.Bbox,n.Z.filter.Spatial),n.Z.filter.Bbox.prototype.write=function(){var e="<gml:Envelope{srsName}><gml:lowerCorner>{lowerCorner}</gml:lowerCorner><gml:upperCorner>{upperCorner}</gml:upperCorner></gml:Envelope>".format({srsName:void 0!==this.srsName?' srsName="'+this.srsName+'"':"",lowerCorner:this.extent[0]+" "+this.extent[1],upperCorner:this.extent[2]+" "+this.extent[3]});return(this.geometryName?"<{prefix}:{tag}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{BBOX}</{prefix}:{tag}>":"<{prefix}:{tag}><{prefix}:{fieldTitle}/>{BBOX}</{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),fieldTitle:this._fieldTitle,name:this.geometryName,BBOX:e})},n.Z.filter.Intersects=function(e,t,r){n.Z.filter.Spatial.call(this,"Intersects",e,t,r)},n.Z.inherit(n.Z.filter.Intersects,n.Z.filter.Spatial),n.Z.filter.Within=function(e,t,r){n.Z.filter.Spatial.call(this,"Within",e,t,r)},n.Z.inherit(n.Z.filter.Within,n.Z.filter.Spatial);const i=n.Z.filter,o=i},3089:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var n=r(688),i=r(330);const o={loadResources:async function(e,t,r){if(e){const e=(await n.Z.ajax({url:t+r+".json",method:"GET",responseType:i.Z.mimeType.JSON})).data;o[r]=o[r]||{},Object.assign(o[r],e),o.currentLocale=o[r],o.currentLocaleKey=r}else o.currentLocale=o[r]}},a=o},8834:(e,t,r)=>{"use strict";function n(){return function(){throw new Error("Unimplemented abstract method.")}()}r.d(t,{Z:()=>fL});var i=0;function o(e){return e.ol_uid||(e.ol_uid=String(++i))}var a="6.15.1";const s=function(){function e(){this.disposed=!1}return e.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposeInternal())},e.prototype.disposeInternal=function(){},e}();function l(e,t){return e>t?1:e<t?-1:0}function c(e,t){return e.indexOf(t)>=0}function u(e,t,r){var n=e.length;if(e[0]<=t)return 0;if(t<=e[n-1])return n-1;var i=void 0;if(r>0){for(i=1;i<n;++i)if(e[i]<t)return i-1}else if(r<0){for(i=1;i<n;++i)if(e[i]<=t)return i}else for(i=1;i<n;++i){if(e[i]==t)return i;if(e[i]<t)return"function"==typeof r?r(t,e[i-1],e[i])>0?i-1:i:e[i-1]-t<t-e[i]?i-1:i}return n-1}function p(e,t,r){for(;t<r;){var n=e[t];e[t]=e[r],e[r]=n,++t,--r}}function h(e,t){for(var r=Array.isArray(t)?t:[t],n=r.length,i=0;i<n;i++)e[e.length]=r[i]}function d(e,t){for(var r,n=e.length>>>0,i=0;i<n;i++)if(t(r=e[i],i,e))return r;return null}function f(e,t){var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function g(e,t){var r;return!e.every((function(n,i){return r=i,!t(n,i,e)}))?r:-1}function y(){return!0}function m(){return!1}function v(){}var _,w="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"",S=-1!==w.indexOf("firefox"),E=-1!==w.indexOf("safari")&&-1==w.indexOf("chrom")&&!!(w.indexOf("version/15.4")>=0||w.match(/cpu (os|iphone os) 15_4 like mac os x/)),b=-1!==w.indexOf("webkit")&&-1==w.indexOf("edge"),C=-1!==w.indexOf("macintosh"),L="undefined"!=typeof devicePixelRatio?devicePixelRatio:1,T="undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&self instanceof WorkerGlobalScope,A="undefined"!=typeof Image&&Image.prototype.decode,x=function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch(e){}return e}(),P=(_=function(e,t){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},_(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}_(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});const O=function(e){function t(t){var r=this,n="Assertion failed. See https://openlayers.org/en/"+("v"+a.split("-")[0])+"/doc/errors/#"+t+" for details.";return(r=e.call(this,n)||this).code=t,r.name="AssertionError",r.message=n,r}return P(t,e),t}(Error);function I(e,t){if(!e)throw new O(t)}var R,M=new Array(6);function D(e){return Z(e,1,0,0,1,0,0)}function N(e,t){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],l=t[0],c=t[1],u=t[2],p=t[3],h=t[4],d=t[5];return e[0]=r*l+i*c,e[1]=n*l+o*c,e[2]=r*u+i*p,e[3]=n*u+o*p,e[4]=r*h+i*d+a,e[5]=n*h+o*d+s,e}function Z(e,t,r,n,i,o,a){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=a,e}function k(e,t){var r=t[0],n=t[1];return t[0]=e[0]*r+e[2]*n+e[4],t[1]=e[1]*r+e[3]*n+e[5],t}function F(e,t,r){return N(e,Z(M,t,0,0,r,0,0))}function U(e,t,r){return N(e,Z(M,1,0,0,1,t,r))}function B(e,t,r,n,i,o,a,s){var l=Math.sin(o),c=Math.cos(o);return e[0]=n*c,e[1]=i*l,e[2]=-n*l,e[3]=i*c,e[4]=a*n*c-s*n*l+t,e[5]=a*i*l+s*i*c+r,e}function G(e,t){var r,n=(r=t)[0]*r[3]-r[1]*r[2];I(0!==n,32);var i=t[0],o=t[1],a=t[2],s=t[3],l=t[4],c=t[5];return e[0]=s/n,e[1]=-o/n,e[2]=-a/n,e[3]=i/n,e[4]=(a*c-s*l)/n,e[5]=-(i*c-o*l)/n,e}function j(e){var t="matrix("+e.join(", ")+")";if(T)return t;var r=R||(R=document.createElement("div"));return r.style.transform=t,r.style.transform}const W=0,H=1,q=2,V=4,z=8,Y=16;function K(e){for(var t=ne(),r=0,n=e.length;r<n;++r)ue(t,e[r]);return t}function X(e,t,r){return r?(r[0]=e[0]-t,r[1]=e[1]-t,r[2]=e[2]+t,r[3]=e[3]+t,r):[e[0]-t,e[1]-t,e[2]+t,e[3]+t]}function $(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e.slice()}function J(e,t,r){var n,i;return(n=t<e[0]?e[0]-t:e[2]<t?t-e[2]:0)*n+(i=r<e[1]?e[1]-r:e[3]<r?r-e[3]:0)*i}function Q(e,t){return te(e,t[0],t[1])}function ee(e,t){return e[0]<=t[0]&&t[2]<=e[2]&&e[1]<=t[1]&&t[3]<=e[3]}function te(e,t,r){return e[0]<=t&&t<=e[2]&&e[1]<=r&&r<=e[3]}function re(e,t){var r=e[0],n=e[1],i=e[2],o=e[3],a=t[0],s=t[1],l=W;return a<r?l|=Y:a>i&&(l|=V),s<n?l|=z:s>o&&(l|=q),l===W&&(l=H),l}function ne(){return[1/0,1/0,-1/0,-1/0]}function ie(e,t,r,n,i){return i?(i[0]=e,i[1]=t,i[2]=r,i[3]=n,i):[e,t,r,n]}function oe(e){return ie(1/0,1/0,-1/0,-1/0,e)}function ae(e,t){var r=e[0],n=e[1];return ie(r,n,r,n,t)}function se(e,t,r,n,i){return pe(oe(i),e,t,r,n)}function le(e,t){return e[0]==t[0]&&e[2]==t[2]&&e[1]==t[1]&&e[3]==t[3]}function ce(e,t){return t[0]<e[0]&&(e[0]=t[0]),t[2]>e[2]&&(e[2]=t[2]),t[1]<e[1]&&(e[1]=t[1]),t[3]>e[3]&&(e[3]=t[3]),e}function ue(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function pe(e,t,r,n,i){for(;r<n;r+=i)he(e,t[r],t[r+1]);return e}function he(e,t,r){e[0]=Math.min(e[0],t),e[1]=Math.min(e[1],r),e[2]=Math.max(e[2],t),e[3]=Math.max(e[3],r)}function de(e,t){var r;return(r=t(ge(e)))||(r=t(ye(e)))||(r=t(Ce(e)))?r:(r=t(be(e)))||!1}function fe(e){var t=0;return Ae(e)||(t=Le(e)*Se(e)),t}function ge(e){return[e[0],e[1]]}function ye(e){return[e[2],e[1]]}function me(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2]}function ve(e,t){var r;return"bottom-left"===t?r=ge(e):"bottom-right"===t?r=ye(e):"top-left"===t?r=be(e):"top-right"===t?r=Ce(e):I(!1,13),r}function _e(e,t,r,n,i){var o=we(e,t,r,n),a=o[0],s=o[1],l=o[2],c=o[3],u=o[4],p=o[5],h=o[6],d=o[7];return ie(Math.min(a,l,u,h),Math.min(s,c,p,d),Math.max(a,l,u,h),Math.max(s,c,p,d),i)}function we(e,t,r,n){var i=t*n[0]/2,o=t*n[1]/2,a=Math.cos(r),s=Math.sin(r),l=i*a,c=i*s,u=o*a,p=o*s,h=e[0],d=e[1];return[h-l+p,d-c-u,h-l-p,d-c+u,h+l-p,d+c+u,h+l+p,d+c-u,h-l+p,d-c-u]}function Se(e){return e[3]-e[1]}function Ee(e,t,r){var n=r||[1/0,1/0,-1/0,-1/0];return Te(e,t)?(e[0]>t[0]?n[0]=e[0]:n[0]=t[0],e[1]>t[1]?n[1]=e[1]:n[1]=t[1],e[2]<t[2]?n[2]=e[2]:n[2]=t[2],e[3]<t[3]?n[3]=e[3]:n[3]=t[3]):oe(n),n}function be(e){return[e[0],e[3]]}function Ce(e){return[e[2],e[3]]}function Le(e){return e[2]-e[0]}function Te(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]}function Ae(e){return e[2]<e[0]||e[3]<e[1]}function xe(e,t){var r=(e[2]-e[0])/2*(t-1),n=(e[3]-e[1])/2*(t-1);e[0]-=r,e[2]+=r,e[1]-=n,e[3]+=n}function Pe(e,t,r,n){var i=[];if(n>1)for(var o=e[2]-e[0],a=e[3]-e[1],s=0;s<n;++s)i.push(e[0]+o*s/n,e[1],e[2],e[1]+a*s/n,e[2]-o*s/n,e[3],e[0],e[3]-a*s/n);else i=[e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]];t(i,i,2);for(var l=[],c=[],u=(s=0,i.length);s<u;s+=2)l.push(i[s]),c.push(i[s+1]);return function(e,t,r){return ie(Math.min.apply(null,e),Math.min.apply(null,t),Math.max.apply(null,e),Math.max.apply(null,t),r)}(l,c,r)}function Oe(e,t){var r=t.getExtent(),n=me(e);if(t.canWrapX()&&(n[0]<r[0]||n[0]>=r[2])){var i=Le(r),o=Math.floor((n[0]-r[0])/i)*i;e[0]-=o,e[2]-=o}return e}function Ie(e,t,r){return Math.min(Math.max(e,t),r)}var Re=function(){var e;return e="cosh"in Math?Math.cosh:function(e){var t=Math.exp(e);return(t+1/t)/2},e}(),Me=function(){var e;return e="log2"in Math?Math.log2:function(e){return Math.log(e)*Math.LOG2E},e}();function De(e,t,r,n,i,o){var a=i-r,s=o-n;if(0!==a||0!==s){var l=((e-r)*a+(t-n)*s)/(a*a+s*s);l>1?(r=i,n=o):l>0&&(r+=a*l,n+=s*l)}return Ne(e,t,r,n)}function Ne(e,t,r,n){var i=r-e,o=n-t;return i*i+o*o}function Ze(e){return e*Math.PI/180}function ke(e,t){var r=e%t;return r*t<0?r+t:r}function Fe(e,t,r){return e+r*(t-e)}function Ue(e,t){var r=Math.pow(10,t);return Math.round(e*r)/r}function Be(e,t){return Math.round(Ue(e,t))}function Ge(e,t){return Math.floor(Ue(e,t))}function je(e,t){return Math.ceil(Ue(e,t))}var We=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,He=/^([a-z]*)$|^hsla?\(.*\)$/i;function qe(e){return"string"==typeof e?e:Xe(e)}function Ve(e){var t=document.createElement("div");if(t.style.color=e,""!==t.style.color){document.body.appendChild(t);var r=getComputedStyle(t).color;return document.body.removeChild(t),r}return""}var ze=function(){var e={},t=0;return function(r){var n;if(e.hasOwnProperty(r))n=e[r];else{if(t>=1024){var i=0;for(var o in e)0==(3&i++)&&(delete e[o],--t)}n=function(e){var t,r,n,i,o;He.exec(e)&&(e=Ve(e));if(We.exec(e)){var a=e.length-1,s=void 0;s=a<=4?1:2;var l=4===a||8===a;t=parseInt(e.substr(1+0*s,s),16),r=parseInt(e.substr(1+1*s,s),16),n=parseInt(e.substr(1+2*s,s),16),i=l?parseInt(e.substr(1+3*s,s),16):255,1==s&&(t=(t<<4)+t,r=(r<<4)+r,n=(n<<4)+n,l&&(i=(i<<4)+i)),o=[t,r,n,i/255]}else 0==e.indexOf("rgba(")?Ke(o=e.slice(5,-1).split(",").map(Number)):0==e.indexOf("rgb(")?((o=e.slice(4,-1).split(",").map(Number)).push(1),Ke(o)):I(!1,14);return o}(r),e[r]=n,++t}return n}}();function Ye(e){return Array.isArray(e)?e:ze(e)}function Ke(e){return e[0]=Ie(e[0]+.5|0,0,255),e[1]=Ie(e[1]+.5|0,0,255),e[2]=Ie(e[2]+.5|0,0,255),e[3]=Ie(e[3],0,1),e}function Xe(e){var t=e[0];t!=(0|t)&&(t=t+.5|0);var r=e[1];r!=(0|r)&&(r=r+.5|0);var n=e[2];return n!=(0|n)&&(n=n+.5|0),"rgba("+t+","+r+","+n+","+(void 0===e[3]?1:Math.round(100*e[3])/100)+")"}var $e=function(){function e(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}return e.prototype.clear=function(){this.cache_={},this.cacheSize_=0},e.prototype.canExpireCache=function(){return this.cacheSize_>this.maxCacheSize_},e.prototype.expire=function(){if(this.canExpireCache()){var e=0;for(var t in this.cache_){var r=this.cache_[t];0!=(3&e++)||r.hasListener()||(delete this.cache_[t],--this.cacheSize_)}}},e.prototype.get=function(e,t,r){var n=Je(e,t,r);return n in this.cache_?this.cache_[n]:null},e.prototype.set=function(e,t,r,n){var i=Je(e,t,r);this.cache_[i]=n,++this.cacheSize_},e.prototype.setSize=function(e){this.maxCacheSize_=e,this.expire()},e}();function Je(e,t,r){return t+":"+e+":"+(r?qe(r):"null")}var Qe=new $e;function et(e){e.stopPropagation()}const tt=function(){function e(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}return e.prototype.preventDefault=function(){this.defaultPrevented=!0},e.prototype.stopPropagation=function(){this.propagationStopped=!0},e}(),rt="propertychange";var nt="function"==typeof Object.assign?Object.assign:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),n=1,i=arguments.length;n<i;++n){var o=arguments[n];if(null!=o)for(var a in o)o.hasOwnProperty(a)&&(r[a]=o[a])}return r};function it(e){for(var t in e)delete e[t]}var ot="function"==typeof Object.values?Object.values:function(e){var t=[];for(var r in e)t.push(e[r]);return t};function at(e){var t;for(t in e)return!1;return!t}var st=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const lt=function(e){function t(t){var r=e.call(this)||this;return r.eventTarget_=t,r.pendingRemovals_=null,r.dispatching_=null,r.listeners_=null,r}return st(t,e),t.prototype.addEventListener=function(e,t){if(e&&t){var r=this.listeners_||(this.listeners_={}),n=r[e]||(r[e]=[]);-1===n.indexOf(t)&&n.push(t)}},t.prototype.dispatchEvent=function(e){var t="string"==typeof e,r=t?e:e.type,n=this.listeners_&&this.listeners_[r];if(n){var i=t?new tt(e):e;i.target||(i.target=this.eventTarget_||this);var o,a=this.dispatching_||(this.dispatching_={}),s=this.pendingRemovals_||(this.pendingRemovals_={});r in a||(a[r]=0,s[r]=0),++a[r];for(var l=0,c=n.length;l<c;++l)if(!1===(o="handleEvent"in n[l]?n[l].handleEvent(i):n[l].call(this,i))||i.propagationStopped){o=!1;break}if(0==--a[r]){var u=s[r];for(delete s[r];u--;)this.removeEventListener(r,v);delete a[r]}return o}},t.prototype.disposeInternal=function(){this.listeners_&&it(this.listeners_)},t.prototype.getListeners=function(e){return this.listeners_&&this.listeners_[e]||void 0},t.prototype.hasListener=function(e){return!!this.listeners_&&(e?e in this.listeners_:Object.keys(this.listeners_).length>0)},t.prototype.removeEventListener=function(e,t){var r=this.listeners_&&this.listeners_[e];if(r){var n=r.indexOf(t);-1!==n&&(this.pendingRemovals_&&e in this.pendingRemovals_?(r[n]=v,++this.pendingRemovals_[e]):(r.splice(n,1),0===r.length&&delete this.listeners_[e]))}},t}(s),ct={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function ut(e,t,r,n,i){if(n&&n!==e&&(r=r.bind(n)),i){var o=r;r=function(){e.removeEventListener(t,r),o.apply(this,arguments)}}var a={target:e,type:t,listener:r};return e.addEventListener(t,r),a}function pt(e,t,r,n){return ut(e,t,r,n,!0)}function ht(e){e&&e.target&&(e.target.removeEventListener(e.type,e.listener),it(e))}var dt=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ft=function(e){function t(){var t=e.call(this)||this;return t.on=t.onInternal,t.once=t.onceInternal,t.un=t.unInternal,t.revision_=0,t}return dt(t,e),t.prototype.changed=function(){++this.revision_,this.dispatchEvent(ct.CHANGE)},t.prototype.getRevision=function(){return this.revision_},t.prototype.onInternal=function(e,t){if(Array.isArray(e)){for(var r=e.length,n=new Array(r),i=0;i<r;++i)n[i]=ut(this,e[i],t);return n}return ut(this,e,t)},t.prototype.onceInternal=function(e,t){var r;if(Array.isArray(e)){var n=e.length;r=new Array(n);for(var i=0;i<n;++i)r[i]=pt(this,e[i],t)}else r=pt(this,e,t);return t.ol_key=r,r},t.prototype.unInternal=function(e,t){var r=t.ol_key;if(r)gt(r);else if(Array.isArray(e))for(var n=0,i=e.length;n<i;++n)this.removeEventListener(e[n],t);else this.removeEventListener(e,t)},t}(lt);function gt(e){if(Array.isArray(e))for(var t=0,r=e.length;t<r;++t)ht(e[t]);else ht(e)}ft.prototype.on,ft.prototype.once,ft.prototype.un;const yt=ft;var mt=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),vt=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.key=r,i.oldValue=n,i}return mt(t,e),t}(tt);const _t=function(e){function t(t){var r=e.call(this)||this;return r.on,r.once,r.un,o(r),r.values_=null,void 0!==t&&r.setProperties(t),r}return mt(t,e),t.prototype.get=function(e){var t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t},t.prototype.getKeys=function(){return this.values_&&Object.keys(this.values_)||[]},t.prototype.getProperties=function(){return this.values_&&nt({},this.values_)||{}},t.prototype.hasProperties=function(){return!!this.values_},t.prototype.notify=function(e,t){var r;r="change:".concat(e),this.hasListener(r)&&this.dispatchEvent(new vt(r,e,t)),r=rt,this.hasListener(r)&&this.dispatchEvent(new vt(r,e,t))},t.prototype.addChangeListener=function(e,t){this.addEventListener("change:".concat(e),t)},t.prototype.removeChangeListener=function(e,t){this.removeEventListener("change:".concat(e),t)},t.prototype.set=function(e,t,r){var n=this.values_||(this.values_={});if(r)n[e]=t;else{var i=n[e];n[e]=t,i!==t&&this.notify(e,i)}},t.prototype.setProperties=function(e,t){for(var r in e)this.set(r,e[r],t)},t.prototype.applyProperties=function(e){e.values_&&nt(this.values_||(this.values_={}),e.values_)},t.prototype.unset=function(e,t){if(this.values_&&e in this.values_){var r=this.values_[e];delete this.values_[e],at(this.values_)&&(this.values_=null),t||this.notify(e,r)}},t}(yt),wt="opacity",St="visible",Et="extent",bt="zIndex",Ct="maxResolution",Lt="minResolution",Tt="maxZoom",At="minZoom",xt="source",Pt="map";var Ot=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const It=function(e){function t(t){var r=e.call(this)||this;r.on,r.once,r.un,r.background_=t.background;var n=nt({},t);return"object"==typeof t.properties&&(delete n.properties,nt(n,t.properties)),n[wt]=void 0!==t.opacity?t.opacity:1,I("number"==typeof n[wt],64),n[St]=void 0===t.visible||t.visible,n[bt]=t.zIndex,n[Ct]=void 0!==t.maxResolution?t.maxResolution:1/0,n[Lt]=void 0!==t.minResolution?t.minResolution:0,n[At]=void 0!==t.minZoom?t.minZoom:-1/0,n[Tt]=void 0!==t.maxZoom?t.maxZoom:1/0,r.className_=void 0!==n.className?n.className:"ol-layer",delete n.className,r.setProperties(n),r.state_=null,r}return Ot(t,e),t.prototype.getBackground=function(){return this.background_},t.prototype.getClassName=function(){return this.className_},t.prototype.getLayerState=function(e){var t=this.state_||{layer:this,managed:void 0===e||e},r=this.getZIndex();return t.opacity=Ie(Math.round(100*this.getOpacity())/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=void 0!==r||t.managed?r:1/0,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t},t.prototype.getLayersArray=function(e){return n()},t.prototype.getLayerStatesArray=function(e){return n()},t.prototype.getExtent=function(){return this.get(Et)},t.prototype.getMaxResolution=function(){return this.get(Ct)},t.prototype.getMinResolution=function(){return this.get(Lt)},t.prototype.getMinZoom=function(){return this.get(At)},t.prototype.getMaxZoom=function(){return this.get(Tt)},t.prototype.getOpacity=function(){return this.get(wt)},t.prototype.getSourceState=function(){return n()},t.prototype.getVisible=function(){return this.get(St)},t.prototype.getZIndex=function(){return this.get(bt)},t.prototype.setBackground=function(e){this.background_=e,this.changed()},t.prototype.setExtent=function(e){this.set(Et,e)},t.prototype.setMaxResolution=function(e){this.set(Ct,e)},t.prototype.setMinResolution=function(e){this.set(Lt,e)},t.prototype.setMaxZoom=function(e){this.set(Tt,e)},t.prototype.setMinZoom=function(e){this.set(At,e)},t.prototype.setOpacity=function(e){I("number"==typeof e,64),this.set(wt,e)},t.prototype.setVisible=function(e){this.set(St,e)},t.prototype.setZIndex=function(e){this.set(bt,e)},t.prototype.disposeInternal=function(){this.state_&&(this.state_.layer=null,this.state_=null),e.prototype.disposeInternal.call(this)},t}(_t),Rt={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};var Mt=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function Dt(e,t){if(!e.visible)return!1;var r=t.resolution;if(r<e.minResolution||r>=e.maxResolution)return!1;var n=t.zoom;return n>e.minZoom&&n<=e.maxZoom}const Nt=function(e){function t(t){var r=this,n=nt({},t);delete n.source,(r=e.call(this,n)||this).on,r.once,r.un,r.mapPrecomposeKey_=null,r.mapRenderKey_=null,r.sourceChangeKey_=null,r.renderer_=null,r.rendered=!1,t.render&&(r.render=t.render),t.map&&r.setMap(t.map),r.addChangeListener(xt,r.handleSourcePropertyChange_);var i=t.source?t.source:null;return r.setSource(i),r}return Mt(t,e),t.prototype.getLayersArray=function(e){var t=e||[];return t.push(this),t},t.prototype.getLayerStatesArray=function(e){var t=e||[];return t.push(this.getLayerState()),t},t.prototype.getSource=function(){return this.get(xt)||null},t.prototype.getRenderSource=function(){return this.getSource()},t.prototype.getSourceState=function(){var e=this.getSource();return e?e.getState():"undefined"},t.prototype.handleSourceChange_=function(){this.changed()},t.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(ht(this.sourceChangeKey_),this.sourceChangeKey_=null);var e=this.getSource();e&&(this.sourceChangeKey_=ut(e,ct.CHANGE,this.handleSourceChange_,this)),this.changed()},t.prototype.getFeatures=function(e){return this.renderer_?this.renderer_.getFeatures(e):new Promise((function(e){return e([])}))},t.prototype.getData=function(e){return this.renderer_&&this.rendered?this.renderer_.getData(e):null},t.prototype.render=function(e,t){var r=this.getRenderer();if(r.prepareFrame(e))return this.rendered=!0,r.renderFrame(e,t)},t.prototype.unrender=function(){this.rendered=!1},t.prototype.setMapInternal=function(e){e||this.unrender(),this.set(Pt,e)},t.prototype.getMapInternal=function(){return this.get(Pt)},t.prototype.setMap=function(e){this.mapPrecomposeKey_&&(ht(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(ht(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=ut(e,Rt.PRECOMPOSE,(function(e){var t=e.frameState.layerStatesArray,r=this.getLayerState(!1);I(!t.some((function(e){return e.layer===r.layer})),67),t.push(r)}),this),this.mapRenderKey_=ut(this,ct.CHANGE,e.render,e),this.changed())},t.prototype.setSource=function(e){this.set(xt,e)},t.prototype.getRenderer=function(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_},t.prototype.hasRenderer=function(){return!!this.renderer_},t.prototype.createRenderer=function(){return null},t.prototype.disposeInternal=function(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),e.prototype.disposeInternal.call(this)},t}(It);function Zt(e,t){return e[0]+=+t[0],e[1]+=+t[1],e}function kt(e,t){var r=t.getRadius(),n=t.getCenter(),i=n[0],o=n[1],a=e[0]-i,s=e[1]-o;0===a&&0===s&&(a=1);var l=Math.sqrt(a*a+s*s);return[i+r*a/l,o+r*s/l]}function Ft(e,t){var r,n,i=e[0],o=e[1],a=t[0],s=t[1],l=a[0],c=a[1],u=s[0],p=s[1],h=u-l,d=p-c,f=0===h&&0===d?0:(h*(i-l)+d*(o-c))/(h*h+d*d||0);return f<=0?(r=l,n=c):f>=1?(r=u,n=p):(r=l+f*h,n=c+f*d),[r,n]}function Ut(e,t){for(var r=!0,n=e.length-1;n>=0;--n)if(e[n]!=t[n]){r=!1;break}return r}function Bt(e,t){var r=Math.cos(t),n=Math.sin(t),i=e[0]*r-e[1]*n,o=e[1]*r+e[0]*n;return e[0]=i,e[1]=o,e}function Gt(e,t){return e[0]*=t,e[1]*=t,e}function jt(e,t){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function Wt(e,t){return Math.sqrt(jt(e,t))}function Ht(e,t){if(t.canWrapX()){var r=Le(t.getExtent()),n=qt(e,t,r);n&&(e[0]-=n*r)}return e}function qt(e,t,r){var n=t.getExtent(),i=0;if(t.canWrapX()&&(e[0]<n[0]||e[0]>n[2])){var o=r||Le(n);i=Math.floor((e[0]-n[0])/o)}return i}var Vt=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),zt=function(e){function t(t){var r=e.call(this)||this;return r.map_=t,r}return Vt(t,e),t.prototype.dispatchRenderEvent=function(e,t){n()},t.prototype.calculateMatrices2D=function(e){var t=e.viewState,r=e.coordinateToPixelTransform,n=e.pixelToCoordinateTransform;B(r,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),G(n,r)},t.prototype.forEachFeatureAtCoordinate=function(e,t,r,n,i,o,a,s){var l,c=t.viewState;function u(e,t,r,n){return i.call(o,t,e?r:null,n)}var p=c.projection,h=Ht(e.slice(),p),d=[[0,0]];if(p.canWrapX()&&n){var f=Le(p.getExtent());d.push([-f,0],[f,0])}for(var g=t.layerStatesArray,y=g.length,m=[],v=[],_=0;_<d.length;_++)for(var w=y-1;w>=0;--w){var S=g[w],E=S.layer;if(E.hasRenderer()&&Dt(S,c)&&a.call(s,E)){var b=E.getRenderer(),C=E.getSource();if(b&&C){var L=C.getWrapX()?h:e,T=u.bind(null,S.managed);v[0]=L[0]+d[_][0],v[1]=L[1]+d[_][1],l=b.forEachFeatureAtCoordinate(v,t,r,T,m)}if(l)return l}}if(0!==m.length){var A=1/m.length;return m.forEach((function(e,t){return e.distanceSq+=t*A})),m.sort((function(e,t){return e.distanceSq-t.distanceSq})),m.some((function(e){return l=e.callback(e.feature,e.layer,e.geometry)})),l}},t.prototype.forEachLayerAtPixel=function(e,t,r,i,o){return n()},t.prototype.hasFeatureAtCoordinate=function(e,t,r,n,i,o){return void 0!==this.forEachFeatureAtCoordinate(e,t,r,n,y,this,i,o)},t.prototype.getMap=function(){return this.map_},t.prototype.renderFrame=function(e){n()},t.prototype.scheduleExpireIconCache=function(e){Qe.canExpireCache()&&e.postRenderFunctions.push(Yt)},t}(s);function Yt(e,t){Qe.expire()}const Kt=zt;var Xt=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const $t=function(e){function t(t,r,n,i){var o=e.call(this,t)||this;return o.inversePixelTransform=r,o.frameState=n,o.context=i,o}return Xt(t,e),t}(tt);var Jt="ol-hidden",Qt="ol-unselectable",er="ol-control",tr="ol-collapsed",rr=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i"),nr=["style","variant","weight","size","lineHeight","family"],ir=function(e){var t=e.match(rr);if(!t)return null;for(var r={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"},n=0,i=nr.length;n<i;++n){var o=t[n+1];void 0!==o&&(r[nr[n]]=o)}return r.families=r.family.split(/,\s?/),r};function or(e,t,r,n){var i;return i=r&&r.length?r.shift():T?new OffscreenCanvas(e||300,t||300):document.createElement("canvas"),e&&(i.width=e),t&&(i.height=t),i.getContext("2d",n)}function ar(e){var t=e.canvas;t.width=1,t.height=1,e.clearRect(0,0,1,1)}function sr(e){var t=e.offsetWidth,r=getComputedStyle(e);return t+=parseInt(r.marginLeft,10)+parseInt(r.marginRight,10)}function lr(e){var t=e.offsetHeight,r=getComputedStyle(e);return t+=parseInt(r.marginTop,10)+parseInt(r.marginBottom,10)}function cr(e,t){var r=t.parentNode;r&&r.replaceChild(e,t)}function ur(e){return e&&e.parentNode?e.parentNode.removeChild(e):null}function pr(e){for(;e.lastChild;)e.removeChild(e.lastChild)}var hr="10px sans-serif",dr="#000",fr="round",gr=[],yr="round",mr="#000",vr="center",_r="middle",wr=[0,0,0,0],Sr=new _t;(new lt).setSize=function(){console.warn("labelCache is deprecated.")};var Er,br,Cr=null,Lr={},Tr=function(){var e,t,r="32px ",n=["monospace","serif"],i=n.length,o="wmytzilWMYTZIL@#/&?$%10";function a(e,a,s){for(var l=!0,c=0;c<i;++c){var u=n[c];if(t=Pr(e+" "+a+" "+r+u,o),s!=u){var p=Pr(e+" "+a+" "+r+s+","+u,o);l=l&&p!=t}}return!!l}function s(){for(var t=!0,r=Sr.getKeys(),n=0,i=r.length;n<i;++n){var o=r[n];Sr.get(o)<100&&(a.apply(this,o.split("\n"))?(it(Lr),Cr=null,Er=void 0,Sr.set(o,100)):(Sr.set(o,Sr.get(o)+1,!0),t=!1))}t&&(clearInterval(e),e=void 0)}return function(t){var r=ir(t);if(r)for(var n=r.families,i=0,o=n.length;i<o;++i){var l=n[i],c=r.style+"\n"+r.weight+"\n"+l;void 0===Sr.get(c)&&(Sr.set(c,100,!0),a(r.style,r.weight,l)||(Sr.set(c,0,!0),void 0===e&&(e=setInterval(s,32))))}}}(),Ar=function(e){var t=Lr[e];if(null==t){if(T){var r=ir(e),n=xr(e,"g");t=(isNaN(Number(r.lineHeight))?1.2:Number(r.lineHeight))*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else br||((br=document.createElement("div")).innerHTML="M",br.style.minHeight="0",br.style.maxHeight="none",br.style.height="auto",br.style.padding="0",br.style.border="none",br.style.position="absolute",br.style.display="block",br.style.left="-99999px"),br.style.font=e,document.body.appendChild(br),t=br.offsetHeight,document.body.removeChild(br);Lr[e]=t}return t};function xr(e,t){return Cr||(Cr=or(1,1)),e!=Er&&(Cr.font=e,Er=Cr.font),Cr.measureText(t)}function Pr(e,t){return xr(e,t).width}function Or(e,t,r){if(t in r)return r[t];var n=t.split("\n").reduce((function(t,r){return Math.max(t,Pr(e,r))}),0);return r[t]=n,n}function Ir(e,t,r,n,i,o,a,s,l,c,u){e.save(),1!==r&&(e.globalAlpha*=r),t&&e.setTransform.apply(e,t),n.contextInstructions?(e.translate(l,c),e.scale(u[0],u[1]),function(e,t){for(var r=e.contextInstructions,n=0,i=r.length;n<i;n+=2)Array.isArray(r[n+1])?t[r[n]].apply(t,r[n+1]):t[r[n]]=r[n+1]}(n,e)):u[0]<0||u[1]<0?(e.translate(l,c),e.scale(u[0],u[1]),e.drawImage(n,i,o,a,s,0,0,a,s)):e.drawImage(n,i,o,a,s,l,c,a*u[0],s*u[1]),e.restore()}var Rr=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Mr=function(e){function t(t){var r=e.call(this,t)||this;r.fontChangeListenerKey_=ut(Sr,rt,t.redrawText.bind(t)),r.element_=document.createElement("div");var n=r.element_.style;n.position="absolute",n.width="100%",n.height="100%",n.zIndex="0",r.element_.className="ol-unselectable ol-layers";var i=t.getViewport();return i.insertBefore(r.element_,i.firstChild||null),r.children_=[],r.renderedVisible_=!0,r}return Rr(t,e),t.prototype.dispatchRenderEvent=function(e,t){var r=this.getMap();if(r.hasListener(e)){var n=new $t(e,void 0,t);r.dispatchEvent(n)}},t.prototype.disposeInternal=function(){ht(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),e.prototype.disposeInternal.call(this)},t.prototype.renderFrame=function(e){if(e){this.calculateMatrices2D(e),this.dispatchRenderEvent(Rt.PRECOMPOSE,e);var t=e.layerStatesArray.sort((function(e,t){return e.zIndex-t.zIndex})),r=e.viewState;this.children_.length=0;for(var n=[],i=null,o=0,a=t.length;o<a;++o){var s=t[o];e.layerIndex=o;var l=s.layer,c=l.getSourceState();if(!Dt(s,r)||"ready"!=c&&"undefined"!=c)l.unrender();else{var u=l.render(e,i);u&&(u!==i&&(this.children_.push(u),i=u),"getDeclutter"in l&&n.push(l))}}for(o=n.length-1;o>=0;--o)n[o].renderDeclutter(e);!function(e,t){for(var r=e.childNodes,n=0;;++n){var i=r[n],o=t[n];if(!i&&!o)break;i!==o&&(i?o?e.insertBefore(o,i):(e.removeChild(i),--n):e.appendChild(o))}}(this.element_,this.children_),this.dispatchRenderEvent(Rt.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}else this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1)},t.prototype.forEachLayerAtPixel=function(e,t,r,n,i){for(var o=t.viewState,a=t.layerStatesArray,s=a.length-1;s>=0;--s){var l=a[s],c=l.layer;if(c.hasRenderer()&&Dt(l,o)&&i(c)){var u=c.getRenderer().getDataAtPixel(e,t,r);if(u){var p=n(c,u);if(p)return p}}}},t}(Kt);const Dr=Mr,Nr="add",Zr="remove";var kr=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Fr="length",Ur=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.element=r,i.index=n,i}return kr(t,e),t}(tt);const Br=function(e){function t(t,r){var n=e.call(this)||this;n.on,n.once,n.un;var i=r||{};if(n.unique_=!!i.unique,n.array_=t||[],n.unique_)for(var o=0,a=n.array_.length;o<a;++o)n.assertUnique_(n.array_[o],o);return n.updateLength_(),n}return kr(t,e),t.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},t.prototype.extend=function(e){for(var t=0,r=e.length;t<r;++t)this.push(e[t]);return this},t.prototype.forEach=function(e){for(var t=this.array_,r=0,n=t.length;r<n;++r)e(t[r],r,t)},t.prototype.getArray=function(){return this.array_},t.prototype.item=function(e){return this.array_[e]},t.prototype.getLength=function(){return this.get(Fr)},t.prototype.insertAt=function(e,t){this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new Ur(Nr,t,e))},t.prototype.pop=function(){return this.removeAt(this.getLength()-1)},t.prototype.push=function(e){this.unique_&&this.assertUnique_(e);var t=this.getLength();return this.insertAt(t,e),this.getLength()},t.prototype.remove=function(e){for(var t=this.array_,r=0,n=t.length;r<n;++r)if(t[r]===e)return this.removeAt(r)},t.prototype.removeAt=function(e){var t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new Ur(Zr,t,e)),t},t.prototype.setAt=function(e,t){var r=this.getLength();if(e<r){this.unique_&&this.assertUnique_(t,e);var n=this.array_[e];this.array_[e]=t,this.dispatchEvent(new Ur(Zr,n,e)),this.dispatchEvent(new Ur(Nr,t,e))}else{for(var i=r;i<e;++i)this.insertAt(i,void 0);this.insertAt(e,t)}},t.prototype.updateLength_=function(){this.set(Fr,this.array_.length)},t.prototype.assertUnique_=function(e,t){for(var r=0,n=this.array_.length;r<n;++r)if(this.array_[r]===e&&r!==t)throw new O(58)},t}(_t);var Gr=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),jr=function(e){function t(t,r){var n=e.call(this,t)||this;return n.layer=r,n}return Gr(t,e),t}(tt),Wr="layers";const Hr=function(e){function t(t){var r=this,n=t||{},i=nt({},n);delete i.layers;var o=n.layers;return(r=e.call(this,i)||this).on,r.once,r.un,r.layersListenerKeys_=[],r.listenerKeys_={},r.addChangeListener(Wr,r.handleLayersChanged_),o?Array.isArray(o)?o=new Br(o.slice(),{unique:!0}):I("function"==typeof o.getArray,43):o=new Br(void 0,{unique:!0}),r.setLayers(o),r}return Gr(t,e),t.prototype.handleLayerChange_=function(){this.changed()},t.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(ht),this.layersListenerKeys_.length=0;var e=this.getLayers();for(var t in this.layersListenerKeys_.push(ut(e,Nr,this.handleLayersAdd_,this),ut(e,Zr,this.handleLayersRemove_,this)),this.listenerKeys_)this.listenerKeys_[t].forEach(ht);it(this.listenerKeys_);for(var r=e.getArray(),n=0,i=r.length;n<i;n++){var o=r[n];this.registerLayerListeners_(o),this.dispatchEvent(new jr("addlayer",o))}this.changed()},t.prototype.registerLayerListeners_=function(e){var r=[ut(e,rt,this.handleLayerChange_,this),ut(e,ct.CHANGE,this.handleLayerChange_,this)];e instanceof t&&r.push(ut(e,"addlayer",this.handleLayerGroupAdd_,this),ut(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[o(e)]=r},t.prototype.handleLayerGroupAdd_=function(e){this.dispatchEvent(new jr("addlayer",e.layer))},t.prototype.handleLayerGroupRemove_=function(e){this.dispatchEvent(new jr("removelayer",e.layer))},t.prototype.handleLayersAdd_=function(e){var t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new jr("addlayer",t)),this.changed()},t.prototype.handleLayersRemove_=function(e){var t=e.element,r=o(t);this.listenerKeys_[r].forEach(ht),delete this.listenerKeys_[r],this.dispatchEvent(new jr("removelayer",t)),this.changed()},t.prototype.getLayers=function(){return this.get(Wr)},t.prototype.setLayers=function(e){var t=this.getLayers();if(t)for(var r=t.getArray(),n=0,i=r.length;n<i;++n)this.dispatchEvent(new jr("removelayer",r[n]));this.set(Wr,e)},t.prototype.getLayersArray=function(e){var t=void 0!==e?e:[];return this.getLayers().forEach((function(e){e.getLayersArray(t)})),t},t.prototype.getLayerStatesArray=function(e){var t=void 0!==e?e:[],r=t.length;this.getLayers().forEach((function(e){e.getLayerStatesArray(t)}));var n=this.getLayerState(),i=n.zIndex;e||void 0!==n.zIndex||(i=0);for(var o=r,a=t.length;o<a;o++){var s=t[o];s.opacity*=n.opacity,s.visible=s.visible&&n.visible,s.maxResolution=Math.min(s.maxResolution,n.maxResolution),s.minResolution=Math.max(s.minResolution,n.minResolution),s.minZoom=Math.max(s.minZoom,n.minZoom),s.maxZoom=Math.min(s.maxZoom,n.maxZoom),void 0!==n.extent&&(void 0!==s.extent?s.extent=Ee(s.extent,n.extent):s.extent=n.extent),void 0===s.zIndex&&(s.zIndex=i)}return t},t.prototype.getSourceState=function(){return"ready"},t}(It);var qr=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const Vr=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.map=r,i.frameState=void 0!==n?n:null,i}return qr(t,e),t}(tt);var zr=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const Yr=function(e){function t(t,r,n,i,o,a){var s=e.call(this,t,r,o)||this;return s.originalEvent=n,s.pixel_=null,s.coordinate_=null,s.dragging=void 0!==i&&i,s.activePointers=a,s}return zr(t,e),Object.defineProperty(t.prototype,"pixel",{get:function(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_},set:function(e){this.pixel_=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"coordinate",{get:function(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_},set:function(e){this.coordinate_=e},enumerable:!1,configurable:!0}),t.prototype.preventDefault=function(){e.prototype.preventDefault.call(this),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()},t.prototype.stopPropagation=function(){e.prototype.stopPropagation.call(this),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()},t}(Vr),Kr={SINGLECLICK:"singleclick",CLICK:ct.CLICK,DBLCLICK:ct.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Xr="pointermove",$r="pointerdown",Jr="pointerup";var Qr=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const en=function(e){function t(t,r){var n=e.call(this,t)||this;n.map_=t,n.clickTimeoutId_,n.emulateClicks_=!1,n.dragging_=!1,n.dragListenerKeys_=[],n.moveTolerance_=void 0===r?1:r,n.down_=null;var i=n.map_.getViewport();return n.activePointers_=[],n.trackedTouches_={},n.element_=i,n.pointerdownListenerKey_=ut(i,$r,n.handlePointerDown_,n),n.originalPointerMoveEvent_,n.relayedListenerKey_=ut(i,Xr,n.relayMoveEvent_,n),n.boundHandleTouchMove_=n.handleTouchMove_.bind(n),n.element_.addEventListener(ct.TOUCHMOVE,n.boundHandleTouchMove_,!!x&&{passive:!1}),n}return Qr(t,e),t.prototype.emulateClick_=function(e){var t=new Yr(Kr.CLICK,this.map_,e);this.dispatchEvent(t),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new Yr(Kr.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;var t=new Yr(Kr.SINGLECLICK,this.map_,e);this.dispatchEvent(t)}.bind(this),250)},t.prototype.updateActivePointers_=function(e){var t=e,r=t.pointerId;if(t.type==Kr.POINTERUP||t.type==Kr.POINTERCANCEL){for(var n in delete this.trackedTouches_[r],this.trackedTouches_)if(this.trackedTouches_[n].target!==t.target){delete this.trackedTouches_[n];break}}else t.type!=Kr.POINTERDOWN&&t.type!=Kr.POINTERMOVE||(this.trackedTouches_[r]=t);this.activePointers_=ot(this.trackedTouches_)},t.prototype.handlePointerUp_=function(e){this.updateActivePointers_(e);var t=new Yr(Kr.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),0===this.activePointers_.length&&(this.dragListenerKeys_.forEach(ht),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)},t.prototype.isMouseActionButton_=function(e){return 0===e.button},t.prototype.handlePointerDown_=function(e){this.emulateClicks_=0===this.activePointers_.length,this.updateActivePointers_(e);var t=new Yr(Kr.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);for(var r in this.dispatchEvent(t),this.down_={},e){var n=e[r];this.down_[r]="function"==typeof n?v:n}if(0===this.dragListenerKeys_.length){var i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(ut(i,Kr.POINTERMOVE,this.handlePointerMove_,this),ut(i,Kr.POINTERUP,this.handlePointerUp_,this),ut(this.element_,Kr.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(ut(this.element_.getRootNode(),Kr.POINTERUP,this.handlePointerUp_,this))}},t.prototype.handlePointerMove_=function(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;var t=new Yr(Kr.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}},t.prototype.relayMoveEvent_=function(e){this.originalPointerMoveEvent_=e;var t=!(!this.down_||!this.isMoving_(e));this.dispatchEvent(new Yr(Kr.POINTERMOVE,this.map_,e,t))},t.prototype.handleTouchMove_=function(e){var t=this.originalPointerMoveEvent_;t&&!t.defaultPrevented||"boolean"==typeof e.cancelable&&!0!==e.cancelable||e.preventDefault()},t.prototype.isMoving_=function(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_},t.prototype.disposeInternal=function(){this.relayedListenerKey_&&(ht(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(ct.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(ht(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(ht),this.dragListenerKeys_.length=0,this.element_=null,e.prototype.disposeInternal.call(this)},t}(lt),tn={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},rn="layergroup",nn="size",on="target",an="view";var sn=1/0;const ln=function(){function e(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}return e.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,it(this.queuedElements_)},e.prototype.dequeue=function(){var e=this.elements_,t=this.priorities_,r=e[0];1==e.length?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));var n=this.keyFunction_(r);return delete this.queuedElements_[n],r},e.prototype.enqueue=function(e){I(!(this.keyFunction_(e)in this.queuedElements_),31);var t=this.priorityFunction_(e);return t!=sn&&(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0)},e.prototype.getCount=function(){return this.elements_.length},e.prototype.getLeftChildIndex_=function(e){return 2*e+1},e.prototype.getRightChildIndex_=function(e){return 2*e+2},e.prototype.getParentIndex_=function(e){return e-1>>1},e.prototype.heapify_=function(){var e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)},e.prototype.isEmpty=function(){return 0===this.elements_.length},e.prototype.isKeyQueued=function(e){return e in this.queuedElements_},e.prototype.isQueued=function(e){return this.isKeyQueued(this.keyFunction_(e))},e.prototype.siftUp_=function(e){for(var t=this.elements_,r=this.priorities_,n=t.length,i=t[e],o=r[e],a=e;e<n>>1;){var s=this.getLeftChildIndex_(e),l=this.getRightChildIndex_(e),c=l<n&&r[l]<r[s]?l:s;t[e]=t[c],r[e]=r[c],e=c}t[e]=i,r[e]=o,this.siftDown_(a,e)},e.prototype.siftDown_=function(e,t){for(var r=this.elements_,n=this.priorities_,i=r[t],o=n[t];t>e;){var a=this.getParentIndex_(t);if(!(n[a]>o))break;r[t]=r[a],n[t]=n[a],t=a}r[t]=i,n[t]=o},e.prototype.reprioritize=function(){var e,t,r,n=this.priorityFunction_,i=this.elements_,o=this.priorities_,a=0,s=i.length;for(t=0;t<s;++t)(r=n(e=i[t]))==sn?delete this.queuedElements_[this.keyFunction_(e)]:(o[a]=r,i[a++]=e);i.length=a,o.length=a,this.heapify_()},e}(),cn=0,un=1,pn=2,hn=3,dn=4;var fn=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),gn=function(e){function t(t,r){var n=e.call(this,(function(e){return t.apply(null,e)}),(function(e){return e[0].getKey()}))||this;return n.boundHandleTileChange_=n.handleTileChange.bind(n),n.tileChangeCallback_=r,n.tilesLoading_=0,n.tilesLoadingKeys_={},n}return fn(t,e),t.prototype.enqueue=function(t){var r=e.prototype.enqueue.call(this,t);r&&t[0].addEventListener(ct.CHANGE,this.boundHandleTileChange_);return r},t.prototype.getTilesLoading=function(){return this.tilesLoading_},t.prototype.handleTileChange=function(e){var t=e.target,r=t.getState();if(r===pn||r===hn||r===dn){t.removeEventListener(ct.CHANGE,this.boundHandleTileChange_);var n=t.getKey();n in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[n],--this.tilesLoading_),this.tileChangeCallback_()}},t.prototype.loadMoreTiles=function(e,t){for(var r,n,i=0;this.tilesLoading_<e&&i<t&&this.getCount()>0;)n=(r=this.dequeue()[0]).getKey(),r.getState()!==cn||n in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[n]=!0,++this.tilesLoading_,++i,r.load())},t}(ln);const yn=gn;var mn={RADIANS:"radians",DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"};var vn={};vn[mn.RADIANS]=6370997/(2*Math.PI),vn[mn.DEGREES]=2*Math.PI*6370997/360,vn[mn.FEET]=.3048,vn[mn.METERS]=1,vn[mn.USFEET]=1200/3937;const _n=mn,wn=0,Sn=1,En={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};var bn=256;const Cn=function(){function e(e){this.code_=e.code,this.units_=e.units,this.extent_=void 0!==e.extent?e.extent:null,this.worldExtent_=void 0!==e.worldExtent?e.worldExtent:null,this.axisOrientation_=void 0!==e.axisOrientation?e.axisOrientation:"enu",this.global_=void 0!==e.global&&e.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}return e.prototype.canWrapX=function(){return this.canWrapX_},e.prototype.getCode=function(){return this.code_},e.prototype.getExtent=function(){return this.extent_},e.prototype.getUnits=function(){return this.units_},e.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||vn[this.units_]},e.prototype.getWorldExtent=function(){return this.worldExtent_},e.prototype.getAxisOrientation=function(){return this.axisOrientation_},e.prototype.isGlobal=function(){return this.global_},e.prototype.setGlobal=function(e){this.global_=e,this.canWrapX_=!(!e||!this.extent_)},e.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},e.prototype.setDefaultTileGrid=function(e){this.defaultTileGrid_=e},e.prototype.setExtent=function(e){this.extent_=e,this.canWrapX_=!(!this.global_||!e)},e.prototype.setWorldExtent=function(e){this.worldExtent_=e},e.prototype.setGetPointResolution=function(e){this.getPointResolutionFunc_=e},e.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},e}();var Ln=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Tn=6378137,An=Math.PI*Tn,xn=[-An,-An,An,An],Pn=[-180,-85,180,85],On=Tn*Math.log(Math.tan(Math.PI/2)),In=function(e){function t(t){return e.call(this,{code:t,units:_n.METERS,extent:xn,global:!0,worldExtent:Pn,getPointResolution:function(e,t){return e/Re(t[1]/Tn)}})||this}return Ln(t,e),t}(Cn),Rn=[new In("EPSG:3857"),new In("EPSG:102100"),new In("EPSG:102113"),new In("EPSG:900913"),new In("http://www.opengis.net/def/crs/EPSG/0/3857"),new In("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Mn(e,t,r){var n=e.length,i=r>1?r:2,o=t;void 0===o&&(o=i>2?e.slice():new Array(n));for(var a=0;a<n;a+=i){o[a]=An*e[a]/180;var s=Tn*Math.log(Math.tan(Math.PI*(+e[a+1]+90)/360));s>On?s=On:s<-On&&(s=-On),o[a+1]=s}return o}function Dn(e,t,r){var n=e.length,i=r>1?r:2,o=t;void 0===o&&(o=i>2?e.slice():new Array(n));for(var a=0;a<n;a+=i)o[a]=180*e[a]/An,o[a+1]=360*Math.atan(Math.exp(e[a+1]/Tn))/Math.PI-90;return o}var Nn=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Zn=[-180,-90,180,90],kn=6378137*Math.PI/180,Fn=function(e){function t(t,r){return e.call(this,{code:t,units:_n.DEGREES,extent:Zn,axisOrientation:r,global:!0,metersPerUnit:kn,worldExtent:Zn})||this}return Nn(t,e),t}(Cn),Un=[new Fn("CRS:84"),new Fn("EPSG:4326","neu"),new Fn("urn:ogc:def:crs:OGC:1.3:CRS84"),new Fn("urn:ogc:def:crs:OGC:2:84"),new Fn("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Fn("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Fn("http://www.opengis.net/def/crs/EPSG/0/4326","neu")],Bn={};var Gn={};function jn(e,t,r){var n=e.getCode(),i=t.getCode();n in Gn||(Gn[n]={}),Gn[n][i]=r}function Wn(e,t){var r;return e in Gn&&t in Gn[e]&&(r=Gn[e][t]),r}var Hn=6371008.8;function qn(e,t,r){var n=r||Hn,i=Ze(e[1]),o=Ze(t[1]),a=(o-i)/2,s=Ze(t[0]-e[0])/2,l=Math.sin(a)*Math.sin(a)+Math.sin(s)*Math.sin(s)*Math.cos(i)*Math.cos(o);return 2*n*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))}var Vn=!0;function zn(e){Vn=!(void 0===e||e)}function Yn(e,t,r){var n;if(void 0!==t){for(var i=0,o=e.length;i<o;++i)t[i]=e[i];n=t}else n=e.slice();return n}function Kn(e,t,r){if(void 0!==t&&e!==t){for(var n=0,i=e.length;n<i;++n)t[n]=e[n];e=t}return e}function Xn(e){!function(e,t){Bn[e]=t}(e.getCode(),e),jn(e,e,Yn)}function $n(e){return"string"==typeof e?Bn[t=e]||Bn[t.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null:e||null;var t}function Jn(e,t,r,n){var i,o=(e=$n(e)).getPointResolutionFunc();if(o){if(i=o(t,r),n&&n!==e.getUnits())(s=e.getMetersPerUnit())&&(i=i*s/vn[n])}else{var a=e.getUnits();if(a==_n.DEGREES&&!n||n==_n.DEGREES)i=t;else{var s,l=ni(e,$n("EPSG:4326"));if(l===Kn&&a!==_n.DEGREES)i=t*e.getMetersPerUnit();else{var c=[r[0]-t/2,r[1],r[0]+t/2,r[1],r[0],r[1]-t/2,r[0],r[1]+t/2];i=(qn((c=l(c,c,2)).slice(0,2),c.slice(2,4))+qn(c.slice(4,6),c.slice(6,8)))/2}void 0!==(s=n?vn[n]:e.getMetersPerUnit())&&(i/=s)}}return i}function Qn(e){!function(e){e.forEach(Xn)}(e),e.forEach((function(t){e.forEach((function(e){t!==e&&jn(t,e,Yn)}))}))}function ei(e,t){return e?"string"==typeof e?$n(e):e:$n(t)}function ti(e){return function(t,r,n){for(var i=t.length,o=void 0!==n?n:2,a=void 0!==r?r:new Array(i),s=0;s<i;s+=o)for(var l=e(t.slice(s,s+o)),c=l.length,u=0,p=o;u<p;++u)a[s+u]=u>=c?t[s+u]:l[u];return a}}function ri(e,t){if(e===t)return!0;var r=e.getUnits()===t.getUnits();return(e.getCode()===t.getCode()||ni(e,t)===Yn)&&r}function ni(e,t){var r=Wn(e.getCode(),t.getCode());return r||(r=Kn),r}function ii(e,t){return ni($n(e),$n(t))}function oi(e,t,r){return ii(t,r)(e,void 0,e.length)}function ai(e,t,r,n){return Pe(e,ii(t,r),void 0,n)}var si,li,ci,ui=null;function pi(){return ui}function hi(e,t){return ui?oi(e,t,ui):e}function di(e,t){return ui?oi(e,ui,t):(Vn&&!Ut(e,[0,0])&&e[0]>=-180&&e[0]<=180&&e[1]>=-90&&e[1]<=90&&(Vn=!1,console.warn("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),e)}function fi(e,t){return ui?ai(e,t,ui):e}function gi(e,t){return ui?ai(e,ui,t):e}function yi(e,t){if(!ui)return e;var r=$n(t).getUnits(),n=ui.getUnits();return r&&n?e*vn[r]/vn[n]:e}function mi(e,t,r){return function(n){var i,o;if(e.canWrapX()){var a=e.getExtent(),s=Le(a);(o=qt(n=n.slice(0),e,s))&&(n[0]=n[0]-o*s),n[0]=Ie(n[0],a[0],a[2]),n[1]=Ie(n[1],a[1],a[3]),i=r(n)}else i=r(n);return o&&t.canWrapX()&&(i[0]+=o*Le(t.getExtent())),i}}function vi(e,t,r){return function(n,i,o,a,s){if(n){if(!i&&!t)return n;var l=t?0:o[0]*i,c=t?0:o[1]*i,u=s?s[0]:0,p=s?s[1]:0,h=e[0]+l/2+u,d=e[2]-l/2+u,f=e[1]+c/2+p,g=e[3]-c/2+p;h>d&&(d=h=(d+h)/2),f>g&&(g=f=(g+f)/2);var y=Ie(n[0],h,d),m=Ie(n[1],f,g);if(a&&r&&i){var v=30*i;y+=-v*Math.log(1+Math.max(0,h-n[0])/v)+v*Math.log(1+Math.max(0,n[0]-d)/v),m+=-v*Math.log(1+Math.max(0,f-n[1])/v)+v*Math.log(1+Math.max(0,n[1]-g)/v)}return[y,m]}}}function _i(e){return e}function wi(e,t,r,n){var i=Le(t)/r[0],o=Se(t)/r[1];return n?Math.min(e,Math.max(i,o)):Math.min(e,Math.min(i,o))}function Si(e,t,r){var n=Math.min(e,t);return n*=Math.log(1+50*Math.max(0,e/t-1))/50+1,r&&(n=Math.max(n,r),n/=Math.log(1+50*Math.max(0,r/e-1))/50+1),Ie(n,r/2,2*t)}function Ei(e,t,r,n,i){return function(o,a,s,l){if(void 0!==o){var c=n?wi(e,n,s,i):e;return(void 0===r||r)&&l?Si(o,c,t):Ie(o,t,c)}}}function bi(e){return void 0!==e?0:void 0}function Ci(e){return void 0!==e?e:void 0}function Li(e){return Math.pow(e,3)}function Ti(e){return 1-Li(1-e)}function Ai(e){return 3*e*e-2*e*e*e}function xi(e){return e}Qn(Rn),Qn(Un),si=Rn,li=Mn,ci=Dn,Un.forEach((function(e){si.forEach((function(t){jn(e,t,li),jn(t,e,ci)}))}));const Pi={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"};function Oi(e,t,r,n,i,o){for(var a=o||[],s=0,l=t;l<r;l+=n){var c=e[l],u=e[l+1];a[s++]=i[0]*c+i[2]*u+i[4],a[s++]=i[1]*c+i[3]*u+i[5]}return o&&a.length!=s&&(a.length=s),a}function Ii(e,t,r,n,i,o,a){for(var s=a||[],l=Math.cos(i),c=Math.sin(i),u=o[0],p=o[1],h=0,d=t;d<r;d+=n){var f=e[d]-u,g=e[d+1]-p;s[h++]=u+f*l-g*c,s[h++]=p+f*c+g*l;for(var y=d+2;y<d+n;++y)s[h++]=e[y]}return a&&s.length!=h&&(s.length=h),s}function Ri(e,t,r,n,i,o,a){for(var s=a||[],l=0,c=t;c<r;c+=n){s[l++]=e[c]+i,s[l++]=e[c+1]+o;for(var u=c+2;u<c+n;++u)s[l++]=e[u]}return a&&s.length!=l&&(s.length=l),s}var Mi=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Di=[1,0,0,1,0,0],Ni=function(e){function t(){var t,r,n,i,o,a=e.call(this)||this;return a.extent_=[1/0,1/0,-1/0,-1/0],a.extentRevision_=-1,a.simplifiedGeometryMaxMinSquaredTolerance=0,a.simplifiedGeometryRevision=0,a.simplifyTransformedInternal=(t=function(e,t,r){if(!r)return this.getSimplifiedGeometry(t);var n=this.clone();return n.applyTransform(r),n.getSimplifiedGeometry(t)},o=!1,function(){var e=Array.prototype.slice.call(arguments);return o&&this===i&&f(e,n)||(o=!0,i=this,n=e,r=t.apply(this,arguments)),r}),a}return Mi(t,e),t.prototype.simplifyTransformed=function(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)},t.prototype.clone=function(){return n()},t.prototype.closestPointXY=function(e,t,r,i){return n()},t.prototype.containsXY=function(e,t){var r=this.getClosestPoint([e,t]);return r[0]===e&&r[1]===t},t.prototype.getClosestPoint=function(e,t){var r=t||[NaN,NaN];return this.closestPointXY(e[0],e[1],r,1/0),r},t.prototype.intersectsCoordinate=function(e){return this.containsXY(e[0],e[1])},t.prototype.computeExtent=function(e){return n()},t.prototype.getExtent=function(e){if(this.extentRevision_!=this.getRevision()){var t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&oe(t),this.extentRevision_=this.getRevision()}return function(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e}(this.extent_,e)},t.prototype.rotate=function(e,t){n()},t.prototype.scale=function(e,t,r){n()},t.prototype.simplify=function(e){return this.getSimplifiedGeometry(e*e)},t.prototype.getSimplifiedGeometry=function(e){return n()},t.prototype.getType=function(){return n()},t.prototype.applyTransform=function(e){n()},t.prototype.intersectsExtent=function(e){return n()},t.prototype.translate=function(e,t){n()},t.prototype.transform=function(e,t){var r=$n(e),n=r.getUnits()==_n.TILE_PIXELS?function(e,n,i){var o=r.getExtent(),a=r.getWorldExtent(),s=Se(a)/Se(o);return B(Di,a[0],a[3],s,-s,0,0,0),Oi(e,0,e.length,i,Di,n),ii(r,t)(e,n,i)}:ii(r,t);return this.applyTransform(n),this},t}(_t);const Zi=Ni;var ki=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Fi=function(e){function t(){var t=e.call(this)||this;return t.layout=Pi.XY,t.stride=2,t.flatCoordinates=null,t}return ki(t,e),t.prototype.computeExtent=function(e){return se(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)},t.prototype.getCoordinates=function(){return n()},t.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},t.prototype.getFlatCoordinates=function(){return this.flatCoordinates},t.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},t.prototype.getLayout=function(){return this.layout},t.prototype.getSimplifiedGeometry=function(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)},t.prototype.getSimplifiedGeometryInternal=function(e){return this},t.prototype.getStride=function(){return this.stride},t.prototype.setFlatCoordinates=function(e,t){this.stride=Ui(e),this.layout=e,this.flatCoordinates=t},t.prototype.setCoordinates=function(e,t){n()},t.prototype.setLayout=function(e,t,r){var n;if(e)n=Ui(e);else{for(var i=0;i<r;++i){if(0===t.length)return this.layout=Pi.XY,void(this.stride=2);t=t[0]}e=function(e){var t;2==e?t=Pi.XY:3==e?t=Pi.XYZ:4==e&&(t=Pi.XYZM);return t}(n=t.length)}this.layout=e,this.stride=n},t.prototype.applyTransform=function(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},t.prototype.rotate=function(e,t){var r=this.getFlatCoordinates();if(r){var n=this.getStride();Ii(r,0,r.length,n,e,t,r),this.changed()}},t.prototype.scale=function(e,t,r){var n=t;void 0===n&&(n=e);var i=r;i||(i=me(this.getExtent()));var o=this.getFlatCoordinates();if(o){var a=this.getStride();!function(e,t,r,n,i,o,a,s){for(var l=s||[],c=a[0],u=a[1],p=0,h=t;h<r;h+=n){var d=e[h]-c,f=e[h+1]-u;l[p++]=c+i*d,l[p++]=u+o*f;for(var g=h+2;g<h+n;++g)l[p++]=e[g]}s&&l.length!=p&&(l.length=p)}(o,0,o.length,a,e,n,i,o),this.changed()}},t.prototype.translate=function(e,t){var r=this.getFlatCoordinates();if(r){var n=this.getStride();Ri(r,0,r.length,n,e,t,r),this.changed()}},t}(Zi);function Ui(e){var t;return e==Pi.XY?t=2:e==Pi.XYZ||e==Pi.XYM?t=3:e==Pi.XYZM&&(t=4),t}const Bi=Fi;function Gi(e,t,r,n,i,o,a){var s,l=e[t],c=e[t+1],u=e[r]-l,p=e[r+1]-c;if(0===u&&0===p)s=t;else{var h=((i-l)*u+(o-c)*p)/(u*u+p*p);if(h>1)s=r;else{if(h>0){for(var d=0;d<n;++d)a[d]=Fe(e[t+d],e[r+d],h);return void(a.length=n)}s=t}}for(d=0;d<n;++d)a[d]=e[s+d];a.length=n}function ji(e,t,r,n,i){var o=e[t],a=e[t+1];for(t+=n;t<r;t+=n){var s=e[t],l=e[t+1],c=Ne(o,a,s,l);c>i&&(i=c),o=s,a=l}return i}function Wi(e,t,r,n,i){for(var o=0,a=r.length;o<a;++o){var s=r[o];i=ji(e,t,s,n,i),t=s}return i}function Hi(e,t,r,n,i,o,a,s,l,c,u){if(t==r)return c;var p,h;if(0===i){if((h=Ne(a,s,e[t],e[t+1]))<c){for(p=0;p<n;++p)l[p]=e[t+p];return l.length=n,h}return c}for(var d=u||[NaN,NaN],f=t+n;f<r;)if(Gi(e,f-n,f,n,a,s,d),(h=Ne(a,s,d[0],d[1]))<c){for(c=h,p=0;p<n;++p)l[p]=d[p];l.length=n,f+=n}else f+=n*Math.max((Math.sqrt(h)-Math.sqrt(c))/i|0,1);if(o&&(Gi(e,r-n,t,n,a,s,d),(h=Ne(a,s,d[0],d[1]))<c)){for(c=h,p=0;p<n;++p)l[p]=d[p];l.length=n}return c}function qi(e,t,r,n,i,o,a,s,l,c,u){for(var p=u||[NaN,NaN],h=0,d=r.length;h<d;++h){var f=r[h];c=Hi(e,t,f,n,i,o,a,s,l,c,p),t=f}return c}function Vi(e,t,r,n){for(var i=0,o=r.length;i<o;++i)e[t++]=r[i];return t}function zi(e,t,r,n){for(var i=0,o=r.length;i<o;++i)for(var a=r[i],s=0;s<n;++s)e[t++]=a[s];return t}function Yi(e,t,r,n,i){for(var o=i||[],a=0,s=0,l=r.length;s<l;++s){var c=zi(e,t,r[s],n);o[a++]=c,t=c}return o.length=a,o}function Ki(e,t,r,n,i,o,a){var s=(r-t)/n;if(s<3){for(;t<r;t+=n)o[a++]=e[t],o[a++]=e[t+1];return a}var l=new Array(s);l[0]=1,l[s-1]=1;for(var c=[t,r-n],u=0;c.length>0;){for(var p=c.pop(),h=c.pop(),d=0,f=e[h],g=e[h+1],y=e[p],m=e[p+1],v=h+n;v<p;v+=n){var _=De(e[v],e[v+1],f,g,y,m);_>d&&(u=v,d=_)}d>i&&(l[(u-t)/n]=1,h+n<u&&c.push(h,u),u+n<p&&c.push(u,p))}for(v=0;v<s;++v)l[v]&&(o[a++]=e[t+v*n],o[a++]=e[t+v*n+1]);return a}function Xi(e,t,r,n,i,o,a,s){for(var l=0,c=r.length;l<c;++l){var u=r[l];a=Ki(e,t,u,n,i,o,a),s.push(a),t=u}return a}function $i(e,t){return t*Math.round(e/t)}function Ji(e,t,r,n,i,o,a){if(t==r)return a;var s,l,c=$i(e[t],i),u=$i(e[t+1],i);t+=n,o[a++]=c,o[a++]=u;do{if(s=$i(e[t],i),l=$i(e[t+1],i),(t+=n)==r)return o[a++]=s,o[a++]=l,a}while(s==c&&l==u);for(;t<r;){var p=$i(e[t],i),h=$i(e[t+1],i);if(t+=n,p!=s||h!=l){var d=s-c,f=l-u,g=p-c,y=h-u;d*y==f*g&&(d<0&&g<d||d==g||d>0&&g>d)&&(f<0&&y<f||f==y||f>0&&y>f)?(s=p,l=h):(o[a++]=s,o[a++]=l,c=s,u=l,s=p,l=h)}}return o[a++]=s,o[a++]=l,a}function Qi(e,t,r,n,i,o,a,s){for(var l=0,c=r.length;l<c;++l){var u=r[l];a=Ji(e,t,u,n,i,o,a),s.push(a),t=u}return a}function eo(e,t,r,n,i){for(var o=void 0!==i?i:[],a=0,s=t;s<r;s+=n)o[a++]=e.slice(s,s+n);return o.length=a,o}function to(e,t,r,n,i){for(var o=void 0!==i?i:[],a=0,s=0,l=r.length;s<l;++s){var c=r[s];o[a++]=eo(e,t,c,n,o[a]),t=c}return o.length=a,o}function ro(e,t,r,n,i){for(var o=void 0!==i?i:[],a=0,s=0,l=r.length;s<l;++s){var c=r[s];o[a++]=to(e,t,c,n,o[a]),t=c[c.length-1]}return o.length=a,o}function no(e,t,r,n){for(var i=0,o=e[r-n],a=e[r-n+1];t<r;t+=n){var s=e[t],l=e[t+1];i+=a*s-o*l,o=s,a=l}return i/2}function io(e,t,r,n){for(var i=0,o=0,a=r.length;o<a;++o){var s=r[o];i+=no(e,t,s,n),t=s}return i}var oo=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ao=function(e){function t(t,r){var n=e.call(this)||this;return n.maxDelta_=-1,n.maxDeltaRevision_=-1,void 0===r||Array.isArray(t[0])?n.setCoordinates(t,r):n.setFlatCoordinates(r,t),n}return oo(t,e),t.prototype.clone=function(){return new t(this.flatCoordinates.slice(),this.layout)},t.prototype.closestPointXY=function(e,t,r,n){return n<J(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ji(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Hi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,r,n))},t.prototype.getArea=function(){return no(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},t.prototype.getCoordinates=function(){return eo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},t.prototype.getSimplifiedGeometryInternal=function(e){var r=[];return r.length=Ki(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,r,0),new t(r,Pi.XY)},t.prototype.getType=function(){return"LinearRing"},t.prototype.intersectsExtent=function(e){return!1},t.prototype.setCoordinates=function(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=zi(this.flatCoordinates,0,e,this.stride),this.changed()},t}(Bi);const so=ao;var lo=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),co=function(e){function t(t,r){var n=e.call(this)||this;return n.setCoordinates(t,r),n}return lo(t,e),t.prototype.clone=function(){var e=new t(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e},t.prototype.closestPointXY=function(e,t,r,n){var i=this.flatCoordinates,o=Ne(e,t,i[0],i[1]);if(o<n){for(var a=this.stride,s=0;s<a;++s)r[s]=i[s];return r.length=a,o}return n},t.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},t.prototype.computeExtent=function(e){return ae(this.flatCoordinates,e)},t.prototype.getType=function(){return"Point"},t.prototype.intersectsExtent=function(e){return te(e,this.flatCoordinates[0],this.flatCoordinates[1])},t.prototype.setCoordinates=function(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Vi(this.flatCoordinates,0,e,this.stride),this.changed()},t}(Bi);const uo=co;function po(e,t,r,n,i){return!de(i,(function(i){return!ho(e,t,r,n,i[0],i[1])}))}function ho(e,t,r,n,i,o){for(var a=0,s=e[r-n],l=e[r-n+1];t<r;t+=n){var c=e[t],u=e[t+1];l<=o?u>o&&(c-s)*(o-l)-(i-s)*(u-l)>0&&a++:u<=o&&(c-s)*(o-l)-(i-s)*(u-l)<0&&a--,s=c,l=u}return 0!==a}function fo(e,t,r,n,i,o){if(0===r.length)return!1;if(!ho(e,t,r[0],n,i,o))return!1;for(var a=1,s=r.length;a<s;++a)if(ho(e,r[a-1],r[a],n,i,o))return!1;return!0}function go(e,t,r,n,i,o,a){for(var s,c,u,p,h,d,f,g=i[o+1],y=[],m=0,v=r.length;m<v;++m){var _=r[m];for(p=e[_-n],d=e[_-n+1],s=t;s<_;s+=n)h=e[s],f=e[s+1],(g<=d&&f<=g||d<=g&&g<=f)&&(u=(g-d)/(f-d)*(h-p)+p,y.push(u)),p=h,d=f}var w=NaN,S=-1/0;for(y.sort(l),p=y[0],s=1,c=y.length;s<c;++s){h=y[s];var E=Math.abs(h-p);E>S&&fo(e,t,r,n,u=(p+h)/2,g)&&(w=u,S=E),p=h}return isNaN(w)&&(w=i[o]),a?(a.push(w,g,S),a):[w,g,S]}function yo(e,t,r,n,i){var o;for(t+=n;t<r;t+=n)if(o=i(e.slice(t-n,t),e.slice(t,t+n)))return o;return!1}function mo(e,t,r,n,i){var o=pe([1/0,1/0,-1/0,-1/0],e,t,r,n);return!!Te(i,o)&&(!!ee(i,o)||(o[0]>=i[0]&&o[2]<=i[2]||(o[1]>=i[1]&&o[3]<=i[3]||yo(e,t,r,n,(function(e,t){return function(e,t,r){var n=!1,i=re(e,t),o=re(e,r);if(i===H||o===H)n=!0;else{var a=e[0],s=e[1],l=e[2],c=e[3],u=t[0],p=t[1],h=r[0],d=r[1],f=(d-p)/(h-u),g=void 0,y=void 0;o&q&&!(i&q)&&(n=(g=h-(d-c)/f)>=a&&g<=l),n||!(o&V)||i&V||(n=(y=d-(h-l)*f)>=s&&y<=c),n||!(o&z)||i&z||(n=(g=h-(d-s)/f)>=a&&g<=l),n||!(o&Y)||i&Y||(n=(y=d-(h-a)*f)>=s&&y<=c)}return n}(i,e,t)})))))}function vo(e,t,r,n,i){return!!mo(e,t,r,n,i)||(!!ho(e,t,r,n,i[0],i[1])||(!!ho(e,t,r,n,i[0],i[3])||(!!ho(e,t,r,n,i[2],i[1])||!!ho(e,t,r,n,i[2],i[3]))))}function _o(e,t,r,n,i){if(!vo(e,t,r[0],n,i))return!1;if(1===r.length)return!0;for(var o=1,a=r.length;o<a;++o)if(po(e,r[o-1],r[o],n,i)&&!mo(e,r[o-1],r[o],n,i))return!1;return!0}function wo(e,t,r,n){for(;t<r-n;){for(var i=0;i<n;++i){var o=e[t+i];e[t+i]=e[r-n+i],e[r-n+i]=o}t+=n,r-=n}}function So(e,t,r,n){for(var i=0,o=e[r-n],a=e[r-n+1];t<r;t+=n){var s=e[t],l=e[t+1];i+=(s-o)*(l+a),o=s,a=l}return 0===i?void 0:i>0}function Eo(e,t,r,n,i){for(var o=void 0!==i&&i,a=0,s=r.length;a<s;++a){var l=r[a],c=So(e,t,l,n);if(0===a){if(o&&c||!o&&!c)return!1}else if(o&&!c||!o&&c)return!1;t=l}return!0}function bo(e,t,r,n,i){for(var o=void 0!==i&&i,a=0,s=r.length;a<s;++a){var l=r[a],c=So(e,t,l,n);(0===a?o&&c||!o&&!c:o&&!c||!o&&c)&&wo(e,t,l,n),t=l}return t}function Co(e,t,r,n,i){for(var o=0,a=r.length;o<a;++o)t=bo(e,t,r[o],n,i);return t}var Lo=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),To=function(e){function t(t,r,n){var i=e.call(this)||this;return i.ends_=[],i.flatInteriorPointRevision_=-1,i.flatInteriorPoint_=null,i.maxDelta_=-1,i.maxDeltaRevision_=-1,i.orientedRevision_=-1,i.orientedFlatCoordinates_=null,void 0!==r&&n?(i.setFlatCoordinates(r,t),i.ends_=n):i.setCoordinates(t,r),i}return Lo(t,e),t.prototype.appendLinearRing=function(e){this.flatCoordinates?h(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},t.prototype.clone=function(){var e=new t(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e},t.prototype.closestPointXY=function(e,t,r,n){return n<J(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Wi(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),qi(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,r,n))},t.prototype.containsXY=function(e,t){return fo(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)},t.prototype.getArea=function(){return io(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},t.prototype.getCoordinates=function(e){var t;return void 0!==e?bo(t=this.getOrientedFlatCoordinates().slice(),0,this.ends_,this.stride,e):t=this.flatCoordinates,to(t,0,this.ends_,this.stride)},t.prototype.getEnds=function(){return this.ends_},t.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var e=me(this.getExtent());this.flatInteriorPoint_=go(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},t.prototype.getInteriorPoint=function(){return new uo(this.getFlatInteriorPoint(),Pi.XYM)},t.prototype.getLinearRingCount=function(){return this.ends_.length},t.prototype.getLinearRing=function(e){return e<0||this.ends_.length<=e?null:new so(this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e]),this.layout)},t.prototype.getLinearRings=function(){for(var e=this.layout,t=this.flatCoordinates,r=this.ends_,n=[],i=0,o=0,a=r.length;o<a;++o){var s=r[o],l=new so(t.slice(i,s),e);n.push(l),i=s}return n},t.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var e=this.flatCoordinates;Eo(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=bo(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},t.prototype.getSimplifiedGeometryInternal=function(e){var r=[],n=[];return r.length=Qi(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),r,0,n),new t(r,Pi.XY,n)},t.prototype.getType=function(){return"Polygon"},t.prototype.intersectsExtent=function(e){return _o(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)},t.prototype.setCoordinates=function(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);var r=Yi(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=0===r.length?0:r[r.length-1],this.changed()},t}(Bi);const Ao=To;function xo(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=[t,r,t,i,n,i,n,r,t,r];return new To(o,Pi.XY,[o.length])}function Po(e,t,r){for(var n=t||32,i=e.getStride(),o=e.getLayout(),a=e.getCenter(),s=i*(n+1),l=new Array(s),c=0;c<s;c+=i){l[c]=0,l[c+1]=0;for(var u=2;u<i;u++)l[c+u]=a[u]}var p=[l.length],h=new To(l,o,p);return function(e,t,r,n){for(var i=e.getFlatCoordinates(),o=e.getStride(),a=i.length/o-1,s=n||0,l=0;l<=a;++l){var c=l*o,u=s+2*ke(l,a)*Math.PI/a;i[c]=t[0]+r*Math.cos(u),i[c+1]=t[1]+r*Math.sin(u)}e.changed()}(h,a,e.getRadius(),r),h}var Oo=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Io=function(e){function t(t){var r=e.call(this)||this;r.on,r.once,r.un;var n=nt({},t);return r.hints_=[0,0],r.animations_=[],r.updateAnimationKey_,r.projection_=ei(n.projection,"EPSG:3857"),r.viewportSize_=[100,100],r.targetCenter_=null,r.targetResolution_,r.targetRotation_,r.nextCenter_=null,r.nextResolution_,r.nextRotation_,r.cancelAnchor_=void 0,n.projection&&zn(),n.center&&(n.center=di(n.center,r.projection_)),n.extent&&(n.extent=gi(n.extent,r.projection_)),r.applyOptions_(n),r}return Oo(t,e),t.prototype.applyOptions_=function(e){var t=nt({},e);for(var r in En)delete t[r];this.setProperties(t,!0);var n=function(e){var t,r,n,i=28,o=2,a=void 0!==e.minZoom?e.minZoom:0,s=void 0!==e.maxZoom?e.maxZoom:i,l=void 0!==e.zoomFactor?e.zoomFactor:o,c=void 0!==e.multiWorld&&e.multiWorld,p=void 0===e.smoothResolutionConstraint||e.smoothResolutionConstraint,h=void 0!==e.showFullExtent&&e.showFullExtent,d=ei(e.projection,"EPSG:3857"),f=d.getExtent(),g=e.constrainOnlyCenter,y=e.extent;c||y||!d.isGlobal()||(g=!1,y=f);if(void 0!==e.resolutions){var m=e.resolutions;r=m[a],n=void 0!==m[s]?m[s]:m[m.length-1],t=e.constrainResolution?function(e,t,r,n){return function(i,o,a,s){if(void 0!==i){var l=e[0],c=e[e.length-1],p=r?wi(l,r,a,n):l;if(s)return void 0===t||t?Si(i,p,c):Ie(i,c,p);var h=Math.min(p,i),d=Math.floor(u(e,h,o));return e[d]>p&&d<e.length-1?e[d+1]:e[d]}}}(m,p,!g&&y,h):Ei(r,n,p,!g&&y,h)}else{var v=(f?Math.max(Le(f),Se(f)):360*vn[_n.DEGREES]/d.getMetersPerUnit())/bn/Math.pow(o,0),_=v/Math.pow(o,i-0);void 0!==(r=e.maxResolution)?a=0:r=v/Math.pow(l,a),void 0===(n=e.minResolution)&&(n=void 0!==e.maxZoom?void 0!==e.maxResolution?r/Math.pow(l,s):v/Math.pow(l,s):_),s=a+Math.floor(Math.log(r/n)/Math.log(l)),n=r/Math.pow(l,s-a),t=e.constrainResolution?function(e,t,r,n,i,o){return function(a,s,l,c){if(void 0!==a){var u=i?wi(t,i,l,o):t,p=void 0!==r?r:0;if(c)return void 0===n||n?Si(a,u,p):Ie(a,p,u);var h=Math.ceil(Math.log(t/u)/Math.log(e)-1e-9),d=-s*(.5-1e-9)+.5,f=Math.min(u,a),g=Math.floor(Math.log(t/f)/Math.log(e)+d),y=Math.max(h,g);return Ie(t/Math.pow(e,y),p,u)}}}(l,r,n,p,!g&&y,h):Ei(r,n,p,!g&&y,h)}return{constraint:t,maxResolution:r,minResolution:n,minZoom:a,zoomFactor:l}}(e);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=n.minZoom;var i=function(e){if(void 0!==e.extent){var t=void 0===e.smoothExtentConstraint||e.smoothExtentConstraint;return vi(e.extent,e.constrainOnlyCenter,t)}var r=ei(e.projection,"EPSG:3857");if(!0!==e.multiWorld&&r.isGlobal()){var n=r.getExtent().slice();return n[0]=-1/0,n[2]=1/0,vi(n,!1,!1)}return _i}(e),o=n.constraint,a=function(e){if(void 0===e.enableRotation||e.enableRotation){var t=e.constrainRotation;return void 0===t||!0===t?(o=i||Ze(5),function(e,t){return t?e:void 0!==e?Math.abs(e)<=o?0:e:void 0}):!1===t?Ci:"number"==typeof t?(r=t,n=2*Math.PI/r,function(e,t){return t?e:void 0!==e?e=Math.floor(e/n+.5)*n:void 0}):Ci}return bi;var r,n;var i,o}(e);this.constraints_={center:i,resolution:o,rotation:a},this.setRotation(void 0!==e.rotation?e.rotation:0),this.setCenterInternal(void 0!==e.center?e.center:null),void 0!==e.resolution?this.setResolution(e.resolution):void 0!==e.zoom&&this.setZoom(e.zoom)},Object.defineProperty(t.prototype,"padding",{get:function(){return this.padding_},set:function(e){var t=this.padding_;this.padding_=e;var r=this.getCenter();if(r){var n=e||[0,0,0,0];t=t||[0,0,0,0];var i=this.getResolution(),o=i/2*(n[3]-t[3]+t[1]-n[1]),a=i/2*(n[0]-t[0]+t[2]-n[2]);this.setCenterInternal([r[0]+o,r[1]-a])}},enumerable:!1,configurable:!0}),t.prototype.getUpdatedOptions_=function(e){var t=this.getProperties();return void 0!==t.resolution?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),nt({},t,e)},t.prototype.animate=function(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);for(var t=new Array(arguments.length),r=0;r<t.length;++r){var n=arguments[r];n.center&&((n=nt({},n)).center=di(n.center,this.getProjection())),n.anchor&&((n=nt({},n)).anchor=di(n.anchor,this.getProjection())),t[r]=n}this.animateInternal.apply(this,t)},t.prototype.animateInternal=function(e){var t,r=arguments.length;r>1&&"function"==typeof arguments[r-1]&&(t=arguments[r-1],--r);for(var n=0;n<r&&!this.isDef();++n){var i=arguments[n];i.center&&this.setCenterInternal(i.center),void 0!==i.zoom?this.setZoom(i.zoom):i.resolution&&this.setResolution(i.resolution),void 0!==i.rotation&&this.setRotation(i.rotation)}if(n!==r){for(var o=Date.now(),a=this.targetCenter_.slice(),s=this.targetResolution_,l=this.targetRotation_,c=[];n<r;++n){var u=arguments[n],p={start:o,complete:!1,anchor:u.anchor,duration:void 0!==u.duration?u.duration:1e3,easing:u.easing||Ai,callback:t};if(u.center&&(p.sourceCenter=a,p.targetCenter=u.center.slice(),a=p.targetCenter),void 0!==u.zoom?(p.sourceResolution=s,p.targetResolution=this.getResolutionForZoom(u.zoom),s=p.targetResolution):u.resolution&&(p.sourceResolution=s,p.targetResolution=u.resolution,s=p.targetResolution),void 0!==u.rotation){p.sourceRotation=l;var h=ke(u.rotation-l+Math.PI,2*Math.PI)-Math.PI;p.targetRotation=l+h,l=p.targetRotation}Mo(p)?p.complete=!0:o+=p.duration,c.push(p)}this.animations_.push(c),this.setHint(wn,1),this.updateAnimations_()}else t&&Ro(t,!0)},t.prototype.getAnimating=function(){return this.hints_[wn]>0},t.prototype.getInteracting=function(){return this.hints_[Sn]>0},t.prototype.cancelAnimations=function(){var e;this.setHint(wn,-this.hints_[wn]);for(var t=0,r=this.animations_.length;t<r;++t){var n=this.animations_[t];if(n[0].callback&&Ro(n[0].callback,!1),!e)for(var i=0,o=n.length;i<o;++i){var a=n[i];if(!a.complete){e=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN},t.prototype.updateAnimations_=function(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),this.getAnimating()){for(var e=Date.now(),t=!1,r=this.animations_.length-1;r>=0;--r){for(var n=this.animations_[r],i=!0,o=0,a=n.length;o<a;++o){var s=n[o];if(!s.complete){var l=e-s.start,c=s.duration>0?l/s.duration:1;c>=1?(s.complete=!0,c=1):i=!1;var u=s.easing(c);if(s.sourceCenter){var p=s.sourceCenter[0],h=s.sourceCenter[1],d=s.targetCenter[0],f=s.targetCenter[1];this.nextCenter_=s.targetCenter;var g=p+u*(d-p),y=h+u*(f-h);this.targetCenter_=[g,y]}if(s.sourceResolution&&s.targetResolution){var m=1===u?s.targetResolution:s.sourceResolution+u*(s.targetResolution-s.sourceResolution);if(s.anchor){var v=this.getViewportSize_(this.getRotation()),_=this.constraints_.resolution(m,0,v,!0);this.targetCenter_=this.calculateCenterZoom(_,s.anchor)}this.nextResolution_=s.targetResolution,this.targetResolution_=m,this.applyTargetState_(!0)}if(void 0!==s.sourceRotation&&void 0!==s.targetRotation){var w=1===u?ke(s.targetRotation+Math.PI,2*Math.PI)-Math.PI:s.sourceRotation+u*(s.targetRotation-s.sourceRotation);if(s.anchor){var S=this.constraints_.rotation(w,!0);this.targetCenter_=this.calculateCenterRotate(S,s.anchor)}this.nextRotation_=s.targetRotation,this.targetRotation_=w}if(this.applyTargetState_(!0),t=!0,!s.complete)break}}if(i){this.animations_[r]=null,this.setHint(wn,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;var E=n[0].callback;E&&Ro(E,!0)}}this.animations_=this.animations_.filter(Boolean),t&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}},t.prototype.calculateCenterRotate=function(e,t){var r,n=this.getCenterInternal();return void 0!==n&&(Bt(r=[n[0]-t[0],n[1]-t[1]],e-this.getRotation()),Zt(r,t)),r},t.prototype.calculateCenterZoom=function(e,t){var r,n=this.getCenterInternal(),i=this.getResolution();void 0!==n&&void 0!==i&&(r=[t[0]-e*(t[0]-n[0])/i,t[1]-e*(t[1]-n[1])/i]);return r},t.prototype.getViewportSize_=function(e){var t=this.viewportSize_;if(e){var r=t[0],n=t[1];return[Math.abs(r*Math.cos(e))+Math.abs(n*Math.sin(e)),Math.abs(r*Math.sin(e))+Math.abs(n*Math.cos(e))]}return t},t.prototype.setViewportSize=function(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)},t.prototype.getCenter=function(){var e=this.getCenterInternal();return e?hi(e,this.getProjection()):e},t.prototype.getCenterInternal=function(){return this.get(En.CENTER)},t.prototype.getConstraints=function(){return this.constraints_},t.prototype.getConstrainResolution=function(){return this.get("constrainResolution")},t.prototype.getHints=function(e){return void 0!==e?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()},t.prototype.calculateExtent=function(e){return fi(this.calculateExtentInternal(e),this.getProjection())},t.prototype.calculateExtentInternal=function(e){var t=e||this.getViewportSizeMinusPadding_(),r=this.getCenterInternal();I(r,1);var n=this.getResolution();I(void 0!==n,2);var i=this.getRotation();return I(void 0!==i,3),_e(r,n,i,t)},t.prototype.getMaxResolution=function(){return this.maxResolution_},t.prototype.getMinResolution=function(){return this.minResolution_},t.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)},t.prototype.setMaxZoom=function(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))},t.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)},t.prototype.setMinZoom=function(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))},t.prototype.setConstrainResolution=function(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))},t.prototype.getProjection=function(){return this.projection_},t.prototype.getResolution=function(){return this.get(En.RESOLUTION)},t.prototype.getResolutions=function(){return this.resolutions_},t.prototype.getResolutionForExtent=function(e,t){return this.getResolutionForExtentInternal(gi(e,this.getProjection()),t)},t.prototype.getResolutionForExtentInternal=function(e,t){var r=t||this.getViewportSizeMinusPadding_(),n=Le(e)/r[0],i=Se(e)/r[1];return Math.max(n,i)},t.prototype.getResolutionForValueFunction=function(e){var t=e||2,r=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,i=Math.log(r/n)/Math.log(t);return function(e){return r/Math.pow(t,e*i)}},t.prototype.getRotation=function(){return this.get(En.ROTATION)},t.prototype.getValueForResolutionFunction=function(e){var t=Math.log(e||2),r=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,i=Math.log(r/n)/t;return function(e){return Math.log(r/e)/t/i}},t.prototype.getViewportSizeMinusPadding_=function(e){var t=this.getViewportSize_(e),r=this.padding_;return r&&(t=[t[0]-r[1]-r[3],t[1]-r[0]-r[2]]),t},t.prototype.getState=function(){var e=this.getProjection(),t=this.getResolution(),r=this.getRotation(),n=this.getCenterInternal(),i=this.padding_;if(i){var o=this.getViewportSizeMinusPadding_();n=Do(n,this.getViewportSize_(),[o[0]/2+i[3],o[1]/2+i[0]],t,r)}return{center:n.slice(0),projection:void 0!==e?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:r,zoom:this.getZoom()}},t.prototype.getZoom=function(){var e,t=this.getResolution();return void 0!==t&&(e=this.getZoomForResolution(t)),e},t.prototype.getZoomForResolution=function(e){var t,r,n=this.minZoom_||0;if(this.resolutions_){var i=u(this.resolutions_,e,1);n=i,t=this.resolutions_[i],r=i==this.resolutions_.length-1?2:t/this.resolutions_[i+1]}else t=this.maxResolution_,r=this.zoomFactor_;return n+Math.log(t/e)/Math.log(r)},t.prototype.getResolutionForZoom=function(e){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;var t=Ie(Math.floor(e),0,this.resolutions_.length-2),r=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(r,Ie(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)},t.prototype.fit=function(e,t){var r;if(I(Array.isArray(e)||"function"==typeof e.getSimplifiedGeometry,24),Array.isArray(e))I(!Ae(e),25),r=xo(n=gi(e,this.getProjection()));else if("Circle"===e.getType()){var n;(r=xo(n=gi(e.getExtent(),this.getProjection()))).rotate(this.getRotation(),me(n))}else{var i=pi();r=i?e.clone().transform(i,this.getProjection()):e}this.fitInternal(r,t)},t.prototype.rotatedExtentForGeometry=function(e){for(var t=this.getRotation(),r=Math.cos(t),n=Math.sin(-t),i=e.getFlatCoordinates(),o=e.getStride(),a=1/0,s=1/0,l=-1/0,c=-1/0,u=0,p=i.length;u<p;u+=o){var h=i[u]*r-i[u+1]*n,d=i[u]*n+i[u+1]*r;a=Math.min(a,h),s=Math.min(s,d),l=Math.max(l,h),c=Math.max(c,d)}return[a,s,l,c]},t.prototype.fitInternal=function(e,t){var r=t||{},n=r.size;n||(n=this.getViewportSizeMinusPadding_());var i,o=void 0!==r.padding?r.padding:[0,0,0,0],a=void 0!==r.nearest&&r.nearest;i=void 0!==r.minResolution?r.minResolution:void 0!==r.maxZoom?this.getResolutionForZoom(r.maxZoom):0;var s=this.rotatedExtentForGeometry(e),l=this.getResolutionForExtentInternal(s,[n[0]-o[1]-o[3],n[1]-o[0]-o[2]]);l=isNaN(l)?i:Math.max(l,i),l=this.getConstrainedResolution(l,a?0:1);var c=this.getRotation(),u=Math.sin(c),p=Math.cos(c),h=me(s);h[0]+=(o[1]-o[3])/2*l,h[1]+=(o[0]-o[2])/2*l;var d=h[0]*p-h[1]*u,f=h[1]*p+h[0]*u,g=this.getConstrainedCenter([d,f],l),y=r.callback?r.callback:v;void 0!==r.duration?this.animateInternal({resolution:l,center:g,duration:r.duration,easing:r.easing},y):(this.targetResolution_=l,this.targetCenter_=g,this.applyTargetState_(!1,!0),Ro(y,!0))},t.prototype.centerOn=function(e,t,r){this.centerOnInternal(di(e,this.getProjection()),t,r)},t.prototype.centerOnInternal=function(e,t,r){this.setCenterInternal(Do(e,t,r,this.getResolution(),this.getRotation()))},t.prototype.calculateCenterShift=function(e,t,r,n){var i,o=this.padding_;if(o&&e){var a=this.getViewportSizeMinusPadding_(-r),s=Do(e,n,[a[0]/2+o[3],a[1]/2+o[0]],t,r);i=[e[0]-s[0],e[1]-s[1]]}return i},t.prototype.isDef=function(){return!!this.getCenterInternal()&&void 0!==this.getResolution()},t.prototype.adjustCenter=function(e){var t=hi(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])},t.prototype.adjustCenterInternal=function(e){var t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])},t.prototype.adjustResolution=function(e,t){var r=t&&di(t,this.getProjection());this.adjustResolutionInternal(e,r)},t.prototype.adjustResolutionInternal=function(e,t){var r=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),i=this.constraints_.resolution(this.targetResolution_*e,0,n,r);t&&(this.targetCenter_=this.calculateCenterZoom(i,t)),this.targetResolution_*=e,this.applyTargetState_()},t.prototype.adjustZoom=function(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)},t.prototype.adjustRotation=function(e,t){t&&(t=di(t,this.getProjection())),this.adjustRotationInternal(e,t)},t.prototype.adjustRotationInternal=function(e,t){var r=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+e,r);t&&(this.targetCenter_=this.calculateCenterRotate(n,t)),this.targetRotation_+=e,this.applyTargetState_()},t.prototype.setCenter=function(e){this.setCenterInternal(e?di(e,this.getProjection()):e)},t.prototype.setCenterInternal=function(e){this.targetCenter_=e,this.applyTargetState_()},t.prototype.setHint=function(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]},t.prototype.setResolution=function(e){this.targetResolution_=e,this.applyTargetState_()},t.prototype.setRotation=function(e){this.targetRotation_=e,this.applyTargetState_()},t.prototype.setZoom=function(e){this.setResolution(this.getResolutionForZoom(e))},t.prototype.applyTargetState_=function(e,t){var r=this.getAnimating()||this.getInteracting()||t,n=this.constraints_.rotation(this.targetRotation_,r),i=this.getViewportSize_(n),o=this.constraints_.resolution(this.targetResolution_,0,i,r),a=this.constraints_.center(this.targetCenter_,o,i,r,this.calculateCenterShift(this.targetCenter_,o,n,i));this.get(En.ROTATION)!==n&&this.set(En.ROTATION,n),this.get(En.RESOLUTION)!==o&&(this.set(En.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),a&&this.get(En.CENTER)&&Ut(this.get(En.CENTER),a)||this.set(En.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0},t.prototype.resolveConstraints=function(e,t,r){var n=void 0!==e?e:200,i=t||0,o=this.constraints_.rotation(this.targetRotation_),a=this.getViewportSize_(o),s=this.constraints_.resolution(this.targetResolution_,i,a),l=this.constraints_.center(this.targetCenter_,s,a,!1,this.calculateCenterShift(this.targetCenter_,s,o,a));if(0===n&&!this.cancelAnchor_)return this.targetResolution_=s,this.targetRotation_=o,this.targetCenter_=l,void this.applyTargetState_();var c=r||(0===n?this.cancelAnchor_:void 0);this.cancelAnchor_=void 0,this.getResolution()===s&&this.getRotation()===o&&this.getCenterInternal()&&Ut(this.getCenterInternal(),l)||(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:o,center:l,resolution:s,duration:n,easing:Ti,anchor:c}))},t.prototype.beginInteraction=function(){this.resolveConstraints(0),this.setHint(Sn,1)},t.prototype.endInteraction=function(e,t,r){var n=r&&di(r,this.getProjection());this.endInteractionInternal(e,t,n)},t.prototype.endInteractionInternal=function(e,t,r){this.setHint(Sn,-1),this.resolveConstraints(e,t,r)},t.prototype.getConstrainedCenter=function(e,t){var r=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),r)},t.prototype.getConstrainedZoom=function(e,t){var r=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(r,t))},t.prototype.getConstrainedResolution=function(e,t){var r=t||0,n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,r,n)},t}(_t);function Ro(e,t){setTimeout((function(){e(t)}),0)}function Mo(e){return!(e.sourceCenter&&e.targetCenter&&!Ut(e.sourceCenter,e.targetCenter))&&(e.sourceResolution===e.targetResolution&&e.sourceRotation===e.targetRotation)}function Do(e,t,r,n,i){var o=Math.cos(-i),a=Math.sin(-i),s=e[0]*o-e[1]*a,l=e[1]*o+e[0]*a;return[(s+=(t[0]/2-r[0])*n)*o-(l+=(r[1]-t[1]/2)*n)*(a=-a),l*o+s*a]}const No=Io;function Zo(e){return e[0]>0&&e[1]>0}function ko(e,t){return Array.isArray(e)?e:(void 0===t?t=[e,e]:(t[0]=e,t[1]=e),t)}var Fo=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function Uo(e){e instanceof Nt?e.setMapInternal(null):e instanceof Hr&&e.getLayers().forEach(Uo)}function Bo(e,t){if(e instanceof Nt)e.setMapInternal(t);else if(e instanceof Hr)for(var r=e.getLayers().getArray(),n=0,i=r.length;n<i;++n)Bo(r[n],t)}var Go=function(e){function t(t){var r=e.call(this)||this;r.on,r.once,r.un;var n=function(e){var t=null;void 0!==e.keyboardEventTarget&&(t="string"==typeof e.keyboardEventTarget?document.getElementById(e.keyboardEventTarget):e.keyboardEventTarget);var r,n,i,o={},a=e.layers&&"function"==typeof e.layers.getLayers?e.layers:new Hr({layers:e.layers});o[rn]=a,o[on]=e.target,o[an]=e.view instanceof No?e.view:new No,void 0!==e.controls&&(Array.isArray(e.controls)?r=new Br(e.controls.slice()):(I("function"==typeof e.controls.getArray,47),r=e.controls));void 0!==e.interactions&&(Array.isArray(e.interactions)?n=new Br(e.interactions.slice()):(I("function"==typeof e.interactions.getArray,48),n=e.interactions));void 0!==e.overlays?Array.isArray(e.overlays)?i=new Br(e.overlays.slice()):(I("function"==typeof e.overlays.getArray,49),i=e.overlays):i=new Br;return{controls:r,interactions:n,keyboardEventTarget:t,overlays:i,values:o}}(t);r.renderComplete_,r.loaded_=!0,r.boundHandleBrowserEvent_=r.handleBrowserEvent.bind(r),r.maxTilesLoading_=void 0!==t.maxTilesLoading?t.maxTilesLoading:16,r.pixelRatio_=void 0!==t.pixelRatio?t.pixelRatio:L,r.postRenderTimeoutHandle_,r.animationDelayKey_,r.animationDelay_=function(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}.bind(r),r.coordinateToPixelTransform_=[1,0,0,1,0,0],r.pixelToCoordinateTransform_=[1,0,0,1,0,0],r.frameIndex_=0,r.frameState_=null,r.previousExtent_=null,r.viewPropertyListenerKey_=null,r.viewChangeListenerKey_=null,r.layerGroupPropertyListenerKeys_=null,r.viewport_=document.createElement("div"),r.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),r.viewport_.style.position="relative",r.viewport_.style.overflow="hidden",r.viewport_.style.width="100%",r.viewport_.style.height="100%",r.overlayContainer_=document.createElement("div"),r.overlayContainer_.style.position="absolute",r.overlayContainer_.style.zIndex="0",r.overlayContainer_.style.width="100%",r.overlayContainer_.style.height="100%",r.overlayContainer_.style.pointerEvents="none",r.overlayContainer_.className="ol-overlaycontainer",r.viewport_.appendChild(r.overlayContainer_),r.overlayContainerStopEvent_=document.createElement("div"),r.overlayContainerStopEvent_.style.position="absolute",r.overlayContainerStopEvent_.style.zIndex="0",r.overlayContainerStopEvent_.style.width="100%",r.overlayContainerStopEvent_.style.height="100%",r.overlayContainerStopEvent_.style.pointerEvents="none",r.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",r.viewport_.appendChild(r.overlayContainerStopEvent_),r.mapBrowserEventHandler_=null,r.moveTolerance_=t.moveTolerance,r.keyboardEventTarget_=n.keyboardEventTarget,r.targetChangeHandlerKeys_=null,r.controls=n.controls||new Br,r.interactions=n.interactions||new Br,r.overlays_=n.overlays,r.overlayIdIndex_={},r.renderer_=null,r.postRenderFunctions_=[],r.tileQueue_=new yn(r.getTilePriority.bind(r),r.handleTileChange_.bind(r)),r.addChangeListener(rn,r.handleLayerGroupChanged_),r.addChangeListener(an,r.handleViewChanged_),r.addChangeListener(nn,r.handleSizeChanged_),r.addChangeListener(on,r.handleTargetChanged_),r.setProperties(n.values);var i=r;return!t.view||t.view instanceof No||t.view.then((function(e){i.setView(new No(e))})),r.controls.addEventListener(Nr,function(e){e.element.setMap(this)}.bind(r)),r.controls.addEventListener(Zr,function(e){e.element.setMap(null)}.bind(r)),r.interactions.addEventListener(Nr,function(e){e.element.setMap(this)}.bind(r)),r.interactions.addEventListener(Zr,function(e){e.element.setMap(null)}.bind(r)),r.overlays_.addEventListener(Nr,function(e){this.addOverlayInternal_(e.element)}.bind(r)),r.overlays_.addEventListener(Zr,function(e){var t=e.element.getId();void 0!==t&&delete this.overlayIdIndex_[t.toString()],e.element.setMap(null)}.bind(r)),r.controls.forEach(function(e){e.setMap(this)}.bind(r)),r.interactions.forEach(function(e){e.setMap(this)}.bind(r)),r.overlays_.forEach(r.addOverlayInternal_.bind(r)),r}return Fo(t,e),t.prototype.createRenderer=function(){throw new Error("Use a map type that has a createRenderer method")},t.prototype.addControl=function(e){this.getControls().push(e)},t.prototype.addInteraction=function(e){this.getInteractions().push(e)},t.prototype.addLayer=function(e){this.getLayerGroup().getLayers().push(e)},t.prototype.handleLayerAdd_=function(e){Bo(e.layer,this)},t.prototype.addOverlay=function(e){this.getOverlays().push(e)},t.prototype.addOverlayInternal_=function(e){var t=e.getId();void 0!==t&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)},t.prototype.disposeInternal=function(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.setTarget(null),e.prototype.disposeInternal.call(this)},t.prototype.forEachFeatureAtPixel=function(e,t,r){if(this.frameState_&&this.renderer_){var n=this.getCoordinateFromPixelInternal(e),i=void 0!==(r=void 0!==r?r:{}).hitTolerance?r.hitTolerance:0,o=void 0!==r.layerFilter?r.layerFilter:y,a=!1!==r.checkWrapped;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,i,a,t,null,o,null)}},t.prototype.getFeaturesAtPixel=function(e,t){var r=[];return this.forEachFeatureAtPixel(e,(function(e){r.push(e)}),t),r},t.prototype.getAllLayers=function(){var e=[];return function t(r){r.forEach((function(r){r instanceof Hr?t(r.getLayers()):e.push(r)}))}(this.getLayers()),e},t.prototype.forEachLayerAtPixel=function(e,t,r){if(this.frameState_&&this.renderer_){var n=r||{},i=void 0!==n.hitTolerance?n.hitTolerance:0,o=n.layerFilter||y;return this.renderer_.forEachLayerAtPixel(e,this.frameState_,i,t,o)}},t.prototype.hasFeatureAtPixel=function(e,t){if(!this.frameState_||!this.renderer_)return!1;var r=this.getCoordinateFromPixelInternal(e),n=void 0!==(t=void 0!==t?t:{}).layerFilter?t.layerFilter:y,i=void 0!==t.hitTolerance?t.hitTolerance:0,o=!1!==t.checkWrapped;return this.renderer_.hasFeatureAtCoordinate(r,this.frameState_,i,o,n,null)},t.prototype.getEventCoordinate=function(e){return this.getCoordinateFromPixel(this.getEventPixel(e))},t.prototype.getEventCoordinateInternal=function(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))},t.prototype.getEventPixel=function(e){var t=this.viewport_.getBoundingClientRect(),r="changedTouches"in e?e.changedTouches[0]:e;return[r.clientX-t.left,r.clientY-t.top]},t.prototype.getTarget=function(){return this.get(on)},t.prototype.getTargetElement=function(){var e=this.getTarget();return void 0!==e?"string"==typeof e?document.getElementById(e):e:null},t.prototype.getCoordinateFromPixel=function(e){return hi(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())},t.prototype.getCoordinateFromPixelInternal=function(e){var t=this.frameState_;return t?k(t.pixelToCoordinateTransform,e.slice()):null},t.prototype.getControls=function(){return this.controls},t.prototype.getOverlays=function(){return this.overlays_},t.prototype.getOverlayById=function(e){var t=this.overlayIdIndex_[e.toString()];return void 0!==t?t:null},t.prototype.getInteractions=function(){return this.interactions},t.prototype.getLayerGroup=function(){return this.get(rn)},t.prototype.setLayers=function(e){var t=this.getLayerGroup();if(e instanceof Br)t.setLayers(e);else{var r=t.getLayers();r.clear(),r.extend(e)}},t.prototype.getLayers=function(){return this.getLayerGroup().getLayers()},t.prototype.getLoadingOrNotReady=function(){for(var e=this.getLayerGroup().getLayerStatesArray(),t=0,r=e.length;t<r;++t){var n=e[t];if(n.visible){var i=n.layer.getRenderer();if(i&&!i.ready)return!0;var o=n.layer.getSource();if(o&&o.loading)return!0}}return!1},t.prototype.getPixelFromCoordinate=function(e){var t=di(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)},t.prototype.getPixelFromCoordinateInternal=function(e){var t=this.frameState_;return t?k(t.coordinateToPixelTransform,e.slice(0,2)):null},t.prototype.getRenderer=function(){return this.renderer_},t.prototype.getSize=function(){return this.get(nn)},t.prototype.getView=function(){return this.get(an)},t.prototype.getViewport=function(){return this.viewport_},t.prototype.getOverlayContainer=function(){return this.overlayContainer_},t.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},t.prototype.getOwnerDocument=function(){var e=this.getTargetElement();return e?e.ownerDocument:document},t.prototype.getTilePriority=function(e,t,r,n){return function(e,t,r,n,i){if(!e||!(r in e.wantedTiles))return sn;if(!e.wantedTiles[r][t.getKey()])return sn;var o=e.viewState.center,a=n[0]-o[0],s=n[1]-o[1];return 65536*Math.log(i)+Math.sqrt(a*a+s*s)/i}(this.frameState_,e,t,r,n)},t.prototype.handleBrowserEvent=function(e,t){var r=t||e.type,n=new Yr(r,this,e);this.handleMapBrowserEvent(n)},t.prototype.handleMapBrowserEvent=function(e){if(this.frameState_){var t=e.originalEvent,r=t.type;if(r===$r||r===ct.WHEEL||r===ct.KEYDOWN){var n=this.getOwnerDocument(),i=this.viewport_.getRootNode?this.viewport_.getRootNode():n,o=t.target;if(this.overlayContainerStopEvent_.contains(o)||!(i===n?n.documentElement:i).contains(o))return}if(e.frameState=this.frameState_,!1!==this.dispatchEvent(e))for(var a=this.getInteractions().getArray().slice(),s=a.length-1;s>=0;s--){var l=a[s];if(l.getMap()===this&&l.getActive()&&this.getTargetElement())if(!l.handleEvent(e)||e.propagationStopped)break}}},t.prototype.handlePostRender=function(){var e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){var r=this.maxTilesLoading_,n=r;if(e){var i=e.viewHints;if(i[wn]||i[Sn]){var o=Date.now()-e.time>8;r=o?0:8,n=o?0:2}}t.getTilesLoading()<r&&(t.reprioritize(),t.loadMoreTiles(r,n))}e&&this.renderer_&&!e.animate&&(!0===this.renderComplete_?(this.hasListener(Rt.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(Rt.RENDERCOMPLETE,e),!1===this.loaded_&&(this.loaded_=!0,this.dispatchEvent(new Vr(tn.LOADEND,this,e)))):!0===this.loaded_&&(this.loaded_=!1,this.dispatchEvent(new Vr(tn.LOADSTART,this,e))));for(var a=this.postRenderFunctions_,s=0,l=a.length;s<l;++s)a[s](this,e);a.length=0},t.prototype.handleSizeChanged_=function(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()},t.prototype.handleTargetChanged_=function(){if(this.mapBrowserEventHandler_){for(var e=0,t=this.targetChangeHandlerKeys_.length;e<t;++e)ht(this.targetChangeHandlerKeys_[e]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(ct.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(ct.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,ur(this.viewport_)}var r=this.getTargetElement();if(r){for(var n in r.appendChild(this.viewport_),this.renderer_||(this.renderer_=this.createRenderer()),this.mapBrowserEventHandler_=new en(this,this.moveTolerance_),Kr)this.mapBrowserEventHandler_.addEventListener(Kr[n],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(ct.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(ct.WHEEL,this.boundHandleBrowserEvent_,!!x&&{passive:!1});var i=this.getOwnerDocument().defaultView,o=this.keyboardEventTarget_?this.keyboardEventTarget_:r;this.targetChangeHandlerKeys_=[ut(o,ct.KEYDOWN,this.handleBrowserEvent,this),ut(o,ct.KEYPRESS,this.handleBrowserEvent,this),ut(i,ct.RESIZE,this.updateSize,this)]}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()},t.prototype.handleTileChange_=function(){this.render()},t.prototype.handleViewPropertyChanged_=function(){this.render()},t.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&(ht(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(ht(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var e=this.getView();e&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=ut(e,rt,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=ut(e,ct.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()},t.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(ht),this.layerGroupPropertyListenerKeys_=null);var e=this.getLayerGroup();e&&(this.handleLayerAdd_(new jr("addlayer",e)),this.layerGroupPropertyListenerKeys_=[ut(e,rt,this.render,this),ut(e,ct.CHANGE,this.render,this),ut(e,"addlayer",this.handleLayerAdd_,this),ut(e,"removelayer",this.handleLayerRemove_,this)]),this.render()},t.prototype.isRendered=function(){return!!this.frameState_},t.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()},t.prototype.redrawText=function(){for(var e=this.getLayerGroup().getLayerStatesArray(),t=0,r=e.length;t<r;++t){var n=e[t].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}},t.prototype.render=function(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))},t.prototype.removeControl=function(e){return this.getControls().remove(e)},t.prototype.removeInteraction=function(e){return this.getInteractions().remove(e)},t.prototype.removeLayer=function(e){return this.getLayerGroup().getLayers().remove(e)},t.prototype.handleLayerRemove_=function(e){Uo(e.layer)},t.prototype.removeOverlay=function(e){return this.getOverlays().remove(e)},t.prototype.renderFrame_=function(e){var t=this,r=this.getSize(),n=this.getView(),i=this.frameState_,a=null;if(void 0!==r&&Zo(r)&&n&&n.isDef()){var s=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),l=n.getState();if(a={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:_e(l.center,l.resolution,l.rotation,r),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:r,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:l,viewHints:s,wantedTiles:{},mapId:o(this),renderTargets:{}},l.nextCenter&&l.nextResolution){var c=isNaN(l.nextRotation)?l.rotation:l.nextRotation;a.nextExtent=_e(l.nextCenter,l.nextResolution,c,r)}}if(this.frameState_=a,this.renderer_.renderFrame(a),a){if(a.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,a.postRenderFunctions),i)(!this.previousExtent_||!Ae(this.previousExtent_)&&!le(a.extent,this.previousExtent_))&&(this.dispatchEvent(new Vr(tn.MOVESTART,this,i)),this.previousExtent_=oe(this.previousExtent_));this.previousExtent_&&!a.viewHints[wn]&&!a.viewHints[Sn]&&!le(a.extent,this.previousExtent_)&&(this.dispatchEvent(new Vr(tn.MOVEEND,this,a)),$(a.extent,this.previousExtent_))}this.dispatchEvent(new Vr(tn.POSTRENDER,this,a)),this.renderComplete_=this.hasListener(tn.LOADSTART)||this.hasListener(tn.LOADEND)||this.hasListener(Rt.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout((function(){t.postRenderTimeoutHandle_=void 0,t.handlePostRender()}),0))},t.prototype.setLayerGroup=function(e){var t=this.getLayerGroup();t&&this.handleLayerRemove_(new jr("removelayer",t)),this.set(rn,e)},t.prototype.setSize=function(e){this.set(nn,e)},t.prototype.setTarget=function(e){this.set(on,e)},t.prototype.setView=function(e){if(!e||e instanceof No)this.set(an,e);else{this.set(an,new No);var t=this;e.then((function(e){t.setView(new No(e))}))}},t.prototype.updateSize=function(){var e=this.getTargetElement(),t=void 0;if(e){var r=getComputedStyle(e),n=e.offsetWidth-parseFloat(r.borderLeftWidth)-parseFloat(r.paddingLeft)-parseFloat(r.paddingRight)-parseFloat(r.borderRightWidth),i=e.offsetHeight-parseFloat(r.borderTopWidth)-parseFloat(r.paddingTop)-parseFloat(r.paddingBottom)-parseFloat(r.borderBottomWidth);isNaN(n)||isNaN(i)||!Zo(t=[n,i])&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&console.warn("No map visible because the map container's width or height are 0.")}this.setSize(t),this.updateViewportSize_()},t.prototype.updateViewportSize_=function(){var e=this.getView();if(e){var t=void 0,r=getComputedStyle(this.viewport_);r.width&&r.height&&(t=[parseInt(r.width,10),parseInt(r.height,10)]),e.setViewportSize(t)}},t}(_t);const jo=Go;var Wo=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const Ho=function(e){function t(t){var r=e.call(this)||this,n=t.element;return!n||t.target||n.style.pointerEvents||(n.style.pointerEvents="auto"),r.element=n||null,r.target_=null,r.map_=null,r.listenerKeys=[],t.render&&(r.render=t.render),t.target&&r.setTarget(t.target),r}return Wo(t,e),t.prototype.disposeInternal=function(){ur(this.element),e.prototype.disposeInternal.call(this)},t.prototype.getMap=function(){return this.map_},t.prototype.setMap=function(e){this.map_&&ur(this.element);for(var t=0,r=this.listenerKeys.length;t<r;++t)ht(this.listenerKeys[t]);(this.listenerKeys.length=0,this.map_=e,e)&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==v&&this.listenerKeys.push(ut(e,tn.POSTRENDER,this.render,this)),e.render())},t.prototype.render=function(e){},t.prototype.setTarget=function(e){this.target_="string"==typeof e?document.getElementById(e):e},t}(_t);var qo=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const Vo=function(e){function t(t){var r=this,n=t||{};(r=e.call(this,{element:document.createElement("div"),render:n.render,target:n.target})||this).ulElement_=document.createElement("ul"),r.collapsed_=void 0===n.collapsed||n.collapsed,r.userCollapsed_=r.collapsed_,r.overrideCollapsible_=void 0!==n.collapsible,r.collapsible_=void 0===n.collapsible||n.collapsible,r.collapsible_||(r.collapsed_=!1);var i=void 0!==n.className?n.className:"ol-attribution",o=void 0!==n.tipLabel?n.tipLabel:"Attributions",a=void 0!==n.expandClassName?n.expandClassName:i+"-expand",s=void 0!==n.collapseLabel?n.collapseLabel:"",l=void 0!==n.collapseClassName?n.collapseClassName:i+"-collapse";"string"==typeof s?(r.collapseLabel_=document.createElement("span"),r.collapseLabel_.textContent=s,r.collapseLabel_.className=l):r.collapseLabel_=s;var c=void 0!==n.label?n.label:"i";"string"==typeof c?(r.label_=document.createElement("span"),r.label_.textContent=c,r.label_.className=a):r.label_=c;var u=r.collapsible_&&!r.collapsed_?r.collapseLabel_:r.label_;r.toggleButton_=document.createElement("button"),r.toggleButton_.setAttribute("type","button"),r.toggleButton_.setAttribute("aria-expanded",String(!r.collapsed_)),r.toggleButton_.title=o,r.toggleButton_.appendChild(u),r.toggleButton_.addEventListener(ct.CLICK,r.handleClick_.bind(r),!1);var p=i+" "+"ol-unselectable "+er+(r.collapsed_&&r.collapsible_?" ol-collapsed":"")+(r.collapsible_?"":" ol-uncollapsible"),h=r.element;return h.className=p,h.appendChild(r.toggleButton_),h.appendChild(r.ulElement_),r.renderedAttributions_=[],r.renderedVisible_=!0,r}return qo(t,e),t.prototype.collectSourceAttributions_=function(e){for(var t={},r=[],n=!0,i=e.layerStatesArray,o=0,a=i.length;o<a;++o){var s=i[o];if(Dt(s,e.viewState)){var l=s.layer.getSource();if(l){var c=l.getAttributions();if(c){var u=c(e);if(u)if(n=n&&!1!==l.getAttributionsCollapsible(),Array.isArray(u))for(var p=0,h=u.length;p<h;++p)u[p]in t||(r.push(u[p]),t[u[p]]=!0);else u in t||(r.push(u),t[u]=!0)}}}}return this.overrideCollapsible_||this.setCollapsible(n),r},t.prototype.updateElement_=function(e){if(e){var t=this.collectSourceAttributions_(e),r=t.length>0;if(this.renderedVisible_!=r&&(this.element.style.display=r?"":"none",this.renderedVisible_=r),!f(t,this.renderedAttributions_)){pr(this.ulElement_);for(var n=0,i=t.length;n<i;++n){var o=document.createElement("li");o.innerHTML=t[n],this.ulElement_.appendChild(o)}this.renderedAttributions_=t}}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)},t.prototype.handleClick_=function(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_},t.prototype.handleToggle_=function(){this.element.classList.toggle(tr),this.collapsed_?cr(this.collapseLabel_,this.label_):cr(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))},t.prototype.getCollapsible=function(){return this.collapsible_},t.prototype.setCollapsible=function(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())},t.prototype.setCollapsed=function(e){this.userCollapsed_=e,this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()},t.prototype.getCollapsed=function(){return this.collapsed_},t.prototype.render=function(e){this.updateElement_(e.frameState)},t}(Ho);var zo=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Yo=function(e){function t(t){var r=this,n=t||{};r=e.call(this,{element:document.createElement("div"),render:n.render,target:n.target})||this;var i=void 0!==n.className?n.className:"ol-rotate",o=void 0!==n.label?n.label:"",a=void 0!==n.compassClassName?n.compassClassName:"ol-compass";r.label_=null,"string"==typeof o?(r.label_=document.createElement("span"),r.label_.className=a,r.label_.textContent=o):(r.label_=o,r.label_.classList.add(a));var s=n.tipLabel?n.tipLabel:"Reset rotation",l=document.createElement("button");l.className=i+"-reset",l.setAttribute("type","button"),l.title=s,l.appendChild(r.label_),l.addEventListener(ct.CLICK,r.handleClick_.bind(r),!1);var c=i+" "+"ol-unselectable "+er,u=r.element;return u.className=c,u.appendChild(l),r.callResetNorth_=n.resetNorth?n.resetNorth:void 0,r.duration_=void 0!==n.duration?n.duration:250,r.autoHide_=void 0===n.autoHide||n.autoHide,r.rotation_=void 0,r.autoHide_&&r.element.classList.add(Jt),r}return zo(t,e),t.prototype.handleClick_=function(e){e.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()},t.prototype.resetNorth_=function(){var e=this.getMap().getView();if(e){var t=e.getRotation();void 0!==t&&(this.duration_>0&&t%(2*Math.PI)!=0?e.animate({rotation:0,duration:this.duration_,easing:Ti}):e.setRotation(0))}},t.prototype.render=function(e){var t=e.frameState;if(t){var r=t.viewState.rotation;if(r!=this.rotation_){var n="rotate("+r+"rad)";if(this.autoHide_){var i=this.element.classList.contains(Jt);i||0!==r?i&&0!==r&&this.element.classList.remove(Jt):this.element.classList.add(Jt)}this.label_.style.transform=n}this.rotation_=r}},t}(Ho);const Ko=Yo;var Xo=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const $o=function(e){function t(t){var r=this,n=t||{};r=e.call(this,{element:document.createElement("div"),target:n.target})||this;var i=void 0!==n.className?n.className:"ol-zoom",o=void 0!==n.delta?n.delta:1,a=void 0!==n.zoomInClassName?n.zoomInClassName:i+"-in",s=void 0!==n.zoomOutClassName?n.zoomOutClassName:i+"-out",l=void 0!==n.zoomInLabel?n.zoomInLabel:"+",c=void 0!==n.zoomOutLabel?n.zoomOutLabel:"",u=void 0!==n.zoomInTipLabel?n.zoomInTipLabel:"Zoom in",p=void 0!==n.zoomOutTipLabel?n.zoomOutTipLabel:"Zoom out",h=document.createElement("button");h.className=a,h.setAttribute("type","button"),h.title=u,h.appendChild("string"==typeof l?document.createTextNode(l):l),h.addEventListener(ct.CLICK,r.handleClick_.bind(r,o),!1);var d=document.createElement("button");d.className=s,d.setAttribute("type","button"),d.title=p,d.appendChild("string"==typeof c?document.createTextNode(c):c),d.addEventListener(ct.CLICK,r.handleClick_.bind(r,-o),!1);var f=i+" "+"ol-unselectable "+er,g=r.element;return g.className=f,g.appendChild(h),g.appendChild(d),r.duration_=void 0!==n.duration?n.duration:250,r}return Xo(t,e),t.prototype.handleClick_=function(e,t){t.preventDefault(),this.zoomByDelta_(e)},t.prototype.zoomByDelta_=function(e){var t=this.getMap().getView();if(t){var r=t.getZoom();if(void 0!==r){var n=t.getConstrainedZoom(r+e);this.duration_>0?(t.getAnimating()&&t.cancelAnimations(),t.animate({zoom:n,duration:this.duration_,easing:Ti})):t.setZoom(n)}}},t}(Ho);const Jo="active";var Qo=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function ea(e,t,r,n){var i=e.getZoom();if(void 0!==i){var o=e.getConstrainedZoom(i+t),a=e.getResolutionForZoom(o);e.getAnimating()&&e.cancelAnimations(),e.animate({resolution:a,anchor:r,duration:void 0!==n?n:250,easing:Ti})}}const ta=function(e){function t(t){var r=e.call(this)||this;return r.on,r.once,r.un,t&&t.handleEvent&&(r.handleEvent=t.handleEvent),r.map_=null,r.setActive(!0),r}return Qo(t,e),t.prototype.getActive=function(){return this.get(Jo)},t.prototype.getMap=function(){return this.map_},t.prototype.handleEvent=function(e){return!0},t.prototype.setActive=function(e){this.set(Jo,e)},t.prototype.setMap=function(e){this.map_=e},t}(_t);var ra=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const na=function(e){function t(t){var r=e.call(this)||this,n=t||{};return r.delta_=n.delta?n.delta:1,r.duration_=void 0!==n.duration?n.duration:250,r}return ra(t,e),t.prototype.handleEvent=function(e){var t=!1;if(e.type==Kr.DBLCLICK){var r=e.originalEvent,n=e.map,i=e.coordinate,o=r.shiftKey?-this.delta_:this.delta_;ea(n.getView(),o,i,this.duration_),r.preventDefault(),t=!0}return!t},t}(ta);var ia=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function oa(e){for(var t=e.length,r=0,n=0,i=0;i<t;i++)r+=e[i].clientX,n+=e[i].clientY;return[r/t,n/t]}const aa=function(e){function t(t){var r=this,n=t||{};return r=e.call(this,n)||this,n.handleDownEvent&&(r.handleDownEvent=n.handleDownEvent),n.handleDragEvent&&(r.handleDragEvent=n.handleDragEvent),n.handleMoveEvent&&(r.handleMoveEvent=n.handleMoveEvent),n.handleUpEvent&&(r.handleUpEvent=n.handleUpEvent),n.stopDown&&(r.stopDown=n.stopDown),r.handlingDownUpSequence=!1,r.targetPointers=[],r}return ia(t,e),t.prototype.getPointerCount=function(){return this.targetPointers.length},t.prototype.handleDownEvent=function(e){return!1},t.prototype.handleDragEvent=function(e){},t.prototype.handleEvent=function(e){if(!e.originalEvent)return!0;var t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==Kr.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==Kr.POINTERUP){var r=this.handleUpEvent(e);this.handlingDownUpSequence=r&&this.targetPointers.length>0}}else if(e.type==Kr.POINTERDOWN){var n=this.handleDownEvent(e);this.handlingDownUpSequence=n,t=this.stopDown(n)}else e.type==Kr.POINTERMOVE&&this.handleMoveEvent(e);return!t},t.prototype.handleMoveEvent=function(e){},t.prototype.handleUpEvent=function(e){return!1},t.prototype.stopDown=function(e){return e},t.prototype.updateTrackedPointers_=function(e){e.activePointers&&(this.targetPointers=e.activePointers)},t}(ta);function sa(e){var t=arguments;return function(e){for(var r=!0,n=0,i=t.length;n<i&&(r=r&&t[n](e));++n);return r}}var la=function(e){var t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},ca=function(e){return!e.map.getTargetElement().hasAttribute("tabindex")||function(e){var t=e.map.getTargetElement(),r=e.map.getOwnerDocument().activeElement;return t.contains(r)}(e)},ua=y,pa=function(e){return e.type==Kr.CLICK},ha=function(e){var t=e.originalEvent;return 0==t.button&&!(b&&C&&t.ctrlKey)},da=m,fa=function(e){return e.type==Kr.SINGLECLICK},ga=function(e){var t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},ya=function(e){var t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},ma=function(e){var t=e.originalEvent,r=t.target.tagName;return"INPUT"!==r&&"SELECT"!==r&&"TEXTAREA"!==r&&!t.target.isContentEditable},va=function(e){var t=e.originalEvent;return I(void 0!==t,56),"mouse"==t.pointerType},_a=function(e){var t=e.originalEvent;return I(void 0!==t,56),t.isPrimary&&0===t.button},wa=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Sa=function(e){function t(t){var r=e.call(this,{stopDown:m})||this,n=t||{};r.kinetic_=n.kinetic,r.lastCentroid=null,r.lastPointersCount_,r.panning_=!1;var i=n.condition?n.condition:sa(ga,_a);return r.condition_=n.onFocusOnly?sa(ca,i):i,r.noKinetic_=!1,r}return wa(t,e),t.prototype.handleDragEvent=function(e){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());var t=this.targetPointers,r=oa(t);if(t.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){var n=[this.lastCentroid[0]-r[0],r[1]-this.lastCentroid[1]],i=e.map.getView();Gt(n,i.getResolution()),Bt(n,i.getRotation()),i.adjustCenterInternal(n)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=t.length,e.originalEvent.preventDefault()},t.prototype.handleUpEvent=function(e){var t=e.map,r=t.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var n=this.kinetic_.getDistance(),i=this.kinetic_.getAngle(),o=r.getCenterInternal(),a=t.getPixelFromCoordinateInternal(o),s=t.getCoordinateFromPixelInternal([a[0]-n*Math.cos(i),a[1]-n*Math.sin(i)]);r.animateInternal({center:r.getConstrainedCenter(s),duration:500,easing:Ti})}return this.panning_&&(this.panning_=!1,r.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0},t.prototype.handleDownEvent=function(e){if(this.targetPointers.length>0&&this.condition_(e)){var t=e.map.getView();return this.lastCentroid=null,t.getAnimating()&&t.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1},t}(aa);const Ea=Sa;var ba=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ca=function(e){function t(t){var r=this,n=t||{};return(r=e.call(this,{stopDown:m})||this).condition_=n.condition?n.condition:la,r.lastAngle_=void 0,r.duration_=void 0!==n.duration?n.duration:250,r}return ba(t,e),t.prototype.handleDragEvent=function(e){if(va(e)){var t=e.map,r=t.getView();if(r.getConstraints().rotation!==bi){var n=t.getSize(),i=e.pixel,o=Math.atan2(n[1]/2-i[1],i[0]-n[0]/2);if(void 0!==this.lastAngle_){var a=o-this.lastAngle_;r.adjustRotationInternal(-a)}this.lastAngle_=o}}},t.prototype.handleUpEvent=function(e){return!va(e)||(e.map.getView().endInteraction(this.duration_),!1)},t.prototype.handleDownEvent=function(e){return!!va(e)&&(!(!ha(e)||!this.condition_(e))&&(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0))},t}(aa);const La=Ca;var Ta=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Aa=function(e){function t(t){var r=e.call(this)||this;return r.geometry_=null,r.element_=document.createElement("div"),r.element_.style.position="absolute",r.element_.style.pointerEvents="auto",r.element_.className="ol-box "+t,r.map_=null,r.startPixel_=null,r.endPixel_=null,r}return Ta(t,e),t.prototype.disposeInternal=function(){this.setMap(null)},t.prototype.render_=function(){var e=this.startPixel_,t=this.endPixel_,r="px",n=this.element_.style;n.left=Math.min(e[0],t[0])+r,n.top=Math.min(e[1],t[1])+r,n.width=Math.abs(t[0]-e[0])+r,n.height=Math.abs(t[1]-e[1])+r},t.prototype.setMap=function(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},t.prototype.setPixels=function(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()},t.prototype.createOrUpdateGeometry=function(){var e=this.startPixel_,t=this.endPixel_,r=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);r[4]=r[0].slice(),this.geometry_?this.geometry_.setCoordinates([r]):this.geometry_=new Ao([r])},t.prototype.getGeometry=function(){return this.geometry_},t}(s);const xa=Aa;var Pa=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Oa="boxstart",Ia="boxdrag",Ra="boxend",Ma="boxcancel",Da=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.coordinate=r,i.mapBrowserEvent=n,i}return Pa(t,e),t}(tt);const Na=function(e){function t(t){var r=e.call(this)||this;r.on,r.once,r.un;var n=t||{};return r.box_=new xa(n.className||"ol-dragbox"),r.minArea_=void 0!==n.minArea?n.minArea:64,n.onBoxEnd&&(r.onBoxEnd=n.onBoxEnd),r.startPixel_=null,r.condition_=n.condition?n.condition:ha,r.boxEndCondition_=n.boxEndCondition?n.boxEndCondition:r.defaultBoxEndCondition,r}return Pa(t,e),t.prototype.defaultBoxEndCondition=function(e,t,r){var n=r[0]-t[0],i=r[1]-t[1];return n*n+i*i>=this.minArea_},t.prototype.getGeometry=function(){return this.box_.getGeometry()},t.prototype.handleDragEvent=function(e){this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new Da(Ia,e.coordinate,e))},t.prototype.handleUpEvent=function(e){this.box_.setMap(null);var t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new Da(t?Ra:Ma,e.coordinate,e)),!1},t.prototype.handleDownEvent=function(e){return!!this.condition_(e)&&(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Da(Oa,e.coordinate,e)),!0)},t.prototype.onBoxEnd=function(e){},t}(aa);var Za=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const ka=function(e){function t(t){var r=this,n=t||{},i=n.condition?n.condition:ya;return(r=e.call(this,{condition:i,className:n.className||"ol-dragzoom",minArea:n.minArea})||this).duration_=void 0!==n.duration?n.duration:200,r.out_=void 0!==n.out&&n.out,r}return Za(t,e),t.prototype.onBoxEnd=function(e){var t=this.getMap().getView(),r=this.getGeometry();if(this.out_){var n=t.rotatedExtentForGeometry(r),i=t.getResolutionForExtentInternal(n),o=t.getResolution()/i;(r=r.clone()).scale(o*o)}t.fitInternal(r,{duration:this.duration_,easing:Ti})},t}(Na),Fa=37,Ua=38,Ba=39,Ga=40;var ja=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const Wa=function(e){function t(t){var r=e.call(this)||this,n=t||{};return r.defaultCondition_=function(e){return ga(e)&&ma(e)},r.condition_=void 0!==n.condition?n.condition:r.defaultCondition_,r.duration_=void 0!==n.duration?n.duration:100,r.pixelDelta_=void 0!==n.pixelDelta?n.pixelDelta:128,r}return ja(t,e),t.prototype.handleEvent=function(e){var t=!1;if(e.type==ct.KEYDOWN){var r=e.originalEvent,n=r.keyCode;if(this.condition_(e)&&(n==Ga||n==Fa||n==Ba||n==Ua)){var i=e.map.getView(),o=i.getResolution()*this.pixelDelta_,a=0,s=0;n==Ga?s=-o:n==Fa?a=-o:n==Ba?a=o:s=o;var l=[a,s];Bt(l,i.getRotation()),function(e,t,r){var n=e.getCenterInternal();if(n){var i=[n[0]+t[0],n[1]+t[1]];e.animateInternal({duration:void 0!==r?r:250,easing:xi,center:e.getConstrainedCenter(i)})}}(i,l,this.duration_),r.preventDefault(),t=!0}}return!t},t}(ta);var Ha=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const qa=function(e){function t(t){var r=e.call(this)||this,n=t||{};return r.condition_=n.condition?n.condition:ma,r.delta_=n.delta?n.delta:1,r.duration_=void 0!==n.duration?n.duration:100,r}return Ha(t,e),t.prototype.handleEvent=function(e){var t=!1;if(e.type==ct.KEYDOWN||e.type==ct.KEYPRESS){var r=e.originalEvent,n=r.charCode;if(this.condition_(e)&&(n=="+".charCodeAt(0)||n=="-".charCodeAt(0))){var i=e.map,o=n=="+".charCodeAt(0)?this.delta_:-this.delta_;ea(i.getView(),o,void 0,this.duration_),r.preventDefault(),t=!0}}return!t},t}(ta);var Va=function(){function e(e,t,r){this.decay_=e,this.minVelocity_=t,this.delay_=r,this.points_=[],this.angle_=0,this.initialVelocity_=0}return e.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},e.prototype.update=function(e,t){this.points_.push(e,t,Date.now())},e.prototype.end=function(){if(this.points_.length<6)return!1;var e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;for(var r=t-3;r>0&&this.points_[r+2]>e;)r-=3;var n=this.points_[t+2]-this.points_[r+2];if(n<1e3/60)return!1;var i=this.points_[t]-this.points_[r],o=this.points_[t+1]-this.points_[r+1];return this.angle_=Math.atan2(o,i),this.initialVelocity_=Math.sqrt(i*i+o*o)/n,this.initialVelocity_>this.minVelocity_},e.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},e.prototype.getAngle=function(){return this.angle_},e}();const za=Va;var Ya=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ka="trackpad",Xa="wheel";const $a=function(e){function t(t){var r=this,n=t||{};(r=e.call(this,n)||this).totalDelta_=0,r.lastDelta_=0,r.maxDelta_=void 0!==n.maxDelta?n.maxDelta:1,r.duration_=void 0!==n.duration?n.duration:250,r.timeout_=void 0!==n.timeout?n.timeout:80,r.useAnchor_=void 0===n.useAnchor||n.useAnchor,r.constrainResolution_=void 0!==n.constrainResolution&&n.constrainResolution;var i=n.condition?n.condition:ua;return r.condition_=n.onFocusOnly?sa(ca,i):i,r.lastAnchor_=null,r.startTime_=void 0,r.timeoutId_,r.mode_=void 0,r.trackpadEventGap_=400,r.trackpadTimeoutId_,r.deltaPerZoom_=300,r}return Ya(t,e),t.prototype.endInteraction_=function(){this.trackpadTimeoutId_=void 0;var e=this.getMap();e&&e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)},t.prototype.handleEvent=function(e){if(!this.condition_(e))return!0;if(e.type!==ct.WHEEL)return!0;var t,r=e.map,n=e.originalEvent;if(n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.coordinate),e.type==ct.WHEEL&&(t=n.deltaY,S&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(t/=L),n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(t*=40)),0===t)return!1;this.lastDelta_=t;var i=Date.now();void 0===this.startTime_&&(this.startTime_=i),(!this.mode_||i-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(t)<4?Ka:Xa);var o=r.getView();if(this.mode_===Ka&&!o.getConstrainResolution()&&!this.constrainResolution_)return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(o.getAnimating()&&o.cancelAnimations(),o.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),o.adjustZoom(-t/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=i,!1;this.totalDelta_+=t;var a=Math.max(this.timeout_-(i-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,r),a),!1},t.prototype.handleWheelZoom_=function(e){var t=e.getView();t.getAnimating()&&t.cancelAnimations();var r=-Ie(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(r=r?r>0?1:-1:0),ea(t,r,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},t.prototype.setMouseAnchor=function(e){this.useAnchor_=e,e||(this.lastAnchor_=null)},t}(ta);var Ja=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const Qa=function(e){function t(t){var r=this,n=t||{},i=n;return i.stopDown||(i.stopDown=m),(r=e.call(this,i)||this).anchor_=null,r.lastAngle_=void 0,r.rotating_=!1,r.rotationDelta_=0,r.threshold_=void 0!==n.threshold?n.threshold:.3,r.duration_=void 0!==n.duration?n.duration:250,r}return Ja(t,e),t.prototype.handleDragEvent=function(e){var t=0,r=this.targetPointers[0],n=this.targetPointers[1],i=Math.atan2(n.clientY-r.clientY,n.clientX-r.clientX);if(void 0!==this.lastAngle_){var o=i-this.lastAngle_;this.rotationDelta_+=o,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=o}this.lastAngle_=i;var a=e.map,s=a.getView();if(s.getConstraints().rotation!==bi){var l=a.getViewport().getBoundingClientRect(),c=oa(this.targetPointers);c[0]-=l.left,c[1]-=l.top,this.anchor_=a.getCoordinateFromPixelInternal(c),this.rotating_&&(a.render(),s.adjustRotationInternal(t,this.anchor_))}},t.prototype.handleUpEvent=function(e){return!(this.targetPointers.length<2)||(e.map.getView().endInteraction(this.duration_),!1)},t.prototype.handleDownEvent=function(e){if(this.targetPointers.length>=2){var t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1},t}(aa);var es=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ts=function(e){function t(t){var r=this,n=t||{},i=n;return i.stopDown||(i.stopDown=m),(r=e.call(this,i)||this).anchor_=null,r.duration_=void 0!==n.duration?n.duration:400,r.lastDistance_=void 0,r.lastScaleDelta_=1,r}return es(t,e),t.prototype.handleDragEvent=function(e){var t=1,r=this.targetPointers[0],n=this.targetPointers[1],i=r.clientX-n.clientX,o=r.clientY-n.clientY,a=Math.sqrt(i*i+o*o);void 0!==this.lastDistance_&&(t=this.lastDistance_/a),this.lastDistance_=a;var s=e.map,l=s.getView();1!=t&&(this.lastScaleDelta_=t);var c=s.getViewport().getBoundingClientRect(),u=oa(this.targetPointers);u[0]-=c.left,u[1]-=c.top,this.anchor_=s.getCoordinateFromPixelInternal(u),s.render(),l.adjustResolutionInternal(t,this.anchor_)},t.prototype.handleUpEvent=function(e){if(this.targetPointers.length<2){var t=e.map.getView(),r=this.lastScaleDelta_>1?1:-1;return t.endInteraction(this.duration_,r),!1}return!0},t.prototype.handleDownEvent=function(e){if(this.targetPointers.length>=2){var t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1},t}(aa);const rs=ts;function ns(e){var t=e||{},r=new Br,n=new za(-.005,.05,100);return(void 0===t.altShiftDragRotate||t.altShiftDragRotate)&&r.push(new La),(void 0===t.doubleClickZoom||t.doubleClickZoom)&&r.push(new na({delta:t.zoomDelta,duration:t.zoomDuration})),(void 0===t.dragPan||t.dragPan)&&r.push(new Ea({onFocusOnly:t.onFocusOnly,kinetic:n})),(void 0===t.pinchRotate||t.pinchRotate)&&r.push(new Qa),(void 0===t.pinchZoom||t.pinchZoom)&&r.push(new rs({duration:t.zoomDuration})),(void 0===t.keyboard||t.keyboard)&&(r.push(new Wa),r.push(new qa({delta:t.zoomDelta,duration:t.zoomDuration}))),(void 0===t.mouseWheelZoom||t.mouseWheelZoom)&&r.push(new $a({onFocusOnly:t.onFocusOnly,duration:t.zoomDuration})),(void 0===t.shiftDragZoom||t.shiftDragZoom)&&r.push(new ka({duration:t.zoomDuration})),r}var is=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const os=function(e){function t(t){return(t=nt({},t)).controls||(t.controls=function(e){var t=e||{},r=new Br;return(void 0===t.zoom||t.zoom)&&r.push(new $o(t.zoomOptions)),(void 0===t.rotate||t.rotate)&&r.push(new Ko(t.rotateOptions)),(void 0===t.attribution||t.attribution)&&r.push(new Vo(t.attributionOptions)),r}()),t.interactions||(t.interactions=ns({onFocusOnly:!0})),e.call(this,t)||this}return is(t,e),t.prototype.createRenderer=function(){return new Dr(this)},t}(jo);var as=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ss="element",ls="map",cs="offset",us="position",ps="positioning",hs=function(e){function t(t){var r=e.call(this)||this;r.on,r.once,r.un,r.options=t,r.id=t.id,r.insertFirst=void 0===t.insertFirst||t.insertFirst,r.stopEvent=void 0===t.stopEvent||t.stopEvent,r.element=document.createElement("div"),r.element.className=void 0!==t.className?t.className:"ol-overlay-container ol-selectable",r.element.style.position="absolute",r.element.style.pointerEvents="auto";var n=t.autoPan;return n&&"object"!=typeof n&&(n={animation:t.autoPanAnimation,margin:t.autoPanMargin}),r.autoPan=n||!1,r.rendered={transform_:"",visible:!0},r.mapPostrenderListenerKey=null,r.addChangeListener(ss,r.handleElementChanged),r.addChangeListener(ls,r.handleMapChanged),r.addChangeListener(cs,r.handleOffsetChanged),r.addChangeListener(us,r.handlePositionChanged),r.addChangeListener(ps,r.handlePositioningChanged),void 0!==t.element&&r.setElement(t.element),r.setOffset(void 0!==t.offset?t.offset:[0,0]),r.setPositioning(t.positioning||"top-left"),void 0!==t.position&&r.setPosition(t.position),r}return as(t,e),t.prototype.getElement=function(){return this.get(ss)},t.prototype.getId=function(){return this.id},t.prototype.getMap=function(){return this.get(ls)||null},t.prototype.getOffset=function(){return this.get(cs)},t.prototype.getPosition=function(){return this.get(us)},t.prototype.getPositioning=function(){return this.get(ps)},t.prototype.handleElementChanged=function(){pr(this.element);var e=this.getElement();e&&this.element.appendChild(e)},t.prototype.handleMapChanged=function(){this.mapPostrenderListenerKey&&(ur(this.element),ht(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);var e=this.getMap();if(e){this.mapPostrenderListenerKey=ut(e,tn.POSTRENDER,this.render,this),this.updatePixelPosition();var t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}},t.prototype.render=function(){this.updatePixelPosition()},t.prototype.handleOffsetChanged=function(){this.updatePixelPosition()},t.prototype.handlePositionChanged=function(){this.updatePixelPosition(),this.performAutoPan()},t.prototype.handlePositioningChanged=function(){this.updatePixelPosition()},t.prototype.setElement=function(e){this.set(ss,e)},t.prototype.setMap=function(e){this.set(ls,e)},t.prototype.setOffset=function(e){this.set(cs,e)},t.prototype.setPosition=function(e){this.set(us,e)},t.prototype.performAutoPan=function(){this.autoPan&&this.panIntoView(this.autoPan)},t.prototype.panIntoView=function(e){var t=this.getMap();if(t&&t.getTargetElement()&&this.get(us)){var r=this.getRect(t.getTargetElement(),t.getSize()),n=this.getElement(),i=this.getRect(n,[sr(n),lr(n)]),o=e||{},a=void 0===o.margin?20:o.margin;if(!ee(r,i)){var s=i[0]-r[0],l=r[2]-i[2],c=i[1]-r[1],u=r[3]-i[3],p=[0,0];if(s<0?p[0]=s-a:l<0&&(p[0]=Math.abs(l)+a),c<0?p[1]=c-a:u<0&&(p[1]=Math.abs(u)+a),0!==p[0]||0!==p[1]){var h=t.getView().getCenterInternal(),d=t.getPixelFromCoordinateInternal(h);if(!d)return;var f=[d[0]+p[0],d[1]+p[1]],g=o.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(f),duration:g.duration,easing:g.easing})}}}},t.prototype.getRect=function(e,t){var r=e.getBoundingClientRect(),n=r.left+window.pageXOffset,i=r.top+window.pageYOffset;return[n,i,n+t[0],i+t[1]]},t.prototype.setPositioning=function(e){this.set(ps,e)},t.prototype.setVisible=function(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)},t.prototype.updatePixelPosition=function(){var e=this.getMap(),t=this.getPosition();if(e&&e.isRendered()&&t){var r=e.getPixelFromCoordinate(t),n=e.getSize();this.updateRenderedPosition(r,n)}else this.setVisible(!1)},t.prototype.updateRenderedPosition=function(e,t){var r=this.element.style,n=this.getOffset(),i=this.getPositioning();this.setVisible(!0);var o=Math.round(e[0]+n[0])+"px",a=Math.round(e[1]+n[1])+"px",s="0%",l="0%";"bottom-right"==i||"center-right"==i||"top-right"==i?s="-100%":"bottom-center"!=i&&"center-center"!=i&&"top-center"!=i||(s="-50%"),"bottom-left"==i||"bottom-center"==i||"bottom-right"==i?l="-100%":"center-left"!=i&&"center-center"!=i&&"center-right"!=i||(l="-50%");var c="translate(".concat(s,", ").concat(l,") translate(").concat(o,", ").concat(a,")");this.rendered.transform_!=c&&(this.rendered.transform_=c,r.transform=c,r.msTransform=c)},t.prototype.getOptions=function(){return this.options},t}(_t);const ds=hs;function fs(e,t,r){var n=void 0!==r?e.toFixed(r):""+e,i=n.indexOf(".");return(i=-1===i?n.length:i)>t?n:new Array(1+t-i).join("0")+n}var gs=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ys=.75,ms=.1,vs=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return gs(t,e),t.prototype.createRenderer=function(){return new Dr(this)},t}(jo),_s=function(e){function t(t){var r=this,n=t||{};(r=e.call(this,{element:document.createElement("div"),render:n.render,target:n.target})||this).boundHandleRotationChanged_=r.handleRotationChanged_.bind(r),r.collapsed_=void 0===n.collapsed||n.collapsed,r.collapsible_=void 0===n.collapsible||n.collapsible,r.collapsible_||(r.collapsed_=!1),r.rotateWithView_=void 0!==n.rotateWithView&&n.rotateWithView,r.viewExtent_=void 0;var i=void 0!==n.className?n.className:"ol-overviewmap",o=void 0!==n.tipLabel?n.tipLabel:"Overview map",a=void 0!==n.collapseLabel?n.collapseLabel:"";"string"==typeof a?(r.collapseLabel_=document.createElement("span"),r.collapseLabel_.textContent=a):r.collapseLabel_=a;var s=void 0!==n.label?n.label:"";"string"==typeof s?(r.label_=document.createElement("span"),r.label_.textContent=s):r.label_=s;var l=r.collapsible_&&!r.collapsed_?r.collapseLabel_:r.label_,c=document.createElement("button");c.setAttribute("type","button"),c.title=o,c.appendChild(l),c.addEventListener(ct.CLICK,r.handleClick_.bind(r),!1),r.ovmapDiv_=document.createElement("div"),r.ovmapDiv_.className="ol-overviewmap-map",r.view_=n.view,r.ovmap_=new vs({view:n.view});var u=r.ovmap_;n.layers&&n.layers.forEach((function(e){u.addLayer(e)}));var p=document.createElement("div");p.className="ol-overviewmap-box",p.style.boxSizing="border-box",r.boxOverlay_=new ds({position:[0,0],positioning:"center-center",element:p}),r.ovmap_.addOverlay(r.boxOverlay_);var h=i+" "+"ol-unselectable "+er+(r.collapsed_&&r.collapsible_?" ol-collapsed":"")+(r.collapsible_?"":" ol-uncollapsible"),d=r.element;d.className=h,d.appendChild(r.ovmapDiv_),d.appendChild(c);var f=r,g=r.boxOverlay_,y=r.boxOverlay_.getElement(),m=function(e){var t,r={clientX:(t=e).clientX,clientY:t.clientY},n=u.getEventCoordinateInternal(r);g.setPosition(n)},v=function(e){var t=u.getEventCoordinateInternal(e);f.getMap().getView().setCenterInternal(t),window.removeEventListener("mousemove",m),window.removeEventListener("mouseup",v)};return y.addEventListener("mousedown",(function(){window.addEventListener("mousemove",m),window.addEventListener("mouseup",v)})),r}return gs(t,e),t.prototype.setMap=function(t){var r=this.getMap();if(t!==r){if(r){var n=r.getView();n&&this.unbindView_(n),this.ovmap_.setTarget(null)}if(e.prototype.setMap.call(this,t),t){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(ut(t,rt,this.handleMapPropertyChange_,this));var i=t.getView();i&&(this.bindView_(i),i.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}},t.prototype.handleMapPropertyChange_=function(e){if(e.key===an){var t=e.oldValue;t&&this.unbindView_(t);var r=this.getMap().getView();this.bindView_(r)}else this.ovmap_.isRendered()||e.key!==on&&e.key!==nn||this.ovmap_.updateSize()},t.prototype.bindView_=function(e){if(!this.view_){var t=new No({projection:e.getProjection()});this.ovmap_.setView(t)}e.addChangeListener(En.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_()},t.prototype.unbindView_=function(e){e.removeChangeListener(En.ROTATION,this.boundHandleRotationChanged_)},t.prototype.handleRotationChanged_=function(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())},t.prototype.validateExtent_=function(){var e=this.getMap(),t=this.ovmap_;if(e.isRendered()&&t.isRendered()){var r=e.getSize(),n=e.getView().calculateExtentInternal(r);if(!this.viewExtent_||!le(n,this.viewExtent_)){this.viewExtent_=n;var i=t.getSize(),o=t.getView().calculateExtentInternal(i),a=t.getPixelFromCoordinateInternal(be(n)),s=t.getPixelFromCoordinateInternal(ye(n)),l=Math.abs(a[0]-s[0]),c=Math.abs(a[1]-s[1]),u=i[0],p=i[1];l<u*ms||c<p*ms||l>u*ys||c>p*ys?this.resetExtent_():ee(o,n)||this.recenter_()}}},t.prototype.resetExtent_=function(){var e=this.getMap(),t=this.ovmap_,r=e.getSize(),n=e.getView().calculateExtentInternal(r),i=t.getView(),o=Math.log(7.5)/Math.LN2;xe(n,1/(Math.pow(2,o/2)*ms)),i.fitInternal(xo(n))},t.prototype.recenter_=function(){var e=this.getMap(),t=this.ovmap_,r=e.getView();t.getView().setCenterInternal(r.getCenterInternal())},t.prototype.updateBox_=function(){var e=this.getMap(),t=this.ovmap_;if(e.isRendered()&&t.isRendered()){var r=e.getSize(),n=e.getView(),i=t.getView(),o=this.rotateWithView_?0:-n.getRotation(),a=this.boxOverlay_,s=this.boxOverlay_.getElement(),l=n.getCenterInternal(),c=n.getResolution(),u=i.getResolution(),p=r[0]*c/u,h=r[1]*c/u;if(a.setPosition(l),s){s.style.width=p+"px",s.style.height=h+"px";var d="rotate("+o+"rad)";s.style.transform=d}}},t.prototype.updateBoxAfterOvmapIsRendered_=function(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=pt(this.ovmap_,tn.POSTRENDER,(function(e){delete this.ovmapPostrenderKey_,this.updateBox_()}),this))},t.prototype.handleClick_=function(e){e.preventDefault(),this.handleToggle_()},t.prototype.handleToggle_=function(){this.element.classList.toggle(tr),this.collapsed_?cr(this.collapseLabel_,this.label_):cr(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;var e=this.ovmap_;if(!this.collapsed_){if(e.isRendered())return this.viewExtent_=void 0,void e.render();e.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}},t.prototype.getCollapsible=function(){return this.collapsible_},t.prototype.setCollapsible=function(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())},t.prototype.setCollapsed=function(e){this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()},t.prototype.getCollapsed=function(){return this.collapsed_},t.prototype.getRotateWithView=function(){return this.rotateWithView_},t.prototype.setRotateWithView=function(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,0!==this.getMap().getView().getRotation()&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))},t.prototype.getOverviewMap=function(){return this.ovmap_},t.prototype.render=function(e){this.validateExtent_(),this.updateBox_()},t}(Ho);const ws=_s;var Ss=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Es="units",bs="degrees",Cs="imperial",Ls="nautical",Ts="metric",As="us",xs=[1,2,5],Ps=25.4/.28,Os=function(e){function t(t){var r=this,n=t||{},i=void 0!==n.className?n.className:n.bar?"ol-scale-bar":"ol-scale-line";return(r=e.call(this,{element:document.createElement("div"),render:n.render,target:n.target})||this).on,r.once,r.un,r.innerElement_=document.createElement("div"),r.innerElement_.className=i+"-inner",r.element.className=i+" "+Qt,r.element.appendChild(r.innerElement_),r.viewState_=null,r.minWidth_=void 0!==n.minWidth?n.minWidth:64,r.maxWidth_=n.maxWidth,r.renderedVisible_=!1,r.renderedWidth_=void 0,r.renderedHTML_="",r.addChangeListener(Es,r.handleUnitsChanged_),r.setUnits(n.units||Ts),r.scaleBar_=n.bar||!1,r.scaleBarSteps_=n.steps||4,r.scaleBarText_=n.text||!1,r.dpi_=n.dpi||void 0,r}return Ss(t,e),t.prototype.getUnits=function(){return this.get(Es)},t.prototype.handleUnitsChanged_=function(){this.updateElement_()},t.prototype.setUnits=function(e){this.set(Es,e)},t.prototype.setDpi=function(e){this.dpi_=e},t.prototype.updateElement_=function(){var e=this.viewState_;if(e){var t=e.center,r=e.projection,n=this.getUnits(),i=n==bs?_n.DEGREES:_n.METERS,o=Jn(r,e.resolution,t,i),a=this.minWidth_*(this.dpi_||Ps)/Ps,s=void 0!==this.maxWidth_?this.maxWidth_*(this.dpi_||Ps)/Ps:void 0,l=a*o,c="";if(n==bs){var u=vn[_n.DEGREES];(l*=u)<u/60?(c="",o*=3600):l<u?(c="",o*=60):c=""}else n==Cs?l<.9144?(c="in",o/=.0254):l<1609.344?(c="ft",o/=.3048):(c="mi",o/=1609.344):n==Ls?(o/=1852,c="NM"):n==Ts?l<.001?(c="m",o*=1e6):l<1?(c="mm",o*=1e3):l<1e3?c="m":(c="km",o/=1e3):n==As?l<.9144?(c="in",o*=39.37):l<1609.344?(c="ft",o/=.30480061):(c="mi",o/=1609.3472):I(!1,33);for(var p,h,d,f,g,y,m,v=3*Math.floor(Math.log(a*o)/Math.log(10));;){d=Math.floor(v/3);var _=Math.pow(10,d);if(p=xs[(v%3+3)%3]*_,h=Math.round(p/o),isNaN(h))return this.element.style.display="none",void(this.renderedVisible_=!1);if(void 0!==s&&h>=s){p=f,h=g,d=y;break}if(h>=a)break;f=p,g=h,y=d,++v}m=this.scaleBar_?this.createScaleBar(h,p,c):p.toFixed(d<0?-d:0)+" "+c,this.renderedHTML_!=m&&(this.innerElement_.innerHTML=m,this.renderedHTML_=m),this.renderedWidth_!=h&&(this.innerElement_.style.width=h+"px",this.renderedWidth_=h),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)},t.prototype.createScaleBar=function(e,t,r){for(var n="1 : "+Math.round(this.getScaleForResolution()).toLocaleString(),i=[],o=e/this.scaleBarSteps_,a="ol-scale-singlebar-odd",s=0;s<this.scaleBarSteps_;s++)0===s&&i.push(this.createMarker("absolute",s)),i.push('<div><div class="ol-scale-singlebar '+a+'" style="width: '+o+'px;"></div>'+this.createMarker("relative",s)+(s%2==0||2===this.scaleBarSteps_?this.createStepText(s,e,!1,t,r):"")+"</div>"),s===this.scaleBarSteps_-1&&i.push(this.createStepText(s+1,e,!0,t,r)),a="ol-scale-singlebar-odd"===a?"ol-scale-singlebar-even":"ol-scale-singlebar-odd";return'<div style="display: flex;">'+(this.scaleBarText_?'<div class="ol-scale-text" style="width: '+e+'px;">'+n+"</div>":"")+i.join("")+"</div>"},t.prototype.createMarker=function(e,t){return'<div class="ol-scale-step-marker" style="position: '+e+";top: "+("absolute"===e?3:-10)+'px;"></div>'},t.prototype.createStepText=function(e,t,r,n,i){var o=(0===e?0:Math.round(n/this.scaleBarSteps_*e*100)/100)+(0===e?"":" "+i);return'<div class="ol-scale-step-text" style="margin-left: '+(0===e?-3:t/this.scaleBarSteps_*-1)+"px;text-align: "+(0===e?"left":"center")+"; min-width: "+(0===e?0:t/this.scaleBarSteps_*2)+"px;left: "+(r?t+"px":"unset")+';">'+o+"</div>"},t.prototype.getScaleForResolution=function(){var e=Jn(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,_n.METERS),t=this.dpi_||Ps;return parseFloat(e.toString())*(1e3/25.4)*t},t.prototype.render=function(e){var t=e.frameState;this.viewState_=t?t.viewState:null,this.updateElement_()},t}(Ho);const Is=Os;var Rs=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const Ms=function(e){function t(t){var r=this,n=t||{};(r=e.call(this,{element:document.createElement("div"),target:n.target})||this).extent=n.extent?n.extent:null;var i=void 0!==n.className?n.className:"ol-zoom-extent",o=void 0!==n.label?n.label:"E",a=void 0!==n.tipLabel?n.tipLabel:"Fit to extent",s=document.createElement("button");s.setAttribute("type","button"),s.title=a,s.appendChild("string"==typeof o?document.createTextNode(o):o),s.addEventListener(ct.CLICK,r.handleClick_.bind(r),!1);var l=i+" "+"ol-unselectable "+er,c=r.element;return c.className=l,c.appendChild(s),r}return Rs(t,e),t.prototype.handleClick_=function(e){e.preventDefault(),this.handleZoomToExtent()},t.prototype.handleZoomToExtent=function(){var e=this.getMap().getView(),t=this.extent?this.extent:e.getProjection().getExtent();e.fitInternal(xo(t))},t}(Ho);var Ds=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ns=0,Zs=1,ks=function(e){function t(t){var r=this,n=t||{};(r=e.call(this,{element:document.createElement("div"),render:n.render})||this).dragListenerKeys_=[],r.currentResolution_=void 0,r.direction_=Ns,r.dragging_,r.heightLimit_=0,r.widthLimit_=0,r.startX_,r.startY_,r.thumbSize_=null,r.sliderInitialized_=!1,r.duration_=void 0!==n.duration?n.duration:200;var i=void 0!==n.className?n.className:"ol-zoomslider",o=document.createElement("button");o.setAttribute("type","button"),o.className=i+"-thumb "+Qt;var a=r.element;return a.className=i+" "+"ol-unselectable "+er,a.appendChild(o),a.addEventListener($r,r.handleDraggerStart_.bind(r),!1),a.addEventListener(Xr,r.handleDraggerDrag_.bind(r),!1),a.addEventListener(Jr,r.handleDraggerEnd_.bind(r),!1),a.addEventListener(ct.CLICK,r.handleContainerClick_.bind(r),!1),o.addEventListener(ct.CLICK,et,!1),r}return Ds(t,e),t.prototype.setMap=function(t){e.prototype.setMap.call(this,t),t&&t.render()},t.prototype.initSlider_=function(){var e=this.element,t=e.offsetWidth,r=e.offsetHeight;if(0===t&&0===r)return this.sliderInitialized_=!1;var n=getComputedStyle(e);t-=parseFloat(n.paddingRight)+parseFloat(n.paddingLeft),r-=parseFloat(n.paddingTop)+parseFloat(n.paddingBottom);var i=e.firstElementChild,o=getComputedStyle(i),a=i.offsetWidth+parseFloat(o.marginRight)+parseFloat(o.marginLeft),s=i.offsetHeight+parseFloat(o.marginTop)+parseFloat(o.marginBottom);return this.thumbSize_=[a,s],t>r?(this.direction_=Zs,this.widthLimit_=t-a):(this.direction_=Ns,this.heightLimit_=r-s),this.sliderInitialized_=!0},t.prototype.handleContainerClick_=function(e){var t=this.getMap().getView(),r=this.getRelativePosition_(e.offsetX-this.thumbSize_[0]/2,e.offsetY-this.thumbSize_[1]/2),n=this.getResolutionForPosition_(r),i=t.getConstrainedZoom(t.getZoomForResolution(n));t.animateInternal({zoom:i,duration:this.duration_,easing:Ti})},t.prototype.handleDraggerStart_=function(e){if(!this.dragging_&&e.target===this.element.firstElementChild){var t=this.element.firstElementChild;if(this.getMap().getView().beginInteraction(),this.startX_=e.clientX-parseFloat(t.style.left),this.startY_=e.clientY-parseFloat(t.style.top),this.dragging_=!0,0===this.dragListenerKeys_.length){var r=this.handleDraggerDrag_,n=this.handleDraggerEnd_,i=this.getMap().getOwnerDocument();this.dragListenerKeys_.push(ut(i,Xr,r,this),ut(i,Jr,n,this))}}},t.prototype.handleDraggerDrag_=function(e){if(this.dragging_){var t=e.clientX-this.startX_,r=e.clientY-this.startY_,n=this.getRelativePosition_(t,r);this.currentResolution_=this.getResolutionForPosition_(n),this.getMap().getView().setResolution(this.currentResolution_)}},t.prototype.handleDraggerEnd_=function(e){this.dragging_&&(this.getMap().getView().endInteraction(),this.dragging_=!1,this.startX_=void 0,this.startY_=void 0,this.dragListenerKeys_.forEach(ht),this.dragListenerKeys_.length=0)},t.prototype.setThumbPosition_=function(e){var t=this.getPositionForResolution_(e),r=this.element.firstElementChild;this.direction_==Zs?r.style.left=this.widthLimit_*t+"px":r.style.top=this.heightLimit_*t+"px"},t.prototype.getRelativePosition_=function(e,t){return Ie(this.direction_===Zs?e/this.widthLimit_:t/this.heightLimit_,0,1)},t.prototype.getResolutionForPosition_=function(e){return this.getMap().getView().getResolutionForValueFunction()(1-e)},t.prototype.getPositionForResolution_=function(e){return Ie(1-this.getMap().getView().getValueForResolutionFunction()(e),0,1)},t.prototype.render=function(e){if(e.frameState&&(this.sliderInitialized_||this.initSlider_())){var t=e.frameState.viewState.resolution;this.currentResolution_=t,this.setThumbPosition_(t)}},t}(Ho);const Fs=ks;var Us=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Bs=function(e){function t(t){var r=e.call(this)||this;if(r.on,r.once,r.un,r.id_=void 0,r.geometryName_="geometry",r.style_=null,r.styleFunction_=void 0,r.geometryChangeKey_=null,r.addChangeListener(r.geometryName_,r.handleGeometryChanged_),t)if("function"==typeof t.getSimplifiedGeometry){var n=t;r.setGeometry(n)}else{var i=t;r.setProperties(i)}return r}return Us(t,e),t.prototype.clone=function(){var e=new t(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());var r=this.getGeometry();r&&e.setGeometry(r.clone());var n=this.getStyle();return n&&e.setStyle(n),e},t.prototype.getGeometry=function(){return this.get(this.geometryName_)},t.prototype.getId=function(){return this.id_},t.prototype.getGeometryName=function(){return this.geometryName_},t.prototype.getStyle=function(){return this.style_},t.prototype.getStyleFunction=function(){return this.styleFunction_},t.prototype.handleGeometryChange_=function(){this.changed()},t.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(ht(this.geometryChangeKey_),this.geometryChangeKey_=null);var e=this.getGeometry();e&&(this.geometryChangeKey_=ut(e,ct.CHANGE,this.handleGeometryChange_,this)),this.changed()},t.prototype.setGeometry=function(e){this.set(this.geometryName_,e)},t.prototype.setStyle=function(e){this.style_=e,this.styleFunction_=e?Gs(e):void 0,this.changed()},t.prototype.setId=function(e){this.id_=e,this.changed()},t.prototype.setGeometryName=function(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()},t}(_t);function Gs(e){return"function"==typeof e?e:(Array.isArray(e)?t=e:(I("function"==typeof e.getZIndex,41),t=[e]),function(){return t});var t}const js=Bs;var Ws=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Hs=function(e){function t(t,r){var n=e.call(this)||this;return r&&!Array.isArray(t[0])?n.setFlatCoordinates(r,t):n.setCoordinates(t,r),n}return Ws(t,e),t.prototype.appendPoint=function(e){this.flatCoordinates?h(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.changed()},t.prototype.clone=function(){var e=new t(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e},t.prototype.closestPointXY=function(e,t,r,n){if(n<J(this.getExtent(),e,t))return n;for(var i=this.flatCoordinates,o=this.stride,a=0,s=i.length;a<s;a+=o){var l=Ne(e,t,i[a],i[a+1]);if(l<n){n=l;for(var c=0;c<o;++c)r[c]=i[a+c];r.length=o}}return n},t.prototype.getCoordinates=function(){return eo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},t.prototype.getPoint=function(e){var t=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return e<0||t<=e?null:new uo(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)},t.prototype.getPoints=function(){for(var e=this.flatCoordinates,t=this.layout,r=this.stride,n=[],i=0,o=e.length;i<o;i+=r){var a=new uo(e.slice(i,i+r),t);n.push(a)}return n},t.prototype.getType=function(){return"MultiPoint"},t.prototype.intersectsExtent=function(e){for(var t=this.flatCoordinates,r=this.stride,n=0,i=t.length;n<i;n+=r){if(te(e,t[n],t[n+1]))return!0}return!1},t.prototype.setCoordinates=function(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=zi(this.flatCoordinates,0,e,this.stride),this.changed()},t}(Bi);const qs=Hs;function Vs(e,t,r,n,i,o,a){var s,c,u=(r-t)/n;if(1===u)s=t;else if(2===u)s=t,c=i;else if(0!==u){for(var p=e[t],h=e[t+1],d=0,f=[0],g=t+n;g<r;g+=n){var y=e[g],m=e[g+1];d+=Math.sqrt((y-p)*(y-p)+(m-h)*(m-h)),f.push(d),p=y,h=m}var v=i*d,_=function(e,t,r){for(var n,i,o=r||l,a=0,s=e.length,c=!1;a<s;)(i=+o(e[n=a+(s-a>>1)],t))<0?a=n+1:(s=n,c=!i);return c?a:~a}(f,v);_<0?(c=(v-f[-_-2])/(f[-_-1]-f[-_-2]),s=t+(-_-2)*n):s=t+_*n}var w=a>1?a:2,S=o||new Array(w);for(g=0;g<w;++g)S[g]=void 0===s?NaN:void 0===c?e[s+g]:Fe(e[s+g],e[s+n+g],c);return S}function zs(e,t,r,n,i,o){if(r==t)return null;var a;if(i<e[t+n-1])return o?((a=e.slice(t,t+n))[n-1]=i,a):null;if(e[r-1]<i)return o?((a=e.slice(r-n,r))[n-1]=i,a):null;if(i==e[t+n-1])return e.slice(t,t+n);for(var s=t/n,l=r/n;s<l;){var c=s+l>>1;i<e[(c+1)*n-1]?l=c:s=c+1}var u=e[s*n-1];if(i==u)return e.slice((s-1)*n,(s-1)*n+n);var p=(i-u)/(e[(s+1)*n-1]-u);a=[];for(var h=0;h<n-1;++h)a.push(Fe(e[(s-1)*n+h],e[s*n+h],p));return a.push(i),a}function Ys(e,t,r,n){for(var i=e[t],o=e[t+1],a=0,s=t+n;s<r;s+=n){var l=e[s],c=e[s+1];a+=Math.sqrt((l-i)*(l-i)+(c-o)*(c-o)),i=l,o=c}return a}var Ks=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Xs=function(e){function t(t,r){var n=e.call(this)||this;return n.flatMidpoint_=null,n.flatMidpointRevision_=-1,n.maxDelta_=-1,n.maxDeltaRevision_=-1,void 0===r||Array.isArray(t[0])?n.setCoordinates(t,r):n.setFlatCoordinates(r,t),n}return Ks(t,e),t.prototype.appendCoordinate=function(e){this.flatCoordinates?h(this.flatCoordinates,e):this.flatCoordinates=e.slice(),this.changed()},t.prototype.clone=function(){var e=new t(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e},t.prototype.closestPointXY=function(e,t,r,n){return n<J(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ji(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Hi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,r,n))},t.prototype.forEachSegment=function(e){return yo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)},t.prototype.getCoordinateAtM=function(e,t){if(this.layout!=Pi.XYM&&this.layout!=Pi.XYZM)return null;var r=void 0!==t&&t;return zs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,r)},t.prototype.getCoordinates=function(){return eo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},t.prototype.getCoordinateAt=function(e,t){return Vs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)},t.prototype.getLength=function(){return Ys(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},t.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},t.prototype.getSimplifiedGeometryInternal=function(e){var r=[];return r.length=Ki(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,r,0),new t(r,Pi.XY)},t.prototype.getType=function(){return"LineString"},t.prototype.intersectsExtent=function(e){return mo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)},t.prototype.setCoordinates=function(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=zi(this.flatCoordinates,0,e,this.stride),this.changed()},t}(Bi);const $s=Xs;var Js=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Qs=function(e){function t(t,r,n){var i=e.call(this)||this;if(i.ends_=[],i.maxDelta_=-1,i.maxDeltaRevision_=-1,Array.isArray(t[0]))i.setCoordinates(t,r);else if(void 0!==r&&n)i.setFlatCoordinates(r,t),i.ends_=n;else{for(var o=i.getLayout(),a=t,s=[],l=[],c=0,u=a.length;c<u;++c){var p=a[c];0===c&&(o=p.getLayout()),h(s,p.getFlatCoordinates()),l.push(s.length)}i.setFlatCoordinates(o,s),i.ends_=l}return i}return Js(t,e),t.prototype.appendLineString=function(e){this.flatCoordinates?h(this.flatCoordinates,e.getFlatCoordinates().slice()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},t.prototype.clone=function(){var e=new t(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e},t.prototype.closestPointXY=function(e,t,r,n){return n<J(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Wi(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),qi(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,r,n))},t.prototype.getCoordinateAtM=function(e,t,r){if(this.layout!=Pi.XYM&&this.layout!=Pi.XYZM||0===this.flatCoordinates.length)return null;var n=void 0!==t&&t,i=void 0!==r&&r;return function(e,t,r,n,i,o,a){if(a)return zs(e,t,r[r.length-1],n,i,o);var s;if(i<e[n-1])return o?((s=e.slice(0,n))[n-1]=i,s):null;if(e[e.length-1]<i)return o?((s=e.slice(e.length-n))[n-1]=i,s):null;for(var l=0,c=r.length;l<c;++l){var u=r[l];if(t!=u){if(i<e[t+n-1])return null;if(i<=e[u-1])return zs(e,t,u,n,i,!1);t=u}}return null}(this.flatCoordinates,0,this.ends_,this.stride,e,n,i)},t.prototype.getCoordinates=function(){return to(this.flatCoordinates,0,this.ends_,this.stride)},t.prototype.getEnds=function(){return this.ends_},t.prototype.getLineString=function(e){return e<0||this.ends_.length<=e?null:new $s(this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e]),this.layout)},t.prototype.getLineStrings=function(){for(var e=this.flatCoordinates,t=this.ends_,r=this.layout,n=[],i=0,o=0,a=t.length;o<a;++o){var s=t[o],l=new $s(e.slice(i,s),r);n.push(l),i=s}return n},t.prototype.getFlatMidpoints=function(){for(var e=[],t=this.flatCoordinates,r=0,n=this.ends_,i=this.stride,o=0,a=n.length;o<a;++o){var s=n[o];h(e,Vs(t,r,s,i,.5)),r=s}return e},t.prototype.getSimplifiedGeometryInternal=function(e){var r=[],n=[];return r.length=Xi(this.flatCoordinates,0,this.ends_,this.stride,e,r,0,n),new t(r,Pi.XY,n)},t.prototype.getType=function(){return"MultiLineString"},t.prototype.intersectsExtent=function(e){return function(e,t,r,n,i){for(var o=0,a=r.length;o<a;++o){if(mo(e,t,r[o],n,i))return!0;t=r[o]}return!1}(this.flatCoordinates,0,this.ends_,this.stride,e)},t.prototype.setCoordinates=function(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);var r=Yi(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=0===r.length?0:r[r.length-1],this.changed()},t}(Bi);const el=Qs;var tl=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),rl=function(e){function t(t,r,n){var i=e.call(this)||this;if(i.endss_=[],i.flatInteriorPointsRevision_=-1,i.flatInteriorPoints_=null,i.maxDelta_=-1,i.maxDeltaRevision_=-1,i.orientedRevision_=-1,i.orientedFlatCoordinates_=null,!n&&!Array.isArray(t[0])){for(var o=i.getLayout(),a=t,s=[],l=[],c=0,u=a.length;c<u;++c){var p=a[c];0===c&&(o=p.getLayout());for(var d=s.length,f=p.getEnds(),g=0,y=f.length;g<y;++g)f[g]+=d;h(s,p.getFlatCoordinates()),l.push(f)}r=o,t=s,n=l}return void 0!==r&&n?(i.setFlatCoordinates(r,t),i.endss_=n):i.setCoordinates(t,r),i}return tl(t,e),t.prototype.appendPolygon=function(e){var t;if(this.flatCoordinates){var r=this.flatCoordinates.length;h(this.flatCoordinates,e.getFlatCoordinates());for(var n=0,i=(t=e.getEnds().slice()).length;n<i;++n)t[n]+=r}else this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();this.endss_.push(t),this.changed()},t.prototype.clone=function(){for(var e=this.endss_.length,r=new Array(e),n=0;n<e;++n)r[n]=this.endss_[n].slice();var i=new t(this.flatCoordinates.slice(),this.layout,r);return i.applyProperties(this),i},t.prototype.closestPointXY=function(e,t,r,n){return n<J(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function(e,t,r,n,i){for(var o=0,a=r.length;o<a;++o){var s=r[o];i=Wi(e,t,s,n,i),t=s[s.length-1]}return i}(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function(e,t,r,n,i,o,a,s,l,c,u){for(var p=u||[NaN,NaN],h=0,d=r.length;h<d;++h){var f=r[h];c=qi(e,t,f,n,i,o,a,s,l,c,p),t=f[f.length-1]}return c}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,r,n))},t.prototype.containsXY=function(e,t){return function(e,t,r,n,i,o){if(0===r.length)return!1;for(var a=0,s=r.length;a<s;++a){var l=r[a];if(fo(e,t,l,n,i,o))return!0;t=l[l.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)},t.prototype.getArea=function(){return function(e,t,r,n){for(var i=0,o=0,a=r.length;o<a;++o){var s=r[o];i+=io(e,t,s,n),t=s[s.length-1]}return i}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},t.prototype.getCoordinates=function(e){var t;return void 0!==e?Co(t=this.getOrientedFlatCoordinates().slice(),0,this.endss_,this.stride,e):t=this.flatCoordinates,ro(t,0,this.endss_,this.stride)},t.prototype.getEndss=function(){return this.endss_},t.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var e=function(e,t,r,n){for(var i=[],o=[1/0,1/0,-1/0,-1/0],a=0,s=r.length;a<s;++a){var l=r[a];o=se(e,t,l[0],n),i.push((o[0]+o[2])/2,(o[1]+o[3])/2),t=l[l.length-1]}return i}(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=function(e,t,r,n,i){for(var o=[],a=0,s=r.length;a<s;++a){var l=r[a];o=go(e,t,l,n,i,2*a,o),t=l[l.length-1]}return o}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_},t.prototype.getInteriorPoints=function(){return new qs(this.getFlatInteriorPoints().slice(),Pi.XYM)},t.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var e=this.flatCoordinates;!function(e,t,r,n,i){for(var o=0,a=r.length;o<a;++o){var s=r[o];if(!Eo(e,t,s,n,i))return!1;s.length&&(t=s[s.length-1])}return!0}(e,0,this.endss_,this.stride)?(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=Co(this.orientedFlatCoordinates_,0,this.endss_,this.stride)):this.orientedFlatCoordinates_=e,this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},t.prototype.getSimplifiedGeometryInternal=function(e){var r=[],n=[];return r.length=function(e,t,r,n,i,o,a,s){for(var l=0,c=r.length;l<c;++l){var u=r[l],p=[];a=Qi(e,t,u,n,i,o,a,p),s.push(p),t=u[u.length-1]}return a}(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),r,0,n),new t(r,Pi.XY,n)},t.prototype.getPolygon=function(e){if(e<0||this.endss_.length<=e)return null;var t;if(0===e)t=0;else{var r=this.endss_[e-1];t=r[r.length-1]}var n=this.endss_[e].slice(),i=n[n.length-1];if(0!==t)for(var o=0,a=n.length;o<a;++o)n[o]-=t;return new Ao(this.flatCoordinates.slice(t,i),this.layout,n)},t.prototype.getPolygons=function(){for(var e=this.layout,t=this.flatCoordinates,r=this.endss_,n=[],i=0,o=0,a=r.length;o<a;++o){var s=r[o].slice(),l=s[s.length-1];if(0!==i)for(var c=0,u=s.length;c<u;++c)s[c]-=i;var p=new Ao(t.slice(i,l),e,s);n.push(p),i=l}return n},t.prototype.getType=function(){return"MultiPolygon"},t.prototype.intersectsExtent=function(e){return function(e,t,r,n,i){for(var o=0,a=r.length;o<a;++o){var s=r[o];if(_o(e,t,s,n,i))return!0;t=s[s.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)},t.prototype.setCoordinates=function(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);var r=function(e,t,r,n,i){for(var o=i||[],a=0,s=0,l=r.length;s<l;++s){var c=Yi(e,t,r[s],n,o[a]);o[a++]=c,t=c[c.length-1]}return o.length=a,o}(this.flatCoordinates,0,e,this.stride,this.endss_);if(0===r.length)this.flatCoordinates.length=0;else{var n=r[r.length-1];this.flatCoordinates.length=0===n.length?0:n[n.length-1]}this.changed()},t}(Bi);const nl=rl;var il=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),al=function(e){function t(t,r,n){var i=e.call(this)||this;if(void 0!==n&&void 0===r)i.setFlatCoordinates(n,t);else{var o=r||0;i.setCenterAndRadius(t,o,n)}return i}return il(t,e),t.prototype.clone=function(){var e=new t(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e},t.prototype.closestPointXY=function(e,t,r,n){var i=this.flatCoordinates,o=e-i[0],a=t-i[1],s=o*o+a*a;if(s<n){if(0===s)for(var l=0;l<this.stride;++l)r[l]=i[l];else{var c=this.getRadius()/Math.sqrt(s);r[0]=i[0]+c*o,r[1]=i[1]+c*a;for(l=2;l<this.stride;++l)r[l]=i[l]}return r.length=this.stride,s}return n},t.prototype.containsXY=function(e,t){var r=this.flatCoordinates,n=e-r[0],i=t-r[1];return n*n+i*i<=this.getRadiusSquared_()},t.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)},t.prototype.computeExtent=function(e){var t=this.flatCoordinates,r=t[this.stride]-t[0];return ie(t[0]-r,t[1]-r,t[0]+r,t[1]+r,e)},t.prototype.getRadius=function(){return Math.sqrt(this.getRadiusSquared_())},t.prototype.getRadiusSquared_=function(){var e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t},t.prototype.getType=function(){return"Circle"},t.prototype.intersectsExtent=function(e){if(Te(e,this.getExtent())){var t=this.getCenter();return e[0]<=t[0]&&e[2]>=t[0]||(e[1]<=t[1]&&e[3]>=t[1]||de(e,this.intersectsCoordinate.bind(this)))}return!1},t.prototype.setCenter=function(e){var t=this.stride,r=this.flatCoordinates[t]-this.flatCoordinates[0],n=e.slice();n[t]=n[0]+r;for(var i=1;i<t;++i)n[t+i]=e[i];this.setFlatCoordinates(this.layout,n),this.changed()},t.prototype.setCenterAndRadius=function(e,t,r){this.setLayout(r,e,0),this.flatCoordinates||(this.flatCoordinates=[]);var n=this.flatCoordinates,i=Vi(n,0,e,this.stride);n[i++]=n[0]+t;for(var o=1,a=this.stride;o<a;++o)n[i++]=n[o];n.length=i,this.changed()},t.prototype.getCoordinates=function(){return null},t.prototype.setCoordinates=function(e,t){},t.prototype.setRadius=function(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()},t.prototype.rotate=function(e,t){var r=this.getCenter(),n=this.getStride();this.setCenter(Ii(r,0,r.length,n,e,t,r)),this.changed()},t.prototype.translate=function(e,t){var r=this.getCenter(),n=this.getStride();this.setCenter(Ri(r,0,r.length,n,e,t,r)),this.changed()},t}(Bi);al.prototype.transform;const sl=al;var ll=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),cl=function(e){function t(t){var r=e.call(this)||this;return r.geometries_=t||null,r.changeEventsKeys_=[],r.listenGeometriesChange_(),r}return ll(t,e),t.prototype.unlistenGeometriesChange_=function(){this.changeEventsKeys_.forEach(ht),this.changeEventsKeys_.length=0},t.prototype.listenGeometriesChange_=function(){if(this.geometries_)for(var e=0,t=this.geometries_.length;e<t;++e)this.changeEventsKeys_.push(ut(this.geometries_[e],ct.CHANGE,this.changed,this))},t.prototype.clone=function(){var e=new t(null);return e.setGeometries(this.geometries_),e.applyProperties(this),e},t.prototype.closestPointXY=function(e,t,r,n){if(n<J(this.getExtent(),e,t))return n;for(var i=this.geometries_,o=0,a=i.length;o<a;++o)n=i[o].closestPointXY(e,t,r,n);return n},t.prototype.containsXY=function(e,t){for(var r=this.geometries_,n=0,i=r.length;n<i;++n)if(r[n].containsXY(e,t))return!0;return!1},t.prototype.computeExtent=function(e){oe(e);for(var t=this.geometries_,r=0,n=t.length;r<n;++r)ce(e,t[r].getExtent());return e},t.prototype.getGeometries=function(){return ul(this.geometries_)},t.prototype.getGeometriesArray=function(){return this.geometries_},t.prototype.getGeometriesArrayRecursive=function(){for(var e=[],t=this.geometries_,r=0,n=t.length;r<n;++r)t[r].getType()===this.getType()?e=e.concat(t[r].getGeometriesArrayRecursive()):e.push(t[r]);return e},t.prototype.getSimplifiedGeometry=function(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;for(var r=[],n=this.geometries_,i=!1,o=0,a=n.length;o<a;++o){var s=n[o],l=s.getSimplifiedGeometry(e);r.push(l),l!==s&&(i=!0)}if(i){var c=new t(null);return c.setGeometriesArray(r),c}return this.simplifiedGeometryMaxMinSquaredTolerance=e,this},t.prototype.getType=function(){return"GeometryCollection"},t.prototype.intersectsExtent=function(e){for(var t=this.geometries_,r=0,n=t.length;r<n;++r)if(t[r].intersectsExtent(e))return!0;return!1},t.prototype.isEmpty=function(){return 0===this.geometries_.length},t.prototype.rotate=function(e,t){for(var r=this.geometries_,n=0,i=r.length;n<i;++n)r[n].rotate(e,t);this.changed()},t.prototype.scale=function(e,t,r){var n=r;n||(n=me(this.getExtent()));for(var i=this.geometries_,o=0,a=i.length;o<a;++o)i[o].scale(e,t,n);this.changed()},t.prototype.setGeometries=function(e){this.setGeometriesArray(ul(e))},t.prototype.setGeometriesArray=function(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()},t.prototype.applyTransform=function(e){for(var t=this.geometries_,r=0,n=t.length;r<n;++r)t[r].applyTransform(e);this.changed()},t.prototype.translate=function(e,t){for(var r=this.geometries_,n=0,i=r.length;n<i;++n)r[n].translate(e,t);this.changed()},t.prototype.disposeInternal=function(){this.unlistenGeometriesChange_(),e.prototype.disposeInternal.call(this)},t}(Zi);function ul(e){for(var t=[],r=0,n=e.length;r<n;++r)t.push(e[r].clone());return t}const pl=cl;var hl=!1;function dl(e,t){return function(r,n,i,o,a){var s=this;!function(e,t,r,n,i,o,a){var s=new XMLHttpRequest;s.open("GET","function"==typeof e?e(r,n,i):e,!0),"arraybuffer"==t.getType()&&(s.responseType="arraybuffer"),s.withCredentials=hl,s.onload=function(e){if(!s.status||s.status>=200&&s.status<300){var n=t.getType(),l=void 0;"json"==n||"text"==n?l=s.responseText:"xml"==n?(l=s.responseXML)||(l=(new DOMParser).parseFromString(s.responseText,"application/xml")):"arraybuffer"==n&&(l=s.response),l?o(t.readFeatures(l,{extent:r,featureProjection:i}),t.readProjection(l)):a()}else a()},s.onerror=a,s.send()}(e,t,r,n,i,(function(e,t){s.addFeatures(e),void 0!==o&&o(e)}),a||v)}}const fl=function(){function e(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}return e.prototype.getReadOptions=function(e,t){var r;if(t){var n=t.dataProjection?$n(t.dataProjection):this.readProjection(e);t.extent&&n&&n.getUnits()===_n.TILE_PIXELS&&(n=$n(n)).setWorldExtent(t.extent),r={dataProjection:n,featureProjection:t.featureProjection}}return this.adaptOptions(r)},e.prototype.adaptOptions=function(e){return nt({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},e)},e.prototype.getType=function(){return n()},e.prototype.readFeature=function(e,t){return n()},e.prototype.readFeatures=function(e,t){return n()},e.prototype.readGeometry=function(e,t){return n()},e.prototype.readProjection=function(e){return n()},e.prototype.writeFeature=function(e,t){return n()},e.prototype.writeFeatures=function(e,t){return n()},e.prototype.writeGeometry=function(e,t){return n()},e}();function gl(e,t,r){var n,i=r?$n(r.featureProjection):null,o=r?$n(r.dataProjection):null;if(n=i&&o&&!ri(i,o)?(t?e.clone():e).transform(t?i:o,t?o:i):e,t&&r&&void 0!==r.decimals){var a=Math.pow(10,r.decimals);n===e&&(n=e.clone()),n.applyTransform((function(e){for(var t=0,r=e.length;t<r;++t)e[t]=Math.round(e[t]*a)/a;return e}))}return n}function yl(e,t){var r=t?$n(t.featureProjection):null,n=t?$n(t.dataProjection):null;return r&&n&&!ri(r,n)?ai(e,n,r):e}var ml="http://www.w3.org/2001/XMLSchema-instance";function vl(e,t){return Bl().createElementNS(e,t)}function _l(e,t){return wl(e,t,[]).join("")}function wl(e,t,r){if(e.nodeType==Node.CDATA_SECTION_NODE||e.nodeType==Node.TEXT_NODE)t?r.push(String(e.nodeValue).replace(/(\r\n|\r|\n)/g,"")):r.push(e.nodeValue);else{var n=void 0;for(n=e.firstChild;n;n=n.nextSibling)wl(n,t,r)}return r}function Sl(e){return"documentElement"in e}function El(e){return(new DOMParser).parseFromString(e,"application/xml")}function bl(e,t){return function(r,n){var i=e.call(void 0!==t?t:this,r,n);void 0!==i&&h(n[n.length-1],i)}}function Cl(e,t){return function(r,n){var i=e.call(void 0!==t?t:this,r,n);void 0!==i&&n[n.length-1].push(i)}}function Ll(e,t){return function(r,n){var i=e.call(void 0!==t?t:this,r,n);void 0!==i&&(n[n.length-1]=i)}}function Tl(e,t,r){return function(n,i){var o=e.call(void 0!==r?r:this,n,i);if(void 0!==o){var a=i[i.length-1],s=void 0!==t?t:n.localName,l=void 0;s in a?l=a[s]:(l=[],a[s]=l),l.push(o)}}}function Al(e,t,r){return function(n,i){var o=e.call(void 0!==r?r:this,n,i);void 0!==o&&(i[i.length-1][void 0!==t?t:n.localName]=o)}}function xl(e,t){return function(r,n,i){e.call(void 0!==t?t:this,r,n,i),i[i.length-1].node.appendChild(r)}}function Pl(e,t){var r,n;return function(t,i,o){if(void 0===r){r={};var a={};a[t.localName]=e,r[t.namespaceURI]=a,n=Ol(t.localName)}Zl(r,n,i,o)}}function Ol(e,t){var r=e;return function(e,n,i){var o=n[n.length-1].node,a=r;return void 0===a&&(a=i),vl(void 0!==t?t:o.namespaceURI,a)}}var Il=Ol();function Rl(e,t){for(var r=t.length,n=new Array(r),i=0;i<r;++i)n[i]=e[t[i]];return n}function Ml(e,t,r){var n,i,o=void 0!==r?r:{};for(n=0,i=e.length;n<i;++n)o[e[n]]=t;return o}function Dl(e,t,r,n){var i;for(i=t.firstElementChild;i;i=i.nextElementSibling){var o=e[i.namespaceURI];if(void 0!==o){var a=o[i.localName];void 0!==a&&a.call(n,i,r)}}}function Nl(e,t,r,n,i){return n.push(e),Dl(t,r,n,i),n.pop()}function Zl(e,t,r,n,i,o){for(var a,s,l=(void 0!==i?i:r).length,c=0;c<l;++c)void 0!==(a=r[c])&&void 0!==(s=t.call(void 0!==o?o:this,a,n,void 0!==i?i[c]:void 0))&&e[s.namespaceURI][s.localName].call(o,s,a,n)}function kl(e,t,r,n,i,o,a){return i.push(e),Zl(t,r,n,i,o,a),i.pop()}var Fl=void 0;var Ul=void 0;function Bl(){return void 0===Ul&&"undefined"!=typeof document&&(Ul=document.implementation.createDocument("","",null)),Ul}var Gl=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const jl=function(e){function t(){var t=e.call(this)||this;return t.xmlSerializer_=(void 0===Fl&&"undefined"!=typeof XMLSerializer&&(Fl=new XMLSerializer),Fl),t}return Gl(t,e),t.prototype.getType=function(){return"xml"},t.prototype.readFeature=function(e,t){if(e){if("string"==typeof e){var r=El(e);return this.readFeatureFromDocument(r,t)}return Sl(e)?this.readFeatureFromDocument(e,t):this.readFeatureFromNode(e,t)}return null},t.prototype.readFeatureFromDocument=function(e,t){var r=this.readFeaturesFromDocument(e,t);return r.length>0?r[0]:null},t.prototype.readFeatureFromNode=function(e,t){return null},t.prototype.readFeatures=function(e,t){if(e){if("string"==typeof e){var r=El(e);return this.readFeaturesFromDocument(r,t)}return Sl(e)?this.readFeaturesFromDocument(e,t):this.readFeaturesFromNode(e,t)}return[]},t.prototype.readFeaturesFromDocument=function(e,t){for(var r=[],n=e.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&h(r,this.readFeaturesFromNode(n,t));return r},t.prototype.readFeaturesFromNode=function(e,t){return n()},t.prototype.readGeometry=function(e,t){if(e){if("string"==typeof e){var r=El(e);return this.readGeometryFromDocument(r,t)}return Sl(e)?this.readGeometryFromDocument(e,t):this.readGeometryFromNode(e,t)}return null},t.prototype.readGeometryFromDocument=function(e,t){return null},t.prototype.readGeometryFromNode=function(e,t){return null},t.prototype.readProjection=function(e){if(e){if("string"==typeof e){var t=El(e);return this.readProjectionFromDocument(t)}return Sl(e)?this.readProjectionFromDocument(e):this.readProjectionFromNode(e)}return null},t.prototype.readProjectionFromDocument=function(e){return this.dataProjection},t.prototype.readProjectionFromNode=function(e){return this.dataProjection},t.prototype.writeFeature=function(e,t){var r=this.writeFeatureNode(e,t);return this.xmlSerializer_.serializeToString(r)},t.prototype.writeFeatureNode=function(e,t){return null},t.prototype.writeFeatures=function(e,t){var r=this.writeFeaturesNode(e,t);return this.xmlSerializer_.serializeToString(r)},t.prototype.writeFeaturesNode=function(e,t){return null},t.prototype.writeGeometry=function(e,t){var r=this.writeGeometryNode(e,t);return this.xmlSerializer_.serializeToString(r)},t.prototype.writeGeometryNode=function(e,t){return null},t}(fl);var Wl=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Hl="http://www.opengis.net/gml",ql=/^[\s\xa0]*$/,Vl=function(e){function t(t){var r=e.call(this)||this,n=t||{};return r.featureType=n.featureType,r.featureNS=n.featureNS,r.srsName=n.srsName,r.schemaLocation="",r.FEATURE_COLLECTION_PARSERS={},r.FEATURE_COLLECTION_PARSERS[r.namespace]={featureMember:Cl(r.readFeaturesInternal),featureMembers:Ll(r.readFeaturesInternal)},r.supportedMediaTypes=["application/gml+xml"],r}return Wl(t,e),t.prototype.readFeaturesInternal=function(e,t){var r=e.localName,n=null;if("FeatureCollection"==r)n=Nl([],this.FEATURE_COLLECTION_PARSERS,e,t,this);else if("featureMembers"==r||"featureMember"==r||"member"==r){var i=t[0],o=i.featureType,a=i.featureNS;if(!o&&e.childNodes){o=[],a={};for(var s=0,l=e.childNodes.length;s<l;++s){var c=e.childNodes[s];if(1===c.nodeType){var u=c.nodeName.split(":").pop();if(-1===o.indexOf(u)){var p="",h=0,d=c.namespaceURI;for(var f in a){if(a[f]===d){p=f;break}++h}p||(a[p="p"+h]=d),o.push(p+":"+u)}}}"featureMember"!=r&&(i.featureType=o,i.featureNS=a)}if("string"==typeof a){var g=a;(a={}).p0=g}var y={},m=Array.isArray(o)?o:[o];for(var v in a){var _={};for(s=0,l=m.length;s<l;++s){(-1===m[s].indexOf(":")?"p0":m[s].split(":")[0])===v&&(_[m[s].split(":").pop()]="featureMembers"==r?Cl(this.readFeatureElement,this):Ll(this.readFeatureElement,this))}y[a[v]]=_}n=Nl("featureMember"==r||"member"==r?void 0:[],y,e,t)}return null===n&&(n=[]),n},t.prototype.readGeometryOrExtent=function(e,t){var r=t[0];return r.srsName=e.firstElementChild.getAttribute("srsName"),r.srsDimension=e.firstElementChild.getAttribute("srsDimension"),Nl(null,this.GEOMETRY_PARSERS,e,t,this)},t.prototype.readExtentElement=function(e,t){var r=t[0],n=this.readGeometryOrExtent(e,t);return n?yl(n,r):void 0},t.prototype.readGeometryElement=function(e,t){var r=t[0],n=this.readGeometryOrExtent(e,t);return n?gl(n,!1,r):void 0},t.prototype.readFeatureElementInternal=function(e,t,r){for(var n,i={},o=e.firstElementChild;o;o=o.nextElementSibling){var a=void 0,s=o.localName;0===o.childNodes.length||1===o.childNodes.length&&(3===o.firstChild.nodeType||4===o.firstChild.nodeType)?(a=_l(o,!1),ql.test(a)&&(a=void 0)):(r&&(a="boundedBy"===s?this.readExtentElement(o,t):this.readGeometryElement(o,t)),a?"boundedBy"!==s&&(n=s):a=this.readFeatureElementInternal(o,t,!1));var l=o.attributes.length;if(l>0){a={_content_:a};for(var c=0;c<l;c++){a[o.attributes[c].name]=o.attributes[c].value}}i[s]?(i[s]instanceof Array||(i[s]=[i[s]]),i[s].push(a)):i[s]=a}if(r){var u=new js(i);n&&u.setGeometryName(n);var p=e.getAttribute("fid")||function(e,t,r){return e.getAttributeNS(t,r)||""}(e,this.namespace,"id");return p&&u.setId(p),u}return i},t.prototype.readFeatureElement=function(e,t){return this.readFeatureElementInternal(e,t,!0)},t.prototype.readPoint=function(e,t){var r=this.readFlatCoordinatesFromNode(e,t);if(r)return new uo(r,Pi.XYZ)},t.prototype.readMultiPoint=function(e,t){var r=Nl([],this.MULTIPOINT_PARSERS,e,t,this);return r?new qs(r):void 0},t.prototype.readMultiLineString=function(e,t){var r=Nl([],this.MULTILINESTRING_PARSERS,e,t,this);if(r)return new el(r)},t.prototype.readMultiPolygon=function(e,t){var r=Nl([],this.MULTIPOLYGON_PARSERS,e,t,this);if(r)return new nl(r)},t.prototype.pointMemberParser=function(e,t){Dl(this.POINTMEMBER_PARSERS,e,t,this)},t.prototype.lineStringMemberParser=function(e,t){Dl(this.LINESTRINGMEMBER_PARSERS,e,t,this)},t.prototype.polygonMemberParser=function(e,t){Dl(this.POLYGONMEMBER_PARSERS,e,t,this)},t.prototype.readLineString=function(e,t){var r=this.readFlatCoordinatesFromNode(e,t);return r?new $s(r,Pi.XYZ):void 0},t.prototype.readFlatLinearRing=function(e,t){var r=Nl(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this);return r||void 0},t.prototype.readLinearRing=function(e,t){var r=this.readFlatCoordinatesFromNode(e,t);if(r)return new so(r,Pi.XYZ)},t.prototype.readPolygon=function(e,t){var r=Nl([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this);if(r&&r[0]){var n,i=r[0],o=[i.length],a=void 0;for(a=1,n=r.length;a<n;++a)h(i,r[a]),o.push(i.length);return new Ao(i,Pi.XYZ,o)}},t.prototype.readFlatCoordinatesFromNode=function(e,t){return Nl(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)},t.prototype.readGeometryFromNode=function(e,t){var r=this.readGeometryElement(e,[this.getReadOptions(e,t||{})]);return r||null},t.prototype.readFeaturesFromNode=function(e,t){var r={featureType:this.featureType,featureNS:this.featureNS};return t&&nt(r,this.getReadOptions(e,t)),this.readFeaturesInternal(e,[r])||[]},t.prototype.readProjectionFromNode=function(e){return $n(this.srsName?this.srsName:e.firstElementChild.getAttribute("srsName"))},t}(jl);Vl.prototype.namespace=Hl,Vl.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}},Vl.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}},Vl.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}},Vl.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:Cl(Vl.prototype.pointMemberParser),pointMembers:Cl(Vl.prototype.pointMemberParser)}},Vl.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:Cl(Vl.prototype.lineStringMemberParser),lineStringMembers:Cl(Vl.prototype.lineStringMemberParser)}},Vl.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:Cl(Vl.prototype.polygonMemberParser),polygonMembers:Cl(Vl.prototype.polygonMemberParser)}},Vl.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:Cl(Vl.prototype.readFlatCoordinatesFromNode)}},Vl.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:Cl(Vl.prototype.readLineString)}},Vl.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:Cl(Vl.prototype.readPolygon)}},Vl.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:Ll(Vl.prototype.readFlatLinearRing)}};const zl=Vl,Yl="http://www.opengis.net/gml",Kl="http://www.opengis.net/gml/3.2";zl.prototype.MULTIPOINT_PARSERS[Kl]=zl.prototype.MULTIPOINT_PARSERS[Yl],zl.prototype.MULTILINESTRING_PARSERS[Kl]=zl.prototype.MULTILINESTRING_PARSERS[Yl],zl.prototype.MULTIPOLYGON_PARSERS[Kl]=zl.prototype.MULTIPOLYGON_PARSERS[Yl],zl.prototype.POINTMEMBER_PARSERS[Kl]=zl.prototype.POINTMEMBER_PARSERS[Yl],zl.prototype.LINESTRINGMEMBER_PARSERS[Kl]=zl.prototype.LINESTRINGMEMBER_PARSERS[Yl],zl.prototype.POLYGONMEMBER_PARSERS[Kl]=zl.prototype.POLYGONMEMBER_PARSERS[Yl],zl.prototype.RING_PARSERS[Kl]=zl.prototype.RING_PARSERS[Yl],zl.prototype.readFeaturesInternal=function(e,t){const r=e.localName;let n=null;if("FeatureCollection"==r){var i=this.FEATURE_COLLECTION_PARSERS[ol.format.GMLBase.prototype.namespace]||this.FEATURE_COLLECTION_PARSERS[this.namespace];i.member||(i.member=ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.readFeaturesInternal)),"http://www.opengis.net/wfs"===e.namespaceURI||(this.FEATURE_COLLECTION_PARSERS[e.namespaceURI]=this.FEATURE_COLLECTION_PARSERS[e.namespaceURI]||this.FEATURE_COLLECTION_PARSERS[ol.format.GMLBase.prototype.namespace]||this.FEATURE_COLLECTION_PARSERS[this.namespace]),n=ol.xml.pushParseAndPop([],this.FEATURE_COLLECTION_PARSERS,e,t,this)}else if("featureMembers"==r||"featureMember"==r||"member"==r){const i=t[0];let o=i.featureType,a=i.featureNS;const s="p",l="p0";if(/*!featureType && */e.childNodes){o=[],a={};for(let r=0,n=e.childNodes.length;r<n;++r){const n=e.childNodes[r];if(1===n.nodeType){const e=n.nodeName.split(":").pop();if("FeatureCollection"==e)return Nl([],this.FEATURE_COLLECTION_PARSERS,n,t,this);if(-1===o.indexOf(e)){let t="",r=0;const i=n.namespaceURI;for(let e in a){if(a[e]===i){t=e;break}++r}t||(t=s+r,a[t]=i),o.push(t+":"+e)}}}"featureMember"!=r&&(i.featureType=o,i.featureNS=a)}if("string"==typeof a){const e=a;a={},a[l]=e}const c={},u=Array.isArray(o)?o:[o];for(let e in a){const t={};for(let n=0,i=u.length;n<i;++n){(-1===u[n].indexOf(":")?l:u[n].split(":")[0])===e&&(t[u[n].split(":").pop()]="featureMembers"==r?ol.xml.makeArrayPusher(this.readFeatureElement,this):ol.xml.makeReplacer(this.readFeatureElement,this))}c[a[e]]=t}n="featureMember"==r?ol.xml.pushParseAndPop(void 0,c,e,t):ol.xml.pushParseAndPop([],c,e,t)}return null===n&&(n=[]),n},zl.prototype.readGeometryElement=function(e,t){var r=t[0];if(r.srsName=e.firstElementChild.getAttribute("srsName"),r.srsDimension=e.firstElementChild.getAttribute("srsDimension"),(this instanceof ol.format.GML2CRS84||this instanceof ol.format.GML3CRS84)&&("EPSG:4326"!==r.srsName||!r.srsName))throw new Error("Conflicto de CRS");r.srsName||(r.srsName=this.srsName),r.dataProjection=ol.proj.get(r.srsName);const n=ol.xml.pushParseAndPop(null,this.GEOMETRY_PARSERS,e,t,this);return n?Array.isArray(n)?yl(n,r):gl(n,!1,r):void 0};const Xl=/^[\s\xa0]*$/;zl.prototype.readFeatureElementInternal=function(e,t,r){let n;const i={};for(let o=e.firstElementChild;o;o=o.nextElementSibling){let e;const a=o.localName;0===o.childNodes.length||1===o.childNodes.length&&(3===o.firstChild.nodeType||4===o.firstChild.nodeType)?(e=ol.xml.getAllTextContent(o,!1),Xl.test(e)&&(e=void 0)):(r&&(e=this.readGeometryElement(o,t)),e?"boundedBy"!==a&&"referencePoint"!==a&&(n=a):e=this.readFeatureElementInternal(o,t,!1)),i[a]?(i[a]instanceof Array||(i[a]=[i[a]]),i[a].push(e)):i[a]=e;const s=o.attributes.length;if(s>0){i[a]={_content_:i[a]};for(let e=0;e<s;e++){const t=o.attributes[e].name;i[a][t]=o.attributes[e].value}}}if(r){const t=new ol.Feature(i);n&&t.setGeometryName(n);const r=e.getAttribute("fid")||e.getAttributeNS(this.namespace,"id");return r&&t.setId(r),t}return i};const $l=zl;function Jl(e){return Ql(_l(e,!1))}function Ql(e){var t=/^\s*(true|1)|(false|0)\s*$/.exec(e);return t?void 0!==t[1]||!1:void 0}function ec(e){var t=_l(e,!1),r=Date.parse(t);return isNaN(r)?void 0:r/1e3}function tc(e){return rc(_l(e,!1))}function rc(e){var t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(e);return t?parseFloat(t[1]):void 0}function nc(e){return ic(_l(e,!1))}function ic(e){var t=/^\s*(\d+)\s*$/.exec(e);return t?parseInt(t[1],10):void 0}function oc(e){return _l(e,!1).trim()}function ac(e,t){uc(e,t?"1":"0")}function sc(e,t){e.appendChild(Bl().createCDATASection(t))}function lc(e,t){var r=t.toPrecision();e.appendChild(Bl().createTextNode(r))}function cc(e,t){var r=t.toString();e.appendChild(Bl().createTextNode(r))}function uc(e,t){e.appendChild(Bl().createTextNode(t))}var pc=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),hc={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"},dc=function(e){function t(t){var r=this,n=t||{};return(r=e.call(this,n)||this).FEATURE_COLLECTION_PARSERS[Hl].featureMember=Cl(r.readFeaturesInternal),r.schemaLocation=n.schemaLocation?n.schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",r}return pc(t,e),t.prototype.readFlatCoordinates=function(e,t){var r=_l(e,!1).replace(/^\s*|\s*$/g,""),n=t[0].srsName,i="enu";if(n){var o=$n(n);o&&(i=o.getAxisOrientation())}for(var a=r.trim().split(/\s+/),s=[],l=0,c=a.length;l<c;l++){var u=a[l].split(/,+/),p=parseFloat(u[0]),h=parseFloat(u[1]),d=3===u.length?parseFloat(u[2]):0;"en"===i.substr(0,2)?s.push(p,h,d):s.push(h,p,d)}return s},t.prototype.readBox=function(e,t){var r=Nl([null],this.BOX_PARSERS_,e,t,this);return ie(r[1][0],r[1][1],r[1][3],r[1][4])},t.prototype.innerBoundaryIsParser=function(e,t){var r=Nl(void 0,this.RING_PARSERS,e,t,this);r&&t[t.length-1].push(r)},t.prototype.outerBoundaryIsParser=function(e,t){var r=Nl(void 0,this.RING_PARSERS,e,t,this);r&&(t[t.length-1][0]=r)},t.prototype.GEOMETRY_NODE_FACTORY_=function(e,t,r){var n,i=t[t.length-1],o=i.multiSurface,a=i.surface,s=i.multiCurve;return Array.isArray(e)?n="Envelope":"MultiPolygon"===(n=e.getType())&&!0===o?n="MultiSurface":"Polygon"===n&&!0===a?n="Surface":"MultiLineString"===n&&!0===s&&(n="MultiCurve"),vl("http://www.opengis.net/gml",n)},t.prototype.writeFeatureElement=function(e,t,r){var n=t.getId();n&&e.setAttribute("fid",n);var i=r[r.length-1],o=i.featureNS,a=t.getGeometryName();i.serializers||(i.serializers={},i.serializers[o]={});var s=[],l=[];if(t.hasProperties()){var c=t.getProperties();for(var u in c){var p=c[u];null!==p&&(s.push(u),l.push(p),u==a||"function"==typeof p.getSimplifiedGeometry?u in i.serializers[o]||(i.serializers[o][u]=xl(this.writeGeometryElement,this)):u in i.serializers[o]||(i.serializers[o][u]=xl(uc)))}}var h=nt({},i);h.node=e,kl(h,i.serializers,Ol(void 0,o),l,r,s)},t.prototype.writeCurveOrLineString=function(e,t,r){var n=r[r.length-1].srsName;if("LineStringSegment"!==e.nodeName&&n&&e.setAttribute("srsName",n),"LineString"===e.nodeName||"LineStringSegment"===e.nodeName){var i=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(i),this.writeCoordinates_(i,t,r)}else if("Curve"===e.nodeName){var o=vl(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,r)}},t.prototype.writeLineStringOrCurveMember=function(e,t,r){var n=this.GEOMETRY_NODE_FACTORY_(t,r);n&&(e.appendChild(n),this.writeCurveOrLineString(n,t,r))},t.prototype.writeMultiCurveOrLineString=function(e,t,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName,a=n.curve;o&&e.setAttribute("srsName",o);var s=t.getLineStrings();kl({node:e,hasZ:i,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,r,void 0,this)},t.prototype.writeGeometryElement=function(e,t,r){var n,i=r[r.length-1],o=nt({},i);o.node=e,n=Array.isArray(t)?yl(t,i):gl(t,!0,i),kl(o,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[n],r,void 0,this)},t.prototype.createCoordinatesNode_=function(e){var t=vl(e,"coordinates");return t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," "),t},t.prototype.writeCoordinates_=function(e,t,r){for(var n=r[r.length-1],i=n.hasZ,o=n.srsName,a=t.getCoordinates(),s=a.length,l=new Array(s),c=0;c<s;++c){var u=a[c];l[c]=this.getCoords_(u,o,i)}uc(e,l.join(" "))},t.prototype.writeCurveSegments_=function(e,t,r){var n=vl(e.namespaceURI,"LineStringSegment");e.appendChild(n),this.writeCurveOrLineString(n,t,r)},t.prototype.writeSurfaceOrPolygon=function(e,t,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName;if("PolygonPatch"!==e.nodeName&&o&&e.setAttribute("srsName",o),"Polygon"===e.nodeName||"PolygonPatch"===e.nodeName){var a=t.getLinearRings();kl({node:e,hasZ:i,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,r,void 0,this)}else if("Surface"===e.nodeName){var s=vl(e.namespaceURI,"patches");e.appendChild(s),this.writeSurfacePatches_(s,t,r)}},t.prototype.RING_NODE_FACTORY_=function(e,t,r){var n=t[t.length-1],i=n.node,o=n.exteriorWritten;return void 0===o&&(n.exteriorWritten=!0),vl(i.namespaceURI,void 0!==o?"innerBoundaryIs":"outerBoundaryIs")},t.prototype.writeSurfacePatches_=function(e,t,r){var n=vl(e.namespaceURI,"PolygonPatch");e.appendChild(n),this.writeSurfaceOrPolygon(n,t,r)},t.prototype.writeRing=function(e,t,r){var n=vl(e.namespaceURI,"LinearRing");e.appendChild(n),this.writeLinearRing(n,t,r)},t.prototype.getCoords_=function(e,t,r){var n="enu";t&&(n=$n(t).getAxisOrientation());var i="en"===n.substr(0,2)?e[0]+","+e[1]:e[1]+","+e[0];r&&(i+=","+(e[2]||0));return i},t.prototype.writePoint=function(e,t,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName;o&&e.setAttribute("srsName",o);var a=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(a);var s=t.getCoordinates();uc(a,this.getCoords_(s,o,i))},t.prototype.writeMultiPoint=function(e,t,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName;o&&e.setAttribute("srsName",o);var a=t.getPoints();kl({node:e,hasZ:i,srsName:o},this.POINTMEMBER_SERIALIZERS,Ol("pointMember"),a,r,void 0,this)},t.prototype.writePointMember=function(e,t,r){var n=vl(e.namespaceURI,"Point");e.appendChild(n),this.writePoint(n,t,r)},t.prototype.writeLinearRing=function(e,t,r){var n=r[r.length-1].srsName;n&&e.setAttribute("srsName",n);var i=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(i),this.writeCoordinates_(i,t,r)},t.prototype.writeMultiSurfaceOrPolygon=function(e,t,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName,a=n.surface;o&&e.setAttribute("srsName",o);var s=t.getPolygons();kl({node:e,hasZ:i,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,r,void 0,this)},t.prototype.writeSurfaceOrPolygonMember=function(e,t,r){var n=this.GEOMETRY_NODE_FACTORY_(t,r);n&&(e.appendChild(n),this.writeSurfaceOrPolygon(n,t,r))},t.prototype.writeEnvelope=function(e,t,r){var n=r[r.length-1].srsName;n&&e.setAttribute("srsName",n);var i=[t[0]+" "+t[1],t[2]+" "+t[3]];kl({node:e},this.ENVELOPE_SERIALIZERS,Il,i,r,["lowerCorner","upperCorner"],this)},t.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_=function(e,t,r){var n=t[t.length-1].node;return vl("http://www.opengis.net/gml",hc[n.nodeName])},t}(zl);dc.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:Ll(dc.prototype.readFlatCoordinates)}},dc.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:dc.prototype.innerBoundaryIsParser,outerBoundaryIs:dc.prototype.outerBoundaryIsParser}},dc.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:Cl(dc.prototype.readFlatCoordinates)}},dc.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:Ll(zl.prototype.readPoint),MultiPoint:Ll(zl.prototype.readMultiPoint),LineString:Ll(zl.prototype.readLineString),MultiLineString:Ll(zl.prototype.readMultiLineString),LinearRing:Ll(zl.prototype.readLinearRing),Polygon:Ll(zl.prototype.readPolygon),MultiPolygon:Ll(zl.prototype.readMultiPolygon),Box:Ll(dc.prototype.readBox)}},dc.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:xl(dc.prototype.writeCurveOrLineString),MultiCurve:xl(dc.prototype.writeMultiCurveOrLineString),Point:xl(dc.prototype.writePoint),MultiPoint:xl(dc.prototype.writeMultiPoint),LineString:xl(dc.prototype.writeCurveOrLineString),MultiLineString:xl(dc.prototype.writeMultiCurveOrLineString),LinearRing:xl(dc.prototype.writeLinearRing),Polygon:xl(dc.prototype.writeSurfaceOrPolygon),MultiPolygon:xl(dc.prototype.writeMultiSurfaceOrPolygon),Surface:xl(dc.prototype.writeSurfaceOrPolygon),MultiSurface:xl(dc.prototype.writeMultiSurfaceOrPolygon),Envelope:xl(dc.prototype.writeEnvelope)}},dc.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:xl(dc.prototype.writeLineStringOrCurveMember),curveMember:xl(dc.prototype.writeLineStringOrCurveMember)}},dc.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:xl(dc.prototype.writeRing),innerBoundaryIs:xl(dc.prototype.writeRing)}},dc.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:xl(dc.prototype.writePointMember)}},dc.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:xl(dc.prototype.writeSurfaceOrPolygonMember),polygonMember:xl(dc.prototype.writeSurfaceOrPolygonMember)}},dc.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:xl(uc),upperCorner:xl(uc)}};const fc=dc;var gc=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),yc={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"},mc=function(e){function t(t){var r=this,n=t||{};return(r=e.call(this,n)||this).surface_=void 0!==n.surface&&n.surface,r.curve_=void 0!==n.curve&&n.curve,r.multiCurve_=void 0===n.multiCurve||n.multiCurve,r.multiSurface_=void 0===n.multiSurface||n.multiSurface,r.schemaLocation=n.schemaLocation?n.schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",r.hasZ=void 0!==n.hasZ&&n.hasZ,r}return gc(t,e),t.prototype.readMultiCurve=function(e,t){var r=Nl([],this.MULTICURVE_PARSERS,e,t,this);return r?new el(r):void 0},t.prototype.readFlatCurveRing=function(e,t){for(var r=Nl([],this.MULTICURVE_PARSERS,e,t,this),n=[],i=0,o=r.length;i<o;++i)h(n,r[i].getFlatCoordinates());return n},t.prototype.readMultiSurface=function(e,t){var r=Nl([],this.MULTISURFACE_PARSERS,e,t,this);if(r)return new nl(r)},t.prototype.curveMemberParser=function(e,t){Dl(this.CURVEMEMBER_PARSERS,e,t,this)},t.prototype.surfaceMemberParser=function(e,t){Dl(this.SURFACEMEMBER_PARSERS,e,t,this)},t.prototype.readPatch=function(e,t){return Nl([null],this.PATCHES_PARSERS,e,t,this)},t.prototype.readSegment=function(e,t){return Nl([],this.SEGMENTS_PARSERS,e,t,this)},t.prototype.readPolygonPatch=function(e,t){return Nl([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this)},t.prototype.readLineStringSegment=function(e,t){return Nl([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)},t.prototype.interiorParser=function(e,t){var r=Nl(void 0,this.RING_PARSERS,e,t,this);r&&t[t.length-1].push(r)},t.prototype.exteriorParser=function(e,t){var r=Nl(void 0,this.RING_PARSERS,e,t,this);r&&(t[t.length-1][0]=r)},t.prototype.readSurface=function(e,t){var r=Nl([null],this.SURFACE_PARSERS,e,t,this);if(r&&r[0]){var n,i=r[0],o=[i.length],a=void 0;for(a=1,n=r.length;a<n;++a)h(i,r[a]),o.push(i.length);return new Ao(i,Pi.XYZ,o)}},t.prototype.readCurve=function(e,t){var r=Nl([null],this.CURVE_PARSERS,e,t,this);return r?new $s(r,Pi.XYZ):void 0},t.prototype.readEnvelope=function(e,t){var r=Nl([null],this.ENVELOPE_PARSERS,e,t,this);return ie(r[1][0],r[1][1],r[2][0],r[2][1])},t.prototype.readFlatPos=function(e,t){for(var r,n=_l(e,!1),i=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,o=[];r=i.exec(n);)o.push(parseFloat(r[1])),n=n.substr(r[0].length);if(""===n){var a=t[0].srsName,s="enu";if(a)s=$n(a).getAxisOrientation();if("neu"===s){var l,c=void 0;for(c=0,l=o.length;c<l;c+=3){var u=o[c],p=o[c+1];o[c]=p,o[c+1]=u}}var h=o.length;if(2==h&&o.push(0),0!==h)return o}},t.prototype.readFlatPosList=function(e,t){var r=_l(e,!1).replace(/^\s*|\s*$/g,""),n=t[0],i=n.srsName,o=n.srsDimension,a="enu";i&&(a=$n(i).getAxisOrientation());var s,l,c,u=r.split(/\s+/),p=2;e.getAttribute("srsDimension")?p=ic(e.getAttribute("srsDimension")):e.getAttribute("dimension")?p=ic(e.getAttribute("dimension")):e.parentNode.getAttribute("srsDimension")?p=ic(e.parentNode.getAttribute("srsDimension")):o&&(p=ic(o));for(var h=[],d=0,f=u.length;d<f;d+=p)s=parseFloat(u[d]),l=parseFloat(u[d+1]),c=3===p?parseFloat(u[d+2]):0,"en"===a.substr(0,2)?h.push(s,l,c):h.push(l,s,c);return h},t.prototype.writePos_=function(e,t,r){var n=r[r.length-1],i=n.hasZ,o=i?"3":"2";e.setAttribute("srsDimension",o);var a=n.srsName,s="enu";a&&(s=$n(a).getAxisOrientation());var l,c=t.getCoordinates();(l="en"===s.substr(0,2)?c[0]+" "+c[1]:c[1]+" "+c[0],i)&&(l+=" "+(c[2]||0));uc(e,l)},t.prototype.getCoords_=function(e,t,r){var n="enu";t&&(n=$n(t).getAxisOrientation());var i="en"===n.substr(0,2)?e[0]+" "+e[1]:e[1]+" "+e[0];r&&(i+=" "+(e[2]||0));return i},t.prototype.writePosList_=function(e,t,r){var n=r[r.length-1],i=n.hasZ,o=i?"3":"2";e.setAttribute("srsDimension",o);for(var a,s=n.srsName,l=t.getCoordinates(),c=l.length,u=new Array(c),p=0;p<c;++p)a=l[p],u[p]=this.getCoords_(a,s,i);uc(e,u.join(" "))},t.prototype.writePoint=function(e,t,r){var n=r[r.length-1].srsName;n&&e.setAttribute("srsName",n);var i=vl(e.namespaceURI,"pos");e.appendChild(i),this.writePos_(i,t,r)},t.prototype.writeEnvelope=function(e,t,r){var n=r[r.length-1].srsName;n&&e.setAttribute("srsName",n);var i=[t[0]+" "+t[1],t[2]+" "+t[3]];kl({node:e},this.ENVELOPE_SERIALIZERS,Il,i,r,["lowerCorner","upperCorner"],this)},t.prototype.writeLinearRing=function(e,t,r){var n=r[r.length-1].srsName;n&&e.setAttribute("srsName",n);var i=vl(e.namespaceURI,"posList");e.appendChild(i),this.writePosList_(i,t,r)},t.prototype.RING_NODE_FACTORY_=function(e,t,r){var n=t[t.length-1],i=n.node,o=n.exteriorWritten;return void 0===o&&(n.exteriorWritten=!0),vl(i.namespaceURI,void 0!==o?"interior":"exterior")},t.prototype.writeSurfaceOrPolygon=function(e,t,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName;if("PolygonPatch"!==e.nodeName&&o&&e.setAttribute("srsName",o),"Polygon"===e.nodeName||"PolygonPatch"===e.nodeName){var a=t.getLinearRings();kl({node:e,hasZ:i,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,r,void 0,this)}else if("Surface"===e.nodeName){var s=vl(e.namespaceURI,"patches");e.appendChild(s),this.writeSurfacePatches_(s,t,r)}},t.prototype.writeCurveOrLineString=function(e,t,r){var n=r[r.length-1].srsName;if("LineStringSegment"!==e.nodeName&&n&&e.setAttribute("srsName",n),"LineString"===e.nodeName||"LineStringSegment"===e.nodeName){var i=vl(e.namespaceURI,"posList");e.appendChild(i),this.writePosList_(i,t,r)}else if("Curve"===e.nodeName){var o=vl(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,r)}},t.prototype.writeMultiSurfaceOrPolygon=function(e,t,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName,a=n.surface;o&&e.setAttribute("srsName",o);var s=t.getPolygons();kl({node:e,hasZ:i,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,r,void 0,this)},t.prototype.writeMultiPoint=function(e,t,r){var n=r[r.length-1],i=n.srsName,o=n.hasZ;i&&e.setAttribute("srsName",i);var a=t.getPoints();kl({node:e,hasZ:o,srsName:i},this.POINTMEMBER_SERIALIZERS,Ol("pointMember"),a,r,void 0,this)},t.prototype.writeMultiCurveOrLineString=function(e,t,r){var n=r[r.length-1],i=n.hasZ,o=n.srsName,a=n.curve;o&&e.setAttribute("srsName",o);var s=t.getLineStrings();kl({node:e,hasZ:i,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,r,void 0,this)},t.prototype.writeRing=function(e,t,r){var n=vl(e.namespaceURI,"LinearRing");e.appendChild(n),this.writeLinearRing(n,t,r)},t.prototype.writeSurfaceOrPolygonMember=function(e,t,r){var n=this.GEOMETRY_NODE_FACTORY_(t,r);n&&(e.appendChild(n),this.writeSurfaceOrPolygon(n,t,r))},t.prototype.writePointMember=function(e,t,r){var n=vl(e.namespaceURI,"Point");e.appendChild(n),this.writePoint(n,t,r)},t.prototype.writeLineStringOrCurveMember=function(e,t,r){var n=this.GEOMETRY_NODE_FACTORY_(t,r);n&&(e.appendChild(n),this.writeCurveOrLineString(n,t,r))},t.prototype.writeSurfacePatches_=function(e,t,r){var n=vl(e.namespaceURI,"PolygonPatch");e.appendChild(n),this.writeSurfaceOrPolygon(n,t,r)},t.prototype.writeCurveSegments_=function(e,t,r){var n=vl(e.namespaceURI,"LineStringSegment");e.appendChild(n),this.writeCurveOrLineString(n,t,r)},t.prototype.writeGeometryElement=function(e,t,r){var n,i=r[r.length-1],o=nt({},i);o.node=e,n=Array.isArray(t)?yl(t,i):gl(t,!0,i),kl(o,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[n],r,void 0,this)},t.prototype.writeFeatureElement=function(e,t,r){var n=t.getId();n&&e.setAttribute("fid",n);var i=r[r.length-1],o=i.featureNS,a=t.getGeometryName();i.serializers||(i.serializers={},i.serializers[o]={});var s=[],l=[];if(t.hasProperties()){var c=t.getProperties();for(var u in c){var p=c[u];null!==p&&(s.push(u),l.push(p),u==a||"function"==typeof p.getSimplifiedGeometry?u in i.serializers[o]||(i.serializers[o][u]=xl(this.writeGeometryElement,this)):u in i.serializers[o]||(i.serializers[o][u]=xl(uc)))}}var h=nt({},i);h.node=e,kl(h,i.serializers,Ol(void 0,o),l,r,s)},t.prototype.writeFeatureMembers_=function(e,t,r){var n=r[r.length-1],i=n.featureType,o=n.featureNS,a={};a[o]={},a[o][i]=xl(this.writeFeatureElement,this);var s=nt({},n);s.node=e,kl(s,a,Ol(i,o),t,r)},t.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_=function(e,t,r){var n=t[t.length-1].node;return vl(this.namespace,yc[n.nodeName])},t.prototype.GEOMETRY_NODE_FACTORY_=function(e,t,r){var n,i=t[t.length-1],o=i.multiSurface,a=i.surface,s=i.curve,l=i.multiCurve;return Array.isArray(e)?n="Envelope":"MultiPolygon"===(n=e.getType())&&!0===o?n="MultiSurface":"Polygon"===n&&!0===a?n="Surface":"LineString"===n&&!0===s?n="Curve":"MultiLineString"===n&&!0===l&&(n="MultiCurve"),vl(this.namespace,n)},t.prototype.writeGeometryNode=function(e,t){t=this.adaptOptions(t);var r=vl(this.namespace,"geom"),n={node:r,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return t&&nt(n,t),this.writeGeometryElement(r,e,[n]),r},t.prototype.writeFeaturesNode=function(e,t){t=this.adaptOptions(t);var r=vl(this.namespace,"featureMembers");r.setAttributeNS(ml,"xsi:schemaLocation",this.schemaLocation);var n={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return t&&nt(n,t),this.writeFeatureMembers_(r,e,[n]),r},t}(zl);mc.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:Ll(mc.prototype.readFlatPos),posList:Ll(mc.prototype.readFlatPosList),coordinates:Ll(fc.prototype.readFlatCoordinates)}},mc.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:mc.prototype.interiorParser,exterior:mc.prototype.exteriorParser}},mc.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:Ll(zl.prototype.readPoint),MultiPoint:Ll(zl.prototype.readMultiPoint),LineString:Ll(zl.prototype.readLineString),MultiLineString:Ll(zl.prototype.readMultiLineString),LinearRing:Ll(zl.prototype.readLinearRing),Polygon:Ll(zl.prototype.readPolygon),MultiPolygon:Ll(zl.prototype.readMultiPolygon),Surface:Ll(mc.prototype.readSurface),MultiSurface:Ll(mc.prototype.readMultiSurface),Curve:Ll(mc.prototype.readCurve),MultiCurve:Ll(mc.prototype.readMultiCurve),Envelope:Ll(mc.prototype.readEnvelope)}},mc.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:Cl(mc.prototype.curveMemberParser),curveMembers:Cl(mc.prototype.curveMemberParser)}},mc.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:Cl(mc.prototype.surfaceMemberParser),surfaceMembers:Cl(mc.prototype.surfaceMemberParser)}},mc.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:Cl(zl.prototype.readLineString),Curve:Cl(mc.prototype.readCurve)}},mc.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:Cl(zl.prototype.readPolygon),Surface:Cl(mc.prototype.readSurface)}},mc.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:Ll(mc.prototype.readPatch)}},mc.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:Ll(mc.prototype.readSegment)}},mc.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:Cl(mc.prototype.readFlatPosList),upperCorner:Cl(mc.prototype.readFlatPosList)}},mc.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:Ll(mc.prototype.readPolygonPatch)}},mc.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:bl(mc.prototype.readLineStringSegment)}},zl.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:Ll(zl.prototype.readFlatLinearRing),Ring:Ll(mc.prototype.readFlatCurveRing)}},mc.prototype.writeFeatures,mc.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:xl(mc.prototype.writeRing),interior:xl(mc.prototype.writeRing)}},mc.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:xl(uc),upperCorner:xl(uc)}},mc.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:xl(mc.prototype.writeSurfaceOrPolygonMember),polygonMember:xl(mc.prototype.writeSurfaceOrPolygonMember)}},mc.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:xl(mc.prototype.writePointMember)}},mc.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:xl(mc.prototype.writeLineStringOrCurveMember),curveMember:xl(mc.prototype.writeLineStringOrCurveMember)}},mc.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:xl(mc.prototype.writeCurveOrLineString),MultiCurve:xl(mc.prototype.writeMultiCurveOrLineString),Point:xl(mc.prototype.writePoint),MultiPoint:xl(mc.prototype.writeMultiPoint),LineString:xl(mc.prototype.writeCurveOrLineString),MultiLineString:xl(mc.prototype.writeMultiCurveOrLineString),LinearRing:xl(mc.prototype.writeLinearRing),Polygon:xl(mc.prototype.writeSurfaceOrPolygon),MultiPolygon:xl(mc.prototype.writeMultiSurfaceOrPolygon),Surface:xl(mc.prototype.writeSurfaceOrPolygon),MultiSurface:xl(mc.prototype.writeMultiSurfaceOrPolygon),Envelope:xl(mc.prototype.writeEnvelope)}};const vc=mc;var _c=vc;_c.prototype.writeFeatures,_c.prototype.writeFeaturesNode;const wc=_c;var Sc=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ec=function(e){function t(t){var r=this,n=t||{};return(r=e.call(this,n)||this).schemaLocation=n.schemaLocation?n.schemaLocation:r.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd",r}return Sc(t,e),t}(vc);Ec.prototype.namespace="http://www.opengis.net/gml/3.2",Ec.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:Ll(vc.prototype.readFlatPos),posList:Ll(vc.prototype.readFlatPosList),coordinates:Ll(fc.prototype.readFlatCoordinates)}},Ec.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:vc.prototype.interiorParser,exterior:vc.prototype.exteriorParser}},Ec.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:Ll(zl.prototype.readPoint),MultiPoint:Ll(zl.prototype.readMultiPoint),LineString:Ll(zl.prototype.readLineString),MultiLineString:Ll(zl.prototype.readMultiLineString),LinearRing:Ll(zl.prototype.readLinearRing),Polygon:Ll(zl.prototype.readPolygon),MultiPolygon:Ll(zl.prototype.readMultiPolygon),Surface:Ll(Ec.prototype.readSurface),MultiSurface:Ll(vc.prototype.readMultiSurface),Curve:Ll(Ec.prototype.readCurve),MultiCurve:Ll(vc.prototype.readMultiCurve),Envelope:Ll(Ec.prototype.readEnvelope)}},Ec.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:Cl(vc.prototype.curveMemberParser),curveMembers:Cl(vc.prototype.curveMemberParser)}},Ec.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:Cl(vc.prototype.surfaceMemberParser),surfaceMembers:Cl(vc.prototype.surfaceMemberParser)}},Ec.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:Cl(zl.prototype.readLineString),Curve:Cl(vc.prototype.readCurve)}},Ec.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:Cl(zl.prototype.readPolygon),Surface:Cl(vc.prototype.readSurface)}},Ec.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:Ll(vc.prototype.readPatch)}},Ec.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:Ll(vc.prototype.readSegment)}},Ec.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:Cl(vc.prototype.readFlatPosList),upperCorner:Cl(vc.prototype.readFlatPosList)}},Ec.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:Ll(vc.prototype.readPolygonPatch)}},Ec.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:bl(vc.prototype.readLineStringSegment)}},Ec.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:Cl(zl.prototype.pointMemberParser),pointMembers:Cl(zl.prototype.pointMemberParser)}},Ec.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:Cl(zl.prototype.lineStringMemberParser),lineStringMembers:Cl(zl.prototype.lineStringMemberParser)}},Ec.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:Cl(zl.prototype.polygonMemberParser),polygonMembers:Cl(zl.prototype.polygonMemberParser)}},Ec.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:Cl(zl.prototype.readFlatCoordinatesFromNode)}},Ec.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:Cl(zl.prototype.readLineString)}},Ec.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:Cl(zl.prototype.readPolygon)}},Ec.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:Ll(zl.prototype.readFlatLinearRing),Ring:Ll(Ec.prototype.readFlatCurveRing)}},Ec.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:xl(vc.prototype.writeRing),interior:xl(vc.prototype.writeRing)}},Ec.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:xl(uc),upperCorner:xl(uc)}},Ec.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:xl(vc.prototype.writeSurfaceOrPolygonMember),polygonMember:xl(vc.prototype.writeSurfaceOrPolygonMember)}},Ec.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:xl(vc.prototype.writePointMember)}},Ec.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:xl(vc.prototype.writeLineStringOrCurveMember),curveMember:xl(vc.prototype.writeLineStringOrCurveMember)}},Ec.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:xl(vc.prototype.writeCurveOrLineString),MultiCurve:xl(vc.prototype.writeMultiCurveOrLineString),Point:xl(Ec.prototype.writePoint),MultiPoint:xl(vc.prototype.writeMultiPoint),LineString:xl(vc.prototype.writeCurveOrLineString),MultiLineString:xl(vc.prototype.writeMultiCurveOrLineString),LinearRing:xl(vc.prototype.writeLinearRing),Polygon:xl(vc.prototype.writeSurfaceOrPolygon),MultiPolygon:xl(vc.prototype.writeMultiSurfaceOrPolygon),Surface:xl(vc.prototype.writeSurfaceOrPolygon),MultiSurface:xl(vc.prototype.writeMultiSurfaceOrPolygon),Envelope:xl(vc.prototype.writeEnvelope)}};const bc=Ec;const Cc=function(){function e(e){this.tagName_=e}return e.prototype.getTagName=function(){return this.tagName_},e}();var Lc=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const Tc=function(e){function t(t,r){var n=e.call(this,t)||this;return n.conditions=r,I(n.conditions.length>=2,57),n}return Lc(t,e),t}(Cc);var Ac=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const xc=function(e){function t(t){return e.call(this,"And",Array.prototype.slice.call(arguments))||this}return Ac(t,e),t}(Tc);var Pc=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const Oc=function(e){function t(t,r,n){var i=e.call(this,"BBOX")||this;if(i.geometryName=t,i.extent=r,4!==r.length)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");return i.srsName=n,i}return Pc(t,e),t}(Cc);var Ic=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Rc={"http://www.opengis.net/gml":{boundedBy:Al(zl.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:Cl(zl.prototype.readFeaturesInternal)}},Mc={"http://www.opengis.net/wfs":{totalInserted:Al(nc),totalUpdated:Al(nc),totalDeleted:Al(nc)},"http://www.opengis.net/wfs/2.0":{totalInserted:Al(nc),totalUpdated:Al(nc),totalDeleted:Al(nc)}},Dc={"http://www.opengis.net/wfs":{TransactionSummary:Al(Vc,"transactionSummary"),InsertResults:Al(Xc,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:Al(Vc,"transactionSummary"),InsertResults:Al(Xc,"insertIds")}},Nc={"http://www.opengis.net/wfs":{PropertyName:xl(uc)},"http://www.opengis.net/wfs/2.0":{PropertyName:xl(uc)}},Zc={"http://www.opengis.net/wfs":{Insert:xl($c),Update:xl(tu),Delete:xl(eu),Property:xl(ru),Native:xl(nu)},"http://www.opengis.net/wfs/2.0":{Insert:xl($c),Update:xl(tu),Delete:xl(eu),Property:xl(ru),Native:xl(nu)}},kc="feature",Fc="http://www.w3.org/2000/xmlns/",Uc={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},Bc={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},Gc={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},jc={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},Wc={"2.0.0":bc,"1.1.0":vc,"1.0.0":fc},Hc=function(e){function t(t){var r=e.call(this)||this,n=t||{};return r.version_=n.version?n.version:"1.1.0",r.featureType_=n.featureType,r.featureNS_=n.featureNS,r.gmlFormat_=n.gmlFormat?n.gmlFormat:new Wc[r.version_],r.schemaLocation_=n.schemaLocation?n.schemaLocation:jc[r.version_],r}return Ic(t,e),t.prototype.getFeatureType=function(){return this.featureType_},t.prototype.setFeatureType=function(e){this.featureType_=e},t.prototype.readFeaturesFromNode=function(e,t){var r={node:e};nt(r,{featureType:this.featureType_,featureNS:this.featureNS_}),nt(r,this.getReadOptions(e,t||{}));var n=[r],i=Nl([],"2.0.0"===this.version_?Rc:this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,n,this.gmlFormat_);return i||(i=[]),i},t.prototype.readTransactionResponse=function(e){if(e){if("string"==typeof e){var t=El(e);return this.readTransactionResponseFromDocument(t)}return Sl(e)?this.readTransactionResponseFromDocument(e):this.readTransactionResponseFromNode(e)}},t.prototype.readFeatureCollectionMetadata=function(e){if(e){if("string"==typeof e){var t=El(e);return this.readFeatureCollectionMetadataFromDocument(t)}return Sl(e)?this.readFeatureCollectionMetadataFromDocument(e):this.readFeatureCollectionMetadataFromNode(e)}},t.prototype.readFeatureCollectionMetadataFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(t)},t.prototype.readFeatureCollectionMetadataFromNode=function(e){var t={},r=ic(e.getAttribute("numberOfFeatures"));return t.numberOfFeatures=r,Nl(t,Rc,e,[],this.gmlFormat_)},t.prototype.readTransactionResponseFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(t)},t.prototype.readTransactionResponseFromNode=function(e){return Nl({},Dc,e,[])},t.prototype.writeGetFeature=function(e){var t=this,r=vl(Bc[this.version_],"GetFeature");r.setAttribute("service","WFS"),r.setAttribute("version",this.version_),e.handle&&r.setAttribute("handle",e.handle),e.outputFormat&&r.setAttribute("outputFormat",e.outputFormat),void 0!==e.maxFeatures&&r.setAttribute("maxFeatures",String(e.maxFeatures)),e.resultType&&r.setAttribute("resultType",e.resultType),void 0!==e.startIndex&&r.setAttribute("startIndex",String(e.startIndex)),void 0!==e.count&&r.setAttribute("count",String(e.count)),void 0!==e.viewParams&&r.setAttribute("viewParams",e.viewParams),r.setAttributeNS(ml,"xsi:schemaLocation",this.schemaLocation_);var n={node:r};if(nt(n,{version:this.version_,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,propertyNames:e.propertyNames?e.propertyNames:[]}),I(Array.isArray(e.featureTypes),11),"string"==typeof e.featureTypes[0]){var i=e.filter;e.bbox&&(I(e.geometryName,12),i=this.combineBboxAndFilter(e.geometryName,e.bbox,e.srsName,i)),nt(n,{geometryName:e.geometryName,filter:i}),Su(r,e.featureTypes,[n])}else e.featureTypes.forEach((function(i){var o=t.combineBboxAndFilter(i.geometryName,i.bbox,e.srsName,e.filter);nt(n,{geometryName:i.geometryName,filter:o}),Su(r,[i.name],[n])}));return r},t.prototype.combineBboxAndFilter=function(e,t,r,n){var i=function(e,t,r){return new Oc(e,t,r)}(e,t,r);return n?function(e){var t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(xc,t))}(n,i):i},t.prototype.writeTransaction=function(e,t,r,n){var i,o=[],a=n.version?n.version:this.version_,s=vl(Bc[a],"Transaction");s.setAttribute("service","WFS"),s.setAttribute("version",a),n&&(i=n.gmlOptions?n.gmlOptions:{},n.handle&&s.setAttribute("handle",n.handle)),s.setAttributeNS(ml,"xsi:schemaLocation",jc[a]);var l=function(e,t,r,n){var i,o=n.featurePrefix?n.featurePrefix:kc;"1.0.0"===r?i=2:"1.1.0"===r?i=3:"2.0.0"===r&&(i=3.2);return nt({node:e},{version:r,featureNS:n.featureNS,featureType:n.featureType,featurePrefix:o,gmlVersion:i,hasZ:n.hasZ,srsName:n.srsName},t)}(s,i,a,n);return e&&qc("Insert",e,o,l),t&&qc("Update",t,o,l),r&&qc("Delete",r,o,l),n.nativeElements&&qc("Native",n.nativeElements,o,l),s},t.prototype.readProjectionFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(t);return null},t.prototype.readProjectionFromNode=function(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild)for(var t=(e=e.firstElementChild.firstElementChild).firstElementChild;t;t=t.nextElementSibling)if(0!==t.childNodes.length&&(1!==t.childNodes.length||3!==t.firstChild.nodeType)){var r=[{}];return this.gmlFormat_.readGeometryElement(t,r),$n(r.pop().srsName)}return null},t}(jl);function qc(e,t,r,n){kl(n,Zc,Ol(e),t,r)}function Vc(e,t){return Nl({},Mc,e,t)}var zc={"http://www.opengis.net/ogc":{FeatureId:Cl((function(e,t){return e.getAttribute("fid")}))},"http://www.opengis.net/ogc/1.1":{FeatureId:Cl((function(e,t){return e.getAttribute("fid")}))}};function Yc(e,t){Dl(zc,e,t)}var Kc={"http://www.opengis.net/wfs":{Feature:Yc},"http://www.opengis.net/wfs/2.0":{Feature:Yc}};function Xc(e,t){return Nl([],Kc,e,t)}function $c(e,t,r){var n=r[r.length-1],i=n.featureType,o=n.featureNS,a=n.gmlVersion,s=vl(o,i);e.appendChild(s),2===a?fc.prototype.writeFeatureElement(s,t,r):3===a?vc.prototype.writeFeatureElement(s,t,r):bc.prototype.writeFeatureElement(s,t,r)}function Jc(e,t,r){var n=r[r.length-1].version,i=Uc[n],o=vl(i,"Filter"),a=vl(i,"FeatureId");o.appendChild(a),a.setAttribute("fid",t),e.appendChild(o)}function Qc(e,t){var r=(e=e||kc)+":";return 0===t.indexOf(r)?t:r+t}function eu(e,t,r){var n=r[r.length-1];I(void 0!==t.getId(),26);var i=n.featureType,o=n.featurePrefix,a=n.featureNS,s=Qc(o,i);e.setAttribute("typeName",s),e.setAttributeNS(Fc,"xmlns:"+o,a);var l=t.getId();void 0!==l&&Jc(e,l,r)}function tu(e,t,r){var n=r[r.length-1];I(void 0!==t.getId(),27);var i=n.version,o=n.featureType,a=n.featurePrefix,s=n.featureNS,l=Qc(a,o),c=t.getGeometryName();e.setAttribute("typeName",l),e.setAttributeNS(Fc,"xmlns:"+a,s);var u=t.getId();if(void 0!==u){for(var p=t.getKeys(),h=[],d=0,f=p.length;d<f;d++){var g=t.get(p[d]);if(void 0!==g){var y=p[d];g&&"function"==typeof g.getSimplifiedGeometry&&(y=c),h.push({name:y,value:g})}}kl({version:i,gmlVersion:n.gmlVersion,node:e,hasZ:n.hasZ,srsName:n.srsName},Zc,Ol("Property"),h,r),Jc(e,u,r)}}function ru(e,t,r){var n=r[r.length-1],i=n.version,o=Bc[i],a=vl(o,"Name"),s=n.gmlVersion;if(e.appendChild(a),uc(a,t.name),void 0!==t.value&&null!==t.value){var l=vl(o,"Value");e.appendChild(l),t.value&&"function"==typeof t.value.getSimplifiedGeometry?2===s?fc.prototype.writeGeometryElement(l,t.value,r):3===s?vc.prototype.writeGeometryElement(l,t.value,r):bc.prototype.writeGeometryElement(l,t.value,r):uc(l,t.value)}}function nu(e,t,r){t.vendorId&&e.setAttribute("vendorId",t.vendorId),void 0!==t.safeToIgnore&&e.setAttribute("safeToIgnore",String(t.safeToIgnore)),void 0!==t.value&&uc(e,t.value)}var iu={"http://www.opengis.net/wfs":{Query:xl(ou)},"http://www.opengis.net/wfs/2.0":{Query:xl(ou)},"http://www.opengis.net/ogc":{During:xl(uu),And:xl(pu),Or:xl(pu),Not:xl(hu),BBOX:xl(su),Contains:xl(lu),Intersects:xl(lu),Within:xl(lu),DWithin:xl(cu),PropertyIsEqualTo:xl(du),PropertyIsNotEqualTo:xl(du),PropertyIsLessThan:xl(du),PropertyIsLessThanOrEqualTo:xl(du),PropertyIsGreaterThan:xl(du),PropertyIsGreaterThanOrEqualTo:xl(du),PropertyIsNull:xl(fu),PropertyIsBetween:xl(gu),PropertyIsLike:xl(yu)},"http://www.opengis.net/fes/2.0":{During:xl(uu),And:xl(pu),Or:xl(pu),Not:xl(hu),BBOX:xl(su),Contains:xl(lu),Disjoint:xl(lu),Intersects:xl(lu),ResourceId:xl((function(e,t,r){e.setAttribute("rid",t.rid)})),Within:xl(lu),DWithin:xl(cu),PropertyIsEqualTo:xl(du),PropertyIsNotEqualTo:xl(du),PropertyIsLessThan:xl(du),PropertyIsLessThanOrEqualTo:xl(du),PropertyIsGreaterThan:xl(du),PropertyIsGreaterThanOrEqualTo:xl(du),PropertyIsNull:xl(fu),PropertyIsBetween:xl(gu),PropertyIsLike:xl(yu)}};function ou(e,t,r){var n,i,o=r[r.length-1],a=o.version,s=o.featurePrefix,l=o.featureNS,c=o.propertyNames,u=o.srsName;n=s?Qc(s,t):t,i="2.0.0"===a?"typeNames":"typeName",e.setAttribute(i,n),u&&e.setAttribute("srsName",u),l&&e.setAttributeNS(Fc,"xmlns:"+s,l);var p=nt({},o);p.node=e,kl(p,Nc,Ol("PropertyName"),c,r);var h=o.filter;if(h){var d=vl(Eu(a),"Filter");e.appendChild(d),au(d,h,r)}}function au(e,t,r){var n=r[r.length-1],i={node:e};nt(i,{context:n}),kl(i,iu,Ol(t.getTagName()),[t],r)}function su(e,t,r){var n=r[r.length-1],i=n.context.version;n.srsName=t.srsName;var o=Wc[i];_u(i,e,t.geometryName),o.prototype.writeGeometryElement(e,t.extent,r)}function lu(e,t,r){var n=r[r.length-1],i=n.context.version;n.srsName=t.srsName;var o=Wc[i];_u(i,e,t.geometryName),o.prototype.writeGeometryElement(e,t.geometry,r)}function cu(e,t,r){var n=r[r.length-1].context.version;lu(e,t,r);var i=vl(Eu(n),"Distance");uc(i,t.distance.toString()),"2.0.0"===n?i.setAttribute("uom",t.unit):i.setAttribute("units",t.unit),e.appendChild(i)}function uu(e,t,r){var n=r[r.length-1].context.version;mu(Gc[n],"ValueReference",e,t.propertyName);var i=vl(Hl,"TimePeriod");e.appendChild(i);var o=vl(Hl,"begin");i.appendChild(o),wu(o,t.begin);var a=vl(Hl,"end");i.appendChild(a),wu(a,t.end)}function pu(e,t,r){var n=r[r.length-1].context,i={node:e};nt(i,{context:n});for(var o=t.conditions,a=0,s=o.length;a<s;++a){var l=o[a];kl(i,iu,Ol(l.getTagName()),[l],r)}}function hu(e,t,r){var n=r[r.length-1].context,i={node:e};nt(i,{context:n});var o=t.condition;kl(i,iu,Ol(o.getTagName()),[o],r)}function du(e,t,r){var n=r[r.length-1].context.version;void 0!==t.matchCase&&e.setAttribute("matchCase",t.matchCase.toString()),_u(n,e,t.propertyName),vu(n,e,""+t.expression)}function fu(e,t,r){_u(r[r.length-1].context.version,e,t.propertyName)}function gu(e,t,r){var n=r[r.length-1].context.version,i=Eu(n);_u(n,e,t.propertyName);var o=vl(i,"LowerBoundary");e.appendChild(o),vu(n,o,""+t.lowerBoundary);var a=vl(i,"UpperBoundary");e.appendChild(a),vu(n,a,""+t.upperBoundary)}function yu(e,t,r){var n=r[r.length-1].context.version;e.setAttribute("wildCard",t.wildCard),e.setAttribute("singleChar",t.singleChar),e.setAttribute("escapeChar",t.escapeChar),void 0!==t.matchCase&&e.setAttribute("matchCase",t.matchCase.toString()),_u(n,e,t.propertyName),vu(n,e,""+t.pattern)}function mu(e,t,r,n){var i=vl(e,t);uc(i,n),r.appendChild(i)}function vu(e,t,r){mu(Eu(e),"Literal",t,r)}function _u(e,t,r){"2.0.0"===e?mu(Gc[e],"ValueReference",t,r):mu(Uc[e],"PropertyName",t,r)}function wu(e,t){var r=vl(Hl,"TimeInstant");e.appendChild(r);var n=vl(Hl,"timePosition");r.appendChild(n),uc(n,t)}function Su(e,t,r){var n=r[r.length-1],i=nt({},n);i.node=e,kl(i,iu,Ol("Query"),t,r)}function Eu(e){return"2.0.0"===e?Gc[e]:Uc[e]}const bu=Hc;var Cu=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function Lu(e){return"string"==typeof e?e:""}const Tu=function(e){function t(){return e.call(this)||this}return Cu(t,e),t.prototype.getType=function(){return"text"},t.prototype.readFeature=function(e,t){return this.readFeatureFromText(Lu(e),this.adaptOptions(t))},t.prototype.readFeatureFromText=function(e,t){return n()},t.prototype.readFeatures=function(e,t){return this.readFeaturesFromText(Lu(e),this.adaptOptions(t))},t.prototype.readFeaturesFromText=function(e,t){return n()},t.prototype.readGeometry=function(e,t){return this.readGeometryFromText(Lu(e),this.adaptOptions(t))},t.prototype.readGeometryFromText=function(e,t){return n()},t.prototype.readProjection=function(e){return this.readProjectionFromText(Lu(e))},t.prototype.readProjectionFromText=function(e){return this.dataProjection},t.prototype.writeFeature=function(e,t){return this.writeFeatureText(e,this.adaptOptions(t))},t.prototype.writeFeatureText=function(e,t){return n()},t.prototype.writeFeatures=function(e,t){return this.writeFeaturesText(e,this.adaptOptions(t))},t.prototype.writeFeaturesText=function(e,t){return n()},t.prototype.writeGeometry=function(e,t){return this.writeGeometryText(e,this.adaptOptions(t))},t.prototype.writeGeometryText=function(e,t){return n()},t}(fl);var Au=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),xu={POINT:uo,LINESTRING:$s,POLYGON:Ao,MULTIPOINT:qs,MULTILINESTRING:el,MULTIPOLYGON:nl},Pu="EMPTY",Ou=0,Iu=1,Ru=2,Mu=3,Du=4,Nu=5,Zu=6,ku={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"},Fu=function(){function e(e){this.wkt=e,this.index_=-1}return e.prototype.isAlpha_=function(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"},e.prototype.isNumeric_=function(e,t){return e>="0"&&e<="9"||"."==e&&!(void 0!==t&&t)},e.prototype.isWhiteSpace_=function(e){return" "==e||"\t"==e||"\r"==e||"\n"==e},e.prototype.nextChar_=function(){return this.wkt.charAt(++this.index_)},e.prototype.nextToken=function(){var e,t=this.nextChar_(),r=this.index_,n=t;if("("==t)e=Ru;else if(","==t)e=Nu;else if(")"==t)e=Mu;else if(this.isNumeric_(t)||"-"==t)e=Du,n=this.readNumber_();else if(this.isAlpha_(t))e=Iu,n=this.readText_();else{if(this.isWhiteSpace_(t))return this.nextToken();if(""!==t)throw new Error("Unexpected character: "+t);e=Zu}return{position:r,value:n,type:e}},e.prototype.readNumber_=function(){var e,t=this.index_,r=!1,n=!1;do{"."==e?r=!0:"e"!=e&&"E"!=e||(n=!0),e=this.nextChar_()}while(this.isNumeric_(e,r)||!n&&("e"==e||"E"==e)||n&&("-"==e||"+"==e));return parseFloat(this.wkt.substring(t,this.index_--))},e.prototype.readText_=function(){var e,t=this.index_;do{e=this.nextChar_()}while(this.isAlpha_(e));return this.wkt.substring(t,this.index_--).toUpperCase()},e}(),Uu=function(){function e(e){this.lexer_=e,this.token_={position:0,type:Ou},this.layout_=Pi.XY}return e.prototype.consume_=function(){this.token_=this.lexer_.nextToken()},e.prototype.isTokenType=function(e){return this.token_.type==e},e.prototype.match=function(e){var t=this.isTokenType(e);return t&&this.consume_(),t},e.prototype.parse=function(){return this.consume_(),this.parseGeometry_()},e.prototype.parseGeometryLayout_=function(){var e=Pi.XY,t=this.token_;if(this.isTokenType(Iu)){var r=t.value;"Z"===r?e=Pi.XYZ:"M"===r?e=Pi.XYM:"ZM"===r&&(e=Pi.XYZM),e!==Pi.XY&&this.consume_()}return e},e.prototype.parseGeometryCollectionText_=function(){if(this.match(Ru)){var e=[];do{e.push(this.parseGeometry_())}while(this.match(Nu));if(this.match(Mu))return e}throw new Error(this.formatErrorMessage_())},e.prototype.parsePointText_=function(){if(this.match(Ru)){var e=this.parsePoint_();if(this.match(Mu))return e}throw new Error(this.formatErrorMessage_())},e.prototype.parseLineStringText_=function(){if(this.match(Ru)){var e=this.parsePointList_();if(this.match(Mu))return e}throw new Error(this.formatErrorMessage_())},e.prototype.parsePolygonText_=function(){if(this.match(Ru)){var e=this.parseLineStringTextList_();if(this.match(Mu))return e}throw new Error(this.formatErrorMessage_())},e.prototype.parseMultiPointText_=function(){if(this.match(Ru)){var e=void 0;if(e=this.token_.type==Ru?this.parsePointTextList_():this.parsePointList_(),this.match(Mu))return e}throw new Error(this.formatErrorMessage_())},e.prototype.parseMultiLineStringText_=function(){if(this.match(Ru)){var e=this.parseLineStringTextList_();if(this.match(Mu))return e}throw new Error(this.formatErrorMessage_())},e.prototype.parseMultiPolygonText_=function(){if(this.match(Ru)){var e=this.parsePolygonTextList_();if(this.match(Mu))return e}throw new Error(this.formatErrorMessage_())},e.prototype.parsePoint_=function(){for(var e=[],t=this.layout_.length,r=0;r<t;++r){var n=this.token_;if(!this.match(Du))break;e.push(n.value)}if(e.length==t)return e;throw new Error(this.formatErrorMessage_())},e.prototype.parsePointList_=function(){for(var e=[this.parsePoint_()];this.match(Nu);)e.push(this.parsePoint_());return e},e.prototype.parsePointTextList_=function(){for(var e=[this.parsePointText_()];this.match(Nu);)e.push(this.parsePointText_());return e},e.prototype.parseLineStringTextList_=function(){for(var e=[this.parseLineStringText_()];this.match(Nu);)e.push(this.parseLineStringText_());return e},e.prototype.parsePolygonTextList_=function(){for(var e=[this.parsePolygonText_()];this.match(Nu);)e.push(this.parsePolygonText_());return e},e.prototype.isEmptyGeometry_=function(){var e=this.isTokenType(Iu)&&this.token_.value==Pu;return e&&this.consume_(),e},e.prototype.formatErrorMessage_=function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"},e.prototype.parseGeometry_=function(){var e=this.token_;if(this.match(Iu)){var t=e.value;this.layout_=this.parseGeometryLayout_();var r=this.isEmptyGeometry_();if("GEOMETRYCOLLECTION"==t){if(r)return new pl([]);var n=this.parseGeometryCollectionText_();return new pl(n)}var i=xu[t];if(!i)throw new Error("Invalid geometry type: "+t);var o=void 0;if(r)o="POINT"==t?[NaN,NaN]:[];else switch(t){case"POINT":o=this.parsePointText_();break;case"LINESTRING":o=this.parseLineStringText_();break;case"POLYGON":o=this.parsePolygonText_();break;case"MULTIPOINT":o=this.parseMultiPointText_();break;case"MULTILINESTRING":o=this.parseMultiLineStringText_();break;case"MULTIPOLYGON":o=this.parseMultiPolygonText_()}return new i(o,this.layout_)}throw new Error(this.formatErrorMessage_())},e}(),Bu=function(e){function t(t){var r=e.call(this)||this,n=t||{};return r.splitCollection_=void 0!==n.splitCollection&&n.splitCollection,r}return Au(t,e),t.prototype.parse_=function(e){var t=new Fu(e);return new Uu(t).parse()},t.prototype.readFeatureFromText=function(e,t){var r=this.readGeometryFromText(e,t),n=new js;return n.setGeometry(r),n},t.prototype.readFeaturesFromText=function(e,t){for(var r=[],n=this.readGeometryFromText(e,t),i=[],o=0,a=(r=this.splitCollection_&&"GeometryCollection"==n.getType()?n.getGeometriesArray():[n]).length;o<a;++o){var s=new js;s.setGeometry(r[o]),i.push(s)}return i},t.prototype.readGeometryFromText=function(e,t){return gl(this.parse_(e),!1,t)},t.prototype.writeFeatureText=function(e,t){var r=e.getGeometry();return r?this.writeGeometryText(r,t):""},t.prototype.writeFeaturesText=function(e,t){if(1==e.length)return this.writeFeatureText(e[0],t);for(var r=[],n=0,i=e.length;n<i;++n)r.push(e[n].getGeometry());var o=new pl(r);return this.writeGeometryText(o,t)},t.prototype.writeGeometryText=function(e,t){return qu(gl(e,!0,t))},t}(Tu);function Gu(e){var t=e.getCoordinates();return 0===t.length?"":t.join(" ")}function ju(e){for(var t=e.getCoordinates(),r=[],n=0,i=t.length;n<i;++n)r.push(t[n].join(" "));return r.join(",")}function Wu(e){for(var t=[],r=e.getLinearRings(),n=0,i=r.length;n<i;++n)t.push("("+ju(r[n])+")");return t.join(",")}var Hu={Point:Gu,LineString:ju,Polygon:Wu,MultiPoint:function(e){for(var t=[],r=e.getPoints(),n=0,i=r.length;n<i;++n)t.push("("+Gu(r[n])+")");return t.join(",")},MultiLineString:function(e){for(var t=[],r=e.getLineStrings(),n=0,i=r.length;n<i;++n)t.push("("+ju(r[n])+")");return t.join(",")},MultiPolygon:function(e){for(var t=[],r=e.getPolygons(),n=0,i=r.length;n<i;++n)t.push("("+Wu(r[n])+")");return t.join(",")},GeometryCollection:function(e){for(var t=[],r=e.getGeometries(),n=0,i=r.length;n<i;++n)t.push(qu(r[n]));return t.join(",")}};function qu(e){var t=e.getType(),r=(0,Hu[t])(e),n=ku[t];if("function"==typeof e.getFlatCoordinates){var i=function(e){var t=e.getLayout(),r="";return t!==Pi.XYZ&&t!==Pi.XYZM||(r+="Z"),t!==Pi.XYM&&t!==Pi.XYZM||(r+="M"),r}(e);i.length>0&&(n+=" "+i)}return 0===r.length?n+" "+Pu:n+"("+r+")"}const Vu=Bu;var zu=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Yu=1,Ku=2,Xu=3,$u=4,Ju=5,Qu=6,ep=7,tp=15,rp=16,np=17,ip=function(){function e(e){this.view_=e,this.pos_=0,this.initialized_=!1,this.isLittleEndian_=!1,this.hasZ_=!1,this.hasM_=!1,this.srid_=null,this.layout_=Pi.XY}return e.prototype.readUint8=function(){return this.view_.getUint8(this.pos_++)},e.prototype.readUint32=function(e){return this.view_.getUint32((this.pos_+=4)-4,void 0!==e?e:this.isLittleEndian_)},e.prototype.readDouble=function(e){return this.view_.getFloat64((this.pos_+=8)-8,void 0!==e?e:this.isLittleEndian_)},e.prototype.readPoint=function(){var e=[];return e.push(this.readDouble()),e.push(this.readDouble()),this.hasZ_&&e.push(this.readDouble()),this.hasM_&&e.push(this.readDouble()),e},e.prototype.readLineString=function(){for(var e=this.readUint32(),t=[],r=0;r<e;r++)t.push(this.readPoint());return t},e.prototype.readPolygon=function(){for(var e=this.readUint32(),t=[],r=0;r<e;r++)t.push(this.readLineString());return t},e.prototype.readWkbHeader=function(e){var t=this.readUint8()>0,r=this.readUint32(t),n=Math.floor((268435455&r)/1e3),i=Boolean(2147483648&r)||1===n||3===n,o=Boolean(1073741824&r)||2===n||3===n,a=Boolean(536870912&r),s=(268435455&r)%1e3,l=["XY",i?"Z":"",o?"M":""].join(""),c=a?this.readUint32(t):null;if(void 0!==e&&e!==s)throw new Error("Unexpected WKB geometry type "+s);if(this.initialized_){if(this.isLittleEndian_!==t)throw new Error("Inconsistent endian");if(this.layout_!==l)throw new Error("Inconsistent geometry layout");if(c&&this.srid_!==c)throw new Error("Inconsistent coordinate system (SRID)")}else this.isLittleEndian_=t,this.hasZ_=i,this.hasM_=o,this.layout_=l,this.srid_=c,this.initialized_=!0;return s},e.prototype.readWkbPayload=function(e){switch(e){case Yu:return this.readPoint();case Ku:return this.readLineString();case Xu:case np:return this.readPolygon();case $u:return this.readMultiPoint();case Ju:return this.readMultiLineString();case Qu:case tp:case rp:return this.readMultiPolygon();case ep:return this.readGeometryCollection();default:throw new Error("Unsupported WKB geometry type "+e+" is found")}},e.prototype.readWkbBlock=function(e){return this.readWkbPayload(this.readWkbHeader(e))},e.prototype.readWkbCollection=function(e,t){for(var r=this.readUint32(),n=[],i=0;i<r;i++){var o=e.call(this,t);o&&n.push(o)}return n},e.prototype.readMultiPoint=function(){return this.readWkbCollection(this.readWkbBlock,Yu)},e.prototype.readMultiLineString=function(){return this.readWkbCollection(this.readWkbBlock,Ku)},e.prototype.readMultiPolygon=function(){return this.readWkbCollection(this.readWkbBlock,Xu)},e.prototype.readGeometryCollection=function(){return this.readWkbCollection(this.readGeometry)},e.prototype.readGeometry=function(){var e=this.readWkbHeader(),t=this.readWkbPayload(e);switch(e){case Yu:return new uo(t,this.layout_);case Ku:return new $s(t,this.layout_);case Xu:case np:return new Ao(t,this.layout_);case $u:return new qs(t,this.layout_);case Ju:return new el(t,this.layout_);case Qu:case tp:case rp:return new nl(t,this.layout_);case ep:return new pl(t);default:return null}},e.prototype.getSrid=function(){return this.srid_},e}(),op=function(){function e(e){e=e||{},this.layout_=e.layout,this.isLittleEndian_=!1!==e.littleEndian,this.isEWKB_=!1!==e.ewkb,this.writeQueue_=[],this.nodata_=nt({X:0,Y:0,Z:0,M:0},e.nodata)}return e.prototype.writeUint8=function(e){this.writeQueue_.push([1,e])},e.prototype.writeUint32=function(e){this.writeQueue_.push([4,e])},e.prototype.writeDouble=function(e){this.writeQueue_.push([8,e])},e.prototype.writePoint=function(e,t){for(var r=nt.apply(null,t.split("").map((function(t,r){var n;return(n={})[t]=e[r],n}))),n=0,i=this.layout_;n<i.length;n++){var o=i[n];this.writeDouble(o in r?r[o]:this.nodata_[o])}},e.prototype.writeLineString=function(e,t){this.writeUint32(e.length);for(var r=0;r<e.length;r++)this.writePoint(e[r],t)},e.prototype.writePolygon=function(e,t){this.writeUint32(e.length);for(var r=0;r<e.length;r++)this.writeLineString(e[r],t)},e.prototype.writeWkbHeader=function(e,t){e%=1e3,this.layout_.indexOf("Z")>=0&&(e+=this.isEWKB_?2147483648:1e3),this.layout_.indexOf("M")>=0&&(e+=this.isEWKB_?1073741824:2e3),this.isEWKB_&&Number.isInteger(t)&&(e|=536870912),this.writeUint8(this.isLittleEndian_?1:0),this.writeUint32(e),this.isEWKB_&&Number.isInteger(t)&&this.writeUint32(t)},e.prototype.writeMultiPoint=function(e,t){this.writeUint32(e.length);for(var r=0;r<e.length;r++)this.writeWkbHeader(1),this.writePoint(e[r],t)},e.prototype.writeMultiLineString=function(e,t){this.writeUint32(e.length);for(var r=0;r<e.length;r++)this.writeWkbHeader(2),this.writeLineString(e[r],t)},e.prototype.writeMultiPolygon=function(e,t){this.writeUint32(e.length);for(var r=0;r<e.length;r++)this.writeWkbHeader(3),this.writePolygon(e[r],t)},e.prototype.writeGeometryCollection=function(e){this.writeUint32(e.length);for(var t=0;t<e.length;t++)this.writeGeometry(e[t])},e.prototype.findMinimumLayout=function(e,t){void 0===t&&(t=Pi.XYZM);var r,n;if(e instanceof Bi)return(r=e.getLayout())===(n=t)?r:r===Pi.XYZM?n:n===Pi.XYZM?r:Pi.XY;if(e instanceof pl)for(var i=e.getGeometriesArray(),o=0;o<i.length&&t!==Pi.XY;o++)t=this.findMinimumLayout(i[o],t);return t},e.prototype.writeGeometry=function(e,t){var r={Point:Yu,LineString:Ku,Polygon:Xu,MultiPoint:$u,MultiLineString:Ju,MultiPolygon:Qu,GeometryCollection:ep},n=e.getType(),i=r[n];if(!i)throw new Error("GeometryType "+n+" is not supported");(this.layout_||(this.layout_=this.findMinimumLayout(e)),this.writeWkbHeader(i,t),e instanceof Bi)?{Point:this.writePoint,LineString:this.writeLineString,Polygon:this.writePolygon,MultiPoint:this.writeMultiPoint,MultiLineString:this.writeMultiLineString,MultiPolygon:this.writeMultiPolygon}[n].call(this,e.getCoordinates(),e.getLayout()):e instanceof pl&&this.writeGeometryCollection(e.getGeometriesArray())},e.prototype.getBuffer=function(){var e=this,t=this.writeQueue_.reduce((function(e,t){return e+t[0]}),0),r=new ArrayBuffer(t),n=new DataView(r),i=0;return this.writeQueue_.forEach((function(t){switch(t[0]){case 1:n.setUint8(i,t[1]);break;case 4:n.setUint32(i,t[1],e.isLittleEndian_);break;case 8:n.setFloat64(i,t[1],e.isLittleEndian_)}i+=t[0]})),r},e}(),ap=function(e){function t(t){var r=e.call(this)||this,n=t||{};return r.splitCollection=Boolean(n.splitCollection),r.viewCache_=null,r.hex_=!1!==n.hex,r.littleEndian_=!1!==n.littleEndian,r.ewkb_=!1!==n.ewkb,r.layout_=n.geometryLayout,r.nodataZ_=n.nodataZ||0,r.nodataM_=n.nodataM||0,r.srid_=n.srid,r}return zu(t,e),t.prototype.getType=function(){return this.hex_?"text":"arraybuffer"},t.prototype.readFeature=function(e,t){return new js({geometry:this.readGeometry(e,t)})},t.prototype.readFeatures=function(e,t){var r=this.readGeometry(e,t);return(this.splitCollection&&r instanceof pl?r.getGeometriesArray():[r]).map((function(e){return new js({geometry:e})}))},t.prototype.readGeometry=function(e,t){var r=sp(e);if(!r)return null;var n=new ip(r).readGeometry();this.viewCache_=r;var i=this.getReadOptions(e,t);return this.viewCache_=null,gl(n,!1,i)},t.prototype.readProjection=function(e){var t=this.viewCache_||sp(e);if(t){var r=new ip(t);return r.readWkbHeader(),r.getSrid()&&$n("EPSG:"+r.getSrid())||void 0}},t.prototype.writeFeature=function(e,t){return this.writeGeometry(e.getGeometry(),t)},t.prototype.writeFeatures=function(e,t){return this.writeGeometry(new pl(e.map((function(e){return e.getGeometry()}))),t)},t.prototype.writeGeometry=function(e,t){var r=this.adaptOptions(t),n=new op({layout:this.layout_,littleEndian:this.littleEndian_,ewkb:this.ewkb_,nodata:{Z:this.nodataZ_,M:this.nodataM_}}),i=Number.isInteger(this.srid_)?Number(this.srid_):null;if(!1!==this.srid_&&!Number.isInteger(this.srid_)){var o=r.dataProjection&&$n(r.dataProjection);if(o){var a=o.getCode();0===a.indexOf("EPSG:")&&(i=Number(a.substring(5)))}}n.writeGeometry(gl(e,!0,r),i);var s=n.getBuffer();return this.hex_?function(e){var t=new Uint8Array(e);return Array.from(t.values()).map((function(e){return(e<16?"0":"")+Number(e).toString(16).toUpperCase()})).join("")}(s):s},t}(fl);function sp(e){return"string"==typeof e?function(e){for(var t=new Uint8Array(e.length/2),r=0;r<e.length/2;r++)t[r]=parseInt(e.substr(2*r,2),16);return new DataView(t.buffer)}(e):ArrayBuffer.isView(e)?e instanceof DataView?e:new DataView(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?new DataView(e):null}const lp=ap;const cp=function(){function e(){}return e.prototype.read=function(e){if(e){if("string"==typeof e){var t=El(e);return this.readFromDocument(t)}return Sl(e)?this.readFromDocument(e):this.readFromNode(e)}return null},e.prototype.readFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null},e.prototype.readFromNode=function(e){},e}();function up(e){return e.getAttributeNS("http://www.w3.org/1999/xlink","href")}var pp=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),hp=[null,"http://www.opengis.net/wms"],dp=Ml(hp,{Service:Al((function(e,t){return Nl({},yp,e,t)})),Capability:Al((function(e,t){return Nl({},fp,e,t)}))}),fp=Ml(hp,{Request:Al((function(e,t){return Nl({},Cp,e,t)})),Exception:Al((function(e,t){return Nl([],wp,e,t)})),Layer:Al((function(e,t){var r=Nl({},Sp,e,t);if(void 0===r.Layer)return Object.assign(r,Ip(e,t));return r}))}),gp=function(e){function t(){var t=e.call(this)||this;return t.version=void 0,t}return pp(t,e),t.prototype.readFromNode=function(e){this.version=e.getAttribute("version").trim();var t=Nl({version:this.version},dp,e,[]);return t||null},t}(cp),yp=Ml(hp,{Name:Al(oc),Title:Al(oc),Abstract:Al(oc),KeywordList:Al(Np),OnlineResource:Al(up),ContactInformation:Al((function(e,t){return Nl({},mp,e,t)})),Fees:Al(oc),AccessConstraints:Al(oc),LayerLimit:Al(nc),MaxWidth:Al(nc),MaxHeight:Al(nc)}),mp=Ml(hp,{ContactPersonPrimary:Al((function(e,t){return Nl({},vp,e,t)})),ContactPosition:Al(oc),ContactAddress:Al((function(e,t){return Nl({},_p,e,t)})),ContactVoiceTelephone:Al(oc),ContactFacsimileTelephone:Al(oc),ContactElectronicMailAddress:Al(oc)}),vp=Ml(hp,{ContactPerson:Al(oc),ContactOrganization:Al(oc)}),_p=Ml(hp,{AddressType:Al(oc),Address:Al(oc),City:Al(oc),StateOrProvince:Al(oc),PostCode:Al(oc),Country:Al(oc)}),wp=Ml(hp,{Format:Cl(oc)}),Sp=Ml(hp,{Name:Al(oc),Title:Al(oc),Abstract:Al(oc),KeywordList:Al(Np),CRS:Tl(oc),EX_GeographicBoundingBox:Al((function(e,t){var r=Nl({},bp,e,t);if(!r)return;var n=r.westBoundLongitude,i=r.southBoundLatitude,o=r.eastBoundLongitude,a=r.northBoundLatitude;if(void 0===n||void 0===i||void 0===o||void 0===a)return;return[n,i,o,a]})),BoundingBox:Tl((function(e,t){var r=[rc(e.getAttribute("minx")),rc(e.getAttribute("miny")),rc(e.getAttribute("maxx")),rc(e.getAttribute("maxy"))],n=[rc(e.getAttribute("resx")),rc(e.getAttribute("resy"))];return{crs:e.getAttribute("CRS"),extent:r,res:n}})),Dimension:Tl((function(e,t){return{name:e.getAttribute("name"),units:e.getAttribute("units"),unitSymbol:e.getAttribute("unitSymbol"),default:e.getAttribute("default"),multipleValues:Ql(e.getAttribute("multipleValues")),nearestValue:Ql(e.getAttribute("nearestValue")),current:Ql(e.getAttribute("current")),values:oc(e)}})),Attribution:Al((function(e,t){return Nl({},Ep,e,t)})),AuthorityURL:Tl((function(e,t){var r=Rp(e,t);if(r)return r.name=e.getAttribute("name"),r;return})),Identifier:Tl(oc),MetadataURL:Tl((function(e,t){var r=Rp(e,t);if(r)return r.type=e.getAttribute("type"),r;return})),DataURL:Tl(Rp),FeatureListURL:Tl(Rp),Style:Tl((function(e,t){return Nl({},xp,e,t)})),MinScaleDenominator:Al(tc),MaxScaleDenominator:Al(tc),Layer:Tl(Ip)}),Ep=Ml(hp,{Title:Al(oc),OnlineResource:Al(up),LogoURL:Al(Dp)}),bp=Ml(hp,{westBoundLongitude:Al(tc),eastBoundLongitude:Al(tc),southBoundLatitude:Al(tc),northBoundLatitude:Al(tc)}),Cp=Ml(hp,{GetCapabilities:Al(Mp),GetMap:Al(Mp),GetFeatureInfo:Al(Mp)}),Lp=Ml(hp,{Format:Tl(oc),DCPType:Tl((function(e,t){return Nl({},Tp,e,t)}))}),Tp=Ml(hp,{HTTP:Al((function(e,t){return Nl({},Ap,e,t)}))}),Ap=Ml(hp,{Get:Al(Rp),Post:Al(Rp)}),xp=Ml(hp,{Name:Al(oc),Title:Al(oc),Abstract:Al(oc),LegendURL:Tl(Dp),StyleSheetURL:Al(Rp),StyleURL:Al(Rp)}),Pp=Ml(hp,{Format:Al(oc),OnlineResource:Al(up)}),Op=Ml(hp,{Keyword:Cl(oc)});function Ip(e,t){var r=t[t.length-1],n=Nl({},Sp,e,t);if(n){var i=Ql(e.getAttribute("queryable"));void 0===i&&(i=r.queryable),n.queryable=void 0!==i&&i;var o=ic(e.getAttribute("cascaded"));void 0===o&&(o=r.cascaded),n.cascaded=o;var a=Ql(e.getAttribute("opaque"));void 0===a&&(a=r.opaque),n.opaque=void 0!==a&&a;var s=Ql(e.getAttribute("noSubsets"));void 0===s&&(s=r.noSubsets),n.noSubsets=void 0!==s&&s;var l=rc(e.getAttribute("fixedWidth"));l||(l=r.fixedWidth),n.fixedWidth=l;var c=rc(e.getAttribute("fixedHeight"));c||(c=r.fixedHeight),n.fixedHeight=c;["Style","CRS","AuthorityURL"].forEach((function(e){if(e in r){var t=n[e]||[];n[e]=t.concat(r[e])}}));return["EX_GeographicBoundingBox","BoundingBox","Dimension","Attribution","MinScaleDenominator","MaxScaleDenominator"].forEach((function(e){if(!(e in n)){var t=r[e];n[e]=t}})),n}}function Rp(e,t){return Nl({},Pp,e,t)}function Mp(e,t){return Nl({},Lp,e,t)}function Dp(e,t){var r=Rp(e,t);if(r){var n=[ic(e.getAttribute("width")),ic(e.getAttribute("height"))];return r.size=n,r}}function Np(e,t){return Nl([],Op,e,t)}const Zp=gp;var kp=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const Fp=function(e){function t(t){var r=e.call(this)||this,n=t||{};return r.featureNS_="http://mapserver.gis.umn.edu/mapserver",r.gmlFormat_=new fc,r.layers_=n.layers?n.layers:null,r}return kp(t,e),t.prototype.getLayers=function(){return this.layers_},t.prototype.setLayers=function(e){this.layers_=e},t.prototype.readFeatures_=function(e,t){e.setAttribute("namespaceURI",this.featureNS_);var r=e.localName,n=[];if(0===e.childNodes.length)return n;if("msGMLOutput"==r)for(var i=0,o=e.childNodes.length;i<o;i++){var a=e.childNodes[i];if(a.nodeType===Node.ELEMENT_NODE){var s=a,l=t[0],u=s.localName.replace("_layer","");if(!this.layers_||c(this.layers_,u)){var p=u+"_feature";l.featureType=p,l.featureNS=this.featureNS_;var d={};d[p]=Cl(this.gmlFormat_.readFeatureElement,this.gmlFormat_);var f=Ml([l.featureNS,null],d);s.setAttribute("namespaceURI",this.featureNS_);var g=Nl([],f,s,t,this.gmlFormat_);g&&h(n,g)}}}if("FeatureCollection"==r){var y=Nl([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,[{}],this.gmlFormat_);y&&(n=y)}return n},t.prototype.readFeaturesFromNode=function(e,t){var r={};return t&&nt(r,this.getReadOptions(e,t)),this.readFeatures_(e,[r])},t}(jl);var Up=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Bp=[null,"http://www.opengis.net/ows/1.1"],Gp=Ml(Bp,{ServiceIdentification:Al((function(e,t){return Nl({},eh,e,t)})),ServiceProvider:Al((function(e,t){return Nl({},th,e,t)})),OperationsMetadata:Al((function(e,t){return Nl({},Xp,e,t)}))}),jp=function(e){function t(){return e.call(this)||this}return Up(t,e),t.prototype.readFromNode=function(e){var t=Nl({},Gp,e,[]);return t||null},t}(cp),Wp=Ml(Bp,{DeliveryPoint:Al(oc),City:Al(oc),AdministrativeArea:Al(oc),PostalCode:Al(oc),Country:Al(oc),ElectronicMailAddress:Al(oc)}),Hp=Ml(Bp,{Value:Tl((function(e,t){return oc(e)}))}),qp=Ml(Bp,{AllowedValues:Al((function(e,t){return Nl({},Hp,e,t)}))}),Vp=Ml(Bp,{Phone:Al((function(e,t){return Nl({},$p,e,t)})),Address:Al((function(e,t){return Nl({},Wp,e,t)}))}),zp=Ml(Bp,{HTTP:Al((function(e,t){return Nl({},Yp,e,t)}))}),Yp=Ml(Bp,{Get:Tl((function(e,t){var r=up(e);if(!r)return;return Nl({href:r},Jp,e,t)})),Post:void 0}),Kp=Ml(Bp,{DCP:Al((function(e,t){return Nl({},zp,e,t)}))}),Xp=Ml(Bp,{Operation:function(e,t){var r=e.getAttribute("name"),n=Nl({},Kp,e,t);if(!n)return;t[t.length-1][r]=n}}),$p=Ml(Bp,{Voice:Al(oc),Facsimile:Al(oc)}),Jp=Ml(Bp,{Constraint:Tl((function(e,t){var r=e.getAttribute("name");if(!r)return;return Nl({name:r},qp,e,t)}))}),Qp=Ml(Bp,{IndividualName:Al(oc),PositionName:Al(oc),ContactInfo:Al((function(e,t){return Nl({},Vp,e,t)}))}),eh=Ml(Bp,{Abstract:Al(oc),AccessConstraints:Al(oc),Fees:Al(oc),Title:Al(oc),ServiceTypeVersion:Al(oc),ServiceType:Al(oc)}),th=Ml(Bp,{ProviderName:Al(oc),ProviderSite:Al(up),ServiceContact:Al((function(e,t){return Nl({},Qp,e,t)}))});const rh=jp;var nh=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ih=[null,"http://www.opengis.net/wmts/1.0"],oh=[null,"http://www.opengis.net/ows/1.1"],ah=Ml(ih,{Contents:Al((function(e,t){return Nl({},lh,e,t)}))}),sh=function(e){function t(){var t=e.call(this)||this;return t.owsParser_=new rh,t}return nh(t,e),t.prototype.readFromNode=function(e){var t=e.getAttribute("version");t&&(t=t.trim());var r=this.owsParser_.readFromNode(e);return r?(r.version=t,(r=Nl(r,ah,e,[]))||null):null},t}(cp),lh=Ml(ih,{Layer:Tl((function(e,t){return Nl({},ch,e,t)})),TileMatrixSet:Tl((function(e,t){return Nl({},yh,e,t)}))}),ch=Ml(ih,{Style:Tl((function(e,t){var r=Nl({},uh,e,t);if(!r)return;var n="true"===e.getAttribute("isDefault");return r.isDefault=n,r})),Format:Tl(oc),TileMatrixSetLink:Tl((function(e,t){return Nl({},ph,e,t)})),Dimension:Tl((function(e,t){return Nl({},fh,e,t)})),ResourceURL:Tl((function(e,t){var r=e.getAttribute("format"),n=e.getAttribute("template"),i=e.getAttribute("resourceType"),o={};r&&(o.format=r);n&&(o.template=n);i&&(o.resourceType=i);return o}))},Ml(oh,{Title:Al(oc),Abstract:Al(oc),WGS84BoundingBox:Al(vh),Identifier:Al(oc)})),uh=Ml(ih,{LegendURL:Tl((function(e,t){var r={};return r.format=e.getAttribute("format"),r.href=up(e),r}))},Ml(oh,{Title:Al(oc),Identifier:Al(oc)})),ph=Ml(ih,{TileMatrixSet:Al(oc),TileMatrixSetLimits:Al((function(e,t){return Nl([],hh,e,t)}))}),hh=Ml(ih,{TileMatrixLimits:Cl((function(e,t){return Nl({},dh,e,t)}))}),dh=Ml(ih,{TileMatrix:Al(oc),MinTileRow:Al(nc),MaxTileRow:Al(nc),MinTileCol:Al(nc),MaxTileCol:Al(nc)}),fh=Ml(ih,{Default:Al(oc),Value:Tl(oc)},Ml(oh,{Identifier:Al(oc)})),gh=Ml(oh,{LowerCorner:Cl(_h),UpperCorner:Cl(_h)}),yh=Ml(ih,{WellKnownScaleSet:Al(oc),TileMatrix:Tl((function(e,t){return Nl({},mh,e,t)}))},Ml(oh,{SupportedCRS:Al(oc),Identifier:Al(oc),BoundingBox:Al(vh)})),mh=Ml(ih,{TopLeftCorner:Al(_h),ScaleDenominator:Al(tc),TileWidth:Al(nc),TileHeight:Al(nc),MatrixWidth:Al(nc),MatrixHeight:Al(nc)},Ml(oh,{Identifier:Al(oc)}));function vh(e,t){var r=Nl([],gh,e,t);if(2==r.length)return K(r)}function _h(e,t){var r=oc(e).split(/\s+/);if(r&&2==r.length){var n=+r[0],i=+r[1];if(!isNaN(n)&&!isNaN(i))return[n,i]}}const wh=sh;var Sh=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function Eh(e){if("string"==typeof e){var t=JSON.parse(e);return t||null}return null!==e?e:null}const bh=function(e){function t(){return e.call(this)||this}return Sh(t,e),t.prototype.getType=function(){return"json"},t.prototype.readFeature=function(e,t){return this.readFeatureFromObject(Eh(e),this.getReadOptions(e,t))},t.prototype.readFeatures=function(e,t){return this.readFeaturesFromObject(Eh(e),this.getReadOptions(e,t))},t.prototype.readFeatureFromObject=function(e,t){return n()},t.prototype.readFeaturesFromObject=function(e,t){return n()},t.prototype.readGeometry=function(e,t){return this.readGeometryFromObject(Eh(e),this.getReadOptions(e,t))},t.prototype.readGeometryFromObject=function(e,t){return n()},t.prototype.readProjection=function(e){return this.readProjectionFromObject(Eh(e))},t.prototype.readProjectionFromObject=function(e){return n()},t.prototype.writeFeature=function(e,t){return JSON.stringify(this.writeFeatureObject(e,t))},t.prototype.writeFeatureObject=function(e,t){return n()},t.prototype.writeFeatures=function(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))},t.prototype.writeFeaturesObject=function(e,t){return n()},t.prototype.writeGeometry=function(e,t){return JSON.stringify(this.writeGeometryObject(e,t))},t.prototype.writeGeometryObject=function(e,t){return n()},t}(fl);var Ch=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Lh=function(e){function t(t){var r=e.call(this)||this,n=t||{};return r.layerName_=n.layerName,r.layers_=n.layers?n.layers:null,r.dataProjection=$n(n.dataProjection?n.dataProjection:"EPSG:4326"),r}return Ch(t,e),t.prototype.readFeaturesFromObject=function(e,t){if("Topology"==e.type){var r=e,n=void 0,i=null,o=null;r.transform&&(i=(n=r.transform).scale,o=n.translate);var a=r.arcs;n&&function(e,t,r){for(var n=0,i=e.length;n<i;++n)Oh(e[n],t,r)}(a,i,o);var s=[],l=r.objects,c=this.layerName_,u=void 0;for(var p in l)this.layers_&&-1==this.layers_.indexOf(p)||("GeometryCollection"===l[p].type?(u=l[p],s.push.apply(s,xh(u,a,i,o,c,p,t))):(u=l[p],s.push(Ph(u,a,i,o,c,p,t))));return s}return[]},t.prototype.readProjectionFromObject=function(e){return this.dataProjection},t}(bh),Th={Point:function(e,t,r){var n=e.coordinates;t&&r&&Ih(n,t,r);return new uo(n)},LineString:function(e,t){var r=Ah(e.arcs,t);return new $s(r)},Polygon:function(e,t){for(var r=[],n=0,i=e.arcs.length;n<i;++n)r[n]=Ah(e.arcs[n],t);return new Ao(r)},MultiPoint:function(e,t,r){var n=e.coordinates;if(t&&r)for(var i=0,o=n.length;i<o;++i)Ih(n[i],t,r);return new qs(n)},MultiLineString:function(e,t){for(var r=[],n=0,i=e.arcs.length;n<i;++n)r[n]=Ah(e.arcs[n],t);return new el(r)},MultiPolygon:function(e,t){for(var r=[],n=0,i=e.arcs.length;n<i;++n){for(var o=e.arcs[n],a=[],s=0,l=o.length;s<l;++s)a[s]=Ah(o[s],t);r[n]=a}return new nl(r)}};function Ah(e,t){for(var r,n=[],i=0,o=e.length;i<o;++i)if(r=e[i],i>0&&n.pop(),r>=0)for(var a=0,s=(l=t[r]).length;a<s;++a)n.push(l[a].slice(0));else{var l;for(a=(l=t[~r]).length-1;a>=0;--a)n.push(l[a].slice(0))}return n}function xh(e,t,r,n,i,o,a){for(var s=e.geometries,l=[],c=0,u=s.length;c<u;++c)l[c]=Ph(s[c],t,r,n,i,o,a);return l}function Ph(e,t,r,n,i,o,a){var s=null,l=e.type;if(l){var c=Th[l];s=gl(s="Point"===l||"MultiPoint"===l?c(e,r,n):c(e,t),!1,a)}var u=new js({geometry:s});void 0!==e.id&&u.setId(e.id);var p=e.properties;return i&&(p||(p={}),p[i]=o),p&&u.setProperties(p,!0),u}function Oh(e,t,r){for(var n=0,i=0,o=0,a=e.length;o<a;++o){var s=e[o];n+=s[0],i+=s[1],s[0]=n,s[1]=i,Ih(s,t,r)}}function Ih(e,t,r){e[0]=e[0]*t[0]+r[0],e[1]=e[1]*t[1]+r[1]}const Rh=Lh;var Mh=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function Dh(e,t){if(!e)return null;var r;switch(e.type){case"Point":r=function(e){return new uo(e.coordinates)}(e);break;case"LineString":r=function(e){return new $s(e.coordinates)}(e);break;case"Polygon":r=function(e){return new Ao(e.coordinates)}(e);break;case"MultiPoint":r=function(e){return new qs(e.coordinates)}(e);break;case"MultiLineString":r=function(e){return new el(e.coordinates)}(e);break;case"MultiPolygon":r=function(e){return new nl(e.coordinates)}(e);break;case"GeometryCollection":r=function(e,t){var r=e.geometries.map((function(e){return Dh(e,t)}));return new pl(r)}(e);break;default:throw new Error("Unsupported GeoJSON type: "+e.type)}return gl(r,!1,t)}function Nh(e,t){var r,n=(e=gl(e,!0,t)).getType();switch(n){case"Point":r=function(e,t){return{type:"Point",coordinates:e.getCoordinates()}}(e);break;case"LineString":r=function(e,t){return{type:"LineString",coordinates:e.getCoordinates()}}(e);break;case"Polygon":r=function(e,t){var r;t&&(r=t.rightHanded);return{type:"Polygon",coordinates:e.getCoordinates(r)}}(e,t);break;case"MultiPoint":r=function(e,t){return{type:"MultiPoint",coordinates:e.getCoordinates()}}(e);break;case"MultiLineString":r=function(e,t){return{type:"MultiLineString",coordinates:e.getCoordinates()}}(e);break;case"MultiPolygon":r=function(e,t){var r;t&&(r=t.rightHanded);return{type:"MultiPolygon",coordinates:e.getCoordinates(r)}}(e,t);break;case"GeometryCollection":r=function(e,t){return{type:"GeometryCollection",geometries:e.getGeometriesArray().map((function(e){var r=nt({},t);return delete r.featureProjection,Nh(e,r)}))}}(e,t);break;case"Circle":r={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+n)}return r}const Zh=function(e){function t(t){var r=this,n=t||{};return(r=e.call(this)||this).dataProjection=$n(n.dataProjection?n.dataProjection:"EPSG:4326"),n.featureProjection&&(r.defaultFeatureProjection=$n(n.featureProjection)),r.geometryName_=n.geometryName,r.extractGeometryName_=n.extractGeometryName,r.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"],r}return Mh(t,e),t.prototype.readFeatureFromObject=function(e,t){var r=null,n=Dh((r="Feature"===e.type?e:{type:"Feature",geometry:e,properties:null}).geometry,t),i=new js;return this.geometryName_?i.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in r!==void 0&&i.setGeometryName(r.geometry_name),i.setGeometry(n),"id"in r&&i.setId(r.id),r.properties&&i.setProperties(r.properties,!0),i},t.prototype.readFeaturesFromObject=function(e,t){var r=null;if("FeatureCollection"===e.type){r=[];for(var n=e.features,i=0,o=n.length;i<o;++i)r.push(this.readFeatureFromObject(n[i],t))}else r=[this.readFeatureFromObject(e,t)];return r},t.prototype.readGeometryFromObject=function(e,t){return Dh(e,t)},t.prototype.readProjectionFromObject=function(e){var t,r=e.crs;return r?"name"==r.type?t=$n(r.properties.name):"EPSG"===r.type?t=$n("EPSG:"+r.properties.code):I(!1,36):t=this.dataProjection,t},t.prototype.writeFeatureObject=function(e,t){t=this.adaptOptions(t);var r={type:"Feature",geometry:null,properties:null},n=e.getId();if(void 0!==n&&(r.id=n),!e.hasProperties())return r;var i=e.getProperties(),o=e.getGeometry();return o&&(r.geometry=Nh(o,t),delete i[e.getGeometryName()]),at(i)||(r.properties=i),r},t.prototype.writeFeaturesObject=function(e,t){t=this.adaptOptions(t);for(var r=[],n=0,i=e.length;n<i;++n)r.push(this.writeFeatureObject(e[n],t));return{type:"FeatureCollection",features:r}},t.prototype.writeGeometryObject=function(e,t){return Nh(e,this.adaptOptions(t))},t}(bh);function kh(e,t){if(!e)return null;var r;switch(e.type){case"Point":r=function(e){return new uo(e.coordinates)}(e);break;case"LineString":r=function(e){return new $s(e.coordinates)}(e);break;case"Polygon":r=function(e){return new Ao(e.coordinates)}(e);break;case"MultiPoint":r=function(e){return new qs(e.coordinates)}(e);break;case"MultiLineString":r=function(e){return new el(e.coordinates)}(e);break;case"MultiPolygon":r=function(e){return new nl(e.coordinates)}(e);break;case"GeometryCollection":r=function(e,t){var r=e.geometries.map((function(e){return kh(e,t)}));return new pl(r)}(e);break;default:throw new Error("Unsupported GeoJSON type: "+e.type)}return gl(r,!1,t)}Zh.prototype.readFeatureFromObject=function(e,t){var r=null;const n=(r="Feature"===e.type?e:{type:"Feature",geometry:e,properties:null}).geometry&&r.geometry.coordinates&&r.geometry.coordinates.length?kh(r.geometry,t):null;var i=new js;return this.geometryName_?i.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in r!==void 0&&i.setGeometryName(r.geometry_name),i.setGeometry(n),"id"in r&&i.setId(r.id),r.properties&&i.setProperties(r.properties,!0),i};const Fh=Zh;var Uh=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Bh=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"];const Gh=function(e){for(var t=[],r=[],n=Math.pow(2,e.length),i=0;i<n;i++){r=[];for(var o=0;o<e.length;o++)i&Math.pow(2,o)&&-1==r.indexOf(e[o])&&r.push(e[o]);r.length>0&&-1==t.indexOf(r.join(" "))&&t.push(r.join(" "))}return t}(Bh.slice().slice(1));!function(e,t){if(e&&e.length>0)for(var r=0;r<t.length;r++){var n=e.indexOf(t[r]);n>-1&&e.splice(n,1)}}(Gh,Bh),Bh=Bh.concat(Gh);const jh=function(e){return 1e3*ec(e)};var Wh={rte:md,trk:vd,wpt:_d},Hh=Ml(Bh,{rte:Cl(md),trk:Cl(vd),wpt:Cl(_d)}),qh=Ml(Bh,{text:Al(oc,"linkText"),type:Al(oc,"linkType")}),Vh=Ml(Bh,{rte:xl((function(e,t,r){var n=r[0],i=t.getProperties(),o={node:e};o.properties=i;var a=t.getGeometry();if("LineString"==a.getType()){var s=gl(a,!0,n);o.geometryLayout=s.getLayout(),i.rtept=s.getCoordinates()}var l=r[r.length-1].node,c=rd[l.namespaceURI],u=Rl(i,c);kl(o,nd,Il,u,r,c)})),trk:xl((function(e,t,r){var n=r[0],i=t.getProperties(),o={node:e};o.properties=i;var a=t.getGeometry();if("MultiLineString"==a.getType()){var s=gl(a,!0,n);i.trkseg=s.getLineStrings()}var l=r[r.length-1].node,c=od[l.namespaceURI],u=Rl(i,c);kl(o,ad,Il,u,r,c)})),wpt:xl((function(e,t,r){var n=r[0],i=r[r.length-1];i.properties=t.getProperties();var o=t.getGeometry();if("Point"==o.getType()){var a=gl(o,!0,n);i.geometryLayout=a.getLayout(),Sd(e,a.getCoordinates(),r)}}))}),zh=function(e){function t(t){var r=e.call(this)||this,n=t||{};return r.dataProjection=$n("EPSG:4326"),r.readExtensions_=n.readExtensions,r}return Uh(t,e),t.prototype.handleReadExtensions_=function(e){e||(e=[]);for(var t=0,r=e.length;t<r;++t){var n=e[t];if(this.readExtensions_){var i=n.get("extensionsNode_")||null;this.readExtensions_(n,i)}n.set("extensionsNode_",void 0)}},t.prototype.readFeatureFromNode=function(e,t){if(!c(Bh,e.namespaceURI))return null;var r=Wh[e.localName];if(!r)return null;var n=r(e,[this.getReadOptions(e,t)]);return n?(this.handleReadExtensions_([n]),n):null},t.prototype.readFeaturesFromNode=function(e,t){if(!c(Bh,e.namespaceURI))return[];if("gpx"==e.localName){var r=Nl([],Hh,e,[this.getReadOptions(e,t)]);return r?(this.handleReadExtensions_(r),r):[]}return[]},t.prototype.writeFeaturesNode=function(e,t){t=this.adaptOptions(t);var r=vl("http://www.topografix.com/GPX/1/1","gpx");return r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",ml),r.setAttributeNS(ml,"xsi:schemaLocation","http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd"),r.setAttribute("version","1.1"),r.setAttribute("creator","OpenLayers"),kl({node:r},Vh,hd,e,[t]),r},t}(jl),Yh=Ml(Bh,{name:Al(oc),cmt:Al(oc),desc:Al(oc),src:Al(oc),link:gd,number:Al(nc),extensions:yd,type:Al(oc),rtept:function(e,t){var r=Nl({},Kh,e,t);if(r){var n=t[t.length-1],i=n.flatCoordinates,o=n.layoutOptions;dd(i,o,e,r)}}}),Kh=Ml(Bh,{ele:Al(tc),time:Al(jh)}),Xh=Ml(Bh,{name:Al(oc),cmt:Al(oc),desc:Al(oc),src:Al(oc),link:gd,number:Al(nc),type:Al(oc),extensions:yd,trkseg:function(e,t){var r=t[t.length-1];Dl($h,e,t);var n=r.flatCoordinates;r.ends.push(n.length)}}),$h=Ml(Bh,{trkpt:function(e,t){var r=Nl({},Jh,e,t);if(r){var n=t[t.length-1],i=n.flatCoordinates,o=n.layoutOptions;dd(i,o,e,r)}}}),Jh=Ml(Bh,{ele:Al(tc),time:Al(jh)}),Qh=Ml(Bh,{ele:Al(tc),time:Al(jh),magvar:Al(tc),geoidheight:Al(tc),name:Al(oc),cmt:Al(oc),desc:Al(oc),src:Al(oc),link:gd,sym:Al(oc),type:Al(oc),fix:Al(oc),sat:Al(nc),hdop:Al(tc),vdop:Al(tc),pdop:Al(tc),ageofdgpsdata:Al(tc),dgpsid:Al(nc),extensions:yd}),ed=["text","type"],td=Ml(Bh,{text:xl(uc),type:xl(uc)}),rd=Ml(Bh,["name","cmt","desc","src","link","number","type","rtept"]),nd=Ml(Bh,{name:xl(uc),cmt:xl(uc),desc:xl(uc),src:xl(uc),link:xl(wd),number:xl(cc),type:xl(uc),rtept:Pl(xl(Sd))}),id=Ml(Bh,["ele","time"]),od=Ml(Bh,["name","cmt","desc","src","link","number","type","trkseg"]),ad=Ml(Bh,{name:xl(uc),cmt:xl(uc),desc:xl(uc),src:xl(uc),link:xl(wd),number:xl(cc),type:xl(uc),trkseg:Pl(xl((function(e,t,r){var n={node:e};n.geometryLayout=t.getLayout(),n.properties={},kl(n,ld,sd,t.getCoordinates(),r)})))}),sd=Ol("trkpt"),ld=Ml(Bh,{trkpt:xl(Sd)}),cd=Ml(Bh,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),ud=Ml(Bh,{ele:xl(lc),time:xl((function(e,t){var r=new Date(1e3*t),n=r.getUTCFullYear()+"-"+fs(r.getUTCMonth()+1,2)+"-"+fs(r.getUTCDate(),2)+"T"+fs(r.getUTCHours(),2)+":"+fs(r.getUTCMinutes(),2)+":"+fs(r.getUTCSeconds(),2)+"Z";e.appendChild(Bl().createTextNode(n))})),magvar:xl(lc),geoidheight:xl(lc),name:xl(uc),cmt:xl(uc),desc:xl(uc),src:xl(uc),link:xl(wd),sym:xl(uc),type:xl(uc),fix:xl(uc),sat:xl(cc),hdop:xl(lc),vdop:xl(lc),pdop:xl(lc),ageofdgpsdata:xl(lc),dgpsid:xl(cc)}),pd={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function hd(e,t,r){var n=e.getGeometry();if(n){var i=pd[n.getType()];if(i)return vl(t[t.length-1].node.namespaceURI,i)}}function dd(e,t,r,n){return e.push(parseFloat(r.getAttribute("lon")),parseFloat(r.getAttribute("lat"))),"ele"in n?(e.push(n.ele),delete n.ele,t.hasZ=!0):e.push(0),"time"in n?(e.push(n.time),delete n.time,t.hasM=!0):e.push(0),e}function fd(e,t,r){var n=Pi.XY,i=2;if(e.hasZ&&e.hasM?(n=Pi.XYZM,i=4):e.hasZ?(n=Pi.XYZ,i=3):e.hasM&&(n=Pi.XYM,i=3),4!==i){for(var o=0,a=t.length/4;o<a;o++)t[o*i]=t[4*o],t[o*i+1]=t[4*o+1],e.hasZ&&(t[o*i+2]=t[4*o+2]),e.hasM&&(t[o*i+2]=t[4*o+3]);if(t.length=t.length/4*i,r)for(o=0,a=r.length;o<a;o++)r[o]=r[o]/4*i}return n}function gd(e,t){var r=t[t.length-1],n=e.getAttribute("href");null!==n&&(r.link=n),Dl(qh,e,t)}function yd(e,t){t[t.length-1].extensionsNode_=e}function md(e,t){var r=t[0],n=Nl({flatCoordinates:[],layoutOptions:{}},Yh,e,t);if(n){var i=n.flatCoordinates;delete n.flatCoordinates;var o=n.layoutOptions;delete n.layoutOptions;var a=fd(o,i),s=new $s(i,a);gl(s,!1,r);var l=new js(s);return l.setProperties(n,!0),l}}function vd(e,t){var r=t[0],n=Nl({flatCoordinates:[],ends:[],layoutOptions:{}},Xh,e,t);if(n){var i=n.flatCoordinates;delete n.flatCoordinates;var o=n.ends;delete n.ends;var a=n.layoutOptions;delete n.layoutOptions;var s=fd(a,i,o),l=new el(i,s,o);gl(l,!1,r);var c=new js(l);return c.setProperties(n,!0),c}}function _d(e,t){var r=t[0],n=Nl({},Qh,e,t);if(n){var i={},o=dd([],i,e,n),a=fd(i,o),s=new uo(o,a);gl(s,!1,r);var l=new js(s);return l.setProperties(n,!0),l}}function wd(e,t,r){e.setAttribute("href",t);var n=r[r.length-1].properties,i=[n.linkText,n.linkType];kl({node:e},td,Il,i,r,ed)}function Sd(e,t,r){var n=r[r.length-1],i=n.node.namespaceURI,o=n.properties;switch(e.setAttributeNS(null,"lat",String(t[1])),e.setAttributeNS(null,"lon",String(t[0])),n.geometryLayout){case Pi.XYZM:0!==t[3]&&(o.time=t[3]);case Pi.XYZ:0!==t[2]&&(o.ele=t[2]);break;case Pi.XYM:0!==t[2]&&(o.time=t[2])}var a="rtept"==e.nodeName?id[i]:cd[i],s=Rl(o,a);kl({node:e,properties:o},ud,Il,s,r,a)}const Ed=zh;const bd=function(){function e(e){var t=e||{};this.color_=void 0!==t.color?t.color:null}return e.prototype.clone=function(){var t=this.getColor();return new e({color:Array.isArray(t)?t.slice():t||void 0})},e.prototype.getColor=function(){return this.color_},e.prototype.setColor=function(e){this.color_=e},e}(),Cd={FRACTION:"fraction",PIXELS:"pixels"},Ld={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},Td=0,Ad=1,xd=2,Pd=3,Od=4;var Id=function(){function e(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=ko(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}return e.prototype.clone=function(){var t=this.getScale();return new e({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})},e.prototype.getOpacity=function(){return this.opacity_},e.prototype.getRotateWithView=function(){return this.rotateWithView_},e.prototype.getRotation=function(){return this.rotation_},e.prototype.getScale=function(){return this.scale_},e.prototype.getScaleArray=function(){return this.scaleArray_},e.prototype.getDisplacement=function(){return this.displacement_},e.prototype.getDeclutterMode=function(){return this.declutterMode_},e.prototype.getAnchor=function(){return n()},e.prototype.getImage=function(e){return n()},e.prototype.getHitDetectionImage=function(){return n()},e.prototype.getPixelRatio=function(e){return 1},e.prototype.getImageState=function(){return n()},e.prototype.getImageSize=function(){return n()},e.prototype.getOrigin=function(){return n()},e.prototype.getSize=function(){return n()},e.prototype.setDisplacement=function(e){this.displacement_=e},e.prototype.setOpacity=function(e){this.opacity_=e},e.prototype.setRotateWithView=function(e){this.rotateWithView_=e},e.prototype.setRotation=function(e){this.rotation_=e},e.prototype.setScale=function(e){this.scale_=e,this.scaleArray_=ko(e)},e.prototype.listenImageChange=function(e){n()},e.prototype.load=function(){n()},e.prototype.unlistenImageChange=function(e){n()},e}();const Rd=Id;var Md=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const Dd=function(e){function t(t,r,n,i){var o=e.call(this)||this;return o.extent=t,o.pixelRatio_=n,o.resolution=r,o.state=i,o}return Md(t,e),t.prototype.changed=function(){this.dispatchEvent(ct.CHANGE)},t.prototype.getExtent=function(){return this.extent},t.prototype.getImage=function(){return n()},t.prototype.getPixelRatio=function(){return this.pixelRatio_},t.prototype.getResolution=function(){return this.resolution},t.prototype.getState=function(){return this.state},t.prototype.load=function(){n()},t}(lt);var Nd=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function Zd(e,t,r){var n=e,i=!0,o=!1,a=!1,s=[pt(n,ct.LOAD,(function(){a=!0,o||t()}))];return n.src&&A?(o=!0,n.decode().then((function(){i&&t()})).catch((function(e){i&&(a?t():r())}))):s.push(pt(n,ct.ERROR,r)),function(){i=!1,s.forEach(ht)}}const kd=function(e){function t(t,r,n,i,o,a){var s=e.call(this,t,r,n,Td)||this;return s.src_=i,s.image_=new Image,null!==o&&(s.image_.crossOrigin=o),s.unlisten_=null,s.state=Td,s.imageLoadFunction_=a,s}return Nd(t,e),t.prototype.getImage=function(){return this.image_},t.prototype.handleImageError_=function(){this.state=Pd,this.unlistenImage_(),this.changed()},t.prototype.handleImageLoad_=function(){void 0===this.resolution&&(this.resolution=Se(this.extent)/this.image_.height),this.state=xd,this.unlistenImage_(),this.changed()},t.prototype.load=function(){this.state!=Td&&this.state!=Pd||(this.state=Ad,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=Zd(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},t.prototype.setImage=function(e){this.image_=e,this.resolution=Se(this.extent)/this.image_.height},t.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},t}(Dd);var Fd=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ud=null,Bd=function(e){function t(t,r,n,i,o,a){var s=e.call(this)||this;return s.hitDetectionImage_=null,s.image_=t||new Image,null!==i&&(s.image_.crossOrigin=i),s.canvas_={},s.color_=a,s.unlisten_=null,s.imageState_=o,s.size_=n,s.src_=r,s.tainted_,s}return Fd(t,e),t.prototype.isTainted_=function(){if(void 0===this.tainted_&&this.imageState_===xd){Ud||(Ud=or(1,1)),Ud.drawImage(this.image_,0,0);try{Ud.getImageData(0,0,1,1),this.tainted_=!1}catch(e){Ud=null,this.tainted_=!0}}return!0===this.tainted_},t.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(ct.CHANGE)},t.prototype.handleImageError_=function(){this.imageState_=Pd,this.unlistenImage_(),this.dispatchChangeEvent_()},t.prototype.handleImageLoad_=function(){this.imageState_=xd,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()},t.prototype.getImage=function(e){return this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_},t.prototype.getPixelRatio=function(e){return this.replaceColor_(e),this.canvas_[e]?e:1},t.prototype.getImageState=function(){return this.imageState_},t.prototype.getHitDetectionImage=function(){if(!this.hitDetectionImage_)if(this.isTainted_()){var e=this.size_[0],t=this.size_[1],r=or(e,t);r.fillRect(0,0,e,t),this.hitDetectionImage_=r.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},t.prototype.getSize=function(){return this.size_},t.prototype.getSrc=function(){return this.src_},t.prototype.load=function(){if(this.imageState_==Td){this.imageState_=Ad;try{this.image_.src=this.src_}catch(e){this.handleImageError_()}this.unlisten_=Zd(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}},t.prototype.replaceColor_=function(e){if(this.color_&&!this.canvas_[e]&&this.imageState_===xd){var t=document.createElement("canvas");this.canvas_[e]=t,t.width=Math.ceil(this.image_.width*e),t.height=Math.ceil(this.image_.height*e);var r=t.getContext("2d");if(r.scale(e,e),r.drawImage(this.image_,0,0),r.globalCompositeOperation="multiply","multiply"===r.globalCompositeOperation||this.isTainted_())r.fillStyle=qe(this.color_),r.fillRect(0,0,t.width/e,t.height/e),r.globalCompositeOperation="destination-in",r.drawImage(this.image_,0,0);else{for(var n=r.getImageData(0,0,t.width,t.height),i=n.data,o=this.color_[0]/255,a=this.color_[1]/255,s=this.color_[2]/255,l=this.color_[3],c=0,u=i.length;c<u;c+=4)i[c]*=o,i[c+1]*=a,i[c+2]*=s,i[c+3]*=l;r.putImageData(n,0,0)}}},t.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},t}(lt);var Gd=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),jd=function(e){function t(t){var r=this,n=t||{},i=void 0!==n.opacity?n.opacity:1,a=void 0!==n.rotation?n.rotation:0,s=void 0!==n.scale?n.scale:1,l=void 0!==n.rotateWithView&&n.rotateWithView;(r=e.call(this,{opacity:i,rotation:a,scale:s,displacement:void 0!==n.displacement?n.displacement:[0,0],rotateWithView:l,declutterMode:n.declutterMode})||this).anchor_=void 0!==n.anchor?n.anchor:[.5,.5],r.normalizedAnchor_=null,r.anchorOrigin_=void 0!==n.anchorOrigin?n.anchorOrigin:Ld.TOP_LEFT,r.anchorXUnits_=void 0!==n.anchorXUnits?n.anchorXUnits:Cd.FRACTION,r.anchorYUnits_=void 0!==n.anchorYUnits?n.anchorYUnits:Cd.FRACTION,r.crossOrigin_=void 0!==n.crossOrigin?n.crossOrigin:null;var c=void 0!==n.img?n.img:null;r.imgSize_=n.imgSize;var u=n.src;I(!(void 0!==u&&c),4),I(!c||c&&r.imgSize_,5),void 0!==u&&0!==u.length||!c||(u=c.src||o(c)),I(void 0!==u&&u.length>0,6);var p=void 0!==n.src?Td:xd;return r.color_=void 0!==n.color?Ye(n.color):null,r.iconImage_=function(e,t,r,n,i,o){var a=Qe.get(t,n,o);return a||(a=new Bd(e,t,r,n,i,o),Qe.set(t,n,o,a)),a}(c,u,void 0!==r.imgSize_?r.imgSize_:null,r.crossOrigin_,p,r.color_),r.offset_=void 0!==n.offset?n.offset:[0,0],r.offsetOrigin_=void 0!==n.offsetOrigin?n.offsetOrigin:Ld.TOP_LEFT,r.origin_=null,r.size_=void 0!==n.size?n.size:null,r}return Gd(t,e),t.prototype.clone=function(){var e=this.getScale();return new t({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Array.isArray(e)?e.slice():e,size:null!==this.size_?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})},t.prototype.getAnchor=function(){var e=this.normalizedAnchor_;if(!e){e=this.anchor_;var t=this.getSize();if(this.anchorXUnits_==Cd.FRACTION||this.anchorYUnits_==Cd.FRACTION){if(!t)return null;e=this.anchor_.slice(),this.anchorXUnits_==Cd.FRACTION&&(e[0]*=t[0]),this.anchorYUnits_==Cd.FRACTION&&(e[1]*=t[1])}if(this.anchorOrigin_!=Ld.TOP_LEFT){if(!t)return null;e===this.anchor_&&(e=this.anchor_.slice()),this.anchorOrigin_!=Ld.TOP_RIGHT&&this.anchorOrigin_!=Ld.BOTTOM_RIGHT||(e[0]=-e[0]+t[0]),this.anchorOrigin_!=Ld.BOTTOM_LEFT&&this.anchorOrigin_!=Ld.BOTTOM_RIGHT||(e[1]=-e[1]+t[1])}this.normalizedAnchor_=e}var r=this.getDisplacement();return[e[0]-r[0],e[1]+r[1]]},t.prototype.setAnchor=function(e){this.anchor_=e,this.normalizedAnchor_=null},t.prototype.getColor=function(){return this.color_},t.prototype.getImage=function(e){return this.iconImage_.getImage(e)},t.prototype.getPixelRatio=function(e){return this.iconImage_.getPixelRatio(e)},t.prototype.getImageSize=function(){return this.iconImage_.getSize()},t.prototype.getImageState=function(){return this.iconImage_.getImageState()},t.prototype.getHitDetectionImage=function(){return this.iconImage_.getHitDetectionImage()},t.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var e=this.offset_;if(this.offsetOrigin_!=Ld.TOP_LEFT){var t=this.getSize(),r=this.iconImage_.getSize();if(!t||!r)return null;e=e.slice(),this.offsetOrigin_!=Ld.TOP_RIGHT&&this.offsetOrigin_!=Ld.BOTTOM_RIGHT||(e[0]=r[0]-t[0]-e[0]),this.offsetOrigin_!=Ld.BOTTOM_LEFT&&this.offsetOrigin_!=Ld.BOTTOM_RIGHT||(e[1]=r[1]-t[1]-e[1])}return this.origin_=e,this.origin_},t.prototype.getSrc=function(){return this.iconImage_.getSrc()},t.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},t.prototype.listenImageChange=function(e){this.iconImage_.addEventListener(ct.CHANGE,e)},t.prototype.load=function(){this.iconImage_.load()},t.prototype.unlistenImageChange=function(e){this.iconImage_.removeEventListener(ct.CHANGE,e)},t}(Rd);const Wd=jd;const Hd=function(){function e(e){var t=e||{};this.color_=void 0!==t.color?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=void 0!==t.lineDash?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}return e.prototype.clone=function(){var t=this.getColor();return new e({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},e.prototype.getColor=function(){return this.color_},e.prototype.getLineCap=function(){return this.lineCap_},e.prototype.getLineDash=function(){return this.lineDash_},e.prototype.getLineDashOffset=function(){return this.lineDashOffset_},e.prototype.getLineJoin=function(){return this.lineJoin_},e.prototype.getMiterLimit=function(){return this.miterLimit_},e.prototype.getWidth=function(){return this.width_},e.prototype.setColor=function(e){this.color_=e},e.prototype.setLineCap=function(e){this.lineCap_=e},e.prototype.setLineDash=function(e){this.lineDash_=e},e.prototype.setLineDashOffset=function(e){this.lineDashOffset_=e},e.prototype.setLineJoin=function(e){this.lineJoin_=e},e.prototype.setMiterLimit=function(e){this.miterLimit_=e},e.prototype.setWidth=function(e){this.width_=e},e}();function qd(e){return Array.isArray(e)?Xe(e):e}var Vd=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),zd=function(e){function t(t){var r=this,n=void 0!==t.rotateWithView&&t.rotateWithView;return(r=e.call(this,{opacity:1,rotateWithView:n,rotation:void 0!==t.rotation?t.rotation:0,scale:void 0!==t.scale?t.scale:1,displacement:void 0!==t.displacement?t.displacement:[0,0],declutterMode:t.declutterMode})||this).canvas_=void 0,r.hitDetectionCanvas_=null,r.fill_=void 0!==t.fill?t.fill:null,r.origin_=[0,0],r.points_=t.points,r.radius_=void 0!==t.radius?t.radius:t.radius1,r.radius2_=t.radius2,r.angle_=void 0!==t.angle?t.angle:0,r.stroke_=void 0!==t.stroke?t.stroke:null,r.size_=null,r.renderOptions_=null,r.render(),r}return Vd(t,e),t.prototype.clone=function(){var e=this.getScale(),r=new t({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return r.setOpacity(this.getOpacity()),r},t.prototype.getAnchor=function(){var e=this.size_;if(!e)return null;var t=this.getDisplacement();return[e[0]/2-t[0],e[1]/2+t[1]]},t.prototype.getAngle=function(){return this.angle_},t.prototype.getFill=function(){return this.fill_},t.prototype.setFill=function(e){this.fill_=e,this.render()},t.prototype.getHitDetectionImage=function(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_},t.prototype.getImage=function(e){var t=this.canvas_[e];if(!t){var r=this.renderOptions_,n=or(r.size*e,r.size*e);this.draw_(r,n,e),t=n.canvas,this.canvas_[e]=t}return t},t.prototype.getPixelRatio=function(e){return e},t.prototype.getImageSize=function(){return this.size_},t.prototype.getImageState=function(){return xd},t.prototype.getOrigin=function(){return this.origin_},t.prototype.getPoints=function(){return this.points_},t.prototype.getRadius=function(){return this.radius_},t.prototype.getRadius2=function(){return this.radius2_},t.prototype.getSize=function(){return this.size_},t.prototype.getStroke=function(){return this.stroke_},t.prototype.setStroke=function(e){this.stroke_=e,this.render()},t.prototype.listenImageChange=function(e){},t.prototype.load=function(){},t.prototype.unlistenImageChange=function(e){},t.prototype.calculateLineJoinSize_=function(e,t,r){if(0===t||this.points_===1/0||"bevel"!==e&&"miter"!==e)return t;var n=this.radius_,i=void 0===this.radius2_?n:this.radius2_;if(n<i){var o=n;n=i,i=o}var a=void 0===this.radius2_?this.points_:2*this.points_,s=2*Math.PI/a,l=i*Math.sin(s),c=n-Math.sqrt(i*i-l*l),u=Math.sqrt(l*l+c*c),p=u/l;if("miter"===e&&p<=r)return p*t;var h=t/2/p,d=t/2*(c/u),f=Math.sqrt((n+h)*(n+h)+d*d)-n;if(void 0===this.radius2_||"bevel"===e)return 2*f;var g=n*Math.sin(s),y=i-Math.sqrt(n*n-g*g),m=Math.sqrt(g*g+y*y)/g;if(m<=r){var v=m*t/2-i-n;return 2*Math.max(f,v)}return 2*f},t.prototype.createRenderOptions=function(){var e,t=yr,r=0,n=null,i=0,o=0;this.stroke_&&(null===(e=this.stroke_.getColor())&&(e=mr),e=qd(e),void 0===(o=this.stroke_.getWidth())&&(o=1),n=this.stroke_.getLineDash(),i=this.stroke_.getLineDashOffset(),void 0===(t=this.stroke_.getLineJoin())&&(t=yr),void 0===(r=this.stroke_.getMiterLimit())&&(r=10));var a=this.calculateLineJoinSize_(t,o,r),s=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:e,strokeWidth:o,size:Math.ceil(2*s+a),lineDash:n,lineDashOffset:i,lineJoin:t,miterLimit:r}},t.prototype.render=function(){this.renderOptions_=this.createRenderOptions();var e=this.renderOptions_.size;this.canvas_={},this.size_=[e,e]},t.prototype.draw_=function(e,t,r){if(t.scale(r,r),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){var n=this.fill_.getColor();null===n&&(n=dr),t.fillStyle=qd(n),t.fill()}this.stroke_&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,t.setLineDash&&e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())},t.prototype.createHitDetectionCanvas_=function(e){if(this.fill_){var t=this.fill_.getColor(),r=0;if("string"==typeof t&&(t=Ye(t)),null===t?r=1:Array.isArray(t)&&(r=4===t.length?t[3]:1),0===r){var n=or(e.size,e.size);this.hitDetectionCanvas_=n.canvas,this.drawHitDetectionCanvas_(e,n)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))},t.prototype.createPath_=function(e){var t=this.points_,r=this.radius_;if(t===1/0)e.arc(0,0,r,0,2*Math.PI);else{var n=void 0===this.radius2_?r:this.radius2_;void 0!==this.radius2_&&(t*=2);for(var i=this.angle_-Math.PI/2,o=2*Math.PI/t,a=0;a<t;a++){var s=i+a*o,l=a%2==0?r:n;e.lineTo(l*Math.cos(s),l*Math.sin(s))}e.closePath()}},t.prototype.drawHitDetectionCanvas_=function(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=dr,t.fill(),this.stroke_&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())},t}(Rd);const Yd=zd;var Kd=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Xd=function(e){function t(t){var r=t||{};return e.call(this,{points:1/0,fill:r.fill,radius:r.radius,stroke:r.stroke,scale:void 0!==r.scale?r.scale:1,rotation:void 0!==r.rotation?r.rotation:0,rotateWithView:void 0!==r.rotateWithView&&r.rotateWithView,displacement:void 0!==r.displacement?r.displacement:[0,0],declutterMode:r.declutterMode})||this}return Kd(t,e),t.prototype.clone=function(){var e=this.getScale(),r=new t({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return r.setOpacity(this.getOpacity()),r},t.prototype.setRadius=function(e){this.radius_=e,this.render()},t}(Yd);const $d=Xd;var Jd=function(){function e(e){var t=e||{};this.geometry_=null,this.geometryFunction_=rf,void 0!==t.geometry&&this.setGeometry(t.geometry),this.fill_=void 0!==t.fill?t.fill:null,this.image_=void 0!==t.image?t.image:null,this.renderer_=void 0!==t.renderer?t.renderer:null,this.hitDetectionRenderer_=void 0!==t.hitDetectionRenderer?t.hitDetectionRenderer:null,this.stroke_=void 0!==t.stroke?t.stroke:null,this.text_=void 0!==t.text?t.text:null,this.zIndex_=t.zIndex}return e.prototype.clone=function(){var t=this.getGeometry();return t&&"object"==typeof t&&(t=t.clone()),new e({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},e.prototype.getRenderer=function(){return this.renderer_},e.prototype.setRenderer=function(e){this.renderer_=e},e.prototype.setHitDetectionRenderer=function(e){this.hitDetectionRenderer_=e},e.prototype.getHitDetectionRenderer=function(){return this.hitDetectionRenderer_},e.prototype.getGeometry=function(){return this.geometry_},e.prototype.getGeometryFunction=function(){return this.geometryFunction_},e.prototype.getFill=function(){return this.fill_},e.prototype.setFill=function(e){this.fill_=e},e.prototype.getImage=function(){return this.image_},e.prototype.setImage=function(e){this.image_=e},e.prototype.getStroke=function(){return this.stroke_},e.prototype.setStroke=function(e){this.stroke_=e},e.prototype.getText=function(){return this.text_},e.prototype.setText=function(e){this.text_=e},e.prototype.getZIndex=function(){return this.zIndex_},e.prototype.setGeometry=function(e){"function"==typeof e?this.geometryFunction_=e:"string"==typeof e?this.geometryFunction_=function(t){return t.get(e)}:e?void 0!==e&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=rf,this.geometry_=e},e.prototype.setZIndex=function(e){this.zIndex_=e},e}();var Qd=null;function ef(e,t){if(!Qd){var r=new bd({color:"rgba(255,255,255,0.4)"}),n=new Hd({color:"#3399CC",width:1.25});Qd=[new Jd({image:new $d({fill:r,stroke:n,radius:5}),fill:r,stroke:n})]}return Qd}function tf(){var e={},t=[255,255,255,1],r=[0,153,255,1];return e.Polygon=[new Jd({fill:new bd({color:[255,255,255,.5]})})],e.MultiPolygon=e.Polygon,e.LineString=[new Jd({stroke:new Hd({color:t,width:5})}),new Jd({stroke:new Hd({color:r,width:3})})],e.MultiLineString=e.LineString,e.Circle=e.Polygon.concat(e.LineString),e.Point=[new Jd({image:new $d({radius:6,fill:new bd({color:r}),stroke:new Hd({color:t,width:1.5})}),zIndex:1/0})],e.MultiPoint=e.Point,e.GeometryCollection=e.Polygon.concat(e.LineString,e.Point),e}function rf(e){return e.getGeometry()}const nf=Jd,of="point",af="line";var sf=function(){function e(e){var t=e||{};this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=ko(void 0!==t.scale?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.textBaseline_=t.textBaseline,this.fill_=void 0!==t.fill?t.fill:new bd({color:"#333"}),this.maxAngle_=void 0!==t.maxAngle?t.maxAngle:Math.PI/4,this.placement_=void 0!==t.placement?t.placement:of,this.overflow_=!!t.overflow,this.stroke_=void 0!==t.stroke?t.stroke:null,this.offsetX_=void 0!==t.offsetX?t.offsetX:0,this.offsetY_=void 0!==t.offsetY?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=void 0===t.padding?null:t.padding}return e.prototype.clone=function(){var t=this.getScale();return new e({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})},e.prototype.getOverflow=function(){return this.overflow_},e.prototype.getFont=function(){return this.font_},e.prototype.getMaxAngle=function(){return this.maxAngle_},e.prototype.getPlacement=function(){return this.placement_},e.prototype.getOffsetX=function(){return this.offsetX_},e.prototype.getOffsetY=function(){return this.offsetY_},e.prototype.getFill=function(){return this.fill_},e.prototype.getRotateWithView=function(){return this.rotateWithView_},e.prototype.getRotation=function(){return this.rotation_},e.prototype.getScale=function(){return this.scale_},e.prototype.getScaleArray=function(){return this.scaleArray_},e.prototype.getStroke=function(){return this.stroke_},e.prototype.getText=function(){return this.text_},e.prototype.getTextAlign=function(){return this.textAlign_},e.prototype.getJustify=function(){return this.justify_},e.prototype.getTextBaseline=function(){return this.textBaseline_},e.prototype.getBackgroundFill=function(){return this.backgroundFill_},e.prototype.getBackgroundStroke=function(){return this.backgroundStroke_},e.prototype.getPadding=function(){return this.padding_},e.prototype.setOverflow=function(e){this.overflow_=e},e.prototype.setFont=function(e){this.font_=e},e.prototype.setMaxAngle=function(e){this.maxAngle_=e},e.prototype.setOffsetX=function(e){this.offsetX_=e},e.prototype.setOffsetY=function(e){this.offsetY_=e},e.prototype.setPlacement=function(e){this.placement_=e},e.prototype.setRotateWithView=function(e){this.rotateWithView_=e},e.prototype.setFill=function(e){this.fill_=e},e.prototype.setRotation=function(e){this.rotation_=e},e.prototype.setScale=function(e){this.scale_=e,this.scaleArray_=ko(void 0!==e?e:1)},e.prototype.setStroke=function(e){this.stroke_=e},e.prototype.setText=function(e){this.text_=e},e.prototype.setTextAlign=function(e){this.textAlign_=e},e.prototype.setJustify=function(e){this.justify_=e},e.prototype.setTextBaseline=function(e){this.textBaseline_=e},e.prototype.setBackgroundFill=function(e){this.backgroundFill_=e},e.prototype.setBackgroundStroke=function(e){this.backgroundStroke_=e},e.prototype.setPadding=function(e){this.padding_=e},e}();const lf=sf;var cf,uf,pf,hf,df,ff,gf=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),yf=["http://www.google.com/kml/ext/2.2"],mf=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],vf={fraction:Cd.FRACTION,pixels:Cd.PIXELS,insetPixels:Cd.PIXELS},_f=Ml(mf,{ExtendedData:yg,Region:mg,MultiGeometry:Al(sg,"geometry"),LineString:Al(ig,"geometry"),LinearRing:Al(og,"geometry"),Point:Al(lg,"geometry"),Polygon:Al(ug,"geometry"),Style:Al(hg),StyleMap:function(e,t){var r=Hf.call(this,e,t);if(!r)return;var n=t[t.length-1];Array.isArray(r)?n.Style=r:"string"==typeof r?n.styleUrl=r:I(!1,38)},address:Al(oc),description:Al(oc),name:Al(oc),open:Al(Jl),phoneNumber:Al(oc),styleUrl:Al(Gf),visibility:Al(Jl)},Ml(yf,{MultiTrack:Al((function(e,t){var r=Nl([],$f,e,t);if(!r)return;return new el(r)}),"geometry"),Track:Al(Qf,"geometry")})),wf=Ml(mf,{ExtendedData:yg,Region:mg,Link:function(e,t){Dl(Sf,e,t)},address:Al(oc),description:Al(oc),name:Al(oc),open:Al(Jl),phoneNumber:Al(oc),visibility:Al(Jl)}),Sf=Ml(mf,{href:Al(Bf)}),Ef=Ml(mf,{LatLonAltBox:function(e,t){var r=Nl({},wg,e,t);if(!r)return;var n=t[t.length-1],i=[parseFloat(r.west),parseFloat(r.south),parseFloat(r.east),parseFloat(r.north)];n.extent=i,n.altitudeMode=r.altitudeMode,n.minAltitude=parseFloat(r.minAltitude),n.maxAltitude=parseFloat(r.maxAltitude)},Lod:function(e,t){var r=Nl({},Sg,e,t);if(!r)return;var n=t[t.length-1];n.minLodPixels=parseFloat(r.minLodPixels),n.maxLodPixels=parseFloat(r.maxLodPixels),n.minFadeExtent=parseFloat(r.minFadeExtent),n.maxFadeExtent=parseFloat(r.maxFadeExtent)}}),bf=Ml(mf,["Document","Placemark"]),Cf=Ml(mf,{Document:xl((function(e,t,r){kl({node:e},Tg,Ag,t,r,void 0,this)})),Placemark:xl($g)}),Lf=null;var Tf,Af=null;var xf,Pf=null;var Of=null;var If=null;var Rf,Mf=null;function Df(e){return 32/Math.min(e[0],e[1])}function Nf(e){return e}var Zf=function(e){function t(t){var r=e.call(this)||this,n=t||{};return Mf||(Lf=new bd({color:cf=[255,255,255,1]}),ff="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",Af=new Wd({anchor:uf=[20,2],anchorOrigin:Ld.BOTTOM_LEFT,anchorXUnits:pf=Cd.PIXELS,anchorYUnits:hf=Cd.PIXELS,crossOrigin:"anonymous",rotation:0,scale:Df(df=[64,64]),size:df,src:ff}),Tf="NO_IMAGE",Pf=new Hd({color:cf,width:1}),xf=new Hd({color:[51,51,51,1],width:2}),Of=new lf({font:"bold 16px Helvetica",fill:Lf,stroke:xf,scale:.8}),If=new nf({fill:Lf,image:Af,text:Of,stroke:Pf,zIndex:0}),Mf=[If]),r.dataProjection=$n("EPSG:4326"),r.defaultStyle_=n.defaultStyle?n.defaultStyle:Mf,r.extractStyles_=void 0===n.extractStyles||n.extractStyles,r.writeStyles_=void 0===n.writeStyles||n.writeStyles,r.sharedStyles_={},r.showPointNames_=void 0===n.showPointNames||n.showPointNames,r.crossOrigin_=void 0!==n.crossOrigin?n.crossOrigin:"anonymous",r.iconUrlFunction_=n.iconUrlFunction?n.iconUrlFunction:Nf,r.supportedMediaTypes=["application/vnd.google-earth.kml+xml"],r}return gf(t,e),t.prototype.readDocumentOrFolder_=function(e,t){var r=Nl([],Ml(mf,{Document:bl(this.readDocumentOrFolder_,this),Folder:bl(this.readDocumentOrFolder_,this),Placemark:Cl(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),e,t,this);return r||void 0},t.prototype.readPlacemark_=function(e,t){var r=Nl({geometry:null},_f,e,t,this);if(r){var n=new js,i=e.getAttribute("id");null!==i&&n.setId(i);var o=t[0],a=r.geometry;if(a&&gl(a,!1,o),n.setGeometry(a),delete r.geometry,this.extractStyles_){var s=function(e,t,r,n,i){return function(o,a){var s=i,l="",c=[];if(s){var u=o.getGeometry();if(u)if(u instanceof pl)c=u.getGeometriesArrayRecursive().filter((function(e){var t=e.getType();return"Point"===t||"MultiPoint"===t})),s=c.length>0;else{var p=u.getType();s="Point"===p||"MultiPoint"===p}}s&&(l=o.get("name"),(s=s&&!!l)&&l.search(/&[^&]+;/)>-1&&(Rf||(Rf=document.createElement("textarea")),Rf.innerHTML=l,l=Rf.value));var h=r;if(e?h=e:t&&(h=kf(t,r,n)),s){var d=function(e,t){var r=[0,0],n="start",i=e.getImage();if(i){var o=i.getSize();if(o&&2==o.length){var a=i.getScaleArray(),s=i.getAnchor();r[0]=a[0]*(o[0]-s[0]),r[1]=a[1]*(o[1]/2-s[1]),n="left"}}var l=e.getText();l?((l=l.clone()).setFont(l.getFont()||Of.getFont()),l.setScale(l.getScale()||Of.getScale()),l.setFill(l.getFill()||Of.getFill()),l.setStroke(l.getStroke()||xf)):l=Of.clone();return l.setText(t),l.setOffsetX(r[0]),l.setOffsetY(r[1]),l.setTextAlign(n),new nf({image:i,text:l})}(h[0],l);return c.length>0?(d.setGeometry(new pl(c)),[d,new nf({geometry:h[0].getGeometry(),image:null,fill:h[0].getFill(),stroke:h[0].getStroke(),text:null})].concat(h.slice(1))):d}return h}}(r.Style,r.styleUrl,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);n.setStyle(s)}return delete r.Style,n.setProperties(r,!0),n}},t.prototype.readSharedStyle_=function(e,t){var r=e.getAttribute("id");if(null!==r){var n=hg.call(this,e,t);if(n){var i=void 0,o=e.baseURI;if(o&&"about:blank"!=o||(o=window.location.href),o)i=new URL("#"+r,o).href;else i="#"+r;this.sharedStyles_[i]=n}}},t.prototype.readSharedStyleMap_=function(e,t){var r=e.getAttribute("id");if(null!==r){var n=Hf.call(this,e,t);if(n){var i,o=e.baseURI;if(o&&"about:blank"!=o||(o=window.location.href),o)i=new URL("#"+r,o).href;else i="#"+r;this.sharedStyles_[i]=n}}},t.prototype.readFeatureFromNode=function(e,t){if(!c(mf,e.namespaceURI))return null;var r=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return r||null},t.prototype.readFeaturesFromNode=function(e,t){if(!c(mf,e.namespaceURI))return[];var r,n=e.localName;if("Document"==n||"Folder"==n)return(r=this.readDocumentOrFolder_(e,[this.getReadOptions(e,t)]))||[];if("Placemark"==n){var i=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return i?[i]:[]}if("kml"==n){r=[];for(var o=e.firstElementChild;o;o=o.nextElementSibling){var a=this.readFeaturesFromNode(o,t);a&&h(r,a)}return r}return[]},t.prototype.readName=function(e){if(e){if("string"==typeof e){var t=El(e);return this.readNameFromDocument(t)}return Sl(e)?this.readNameFromDocument(e):this.readNameFromNode(e)}},t.prototype.readNameFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE){var r=this.readNameFromNode(t);if(r)return r}},t.prototype.readNameFromNode=function(e){for(var t=e.firstElementChild;t;t=t.nextElementSibling)if(c(mf,t.namespaceURI)&&"name"==t.localName)return oc(t);for(t=e.firstElementChild;t;t=t.nextElementSibling){var r=t.localName;if(c(mf,t.namespaceURI)&&("Document"==r||"Folder"==r||"Placemark"==r||"kml"==r)){var n=this.readNameFromNode(t);if(n)return n}}},t.prototype.readNetworkLinks=function(e){var t=[];if("string"==typeof e){var r=El(e);h(t,this.readNetworkLinksFromDocument(r))}else Sl(e)?h(t,this.readNetworkLinksFromDocument(e)):h(t,this.readNetworkLinksFromNode(e));return t},t.prototype.readNetworkLinksFromDocument=function(e){for(var t=[],r=e.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&h(t,this.readNetworkLinksFromNode(r));return t},t.prototype.readNetworkLinksFromNode=function(e){for(var t=[],r=e.firstElementChild;r;r=r.nextElementSibling)if(c(mf,r.namespaceURI)&&"NetworkLink"==r.localName){var n=Nl({},wf,r,[]);t.push(n)}for(r=e.firstElementChild;r;r=r.nextElementSibling){var i=r.localName;!c(mf,r.namespaceURI)||"Document"!=i&&"Folder"!=i&&"kml"!=i||h(t,this.readNetworkLinksFromNode(r))}return t},t.prototype.readRegion=function(e){var t=[];if("string"==typeof e){var r=El(e);h(t,this.readRegionFromDocument(r))}else Sl(e)?h(t,this.readRegionFromDocument(e)):h(t,this.readRegionFromNode(e));return t},t.prototype.readRegionFromDocument=function(e){for(var t=[],r=e.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&h(t,this.readRegionFromNode(r));return t},t.prototype.readRegionFromNode=function(e){for(var t=[],r=e.firstElementChild;r;r=r.nextElementSibling)if(c(mf,r.namespaceURI)&&"Region"==r.localName){var n=Nl({},Ef,r,[]);t.push(n)}for(r=e.firstElementChild;r;r=r.nextElementSibling){var i=r.localName;!c(mf,r.namespaceURI)||"Document"!=i&&"Folder"!=i&&"kml"!=i||h(t,this.readRegionFromNode(r))}return t},t.prototype.writeFeaturesNode=function(e,t){t=this.adaptOptions(t);var r=vl(mf[4],"kml"),n="http://www.w3.org/2000/xmlns/";r.setAttributeNS(n,"xmlns:gx",yf[0]),r.setAttributeNS(n,"xmlns:xsi",ml),r.setAttributeNS(ml,"xsi:schemaLocation","http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd");var i={node:r},o={};e.length>1?o.Document=e:1==e.length&&(o.Placemark=e[0]);var a=bf[r.namespaceURI],s=Rl(o,a);return kl(i,Cf,Il,s,[t],a,this),r},t}(jl);function kf(e,t,r){return Array.isArray(e)?e:"string"==typeof e?kf(r[e],t,r):t}function Ff(e){var t=_l(e,!1),r=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(t);if(r){var n=r[1];return[parseInt(n.substr(6,2),16),parseInt(n.substr(4,2),16),parseInt(n.substr(2,2),16),parseInt(n.substr(0,2),16)/255]}}function Uf(e){var t=_l(e,!1),r=[];t=t.replace(/\s*,\s*/g,",");for(var n,i=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;n=i.exec(t);){var o=parseFloat(n[1]),a=parseFloat(n[2]),s=n[3]?parseFloat(n[3]):0;r.push(o,a,s),t=t.substr(n[0].length)}if(""===t)return r}function Bf(e){var t=_l(e,!1).trim(),r=e.baseURI;return r&&"about:blank"!=r||(r=window.location.href),r?new URL(t,r).href:t}function Gf(e){var t=_l(e,!1).trim().replace(/^(?!.*#)/,"#"),r=e.baseURI;return r&&"about:blank"!=r||(r=window.location.href),r?new URL(t,r).href:t}function jf(e){return tc(e)}var Wf=Ml(mf,{Pair:function(e,t){var r=Nl({},vg,e,t,this);if(!r)return;var n=r.key;if(n&&"normal"==n){var i=r.styleUrl;i&&(t[t.length-1]=i);var o=r.Style;o&&(t[t.length-1]=o)}}});function Hf(e,t){return Nl(void 0,Wf,e,t,this)}var qf=Ml(mf,{Icon:Al((function(e,t){var r=Nl({},eg,e,t);return r||null})),color:Al(Ff),heading:Al(tc),hotSpot:Al((function(e){var t,r=e.getAttribute("xunits"),n=e.getAttribute("yunits");return t="insetPixels"!==r?"insetPixels"!==n?Ld.BOTTOM_LEFT:Ld.TOP_LEFT:"insetPixels"!==n?Ld.BOTTOM_RIGHT:Ld.TOP_RIGHT,{x:parseFloat(e.getAttribute("x")),xunits:vf[r],y:parseFloat(e.getAttribute("y")),yunits:vf[n],origin:t}})),scale:Al(jf)});var Vf=Ml(mf,{color:Al(Ff),scale:Al(jf)});var zf=Ml(mf,{color:Al(Ff),width:Al(tc)});var Yf=Ml(mf,{color:Al(Ff),fill:Al(Jl),outline:Al(Jl)});var Kf=Ml(mf,{coordinates:Ll(Uf)});function Xf(e,t){return Nl(null,Kf,e,t)}var $f=Ml(yf,{Track:Cl(Qf)});var Jf=Ml(mf,{when:function(e,t){var r=t[t.length-1].whens,n=_l(e,!1),i=Date.parse(n);r.push(isNaN(i)?0:i)}},Ml(yf,{coord:function(e,t){var r=t[t.length-1].coordinates,n=_l(e,!1),i=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(n);if(i){var o=parseFloat(i[1]),a=parseFloat(i[2]),s=parseFloat(i[3]);r.push([o,a,s])}else r.push([])}}));function Qf(e,t){var r=Nl({coordinates:[],whens:[]},Jf,e,t);if(r){for(var n=[],i=r.coordinates,o=r.whens,a=0,s=Math.min(i.length,o.length);a<s;++a)3==i[a].length&&n.push(i[a][0],i[a][1],i[a][2],o[a]);return new $s(n,Pi.XYZM)}}var eg=Ml(mf,{href:Al(Bf)},Ml(yf,{x:Al(tc),y:Al(tc),w:Al(tc),h:Al(tc)}));var tg=Ml(mf,{coordinates:Ll(Uf)});function rg(e,t){return Nl(null,tg,e,t)}var ng=Ml(mf,{extrude:Al(Jl),tessellate:Al(Jl),altitudeMode:Al(oc)});function ig(e,t){var r=Nl({},ng,e,t),n=rg(e,t);if(n){var i=new $s(n,Pi.XYZ);return i.setProperties(r,!0),i}}function og(e,t){var r=Nl({},ng,e,t),n=rg(e,t);if(n){var i=new Ao(n,Pi.XYZ,[n.length]);return i.setProperties(r,!0),i}}var ag=Ml(mf,{LineString:Cl(ig),LinearRing:Cl(og),MultiGeometry:Cl(sg),Point:Cl(lg),Polygon:Cl(ug)});function sg(e,t){var r,n=Nl([],ag,e,t);if(!n)return null;if(0===n.length)return new pl(n);for(var i=!0,o=n[0].getType(),a=1,s=n.length;a<s;++a)if(n[a].getType()!=o){i=!1;break}if(i){var l=void 0,c=void 0;if("Point"==o){var u=n[0];l=u.getLayout(),c=u.getFlatCoordinates();for(a=1,s=n.length;a<s;++a)h(c,n[a].getFlatCoordinates());dg(r=new qs(c,l),n)}else"LineString"==o?dg(r=new el(n),n):"Polygon"==o?dg(r=new nl(n),n):"GeometryCollection"==o?r=new pl(n):I(!1,37)}else r=new pl(n);return r}function lg(e,t){var r=Nl({},ng,e,t),n=rg(e,t);if(n){var i=new uo(n,Pi.XYZ);return i.setProperties(r,!0),i}}var cg=Ml(mf,{innerBoundaryIs:function(e,t){var r=Nl([],Eg,e,t);if(r.length>0){var n=t[t.length-1];n.push.apply(n,r)}},outerBoundaryIs:function(e,t){var r=Nl(void 0,bg,e,t);if(r){t[t.length-1][0]=r}}});function ug(e,t){var r=Nl({},ng,e,t),n=Nl([null],cg,e,t);if(n&&n[0]){for(var i=n[0],o=[i.length],a=1,s=n.length;a<s;++a)h(i,n[a]),o.push(i.length);var l=new Ao(i,Pi.XYZ,o);return l.setProperties(r,!0),l}}var pg=Ml(mf,{IconStyle:function(e,t){var r=Nl({},qf,e,t);if(r){var n,i,o,a,s=t[t.length-1],l="Icon"in r?r.Icon:{},c=!("Icon"in r)||Object.keys(l).length>0,u=l.href;u?n=u:c&&(n=ff);var p,h=Ld.BOTTOM_LEFT,d=r.hotSpot;d?(i=[d.x,d.y],o=d.xunits,a=d.yunits,h=d.origin):/^http:\/\/maps\.(?:google|gstatic)\.com\//.test(n)&&(/pushpin/.test(n)?(i=uf,o=pf,a=hf):/arrow-reverse/.test(n)?(i=[54,42],o=pf,a=hf):/paddle/.test(n)&&(i=[32,1],o=pf,a=hf));var f,g=l.x,y=l.y;void 0!==g&&void 0!==y&&(p=[g,y]);var m,v=l.w,_=l.h;void 0!==v&&void 0!==_&&(f=[v,_]);var w=r.heading;void 0!==w&&(m=Ze(w));var S=r.scale,E=r.color;if(c){n==ff&&(f=df);var b=new Wd({anchor:i,anchorOrigin:h,anchorXUnits:o,anchorYUnits:a,crossOrigin:this.crossOrigin_,offset:p,offsetOrigin:Ld.BOTTOM_LEFT,rotation:m,scale:S,size:f,src:this.iconUrlFunction_(n),color:E}),C=b.getScaleArray()[0],L=b.getSize();if(null===L){var T=b.getImageState();if(T===Td||T===Ad){var A=function(){var e=b.getImageState();if(e!==Td&&e!==Ad){var t=b.getSize();if(t&&2==t.length){var r=Df(t);b.setScale(C*r)}b.unlistenImageChange(A)}};b.listenImageChange(A),T===Td&&b.load()}}else if(2==L.length){var x=Df(L);b.setScale(C*x)}s.imageStyle=b}else s.imageStyle=Tf}},LabelStyle:function(e,t){var r=Nl({},Vf,e,t);if(r){var n=t[t.length-1],i=new lf({fill:new bd({color:"color"in r?r.color:cf}),scale:r.scale});n.textStyle=i}},LineStyle:function(e,t){var r=Nl({},zf,e,t);if(r){var n=t[t.length-1],i=new Hd({color:"color"in r?r.color:cf,width:"width"in r?r.width:1});n.strokeStyle=i}},PolyStyle:function(e,t){var r=Nl({},Yf,e,t);if(r){var n=t[t.length-1],i=new bd({color:"color"in r?r.color:cf});n.fillStyle=i;var o=r.fill;void 0!==o&&(n.fill=o);var a=r.outline;void 0!==a&&(n.outline=a)}}});function hg(e,t){var r=Nl({},pg,e,t,this);if(!r)return null;var n,i="fillStyle"in r?r.fillStyle:Lf,o=r.fill;void 0===o||o||(i=null),"imageStyle"in r?r.imageStyle!=Tf&&(n=r.imageStyle):n=Af;var a="textStyle"in r?r.textStyle:Of,s="strokeStyle"in r?r.strokeStyle:Pf,l=r.outline;return void 0===l||l?[new nf({fill:i,image:n,stroke:s,text:a,zIndex:void 0})]:[new nf({geometry:function(e){var t=e.getGeometry(),r=t.getType();return"GeometryCollection"===r?new pl(t.getGeometriesArrayRecursive().filter((function(e){var t=e.getType();return"Polygon"!==t&&"MultiPolygon"!==t}))):"Polygon"!==r&&"MultiPolygon"!==r?t:void 0},fill:i,image:n,stroke:s,text:a,zIndex:void 0}),new nf({geometry:function(e){var t=e.getGeometry(),r=t.getType();return"GeometryCollection"===r?new pl(t.getGeometriesArrayRecursive().filter((function(e){var t=e.getType();return"Polygon"===t||"MultiPolygon"===t}))):"Polygon"===r||"MultiPolygon"===r?t:void 0},fill:i,stroke:null,zIndex:void 0})]}function dg(e,t){var r,n,i,o=t.length,a=new Array(t.length),s=new Array(t.length),l=new Array(t.length);r=!1,n=!1,i=!1;for(var c=0;c<o;++c){var u=t[c];a[c]=u.get("extrude"),s[c]=u.get("tessellate"),l[c]=u.get("altitudeMode"),r=r||void 0!==a[c],n=n||void 0!==s[c],i=i||l[c]}r&&e.set("extrude",a),n&&e.set("tessellate",s),i&&e.set("altitudeMode",l)}var fg=Ml(mf,{displayName:Al(oc),value:Al(oc)});var gg=Ml(mf,{Data:function(e,t){var r=e.getAttribute("name");Dl(fg,e,t);var n=t[t.length-1];r&&n.displayName?n[r]={value:n.value,displayName:n.displayName,toString:function(){return n.value}}:null!==r?n[r]=n.value:null!==n.displayName&&(n[n.displayName]=n.value),delete n.value},SchemaData:function(e,t){Dl(_g,e,t)}});function yg(e,t){Dl(gg,e,t)}function mg(e,t){Dl(Ef,e,t)}var vg=Ml(mf,{Style:Al(hg),key:Al(oc),styleUrl:Al(Gf)});var _g=Ml(mf,{SimpleData:function(e,t){var r=e.getAttribute("name");if(null!==r){var n=oc(e);t[t.length-1][r]=n}}});var wg=Ml(mf,{altitudeMode:Al(oc),minAltitude:Al(tc),maxAltitude:Al(tc),north:Al(tc),south:Al(tc),east:Al(tc),west:Al(tc)});var Sg=Ml(mf,{minLodPixels:Al(tc),maxLodPixels:Al(tc),minFadeExtent:Al(tc),maxFadeExtent:Al(tc)});var Eg=Ml(mf,{LinearRing:Cl(Xf)});var bg=Ml(mf,{LinearRing:Ll(Xf)});function Cg(e,t){for(var r=Ye(t),n=[255*(4==r.length?r[3]:1),r[2],r[1],r[0]],i=0;i<4;++i){var o=Math.floor(n[i]).toString(16);n[i]=1==o.length?"0"+o:o}uc(e,n.join(""))}var Lg=Ml(mf,{Data:xl((function(e,t,r){e.setAttribute("name",t.name);var n={node:e},i=t.value;"object"==typeof i?(null!==i&&i.displayName&&kl(n,Lg,Il,[i.displayName],r,["displayName"]),null!==i&&i.value&&kl(n,Lg,Il,[i.value],r,["value"])):kl(n,Lg,Il,[i],r,["value"])})),value:xl((function(e,t){uc(e,t)})),displayName:xl((function(e,t){sc(e,t)}))});var Tg=Ml(mf,{Placemark:xl($g)}),Ag=function(e,t,r){return vl(t[t.length-1].node.namespaceURI,"Placemark")};var xg=Ol("Data");var Pg=Ml(mf,["href"],Ml(yf,["x","y","w","h"])),Og=Ml(mf,{href:xl(uc)},Ml(yf,{x:xl(lc),y:xl(lc),w:xl(lc),h:xl(lc)})),Ig=function(e,t,r){return vl(yf[0],"gx:"+r)};var Rg=Ml(mf,["scale","heading","Icon","color","hotSpot"]),Mg=Ml(mf,{Icon:xl((function(e,t,r){var n={node:e},i=r[r.length-1].node,o=Pg[i.namespaceURI],a=Rl(t,o);kl(n,Og,Il,a,r,o),a=Rl(t,o=Pg[yf[0]]),kl(n,Og,Ig,a,r,o)})),color:xl(Cg),heading:xl(lc),hotSpot:xl((function(e,t){e.setAttribute("x",String(t.x)),e.setAttribute("y",String(t.y)),e.setAttribute("xunits",t.xunits),e.setAttribute("yunits",t.yunits)})),scale:xl(sy)});var Dg=Ml(mf,["color","scale"]),Ng=Ml(mf,{color:xl(Cg),scale:xl(sy)});var Zg=Ml(mf,["color","width"]),kg=Ml(mf,{color:xl(Cg),width:xl(lc)});var Fg={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},Ug=function(e,t,r){if(e)return vl(t[t.length-1].node.namespaceURI,Fg[e.getType()])},Bg=Ol("Point"),Gg=Ol("LineString"),jg=Ol("LinearRing"),Wg=Ol("Polygon"),Hg=Ml(mf,{LineString:xl(ey),Point:xl(ey),Polygon:xl(oy),GeometryCollection:xl(qg)});function qg(e,t,r){var n,i={node:e},o=t.getType(),a=[];"GeometryCollection"===o?(t.getGeometriesArrayRecursive().forEach((function(e){var t=e.getType();"MultiPoint"===t?a=a.concat(e.getPoints()):"MultiLineString"===t?a=a.concat(e.getLineStrings()):"MultiPolygon"===t?a=a.concat(e.getPolygons()):"Point"===t||"LineString"===t||"Polygon"===t?a.push(e):I(!1,39)})),n=Ug):"MultiPoint"===o?(a=t.getPoints(),n=Bg):"MultiLineString"===o?(a=t.getLineStrings(),n=Gg):"MultiPolygon"===o?(a=t.getPolygons(),n=Wg):I(!1,39),kl(i,Hg,n,a,r)}var Vg=Ml(mf,{LinearRing:xl(ey)});function zg(e,t,r){kl({node:e},Vg,jg,[t],r)}var Yg=Ml(mf,{ExtendedData:xl((function(e,t,r){for(var n={node:e},i=t.names,o=t.values,a=i.length,s=0;s<a;s++)kl(n,Lg,xg,[{name:i[s],value:o[s]}],r)})),MultiGeometry:xl(qg),LineString:xl(ey),LinearRing:xl(ey),Point:xl(ey),Polygon:xl(oy),Style:xl((function(e,t,r){var n={node:e},i={};if(t.pointStyles.length){var o=t.pointStyles[0].getText();o&&(i.LabelStyle=o);var a=t.pointStyles[0].getImage();a&&"function"==typeof a.getSrc&&(i.IconStyle=a)}if(t.lineStyles.length){(s=t.lineStyles[0].getStroke())&&(i.LineStyle=s)}if(t.polyStyles.length){var s;(s=t.polyStyles[0].getStroke())&&!i.LineStyle&&(i.LineStyle=s),i.PolyStyle=t.polyStyles[0]}var l=r[r.length-1].node,c=ly[l.namespaceURI],u=Rl(i,c);kl(n,cy,Il,u,r,c)})),address:xl(uc),description:xl(uc),name:xl(uc),open:xl(ac),phoneNumber:xl(uc),styleUrl:xl(uc),visibility:xl(ac)}),Kg=Ml(mf,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),Xg=Ol("ExtendedData");function $g(e,t,r){var n={node:e};t.getId()&&e.setAttribute("id",t.getId());var i=t.getProperties(),o={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};o[t.getGeometryName()]=1;var a=Object.keys(i||{}).sort().filter((function(e){return!o[e]})),s=t.getStyleFunction();if(s){var l=s(t,0);if(l){var c=Array.isArray(l)?l:[l],u=c;if(t.getGeometry()&&(u=c.filter((function(e){var r=e.getGeometryFunction()(t);if(r){var n=r.getType();return"GeometryCollection"===n?r.getGeometriesArrayRecursive().filter((function(e){var t=e.getType();return"Point"===t||"MultiPoint"===t})).length:"Point"===n||"MultiPoint"===n}}))),this.writeStyles_){var p=c,h=c;t.getGeometry()&&(p=c.filter((function(e){var r=e.getGeometryFunction()(t);if(r){var n=r.getType();return"GeometryCollection"===n?r.getGeometriesArrayRecursive().filter((function(e){var t=e.getType();return"LineString"===t||"MultiLineString"===t})).length:"LineString"===n||"MultiLineString"===n}})),h=c.filter((function(e){var r=e.getGeometryFunction()(t);if(r){var n=r.getType();return"GeometryCollection"===n?r.getGeometriesArrayRecursive().filter((function(e){var t=e.getType();return"Polygon"===t||"MultiPolygon"===t})).length:"Polygon"===n||"MultiPolygon"===n}}))),i.Style={pointStyles:u,lineStyles:p,polyStyles:h}}if(u.length&&void 0===i.name){var d=u[0].getText();d&&(i.name=d.getText())}}}var f=r[r.length-1].node,g=Kg[f.namespaceURI],y=Rl(i,g);if(kl(n,Yg,Il,y,r,g),a.length>0){var m=Rl(i,a);kl(n,Yg,Xg,[{names:a,values:m}],r)}var v=r[0],_=t.getGeometry();_&&(_=gl(_,!0,v)),kl(n,Yg,Ug,[_],r)}var Jg=Ml(mf,["extrude","tessellate","altitudeMode","coordinates"]),Qg=Ml(mf,{extrude:xl(ac),tessellate:xl(ac),altitudeMode:xl(uc),coordinates:xl((function(e,t,r){var n,i=r[r.length-1],o=i.layout,a=i.stride;o==Pi.XY||o==Pi.XYM?n=2:o==Pi.XYZ||o==Pi.XYZM?n=3:I(!1,34);var s=t.length,l="";if(s>0){l+=t[0];for(var c=1;c<n;++c)l+=","+t[c];for(var u=a;u<s;u+=a){l+=" "+t[u];for(c=1;c<n;++c)l+=","+t[u+c]}}uc(e,l)}))});function ey(e,t,r){var n=t.getFlatCoordinates(),i={node:e};i.layout=t.getLayout(),i.stride=t.getStride();var o=t.getProperties();o.coordinates=n;var a=r[r.length-1].node,s=Jg[a.namespaceURI],l=Rl(o,s);kl(i,Qg,Il,l,r,s)}var ty=Ml(mf,["color","fill","outline"]),ry=Ml(mf,{outerBoundaryIs:xl(zg),innerBoundaryIs:xl(zg)}),ny=Ol("innerBoundaryIs"),iy=Ol("outerBoundaryIs");function oy(e,t,r){var n=t.getLinearRings(),i=n.shift(),o={node:e};kl(o,ry,ny,n,r),kl(o,ry,iy,[i],r)}var ay=Ml(mf,{color:xl(Cg),fill:xl(ac),outline:xl(ac)});function sy(e,t){lc(e,Math.round(1e6*t)/1e6)}var ly=Ml(mf,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),cy=Ml(mf,{IconStyle:xl((function(e,t,r){var n={node:e},i={},o=t.getSrc(),a=t.getSize(),s=t.getImageSize(),l={href:o};if(a){l.w=a[0],l.h=a[1];var c=t.getAnchor(),u=t.getOrigin();if(u&&s&&0!==u[0]&&u[1]!==a[1]&&(l.x=u[0],l.y=s[1]-(u[1]+a[1])),c&&(c[0]!==a[0]/2||c[1]!==a[1]/2)){var p={x:c[0],xunits:Cd.PIXELS,y:a[1]-c[1],yunits:Cd.PIXELS};i.hotSpot=p}}i.Icon=l;var h=t.getScaleArray()[0],d=a;null===d&&(d=df),2==d.length&&(h/=Df(d)),1!==h&&(i.scale=h);var f=t.getRotation();0!==f&&(i.heading=f);var g=t.getColor();g&&(i.color=g);var y=r[r.length-1].node,m=Rg[y.namespaceURI],v=Rl(i,m);kl(n,Mg,Il,v,r,m)})),LabelStyle:xl((function(e,t,r){var n={node:e},i={},o=t.getFill();o&&(i.color=o.getColor());var a=t.getScale();a&&1!==a&&(i.scale=a);var s=r[r.length-1].node,l=Dg[s.namespaceURI],c=Rl(i,l);kl(n,Ng,Il,c,r,l)})),LineStyle:xl((function(e,t,r){var n={node:e},i={color:t.getColor(),width:Number(t.getWidth())||1},o=r[r.length-1].node,a=Zg[o.namespaceURI],s=Rl(i,a);kl(n,kg,Il,s,r,a)})),PolyStyle:xl((function(e,t,r){var n={node:e},i=t.getFill(),o=t.getStroke(),a={color:i?i.getColor():void 0,fill:!!i&&void 0,outline:!!o&&void 0},s=r[r.length-1].node,l=ty[s.namespaceURI],c=Rl(a,l);kl(n,ay,Il,c,r,l)}))});const uy=Zf,py="Point",hy="LineString",dy="Polygon",fy="MultiPoint",gy="MultiLineString",yy="MultiPolygon",my="GeometryCollection";var vy=["http://www.google.com/kml/ext/2.2"],_y=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"];const wy=function(e){for(var t=[],r=[],n=Math.pow(2,e.length),i=0;i<n;i++){r=[];for(var o=0;o<e.length;o++)i&Math.pow(2,o)&&-1==r.indexOf(e[o])&&r.push(e[o]);r.length>0&&-1==t.indexOf(r.join(" "))&&t.push(r.join(" "))}return t}(_y.slice().slice(1));!function(e,t){if(e&&e.length>0)for(var r=0;r<t.length;r++){var n=e.indexOf(t[r]);n>-1&&e.splice(n,1)}}(wy,_y),_y=_y.concat(wy);var Sy,Ey,by,Cy,Ly,Ty,Ay={fraction:Cd.FRACTION,pixels:Cd.PIXELS,insetPixels:Cd.PIXELS},xy=Ml(_y,{ExtendedData:Tm,Region:Am,MultiGeometry:Al(mm,"geometry"),LineString:Al(fm,"geometry"),LinearRing:Al(gm,"geometry"),Point:Al(vm,"geometry"),Polygon:Al(wm,"geometry"),Style:Al(Em),StyleMap:function(e,t){var r=Qy.call(this,e,t);if(!r)return;var n=t[t.length-1];Array.isArray(r)?n.Style=r:"string"==typeof r?n.styleUrl=r:I(!1,38)},address:Al(oc),description:Al(oc),name:Al(oc),open:Al(Jl),phoneNumber:Al(oc),styleUrl:Al(Xy),visibility:Al(Jl)},Ml(vy,{MultiTrack:Al((function(e,t){var r=Nl([],sm,e,t);if(!r)return;return new el(r)}),"geometry"),Track:Al(cm,"geometry")})),Py=(Ml(_y,{ExtendedData:Tm,Region:Am,Link:function(e,t){Dl(Py,e,t)},address:Al(oc),description:Al(oc),name:Al(oc),open:Al(Jl),phoneNumber:Al(oc),visibility:Al(Jl)}),Ml(_y,{href:Al(Ky)})),Oy=Ml(_y,{LatLonAltBox:function(e,t){var r=Nl({},Om,e,t);if(!r)return;var n=t[t.length-1],i=[parseFloat(r.west),parseFloat(r.south),parseFloat(r.east),parseFloat(r.north)];n.extent=i,n.altitudeMode=r.altitudeMode,n.minAltitude=parseFloat(r.minAltitude),n.maxAltitude=parseFloat(r.maxAltitude)},Lod:function(e,t){var r=Nl({},Im,e,t);if(!r)return;var n=t[t.length-1];n.minLodPixels=parseFloat(r.minLodPixels),n.maxLodPixels=parseFloat(r.maxLodPixels),n.minFadeExtent=parseFloat(r.minFadeExtent),n.maxFadeExtent=parseFloat(r.maxFadeExtent)}}),Iy=Ml(_y,["Document","Placemark"]),Ry=Ml(_y,{Document:xl(Um),Placemark:xl(cv)}),My=null;var Dy,Ny=null;var Zy,ky=null;var Fy=null;var Uy=null;var By=null;const Gy=function(e,t){var r;return e?(r=(r=Ye(e)).slice(),void 0!==t&&(r[3]=t)):r=[0,0,0,1],r};function jy(e){return 32/Math.min(e[0],e[1])}function Wy(){Sy=[255,255,255,1],My=new bd({color:Gy(TC.Cfg.styles.polygon.fillColor,TC.Cfg.styles.polygon.fillOpacity)}),Ty="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",Ny=new Wd({anchor:Ey=[20,2],anchorOrigin:Ld.BOTTOM_LEFT,anchorXUnits:by=Cd.PIXELS,anchorYUnits:Cy=Cd.PIXELS,crossOrigin:"anonymous",rotation:0,scale:jy(Ly=[64,64]),size:Ly,src:Ty}),Dy="NO_IMAGE",ky=new Hd({color:Sy,width:1}),Zy=new Hd({color:Gy(TC.Cfg.styles.label.strokeColor,1),width:TC.Cfg.styles.label.strokeWidth||1}),Fy=new lf({font:"bold 16px Helvetica",fill:new bd({color:Gy(TC.Cfg.styles.label.fillColor,1)}),stroke:Zy,scale:.8}),Uy=new nf({fill:My,image:Ny,text:Fy,stroke:ky,zIndex:0}),By=[Uy]}var Hy;class qy extends uy{constructor(e){super(),By||Wy()}}function Vy(e,t,r){return Array.isArray(e)?e:"string"==typeof e?Vy(r[e],t,r):t}function zy(e){var t=_l(e,!1),r=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(t);if(r){var n=r[1];return[parseInt(n.substr(6,2),16),parseInt(n.substr(4,2),16),parseInt(n.substr(2,2),16),parseInt(n.substr(0,2),16)/255]}}function Yy(e){var t=_l(e,!1),r=[];t=t.replace(/\s*,\s*/g,",");for(var n,i=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;n=i.exec(t);){var o=parseFloat(n[1]),a=parseFloat(n[2]),s=n[3]?parseFloat(n[3]):0;r.push(o,a,s),t=t.substr(n[0].length)}if(""===t)return r}function Ky(e){var t=_l(e,!1).trim(),r=e.baseURI;return r&&"about:blank"!=r||(r=window.location.href),r?("https:"===location.protocol&&0===r.indexOf("http://")&&(r=r.substr(5)),new URL(t,r).href):t}function Xy(e){var t=_l(e,!1).trim().replace(/^(?!.*#)/,"#"),r=e.baseURI;return r&&"about:blank"!=r||(r=window.location.href),r?new URL(t,r).href:t}function $y(e){return tc(e)}qy.prototype.readDocumentOrFolder_=function(e,t){var r=Nl([],Ml(_y,{Document:bl(this.readDocumentOrFolder_,this),Folder:bl(this.readDocumentOrFolder_,this),Placemark:Cl(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),e,t,this);if(r){const t=e.getElementsByTagName("name")[0];let n=t&&(t.innerHTML||t.textContent);return r.forEach((e=>{Array.isArray(e._folders)||(e._folders=[]),n&&e._folders.unshift(n)})),r}},qy.prototype.readPlacemark_=function(e,t){var r=Nl({geometry:null},xy,e,t,this);if(r){var n=new js,i=e.getAttribute("id");null!==i&&n.setId(i);var o=t[0],a=r.geometry;if(a&&gl(a,!1,o),n.setGeometry(a),delete r.geometry,this.extractStyles_){var s=function(e,t,r,n,i){return function(o,a){var s=i,l="",c=[];if(s){var u=o.getGeometry();if(u){var p=u.getType();p===my?(c=u.getGeometriesArrayRecursive().filter((function(e){var t=e.getType();return t===py||t===fy})),s=c.length>0):s=p===py||p===fy}}s&&(l=o.get("name"),(s=s&&!!l)&&l.search(/&[^&]+;/)>-1&&(Hy||(Hy=document.createElement("textarea")),Hy.innerHTML=l,l=Hy.value));var h=r;if(e?h=e:t&&(h=Vy(t,r,n)),s){var d=function(e,t){Fy||Wy();var r=[0,0],n="start",i=e.getImage();if(i){var o=i.getSize();if(o&&2==o.length){var a=i.getScaleArray(),s=i.getAnchor();r[0]=a[0]*(o[0]-s[0]),r[1]=a[1]*(o[1]/2-s[1]),n="left"}}var l=e.getText();l?((l=l.clone()).setFont(l.getFont()||Fy.getFont()),l.setScale(l.getScale()||Fy.getScale()),l.setFill(l.getFill()||Fy.getFill()),l.setStroke(l.getStroke()||Zy)):l=Fy.clone();l.setText(t),l.setOffsetX(r[0]),l.setOffsetY(r[1]),l.setTextAlign(n);var c=new nf({image:i,text:l});e._balloon&&(c._balloon=e._balloon);return c}(h[0],l);return c.length>0?(d.setGeometry(new pl(c)),[d,new nf({geometry:h[0].getGeometry(),image:null,fill:h[0].getFill(),stroke:h[0].getStroke(),text:null})].concat(h.slice(1))):d}return h}}(r.Style,r.styleUrl,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);n.setStyle(s)}return delete r.Style,delete r.styleUrl,n.setProperties(r,!0),n}},qy.prototype.readSharedStyle_=function(e,t){var r=e.getAttribute("id");if(null!==r){var n=Em.call(this,e,t);if(n){var i=void 0,o=e.baseURI;if(o&&"about:blank"!=o||(o=window.location.href),o)i=new URL("#"+r,o).href;else i="#"+r;this.sharedStyles_[i]=n}}},qy.prototype.readFeaturesFromNode=function(e,t){if(!c(_y,e.namespaceURI))return[];var r,n=e.localName;if("Document"==n||"Folder"==n)return(r=this.readDocumentOrFolder_(e,[this.getReadOptions(e,t)]))||[];if("Placemark"==n){var i=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return i?[i]:[]}if("kml"==n){r=[];for(var o=e.firstElementChild;o;o=o.nextElementSibling){var a=this.readFeaturesFromNode(o,t);a&&h(r,a)}return r.forEach((function(e){e.getId()||e.setId(TC.getUID())})),r}return[]},qy.prototype.writeFeaturesNode=function(e,t){t=this.adaptOptions(t);var r=vl(_y[4],"kml"),n="http://www.w3.org/2000/xmlns/";r.setAttributeNS(n,"xmlns:gx",vy[0]),r.setAttributeNS(n,"xmlns:xsi",ml),r.setAttributeNS(ml,"xsi:schemaLocation","http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd");var i={node:r},o={};const a=[];let s=[];const l=function(e,t,r){if(r>=t._folders.length)e.push(t);else{let n=e.find((e=>e._name===t._folders[r]));n||(n=[],n._name=t._folders[r],e.push(n)),l(n,t,r+1)}};e.forEach((function(e){e._folders?l(s,e,0):a.push(e)})),1===s.length&&(s=s[0]);const c=s._name;Array.isArray(s)||(s=[s]),s=s.concat(a),s._name=c,o.Document=s;var u=Iy[r.namespaceURI],p=Rl(o,u);return kl(i,Ry,Il,p,[t],u,this),r};var Jy=Ml(_y,{Pair:function(e,t){var r=Nl({},xm,e,t,this);if(!r)return;var n=r.key;if(n&&"normal"==n){var i=r.styleUrl;i&&(t[t.length-1]=i);var o=r.Style;o&&(t[t.length-1]=o)}}});function Qy(e,t){return Nl(void 0,Jy,e,t,this)}var em=Ml(_y,{Icon:Al((function(e,t){var r=Nl({},um,e,t);return r||null})),color:Al(zy),heading:Al(tc),hotSpot:Al((function(e){var t,r=e.getAttribute("xunits"),n=e.getAttribute("yunits");return t="insetPixels"!==r?"insetPixels"!==n?Ld.BOTTOM_LEFT:Ld.TOP_LEFT:"insetPixels"!==n?Ld.BOTTOM_RIGHT:Ld.TOP_RIGHT,{x:parseFloat(e.getAttribute("x")),xunits:Ay[r],y:parseFloat(e.getAttribute("y")),yunits:Ay[n],origin:t}})),scale:Al($y)});const tm=Ml(_y,{text:Al((function(e,t){return ol.asserts.assert(e.nodeType==Node.ELEMENT_NODE),ol.asserts.assert("text"==e.localName),ol.format.xsd.readString(e).trim()}))});var rm=Ml(_y,{color:Al(zy),scale:Al($y)});var nm=Ml(_y,{color:Al(zy),width:Al(tc)});var im=Ml(_y,{color:Al(zy),fill:Al(Jl),outline:Al(Jl)});var om=Ml(_y,{coordinates:Ll(Yy)});function am(e,t){return Nl(null,om,e,t)}var sm=Ml(vy,{Track:Cl(cm)});var lm=Ml(_y,{when:function(e,t){var r=t[t.length-1].whens,n=_l(e,!1),i=Date.parse(n);r.push(isNaN(i)?0:i)}},Ml(vy,{coord:function(e,t){var r=t[t.length-1].coordinates,n=_l(e,!1),i=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(n);if(i){var o=parseFloat(i[1]),a=parseFloat(i[2]),s=parseFloat(i[3]);r.push([o,a,s])}else r.push([])}}));function cm(e,t){var r=Nl({coordinates:[],whens:[]},lm,e,t);if(r){for(var n=[],i=r.coordinates,o=r.whens,a=0,s=Math.min(i.length,o.length);a<s;++a)3==i[a].length&&n.push(i[a][0],i[a][1],i[a][2],o[a]);return new $s(n,Pi.XYZM)}}var um=Ml(_y,{href:Al(Ky)},Ml(vy,{x:Al(tc),y:Al(tc),w:Al(tc),h:Al(tc)}));var pm=Ml(_y,{coordinates:Ll(Yy)});function hm(e,t){return Nl(null,pm,e,t)}var dm=Ml(_y,{extrude:Al(Jl),tessellate:Al(Jl),altitudeMode:Al(oc)});function fm(e,t){var r=Nl({},dm,e,t),n=hm(e,t);if(n){var i=new $s(n,Pi.XYZ);return i.setProperties(r,!0),i}}function gm(e,t){var r=Nl({},dm,e,t),n=hm(e,t);if(n){var i=new Ao(n,Pi.XYZ,[n.length]);return i.setProperties(r,!0),i}}var ym=Ml(_y,{LineString:Cl(fm),LinearRing:Cl(gm),MultiGeometry:Cl(mm),Point:Cl(vm),Polygon:Cl(wm)});function mm(e,t){var r,n=Nl([],ym,e,t);if(!n)return null;if(0===n.length)return new pl(n);for(var i=!0,o=n[0].getType(),a=1,s=n.length;a<s;++a)if(n[a].getType()!=o){i=!1;break}if(i){var l=void 0,c=void 0;if(o==py){var u=n[0];l=u.getLayout(),c=u.getFlatCoordinates();for(a=1,s=n.length;a<s;++a)h(c,n[a].getFlatCoordinates());bm(r=new qs(c,l),n)}else o==hy?bm(r=new el(n),n):o==dy?bm(r=new nl(n),n):o==my?r=new pl(n):I(!1,37)}else r=new pl(n);return r}function vm(e,t){var r=Nl({},dm,e,t),n=hm(e,t);if(n){var i=new uo(n,Pi.XYZ);return i.setProperties(r,!0),i}}var _m=Ml(_y,{innerBoundaryIs:function(e,t){var r=Nl([],Rm,e,t);if(r.length>0){var n=t[t.length-1];n.push.apply(n,r)}},outerBoundaryIs:function(e,t){var r=Nl(void 0,Mm,e,t);if(r){t[t.length-1][0]=r}}});function wm(e,t){var r=Nl({},dm,e,t),n=Nl([null],_m,e,t);if(n&&n[0]){for(var i=n[0],o=[i.length],a=1,s=n.length;a<s;++a)h(i,n[a]),o.push(i.length);var l=new Ao(i,Pi.XYZ,o);return l.setProperties(r,!0),l}}var Sm=Ml(_y,{IconStyle:function(e,t){var r=Nl({},em,e,t);if(r){var n,i,o,a,s=t[t.length-1],l="Icon"in r?r.Icon:{},c=!("Icon"in r)||Object.keys(l).length>0,u=l.href;u?n=u:c&&(n=Ty);var p,h=Ld.BOTTOM_LEFT,d=r.hotSpot;d?(i=[d.x,d.y],o=d.xunits,a=d.yunits,h=d.origin):/^http:\/\/maps\.(?:google|gstatic)\.com\//.test(n)&&(/pushpin/.test(n)?(i=Ey,o=by,a=Cy):/arrow-reverse/.test(n)?(i=[54,42],o=by,a=Cy):/paddle/.test(n)&&(i=[32,1],o=by,a=Cy)),c&&/Firefox/.test(navigator.userAgent)&&"https:"===location.protocol&&n.startsWith("http:")&&(n=n.replace("http:","https:"));var f,g=l.x,y=l.y;void 0!==g&&void 0!==y&&(p=[g,y]);var m,v=l.w,_=l.h;void 0!==v&&void 0!==_&&(f=[v,_]);var w=r.heading;void 0!==w&&(m=Ze(w));var S=r.scale,E=r.color;if(c){n==Ty&&(f=Ly);var b=new Wd({anchor:i,anchorOrigin:h,anchorXUnits:o,anchorYUnits:a,crossOrigin:this.crossOrigin_,offset:p,offsetOrigin:Ld.BOTTOM_LEFT,rotation:m,scale:S,size:f,src:this.iconUrlFunction_(n),color:E}),C=b.getScaleArray()[0],L=b.getSize();if(null===L){var T=b.getImageState();if(T===Td||T===Ad){var A=function(){var e=b.getImageState();if(e!==Td&&e!==Ad){var t=b.getSize();if(t&&2==t.length){var r=jy(t);b.setScale(C*r)}b.unlistenImageChange(A)}};b.listenImageChange(A),T===Td&&b.load()}}else if(2==L.length){var x=jy(L);b.setScale(C*x)}s.imageStyle=b}else s.imageStyle=Dy}},LabelStyle:function(e,t){var r=Nl({},rm,e,t);if(r){var n=t[t.length-1],i=new lf({fill:new bd({color:"color"in r?r.color:Sy}),scale:r.scale});n.textStyle=i}},LineStyle:function(e,t){var r=Nl({},nm,e,t);if(r){var n=t[t.length-1],i=new Hd({color:"color"in r?r.color:Sy,width:"width"in r?r.width:1});n.strokeStyle=i}},PolyStyle:function(e,t){var r=Nl({},im,e,t);if(r){var n=t[t.length-1],i=new bd({color:"color"in r?r.color:Sy});n.fillStyle=i;var o=r.fill;void 0!==o&&(n.fill=o);var a=r.outline;void 0!==a&&(n.outline=a)}},BalloonStyle:function(e,t){ol.asserts.assert(e.nodeType==Node.ELEMENT_NODE),ol.asserts.assert("BalloonStyle"==e.localName);var r=ol.xml.pushParseAndPop({},tm,e,t);if(!r)return;const n=t[t.length-1],i=typeof n;ol.asserts.assert("object"==i&&null!=n||"function"==i);var o=new ol.style.Text({text:r.text});n.balloonStyle=o}});function Em(e,t){var r=Nl({},Sm,e,t,this);if(!r)return null;var n,i="fillStyle"in r?r.fillStyle:My,o=r.fill;void 0===o||o||(i=null),"imageStyle"in r?r.imageStyle!=Dy&&(n=r.imageStyle):n=Ny;var a="textStyle"in r?r.textStyle:Fy,s="strokeStyle"in r?r.strokeStyle:ky;let l;var c=r.outline;l=void 0===c||c?[new nf({fill:i,image:n,stroke:s,text:a,zIndex:void 0})]:[new nf({geometry:function(e){var t=e.getGeometry(),r=t.getType();return r===my?new pl(t.getGeometriesArrayRecursive().filter((function(e){var t=e.getType();return t!==dy&&t!==yy}))):r!==dy&&r!==yy?t:void 0},fill:i,image:n,stroke:s,text:a,zIndex:void 0}),new nf({geometry:function(e){var t=e.getGeometry(),r=t.getType();return r===my?new pl(t.getGeometriesArrayRecursive().filter((function(e){var t=e.getType();return t===dy||t===yy}))):r===dy||r===yy?t:void 0},fill:i,stroke:null,zIndex:void 0})];const u=r.balloonStyle;return u&&l.forEach((e=>e._balloon=u)),l}function bm(e,t){var r,n,i,o=t.length,a=new Array(t.length),s=new Array(t.length),l=new Array(t.length);r=!1,n=!1,i=!1;for(var c=0;c<o;++c){var u=t[c];a[c]=u.get("extrude"),s[c]=u.get("tessellate"),l[c]=u.get("altitudeMode"),r=r||void 0!==a[c],n=n||void 0!==s[c],i=i||l[c]}r&&e.set("extrude",a),n&&e.set("tessellate",s),i&&e.set("altitudeMode",l)}var Cm=Ml(_y,{displayName:Al(oc),value:Al(oc)});var Lm=Ml(_y,{Data:function(e,t){var r=e.getAttribute("name");Dl(Cm,e,t);var n=t[t.length-1];r&&n.displayName?(n[r]={value:n.value,displayName:n.displayName,toString:function(){return n.value}},delete n.displayName):null!==r?n[r]=n.value:null!==n.displayName&&(n[n.displayName]=n.value),delete n.value},SchemaData:function(e,t){Dl(Pm,e,t)}});function Tm(e,t){Dl(Lm,e,t)}function Am(e,t){Dl(Oy,e,t)}var xm=Ml(_y,{Style:Al(Em),key:Al(oc),styleUrl:Al(Xy)});var Pm=Ml(_y,{SimpleData:function(e,t){var r=e.getAttribute("name");if(null!==r){var n=oc(e);t[t.length-1][r]=n}}});var Om=Ml(_y,{altitudeMode:Al(oc),minAltitude:Al(tc),maxAltitude:Al(tc),north:Al(tc),south:Al(tc),east:Al(tc),west:Al(tc)});var Im=Ml(_y,{minLodPixels:Al(tc),maxLodPixels:Al(tc),minFadeExtent:Al(tc),maxFadeExtent:Al(tc)});var Rm=Ml(_y,{LinearRing:Cl(am)});var Mm=Ml(_y,{LinearRing:Ll(am)});function Dm(e,t){for(var r=Ye(t),n=[255*(4==r.length?r[3]:1),r[2],r[1],r[0]],i=0;i<4;++i){var o=Math.floor(n[i]).toString(16);n[i]=1==o.length?"0"+o:o}uc(e,n.join(""))}var Nm=Ml(_y,{Data:xl((function(e,t,r){e.setAttribute("name",t.name);var n={node:e},i=t.value;"object"==typeof i?(null!==i&&i.displayName&&kl(n,Nm,Il,[i.displayName],r,["displayName"]),null!==i&&i.value&&kl(n,Nm,Il,[i.value],r,["value"])):kl(n,Nm,Il,[i],r,["value"])})),value:xl((function(e,t){uc(e,t)})),displayName:xl((function(e,t){sc(e,t)}))});var Zm=Ml(_y,["name"]),km=Ml(_y,{Placemark:xl(cv),Document:xl(Um),Folder:xl(Um),name:xl(uc)}),Fm=function(e,t,r){var n=t[t.length-1].node;return Array.isArray(e)?vl(n.namespaceURI,"Folder"):vl(n.namespaceURI,"string"==typeof e?"name":"Placemark")};function Um(e,t,r){var n={node:e};if(t._name){var i={name:t._name},o=r[r.length-1].node,a=Zm[o.namespaceURI],s=Rl(i,a);kl(n,km,Fm,s,r,a)}kl(n,km,Fm,t,r,void 0,this)}var Bm=Ol("Data");var Gm=Ml(_y,["href"],Ml(vy,["x","y","w","h"])),jm=Ml(_y,{href:xl(uc)},Ml(vy,{x:xl(lc),y:xl(lc),w:xl(lc),h:xl(lc)})),Wm=function(e,t,r){return vl(vy[0],"gx:"+r)};var Hm=Ml(_y,["scale","heading","Icon","color","hotSpot"]),qm=Ml(_y,{Icon:xl((function(e,t,r){var n={node:e},i=r[r.length-1].node,o=Gm[i.namespaceURI],a=Rl(t,o);kl(n,jm,Il,a,r,o),a=Rl(t,o=Gm[vy[0]]),kl(n,jm,Wm,a,r,o)})),color:xl(Dm),heading:xl(lc),hotSpot:xl((function(e,t){e.setAttribute("x",String(t.x)),e.setAttribute("y",String(t.y)),e.setAttribute("xunits",t.xunits),e.setAttribute("yunits",t.yunits)})),scale:xl(_v)});var Vm=Ml(_y,["color","scale"]),zm=Ml(_y,{color:xl(Dm),scale:xl(_v)});var Ym=Ml(_y,["color","width"]),Km=Ml(_y,{color:xl(Dm),width:xl(lc)});var Xm={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},$m=function(e,t,r){if(e)return vl(t[t.length-1].node.namespaceURI,Xm[e.getType()])},Jm=Ol("Point"),Qm=Ol("LineString"),ev=Ol("LinearRing"),tv=Ol("Polygon"),rv=Ml(_y,{LineString:xl(hv),Point:xl(hv),Polygon:xl(mv),GeometryCollection:xl(nv)});function nv(e,t,r){var n,i={node:e},o=t.getType(),a=[];o===my?(t.getGeometriesArrayRecursive().forEach((function(e){var t=e.getType();t===fy?a=a.concat(e.getPoints()):t===gy?a=a.concat(e.getLineStrings()):t===yy?a=a.concat(e.getPolygons()):t===py||t===hy||t===dy?a.push(e):I(!1,39)})),n=$m):o===fy?(a=t.getPoints(),n=Jm):o===gy?(a=t.getLineStrings(),n=Qm):o===yy?(a=t.getPolygons(),n=tv):I(!1,39),kl(i,rv,n,a,r)}var iv=Ml(_y,{LinearRing:xl(hv)});function ov(e,t,r){kl({node:e},iv,ev,[t],r)}var av=Ml(_y,{ExtendedData:xl((function(e,t,r){for(var n={node:e},i=t.names,o=t.values,a=i.length,s=0;s<a;s++)kl(n,Nm,Bm,[{name:i[s],value:o[s]}],r)})),MultiGeometry:xl(nv),LineString:xl(hv),LinearRing:xl(hv),Point:xl(hv),Polygon:xl(mv),Style:xl((function(e,t,r){var n={node:e},i={};if(t.pointStyles.length){var o=t.pointStyles[0].getText();o&&(i.LabelStyle=o);var a=t.pointStyles[0].getImage();a&&"function"==typeof a.getSrc&&(i.IconStyle=a);var s=t.pointStyles[0]._balloon;s&&(i.BalloonStyle=s)}if(t.lineStyles.length){(l=t.lineStyles[0].getStroke())&&(i.LineStyle=l)}if(t.polyStyles.length){var l;(l=t.polyStyles[0].getStroke())&&!i.LineStyle&&(i.LineStyle=l),i.PolyStyle=t.polyStyles[0]}var c=r[r.length-1].node,u=wv[c.namespaceURI],p=Rl(i,u);kl(n,Sv,Il,p,r,u)})),address:xl(uc),description:xl(uc),name:xl(uc),open:xl(ac),phoneNumber:xl(uc),styleUrl:xl(uc),visibility:xl(ac)}),sv=Ml(_y,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),lv=Ol("ExtendedData");function cv(e,t,r){var n={node:e};t.getId()&&e.setAttribute("id",t.getId());var i=t.getProperties(),o={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};o[t.getGeometryName()]=1;var a=Object.keys(i||{}).filter((function(e){return!o[e]})),s=t.getStyleFunction();if(s){var l=s(t,0);if(l){var c=Array.isArray(l)?l:[l],u=c;if(t.getGeometry()&&(u=c.filter((function(e){var r=e.getGeometryFunction()(t);if(r){var n=r.getType();return n===my?r.getGeometriesArrayRecursive().filter((function(e){var t=e.getType();return t===py||t===fy})).length:n===py||n===fy}}))),this.writeStyles_){var p=c,h=c;t.getGeometry()&&(p=c.filter((function(e){var r=e.getGeometryFunction()(t);if(r){var n=r.getType();return n===my?r.getGeometriesArrayRecursive().filter((function(e){var t=e.getType();return t===hy||t===gy})).length:n===hy||n===gy}})),h=c.filter((function(e){var r=e.getGeometryFunction()(t);if(r){var n=r.getType();return n===my?r.getGeometriesArrayRecursive().filter((function(e){var t=e.getType();return t===dy||t===yy})).length:n===dy||n===yy}}))),i.Style={pointStyles:u,lineStyles:p,polyStyles:h}}if(u.length&&void 0===i.name){var d=u[0].getText();d&&(i.name=d.getText())}}}var f=r[r.length-1].node,g=sv[f.namespaceURI],y=Rl(i,g);if(kl(n,av,Il,y,r,g),a.length>0){var m=Rl(i,a);kl(n,av,lv,[{names:a,values:m}],r)}var v=r[0],_=t.getGeometry();_&&(_=gl(_,!0,v)),kl(n,av,$m,[_],r)}var uv=Ml(_y,["extrude","tessellate","altitudeMode","coordinates"]),pv=Ml(_y,{extrude:xl(ac),tessellate:xl(ac),altitudeMode:xl(uc),coordinates:xl((function(e,t,r){var n,i=r[r.length-1],o=i.layout,a=i.stride;o==Pi.XY||o==Pi.XYM?n=2:o==Pi.XYZ||o==Pi.XYZM?n=3:I(!1,34);var s=t.length,l="";if(s>0){l+=t[0];for(var c=1;c<n;++c)l+=","+t[c];for(var u=a;u<s;u+=a){l+=" "+t[u];for(c=1;c<n;++c)l+=","+t[u+c]}}uc(e,l)}))});function hv(e,t,r){var n=t.getFlatCoordinates(),i={node:e};i.layout=t.getLayout(),i.stride=t.getStride();var o=t.getProperties();o.coordinates=n;var a=r[r.length-1].node,s=uv[a.namespaceURI],l=Rl(o,s);kl(i,pv,Il,l,r,s)}var dv=Ml(_y,["color","fill","outline"]),fv=Ml(_y,{outerBoundaryIs:xl(ov),innerBoundaryIs:xl(ov)}),gv=Ol("innerBoundaryIs"),yv=Ol("outerBoundaryIs");function mv(e,t,r){var n=t.getLinearRings(),i=n.shift(),o={node:e};kl(o,fv,gv,n,r),kl(o,fv,yv,[i],r)}var vv=Ml(_y,{color:xl(Dm),fill:xl(ac),outline:xl(ac)});function _v(e,t){lc(e,Math.round(1e6*t)/1e6)}var wv=Ml(_y,["IconStyle","LabelStyle","LineStyle","PolyStyle","BalloonStyle"]),Sv=Ml(_y,{IconStyle:xl((function(e,t,r){var n={node:e},i={},o=t.getSrc(),a=t.getSize(),s=t.getImageSize(),l={href:o};if(a){l.w=a[0],l.h=a[1];var c=t.getAnchor(),u=t.getOrigin();if(u&&s&&0!==u[0]&&u[1]!==a[1]&&(l.x=u[0],l.y=s[1]-(u[1]+a[1])),c&&(c[0]!==a[0]/2||c[1]!==a[1]/2)){var p={x:c[0],xunits:Cd.PIXELS,y:a[1]-c[1],yunits:Cd.PIXELS};i.hotSpot=p}}i.Icon=l;var h=t.getScaleArray()[0],d=a;null===d&&(Ly||Wy(),d=Ly),2==d.length&&(h/=jy(d)),1!==h&&(i.scale=h);var f=t.getRotation();0!==f&&(i.heading=f*(180/Math.PI));var g=t.getColor();g&&(i.color=g);var y=r[r.length-1].node,m=Hm[y.namespaceURI],v=Rl(i,m);kl(n,qm,Il,v,r,m)})),LabelStyle:xl((function(e,t,r){var n={node:e},i={},o=t.getFill();o&&(i.color=o.getColor());var a=t.getScale();a&&1!==a&&(i.scale=a);var s=r[r.length-1].node,l=Vm[s.namespaceURI],c=Rl(i,l);kl(n,zm,Il,c,r,l)})),LineStyle:xl((function(e,t,r){var n={node:e},i={color:t.getColor(),width:Number(t.getWidth())||1},o=r[r.length-1].node,a=Ym[o.namespaceURI],s=Rl(i,a);kl(n,Km,Il,s,r,a)})),PolyStyle:xl((function(e,t,r){var n={node:e},i=t.getFill(),o=t.getStroke(),a={color:i?i.getColor():void 0,fill:!!i&&void 0,outline:!!o&&void 0},s=r[r.length-1].node,l=dv[s.namespaceURI],c=Rl(a,l);kl(n,vv,Il,c,r,l)})),BalloonStyle:xl(((e,t)=>{const r=Bl().createCDATASection(t.getText()),n=Bl().createElement("text");n.appendChild(r),e.appendChild(n)}))});const Ev=qy;var bv=r(6656),Cv=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Lv="renderOrder";const Tv=function(e){function t(t){var r=this,n=t||{},i=nt({},n);return delete i.style,delete i.renderBuffer,delete i.updateWhileAnimating,delete i.updateWhileInteracting,(r=e.call(this,i)||this).declutter_=void 0!==n.declutter&&n.declutter,r.renderBuffer_=void 0!==n.renderBuffer?n.renderBuffer:100,r.style_=null,r.styleFunction_=void 0,r.setStyle(n.style),r.updateWhileAnimating_=void 0!==n.updateWhileAnimating&&n.updateWhileAnimating,r.updateWhileInteracting_=void 0!==n.updateWhileInteracting&&n.updateWhileInteracting,r}return Cv(t,e),t.prototype.getDeclutter=function(){return this.declutter_},t.prototype.getFeatures=function(t){return e.prototype.getFeatures.call(this,t)},t.prototype.getRenderBuffer=function(){return this.renderBuffer_},t.prototype.getRenderOrder=function(){return this.get(Lv)},t.prototype.getStyle=function(){return this.style_},t.prototype.getStyleFunction=function(){return this.styleFunction_},t.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},t.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},t.prototype.renderDeclutter=function(e){e.declutterTree||(e.declutterTree=new bv(9)),this.getRenderer().renderDeclutter(e)},t.prototype.setRenderOrder=function(e){this.set(Lv,e)},t.prototype.setStyle=function(e){this.style_=void 0!==e?e:ef,this.styleFunction_=null===e?void 0:function(e){var t;if("function"==typeof e)t=e;else{var r;Array.isArray(e)?r=e:(I("function"==typeof e.getZIndex,41),r=[e]),t=function(){return r}}return t}(this.style_),this.changed()},t}(Nt);var Av={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},xv=[Av.FILL],Pv=[Av.STROKE],Ov=[Av.BEGIN_PATH],Iv=[Av.CLOSE_PATH];const Rv=Av;const Mv=function(){function e(){}return e.prototype.drawCustom=function(e,t,r,n){},e.prototype.drawGeometry=function(e){},e.prototype.setStyle=function(e){},e.prototype.drawCircle=function(e,t){},e.prototype.drawFeature=function(e,t){},e.prototype.drawGeometryCollection=function(e,t){},e.prototype.drawLineString=function(e,t){},e.prototype.drawMultiLineString=function(e,t){},e.prototype.drawMultiPoint=function(e,t){},e.prototype.drawMultiPolygon=function(e,t){},e.prototype.drawPoint=function(e,t){},e.prototype.drawPolygon=function(e,t){},e.prototype.drawText=function(e,t){},e.prototype.setFillStrokeStyle=function(e,t){},e.prototype.setImageStyle=function(e,t){},e.prototype.setTextStyle=function(e,t){},e}();var Dv=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Nv=function(e){function t(t,r,n,i){var o=e.call(this)||this;return o.tolerance=t,o.maxExtent=r,o.pixelRatio=i,o.maxLineWidth=0,o.resolution=n,o.beginGeometryInstruction1_=null,o.beginGeometryInstruction2_=null,o.bufferedMaxExtent_=null,o.instructions=[],o.coordinates=[],o.tmpCoordinate_=[],o.hitDetectionInstructions=[],o.state={},o}return Dv(t,e),t.prototype.applyPixelRatio=function(e){var t=this.pixelRatio;return 1==t?e:e.map((function(e){return e*t}))},t.prototype.appendFlatPointCoordinates=function(e,t){for(var r=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,i=this.coordinates,o=i.length,a=0,s=e.length;a<s;a+=t)n[0]=e[a],n[1]=e[a+1],Q(r,n)&&(i[o++]=n[0],i[o++]=n[1]);return o},t.prototype.appendFlatLineCoordinates=function(e,t,r,n,i,o){var a=this.coordinates,s=a.length,l=this.getBufferedMaxExtent();o&&(t+=n);var c,u,p,h=e[t],d=e[t+1],f=this.tmpCoordinate_,g=!0;for(c=t+n;c<r;c+=n)f[0]=e[c],f[1]=e[c+1],(p=re(l,f))!==u?(g&&(a[s++]=h,a[s++]=d,g=!1),a[s++]=f[0],a[s++]=f[1]):p===H?(a[s++]=f[0],a[s++]=f[1],g=!1):g=!0,h=f[0],d=f[1],u=p;return(i&&g||c===t+n)&&(a[s++]=h,a[s++]=d),s},t.prototype.drawCustomCoordinates_=function(e,t,r,n,i){for(var o=0,a=r.length;o<a;++o){var s=r[o],l=this.appendFlatLineCoordinates(e,t,s,n,!1,!1);i.push(l),t=s}return t},t.prototype.drawCustom=function(e,t,r,n){this.beginGeometry(e,t);var i,o,a,s,l,c=e.getType(),u=e.getStride(),p=this.coordinates.length;switch(c){case"MultiPolygon":i=e.getOrientedFlatCoordinates(),s=[];var h=e.getEndss();l=0;for(var d=0,f=h.length;d<f;++d){var g=[];l=this.drawCustomCoordinates_(i,l,h[d],u,g),s.push(g)}this.instructions.push([Rv.CUSTOM,p,s,e,r,ro]),this.hitDetectionInstructions.push([Rv.CUSTOM,p,s,e,n||r,ro]);break;case"Polygon":case"MultiLineString":a=[],i="Polygon"==c?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),l=this.drawCustomCoordinates_(i,0,e.getEnds(),u,a),this.instructions.push([Rv.CUSTOM,p,a,e,r,to]),this.hitDetectionInstructions.push([Rv.CUSTOM,p,a,e,n||r,to]);break;case"LineString":case"Circle":i=e.getFlatCoordinates(),o=this.appendFlatLineCoordinates(i,0,i.length,u,!1,!1),this.instructions.push([Rv.CUSTOM,p,o,e,r,eo]),this.hitDetectionInstructions.push([Rv.CUSTOM,p,o,e,n||r,eo]);break;case"MultiPoint":i=e.getFlatCoordinates(),(o=this.appendFlatPointCoordinates(i,u))>p&&(this.instructions.push([Rv.CUSTOM,p,o,e,r,eo]),this.hitDetectionInstructions.push([Rv.CUSTOM,p,o,e,n||r,eo]));break;case"Point":i=e.getFlatCoordinates(),this.coordinates.push(i[0],i[1]),o=this.coordinates.length,this.instructions.push([Rv.CUSTOM,p,o,e,r]),this.hitDetectionInstructions.push([Rv.CUSTOM,p,o,e,n||r])}this.endGeometry(t)},t.prototype.beginGeometry=function(e,t){this.beginGeometryInstruction1_=[Rv.BEGIN_GEOMETRY,t,0,e],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Rv.BEGIN_GEOMETRY,t,0,e],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},t.prototype.finish=function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}},t.prototype.reverseHitDetectionInstructions=function(){var e,t=this.hitDetectionInstructions;t.reverse();var r,n,i=t.length,o=-1;for(e=0;e<i;++e)(n=(r=t[e])[0])==Rv.END_GEOMETRY?o=e:n==Rv.BEGIN_GEOMETRY&&(r[2]=e,p(this.hitDetectionInstructions,o,e),o=-1)},t.prototype.setFillStrokeStyle=function(e,t){var r=this.state;if(e){var n=e.getColor();r.fillStyle=qd(n||dr)}else r.fillStyle=void 0;if(t){var i=t.getColor();r.strokeStyle=qd(i||mr);var o=t.getLineCap();r.lineCap=void 0!==o?o:fr;var a=t.getLineDash();r.lineDash=a?a.slice():gr;var s=t.getLineDashOffset();r.lineDashOffset=s||0;var l=t.getLineJoin();r.lineJoin=void 0!==l?l:yr;var c=t.getWidth();r.lineWidth=void 0!==c?c:1;var u=t.getMiterLimit();r.miterLimit=void 0!==u?u:10,r.lineWidth>this.maxLineWidth&&(this.maxLineWidth=r.lineWidth,this.bufferedMaxExtent_=null)}else r.strokeStyle=void 0,r.lineCap=void 0,r.lineDash=null,r.lineDashOffset=void 0,r.lineJoin=void 0,r.lineWidth=void 0,r.miterLimit=void 0},t.prototype.createFill=function(e){var t=e.fillStyle,r=[Rv.SET_FILL_STYLE,t];return"string"!=typeof t&&r.push(!0),r},t.prototype.applyStroke=function(e){this.instructions.push(this.createStroke(e))},t.prototype.createStroke=function(e){return[Rv.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,this.applyPixelRatio(e.lineDash),e.lineDashOffset*this.pixelRatio]},t.prototype.updateFillStyle=function(e,t){var r=e.fillStyle;"string"==typeof r&&e.currentFillStyle==r||(void 0!==r&&this.instructions.push(t.call(this,e)),e.currentFillStyle=r)},t.prototype.updateStrokeStyle=function(e,t){var r=e.strokeStyle,n=e.lineCap,i=e.lineDash,o=e.lineDashOffset,a=e.lineJoin,s=e.lineWidth,l=e.miterLimit;(e.currentStrokeStyle!=r||e.currentLineCap!=n||i!=e.currentLineDash&&!f(e.currentLineDash,i)||e.currentLineDashOffset!=o||e.currentLineJoin!=a||e.currentLineWidth!=s||e.currentMiterLimit!=l)&&(void 0!==r&&t.call(this,e),e.currentStrokeStyle=r,e.currentLineCap=n,e.currentLineDash=i,e.currentLineDashOffset=o,e.currentLineJoin=a,e.currentLineWidth=s,e.currentMiterLimit=l)},t.prototype.endGeometry=function(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var t=[Rv.END_GEOMETRY,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)},t.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=$(this.maxExtent),this.maxLineWidth>0)){var e=this.resolution*(this.maxLineWidth+1)/2;X(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},t}(Mv);const Zv=Nv;var kv=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const Fv=function(e){function t(t,r,n,i){var o=e.call(this,t,r,n,i)||this;return o.hitDetectionImage_=null,o.image_=null,o.imagePixelRatio_=void 0,o.anchorX_=void 0,o.anchorY_=void 0,o.height_=void 0,o.opacity_=void 0,o.originX_=void 0,o.originY_=void 0,o.rotateWithView_=void 0,o.rotation_=void 0,o.scale_=void 0,o.width_=void 0,o.declutterMode_=void 0,o.declutterImageWithText_=void 0,o}return kv(t,e),t.prototype.drawPoint=function(e,t){if(this.image_){this.beginGeometry(e,t);var r=e.getFlatCoordinates(),n=e.getStride(),i=this.coordinates.length,o=this.appendFlatPointCoordinates(r,n);this.instructions.push([Rv.DRAW_IMAGE,i,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Rv.DRAW_IMAGE,i,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}},t.prototype.drawMultiPoint=function(e,t){if(this.image_){this.beginGeometry(e,t);var r=e.getFlatCoordinates(),n=e.getStride(),i=this.coordinates.length,o=this.appendFlatPointCoordinates(r,n);this.instructions.push([Rv.DRAW_IMAGE,i,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Rv.DRAW_IMAGE,i,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}},t.prototype.finish=function(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,e.prototype.finish.call(this)},t.prototype.setImageStyle=function(e,t){var r=e.getAnchor(),n=e.getSize(),i=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=r[0],this.anchorY_=r[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=e.getOpacity(),this.originX_=i[0],this.originY_=i[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=n[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t},t}(Zv);var Uv=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Bv=function(e){function t(t,r,n,i){return e.call(this,t,r,n,i)||this}return Uv(t,e),t.prototype.drawFlatCoordinates_=function(e,t,r,n){var i=this.coordinates.length,o=this.appendFlatLineCoordinates(e,t,r,n,!1,!1),a=[Rv.MOVE_TO_LINE_TO,i,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),r},t.prototype.drawLineString=function(e,t){var r=this.state,n=r.strokeStyle,i=r.lineWidth;if(void 0!==n&&void 0!==i){this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(e,t),this.hitDetectionInstructions.push([Rv.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,gr,0],Ov);var o=e.getFlatCoordinates(),a=e.getStride();this.drawFlatCoordinates_(o,0,o.length,a),this.hitDetectionInstructions.push(Pv),this.endGeometry(t)}},t.prototype.drawMultiLineString=function(e,t){var r=this.state,n=r.strokeStyle,i=r.lineWidth;if(void 0!==n&&void 0!==i){this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(e,t),this.hitDetectionInstructions.push([Rv.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset],Ov);for(var o=e.getEnds(),a=e.getFlatCoordinates(),s=e.getStride(),l=0,c=0,u=o.length;c<u;++c)l=this.drawFlatCoordinates_(a,l,o[c],s);this.hitDetectionInstructions.push(Pv),this.endGeometry(t)}},t.prototype.finish=function(){var t=this.state;return null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&this.instructions.push(Pv),this.reverseHitDetectionInstructions(),this.state=null,e.prototype.finish.call(this)},t.prototype.applyStroke=function(t){null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(Pv),t.lastStroke=this.coordinates.length),t.lastStroke=0,e.prototype.applyStroke.call(this,t),this.instructions.push(Ov)},t}(Zv);const Gv=Bv;var jv=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Wv=function(e){function t(t,r,n,i){return e.call(this,t,r,n,i)||this}return jv(t,e),t.prototype.drawFlatCoordinatess_=function(e,t,r,n){var i=this.state,o=void 0!==i.fillStyle,a=void 0!==i.strokeStyle,s=r.length;this.instructions.push(Ov),this.hitDetectionInstructions.push(Ov);for(var l=0;l<s;++l){var c=r[l],u=this.coordinates.length,p=this.appendFlatLineCoordinates(e,t,c,n,!0,!a),h=[Rv.MOVE_TO_LINE_TO,u,p];this.instructions.push(h),this.hitDetectionInstructions.push(h),a&&(this.instructions.push(Iv),this.hitDetectionInstructions.push(Iv)),t=c}return o&&(this.instructions.push(xv),this.hitDetectionInstructions.push(xv)),a&&(this.instructions.push(Pv),this.hitDetectionInstructions.push(Pv)),t},t.prototype.drawCircle=function(e,t){var r=this.state,n=r.fillStyle,i=r.strokeStyle;if(void 0!==n||void 0!==i){this.setFillStrokeStyles_(),this.beginGeometry(e,t),void 0!==r.fillStyle&&this.hitDetectionInstructions.push([Rv.SET_FILL_STYLE,dr]),void 0!==r.strokeStyle&&this.hitDetectionInstructions.push([Rv.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);var o=e.getFlatCoordinates(),a=e.getStride(),s=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,a,!1,!1);var l=[Rv.CIRCLE,s];this.instructions.push(Ov,l),this.hitDetectionInstructions.push(Ov,l),void 0!==r.fillStyle&&(this.instructions.push(xv),this.hitDetectionInstructions.push(xv)),void 0!==r.strokeStyle&&(this.instructions.push(Pv),this.hitDetectionInstructions.push(Pv)),this.endGeometry(t)}},t.prototype.drawPolygon=function(e,t){var r=this.state,n=r.fillStyle,i=r.strokeStyle;if(void 0!==n||void 0!==i){this.setFillStrokeStyles_(),this.beginGeometry(e,t),void 0!==r.fillStyle&&this.hitDetectionInstructions.push([Rv.SET_FILL_STYLE,dr]),void 0!==r.strokeStyle&&this.hitDetectionInstructions.push([Rv.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);var o=e.getEnds(),a=e.getOrientedFlatCoordinates(),s=e.getStride();this.drawFlatCoordinatess_(a,0,o,s),this.endGeometry(t)}},t.prototype.drawMultiPolygon=function(e,t){var r=this.state,n=r.fillStyle,i=r.strokeStyle;if(void 0!==n||void 0!==i){this.setFillStrokeStyles_(),this.beginGeometry(e,t),void 0!==r.fillStyle&&this.hitDetectionInstructions.push([Rv.SET_FILL_STYLE,dr]),void 0!==r.strokeStyle&&this.hitDetectionInstructions.push([Rv.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);for(var o=e.getEndss(),a=e.getOrientedFlatCoordinates(),s=e.getStride(),l=0,c=0,u=o.length;c<u;++c)l=this.drawFlatCoordinatess_(a,l,o[c],s);this.endGeometry(t)}},t.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var t=this.tolerance;if(0!==t)for(var r=this.coordinates,n=0,i=r.length;n<i;++n)r[n]=$i(r[n],t);return e.prototype.finish.call(this)},t.prototype.setFillStrokeStyles_=function(){var e=this.state;void 0!==e.fillStyle&&this.updateFillStyle(e,this.createFill),void 0!==e.strokeStyle&&this.updateStrokeStyle(e,this.applyStroke)},t}(Zv);const Hv=Wv;function qv(e,t,r,n,i){var o,a,s,l,c,u,p,h,d,f=r,g=r,y=0,m=0,v=r;for(o=r;o<n;o+=i){var _=t[o],w=t[o+1];void 0!==l&&(h=_-l,d=w-c,s=Math.sqrt(h*h+d*d),void 0!==u&&(m+=a,Math.acos((u*h+p*d)/(a*s))>e&&(m>y&&(y=m,f=v,g=o),m=0,v=o-i)),a=s,u=h,p=d),l=_,c=w}return(m+=s)>y?[v,o]:[f,g]}var Vv=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),zv={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},Yv=function(e){function t(t,r,n,i){var o=e.call(this,t,r,n,i)||this;return o.labels_=null,o.text_="",o.textOffsetX_=0,o.textOffsetY_=0,o.textRotateWithView_=void 0,o.textRotation_=0,o.textFillState_=null,o.fillStates={},o.textStrokeState_=null,o.strokeStates={},o.textState_={},o.textStates={},o.textKey_="",o.fillKey_="",o.strokeKey_="",o.declutterImageWithText_=void 0,o}return Vv(t,e),t.prototype.finish=function(){var t=e.prototype.finish.call(this);return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t},t.prototype.drawText=function(e,t){var r=this.textFillState_,n=this.textStrokeState_,i=this.textState_;if(""!==this.text_&&i&&(r||n)){var o=this.coordinates,a=o.length,s=e.getType(),l=null,c=e.getStride();if(i.placement!==af||"LineString"!=s&&"MultiLineString"!=s&&"Polygon"!=s&&"MultiPolygon"!=s){var u=i.overflow?null:[];switch(s){case"Point":case"MultiPoint":l=e.getFlatCoordinates();break;case"LineString":l=e.getFlatMidpoint();break;case"Circle":l=e.getCenter();break;case"MultiLineString":l=e.getFlatMidpoints(),c=2;break;case"Polygon":l=e.getFlatInteriorPoint(),i.overflow||u.push(l[2]/this.resolution),c=3;break;case"MultiPolygon":var p=e.getFlatInteriorPoints();l=[];for(E=0,b=p.length;E<b;E+=3)i.overflow||u.push(p[E+2]/this.resolution),l.push(p[E],p[E+1]);if(0===l.length)return;c=2}if((O=this.appendFlatPointCoordinates(l,c))===a)return;if(u&&(O-a)/2!=l.length/c){var h=a/2;u=u.filter((function(e,t){var r=o[2*(h+t)]===l[t*c]&&o[2*(h+t)+1]===l[t*c+1];return r||--h,r}))}this.saveTextStates_(),(i.backgroundFill||i.backgroundStroke)&&(this.setFillStrokeStyle(i.backgroundFill,i.backgroundStroke),i.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),i.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(e,t);var d=i.padding;if(d!=wr&&(i.scale[0]<0||i.scale[1]<0)){var f=i.padding[0],g=i.padding[1],y=i.padding[2],m=i.padding[3];i.scale[0]<0&&(g=-g,m=-m),i.scale[1]<0&&(f=-f,y=-y),d=[f,g,y,m]}var v=this.pixelRatio;this.instructions.push([Rv.DRAW_IMAGE,a,O,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,d==wr?wr:d.map((function(e){return e*v})),!!i.backgroundFill,!!i.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,u]);var _=1/v;this.hitDetectionInstructions.push([Rv.DRAW_IMAGE,a,O,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[_,_],NaN,void 0,this.declutterImageWithText_,d,!!i.backgroundFill,!!i.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,u]),this.endGeometry(t)}else{if(!Te(this.getBufferedMaxExtent(),e.getExtent()))return;var w=void 0;if(l=e.getFlatCoordinates(),"LineString"==s)w=[l.length];else if("MultiLineString"==s)w=e.getEnds();else if("Polygon"==s)w=e.getEnds().slice(0,1);else if("MultiPolygon"==s){var S=e.getEndss();w=[];for(var E=0,b=S.length;E<b;++E)w.push(S[E][0])}this.beginGeometry(e,t);for(var C=i.textAlign,L=0,T=void 0,A=0,x=w.length;A<x;++A){if(null==C){var P=qv(i.maxAngle,l,L,w[A],c);L=P[0],T=P[1]}else T=w[A];for(var E=L;E<T;E+=c)o.push(l[E],l[E+1]);var O=o.length;L=w[A],this.drawChars_(a,O),a=O}this.endGeometry(t)}}},t.prototype.saveTextStates_=function(){var e=this.textStrokeState_,t=this.textState_,r=this.textFillState_,n=this.strokeKey_;e&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));var i=this.textKey_;i in this.textStates||(this.textStates[i]={font:t.font,textAlign:t.textAlign||vr,justify:t.justify,textBaseline:t.textBaseline||_r,scale:t.scale});var o=this.fillKey_;r&&(o in this.fillStates||(this.fillStates[o]={fillStyle:r.fillStyle}))},t.prototype.drawChars_=function(e,t){var r=this.textStrokeState_,n=this.textState_,i=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();var s=this.pixelRatio,l=zv[n.textBaseline],c=this.textOffsetY_*s,u=this.text_,p=r?r.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([Rv.DRAW_CHARS,e,t,l,n.overflow,a,n.maxAngle,s,c,i,p*s,u,o,1]),this.hitDetectionInstructions.push([Rv.DRAW_CHARS,e,t,l,n.overflow,a,n.maxAngle,1,c,i,p,u,o,1/s])},t.prototype.setTextStyle=function(e,t){var r,n,i;if(e){var a=e.getFill();a?((n=this.textFillState_)||(n={},this.textFillState_=n),n.fillStyle=qd(a.getColor()||dr)):(n=null,this.textFillState_=n);var s=e.getStroke();if(s){(i=this.textStrokeState_)||(i={},this.textStrokeState_=i);var l=s.getLineDash(),c=s.getLineDashOffset(),u=s.getWidth(),p=s.getMiterLimit();i.lineCap=s.getLineCap()||fr,i.lineDash=l?l.slice():gr,i.lineDashOffset=void 0===c?0:c,i.lineJoin=s.getLineJoin()||yr,i.lineWidth=void 0===u?1:u,i.miterLimit=void 0===p?10:p,i.strokeStyle=qd(s.getColor()||mr)}else i=null,this.textStrokeState_=i;r=this.textState_;var h=e.getFont()||hr;Tr(h);var d=e.getScaleArray();r.overflow=e.getOverflow(),r.font=h,r.maxAngle=e.getMaxAngle(),r.placement=e.getPlacement(),r.textAlign=e.getTextAlign(),r.justify=e.getJustify(),r.textBaseline=e.getTextBaseline()||_r,r.backgroundFill=e.getBackgroundFill(),r.backgroundStroke=e.getBackgroundStroke(),r.padding=e.getPadding()||wr,r.scale=void 0===d?[1,1]:d;var f=e.getOffsetX(),g=e.getOffsetY(),y=e.getRotateWithView(),m=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=void 0===f?0:f,this.textOffsetY_=void 0===g?0:g,this.textRotateWithView_=void 0!==y&&y,this.textRotation_=void 0===m?0:m,this.strokeKey_=i?("string"==typeof i.strokeStyle?i.strokeStyle:o(i.strokeStyle))+i.lineCap+i.lineDashOffset+"|"+i.lineWidth+i.lineJoin+i.miterLimit+"["+i.lineDash.join()+"]":"",this.textKey_=r.font+r.scale+(r.textAlign||"?")+(r.justify||"?")+(r.textBaseline||"?"),this.fillKey_=n?"string"==typeof n.fillStyle?n.fillStyle:"|"+o(n.fillStyle):""}else this.text_="";this.declutterImageWithText_=t},t}(Zv);var Kv={Circle:Hv,Default:Zv,Image:Fv,LineString:Gv,Polygon:Hv,Text:Yv};const Xv=function(){function e(e,t,r,n){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=n,this.resolution_=r,this.buildersByZIndex_={}}return e.prototype.finish=function(){var e={};for(var t in this.buildersByZIndex_){e[t]=e[t]||{};var r=this.buildersByZIndex_[t];for(var n in r){var i=r[n].finish();e[t][n]=i}}return e},e.prototype.getBuilder=function(e,t){var r=void 0!==e?e.toString():"0",n=this.buildersByZIndex_[r];void 0===n&&(n={},this.buildersByZIndex_[r]=n);var i=n[t];void 0===i&&(i=new(0,Kv[t])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[t]=i);return i},e}();var $v=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Jv=function(e){function t(t){var r=e.call(this)||this;return r.ready=!0,r.boundHandleImageChange_=r.handleImageChange_.bind(r),r.layer_=t,r.declutterExecutorGroup=null,r}return $v(t,e),t.prototype.getFeatures=function(e){return n()},t.prototype.getData=function(e){return null},t.prototype.prepareFrame=function(e){return n()},t.prototype.renderFrame=function(e,t){return n()},t.prototype.loadedTileCallback=function(e,t,r){e[t]||(e[t]={}),e[t][r.tileCoord.toString()]=r},t.prototype.createLoadedTileFinder=function(e,t,r){return function(n,i){var o=this.loadedTileCallback.bind(this,r,n);return e.forEachLoadedTile(t,n,i,o)}.bind(this)},t.prototype.forEachFeatureAtCoordinate=function(e,t,r,n,i){},t.prototype.getDataAtPixel=function(e,t,r){return null},t.prototype.getLayer=function(){return this.layer_},t.prototype.handleFontsChanged=function(){},t.prototype.handleImageChange_=function(e){e.target.getState()===xd&&this.renderIfReadyAndVisible()},t.prototype.loadImage=function(e){var t=e.getState();return t!=xd&&t!=Pd&&e.addEventListener(ct.CHANGE,this.boundHandleImageChange_),t==Td&&(e.load(),t=e.getState()),t==xd},t.prototype.renderIfReadyAndVisible=function(){var e=this.getLayer();e&&e.getVisible()&&"ready"===e.getSourceState()&&e.changed()},t.prototype.disposeInternal=function(){delete this.layer_,e.prototype.disposeInternal.call(this)},t}(yt);const Qv=Jv;var e_=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),t_=[],r_=null;var n_=function(e){function t(t){var r=e.call(this,t)||this;return r.container=null,r.renderedResolution,r.tempTransform=[1,0,0,1,0,0],r.pixelTransform=[1,0,0,1,0,0],r.inversePixelTransform=[1,0,0,1,0,0],r.context=null,r.containerReused=!1,r.pixelContext_=null,r.frameState=null,r}return e_(t,e),t.prototype.getImageData=function(e,t,r){var n,i;r_||((n=document.createElement("canvas")).width=1,n.height=1,r_=n.getContext("2d")),r_.clearRect(0,0,1,1);try{r_.drawImage(e,t,r,1,1,0,0,1,1),i=r_.getImageData(0,0,1,1).data}catch(e){return r_=null,null}return i},t.prototype.getBackground=function(e){var t=this.getLayer().getBackground();return"function"==typeof t&&(t=t(e.viewState.resolution)),t||void 0},t.prototype.useContainer=function(e,t,r){var n,i,o=this.getLayer().getClassName();e&&e.className===o&&(!r||e&&e.style.backgroundColor&&f(Ye(e.style.backgroundColor),Ye(r)))&&((s=e.firstElementChild)instanceof HTMLCanvasElement&&(i=s.getContext("2d")));if(i&&i.canvas.style.transform===t?(this.container=e,this.context=i,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){(n=document.createElement("div")).className=o;var a=n.style;a.position="absolute",a.width="100%",a.height="100%";var s=(i=or()).canvas;n.appendChild(s),(a=s.style).position="absolute",a.left="0",a.transformOrigin="top left",this.container=n,this.context=i}this.containerReused||!r||this.container.style.backgroundColor||(this.container.style.backgroundColor=r)},t.prototype.clipUnrotated=function(e,t,r){var n=be(r),i=Ce(r),o=ye(r),a=ge(r);k(t.coordinateToPixelTransform,n),k(t.coordinateToPixelTransform,i),k(t.coordinateToPixelTransform,o),k(t.coordinateToPixelTransform,a);var s=this.inversePixelTransform;k(s,n),k(s,i),k(s,o),k(s,a),e.save(),e.beginPath(),e.moveTo(Math.round(n[0]),Math.round(n[1])),e.lineTo(Math.round(i[0]),Math.round(i[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()},t.prototype.dispatchRenderEvent_=function(e,t,r){var n=this.getLayer();if(n.hasListener(e)){var i=new $t(e,this.inversePixelTransform,r,t);n.dispatchEvent(i)}},t.prototype.preRender=function(e,t){this.frameState=t,this.dispatchRenderEvent_(Rt.PRERENDER,e,t)},t.prototype.postRender=function(e,t){this.dispatchRenderEvent_(Rt.POSTRENDER,e,t)},t.prototype.getRenderTransform=function(e,t,r,n,i,o,a){var s=i/2,l=o/2,c=n/t,u=-c,p=-e[0]+a,h=-e[1];return B(this.tempTransform,s,l,c,u,-r,p,h)},t.prototype.getDataAtPixel=function(e,t,r){var n=k(this.inversePixelTransform,e.slice()),i=this.context,o=this.getLayer().getExtent();if(o&&!Q(o,k(t.pixelToCoordinateTransform,e.slice())))return null;var a,s=Math.round(n[0]),l=Math.round(n[1]),c=this.pixelContext_;if(!c){var u=document.createElement("canvas");u.width=1,u.height=1,c=u.getContext("2d"),this.pixelContext_=c}c.clearRect(0,0,1,1);try{c.drawImage(i.canvas,s,l,1,1,0,0,1,1),a=c.getImageData(0,0,1,1).data}catch(e){return"SecurityError"===e.name?(this.pixelContext_=null,new Uint8Array):a}return 0===a[3]?null:a},t.prototype.disposeInternal=function(){delete this.frameState,e.prototype.disposeInternal.call(this)},t}(Qv);const i_=n_;function o_(e,t,r,n,i,o,a,s,l,c,u,p){var h=e[t],d=e[t+1],f=0,g=0,y=0,m=0;function v(){f=h,g=d,h=e[t+=n],d=e[t+1],m+=y,y=Math.sqrt((h-f)*(h-f)+(d-g)*(d-g))}do{v()}while(t<r-n&&m+y<o);for(var _=0===y?0:(o-m)/y,w=Fe(f,h,_),S=Fe(g,d,_),E=t-n,b=m,C=o+s*l(c,i,u);t<r-n&&m+y<C;)v();var L,T=Fe(f,h,_=0===y?0:(C-m)/y),A=Fe(g,d,_);if(p){var x=[w,S,T,A];Ii(x,0,4,2,p,x,x),L=x[0]>x[2]}else L=w>T;var P,O=Math.PI,I=[],R=E+n===t;if(y=0,m=b,h=e[t=E],d=e[t+1],R){v(),P=Math.atan2(d-g,h-f),L&&(P+=P>0?-O:O);var M=(T+w)/2,D=(A+S)/2;return I[0]=[M,D,(C-o)/2,P,i],I}for(var N=0,Z=(i=i.replace(/\n/g," ")).length;N<Z;){v();var k=Math.atan2(d-g,h-f);if(L&&(k+=k>0?-O:O),void 0!==P){var F=k-P;if(F+=F>O?-2*O:F<-O?2*O:0,Math.abs(F)>a)return null}P=k;for(var U=N,B=0;N<Z;++N){var G=s*l(c,i[L?Z-N-1:N],u);if(t+n<r&&m+y<o+B+G/2)break;B+=G}if(N!==U){var j=L?i.substring(Z-U,Z-N):i.substring(U,N);M=Fe(f,h,_=0===y?0:(o+B/2-m)/y),D=Fe(g,d,_);I.push([M,D,B/2,k,j]),o+=B}}return I}var a_=[1/0,1/0,-1/0,-1/0],s_=[],l_=[],c_=[],u_=[];function p_(e){return e[3].declutterBox}var h_=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function d_(e,t){return"start"!==t&&"end"!==t||h_.test(e)||(t="start"===t?"left":"right"),zv[t]}function f_(e,t,r){return r>0&&e.push("\n",""),e.push(t,""),e}var g_=function(){function e(e,t,r,n){this.overlaps=r,this.pixelRatio=t,this.resolution=e,this.alignFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=[1,0,0,1,0,0],this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={}}return e.prototype.createLabel=function(e,t,r,n){var i=e+t+r+n;if(this.labels_[i])return this.labels_[i];var o=n?this.strokeStates[n]:null,a=r?this.fillStates[r]:null,s=this.textStates[t],l=this.pixelRatio,c=[s.scale[0]*l,s.scale[1]*l],u=Array.isArray(e),p=s.justify?zv[s.justify]:d_(Array.isArray(e)?e[0]:e,s.textAlign||vr),h=n&&o.lineWidth?o.lineWidth:0,d=u?e:e.split("\n").reduce(f_,[]),f=function(e,t){for(var r=[],n=[],i=[],o=0,a=0,s=0,l=0,c=0,u=t.length;c<=u;c+=2){var p=t[c];if("\n"!==p&&c!==u){var h=t[c+1]||e.font,d=Pr(h,p);r.push(d),a+=d;var f=Ar(h);n.push(f),l=Math.max(l,f)}else o=Math.max(o,a),i.push(a),a=0,s+=l}return{width:o,height:s,widths:r,heights:n,lineWidths:i}}(s,d),g=f.width,y=f.height,m=f.widths,v=f.heights,_=f.lineWidths,w=g+h,S=[],E=(w+2)*c[0],b=(y+h)*c[1],C={width:E<0?Math.floor(E):Math.ceil(E),height:b<0?Math.floor(b):Math.ceil(b),contextInstructions:S};(1==c[0]&&1==c[1]||S.push("scale",c),n)&&(S.push("strokeStyle",o.strokeStyle),S.push("lineWidth",h),S.push("lineCap",o.lineCap),S.push("lineJoin",o.lineJoin),S.push("miterLimit",o.miterLimit),(T?OffscreenCanvasRenderingContext2D:CanvasRenderingContext2D).prototype.setLineDash&&(S.push("setLineDash",[o.lineDash]),S.push("lineDashOffset",o.lineDashOffset)));r&&S.push("fillStyle",a.fillStyle),S.push("textBaseline","middle"),S.push("textAlign","center");for(var L,A=.5-p,x=p*w+A*h,P=[],O=[],I=0,R=0,M=0,D=0,N=0,Z=d.length;N<Z;N+=2){var k=d[N];if("\n"!==k){var F=d[N+1]||s.font;F!==L&&(n&&P.push("font",F),r&&O.push("font",F),L=F),I=Math.max(I,v[M]);var U=[k,x+A*m[M]+p*(m[M]-_[D]),.5*(h+I)+R];x+=m[M],n&&P.push("strokeText",U),r&&O.push("fillText",U),++M}else R+=I,I=0,x=p*w+A*h,++D}return Array.prototype.push.apply(S,P),Array.prototype.push.apply(S,O),this.labels_[i]=C,C},e.prototype.replayTextBackground_=function(e,t,r,n,i,o,a){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,r),e.lineTo.apply(e,n),e.lineTo.apply(e,i),e.lineTo.apply(e,t),o&&(this.alignFill_=o[2],this.fill_(e)),a&&(this.setStrokeStyle_(e,a),e.stroke())},e.prototype.calculateImageOrLabelDimensions_=function(e,t,r,n,i,o,a,s,l,c,u,p,h,d,f,g){var y,m=r-(a*=p[0]),v=n-(s*=p[1]),_=i+l>e?e-l:i,w=o+c>t?t-c:o,S=d[3]+_*p[0]+d[1],E=d[0]+w*p[1]+d[2],b=m-d[3],C=v-d[0];return(f||0!==u)&&(s_[0]=b,u_[0]=b,s_[1]=C,l_[1]=C,l_[0]=b+S,c_[0]=l_[0],c_[1]=C+E,u_[1]=c_[1]),0!==u?(k(y=B([1,0,0,1,0,0],r,n,1,1,u,-r,-n),s_),k(y,l_),k(y,c_),k(y,u_),ie(Math.min(s_[0],l_[0],c_[0],u_[0]),Math.min(s_[1],l_[1],c_[1],u_[1]),Math.max(s_[0],l_[0],c_[0],u_[0]),Math.max(s_[1],l_[1],c_[1],u_[1]),a_)):ie(Math.min(b,b+S),Math.min(C,C+E),Math.max(b,b+S),Math.max(C,C+E),a_),h&&(m=Math.round(m),v=Math.round(v)),{drawImageX:m,drawImageY:v,drawImageW:_,drawImageH:w,originX:l,originY:c,declutterBox:{minX:a_[0],minY:a_[1],maxX:a_[2],maxY:a_[3],value:g},canvasTransform:y,scale:p}},e.prototype.replayImageOrLabel_=function(e,t,r,n,i,o,a){var s=!(!o&&!a),l=n.declutterBox,c=e.canvas,u=a?a[2]*n.scale[0]/2:0;return l.minX-u<=c.width/t&&l.maxX+u>=0&&l.minY-u<=c.height/t&&l.maxY+u>=0&&(s&&this.replayTextBackground_(e,s_,l_,c_,u_,o,a),Ir(e,n.canvasTransform,i,r,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0},e.prototype.fill_=function(e){if(this.alignFill_){var t=k(this.renderedTransform_,[0,0]),r=512*this.pixelRatio;e.save(),e.translate(t[0]%r,t[1]%r),e.rotate(this.viewRotation_)}e.fill(),this.alignFill_&&e.restore()},e.prototype.setStrokeStyle_=function(e,t){e.strokeStyle=t[1],e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.setLineDash&&(e.lineDashOffset=t[7],e.setLineDash(t[6]))},e.prototype.drawLabelWithPointPlacement_=function(e,t,r,n){var i=this.textStates[t],o=this.createLabel(e,t,n,r),a=this.strokeStates[r],s=this.pixelRatio,l=d_(Array.isArray(e)?e[0]:e,i.textAlign||vr),c=zv[i.textBaseline||_r],u=a&&a.lineWidth?a.lineWidth:0;return{label:o,anchorX:l*(o.width/s-2*i.scale[0])+2*(.5-l)*u,anchorY:c*o.height/s+2*(.5-c)*u}},e.prototype.execute_=function(e,t,r,n,i,o,a,s){var l,c,u;this.pixelCoordinates_&&f(r,this.renderedTransform_)?l=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),l=Oi(this.coordinates,0,this.coordinates.length,2,r,this.pixelCoordinates_),c=this.renderedTransform_,u=r,c[0]=u[0],c[1]=u[1],c[2]=u[2],c[3]=u[3],c[4]=u[4],c[5]=u[5]);for(var p,h,d,g,y,m,v,_,w,S,E,b,C,L,T,A,x=0,P=n.length,O=0,I=0,R=0,M=null,D=null,N=this.coordinateCache_,Z=this.viewRotation_,k=Math.round(1e12*Math.atan2(-r[1],r[0]))/1e12,F={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:Z},U=this.instructions!=n||this.overlaps?0:200;x<P;){var B=n[x];switch(B[0]){case Rv.BEGIN_GEOMETRY:C=B[1],A=B[3],C.getGeometry()?void 0===a||Te(a,A.getExtent())?++x:x=B[2]+1:x=B[2];break;case Rv.BEGIN_PATH:I>U&&(this.fill_(e),I=0),R>U&&(e.stroke(),R=0),I||R||(e.beginPath(),g=NaN,y=NaN),++x;break;case Rv.CIRCLE:var G=l[O=B[1]],j=l[O+1],W=l[O+2]-G,H=l[O+3]-j,q=Math.sqrt(W*W+H*H);e.moveTo(G+q,j),e.arc(G,j,q,0,2*Math.PI,!0),++x;break;case Rv.CLOSE_PATH:e.closePath(),++x;break;case Rv.CUSTOM:O=B[1],p=B[2];var V=B[3],z=B[4],Y=6==B.length?B[5]:void 0;F.geometry=V,F.feature=C,x in N||(N[x]=[]);var K=N[x];Y?Y(l,O,p,2,K):(K[0]=l[O],K[1]=l[O+1],K.length=2),z(K,F),++x;break;case Rv.DRAW_IMAGE:O=B[1],p=B[2],_=B[3],h=B[4],d=B[5];var X=B[6],$=B[7],J=B[8],Q=B[9],ee=B[10],te=B[11],re=B[12],ne=B[13],ie=B[14],oe=B[15];if(!_&&B.length>=20){w=B[19],S=B[20],E=B[21],b=B[22];var ae=this.drawLabelWithPointPlacement_(w,S,E,b);_=ae.label,B[3]=_;var se=B[23];h=(ae.anchorX-se)*this.pixelRatio,B[4]=h;var le=B[24];d=(ae.anchorY-le)*this.pixelRatio,B[5]=d,X=_.height,B[6]=X,ne=_.width,B[13]=ne}var ce=void 0;B.length>25&&(ce=B[25]);var ue=void 0,pe=void 0,he=void 0;B.length>17?(ue=B[16],pe=B[17],he=B[18]):(ue=wr,pe=!1,he=!1),ee&&k?te+=Z:ee||k||(te-=Z);for(var de=0;O<p;O+=2)if(!(ce&&ce[de++]<ne/this.pixelRatio)){var fe=[e,t,_,je=this.calculateImageOrLabelDimensions_(_.width,_.height,l[O],l[O+1],ne,X,h,d,J,Q,te,re,i,ue,pe||he,C),$,pe?M:null,he?D:null];if(s){if("none"===ie)continue;if("obstacle"===ie){s.insert(je.declutterBox);continue}var ge=void 0,ye=void 0;if(oe){var me=p-O;if(!oe[me]){oe[me]=fe;continue}if(ge=oe[me],delete oe[me],ye=p_(ge),s.collides(ye))continue}if(s.collides(je.declutterBox))continue;ge&&(s.insert(ye),this.replayImageOrLabel_.apply(this,ge)),s.insert(je.declutterBox)}this.replayImageOrLabel_.apply(this,fe)}++x;break;case Rv.DRAW_CHARS:var ve=B[1],_e=B[2],we=B[3],Se=B[4];b=B[5];var Ee=B[6],be=B[7],Ce=B[8];E=B[9];var Le=B[10];w=B[11],S=B[12];var Ae=[B[13],B[13]],xe=this.textStates[S],Pe=xe.font,Oe=[xe.scale[0]*be,xe.scale[1]*be],Ie=void 0;Pe in this.widths_?Ie=this.widths_[Pe]:(Ie={},this.widths_[Pe]=Ie);var Re=Ys(l,ve,_e,2),Me=Math.abs(Oe[0])*Or(Pe,w,Ie);if(Se||Me<=Re){var De=this.textStates[S].textAlign,Ne=o_(l,ve,_e,2,w,(Re-Me)*zv[De],Ee,Math.abs(Oe[0]),Or,Pe,Ie,k?0:this.viewRotation_);e:if(Ne){var Ze=[],ke=void 0,Fe=void 0,Ue=void 0,Be=void 0,Ge=void 0;if(E)for(ke=0,Fe=Ne.length;ke<Fe;++ke){Ue=(Ge=Ne[ke])[4],Be=this.createLabel(Ue,S,"",E),h=Ge[2]+(Oe[0]<0?-Le:Le),d=we*Be.height+2*(.5-we)*Le*Oe[1]/Oe[0]-Ce;var je=this.calculateImageOrLabelDimensions_(Be.width,Be.height,Ge[0],Ge[1],Be.width,Be.height,h,d,0,0,Ge[3],Ae,!1,wr,!1,C);if(s&&s.collides(je.declutterBox))break e;Ze.push([e,t,Be,je,1,null,null])}if(b)for(ke=0,Fe=Ne.length;ke<Fe;++ke){Ue=(Ge=Ne[ke])[4],Be=this.createLabel(Ue,S,b,""),h=Ge[2],d=we*Be.height-Ce;je=this.calculateImageOrLabelDimensions_(Be.width,Be.height,Ge[0],Ge[1],Be.width,Be.height,h,d,0,0,Ge[3],Ae,!1,wr,!1,C);if(s&&s.collides(je.declutterBox))break e;Ze.push([e,t,Be,je,1,null,null])}s&&s.load(Ze.map(p_));for(var We=0,He=Ze.length;We<He;++We)this.replayImageOrLabel_.apply(this,Ze[We])}}++x;break;case Rv.END_GEOMETRY:if(void 0!==o){var qe=o(C=B[1],A);if(qe)return qe}++x;break;case Rv.FILL:U?I++:this.fill_(e),++x;break;case Rv.MOVE_TO_LINE_TO:for(O=B[1],p=B[2],L=l[O],v=(T=l[O+1])+.5|0,(m=L+.5|0)===g&&v===y||(e.moveTo(L,T),g=m,y=v),O+=2;O<p;O+=2)m=(L=l[O])+.5|0,v=(T=l[O+1])+.5|0,O!=p-2&&m===g&&v===y||(e.lineTo(L,T),g=m,y=v);++x;break;case Rv.SET_FILL_STYLE:M=B,this.alignFill_=B[2],I&&(this.fill_(e),I=0,R&&(e.stroke(),R=0)),e.fillStyle=B[1],++x;break;case Rv.SET_STROKE_STYLE:D=B,R&&(e.stroke(),R=0),this.setStrokeStyle_(e,B),++x;break;case Rv.STROKE:U?R++:e.stroke(),++x;break;default:++x}}I&&this.fill_(e),R&&e.stroke()},e.prototype.execute=function(e,t,r,n,i,o){this.viewRotation_=n,this.execute_(e,t,r,this.instructions,i,void 0,void 0,o)},e.prototype.executeHitDetection=function(e,t,r,n,i){return this.viewRotation_=r,this.execute_(e,1,t,this.hitDetectionInstructions,!0,n,i)},e}();const y_=g_;var m_=["Polygon","Circle","LineString","Image","Text","Default"],v_=function(){function e(e,t,r,n,i,o){this.maxExtent_=e,this.overlaps_=n,this.pixelRatio_=r,this.resolution_=t,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=[1,0,0,1,0,0],this.createExecutors_(i)}return e.prototype.clip=function(e,t){var r=this.getClipCoords(t);e.beginPath(),e.moveTo(r[0],r[1]),e.lineTo(r[2],r[3]),e.lineTo(r[4],r[5]),e.lineTo(r[6],r[7]),e.clip()},e.prototype.createExecutors_=function(e){for(var t in e){var r=this.executorsByZIndex_[t];void 0===r&&(r={},this.executorsByZIndex_[t]=r);var n=e[t];for(var i in n){var o=n[i];r[i]=new y_(this.resolution_,this.pixelRatio_,this.overlaps_,o)}}},e.prototype.hasExecutors=function(e){for(var t in this.executorsByZIndex_)for(var r=this.executorsByZIndex_[t],n=0,i=e.length;n<i;++n)if(e[n]in r)return!0;return!1},e.prototype.forEachFeatureAtCoordinate=function(e,t,r,n,i,o){var a=2*(n=Math.round(n))+1,s=B(this.hitDetectionTransform_,n+.5,n+.5,1/t,-1/t,-r,-e[0],-e[1]),c=!this.hitDetectionContext_;c&&(this.hitDetectionContext_=or(a,a));var u,p=this.hitDetectionContext_;p.canvas.width!==a||p.canvas.height!==a?(p.canvas.width=a,p.canvas.height=a):c||p.clearRect(0,0,a,a),void 0!==this.renderBuffer_&&(ue(u=[1/0,1/0,-1/0,-1/0],e),X(u,t*(this.renderBuffer_+n),u));var h,d=function(e){if(void 0!==__[e])return __[e];for(var t=2*e+1,r=e*e,n=new Array(r+1),i=0;i<=e;++i)for(var o=0;o<=e;++o){var a=i*i+o*o;if(a>r)break;var s=n[a];s||(s=[],n[a]=s),s.push(4*((e+i)*t+(e+o))+3),i>0&&s.push(4*((e-i)*t+(e+o))+3),o>0&&(s.push(4*((e+i)*t+(e-o))+3),i>0&&s.push(4*((e-i)*t+(e-o))+3))}for(var l=[],c=(i=0,n.length);i<c;++i)n[i]&&l.push.apply(l,n[i]);return __[e]=l,l}(n);function f(e,t){for(var r=p.getImageData(0,0,a,a).data,s=0,l=d.length;s<l;s++)if(r[d[s]]>0){if(!o||"Image"!==h&&"Text"!==h||-1!==o.indexOf(e)){var c=(d[s]-3)/4,u=n-c%a,f=n-(c/a|0),g=i(e,t,u*u+f*f);if(g)return g}p.clearRect(0,0,a,a);break}}var g,y,m,v,_,w=Object.keys(this.executorsByZIndex_).map(Number);for(w.sort(l),g=w.length-1;g>=0;--g){var S=w[g].toString();for(m=this.executorsByZIndex_[S],y=m_.length-1;y>=0;--y)if(void 0!==(v=m[h=m_[y]])&&(_=v.executeHitDetection(p,s,r,f,u)))return _}},e.prototype.getClipCoords=function(e){var t=this.maxExtent_;if(!t)return null;var r=t[0],n=t[1],i=t[2],o=t[3],a=[r,n,r,o,i,o,i,n];return Oi(a,0,8,2,e,a),a},e.prototype.isEmpty=function(){return at(this.executorsByZIndex_)},e.prototype.execute=function(e,t,r,n,i,o,a){var s=Object.keys(this.executorsByZIndex_).map(Number);s.sort(l),this.maxExtent_&&(e.save(),this.clip(e,r));var c,u,p,h,d,f,g=o||m_;for(a&&s.reverse(),c=0,u=s.length;c<u;++c){var y=s[c].toString();for(d=this.executorsByZIndex_[y],p=0,h=g.length;p<h;++p){void 0!==(f=d[g[p]])&&f.execute(e,t,r,n,i,a)}}this.maxExtent_&&e.restore()},e}(),__={};const w_=v_;var S_=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),E_=function(e){function t(t,r,n,i,o,a,s){var l=e.call(this)||this;return l.context_=t,l.pixelRatio_=r,l.extent_=n,l.transform_=i,l.viewRotation_=o,l.squaredTolerance_=a,l.userTransform_=s,l.contextFillState_=null,l.contextStrokeState_=null,l.contextTextState_=null,l.fillState_=null,l.strokeState_=null,l.image_=null,l.imageAnchorX_=0,l.imageAnchorY_=0,l.imageHeight_=0,l.imageOpacity_=0,l.imageOriginX_=0,l.imageOriginY_=0,l.imageRotateWithView_=!1,l.imageRotation_=0,l.imageScale_=[0,0],l.imageWidth_=0,l.text_="",l.textOffsetX_=0,l.textOffsetY_=0,l.textRotateWithView_=!1,l.textRotation_=0,l.textScale_=[0,0],l.textFillState_=null,l.textStrokeState_=null,l.textState_=null,l.pixelCoordinates_=[],l.tmpLocalTransform_=[1,0,0,1,0,0],l}return S_(t,e),t.prototype.drawImages_=function(e,t,r,n){if(this.image_){var i=Oi(e,t,r,n,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,s=o.globalAlpha;1!=this.imageOpacity_&&(o.globalAlpha=s*this.imageOpacity_);var l=this.imageRotation_;this.imageRotateWithView_&&(l+=this.viewRotation_);for(var c=0,u=i.length;c<u;c+=2){var p=i[c]-this.imageAnchorX_,h=i[c+1]-this.imageAnchorY_;if(0!==l||1!=this.imageScale_[0]||1!=this.imageScale_[1]){var d=p+this.imageAnchorX_,f=h+this.imageAnchorY_;B(a,d,f,1,1,l,-d,-f),o.setTransform.apply(o,a),o.translate(d,f),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.setTransform(1,0,0,1,0,0)}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,p,h,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(o.globalAlpha=s)}},t.prototype.drawText_=function(e,t,r,n){if(this.textState_&&""!==this.text_){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var i=Oi(e,t,r,n,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.textRotation_;for(this.textRotateWithView_&&(a+=this.viewRotation_);t<r;t+=n){var s=i[t]+this.textOffsetX_,l=i[t+1]+this.textOffsetY_;if(0!==a||1!=this.textScale_[0]||1!=this.textScale_[1]){var c=B(this.tmpLocalTransform_,s,l,1,1,a,-s,-l);o.setTransform.apply(o,c),o.translate(s,l),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.setTransform(1,0,0,1,0,0)}else this.textStrokeState_&&o.strokeText(this.text_,s,l),this.textFillState_&&o.fillText(this.text_,s,l)}}},t.prototype.moveToLineTo_=function(e,t,r,n,i){var o=this.context_,a=Oi(e,t,r,n,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);var s=a.length;i&&(s-=2);for(var l=2;l<s;l+=2)o.lineTo(a[l],a[l+1]);return i&&o.closePath(),r},t.prototype.drawRings_=function(e,t,r,n){for(var i=0,o=r.length;i<o;++i)t=this.moveToLineTo_(e,t,r[i],n,!0);return t},t.prototype.drawCircle=function(e){if(Te(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var t=function(e,t,r){var n=e.getFlatCoordinates();if(n){var i=e.getStride();return Oi(n,0,n.length,i,t,r)}return null}(e,this.transform_,this.pixelCoordinates_),r=t[2]-t[0],n=t[3]-t[1],i=Math.sqrt(r*r+n*n),o=this.context_;o.beginPath(),o.arc(t[0],t[1],i,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}""!==this.text_&&this.drawText_(e.getCenter(),0,2,2)}},t.prototype.setStyle=function(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())},t.prototype.setTransform=function(e){this.transform_=e},t.prototype.drawGeometry=function(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e)}},t.prototype.drawFeature=function(e,t){var r=t.getGeometryFunction()(e);r&&Te(this.extent_,r.getExtent())&&(this.setStyle(t),this.drawGeometry(r))},t.prototype.drawGeometryCollection=function(e){for(var t=e.getGeometriesArray(),r=0,n=t.length;r<n;++r)this.drawGeometry(t[r])},t.prototype.drawPoint=function(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var t=e.getFlatCoordinates(),r=e.getStride();this.image_&&this.drawImages_(t,0,t.length,r),""!==this.text_&&this.drawText_(t,0,t.length,r)},t.prototype.drawMultiPoint=function(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var t=e.getFlatCoordinates(),r=e.getStride();this.image_&&this.drawImages_(t,0,t.length,r),""!==this.text_&&this.drawText_(t,0,t.length,r)},t.prototype.drawLineString=function(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Te(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var t=this.context_,r=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(r,0,r.length,e.getStride(),!1),t.stroke()}if(""!==this.text_){var n=e.getFlatMidpoint();this.drawText_(n,0,2,2)}}},t.prototype.drawMultiLineString=function(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var t=e.getExtent();if(Te(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var r=this.context_,n=e.getFlatCoordinates(),i=0,o=e.getEnds(),a=e.getStride();r.beginPath();for(var s=0,l=o.length;s<l;++s)i=this.moveToLineTo_(n,i,o[s],a,!1);r.stroke()}if(""!==this.text_){var c=e.getFlatMidpoints();this.drawText_(c,0,c.length,2)}}},t.prototype.drawPolygon=function(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Te(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(""!==this.text_){var r=e.getFlatInteriorPoint();this.drawText_(r,0,2,2)}}},t.prototype.drawMultiPolygon=function(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Te(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var t=this.context_,r=e.getOrientedFlatCoordinates(),n=0,i=e.getEndss(),o=e.getStride();t.beginPath();for(var a=0,s=i.length;a<s;++a){var l=i[a];n=this.drawRings_(r,n,l,o)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(""!==this.text_){var c=e.getFlatInteriorPoints();this.drawText_(c,0,c.length,2)}}},t.prototype.setContextFillState_=function(e){var t=this.context_,r=this.contextFillState_;r?r.fillStyle!=e.fillStyle&&(r.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})},t.prototype.setContextStrokeState_=function(e){var t=this.context_,r=this.contextStrokeState_;r?(r.lineCap!=e.lineCap&&(r.lineCap=e.lineCap,t.lineCap=e.lineCap),t.setLineDash&&(f(r.lineDash,e.lineDash)||t.setLineDash(r.lineDash=e.lineDash),r.lineDashOffset!=e.lineDashOffset&&(r.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset)),r.lineJoin!=e.lineJoin&&(r.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),r.lineWidth!=e.lineWidth&&(r.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),r.miterLimit!=e.miterLimit&&(r.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),r.strokeStyle!=e.strokeStyle&&(r.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})},t.prototype.setContextTextState_=function(e){var t=this.context_,r=this.contextTextState_,n=e.textAlign?e.textAlign:vr;r?(r.font!=e.font&&(r.font=e.font,t.font=e.font),r.textAlign!=n&&(r.textAlign=n,t.textAlign=n),r.textBaseline!=e.textBaseline&&(r.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=n,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:n,textBaseline:e.textBaseline})},t.prototype.setFillStrokeStyle=function(e,t){var r=this;if(e){var n=e.getColor();this.fillState_={fillStyle:qd(n||dr)}}else this.fillState_=null;if(t){var i=t.getColor(),o=t.getLineCap(),a=t.getLineDash(),s=t.getLineDashOffset(),l=t.getLineJoin(),c=t.getWidth(),u=t.getMiterLimit(),p=a||gr;this.strokeState_={lineCap:void 0!==o?o:fr,lineDash:1===this.pixelRatio_?p:p.map((function(e){return e*r.pixelRatio_})),lineDashOffset:(s||0)*this.pixelRatio_,lineJoin:void 0!==l?l:yr,lineWidth:(void 0!==c?c:1)*this.pixelRatio_,miterLimit:void 0!==u?u:10,strokeStyle:qd(i||mr)}}else this.strokeState_=null},t.prototype.setImageStyle=function(e){var t;if(e&&(t=e.getSize())){var r=e.getAnchor(),n=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=r[0]*this.pixelRatio_,this.imageAnchorY_=r[1]*this.pixelRatio_,this.imageHeight_=t[1]*this.pixelRatio_,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=n[0],this.imageOriginY_=n[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation(),this.imageScale_=e.getScaleArray(),this.imageWidth_=t[0]*this.pixelRatio_}else this.image_=null},t.prototype.setTextStyle=function(e){if(e){var t=e.getFill();if(t){var r=t.getColor();this.textFillState_={fillStyle:qd(r||dr)}}else this.textFillState_=null;var n=e.getStroke();if(n){var i=n.getColor(),o=n.getLineCap(),a=n.getLineDash(),s=n.getLineDashOffset(),l=n.getLineJoin(),c=n.getWidth(),u=n.getMiterLimit();this.textStrokeState_={lineCap:void 0!==o?o:fr,lineDash:a||gr,lineDashOffset:s||0,lineJoin:void 0!==l?l:yr,lineWidth:void 0!==c?c:1,miterLimit:void 0!==u?u:10,strokeStyle:qd(i||mr)}}else this.textStrokeState_=null;var p=e.getFont(),h=e.getOffsetX(),d=e.getOffsetY(),f=e.getRotateWithView(),g=e.getRotation(),y=e.getScaleArray(),m=e.getText(),v=e.getTextAlign(),_=e.getTextBaseline();this.textState_={font:void 0!==p?p:hr,textAlign:void 0!==v?v:vr,textBaseline:void 0!==_?_:_r},this.text_=void 0!==m?Array.isArray(m)?m.reduce((function(e,t,r){return e+(r%2?" ":t)}),""):m:"",this.textOffsetX_=void 0!==h?this.pixelRatio_*h:0,this.textOffsetY_=void 0!==d?this.pixelRatio_*d:0,this.textRotateWithView_=void 0!==f&&f,this.textRotation_=void 0!==g?g:0,this.textScale_=[this.pixelRatio_*y[0],this.pixelRatio_*y[1]]}else this.text_=""},t}(Mv);const b_=E_;var C_=.5;var L_={Point:function(e,t,r,n,i){var o,a=r.getImage(),s=r.getText();if(a){if(a.getImageState()!=xd)return;var l=e;if(i){var c=a.getDeclutterMode();if("none"!==c)if(l=i,"obstacle"===c){var u=e.getBuilder(r.getZIndex(),"Image");u.setImageStyle(a,o),u.drawPoint(t,n)}else s&&s.getText()&&(o={})}var p=l.getBuilder(r.getZIndex(),"Image");p.setImageStyle(a,o),p.drawPoint(t,n)}if(s&&s.getText()){var h=e;i&&(h=i);var d=h.getBuilder(r.getZIndex(),"Text");d.setTextStyle(s,o),d.drawText(t,n)}},LineString:function(e,t,r,n,i){var o=r.getStroke();if(o){var a=e.getBuilder(r.getZIndex(),"LineString");a.setFillStrokeStyle(null,o),a.drawLineString(t,n)}var s=r.getText();if(s&&s.getText()){var l=(i||e).getBuilder(r.getZIndex(),"Text");l.setTextStyle(s),l.drawText(t,n)}},Polygon:function(e,t,r,n,i){var o=r.getFill(),a=r.getStroke();if(o||a){var s=e.getBuilder(r.getZIndex(),"Polygon");s.setFillStrokeStyle(o,a),s.drawPolygon(t,n)}var l=r.getText();if(l&&l.getText()){var c=(i||e).getBuilder(r.getZIndex(),"Text");c.setTextStyle(l),c.drawText(t,n)}},MultiPoint:function(e,t,r,n,i){var o,a=r.getImage(),s=r.getText();if(a){if(a.getImageState()!=xd)return;var l=e;if(i){var c=a.getDeclutterMode();if("none"!==c)if(l=i,"obstacle"===c){var u=e.getBuilder(r.getZIndex(),"Image");u.setImageStyle(a,o),u.drawMultiPoint(t,n)}else s&&s.getText()&&(o={})}var p=l.getBuilder(r.getZIndex(),"Image");p.setImageStyle(a,o),p.drawMultiPoint(t,n)}if(s&&s.getText()){var h=e;i&&(h=i);var d=h.getBuilder(r.getZIndex(),"Text");d.setTextStyle(s,o),d.drawText(t,n)}},MultiLineString:function(e,t,r,n,i){var o=r.getStroke();if(o){var a=e.getBuilder(r.getZIndex(),"LineString");a.setFillStrokeStyle(null,o),a.drawMultiLineString(t,n)}var s=r.getText();if(s&&s.getText()){var l=(i||e).getBuilder(r.getZIndex(),"Text");l.setTextStyle(s),l.drawText(t,n)}},MultiPolygon:function(e,t,r,n,i){var o=r.getFill(),a=r.getStroke();if(a||o){var s=e.getBuilder(r.getZIndex(),"Polygon");s.setFillStrokeStyle(o,a),s.drawMultiPolygon(t,n)}var l=r.getText();if(l&&l.getText()){var c=(i||e).getBuilder(r.getZIndex(),"Text");c.setTextStyle(l),c.drawText(t,n)}},GeometryCollection:function(e,t,r,n,i){var o,a,s=t.getGeometriesArray();for(o=0,a=s.length;o<a;++o){(0,L_[s[o].getType()])(e,s[o],r,n,i)}},Circle:function(e,t,r,n,i){var o=r.getFill(),a=r.getStroke();if(o||a){var s=e.getBuilder(r.getZIndex(),"Circle");s.setFillStrokeStyle(o,a),s.drawCircle(t,n)}var l=r.getText();if(l&&l.getText()){var c=(i||e).getBuilder(r.getZIndex(),"Text");c.setTextStyle(l),c.drawText(t,n)}}};function T_(e,t){return parseInt(o(e),10)-parseInt(o(t),10)}function A_(e,t){var r=x_(e,t);return r*r}function x_(e,t){return.5*e/t}function P_(e,t,r,n,i,o,a){var s=!1,l=r.getImage();if(l){var c=l.getImageState();c==xd||c==Pd?l.unlistenImageChange(i):(c==Td&&l.load(),l.listenImageChange(i),s=!0)}return function(e,t,r,n,i,o){var a=r.getGeometryFunction()(t);if(!a)return;var s=a.simplifyTransformed(n,i);if(r.getRenderer())O_(e,s,r,t);else{(0,L_[s.getType()])(e,s,r,t,o)}}(e,t,r,n,o,a),s}function O_(e,t,r,n){if("GeometryCollection"!=t.getType())e.getBuilder(r.getZIndex(),"Default").drawCustom(t,n,r.getRenderer(),r.getHitDetectionRenderer());else for(var i=t.getGeometries(),o=0,a=i.length;o<a;++o)O_(e,i[o],r,n)}var I_=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),R_=function(e){function t(t){var r=e.call(this,t)||this;return r.boundHandleStyleImageChange_=r.handleStyleImageChange_.bind(r),r.animatingOrInteracting_,r.hitDetectionImageData_=null,r.renderedFeatures_=null,r.renderedRevision_=-1,r.renderedResolution_=NaN,r.renderedExtent_=[1/0,1/0,-1/0,-1/0],r.wrappedRenderedExtent_=[1/0,1/0,-1/0,-1/0],r.renderedRotation_,r.renderedCenter_=null,r.renderedProjection_=null,r.renderedRenderOrder_=null,r.replayGroup_=null,r.replayGroupChanged=!0,r.declutterExecutorGroup=null,r.clipping=!0,r.compositionContext_=null,r.opacity_=1,r}return I_(t,e),t.prototype.renderWorlds=function(e,t,r){var n=t.extent,i=t.viewState,o=i.center,a=i.resolution,s=i.projection,l=i.rotation,c=s.getExtent(),u=this.getLayer().getSource(),p=t.pixelRatio,h=t.viewHints,d=!(h[wn]||h[Sn]),f=this.compositionContext_,g=Math.round(t.size[0]*p),y=Math.round(t.size[1]*p),m=u.getWrapX()&&s.canWrapX(),v=m?Le(c):null,_=m?Math.ceil((n[2]-c[2])/v)+1:1,w=m?Math.floor((n[0]-c[0])/v):0;do{var S=this.getRenderTransform(o,a,l,p,g,y,w*v);e.execute(f,1,S,l,d,void 0,r)}while(++w<_)},t.prototype.setupCompositionContext_=function(){if(1!==this.opacity_){var e=or(this.context.canvas.width,this.context.canvas.height,t_);this.compositionContext_=e}else this.compositionContext_=this.context},t.prototype.releaseCompositionContext_=function(){if(1!==this.opacity_){var e=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=e,ar(this.compositionContext_),t_.push(this.compositionContext_.canvas),this.compositionContext_=null}},t.prototype.renderDeclutter=function(e){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,e,e.declutterTree),this.releaseCompositionContext_())},t.prototype.renderFrame=function(e,t){var r=e.pixelRatio,n=e.layerStatesArray[e.layerIndex];!function(e,t,r){Z(e,t,0,0,r,0,0)}(this.pixelTransform,1/r,1/r),G(this.inversePixelTransform,this.pixelTransform);var i=j(this.pixelTransform);this.useContainer(t,i,this.getBackground(e));var o=this.context,a=o.canvas,s=this.replayGroup_,l=this.declutterExecutorGroup;if((!s||s.isEmpty())&&(!l||l.isEmpty()))return null;var c=Math.round(e.size[0]*r),u=Math.round(e.size[1]*r);a.width!=c||a.height!=u?(a.width=c,a.height=u,a.style.transform!==i&&(a.style.transform=i)):this.containerReused||o.clearRect(0,0,c,u),this.preRender(o,e);var p=e.viewState,h=p.projection;this.opacity_=n.opacity,this.setupCompositionContext_();var d=!1,f=!0;if(n.extent&&this.clipping){var g=gi(n.extent,h);(d=(f=Te(g,e.extent))&&!ee(g,e.extent))&&this.clipUnrotated(this.compositionContext_,e,g)}return f&&this.renderWorlds(s,e),d&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(o,e),this.renderedRotation_!==p.rotation&&(this.renderedRotation_=p.rotation,this.hitDetectionImageData_=null),this.container},t.prototype.getFeatures=function(e){return new Promise(function(t){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){var r=[this.context.canvas.width,this.context.canvas.height];k(this.pixelTransform,r);var n=this.renderedCenter_,i=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,s=this.wrappedRenderedExtent_,c=this.getLayer(),u=[],p=r[0]*C_,h=r[1]*C_;u.push(this.getRenderTransform(n,i,o,C_,p,h,0).slice());var d=c.getSource(),f=a.getExtent();if(d.getWrapX()&&a.canWrapX()&&!ee(f,s)){for(var g=s[0],y=Le(f),m=0,v=void 0;g<f[0];)v=y*--m,u.push(this.getRenderTransform(n,i,o,C_,p,h,v).slice()),g+=y;for(m=0,g=s[2];g>f[2];)v=y*++m,u.push(this.getRenderTransform(n,i,o,C_,p,h,v).slice()),g-=y}this.hitDetectionImageData_=function(e,t,r,n,i,o,a){var s=or(e[0]*C_,e[1]*C_);s.imageSmoothingEnabled=!1;for(var c=s.canvas,u=new b_(s,C_,i,null,a),p=r.length,h=Math.floor(16777215/p),d={},f=1;f<=p;++f){var g=r[f-1],y=g.getStyleFunction()||n;if(n){var m=y(g,o);if(m){Array.isArray(m)||(m=[m]);for(var v="#"+("000000"+(f*h).toString(16)).slice(-6),_=0,w=m.length;_<w;++_){var S=m[_],E=S.getGeometryFunction()(g);if(E&&Te(i,E.getExtent())){var b=S.clone(),C=b.getFill();C&&C.setColor(v);var L=b.getStroke();L&&(L.setColor(v),L.setLineDash(null)),b.setText(void 0);var T=S.getImage();if(T&&0!==T.getOpacity()){var A=T.getImageSize();if(!A)continue;var x=or(A[0],A[1],void 0,{alpha:!1}),P=x.canvas;x.fillStyle=v,x.fillRect(0,0,P.width,P.height),b.setImage(new Wd({img:P,imgSize:A,anchor:T.getAnchor(),anchorXUnits:Cd.PIXELS,anchorYUnits:Cd.PIXELS,offset:T.getOrigin(),opacity:1,size:T.getSize(),scale:T.getScale(),rotation:T.getRotation(),rotateWithView:T.getRotateWithView()}))}var O=b.getZIndex()||0;(M=d[O])||(M={},d[O]=M,M.Polygon=[],M.Circle=[],M.LineString=[],M.Point=[]),M[E.getType().replace("Multi","")].push(E,b)}}}}}for(var I=Object.keys(d).map(Number).sort(l),R=(f=0,I.length);f<R;++f){var M=d[I[f]];for(var D in M){var N=M[D];for(_=0,w=N.length;_<w;_+=2){u.setStyle(N[_+1]);for(var Z=0,k=t.length;Z<k;++Z)u.setTransform(t[Z]),u.drawGeometry(N[_])}}}return s.getImageData(0,0,c.width,c.height)}(r,u,this.renderedFeatures_,c.getStyleFunction(),s,i,o)}t(function(e,t,r){var n=[];if(r){var i=Math.floor(Math.round(e[0])*C_),o=Math.floor(Math.round(e[1])*C_),a=4*(Ie(i,0,r.width-1)+Ie(o,0,r.height-1)*r.width),s=r.data[a],l=r.data[a+1],c=r.data[a+2]+256*(l+256*s),u=Math.floor(16777215/t.length);c&&c%u==0&&n.push(t[c/u-1])}return n}(e,this.renderedFeatures_,this.hitDetectionImageData_))}.bind(this))},t.prototype.forEachFeatureAtCoordinate=function(e,t,r,n,i){var a=this;if(this.replayGroup_){var s,l=t.viewState.resolution,c=t.viewState.rotation,u=this.getLayer(),p={},h=function(e,t,r){var a=o(e),s=p[a];if(s){if(!0!==s&&r<s.distanceSq){if(0===r)return p[a]=!0,i.splice(i.lastIndexOf(s),1),n(e,u,t);s.geometry=t,s.distanceSq=r}}else{if(0===r)return p[a]=!0,n(e,u,t);i.push(p[a]={feature:e,layer:u,geometry:t,distanceSq:r,callback:n})}},d=[this.replayGroup_];return this.declutterExecutorGroup&&d.push(this.declutterExecutorGroup),d.some((function(n){return s=n.forEachFeatureAtCoordinate(e,l,c,r,h,n===a.declutterExecutorGroup&&t.declutterTree?t.declutterTree.all().map((function(e){return e.value})):null)})),s}},t.prototype.handleFontsChanged=function(){var e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()},t.prototype.handleStyleImageChange_=function(e){this.renderIfReadyAndVisible()},t.prototype.prepareFrame=function(e){var t=this.getLayer(),r=t.getSource();if(!r)return!1;var n=e.viewHints[wn],i=e.viewHints[Sn],o=t.getUpdateWhileAnimating(),a=t.getUpdateWhileInteracting();if(this.ready&&!o&&n||!a&&i)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;var s=e.extent,l=e.viewState,c=l.projection,u=l.resolution,p=e.pixelRatio,h=t.getRevision(),d=t.getRenderBuffer(),g=t.getRenderOrder();void 0===g&&(g=T_);var y=l.center.slice(),m=X(s,d*u),v=m.slice(),_=[m.slice()],w=c.getExtent();if(r.getWrapX()&&c.canWrapX()&&!ee(w,e.extent)){var S=Le(w),E=Math.max(Le(m)/2,S);m[0]=w[0]-E,m[2]=w[2]+E,Ht(y,c);var b=Oe(_[0],c);b[0]<w[0]&&b[2]<w[2]?_.push([b[0]+S,b[1],b[2]+S,b[3]]):b[0]>w[0]&&b[2]>w[2]&&_.push([b[0]-S,b[1],b[2]-S,b[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==h&&this.renderedRenderOrder_==g&&ee(this.wrappedRenderedExtent_,m))return f(this.renderedExtent_,v)||(this.hitDetectionImageData_=null,this.renderedExtent_=v),this.renderedCenter_=y,this.replayGroupChanged=!1,!0;this.replayGroup_=null;var C,L=new Xv(x_(u,p),m,u,p);this.getLayer().getDeclutter()&&(C=new Xv(x_(u,p),m,u,p));var T,A=pi();if(A){for(var x=0,P=_.length;x<P;++x){var O=fi(_[x],c);r.loadFeatures(O,yi(u,c),A)}T=ni(A,c)}else for(x=0,P=_.length;x<P;++x)r.loadFeatures(_[x],u,c);var I=A_(u,p),R=!0,M=function(e){var r,n=e.getStyleFunction()||t.getStyleFunction();if(n&&(r=n(e,u)),r){var i=this.renderFeature(e,I,r,L,T,C);R=R&&!i}}.bind(this),D=fi(m,c),N=r.getFeaturesInExtent(D);g&&N.sort(g);for(x=0,P=N.length;x<P;++x)M(N[x]);this.renderedFeatures_=N,this.ready=R;var Z=L.finish(),k=new w_(m,u,p,r.getOverlaps(),Z,t.getRenderBuffer());return C&&(this.declutterExecutorGroup=new w_(m,u,p,r.getOverlaps(),C.finish(),t.getRenderBuffer())),this.renderedResolution_=u,this.renderedRevision_=h,this.renderedRenderOrder_=g,this.renderedExtent_=v,this.wrappedRenderedExtent_=m,this.renderedCenter_=y,this.renderedProjection_=c,this.replayGroup_=k,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0},t.prototype.renderFeature=function(e,t,r,n,i,o){if(!r)return!1;var a=!1;if(Array.isArray(r))for(var s=0,l=r.length;s<l;++s)a=P_(n,e,r[s],t,this.boundHandleStyleImageChange_,i,o)||a;else a=P_(n,e,r,t,this.boundHandleStyleImageChange_,i,o);return a},t}(i_);const M_=R_;var D_=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const N_=function(e){function t(t){return e.call(this,t)||this}return D_(t,e),t.prototype.createRenderer=function(){return new M_(this)},t}(Tv);var Z_=function(){function e(e){this.rbush_=new bv(e),this.items_={}}return e.prototype.insert=function(e,t){var r={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(r),this.items_[o(t)]=r},e.prototype.load=function(e,t){for(var r=new Array(t.length),n=0,i=t.length;n<i;n++){var a=e[n],s=t[n],l={minX:a[0],minY:a[1],maxX:a[2],maxY:a[3],value:s};r[n]=l,this.items_[o(s)]=l}this.rbush_.load(r)},e.prototype.remove=function(e){var t=o(e),r=this.items_[t];return delete this.items_[t],null!==this.rbush_.remove(r)},e.prototype.update=function(e,t){var r=this.items_[o(t)];le([r.minX,r.minY,r.maxX,r.maxY],e)||(this.remove(t),this.insert(e,t))},e.prototype.getAll=function(){return this.rbush_.all().map((function(e){return e.value}))},e.prototype.getInExtent=function(e){var t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map((function(e){return e.value}))},e.prototype.forEach=function(e){return this.forEach_(this.getAll(),e)},e.prototype.forEachInExtent=function(e,t){return this.forEach_(this.getInExtent(e),t)},e.prototype.forEach_=function(e,t){for(var r,n=0,i=e.length;n<i;n++)if(r=t(e[n]))return r;return r},e.prototype.isEmpty=function(){return at(this.items_)},e.prototype.clear=function(){this.rbush_.clear(),this.items_={}},e.prototype.getExtent=function(e){var t=this.rbush_.toJSON();return ie(t.minX,t.minY,t.maxX,t.maxY,e)},e.prototype.concat=function(e){for(var t in this.rbush_.load(e.rbush_.all()),e.items_)this.items_[t]=e.items_[t]},e}();const k_=Z_;var F_=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function U_(e){return e?Array.isArray(e)?function(t){return e}:"function"==typeof e?e:function(t){return[e]}:null}const B_=function(e){function t(t){var r=e.call(this)||this;r.projection=$n(t.projection),r.attributions_=U_(t.attributions),r.attributionsCollapsible_=void 0===t.attributionsCollapsible||t.attributionsCollapsible,r.loading=!1,r.state_=void 0!==t.state?t.state:"ready",r.wrapX_=void 0!==t.wrapX&&t.wrapX,r.interpolate_=!!t.interpolate,r.viewResolver=null,r.viewRejector=null;var n=r;return r.viewPromise_=new Promise((function(e,t){n.viewResolver=e,n.viewRejector=t})),r}return F_(t,e),t.prototype.getAttributions=function(){return this.attributions_},t.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},t.prototype.getProjection=function(){return this.projection},t.prototype.getResolutions=function(){return n()},t.prototype.getView=function(){return this.viewPromise_},t.prototype.getState=function(){return this.state_},t.prototype.getWrapX=function(){return this.wrapX_},t.prototype.getInterpolate=function(){return this.interpolate_},t.prototype.refresh=function(){this.changed()},t.prototype.setAttributions=function(e){this.attributions_=U_(e),this.changed()},t.prototype.setState=function(e){this.state_=e,this.changed()},t}(_t),G_={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function j_(e,t){return[[-1/0,-1/0,1/0,1/0]]}var W_=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),H_=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.feature=r,i.features=n,i}return W_(t,e),t}(tt),q_=function(e){function t(t){var r=this,n=t||{};(r=e.call(this,{attributions:n.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:void 0===n.wrapX||n.wrapX})||this).on,r.once,r.un,r.loader_=v,r.format_=n.format,r.overlaps_=void 0===n.overlaps||n.overlaps,r.url_=n.url,void 0!==n.loader?r.loader_=n.loader:void 0!==r.url_&&(I(r.format_,7),r.loader_=dl(r.url_,r.format_)),r.strategy_=void 0!==n.strategy?n.strategy:j_;var i,o,a=void 0===n.useSpatialIndex||n.useSpatialIndex;return r.featuresRtree_=a?new k_:null,r.loadedExtentsRtree_=new k_,r.loadingExtentsCount_=0,r.nullGeometryFeatures_={},r.idIndex_={},r.uidIndex_={},r.featureChangeKeys_={},r.featuresCollection_=null,Array.isArray(n.features)?o=n.features:n.features&&(o=(i=n.features).getArray()),a||void 0!==i||(i=new Br(o)),void 0!==o&&r.addFeaturesInternal(o),void 0!==i&&r.bindFeaturesCollection_(i),r}return W_(t,e),t.prototype.addFeature=function(e){this.addFeatureInternal(e),this.changed()},t.prototype.addFeatureInternal=function(e){var t=o(e);if(this.addToIndex_(t,e)){this.setupChangeEvents_(t,e);var r=e.getGeometry();if(r){var n=r.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new H_(G_.ADDFEATURE,e))}else this.featuresCollection_&&this.featuresCollection_.remove(e)},t.prototype.setupChangeEvents_=function(e,t){this.featureChangeKeys_[e]=[ut(t,ct.CHANGE,this.handleFeatureChange_,this),ut(t,rt,this.handleFeatureChange_,this)]},t.prototype.addToIndex_=function(e,t){var r=!0,n=t.getId();return void 0!==n&&(n.toString()in this.idIndex_?r=!1:this.idIndex_[n.toString()]=t),r&&(I(!(e in this.uidIndex_),30),this.uidIndex_[e]=t),r},t.prototype.addFeatures=function(e){this.addFeaturesInternal(e),this.changed()},t.prototype.addFeaturesInternal=function(e){for(var t=[],r=[],n=[],i=0,a=e.length;i<a;i++){var s=o(c=e[i]);this.addToIndex_(s,c)&&r.push(c)}i=0;for(var l=r.length;i<l;i++){var c;s=o(c=r[i]);this.setupChangeEvents_(s,c);var u=c.getGeometry();if(u){var p=u.getExtent();t.push(p),n.push(c)}else this.nullGeometryFeatures_[s]=c}if(this.featuresRtree_&&this.featuresRtree_.load(t,n),this.hasListener(G_.ADDFEATURE)){i=0;for(var h=r.length;i<h;i++)this.dispatchEvent(new H_(G_.ADDFEATURE,r[i]))}},t.prototype.bindFeaturesCollection_=function(e){var t=!1;this.addEventListener(G_.ADDFEATURE,(function(r){t||(t=!0,e.push(r.feature),t=!1)})),this.addEventListener(G_.REMOVEFEATURE,(function(r){t||(t=!0,e.remove(r.feature),t=!1)})),e.addEventListener(Nr,function(e){t||(t=!0,this.addFeature(e.element),t=!1)}.bind(this)),e.addEventListener(Zr,function(e){t||(t=!0,this.removeFeature(e.element),t=!1)}.bind(this)),this.featuresCollection_=e},t.prototype.clear=function(e){if(e){for(var t in this.featureChangeKeys_){this.featureChangeKeys_[t].forEach(ht)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){var r=function(e){this.removeFeatureInternal(e)}.bind(this);for(var n in this.featuresRtree_.forEach(r),this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[n])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};var i=new H_(G_.CLEAR);this.dispatchEvent(i),this.changed()},t.prototype.forEachFeature=function(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)},t.prototype.forEachFeatureAtCoordinateDirect=function(e,t){var r=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(r,(function(r){return r.getGeometry().intersectsCoordinate(e)?t(r):void 0}))},t.prototype.forEachFeatureInExtent=function(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)},t.prototype.forEachFeatureIntersectingExtent=function(e,t){return this.forEachFeatureInExtent(e,(function(r){if(r.getGeometry().intersectsExtent(e)){var n=t(r);if(n)return n}}))},t.prototype.getFeaturesCollection=function(){return this.featuresCollection_},t.prototype.getFeatures=function(){var e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),at(this.nullGeometryFeatures_)||h(e,ot(this.nullGeometryFeatures_))),e},t.prototype.getFeaturesAtCoordinate=function(e){var t=[];return this.forEachFeatureAtCoordinateDirect(e,(function(e){t.push(e)})),t},t.prototype.getFeaturesInExtent=function(e,t){var r=this;if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);var n=function(e,t){if(t.canWrapX()){var r=t.getExtent();if(!isFinite(e[0])||!isFinite(e[2]))return[[r[0],e[1],r[2],e[3]]];Oe(e,t);var n=Le(r);if(Le(e)>n)return[[r[0],e[1],r[2],e[3]]];if(e[0]<r[0])return[[e[0]+n,e[1],r[2],e[3]],[r[0],e[1],e[2],e[3]]];if(e[2]>r[2])return[[e[0],e[1],r[2],e[3]],[r[0],e[1],e[2]-n,e[3]]]}return[e]}(e,t);return[].concat.apply([],n.map((function(e){return r.featuresRtree_.getInExtent(e)})))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]},t.prototype.getClosestFeatureToCoordinate=function(e,t){var r=e[0],n=e[1],i=null,o=[NaN,NaN],a=1/0,s=[-1/0,-1/0,1/0,1/0],l=t||y;return this.featuresRtree_.forEachInExtent(s,(function(e){if(l(e)){var t=e.getGeometry(),c=a;if((a=t.closestPointXY(r,n,o,a))<c){i=e;var u=Math.sqrt(a);s[0]=r-u,s[1]=n-u,s[2]=r+u,s[3]=n+u}}})),i},t.prototype.getExtent=function(e){return this.featuresRtree_.getExtent(e)},t.prototype.getFeatureById=function(e){var t=this.idIndex_[e.toString()];return void 0!==t?t:null},t.prototype.getFeatureByUid=function(e){var t=this.uidIndex_[e];return void 0!==t?t:null},t.prototype.getFormat=function(){return this.format_},t.prototype.getOverlaps=function(){return this.overlaps_},t.prototype.getUrl=function(){return this.url_},t.prototype.handleFeatureChange_=function(e){var t=e.target,r=o(t),n=t.getGeometry();if(n){var i=n.getExtent();r in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[r],this.featuresRtree_&&this.featuresRtree_.insert(i,t)):this.featuresRtree_&&this.featuresRtree_.update(i,t)}else r in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[r]=t);var a=t.getId();if(void 0!==a){var s=a.toString();this.idIndex_[s]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[s]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[r]=t;this.changed(),this.dispatchEvent(new H_(G_.CHANGEFEATURE,t))},t.prototype.hasFeature=function(e){var t=e.getId();return void 0!==t?t in this.idIndex_:o(e)in this.uidIndex_},t.prototype.isEmpty=function(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&at(this.nullGeometryFeatures_):!this.featuresCollection_||0===this.featuresCollection_.getLength()},t.prototype.loadFeatures=function(e,t,r){for(var n=this.loadedExtentsRtree_,i=this.strategy_(e,t,r),o=function(e,o){var s=i[e];n.forEachInExtent(s,(function(e){return ee(e.extent,s)}))||(++a.loadingExtentsCount_,a.dispatchEvent(new H_(G_.FEATURESLOADSTART)),a.loader_.call(a,s,t,r,function(e){--this.loadingExtentsCount_,this.dispatchEvent(new H_(G_.FEATURESLOADEND,void 0,e))}.bind(a),function(){--this.loadingExtentsCount_,this.dispatchEvent(new H_(G_.FEATURESLOADERROR))}.bind(a)),n.insert(s,{extent:s.slice()}))},a=this,s=0,l=i.length;s<l;++s)o(s);this.loading=!(this.loader_.length<4)&&this.loadingExtentsCount_>0},t.prototype.refresh=function(){this.clear(!0),this.loadedExtentsRtree_.clear(),e.prototype.refresh.call(this)},t.prototype.removeLoadedExtent=function(e){var t,r=this.loadedExtentsRtree_;r.forEachInExtent(e,(function(r){if(le(r.extent,e))return t=r,!0})),t&&r.remove(t)},t.prototype.removeFeature=function(e){if(e){var t=o(e);t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.removeFeatureInternal(e)&&this.changed()}},t.prototype.removeFeatureInternal=function(e){var t=o(e),r=this.featureChangeKeys_[t];if(r){r.forEach(ht),delete this.featureChangeKeys_[t];var n=e.getId();return void 0!==n&&delete this.idIndex_[n.toString()],delete this.uidIndex_[t],this.dispatchEvent(new H_(G_.REMOVEFEATURE,e)),e}},t.prototype.removeFromIdIndex_=function(e){var t=!1;for(var r in this.idIndex_)if(this.idIndex_[r]===e){delete this.idIndex_[r],t=!0;break}return t},t.prototype.setLoader=function(e){this.loader_=e},t.prototype.setUrl=function(e){I(this.format_,7),this.url_=e,this.setLoader(dl(e,this.format_))},t}(B_);const V_=q_;var z_=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Y_="Point",K_="LineString",X_="Polygon",$_="Circle",J_="drawstart",Q_="drawend",ew="drawabort",tw=function(e){function t(t,r){var n=e.call(this,t)||this;return n.feature=r,n}return z_(t,e),t}(tt),rw=function(e){function t(t){var r=this,n=t;n.stopDown||(n.stopDown=m),(r=e.call(this,n)||this).on,r.once,r.un,r.shouldHandle_=!1,r.downPx_=null,r.downTimeout_,r.lastDragTime_,r.pointerType_,r.freehand_=!1,r.source_=t.source?t.source:null,r.features_=t.features?t.features:null,r.snapTolerance_=t.snapTolerance?t.snapTolerance:12,r.type_=t.type,r.mode_=function(e){switch(e){case"Point":case"MultiPoint":return Y_;case"LineString":case"MultiLineString":return K_;case"Polygon":case"MultiPolygon":return X_;case"Circle":return $_;default:throw new Error("Invalid type: "+e)}}(r.type_),r.stopClick_=!!t.stopClick,r.minPoints_=t.minPoints?t.minPoints:r.mode_===X_?3:2,r.maxPoints_=r.mode_===$_?2:t.maxPoints?t.maxPoints:1/0,r.finishCondition_=t.finishCondition?t.finishCondition:y,r.geometryLayout_=t.geometryLayout?t.geometryLayout:Pi.XY;var i=t.geometryFunction;if(!i){var o,a=r.mode_;if(a===$_)i=function(e,t,r){var n=t||new sl([NaN,NaN]),i=di(e[0],r),o=jt(i,di(e[e.length-1],r));n.setCenterAndRadius(i,Math.sqrt(o),this.geometryLayout_);var a=pi();return a&&n.transform(r,a),n};else a===Y_?o=uo:a===K_?o=$s:a===X_&&(o=Ao),i=function(e,t,r){return t?a===X_?e[0].length?t.setCoordinates([e[0].concat([e[0][0]])],this.geometryLayout_):t.setCoordinates([],this.geometryLayout_):t.setCoordinates(e,this.geometryLayout_):t=new o(e,this.geometryLayout_),t}}return r.geometryFunction_=i,r.dragVertexDelay_=void 0!==t.dragVertexDelay?t.dragVertexDelay:500,r.finishCoordinate_=null,r.sketchFeature_=null,r.sketchPoint_=null,r.sketchCoords_=null,r.sketchLine_=null,r.sketchLineCoords_=null,r.squaredClickTolerance_=t.clickTolerance?t.clickTolerance*t.clickTolerance:36,r.overlay_=new N_({source:new V_({useSpatialIndex:!1,wrapX:!!t.wrapX&&t.wrapX}),style:t.style?t.style:nw(),updateWhileInteracting:!0}),r.geometryName_=t.geometryName,r.condition_=t.condition?t.condition:ga,r.freehandCondition_,t.freehand?r.freehandCondition_=ua:r.freehandCondition_=t.freehandCondition?t.freehandCondition:ya,r.addChangeListener(Jo,r.updateState_),r}return z_(t,e),t.prototype.setMap=function(t){e.prototype.setMap.call(this,t),this.updateState_()},t.prototype.getOverlay=function(){return this.overlay_},t.prototype.handleEvent=function(t){t.originalEvent.type===ct.CONTEXTMENU&&t.originalEvent.preventDefault(),this.freehand_=this.mode_!==Y_&&this.freehandCondition_(t);var r=t.type===Kr.POINTERMOVE,n=!0;!this.freehand_&&this.lastDragTime_&&t.type===Kr.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=t.pixel,this.shouldHandle_=!this.freehand_,r=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0));return this.freehand_&&t.type===Kr.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(t.coordinate),n=!1):this.freehand_&&t.type===Kr.POINTERDOWN?n=!1:r&&this.getPointerCount()<2?(n=t.type===Kr.POINTERMOVE)&&this.freehand_?(this.handlePointerMove_(t),this.shouldHandle_&&t.originalEvent.preventDefault()):("mouse"===t.originalEvent.pointerType||t.type===Kr.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(t):t.type===Kr.DBLCLICK&&(n=!1),e.prototype.handleEvent.call(this,t)&&n},t.prototype.handleDownEvent=function(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(function(){this.handlePointerMove_(new Yr(Kr.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))}.bind(this),this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)},t.prototype.handleUpEvent=function(e){var t=!0;if(0===this.getPointerCount())if(this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e),this.shouldHandle_){var r=!this.finishCoordinate_;r&&this.startDrawing_(e.coordinate),!r&&this.freehand_?this.finishDrawing():this.freehand_||r&&this.mode_!==Y_||(this.atFinish_(e.pixel)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing();return!t&&this.stopClick_&&e.preventDefault(),t},t.prototype.handlePointerMove_=function(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){var t=this.downPx_,r=e.pixel,n=t[0]-r[0],i=t[1]-r[1],o=n*n+i*i;if(this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_,!this.shouldHandle_)return}this.finishCoordinate_?this.modifyDrawing_(e.coordinate):this.createOrUpdateSketchPoint_(e.coordinate.slice())},t.prototype.atFinish_=function(e){var t=!1;if(this.sketchFeature_){var r=!1,n=[this.finishCoordinate_],i=this.mode_;if(i===Y_)t=!0;else if(i===$_)t=2===this.sketchCoords_.length;else if(i===K_)r=this.sketchCoords_.length>this.minPoints_;else if(i===X_){var o=this.sketchCoords_;r=o[0].length>this.minPoints_,n=[o[0][0],o[0][o[0].length-2]]}if(r)for(var a=this.getMap(),s=0,l=n.length;s<l;s++){var c=n[s],u=a.getPixelFromCoordinate(c),p=e[0]-u[0],h=e[1]-u[1],d=this.freehand_?1:this.snapTolerance_;if(t=Math.sqrt(p*p+h*h)<=d){this.finishCoordinate_=c;break}}}return t},t.prototype.createOrUpdateSketchPoint_=function(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new js(new uo(e)),this.updateSketchFeatures_())},t.prototype.createOrUpdateCustomSketchLine_=function(e){this.sketchLine_||(this.sketchLine_=new js);var t=e.getLinearRing(0),r=this.sketchLine_.getGeometry();r?(r.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),r.changed()):(r=new $s(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(r))},t.prototype.startDrawing_=function(e){for(var t=this.getMap().getView().getProjection(),r=Ui(this.geometryLayout_);e.length<r;)e.push(0);this.finishCoordinate_=e,this.mode_===Y_?this.sketchCoords_=e.slice():this.mode_===X_?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new js(new $s(this.sketchLineCoords_)));var n=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new js,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(n),this.updateSketchFeatures_(),this.dispatchEvent(new tw(J_,this.sketchFeature_))},t.prototype.modifyDrawing_=function(e){for(var t,r,n=this.getMap(),i=this.sketchFeature_.getGeometry(),o=n.getView().getProjection(),a=Ui(this.geometryLayout_);e.length<a;)e.push(0);(this.mode_===Y_?r=this.sketchCoords_:this.mode_===X_?(r=(t=this.sketchCoords_[0])[t.length-1],this.atFinish_(n.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):r=(t=this.sketchCoords_)[t.length-1],r[0]=e[0],r[1]=e[1],this.geometryFunction_(this.sketchCoords_,i,o),this.sketchPoint_)&&this.sketchPoint_.getGeometry().setCoordinates(e);if("Polygon"===i.getType()&&this.mode_!==X_)this.createOrUpdateCustomSketchLine_(i);else if(this.sketchLineCoords_){this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_)}this.updateSketchFeatures_()},t.prototype.addToDrawing_=function(e){var t,r,n=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),o=this.mode_;o===K_||o===$_?(this.finishCoordinate_=e.slice(),(r=this.sketchCoords_).length>=this.maxPoints_&&(this.freehand_?r.pop():t=!0),r.push(e.slice()),this.geometryFunction_(r,n,i)):o===X_&&((r=this.sketchCoords_[0]).length>=this.maxPoints_&&(this.freehand_?r.pop():t=!0),r.push(e.slice()),t&&(this.finishCoordinate_=r[0]),this.geometryFunction_(this.sketchCoords_,n,i)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),t&&this.finishDrawing()},t.prototype.removeLastPoint=function(){if(this.sketchFeature_){var e,t=this.sketchFeature_.getGeometry(),r=this.getMap().getView().getProjection(),n=this.mode_;if(n===K_||n===$_){if((e=this.sketchCoords_).splice(-2,1),e.length>=2){this.finishCoordinate_=e[e.length-2].slice();var i=this.finishCoordinate_.slice();e[e.length-1]=i,this.createOrUpdateSketchPoint_(i)}this.geometryFunction_(e,t,r),"Polygon"===t.getType()&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(n===X_){(e=this.sketchCoords_[0]).splice(-2,1);var o=this.sketchLine_.getGeometry();if(e.length>=2){i=e[e.length-2].slice();e[e.length-1]=i,this.createOrUpdateSketchPoint_(i)}o.setCoordinates(e),this.geometryFunction_(this.sketchCoords_,t,r)}1===e.length&&this.abortDrawing(),this.updateSketchFeatures_()}},t.prototype.finishDrawing=function(){var e=this.abortDrawing_();if(e){var t=this.sketchCoords_,r=e.getGeometry(),n=this.getMap().getView().getProjection();this.mode_===K_?(t.pop(),this.geometryFunction_(t,r,n)):this.mode_===X_&&(t[0].pop(),this.geometryFunction_(t,r,n),t=r.getCoordinates()),"MultiPoint"===this.type_?e.setGeometry(new qs([t])):"MultiLineString"===this.type_?e.setGeometry(new el([t])):"MultiPolygon"===this.type_&&e.setGeometry(new nl([t])),this.dispatchEvent(new tw(Q_,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e)}},t.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),e},t.prototype.abortDrawing=function(){var e=this.abortDrawing_();e&&this.dispatchEvent(new tw(ew,e))},t.prototype.appendCoordinates=function(e){var t,r=this.mode_,n=!this.sketchFeature_;if(n&&this.startDrawing_(e[0]),r===K_||r===$_)t=this.sketchCoords_;else{if(r!==X_)return;t=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]}n&&t.shift(),t.pop();for(var i=0;i<e.length;i++)this.addToDrawing_(e[i]);var o=e[e.length-1];this.addToDrawing_(o),this.modifyDrawing_(o)},t.prototype.extend=function(e){var t=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=t.getCoordinates();var r=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=r.slice(),this.sketchCoords_.push(r.slice()),this.sketchPoint_=new js(new uo(r)),this.updateSketchFeatures_(),this.dispatchEvent(new tw(J_,this.sketchFeature_))},t.prototype.updateSketchFeatures_=function(){var e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);var t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)},t.prototype.updateState_=function(){var e=this.getMap(),t=this.getActive();e&&t||this.abortDrawing(),this.overlay_.setMap(t?e:null)},t}(aa);function nw(){var e=tf();return function(t,r){return e[t.getGeometry().getType()]}}const iw=rw;var ow=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),aw="translatestart",sw="translating",lw="translateend",cw=function(e){function t(t,r,n,i,o){var a=e.call(this,t)||this;return a.features=r,a.coordinate=n,a.startCoordinate=i,a.mapBrowserEvent=o,a}return ow(t,e),t}(tt),uw=function(e){function t(t){var r,n=this,i=t||{};if((n=e.call(this,i)||this).on,n.once,n.un,n.lastCoordinate_=null,n.startCoordinate_=null,n.features_=void 0!==i.features?i.features:null,i.layers&&!n.features_)if("function"==typeof i.layers)r=i.layers;else{var o=i.layers;r=function(e){return c(o,e)}}else r=y;return n.layerFilter_=r,n.filter_=i.filter&&!n.features_?i.filter:y,n.hitTolerance_=i.hitTolerance?i.hitTolerance:0,n.condition_=i.condition?i.condition:ua,n.lastFeature_=null,n.addChangeListener(Jo,n.handleActiveChanged_),n}return ow(t,e),t.prototype.handleDownEvent=function(e){if(!e.originalEvent||!this.condition_(e))return!1;if(this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=e.coordinate,this.lastCoordinate_=e.coordinate,this.handleMoveEvent(e);var t=this.features_||new Br([this.lastFeature_]);return this.dispatchEvent(new cw(aw,t,e.coordinate,this.startCoordinate_,e)),!0}return!1},t.prototype.handleUpEvent=function(e){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(e);var t=this.features_||new Br([this.lastFeature_]);return this.dispatchEvent(new cw(lw,t,e.coordinate,this.startCoordinate_,e)),this.startCoordinate_=null,!0}return!1},t.prototype.handleDragEvent=function(e){if(this.lastCoordinate_){var t=e.coordinate,r=t[0]-this.lastCoordinate_[0],n=t[1]-this.lastCoordinate_[1],i=this.features_||new Br([this.lastFeature_]);i.forEach((function(e){var t=e.getGeometry();t.translate(r,n),e.setGeometry(t)})),this.lastCoordinate_=t,this.dispatchEvent(new cw(sw,i,t,this.startCoordinate_,e))}},t.prototype.handleMoveEvent=function(e){var t=e.map.getViewport();this.featuresAtPixel_(e.pixel,e.map)?(t.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),t.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):t.classList.remove("ol-grab","ol-grabbing")},t.prototype.featuresAtPixel_=function(e,t){return t.forEachFeatureAtPixel(e,function(e,t){if(this.filter_(e,t)&&(!this.features_||c(this.features_.getArray(),e)))return e}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})},t.prototype.getHitTolerance=function(){return this.hitTolerance_},t.prototype.setHitTolerance=function(e){this.hitTolerance_=e},t.prototype.setMap=function(t){var r=this.getMap();e.prototype.setMap.call(this,t),this.updateState_(r)},t.prototype.handleActiveChanged_=function(){this.updateState_(null)},t.prototype.updateState_=function(e){var t=this.getMap(),r=this.getActive();t&&r||(t=t||e)&&t.getViewport().classList.remove("ol-grab","ol-grabbing")},t}(aa);const pw=uw;var hw=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function dw(e){return e.feature?e.feature:e.element?e.element:void 0}var fw=[],gw=function(e){function t(t){var r=this,n=t||{},i=n;return i.handleDownEvent||(i.handleDownEvent=y),i.stopDown||(i.stopDown=m),(r=e.call(this,i)||this).source_=n.source?n.source:null,r.vertex_=void 0===n.vertex||n.vertex,r.edge_=void 0===n.edge||n.edge,r.features_=n.features?n.features:null,r.featuresListenerKeys_=[],r.featureChangeListenerKeys_={},r.indexedFeaturesExtents_={},r.pendingFeatures_={},r.pixelTolerance_=void 0!==n.pixelTolerance?n.pixelTolerance:10,r.rBush_=new k_,r.GEOMETRY_SEGMENTERS_={Point:r.segmentPointGeometry_.bind(r),LineString:r.segmentLineStringGeometry_.bind(r),LinearRing:r.segmentLineStringGeometry_.bind(r),Polygon:r.segmentPolygonGeometry_.bind(r),MultiPoint:r.segmentMultiPointGeometry_.bind(r),MultiLineString:r.segmentMultiLineStringGeometry_.bind(r),MultiPolygon:r.segmentMultiPolygonGeometry_.bind(r),GeometryCollection:r.segmentGeometryCollectionGeometry_.bind(r),Circle:r.segmentCircleGeometry_.bind(r)},r}return hw(t,e),t.prototype.addFeature=function(e,t){var r=void 0===t||t,n=o(e),i=e.getGeometry();if(i){var a=this.GEOMETRY_SEGMENTERS_[i.getType()];if(a){this.indexedFeaturesExtents_[n]=i.getExtent([1/0,1/0,-1/0,-1/0]);var s=[];if(a(s,i),1===s.length)this.rBush_.insert(K(s[0]),{feature:e,segment:s[0]});else if(s.length>1){var l=s.map((function(e){return K(e)})),c=s.map((function(t){return{feature:e,segment:t}}));this.rBush_.load(l,c)}}}r&&(this.featureChangeListenerKeys_[n]=ut(e,ct.CHANGE,this.handleFeatureChange_,this))},t.prototype.forEachFeatureAdd_=function(e){this.addFeature(e)},t.prototype.forEachFeatureRemove_=function(e){this.removeFeature(e)},t.prototype.getFeatures_=function(){var e;return this.features_?e=this.features_:this.source_&&(e=this.source_.getFeatures()),e},t.prototype.handleEvent=function(t){var r=this.snapTo(t.pixel,t.coordinate,t.map);return r&&(t.coordinate=r.vertex.slice(0,2),t.pixel=r.vertexPixel),e.prototype.handleEvent.call(this,t)},t.prototype.handleFeatureAdd_=function(e){var t=dw(e);this.addFeature(t)},t.prototype.handleFeatureRemove_=function(e){var t=dw(e);this.removeFeature(t)},t.prototype.handleFeatureChange_=function(e){var t=e.target;if(this.handlingDownUpSequence){var r=o(t);r in this.pendingFeatures_||(this.pendingFeatures_[r]=t)}else this.updateFeature_(t)},t.prototype.handleUpEvent=function(e){var t=ot(this.pendingFeatures_);return t.length&&(t.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1},t.prototype.removeFeature=function(e,t){var r=void 0===t||t,n=o(e),i=this.indexedFeaturesExtents_[n];if(i){var a=this.rBush_,s=[];a.forEachInExtent(i,(function(t){e===t.feature&&s.push(t)}));for(var l=s.length-1;l>=0;--l)a.remove(s[l])}r&&(ht(this.featureChangeListenerKeys_[n]),delete this.featureChangeListenerKeys_[n])},t.prototype.setMap=function(t){var r=this.getMap(),n=this.featuresListenerKeys_,i=this.getFeatures_();r&&(n.forEach(ht),n.length=0,i.forEach(this.forEachFeatureRemove_.bind(this))),e.prototype.setMap.call(this,t),t&&(this.features_?n.push(ut(this.features_,Nr,this.handleFeatureAdd_,this),ut(this.features_,Zr,this.handleFeatureRemove_,this)):this.source_&&n.push(ut(this.source_,G_.ADDFEATURE,this.handleFeatureAdd_,this),ut(this.source_,G_.REMOVEFEATURE,this.handleFeatureRemove_,this)),i.forEach(this.forEachFeatureAdd_.bind(this)))},t.prototype.snapTo=function(e,t,r){var n=K([r.getCoordinateFromPixel([e[0]-this.pixelTolerance_,e[1]+this.pixelTolerance_]),r.getCoordinateFromPixel([e[0]+this.pixelTolerance_,e[1]-this.pixelTolerance_])]),i=this.rBush_.getInExtent(n),o=i.length;if(0===o)return null;var a,s=r.getView().getProjection(),l=di(t,s),c=1/0,u=this.pixelTolerance_*this.pixelTolerance_,p=function(){if(a){var t=r.getPixelFromCoordinate(a);if(jt(e,t)<=u)return{vertex:a,vertexPixel:[Math.round(t[0]),Math.round(t[1])]}}return null};if(this.vertex_){for(var h=0;h<o;++h){"Circle"!==(d=i[h]).feature.getGeometry().getType()&&d.segment.forEach((function(e){var t=di(e,s),r=jt(l,t);r<c&&(a=e,c=r)}))}if(S=p())return S}if(this.edge_){for(h=0;h<o;++h){var d,f=null;if("Circle"===(d=i[h]).feature.getGeometry().getType()){var g=d.feature.getGeometry(),y=pi();y&&(g=g.clone().transform(y,s)),f=hi(kt(l,g),s)}else{var m=d.segment,v=m[0],_=m[1];_&&(fw[0]=di(v,s),fw[1]=di(_,s),f=Ft(l,fw))}if(f){var w=jt(l,f);w<c&&(a=f,c=w)}}var S;if(S=p())return S}return null},t.prototype.updateFeature_=function(e){this.removeFeature(e,!1),this.addFeature(e,!1)},t.prototype.segmentCircleGeometry_=function(e,t){var r=this.getMap().getView().getProjection(),n=t,i=pi();i&&(n=n.clone().transform(i,r));var o=Po(n);i&&o.transform(r,i);for(var a=o.getCoordinates()[0],s=0,l=a.length-1;s<l;++s)e.push(a.slice(s,s+2))},t.prototype.segmentGeometryCollectionGeometry_=function(e,t){for(var r=t.getGeometriesArray(),n=0;n<r.length;++n){var i=this.GEOMETRY_SEGMENTERS_[r[n].getType()];i&&i(e,r[n])}},t.prototype.segmentLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,i=r.length-1;n<i;++n)e.push(r.slice(n,n+2))},t.prototype.segmentMultiLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length-1;a<s;++a)e.push(o.slice(a,a+2))},t.prototype.segmentMultiPointGeometry_=function(e,t){t.getCoordinates().forEach((function(t){e.push([t])}))},t.prototype.segmentMultiPolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length;a<s;++a)for(var l=o[a],c=0,u=l.length-1;c<u;++c)e.push(l.slice(c,c+2))},t.prototype.segmentPointGeometry_=function(e,t){e.push([t.getCoordinates()])},t.prototype.segmentPolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length-1;a<s;++a)e.push(o.slice(a,a+2))},t}(aa);const yw=gw;var mw=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),vw="select",_w=function(e){function t(t,r,n,i){var o=e.call(this,t)||this;return o.selected=r,o.deselected=n,o.mapBrowserEvent=i,o}return mw(t,e),t}(tt),ww={},Sw=function(e){function t(t){var r=e.call(this)||this;r.on,r.once,r.un;var n,i=t||{};if(r.boundAddFeature_=r.addFeature_.bind(r),r.boundRemoveFeature_=r.removeFeature_.bind(r),r.condition_=i.condition?i.condition:fa,r.addCondition_=i.addCondition?i.addCondition:da,r.removeCondition_=i.removeCondition?i.removeCondition:da,r.toggleCondition_=i.toggleCondition?i.toggleCondition:ya,r.multi_=!!i.multi&&i.multi,r.filter_=i.filter?i.filter:y,r.hitTolerance_=i.hitTolerance?i.hitTolerance:0,r.style_=void 0!==i.style?i.style:function(){var e=tf();return h(e.Polygon,e.LineString),h(e.GeometryCollection,e.LineString),function(t){return t.getGeometry()?e[t.getGeometry().getType()]:null}}(),r.features_=i.features||new Br,i.layers)if("function"==typeof i.layers)n=i.layers;else{var o=i.layers;n=function(e){return c(o,e)}}else n=y;return r.layerFilter_=n,r.featureLayerAssociation_={},r}return mw(t,e),t.prototype.addFeatureLayerAssociation_=function(e,t){this.featureLayerAssociation_[o(e)]=t},t.prototype.getFeatures=function(){return this.features_},t.prototype.getHitTolerance=function(){return this.hitTolerance_},t.prototype.getLayer=function(e){return this.featureLayerAssociation_[o(e)]},t.prototype.setHitTolerance=function(e){this.hitTolerance_=e},t.prototype.setMap=function(t){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),e.prototype.setMap.call(this,t),t?(this.features_.addEventListener(Nr,this.boundAddFeature_),this.features_.addEventListener(Zr,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(Nr,this.boundAddFeature_),this.features_.removeEventListener(Zr,this.boundRemoveFeature_))},t.prototype.addFeature_=function(e){var t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){var r=this.getMap().getAllLayers().find((function(e){if(e instanceof N_&&e.getSource()&&e.getSource().hasFeature(t))return e}));r&&this.addFeatureLayerAssociation_(t,r)}},t.prototype.removeFeature_=function(e){var t=e.element;this.style_&&this.restorePreviousStyle_(t)},t.prototype.getStyle=function(){return this.style_},t.prototype.applySelectedStyle_=function(e){var t=o(e);t in ww||(ww[t]=e.getStyle()),e.setStyle(this.style_)},t.prototype.restorePreviousStyle_=function(e){for(var r=this.getMap().getInteractions().getArray(),n=r.length-1;n>=0;--n){var i=r[n];if(i!==this&&i instanceof t&&i.getStyle()&&-1!==i.getFeatures().getArray().lastIndexOf(e))return void e.setStyle(i.getStyle())}var a=o(e);e.setStyle(ww[a]),delete ww[a]},t.prototype.removeFeatureLayerAssociation_=function(e){delete this.featureLayerAssociation_[o(e)]},t.prototype.handleEvent=function(e){if(!this.condition_(e))return!0;var t=this.addCondition_(e),r=this.removeCondition_(e),n=this.toggleCondition_(e),i=!t&&!r&&!n,o=e.map,a=this.getFeatures(),s=[],l=[];if(i){it(this.featureLayerAssociation_),o.forEachFeatureAtPixel(e.pixel,function(e,t){if(this.filter_(e,t))return this.addFeatureLayerAssociation_(e,t),l.push(e),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var u=a.getLength()-1;u>=0;--u){var p=a.item(u),h=l.indexOf(p);h>-1?l.splice(h,1):(a.remove(p),s.push(p))}0!==l.length&&a.extend(l)}else{o.forEachFeatureAtPixel(e.pixel,function(e,i){if(this.filter_(e,i))return!t&&!n||c(a.getArray(),e)?(r||n)&&c(a.getArray(),e)&&(s.push(e),this.removeFeatureLayerAssociation_(e)):(this.addFeatureLayerAssociation_(e,i),l.push(e)),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var d=s.length-1;d>=0;--d)a.remove(s[d]);a.extend(l)}return(l.length>0||s.length>0)&&this.dispatchEvent(new _w(vw,l,s,e)),!0},t}(ta);const Ew=Sw;var bw=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Cw=[0,0,0,0],Lw=[],Tw="modifystart",Aw="modifyend",xw=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.features=r,i.mapBrowserEvent=n,i}return bw(t,e),t}(tt),Pw=function(e){function t(t){var r,n,i=e.call(this,t)||this;if(i.on,i.once,i.un,i.boundHandleFeatureChange_=i.handleFeatureChange_.bind(i),i.condition_=t.condition?t.condition:_a,i.defaultDeleteCondition_=function(e){return function(e){var t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey}(e)&&fa(e)},i.deleteCondition_=t.deleteCondition?t.deleteCondition:i.defaultDeleteCondition_,i.insertVertexCondition_=t.insertVertexCondition?t.insertVertexCondition:ua,i.vertexFeature_=null,i.vertexSegments_=null,i.lastPixel_=[0,0],i.ignoreNextSingleClick_=!1,i.featuresBeingModified_=null,i.rBush_=new k_,i.pixelTolerance_=void 0!==t.pixelTolerance?t.pixelTolerance:10,i.snappedToVertex_=!1,i.changingFeature_=!1,i.dragSegments_=[],i.overlay_=new N_({source:new V_({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style?t.style:(r=tf(),function(e,t){return r.Point}),updateWhileAnimating:!0,updateWhileInteracting:!0}),i.SEGMENT_WRITERS_={Point:i.writePointGeometry_.bind(i),LineString:i.writeLineStringGeometry_.bind(i),LinearRing:i.writeLineStringGeometry_.bind(i),Polygon:i.writePolygonGeometry_.bind(i),MultiPoint:i.writeMultiPointGeometry_.bind(i),MultiLineString:i.writeMultiLineStringGeometry_.bind(i),MultiPolygon:i.writeMultiPolygonGeometry_.bind(i),Circle:i.writeCircleGeometry_.bind(i),GeometryCollection:i.writeGeometryCollectionGeometry_.bind(i)},i.source_=null,i.hitDetection_=null,t.features?n=t.features:t.source&&(i.source_=t.source,n=new Br(i.source_.getFeatures()),i.source_.addEventListener(G_.ADDFEATURE,i.handleSourceAdd_.bind(i)),i.source_.addEventListener(G_.REMOVEFEATURE,i.handleSourceRemove_.bind(i))),!n)throw new Error("The modify interaction requires features, a source or a layer");return t.hitDetection&&(i.hitDetection_=t.hitDetection),i.features_=n,i.features_.forEach(i.addFeature_.bind(i)),i.features_.addEventListener(Nr,i.handleFeatureAdd_.bind(i)),i.features_.addEventListener(Zr,i.handleFeatureRemove_.bind(i)),i.lastPointerEvent_=null,i.delta_=[0,0],i.snapToPointer_=void 0===t.snapToPointer?!i.hitDetection_:t.snapToPointer,i}return bw(t,e),t.prototype.addFeature_=function(e){var t=e.getGeometry();if(t){var r=this.SEGMENT_WRITERS_[t.getType()];r&&r(e,t)}var n=this.getMap();n&&n.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,n),e.addEventListener(ct.CHANGE,this.boundHandleFeatureChange_)},t.prototype.willModifyFeatures_=function(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new Br;for(var r=this.featuresBeingModified_.getArray(),n=0,i=t.length;n<i;++n)for(var o=t[n],a=0,s=o.length;a<s;++a){var l=o[a].feature;l&&-1===r.indexOf(l)&&this.featuresBeingModified_.push(l)}0===this.featuresBeingModified_.getLength()?this.featuresBeingModified_=null:this.dispatchEvent(new xw(Tw,this.featuresBeingModified_,e))}},t.prototype.removeFeature_=function(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(ct.CHANGE,this.boundHandleFeatureChange_)},t.prototype.removeFeatureSegmentData_=function(e){var t=this.rBush_,r=[];t.forEach((function(t){e===t.feature&&r.push(t)}));for(var n=r.length-1;n>=0;--n){for(var i=r[n],o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===i&&this.dragSegments_.splice(o,1);t.remove(i)}},t.prototype.setActive=function(t){this.vertexFeature_&&!t&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.prototype.setActive.call(this,t)},t.prototype.setMap=function(t){this.overlay_.setMap(t),e.prototype.setMap.call(this,t)},t.prototype.getOverlay=function(){return this.overlay_},t.prototype.handleSourceAdd_=function(e){e.feature&&this.features_.push(e.feature)},t.prototype.handleSourceRemove_=function(e){e.feature&&this.features_.remove(e.feature)},t.prototype.handleFeatureAdd_=function(e){this.addFeature_(e.element)},t.prototype.handleFeatureChange_=function(e){if(!this.changingFeature_){var t=e.target;this.removeFeature_(t),this.addFeature_(t)}},t.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature_(t)},t.prototype.writePointGeometry_=function(e,t){var r=t.getCoordinates(),n={feature:e,geometry:t,segment:[r,r]};this.rBush_.insert(t.getExtent(),n)},t.prototype.writeMultiPointGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,i=r.length;n<i;++n){var o=r[n],a={feature:e,geometry:t,depth:[n],index:n,segment:[o,o]};this.rBush_.insert(t.getExtent(),a)}},t.prototype.writeLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,i=r.length-1;n<i;++n){var o=r.slice(n,n+2),a={feature:e,geometry:t,index:n,segment:o};this.rBush_.insert(K(o),a)}},t.prototype.writeMultiLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length-1;a<s;++a){var l=o.slice(a,a+2),c={feature:e,geometry:t,depth:[n],index:a,segment:l};this.rBush_.insert(K(l),c)}},t.prototype.writePolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length-1;a<s;++a){var l=o.slice(a,a+2),c={feature:e,geometry:t,depth:[n],index:a,segment:l};this.rBush_.insert(K(l),c)}},t.prototype.writeMultiPolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,i=r.length;n<i;++n)for(var o=r[n],a=0,s=o.length;a<s;++a)for(var l=o[a],c=0,u=l.length-1;c<u;++c){var p=l.slice(c,c+2),h={feature:e,geometry:t,depth:[a,n],index:c,segment:p};this.rBush_.insert(K(p),h)}},t.prototype.writeCircleGeometry_=function(e,t){var r=t.getCenter(),n={feature:e,geometry:t,index:0,segment:[r,r]},i={feature:e,geometry:t,index:1,segment:[r,r]},o=[n,i];n.featureSegments=o,i.featureSegments=o,this.rBush_.insert(ae(r),n);var a=t,s=pi();if(s&&this.getMap()){var l=this.getMap().getView().getProjection();a=Po(a=a.clone().transform(s,l)).transform(l,s)}this.rBush_.insert(a.getExtent(),i)},t.prototype.writeGeometryCollectionGeometry_=function(e,t){for(var r=t.getGeometriesArray(),n=0;n<r.length;++n){var i=r[n];(0,this.SEGMENT_WRITERS_[i.getType()])(e,i)}},t.prototype.createOrUpdateVertexFeature_=function(e,t,r){var n=this.vertexFeature_;n?n.getGeometry().setCoordinates(e):(n=new js(new uo(e)),this.vertexFeature_=n,this.overlay_.getSource().addFeature(n));return n.set("features",t),n.set("geometries",r),n},t.prototype.handleEvent=function(t){return!t.originalEvent||(this.lastPointerEvent_=t,t.map.getView().getInteracting()||t.type!=Kr.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(t),this.vertexFeature_&&this.deleteCondition_(t)&&(r=!(t.type!=Kr.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),t.type==Kr.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),e.prototype.handleEvent.call(this,t)&&!r);var r},t.prototype.handleDragEvent=function(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_);for(var t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],r=[],n=[],i=0,o=this.dragSegments_.length;i<o;++i){var a=this.dragSegments_[i],s=a[0],l=s.feature;-1===r.indexOf(l)&&r.push(l);var c=s.geometry;-1===n.indexOf(c)&&n.push(c);for(var u=s.depth,p=void 0,h=s.segment,d=a[1];t.length<c.getStride();)t.push(h[d][t.length]);switch(c.getType()){case"Point":p=t,h[0]=t,h[1]=t;break;case"MultiPoint":(p=c.getCoordinates())[s.index]=t,h[0]=t,h[1]=t;break;case"LineString":(p=c.getCoordinates())[s.index+d]=t,h[d]=t;break;case"MultiLineString":case"Polygon":(p=c.getCoordinates())[u[0]][s.index+d]=t,h[d]=t;break;case"MultiPolygon":(p=c.getCoordinates())[u[1]][u[0]][s.index+d]=t,h[d]=t;break;case"Circle":if(h[0]=t,h[1]=t,0===s.index)this.changingFeature_=!0,c.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0;var f=e.map.getView().getProjection(),g=Wt(di(c.getCenter(),f),di(t,f)),y=pi();if(y){var m=c.clone().transform(y,f);m.setRadius(g),g=m.transform(f,y).getRadius()}c.setRadius(g),this.changingFeature_=!1}}p&&this.setGeometryCoordinates_(c,p)}this.createOrUpdateVertexFeature_(t,r,n)},t.prototype.handleDownEvent=function(e){if(!this.condition_(e))return!1;var t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;var r=this.vertexFeature_;if(r){var n=e.map.getView().getProjection(),i=[],a=r.getGeometry().getCoordinates(),s=K([a]),l=this.rBush_.getInExtent(s),c={};l.sort(Ow);for(var u=0,p=l.length;u<p;++u){var h=l[u],d=h.segment,f=o(h.geometry),g=h.depth;if(g&&(f+="-"+g.join("-")),c[f]||(c[f]=new Array(2)),"Circle"!==h.geometry.getType()||1!==h.index)if(!Ut(d[0],a)||c[f][0])if(!Ut(d[1],a)||c[f][1])o(d)in this.vertexSegments_&&!c[f][0]&&!c[f][1]&&this.insertVertexCondition_(e)&&i.push(h);else{if(c[f][0]&&0===c[f][0].index){var y=h.geometry.getCoordinates();switch(h.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":y=y[g[1]];case"Polygon":if(h.index!==y[g[0]].length-2)continue}}this.dragSegments_.push([h,1]),c[f][1]=h}else this.dragSegments_.push([h,0]),c[f][0]=h;else Ut(Rw(t,h,n),a)&&!c[f][0]&&(this.dragSegments_.push([h,0]),c[f][0]=h)}i.length&&this.willModifyFeatures_(e,[i]);for(var m=i.length-1;m>=0;--m)this.insertVertex_(i[m],a)}return!!this.vertexFeature_},t.prototype.handleUpEvent=function(e){for(var t=this.dragSegments_.length-1;t>=0;--t){var r=this.dragSegments_[t][0],n=r.geometry;if("Circle"===n.getType()){var i=n.getCenter(),o=r.featureSegments[0],a=r.featureSegments[1];o.segment[0]=i,o.segment[1]=i,a.segment[0]=i,a.segment[1]=i,this.rBush_.update(ae(i),o);var s=n,l=pi();if(l){var c=e.map.getView().getProjection();s=Po(s=s.clone().transform(l,c)).transform(c,l)}this.rBush_.update(s.getExtent(),a)}else this.rBush_.update(K(r.segment),r)}return this.featuresBeingModified_&&(this.dispatchEvent(new xw(Aw,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1},t.prototype.handlePointerMove_=function(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)},t.prototype.handlePointerAtPixel_=function(e,t,r){var n,i,a=this,s=r||t.getCoordinateFromPixel(e),l=t.getView().getProjection();if(this.hitDetection_){var u="object"==typeof this.hitDetection_?function(e){return e===a.hitDetection_}:void 0;t.forEachFeatureAtPixel(e,(function(e,t,r){if("Point"===(r=r||e.getGeometry()).getType()&&c(a.features_.getArray(),e)){i=r;var o=r.getFlatCoordinates().slice(0,2);n=[{feature:e,geometry:r,segment:[o,o]}]}return!0}),{layerFilter:u})}if(!n){var p=fi(X(gi(ae(s,Cw),l),t.getView().getResolution()*this.pixelTolerance_,Cw),l);n=this.rBush_.getInExtent(p)}if(n&&n.length>0){var h=n.sort((function(e,t){return Iw(s,e,l)-Iw(s,t,l)}))[0],d=h.segment,f=Rw(s,h,l),g=t.getPixelFromCoordinate(f),y=Wt(e,g);if(i||y<=this.pixelTolerance_){var m={};if(m[o(d)]=!0,this.snapToPointer_||(this.delta_[0]=f[0]-s[0],this.delta_[1]=f[1]-s[1]),"Circle"===h.geometry.getType()&&1===h.index)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(f,[h.feature],[h.geometry]);else{var v=t.getPixelFromCoordinate(d[0]),_=t.getPixelFromCoordinate(d[1]),w=jt(g,v),S=jt(g,_);y=Math.sqrt(Math.min(w,S)),this.snappedToVertex_=y<=this.pixelTolerance_,this.snappedToVertex_&&(f=w>S?d[1]:d[0]),this.createOrUpdateVertexFeature_(f,[h.feature],[h.geometry]);var E={};E[o(h.geometry)]=!0;for(var b=1,C=n.length;b<C;++b){var L=n[b].segment;if(!(Ut(d[0],L[0])&&Ut(d[1],L[1])||Ut(d[0],L[1])&&Ut(d[1],L[0])))break;var T=o(n[b].geometry);T in E||(E[T]=!0,m[o(L)]=!0)}}return void(this.vertexSegments_=m)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},t.prototype.insertVertex_=function(e,t){for(var r,n=e.segment,i=e.feature,o=e.geometry,a=e.depth,s=e.index;t.length<o.getStride();)t.push(0);switch(o.getType()){case"MultiLineString":case"Polygon":(r=o.getCoordinates())[a[0]].splice(s+1,0,t);break;case"MultiPolygon":(r=o.getCoordinates())[a[1]][a[0]].splice(s+1,0,t);break;case"LineString":(r=o.getCoordinates()).splice(s+1,0,t);break;default:return}this.setGeometryCoordinates_(o,r);var l=this.rBush_;l.remove(e),this.updateSegmentIndices_(o,s,a,1);var c={segment:[n[0],t],feature:i,geometry:o,depth:a,index:s};l.insert(K(c.segment),c),this.dragSegments_.push([c,1]);var u={segment:[t,n[1]],feature:i,geometry:o,depth:a,index:s+1};l.insert(K(u.segment),u),this.dragSegments_.push([u,0]),this.ignoreNextSingleClick_=!0},t.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=Kr.POINTERDRAG){var e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_);var t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new xw(Aw,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1},t.prototype.removeVertex_=function(){var e,t,r,n,i,a,s,l,c,u,p,h=this.dragSegments_,d={},f=!1;for(i=h.length-1;i>=0;--i)p=o((u=(r=h[i])[0]).feature),u.depth&&(p+="-"+u.depth.join("-")),p in d||(d[p]={}),0===r[1]?(d[p].right=u,d[p].index=u.index):1==r[1]&&(d[p].left=u,d[p].index=u.index+1);for(p in d){switch(c=d[p].right,s=d[p].left,(l=(a=d[p].index)-1)<0&&(l=0),e=t=(n=(u=void 0!==s?s:c).geometry).getCoordinates(),f=!1,n.getType()){case"MultiLineString":t[u.depth[0]].length>2&&(t[u.depth[0]].splice(a,1),f=!0);break;case"LineString":t.length>2&&(t.splice(a,1),f=!0);break;case"MultiPolygon":e=e[u.depth[1]];case"Polygon":(e=e[u.depth[0]]).length>4&&(a==e.length-1&&(a=0),e.splice(a,1),f=!0,0===a&&(e.pop(),e.push(e[0]),l=e.length-1))}if(f){this.setGeometryCoordinates_(n,t);var g=[];if(void 0!==s&&(this.rBush_.remove(s),g.push(s.segment[0])),void 0!==c&&(this.rBush_.remove(c),g.push(c.segment[1])),void 0!==s&&void 0!==c){var y={depth:u.depth,feature:u.feature,geometry:u.geometry,index:l,segment:g};this.rBush_.insert(K(y.segment),y)}this.updateSegmentIndices_(n,a,u.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),h.length=0}}return f},t.prototype.setGeometryCoordinates_=function(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1},t.prototype.updateSegmentIndices_=function(e,t,r,n){this.rBush_.forEachInExtent(e.getExtent(),(function(i){i.geometry===e&&(void 0===r||void 0===i.depth||f(i.depth,r))&&i.index>t&&(i.index+=n)}))},t}(aa);function Ow(e,t){return e.index-t.index}function Iw(e,t,r){var n=t.geometry;if("Circle"===n.getType()){var i=n;if(1===t.index){var o=pi();o&&(i=i.clone().transform(o,r));var a=jt(i.getCenter(),di(e,r)),s=Math.sqrt(a)-i.getRadius();return s*s}}var l=di(e,r);return Lw[0]=di(t.segment[0],r),Lw[1]=di(t.segment[1],r),function(e,t){return jt(e,Ft(e,t))}(l,Lw)}function Rw(e,t,r){var n=t.geometry;if("Circle"===n.getType()&&1===t.index){var i=n,o=pi();return o&&(i=i.clone().transform(o,r)),hi(i.getClosestPoint(di(e,r)),r)}var a=di(e,r);return Lw[0]=di(t.segment[0],r),Lw[1]=di(t.segment[1],r),hi(Ft(a,Lw),r)}const Mw=Pw;var Dw=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Nw="addfeatures",Zw=function(e){function t(t,r,n,i){var o=e.call(this,t)||this;return o.features=n,o.file=r,o.projection=i,o}return Dw(t,e),t}(tt),kw=function(e){function t(t){var r=this,n=t||{};(r=e.call(this,{handleEvent:y})||this).on,r.once,r.un,r.readAsBuffer_=!1,r.formats_=[];for(var i=n.formatConstructors?n.formatConstructors:[],o=0,a=i.length;o<a;++o){var s=i[o];"function"==typeof s&&(s=new s),r.formats_.push(s),r.readAsBuffer_=r.readAsBuffer_||"arraybuffer"===s.getType()}return r.projection_=n.projection?$n(n.projection):null,r.dropListenKeys_=null,r.source_=n.source||null,r.target=n.target?n.target:null,r}return Dw(t,e),t.prototype.handleResult_=function(e,t){var r,n=t.target.result,i=this.getMap(),o=this.projection_;o||(o=i.getView().getProjection());for(var a=this.formats_,s=0,l=a.length;s<l;++s){var c=a[s],u=n;this.readAsBuffer_&&"arraybuffer"!==c.getType()&&(void 0===r&&(r=(new TextDecoder).decode(n)),u=r);var p=this.tryReadFeatures_(c,u,{featureProjection:o});if(p&&p.length>0){this.source_&&(this.source_.clear(),this.source_.addFeatures(p)),this.dispatchEvent(new Zw(Nw,e,p,o));break}}},t.prototype.registerListeners_=function(){var e=this.getMap();if(e){var t=this.target?this.target:e.getViewport();this.dropListenKeys_=[ut(t,ct.DROP,this.handleDrop,this),ut(t,ct.DRAGENTER,this.handleStop,this),ut(t,ct.DRAGOVER,this.handleStop,this),ut(t,ct.DROP,this.handleStop,this)]}},t.prototype.setActive=function(t){!this.getActive()&&t&&this.registerListeners_(),this.getActive()&&!t&&this.unregisterListeners_(),e.prototype.setActive.call(this,t)},t.prototype.setMap=function(t){this.unregisterListeners_(),e.prototype.setMap.call(this,t),this.getActive()&&this.registerListeners_()},t.prototype.tryReadFeatures_=function(e,t,r){try{return e.readFeatures(t,r)}catch(e){return null}},t.prototype.unregisterListeners_=function(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(ht),this.dropListenKeys_=null)},t.prototype.handleDrop=function(e){for(var t=e.dataTransfer.files,r=0,n=t.length;r<n;++r){var i=t.item(r),o=new FileReader;o.addEventListener(ct.LOAD,this.handleResult_.bind(this,i)),this.readAsBuffer_?o.readAsArrayBuffer(i):o.readAsText(i)}},t.prototype.handleStop=function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},t}(ta);const Fw=kw;var Uw=r(3837),Bw=r.n(Uw),Gw="addfeatures";const jw=function(e,t){if(Object.prototype.hasOwnProperty.call(e.getProperties(),"h4_Capa"))return e.getProperties().h4_Capa;const r=/(?<layer>[-_\p{Letter}.]+[\p{Letter}])?\.*(?<id>[\d]*)?/iu.exec(e.getId()||e.ol_uid).groups;return r.layer?r.layer:!t.name.toLowerCase().endsWith(".gpx")&&e.getGeometry()?Object.keys(ol.geom).find((t=>e.getGeometry()instanceof ol.geom[t])):t.name};Fw.prototype.handleResult_=function(e,t){var r=t.target.result,n=this.getMap(),i=this.projection_;i||(i=n.getView().getProjection());var o=[],a={},s=this.formats_,l=e.name;if("string"==typeof r){for(var c=0,u=s.length;c<u;++c){var p=s[c];if((o=this.tryReadFeatures_(p,r,{featureProjection:i}))&&o.length>0)break}o&&o.length>0?a=o.every((e=>Array.isArray(e)))?o.reduce((function(t,r){if(0===r.length)return t;const n=jw(r[0],e);return t[n]=(t[n]=t[n]||[]).concat(r),t}),{}):o.reduce((function(t,r){var n=r._folders&&r._folders.length?r._folders[r._folders.length-1]:null;return n||(n=jw(r,e)),(t[n]=t[n]||[]).push(r),t}),{}):a[e.name]=o}else o=r?(new ol.format.GeoJSON).readFeaturesFromObject(r,{featureProjection:i,dataProjection:(new ol.format.GeoJSON).readProjectionFromObject(r)}):null,a[e.name]=o;const h=Date.now(),d=Object.keys(a);d.length>1&&(window.dropFilesCounter=window.dropFilesCounter+d.length-1);for(c=0;c<d.length;c++){const t=d[c],r=a[t];"undefined"!==t&&r&&r.forEach((e=>{e._folders||(e._folders=[t])})),this.source_&&(this.source_.clear(),this.source_.addFeatures(r));const n=r&&r.length&&r[0]._document,o=new File([e],n?n+" ("+l+")":l,{lastModified:h});e._fileSystemFile&&(o._fileSystemFile=e._fileSystemFile);const s=this.getFileHandle(e);s&&Ww.set(o,s);const u=new Zw(Gw,o,a[t],i);u._groupIndex=c,u._groupCount=d.length,this.dispatchEvent(u)}},Fw.prototype.handleDrop=function(e){const t=this;var r=e.dataTransfer.items;if(DataTransferItem.prototype.getAsFileSystemHandle){const e=function(e){e&&t.processFile(e)};for(var n=0,i=r.length;n<i;++n)r[n].getAsFileSystemHandle().then(e)}else{const e=r=>{r.isDirectory?r.createReader().readEntries((function(t){t.forEach((function(t){e(t)}))})):r instanceof File?t.processFile(r):r.file((async function(e){t.processFile(e)}))};for(var o=0,a=r.length;o<a;++o){const t=r[o];"file"===t.kind&&e(t.webkitGetAsEntry()||t.getAsFile())}}};const Ww=new Map;Fw.prototype.getFileHandle=function(e){return Ww.get(e)},Fw.prototype.getFileHandleByName=function(e){const t=e.toLowerCase();for(const e of Ww.keys())if(e.name.toLowerCase()===t)return Ww.get(e);return null},Fw.prototype.setFileHandle=function(e,t){return Ww.set(e,t)},Fw.prototype.processFile=async function(e){const t=this;let r;if(window.FileSystemFileHandle&&e instanceof window.FileSystemFileHandle){r=e;try{e=await r.getFile()}catch(e){return console.warn(e),void t.dispatchEvent(new Zw("error",r))}t.setFileHandle(e,r)}if("application/zip"===e.type||"application/x-zip-compressed"===e.type||"application/vnd.google-earth.kmz"===e.type||(!e.type||"application/octet-stream"===e.type)&&e.name.match(/\.kmz|\.zip$/gi)){var n=new(Bw());window.dropFilesCounter=window.dropFilesCounter?window.dropFilesCounter+1:1;const i=await n.loadAsync(e);window.dropFilesCounter--;const o="application/vnd.google-earth.kmz"===e.type||(!e.type||"application/octet-stream"===e.type)&&e.name.match(/\.kmz$/gi)?e.name:null;i.forEach((function(n,i){i.dir||(window.dropFilesCounter++,i.async("blob").then((function(i){window.dropFilesCounter--;const a=o?new File([i],o,{type:"application/vnd.google-earth.kml+xml"}):new File([i],n);a._fileSystemFile=e._fileSystemFile||e,r&&t.setFileHandle(a,r),t.processFile(a)})))}))}else if(window.FileSystemDirectoryHandle&&e instanceof window.FileSystemDirectoryHandle)for await(const r of e.values())t.processFile(r);else{window.dropFilesCounter=window.dropFilesCounter?window.dropFilesCounter+1:1;var i=new FileReader;i.addEventListener(ct.LOAD,t.handleResult_.bind(t,e)),i.readAsText(e)}},Fw.prototype.tryReadFeatures_=function(e,t,r){let n;try{n=e.readFeatures(t,r)}catch(e){return null}return n&&n.length&&n.some((e=>Array.isArray(e)?e.some((e=>!!e.getGeometry())):!!e.getGeometry()))?n:null};const Hw=Fw,qw="preload",Vw="useInterimTilesOnError";var zw=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const Yw=function(e){function t(t){var r=this,n=t||{},i=nt({},n);return delete i.preload,delete i.useInterimTilesOnError,(r=e.call(this,i)||this).on,r.once,r.un,r.setPreload(void 0!==n.preload?n.preload:0),r.setUseInterimTilesOnError(void 0===n.useInterimTilesOnError||n.useInterimTilesOnError),r}return zw(t,e),t.prototype.getPreload=function(){return this.get(qw)},t.prototype.setPreload=function(e){this.set(qw,e)},t.prototype.getUseInterimTilesOnError=function(){return this.get(Vw)},t.prototype.setUseInterimTilesOnError=function(e){this.set(Vw,e)},t.prototype.getData=function(t){return e.prototype.getData.call(this,t)},t}(Nt);var Kw=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Xw=function(e){function t(t,r,n){var i=e.call(this)||this,o=n||{};return i.tileCoord=t,i.state=r,i.interimTile=null,i.key="",i.transition_=void 0===o.transition?250:o.transition,i.transitionStarts_={},i.interpolate=!!o.interpolate,i}return Kw(t,e),t.prototype.changed=function(){this.dispatchEvent(ct.CHANGE)},t.prototype.release=function(){},t.prototype.getKey=function(){return this.key+"/"+this.tileCoord},t.prototype.getInterimTile=function(){if(!this.interimTile)return this;var e=this.interimTile;do{if(e.getState()==pn)return this.transition_=0,e;e=e.interimTile}while(e);return this},t.prototype.refreshInterimChain=function(){if(this.interimTile){var e=this.interimTile,t=this;do{if(e.getState()==pn){e.interimTile=null;break}e.getState()==un?t=e:e.getState()==cn?t.interimTile=e.interimTile:t=e,e=t.interimTile}while(e)}},t.prototype.getTileCoord=function(){return this.tileCoord},t.prototype.getState=function(){return this.state},t.prototype.setState=function(e){if(this.state!==hn&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()},t.prototype.load=function(){n()},t.prototype.getAlpha=function(e,t){if(!this.transition_)return 1;var r=this.transitionStarts_[e];if(r){if(-1===r)return 1}else r=t,this.transitionStarts_[e]=r;var n=t-r+1e3/60;return n>=this.transition_?1:Li(n/this.transition_)},t.prototype.inTransition=function(e){return!!this.transition_&&-1!==this.transitionStarts_[e]},t.prototype.endTransition=function(e){this.transition_&&(this.transitionStarts_[e]=-1)},t}(lt);const $w=Xw;var Jw=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const Qw=function(e){function t(t,r,n,i,o,a){var s=e.call(this,t,r,a)||this;return s.crossOrigin_=i,s.src_=n,s.key=n,s.image_=new Image,null!==i&&(s.image_.crossOrigin=i),s.unlisten_=null,s.tileLoadFunction_=o,s}return Jw(t,e),t.prototype.getImage=function(){return this.image_},t.prototype.setImage=function(e){this.image_=e,this.state=pn,this.unlistenImage_(),this.changed()},t.prototype.handleImageError_=function(){var e;this.state=hn,this.unlistenImage_(),this.image_=((e=or(1,1)).fillStyle="rgba(0,0,0,0)",e.fillRect(0,0,1,1),e.canvas),this.changed()},t.prototype.handleImageLoad_=function(){var e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=pn:this.state=dn,this.unlistenImage_(),this.changed()},t.prototype.load=function(){this.state==hn&&(this.state=cn,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==cn&&(this.state=un,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Zd(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},t.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},t}($w);const eS=function(){function e(e,t,r,n,i,o){this.sourceProj_=e,this.targetProj_=t;var a={},s=ii(this.targetProj_,this.sourceProj_);this.transformInv_=function(e){var t=e[0]+"/"+e[1];return a[t]||(a[t]=s(e)),a[t]},this.maxSourceExtent_=n,this.errorThresholdSquared_=i*i,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&Le(n)==Le(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Le(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Le(this.targetProj_.getExtent()):null;var l=be(r),c=Ce(r),u=ye(r),p=ge(r),h=this.transformInv_(l),d=this.transformInv_(c),f=this.transformInv_(u),g=this.transformInv_(p),y=10+(o?Math.max(0,Math.ceil(Me(fe(r)/(o*o*256*256)))):0);if(this.addQuad_(l,c,u,p,h,d,f,g,y),this.wrapsXInSource_){var m=1/0;this.triangles_.forEach((function(e,t,r){m=Math.min(m,e.source[0][0],e.source[1][0],e.source[2][0])})),this.triangles_.forEach(function(e){if(Math.max(e.source[0][0],e.source[1][0],e.source[2][0])-m>this.sourceWorldWidth_/2){var t=[[e.source[0][0],e.source[0][1]],[e.source[1][0],e.source[1][1]],[e.source[2][0],e.source[2][1]]];t[0][0]-m>this.sourceWorldWidth_/2&&(t[0][0]-=this.sourceWorldWidth_),t[1][0]-m>this.sourceWorldWidth_/2&&(t[1][0]-=this.sourceWorldWidth_),t[2][0]-m>this.sourceWorldWidth_/2&&(t[2][0]-=this.sourceWorldWidth_);var r=Math.min(t[0][0],t[1][0],t[2][0]);Math.max(t[0][0],t[1][0],t[2][0])-r<this.sourceWorldWidth_/2&&(e.source=t)}}.bind(this))}a={}}return e.prototype.addTriangle_=function(e,t,r,n,i,o){this.triangles_.push({source:[n,i,o],target:[e,t,r]})},e.prototype.addQuad_=function(e,t,r,n,i,o,a,s,l){var c=K([i,o,a,s]),u=this.sourceWorldWidth_?Le(c)/this.sourceWorldWidth_:null,p=this.sourceWorldWidth_,h=this.sourceProj_.canWrapX()&&u>.5&&u<1,d=!1;if(l>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_)d=Le(K([e,t,r,n]))/this.targetWorldWidth_>.25||d;!h&&this.sourceProj_.isGlobal()&&u&&(d=u>.25||d)}if(!(!d&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3]))||Te(c,this.maxSourceExtent_)){var f=0;if(!(d||isFinite(i[0])&&isFinite(i[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(a[0])&&isFinite(a[1])&&isFinite(s[0])&&isFinite(s[1])))if(l>0)d=!0;else if(1!=(f=(isFinite(i[0])&&isFinite(i[1])?0:8)+(isFinite(o[0])&&isFinite(o[1])?0:4)+(isFinite(a[0])&&isFinite(a[1])?0:2)+(isFinite(s[0])&&isFinite(s[1])?0:1))&&2!=f&&4!=f&&8!=f)return;if(l>0){if(!d){var g=[(e[0]+r[0])/2,(e[1]+r[1])/2],y=this.transformInv_(g),m=void 0;if(h)m=(ke(i[0],p)+ke(a[0],p))/2-ke(y[0],p);else m=(i[0]+a[0])/2-y[0];var v=(i[1]+a[1])/2-y[1];d=m*m+v*v>this.errorThresholdSquared_}if(d){if(Math.abs(e[0]-r[0])<=Math.abs(e[1]-r[1])){var _=[(t[0]+r[0])/2,(t[1]+r[1])/2],w=this.transformInv_(_),S=[(n[0]+e[0])/2,(n[1]+e[1])/2],E=this.transformInv_(S);this.addQuad_(e,t,_,S,i,o,w,E,l-1),this.addQuad_(S,_,r,n,E,w,a,s,l-1)}else{var b=[(e[0]+t[0])/2,(e[1]+t[1])/2],C=this.transformInv_(b),L=[(r[0]+n[0])/2,(r[1]+n[1])/2],T=this.transformInv_(L);this.addQuad_(e,b,L,n,i,C,T,s,l-1),this.addQuad_(b,t,r,L,C,o,a,T,l-1)}return}}if(h){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}0==(11&f)&&this.addTriangle_(e,r,n,i,a,s),0==(14&f)&&this.addTriangle_(e,r,t,i,a,o),f&&(0==(13&f)&&this.addTriangle_(t,n,e,o,s,i),0==(7&f)&&this.addTriangle_(t,n,r,o,s,a))}},e.prototype.calculateSourceExtent=function(){var e=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach((function(t,r,n){var i=t.source;ue(e,i[0]),ue(e,i[1]),ue(e,i[2])})),e},e.prototype.getTriangles=function(){return this.triangles_},e}();var tS,rS={imageSmoothingEnabled:!1,msImageSmoothingEnabled:!1},nS={imageSmoothingEnabled:!0,msImageSmoothingEnabled:!0},iS=[];function oS(e,t,r,n,i){e.beginPath(),e.moveTo(0,0),e.lineTo(t,r),e.lineTo(n,i),e.closePath(),e.save(),e.clip(),e.fillRect(0,0,Math.max(t,n)+1,Math.max(r,i)),e.restore()}function aS(e,t){return Math.abs(e[4*t]-210)>2||Math.abs(e[4*t+3]-191.25)>2}function sS(e,t,r,n){var i=oi(r,t,e),o=Jn(t,n,r),a=t.getMetersPerUnit();void 0!==a&&(o*=a);var s=e.getMetersPerUnit();void 0!==s&&(o/=s);var l=e.getExtent();if(!l||Q(l,i)){var c=Jn(e,o,i)/o;isFinite(c)&&c>0&&(o/=c)}return o}function lS(e,t,r,n,i,o,a,s,l,c,u,p){var h=or(Math.round(r*e),Math.round(r*t),iS);if(p||nt(h,rS),0===l.length)return h.canvas;function d(e){return Math.round(e*r)/r}h.scale(r,r),h.globalCompositeOperation="lighter";var f=[1/0,1/0,-1/0,-1/0];l.forEach((function(e,t,r){ce(f,e.extent)}));var g=Le(f),y=Se(f),m=or(Math.round(r*g/n),Math.round(r*y/n));p||nt(m,rS);var v=r/n;l.forEach((function(e,t,r){var n=e.extent[0]-f[0],i=-(e.extent[3]-f[3]),o=Le(e.extent),a=Se(e.extent);e.image.width>0&&e.image.height>0&&m.drawImage(e.image,c,c,e.image.width-2*c,e.image.height-2*c,n*v,i*v,o*v,a*v)}));var _=be(a);return s.getTriangles().forEach((function(e,t,i){var a=e.source,s=e.target,l=a[0][0],c=a[0][1],u=a[1][0],g=a[1][1],y=a[2][0],v=a[2][1],w=d((s[0][0]-_[0])/o),S=d(-(s[0][1]-_[1])/o),E=d((s[1][0]-_[0])/o),b=d(-(s[1][1]-_[1])/o),C=d((s[2][0]-_[0])/o),L=d(-(s[2][1]-_[1])/o),T=l,A=c;l=0,c=0;var x=function(e){for(var t=e.length,r=0;r<t;r++){for(var n=r,i=Math.abs(e[r][r]),o=r+1;o<t;o++){var a=Math.abs(e[o][r]);a>i&&(i=a,n=o)}if(0===i)return null;var s=e[n];e[n]=e[r],e[r]=s;for(var l=r+1;l<t;l++)for(var c=-e[l][r]/e[r][r],u=r;u<t+1;u++)r==u?e[l][u]=0:e[l][u]+=c*e[r][u]}for(var p=new Array(t),h=t-1;h>=0;h--){p[h]=e[h][t]/e[h][h];for(var d=h-1;d>=0;d--)e[d][t]-=e[d][h]*p[h]}return p}([[u-=T,g-=A,0,0,E-w],[y-=T,v-=A,0,0,C-w],[0,0,u,g,b-S],[0,0,y,v,L-S]]);if(x){if(h.save(),h.beginPath(),function(){if(void 0===tS){var e=document.createElement("canvas").getContext("2d");e.globalCompositeOperation="lighter",e.fillStyle="rgba(210, 0, 0, 0.75)",oS(e,4,5,4,0),oS(e,4,5,0,5);var t=e.getImageData(0,0,3,3).data;tS=aS(t,0)||aS(t,4)||aS(t,8)}return tS}()||!p){h.moveTo(E,b);for(var P=w-E,O=S-b,I=0;I<4;I++)h.lineTo(E+d((I+1)*P/4),b+d(I*O/3)),3!=I&&h.lineTo(E+d((I+1)*P/4),b+d((I+1)*O/3));h.lineTo(C,L)}else h.moveTo(E,b),h.lineTo(w,S),h.lineTo(C,L);h.clip(),h.transform(x[0],x[2],x[1],x[3],w,S),h.translate(f[0]-T,f[3]-A),h.scale(n/r,-n/r),h.drawImage(m.canvas,0,0),h.restore()}})),u&&(h.save(),h.globalCompositeOperation="source-over",h.strokeStyle="black",h.lineWidth=1,s.getTriangles().forEach((function(e,t,r){var n=e.target,i=(n[0][0]-_[0])/o,a=-(n[0][1]-_[1])/o,s=(n[1][0]-_[0])/o,l=-(n[1][1]-_[1])/o,c=(n[2][0]-_[0])/o,u=-(n[2][1]-_[1])/o;h.beginPath(),h.moveTo(s,l),h.lineTo(i,a),h.lineTo(c,u),h.closePath(),h.stroke()})),h.restore()),h.canvas}var cS=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),uS=function(e){function t(t,r,n,i,o,a,s,l,c,u,p,h){var d=e.call(this,o,cn,{interpolate:!!h})||this;d.renderEdges_=void 0!==p&&p,d.pixelRatio_=s,d.gutter_=l,d.canvas_=null,d.sourceTileGrid_=r,d.targetTileGrid_=i,d.wrappedTileCoord_=a||o,d.sourceTiles_=[],d.sourcesListenerKeys_=null,d.sourceZ_=0;var f=i.getTileCoordExtent(d.wrappedTileCoord_),g=d.targetTileGrid_.getExtent(),y=d.sourceTileGrid_.getExtent(),m=g?Ee(f,g):f;if(0===fe(m))return d.state=dn,d;var v=t.getExtent();v&&(y=y?Ee(y,v):v);var _=i.getResolution(d.wrappedTileCoord_[0]),w=function(e,t,r,n){var i=me(r),o=sS(e,t,i,n);return(!isFinite(o)||o<=0)&&de(r,(function(r){return o=sS(e,t,r,n),isFinite(o)&&o>0})),o}(t,n,m,_);if(!isFinite(w)||w<=0)return d.state=dn,d;var S=void 0!==u?u:.5;if(d.triangulation_=new eS(t,n,m,y,w*S,_),0===d.triangulation_.getTriangles().length)return d.state=dn,d;d.sourceZ_=r.getZForResolution(w);var E=d.triangulation_.calculateSourceExtent();if(y&&(t.canWrapX()?(E[1]=Ie(E[1],y[1],y[3]),E[3]=Ie(E[3],y[1],y[3])):E=Ee(E,y)),fe(E)){for(var b=r.getTileRangeForExtentAndZ(E,d.sourceZ_),C=b.minX;C<=b.maxX;C++)for(var L=b.minY;L<=b.maxY;L++){var T=c(d.sourceZ_,C,L,s);T&&d.sourceTiles_.push(T)}0===d.sourceTiles_.length&&(d.state=dn)}else d.state=dn;return d}return cS(t,e),t.prototype.getImage=function(){return this.canvas_},t.prototype.reproject_=function(){var e=[];if(this.sourceTiles_.forEach(function(t,r,n){t&&t.getState()==pn&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}.bind(this)),this.sourceTiles_.length=0,0===e.length)this.state=hn;else{var t=this.wrappedTileCoord_[0],r=this.targetTileGrid_.getTileSize(t),n="number"==typeof r?r:r[0],i="number"==typeof r?r:r[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),s=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=lS(n,i,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,s,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=pn}this.changed()},t.prototype.load=function(){if(this.state==cn){this.state=un,this.changed();var e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(t,r,n){var i=t.getState();if(i==cn||i==un){e++;var o=ut(t,ct.CHANGE,(function(r){var n=t.getState();n!=pn&&n!=hn&&n!=dn||(ht(o),0===--e&&(this.unlistenSources_(),this.reproject_()))}),this);this.sourcesListenerKeys_.push(o)}}.bind(this)),0===e?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach((function(e,t,r){e.getState()==cn&&e.load()}))}},t.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(ht),this.sourcesListenerKeys_=null},t.prototype.release=function(){this.canvas_&&(ar(this.canvas_.getContext("2d")),iS.push(this.canvas_),this.canvas_=null),e.prototype.release.call(this)},t}($w);const pS=uS;var hS=function(){function e(e,t,r,n){this.minX=e,this.maxX=t,this.minY=r,this.maxY=n}return e.prototype.contains=function(e){return this.containsXY(e[1],e[2])},e.prototype.containsTileRange=function(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY},e.prototype.containsXY=function(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY},e.prototype.equals=function(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY},e.prototype.extend=function(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)},e.prototype.getHeight=function(){return this.maxY-this.minY+1},e.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},e.prototype.getWidth=function(){return this.maxX-this.minX+1},e.prototype.intersects=function(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY},e}();function dS(e,t,r,n,i){return void 0!==i?(i.minX=e,i.maxX=t,i.minY=r,i.maxY=n,i):new hS(e,t,r,n)}const fS=hS;var gS=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),yS=function(e){function t(t){var r=e.call(this,t)||this;return r.extentChanged=!0,r.renderedExtent_=null,r.renderedPixelRatio,r.renderedProjection=null,r.renderedRevision,r.renderedTiles=[],r.newTiles_=!1,r.tmpExtent=[1/0,1/0,-1/0,-1/0],r.tmpTileRange_=new fS(0,0,0,0),r}return gS(t,e),t.prototype.isDrawableTile=function(e){var t=this.getLayer(),r=e.getState(),n=t.getUseInterimTilesOnError();return r==pn||r==dn||r==hn&&!n},t.prototype.getTile=function(e,t,r,n){var i=n.pixelRatio,o=n.viewState.projection,a=this.getLayer(),s=a.getSource().getTile(e,t,r,i,o);return s.getState()==hn&&(a.getUseInterimTilesOnError()?a.getPreload()>0&&(this.newTiles_=!0):s.setState(pn)),this.isDrawableTile(s)||(s=s.getInterimTile()),s},t.prototype.getData=function(e){var t=this.frameState;if(!t)return null;var r=this.getLayer(),n=k(t.pixelToCoordinateTransform,e.slice()),i=r.getExtent();if(i&&!Q(i,n))return null;for(var o=t.pixelRatio,a=t.viewState.projection,s=t.viewState,l=r.getRenderSource(),c=l.getTileGridForProjection(s.projection),u=l.getTilePixelRatio(t.pixelRatio),p=c.getZForResolution(s.resolution);p>=c.getMinZoom();--p){var h=c.getTileCoordForCoordAndZ(n,p),d=l.getTile(p,h[1],h[2],o,a);if(!(d instanceof Qw||d instanceof pS))return null;if(d.getState()===pn){var f=c.getOrigin(p),g=ko(c.getTileSize(p)),y=c.getResolution(p),m=Math.floor(u*((n[0]-f[0])/y-h[1]*g[0])),v=Math.floor(u*((f[1]-n[1])/y-h[2]*g[1])),_=Math.round(u*l.getGutterForProjection(s.projection));return this.getImageData(d.getImage(),m+_,v+_)}}return null},t.prototype.loadedTileCallback=function(t,r,n){return!!this.isDrawableTile(n)&&e.prototype.loadedTileCallback.call(this,t,r,n)},t.prototype.prepareFrame=function(e){return!!this.getLayer().getSource()},t.prototype.renderFrame=function(e,t){var r=e.layerStatesArray[e.layerIndex],n=e.viewState,i=n.projection,a=n.resolution,s=n.center,c=n.rotation,u=e.pixelRatio,p=this.getLayer(),h=p.getSource(),d=h.getRevision(),f=h.getTileGridForProjection(i),g=f.getZForResolution(a,h.zDirection),y=f.getResolution(g),m=e.extent,v=e.viewState.resolution,_=h.getTilePixelRatio(u),w=Math.round(Le(m)/v*u),S=Math.round(Se(m)/v*u),E=r.extent&&gi(r.extent,i);E&&(m=Ee(m,gi(r.extent,i)));var b=y*w/2/_,C=y*S/2/_,L=[s[0]-b,s[1]-C,s[0]+b,s[1]+C],T=f.getTileRangeForExtentAndZ(m,g),A={};A[g]={};var x=this.createLoadedTileFinder(h,i,A),P=this.tmpExtent,O=this.tmpTileRange_;this.newTiles_=!1;for(var I=c?we(n.center,v,c,e.size):void 0,R=T.minX;R<=T.maxX;++R)for(var M=T.minY;M<=T.maxY;++M)if(!c||f.tileCoordIntersectsViewport([g,R,M],I)){var D=this.getTile(g,R,M,e);if(this.isDrawableTile(D)){var N=o(this);if(D.getState()==pn)A[g][D.tileCoord.toString()]=D,(ce=D.inTransition(N))&&1!==r.opacity&&(D.endTransition(N),ce=!1),this.newTiles_||!ce&&-1!==this.renderedTiles.indexOf(D)||(this.newTiles_=!0);if(1===D.getAlpha(N,e.time))continue}var Z=f.getTileCoordChildTileRange(D.tileCoord,O,P),F=!1;Z&&(F=x(g+1,Z)),F||f.forEachTileCoordParentTileRange(D.tileCoord,x,O,P)}var U=y/a*u/_;B(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/u,1/u,c,-w/2,-S/2);var W=j(this.pixelTransform);this.useContainer(t,W,this.getBackground(e));var H=this.context,q=H.canvas;G(this.inversePixelTransform,this.pixelTransform),B(this.tempTransform,w/2,S/2,U,U,0,-w/2,-S/2),q.width!=w||q.height!=S?(q.width=w,q.height=S):this.containerReused||H.clearRect(0,0,w,S),E&&this.clipUnrotated(H,e,E),h.getInterpolate()||nt(H,rS),this.preRender(H,e),this.renderedTiles.length=0;var V,z,Y,K=Object.keys(A).map(Number);K.sort(l),1!==r.opacity||this.containerReused&&!h.getOpaque(e.viewState.projection)?(V=[],z=[]):K=K.reverse();for(var X=K.length-1;X>=0;--X){var $=K[X],J=h.getTilePixelSize($,u,i),Q=f.getResolution($)/y,ee=J[0]*Q*U,te=J[1]*Q*U,re=f.getTileCoordForCoordAndZ(be(L),$),ne=f.getTileCoordExtent(re),ie=k(this.tempTransform,[_*(ne[0]-L[0])/y,_*(L[3]-ne[3])/y]),oe=_*h.getGutterForProjection(i),ae=A[$];for(var se in ae){var ce,ue=(D=ae[se]).tileCoord,pe=re[1]-ue[1],he=Math.round(ie[0]-(pe-1)*ee),de=re[2]-ue[2],fe=Math.round(ie[1]-(de-1)*te),ge=he-(R=Math.round(ie[0]-pe*ee)),ye=fe-(M=Math.round(ie[1]-de*te)),me=g===$,ve=!1;if(!(ce=me&&1!==D.getAlpha(o(this),e.time)))if(V){Y=[R,M,R+ge,M,R+ge,M+ye,R,M+ye];for(var _e=0,Ce=V.length;_e<Ce;++_e)if(g!==$&&$<z[_e]){var Ae=V[_e];Te([R,M,R+ge,M+ye],[Ae[0],Ae[3],Ae[4],Ae[7]])&&(ve||(H.save(),ve=!0),H.beginPath(),H.moveTo(Y[0],Y[1]),H.lineTo(Y[2],Y[3]),H.lineTo(Y[4],Y[5]),H.lineTo(Y[6],Y[7]),H.moveTo(Ae[6],Ae[7]),H.lineTo(Ae[4],Ae[5]),H.lineTo(Ae[2],Ae[3]),H.lineTo(Ae[0],Ae[1]),H.clip())}V.push(Y),z.push($)}else H.clearRect(R,M,ge,ye);this.drawTileImage(D,e,R,M,ge,ye,oe,me),V&&!ce?(ve&&H.restore(),this.renderedTiles.unshift(D)):this.renderedTiles.push(D),this.updateUsedTiles(e.usedTiles,h,D)}}return this.renderedRevision=d,this.renderedResolution=y,this.extentChanged=!this.renderedExtent_||!le(this.renderedExtent_,L),this.renderedExtent_=L,this.renderedPixelRatio=u,this.renderedProjection=i,this.manageTilePyramid(e,h,f,u,i,m,g,p.getPreload()),this.scheduleExpireCache(e,h),this.postRender(H,e),r.extent&&H.restore(),nt(H,nS),W!==q.style.transform&&(q.style.transform=W),this.container},t.prototype.drawTileImage=function(e,t,r,n,i,a,s,l){var c=this.getTileImage(e);if(c){var u=o(this),p=t.layerStatesArray[t.layerIndex],h=p.opacity*(l?e.getAlpha(u,t.time):1),d=h!==this.context.globalAlpha;d&&(this.context.save(),this.context.globalAlpha=h),this.context.drawImage(c,s,s,c.width-2*s,c.height-2*s,r,n,i,a),d&&this.context.restore(),h!==p.opacity?t.animate=!0:l&&e.endTransition(u)}},t.prototype.getImage=function(){var e=this.context;return e?e.canvas:null},t.prototype.getTileImage=function(e){return e.getImage()},t.prototype.scheduleExpireCache=function(e,t){if(t.canExpireCache()){var r=function(e,t,r){var n=o(e);n in r.usedTiles&&e.expireCache(r.viewState.projection,r.usedTiles[n])}.bind(null,t);e.postRenderFunctions.push(r)}},t.prototype.updateUsedTiles=function(e,t,r){var n=o(t);n in e||(e[n]={}),e[n][r.getKey()]=!0},t.prototype.manageTilePyramid=function(e,t,r,n,i,a,s,l,c){var u=o(t);u in e.wantedTiles||(e.wantedTiles[u]={});var p,h,d,f,g,y,m=e.wantedTiles[u],v=e.tileQueue,_=r.getMinZoom(),w=e.viewState.rotation,S=w?we(e.viewState.center,e.viewState.resolution,w,e.size):void 0,E=0;for(y=_;y<=s;++y)for(h=r.getTileRangeForExtentAndZ(a,y,h),d=r.getResolution(y),f=h.minX;f<=h.maxX;++f)for(g=h.minY;g<=h.maxY;++g)w&&!r.tileCoordIntersectsViewport([y,f,g],S)||(s-y<=l?(++E,(p=t.getTile(y,f,g,n,i)).getState()==cn&&(m[p.getKey()]=!0,v.isKeyQueued(p.getKey())||v.enqueue([p,u,r.getTileCoordCenter(p.tileCoord),d])),void 0!==c&&c(p)):t.useTile(y,f,g,i));t.updateCacheSize(E,i)},t}(i_);const mS=yS;var vS=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const _S=function(e){function t(t){return e.call(this,t)||this}return vS(t,e),t.prototype.createRenderer=function(){return new mS(this)},t}(Yw);var wS=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const SS=function(e){function t(t){var r=t||{};return e.call(this,r)||this}return wS(t,e),t}(Nt);var ES=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),bS=function(e){function t(t){var r=e.call(this,t)||this;return r.image_=null,r}return ES(t,e),t.prototype.getImage=function(){return this.image_?this.image_.getImage():null},t.prototype.prepareFrame=function(e){var t=e.layerStatesArray[e.layerIndex],r=e.pixelRatio,n=e.viewState,i=n.resolution,o=this.getLayer().getSource(),a=e.viewHints,s=e.extent;if(void 0!==t.extent&&(s=Ee(s,gi(t.extent,n.projection))),!a[wn]&&!a[Sn]&&!Ae(s))if(o){var l=n.projection,c=o.getImage(s,i,r,l);c&&(this.loadImage(c)?this.image_=c:c.getState()===Od&&(this.image_=null))}else this.image_=null;return!!this.image_},t.prototype.getData=function(e){var t=this.frameState;if(!t)return null;var r=this.getLayer(),n=k(t.pixelToCoordinateTransform,e.slice()),i=r.getExtent();if(i&&!Q(i,n))return null;var o=this.image_.getExtent(),a=this.image_.getImage(),s=Le(o),l=Math.floor(a.width*((n[0]-o[0])/s));if(l<0||l>=a.width)return null;var c=Se(o),u=Math.floor(a.height*((o[3]-n[1])/c));return u<0||u>=a.height?null:this.getImageData(a,l,u)},t.prototype.renderFrame=function(e,t){var r=this.image_,n=r.getExtent(),i=r.getResolution(),o=r.getPixelRatio(),a=e.layerStatesArray[e.layerIndex],s=e.pixelRatio,l=e.viewState,c=l.center,u=s*i/(l.resolution*o),p=e.extent,h=l.resolution,d=l.rotation,f=Math.round(Le(p)/h*s),g=Math.round(Se(p)/h*s);B(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/s,1/s,d,-f/2,-g/2),G(this.inversePixelTransform,this.pixelTransform);var y=j(this.pixelTransform);this.useContainer(t,y,this.getBackground(e));var m=this.context,v=m.canvas;v.width!=f||v.height!=g?(v.width=f,v.height=g):this.containerReused||m.clearRect(0,0,f,g);var _=!1,w=!0;if(a.extent){var S=gi(a.extent,l.projection);(_=(w=Te(S,e.extent))&&!ee(S,e.extent))&&this.clipUnrotated(m,e,S)}var E=r.getImage(),b=B(this.tempTransform,f/2,g/2,u,u,0,o*(n[0]-c[0])/i,o*(c[1]-n[3])/i);this.renderedResolution=i*s/o;var C=E.width*b[0],L=E.height*b[3];if(this.getLayer().getSource().getInterpolate()||nt(m,rS),this.preRender(m,e),w&&C>=.5&&L>=.5){var T=b[4],A=b[5],x=a.opacity,P=void 0;1!==x&&(P=m.globalAlpha,m.globalAlpha=x),m.drawImage(E,0,0,+E.width,+E.height,T,A,C,L),1!==x&&(m.globalAlpha=P)}return this.postRender(m,e),_&&m.restore(),nt(m,nS),y!==v.style.transform&&(v.style.transform=y),this.container},t}(i_);const CS=bS;var LS=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const TS=function(e){function t(t){return e.call(this,t)||this}return LS(t,e),t.prototype.createRenderer=function(){return new CS(this)},t.prototype.getData=function(t){return e.prototype.getData.call(this,t)},t}(SS);var AS=34962,xS=34963,PS=35048,OS=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function IS(e,t){for(var r=nt({preserveDrawingBuffer:!0,antialias:!E},t),n=OS.length,i=0;i<n;++i)try{var o=e.getContext(OS[i],r);if(o)return o}catch(e){}return null}var RS=35044,MS=function(){function e(e,t){this.array=null,this.type=e,I(e===AS||e===xS,62),this.usage=void 0!==t?t:RS}return e.prototype.ofSize=function(e){this.array=new(DS(this.type))(e)},e.prototype.fromArray=function(e){var t=DS(this.type);this.array=t.from?t.from(e):new t(e)},e.prototype.fromArrayBuffer=function(e){this.array=new(DS(this.type))(e)},e.prototype.getType=function(){return this.type},e.prototype.getArray=function(){return this.array},e.prototype.getUsage=function(){return this.usage},e.prototype.getSize=function(){return this.array?this.array.length:0},e}();function DS(e){switch(e){case AS:return Float32Array;case xS:return Uint32Array;default:return Float32Array}}const NS=MS,ZS="webglcontextlost",kS="webglcontextrestored";var FS=function(){function e(e){this.gl_=e.webGlContext;var t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer();var r=t.createShader(t.VERTEX_SHADER);t.shaderSource(r,e.vertexShader||"\n  precision mediump float;\n  \n  attribute vec2 a_position;\n  varying vec2 v_texCoord;\n  varying vec2 v_screenCoord;\n  \n  uniform vec2 u_screenSize;\n   \n  void main() {\n    v_texCoord = a_position * 0.5 + 0.5;\n    v_screenCoord = v_texCoord * u_screenSize;\n    gl_Position = vec4(a_position, 0.0, 1.0);\n  }\n"),t.compileShader(r);var n=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(n,e.fragmentShader||"\n  precision mediump float;\n   \n  uniform sampler2D u_image;\n  uniform float u_opacity;\n   \n  varying vec2 v_texCoord;\n   \n  void main() {\n    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n  }\n"),t.compileShader(n),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,r),t.attachShader(this.renderTargetProgram_,n),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(function(r){this.uniforms_.push({value:e.uniforms[r],location:t.getUniformLocation(this.renderTargetProgram_,r)})}.bind(this))}return e.prototype.getGL=function(){return this.gl_},e.prototype.init=function(e){var t=this.getGL(),r=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.viewport(0,0,r[0],r[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==r[0]||this.renderTargetTextureSize_[1]!==r[1]){this.renderTargetTextureSize_=r;var n=t.RGBA,i=t.RGBA,o=t.UNSIGNED_BYTE;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,0,n,r[0],r[1],0,i,o,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0)}},e.prototype.apply=function(e,t,r,n){var i=this.getGL(),a=e.size;if(i.bindFramebuffer(i.FRAMEBUFFER,t?t.getFrameBuffer():null),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.renderTargetTexture_),!t){var s=o(i.canvas);if(!e.renderTargets[s]){var l=i.getContextAttributes();l&&l.preserveDrawingBuffer&&(i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT)),e.renderTargets[s]=!0}}i.enable(i.BLEND),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight),i.bindBuffer(i.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),i.useProgram(this.renderTargetProgram_),i.enableVertexAttribArray(this.renderTargetAttribLocation_),i.vertexAttribPointer(this.renderTargetAttribLocation_,2,i.FLOAT,!1,0,0),i.uniform2f(this.renderTargetUniformLocation_,a[0],a[1]),i.uniform1i(this.renderTargetTextureLocation_,0);var c=e.layerStatesArray[e.layerIndex].opacity;i.uniform1f(this.renderTargetOpacityLocation_,c),this.applyUniforms(e),r&&r(i,e),i.drawArrays(i.TRIANGLES,0,6),n&&n(i,e)},e.prototype.getFrameBuffer=function(){return this.frameBuffer_},e.prototype.applyUniforms=function(e){var t,r=this.getGL(),n=1;this.uniforms_.forEach((function(i){if((t="function"==typeof i.value?i.value(e):i.value)instanceof HTMLCanvasElement||t instanceof ImageData)i.texture||(i.texture=r.createTexture()),r.activeTexture(r["TEXTURE".concat(n)]),r.bindTexture(r.TEXTURE_2D,i.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),t instanceof ImageData?r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,t.width,t.height,0,r.UNSIGNED_BYTE,new Uint8Array(t.data)):r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t),r.uniform1i(i.location,n++);else if(Array.isArray(t))switch(t.length){case 2:return void r.uniform2f(i.location,t[0],t[1]);case 3:return void r.uniform3f(i.location,t[0],t[1],t[2]);case 4:return void r.uniform4f(i.location,t[0],t[1],t[2],t[3]);default:return}else"number"==typeof t&&r.uniform1f(i.location,t)}))},e}();const US=FS;function BS(e,t){return e[0]=t[0],e[1]=t[1],e[4]=t[2],e[5]=t[3],e[12]=t[4],e[13]=t[5],e}var GS=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),jS="u_projectionMatrix",WS="u_offsetScaleMatrix",HS="u_offsetRotateMatrix",qS="u_time",VS="u_zoom",zS="u_resolution",YS={UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126},KS={};function XS(e){return"shared/"+e}var $S=0;var JS=function(e){function t(t){var r,n=e.call(this)||this,i=t||{};n.boundHandleWebGLContextLost_=n.handleWebGLContextLost.bind(n),n.boundHandleWebGLContextRestored_=n.handleWebGLContextRestored.bind(n),n.canvasCacheKey_=i.canvasCacheKey?XS(i.canvasCacheKey):(r="unique/"+$S,$S+=1,r),n.canvas_=function(e){var t=KS[e];if(!t){var r=document.createElement("canvas");r.style.position="absolute",r.style.left="0",t={users:0,canvas:r},KS[e]=t}return t.users+=1,t.canvas}(n.canvasCacheKey_),n.gl_=IS(n.canvas_),n.bufferCache_={},n.extensionCache_={},n.currentProgram_=null,n.canvas_.addEventListener(ZS,n.boundHandleWebGLContextLost_),n.canvas_.addEventListener(kS,n.boundHandleWebGLContextRestored_),n.offsetRotateMatrix_=[1,0,0,1,0,0],n.offsetScaleMatrix_=[1,0,0,1,0,0],n.tmpMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n.uniformLocations_={},n.attribLocations_={},n.uniforms_=[],i.uniforms&&n.setUniforms(i.uniforms);var o=n.getGL();return n.postProcessPasses_=i.postProcesses?i.postProcesses.map((function(e){return new US({webGlContext:o,scaleRatio:e.scaleRatio,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms})})):[new US({webGlContext:o})],n.shaderCompileErrors_=null,n.startTime_=Date.now(),n}return GS(t,e),t.prototype.setUniforms=function(e){for(var t in this.uniforms_=[],e)this.uniforms_.push({name:t,value:e[t]});this.uniformLocations_={}},t.prototype.canvasCacheKeyMatches=function(e){return this.canvasCacheKey_===XS(e)},t.prototype.getExtension=function(e){if(e in this.extensionCache_)return this.extensionCache_[e];var t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t},t.prototype.bindBuffer=function(e){var t=this.getGL(),r=o(e),n=this.bufferCache_[r];n||(n={buffer:e,webGlBuffer:t.createBuffer()},this.bufferCache_[r]=n);t.bindBuffer(e.getType(),n.webGlBuffer)},t.prototype.flushBufferData=function(e){var t=this.getGL();this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())},t.prototype.deleteBuffer=function(e){var t=this.getGL(),r=o(e),n=this.bufferCache_[r];n&&!t.isContextLost()&&t.deleteBuffer(n.webGlBuffer),delete this.bufferCache_[r]},t.prototype.disposeInternal=function(){this.canvas_.removeEventListener(ZS,this.boundHandleWebGLContextLost_),this.canvas_.removeEventListener(kS,this.boundHandleWebGLContextRestored_),function(e){var t=KS[e];if(t&&(t.users-=1,!(t.users>0))){var r=IS(t.canvas).getExtension("WEBGL_lose_context");r&&r.loseContext(),delete KS[e]}}(this.canvasCacheKey_),delete this.gl_,delete this.canvas_},t.prototype.prepareDraw=function(e,t){var r=this.getGL(),n=this.getCanvas(),i=e.size,o=e.pixelRatio;n.width=i[0]*o,n.height=i[1]*o,n.style.width=i[0]+"px",n.style.height=i[1]+"px",r.useProgram(this.currentProgram_);for(var a=this.postProcessPasses_.length-1;a>=0;a--)this.postProcessPasses_[a].init(e);r.bindTexture(r.TEXTURE_2D,null),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.enable(r.BLEND),r.blendFunc(r.ONE,t?r.ZERO:r.ONE_MINUS_SRC_ALPHA),r.useProgram(this.currentProgram_),this.applyFrameState(e),this.applyUniforms(e)},t.prototype.prepareDrawToRenderTarget=function(e,t,r){var n=this.getGL(),i=t.getSize();n.bindFramebuffer(n.FRAMEBUFFER,t.getFramebuffer()),n.viewport(0,0,i[0],i[1]),n.bindTexture(n.TEXTURE_2D,t.getTexture()),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,r?n.ZERO:n.ONE_MINUS_SRC_ALPHA),n.useProgram(this.currentProgram_),this.applyFrameState(e),this.applyUniforms(e)},t.prototype.drawElements=function(e,t){var r=this.getGL();this.getExtension("OES_element_index_uint");var n=r.UNSIGNED_INT,i=t-e,o=4*e;r.drawElements(r.TRIANGLES,i,n,o)},t.prototype.finalizeDraw=function(e,t,r){for(var n=0,i=this.postProcessPasses_.length;n<i;n++)n===i-1?this.postProcessPasses_[n].apply(e,null,t,r):this.postProcessPasses_[n].apply(e,this.postProcessPasses_[n+1])},t.prototype.getCanvas=function(){return this.canvas_},t.prototype.getGL=function(){return this.gl_},t.prototype.applyFrameState=function(e){var t=e.size,r=e.viewState.rotation,n=D(this.offsetScaleMatrix_);F(n,2/t[0],2/t[1]);var i=D(this.offsetRotateMatrix_);0!==r&&function(e,t){var r=Math.cos(t),n=Math.sin(t);N(e,Z(M,r,n,-n,r,0,0))}(i,-r),this.setUniformMatrixValue(WS,BS(this.tmpMat4_,n)),this.setUniformMatrixValue(HS,BS(this.tmpMat4_,i)),this.setUniformFloatValue(qS,.001*(Date.now()-this.startTime_)),this.setUniformFloatValue(VS,e.viewState.zoom),this.setUniformFloatValue(zS,e.viewState.resolution)},t.prototype.applyUniforms=function(e){var t,r=this.getGL(),n=0;this.uniforms_.forEach(function(i){if((t="function"==typeof i.value?i.value(e):i.value)instanceof HTMLCanvasElement||t instanceof HTMLImageElement||t instanceof ImageData)i.texture||(i.prevValue=void 0,i.texture=r.createTexture()),r.activeTexture(r["TEXTURE".concat(n)]),r.bindTexture(r.TEXTURE_2D,i.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),(!(t instanceof HTMLImageElement)||t.complete)&&i.prevValue!==t&&(i.prevValue=t,r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)),r.uniform1i(this.getUniformLocation(i.name),n++);else if(Array.isArray(t)&&6===t.length)this.setUniformMatrixValue(i.name,BS(this.tmpMat4_,t));else if(Array.isArray(t)&&t.length<=4)switch(t.length){case 2:return void r.uniform2f(this.getUniformLocation(i.name),t[0],t[1]);case 3:return void r.uniform3f(this.getUniformLocation(i.name),t[0],t[1],t[2]);case 4:return void r.uniform4f(this.getUniformLocation(i.name),t[0],t[1],t[2],t[3]);default:return}else"number"==typeof t&&r.uniform1f(this.getUniformLocation(i.name),t)}.bind(this))},t.prototype.useProgram=function(e){return e!=this.currentProgram_&&(this.getGL().useProgram(e),this.currentProgram_=e,this.uniformLocations_={},this.attribLocations_={},!0)},t.prototype.compileShader=function(e,t){var r=this.getGL(),n=r.createShader(t);return r.shaderSource(n,e),r.compileShader(n),n},t.prototype.getProgram=function(e,t){var r=this.getGL(),n=this.compileShader(e,r.FRAGMENT_SHADER),i=this.compileShader(t,r.VERTEX_SHADER),o=r.createProgram();if(r.attachShader(o,n),r.attachShader(o,i),r.linkProgram(o),!r.getShaderParameter(n,r.COMPILE_STATUS)){var a="Fragment shader compliation failed: ".concat(r.getShaderInfoLog(n));throw new Error(a)}if(r.deleteShader(n),!r.getShaderParameter(i,r.COMPILE_STATUS)){a="Vertex shader compilation failed: ".concat(r.getShaderInfoLog(i));throw new Error(a)}if(r.deleteShader(i),!r.getProgramParameter(o,r.LINK_STATUS)){a="GL program linking failed: ".concat(r.getShaderInfoLog(i));throw new Error(a)}return o},t.prototype.getUniformLocation=function(e){return void 0===this.uniformLocations_[e]&&(this.uniformLocations_[e]=this.getGL().getUniformLocation(this.currentProgram_,e)),this.uniformLocations_[e]},t.prototype.getAttributeLocation=function(e){return void 0===this.attribLocations_[e]&&(this.attribLocations_[e]=this.getGL().getAttribLocation(this.currentProgram_,e)),this.attribLocations_[e]},t.prototype.makeProjectionTransform=function(e,t){var r=e.size,n=e.viewState.rotation,i=e.viewState.resolution,o=e.viewState.center;return D(t),B(t,0,0,2/(i*r[0]),2/(i*r[1]),-n,-o[0],-o[1]),t},t.prototype.setUniformFloatValue=function(e,t){this.getGL().uniform1f(this.getUniformLocation(e),t)},t.prototype.setUniformFloatVec4=function(e,t){this.getGL().uniform4fv(this.getUniformLocation(e),t)},t.prototype.setUniformMatrixValue=function(e,t){this.getGL().uniformMatrix4fv(this.getUniformLocation(e),!1,t)},t.prototype.enableAttributeArray_=function(e,t,r,n,i){var o=this.getAttributeLocation(e);o<0||(this.getGL().enableVertexAttribArray(o),this.getGL().vertexAttribPointer(o,t,r,!1,n,i))},t.prototype.enableAttributes=function(e){for(var t=function(e){for(var t=0,r=0;r<e.length;r++){var n=e[r];t+=n.size*QS(n.type)}return t}(e),r=0,n=0;n<e.length;n++){var i=e[n];this.enableAttributeArray_(i.name,i.size,i.type||5126,t,r),r+=i.size*QS(i.type)}},t.prototype.handleWebGLContextLost=function(){it(this.bufferCache_),this.currentProgram_=null},t.prototype.handleWebGLContextRestored=function(){},t.prototype.createTexture=function(e,t,r){var n=this.getGL(),i=r||n.createTexture(),o=n.RGBA,a=n.RGBA,s=n.UNSIGNED_BYTE;return n.bindTexture(n.TEXTURE_2D,i),t?n.texImage2D(n.TEXTURE_2D,0,o,a,s,t):n.texImage2D(n.TEXTURE_2D,0,o,e[0],e[1],0,a,s,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),i},t}(s);function QS(e){switch(e){case YS.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case YS.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case YS.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case YS.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}const eE=JS;var tE=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),rE="GENERATE_BUFFERS",nE=function(e){function t(t,r){var n=e.call(this,t)||this,i=r||{};return n.inversePixelTransform_=[1,0,0,1,0,0],n.pixelContext_=null,n.postProcesses_=i.postProcesses,n.uniforms_=i.uniforms,n.helper,t.addChangeListener(Pt,n.removeHelper.bind(n)),n.dispatchPreComposeEvent=n.dispatchPreComposeEvent.bind(n),n.dispatchPostComposeEvent=n.dispatchPostComposeEvent.bind(n),n}return tE(t,e),t.prototype.dispatchPreComposeEvent=function(e,t){var r=this.getLayer();if(r.hasListener(Rt.PRECOMPOSE)){var n=new $t(Rt.PRECOMPOSE,void 0,t,e);r.dispatchEvent(n)}},t.prototype.dispatchPostComposeEvent=function(e,t){var r=this.getLayer();if(r.hasListener(Rt.POSTCOMPOSE)){var n=new $t(Rt.POSTCOMPOSE,void 0,t,e);r.dispatchEvent(n)}},t.prototype.reset=function(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)},t.prototype.removeHelper=function(){this.helper&&(this.helper.dispose(),delete this.helper)},t.prototype.prepareFrame=function(e){if(this.getLayer().getRenderSource()){for(var r=!0,n=-1,i=void 0,o=0,a=e.layerStatesArray.length;o<a;o++){var s=e.layerStatesArray[o].layer,l=s.getRenderer();if(l instanceof t){var c=s.getClassName();if((r||c!==i)&&(n+=1,r=!1),i=c,l===this)break}else r=!0}var u="map/"+e.mapId+"/group/"+n;this.helper&&this.helper.canvasCacheKeyMatches(u)||(this.removeHelper(),this.helper=new eE({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:u}),i&&(this.helper.getCanvas().className=i),this.afterHelperCreated())}return this.prepareFrameInternal(e)},t.prototype.afterHelperCreated=function(){},t.prototype.prepareFrameInternal=function(e){return!0},t.prototype.disposeInternal=function(){this.removeHelper(),e.prototype.disposeInternal.call(this)},t.prototype.dispatchRenderEvent_=function(e,t,r){var n=this.getLayer();if(n.hasListener(e)){B(this.inversePixelTransform_,0,0,r.pixelRatio,-r.pixelRatio,0,0,-r.size[1]);var i=new $t(e,this.inversePixelTransform_,r,t);n.dispatchEvent(i)}},t.prototype.preRender=function(e,t){this.dispatchRenderEvent_(Rt.PRERENDER,e,t)},t.prototype.postRender=function(e,t){this.dispatchRenderEvent_(Rt.POSTRENDER,e,t)},t.prototype.getDataAtPixel=function(e,t,r){var n=k([t.pixelRatio,0,0,t.pixelRatio,0,0],e.slice()),i=this.helper.getGL();if(!i)return null;var o=this.getLayer().getExtent();if(o&&!Q(o,k(t.pixelToCoordinateTransform,e.slice())))return null;var a=i.getContextAttributes();if(!a||!a.preserveDrawingBuffer)return new Uint8Array;var s,l=Math.round(n[0]),c=Math.round(n[1]),u=this.pixelContext_;if(!u){var p=document.createElement("canvas");p.width=1,p.height=1,u=p.getContext("2d"),this.pixelContext_=u}u.clearRect(0,0,1,1);try{u.drawImage(i.canvas,l,c,1,1,0,0,1,1),s=u.getImageData(0,0,1,1).data}catch(e){return s}return 0===s[3]?null:s},t}(Qv);const iE=nE;var oE=new Uint8Array(4),aE=function(){function e(e,t){this.helper_=e;var r=e.getGL();this.texture_=r.createTexture(),this.framebuffer_=r.createFramebuffer(),this.size_=t||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}return e.prototype.setSize=function(e){f(e,this.size_)||(this.size_[0]=e[0],this.size_[1]=e[1],this.updateSize_())},e.prototype.getSize=function(){return this.size_},e.prototype.clearCachedData=function(){this.dataCacheDirty_=!0},e.prototype.readAll=function(){if(this.dataCacheDirty_){var e=this.size_,t=this.helper_.getGL();t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.readPixels(0,0,e[0],e[1],t.RGBA,t.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_},e.prototype.readPixel=function(e,t){if(e<0||t<0||e>this.size_[0]||t>=this.size_[1])return oE[0]=0,oE[1]=0,oE[2]=0,oE[3]=0,oE;this.readAll();var r=Math.floor(e)+(this.size_[1]-Math.floor(t)-1)*this.size_[0];return oE[0]=this.data_[4*r],oE[1]=this.data_[4*r+1],oE[2]=this.data_[4*r+2],oE[3]=this.data_[4*r+3],oE},e.prototype.getTexture=function(){return this.texture_},e.prototype.getFramebuffer=function(){return this.framebuffer_},e.prototype.updateSize_=function(){var e=this.size_,t=this.helper_.getGL();this.texture_=this.helper_.createTexture(e,null,this.texture_),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.viewport(0,0,e[0],e[1]),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture_,0),this.data_=new Uint8Array(e[0]*e[1]*4)},e}();const sE=aE;var lE=r(2486).lW;var cE=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const uE=function(e){function t(t,r){var n=this,i=r.uniforms||{},a=[1,0,0,1,0,0];i[jS]=a,(n=e.call(this,t,{uniforms:i,postProcesses:r.postProcesses})||this).ready=!1,n.sourceRevision_=-1,n.verticesBuffer_=new NS(AS,PS),n.hitVerticesBuffer_=new NS(AS,PS),n.indicesBuffer_=new NS(xS,PS),n.vertexShader_=r.vertexShader,n.fragmentShader_=r.fragmentShader,n.program_,n.hitDetectionEnabled_=!(!r.hitFragmentShader||!r.hitVertexShader),n.hitVertexShader_=r.hitVertexShader,n.hitFragmentShader_=r.hitFragmentShader,n.hitProgram_;var s=r.attributes?r.attributes.map((function(e){return{name:"a_"+e.name,size:1,type:YS.FLOAT}})):[];n.attributes=[{name:"a_position",size:2,type:YS.FLOAT},{name:"a_index",size:1,type:YS.FLOAT}].concat(s),n.hitDetectionAttributes=[{name:"a_position",size:2,type:YS.FLOAT},{name:"a_index",size:1,type:YS.FLOAT},{name:"a_hitColor",size:4,type:YS.FLOAT},{name:"a_featureUid",size:1,type:YS.FLOAT}].concat(s),n.customAttributes=r.attributes?r.attributes:[],n.previousExtent_=[1/0,1/0,-1/0,-1/0],n.currentTransform_=a,n.renderTransform_=[1,0,0,1,0,0],n.invertRenderTransform_=[1,0,0,1,0,0],n.renderInstructions_=new Float32Array(0),n.hitRenderInstructions_=new Float32Array(0),n.hitRenderTarget_,n.generateBuffersRun_=0,n.worker_=function(){var e='const e="function"==typeof Object.assign?Object.assign:function(e,n){if(null==e)throw new TypeError("Cannot convert undefined or null to object");const t=Object(e);for(let e=1,n=arguments.length;e<n;++e){const n=arguments[e];if(null!=n)for(const e in n)n.hasOwnProperty(e)&&(t[e]=n[e])}return t},n="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"";n.indexOf("firefox");-1!==n.indexOf("safari")&&-1==n.indexOf("chrom")&&(n.indexOf("version/15.4")>=0||n.match(/cpu (os|iphone os) 15_4 like mac os x/)),-1!==n.indexOf("webkit")&&n.indexOf("edge"),n.indexOf("macintosh"),"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&(self,WorkerGlobalScope),function(){let e=!1;try{const n=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("_",null,n),window.removeEventListener("_",null,n)}catch(e){}}(),new Array(6);const t="GENERATE_BUFFERS",o=[],r={vertexPosition:0,indexPosition:0};function i(e,n,t,o,r){e[n+0]=t,e[n+1]=o,e[n+2]=r}function s(e,n,t,s,f,c){const l=3+f,a=e[n+0],u=e[n+1],d=o;d.length=f;for(let t=0;t<d.length;t++)d[t]=e[n+2+t];let g=c?c.vertexPosition:0,x=c?c.indexPosition:0;const h=g/l;return i(t,g,a,u,0),d.length&&t.set(d,g+3),g+=l,i(t,g,a,u,1),d.length&&t.set(d,g+3),g+=l,i(t,g,a,u,2),d.length&&t.set(d,g+3),g+=l,i(t,g,a,u,3),d.length&&t.set(d,g+3),g+=l,s[x++]=h,s[x++]=h+1,s[x++]=h+3,s[x++]=h+1,s[x++]=h+2,s[x++]=h+3,r.vertexPosition=g,r.indexPosition=x,r}const f=self;f.onmessage=n=>{const o=n.data;if(o.type===t){const n=3,t=2,r=o.customAttributesCount,i=t+r,c=new Float32Array(o.renderInstructions),l=c.length/i,a=4*l*(r+n),u=new Uint32Array(6*l),d=new Float32Array(a);let g;for(let e=0;e<c.length;e+=i)g=s(c,e,d,u,r,g);const x=e({vertexBuffer:d.buffer,indexBuffer:u.buffer,renderInstructions:c.buffer},o);f.postMessage(x,[d.buffer,u.buffer,c.buffer])}};';return new Worker("undefined"==typeof Blob?"data:application/javascript;base64,"+lE.from(e,"binary").toString("base64"):URL.createObjectURL(new Blob([e],{type:"application/javascript"})))}(),n.worker_.addEventListener("message",function(e){var t=e.data;if(t.type===rE){var r=t.projectionTransform;t.hitDetection?(this.hitVerticesBuffer_.fromArrayBuffer(t.vertexBuffer),this.helper.flushBufferData(this.hitVerticesBuffer_)):(this.verticesBuffer_.fromArrayBuffer(t.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_)),this.indicesBuffer_.fromArrayBuffer(t.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=r,G(this.invertRenderTransform_,this.renderTransform_),t.hitDetection?this.hitRenderInstructions_=new Float32Array(e.data.renderInstructions):(this.renderInstructions_=new Float32Array(e.data.renderInstructions),t.generateBuffersRun===this.generateBuffersRun_&&(this.ready=!0)),this.getLayer().changed()}}.bind(n)),n.featureCache_={},n.featureCount_=0;var l=n.getLayer().getSource();return n.sourceListenKeys_=[ut(l,G_.ADDFEATURE,n.handleSourceFeatureAdded_,n),ut(l,G_.CHANGEFEATURE,n.handleSourceFeatureChanged_,n),ut(l,G_.REMOVEFEATURE,n.handleSourceFeatureDelete_,n),ut(l,G_.CLEAR,n.handleSourceFeatureClear_,n)],l.forEachFeature(function(e){this.featureCache_[o(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()},this.featureCount_++}.bind(n)),n}return cE(t,e),t.prototype.afterHelperCreated=function(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitProgram_=this.helper.getProgram(this.hitFragmentShader_,this.hitVertexShader_),this.hitRenderTarget_=new sE(this.helper))},t.prototype.handleSourceFeatureAdded_=function(e){var t=e.feature;this.featureCache_[o(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()},this.featureCount_++},t.prototype.handleSourceFeatureChanged_=function(e){var t=e.feature;this.featureCache_[o(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()}},t.prototype.handleSourceFeatureDelete_=function(e){var t=e.feature;delete this.featureCache_[o(t)],this.featureCount_--},t.prototype.handleSourceFeatureClear_=function(){this.featureCache_={},this.featureCount_=0},t.prototype.renderFrame=function(e){var t=this.helper.getGL();this.preRender(t,e);var r=e.viewState.projection,n=this.getLayer().getSource().getWrapX()&&r.canWrapX(),i=r.getExtent(),o=e.extent,a=n?Le(i):null,s=n?Math.ceil((o[2]-i[2])/a)+1:1,l=n?Math.floor((o[0]-i[0])/a):0,c=l,u=this.indicesBuffer_.getSize();do{this.helper.makeProjectionTransform(e,this.currentTransform_),U(this.currentTransform_,c*a,0),N(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(e),this.helper.drawElements(0,u)}while(++c<s);this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);var p=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderHitDetection(e,l,s,a),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),p},t.prototype.prepareFrameInternal=function(e){var t=this.getLayer(),r=t.getSource(),n=e.viewState,i=!e.viewHints[wn]&&!e.viewHints[Sn],o=!le(this.previousExtent_,e.extent),a=this.sourceRevision_<r.getRevision();if(a&&(this.sourceRevision_=r.getRevision()),i&&(o||a)){var s=n.projection,l=n.resolution,c=t instanceof Tv?t.getRenderBuffer():0,u=X(e.extent,c*l);r.loadFeatures(u,l,s),this.rebuildBuffers_(e),this.previousExtent_=e.extent.slice()}return this.helper.useProgram(this.program_),this.helper.prepareDraw(e),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0},t.prototype.rebuildBuffers_=function(e){var t=[1,0,0,1,0,0];this.helper.makeProjectionTransform(e,t);var r,n,i=(2+this.customAttributes.length)*this.featureCount_;if(this.renderInstructions_&&this.renderInstructions_.length===i||(this.renderInstructions_=new Float32Array(i)),this.hitDetectionEnabled_){var o=(7+this.customAttributes.length)*this.featureCount_;this.hitRenderInstructions_&&this.hitRenderInstructions_.length===o||(this.hitRenderInstructions_=new Float32Array(o))}var a,s,l,c,u,p=[],h=[],d=0,f=0;for(var g in this.featureCache_)if((n=(r=this.featureCache_[g]).geometry)&&"Point"===n.getType()){p[0]=n.getFlatCoordinates()[0],p[1]=n.getFlatCoordinates()[1],k(t,p),s=f+6,l=void 0,c=void 0,u=void 0,c=256,u=255,(l=h||[])[0]=Math.floor(s/c/c/c)/u,l[1]=Math.floor(s/c/c)%c/u,l[2]=Math.floor(s/c)%c/u,l[3]=s%c/u,a=l,this.renderInstructions_[d++]=p[0],this.renderInstructions_[d++]=p[1],this.hitDetectionEnabled_&&(this.hitRenderInstructions_[f++]=p[0],this.hitRenderInstructions_[f++]=p[1],this.hitRenderInstructions_[f++]=a[0],this.hitRenderInstructions_[f++]=a[1],this.hitRenderInstructions_[f++]=a[2],this.hitRenderInstructions_[f++]=a[3],this.hitRenderInstructions_[f++]=Number(g));for(var y=void 0,m=0;m<this.customAttributes.length;m++)y=this.customAttributes[m].callback(r.feature,r.properties),this.renderInstructions_[d++]=y,this.hitDetectionEnabled_&&(this.hitRenderInstructions_[f++]=y)}var v={type:rE,renderInstructions:this.renderInstructions_.buffer,customAttributesCount:this.customAttributes.length};if(v.projectionTransform=t,v.generateBuffersRun=++this.generateBuffersRun_,this.ready=!1,this.worker_.postMessage(v,[this.renderInstructions_.buffer]),this.renderInstructions_=null,this.hitDetectionEnabled_){var _={type:rE,renderInstructions:this.hitRenderInstructions_.buffer,customAttributesCount:5+this.customAttributes.length};_.projectionTransform=t,_.hitDetection=!0,this.worker_.postMessage(_,[this.hitRenderInstructions_.buffer]),this.hitRenderInstructions_=null}},t.prototype.forEachFeatureAtCoordinate=function(e,t,r,n,i){if(I(this.hitDetectionEnabled_,66),this.hitRenderInstructions_){var o=k(t.coordinateToPixelTransform,e.slice()),a=this.hitRenderTarget_.readPixel(o[0]/2,o[1]/2),s=function(e){var t=0,r=256,n=255;return t+=Math.round(e[0]*r*r*r*n),t+=Math.round(e[1]*r*r*n),t+=Math.round(e[2]*r*n),t+Math.round(e[3]*n)}([a[0]/255,a[1]/255,a[2]/255,a[3]/255]),l=this.hitRenderInstructions_[s],c=Math.floor(l).toString(),u=this.getLayer().getSource().getFeatureByUid(c);return u?n(u,this.getLayer(),null):void 0}},t.prototype.renderHitDetection=function(e,t,r,n){if(this.hitVerticesBuffer_.getSize()){var i=t;this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.useProgram(this.hitProgram_),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0),this.helper.bindBuffer(this.hitVerticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.hitDetectionAttributes);do{this.helper.makeProjectionTransform(e,this.currentTransform_),U(this.currentTransform_,i*n,0),N(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(e);var o=this.indicesBuffer_.getSize();this.helper.drawElements(0,o)}while(++i<r)}},t.prototype.disposeInternal=function(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach((function(e){ht(e)})),this.sourceListenKeys_=null,e.prototype.disposeInternal.call(this)},t}(iE);var pE=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),hE="blur",dE="gradient",fE="radius",gE=["#00f","#0ff","#0f0","#ff0","#f00"];const yE=function(e){function t(t){var r=this,n=t||{},i=nt({},n);delete i.gradient,delete i.radius,delete i.blur,delete i.weight,(r=e.call(this,i)||this).gradient_=null,r.addChangeListener(dE,r.handleGradientChanged_),r.setGradient(n.gradient?n.gradient:gE),r.setBlur(void 0!==n.blur?n.blur:15),r.setRadius(void 0!==n.radius?n.radius:8);var o=n.weight?n.weight:"weight";return r.weightFunction_="string"==typeof o?function(e){return e.get(o)}:o,r.setRenderOrder(null),r}return pE(t,e),t.prototype.getBlur=function(){return this.get(hE)},t.prototype.getGradient=function(){return this.get(dE)},t.prototype.getRadius=function(){return this.get(fE)},t.prototype.handleGradientChanged_=function(){this.gradient_=function(e){for(var t=1,r=256,n=or(t,r),i=n.createLinearGradient(0,0,t,r),o=1/(e.length-1),a=0,s=e.length;a<s;++a)i.addColorStop(a*o,e[a]);return n.fillStyle=i,n.fillRect(0,0,t,r),n.canvas}(this.getGradient())},t.prototype.setBlur=function(e){this.set(hE,e)},t.prototype.setGradient=function(e){this.set(dE,e)},t.prototype.setRadius=function(e){this.set(fE,e)},t.prototype.createRenderer=function(){return new uE(this,{className:this.getClassName(),attributes:[{name:"weight",callback:function(e){var t=this.weightFunction_(e);return void 0!==t?Ie(t,0,1):1}.bind(this)}],vertexShader:"\n        precision mediump float;\n        uniform mat4 u_projectionMatrix;\n        uniform mat4 u_offsetScaleMatrix;\n        uniform float u_size;\n        attribute vec2 a_position;\n        attribute float a_index;\n        attribute float a_weight;\n\n        varying vec2 v_texCoord;\n        varying float v_weight;\n\n        void main(void) {\n          mat4 offsetMatrix = u_offsetScaleMatrix;\n          float offsetX = a_index == 0.0 || a_index == 3.0 ? -u_size / 2.0 : u_size / 2.0;\n          float offsetY = a_index == 0.0 || a_index == 1.0 ? -u_size / 2.0 : u_size / 2.0;\n          vec4 offsets = offsetMatrix * vec4(offsetX, offsetY, 0.0, 0.0);\n          gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\n          float u = a_index == 0.0 || a_index == 3.0 ? 0.0 : 1.0;\n          float v = a_index == 0.0 || a_index == 1.0 ? 0.0 : 1.0;\n          v_texCoord = vec2(u, v);\n          v_weight = a_weight;\n        }",fragmentShader:"\n        precision mediump float;\n        uniform float u_blurSlope;\n\n        varying vec2 v_texCoord;\n        varying float v_weight;\n\n        void main(void) {\n          vec2 texCoord = v_texCoord * 2.0 - vec2(1.0, 1.0);\n          float sqRadius = texCoord.x * texCoord.x + texCoord.y * texCoord.y;\n          float value = (1.0 - sqrt(sqRadius)) * u_blurSlope;\n          float alpha = smoothstep(0.0, 1.0, value) * v_weight;\n          gl_FragColor = vec4(alpha, alpha, alpha, alpha);\n        }",hitVertexShader:"\n        precision mediump float;\n        uniform mat4 u_projectionMatrix;\n        uniform mat4 u_offsetScaleMatrix;\n        uniform float u_size;\n        attribute vec2 a_position;\n        attribute float a_index;\n        attribute float a_weight;\n        attribute vec4 a_hitColor;\n\n        varying vec2 v_texCoord;\n        varying float v_weight;\n        varying vec4 v_hitColor;\n\n        void main(void) {\n          mat4 offsetMatrix = u_offsetScaleMatrix;\n          float offsetX = a_index == 0.0 || a_index == 3.0 ? -u_size / 2.0 : u_size / 2.0;\n          float offsetY = a_index == 0.0 || a_index == 1.0 ? -u_size / 2.0 : u_size / 2.0;\n          vec4 offsets = offsetMatrix * vec4(offsetX, offsetY, 0.0, 0.0);\n          gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\n          float u = a_index == 0.0 || a_index == 3.0 ? 0.0 : 1.0;\n          float v = a_index == 0.0 || a_index == 1.0 ? 0.0 : 1.0;\n          v_texCoord = vec2(u, v);\n          v_hitColor = a_hitColor;\n          v_weight = a_weight;\n        }",hitFragmentShader:"\n        precision mediump float;\n        uniform float u_blurSlope;\n\n        varying vec2 v_texCoord;\n        varying float v_weight;\n        varying vec4 v_hitColor;\n\n        void main(void) {\n          vec2 texCoord = v_texCoord * 2.0 - vec2(1.0, 1.0);\n          float sqRadius = texCoord.x * texCoord.x + texCoord.y * texCoord.y;\n          float value = (1.0 - sqrt(sqRadius)) * u_blurSlope;\n          float alpha = smoothstep(0.0, 1.0, value) * v_weight;\n          if (alpha < 0.05) {\n            discard;\n          }\n\n          gl_FragColor = v_hitColor;\n        }",uniforms:{u_size:function(){return 2*(this.get(fE)+this.get(hE))}.bind(this),u_blurSlope:function(){return this.get(fE)/Math.max(1,this.get(hE))}.bind(this)},postProcesses:[{fragmentShader:"\n            precision mediump float;\n\n            uniform sampler2D u_image;\n            uniform sampler2D u_gradientTexture;\n            uniform float u_opacity;\n\n            varying vec2 v_texCoord;\n\n            void main() {\n              vec4 color = texture2D(u_image, v_texCoord);\n              gl_FragColor.a = color.a * u_opacity;\n              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;\n              gl_FragColor.rgb *= gl_FragColor.a;\n            }",uniforms:{u_gradientTexture:function(){return this.gradient_}.bind(this),u_opacity:function(){return this.getOpacity()}.bind(this)}}]})},t.prototype.renderDeclutter=function(){},t}(Tv);function mE(e,t,r,n){return void 0!==n?(n[0]=e,n[1]=t,n[2]=r,n):[e,t,r]}function vE(e,t,r){return e+"/"+t+"/"+r}function _E(e){return vE(e[0],e[1],e[2])}var wE=[0,0,0],SE=function(){function e(e){var t,r,n,i;if(this.minZoom=void 0!==e.minZoom?e.minZoom:0,this.resolutions_=e.resolutions,I((t=this.resolutions_,r=!0,n=function(e,t){return t-e}||l,t.every((function(e,i){if(0===i)return!0;var o=n(t[i-1],e);return!(o>0||r&&0===o)}))),17),!e.origins)for(var o=0,a=this.resolutions_.length-1;o<a;++o)if(i){if(this.resolutions_[o]/this.resolutions_[o+1]!==i){i=void 0;break}}else i=this.resolutions_[o]/this.resolutions_[o+1];this.zoomFactor_=i,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==e.origin?e.origin:null,this.origins_=null,void 0!==e.origins&&(this.origins_=e.origins,I(this.origins_.length==this.resolutions_.length,20));var s=e.extent;void 0===s||this.origin_||this.origins_||(this.origin_=be(s)),I(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==e.tileSizes&&(this.tileSizes_=e.tileSizes,I(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==e.tileSize?e.tileSize:this.tileSizes_?null:bn,I(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==s?s:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==e.sizes?this.fullTileRanges_=e.sizes.map((function(e,t){var r=new fS(Math.min(0,e[0]),Math.max(e[0]-1,-1),Math.min(0,e[1]),Math.max(e[1]-1,-1));if(s){var n=this.getTileRangeForExtentAndZ(s,t);r.minX=Math.max(n.minX,r.minX),r.maxX=Math.min(n.maxX,r.maxX),r.minY=Math.max(n.minY,r.minY),r.maxY=Math.min(n.maxY,r.maxY)}return r}),this):s&&this.calculateTileRanges_(s)}return e.prototype.forEachTileCoord=function(e,t,r){for(var n=this.getTileRangeForExtentAndZ(e,t),i=n.minX,o=n.maxX;i<=o;++i)for(var a=n.minY,s=n.maxY;a<=s;++a)r([t,i,a])},e.prototype.forEachTileCoordParentTileRange=function(e,t,r,n){var i,o,a=null,s=e[0]-1;for(2===this.zoomFactor_?(i=e[1],o=e[2]):a=this.getTileCoordExtent(e,n);s>=this.minZoom;){if(t(s,2===this.zoomFactor_?dS(i=Math.floor(i/2),i,o=Math.floor(o/2),o,r):this.getTileRangeForExtentAndZ(a,s,r)))return!0;--s}return!1},e.prototype.getExtent=function(){return this.extent_},e.prototype.getMaxZoom=function(){return this.maxZoom},e.prototype.getMinZoom=function(){return this.minZoom},e.prototype.getOrigin=function(e){return this.origin_?this.origin_:this.origins_[e]},e.prototype.getResolution=function(e){return this.resolutions_[e]},e.prototype.getResolutions=function(){return this.resolutions_},e.prototype.getTileCoordChildTileRange=function(e,t,r){if(e[0]<this.maxZoom){if(2===this.zoomFactor_){var n=2*e[1],i=2*e[2];return dS(n,n+1,i,i+1,t)}var o=this.getTileCoordExtent(e,r||this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,e[0]+1,t)}return null},e.prototype.getTileRangeForTileCoordAndZ=function(e,t,r){if(t>this.maxZoom||t<this.minZoom)return null;var n=e[0],i=e[1],o=e[2];if(t===n)return dS(i,o,i,o,r);if(this.zoomFactor_){var a=Math.pow(this.zoomFactor_,t-n),s=Math.floor(i*a),l=Math.floor(o*a);return t<n?dS(s,s,l,l,r):dS(s,Math.floor(a*(i+1))-1,l,Math.floor(a*(o+1))-1,r)}var c=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(c,t,r)},e.prototype.getTileRangeExtent=function(e,t,r){var n=this.getOrigin(e),i=this.getResolution(e),o=ko(this.getTileSize(e),this.tmpSize_),a=n[0]+t.minX*o[0]*i,s=n[0]+(t.maxX+1)*o[0]*i;return ie(a,n[1]+t.minY*o[1]*i,s,n[1]+(t.maxY+1)*o[1]*i,r)},e.prototype.getTileRangeForExtentAndZ=function(e,t,r){var n=wE;this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,n);var i=n[1],o=n[2];return this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,n),dS(i,n[1],o,n[2],r)},e.prototype.getTileCoordCenter=function(e){var t=this.getOrigin(e[0]),r=this.getResolution(e[0]),n=ko(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*n[0]*r,t[1]-(e[2]+.5)*n[1]*r]},e.prototype.getTileCoordExtent=function(e,t){var r=this.getOrigin(e[0]),n=this.getResolution(e[0]),i=ko(this.getTileSize(e[0]),this.tmpSize_),o=r[0]+e[1]*i[0]*n,a=r[1]-(e[2]+1)*i[1]*n;return ie(o,a,o+i[0]*n,a+i[1]*n,t)},e.prototype.getTileCoordForCoordAndResolution=function(e,t,r){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,r)},e.prototype.getTileCoordForXYAndResolution_=function(e,t,r,n,i){var o=this.getZForResolution(r),a=r/this.getResolution(o),s=this.getOrigin(o),l=ko(this.getTileSize(o),this.tmpSize_),c=a*(e-s[0])/r/l[0],u=a*(s[1]-t)/r/l[1];return n?(c=je(c,5)-1,u=je(u,5)-1):(c=Ge(c,5),u=Ge(u,5)),mE(o,c,u,i)},e.prototype.getTileCoordForXYAndZ_=function(e,t,r,n,i){var o=this.getOrigin(r),a=this.getResolution(r),s=ko(this.getTileSize(r),this.tmpSize_),l=(e-o[0])/a/s[0],c=(o[1]-t)/a/s[1];return n?(l=je(l,5)-1,c=je(c,5)-1):(l=Ge(l,5),c=Ge(c,5)),mE(r,l,c,i)},e.prototype.getTileCoordForCoordAndZ=function(e,t,r){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,r)},e.prototype.getTileCoordResolution=function(e){return this.resolutions_[e[0]]},e.prototype.getTileSize=function(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]},e.prototype.getFullTileRange=function(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null},e.prototype.getZForResolution=function(e,t){return Ie(u(this.resolutions_,e,t||0),this.minZoom,this.maxZoom)},e.prototype.tileCoordIntersectsViewport=function(e,t){return vo(t,0,t.length,2,this.getTileCoordExtent(e))},e.prototype.calculateTileRanges_=function(e){for(var t=this.resolutions_.length,r=new Array(t),n=this.minZoom;n<t;++n)r[n]=this.getTileRangeForExtentAndZ(e,n);this.fullTileRanges_=r},e}();const EE=SE;var bE=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),CE=function(e){function t(t){var r=e.call(this,{attributions:t.attributions,wrapX:t.wrapX})||this;return r.resolution=void 0,r.distance=void 0!==t.distance?t.distance:20,r.minDistance=t.minDistance||0,r.interpolationRatio=0,r.features=[],r.geometryFunction=t.geometryFunction||function(e){var t=e.getGeometry();return I("Point"==t.getType(),10),t},r.createCustomCluster_=t.createCluster,r.source=null,r.boundRefresh_=r.refresh.bind(r),r.updateDistance(r.distance,r.minDistance),r.setSource(t.source||null),r}return bE(t,e),t.prototype.clear=function(t){this.features.length=0,e.prototype.clear.call(this,t)},t.prototype.getDistance=function(){return this.distance},t.prototype.getSource=function(){return this.source},t.prototype.loadFeatures=function(e,t,r){this.source.loadFeatures(e,t,r),t!==this.resolution&&(this.resolution=t,this.refresh())},t.prototype.setDistance=function(e){this.updateDistance(e,this.minDistance)},t.prototype.setMinDistance=function(e){this.updateDistance(this.distance,e)},t.prototype.getMinDistance=function(){return this.minDistance},t.prototype.setSource=function(e){this.source&&this.source.removeEventListener(ct.CHANGE,this.boundRefresh_),this.source=e,e&&e.addEventListener(ct.CHANGE,this.boundRefresh_),this.refresh()},t.prototype.refresh=function(){this.clear(),this.cluster(),this.addFeatures(this.features)},t.prototype.updateDistance=function(e,t){var r=0===e?0:Math.min(t,e)/e,n=e!==this.distance||this.interpolationRatio!==r;this.distance=e,this.minDistance=t,this.interpolationRatio=r,n&&this.refresh()},t.prototype.cluster=function(){if(void 0!==this.resolution&&this.source)for(var e=[1/0,1/0,-1/0,-1/0],t=this.distance*this.resolution,r=this.source.getFeatures(),n={},i=0,a=r.length;i<a;i++){var s=r[i];if(!(o(s)in n)){var l=this.geometryFunction(s);if(l){ae(l.getCoordinates(),e),X(e,t,e);var c=this.source.getFeaturesInExtent(e).filter((function(e){var t=o(e);return!(t in n)&&(n[t]=!0,!0)}));this.features.push(this.createCluster(c,e))}}}},t.prototype.createCluster=function(e,t){for(var r=[0,0],n=e.length-1;n>=0;--n){var i=this.geometryFunction(e[n]);i?Zt(r,i.getCoordinates()):e.splice(n,1)}Gt(r,1/e.length);var o=me(t),a=this.interpolationRatio,s=new uo([r[0]*(1-a)+o[0]*a,r[1]*(1-a)+o[1]*a]);return this.createCustomCluster_?this.createCustomCluster_(s,e):new js({geometry:s,features:e})},t}(V_);const LE=CE;var TE=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const AE=function(e){function t(t,r,n,i,o,a,s){var l=this,c=t.getExtent(),u=r.getExtent(),p=u?Ee(n,u):n,h=sS(t,r,me(p),i),d=new eS(t,r,p,c,.5*h,i),f=a(d.calculateSourceExtent(),h,o),g=f?Td:Od,y=f?f.getPixelRatio():1;return(l=e.call(this,n,i,y,g)||this).targetProj_=r,l.maxSourceExtent_=c,l.triangulation_=d,l.targetResolution_=i,l.targetExtent_=n,l.sourceImage_=f,l.sourcePixelRatio_=y,l.interpolate_=s,l.canvas_=null,l.sourceListenerKey_=null,l}return TE(t,e),t.prototype.disposeInternal=function(){this.state==Ad&&this.unlistenSource_(),e.prototype.disposeInternal.call(this)},t.prototype.getImage=function(){return this.canvas_},t.prototype.getProjection=function(){return this.targetProj_},t.prototype.reproject_=function(){var e=this.sourceImage_.getState();if(e==xd){var t=Le(this.targetExtent_)/this.targetResolution_,r=Se(this.targetExtent_)/this.targetResolution_;this.canvas_=lS(t,r,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_)}this.state=e,this.changed()},t.prototype.load=function(){if(this.state==Td){this.state=Ad,this.changed();var e=this.sourceImage_.getState();e==xd||e==Pd?this.reproject_():(this.sourceListenerKey_=ut(this.sourceImage_,ct.CHANGE,(function(e){var t=this.sourceImage_.getState();t!=xd&&t!=Pd||(this.unlistenSource_(),this.reproject_())}),this),this.sourceImage_.load())}},t.prototype.unlistenSource_=function(){ht(this.sourceListenerKey_),this.sourceListenerKey_=null},t}(Dd);var xE=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),PE="imageloadstart",OE="imageloadend",IE="imageloaderror",RE=function(e){function t(t,r){var n=e.call(this,t)||this;return n.image=r,n}return xE(t,e),t}(tt);function ME(e,t){e.getImage().src=t}const DE=function(e){function t(t){var r=this,n=void 0===t.imageSmoothing||t.imageSmoothing;return void 0!==t.interpolate&&(n=t.interpolate),(r=e.call(this,{attributions:t.attributions,projection:t.projection,state:t.state,interpolate:n})||this).on,r.once,r.un,r.resolutions_=void 0!==t.resolutions?t.resolutions:null,r.reprojectedImage_=null,r.reprojectedRevision_=0,r}return xE(t,e),t.prototype.getResolutions=function(){return this.resolutions_},t.prototype.findNearestResolution=function(e){if(this.resolutions_){var t=u(this.resolutions_,e,0);e=this.resolutions_[t]}return e},t.prototype.getImage=function(e,t,r,n){var i=this.getProjection();if(i&&n&&!ri(i,n)){if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&ri(this.reprojectedImage_.getProjection(),n)&&this.reprojectedImage_.getResolution()==t&&le(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new AE(i,n,e,t,r,function(e,t,r){return this.getImageInternal(e,t,r,i)}.bind(this),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}return i&&(n=i),this.getImageInternal(e,t,r,n)},t.prototype.getImageInternal=function(e,t,r,i){return n()},t.prototype.handleImageChange=function(e){var t,r=e.target;switch(r.getState()){case Ad:this.loading=!0,t=PE;break;case xd:this.loading=!1,t=OE;break;case Pd:this.loading=!1,t=IE;break;default:return}this.hasListener(t)&&this.dispatchEvent(new RE(t,r))},t}(B_);var NE="1.3.0";function ZE(e,t){var r=[];Object.keys(t).forEach((function(e){null!==t[e]&&void 0!==t[e]&&r.push(e+"="+encodeURIComponent(t[e]))}));var n=r.join("&");return(e=-1===(e=e.replace(/[?&]$/,"")).indexOf("?")?e+"?":e+"&")+n}var kE=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),FE=[101,101],UE=function(e){function t(t){var r=this,n=t||{},i=void 0===n.imageSmoothing||n.imageSmoothing;return void 0!==n.interpolate&&(i=n.interpolate),(r=e.call(this,{attributions:n.attributions,interpolate:i,projection:n.projection,resolutions:n.resolutions})||this).crossOrigin_=void 0!==n.crossOrigin?n.crossOrigin:null,r.url_=n.url,r.imageLoadFunction_=void 0!==n.imageLoadFunction?n.imageLoadFunction:ME,r.params_=n.params||{},r.v13_=!0,r.updateV13_(),r.serverType_=n.serverType,r.hidpi_=void 0===n.hidpi||n.hidpi,r.image_=null,r.imageSize_=[0,0],r.renderedRevision_=0,r.ratio_=void 0!==n.ratio?n.ratio:1.5,r}return kE(t,e),t.prototype.getFeatureInfoUrl=function(e,t,r,n){if(void 0!==this.url_){var i=$n(r),o=this.getProjection();o&&o!==i&&(t=sS(o,i,e,t),e=oi(e,i,o));var a=_e(e,t,0,FE),s={SERVICE:"WMS",VERSION:NE,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};nt(s,this.params_,n);var l=Ge((e[0]-a[0])/t,4),c=Ge((a[3]-e[1])/t,4);return s[this.v13_?"I":"X"]=l,s[this.v13_?"J":"Y"]=c,this.getRequestUrl_(a,FE,1,o||i,s)}},t.prototype.getLegendUrl=function(e,t){if(void 0!==this.url_){var r={SERVICE:"WMS",VERSION:NE,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===t||void 0===t.LAYER){var n=this.params_.LAYERS;if(!(!Array.isArray(n)||1===n.length))return;r.LAYER=n}if(void 0!==e){var i=this.getProjection()?this.getProjection().getMetersPerUnit():1;r.SCALE=e*i/28e-5}return nt(r,t),ZE(this.url_,r)}},t.prototype.getParams=function(){return this.params_},t.prototype.getImageInternal=function(e,t,r,n){if(void 0===this.url_)return null;t=this.findNearestResolution(t),1==r||this.hidpi_&&void 0!==this.serverType_||(r=1);var i=t/r,o=me(e),a=_e(o,i,0,[je(Le(e)/i,4),je(Se(e)/i,4)]),s=_e(o,i,0,[je(this.ratio_*Le(e)/i,4),je(this.ratio_*Se(e)/i,4)]),l=this.image_;if(l&&this.renderedRevision_==this.getRevision()&&l.getResolution()==t&&l.getPixelRatio()==r&&ee(l.getExtent(),a))return l;var c={SERVICE:"WMS",VERSION:NE,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};nt(c,this.params_),this.imageSize_[0]=Be(Le(s)/i,4),this.imageSize_[1]=Be(Se(s)/i,4);var u=this.getRequestUrl_(s,this.imageSize_,r,n,c);return this.image_=new kd(s,t,r,u,this.crossOrigin_,this.imageLoadFunction_),this.renderedRevision_=this.getRevision(),this.image_.addEventListener(ct.CHANGE,this.handleImageChange.bind(this)),this.image_},t.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_},t.prototype.getRequestUrl_=function(e,t,r,n,i){if(I(void 0!==this.url_,9),i[this.v13_?"CRS":"SRS"]=n.getCode(),"STYLES"in this.params_||(i.STYLES=""),1!=r)switch(this.serverType_){case"geoserver":var o=90*r+.5|0;"FORMAT_OPTIONS"in i?i.FORMAT_OPTIONS+=";dpi:"+o:i.FORMAT_OPTIONS="dpi:"+o;break;case"mapserver":i.MAP_RESOLUTION=90*r;break;case"carmentaserver":case"qgis":i.DPI=90*r;break;default:I(!1,8)}i.WIDTH=t[0],i.HEIGHT=t[1];var a,s=n.getAxisOrientation();return a=this.v13_&&"ne"==s.substr(0,2)?[e[1],e[0],e[3],e[2]]:e,i.BBOX=a.join(","),ZE(this.url_,i)},t.prototype.getUrl=function(){return this.url_},t.prototype.setImageLoadFunction=function(e){this.image_=null,this.imageLoadFunction_=e,this.changed()},t.prototype.setUrl=function(e){e!=this.url_&&(this.url_=e,this.image_=null,this.changed())},t.prototype.updateParams=function(e){nt(this.params_,e),this.updateV13_(),this.image_=null,this.changed()},t.prototype.updateV13_=function(){var e=this.params_.VERSION||NE;this.v13_=function(e,t){for(var r=(""+e).split("."),n=(""+t).split("."),i=0;i<Math.max(r.length,n.length);i++){var o=parseInt(r[i]||"0",10),a=parseInt(n[i]||"0",10);if(o>a)return 1;if(a>o)return-1}return 0}(e,"1.3")>=0},t}(DE);const BE=UE;const GE=function(){function e(e){this.highWaterMark=void 0!==e?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}return e.prototype.canExpireCache=function(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark},e.prototype.expireCache=function(e){for(;this.canExpireCache();)this.pop()},e.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null},e.prototype.containsKey=function(e){return this.entries_.hasOwnProperty(e)},e.prototype.forEach=function(e){for(var t=this.oldest_;t;)e(t.value_,t.key_,this),t=t.newer},e.prototype.get=function(e,t){var r=this.entries_[e];return I(void 0!==r,15),r===this.newest_||(r===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(r.newer.older=r.older,r.older.newer=r.newer),r.newer=null,r.older=this.newest_,this.newest_.newer=r,this.newest_=r),r.value_},e.prototype.remove=function(e){var t=this.entries_[e];return I(void 0!==t,15),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_},e.prototype.getCount=function(){return this.count_},e.prototype.getKeys=function(){var e,t=new Array(this.count_),r=0;for(e=this.newest_;e;e=e.older)t[r++]=e.key_;return t},e.prototype.getValues=function(){var e,t=new Array(this.count_),r=0;for(e=this.newest_;e;e=e.older)t[r++]=e.value_;return t},e.prototype.peekLast=function(){return this.oldest_.value_},e.prototype.peekLastKey=function(){return this.oldest_.key_},e.prototype.peekFirstKey=function(){return this.newest_.key_},e.prototype.peek=function(e){if(this.containsKey(e))return this.entries_[e].value_},e.prototype.pop=function(){var e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_},e.prototype.replace=function(e,t){this.get(e),this.entries_[e].value_=t},e.prototype.set=function(e,t){I(!(e in this.entries_),16);var r={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=r:this.oldest_=r,this.newest_=r,this.entries_[e]=r,++this.count_},e.prototype.setSize=function(e){this.highWaterMark=e},e}();var jE=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),WE=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return jE(t,e),t.prototype.expireCache=function(e){for(;this.canExpireCache();){if(this.peekLast().getKey()in e)break;this.pop().release()}},t.prototype.pruneExceptNewestZ=function(){if(0!==this.getCount()){var e=function(e){return e.split("/").map(Number)}(this.peekFirstKey()),t=e[0];this.forEach(function(e){e.tileCoord[0]!==t&&(this.remove(_E(e.tileCoord)),e.release())}.bind(this))}},t}(GE);const HE=WE,qE={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};function VE(e){var t=e.getDefaultTileGrid();return t||(t=function(e,t,r,n){return function(e,t,r,n){var i=void 0!==n?n:"top-left",o=zE(e,t,r);return new EE({extent:e,origin:ve(e,i),resolutions:o,tileSize:r})}(YE(e),t,r,n)}(e),e.setDefaultTileGrid(t)),t}function zE(e,t,r,n){for(var i=void 0!==t?t:42,o=Se(e),a=Le(e),s=ko(void 0!==r?r:bn),l=n>0?n:Math.max(a/s[0],o/s[1]),c=i+1,u=new Array(c),p=0;p<c;++p)u[p]=l/Math.pow(2,p);return u}function YE(e){var t=(e=$n(e)).getExtent();if(!t){var r=180*vn[_n.DEGREES]/e.getMetersPerUnit();t=ie(-r,-r,r,r)}return t}var KE=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),XE=function(e){function t(t){var r=e.call(this,{attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate})||this;r.on,r.once,r.un,r.opaque_=void 0!==t.opaque&&t.opaque,r.tilePixelRatio_=void 0!==t.tilePixelRatio?t.tilePixelRatio:1,r.tileGrid=void 0!==t.tileGrid?t.tileGrid:null;return r.tileGrid&&ko(r.tileGrid.getTileSize(r.tileGrid.getMinZoom()),[256,256]),r.tileCache=new HE(t.cacheSize||0),r.tmpSize=[0,0],r.key_=t.key||"",r.tileOptions={transition:t.transition,interpolate:t.interpolate},r.zDirection=t.zDirection?t.zDirection:0,r}return KE(t,e),t.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},t.prototype.expireCache=function(e,t){var r=this.getTileCacheForProjection(e);r&&r.expireCache(t)},t.prototype.forEachLoadedTile=function(e,t,r,n){var i=this.getTileCacheForProjection(e);if(!i)return!1;for(var o,a,s,l=!0,c=r.minX;c<=r.maxX;++c)for(var u=r.minY;u<=r.maxY;++u)a=vE(t,c,u),s=!1,i.containsKey(a)&&(s=(o=i.get(a)).getState()===pn)&&(s=!1!==n(o)),s||(l=!1);return l},t.prototype.getGutterForProjection=function(e){return 0},t.prototype.getKey=function(){return this.key_},t.prototype.setKey=function(e){this.key_!==e&&(this.key_=e,this.changed())},t.prototype.getOpaque=function(e){return this.opaque_},t.prototype.getResolutions=function(){return this.tileGrid?this.tileGrid.getResolutions():null},t.prototype.getTile=function(e,t,r,i,o){return n()},t.prototype.getTileGrid=function(){return this.tileGrid},t.prototype.getTileGridForProjection=function(e){return this.tileGrid?this.tileGrid:VE(e)},t.prototype.getTileCacheForProjection=function(e){var t=this.getProjection();return I(null===t||ri(t,e),68),this.tileCache},t.prototype.getTilePixelRatio=function(e){return this.tilePixelRatio_},t.prototype.getTilePixelSize=function(e,t,r){var n,i,o,a=this.getTileGridForProjection(r),s=this.getTilePixelRatio(t),l=ko(a.getTileSize(e),this.tmpSize);return 1==s?l:(n=l,i=s,void 0===(o=this.tmpSize)&&(o=[0,0]),o[0]=n[0]*i+.5|0,o[1]=n[1]*i+.5|0,o)},t.prototype.getTileCoordForTileUrlFunction=function(e,t){var r=void 0!==t?t:this.getProjection(),n=this.getTileGridForProjection(r);return this.getWrapX()&&r.isGlobal()&&(e=function(e,t,r){var n=t[0],i=e.getTileCoordCenter(t),o=YE(r);if(Q(o,i))return t;var a=Le(o),s=Math.ceil((o[0]-i[0])/a);return i[0]+=a*s,e.getTileCoordForCoordAndZ(i,n)}(n,e,r)),function(e,t){var r=e[0],n=e[1],i=e[2];if(t.getMinZoom()>r||r>t.getMaxZoom())return!1;var o=t.getFullTileRange(r);return!o||o.containsXY(n,i)}(e,n)?e:null},t.prototype.clear=function(){this.tileCache.clear()},t.prototype.refresh=function(){this.clear(),e.prototype.refresh.call(this)},t.prototype.updateCacheSize=function(e,t){var r=this.getTileCacheForProjection(t);e>r.highWaterMark&&(r.highWaterMark=e)},t.prototype.useTile=function(e,t,r,n){},t}(B_),$E=function(e){function t(t,r){var n=e.call(this,t)||this;return n.tile=r,n}return KE(t,e),t}(tt);const JE=XE;function QE(e,t){var r=/\{z\}/g,n=/\{x\}/g,i=/\{y\}/g,o=/\{-y\}/g;return function(a,s,l){return a?e.replace(r,a[0].toString()).replace(n,a[1].toString()).replace(i,a[2].toString()).replace(o,(function(){var e=a[0],r=t.getFullTileRange(e);return I(r,55),(r.getHeight()-a[2]-1).toString()})):void 0}}function eb(e){return 1===e.length?e[0]:function(t,r,n){if(t){var i=function(e){return(e[1]<<e[0])+e[2]}(t),o=ke(i,e.length);return e[o](t,r,n)}}}function tb(e){var t=[],r=/\{([a-z])-([a-z])\}/.exec(e);if(r){var n=r[1].charCodeAt(0),i=r[2].charCodeAt(0),o=void 0;for(o=n;o<=i;++o)t.push(e.replace(r[0],String.fromCharCode(o)));return t}if(r=/\{(\d+)-(\d+)\}/.exec(e)){for(var a=parseInt(r[2],10),s=parseInt(r[1],10);s<=a;s++)t.push(e.replace(r[0],s.toString()));return t}return t.push(e),t}var rb=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),nb=function(e){function t(r){var n=e.call(this,{attributions:r.attributions,cacheSize:r.cacheSize,opaque:r.opaque,projection:r.projection,state:r.state,tileGrid:r.tileGrid,tilePixelRatio:r.tilePixelRatio,wrapX:r.wrapX,transition:r.transition,interpolate:r.interpolate,key:r.key,attributionsCollapsible:r.attributionsCollapsible,zDirection:r.zDirection})||this;return n.generateTileUrlFunction_=n.tileUrlFunction===t.prototype.tileUrlFunction,n.tileLoadFunction=r.tileLoadFunction,r.tileUrlFunction&&(n.tileUrlFunction=r.tileUrlFunction),n.urls=null,r.urls?n.setUrls(r.urls):r.url&&n.setUrl(r.url),n.tileLoadingKeys_={},n}return rb(t,e),t.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},t.prototype.getTileUrlFunction=function(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction},t.prototype.getUrls=function(){return this.urls},t.prototype.handleTileChange=function(e){var t,r=e.target,n=o(r),i=r.getState();i==un?(this.tileLoadingKeys_[n]=!0,t=qE.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],t=i==hn?qE.TILELOADERROR:i==pn?qE.TILELOADEND:void 0),null!=t&&this.dispatchEvent(new $E(t,r))},t.prototype.setTileLoadFunction=function(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()},t.prototype.setTileUrlFunction=function(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),void 0!==t?this.setKey(t):this.changed()},t.prototype.setUrl=function(e){var t=tb(e);this.urls=t,this.setUrls(t)},t.prototype.setUrls=function(e){this.urls=e;var t=e.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(function(e,t){for(var r=e.length,n=new Array(r),i=0;i<r;++i)n[i]=QE(e[i],t);return eb(n)}(e,this.tileGrid),t):this.setKey(t)},t.prototype.tileUrlFunction=function(e,t,r){},t.prototype.useTile=function(e,t,r){var n=vE(e,t,r);this.tileCache.containsKey(n)&&this.tileCache.get(n)},t}(JE);const ib=nb;var ob=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ab=function(e){function t(t){var r=this,n=void 0===t.imageSmoothing||t.imageSmoothing;return void 0!==t.interpolate&&(n=t.interpolate),(r=e.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:sb,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:n,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection})||this).crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:null,r.tileClass=void 0!==t.tileClass?t.tileClass:Qw,r.tileCacheForProjection={},r.tileGridForProjection={},r.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,r.renderReprojectionEdges_=!1,r}return ob(t,e),t.prototype.canExpireCache=function(){if(this.tileCache.canExpireCache())return!0;for(var e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1},t.prototype.expireCache=function(e,t){var r=this.getTileCacheForProjection(e);for(var n in this.tileCache.expireCache(this.tileCache==r?t:{}),this.tileCacheForProjection){var i=this.tileCacheForProjection[n];i.expireCache(i==r?t:{})}},t.prototype.getGutterForProjection=function(e){return this.getProjection()&&e&&!ri(this.getProjection(),e)?0:this.getGutter()},t.prototype.getGutter=function(){return 0},t.prototype.getKey=function(){var t=e.prototype.getKey.call(this);return this.getInterpolate()||(t+=":disable-interpolation"),t},t.prototype.getOpaque=function(t){return!(this.getProjection()&&t&&!ri(this.getProjection(),t))&&e.prototype.getOpaque.call(this,t)},t.prototype.getTileGridForProjection=function(e){var t=this.getProjection();if(!this.tileGrid||t&&!ri(t,e)){var r=o(e);return r in this.tileGridForProjection||(this.tileGridForProjection[r]=VE(e)),this.tileGridForProjection[r]}return this.tileGrid},t.prototype.getTileCacheForProjection=function(e){var t=this.getProjection();if(!t||ri(t,e))return this.tileCache;var r=o(e);return r in this.tileCacheForProjection||(this.tileCacheForProjection[r]=new HE(this.tileCache.highWaterMark)),this.tileCacheForProjection[r]},t.prototype.createTile_=function(e,t,r,n,i,o){var a=[e,t,r],s=this.getTileCoordForTileUrlFunction(a,i),l=s?this.tileUrlFunction(s,n,i):void 0,c=new this.tileClass(a,void 0!==l?cn:dn,void 0!==l?l:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(ct.CHANGE,this.handleTileChange.bind(this)),c},t.prototype.getTile=function(e,t,r,n,i){var o=this.getProjection();if(o&&i&&!ri(o,i)){var a=this.getTileCacheForProjection(i),s=[e,t,r],l=void 0,c=_E(s);a.containsKey(c)&&(l=a.get(c));var u=this.getKey();if(l&&l.key==u)return l;var p=this.getTileGridForProjection(o),h=this.getTileGridForProjection(i),d=this.getTileCoordForTileUrlFunction(s,i),f=new pS(o,p,i,h,s,d,this.getTilePixelRatio(n),this.getGutter(),function(e,t,r,n){return this.getTileInternal(e,t,r,n,o)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return f.key=u,l?(f.interimTile=l,f.refreshInterimChain(),a.replace(c,f)):a.set(c,f),f}return this.getTileInternal(e,t,r,n,o||i)},t.prototype.getTileInternal=function(e,t,r,n,i){var o=null,a=vE(e,t,r),s=this.getKey();if(this.tileCache.containsKey(a)){if((o=this.tileCache.get(a)).key!=s){var l=o;o=this.createTile_(e,t,r,n,i,s),l.getState()==cn?o.interimTile=l.interimTile:o.interimTile=l,o.refreshInterimChain(),this.tileCache.replace(a,o)}}else o=this.createTile_(e,t,r,n,i,s),this.tileCache.set(a,o);return o},t.prototype.setRenderReprojectionEdges=function(e){if(this.renderReprojectionEdges_!=e){for(var t in this.renderReprojectionEdges_=e,this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}},t.prototype.setTileGridForProjection=function(e,t){var r=$n(e);if(r){var n=o(r);n in this.tileGridForProjection||(this.tileGridForProjection[n]=t)}},t}(ib);function sb(e,t){e.getImage().src=t}const lb=ab;var cb=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ub=function(e){function t(t){var r=e.call(this,{extent:t.extent,origin:t.origin,origins:t.origins,resolutions:t.resolutions,tileSize:t.tileSize,tileSizes:t.tileSizes,sizes:t.sizes})||this;return r.matrixIds_=t.matrixIds,r}return cb(t,e),t.prototype.getMatrixId=function(e){return this.matrixIds_[e]},t.prototype.getMatrixIds=function(){return this.matrixIds_},t}(EE);var pb=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),hb=function(e){function t(t){var r=this,n=void 0===t.imageSmoothing||t.imageSmoothing;void 0!==t.interpolate&&(n=t.interpolate);var i=void 0!==t.requestEncoding?t.requestEncoding:"KVP",o=t.tileGrid,a=t.urls;return void 0===a&&void 0!==t.url&&(a=tb(t.url)),(r=e.call(this,{attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:n,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:o,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,urls:a,wrapX:void 0!==t.wrapX&&t.wrapX,transition:t.transition,zDirection:t.zDirection})||this).version_=void 0!==t.version?t.version:"1.0.0",r.format_=void 0!==t.format?t.format:"image/jpeg",r.dimensions_=void 0!==t.dimensions?t.dimensions:{},r.layer_=t.layer,r.matrixSet_=t.matrixSet,r.style_=t.style,r.requestEncoding_=i,r.setKey(r.getKeyForDimensions_()),a&&a.length>0&&(r.tileUrlFunction=eb(a.map(r.createFromWMTSTemplate.bind(r)))),r}return pb(t,e),t.prototype.setUrls=function(e){this.urls=e;var t=e.join("\n");this.setTileUrlFunction(eb(e.map(this.createFromWMTSTemplate.bind(this))),t)},t.prototype.getDimensions=function(){return this.dimensions_},t.prototype.getFormat=function(){return this.format_},t.prototype.getLayer=function(){return this.layer_},t.prototype.getMatrixSet=function(){return this.matrixSet_},t.prototype.getRequestEncoding=function(){return this.requestEncoding_},t.prototype.getStyle=function(){return this.style_},t.prototype.getVersion=function(){return this.version_},t.prototype.getKeyForDimensions_=function(){var e=0,t=[];for(var r in this.dimensions_)t[e++]=r+"-"+this.dimensions_[r];return t.join("/")},t.prototype.updateDimensions=function(e){nt(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())},t.prototype.createFromWMTSTemplate=function(e){var t=this.requestEncoding_,r={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};"KVP"==t&&nt(r,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e="KVP"==t?ZE(e,r):e.replace(/\{(\w+?)\}/g,(function(e,t){return t.toLowerCase()in r?r[t.toLowerCase()]:e}));var n=this.tileGrid,i=this.dimensions_;return function(r,o,a){if(r){var s={TileMatrix:n.getMatrixId(r[0]),TileCol:r[1],TileRow:r[2]};nt(s,i);var l=e;return l="KVP"==t?ZE(l,s):l.replace(/\{(\w+?)\}/g,(function(e,t){return s[t]}))}}},t}(lb);const db=hb;var fb=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const gb=function(e){function t(t,r,n,i,o){var a=this,s=void 0!==o?Td:xd;return(a=e.call(this,t,r,n,s)||this).loader_=void 0!==o?o:null,a.canvas_=i,a.error_=null,a}return fb(t,e),t.prototype.getError=function(){return this.error_},t.prototype.handleLoad_=function(e){e?(this.error_=e,this.state=Pd):this.state=xd,this.changed()},t.prototype.load=function(){this.state==Td&&(this.state=Ad,this.changed(),this.loader_(this.handleLoad_.bind(this)))},t.prototype.getImage=function(){return this.canvas_},t}(Dd);var yb=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();const mb=function(e){function t(t){var r=this,n=t||{},i=void 0===n.imageSmoothing||n.imageSmoothing;return void 0!==n.interpolate&&(i=n.interpolate),(r=e.call(this,{attributions:n.attributions,interpolate:i,projection:n.projection,resolutions:n.resolutions,state:n.state})||this).canvasFunction_=n.canvasFunction,r.canvas_=null,r.renderedRevision_=0,r.ratio_=void 0!==n.ratio?n.ratio:1.5,r}return yb(t,e),t.prototype.getImageInternal=function(e,t,r,n){t=this.findNearestResolution(t);var i=this.canvas_;if(i&&this.renderedRevision_==this.getRevision()&&i.getResolution()==t&&i.getPixelRatio()==r&&ee(i.getExtent(),e))return i;xe(e=e.slice(),this.ratio_);var o=[Le(e)/t*r,Se(e)/t*r],a=this.canvasFunction_.call(this,e,t,r,o,n);return a&&(i=new gb(e,t,r,a)),this.canvas_=i,this.renderedRevision_=this.getRevision(),i},t}(DE);var vb=r(9409),_b=r(688),wb=r(3418),Sb=r(268),Eb=r(330),bb=r(6204),Cb=r(3048),Lb=r(6382),Tb=r(8683),Ab=r(9529),xb=r(8033),Pb=r(1848),Ob=r(1872),Ib=r(5265),Rb=r(9180),Mb=r(52),Db=r(4115),Nb=r(1399);_b.Z.wrap=wb.Z,_b.Z.Util=Sb.Z;const Zb={};Zb.Point=Cb.Z,Zb.Marker=Lb.Z,Zb.Polyline=Tb.Z,Zb.Polygon=Ab.Z,Zb.MultiPoint=xb.Z,Zb.MultiMarker=Pb.Z,Zb.MultiPolyline=Ob.Z,Zb.MultiPolygon=Ib.Z,_b.Z.Geometry=Nb.Z,window.ol={},ol.VERSION=a,ol.Map=os,ol.View=No,ol.Overlay=ds,js.createStyleFunction=Gs,ol.Feature=js,ol.Collection=Br,ol.MapEventType=tn,ol.MapBrowserEventType=Kr,ol.Image=kd,ol.array={extend:h,includes:c},ol.asserts={assert:I},ol.color={asArray:Ye,asString:qe},ol.math={toRadians:Ze},ol.string={padNumber:fs},ol.control={OverviewMap:ws,ScaleLine:Is,Zoom:$o,ZoomSlider:Fs,ZoomToExtent:Ms},ol.events={EventType:ct,listen:ut,unlistenByKey:ht,condition:{shiftKeyOnly:ya}},ol.extent={getWidth:Le,getHeight:Se,containsCoordinate:Q,containsExtent:ee,buffer:X,boundingExtent:K},ol.geom={Point:uo,MultiPoint:qs,LineString:$s,MultiLineString:el,Polygon:Ao,MultiPolygon:nl,GeometryCollection:pl,Circle:sl,GeometryLayout:Pi,flat:{deflateCoordinates:zi,inflateCoordinates:eo,linearRingLength:function(e,t,r,n){var i=Ys(e,t,r,n),o=e[r-n]-e[t],a=e[r-n+1]-e[t+1];return i+=Math.sqrt(o*o+a*a)}}},ol.featureloader={xhr:dl},ol.format={Feature:js,GMLBase:$l,GML:wc,GML2:fc,GML3:vc,GML32:bc,GPX:Ed,KML:Ev,WFS:bu,WKT:Vu,WKB:lp,GeoJSON:Fh,WMSCapabilities:Zp,WMSGetFeatureInfo:Fp,WMTSCapabilities:wh,TopoJSON:Rh,xsd:{readDecimal:tc,readBoolean:Jl,readString:oc,readPositiveInteger:nc,readDateTime:ec,writeStringTextNode:uc,writeCDATASection:sc,writeDecimalTextNode:lc,writeBooleanTextNode:ac,writeNonNegativeIntegerTextNode:cc}},ol.format.Feature.transformGeometryWithOptions=gl,ol.interaction={defaults:ns,Draw:iw,Pointer:aa,Translate:pw,Snap:yw,Select:Ew,Modify:Mw,DragAndDrop:Hw,DoubleClickZoom:na},ol.layer={Layer:Nt,Tile:_S,Image:TS,Vector:N_,Heatmap:yE},ol.Observable={unByKey:gt},ol.Object=_t,ol.proj={METERS_PER_UNIT:vn,Projection:Cn,addEquivalentProjections:Qn,get:$n,transform:oi,transformExtent:ai,getTransform:ii,Units:_n,proj4:{register:function(e){var t,r,n,i,o,a,s,l,c=Object.keys(e.defs),u=c.length;for(t=0;t<u;++t){var p=c[t];if(!$n(p)){var h=e.defs(p),d=h.units;d||"longlat"!==h.projName||(d=_n.DEGREES),Xn(new Cn({code:p,axisOrientation:h.axis,metersPerUnit:h.to_meter,units:d}))}}for(t=0;t<u;++t){var f=c[t],g=$n(f);for(r=0;r<u;++r){var y=c[r],m=$n(y);if(!Wn(f,y))if(e.defs[f]===e.defs[y])Qn([g,m]);else{var v=e(f,y);n=g,i=m,o=mi(g,m,v.forward),a=mi(m,g,v.inverse),s=void 0,l=void 0,s=$n(n),l=$n(i),jn(s,l,ti(o)),jn(l,s,ti(a))}}}}},EPSG4326:{METERS_PER_UNIT:kn,PROJECTIONS:Un}},ol.render={getVectorContext:function(e){if(!(e.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");var t,r=e.inversePixelTransform[0],n=e.frameState,i=N(e.inversePixelTransform.slice(),n.coordinateToPixelTransform),o=A_(n.viewState.resolution,r),a=pi();return a&&(t=ni(a,n.viewState.projection)),new b_(e.context,r,n.extent,i,n.viewState.rotation,o,t)},toContext:function(e,t){var r=e.canvas,n=t||{},i=n.pixelRatio||L,o=n.size;o&&(r.width=o[0]*i,r.height=o[1]*i,r.style.width=o[0]+"px",r.style.height=o[1]+"px");var a=[0,0,r.width,r.height],s=F([1,0,0,1,0,0],i,i);return new b_(e,i,a,s,0)},EventType:Rt},ol.source={Vector:V_,Cluster:LE,ImageWMS:BE,WMTS:db,TileEventType:qE,VectorEventType:G_,ImageCanvas:mb,Image:{defaultImageLoadFunction:ME}},ol.source.WMTS.optionsFromCapabilities=function(e,t){var r=d(e.Contents.Layer,(function(e,r,n){return e.Identifier==t.layer}));if(null===r)return null;var n,i=e.Contents.TileMatrixSet;(n=r.TileMatrixSetLink.length>1?g(r.TileMatrixSetLink,"projection"in t?function(e,r,n){var o=d(i,(function(t){return t.Identifier==e.TileMatrixSet})).SupportedCRS,a=$n(o),s=$n(t.projection);return a&&s?ri(a,s):o==t.projection}:function(e,r,n){return e.TileMatrixSet==t.matrixSet}):0)<0&&(n=0);var o=r.TileMatrixSetLink[n].TileMatrixSet,a=r.TileMatrixSetLink[n].TileMatrixSetLimits,s=r.Format[0];"format"in t&&(s=t.format),(n=g(r.Style,(function(e,r,n){return"style"in t?e.Title==t.style:e.isDefault})))<0&&(n=0);var l=r.Style[n].Identifier,u={};"Dimension"in r&&r.Dimension.forEach((function(e,t,r){var n=e.Identifier,i=e.Default;void 0===i&&(i=e.Value[0]),u[n]=i}));var p,h=d(e.Contents.TileMatrixSet,(function(e,t,r){return e.Identifier==o})),f=h.SupportedCRS;if(f&&(p=$n(f)),"projection"in t){var y=$n(t.projection);y&&(p&&!ri(y,p)||(p=y))}var m=!1,v="ne"==p.getAxisOrientation().substr(0,2),_=h.TileMatrix[0],w={MinTileCol:0,MinTileRow:0,MaxTileCol:_.MatrixWidth-1,MaxTileRow:_.MatrixHeight-1};if(a){w=a[a.length-1];var S=d(h.TileMatrix,(function(e){return e.Identifier===w.TileMatrix||h.Identifier+":"+e.Identifier===w.TileMatrix}));S&&(_=S)}var E=28e-5*_.ScaleDenominator/p.getMetersPerUnit(),b=v?[_.TopLeftCorner[1],_.TopLeftCorner[0]]:_.TopLeftCorner,C=_.TileWidth*E,L=_.TileHeight*E,T=h.BoundingBox;T&&v&&(T=[T[1],T[0],T[3],T[2]]);var A=[b[0]+C*w.MinTileCol,b[1]-L*(1+w.MaxTileRow),b[0]+C*(1+w.MaxTileCol),b[1]-L*w.MinTileRow];if(void 0!==T&&!ee(T,A)){var x=r.WGS84BoundingBox,P=$n("EPSG:4326").getExtent();if(A=T,x)m=x[0]===P[0]&&x[2]===P[2];else{var O=ai(T,h.SupportedCRS,"EPSG:4326");m=O[0]-1e-10<=P[0]&&O[2]+1e-10>=P[2]}}var I=function(e,t,r){var n=[],i=[],o=[],a=[],s=[],l=void 0!==r?r:[],c=$n(e.SupportedCRS),u=c.getMetersPerUnit(),p="ne"==c.getAxisOrientation().substr(0,2);return e.TileMatrix.sort((function(e,t){return t.ScaleDenominator-e.ScaleDenominator})),e.TileMatrix.forEach((function(t){if(!(l.length>0)||d(l,(function(r){return t.Identifier==r.TileMatrix||-1===t.Identifier.indexOf(":")&&e.Identifier+":"+t.Identifier===r.TileMatrix}))){i.push(t.Identifier);var r=28e-5*t.ScaleDenominator/u,c=t.TileWidth,h=t.TileHeight;p?o.push([t.TopLeftCorner[1],t.TopLeftCorner[0]]):o.push(t.TopLeftCorner),n.push(r),a.push(c==h?c:[c,h]),s.push([t.MatrixWidth,t.MatrixHeight])}})),new ub({extent:t,origins:o,resolutions:n,matrixIds:i,tileSizes:a,sizes:s})}(h,A,a),R=[],M=t.requestEncoding;if(M=void 0!==M?M:"","OperationsMetadata"in e&&"GetTile"in e.OperationsMetadata)for(var D=e.OperationsMetadata.GetTile.DCP.HTTP.Get,N=0,Z=D.length;N<Z;++N)if(D[N].Constraint){var k=d(D[N].Constraint,(function(e){return"GetEncoding"==e.name})).AllowedValues.Value;if(""===M&&(M=k[0]),"KVP"!==M)break;c(k,"KVP")&&R.push(D[N].href)}else D[N].href&&(M="KVP",R.push(D[N].href));return 0===R.length&&(M="REST",r.ResourceURL.forEach((function(e){"tile"===e.resourceType&&(s=e.format,R.push(e.template))}))),{urls:R,layer:t.layer,matrixSet:o,format:s,projection:p,requestEncoding:M,tileGrid:I,style:l,dimensions:u,wrapX:m,crossOrigin:t.crossOrigin}},ol.tilegrid={TileGrid:EE},ol.style={Style:nf,RegularShape:Yd,Circle:$d,Fill:bd,Icon:Wd,Stroke:Hd,Text:lf,IconAnchorUnits:Cd,IconOrigin:Ld},ol.xml={parse:El,parseNode:Dl,createElementNS:vl,pushParseAndPop:Nl,pushSerializeAndPop:kl,makeStructureNS:Ml,getAllTextContent:_l,makeChildAppender:xl,makeReplacer:Ll,makeSequence:Rl,makeArrayPusher:Cl,makeArrayExtender:bl,makeArraySerializer:Pl,makeObjectPropertySetter:Al,makeSimpleNodeFactory:Ol,OBJECT_PROPERTY_NODE_FACTORY:Il,XML_SCHEMA_INSTANCE_URI:ml};for(var kb=0,Fb=["ms","moz","webkit","o"],Ub=0;Ub<Fb.length&&!window.requestAnimationFrame;++Ub)window.requestAnimationFrame=window[Fb[Ub]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[Fb[Ub]+"CancelAnimationFrame"]||window[Fb[Ub]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,t){var r=(new Date).getTime(),n=Math.max(0,16-(r-kb)),i=window.setTimeout((function(){e(r+n)}),n);return kb=r+n,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)});const Bb="mousemove",Gb="mouseover",jb=ol.events.EventType.DRAGENTER,Wb=ol.events.EventType.DRAGOVER,Hb=ol.events.EventType.DROP,qb=ol.events.EventType.CHANGE,Vb=ol.MapBrowserEventType.CLICK,zb=ol.MapBrowserEventType.SINGLECLICK,Yb=ol.MapBrowserEventType.POINTERMOVE,Kb=ol.MapEventType.MOVEEND,Xb=ol.render.EventType.POSTRENDER,$b=ol.source.VectorEventType.ADDFEATURE,Jb=ol.source.VectorEventType.REMOVEFEATURE,Qb=ol.source.VectorEventType.CLEAR,eC="bottom-left",tC="bottom-center",rC="bottom-right",nC="center-left",iC="center-center",oC="center-right",aC="top-center",sC="top-right",lC="Point",cC="MultiPoint",uC="LineString",pC="MultiLineString",hC="Polygon",dC="MultiPolygon",fC=_b.Z.Util.detectMouse()?3:10,gC="data:image/svg+xml;base64,";ol.View.prototype.getValueForResolutionFunction=function(e){const t=e||2,r=this.maxResolution_,n=this.minResolution_,i=Math.log(r/n)/Math.log(t);return function(e){var n=Math.log(r/e)/Math.log(t)/i;return n=Math.max(Math.min(1,n),0)}},ol.control.OverviewMap.prototype._validateExtent_=ol.control.OverviewMap.prototype.validateExtent_,ol.control.OverviewMap.prototype.validateExtent_=function(){var e=this;e._validateExtent_(),e._wrap&&e._wrap.parent.options.alwaysCentered&&e.recenter_()},ol.control.OverviewMap.prototype._bindView_=ol.control.OverviewMap.prototype.bindView_,ol.control.OverviewMap.prototype.bindView_=function(e){const t=this,r=t.getOverviewMap().getView(),n=ol.control.OverviewMap.prototype._bindView_.call(t,e),i=t.getOverviewMap().getView(),o=t._wrap.parent.map.wrap.map.getView();return i.getCenter()||i.setCenter(o.getCenter()),i.getResolution()||i.setResolution(r.getResolution()),n},ol.control.OverviewMap.prototype._resetExtent_=ol.control.OverviewMap.prototype.resetExtent_,ol.control.OverviewMap.prototype.resetExtent_=function(){var e=this;e._resetExtent_.call(e);var t=e._wrap;if(t.is3D){var r=e.getOverviewMap().getView(),n=r.calculateExtent(),i=t.get3DCameraLayer().getSource().getFeatures()[0];if(i){const e=i.getGeometry().getCoordinates();var o=e[0][0],a=e[0][1];if(!ol.extent.containsCoordinate(n,o)||!ol.extent.containsCoordinate(n,a)){var s=Math.max(n[0]-o[0],n[1]-o[1],o[0]-n[2],o[1]-n[3],n[0]-a[0],n[1]-a[1],a[0]-n[2],a[1]-n[3]);r.fit(ol.extent.buffer(n,s))}}}},ol.control.OverviewMap.prototype._updateBox_=ol.control.OverviewMap.prototype.updateBox_,ol.control.OverviewMap.prototype.updateBox_=function(){const e=this;e._updateBox_.call(e),e.boxOverlay_.handlePositionChanged()},ol.format.GML3CRS84=function(){ol.format.GML3.call(this,{srsName:"CRS:84"})},_b.Z.inherit(ol.format.GML3CRS84,ol.format.GML3),ol.format.GML2CRS84=function(){ol.format.GML2.call(this,{srsName:"CRS:84"})},_b.Z.inherit(ol.format.GML2CRS84,ol.format.GML2);const yC="http://www.opengis.net/gml",mC="http://www.opengis.net/gml/3.2";ol.format.GML3.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS[mC]=ol.format.GML3.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS[yC],ol.format.GML3.prototype.FLAT_LINEAR_RINGS_PARSERS[mC]=ol.format.GML3.prototype.FLAT_LINEAR_RINGS_PARSERS[yC],ol.format.GML3.prototype.GEOMETRY_PARSERS[mC]=ol.format.GML3.prototype.GEOMETRY_PARSERS[yC],ol.format.GML3.prototype.MULTICURVE_PARSERS[mC]=ol.format.GML3.prototype.MULTICURVE_PARSERS[yC],ol.format.GML3.prototype.MULTISURFACE_PARSERS[mC]=ol.format.GML3.prototype.MULTISURFACE_PARSERS[yC],ol.format.GML3.prototype.CURVEMEMBER_PARSERS[mC]=ol.format.GML3.prototype.CURVEMEMBER_PARSERS[yC],ol.format.GML3.prototype.SURFACEMEMBER_PARSERS[mC]=ol.format.GML3.prototype.SURFACEMEMBER_PARSERS[yC],ol.format.GML3.prototype.SURFACE_PARSERS[mC]=ol.format.GML3.prototype.SURFACE_PARSERS[yC],ol.format.GML3.prototype.CURVE_PARSERS[mC]=ol.format.GML3.prototype.CURVE_PARSERS[yC],ol.format.GML3.prototype.ENVELOPE_PARSERS[mC]=ol.format.GML3.prototype.ENVELOPE_PARSERS[yC],ol.format.GML3.prototype.PATCHES_PARSERS[mC]=ol.format.GML3.prototype.PATCHES_PARSERS[yC],ol.format.GML3.prototype.SEGMENTS_PARSERS[mC]=ol.format.GML3.prototype.SEGMENTS_PARSERS[yC],ol.proj.addEquivalentProjections(ol.proj.EPSG4326.PROJECTIONS),ol.proj.proj4.register(vb.Z);const vC=_b.Z.Util.detectMobile(),_C=ol.source.WMTS.prototype.getTilePixelRatio;ol.source.WMTS.prototype.getTilePixelRatio=function(e){return vC?_C.call(this,e):_C.call(this,e)*(e||1)};const wC=ol.tilegrid.TileGrid.prototype.getZForResolution;ol.tilegrid.TileGrid.prototype.getZForResolution=function(e,t){let r=e;return vC||(r/=window.devicePixelRatio),wC.call(this,r,t)},ol.Overlay.prototype.updateRenderedPosition=function(e,t){const r=this.element.style,n=this.getOffset(),i=this.getPositioning();this.setVisible(!0);let o=n[0],a=n[1];if(i==rC||i==oC||i==sC){""!==this.rendered.left_&&(this.rendered.left_=r.left="");const n=Math.round(t[0]-e[0]-o)+"px";this.rendered.right_!=n&&(this.rendered.right_=r.right=n)}else{""!==this.rendered.right_&&(this.rendered.right_=r.right=""),i!=tC&&i!=iC&&i!=aC||(o-=this.element.offsetWidth/2);const t=Math.round(e[0]+o)+"px";this.rendered.left_!=t&&(this.rendered.left_=r.left=t)}if(i==eC||i==tC||i==rC){""!==this.rendered.top_&&(this.rendered.top_=r.top="");const n=Math.round(t[1]-e[1]-a)+"px";this.rendered.bottom_!=n&&(this.rendered.bottom_=r.bottom=n)}else{""!==this.rendered.bottom_&&(this.rendered.bottom_=r.bottom=""),i!=nC&&i!=iC&&i!=oC||(a-=this.element.offsetHeight/2);const t=Math.round(e[1]+a)+"px";this.rendered.top_!=t&&(this.rendered.top_=r.top=t)}};const SC=ol.source.ImageWMS.prototype.getRequestUrl_;ol.source.ImageWMS.prototype.getRequestUrl_=function(e,t,r,n,i){if(1!==r){const e=90*r+.5|0;i.MAP_RESOLUTION=e,i.DPI=e}return SC.call(this,e,t,r,n,i)};const EC=ol.interaction.Snap.prototype.snapTo;ol.interaction.Snap.prototype.snapTo=function(e,t,r){const n=EC.call(this,e,t,r);return this._snapData=n,n};const bC=function(e,t){var r;return r=e?(r=ol.color.asArray(e)).slice():[0,0,0,1],void 0!==t&&(r[3]=t),r},CC=function(e,t,r){const n=e.map.getView(),i=n.getResolution(),o=_b.Z.Util.detectMobile()?1:e.map.pixelRatio_,a={projection:n.getProjection(),center:n.getCenter(),resolution:i,enableRotation:!1,constrainResolution:!0,showFullExtent:!0,smoothExtentConstraint:!0};e.parent.maxExtent&&(a.extent=e.parent.maxExtent);var s=t;t.type===Eb.Z.layerType.VECTOR&&e.parent.getBaseLayer()&&(s=e.parent.getBaseLayer());const l=s.getResolutions?s.getResolutions():[];var c,u;if(l&&l.length){c=s.maxResolution||(null==r?void 0:r.maxResolution)||l[0],u=s.minResolution||(null==r?void 0:r.minResolution)||l[l.length-1];let e=l.length-l.slice().reverse().findIndex((e=>e>=u))-1;e===l.length&&(e=-1);const t=l.findIndex((e=>e<=c));a.resolutions=l.slice(t,e+1),1!==o&&(a.resolutions=a.resolutions.map((e=>e*o)))}else c=s.maxResolution,u=s.minResolution;return u&&(u*=o,a.minResolution=u,i<u&&(a.resolution=u)),c&&(c*=o,a.maxResolution=c,i>c&&(a.resolution=c)),a};_b.Z.wrap.Map.prototype.setMap=function(){var e=this,t=[(e.parent.initialExtent[0]+e.parent.initialExtent[2])/2,(e.parent.initialExtent[1]+e.parent.initialExtent[3])/2],r=(0,vb.Z)(e.parent.crs);!function(){var t=e.parent.crs.substr(e.parent.crs.lastIndexOf(":")+1),n={units:r.oProj.units},i=[];"4326"!==t&&(n.code="EPSG:"+t,i.push(new ol.proj.Projection(n)),n.code="urn:ogc:def:crs:EPSG::"+t,i.push(new ol.proj.Projection(n)),ol.proj.addEquivalentProjections(i)),ol.proj.proj4.register(vb.Z)}();var n={code:e.parent.crs,units:r.oProj.units};"EPSG:4326"===e.parent.crs&&(n.axisOrientation="neu");var i=new ol.proj.Projection(n),o=ol.interaction.defaults(),a={projection:i,center:t,enableRotation:!1,constrainResolution:!0,showFullExtent:!0,smoothExtentConstraint:!0};const s=e.parent.maxExtent||e.parent.initialExtent;e.parent.maxExtent&&(a.extent=e.parent.maxExtent);var l=e.parent.div.getBoundingClientRect(),c=s[2]-s[0],u=s[3]-s[1];a.resolution=Math.max(c/l.width,u/l.height),e.map=new ol.Map({target:e.parent.div,view:new ol.View(a),controls:[],interactions:o}),e.map._wrap=e,e._promise=Promise.resolve(e.map),e.manageSize.call(e.map);let p;e.parent.one(Eb.Z.event.MAPLOAD,(function(){e.updateSize()})),e.map.on(zb,(function(t){if(e.parent.view!==Eb.Z.view.PRINTING){e.parent.workLayers.forEach((function(e){delete e._noFeatureClicked}));var r=e.parent.workLayers.map((function(){return!1}));e.map.forEachFeatureAtPixel(t.pixel,(function(t,n){if(t._wrap&&t._wrap.parent.showsPopup){for(var i=0;i<e.parent.workLayers.length;i++){if(e.parent.workLayers[i].wrap.layer===n){r[i]=!0;break}}return e.parent.trigger(Eb.Z.event.FEATURECLICK,{feature:t._wrap.parent}),t}}),{hitTolerance:fC});for(var n=0;n<r.length;n++)r[n]||e.parent.trigger(Eb.Z.event.NOFEATURECLICK,{layer:e.parent.workLayers[n]})}}));const h=function(t){const r=p.getResolution(),n=p.getProjection().getCode();e.parent.layers.filter((e=>e.type===Eb.Z.layerType.WMS)).forEach((e=>{const t=e.getExtent({crs:n});if(t){const n=FC(t,r,100);e.wrap.layer.setExtent(n)}}))},d=function(){p=e.map.getView(),p.on("change:resolution",h),h()};e.map.on(Kb,(function(){e.parent.trigger(Eb.Z.event.ZOOM)})),d(),p.on("change:resolution",(function(t){e.parent.trigger(Eb.Z.event.BEFOREZOOM)}),e.parent),e.map.on("change:view",d);const f=function(t,r){if(t){var n=CC(e,t,r),i=new ol.View(n);e.map.setView(i),e.map.render()}};e.parent.on(Eb.Z.event.BEFOREBASELAYERCHANGE,(function(t){if(e.parent.crs===e.parent.options.crs&&!e.parent.on3DView&&t.newLayer.type!==Eb.Z.layerType.VECTOR){const r=t.oldLayer.getResolutions();let n=t.newLayer;const i={};!t.newLayer.getResolutions()&&r&&(n=t.oldLayer,i.minResolution=t.newLayer.minResolution,i.maxResolution=t.newLayer.maxResolution),e.parent.one(Eb.Z.event.BASELAYERCHANGE,(function(e){f(n,i)}))}})),e.parent.on(Eb.Z.event.MAPLOAD,(function(t){f(e.parent.getBaseLayer())}));const g=e.map.getViewport();g.addEventListener(Eb.Z.event.MOUSEMOVE,(function(t){var r=!1;if(!e.parent.activeControl||!e.parent.activeControl.isExclusive()){if(e.parent.view===Eb.Z.view.PRINTING)return;var n=e.map.getEventPixel(t);r=e.map.forEachFeatureAtPixel(n,(function(t,r){var n=!0;return!t._wrap||t._wrap.parent.showsPopup||t._wrap.parent.options.selectable||(n=!1),n&&t._wrap&&e.parent.trigger(Eb.Z.event.FEATUREOVER,{feature:t._wrap.parent}),n}),{hitTolerance:fC})}g.style.cursor=r?"pointer":""})),function t(){matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`).addEventListener("change",t,{once:!0}),e.map.pixelRatio_=window.devicePixelRatio,f(e.parent.baseLayer),e.manageSize()}()},_b.Z.wrap.Map.prototype.updateSize=function(){this.map.updateSize()};var LC=function(e,t){var r=e.getUnits();return r&&r!==ol.proj.Units.DEGREES?ol.proj.METERS_PER_UNIT[r]:_b.Z.Util.getMetersPerDegree(t)};_b.Z.wrap.Map.prototype.getMetersPerUnit=function(){return LC(ol.proj.get(this.parent.crs),this.getExtent())};var AC=function(e){e=e||{};var t=this.parent.options.crs||_b.Z.Cfg.crs,r=ol.proj.get(t),n=ol.proj.get(e.crs);return LC(n,e.extentInDegrees)/LC(r,e.extentInDegrees)},xC=function(e){var t;return(t=e.axisOrientation?new ol.proj.Projection({code:e.crs,axisOrientation:e.axisOrientation}):ol.proj.get(e.crs)).getUnits()||(t.units_=ol.proj.Units.DEGREES),t};_b.Z.wrap.Map.prototype.setProjection=function(e){const t=this,r=(e=e||{}).baseLayer||t.parent.baseLayer;var n;n=e.extent?e.extent:ol.proj.transformExtent(t.getExtent(),t.parent.crs,e.crs);const i=ol.proj.transformExtent(n,e.crs,"EPSG:4326"),o=AC.call(t,{crs:e.crs,extentInDegrees:i}),a=xC(e),s=t.map.getView(),l={projection:a,enableRotation:!1,constrainResolution:!0,showFullExtent:!0,smoothExtentConstraint:!0},c=r.getResolutions();if(c&&c.length)l.resolutions=c;else{l.minZoom=s.getMinZoom(),l.maxZoom=s.getMaxZoom();const e=r.wrap.layer.getMinResolution(),n=r.wrap.layer.getMaxResolution();var u=1;if(0===e||n===Number.POSITIVE_INFINITY){u=AC.call(t,{crs:t.parent.crs,extentInDegrees:i})/o}l.minResolution=0===e?s.getMinResolution()*u:e,n===Number.POSITIVE_INFINITY?l.maxResolution=s.getMaxResolution()*u:l.maxResolution=n}t.parent.workLayers.forEach((t=>{if(t.type===Eb.Z.layerType.WMS){t.getExtent({crs:e.crs})&&t.wrap.layer.setExtent(t.getExtent())}})),l.center=ol.proj.transform(t.getCenter(),t.parent.crs,e.crs),t.parent.initialExtent=1!==o?ol.proj.transformExtent(t.parent.initialExtent,t.parent.crs,e.crs):t.parent.options.initialExtent,t.parent.options.maxExtent&&(t.parent.maxExtent=1!==o?ol.proj.transformExtent(t.parent.maxExtent,t.parent.crs,e.crs):t.parent.options.maxExtent,l.extent=t.parent.maxExtent);var p=new ol.View(l);t.map.setView(p),p.fit(n,{nearest:!0})},_b.Z.wrap.Map.prototype.insertLayer=function(e,t){for(var r=this,n=r.map.getLayers(),i=!1,o=0;o<n.getLength();o++)if(n.item(o)===e){i=!0;break}const a=e._wrap;if(!a.parent.isBase&&a.parent.type===Eb.Z.layerType.WMS){const t=a.parent.getExtent();t&&e.setExtent(FC(t,r.getResolution(),100))}if(i)n.remove(e),n.insertAt(t,e);else{t<0?n.push(e):n.insertAt(t,e);var s=r.map.getView();if(r.parent.crs===r.parent.options.crs){if(e instanceof ol.layer.Tile){var l=e.getSource().getResolutions();s.maxResolution_=l[0],s.minResolution_=l[l.length-1]}}else e instanceof ol.layer.Tile&&(e.setMaxResolution(s.getMaxResolution()),e.setMinResolution(s.getMinResolution()));var c=0,u=function(t){a.parent.state=Mb.Z.state.LOADING,c<=0&&(c=0,r.parent.trigger(Eb.Z.event.BEFORELAYERUPDATE,{layer:a.parent})),e._loadingTileCount=e._loadingTileCount+1};a.parent.state===Mb.Z.state.LOADING&&a.parent.isRaster()&&u(),a.$events.on(Eb.Z.event.BEFORETILELOAD,u),a.$events.on(Eb.Z.event.TILELOAD+" "+Eb.Z.event.TILELOADERROR,(function(e){(c-=1)<=0&&(c=0,a.parent.state=Mb.Z.state.IDLE,r.parent.trigger(Eb.Z.event.LAYERUPDATE,{layer:a.parent}))}))}},_b.Z.wrap.Map.prototype.removeLayer=function(e){this.map.removeLayer(e)},_b.Z.wrap.Map.prototype.getLayerCount=function(){return this.map.getLayerGroup().getLayers().getLength()},_b.Z.wrap.Map.prototype.indexOfFirstVector=function(){var e=-1;return this.map.getLayerGroup().getLayers().forEach((function(t,r){t instanceof ol.layer.Vector&&-1===e&&(e=r)})),e},_b.Z.wrap.Map.prototype.getLayerIndex=function(e){var t=-1;return this.map.getLayerGroup().getLayers().forEach((function(r,n){r===e&&(t=n)})),t},_b.Z.wrap.Map.prototype.setLayerIndex=function(e,t){var r=this.map.getLayers().getArray().indexOf(e);r>-1&&r!==t&&(this.map.removeLayer(e),this.insertLayer(e,t))},_b.Z.wrap.Map.prototype.setBaseLayer=function(e){var t=this;return new Promise((function(r,n){var i,o,a,s=function(n){if((n=n||t.parent.getBaseLayer())&&(t.map.removeLayer(n.wrap.layer),e instanceof ol.layer.Image&&e._wrap.setProjection({crs:t.parent.crs}),e._wrap.parent.type===Eb.Z.layerType.WMTS)){var i={crs:t.parent.crs,oldCrs:e.getSource().getProjection().getCode()};i.oldCrs!==i.crs&&e._wrap.parent.setProjection(i)}t.insertLayer(e,0),t.map.getControls().forEach((function(e){e instanceof ol.control.ZoomSlider&&e.initSlider_()})),r()},l=CC(t,e._wrap.parent),c=t.map.getView(),u=c.getResolution();if(!l.resolutions&&(l.minResolution||l.maxResolution)){const e=c.getResolutions();if(e){const t=e.filter((e=>!(l.minResolution&&e<l.minResolution)&&!(l.maxResolution&&e>l.maxResolution)));t.length<e.length&&(l.resolutions=t)}}if(l.resolutions){const e=new ol.View(l);var p=(i=u,o=l.resolutions,a=t.parent.options.maxResolutionError,o?o.slice().sort((function(e,t){return e-t})).reduce((function(e,t){return 0===e&&(t>i||Math.abs(1-i/t)<a)?t:e}),0):i);p!==u&&t.parent.isLoaded?c.animate({resolution:p,duration:Eb.Z.ZOOM_ANIMATION_DURATION},(function(){t.map.setView(e),s(t.parent.getBaseLayer())})):(t.map.setView(e),e.setResolution(p),s())}else s()}))},_b.Z.wrap.Map.prototype.setExtent=function(e,t,r){const n=this;_b.Z.Util.isFunction(t)?(r=t,t={}):t=t||{};return Promise.resolve(n._setExtentPromise).finally((function(){!function(e){n._setExtentPromise=new Promise((function(i,o){clearTimeout(n._timeout),n._timeout=setTimeout((function(){const o={callback:function(){const e=n.getExtent();_b.Z.Util.isFunction(r)&&r(e),i(e)},nearest:!t.contain};(void 0===t.animate||t.animate)&&(o.duration=Eb.Z.ZOOM_ANIMATION_DURATION),n.map.getView().fit(e,o)}),50)}))}(e)})),n._setExtentPromise},_b.Z.wrap.Map.prototype.getExtent=function(){return this.map.getView().calculateExtent(this.map.getSize())},_b.Z.wrap.Map.prototype.setCenter=function(e,t){const r=this;return new Promise((function(n,i){const o=function(){n()},a=t||{},s=r.map.getView();a.animate?s.animate({center:e,duration:Eb.Z.ZOOM_ANIMATION_DURATION},o):(s.setCenter(e),n())}))},_b.Z.wrap.Map.prototype.getCenter=function(){return this.map.getView().getCenter()},_b.Z.wrap.Map.prototype.getResolution=function(){return this.map.getView().getResolution()},_b.Z.wrap.Map.prototype.setResolution=async function(e){return(await this.getMap()).getView().setResolution(e),e},_b.Z.wrap.Map.prototype.setRotation=function(e){this.getMap().then((function(t){t.getView().setRotation(e)}))},_b.Z.wrap.Map.prototype.getRotation=function(){return this.map.getView().getRotation()},_b.Z.wrap.Map.prototype.getResolutions=function(){return this.map.getView().getResolutions()||[]},_b.Z.wrap.Map.prototype.getCoordinateFromPixel=function(e){return this.map.getCoordinateFromPixel(e)},_b.Z.wrap.Map.prototype.getPixelFromCoordinate=function(e){return this.map.getPixelFromCoordinate(e)},_b.Z.wrap.Map.prototype.getViewport=function(e){const t=this;return(e||{}).synchronous?t.map.getViewport():new Promise((function(e,r){t.getMap().then((function(t){e(t.getViewport())}))}))},_b.Z.wrap.Map.prototype.getCanvas=function(){const e=this;if(e.parent.on3DView){const t=e.parent.view3D.getScene(),r=document.createElement("canvas");r.width=t.canvas.width,r.height=t.canvas.height;const n=r.getContext("2d");return t.canvas.getContext("webgl",{preserveDrawingBuffer:!0}),t.requestRenderMode=!1,t.render(),n.drawImage(t.canvas,0,0,t.canvas.width,t.canvas.height),t.requestRenderMode=!0,t.canvas.getContext("webgl",{preserveDrawingBuffer:!1}),[r]}return Array.from(e.parent.div.querySelectorAll(".ol-viewport canvas:not(.tc-ctl-ovmap canvas)"))},_b.Z.wrap.Map.prototype.isNative=function(e){return e instanceof ol.Map},_b.Z.wrap.Map.prototype.isGeo=function(){var e=this.map.getView().getProjection().getUnits();return!e||e===ol.proj.Units.DEGREES},_b.Z.wrap.Map.prototype.addPopup=function(e){const t=this;return new Promise((function(n,i){var o=void 0===e.options.draggable||e.options.draggable;t.getMap().then((function(n){if(!e.wrap.popup){var i=new ol.Overlay({element:e.popupDiv,positioning:eC});n.addOverlay(i),e.wrap.popup=i;const a=n.getViewport();o&&r.e(4982).then(r.t.bind(r,4982,23)).then((function(t){const r=e.popupDiv.parentElement;e.popupDiv.classList.add(Eb.Z.classes.DRAGGABLE),r.addEventListener("touchmove",(function(e){var t=e.target;do{if(t.matches&&t.matches(".tc-ctl-finfo-layer-content")){e.stopPropagation();break}t=t.parentElement}while(t)}),{passive:!0});const o=t.default,a=new o(r,{not:"th,td, td *,input,select,.tc-ctl-finfo-coords"});a.handleEvent=function(e){const t=this.options.not;if(t){let r=e.target,n=!1;for(;r&&!n;)n=r.matches&&r.matches(t),r=r.parentElement;if(n)return}o.prototype.handleEvent.call(this,e)},a.on("pointerDown",(function(e,t){var r=e.target.getBoundingClientRect();if(r.left+e.target.clientWidth<t.pageX||r.top+e.target.clientHeight<t.pageY)return a._pointerCancel(e,t),!1})),a.on("dragStart",(function(t,r){if(e.setDragging(!0),e._currentOffset=i.getOffset(),e._previousContainerPosition){var o=n.getSize();i.setPosition(n.getCoordinateFromPixel([e._previousContainerPosition[0],o[1]-e._previousContainerPosition[1]])),e._currentOffset=[0,0],i.setOffset(e._currentOffset),delete e._previousContainerPosition}else e._currentOffset=i.getOffset()})),a.on("dragEnd",(function(t){e.setDragging(!1);var o=n.getCoordinateFromPixel([0,0]),a=n.getCoordinateFromPixel(i.getOffset()),s=[a[0]-o[0],a[1]-o[1]],l=i.getPosition();i.setPosition([l[0]+s[0],l[1]+s[1]]),i.setOffset([0,0]),e._currentOffset=[0,0];const c=r.getBoundingClientRect();e._previousContainerPosition=[c.left,c.bottom]}))}));const s=function(e){const r=n.getViewport();var i=!1;if(!t.parent.activeControl||!t.parent.activeControl.isExclusive()){var o=n.getEventPixel(e);i=n.forEachFeatureAtPixel(o,(function(e,t){var r=!0;return e._wrap&&!e._wrap.parent.showsPopup&&(r=!1),r}),{hitTolerance:fC})}r.style.cursor=i?"pointer":""};a.removeEventListener(Bb,s),a.addEventListener(Bb,s)}})),n()}))},_b.Z.wrap.Map.prototype.hidePopup=function(e){this.parent.currentFeature=null,e.popupDiv&&e.popupDiv.classList.remove(Eb.Z.classes.VISIBLE)},_b.Z.wrap.Map.prototype.manageSize=function(){const e=this;e.pixelRatio_=window.devicePixelRatio;const t=function(){e.updateSize()};_b.Z.Util.detectMobile()||(t(),window.addEventListener("resize",t))};var PC=function(e,t){switch(e){case Eb.Z.layerType.KML:case Eb.Z.mimeType.KML:case Eb.Z.format.KMZ:return new ol.format.KML({showPointNames:!1,extractStyles:void 0===t||t});case Eb.Z.layerType.GPX:case Eb.Z.mimeType.GPX:return new ol.format.GPX;case Eb.Z.layerType.GEOJSON:case Eb.Z.mimeType.GEOJSON:case Eb.Z.mimeType.JSON:case Eb.Z.format.JSON:return new ol.format.GeoJSON;case Eb.Z.format.GML2:return new ol.format.GML2;case Eb.Z.format.GML3:return new ol.format.GML3;case Eb.Z.format.GML32:return new ol.format.GML32;case Eb.Z.mimeType.GML:case Eb.Z.format.GML:return new ol.format.GML;case Eb.Z.format.TOPOJSON:return new ol.format.TopoJSON;case Eb.Z.format.WKT:return new ol.format.WKT;case Eb.Z.format.WKB:return new ol.format.WKB;default:return null}};_b.Z.wrap.Map.prototype.exportFeatures=function(e,t){var r=this;t=t||{};var n=WC({styles:r.parent.options.styles}),i=e.map((function(e){var t=e.wrap.feature.clone();t._wrap=e.wrap;const r=e.getPath();r&&(t._folders=r),t.id_=e.id,t.getStyle()||t.setStyle(n);const i=aL(t).getText();if(i){i.getText()&&t.setProperties({name:i.getText()})}return t})),o=PC(t.format);if(o instanceof ol.format.KML){i=i.map((function(e){const t=e.getGeometry();if(t instanceof ol.geom.Point){var r=aL(e);const n=r.getImage();if(n instanceof ol.style.RegularShape){const i=n.getRadius(),o=n.getStroke(),a=o.getWidth(),s=n.getFill(),l=2*i+a,c=document.createElement("canvas");c.width=l,c.height=l;const u=r.getText();(r=r.clone()).setText();const p=new ol.Feature(t);return p.setId(e.getId()),p.setProperties(e.getProperties()),p.setStyle(new ol.style.Style({image:new ol.style.Icon({src:gC+window.btoa('<svg xmlns="http://www.w3.org/2000/svg" width="'+l+'" height="'+l+'"><circle cx="'+l/2+'" cy="'+l/2+'" r="'+i+'" stroke="'+o.getColor()+'" fill="rgba('+s.getColor()+')" stroke-width="'+a+'" /></svg>'),size:[l,l],imgSize:[l,l],scale:n.getScale()}),text:u})),p}}return e}));const e=[];i.forEach((function(t){var r=aL(t);const n=t.getGeometry(),i=r.getText();var o;if(i&&i.getText()){switch(!0){case n instanceof ol.geom.LineString:o=new ol.geom.Point(n.getCoordinateAt(.5));break;case n instanceof ol.geom.Polygon:o=n.getInteriorPoint();break;case n instanceof ol.geom.MultiLineString:{const e=n.getLineStrings();var a=-1;o=new ol.geom.Point(e[e.map((function(e){return e.getLength()})).reduce((function(e,t,r){return t>a?(a=t,r):e}),-1)].getCoordinateAt(.5));break}case n instanceof ol.geom.MultiPolygon:{const e=n.getPolygons();var s=-1;o=e[e.map((function(e){return e.getArea()})).reduce((function(e,t,r){return t>s?(s=t,r):e}),-1)].getInteriorPoint();break}}if(o){const t=new ol.Feature(o);t.setStyle(new ol.style.Style({text:i.clone(),image:new ol.style.Icon({crossOrigin:"anonymous",src:_b.Z.apiLocation+"css/img/transparent.gif"})})),e.push(t)}}})),e.length&&(i=i.concat(e))}if(o instanceof ol.format.GMLBase){o.hasZ=e[0].getGeometryStride()>=3,o.srsName=_b.Z.Util.toURNCRS(r.parent.crs),(i=i.map((function(e){var t=e.clone();return t.id_=e.id_,t}))).forEach((function(e){const t=e.values_,r=[];for(var n in t)n.indexOf(" ")>=0&&r.push(n);r.forEach((function(e){var r=e.replace(/ /g,"_");if(/^\d/.test(r)&&(r="_"+r),e!==r)for(;void 0!==t[r];)r+="_";t[r]=t[e],delete t[e]}))})),o.featureNS="http://www.opengis.net/gml",o.featureType="feature";var a=o.writeFeaturesNode(i,{featureProjection:r.parent.crs});a.querySelectorAll("feature geometry > * *[srsName]").forEach((e=>e.removeAttribute("srsName")));var s=ol.xml.createElementNS("http://www.opengis.net/wfs","FeatureCollection");return s.setAttributeNS("http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation",o.schemaLocation),a.removeAttribute("xmlns:xsi"),a.removeAttribute("xsi:schemaLocation"),s.appendChild(a),s.outerHTML}o instanceof ol.format.GPX&&(i=i.map((function(e){const t=e.getGeometry();return t instanceof ol.geom.LineString&&(e=e.clone()).setGeometry(new ol.geom.MultiLineString([t.getCoordinates()])),e})));var l=o.writeFeatures(i,{dataProjection:"EPSG:4326",featureProjection:r.parent.crs});return o instanceof ol.format.GPX&&(l=l.replace(/<ele>NaN<\/ele>/g,"")),l};var OC=function(e){for(var t=0,r=e.dataTransfer.types.length;t<r;t++)if("Files"===e.dataTransfer.types[t])return!0;return!1},IC=function(e){OC(e)&&(this.getMap()._wrap.parent.div.classList.add(Eb.Z.classes.DROP),e.preventDefault(),e.stopPropagation())},RC=function(e){if(OC(e)){var t=this.getMap()._wrap.parent;e.target===this.target&&t.div.classList.remove(Eb.Z.classes.DROP)}};_b.Z.wrap.Map.prototype.enableDragAndDrop=function(e){var t=this,n=e||{},i={formatConstructors:[ol.format.KML,ol.format.GPX,ol.format.GML32,ol.format.GML2,ol.format.GML3CRS84,ol.format.GML2CRS84,ol.format.GML3,ol.format.GeoJSON,function(){return new ol.format.WKT({splitCollection:!0})},function(){return new ol.format.WKB({splitCollection:!0})},ol.format.TopoJSON]};n.dropTarget?i.target=_b.Z.Util.getDiv(n.dropTarget):i.target=t.parent.div;var o=null,a=new ol.interaction.DragAndDrop(i);if(a.on("addfeatures",(function(e){var r;if(null!==(r=e.features)&&void 0!==r&&r.length){const t=/<circle cx="(?:\d+(?:\.\d+)?)" cy="(?:\d+(?:\.\d+)?)" r="(\d+(?:\.\d+)?)" stroke="([\w\d#(),]+)" fill="([\w\d#(),]+)" stroke-width="(\d+(?:\.\d+)?)" fill-opacity="(\d+(?:\.\d+)?)" \/>/;e.features.forEach((e=>{let r=e.getStyle();if(r){Sb.Z.isFunction(r)&&(r=r(e)),Array.isArray(r)&&(r=r[0]);const n=r.getImage();if(n){const i=n.getSrc();if(i.startsWith(gC)){const n=window.atob(i.substr(gC.length)).match(t);if(n){const t=new ol.style.Circle({radius:parseFloat(n[1]),stroke:new ol.style.Stroke({color:n[2],width:parseFloat(n[4])}),fill:new ol.style.Fill({color:n[3],opacity:parseFloat(n[5])})});r.setImage(t),e.setStyle(r)}}}}}))}const n=e.features?e.features.map((function(e){return e.getId()||e.setId(_b.Z.getUID()),_b.Z.wrap.Feature.createFeature(e)})):[];var i=t.parent.getLoadingIndicator();i&&i.removeWait(t.parent._featureImportWaitId);const s=n.filter((e=>e.geometry));if(s.length){const r={features:s,file:e.file,fileHandle:a.getFileHandle(e.file),fileName:e.file.name,dropTarget:e.target.target,timeStamp:e.file.lastModified,groupIndex:e._groupIndex,groupCount:e._groupCount};if("shp"===e.file.name.substring(e.file.name.lastIndexOf(".")+1).toLowerCase()){const t=e.file.name.substring(0,e.file.name.lastIndexOf("."));r.additionalFileHandles=[".dbf",".prj",".cst",".cpg"].map((e=>a.getFileHandleByName(t+e))).filter((e=>null!==e)).filter((e=>e!==r.fileHandle))}if(e.file._fileSystemFile&&(r.fileSystemFile=e.file._fileSystemFile,delete e.file._fileSystemFile),a._fileLayers){const t=a._fileLayers.filter((t=>t.options.file===e.file.name&&t.options.groupIndex===e._groupIndex));if(!t.length)return;r.targetLayers=t}let i;if(r.fileHandle){let e={mainHandle:r.fileHandle};r.additionalFileHandles&&(e.additionalHandles=r.additionalFileHandles),i=t.parent.addRecentFileEntry(e)}else i=Promise.resolve();i.then((()=>{t.parent.trigger(Eb.Z.event.FEATURESIMPORT,r),n.some((e=>!e.geometry))&&t.parent.trigger(Eb.Z.event.FEATURESIMPORTWARN,{file:e.file})}))}else{if(o){if(++o.failed<o.total)return;{const t=a.getFileHandle(e.file);e.file=new File([],o.zipName),t&&a.setFileHandle(e.file,t)}}t.parent.trigger(Eb.Z.event.FEATURESIMPORTERROR,{file:e.file})}})),a.on("error",(function(e){_b.Z.error(e)})),n.once)a.map_=t.map;else{t.map.addInteraction(a);var s=a.target?a.target:t.map.getViewport();const e=a.handleResult_;var l={},c=function(e){return e.arrayBuffer?e.arrayBuffer():new Promise((function(t,r){var n=new FileReader;n.onload=function(e){t(new Uint8Array(this.result))},n.onerror=r,n.readAsArrayBuffer(e)}))};a.handleResult_=async function(n,i){var a=this;o=null;if(/\.gpkg$/gi.test(n.name)||"application/geopackage+sqlite3"===n.type)r.e(2020).then(r.t.bind(r,2020,23)).then((async function(r){const i=r.GeoPackageAPI,o=function(t){t&&_b.Z.error(t,Eb.Z.msgErrorMode.CONSOLE),e.apply(a,[n,{target:{result:null}}])};try{!async function(r){i.open(r).then((async function(r){const i=r.getFeatureTables(),s=i.length;var l=0,c=0,u=[];const p=function(e){if(++l===s){t.parent.off(Eb.Z.event.FEATURESIMPORT,p);for(var r=0;r<u.length;r++)t.parent.trigger(Eb.Z.event.FEATURESIMPORTPARTIAL,{file:n,table:u[r].table,reason:u[r].reason})}},h=a.getFileHandle(n);t.parent.on(Eb.Z.event.FEATURESIMPORT,p),i.length>1&&(window.dropFilesCounter=window.dropFilesCounter+i.length-1);for(var d=0;d<i.length;d++)try{var f=[];for(let e of r.iterateGeoJSONFeatures(i[d]))Object.prototype.hasOwnProperty.call(e,"id")&&(e.id=i[d]+"."+e.id),e.geometry&&(e.type="Feature",f[f.length]=e);if(!f.length)throw"empty table";var g={type:"FeatureCollection",features:f},y=new File([],i[d]);h&&a.setFileHandle(y,h),e.apply(a,[y,{target:{result:g}}])}catch(e){c++,p({fileName:i[d]}),u.push({table:i[d],reason:e}),_b.Z.error("Error: "+e+" Table: "+i[d],Eb.Z.msgErrorMode.CONSOLE)}s===c&&o("Error: No hay capas vectoriales vlidas que mostrar")}),o)}(new Uint8Array(await c(n)))}catch(e){o(e)}}));else if(/\.(json|geojson|kml|kmz|wkt|wkb|gml|gml2|gpx)$/gi.test(n.name))e.apply(a,[n,i]);else{/\.(shp)$/gi.test(n.name)||window.dropFilesCounter--;let i=n.name;const o=i.substring(i.lastIndexOf(".")+1);o.length&&(i=i.substring(0,i.lastIndexOf("."))),i=i.match(/^(?:spaSITNA)?(.+)/i)[1];var s=null;if(s=Object.prototype.hasOwnProperty.call(l,i)?l[i]:l[i]={isSHP:!1,promises:[]},/\.(cst|cpg|prj)$/gi.test(n.name)){s.isSHP=!0;let e=function(e){return e.text?e.text():new Promise((function(t,r){var n=new FileReader;n.onload=function(e){t(new Uint8Array(this.result))},n.onerror=r,n.readAsText(e)}))}(n);s.promises.push(e),e.then((function(e){l[i][o]=e}))}else if(/\.(shp|dbf|str)$/gi.test(n.name)){s.isSHP=!0,/\.(shp)$/gi.test(n.name)&&(s.shpFile=n);let e=c(n);s.promises.push(e),e.then((function(e){l[i][o]=e}))}s.timer||(s.timer=new Promise((function(e){setTimeout((function(){e()}),1300)})),s.promises.push(s.timer),Promise.all(s.promises).then((function(o){s.isSHP?r.e(1741).then(r.t.bind(r,1741,23)).then((async({default:r})=>{var o;let c;try{if(!s.shp||!s.prj||!s.dbf)return s.shp||window.dropFilesCounter++,t.parent.trigger(Eb.Z.event.FEATURESIMPORTERROR,{file:n,message:"fileImport.shapeImcomplete"}),void delete l[i];c=s.shpFile,o=await r.combine([r.parseShp(s.shp,s.prj,s.str),r.parseDbf(s.dbf,s.cst||s.cpg||"ISO-8859-1")]),delete l[i]}catch(e){return void t.parent.trigger(Eb.Z.event.FEATURESIMPORTERROR,{file:n})}(o instanceof Array?o:[o]).forEach((function(t){t.features.forEach(((e,t)=>{e.id=`${i}.${t+1}`}));var r=new File([],i+".shp");const n=a.getFileHandle(c);n&&a.setFileHandle(r,n),e.apply(a,[r,{target:{result:JSON.stringify(t)}}])}))})):("wfsrequest.txt"===n.name.toLowerCase()&&Object.keys(l).some((e=>l[e].isSHP))||(window.dropFilesCounter++,t.parent.trigger(Eb.Z.event.FEATURESIMPORTERROR,{file:n})),delete l[i])})))}};var u=function(e){if(OC(e)){var r=t.parent;if(a.target===e.target){if(!p(e.dataTransfer.items)){var n=r.getLoadingIndicator();n&&(r._featureImportWaitId=n.addWait(r._featureImportWaitId))}e.stopPropagation()}else e.preventDefault();r.div.classList.remove(Eb.Z.classes.DROP)}},p=function(e){for(var t=0,r=e.length;t<r;++t)if("file"===e[t].kind)return!(e[t].getAsFile()||e[t].webkitGetAsEntry()&&e[t].webkitGetAsEntry().isFile)&&p(e[t].webkitGetAsEntry());return!0};a.dropListenKeys_.push(ol.events.listen(s,jb,IC,a)),a.dropListenKeys_.push(ol.events.listen(document.body,jb,IC,a)),a.dropListenKeys_.push(ol.events.listen(s,Wb,IC,a)),a.dropListenKeys_.push(ol.events.listen(document.body,Wb,IC,a)),a.dropListenKeys_.push(ol.events.listen(s,Hb,u,a)),a.dropListenKeys_.push(ol.events.listen(document.body,Hb,u,a)),a.dropListenKeys_.push(ol.events.listen(document.body,"dragleave",RC,a)),a.dropListenKeys_.push(ol.events.listen(document.body,"dragend",RC,a)),a.dropListenKeys_.push(ol.events.listen(document.body,"dragexit",RC,a)),document.addEventListener("mouseenter",(function(e){e.buttons||t.parent.div.classList.remove(Eb.Z.classes.DROP)}),!1),t.ddEnabled=!0}return a},_b.Z.wrap.Map.prototype.loadFiles=async function(e,t){const r=this;let n;if(e.length){if(r.ddEnabled?r.map.getInteractions().forEach((function(e){e instanceof ol.interaction.DragAndDrop&&(n=e)})):n=r.enableDragAndDrop({once:!0}),n&&t){var i=n.target;if(n.target=t.control,r.parent.one(Eb.Z.event.FEATURESIMPORT,(function(e){n.target=i})),t.layers){const e=n._fileLayers||[];n._fileLayers=e.concat(t.layers.filter((t=>!e.includes(t))))}}var o=r.parent.getLoadingIndicator();o&&(r.parent._featureImportWaitId=o.addWait(r.parent._featureImportWaitId));for(var a=0,s=e.length;a<s;++a){const t=e[a];n.processFile(t)}}},_b.Z.wrap.Map.prototype.linkTo=function(e){const t=this,r=function(){const r=t.map.getView(),n=e.wrap.map.getView();setTimeout((function(){r!==n&&t.map.setView(n)}),100)};e.wrap.map.on("change:view",r),t.map.on("change:view",r),r()},_b.Z.wrap.Layer.prototype.getVisibility=function(){const e=this;var t=!1;return e.layer&&(t=e.layer.getVisible()),t},_b.Z.wrap.Layer.prototype.setVisibility=function(e){this.getLayer().then((function(t){t.setVisible(e)}))},_b.Z.wrap.Layer.prototype.setOpacity=async function(e){(await this.getLayer()).setOpacity(e)},_b.Z.wrap.Layer.prototype.isNative=function(e){return e instanceof ol.layer.Layer},_b.Z.wrap.Layer.prototype.setProjection=function(e){const t=this;e=e||{};const r=t.parent;if(r.map){const o=AC.call(t,{crs:e.crs,extentInDegrees:ol.proj.transformExtent(r.map.getExtent(),r.map.crs,"EPSG:4326")});var n=r.getResolutions();if(n&&n.length)n=n.map((function(e){return e/o})),r.wrap.layer.setMaxResolution(n[0]),r.wrap.layer.setMinResolution(n[n.length-1]);else if(!e.oldCrs||ol.proj.get(e.oldCrs).getUnits()!==ol.proj.Units.METERS||ol.proj.get(e.crs).getUnits()&&ol.proj.get(e.crs).getUnits()!==ol.proj.Units.DEGREES){if(e.oldCrs&&ol.proj.get(e.oldCrs).getUnits()===ol.proj.Units.DEGREES&&ol.proj.get(e.crs).getUnits()===ol.proj.Units.METERS){var i=_b.Z.Util.getMetersPerDegree(ol.proj.transformExtent(r.map.getExtent(),r.map.crs,"EPSG:4326"));r.minResolution&&(r.minResolution=r.minResolution*i,t.layer.setMinResolution(r.minResolution)),r.maxResolution&&(r.maxResolution=r.maxResolution*i,t.layer.setMaxResolution(r.maxResolution))}}else r.minResolution&&(r.minResolution=r.minResolution/o,t.layer.setMinResolution(r.minResolution)),r.maxResolution&&(r.maxResolution=r.maxResolution/o,t.layer.setMaxResolution(r.maxResolution))}};const MC=function(e){const t=new Path2D,r=e[0];t.moveTo(r[0],r[1]);for(var n=1,i=e.length;n<i;n++){const r=e[n];t.lineTo(r[0],r[1])}return t.closePath(),t},DC=function(e){if(_b.Z.Util.detectMobile())return e;{const t=new Path2D;return t.addPath(e,new DOMMatrix("scale("+window.devicePixelRatio+")")),t}},NC=function(e,t,r,n){const i=this,o=`_${t}PrerenderHandler`,a=`_${t}PostrenderHandler`;i[o]&&(i.layer.un(ol.render.EventType.PRERENDER,i[o]),delete i[o],i.layer.un(ol.render.EventType.POSTRENDER,i[a]),delete i[a]),e&&(i[o]=r,i.layer.on(ol.render.EventType.PRERENDER,i[o]),i[a]=n,i.layer.on(ol.render.EventType.POSTRENDER,i[a])),i.parent.map.wrap.map.render()};_b.Z.wrap.Layer.prototype.clip=function(e){const t=this;NC.call(t,e,"clip",(function(r){let n=e;_b.Z.Util.isFunction(e)&&(n=e.call(t._wrap)),n instanceof Path2D||(n=MC(n)),n=DC(n);const i=r.context;i.save(),i.clip(n,"evenodd")}),(function(e){e.context.restore()}))},_b.Z.wrap.Layer.prototype.stroke=function(e,t){const r=this;NC.call(r,e,"stroke",(function(e){}),(function(n){let i=e;_b.Z.Util.isFunction(e)&&(i=e.call(r._wrap)),i instanceof Path2D||(i=MC(i)),i=DC(i);const o=n.context;t.strokeWidth&&(o.lineWidth=t.strokeWidth),t.strokeColor&&(o.strokeStyle=t.strokeColor),o.stroke(i)}))},_b.Z.wrap.layer.Raster.prototype.WmsParser=ol.format.WMSCapabilities,_b.Z.wrap.layer.Raster.prototype.WmtsParser=ol.format.WMTSCapabilities,_b.Z.wrap.Layer.prototype.addCommonEvents=function(e){var t=this;e.on("change:visible",(function(){t.parent.map&&t.parent.map.trigger(Eb.Z.event.LAYERVISIBILITY,{layer:t.parent})}),t.parent.map)},_b.Z.wrap.layer.Raster.prototype.getGetMapUrl=function(){var e=null,t=this;switch(t.getServiceType()){case Eb.Z.layerType.WMS:for(var r=t.parent.capabilities.Capability.Request.GetMap.DCPType,n=0;n<r.length;n++)if(r[n].HTTP&&r[n].HTTP.Get){e=r[n].HTTP.Get.OnlineResource;break}break;case Eb.Z.layerType.WMTS:e=t.parent.capabilities.OperationsMetadata.GetTile.DCP.HTTP.Get[0].href}const i=document.createDocumentFragment(),o=document.createElement("textarea");return i.appendChild(o),o.innerHTML=e,e=o.textContent},_b.Z.wrap.layer.Raster.prototype.getInfoFormats=function(){var e=null,t=this.parent.capabilities;return t.Capability&&t.Capability.Request.GetFeatureInfo&&(e=t.Capability.Request.GetFeatureInfo.Format),e},_b.Z.wrap.layer.Raster.infoFormatPreference=["application/json","application/vnd.ogc.gml/3.1.1","application/vnd.ogc.gml","application/vnd.esri.wms_featureinfo_xml","text/html","text/plain","text/xml"],_b.Z.wrap.layer.Raster.prototype.getWMTSLayer=function(e){var t=null,r=this,n=r.parent.capabilities;let i;if((e=e||{}).crs&&(i=n.Contents.TileMatrixSet.filter((t=>_b.Z.Util.CRSCodesEqual(e.crs,t.SupportedCRS)))),n&&n.Contents)for(var o=0;o<n.Contents.Layer.length;o++){var a=n.Contents.Layer[o];if(r.parent.options.layerNames===a.Identifier)for(var s=0;s<a.TileMatrixSetLink.length;s++)if(e.crs){if(i.filter((e=>e.Identifier===a.TileMatrixSetLink[s].TileMatrixSet)).length>0){t=a;break}}else if((e.matrixSetId||r.parent.options.matrixSet)===a.TileMatrixSetLink[s].TileMatrixSet){t=a;break}}return t},_b.Z.wrap.layer.Raster.prototype.getTileMatrix=function(e){var t=null,r=this.parent.capabilities;if(r&&r.Contents&&r.Contents.TileMatrixSet)for(var n=0;n<r.Contents.TileMatrixSet.length;n++){var i=r.Contents.TileMatrixSet[n];if(i.Identifier===e){t=i.TileMatrix;break}}return t},_b.Z.wrap.layer.Raster.prototype.getScaleDenominators=function(e){var t=[],r=this;if(e.ScaleDenominator?t=[e.ScaleDenominator,e.ScaleDenominator]:(e.MinScaleDenominator||e.MaxScaleDenominator)&&(t=[e.MaxScaleDenominator,e.MinScaleDenominator]),!t.length&&!r.getName(e)){for(var n=r.getLayerNodes(e),i=-1/0,o=1/0,a=0,s=n.length;a<s;a++){var l=r.getScaleDenominators(n[a]);l[0]>i&&(i=l[0]),l[1]<o&&(o=l[1])}i>-1/0&&o<1/0&&(t=[i,o])}return t},_b.Z.wrap.layer.Raster.prototype.getAttribution=function(){const e={},t=_b.Z.capabilities[this.parent.url];return t&&(t.ServiceProvider?(e.name=t.ServiceProvider.ProviderName.trim(),e.site=t.ServiceProvider.ProviderSite,e.site&&e.site.href&&e.site.href.trim().length>0?e.site=e.site.href:delete e.site):t.ServiceIdentification?e.name=t.ServiceIdentification.Title.trim():e.name=t.Service.Title.trim()),e},_b.Z.wrap.layer.Raster.prototype.getInfo=function(e){var t,r=this,n={},i=r.parent.capabilities;if(i)if(i.Capability){var o=r.getAllLayerNodes();for(t=0;t<o.length;t++){var a=o[t];if(r.parent.compareNames(r.getName(a),e)){a.Title&&(n.title=a.Title),a.Abstract&&(n.abstract=a.Abstract),n.legend=[];var s=function(e,t){if(e.Layer&&e.Layer.length>0)for(var n in e.Layer)s(e.Layer[n],t);else t.apply(r,[e])};if(s(a,(function(e){this.getLegend(e).filter((e=>e.src)).forEach((t=>{n.legend.push({src:t.src,title:e.Title})}))})),a.MetadataURL&&a.MetadataURL.length){n.metadata=[];for(var l=0;l<a.MetadataURL.length;l++){var c=a.MetadataURL[l];n.metadata.push({format:c.Format,type:c.type,url:c.OnlineResource})}}n.queryable=a.queryable;break}}}else if(i.Contents){const e=r.parent.names[0];for(t=0;t<i.Contents.Layer.length;t++){const r=i.Contents.Layer[t];if(r.Identifier===e){n.abstract=r.Abstract;let e=r.Metadata;e&&(Array.isArray(e)||(e=[e]),n.metadata=e.map((e=>({format:e.format,url:e.href}))));break}}}return n},_b.Z.wrap.layer.Raster.prototype.getServiceType=function(){var e=null,t=this.parent.capabilities;return t.Capability&&t.Capability.Request&&t.Capability.Request.GetMap?e=Eb.Z.layerType.WMS:t.OperationsMetadata&&t.OperationsMetadata.GetTile&&(e=Eb.Z.layerType.WMTS),e},_b.Z.wrap.layer.Raster.prototype.getServiceTitle=function(){var e=null,t=this.parent.capabilities;return t.Capability&&t.Service?e=t.Service.Title:t.ServiceIdentification&&(e=t.ServiceIdentification.Title),e},_b.Z.wrap.layer.Raster.prototype.getRootLayerNode=function(){var e;return this.getServiceType()===Eb.Z.layerType.WMS&&(e=this.parent.capabilities.Capability.Layer),e},_b.Z.wrap.layer.Raster.prototype.getName=function(e,t){var r=e.Name;if(r&&t){var n=r.indexOf(":");n>=0&&(r=r.substr(n+1))}return r},_b.Z.wrap.layer.Raster.prototype.getIdentifier=function(e){return e.Identifier},_b.Z.wrap.layer.Raster.prototype.getLayerNodes=function(e){var t=e.Layer;return Array.isArray(t)||(t=t?[t]:[]),t},_b.Z.wrap.layer.Raster.prototype.getAllLayerNodes=function(){var e=this;if(!e._layerList)switch(e.getServiceType()){case Eb.Z.layerType.WMS:var t=e.getRootLayerNode();e._layerList=t?function t(r){for(var n=[r],i=e.getLayerNodes(r),o=0;o<i.length;o++)n=n.concat(t(i[o]));return n}(t):[];break;case Eb.Z.layerType.WMTS:e._layerList=e.parent.capabilities.Contents.Layer.slice();break;default:e._layerList=[]}return e._layerList},_b.Z.wrap.layer.Raster.prototype.normalizeLayerNode=function(e){return e},_b.Z.wrap.layer.Raster.prototype.normalizeCapabilities=function(e){return e};const ZC=document.createDocumentFragment(),kC=document.createElement("textarea");ZC.appendChild(kC),_b.Z.wrap.layer.Raster.prototype.getLegend=function(e){var t=[],r=e.Style;return r&&r.length&&r.length&&r[0].LegendURL&&r[0].LegendURL.length&&r[0].LegendURL.forEach((function(e){kC.innerHTML=e.OnlineResource;const r={src:kC.textContent};t.push(r)})),t},_b.Z.wrap.layer.Raster.prototype.isCompatible=function(e){var t=this,r=!0,n=t.parent;switch(t.getServiceType()){case Eb.Z.layerType.WMS:if(n.capabilities&&n.capabilities.Capability&&n.capabilities.Capability.Layer&&n.names.length>0)for(var i=n.names.slice(0),o=function r(i,o,a){var s=!1;if(i)for(var l=0;l<i.length;l++){var c=i[l];const p=c.CRS||c.SRS,h=Array.isArray(p)?p:[p];var u=a||h.indexOf(e)>=0;if(n.compareNames(t.getName(c),o)){u&&(s=!0);break}if(r(c.Layer,o,u)){s=!0;break}}return s};i.length>0;)if(!o([n.capabilities.Capability.Layer],i.pop())){r=!1;break}break;case Eb.Z.layerType.WMTS:if(r=!1,n.capabilities&&n.capabilities.Contents&&n.capabilities.Contents.TileMatrixSet)for(var a=n.capabilities.Contents.TileMatrixSet,s=0;s<a.length;s++)if(a[s].Identifier===n.options.matrixSet){r=_b.Z.Util.CRSCodesEqual(e,a[s].SupportedCRS);break}}return r},_b.Z.wrap.layer.Raster.prototype.getCompatibleCRS=function(){var e=[],t=this.parent;switch(this.getServiceType()){case Eb.Z.layerType.WMS:if(t.capabilities&&t.capabilities.Capability&&t.capabilities.Capability.Layer&&t.names.length>0){const r=t.names.map((function(e){return t.getNodePath(e).map((function(e){const t=e.CRS||e.SRS||[],r=Array.isArray(t)?t:[t];return Array.isArray(r)?r:[r]})).reduce((function(e,t){return 0===e.length?t:(t.forEach((function(t){e.indexOf(t)<0&&(e[e.length-1]=t)})),e)}),[])}));if(1===r.length)e=r[0];else{const t=r.slice(1);e=r[0].filter((function(e){return t.every((function(t){return t.indexOf(e)>=0}))}))}}break;case Eb.Z.layerType.WMTS:t.capabilities&&t.capabilities.Contents&&t.capabilities.Contents.Layer.filter((function(e){return e.Identifier===t.layerNames})).forEach((function(r){const n=r.TileMatrixSetLink.map((function(e){return e.TileMatrixSet}));e=t.capabilities.Contents.TileMatrixSet.filter((function(e){return n.indexOf(e.Identifier)>=0})).map((function(e){return e.SupportedCRS}))}))}return e},_b.Z.wrap.layer.Raster.prototype.getCompatibleLayers=function(e){var t=[],r=this.parent;switch(this.getServiceType()){case Eb.Z.layerType.WMS:if(r.capabilities&&r.capabilities.Capability&&r.capabilities.Capability.Layer){var n=function(e,r,i){var o=e.CRS||e.SRS,a=Array.isArray(o)?o:[o],s=i||a.indexOf(r)>=0;if(s&&e.Name&&t.push(e.Name),e.Layer)for(var l=0;l<e.Layer.length;l++)n(e.Layer[l],r,s)};n(r.capabilities.Capability.Layer,e)}break;case Eb.Z.layerType.WMTS:if(r.capabilities&&r.capabilities.Contents&&r.capabilities.Contents.TileMatrixSet)for(var i=r.capabilities.Contents.TileMatrixSet,o=0,a=i.length;o<a;o++){var s=i[o];if(_b.Z.Util.CRSCodesEqual(e,s.SupportedCRS))for(var l=s.Identifier,c=r.capabilities.Contents.Layer,u=0,p=c.length;u<p;u++)for(var h=c[u].TileMatrixSetLink,d=0,f=h.length;d<f;d++)if(h[d].TileMatrixSet===l){t.push(c[u].Identifier);break}}}return t},_b.Z.wrap.layer.Raster.prototype.getCompatibleMatrixSets=function(e){var t=[];xC({crs:e});var r=this.parent;if(this.getServiceType()===Eb.Z.layerType.WMTS)for(var n=r.capabilities.Contents.Layer,i=r.capabilities.Contents.TileMatrixSet,o=0,a=n.length;o<a;o++)if(r.layerNames===n[o].Identifier)for(var s=n[o].TileMatrixSetLink,l=0,c=s.length;l<c;l++)for(var u=s[l],p=0,h=i.length;p<h;p++){var d=i[p];if(d.Identifier===u.TileMatrixSet){_b.Z.Util.CRSCodesEqual(e,d.SupportedCRS)&&t.push(d.Identifier);break}}return t},_b.Z.wrap.layer.Raster.prototype.setWMTSUrl=function(){var e=this;e.getLayer().then((function(t){e.parent.options=e.parent.options||{};var r=t.getSource().getUrls();e.parent.options.urlPattern=r[r.length-1]}))};const FC=function(e,t,r){const n=r*(t||1);return e.map(((e,t)=>t<2?e-n:e+n))};_b.Z.wrap.layer.Raster.prototype.createWMSLayer=function(e,t,r){const n=this;var i=null,o=new ol.source.ImageWMS({url:e,crossOrigin:r.map?r.map.crossOrigin:void 0,params:t,ratio:_b.Z.Cfg.imageRatio,imageLoadFunction:n.parent.getImageLoad.bind(n.parent),serverType:"geoserver"}),a={visible:!!t.LAYERS.length||r&&r.method&&"POST"===r.method,source:o};return r.minResolution&&(a.minResolution=r.minResolution),r.maxResolution&&(a.maxResolution=r.maxResolution),(i=new ol.layer.Image(a))._wrap=n,n.addCommonEvents(i),i};var UC=function(e){var t=this,r=null,n=ol.source.WMTS.optionsFromCapabilities(t.parent.capabilities,{layer:e.layerNames,matrixSet:e.matrixSet,crossOrigin:e.map?e.map.options.crossOrigin:void 0,requestEncoding:e.encoding,format:e.format});let i;const o=t.parent.capabilities.Contents.Layer.find((t=>t.Identifier===e.layerNames));if(!o)throw new Error(`Layer '${e.layerNames}' not found`);if(i=o.TileMatrixSetLink.find((t=>t.TileMatrixSet===e.matrixSet)),!i)throw new Error(`Matrix set '${e.matrixSet}' not found`);{const e=i.TileMatrixSetLimits;e&&n.tileGrid.fullTileRanges_.forEach((function(t,r){const n=e[r];t.minX=n.MinTileCol,t.minY=n.MinTileRow,t.maxX=n.MaxTileCol,t.maxY=n.MaxTileRow}))}var a="https:";if(n){n.cacheSize=2048,location.protocol===a&&(n.urls=n.urls.map((function(e){return e.replace("http:",a)}))),n.extent=t.parent.getExtent(),n.crossOrigin=e.map?e.map.crossOrigin:void 0,(r=new ol.source.WMTS(n)).setTileLoadFunction(t.parent.getImageLoad.bind(t.parent));var s=r.getResolutions.bind(r);r.getResolutions=function(){var e=s(),r=t.parent.getLimitedMatrixSet();if(r&&r.length){var n=r[0].matrixIndex;void 0!==n&&(e=e.slice(n,r.length+n))}return e}}return r};_b.Z.wrap.layer.Raster.prototype.createWMTSLayer=function(e){const t=this;var r=null,n=UC.call(t,e);if(n){var i={source:n};e.minResolution&&(i.minResolution=e.minResolution),e.maxResolution&&(i.maxResolution=e.maxResolution),(r=new ol.layer.Tile(i))._wrap=t,t.addCommonEvents(r);var o=n.getResolutions();r.setMaxResolution(o[0]+1),r.setMinResolution(o[o.length-1])}return r},_b.Z.wrap.layer.Raster.prototype.getParams=function(){return this.layer.getSource().getParams()},_b.Z.wrap.layer.Raster.prototype.setParams=function(e){this.layer.getSource().updateParams(e)},_b.Z.wrap.layer.Raster.prototype.setMatrixSet=function(e){const t=this;if(t.parent.type===Eb.Z.layerType.WMTS){const r=UC.call(t,_b.Z.Util.extend({},t.parent.options,{matrixSet:e})),n=r.getResolutions(),i=n[0],o=n[n.length-1];t.layer.setMaxResolution(i),t.layer.setMinResolution(o),t.parent.minResolution&&(t.parent.minResolution=o),t.parent.maxResolution&&(t.parent.maxResolution=i),t.layer.setSource(r)}},_b.Z.wrap.layer.Raster.prototype.getResolutions=function(){if(this.layer.getSource){var e=this.layer.getSource();return e.getResolutions?e.getResolutions():[]}return[]},_b.Z.wrap.layer.Raster.prototype.setResolutions=function(e){if(this.layer.getSource){var t=this.layer.getSource();t.resolutions_?t.resolutions_=e:t.tileGrid&&(t.tileGrid.resolutions_=e)}},_b.Z.wrap.layer.Raster.prototype.reloadSource=function(){const e=this;return new Promise((function(t,r){e.layer.getSource?(e.layer.getSource().refresh(),t()):r()}))},_b.Z.wrap.Geometry={getNearest:function(e,t){let r;return r=Nb.Z.isRingCollection(t)?new ol.geom.MultiLineString(t):new ol.geom.LineString(t),r.getClosestPoint(e)}};var BC=function(e,t,r){if(e){var n=function(n){var i=(r&&r._wrap?r._wrap.parent.options.width:null)||t;if(i<n){var o=i/n;e.setScale(o)}},i=e.getSize();if(i)n(i[0]);else{var o=e.getImage();if(!o.naturalWidth){const t=document.createDocumentFragment(),r=document.createElement("img");return r.src=e.getSrc(),t.appendChild(r),new Promise((function(e){r.addEventListener("load",(function(){n(this.naturalWidth),e(this)}))}))}n(o.naturalWidth)}}},GC=function(e,t){var r=e,n=t&&t.wrap&&t.wrap.feature;if("string"==typeof e){var i=e.match(/^\$\{(.+)\}$/);if(i&&(r="",n)){for(var o=i[1].split("."),a=n.getProperties(),s=0;s<o.length&&void 0!==a;s++)a=a[o[s]];r=a}}else _b.Z.Util.isFunction(e)&&(r=e(t));return r};const jC=function(e){if(e)for(var t in e)if("point"==t||"line"==t||"polygon"==t||"marker"==t||"cluster"==t||Sb.Z.isStyleOption(t)){const r=e[t];if("string"==typeof r){if(/^\$\{(.+)\}$/.test(r))return!0}else if("object"==typeof r&&jC(r))return!0}return!1},WC=function(e,t){if(Sb.Z.isFunction(e))return function(t){return WC(e(t._wrap.parent))};const r=function(t){const r=[];var n,i,o,a;if(t){const e=t.getGeometry();switch(e&&e.getType()){case"Point":case"MultiPoint":i=!0;break;case"LineString":case"MultiLineString":o=!0;break;case"Polygon":case"MultiPolygon":a=!0}n=t._wrap?t._wrap.parent:{id:_b.Z.wrap.Feature.prototype.getId.call({feature:t}),features:t.get("features"),getData:function(){return _b.Z.wrap.Feature.prototype.getData.call({feature:t})}}}const s=e.styles;let l={};return!s.line||!o&&t||(l=s.line,(l instanceof Array?l:[l]).forEach((function(e,t){r[t]=Object.assign(r[t]||{},{stroke:new ol.style.Stroke({color:GC(e.strokeColor,n),width:GC(e.strokeWidth,n),lineDash:e.lineDash})})}))),!s.polygon||!a&&t||(l=s.polygon,(l instanceof Array?l:[l]).forEach((function(e,t){r[t]=Object.assign(r[t]||{},{fill:new ol.style.Fill({color:bC(GC(e.fillColor,n),GC(e.fillOpacity,n))}),stroke:new ol.style.Stroke({color:GC(e.strokeColor,n),width:GC(e.strokeWidth,n),lineDash:e.lineDash})})}))),!s.point||!i&&t||(l=s.point,(l instanceof Array?l:[l]).forEach((function(e,t){var i={radius:GC(e.radius,n)||(GC(e.height,n)+GC(e.width,n))/4};e.fillColor&&(i.fill=new ol.style.Fill({color:bC(GC(e.fillColor,n),GC(e.fillOpacity,n))})),e.strokeColor&&(i.stroke=new ol.style.Stroke({color:GC(e.strokeColor,n),width:GC(e.strokeWidth,n),lineDash:e.lineDash})),isNaN(i.radius)||(r[t]=Object.assign(r[t]||{},{image:new ol.style.Circle(i)}))}))),(l.label||l.labelKey)&&(r[r.length]={text:HC(l,n)}),!s.marker||!i&&t||(l=s.marker,(l instanceof Array?l:[l]).forEach((function(e,t){const i=e.url||Sb.Z.getBackgroundUrlFromCss(e.cssClass);var o="fraction";if(i){var a,l;let c;e.width&&e.height&&(c=[GC(e.width,n),GC(e.height,n)]),r[t]=Object.assign(r[t]||{},{image:new ol.style.Icon({crossOrigin:"anonymous",anchor:e.anchor||s.marker.anchor||[.5,1],anchorXUnits:e.anchorXUnits||o,anchorYUnits:e.anchorYUnits||o,src:i,width:null===(a=c)||void 0===a?void 0:a[0],height:null===(l=c)||void 0===l?void 0:l[1],rotation:e.rotation?e.rotation/180*Math.PI:void 0}),text:HC(e,n)})}}))),r.map((e=>{var t=new ol.style.Style(e);return l.balloon&&(t._balloon=new ol.style.Text({text:l.balloon})),t}))};return jC(e.styles)?r:r(t)},HC=function(e,t){if(!e||!e.label)return;const r={text:""+GC(e.labelKey||e.label,t),overflow:!0};if(e.font?r.font=e.font:e.fontSize&&(r.font=GC(e.fontSize,t)+"pt sans-serif"),e.labelRotationKey&&(r.rotation=-Math.PI*GC(e.labelRotationKey,t)/180),e.fontColor){const n=GC(e.fontColor,t);r.fill=new ol.style.Fill({color:bC(n,(Array.isArray(n)?n[3]:1)||1)})}if(e.labelOutlineColor){const n=GC(e.labelOutlineColor,t);r.stroke=new ol.style.Stroke({color:bC(n,(Array.isArray(n)?n[3]:1)||1),width:GC(e.labelOutlineWidth,t)})}return e.labelOffset&&(r.offsetX=e.labelOffset[0],r.offsetY=e.labelOffset[1]),e.textScale&&(r.scale=e.textScale),e.textAlign&&(r.textAlign=e.textAlign),new ol.style.Text(r)};var qC=function(e){var t=e.toString(16);return 1===t.length&&(t="0"+t),t},VC=function(e){return"#"+qC(e[0])+qC(e[1])+qC(e[2])},zC=function(e,t){var r={};if(_b.Z.Util.isFunction(e)&&t&&(e=e(t)),Array.isArray(e)&&(e=e[0]),!_b.Z.Util.isFunction(e)){var n,i,o;if(t){const r=t.getGeometry();if(r){const t=r.getType();t!==lC&&t!==cC&&e.setImage(null)}}var a=e.getImage();if(a)if(a instanceof ol.style.RegularShape)(n=(i=a.getStroke()).getColor())&&(n=ol.color.asArray(n),r.strokeColor=VC(n)),r.strokeWidth=i.getWidth(),(o=a.getFill())&&((n=o.getColor())&&(n=ol.color.asArray(n),r.fillColor=VC(n)),r.fillOpacity=n[3]);else{r.url=a.getSrc();var s=a.getSize();s&&(r.width=s[0],r.height=s[1],r.anchor=a.getAnchor(),r.anchor&&(r.anchor[0]=r.anchor[0]/r.width*(a.getScale()||1),r.anchor[1]=r.anchor[1]/r.height*(a.getScale()||1)))}else(i=e.getStroke())&&((n=i.getColor())&&(n=ol.color.asArray(n),r.strokeColor=VC(n)),r.strokeWidth=i.getWidth(),r.lineDash=i.getLineDash()),(o=e.getFill())&&((n=o.getColor())&&(n=ol.color.asArray(n),r.fillColor=VC(n)),r.fillOpacity=n[3])}return r};_b.Z.wrap.layer.Vector.prototype.getStyle=function(){return zC(this.layer.getStyle())},_b.Z.wrap.layer.Vector.prototype.reloadSource=function(){const e=this;return new Promise((function(t,r){const n=e.createVectorSource(e.parent,e.createStyles(e.parent));if(e.parent.type===Eb.Z.layerType.WFS)var i=n.source.on("change",(function(e){"ready"===n.source.getState()&&(ol.Observable.unByKey(i),t())}));var o=e.layer.getSource().getFeatures();e.layer.setSource(n.source),n.style&&e.layer.setStyle(n.style),e.parent.type!==Eb.Z.layerType.WFS&&(n.source.addFeatures(o),t())}))},_b.Z.wrap.layer.Vector.prototype.import=function(e){var t=this,r=_b.Z.Util.extend({},e);r.type=e.format;var n=t.layer.getSource().getFeatures(),i=t.createVectorSource(r,t.createStyles(t.parent));t.layer.setSource(i.source),i.style&&t.layer.setStyle(i.style),i.source.addFeatures(n)},_b.Z.wrap.layer.Vector.prototype.createVectorSource=function(e,t){const r=this;var n,i,o=!1;const a=e.styles&&e.styles.heatmap;if(Array.isArray(e.url)||e.urls){var s=e.urls||e.url;s=s.map((function(e,t){return _b.Z.proxify(e)})),i={url:s,format:new ol.format.KML({showPointNames:!1,extractStyles:!a}),projection:e.crs}}else if(e.url&&e.type!==Eb.Z.layerType.WFS)(i={url:e.url,projection:e.crs}).format=PC(e.format,!a)||PC(_b.Z.Util.getMimeTypeFromUrl(e.url),!a)||PC(e.type,!a),i.loader=i.format instanceof ol.format.KML?function(e,t,n){const o=i.url,a=i.format;r.parent.state=Mb.Z.state.LOADING,r.parent.map&&r.parent.map.trigger(Eb.Z.event.BEFORELAYERUPDATE,{layer:r.parent}),r.parent.proxificationTool.fetch(o,{method:"GET",nomanage:!0}).then((async function(e){if(e.ok){const o=await e.text();var t=a.readFeatures(o,{featureProjection:n});const s=(new DOMParser).parseFromString(o,"text/xml").querySelector("Document > name");if(r.addFeatures(t),r.parent.state=Mb.Z.state.IDLE,e.headers.has("content-disposition")&&/(attachment);([^;]*)/gi.test(e.headers.get("content-disposition"))){const t=e.headers.get("content-disposition");var i;try{i=/filename\*?=\"?([\w|-]*\'\')?(.*\.\w*)\"?/gi.exec(t)[2]}catch(e){try{i=t.substring((t.lastIndexOf("'")||t.indexOf("="))+1)}catch(e){}}r.parent.title=(s?s.textContent:"")+(i?s&&s.textContent!=i?" ("+i+")":i:"")}else r.parent.title=(s?s.textContent:"")+(s&&s.textContent!=r.parent.title?" ("+r.parent.title+")":r.parent.title);r.parent.map&&r.parent.map.trigger(Eb.Z.event.LAYERUPDATE,{layer:r.parent})}})).catch((function(e){r.parent.state=Mb.Z.state.IDLE,r.parent.map&&r.parent.map.trigger(Eb.Z.event.LAYERERROR,{layer:r.parent,reason:e})}))}:function(e,t){var n=ol.featureloader.xhr(e,t);return function(e,t,i){r.parent.state=Mb.Z.state.LOADING,r.parent.map&&r.parent.map.trigger(Eb.Z.event.BEFORELAYERUPDATE,{layer:r.parent}),n.call(this,e,t,i)}}(i.url,i.format),o=!0;else if(e.data)i={projection:e.crs,loader:function(t,n,i){r.parent.state=Mb.Z.state.LOADING,r.parent.map&&r.parent.map.trigger(Eb.Z.event.BEFORELAYERUPDATE,{layer:r.parent});var o=this.getFormat();try{var a=o.readFeatures(e.data,{featureProjection:i});this.addFeatures(a),r.parent.state=Mb.Z.state.IDLE,r.parent.map&&r.parent.map.trigger(Eb.Z.event.LAYERUPDATE,{layer:r.parent,newData:e.data})}catch(e){r.parent.state=Mb.Z.state.IDLE,r.parent.map&&r.parent.map.trigger(Eb.Z.event.LAYERERROR,{layer:r.parent,reason:e.message})}}},i.format=PC(e.format)||PC(e.type);else if(e.type===Eb.Z.layerType.WFS){var l,c;switch(e.outputFormat){case Eb.Z.format.JSON:l=new ol.format.GeoJSON({geometryName:e.geometryName}),c="json";break;case Eb.Z.format.GML3:l=new ol.format.WFS({gmlFormat:new ol.format.GML3}),c=Eb.Z.mimeType.GML;break;case Eb.Z.format.GML32:l=new ol.format.WFS({gmlFormat:new ol.format.GML32}),c=Eb.Z.mimeType.GML;break;default:l=new ol.format.WFS({gmlFormat:new ol.format.GML2}),c=Eb.Z.mimeType.GML}i={format:l,loader:function(t,n,i){var o=this,a=e.url;if(a){r.parent.state=Mb.Z.state.LOADING,r.parent.map.trigger(Eb.Z.event.BEFORELAYERUPDATE,{layer:r.parent});const t=function(){return"string"==typeof e.properties},n=e=>{const t=e.data;let n;try{n=l.readFeatures(t)}catch(e){r.parent.map.trigger(Eb.Z.event.LAYERERROR,{layer:r.parent,reason:e.message})}const i=function(){r.parent.map.trigger(Eb.Z.event.LAYERUPDATE,{layer:r.parent,newData:t})},a=function(e){e.layer===r.parent&&(r.parent.map.off(Eb.Z.event.FEATURESADD,a),i())};n&&n.length?(r.parent.map.on(Eb.Z.event.FEATURESADD,a),o.addFeatures(n)):i(),r.parent.state=Mb.Z.state.IDLE},s=e=>{e instanceof XMLDocument?r.parent.map.trigger(Eb.Z.event.LAYERERROR,{layer:r.parent,reason:e.querySelector("ExceptionText").innerHTML}):r.parent.map.trigger(Eb.Z.event.LAYERERROR,{layer:r.parent,reason:e})},u=(n,o)=>{var s={},l=i.getCode(),u=e.version||o.version||"1.1.0";o.version=u;var p=a,h=Array.isArray(e.featureType)?e.featureType:[e.featureType];const d=t();if(e.properties&&(d?e.properties.length>Eb.Z.URL_MAX_LENGTH:e.properties.getText(o.version).length>Eb.Z.URL_MAX_LENGTH)?(s.method="POST",s.url=p,s.data=d?e.properties:_b.Z.Util.WFSQueryBuilder(h,e.properties,o,n?null:e.outputFormat,n,l,e.maxFeatures),d||r.parent.map.trigger(Eb.Z.event.BEFOREAPPLYQUERY,{layer:r.parent,query:s.data})):(s.method="GET",s.url=p,s.data={service:"WFS",request:"GetFeature",version:u,outputFormat:e.outputFormat,srsname:l},s.data["typename"+("2.0.0"===u?"s":"")]=(e.featurePrefix?e.featurePrefix+":":"")+e.featureType,n&&(s.data=Object.assign(s.data,{resultType:"hits"})),e.properties&&(e.properties instanceof _b.Z.filter.Bbox?s.data=Object.assign(s.data,{BBOX:"{0},{1},{2},{3},{4}".format(e.properties.extent.concat([l]))}):s.data=Object.assign(s.data,{filter:d?e.properties:e.properties.getText(u).replace(/\<(fes\:|ogc\:)/g,"<").replace(/\<\/(fes\:|ogc\:)/g,"</")}),d||n||r.parent.map.trigger(Eb.Z.event.BEFOREAPPLYQUERY,{layer:r.parent,query:e.properties.getText()})),e.maxFeatures&&(s.data=Object.assign(s.data,{maxFeatures:e.maxFeatures}))),"json"===(n?"":c))s.responseType=Eb.Z.mimeType.JSON;else s.responseType=Eb.Z.mimeType.XML;return s.contentType=Eb.Z.mimeType.XML,_b.Z.ajax(s)};r.parent.getCapabilitiesPromise().then((i=>{var o,a,c;const p=i;let h=null===(o=p.Operations)||void 0===o||null===(a=o.GetFeature)||void 0===a||null===(c=a.CountDefault)||void 0===c?void 0:c.DefaultValue;if(h){e.maxFeatures||(e.maxFeatures=h);let i=t();u(!i,p).then((e=>{if(i)n(e);else{var t=e.data.children[0];if(t.tagName.toLowerCase().indexOf("exception")>=0)r.parent.map.trigger(Eb.Z.event.LAYERERROR,{layer:r.parent,reason:t.querySelector("ExceptionText").innerHTML});else if(t.tagName.toLowerCase().indexOf("featurecollection")>=0){let e=parseInt((t.attributes.numberMatched||t.attributes.numberOfFeatures).value,10);if(isNaN(e)||e>=parseInt(h,10))return void r.parent.map.trigger(Eb.Z.event.LAYERERROR,{layer:r.parent,reason:Eb.Z.WFSErrors.MAX_NUM_FEATURES,data:{limit:parseInt(h,10),founded:e}});if(!isNaN(e)&&0===e)return void n({data:l instanceof ol.format.GeoJSON?{type:"FeatureCollection",totalFeatures:0,features:[],crs:null}:l.writeFeatures([])});u(!1,p).then(n).catch(s)}}})).catch(s)}else u(!1,p).then(n).catch(s)})),r._requestUrl=a}},projection:e.crs}}e.features&&((i=i||{}).features=e.features.map((e=>e instanceof bb.Z?e.wrap.feature:e))),n=new ol.source.Vector(i),o&&n.on(qb,(function(e){r.parent.map&&r.parent.map.trigger(Eb.Z.event.LAYERUPDATE,{layer:r.parent})})),n._tcLayer=r.parent;var u=e.style&&e.style.marker?e.style.marker:_b.Z.Cfg.styles.marker;if(e.style&&e.style.marker||(u=_b.Z.Util.extend({},u,{anchor:_b.Z.Cfg.styles.point.anchor})),e.cluster&&(n=new ol.source.Cluster({projection:e.crs,distance:e.cluster.distance,source:n}),e.cluster.animate)){var p=function(e,t){var r=Date.now(),n=e.getGeometry().getCoordinates(),i=t.getGeometry().getCoordinates();t.setGeometry(new ol.geom.Point(n));requestAnimationFrame((function o(){var a=function(e,t,r,n){var i=Math.min((Date.now()-n)/r,1),o=(t[0]-e[0])*i,a=(t[1]-e[1])*i;return[e[0]+o,e[1]+a]}(n,i,Eb.Z.CLUSTER_ANIMATION_DURATION,r);t.setGeometry(new ol.geom.Point(a)),a[0]!==i[0]&&a[1]!==i[1]?requestAnimationFrame(o):h.splice(h.indexOf(e),1)}))},h=[];n.addEventListener(Jb,(function(e){var t=e.feature.get("features");t&&t.length>1&&h.push(e.feature)})),n.addEventListener($b,(function(e){var t=e.feature.get("features");if(t){var r=t[0].getGeometry().getCoordinates();if(t.length>1){var n=h.filter((function(e){var t=e.getGeometry().getCoordinates();return t[0]===r[0]&&t[1]===r[1]}));n.length&&h.splice(h.indexOf(n[0]),1)}var i=h.filter((function(e){var t=e.get("features");if(t&&t.length>0)return t.filter((function(e){var t=e.getGeometry().getCoordinates();return t[0]===r[0]&&t[1]===r[1]})).length>0}));i.length&&p(i[i.length-1],e.feature)}}))}var d=n;do{d.addEventListener($b,(function(e){var t=e.feature,r=aL(t,!0);if(r){const n=BC(r.getImage(),u.width,t);n&&n.then((function(){if(e.feature._wrap.parent._legend){const t=e.feature._wrap.parent.layer;delete e.feature._wrap.parent._legend,t.map.trigger(Eb.Z.event.VECTORUPDATE,{layer:t})}}))}})),d=_b.Z.Util.isFunction(d.getSource)?d.getSource():null}while(d);n.addEventListener($b,(function(e){const t=e.feature;if(!t._wrap||!t._wrap.parent.layer||!t._wrap.parent.layer.features.includes(t._wrap.parent)){const e=_b.Z.wrap.Feature.createFeature(t);let i;switch(!0){case e instanceof Cb.Z:i=r.parent.addPoint;break;case e instanceof Tb.Z:i=r.parent.addPolyline;break;case e instanceof Ab.Z:i=r.parent.addPolygon;break;case e instanceof Ib.Z:i=r.parent.addMultiPolygon;break;case e instanceof Ob.Z:i=r.parent.addMultiPolyline;break;default:i=r.parent.addFeature}var n;if(i)i.call(r.parent,t).then((function(i){var o=t.get("features");Array.isArray(o)&&(i.features=o.map((function(t){return new e.constructor(t)}))),clearTimeout(n),n=setTimeout((function(){r.parent.map.trigger(Eb.Z.event.FEATURESADD,{layer:r.parent,features:[i]})}),50)}))}})),n.addEventListener(Jb,(function(e){var t=e.feature;if(t._wrap){var n=r.parent.features.indexOf(t._wrap.parent);n>-1&&(r.parent.map.trigger(Eb.Z.event.BEFOREFEATUREREMOVE,{layer:r.parent,feature:t._wrap.parent}),r.parent.features.splice(n,1),r.parent.map.trigger(Eb.Z.event.FEATUREREMOVE,{layer:r.parent,feature:t._wrap.parent}))}})),n.addEventListener($b,(function(e){r.parent.map&&r.parent.map.trigger(Eb.Z.event.VECTORUPDATE,{layer:r.parent})})),n.addEventListener(Jb,(function(){r.parent.map&&r.parent.map.trigger(Eb.Z.event.VECTORUPDATE,{layer:r.parent})})),n.addEventListener(Qb,(function(){r.parent.map&&r.parent.map.trigger(Eb.Z.event.FEATURESCLEAR,{layer:r.parent})}));var f={source:n};return e.minResolution&&(f.minResolution=e.minResolution),e.maxResolution&&(f.maxResolution=e.maxResolution),i&&i.format instanceof ol.format.KML&&!e.cluster||(f.style=t||e.styles),f},_b.Z.wrap.layer.Vector.prototype.createStyles=function(e){var t=this,r=!1;if((e=_b.Z.Util.extend({},e)).crs=e.crs||_b.Z.Cfg.crs,Sb.Z.isFunction(e.styles))r=!0,t.styleFunction=function(t){return WC(e.styles(t._wrap.parent))};else{const n=function(e){const t=_b.Z.Util.extend(!0,{},_b.Z.Cfg.styles);return e&&e.map&&_b.Z.Util.extend(!0,t,e.map.options.styles),t}(t.parent),i=_b.Z.Util.extend(!0,n,e.styles);r=!(!e.cluster||!e.cluster.styles)||function e(t){for(var r in t){var n=t[r];switch(typeof n){case"string":if(/^\$\{(.+)\}$/.test(n))return!0;break;case"object":if(e(n))return!0;break;case"function":return!0}}return!1}(i);const o={styles:Object.assign({},i)};t.parent.styles&&(o.styles=Object.assign(o.styles,t.parent.styles)),e.cluster&&e.cluster.styles&&(o.styles=Object.assign({},o.styles,{cluster:e.cluster.styles})),t.styleFunction=function(e){o.layer=t.parent;let r=WC(o,e);return Sb.Z.isFunction(r)&&(r=r(e)),r},o.styles&&Object.keys(o.styles).length>1&&(r=!0)}return r?t.styleFunction:t.styleFunction()},_b.Z.wrap.layer.Vector.prototype.setStyles=function(e){const t=this;t.getLayer().then((function(r){if(e&&e.heatmap||r instanceof ol.layer.Heatmap){const n=r.getSource().getFeatures();n.forEach((e=>e.setStyle(null)));const i=_b.Z.Util.extend(!0,{features:n},t.parent.options);if(delete i.styles,t.layer=t.createVectorLayer(_b.Z.Util.extend(i,{styles:e})),t.parent.map){const e=t.parent.map.wrap;e.insertLayer(t.layer,e.getLayerIndex(r)),e.removeLayer(r)}}else r.setStyle(t.createStyles({styles:e}))}))},_b.Z.wrap.layer.Vector.prototype.createVectorLayer=function(e){const t=this;var r=null;e=e||t.parent.options;const n=t.createVectorSource(e,t.createStyles(e));if(e.styles&&e.styles.heatmap){const t=_b.Z.Util.extend({},e.styles.heatmap);if(_b.Z.Util.isFunction(t.weight)){const e=t.weight;t.weight=function(t){return e(t._wrap.parent)}}r=new ol.layer.Heatmap(_b.Z.Util.extend({source:n.source},t))}else r=new ol.layer.Vector(n);return r._wrap=t,t.addCommonEvents(r),r},_b.Z.wrap.layer.Vector.prototype.addFeatures=function(e){const t=this,r=function(t){t instanceof ol.layer.Heatmap&&e.forEach((e=>e.setStyle(null)));for(var r=t;_b.Z.Util.isFunction(r.getSource);)r=r.getSource();r.addFeatures(e)};t.layer?r(t.layer):t.getLayer().then(r)},_b.Z.wrap.layer.Vector.prototype.getFeatures=function(){var e=this.getLayer();return e instanceof ol.layer.Layer?e.getSource().getFeatures():[]},_b.Z.wrap.layer.Vector.prototype.getFeatureById=function(e){var t=this.layer;return t instanceof ol.layer.Layer?t.getSource().getFeatureById(e):null},_b.Z.wrap.layer.Vector.prototype.removeFeature=function(e){const t=this,r=function(t){if(e.wrap.feature){let r=t.getSource(),n=e.wrap.feature.getId();if(n&&r.getFeatureById(n)&&(r.removeFeature(e.wrap.feature),r.getSource&&Array.isArray(e.features))){const t=r.getSource();e.features.slice().forEach((e=>t.removeFeature(e.wrap.feature)))}}};t.layer?r(t.layer):t.getLayer().then(r)},_b.Z.wrap.layer.Vector.prototype.clearFeatures=function(){const e=this,t=function(e){var t=e.getSource();t.clearFeatures?t.clearFeatures():t.clear()};e.layer?t(e.layer):e.getLayer().then(t)},_b.Z.wrap.layer.Vector.prototype.setFeatureVisibility=function(e,t){var r=this,n={color:"rgba(0, 0, 0, 0)"},i={color:"rgba(0, 0, 0, 0)"},o=new ol.style.Style({image:new ol.style.Circle({radius:0,fill:new ol.style.Fill(n),stroke:new ol.style.Stroke(i)}),fill:new ol.style.Fill(n),stroke:new ol.style.Stroke(i)});if(r.parent.features.indexOf(e)>=0){var a=e.wrap.feature;r.getLayer().then((function(e){t&&a._originalStyle?a.setStyle(a._originalStyle):(a._originalStyle=a.getStyle()||e.getStyle(),a.setStyle(o)),r.parent.map.trigger(Eb.Z.event.VECTORUPDATE,{layer:r.parent})}))}},_b.Z.wrap.layer.Vector.prototype.getRGBA=function(e,t){return bC(e,t)},_b.Z.wrap.layer.Vector.prototype.findFeature=function(e){},_b.Z.wrap.layer.Vector.prototype.getGetFeatureUrl=function(){return this._requestUrl},_b.Z.wrap.layer.Vector.prototype.sendTransaction=function(e,t,r){const n=this,i=function(e){return e.wrap.feature};return new Promise((function(o,a){const s=e.map(i),l=t.map(i),c=r.map(i);e.length||t.length||r.length?n.getLayer().then((function(){var e=new ol.format.WFS,t=n.parent.options,r=e.writeTransaction(s,l,c,{featurePrefix:t.featurePrefix,featureNS:t.featureNS,featureType:t.featureType[0]}),i={url:n.parent.url,method:"POST",contentType:Eb.Z.mimeType.XML,responseType:Eb.Z.mimeType.XML,data:r.outerHTML};_b.Z.ajax(i).then((function(t){const r=t.data,n="http://www.opengis.net/ows";var i=r.getElementsByTagNameNS(n,"ExceptionReport")[0],s={reason:""};if(i){var l=i.getElementsByTagNameNS(n,"Exception")[0];if(l){s.code=l.getAttribute("exceptionCode");for(var c=l.getElementsByTagNameNS(n,"ExceptionText"),u=0,p=c.length;u<p;u++)s.reason+="\n"+c[u].innerHTML}a(s)}else{var h=e.readTransactionResponse(r);o(h)}})).catch((function(e){const t={code:e.status||"",reason:e.msg||"unknown"};a(t)}))})):o(n.parent)}))},_b.Z.wrap.layer.Vector.prototype.setDraggable=function(e,t,r){var n=this;Promise.all([n.parent.map.wrap.getMap(),n.getLayer()]).then((function(i){const o=i[0],a=i[1];if(e){var s={layers:[a],features:new ol.Collection(a.getSource().getFeatures())};n.interaction=new ol.interaction.Translate(s),_b.Z.Util.isFunction(t)&&n.interaction.on("translateend",(function(e){e.features.getLength()&&t(e.features.item(0)._wrap.parent)})),_b.Z.Util.isFunction(r)&&n.interaction.on("translatestart",(function(e){e.features.getLength()&&r(e.features.item(0)._wrap.parent)})),o.addInteraction(n.interaction)}else n.interaction&&(o.removeInteraction(n.interaction),_b.Z.Util.detectIE()&&n._handlerDraggablePointerMove&&_b.Z.Util.isFunction(n._handlerDraggablePointerMove)&&(o.un("pointermove",n._handlerDraggablePointerMove),delete n._handlerDraggablePointerMove))}))},_b.Z.wrap.layer.Vector.prototype.getFeaturesInExtent=function(e,t){var r=this,n=this.layer.getSource().getFeatures(),i=[];if(t){var o=r.parent.map.getPixelFromCoordinate([e[0],e[1]]),a=r.parent.map.getPixelFromCoordinate([e[2],e[3]]);o[0]-=t[0]/2,o[1]+=t[1],a[0]+=t[0]/2,e=r.parent.map.getCoordinateFromPixel(o).concat(r.parent.map.getCoordinateFromPixel(a))}for(var s=0;s<n.length;s++){var l=n[s],c=l.getGeometry().getCoordinates();ol.extent.containsCoordinate(e,c)&&i.push(l._wrap.parent)}return i},_b.Z.wrap.layer.Vector.prototype.getAttribution=function(){return null},_b.Z.wrap.layer.Vector.prototype.getGetMapUrl=function(){var e=null;if(this.getServiceType()===Eb.Z.layerType.WFS)try{e=this.parent.capabilities.Operations.GetFeature.DCP.HTTP.Get.href}catch(e){}const t=document.createDocumentFragment(),r=document.createElement("textarea");return t.appendChild(r),r.innerHTML=e,e=r.textContent},_b.Z.wrap.layer.Vector.prototype.getServiceType=function(){var e=null;return this.parent.capabilities&&(e=Eb.Z.layerType.WFS),e},_b.Z.wrap.control.Click.prototype.register=function(e){var t=this;t._trigger=function(r){if(e.view!==Eb.Z.view.PRINTING){var n=0;return e.wrap.map.forEachFeatureAtPixel(r.pixel,(function(e,t){e._wrap&&e._wrap.parent.showsPopup&&n++}),{hitTolerance:fC}),n||(t.parent.map.trigger(Eb.Z.event.CLICK,{coordinate:r.coordinate,pixel:r.pixel}),t.parent.callback(r.coordinate,r.pixel)),0===n}}},_b.Z.wrap.control.Click.prototype.activate=function(){var e=this;e.parent.map.wrap.getMap().then((function(t){t.on(zb,e._trigger)}))},_b.Z.wrap.control.Click.prototype.deactivate=function(){var e=this;e.parent.map.wrap.getMap().then((function(t){t.un(zb,e._trigger)}))},_b.Z.wrap.control.ScaleBar.prototype.render=function(){var e=this;e.ctl?e.ctl.updateElement_():e.ctl=new ol.control.ScaleLine({target:e.parent.div})},_b.Z.wrap.control.ScaleBar.prototype.getText=function(){if(this.ctl)return this.ctl.renderedHTML_},_b.Z.wrap.control.NavBar.prototype.register=function(e){var t=this;e.wrap.getMap().then((function(r){const n=t.parent.div;t.zCtl=new ol.control.Zoom({target:n}),t.zsCtl=new ol.control.ZoomSlider({render:function(e){if(!e.frameState||!e.frameState.viewState||r.getView().getMinResolution()<=e.frameState.viewState.resolution){var n=function(){this.element.offsetWidth>this.element.offsetHeight?(t.requestSliderSize||(t.requestSliderSize=window.requestAnimationFrame(n.bind(this))),window.requestAnimationFrame(n.bind(this))):this.element.offsetWidth<this.element.offsetHeight&&(t.requestSliderSize&&(window.cancelAnimationFrame(t.requestSliderSize),delete t.requestSliderSize),ol.control.ZoomSlider.prototype.render.call(this,e))};n.call(this)}}}),t.zsCtl.setTarget(n),r.addControl(t.zsCtl),r.addControl(t.zCtl),n.querySelectorAll("button").forEach((function(e){e.classList.add("tc-ctl-btn","tc-float-btn",t.parent.CLASS+"-btn"),e.style.display="block",e.innerHTML="",e.matches(".ol-zoom-in")&&(e.classList.add(t.parent.CLASS+"-btn-zoomin"),e.setAttribute("title",t.parent.getLocaleString("zoomIn"))),e.matches(".ol-zoom-out")&&(e.classList.add(t.parent.CLASS+"-btn-zoomout"),e.setAttribute("title",t.parent.getLocaleString("zoomOut")))}));const i=n.querySelector(".ol-zoomslider");i.classList.add(t.parent.CLASS+"-bar"),i.querySelector(".ol-zoomslider-thumb").classList.add(t.parent.CLASS+"-slider"),e.on(Eb.Z.event.BASELAYERCHANGE,t.refresh.bind(t))}))},_b.Z.wrap.control.NavBar.prototype.refresh=function(){var e=this,t=e.parent.map.wrap.map;e.parent.renderPromise().then((function(){if(e.zsCtl.sliderInitialized_){var r=t.getView().getResolution();e.zsCtl.setThumbPosition_(r)}else t.once(Xb,(function(t){e.zsCtl.render(t)}))}))},_b.Z.wrap.control.NavBarHome.prototype.register=function(e){var t=this;e.wrap.getMap().then((function(r){const n=t.parent.div;t.z2eCtl=new ol.control.ZoomToExtent({target:n,extent:e.initialExtent,tipLabel:""}),r.addControl(t.z2eCtl),n.querySelectorAll("button").forEach((function(e){e.style.display="block",e.innerHTML=""}));const i=n.querySelector(".ol-zoom-extent button");i.classList.add("tc-ctl-btn","tc-float-btn",t.parent.CLASS+"-btn"),i.setAttribute("title",t.parent.getLocaleString("zoomToInitialExtent"))}))},_b.Z.wrap.control.NavBarHome.prototype.setInitialExtent=function(e){this.z2eCtl.extent=e},_b.Z.wrap.control.Coordinates.prototype.register=async function(e){const t=this;if(t.map=e,t._coordsTrigger=function(e){t.parent.coordsToClick(e)},t.olMap=await e.wrap.getMap(),t.parent.map.on3DView)t.parent.crs=t.parent.map.view3D.crs,t.parent.units=Eb.Z.units.DEGREES;else{var r=t.olMap.getView().getProjection();t.parent.crs=r.getCode(),t.parent.units=r.getUnits()}t.parent.isGeo=t.parent.units===ol.proj.Units.DEGREES},_b.Z.wrap.control.Coordinates.prototype.onMouseMove=function(e){var t=this;if(t.map.wrap.map){var r=t.map.wrap.map.getEventCoordinate(e);r&&(t.parent.isGeo?t.parent.latLon=r.reverse():t.parent.xy=r,t.parent.update.apply(t.parent,arguments))}},_b.Z.wrap.control.Geolocation.prototype.register=function(e){var t=this;t.map=e,t._snapTrigger=function(e){e.dragging||t.initSnap(t.olMap.getEventCoordinate(e.originalEvent),e.pixel)},t._postrenderTrigger=function(e){t.duringTrackSnap(e)},e.wrap.getMap().then((function(e){t.olMap=e}))};var YC=function(){return this.parent.geotrackingLayer.features.find((function(e){return e instanceof Tb.Z}))};_b.Z.wrap.control.Geolocation.prototype.hasCoordinates=function(){return this.parent.geotrackingLayer.features.length>0&&this.parent.geotrackingLayer.features[0].geometry.length>=1},_b.Z.wrap.control.Geolocation.prototype.addWaypoint=function(e,t){var r=new ol.Feature({geometry:new ol.geom.Point([e[0],e[1],t.ele,t.time],"XYZM")});r.setProperties(t),this.parent.geotrackingLayer.wrap.layer.getSource().addFeature(r)},_b.Z.wrap.control.Geolocation.prototype.addPosition=function(e,t,r,n,i,o,a){var s=this,l=e[0],c=e[1],u=YC.call(this);if(s.parent.geotrackingLayer.features&&u){var p=u.geometry.length>0&&u.geometry[u.geometry.length-1];if(p&&0===p.length)s.parent.geotrackingLayer.features[0].geometry.push([l,c,a,r]),u.wrap.feature.getGeometry().appendCoordinate([l,c,a,r]);else{var h=p[0],d=p[1];l===h&&c===d||(s.parent.geotrackingLayer.features[0].geometry.push([l,c,a,r]),u.wrap.feature.getGeometry().appendCoordinate([l,c,a,r]))}_b.Z.Util.storage.setSessionLocalValue(s.parent.const.localStorageKey.GEOTRACKINGTEMP,s.formattedToStorage(s.parent.geotrackingLayer).features)}s.parent.trigger(s.parent.const.event.STATEUPDATED,{moving:null!=t&&null!=n&&n>0&&t>0})},_b.Z.wrap.control.Geolocation.prototype.positionChangehandler=async function(e){const t=this;var r,n,i,o,a;if(YC.call(this)||t.parent.setGeotracking(!1),e&&e.coords&&(t.parent.gpsLayer.clearFeatures(),r=e.coords.accuracy/t.parent.map.getMetersPerUnit()||0,n=e.coords.heading||e[2]||0,i=e.coords.speed?3.6*e.coords.speed:0,o=e.coords.altitude||0,a=e.coords.altitudeAccuracy||0,t.parent.geotrackingLayer)){var s=[e.coords&&e.coords.longitude||e[0],e.coords&&e.coords.latitude||e[1]];if(!s.every((e=>e)))return null;var l=_b.Z.Util.reproject(s,"EPSG:4326",t.parent.map.crs);t.addPosition(l,n,(new Date).getTime(),i,r,a,o);var c=YC.call(t).geometry,u=c.length;u>=2&&(t.parent.deltaMean=(c[u-1][3]-c[0][3])/(u-1)),t.parent.trigger(t.parent.const.event.POSITIONCHANGE,{pd:{position:l,altitude:o,accuracy:r,heading:_b.Z.Util.radToDeg(n),speed:i}});const h=await Promise.all([t.parent.gpsLayer.addPoint(l,{radius:6,fillColor:"#00CED1",fillOpacity:1,strokeColor:"#ffffff",strokeWidth:2,showsPopup:!1}),t.parent.gpsLayer.addCircle({center:l,radius:r},{strokeColor:"#ffffff",strokeWidth:1,fillColor:"#00CED1",fillOpacity:.3,showsPopup:!1})]),d=h[0],f=h[1];if(t.parent.geotrackingPosition=!0,0==t.parent.firstPosition){if(t.parent.firstPosition=!0,!t.parent.trackCenterButton){t.parent.trackCenterButton=t.parent.div.querySelector("."+t.parent.CLASS+"-track-center"),t.parent.trackCenterButton.querySelector("button").addEventListener("click",(function(){this.classList.contains(Eb.Z.classes.UNPLUGGED)?(t.parent.setFollowing(!0),t.parent.moveTo(t.parent.gpsLayer.features[0].geometry),t.parent.getTrackInfoPanel().then((function(e){e.isVisible()||e.doVisible(),e.isMinimized()&&e.maximize()}))):t.parent.setFollowing(!1)}));var p=t.parent.map.getControlsByClass("TC.control.ControlContainer")[0];p?t.parent.trackCenterButton=p.addElement({position:p.POSITION.LEFT,htmlElement:t.parent.trackCenterButton}):t.parent.map.div.appendChild(t.parent.trackCenterButton)}t.parent.trackCenterButton.classList.remove(Eb.Z.classes.HIDDEN),t.parent.setFollowing(!0),t.parent.moveTo(t.parent.gpsLayer.features)}return{marker:d,accuracy:f}}return null},_b.Z.wrap.control.Geolocation.prototype.setGeotracking=function(e){var t=this;if(e){t.parent.firstPosition=!1;var r,n=[];if(t.parent.geotrackingSession){var i=(new _b.Z.wrap.parser.JSON).parser.readFeatures(t.parent.geotrackingSession);i&&t.parent.storageCrs!==t.parent.map.crs&&(i=i.map((function(e){var r=e.clone();return r.getGeometry().transform(t.parent.storageCrs,t.parent.map.crs),r})));var o=i.find((function(e){var t=e.getGeometry().getType().toLowerCase();return"point"===t&&n.push(e),"linestring"===t||"multilinestring"===t})).getGeometry().getCoordinates();r=new ol.Feature({geometry:new ol.geom.LineString(o,"XYZM"),tracking:!0})}else r=new ol.Feature({geometry:new ol.geom.LineString([],"XYZM"),tracking:!0});if(r){const e=_b.Z.wrap.Feature.createFeature(r);var a;t.parent.geotrackingLayer.addFeature(e),e.geometry.length>1&&t.parent.map.zoomToFeatures(t.parent.geotrackingLayer.features),n.length>0&&n.map((e=>_b.Z.wrap.Feature.createFeature(e))).forEach((e=>t.parent.geotrackingLayer.addFeature(e))),t.parent.currentPositionWaiting=t.parent.getLoadingIndicator().addWait(),t.currentPositionTrk||(t.currentPositionTrk=[]);var s=0,l=0,c=!1,u={enableHighAccuracy:!0,timeout:6e5};a=setInterval((function e(r){var n=s++;navigator.geolocation.getCurrentPosition((function(e){clearInterval(a),t.parent.getLoadingIndicator().removeWait(t.parent.currentPositionWaiting),t.positionChangehandler(e).then((function(e){1==t.parent.geotrackingPosition&&e&&e.marker&&e.accuracy&&t.currentPositionTrk.push(navigator.geolocation.watchPosition(t.positionChangehandler.bind(t),t.parent.onGeolocateError.bind(t.parent),u))}))}),r||function(r){if(r.code===r.TIMEOUT)l>10?(clearInterval(a),t.parent.onGeolocateError.call(t.parent,r)):(l++,e((function(){clearInterval(a),c||(c=!0,t.parent.onGeolocateError.call(t.parent,r))})));else clearInterval(a),t.parent.onGeolocateError.call(t.parent,r)},{timeout:5e3+n,maximumAge:10,enableHighAccuracy:!0})}),1e3),setTimeout((function(){t.parent.geotrackingLayer&&t.parent.geotrackingLayer.features&&t.parent.geotrackingLayer.features.length>0&&0==t.parent.geotrackingLayer.features[0].geometry.length&&(clearInterval(a),t.parent.getLoadingIndicator().removeWait(t.parent.currentPositionWaiting),t.map.toast(t.parent.getLocaleString("geo.error.permission_denied"),{type:Eb.Z.msgType.WARNING}),t.parent.track.activateButton.classList.remove(Eb.Z.classes.HIDDEN),t.parent.track.deactivateButton.classList.add(Eb.Z.classes.HIDDEN))}),u.timeout+1e3)}}else t.parent.firstPosition=!1,t.currentPositionTrk&&(t.currentPositionTrk=t.currentPositionTrk instanceof Array?t.currentPositionTrk:[t.currentPositionTrk],t.currentPositionTrk.forEach((function(e){navigator.geolocation.clearWatch(e)})),t.currentPositionTrk=[]),t.parent.trackCenterButton&&t.parent.trackCenterButton.classList.add(Eb.Z.classes.HIDDEN)},_b.Z.wrap.control.Geolocation.prototype.activateSnapping=function(){var e=this;_b.Z.Util.detectMobile()||(e.olMap.on([Yb,zb],e._snapTrigger),e.parent.trackLayer.wrap.layer.on(Xb,e._postrenderTrigger))},_b.Z.wrap.control.Geolocation.prototype.deactivateSnapping=function(){var e=this;e.parent.map.wrap.getMap().then((function(t){_b.Z.Util.detectMobile()||(t.un([Yb,zb],e._snapTrigger),e.parent.trackLayer.wrap.layer.un(Xb,e._postrenderTrigger)),e.snapInfo&&t.removeOverlay(e.snapInfo),e.snapInfoElement&&(e.snapInfoElement.style.display="none"),e.snapLine&&(delete e.snapLine,t.render())}))},_b.Z.wrap.control.Geolocation.prototype.clear=function(e){e&&e.clearFeatures(),this.deactivateSnapping.call(this)},_b.Z.wrap.control.Geolocation.prototype.duringTrackSnap=function(e){const t=ol.render.getVectorContext(e);t&&this.snapLine&&("function"==typeof t.setFillStrokeStyle&&t.setFillStrokeStyle(null,new ol.style.Stroke({color:"rgba(197, 39, 55, 1)",width:1})),"function"==typeof t.drawGeometry&&t.drawGeometry(this.snapLine.wrap.feature.getGeometry()))},_b.Z.wrap.control.Geolocation.prototype.endSnap=function(){var e=this;e.parent.map.wrap.getMap().then((function(t){e.snapInfo&&t.removeOverlay(e.snapInfo),e.snapInfoElement&&(e.snapInfoElement.style.display="none"),e.snapLine&&delete e.snapLine}))},_b.Z.wrap.control.Geolocation.prototype.initSnap=function(e,t){var r=this;if(r.parent.trackLayer){var n=r.parent.trackLayer.wrap.layer.getSource().getClosestFeatureToCoordinate(e,(e=>{const t=e.getGeometry();return t instanceof ol.geom.LineString||t instanceof el}));if(null!==n){var i=n.getGeometry().getClosestPoint(e);r.parent.setSecondaryElevationProfileCoordinates(n.getGeometry().getCoordinates());const u=r.parent.map.getPixelFromCoordinate(i);if(Math.sqrt(Math.pow(t[0]-u[0],2)+Math.pow(t[1]-u[1],2))>r.parent.snappingTolerance)r.endSnap();else{var o=[e,[i[0],i[1]]];r.snapLine?r.snapLine.wrap.feature.getGeometry().setCoordinates(o):r.snapLine=new Tb.Z(o,{}),r.snapInfoElement||(r.snapInfoElement=document.getElementsByClassName("tc-ctl-geolocation-track-snap-info")[0]),r.snapInfoElement.style.display="block",r.snapInfo||(r.snapInfo=new ol.Overlay({element:r.snapInfoElement,offset:[5,18]}),r.olMap.addOverlay(r.snapInfo)),null==r.snapInfo.getMap()&&r.snapInfo.setMap(r.olMap),r.snapInfo.setPosition(e);var a={};const t=n.getGeometry().getType();"LineString"!=t&&"MultiLineString"!=t&&n.getKeys().indexOf("name")>-1&&(a.n=n.get("name"));var s=r.parent.map.options.locale&&r.parent.map.options.locale.replace("_","-")||void 0;a.x=r.map.wrap.isGeo()?i[0].toLocaleString(s,{minimumFractionDigits:5}):Math.round(i[0]).toLocaleString(s),a.y=r.map.wrap.isGeo()?i[1].toLocaleString(s,{minimumFractionDigits:5}):Math.round(i[1]).toLocaleString(s),r.map.wrap.isGeo()&&(a.isGeo=!0);var l=function(e){return i[e]?(Math.round(100*i[e])/100).toLocaleString(s):void 0},c=function(e){return i[e]>0?new Date(i[e]).toLocaleString(s):void 0};if(n.getGeometry().getLayout()===ol.geom.GeometryLayout.XYZM?(a.z=l(2),a.m=c(3)):n.getGeometry().getLayout()===ol.geom.GeometryLayout.XYZ?a.z=l(2):n.getGeometry().getLayout()===ol.geom.GeometryLayout.XYM&&(a.m=c(2)),a){if(r.parent.elevationChartData&&r.parent.elevationChartData.secondaryElevationProfileChartData[0]&&r.parent.elevationChartData.secondaryElevationProfileChartData[0].eleCoordinates){const t=_b.Z.wrap.Geometry.getNearest(e,r.parent.elevationChartData.secondaryElevationProfileChartData[0].eleCoordinates)[2];a.mdtz=(Math.round(100*t)/100).toLocaleString(s)}r.parent.getRenderedHtml(r.parent.CLASS+"-track-snapping-node",a,(function(e){r.snapInfoElement.innerHTML=e}))}}}}r.olMap.render()},_b.Z.wrap.control.Geolocation.prototype.drawTrackData=async function(e){const t=this,r=(new _b.Z.wrap.parser.JSON).parser.readFeatures(e.data);r.filter((function(e){return"linestring"===e.getGeometry().getType().toLowerCase()||"multilinestring"===e.getGeometry().getType().toLowerCase()})).forEach((function(t){t.getGeometry().setCoordinates(t.getGeometry().getCoordinates(),e.layout)})),t.activateSnapping.call(t),r.map((e=>_b.Z.wrap.Feature.createFeature(e))).forEach((function(e){e&&t.parent.trackLayer.addFeature(e)})),(!t.parent.toShare||t.parent.toShare&&t.parent.toShare.doZoom)&&t.parent.map.zoomToFeatures(t.parent.trackLayer.features)},_b.Z.wrap.control.Geolocation.prototype.formattedFromStorage=function(e){const t=this;if(t.parent.storageCrs!==t.parent.map.crs){var r=(new ol.format.GeoJSON).readFeatures(e);if(r)return r=r.map((function(e){var r=e.clone();return r.getGeometry().transform(t.parent.storageCrs,t.parent.map.crs),r.setId(e.getId()),r})),(new ol.format.GeoJSON).writeFeatures(r)}return e},_b.Z.wrap.control.Geolocation.prototype.formattedToStorage=function(e,t,r){var n=this,i=new _b.Z.wrap.parser.JSON;i=i.parser;var o,a=e.wrap.layer.getSource().getFeatures();return a=a.map((function(e){const i=e.getGeometry();if((i instanceof ol.geom.LineString||i instanceof ol.geom.MultiLineString)&&(o=i.getLayout()),t&&e.getProperties().tracking&&e.unset("tracking"),!r&&n.parent.map.crs!==n.parent.storageCrs){var a=e.clone();return a.getGeometry().transform(n.parent.map.crs,n.parent.storageCrs),a.setId(e.getId()),a}return e})).sort((function(e,t){return e.getGeometry()instanceof ol.geom.Point&&!(t.getGeometry()instanceof ol.geom.Point)?-1:t.getGeometry()instanceof ol.geom.Point&&!(e.getGeometry()instanceof ol.geom.Point)?2:e.getProperties().name<t.getProperties().name?-1:e.getProperties().name>t.getProperties().name?1:0})),{features:i.writeFeatures(a),layout:o}},_b.Z.wrap.control.Geolocation.prototype.export=function(e){const t=this;return new Promise((function(r,n){t.parent.getTrackData(e).then((function(i){if(i){var o=(new ol.format.GeoJSON).readFeatures(i.data);if(0===o.length){var a=t.parent.getTrackData(e);o=(new ol.format.GeoJSON).readFeatures(a)}r(o.map((e=>_b.Z.wrap.Feature.createFeature(e))))}else n()}))}))};var KC,XC,$C=function(e){var t=[],r=[];if(e.length>1){4===e[0].length&&(e=e.sort((function(e,t){return e[0][3]==t[0][3]?0:e[0][3]<t[0][3]?-1:1})));for(var n=0;n<e.length;n++){for(var i=e[n],o=-1,a=1/0,s=i.getLastCoordinate(),l=n+1;l<e.length;l++){var c=e[l].getFirstCoordinate(),u=Math.hypot(s[0]-c[0],s[1]-c[1]);u<a&&(o=l,a=u)}t.length<e.length&&(-1===t.indexOf(n)&&(t.push(n),r=r.concat(i.getCoordinates())),-1===t.indexOf(o)&&(t.push(o),r=r.concat(e[o].getCoordinates())))}return r}return e[0].getCoordinates()};_b.Z.wrap.control.Geolocation.prototype.processImportedFeatures=function(e){for(var t=this,r=t.parent.trackLayer.wrap.layer.getSource(),n=t.parent.importedFileName,i=[],o=[],a=[],s=[],l=r.getFeatures(),c=[],u=[],p=function(e){const t=e.getProperties();Object.prototype.hasOwnProperty.call(t,"name")&&t.name.trim().length>0?i.push(t.name):i.push(n)},h=0;h<l.length;h++){var d=l[h];d instanceof bb.Z&&(d=l[h].wrap.feature);const e=d.getGeometry();if(e instanceof ol.geom.Point){const t=e.getCoordinates();t.length>2&&t[3]>1e5&&t.splice(2,0,0),u.push(t),s.push(d)}else if(e instanceof ol.geom.LineString){p(d);const t=new ol.Feature({geometry:new ol.geom.LineString(e.getCoordinates(),e.getLayout())});t.setId(d.getId()||_b.Z.getUID()),t.setProperties(d.getProperties()),o.push(t),a.push(d)}else if(e instanceof ol.geom.MultiLineString){var f=d.clone();p(f);var g=f.getGeometry().getLineStrings();const t=$C(g),r=new ol.Feature({geometry:new ol.geom.LineString(t,e.getLayout())});r.setId(d.getId()||_b.Z.getUID()),r.setProperties(d.getProperties()),o.push(r),a.push(d)}}if(c.length>0){const e=$C(c);o.push(new ol.Feature({geometry:new ol.geom.LineString(e)}))}if(u.length>0&&s.length==l.length&&o.push(new ol.Feature({geometry:new ol.geom.LineString(u)})),a.length>0)for(var y=0;y<a.length;y++)r.removeFeature(a[y]);if(o.length>0){var m,v=0;(function(){const a=o.map((function(a,s){return new Promise((function(a,l){var c;m&&r.removeFeature(m),i.length>s&&(c=i[s],function(e,t){for(var r=[],n=e.indexOf(t);-1!==n;)if(r.push(n),n=e.indexOf(t,n+1),r.length>1)return!0;return r.length>1}(i,c)&&(c="["+(s+1)+"] "+c)),t.parent.importedFileName=c||n,m=o[s],r.addFeature(m),t.parent.saveTrack({message:t.parent.getLocaleString("geo.trk.upload.ok",{trackName:c||n}),importedFileName:c||n,notReproject:e.notReproject,fileHandle:e.fileHandle}).then((function(e){0===s&&(v=e),a()}))}))}));return Promise.all(a)})().then((function(){t.parent.trackLayer.setVisibility(!1),t.parent.trackLayer.clearFeatures(),t.parent.trigger(t.parent.const.event.IMPORTEDTRACK,{index:v}),delete t.parent.importedFileName,t.parent.getLoadingIndicator().removeWait(e.wait)}))}else t.parent.trackLayer&&(t.parent.map.removeLayer(t.parent.trackLayer),t.parent.trackLayer=void 0),delete t.parent.importedFileName,t.parent.getLoadingIndicator().removeWait(e.wait),_b.Z.alert(t.parent.getLocaleString("geo.trk.upload.error4"))},_b.Z.wrap.control.Geolocation.prototype.import=function(e,t,r){var n,i,o=this;if(t&&t.text){var a=o.parent.trackLayer.wrap.createVectorSource({data:t.text,type:r});n=a.source,i=n.on("change",(function(t){"ready"===n.getState()&&(ol.Observable.unByKey(i),o.processImportedFeatures(e))})),o.parent.trackLayer.wrap.layer.setSource(n)}else o.parent.trackLayer&&(o.parent.map.removeLayer(o.parent.trackLayer),o.parent.trackLayer=void 0),delete o.parent.importedFileName,o.parent.getLoadingIndicator().removeWait(e),_b.Z.alert(o.parent.getLocaleString("geo.trk.upload.error4"))},_b.Z.wrap.control.Geolocation.prototype.simulateTrackEnd=function(e){var t=this;e||(t.hasElevation=!0),t.parent.clearChartProgress(),t.simulateMarker&&(window.cancelAnimationFrame(KC),t.simulateMarker.layer.wrap.layer.getSource().getFeatures().length>0&&t.simulateMarker.layer.removeFeature(t.simulateMarker),delete t.simulateMarker)},_b.Z.wrap.control.Geolocation.prototype.simulateTrack=function(){for(var e,t=this,n=t.parent.trackLayer.wrap.layer.getSource().getFeatures(),i=0;i<n.length;i++){const t=n[i].getGeometry();if(t instanceof ol.geom.LineString){e=n[i].getGeometry().getCoordinates();break}t instanceof ol.geom.MultiLineString&&(e=t.getLineStrings().map((e=>e.getCoordinates())).flat())}if(e&&e.length>0){var o=e[0];(async function(){return t.simulateMarker?t.simulateMarker.setCoords(o.slice(0,2)):t.simulateMarker=await t.parent.trackLayer.addPoint(o.slice(0,2),{radius:7,fillColor:"#ff0000",fillOpacity:.5,strokeColor:"#ffffff",strokeWidth:2}),t.simulateMarker})().then((function(n){var i=function(){var r,n=!1;const i=function(e){return t.parent.map.crs!==t.parent.map.options.utmCrs?_b.Z.Util.reproject(e,t.parent.map.crs,t.parent.map.options.utmCrs):e};var o=e;if(4===o[0].length&&o[0][3]>0)r=o[0][3],n=!0;else{o[0][3]=Date.now();for(var a=1;a<o.length;a++){let e;o[a][3]=0,e=a+1<o.length?new ol.geom.LineString(i(o.slice(a-1,a+1))).getLength():new ol.geom.LineString(i(o.slice(a-1))).getLength(),o[a][3]=o[a-1][3]+36e5*e/t.parent.walkingSpeed}r=o[0][3]}var s=new ol.geom.LineString(o),l=r,c=0;c=t.parent.map.crs!==t.parent.map.options.utmCrs?new ol.geom.LineString(i(JSON.parse(JSON.stringify(o)))).getLength():s.getLength();var u=function(){if(!t.parent.simulate_paused){var e=s.getCoordinateAtM(l),r=function(e){for(var t=0;t<o.length;t++)if(o[t][3]>e)return{d:new ol.geom.LineString(i(o.slice(0,t))).getLength(),p:o[t-1].slice(0,2)}}(l);if(!e||!r){var a=t.parent.getSelectedTrackItem();return a&&t.parent.uiSimulate(!1,a),t.parent.hasElevation&&t.parent.clearChartProgress(),void t.simulateTrackEnd()}t.parent.hasElevation&&t.parent.setChartProgress(r,e,c,!!n&&t.parent.getTimeInterval(o[0][3],e[3])),t.simulateMarker&&t.simulateMarker.setCoords(e),1!==t.parent.simulationSpeed?l+=t.parent.delta*t.parent.simulationSpeed:l+=t.parent.delta}KC=requestAnimationFrame(u)};KC=requestAnimationFrame(u)};(async function(){return!!window.d3||await r.e(5327).then(r.t.bind(r,5327,23))})().then((function(){KC=requestAnimationFrame(i)}))}))}},_b.Z.wrap.control.Geolocation.prototype.headingChangehandler=function(e){var t=this;if(!t.parent.track.infoOnMap){t.parent.track.infoOnMap=document.createElement("div");const e=t.parent.track.infoOnMap.style;e.overFlowY="scroll",e.height="200px",e.width="200px",e.top="0",e.left="100px",e.backgroundColor="fuchsia",e.position="absolute",t.parent.map.div.appendChild(t.parent.track.infoOnMap)}t.parent.track.infoOnMap.style.display="",t.heading=e.target.getHeading(),t.parent.track.infoOnMap.innerHTML=t.parent.track.infoOnMap.innerHTML+"<br> <p> salta headingChangehandler </p> <br> <p> evt.target.getHeading(): "+t.heading+" </p>",t.map.wrap.getMap().then((function(e){e.getView().setRotation(-t.heading)})),t.parent.trigger(t.parent.const.event.STATEUPDATED,{moving:null!=t.heading&&t.heading>0})},_b.Z.wrap.control.Geolocation.prototype.orientationChangehandler=function(e){var t=this,r=t.map.wrap.map.getView(),n=r.getCenter(),i=r.getResolution(),o=e.target.getBeta()||0,a=e.target.getGamma()||0;n[0]-=i*a*25,n[1]+=i*o*25,r.setCenter(r.constrainCenter(n)),t.parent.trigger(t.parent.const.event.STATEUPDATED,{moving:null!=t.heading&&t.heading>0})},_b.Z.wrap.control.Geolocation.prototype.pulsate=function(e){this.pulsated=!0;var t,r=e.wrap.feature.getGeometry().getRadius(),n=(new Date).getTime();t=this.olMap.on(Xb,(function(i){var o=i.vectorContext,a=i.frameState,s=a.time-n,l=e.wrap.feature.getGeometry().clone(),c=function(e){switch(!0){case e<=50:return r;case e>50&&e<=100:return 1.02*r;case e>100&&e<=150:return 1.05*r;case e>150&&e<=200:return 1.02*r;case e>200&&e<=300:return r;case e>300&&e<=350:return 1.02*r;case e>350&&e<=400:return 1.05*r;case e>400&&e<=450:return 1.02*r;case e>450&&e<=500:return 1*r;default:return r}}(s);l.setRadius(c),o.setFillStrokeStyle(new ol.style.Fill({color:"rgba(0, 0, 0, 0.1)"}),new ol.style.Stroke({color:"rgba(255, 0, 0, .8)",width:1})),o.drawCircleGeometry(l),s>500?ol.Observable.unByKey(t):a.animate=!0}))},_b.Z.wrap.control.ResultsPanel.prototype.register=function(e){const t=this;t.map=e,e.wrap.getMap().then((function(e){t.olMap=e}))},_b.Z.wrap.control.ResultsPanel.prototype.showElevationMarker=function(e){const t=this,r=(e=e||{}).data,n=e.layer,i=e.coords;if(!t.elevationMarker){const e=document.createElement("div");e.style.display="none",e.classList.add(t.parent.CLASS+"-overlay","tc-elevation"),t.elevationMarker=new ol.Overlay({id:"ovElevationMarker",element:e,offset:[0,0],positioning:iC,stopEvent:!1})}if(!n||n.getVisibility()&&n.getOpacity()>0){let e=i[r[0].index];t.parent.map.crs!==t.parent.map.options.utmCrs&&(e=_b.Z.Util.reproject(e,t.map.options.utmCrs,t.map.crs)),t.elevationMarker.getElement().style.display="",t.olMap.getOverlayById(t.elevationMarker.getId())||(t.olMap.addOverlay(t.elevationMarker),t.map.on3DView&&t.map.view3D.addElevationMarker(e,t.parent)),t.elevationMarker.setPosition(e),t.map.on3DView&&t.map.view3D.setElevationMarker(e,t.parent)}},_b.Z.wrap.control.ResultsPanel.prototype.hideElevationMarker=function(){const e=this;e.elevationMarker&&(e.elevationMarker.getElement().style.display="none",e.map.on3DView&&e.map.view3D.hideElevationMarker(e.parent))},_b.Z.wrap.control.Coordinates.prototype.coordsActivate=async function(){var e=this;(e.olMap||await e.map.wrap.getMap()).on(Vb,e._coordsTrigger)},_b.Z.wrap.control.Coordinates.prototype.coordsDeactivate=function(){this.olMap.un(Vb,this._coordsTrigger)},_b.Z.wrap.Parser=function(){},_b.Z.wrap.Parser.prototype.read=function(e){var t=[];return this.parser&&(t=this.parser.readFeatures(e).map((function(e){return new bb.Z(null,{id:e.getId(),data:e.getProperties()})}))),t},_b.Z.wrap.Parser.prototype.readFeatures=function(e){var t=[];return this.parser&&(t=this.parser.readFeatures(e).map((function(e){let t=e.getGeometry().getCoordinates();const r={};let n;switch(e.getGeometry().getType()){case"LineString":n=new Tb.Z(t,r);break;case"Polygon":n=new Ab.Z(t,r);break;case"MultiPoint":n=new xb.Z(t,r);break;case"MultiLineString":n=new Ob.Z(t,r);break;case"MultiPolygon":n=new Ib.Z(t,r);break;default:n=new Cb.Z(t,r)}return n}))),t},_b.Z.wrap.parser={WFS:function(e){this.parser=new ol.format.WFS(e)},JSON:function(e){this.parser=new ol.format.GeoJSON(e)}},_b.Z.inherit(_b.Z.wrap.parser.WFS,_b.Z.wrap.Parser),_b.Z.inherit(_b.Z.wrap.parser.JSON,_b.Z.wrap.Parser),_b.Z.wrap.control.OverviewMap.prototype.register=async function(e){const t=this,n=await t.parent.layer.wrap.getLayer();t.ovMap=new ol.control.OverviewMap({target:t.parent.div,collapsed:!1,collapsible:!1,className:t.parent.CLASS+" ol-overviewmap",layers:[n]}),t.ovMap._wrap=t,t.ovMap.getOverviewMap().pixelRatio_=1,t.manageSize.call(t.ovMap.getOverviewMap()),t._boxElm=t.ovMap.boxOverlay_.getElement();const i=(await r.e(4982).then(r.t.bind(r,4982,23))).default;var o=t.ovMap.getOverviewMap();const a=new i(t._boxElm);a.positionDrag=function(){const e=this.element.style,t="translate3d( "+this.dragPoint.x+"px, "+this.dragPoint.y+"px, 0)";if(e.transform.length){const r=e.transform.indexOf("translate3d");if(r>=0){const n=e.transform.indexOf(")",r);e.transform=e.transform.replace(e.transform.substring(r,n+1),t)}else e.transform=t+" "+e.transform}else e.transform=t},a.on("pointerDown",(function(r){if(a.dragged=t._boxElm.cloneNode(),a.dragged.classList.add(Eb.Z.classes.ACTIVE),a.dragged.style.position="absolute",t._boxElm.insertAdjacentElement("beforebegin",a.dragged),e.maxExtent){var n=o.getPixelFromCoordinate([e.maxExtent[0],e.maxExtent[1]]),i=o.getPixelFromCoordinate([e.maxExtent[2],e.maxExtent[3]]),s=o.getSize();const t=document.createElement("div");t.style.position="absolute",t.style.bottom=Math.round(s[1]-n[1])+"px",t.style.left=Math.round(n[0])+"px",t.style.top=Math.round(i[1])+"px",t.style.right=Math.round(s[0]-i[0])+"px";const r=o.getViewport();r.insertBefore(t,r.firstElementChild),a.options.containment=t}})),a.on("pointerUp",(function(t){a.dragged.parentElement.removeChild(a.dragged),e.maxExtent&&(o.getViewport().removeChild(a.options.containment),a.options.containment=null)})),a.on("dragMove",(function(e,t,r){a._delta=r})),a.on("dragEnd",(function(r,n){var i=t.ovMap.getMap().getView(),s=o.getPixelFromCoordinate(i.getCenter()),l=o.getCoordinateFromPixel([s[0]+a._delta.x,s[1]+a._delta.y]),c=e.getExtent(),u=(c[2]-c[0])/2,p=(c[3]-c[1])/2;l[0]+u>e.maxExtent[2]?l[0]=e.maxExtent[2]-u:l[0]-u<e.maxExtent[0]&&(l[0]=e.maxExtent[0]+u),l[1]+p>e.maxExtent[3]?l[1]=e.maxExtent[3]-p:l[1]-p<e.maxExtent[1]&&(l[1]=e.maxExtent[1]+p),a.setPosition(0,0),delete a._delta,e.setCenter(l,{animate:!0})}));const s=await e.wrap.getMap();t.reset();const l=t.parent.div.querySelector("."+t.parent.CLASS+"-load");return n._wrap.$events.on(Eb.Z.event.BEFORETILELOAD,(function(){l.classList.remove(Eb.Z.classes.HIDDEN),l.classList.add(Eb.Z.classes.VISIBLE)})),n._wrap.$events.on(Eb.Z.event.TILELOAD,(function(){l.classList.remove(Eb.Z.classes.VISIBLE),l.classList.add(Eb.Z.classes.HIDDEN)})),s.addControl(t.ovMap),t.parent.isLoaded=!0,t.parent.trigger(Eb.Z.event.MAPLOAD),t},_b.Z.wrap.control.OverviewMap.prototype.reset=async function(e){const t=this,r=async function(e,r){if(e.type===Eb.Z.layerType.WMTS){var n={crs:r||t.parent.map.crs,oldCrs:e.wrap.layer.getSource().getProjection().getCode()};n.oldCrs!==n.crs&&e.setProjection(n)}const i=await e.wrap.getLayer();var o=new ol.View(CC(t.parent.map.wrap,i._wrap.parent));const a=t.ovMap.getOverviewMap();if((o.getResolutions()||o.getProjection().getCode()!==a.getView().getProjection().getCode())&&a.setView(o),i._wrap.$events.one(Eb.Z.event.TILELOAD,(function(){a.getLayers().getArray()[0].getSource().refresh()})),e!==t.parent.layer||-1===a.getLayers().getArray().indexOf(e)){t.parent.map.trigger(Eb.Z.event.OVERVIEWBASELAYERCHANGE,{oldLayer:e!==t.parent.layer?t.parent.layer:null,newLayer:e}),a.getLayers().forEach((function(e){(e instanceof ol.layer.Image||e instanceof ol.layer.Tile)&&a.removeLayer(e)}));const r=t.parent.div.querySelector("."+t.parent.CLASS+"-load");i._wrap.$events.on(Eb.Z.event.BEFORETILELOAD,(function(){r.classList.remove(Eb.Z.classes.HIDDEN),r.classList.add(Eb.Z.classes.VISIBLE)})),i._wrap.$events.on(Eb.Z.event.TILELOAD,(function(){r.classList.remove(Eb.Z.classes.VISIBLE),r.classList.add(Eb.Z.classes.HIDDEN)})),a.getLayers().insertAt(0,i)}return e};var n=(e=e||{}).layer||t.parent.layer;if(t.parent.map&&n&&t.ovMap){await n.getCapabilitiesPromise();var i=n;if(n.isCompatible(t.parent.map.crs)||0!==n.wrap.getCompatibleMatrixSets(t.parent.map.crs).length)return await r(n);if(n=n.getFallbackLayer()||t.parent.defaultLayer,await n.getCapabilitiesPromise(),t.parent.map.on3DView&&!n.isCompatible(t.parent.map.crs)){const e=await t.parent.map.loadProjections({crsList:i.getCompatibleCRS(),orderBy:"name"});return await r(i,e[0].code)}if(n.isCompatible(t.parent.map.crs))return await r(n)}return null},_b.Z.wrap.control.OverviewMap.prototype.get3DCameraLayer=function(){var e,t=this,r=null,n="3DCamera";if(t.ovMap&&((e=t.ovMap.getOverviewMap()).getLayers().forEach((function(e){e.get("id")===n&&(r=e)})),!r)){var i;const o={styles:{polygon:Object.assign({},null===(i=t.parent.map.options.styles)||void 0===i?void 0:i.polygon)}};let a=WC(o);Sb.Z.isFunction(a)&&(a=a()),a[0].getFill().setColor([0,0,0,0]),r=new ol.layer.Vector({id:n,source:new ol.source.Vector,style:a}),e.addLayer(r)}return r},_b.Z.wrap.control.OverviewMap.prototype.draw3DCamera=function(e){var t=this;if(this.parent.map.isLoaded){t.is3D=!!e;var r=t.get3DCameraLayer();if(r){var n,i=(e=e||{}).fov,o=r.getSource();if(i&&i.length){var a=o.getFeatures();a.length?n=a[0]:(n=new ol.Feature,o.addFeature(n)),n.setGeometry(new ol.geom.Polygon([i]))}else o.clear();var s="number"==typeof e.heading?e.heading:0;t._boxElm.style.transform="rotate("+s+"rad)"}}},_b.Z.wrap.control.OverviewMap.prototype.enable=function(){var e=this;if(e.parent.layer&&e.parent.layer.setVisibility){e.parent.layer.setVisibility(!0),e.parent.wrap.ovMap.getOverviewMap().updateSize();const t=document.createEvent("HTMLEvents");t.initEvent("resize",!1,!1),e.parent.map.div.dispatchEvent(t)}e.ovMap.resetExtent_(),e.ovMap.updateBox_()},_b.Z.wrap.control.OverviewMap.prototype.disable=function(){var e=this;e.parent.layer&&e.parent.layer.setVisibility&&e.parent.layer.setVisibility(!1)},_b.Z.wrap.control.OverviewMap.prototype.manageSize=function(){_b.Z.wrap.Map.prototype.manageSize.call(this)},_b.Z.wrap.control.FeatureInfo.prototype.register=function(e){var t=this;e.wrap.getMap().then((function(r){_b.Z.wrap.control.Click.prototype.register.call(t,e);var n=t._trigger;t._trigger=function(r){var i=n.call(t,r);return i?t.parent.beforeRequest({xy:r.pixel}):e.trigger(Eb.Z.event.NOFEATUREINFO,{control:t.parent}),i}}))};var JC=function(e){var t=e.innerHTML||e.textContent;return(XC=XC||document.createElement("textarea")).innerHTML=t,XC.value},QC={readFeatures:function(e){var t=[],r=(new DOMParser).parseFromString(e,"text/xml");if("FeatureInfoResponse"===r.documentElement.tagName)for(var n=r.documentElement.getElementsByTagName("FeatureInfoCollection"),i=0,o=n.length;i<o;i++)for(var a=n[i],s=a.getAttribute("layername"),l=a.getElementsByTagName("FeatureInfo"),c=0,u=l.length;c<u;c++){for(var p=l[c].getElementsByTagName("Field"),h={},d=0,f=p.length;d<f;d++){var g=p[d];h[JC(g.getElementsByTagName("FieldName")[0])]=JC(g.getElementsByTagName("FieldValue")[0])}var y=new ol.Feature(h);y.setId(s+"."+_b.Z.getUID()),t.push(y)}return t}},eL=function(e,t,r){var n=t.getPath(r);e.layers.push({name:r,title:n[n.length-1],path:n.slice(1),features:[],filter:t.filter})};_b.Z.wrap.control.FeatureInfo.prototype.getFeatureInfo=function(e,t,r){var n=this,i=r||{},o=n.parent.map;return new Promise((function(r,a){o.wrap.getMap().then((function(a){var s={},l={};const c=[],u=[],p=[];var h=[],d=a.getLayers().getArray();d=d.filter((function(e){return e instanceof ol.layer.Image&&e.getVisible()}));for(var f=0;f<d.length;f++){var g=d[f],y=g._wrap.parent;const e=g.getSource();if(e.getFeatureInfoUrl&&o.workLayers.indexOf(y)>=0&&y.names.length>0&&(!i.serviceUrl||i.serviceUrl===y.url)){let t;s[y.url]?(t=s[y.url],l[y.url].source.updateParams(_b.Z.Util.extend(l[y.url].source.getParams(),e.getParams()))):(t={url:y.url,layers:[],mapLayers:[],title:y.title,request:null},s[y.url]=t,l[y.url]={source:_b.Z.Util.extend(!0,{},e),layers:[]}),t.mapLayers.push(y);var m=y.getDisgregatedLayerNames();if(i.layerName)m.indexOf(i.layerName)>=0&&g._wrap.getInfo(i.layerName).queryable&&(eL(t,y,i.layerName),l[y.url].layers.push(i.layerName));else{for(var v=0;v<m.length;v++){var _=m[v];g._wrap.getInfo(_).queryable?eL(t,y,_):(_b.Z.Util.consoleRegister('Capa "'+m[v]+'" no queryable, la eliminamos de la peticin GFI'),m.splice(v,1),v-=1)}m.length>0&&(l[y.url].layers=l[y.url].layers.concat(m))}}}const w=function(e){return e&&(/<ogc:Filter.*<\/ogc:Filter>/.test(e)||e instanceof _b.Z.filter.Filter)};for(var S in s){h.push(s[S]);const r=s[S],n=l[S].source,i=l[S].layers;if(!i||0===i.length)continue;var E=n.getParams();E.filter&&(E.filter=r.layers.map((function(e){return"("+(w(e.filter)?e.filter instanceof _b.Z.filter.Filter?e.filter.getText():e.filter:"")+")"})).join("")),E.cql_filter&&(E.cql_filter=r.layers.map((function(e){return!e.filter||w(e.filter)?"INCLUDE":e.filter})).join(";")),n.params_.LAYERS=i.join(",");var b=n.getFeatureInfoUrl(e,t,o.crs,{QUERY_LAYERS:i.join(","),INFO_FORMAT:E.INFO_FORMAT,FEATURE_COUNT:1e3,radius:o.options.pixelTolerance,buffer:o.options.pixelTolerance}),C=b=b.replace(/sld_body=[a-zA-Z%0-9._]*/);const a={serviceUrl:S,requestedFormat:E.INFO_FORMAT,expandUrl:C};u.push(a),c.push(new Promise((function(e,t){const n=r.mapLayers[0];n.proxificationTool.fetch(b).then((function(t){n.proxificationTool.cacheHost.getAction(a.expandUrl).then((function(r){a.originalUrl=r.action.call(n.proxificationTool,a.expandUrl),e(_b.Z.Util.extend({},t,a))}))})).catch((function(e){t(Error(e))}))}))),_b.Z.Util.consoleRegister("Lanzamos GFI")}if(c.length>0)Promise.all(c).then((function(a){for(var l=!1,c=0,h=[],d=0;d<a.length;d++){var f,g=a[d],y=s[u[d].serviceUrl];l=!0,y.text=g.responseText;var m=g.contentType;if(m&&m.indexOf(";")>-1&&(m=m.substr(0,m.indexOf(";")).trim()),m||(m=g.requestedFormat),m===g.requestedFormat){switch(m){case"application/json":f=new ol.format.GeoJSON;break;case"application/vnd.ogc.gml":f=g.responseText.indexOf("FeatureCollection")>-1?new ol.format.WFS({gmlFormat:new ol.format.GML2({srsName:o.crs})}):new ol.format.WMSGetFeatureInfo;break;case"application/vnd.ogc.gml/3.1.1":f=new ol.format.GML3({srsName:o.crs});break;case"application/vnd.esri.wms_featureinfo_xml":f=QC;break;default:f=null}if(f){var v;try{v=f.readFeatures(g.responseText,{featureProjection:ol.proj.get(o.crs)})}catch(e){_b.Z.error(n.parent.getLocaleString("featureInfo.error.badResponse",{url:g.serviceUrl})+": "+e.message),v=[];continue}c+=v.length;for(var _=function(e,t,r){var n=!1;if(t===r)n=!0;else{var i=e.getNodePath(t),o=e.getNodePath(r);if(i.length>0&&o.length>=i.length){n=!0;for(var a=0;a<i.length;a++)if(e.wrap.getName(i[a])!==e.wrap.getName(o[a])){n=!1;break}}}return n},w={},S=0;S<v.length;S++){var E=v[S];if(E instanceof ol.Feature){for(var b,C=E.getId()||_b.Z.getUID(),L=!1,T=C.substr(0,C.lastIndexOf(".")),A=0;A<y.layers.length;A++){var x=y.layers[A],P=x.name.substr(x.name.indexOf(":")+1);if(y.mapLayers.some((e=>_(e,P,T)))){L=!0,i.featureId&&E.getId()!==i.featureId||(p.push(_b.Z.wrap.Feature.createFeature(E,{showsPopup:!1})),h.push(x.features));break}}if(!L)w[T]?b=w[T]:(b={name:T,title:T,path:[T],features:[]},w[T]=b,y.layers.push(b)),i.featureId&&E.getId()!==i.featureId||(p.push(_b.Z.wrap.Feature.createFeature(E,{showsPopup:!1})),h.push(b.features))}}}else{const e={name:"layer"+_b.Z.getUID(),title:"Datos en el punto",features:[{rawUrl:g.originalUrl,expandUrl:g.expandUrl,rawContent:g.responseText,rawFormat:m}]};y.layers.push(e),c+=1}}else _b.Z.Util.consoleRegister("Respuesta GFI: lo ms probable es que el servidor est devolviendo una excepcin"),_b.Z.Util.consoleRegister("Lanzamos los eventos que corresponde y mostramos tostada"),n.parent.responseError({message:g.responseText,status:g.status}),o.toast(n.parent.getLocaleString("featureInfo.error"),{type:Eb.Z.msgType.ERROR})}if(l){var O;p.forEach((function(t,r){for(var i in t.attributes=[],t.data){var o=t.data[i];"object"!=typeof o?t.attributes.push({name:i,value:"number"==typeof o?o.toLocaleString(_b.Z.Util.getMapLocale(n.parent.map)):o}):t.attributes.push({name:i,value:o})}!O&&_b.Z.Geometry.isInside(e,t.geometry)&&(O=t);const a=h[r];a.some((e=>e.id===t.id))||a.push(t)}));var I=[];for(let e in s)Object.prototype.hasOwnProperty.call(s,e)&&I.push(s[e]);n.parent.responseCallback({coords:e,resolution:t,services:I,featureCount:c,defaultFeature:O}),r()}else r()}),(function(i,a,l){if(h&&0===h.length)for(let e in s)h.push(s[e]);n.parent.responseCallback({coords:e,resolution:t,services:h,featureCount:0}),o.toast(n.parent.getLocaleString("featureInfo.error"),{type:Eb.Z.msgType.ERROR}),r()}));else{if(o.workLayers.filter((function(e){return e instanceof Db.Z})).length>0&&o.toast(n.parent.getLocaleString("featureInfo.notQueryableLayers"),{type:Eb.Z.msgType.INFO}),h&&0===h.length)for(let e in s)h.push(s[e]);o.on(Eb.Z.event.BEFOREFEATUREINFO,(function(){n.parent.responseCallback({coords:e,resolution:t,services:h,featureCount:0})})),n.parent.responseCallback({coords:e,resolution:t,services:h,featureCount:0}),r()}}))}))},_b.Z.wrap.control.GeometryFeatureInfo.prototype.register=function(e){var t=this;e.wrap.getMap().then((function(r){_b.Z.wrap.control.Click.prototype.register.call(t,e);var n=t._trigger;t._trigger=function(e){t.hasSuitableLayers().then((function(r){r&&(t.parent._isSearching||e.type!==zb||t.parent._isDrawing||t.parent._isSearching||n.call(t,e))}))}}))},_b.Z.wrap.control.GeometryFeatureInfo.prototype.hasSuitableLayers=async function(){const e=this.parent.map;var t=!1;return(await e.wrap.getMap()).getLayers().forEach((function(r){var n=r._wrap.parent;if(r.getSource().getFeatureInfoUrl&&e.workLayers.indexOf(n)>=0)return t=!0,!1})),t},_b.Z.wrap.control.GeometryFeatureInfo.prototype.beginDraw=function(e){var t=this,r=(e=e||{}).xy,n=e.layer||t.parent.filterLayer,i=e.callback,o=e.geometryType,a=!1;t.drawCtrl?(t.drawCtrl.setActive(!0),t.drawCtrl.startDrawing_(r)):n.wrap.getLayer().then((function(e){let n;if(o===Eb.Z.geom.POLYLINE)n=uC;else n=hC;const s=e.getStyle();t.drawCtrl=new ol.interaction.Draw({source:e.getSource(),type:n,style:function(e){return e&&e.getGeometry().getType()===n?_b.Z.Util.isFunction(s)?s(e):s:null}}),e.getSource().on($b,(function(e){_b.Z.wrap.Feature.createFeature(e.feature).showsPopup=!1})),t.drawCtrl.handleEvent=function(e){if(e.type===zb){var t=n===hC?this.sketchCoords_[0]:this.sketchCoords_;a&&2===t.length&&null!==this.sketchFeature_?this.addToDrawing_(e):a=!0}return ol.interaction.Draw.prototype.handleEvent.call(this,e)};const l=t.parent.map.wrap.map;l.addInteraction(t.drawCtrl),t.drawCtrl.on("drawstart",(function(e){t.parent._isDrawing=!0,l.getInteractions().forEach((function(e,t){e instanceof ol.interaction.DoubleClickZoom&&e.setActive(!1)}))})),t.drawCtrl.startDrawing_(r),t.drawCtrl.on("drawend",(function(r){t.parent._isDrawing=!1,l.getInteractions().forEach((function(e,t){e instanceof ol.interaction.DoubleClickZoom&&e.setActive(!1)})),l.removeInteraction(t.drawCtrl),this.setActive(!1),t.drawCtrl=null,e.getSource().clear(),t.parent._drawToken=!0,setTimeout((function(){t.parent._drawToken=!1}),500),r.feature.setId(t.parent.getUID());const n=_b.Z.wrap.Feature.createFeature(r.feature,{showsPopup:!1});t.parent.filterFeature=n,n.layer=t.parent.filterLayer,i&&i(n)}))}))},_b.Z.wrap.control.GeometryFeatureInfo.prototype.cancelDraw=function(e,t,r){var n=this;n.drawCtrl&&n.parent._isDrawing&&(n.parent._isDrawing=!1,n.drawCtrl.setActive(!1),n.drawCtrl.source_.clear())};var tL=function(e,t,r){var n,i=r;switch(i&&i.indexOf(";")>-1&&(i=i.substr(0,i.indexOf(";")).trim()),i||(i=t.requestedFormat),i){case"application/json":n=new ol.format.GeoJSON;break;case"application/vnd.ogc.gml":n=t.responseText.indexOf("FeatureCollection")>-1?new ol.format.WFS({gmlFormat:new ol.format.GML2({srsName:e.crs})}):new ol.format.WMSGetFeatureInfo;break;case"application/vnd.ogc.gml/3.1.1":n=new ol.format.GML3({srsName:e.crs});break;case"text/xml":case"application/xml":{const e=t.querySelector("ServiceException");e&&_b.Z.error(e),n=null;break}default:n=null}return n?n.readFeatures(t,{featureProjection:ol.proj.get(e.crs)}):null},rL=async function(e,t){const r=[];for(var n=[],i=function(e,t,r){var n=!1;if(t===r||0===t.indexOf(r))n=!0;else{var i=e.getPath(t),o=e.getPath(r);if(i.length>0&&o.length>=i.length){n=!0;for(var a=0;a<i.length;a++)if(i[a]!==o[a]){n=!1;break}}}return n},o={},a=0;a<e.length;a++){var s=e[a];if(s instanceof ol.Feature){for(var l,c=s.getId()||_b.Z.getUID(),u=!1,p=c.substr(0,c.lastIndexOf(".")),h=0;h<t.layers.length;h++){var d=t.layers[h],f=d.name.substr(d.name.indexOf(":")+1);if(t.mapLayers.some((e=>i(e,f,p)))){u=!0,r.push(_b.Z.wrap.Feature.createFeature(s)),n[s.id_]=d.features;break}}if(!u)o[p]?l=o[p]:(l={name:p,title:p,features:[]},o[p]=l,t.layers.push(l)),r.push(_b.Z.wrap.Feature.createFeature(s)),n.push(s.id_)}}return r.forEach((function(e){for(var t in e.attributes=[],e.data){var r=e.data[t];e.attributes.push({name:t,value:r})}n[e.id].push(e)})),{service:t}};_b.Z.wrap.control.GeometryFeatureInfo.prototype.getFeaturesByGeometry=function(e,t){var r=this;return new Promise((function(n,i){var o=r.parent.map;o.wrap.getMap().then((function(i){var a=e.wrap.feature.getGeometry(),s=a.stride,l=a.getFlatCoordinates();if(!t){for(var c=null,u=1,p=l.length;u<p;u+=s)(!c||c[1]<l[u])&&(c=[l[u-1],l[u]]);t=i.getPixelFromCoordinate(new ol.geom.Point(c).getCoordinates())}r.parent.beforeRequest({xy:t});var h=o.extractFeatures({filter:new _b.Z.filter.intersects(e,o.crs),outputFormat:Eb.Z.format.JSON});const d=[];Promise.all(h).then((function(e){for(var i=[],a=0,s=0;s<e.length;s++){const t=e[s];if(t){d.push(new Promise((function(e,n){if(t.errors&&t.errors.length){for(var i=0;i<t.errors.length;i++){var a,s=Eb.Z.msgType.WARNING,l=t.errors[i];switch(l.key){case Eb.Z.WFSErrors.MAX_NUM_FEATURES:a=r.parent.getLocaleString("wfs.tooManyFeatures",l.params);break;case Eb.Z.WFSErrors.GETCAPABILITIES:a=r.parent.getLocaleString("wfsGFI.inValidService",l.params);break;case Eb.Z.WFSErrors.NO_FEATURES:continue;case Eb.Z.WFSErrors.INDETERMINATE:a=r.parent.getLocaleString("wfs.IndeterminateError"),_b.Z.error("Error:{error} \r\n Descripcion:{descripcion} \r\n Servicio:{serviceName}".format({error:l.params.err,descripcion:l.params.errorThrown,serviceName:l.params.serviceTitle}),Eb.Z.msgErrorMode.CONSOLE),s=Eb.Z.msgType.ERROR;break;default:a=r.parent.getLocaleString("wfsGFI."+l.key,l.params)}o.toast(a,{type:s})}t.response||e()}})));var l=t.response?tL(o,t.response.responseText,t.response.contentType):[];d[d.length-1]=rL(l,t.service),t.service&&i.push(t.service),a+=l.length}}Promise.all(d).then((function(){r.parent.responseCallback({xy:t||null,services:i,featureCount:a}),n()}))}),(function(e){r.parent.responseCallback({}),n()}))}))}))},_b.Z.wrap.control.Popup.prototype=function(){this.popup=null},Eb.Z.event.PANANIMATIONSTART="pananimationstart.tc",Eb.Z.event.PANANIMATIONEND="pananimationend.tc",_b.Z.wrap.control.Popup.prototype.fitToView=function(){var e=this,t=e.parent.map,r=e.parent.map.wrap.map,n=e.parent.popupDiv.getBoundingClientRect(),i=t.div.getBoundingClientRect(),o=r.getCoordinateFromPixel([n.left-i.left,n.top-i.top]),a=r.getCoordinateFromPixel([n.right-i.left,n.bottom-i.top]);if(o){var s=o[0],l=o[1],c=a[0],u=[s,a[1],c,l],p=t.getExtent();if(!ol.extent.containsExtent(p,u)){var h={left:Math.max(p[0]-u[0],0),bottom:Math.max(p[1]-u[1],0),right:Math.max(u[2]-p[2],0),top:Math.max(u[3]-p[3],0)};if(e.parent.dragged){var d=e.popup.getPosition();h.right?d[0]=d[0]-h.right:h.left&&(d[0]=d[0]+h.left),h.top?d[1]=d[1]-h.top:h.bottom&&(d[1]=d[1]+h.bottom);var f=r.getPixelFromCoordinate(d);f[1]=r.getSize()[1]-f[1],e.parent._previousContainerPosition=f,(e.popup._oldUpdatePixelPosition||e.popup.updatePixelPosition).call(e.popup,d)}else if(e.parent.isVisible()){var g=r.getView(),y=g.getCenter().slice();h.top?y[1]+=h.top:h.bottom&&(y[1]-=h.bottom),h.right?y[0]+=h.right:h.left&&(y[0]-=h.left),g.animate({center:y,easing:function(t){return 0===t&&e.parent.map.trigger(Eb.Z.event.PANANIMATIONSTART),1===t&&e.parent.map.trigger(Eb.Z.event.PANANIMATIONEND),t}})}}}},_b.Z.wrap.control.Popup.prototype.setDragged=function(e){const t=this;var r=t.popup;if(e)r._oldUpdatePixelPosition||(r._oldUpdatePixelPosition=r.updatePixelPosition,r.updatePixelPosition=function(){}),r._newHandleOffsetChanged||(r._newHandleOffsetChanged=function(){r._oldUpdatePixelPosition()},t._offsetChangeListenerKey&&ol.events.unlistenByKey(t._offsetChangeListenerKey),t._offsetChangeListenerKey=ol.events.listen(r,"change:offset",r._newHandleOffsetChanged,r));else{const e=r.getElement().parentElement.style;e.setProperty("top",r.rendered.top_),e.setProperty("bottom",r.rendered.bottom_),e.setProperty("left",r.rendered.left_),e.setProperty("right",r.rendered.right_),delete t.parent._previousContainerPosition,r._oldUpdatePixelPosition&&(r.updatePixelPosition=r._oldUpdatePixelPosition,delete r._oldUpdatePixelPosition),r._newHandleOffsetChanged&&(t._offsetChangeListenerKey&&ol.events.unlistenByKey(t._offsetChangeListenerKey),t._offsetChangeListenerKey=ol.events.listen(r,"change:offset",r.handleOffsetChanged,r),delete r._newHandleOffsetChanged)}},_b.Z.wrap.Feature.prototype.getLegend=function(){var e=this,t={},r=aL(e.feature,!0);if(r){var n=r.getImage();if(n){if(n instanceof ol.style.Icon){t.src=n.getSrc();var i=n.getScale(),o=n.getImage();i?o.width?(t.width=o.width*i,t.height=o.height*i):t.scale=i:o.width&&(t.width=o.width,t.height=o.height)}else n instanceof ol.style.Circle&&(t.src=n.getImage().toDataURL());e.parent.options.radius?t.height=t.width=2*e.parent.options.radius:(t.width=t.width||e.parent.options.width,t.height=t.height||e.parent.options.height)}else{let n;switch(e.feature.getGeometry().getType()){case dC:case hC:n=Eb.Z.geom.POLYGON;break;case pC:case uC:n=Eb.Z.geom.POLYLINE;break;default:n=Eb.Z.geom.POINT}t.src=_b.Z.Util.getLegendImageFromStyle(zC(r),{geometryType:n})}}return t};const nL=function(e,t){const r=this;r.feature=new ol.Feature,r.parent.id&&r.feature.setId(r.parent.id),t.geometryName&&r.feature.setGeometryName(t.geometryName),r.feature._wrap=r,r.parent.setCoordinates(e),r.parent.setData(r.parent.data)};_b.Z.wrap.Feature.prototype.createPoint=function(e,t){const r=this;nL.call(r,e,t=t||{}),_b.Z.Util.hasStyleOptions(t)&&r.feature.setStyle(WC({styles:{point:t}},r.feature))},_b.Z.wrap.Feature.prototype.createMultiPoint=function(e,t){const r=this;nL.call(r,e,t=t||{}),_b.Z.Util.hasStyleOptions(t)&&r.feature.setStyle(WC({styles:{point:t}},r.feature))},_b.Z.wrap.Feature.prototype.createMarker=function(e,t){const r=this;t=t||{};var n=_b.Z.Util.getPointIconUrl(t);n?(t.url=n,nL.call(r,e,t),_b.Z.Util.hasStyleOptions(t)&&r.feature.setStyle(WC({styles:{marker:t}},r.feature))):r.createPoint(e,t)},_b.Z.wrap.Feature.prototype.createMultiMarker=function(e,t){const r=this;t=t||{};var n=_b.Z.Util.getPointIconUrl(t);n?(t.url=n,nL.call(r,e,t),_b.Z.Util.hasStyleOptions(t)&&r.feature.setStyle(WC({styles:{marker:t}},r.feature))):r.createMultiPoint(e,t)},_b.Z.wrap.Feature.prototype.createPolyline=function(e,t){const r=this;nL.call(r,e,t=t||{}),_b.Z.Util.hasStyleOptions(t)&&r.feature.setStyle(WC({styles:{line:t}},r.feature))},_b.Z.wrap.Feature.prototype.createPolygon=function(e,t){const r=this;nL.call(r,e,t=t||{}),_b.Z.Util.hasStyleOptions(t)&&r.feature.setStyle(WC({styles:{polygon:t}},r.feature))},_b.Z.wrap.Feature.prototype.createMultiPolyline=function(e,t){const r=this;nL.call(r,e,t=t||{}),_b.Z.Util.hasStyleOptions(t)&&r.feature.setStyle(WC({styles:{line:t}},r.feature))},_b.Z.wrap.Feature.prototype.createMultiPolygon=function(e,t){const r=this;nL.call(r,e,t=t||{}),_b.Z.Util.hasStyleOptions(t)&&r.feature.setStyle(WC({styles:{polygon:t}},r.feature))},_b.Z.wrap.Feature.prototype.createCircle=function(e,t){const r=this;nL.call(r,e,t=t||{}),t&&r.feature.setStyle(new ol.style.Style({stroke:new ol.style.Stroke({color:t.strokeColor,width:t.strokeWidth,lineDash:t.lineDash}),fill:new ol.style.Fill({color:bC(t.fillColor,t.fillOpacity)})}))},_b.Z.wrap.Feature.createFeature=function(e,t){if(!e._sitnaFeature){var r=e.getGeometry();(t=t||{}).id=e.getId();let a,s,l=e.getStyle();switch(l&&_b.Z.Util.extend(t,zC(l,e)),!0){case r instanceof ol.geom.Point:case r instanceof ol.geom.MultiPoint:_b.Z.Util.isFunction(l)&&(l=l(e));for(var n=l?Array.isArray(l)?l:[l]:[],i=0,o=n.length;i<o;i++)if(l=n[i],l.getImage()instanceof ol.style.Icon){a="Marker";break}a=a||"Point",r instanceof ol.geom.MultiPoint&&("Point"===a&&(a="MultiPoint"),"Marker"===a&&(a="MultiMarker"));break;case r instanceof ol.geom.LineString:a="Polyline";break;case r instanceof ol.geom.Polygon:a="Polygon";break;case r instanceof ol.geom.MultiLineString:a="MultiPolyline";break;case r instanceof ol.geom.MultiPolygon:a="MultiPolygon"}s=a?new Zb[a](e,t):new bb.Z(e,t),s.data=s.wrap.getData(),e._sitnaFeature=s}return e._sitnaFeature},_b.Z.wrap.Feature.prototype.cloneFeature=function(){return this.feature.clone()},_b.Z.wrap.Feature.prototype.getStyle=function(){var e=this,t={},r=e.feature.getStyle();_b.Z.Util.isFunction(r)&&(r=r(e.feature));var n=r?Array.isArray(r)?r:[r]:[];const i=function(e){return("0"+Number(e).toString(16)).slice(-2)},o=function(e,t){if(e){var r,n;const a=e.getFill()||(null===(r=e.getImage())||void 0===r||null===(n=r.getFill)||void 0===n?void 0:n.call(r));if(a){var o=a.getColor();t.fillColor="#"+i(o[0])+i(o[1])+i(o[2]),Array.isArray(o)&&(t.fillOpacity=o[3])}}},a=function(e,t){if(e){const r=e.getStroke();r&&(t.strokeColor=r.getColor(),t.strokeWidth=r.getWidth())}};for(var s=0,l=n.length;s<l;s++){o(r=n[s],t),a(r,t);const i=r.getImage();if(i instanceof ol.style.Icon){var c,u,p;(null===(c=e.parent.options)||void 0===c||!c.cssClass||null!==(u=e.parent.options)&&void 0!==u&&u.cssClass&&!_b.Z.Util.getBackgroundUrlFromCss(null===(p=e.parent.options)||void 0===p?void 0:p.cssClass))&&(t.url=i.getSrc());const r=i.getSize(),n=i.getScale()||1;r&&(t.width=r[0]*n,t.height=r[1]*n);const o=i.getRotation();o&&(t.rotation=180*o/Math.PI);var h=i.getAnchor();h&&(t.anchor=[h[0]*n,h[1]*n],r&&(t.anchor[0]=t.anchor[0]/t.width,t.anchor[1]=t.anchor[1]/t.height))}else o(i,t),a(i,t);var d=r.getText();if(d){t.label=d.getText();var f=d.getFont();f&&(t.fontSize=parseInt(f.match(/\d+pt/))||.75*parseInt(f.match(/\d+px/)),t.font=f);var g=d.getRotation();g&&(t.labelRotationKey=-180*g/Math.PI);var y=d.getScale();y&&(t.textScale=y);var m=d.getTextAlign();m&&(t.textAlign=m),t.labelOffset=[d.getOffsetX(),d.getOffsetY()];var v=d.getFill();v&&(t.fontColor=v.getColor());var _=d.getStroke();_&&(t.labelOutlineColor=_.getColor(),t.labelOutlineWidth=_.getWidth())}r._balloon&&r._balloon.getText()&&(t.balloon=r._balloon.getText())}return _b.Z.Util.extend(e.parent.options,t),e.feature3D&&(t=Object.assign(t,e.feature3D.getStyle())),t},_b.Z.wrap.Feature.prototype.getGeometry=function(){var e,t=this;if(t.feature&&t.feature.getGeometry){var r=t.feature.getGeometry();if(r)if(r instanceof ol.geom.Circle){const t=r.getCenter();e=[t,[t[0]+r.getRadius(),t[1]]]}else r.getCoordinates&&(e=r.getCoordinates())}return e},_b.Z.wrap.Feature.prototype.setGeometry=function(e){const t=this;if(t.feature&&t.feature.getGeometry){var r,n,i,o,a,s,l,c,u=t.feature.getGeometry();switch(!0){case t.parent instanceof Ib.Z:s=!0,r=ol.geom.MultiPolygon,a=e,Array.isArray(a)&&(o=e[0]);case t.parent instanceof Ab.Z||t.parent instanceof Ob.Z:l=!0,r=r||(t.parent instanceof Ab.Z?ol.geom.Polygon:ol.geom.MultiLineString),o=s?o:e,Array.isArray(o)&&(i=o[0]);case t.parent instanceof Tb.Z||t.parent instanceof xb.Z:c=!0,r=r||(t.parent instanceof Tb.Z?ol.geom.LineString:ol.geom.MultiPoint),i=l?i:e,Array.isArray(i)&&(n=i[0]);case t.parent instanceof Cb.Z:if(r=r||ol.geom.Point,n=c?n:e,Array.isArray(n)&&"number"==typeof n[0]&&"number"==typeof n[1]){let i;switch(n.length){case 3:i=ol.geom.GeometryLayout.XYZ;break;case 4:i=ol.geom.GeometryLayout.XYZM;break;default:i=ol.geom.GeometryLayout.XY}u?u.setCoordinates(e,i):(u=new r(e,i),t.feature.setGeometry(u))}break;case t.parent instanceof Rb.Z:{const r=Rb.Z.parseGeometry(e),n=r[0],i=r[1];let o;switch(n.length){case 3:o=ol.geom.GeometryLayout.XYZ;break;case 4:o=ol.geom.GeometryLayout.XYZM;break;default:o=ol.geom.GeometryLayout.XY}const a=Math.hypot(i[0]-n[0],i[1]-n[1]);u?u.setCenterAndRadius(n,a,o):(u=new ol.geom.Circle(n,a,o),t.feature.setGeometry(u));break}}}},_b.Z.wrap.Feature.prototype.getId=function(){var e;return this.feature&&(e=this.feature.getId()),e},_b.Z.wrap.Feature.prototype.setId=function(e){this.feature&&this.feature.setId(e)};const iL=function(e){let t=0;return e.forEach((function(e){const r=new ol.geom.Polygon([e]).getLinearRing(0);t+=ol.geom.flat.linearRingLength(r.flatCoordinates,0,r.flatCoordinates.length,r.stride)})),t},oL=function(e){return new ol.geom.LineString(e).getLength()};_b.Z.wrap.Feature.prototype.getLength=function(e){var t,r;const n=this;e=e||{};let i=0;if(n.feature3D&&null!==(t=n.parent)&&void 0!==t&&null!==(r=t.layer)&&void 0!==r&&r.map.on3DView)return n.parent.layer.map.view3D.getLength(n.feature3D);const o=n.feature.getGeometry(),a=e.coordinates||o.getCoordinates();switch(!0){case o instanceof ol.geom.Polygon:i=iL(a);break;case o instanceof ol.geom.LineString:i=oL(a);break;case o instanceof ol.geom.MultiPolygon:a.forEach((function(e){i+=iL(e)}));break;case o instanceof ol.geom.MultiLineString:a.forEach((function(e){i+=oL(e)}))}return i},_b.Z.wrap.Feature.prototype.getArea=function(e){var t,r;const n=this;if(e=e||{},n.feature3D&&null!==(t=n.parent)&&void 0!==t&&null!==(r=t.layer)&&void 0!==r&&r.map.on3DView)return n.parent.layer.map.view3D.getArea(n.feature3D);const i=n.feature.getGeometry();let o;if(i instanceof ol.geom.Polygon?o=ol.geom.Polygon:i instanceof ol.geom.MultiPolygon&&(o=ol.geom.MultiPolygon),o){return new o(e.coordinates||i.getCoordinates()).getArea()}return 0};const aL=function(e,t){var r=e.getStyle();return _b.Z.Util.isFunction(r)&&(r=r(e)),Array.isArray(r)&&(r=r.reduce((function(e,t){return e.fill_=t.fill_||e.fill_,e.image_=t.image_||e.image_,e.stroke_=t.stroke_||e.stroke_,e.text_=t.text_||e.text_,e}),new ol.style.Style)),r||t||(r=new ol.style.Style,e.setStyle(r)),r};_b.Z.wrap.Feature.prototype.setStyle=function(e){const t=this,r=t.feature;if(null===e)return void r.setStyle(null);const n=t.parent,i={styles:{}};i.styles[n.STYLETYPE]=e;let o=WC(i,r);if(r.setStyle(o),n.layer&&t.feature3D){let i=r._originalStyle||o;_b.Z.Util.isFunction(i)&&(i=i());const a=i.find((e=>e.getText()));n.layer.map.view3D.setStyle(t.feature3D,e),a&&n.layer.map.view3D.setLabel(t.feature3D,{outlineColor:"#FFFFFF",fontColor:a.getText().getFill().getColor().slice(0,3),outlineWidth:2,font:a.getText().getFont(),text:a.getText().getText()})}r._originalStyle&&(delete r._originalStyle,t.toggleSelectedStyle(!0)),r.changed()},_b.Z.wrap.Feature.prototype.toggleSelectedStyle=function(e){const t=this.feature;(void 0===e?!t._originalStyle:e)?pL(t):hL(t)},_b.Z.wrap.Feature.prototype.getInnerPoint=function(e){var t,r=e||{},n=this.feature.getGeometry();let i,o=!1;switch(t=n.getFirstCoordinate(),n.getType()){case dC:r.clipBox&&(n=new ol.geom.MultiPolygon(n.getPolygons().map((e=>_b.Z.Geometry.clipPolygon(e.getCoordinates(),r.clipBox))).filter((e=>e.length))),o=!0);var a=0;n=n.getPolygons().reduce((function(e,t){const r=t.getArea(),n=r>a?t:e;return a=r,n}));case hC:i=n.getCoordinates(),r.clipBox&&!o&&(i=_b.Z.Geometry.clipPolygon(i,r.clipBox)),t=(n=new ol.geom.Polygon(i)).getInteriorPoint().getCoordinates();for(var s=n.getLinearRings(),l=1;l<s.length;l++)if(_b.Z.Geometry.isInside(t,s[l].getCoordinates())){t=n.getClosestPoint(t);break}break;case pC:r.clipBox&&(n=new ol.geom.MultiLineString(n.getLineStrings().map((e=>_b.Z.Geometry.clipPolyline(e.getCoordinates(),r.clipBox))).filter((e=>e.length))),o=!0);var c=0;n=n.getLineStrings().reduce((function(e,t){const r=t.getLength(),n=r>c?t:e;return c=r,n}));case uC:var u=[0,0];i=n.getCoordinates(),r.clipBox&&!o&&(i=_b.Z.Geometry.clipPolyline(i,r.clipBox)),n=new ol.geom.LineString(i);for(l=0;l<i.length;l++)u[0]+=i[l][0],u[1]+=i[l][1];u[0]/=i.length,u[1]/=i.length,t=n.getClosestPoint(u)}return t},_b.Z.wrap.Feature.prototype.showPopup=function(e){const t=this,r=(e=e||{})&&e instanceof _b.Z.Control?e:e.control;var n=r.map;if(n){var i=t.feature;if(i){const f=t.parent;n.currentFeature=f;var o=n.getExtent();t._innerCentroid=t.getInnerPoint({clipBox:o}),r.contentDiv.innerHTML=e.html||t.parent.getInfo({locale:n.options.locale});var a,s=t.parent.options;if(_b.Z.Util.isEmptyObject(s)&&t.parent.layer&&t.parent.layer.styles)switch(!0){case f instanceof Cb.Z:(s=t.parent.layer.styles.point)&&!_b.Z.Util.isEmptyObject(s)||(s=t.parent.layer.styles.marker);break;case f instanceof Lb.Z:s=t.parent.layer.styles.marker;break;case f instanceof Rb.Z:case f instanceof Ib.Z:case f instanceof Ab.Z:s=t.parent.layer.styles.polygon;break;case f instanceof Ob.Z:case f instanceof Tb.Z:s=t.parent.layer.styles.line}if(s.anchor)a=GC(s.anchor,t.parent);else{for(var l,c=i._wrap.parent,u=0;u<n.workLayers.length;u++){var p=n.workLayers[u];if(!p.isRaster()&&p.features.indexOf(c)>=0){l=p.wrap.styleFunction(i);break}}if(Array.isArray(l)){var h;const e=null===(h=l[0])||void 0===h?void 0:h.getImage();a=!e||e instanceof ol.style.Icon?[.5,0]:[.5,.5]}}const g=[0,0];if(a)if(s.height)g[1]=-(GC(s.height,t.parent)||0)*a[1];else{var d=aL(i,!0);if(d){const e=d.getImage();if(e instanceof ol.style.Icon){const t=e.getImageSize();t&&(g[1]=t[1]*-e.getScale())}}}r.wrap.setDragged(!1),r.wrap.popup.setOffset(g),r.wrap.popup.setPosition(t._innerCentroid),r.popupDiv.classList.add(Eb.Z.classes.VISIBLE)}else n.wrap.hidePopup(r)}},_b.Z.wrap.Feature.prototype.isNative=function(e){return e instanceof ol.Feature},_b.Z.wrap.Feature.prototype.getPath=function(){var e=[],t=this;return t.feature&&t.feature._folders&&(e=t.feature._folders),e},_b.Z.wrap.Feature.prototype.getBounds=function(){var e=null;if(this.feature){const t=this.feature.getGeometry();if(!t)return null;e=t.getExtent()}return e},_b.Z.wrap.Feature.prototype.getTemplate=function(){var e=null,t=this,r=t.feature.getStyle();_b.Z.Util.isFunction(r)&&(r=r(t.feature)),r&&(r=Array.isArray(r)?r.find((e=>e._balloon)):r)&&r._balloon&&(e=r._balloon.getText());const n=t.feature.getProperties();return!e&&Object.prototype.hasOwnProperty.call(n,"description")&&(e=n.description),e},_b.Z.wrap.Feature.prototype.getData=function(){var e=this.feature.getProperties();Array.isArray(e.features)&&(e=1===e.features.length?e.features[0].getProperties():e.features.length+" elementos");var t=this.feature.getGeometryName();for(var r in e[t]&&delete e[t],e)if(e[r]&&e[r].getType)switch(e[r].getType()){case lC:case cC:case hC:case dC:case uC:case pC:e[r]=e[r].getCoordinates()}return e},_b.Z.wrap.Feature.prototype.setData=function(e){this.feature.setProperties(e)},_b.Z.wrap.Feature.prototype.unsetData=function(e){this.feature.unset(e)},_b.Z.wrap.Feature.prototype.clearData=function(){const e=this.feature,t=e.getGeometryName();e.getKeys().forEach((function(r){r!==t&&e.unset(r)}))},_b.Z.wrap.control.Draw.prototype.mouseMoveHandler=function(e){const t=this;t.sketch&&t.parent.trigger(Eb.Z.event.MEASUREPARTIAL,t.getMeasureData())},_b.Z.wrap.control.Draw.prototype.mouseOverHandler=function(e){const t=this;t.sketch&&t.hoverCoordinate&&(t.pushCoordinate(t.hoverCoordinate),t.hoverCoordinate=null)},_b.Z.wrap.control.Draw.prototype.clickHandler=function(e){const t=this;if(t.parent.map.view!==Eb.Z.view.PRINTING){if(t._mdPx){const r=t._mdPx[0]-e.clientX,n=t._mdPx[1]-e.clientY;if(r*r+n*n>t.interaction.squaredClickTolerance_)return}if(t.sketch){var r=t.sketch.getGeometry().getCoordinates();t.parent.trigger(Eb.Z.event.POINT,{point:r[r.length-1]})}}},_b.Z.wrap.control.Draw.prototype.pointerdownHandler=function(e){this._mdPx=[e.clientX,e.clientY]},_b.Z.wrap.control.Draw.prototype.getMeasureData=function(){const e=this,t=function(r,n){const i=new r.constructor(_b.Z.Util.reproject(r.getCoordinates(),e.parent.map.crs,e.parent.map.options.utmCrs));if(i.getLineStrings?n.length=i.getLineStrings().reduce(((e,t)=>e+t.getLength()),0):n.length=i.getLength(),e._extendedFeature){const i=e._extendedFeature.getGeometry();if(i!==r){const e={};t(i,e),e.length&&(n.length+=e.length)}}};var r={units:ol.proj.Units.METERS};if(this.sketch){var n=this.sketch.getGeometry();n instanceof ol.geom.Polygon?function(t,r){const n=new ol.geom.Polygon([_b.Z.Util.reproject(t.getLinearRing(0).getCoordinates(),e.parent.map.crs,e.parent.map.options.utmCrs)]);r.area=n.getArea();var i=n.getLinearRing(0);r.perimeter=ol.geom.flat.linearRingLength(i.flatCoordinates,0,i.flatCoordinates.length,i.stride)}(n,r):n instanceof ol.geom.LineString||n instanceof ol.geom.MultiLineString?t(n,r):n instanceof ol.geom.Point&&(r.coordinates=n.getCoordinates())}return r},_b.Z.wrap.control.Draw.prototype.getSketch=function(){const e=this;if(e.sketch){let t=e.sketch.getGeometry().clone();if(e._extendedFeature){const r=e._extendedFeature.getGeometry().clone();t=new t.constructor(t.getCoordinates(),r.getLayout()),r.appendLineString(t),t=r}return _b.Z.wrap.Feature.createFeature(new ol.Feature(t))}return null};_b.Z.wrap.control.Draw.prototype.activate=function(e){var t,r=this;switch(e){case Eb.Z.geom.POLYGON:t=hC;break;case Eb.Z.geom.MULTIPOLYGON:t=dC;break;case Eb.Z.geom.POINT:t=lC;break;case Eb.Z.geom.MULTIPOINT:t=cC;break;case Eb.Z.geom.MULTIPOLYLINE:t=pC;break;default:t=uC}r.parent.map&&Promise.all([r.parent.map.wrap.getMap(),r.parent.getLayer()]).then((function(n){const i=n[0],o=n[1];if(r.parent.map.on3DView)return r.interaction3D=new r.parent.map.view3D.UI.DrawControl(e,(function(e){return o.addFeature(e)})),r.setStyle(),r.interaction3D.activate(),void(r.redoStack=[]);o&&o.wrap.getLayer().then((function(n){if(r.viewport||(r.viewport=i.getViewport()),r.interaction&&(i.removeInteraction(r.interaction),r._pointerdownHandler&&(r.viewport.removeEventListener("pointerdown",r._pointerdownHandler),r._pointerdownHandler=null),r._clickHandler&&(r.viewport.removeEventListener("click",r._clickHandler),r._clickHandler=null),r._mouseMoveHandler&&r._mouseOverHandler&&(r.viewport.removeEventListener(Bb,r._mouseMoveHandler),r.viewport.removeEventListener(Gb,r._mouseOverHandler))),e){r._pointerdownHandler=r.pointerdownHandler.bind(r),r._clickHandler=r.clickHandler.bind(r),r.viewport.addEventListener("pointerdown",r._pointerdownHandler),r.viewport.addEventListener("click",r._clickHandler),r.parent.measurer&&(r._mouseMoveHandler=r.mouseMoveHandler.bind(r),r._mouseOverHandler=r.mouseOverHandler.bind(r),r.viewport.addEventListener(Bb,r._mouseMoveHandler),r.viewport.addEventListener(Gb,r._mouseOverHandler));var o={type:t,snapTolerance:0,condition:function(){if(ol.events.condition.shiftKeyOnly(arguments[0])){i.forEachFeatureAtPixel(i.getPixelFromCoordinate(arguments[0].coordinate),(function(e){return hC===e.getGeometry().getType()||dC===e.getGeometry().getType()?e:null}),{hitTolerance:fC})}return r.parent.map.view!==Eb.Z.view.PRINTING||null}};n&&(o.source=n.getSource()),e===Eb.Z.geom.RECTANGLE&&(o.type=uC,o.maxPoints=2,o.geometryFunction=function(e,t){const r=e[0],n=e[1],i=[[r,[r[0],n[1]],n,[n[0],r[1]],r]];return t?t.setCoordinates(i):t=new ol.geom.Polygon(i),t}),r.interaction=new ol.interaction.Draw(o),r.setStyle(),r.interaction.on("drawstart",(function(e){r.sketch=e.feature;const t={},n=r.parent.mode;if(r._extending)t.feature=r.interaction.sketchFeature_._sitnaFeature;else if(r.parent.extensibleSketch&&(n===Eb.Z.geom.POLYLINE||n===Eb.Z.geom.MULTIPOLYLINE)){const n=e.feature.getGeometry().getFirstCoordinate(),i=r.parent.layer.features.filter((e=>e instanceof Tb.Z||e instanceof Ob.Z)).find((e=>{const t=e.wrap.feature.getGeometry().getLastCoordinate();return n[0]===t[0]&&n[1]===t[1]}));if(i)return r._extendFeature(i),void(t.feature=i)}t.extending=r._extending,r.parent.trigger(Eb.Z.event.DRAWSTART,t)}),this),r.interaction.on("drawend",(function(e){if(!e.feature.getStyle()){const t=sL(r.parent.mode,r.parent.getStyle());e.feature.setStyle(WC(t))}r.parent.measurer&&r.parent.trigger(Eb.Z.event.MEASURE,r.getMeasureData());const t=function(e){r.parent.trigger(Eb.Z.event.DRAWEND,{feature:e}),r.sketch=null,r.interaction.setActive(!0)};if(r._extending&&r._extendedFeature){let i=r.sketch.getGeometry();const o=r._extendedFeature.getGeometry();i=new i.constructor(i.getCoordinates(),o.getLayout()),o.appendLineString(i);const a=r._extendedFeature._wrap.parent;a.setStyle(r.parent.getStyle()),a.geometry=o,n&&setTimeout((()=>{n.getSource().removeFeature(e.feature)}),100),t(a)}else{const e=_b.Z.wrap.Feature.createFeature(r.sketch);if(r.parent.mode===Eb.Z.geom.RECTANGLE){const n=400,i=r.interaction.getMap().getInteractions().getArray().find((e=>e instanceof ol.interaction.DoubleClickZoom));i&&i.getActive()&&(i.setActive(!1),setTimeout((function(){i.setActive(!0)}),n)),r.interaction.setActive(!1),setTimeout((()=>t(e)),n)}else t(e)}delete r._extendedFeature,delete r._extending}),this),r._projectionChangeHandler=function(e){!function(e,t){if(e.sketch){const n=t.oldValue.getProjection(),i=t.target.get(t.key).getProjection();if(n.getCode()!==i.getCode()){const t=e.sketch.getGeometry();t.transform(n,i),e.interaction.sketchPoint_.getGeometry().transform(n,i);const o=[];var r;r=e.parent.mode===Eb.Z.geom.POLYGON?e.interaction.sketchCoords_[0]:e.interaction.sketchCoords_,ol.geom.flat.deflateCoordinates(o,0,r,t.stride),ol.proj.getTransform(n,i)(o,o,t.stride),r=ol.geom.flat.inflateCoordinates(o,0,o.length,t.stride),e.parent.mode===Eb.Z.geom.POLYGON?e.interaction.sketchCoords_=[r]:e.interaction.sketchCoords_=r}}}(r,e)},i.on("change:view",r._projectionChangeHandler),i.addInteraction(r.interaction);let a=r.parent.snapping;const s=!a&&r.parent.extensibleSketch,l=e=>{const t=e.getGeometry();return t instanceof $s||t instanceof el};if(s&&(a=n.getSource().getFeatures().filter(l).map((e=>e._wrap.parent))),r.setSnapping(a),s){const e=r.snapInteraction;n.getSource().on("addfeature",(function(t){l(t.feature)&&r.snapInteraction===e&&r.snapInteraction.addFeature(t.feature)}))}}r.redoStack=[]}))}))},_b.Z.wrap.control.Draw.prototype.setSnapping=function(e){const t=this,r=t.parent.map.wrap.map;if(t.snapInteraction&&(r.removeInteraction(t.snapInteraction),t.snapInteraction=null),e){const n={};if(e instanceof Nt)n.source=e.wrap.layer.getSource();else if(Array.isArray(e))n.features=new Br(e.map((e=>{var t;return null===(t=e.wrap)||void 0===t?void 0:t.feature})));else{const e=t.parent.layer.wrap.layer;n.source=e.getSource()}t.snapInteraction=new ol.interaction.Snap(n),r.addInteraction(t.snapInteraction),t.setStyle()}},_b.Z.wrap.control.Draw.prototype.deactivate=function(){var e=this;e.parent.map&&(e.sketch=null,e.viewport&&(e._pointerdownHandler&&(e.viewport.removeEventListener("pointerdown",e._pointerdownHandler),e._pointerdownHandler=null),e._clickHandler&&(e.viewport.removeEventListener("click",e._clickHandler),e._clickHandler=null)),Promise.all([e.parent.map.wrap.getMap(),e.parent.getLayer()]).then((function(t){const r=t[0],n=t[1];n&&e.parent.singleSketch&&n.clearFeatures(),e.interaction&&(r.removeInteraction(e.interaction),e.interaction=null),e._projectionChangeHandler&&r.un("change:view",e._projectionChangeHandler)}))),e.interaction3D&&e.interaction3D.deactivate()},_b.Z.wrap.control.Draw.prototype._extendFeature=function(e){const t=this;t._extending=!0;const r=e.wrap.feature;e instanceof Tb.Z?(t.interaction.abortDrawing(),e.layer.removeFeature(e),t.interaction.extend(r)):t._extendedFeature=r},_b.Z.wrap.control.Draw.prototype.popCoordinate=function(){const e=this;if(e.parent.mode===Eb.Z.geom.RECTANGLE)throw Error("popCoordinate not allowed when drawing rectangles");var t=null;if(e.interaction){var r=e.interaction.sketchFeature_;if(r){var n,i=r.getGeometry();if(i instanceof ol.geom.Polygon?n=i.getCoordinates()[0]:i instanceof ol.geom.LineString&&(n=i.getCoordinates()),n.length>1){let c;i instanceof ol.geom.Polygon?c=e.interaction.sketchCoords_[0]:i instanceof ol.geom.LineString&&(c=e.interaction.sketchCoords_);var o,a=!1;if(e.interaction.sketchPoint_)for(var s=e.interaction.sketchPoint_.getGeometry().getCoordinates(),l=0;l<n.length;l++)if(n[l][0]==s[0]&&n[l][1]==s[1]){a=!0;break}t=c[o=a?c.length-2:c.length-1],c.splice(o,1),i instanceof ol.geom.Polygon?(i.setCoordinates([c]),e.interaction.sketchLine_.getGeometry().setCoordinates(c)):i.setCoordinates(c),r.setGeometry(i)}}}else e.interaction3D&&(t=e.interaction3D.popCoordinate());return t},_b.Z.wrap.control.Draw.prototype.pushCoordinate=function(e){var t=this,r=!1;if(t.interaction){var n=t.interaction.sketchFeature_;if(n){var i,o,a=n.getGeometry();a instanceof ol.geom.Polygon?i=a.getCoordinates()[0]:a instanceof ol.geom.LineString&&(i=a.getCoordinates()),a instanceof ol.geom.Polygon?o=t.interaction.sketchCoords_[0]:a instanceof ol.geom.LineString&&(o=t.interaction.sketchCoords_);var s=!1;if(t.interaction.sketchPoint_)for(var l=t.interaction.sketchPoint_.getGeometry().getCoordinates(),c=0;c<i.length;c++)if(i[c][0]==l[0]&&i[c][1]==l[1]){s=!0;break}let u;u=s?o.length-1:o.length,o.splice(u,0,e),a instanceof ol.geom.LineString?a.setCoordinates(o,ol.geom.GeometryLayout.XY):(a.setCoordinates([o],ol.geom.GeometryLayout.XY),t.interaction.sketchLine_.getGeometry().setCoordinates(o)),r=!0}}else t.interaction3D&&(t.interaction3D.pushCoordinate(e),r=!0);return r},_b.Z.wrap.control.Draw.prototype.undo=function(){var e=this,t=!1,r=e.popCoordinate();return r&&(e.redoStack.push(r),t=!0),e.parent.trigger(Eb.Z.event.MEASUREPARTIAL,e.getMeasureData()),t},_b.Z.wrap.control.Draw.prototype.redo=function(){var e=this,t=!1;return e.redoStack.length>0&&(e.pushCoordinate(e.redoStack.pop()),t=!0),e.parent.trigger(Eb.Z.event.MEASUREPARTIAL,e.getMeasureData()),t},_b.Z.wrap.control.Draw.prototype.end=function(){var e=this;e.interaction&&e.interaction.sketchFeature_?e.interaction.finishDrawing():e.interaction3D&&e.interaction3D.end()};const sL=function(e,t){const r={};switch(e){case Eb.Z.geom.POLYGON:case Eb.Z.geom.MULTIPOLYGON:r.styles={polygon:t,line:!1,point:!1};break;case Eb.Z.geom.POINT:case Eb.Z.geom.MULTIPOINT:r.styles={point:t,line:!1,polygon:!1};break;default:r.styles={line:t,point:!1,polygon:!1}}return r};_b.Z.wrap.control.Draw.prototype.setStyle=function(){const e=this;if(e.interaction){let r;const n=e.parent.getStyle();if(n){var t;const i=e.parent.mode,o=sL(i,n),a=WC(o);let s,l;if(null!==(t=e.parent.styles.snapping)&&void 0!==t&&t.point){if(e.parent.extensibleSketch&&(i===Eb.Z.geom.POLYLINE||i===Eb.Z.geom.MULTIPOLYLINE)){const t=WC({styles:Object.assign({},o.styles,{point:Object.assign({},e.parent.styles.snapping.point,{label:"+",fontSize:12,labelOffset:[8,-8]})})});l=r=>{if(!e.sketch&&e.parent.layer.wrap.layer.getSource().getFeatures().map((e=>e.getGeometry())).filter((e=>e instanceof ol.geom.LineString||e instanceof ol.geom.MultiLineString)).some((e=>{const t=e.getLastCoordinate();return r[0]===t[0]&&r[1]===t[1]})))return t}}if(e.parent.snapping||e.parent.extensibleSketch){const t=WC({styles:Object.assign({},o.styles,{point:Object.assign({},e.parent.styles.snapping.point)})});s=()=>t}(s||l)&&(r=function(){var t;if(null!==(t=e.snapInteraction)&&void 0!==t&&t._snapData){var r;const t=e.snapInteraction._snapData.vertex,n=(null===(r=l)||void 0===r?void 0:r(t))||s(t);if(n)return n}return a})}r||(r=a),e.interaction.overlay_.setStyle(r)}}else e.interaction3D&&e.interaction3D.setStyle(e.parent.getStyle())},_b.Z.wrap.control.Draw.prototype.setVisibility=function(e){const t=this;t.interaction&&t.interaction.getOverlay().setVisible(e),t.interaction3D&&t.interaction3D.visibility(e)},_b.Z.wrap.control.OfflineMapMaker.prototype.getRequestSchemas=function(e){for(var t=e.extent,r=e.layers,n=new Array(r.length),i=0,o=n.length;i<o;i++){var a=r[i],s={layerId:a.id,tileMatrixSet:a.matrixSet},l=a.wrap.layer.getSource();if(l.getUrls&&(s.url=l.getUrls()[0]),l.getTileGrid){for(var c=l.getTileGrid(),u=c.getResolutions(),p=c.getMatrixIds(),h=a.getLayerNodeByName(a.layerNames),d=null,f=0,g=h.TileMatrixSetLink.length;f<g;f++){var y=h.TileMatrixSetLink[f];if(y.TileMatrixSet===a.matrixSet){d=y.TileMatrixSetLimits;break}}s.tileMatrixLimits=[],u.forEach((function(e,r){var n=c.getOrigin(r),i=c.getTileSize(r),o=i*e,a={mId:p[r],res:e,origin:n,tSize:i,cl:Math.floor((t[0]-n[0])/o),cr:Math.floor((t[2]-n[0])/o),rt:Math.floor((n[1]-t[3])/o),rb:Math.floor((n[1]-t[1])/o)};if(d){var l=d[r];l&&(a.cl=Math.max(a.cl,l.MinTileCol),a.cr=Math.min(a.cr,l.MaxTileCol),a.rt=Math.max(a.rt,l.MinTileRow),a.rb=Math.min(a.rb,l.MaxTileRow))}a.cl<=a.cr&&a.rt<=a.rb&&s.tileMatrixLimits.push(a)}))}n[i]=s}return n},_b.Z.wrap.control.OfflineMapMaker.prototype.getGetTilePattern=function(e){var t="",r=e.wrap.layer.getSource();return r.getUrls&&(t=r.getUrls()[0]),e.options.encoding!==Eb.Z.WMTSEncoding.RESTFUL&&(t.indexOf("?")<0&&(t+="?"),t.indexOf("?")===t.length-1&&(t=t+"layer="+e.layerNames+"&style=default&tilematrixset="+encodeURIComponent(e.matrixSet)+"&Service=WMTS&Request=GetTile&Version=1.0.0&Format="+encodeURIComponent(e.format)+"&TileMatrix={TileMatrix}&TileCol={TileCol}&TileRow={TileRow}")),t};const lL=function(e){return new ol.style.Stroke({color:"#ffffff",width:e+4})},cL=function(e){return new ol.style.Stroke({color:"#000000",width:e+6})},uL=function(e){e||(e=[]),e instanceof ol.style.Style&&(e=[e]);const t=(e=e.slice())[0];if(t){const n=t.getImage();var r;if(n instanceof ol.style.RegularShape){r=n.getStroke().getWidth();const i=n.getRadius(),o=t.clone();o.setImage(new ol.style.Circle({radius:i,stroke:lL(r)})),e.unshift(o);const a=t.clone();a.setImage(new ol.style.Circle({radius:i,stroke:cL(r)})),e.unshift(a)}const i=t.getStroke();return i&&(r=i.getWidth(),e.unshift(new ol.style.Style({stroke:lL(r)})),e.unshift(new ol.style.Style({stroke:cL(r)}))),e}return null},pL=function(e){dL.call(e),e.changed()},hL=function(e){Object.prototype.hasOwnProperty.call(e,"_originalStyle")&&e._originalStyle&&e.setStyle(e._originalStyle),delete e._originalStyle},dL=function(){this.style_=function(e){var t;let r=e._originalStyle=e._originalStyle||e.getStyle();return!e._originalStyle&&e._wrap.parent.layer&&(r=e._originalStyle=e._wrap.parent.layer.wrap.layer.getStyle()),r||(r=e._originalStyle=WC({styles:{}},e)),_b.Z.Util.isFunction(r)?function(e,t){return uL(r(e,t)).map((e=>(e.setZIndex((e.getZIndex()||0)+1),e)))}:null===(t=uL(r))||void 0===t?void 0:t.map((e=>(e.setZIndex((e.getZIndex()||0)+1),e)))}(this),this.styleFunction_=this.style_?ol.Feature.createStyleFunction(this.style_):void 0};_b.Z.wrap.control.Modify.prototype.activate=function(){const e=this;e.parent.map&&Promise.all([e.parent.map.wrap.getMap(),e.parent.layer.wrap.getLayer()]).then((function(t){const r=t[0],n=t[1],i=e.parent.mode===_b.Z.control.Modify.mode.VERTEX_DELETE,o={layers:[n],hitTolerance:fC,style:null};e.selectInteraction&&(o.features=e.selectInteraction.getFeatures(),i&&(o.condition=da),r.removeInteraction(e.selectInteraction));var a=null;e.parent.map.on3DView?((a=e.selectInteraction||new e.parent.map.view3D.UI.SelectControl).activate(i),e.selectInteraction=a):(a=new ol.interaction.Select(o),e.selectInteraction=a,r.addInteraction(a));var s=function(e){return e._wrap.parent};a.on("select",(function(t){t.selected.length>0&&e.parent.trigger(Eb.Z.event.FEATURESSELECT,{ctrl:e,features:t.selected.map(s)}),t.deselected.length>0&&0===t.selected.length&&e.parent.trigger(Eb.Z.event.FEATURESUNSELECT,{ctrl:e.parent,features:t.deselected.map(s)})})),e.modifyInteraction&&r.removeInteraction(e.modifyInteraction);const l={features:a.getFeatures()};i&&(l.deleteCondition=pa);var c=new ol.interaction.Modify(l);if(i){let t;c.on("modifystart",(function(e){"click"===e.mapBrowserEvent.type&&(t=e.features.item(0).getRevision())})),c.on("modifyend",(function(r){"click"===r.mapBrowserEvent.type&&r.features.item(0).getRevision()===t&&e.parent.map.toast(e.parent.getLocaleString("verticesCannotBeDeleted"),{type:Eb.Z.msgType.ERROR})}))}if(e._modifiedGeometries=e._modifiedGeometries||new WeakMap,c.on("modifystart",(function(t){t.features.forEach((function(t){e._modifiedGeometries.set(t,t.getGeometry().getFlatCoordinates().slice())}))})),c.on("modifyend",(function(t){t.features.forEach((function(t){const r=t.getGeometry();if(r.stride>2){const i=e._modifiedGeometries.get(t);if(i){const e=r.getFlatCoordinates();if(i.length<=e.length)for(var n=0;n<e.length;n+=r.stride){const t=n+1;if(e[n]!==i[n]||e[t]!==i[t]){e[t+1]=0;break}}}}t._wrap.parent.geometry=t._wrap.getGeometry(),e.parent.trigger(Eb.Z.event.FEATUREMODIFY,{feature:t._wrap.parent,layer:e.parent.layer})}))})),e.modifyInteraction=c,r.addInteraction(c),e.snapInteraction&&r.removeInteraction(e.snapInteraction),e.parent.snapping){var u;if(e.snapInteraction=new ol.interaction.Snap({source:n.getSource()}),null!==(u=e.parent.styles.snapping)&&void 0!==u&&u.point){const t=WC({styles:Object.assign({point:Object.assign({},e.parent.styles.snapping.point)})}),r=function(){var r;return null!==(r=e.snapInteraction)&&void 0!==r&&r._snapData?t:null};e.modifyInteraction.getOverlay().setStyle(r)}r.addInteraction(e.snapInteraction)}e._onMouseMove||(e._onMouseMove=function(t){const n=r.getViewport();var i,o=r.getEventPixel(t);i=r.forEachFeatureAtPixel(o,(function(t,r){return!(!e.parent.layer||r!==e.parent.layer.wrap.layer)}),{hitTolerance:fC}),n.style.cursor=i?"pointer":""}),r.getViewport().addEventListener(Bb,e._onMouseMove)}))},_b.Z.wrap.control.Modify.prototype.deactivate=function(){const e=this;if(e.modifyInteraction){e.modifyInteraction.setActive(!1),e.selectInteraction.setActive(!1);const t=e.modifyInteraction.getMap();t.getViewport().removeEventListener(Bb,e._onMouseMove),t.removeInteraction(e.modifyInteraction),t.removeInteraction(e.selectInteraction),e.modifyInteraction=null,e.selectInteraction=null}},_b.Z.wrap.control.Modify.prototype.getSelectedFeatures=function(){var e=[];return this.selectInteraction&&this.selectInteraction.getFeatures().forEach((function(t){e.push(t._wrap.parent)})),e},_b.Z.wrap.control.Modify.prototype.setSelectedFeatures=function(e){var t=this;t.selectInteraction&&(t.selectInteraction.features_.clear(),t.selectInteraction.features_.extend(e.map((e=>e.wrap.feature))))},_b.Z.wrap.control.Modify.prototype.unselectFeatures=function(e){e=e||[];const t=this,r=t.selectInteraction?t.selectInteraction.getFeatures():null;if(r){const n=[];r.getArray().slice().forEach((function(t){(!e.length||e.indexOf(t)>=0)&&(r.remove(t),n.push(t._wrap.parent))})),n.length&&t.parent.trigger(Eb.Z.event.FEATURESUNSELECT,{features:n})}},_b.Z.wrap.control.Edit.prototype.cancel=function(e,t){var r=this;if(r.points=[],r.histPoints=[],r.selectInteraction){var n=r.selectInteraction.getFeatures();r.parent.trigger(Eb.Z.event.FEATURESUNSELECT,{ctrl:r.parent,feature:n.get(0)}),n.clear(),r.selectInteraction.setActive(!1)}},_b.Z.wrap.control.Edit.prototype.deleteFeatures=function(e){var t=this;if(Array.isArray(e)){var r=e.map((function(e){return e.wrap.feature}));t.parent.layer.wrap.getLayer().then((function(e){for(var n=t.selectInteraction?t.selectInteraction.getFeatures():null,i=0,o=r.length;i<o;i++){var a=r[i];n&&(n.remove(a),t.parent.trigger(Eb.Z.event.FEATURESUNSELECT,{feature:a._wrap.parent})),e.getSource().removeFeature(a),t.parent.trigger(Eb.Z.event.FEATUREREMOVE,{feature:a._wrap.parent})}}))}},_b.Z.wrap.Feature.prototype.toGML=function(e,t){var r=new ol.format.GML({srsName:t}).writeGeometryNode(this.feature.getGeometry()),n=r.querySelector("MultiSurface,MultiPolygon,Polygon");return n&&n.querySelectorAll("Polygon,LinearRing").forEach((e=>e.removeAttribute("srsName"))),r.firstChild.setAttribute("gml:id",r.firstChild.tagName+"."+_b.Z.getUID()),(new XMLSerializer).serializeToString(r.firstChild).replace(/\<\/?\w/gm,(function(e){var t=e.indexOf("/")>0?e.indexOf("/")+1:1;return e.substring(0,t)+"gml:"+e.substring(t)}))},_b.Z.wrap.Feature.prototype.toGeoJSON=function(){return(new ol.format.GeoJSON).writeGeometry(this.feature.getGeometry())},_b.Z.wrap.Geometry.write=function(e){var t;switch((e=e||{}).format,e.parser=new ol.format.GeoJSON,e.type){case Eb.Z.geom.POLYLINE:t=new ol.geom.LineString(e.coordinates);break;case Eb.Z.geom.POLYGON:t=new ol.geom.Polygon(e.coordinates);break;case Eb.Z.geom.MULTIPOINT:t=new ol.geom.MultiPoint(e.coordinates);break;case Eb.Z.geom.MULTIPOLYLINE:t=new ol.geom.MultiLineString(e.coordinates);break;case Eb.Z.geom.MULTIPOLYGON:t=new ol.geom.MultiPolygon(e.coordinates);break;case Eb.Z.geom.POINT:default:t=new ol.geom.Point(e.coordinates)}return e.parser.writeGeometry(t)},_b.Z.wrap.Geometry.toGeoJSON=function(e){return _b.Z.wrap.Geometry.write(e)};const fL=wb.Z},1446:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var n=r(688),i=r(268);n.Z.tool=n.Z.tool||{},n.Z.tool.ExcelExport=function(){this.stringifyField=function(e,t,r){return"string"==typeof e?(e=e.replace(/"/g,'""'),(r||e.indexOf(",")>-1||e.indexOf("\n")>-1||e.indexOf("\r")>-1)&&(e=t+e+t),e):"boolean"==typeof e?e?"TRUE":"FALSE":e},this.stringify=function(e,t){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n=String.fromCharCode,o=function(){try{document.createElement("$")}catch(e){return e}}();window.btoa||(window.btoa=function(e){for(var t,n,i,a,s,l,c=0,u=e.length,p=Math.max,h="";c<u;){if(p(t=e.charCodeAt(c++)||0,n=e.charCodeAt(c++)||0,l=e.charCodeAt(c++)||0)>255)throw o;i=(3&t)<<4|n>>4&15,a=(15&n)<<2|l>>6&3,s=63&l,n?l||(s=64):a=s=64,h+=r.charAt(t>>2&63)+r.charAt(i)+r.charAt(a)+r.charAt(s)}return h}),window.atob||(window.atob=function(e){var t,i,a,s,l,c=0,u=(e=e.replace(/=+$/,"")).length,p=[];if(u%4==1)throw o;for(;c<u;)t=(63&r.indexOf(e.charAt(c++)))<<2|(a=r.indexOf(e.charAt(c++)))>>4&3,i=(15&a)<<4|(s=r.indexOf(e.charAt(c++)))>>2&15,l=(3&s)<<6|63&r.indexOf(e.charAt(c++)),p.push(n(t)),i&&p.push(n(i)),l&&p.push(n(l));return p.join("")});var a=[];Array.isArray(e)?a=e:i.Z.isFunction(e)&&(a=e());const s=function(e,t){var r=t||"";if(e instanceof Array){r+="<table><tbody>";for(var n=0;n<e.length;n++)r+="<tr><td>"+s(e[n],t)+"</td></tr>";r+="</tbody></table>"}else if(e instanceof Object){for(var i in r+="<table><tbody>",e){const n=e[i];if(r+="<tr><th>"+i+"</th>",n instanceof Object)r+="<td>"+s(n,t)+"</td></tr>";else{var o=l(n);if(e[i]=o.value,r+='<td class="'+o.class+'">',!0===("string"==typeof n&&n.startsWith("http")))r+='<a href="'+unescape(encodeURIComponent(n))+'">Abrir</a>';else r+=n;r+="</td></tr>"}}r+="</tbody></table>"}else r+=e;return r},l=function(e){var t;if(null===e||"string"!=typeof e&&"number"!=typeof e)t=t instanceof Object?"":"string";else if(e.value&&(e=e.value),-1!==(""+e).indexOf("%"))e=e.replace(" %","%").replace(/\.|,/g,d),t="percent";else{var r=0;e&&(r="number"==typeof e?e:new Number(e.replace?e.replace(/\,/g,"").replace(/./g,".").trim():e.trim())),isNaN(r)?t=/^\d{1,2}([.\/-])\d{1,2}\1(\d{4}|\d{2})$/.test(e)||/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])[ ,T]{1}(2[0-3]|[01][0-9]):[0-5][0-9]:[0-5][0-9][Z]{0,1}$/.test(e)?"date":"string":(e=r.toString().replace(".",d),t=r%1>0?"number2d":"number")}return{class:t,value:e}};for(var c='<thead valign="top">',u=0;u<1;u++){for(var p in c+="<tr>",a[u])Object.prototype.hasOwnProperty.call(a[u],p)&&(c+="<th>"+a[u][p]+"</th>");c+="</tr>"}c+="</thead>",c+="<tbody>";let h=navigator.language.substring(0,5);var d;try{d=1.1.toLocaleString(h).substring(1,2),1e3.toLocaleString(h).substring(1,2)}catch(e){d=1.1.toLocaleString("es-ES").substring(1,2),1e3.toLocaleString("es-ES").substring(1,2)}for(u=1;u<a.length;u++){for(c+="<tr>",p=0;p<a[u].length;p++)if(Object.prototype.hasOwnProperty.call(a[u],p)){var f=a[u][p];const e=l(f);(f=e.value)instanceof Object?c+="<td>"+s(f)+"</td>":(c+='<td class="'+e.class+'"',f&&(Object.prototype.hasOwnProperty.call(f,"rowspan")||Object.prototype.hasOwnProperty.call(f,"colspan"))?(Object.prototype.hasOwnProperty.call(f,"rowspan")&&(c+=' valign="top" rowspan="'+f.rowspan+'">'+f.value+"</td>"),Object.prototype.hasOwnProperty.call(f,"colspan")&&(c+=' colspan="'+f.colspan+'">'+f.value+"</td>"),p++):c+=">"+(null==f?"":f)+"</td>")}c+="</tr>"}c+="</tbody>";var g='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name=ProgId content=Excel.Sheet><meta name=Generator content="Microsoft Excel 9">\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<style>';g+=","===d?'\x3c!--table{mso-displayed-decimal-separator:","; mso-displayed-thousand-separator:".";}':'\x3c!--table{mso-displayed-decimal-separator:"."; mso-displayed-thousand-separator:",";}',g+="body {visibility:hidden;}",g+='.number{mso-number-format:"#,##0";} .number2d{mso-number-format:"#,##0.00";} .percent{mso-number-format:0.00%;} ',g+='.date{mso-number-format:"dd/mm/yyyy";} .string{mso-number-format:"@";} caption{text-align:left;}--\x3e</style></head><body><table><caption>{caption}</caption>{table}</table></body></html>';var y,m={worksheet:t.workSheet||"Hoja1",table:c,caption:t.title||""};return y=m,g.replace(/{(\w+)}/g,(function(e,t){return y[t]}))}},n.Z.tool.ExcelExport.prototype.Save=function(e,t,r){const n=this.stringify(t,{txtDelim:'"',fieldSep:";",title:r||""});var i=new Blob([n],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(i,e);else{var o=document.createElement("a");if(void 0!==o.download){var a=URL.createObjectURL(i);o.setAttribute("href",a),o.setAttribute("download",e),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)}}};const o=n.Z.tool.ExcelExport},4676:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var n=r(688),i=r(330);n.Z.tool=n.Z.tool||{},n.Z.tool.Proxification=function(e,t){var r=this;if(r.Consts={url:{SPLIT_REGEX:/([^:]*:)?\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/}},void 0===e)throw new TypeError('"proxy" parameter is undefined',"TC.tool.Proxification.js");r.proxy="function"==typeof e?e:function(t){var r=e;return"http"!==t.substr(0,4)&&(r+=window.location.protocol),r+=encodeURIComponent(t)},t=t||{},r._location=t.location||window.location,r.preventMixedContent=void 0===t.allowedMixedContent||!t.allowedMixedContent},function(){window.fetch||function(e){if(!e.fetch){var t="URLSearchParams"in e,r="Symbol"in e&&"iterator"in Symbol,n="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),i="FormData"in e,o="ArrayBuffer"in e;if(o)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(e){return e&&Object.prototype.isPrototypeOf.call(DataView.prototype,e)},l=ArrayBuffer.isView||function(e){return e&&a.indexOf(Object.prototype.toString.call(e))>-1};f.prototype.append=function(e,t){e=p(e),t=h(t);var r=this.map[e];this.map[e]=r?r+","+t:t},f.prototype.delete=function(e){delete this.map[p(e)]},f.prototype.get=function(e){return e=p(e),this.has(e)?this.map[e]:null},f.prototype.has=function(e){return Object.prototype.hasOwnProperty.call(this.map,p(e))},f.prototype.set=function(e,t){this.map[p(e)]=h(t)},f.prototype.forEach=function(e,t){for(var r in this.map)Object.prototype.hasOwnProperty.call(this.map,r)&&e.call(t,this.map[r],r,this)},f.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),d(e)},f.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),d(e)},f.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),d(e)},r&&(f.prototype[Symbol.iterator]=f.prototype.entries);var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},_.call(w.prototype),_.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new f(this.headers),url:this.url})},E.error=function(){var e=new E(null,{status:0,statusText:""});return e.type="error",e};var u=[301,302,303,307,308];E.redirect=function(e,t){if(-1===u.indexOf(t))throw new RangeError("Invalid status code");return new E(null,{status:t,headers:{location:e}})},e.Headers=f,e.Request=w,e.Response=E,e.fetch=function(e,t){return new Promise((function(r,i){var o=new w(e,t);t=t||{};var a=new XMLHttpRequest;a.onload=function(){if(0===a.status)return new E(null,{status:a.status});var e={status:a.status,statusText:a.statusText,headers:(t=a.getAllResponseHeaders()||"",n=new f,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var t=e.split(":"),r=t.shift().trim();if(r){var i=t.join(":").trim();n.append(r,i)}})),n)};e.url="responseURL"in a?a.responseURL:e.headers.get("X-Request-URL");var t,n,i="response"in a?a.response:a.responseText;r(new E(i,e))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.open(o.method,o.url,!t.sync),"include"===o.credentials?a.withCredentials=!0:"omit"===o.credentials&&(a.withCredentials=!1),!t.sync&&"responseType"in a&&n&&(a.responseType="blob"),o.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),a.send(void 0===o._bodyInit?null:o._bodyInit)}))},e.fetch.polyfill=!0}function p(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function h(e){return"string"!=typeof e&&(e=String(e)),e}function d(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return r&&(t[Symbol.iterator]=function(){return t}),t}function f(e){this.map={},e instanceof f?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function g(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function y(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function m(e){var t=new FileReader,r=y(t);return t.readAsArrayBuffer(e),r}function v(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function _(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(n&&Object.prototype.isPrototypeOf.call(Blob.prototype,e))this._bodyBlob=e;else if(i&&Object.prototype.isPrototypeOf.call(FormData.prototype,e))this._bodyFormData=e;else if(t&&Object.prototype.isPrototypeOf.call(URLSearchParams.prototype,e))this._bodyText=e.toString();else if(o&&n&&s(e))this._bodyArrayBuffer=v(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!o||!Object.prototype.isPrototypeOf.call(ArrayBuffer.prototype,e)&&!l(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=v(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t&&Object.prototype.isPrototypeOf.call(URLSearchParams.prototype,e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},n&&(this.blob=function(){var e=g(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?g(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(m)}),this.text=function(){var e,t,r,n=g(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=y(t),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(S)}),this.json=function(){return this.text().then(JSON.parse)},this}function w(e,t){var r,n,i=(t=t||{}).body;if(e instanceof w){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new f(e.headers)),this.method=e.method,this.mode=e.mode,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new f(t.headers)),this.method=(r=t.method||this.method||"GET",n=r.toUpperCase(),c.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function S(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(i))}})),t}function E(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new f(t.headers),this.url=t.url||"",this._initBody(e)}}(this);var e=function(e){var t=document.createElement("a");if(t.href=e,!t.origin){if(!t.protocol||!t.hostname){var r=/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/.exec(t.href);if(t.protocol=r[1],r[4].indexOf(":")>-1){var n=r[4].split(":");t.hostname=n[0],t.port=n[1]}else t.hostname=r[4]}t.origin=(0===t.protocol.length?window.location.protocol:t.protocol)+"//"+t.hostname+(t.port&&e.indexOf(t.port)>-1?":"+t.port:"")}return t};var t=n.Z.tool.Proxification.prototype;t.cacheHost=new function(){var t=function(t){var r=e(t);return r?r.origin:null};this._hosts=[],this._hostsImage=[],this.is=function(e,r){var n=t(e);return null!==this.get(n,r)},this.get=function(e,t){if(0===this.getList(t).length)return null;var r=this.getList(t).filter((function(r){return r.key===e&&t.exportable==r.exportable}));return 0===r.length?null:r[0]},this.getList=function(e){return e.forImage?this._hostsImage:this._hosts},this.addKey=function(e,r){var n={key:t(e),action:null};return r.exportable&&(n.exportable=r.exportable),this.getList(r).push(n),this.getList(r)[this.getList(r).length-1]},this.removeKey=function(e,r){for(var n=t(e),i=0;i<this.getList(r).length;i++)if(this.getList(r)[i].key===n&&r.exportable==this.getList(r)[i].exportable){this.getList(r).splice(i,1);break}},this.getAction=function(e,r){r=r||{};var n=t(e),i=this.get(n,r);return i?i._actionPromise:Promise.reject(new Error("Cache null"))}},t._isServiceWorker=function(){return!!navigator.serviceWorker&&(!(!navigator.serviceWorker.controller||"activated"!==navigator.serviceWorker.controller.state)||(navigator.serviceWorker.ready.then((function(e){return!!e.active})).catch((()=>{console.log("Capturamos error que se produce en FF por configuracin del navegador.")})),!1))},t._isSameOrigin=function(e){var t=this,r=0!==e.indexOf("http")&&0!==e.indexOf("//"),n=!r&&e.match(t.Consts.url.SPLIT_REGEX);if(n){var i=n[1];r=(i==t._location.protocol||null==i)&&n[3]==t._location.hostname;var o=n[4],a=t._location.port;(80!=o&&""!==o||"80"!=a&&""!==a)&&(r=r&&o==a)}return r},t._isSameProtocol=function(e){const t=this;var r=/^(https?:\/\/)/i,n=e.match(r);if(n&&n.length>1){var i=t._location.match(r);if(i&&i.length>1)return n[0].trim()===i[0].trim()}return!1},t._isSecureURL=function(e){return!/^(f|ht)tps?:\/\//i.test(e)||/^(f|ht)tps:\/\//i.test(e)};const r=function(e,t,r){this.status=e,this.text=t,this.url=r};var o=function(t,r){var n=e(t);return t.replace(n.protocol,r)},a=function(e){return o(e,"https:")},s=function(e){return o(e,"http:")},l=function(e,t,r,n){var i=this;e=a(e),i._image.getImgTag(e,t).then((function(e){r(e,i._actionHTTPS)}),(function(o){o===i._image.ErrorType.PROTOCOL?n(o):u.call(i,s(e),t,r,n)}))},c=function(e,t,r,n){var i=this;e=s(e),i._image.getImgTag(e,t).then((function(e){r(e,i._actionHTTP)}),(function(o){o===i._image.ErrorType.PROTOCOL||o===i._image.ErrorType.UNEXPECTEDCONTENTTYPE?n(o):u.call(i,a(e),t,r,n)}))},u=function(e,t,r,n){var i=this;t.sameOrigin=i._isSameOrigin(i._actionProxy.call(i,e)),i._image.getImgTagByAction(e,t,i._actionProxy.bind(i)).then((function(e){r(e,i._actionProxy)}),(function(e){n(e)}))};t._actionDirect=function(e){return e},t._actionHTTP=function(e){return o(e,"http:")},t._actionHTTPS=function(e){return o(e,"https:")},t._actionProxy=function(e){return this.proxy(e)},t._image={ErrorType:{CORS:"cors",PROTOCOL:"protocol",NOTFOUNDED:"notfounded",UNEXPECTED:"unexpected",OFFLINE:"offline",UNEXPECTEDCONTENTTYPE:"Un_Expected_ContentType"},validContentType:["image/png","image/jpeg","image/tiff","image/gif","image/bmp","image/svg+xml","image/webp","image/avif"],checkHttpStatus:function(e){const r=this;return navigator.onLine?fetch(e,{credentials:"omit"}).then(t._fetch.validateContentType.bind(t,r.validContentType)).then((function(e){return{status:e.status,statusText:e.statusText}})).catch((function(e){return e.message===r.ErrorType.UNEXPECTEDCONTENTTYPE?e:{statusText:r.ErrorType.UNEXPECTED}})):Promise.reject({statusText:r.ErrorType.OFFLINE})},getImgTag:function(e,r){return new Promise(function(t,n){var i=this,o=document.createElement("img");r.exportable&&!r.sameOrigin&&(o.dataset.checkCORSHeaders=!0,o.crossOrigin="string"==typeof r.exportable?r.exportable:"anonymous"),o.onload=function(){if(console.log("Load OK: "+o.src),o.onload=o.onerror=void 0,r.exportable&&!r.sameOrigin){try{var e=function(e){var t=document.createElement("CANVAS"),r=t.getContext("2d");return t.height=e.height,t.width=e.width,r.drawImage(e,0,0),t}(o);e.toDataURL("image/png");t(o)}catch(e){18===e.code?n(i.ErrorType.CORS):t(o)}}else t(o)},o.onerror=function(t){console.log("Load crossOrigin ERROR: "+o.src),o.dataset.checkCORSHeaders?(o.crossOrigin=null,o.onerror=void 0,o.onerror=function(e){console.log("Load ERROR: "+o.src),i.checkHttpStatus(o.src).then((function(e){r.ignoreProxification||400===e.status?n(i.ErrorType.PROTOCOL):n(e)})).catch(n),o.onload=o.onerror=void 0},o.src=e):(console.log("Load ERROR: "+o.src),o.onload=o.onerror=void 0,i.checkHttpStatus(o.src).then((function(e){r.ignoreProxification||400===e.status?n(i.ErrorType.PROTOCOL):n(e)})).catch(n))};try{o.src=e}catch(e){console.log("Load ERROR: "+o.src),n(i.ErrorType.UNEXPECTED)}}.bind(t._image))},getImgTagByAction:function(e,r,n){return new Promise(function(t,i){var o=this,a=document.createElement("img");r.sameOrigin||r.exportable&&(a.crossOrigin="anonymous"),a.onload=function(){a.onload=a.onerror=void 0,t(a)},a.onerror=function(e){console.log("Load ERROR: "+a.src),a.onload=a.onerror=void 0,o.checkHttpStatus(a.src).then((function(e){r.ignoreProxification||400===e.status?i(o.ErrorType.PROTOCOL):i(e)})).catch(i)},a.src=n(e)}.bind(t._image))}},t._fetch={Headers:{CONTENTTYPE:"content-type",CONTENTDISPOSITION:"content-disposition"},ErrorType:{CORS:"cors",PROTOCOL:"protocol",NOTFOUNDED:"Not_Founded",UNEXPECTED:"Un_Expected",UNEXPECTEDCONTENTTYPE:"Un_Expected_ContentType"},validateResponse:function(e){if(!e.ok)throw new r(e.status,e.statusText,e.url);return e},validateContentType:function(e,t){const r=this;if(!e)return t;var n=t.headers.get(r._fetch.Headers.CONTENTTYPE);if(n&&-1===n.indexOf(e))throw Error(r._fetch.ErrorType.UNEXPECTEDCONTENTTYPE);return t}},t.fetchImage=function(e,t){var r=this;return(t=t||{}).forImage=!0,new Promise((function(n,i){if(r.cacheHost.is(e,t))r.cacheHost.getAction(e,t).then((function(o){t.sameOrigin=r._isSameOrigin(o.action(e)),r._image.getImgTagByAction(e,t,o.action).then((function(e){n(e)}),(function(e){i(e)}))})).catch((e=>i(e)));else{var o=r.cacheHost.addKey(e,t);o._actionPromise=new Promise((function(a,s){const p=function(e,i){o.action=i.bind(r),o.exportable=t.exportable,a({action:o.action}),n(e)},h=function(n){s(n),n.status,r.cacheHost.removeKey(e,t),i(n)};!function(t){r._isSameOrigin(e)?(t.sameOrigin=!0,r._image.getImgTag(e,t).then((function(e){p(e,r._actionDirect)}),h)):r._isSecureURL(e)?r._image.getImgTag(e,t).then((function(e){p(e,r._actionDirect)}),(function(n){t.exportable&&n===r._image.ErrorType.CORS||r._isServiceWorker()||r._isSecureURL(r._location)&&r.preventMixedContent?n===r._image.ErrorType.PROTOCOL&&t.ignoreProxification?h(n):u.call(r,e,t,p,h):c.call(r,e,t,p,h)})):r._isServiceWorker()||r._isSecureURL(r._location)&&r.preventMixedContent?l.call(r,e,t,p,h):r._image.getImgTag(e,t).then((function(e){p(e,r._actionDirect)}),(function(n){t.exportable&&n===r._image.ErrorType.CORS||!r._isSecureURL(r._location)?n===r._image.ErrorType.PROTOCOL&&t.ignoreProxification?h(n):u.call(r,e,t,p,h):l.call(r,e,t,p,h)}))}(t)}))}}))},t.fetchRetry=function(e,t,r){const n=this;var i=fetch;return t.sync&&(i=n.fetchSync),i(e,t).catch((function(i){if(1===r)throw i;return n.fetchRetry(e,t,r-1)}))},t.fetchSync=function(e,t){var r=this;return new Promise((function(n,i){"Symbol"in r&&Symbol;var o="FileReader"in r&&"Blob"in r&&function(){try{return new Blob,!0}catch(e){return!1}}();var a=new Request(e,t),s=new XMLHttpRequest;s.onload=function(){var e,t,r={status:s.status,statusText:s.statusText,headers:(e=s.getAllResponseHeaders()||"",t=new Headers,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();t.append(n,i)}})),t)};r.url="responseURL"in s?s.responseURL:r.headers.get("X-Request-URL");var i="response"in s?s.response:s.responseText;n(new Response(i,r))},s.onerror=function(){i(new TypeError("Network request failed"))},s.ontimeout=function(){i(new TypeError("Network request failed"))},s.open(a.method,a.url,!1),"include"===a.credentials?s.withCredentials=!t.sync:"omit"===a.credentials&&(s.withCredentials=!1),!t.sync&&"responseType"in s&&o&&(s.responseType="blob"),a.headers.forEach((function(e,t){s.setRequestHeader(t,e)})),s.send(void 0===a._bodyInit?null:a._bodyInit)}))},t.fetchXML=function(e,t){return(t=t||{}).responseType="xml",this.fetch(e,t)},t.fetchJSON=function(e,t){return(t=t||{}).responseType=i.Z.mimeType.JSON,this.fetch(e,t)},t.fetchBlob=function(e,t){return(t=t||{}).responseType="blob",this.fetch(e,t)},t.fetchImageAsBlob=function(e,t){return(t=t||{}).responseType="image",this.fetch(e,t)},t.fetch=function(t,r){const n=this;(r=r||{}).type&&(r.method=r.type,delete r.type),r.data&&(r.body=r.data,delete r.data),r.contentType&&(r.headers=new Headers,r.headers.append("Content-Type",r.contentType),delete r.contentType),r.responseType||(r.responseType="");var o=function(e,t,r,a){return(t.retryAttempts?n.fetchRetry(r[0].call(n,e),t,t.retryAttempts):fetch(r[0].call(n,e),t)).then(n._fetch.validateResponse).then(n._fetch.validateContentType.bind(n,t.responseType)).then((function(e){a&&(a.action=r[0].bind(n));const o=e.headers.get(n._fetch.Headers.CONTENTTYPE);if(t.nomanage)return Promise.resolve(e);const s=function(t){return e.blob().then((function(e){const r=new FileReader;return new Promise((function(n,i){r.addEventListener("error",(function(){r.abort(),i(new DOMException("Problem decoding"))})),r.addEventListener("loadend",(function(){n(r.result)})),r.readAsText(e,t)}))})).catch((function(e){throw e}))};let l;switch(!0){case t.responseType.indexOf("xml")>-1:case t.responseType.indexOf("text/xml")>-1:case t.responseType.indexOf(i.Z.mimeType.XML)>-1:return l=/charset=([^;]*)/i.exec(o),l&&2===l.length&&"UTF-8"!==l[1]?s(l[1]).then((function(e){return(new window.DOMParser).parseFromString(e,"text/xml")})).catch((function(e){throw e})):e.text().then((function(e){return(new window.DOMParser).parseFromString(e,"text/xml")})).catch((function(e){throw e}));case t.responseType.indexOf("arraybuffer")>-1:return e.arrayBuffer();case t.responseType.indexOf("image")>-1:case t.responseType.indexOf("blob")>-1:case t.responseType.indexOf("application/zip")>-1:case t.responseType.indexOf("application/x-zip-compressed")>-1:case t.responseType.indexOf("application/vnd.google-earth.kmz")>-1:case t.responseType.indexOf("application/octet-stream")>-1:case t.responseType.indexOf("application/geopackage+sqlite3")>-1:return e.blob().then((function(e){return new Blob([e],{type:o})})).catch((function(e){throw e}));case t.responseType.indexOf("document")>-1:throw new DeveloperError("Unhandled responseType: "+t.responseType);case t.responseType.indexOf(i.Z.mimeType.JSON)>-1:return e.json();case""==t.responseType:case t.responseType.indexOf("text")>-1:default:return l=/charset=([^;]*)/i.exec(o),l&&2===l.length&&"UTF-8"!==l[1]?s(l[1]).then((function(e){return""==t.responseType?{responseText:e,contentType:o}:e})).catch((function(e){throw e})):e.text().then((function(e){return""==t.responseType?{responseText:e,contentType:o}:e})).catch((function(e){throw e}))}})).catch((function(n){return 1===r.length||n.status&&500===n.status?(console.log("request failed",n),Promise.reject(n)):(r.shift(),o(e,t,r,a))}))};if(n.cacheHost.is(t,r))return new Promise((function(e,i){n.cacheHost.getAction(t,r).then((function(n){e(o(t,r,[n.action]))})).catch((function(o){!o.status||o.status>=400?i(o):e(n.fetch(t,r))}))}));var a=n.cacheHost.addKey(t,r);return new Promise((function(i,s){a._actionPromise=new Promise((function(l,c){t=e(t).href;const u=function(e){l({action:a.action}),i(e)},p=function(e){n.cacheHost.removeKey(t,r),c(e),s(e)};n._isSameOrigin(t)?o(t,r,[n._actionDirect,n._actionProxy],a).then(u).catch(p):n._isSecureURL(t)?n._isServiceWorker()?o(t,r,[n._actionDirect,n._actionProxy],a).then(u).catch(p):o(t,r,n._isSecureURL(n._location)?[n._actionDirect,n._actionProxy]:[n._actionDirect,n._actionHTTP,n._actionProxy],a).then(u).catch(p):n._isServiceWorker()?o(t,r,[n._actionHTTPS,n._actionProxy],a).then(u).catch(p):o(t,r,n._isSecureURL(n._location)?[n._actionHTTPS,n._actionProxy]:[n._actionDirect,n._actionHTTPS,n._actionProxy],a).then(u).catch(p)})),a._actionPromise.catch((function(e){!e.status||e.status>=400?s(e):i(n.fetch(t,r))}))}))},t.fetchFile=function(e,t){const r=this;return(t=t||{}).nomanage=!0,new Promise((function(n,i){r.fetch(e,t).then((function(t){const i=t.headers.get(r._fetch.Headers.CONTENTDISPOSITION);var o=new RegExp(/[\w|\-|\.]+.\w{1,}$/gi).exec(e)[0];if(i&&/(attachment);([^;]*)/gi.test(i))try{o=/filename\*?=\"?([\w|\-|\.]*\'\')?(.*\.\w*)\"?/gi.exec(i)[2]}catch(e){try{o=i.substring((i.lastIndexOf("'")||i.indexOf("="))+1)}catch(e){}}t.blob().then((function(e){n(new File([e],o,{type:t.headers.get(r._fetch.Headers.CONTENTTYPE)}))}))})).catch(i)}))}}();const o=n.Z.tool.Proxification},8288:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var n=r(688);n.Z.UI=n.Z.UI||{},function(){var e=function(e){return"[object Object]"===Object.prototype.toString.call(e)},t=function(){var e={},r=!1,n=0;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(r=arguments[0],n++);for(var i=function(n){for(var i in n)n.hasOwnProperty(i)&&(r&&"[object Object]"===Object.prototype.toString.call(n[i])?e[i]=t(e[i],n[i]):e[i]=n[i])};n<arguments.length;n++)i(arguments[n]);return e},r=function(t,r,n){var o=[];if(r)if(n.buildHTML)n.target.innerHTML=n.buildHTML({results:r});else{for(var a=0;a<r.length;a++){var s=r[a];e(s)?o.push(`<li><a href="${n.link}${encodeURIComponent(s.id)}">${s.label}</a></li>`):o.push(`<li><a href="${n.link}${encodeURIComponent(s)}">${s}</a></li>`)}var l=document.createElement("template");l.innerHTML=o.join(""),n.target.appendChild(l.content?l.content.firstChild:l.firstChild)}null!==n.callback&&"function"==typeof n.callback&&i(n),t.value.length>0?t.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")):t.dispatchEvent(new CustomEvent("targetCleared.autocomplete"))},i=function(e){e.target.querySelectorAll("li a").forEach((function(t){t.addEventListener("click",(function(t){t.stopPropagation(),t.preventDefault(),e.callback(t)}))}))},o=function(e,t){t.innerHTML="",e.dispatchEvent(new CustomEvent("targetCleared.autocomplete"))},a=function(t){var n,i,a,s,l=t.target,c=(l.getAttribute("id"),l.getAttribute("autocomplete"));if(c){var u=this.settings;c.openXHR;if((n=l.value).length<u.minLength)o(l,u.target);else if(Array.isArray(u.source))i=u.source.sort().filter((function(t){return s=u.matchFromStart?new RegExp("^"+n,"i"):new RegExp(n,"i"),a=e(t)?t.label:t,s.test(a)})),r(l,i,u);else if("function"==typeof u.source){if(arguments&&arguments[0]&&[37,39].indexOf(arguments[0].keyCode)>-1)return;u.source(n,(function(e){r(l,e,u)}))}}},s={init:function(e){var r=this,n={settings:null};n.settings=t({},n.defaults,e),r.setAttribute("autocomplete",!0);var i=n.settings;return r.removeEventListener("keyup",a),r.addEventListener("keyup",a),r.parentNode.querySelector(".ui-input-clear")&&r.parentNode.querySelector(".ui-input-clear").addEventListener("click",(function(e){o(r,i.target)})),r},update:function(e,r){return this.getAttribute("autocomplete")&&(this.settings=t(this.settings,r)),this},clear:function(e){return this.getAttribute("autocomplete")&&o(this,this.settings.target),this},destroy:function(){return this.getAttribute("autocomplete")&&(o(this,this.settings.target),this.removeAttribute("autocomplete"),this.removeEventListener("keyup",a)),this}};n.Z.UI.autocomplete=function(e){return s[e]?s[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void 0:(this.settings=arguments[0],s.init.apply(this,arguments))}}(n.Z);const i=n.Z.UI.autocomplete},4859:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>U});var n=r(688),i=r(330),o=r(8239),a=r(3048),s=r(6382),l=r(8683),c=r(1872),u=r(9529),p=r(5265),h=r(9180),d=r(4115),f=r(8197),g=r(1235),y=r(5516);function m(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function v(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}function _(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,S(e,t,"get"))}function w(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,S(e,t,"set"),r),r}function S(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}var E=new WeakMap,b=new WeakMap,C=new WeakMap,L=new WeakMap,T=new WeakMap,A=new WeakMap,x=new WeakMap,P=new WeakMap,O=new WeakMap,I=new WeakMap,R=new WeakMap,M=new WeakMap,D=new WeakMap;class N extends EventTarget{constructor(e,t,r){super(),v(this,E,{writable:!0,value:void 0}),v(this,b,{writable:!0,value:void 0}),v(this,C,{writable:!0,value:void 0}),v(this,L,{writable:!0,value:void 0}),v(this,T,{writable:!0,value:void 0}),v(this,A,{writable:!0,value:[]}),v(this,x,{writable:!0,value:void 0}),v(this,P,{writable:!0,value:void 0}),v(this,O,{writable:!0,value:void 0}),v(this,I,{writable:!0,value:0}),v(this,R,{writable:!0,value:[]}),v(this,M,{writable:!0,value:void 0}),m(this,"sketchPoints_",[]),v(this,D,{writable:!0,value:""}),m(this,"julianDate",new cesium.JulianDate),m(this,"drawingDataSource",new cesium.CustomDataSource("drawing")),m(this,"drawnDataSource",new cesium.CustomDataSource("drawn")),m(this,"minPointsStop",0),m(this,"moveEntity",!1),m(this,"vertexRemoveMode",!1),m(this,"entityForEdit",void 0),m(this,"ERROR_TYPES",{needMorePoints:"need_more_points"}),m(this,"editMode",!1),m(this,"onSelectEntity",null),w(this,E,e),w(this,D,t),_(this,E).dataSources.getByName("drawing").length>0?this.drawingDataSource=_(this,E).dataSources.getByName("drawing")[0]:_(this,E).dataSources.add(this.drawingDataSource),_(this,E).dataSources.getByName("drawn").length>0?this.drawnDataSource=_(this,E).dataSources.getByName("drawn")[0]:_(this,E).dataSources.add(this.drawnDataSource),w(this,b,null!=r&&r.strokeColor&&r.strokeColor instanceof cesium.Color?r.strokeColor:cesium.Color.fromCssColorString((null==r?void 0:r.strokeColor)||"rgba(255, 0, 0, 1)")),w(this,C,void 0!==(null==r?void 0:r.strokeWidth)?r.strokeWidth:2),w(this,L,null!=r&&r.fillColor&&r.fillColor instanceof cesium.Color?r.fillColor:cesium.Color.fromCssColorString((null==r?void 0:r.fillColor)||"rgba(0, 0, 0, 0.3)")),this.minPointsStop=!(null==r||!r.minPointsStop)}renderSceneIfTranslucent(){var e,t;null!==(e=_(this,E).scene.globe)&&void 0!==e&&null!==(t=e.translucency)&&void 0!==t&&t.enabled&&_(this,E).scene.render()}activate(){this.active(!0)}deactivate(){this.eventHandler_&&(this.active(!1),this.removeSketches())}popCoordinate(){return _(this,R).pop(),_(this,A).pop()}pushCoordinate(e){_(this,A).push(e)}end(){this.finishDrawing()}visibility(e){this.drawingDataSource.entities.show=e,this.drawnDataSource.entities.show=e}remove(e){this.drawnDataSource.entities.contains(e)&&(this.drawnDataSource.entities.remove(e),this.removeSketches(),_(this,E).scene.requestRender())}setLabel(e=null,t){(e=e||this.drawnDataSource.entities.values[this.drawnDataSource.entities.values.length-1]||this.drawingDataSource.entities.values[this.drawingDataSource.entities.values.length-1])&&(e.position||(e.position=cesium.BoundingSphere.fromPoints(e.polyline.positions.getValue()).center),e.label={outlineColor:cesium.Color.fromCssColorString(t.outlineColor),fillColor:cesium.Color.fromBytes.apply({},t.fontColor),outlineWidth:t.outlineWidth,font:t.font,text:t.text,style:cesium.LabelStyle.FILL_AND_OUTLINE,heightReference:cesium.HeightReference.CLAMP_TO_GROUND,pixelOffset:e.polyline?new cesium.Cartesian2(0,0):new cesium.Cartesian2(0,-25)},_(this,E).scene.requestRender())}moveLabel(e){e.label&&(e.position=cesium.BoundingSphere.fromPoints(_(this,A)).center)}getEntities(){var e,t,r,n;return[...(null===(e=_(this,E))||void 0===e||null===(t=e.entities)||void 0===t?void 0:t.values)||[],...(null===(r=_(this,E).drawnDataSource)||void 0===r||null===(n=r.entities)||void 0===n?void 0:n.values)||[]]}active(e){e?this.eventHandler_||(this.eventHandler_=new cesium.ScreenSpaceEventHandler(_(this,E).canvas),this.eventHandler_.setInputAction(this.onLeftClick_.bind(this),cesium.ScreenSpaceEventType.LEFT_CLICK),this.eventHandler_.setInputAction(this.onDoubleClick_.bind(this),cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),"point"===_(this,D)&&(this.tempPoint_=this.createProvisionalPoint_()),this.eventHandler_.setInputAction(this.onMouseMove_.bind(this),cesium.ScreenSpaceEventType.MOUSE_MOVE)):(this.entityForEdit&&this.deactivateEditing(),this.eventHandler_&&(this.eventHandler_.removeInputAction(cesium.ScreenSpaceEventType.LEFT_CLICK),this.eventHandler_.removeInputAction(cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this.eventHandler_.removeInputAction(cesium.ScreenSpaceEventType.MOUSE_MOVE),this.eventHandler_.destroy()),this.eventHandler_=void 0,this.tempPoint_&&(this.drawingDataSource.entities.remove(this.tempPoint_),this.tempPoint_=null,_(this,E).scene.requestRender())),this.dispatchEvent(new CustomEvent("statechanged",{detail:{active:e}}))}activeSelectMode(e){this.editMode=!0,this.onSelectEntity=e,this.eventHandler_=new cesium.ScreenSpaceEventHandler(_(this,E).canvas),this.eventHandler_.setInputAction(this.onEntityClick_.bind(this),cesium.ScreenSpaceEventType.LEFT_CLICK)}deactivateSelectMode(){this.eventHandler_.removeInputAction(cesium.ScreenSpaceEventType.LEFT_CLICK)}setStyle(e,t){t?(t.point&&(t.point.color=cesium.Color.fromCssColorString(e.fillColor).withAlpha(e.fillOpacity),t.point.pixelSize=e.strokeWidth+(t===this.entityForEdit?20:10),t.point.outlineWidth=e.strokeWidth,t.point.outlineColor=cesium.Color.fromCssColorString(e.strokeColor)),t.polyline&&(t.polyline.width=e.strokeWidth,t.polyline.material=cesium.Color.fromCssColorString(e.strokeColor)),t.polygon&&(t.polygon.material=cesium.Color.fromCssColorString(e.fillColor).withAlpha(e.fillOpacity))):(w(this,b,cesium.Color.fromCssColorString(e.strokeColor)),w(this,C,e.strokeWidth),e.fillColor&&w(this,L,cesium.Color.fromCssColorString(e.fillColor).withAlpha(e.fillOpacity)))}vertexRemove(e){e?(this.vertexRemoveMode=!0,this.sketchPoints_.filter(((e,t)=>t%2)).forEach((e=>{e.show=!1}))):(this.vertexRemoveMode=!1,this.sketchPoints_.forEach((e=>{e.show=!0})))}activateEditing(){var e,t,r,n,i;if(!this.eventHandler_||!this.entityForEdit)return;w(this,D,this.entityForEdit.polygon?"polygon":this.entityForEdit.polyline?"polyline":"point"),this.eventHandler_.setInputAction((e=>this.onLeftDown_(e)),cesium.ScreenSpaceEventType.LEFT_DOWN),this.eventHandler_.setInputAction((e=>this.onLeftUp_(e)),cesium.ScreenSpaceEventType.LEFT_UP),this.eventHandler_.setInputAction(this.onDragPoint_.bind(this),cesium.ScreenSpaceEventType.MOUSE_MOVE);const o=null===(e=this.entityForEdit.position)||void 0===e?void 0:e.getValue(this.julianDate);let a=[],s=!1;switch(_(this,D)){case"point":this.entityForEdit.position=new cesium.CallbackProperty((()=>_(this,A)[0]||o),!1),this.entityForEdit.point.pixelSize=2*this.entityForEdit.point.pixelSize;break;case"polyline":a=[...this.entityForEdit.polyline.positions.getValue(this.julianDate)],this.entityForEdit.polyline.positions=new cesium.CallbackProperty((()=>_(this,A)),!1),s=!0;break;case"polygon":a=[...null===(t=this.entityForEdit.polygon)||void 0===t||null===(r=t.hierarchy)||void 0===r?void 0:r.getValue(this.julianDate).positions],this.entityForEdit.polygon.hierarchy=new cesium.CallbackProperty((()=>new cesium.PolygonHierarchy(_(this,A))),!1),this.entityForEdit.polyline.positions=new cesium.CallbackProperty((()=>[..._(this,A),_(this,A)[0]]),!1),s=!0;break;case"rectangle":a=[...null===(n=this.entityForEdit.polygon)||void 0===n||null===(i=n.hierarchy)||void 0===i?void 0:i.getValue(this.julianDate).positions],this.entityForEdit.polygon.hierarchy=new cesium.CallbackProperty((()=>new cesium.PolygonHierarchy(_(this,A))),!1),this.drawingDataSource.entities.add({position:new cesium.CallbackProperty((()=>(a=_(this,A).length?_(this,A):a,cesium.Cartesian3.midpoint(a[0],a[1],new cesium.Cartesian3))),!1),billboard:{image:"./images/rotate-icon.svg",disableDepthTestDistance:Number.POSITIVE_INFINITY,heightReference:cesium.HeightReference.CLAMP_TO_GROUND},properties:{type:"rotate"}})}a.forEach(((e,t)=>{_(this,A).push(e)})),this.createSketchPoints_(a,s)}createSketchPoints_(e,t){if(e.forEach(((r,n)=>{const i=this.createSketchPoint_(r,{edit:!0,positionIndex:n});if(i.properties.index=n,this.sketchPoints_.push(i),t&&n+1<e.length){const t=this.halfwayPosition_(r,e[n+1]),i=this.createSketchPoint_(t,{edit:!0,virtual:!0});i.properties.index=n,this.sketchPoints_.push(i)}})),"polygon"===_(this,D)&&e.length>2){const t=e.length-1,r=this.halfwayPosition_(e[t],e[0]),n=this.createSketchPoint_(r,{edit:!0,virtual:!0});n.properties.index=t,this.sketchPoints_.push(n)}_(this,E).scene.requestRender()}deactivateEditing(){if(this.eventHandler_&&this.entityForEdit){switch(_(this,D)){case"polyline":this.entityForEdit.polyline.positions=_(this,A);break;case"point":this.entityForEdit.point.pixelSize=this.entityForEdit.point.pixelSize/2,this.entityForEdit.position=this.entityForEdit.position.getValue(this.julianDate);break;case"polygon":this.entityForEdit.polyline.positions=[..._(this,A),_(this,A)[0]],this.entityForEdit.polygon.hierarchy=new cesium.PolygonHierarchy(_(this,A))}_(this,E).scene.requestRender(),this.eventHandler_.removeInputAction(cesium.ScreenSpaceEventType.LEFT_DOWN),this.eventHandler_.removeInputAction(cesium.ScreenSpaceEventType.LEFT_UP),this.eventHandler_.removeInputAction(cesium.ScreenSpaceEventType.MOUSE_MOVE)}}finishDrawing(){let e,t=_(this,A);if(("polygon"===_(this,D)||"rectangle"===_(this,D))&&t.length<3)return void this.dispatchEvent(new CustomEvent("drawerror",{detail:{error:this.ERROR_TYPES.needMorePoints}}));if("point"===_(this,D))this.activePoint_&&t.push(this.activePoint_),e=this.drawShape_(this.activePoint_);else{if("polygon"===_(this,D)){const e=new cesium.EllipsoidGeodesic(cesium.Cartographic.fromCartesian(_(this,A)[_(this,A).length-1]),cesium.Cartographic.fromCartesian(_(this,A)[0]),cesium.Ellipsoid.WGS84).surfaceDistance;_(this,R).push(e/1e3)}e=this.drawShape_(_(this,A))}_(this,E).scene.requestRender();const r=this.getMeasurements(t,_(this,D));this.dispatchEvent(new CustomEvent("drawend",{detail:{positions:t,type:_(this,D),measurements:r,entity:e}})),this.removeSketches()}IsSketchEntity(e){return this.sketchPoint_&&this.sketchPoint_===e.id}CanIUseEntity(e){return!this.drawMode&&this.editMode&&(!this.entityForEdit&&this.drawnDataSource.entities.contains(e.id)||this.entityForEdit&&this.drawnDataSource.entities.contains(e.id)&&this.entityForEdit!=e.id||this.entityForEdit&&this.sketchPoints_.some((t=>t===e.id)))}removeSketches(e){this.drawingDataSource.entities.removeAll(),this.tempPoint_&&this.drawingDataSource.entities.add(this.tempPoint_),e&&this.drawnDataSource.entities.removeAll(),w(this,A,[]),this.activePoint_=void 0,this.sketchPoint_=void 0,this.activeDistance_=0,w(this,R,[]),this.entityForEdit=void 0,this.leftPressedPixel_=void 0,this.moveEntity=!1,this.sketchPoints_=[]}clear(){this.removeSketches()}createSketchPoint_(e,t){const r={position:e,point:{color:null!=t&&t.virtual?cesium.Color.GREY:cesium.Color.WHITE,outlineWidth:1,outlineColor:cesium.Color.BLACK,pixelSize:null!=t&&t.edit?9:5,heightReference:cesium.HeightReference.CLAMP_TO_GROUND},properties:{}};null!=t&&t.edit&&(r.point.disableDepthTestDistance=Number.POSITIVE_INFINITY);const n=this.drawingDataSource.entities.add(r);return null!=t&&t.virtual&&(n.properties.virtual=t.virtual),n}createProvisionalPoint_(){return this.drawingDataSource.entities.add({position:new cesium.Cartesian3,point:{color:new cesium.CallbackProperty((()=>_(this,L)),!1),outlineWidth:new cesium.CallbackProperty((()=>_(this,C)),!1),outlineColor:new cesium.CallbackProperty((()=>_(this,b)),!1),pixelSize:new cesium.CallbackProperty((()=>12-_(this,C)),!1)}})}createSketchLine_(e){return this.drawingDataSource.entities.add({polyline:{positions:e,clampToGround:!0,width:new cesium.CallbackProperty((()=>_(this,C)),!1),material:new cesium.ColorMaterialProperty(new cesium.CallbackProperty((()=>_(this,b)),!1))}})}drawShape_(e){return"point"===_(this,D)?this.drawnDataSource.entities.add({position:e,point:{color:_(this,L),pixelSize:12-_(this,C),outlineWidth:_(this,C),outlineColor:_(this,b)}}):"polyline"===_(this,D)?this.drawnDataSource.entities.add({polyline:{positions:e,clampToGround:!0,width:_(this,C),material:_(this,b)}}):"polygon"===_(this,D)||"rectangle"===_(this,D)?this.drawnDataSource.entities.add({polygon:{hierarchy:{positions:e},material:new cesium.ColorMaterialProperty(_(this,L)),clampToGround:!0},polyline:{positions:[...e,e[0]],clampToGround:!0,width:_(this,C),material:_(this,b)}}):void 0}dynamicSketLinePositions(){return new cesium.CallbackProperty((()=>{const e=[..._(this,A),this.activePoint_],t=e;return"rectangle"===_(this,D)&&4===e.length?[]:t.length>=3&&"polyline"!==_(this,D)?[...t,t[0]]:t}),!1)}updateSketchPoint(){if(!this.sketchPoint_)return;const e=[..._(this,A),this.activePoint_],t=e.length;if(t>1){let r;if("rectangle"===_(this,D)&&t>2){const t=e[1],n=e[2];r=cesium.Cartesian3.distance(t,n),this.sketchPoint_.position.setValue(n)}else{const n=e[t-1];r=new cesium.EllipsoidGeodesic(cesium.Cartographic.fromCartesian(e[t-2]),cesium.Cartographic.fromCartesian(n),cesium.Ellipsoid.WGS84).surfaceDistance}return w(this,I,r/1e3),void this.dispatchEvent(new CustomEvent("drawupdate",{detail:{positions:e,type:_(this,D),measurements:this.getMeasurements(e,_(this,D))}}))}}onLeftClick_(e){this.renderSceneIfTranslucent();const t=_(this,E).scene.globe.pick(_(this,E).camera.getPickRay(e.position),_(this,E).scene);if(t){if(this.sketchPoint_)this.sketchPoint_.position.setValue(t),_(this,R).includes(_(this,I))||_(this,R).push(_(this,I));else if(this.dispatchEvent(new CustomEvent("drawstart")),this.sketchPoint_=this.createSketchPoint_(t),this.activePoint_=t,this.createSketchLine_(this.dynamicSketLinePositions()),_(this,E).scene.requestRender(),"point"===_(this,D))return _(this,A).push(t),void this.finishDrawing();_(this,A).push(this.activePoint_);const e=this.minPointsStop&&("polygon"===_(this,D)&&3===_(this,A).length||"polyline"===_(this,D)&&2===_(this,A).length);("rectangle"===_(this,D)&&3===_(this,A).length||e)&&this.finishDrawing(),this.dispatchEvent(new CustomEvent("point",{detail:{position:t,position:t}}))}}onEntityClick_(e){if(!this.onSelectEntity)return;const t=_(this,E).scene.pick(e.position);cesium.defined(t)&&cesium.defined(t.id)&&this.drawnDataSource.entities.contains(t.id)?(this.entityForEdit&&this.entityForEdit!==t.id&&this.deactivateEditing(),this.entityForEdit=t.id,this.activateEditing(),this.onSelectEntity(t.id)):this.onSelectEntity(null)}updateRectCorner(e,t,r,n,i,o){let a=cesium.Cartesian3.subtract(e,n,new cesium.Cartesian3);a=cesium.Cartesian3.multiplyByScalar(a,i,new cesium.Cartesian3);const s=cesium.Cartesian3.add(r,a,new cesium.Cartesian3),l=cesium.Cartesian3.distance(e,t),c=cesium.Cartesian3.distance(s,t)/l;let u=cesium.Cartesian3.subtract(e,t,new cesium.Cartesian3);u=cesium.Cartesian3.multiplyByScalar(u,c,new cesium.Cartesian3);let p=cesium.Cartesian3.add(t,u,new cesium.Cartesian3);return o&&(u=cesium.Cartesian3.negate(u,new cesium.Cartesian3),p=cesium.Cartesian3.add(t,u,new cesium.Cartesian3)),p}rotateRectangle(e,t){const r=[..._(this,A)],n=cesium.Cartesian3.midpoint(r[0],r[2],new cesium.Cartesian3),i=Cartographic.fromCartesian(n),o=Cartographic.fromCartesian(t),a=Cartographic.fromCartesian(e),s=Math.PI+Math.atan2(o.longitude-i.longitude,o.latitude-i.latitude),l=Math.PI+Math.atan2(a.longitude-i.longitude,a.latitude-i.latitude)-s;r.forEach(((e,t)=>{const n=Cartographic.fromCartesian(e),o=Math.cos(l),a=Math.sin(l),s=o*(n.longitude-i.longitude)-a*(n.latitude-i.latitude)/Math.abs(Math.cos(i.latitude)),c=a*(n.longitude-i.longitude)*Math.abs(Math.cos(i.latitude))+o*(n.latitude-i.latitude),u=i.longitude+s,p=i.latitude+c;r[t]=Cartographic.toCartesian(new Cartographic(u,p))})),this.sketchPoints_.forEach(((e,t)=>{e.position=r[t],_(this,A)[t]=r[t]})),_(this,E).scene.requestRender()}onMouseMove_(e){this.renderSceneIfTranslucent();const t=_(this,E).scene.globe.pick(_(this,E).camera.getPickRay(e.endPosition),_(this,E).scene);t&&(this.sketchPoint_&&(this.sketchPoint_.position.setValue(t),this.activePoint_=t,this.updateSketchPoint()),this.tempPoint_&&this.tempPoint_.position.setValue(t),_(this,E).scene.requestRender())}onDragPoint_(e){this.renderSceneIfTranslucent();const t=_(this,E).scene.globe.pick(_(this,E).camera.getPickRay(e.endPosition),_(this,E).scene);if(t&&this.entityForEdit&&this.leftPressedPixel_&&this.moveEntity)if("point"===_(this,D))this.entityForEdit.position=t,w(this,A,[t]);else{var r;const e=null===(r=this.sketchPoint_)||void 0===r?void 0:r.properties,c=e.index;let u=new cesium.Cartesian3;if("number"==typeof c&&(this.sketchPoint_.position=t,u=_(this,A)[c],_(this,A)[c]=t),"polygon"===_(this,D)){var n,i;const e=null===(n=this.sketchPoint_)||void 0===n||null===(i=n.properties)||void 0===i?void 0:i.index,t=this.sketchPoints_.length,r=2*(t+e-1)%t,o=this.sketchPoints_[r],a=this.halfwayPosition_(o,this.sketchPoint_);this.sketchPoints_[r+1].position=a;const s=2*(t+e+1)%t,l=this.sketchPoints_[s],c=this.halfwayPosition_(l,this.sketchPoint_);this.sketchPoints_[2*e+1].position=c}if("polyline"===_(this,D)){var o,a;const e=null===(o=this.sketchPoint_)||void 0===o||null===(a=o.properties)||void 0===a?void 0:a.index;if(e>0){const t=this.sketchPoints_[2*(e-1)],r=this.halfwayPosition_(t,this.sketchPoint_);this.sketchPoints_[2*(e-1)+1].position=r}if(e<_(this,A).length-1){const t=this.sketchPoints_[2*(e+1)],r=this.halfwayPosition_(t,this.sketchPoint_);this.sketchPoints_[2*(e+1)-1].position=r}}else{const r=_(this,A);if("rectangle"===_(this,D)){if(e.type&&"rotate"===e.type.getValue()){var s,l;const e=null===(s=this.sketchPoint_)||void 0===s||null===(l=s.position)||void 0===l?void 0:l.getValue(this.julianDate);return void this.rotateRectangle(e,t)}const n=c>1?c-2:c+2,i=c-1<0?3:c-1,o=c+1>3?0:c+1;let a=r[c];const p=r[n];let h=r[i],d=r[o];const f=cesium.Cartesian3.midpoint(a,p,new cesium.Cartesian3),g=cesium.Cartesian3.midpoint(u,p,new cesium.Cartesian3),y=cesium.Cartesian3.distance(a,f)/cesium.Cartesian3.distance(u,g),m=this.checkForNegateMove(a,p,h,d);h=this.updateRectCorner(h,p,f,g,y,m.left),d=this.updateRectCorner(d,p,f,g,y,m.right),a=this.getCorrectRectCorner(a,p,h,d),a=this.getCorrectRectCorner(a,p,d,h),r[c]=a,_(this,A)[c]=a,r[i]=h,r[o]=d,this.sketchPoints_.forEach(((e,t)=>{e.position=r[t]}))}}}}onDoubleClick_(){_(this,R).includes(_(this,I))||_(this,R).push(_(this,I)),_(this,A).pop(),this.finishDrawing()}onLeftDown_(e){if(this.leftPressedPixel_=e.position,this.entityForEdit){const n=_(this,E).scene.drillPick(e.position,5,5,5);if(n.length)if(this.vertexRemoveMode&&this.sketchPoints_.includes(n[0].id)){if("polygon"===_(this,D)&&_(this,A).length<=3||"polyline"===_(this,D)&&_(this,A).length<=2)return void this.dispatchEvent(new CustomEvent("drawerror",{detail:{error:this.ERROR_TYPES.needMorePoints}}));const e=this.sketchPoints_.filter(((e,t)=>!(t%2))).indexOf(n[0].id),t=this.sketchPoints_.indexOf(n[0].id),r=this.sketchPoints_[t-1]||this.sketchPoints_[t+1],i=this.sketchPoints_[t+1]||this.sketchPoints_[t-1];r!==i&&(r.position=this.halfwayPosition_(_(this,A)[(0===e?e.length:e)-1],_(this,A)[e===_(this,A).length-1?0:e+1])),this.sketchPoints_.splice(this.sketchPoints_.indexOf(i),1),this.sketchPoints_.splice(t,1),this.drawingDataSource.entities.remove(i),this.drawingDataSource.entities.remove(n[0].id),this.removeVertexToPolylineOrPolygon_(e),this.sketchPoints_.filter((e=>!e.properties.virtual)).forEach(((e,t)=>{e.properties.index=t})),this.sketchPoints_.filter((e=>e.properties.virtual)).forEach(((e,t)=>{e.properties.index=t})),this.dispatchEvent(new CustomEvent("drawmodify",{detail:{positions:_(this,A),type:_(this,D),entity:this.entityForEdit}})),this.moveLabel(this.entityForEdit)}else{var t,r;const e=n.find((e=>!!e.id.point||!!e.id.billboard));if(!e)return;const i=e.id;this.sketchPoint_=i;const o=i.properties;this.moveEntity=i.id===this.entityForEdit.id||this.sketchPoints_.some((e=>e.id===i.id))||o&&o.type&&"rotate"===o.type.getValue(),this.moveEntity&&null!==(t=this.sketchPoint_)&&void 0!==t&&null!==(r=t.properties)&&void 0!==r&&r.virtual&&this.extendOrSplitLineOrPolygonPositions_()}this.moveEntity&&(_(this,E).scene.screenSpaceCameraController.enableInputs=!1,this.dispatchEvent(new CustomEvent("leftdown")))}}halfwayPosition_(e,t){e=e.position||e,t=t.position||t,e=e.getValue?e.getValue(this.julianDate):e,t=t.getValue?t.getValue(this.julianDate):t;const r=cesium.Cartesian3.add(e,t,new cesium.Cartesian3);return cesium.Cartesian3.divideByScalar(r,2,r),r}extendOrSplitLineOrPolygonPositions_(){var e,t;const r=this.sketchPoint_,n=cesium.Cartesian3.clone(null===(e=r.position)||void 0===e?void 0:e.getValue(this.julianDate)),i=null===(t=r.properties)||void 0===t?void 0:t.index,o=this.sketchPoints_[2*i],a=this.sketchPoints_[2*(i+1)%this.sketchPoints_.length],s=this.halfwayPosition_(o,n),l=this.halfwayPosition_(n,a),c=this.createSketchPoint_(n,{edit:!0}),u=this.createSketchPoint_(l,{edit:!0,virtual:!0});r.position=s,this.insertVertexToPolylineOrPolygon_(i+1,n.clone()),this.sketchPoints_.splice(2*(i+1),0,c,u),this.sketchPoints_.forEach(((e,t)=>e.properties.index=Math.floor(t/2))),this.sketchPoint_=c,_(this,E).scene.requestRender()}insertVertexToPolylineOrPolygon_(e,t){_(this,A).splice(e,0,t)}removeVertexToPolylineOrPolygon_(e){_(this,A).splice(e,1)}onLeftUp_(e){_(this,E).scene.screenSpaceCameraController.enableInputs=!0;cesium.Cartesian2.equalsEpsilon(e.position,this.leftPressedPixel_,0,2)&&this.onLeftDownThenUp_(e),this.moveEntity&&(this.dispatchEvent(new CustomEvent("drawmodify",{detail:{positions:_(this,A),type:_(this,D),entity:this.entityForEdit}})),this.moveLabel(this.entityForEdit)),this.moveEntity=!1,this.leftPressedPixel_=void 0,this.sketchPoint_=void 0}onLeftDownThenUp_(e){var t,r;const n=this.entityForEdit;if(this.sketchPoint_&&void 0!==(null===(t=this.sketchPoint_.properties)||void 0===t?void 0:t.index)&&(null===(r=this.sketchPoint_.properties)||void 0===r||!r.virtual)){let e=1;switch(_(this,D)){case"polygon":var i,o,a;if((null===(i=n.polygon)||void 0===i||null===(o=i.hierarchy)||void 0===o?void 0:o.getValue(this.julianDate)).positions.length<=3)return;_(this,A).splice(null===(a=this.sketchPoint_.properties)||void 0===a?void 0:a.index,1),e=2;break;case"polyline":var s,l,c;if((null===(s=n.polyline)||void 0===s||null===(l=s.positions)||void 0===l?void 0:l.getValue(this.julianDate)).length<=2)return;_(this,A).splice(null===(c=this.sketchPoint_.properties)||void 0===c?void 0:c.index,1),e=2;break}if(2===e){var u;const t=null===(u=this.sketchPoint_.properties)||void 0===u?void 0:u.index,r=2*t,n="polyline"===_(this,D),i=n&&0===t,o=n&&r===this.sketchPoints_.length-1;if(!i&&!o){const e=(this.sketchPoints_.length+r-2)%this.sketchPoints_.length,t=(r+2)%this.sketchPoints_.length,n=this.sketchPoints_[e],i=this.sketchPoints_[e+1],o=this.sketchPoints_[t],a=this.halfwayPosition_(n,o);i.position=a}let a;a=o?this.sketchPoints_.splice(r-1,2):this.sketchPoints_.splice(r,2),this.sketchPoints_.forEach(((t,r)=>t.properties.index=Math.floor(r/e))),a.forEach((e=>this.drawingDataSource.entities.remove(e)))}else if("polygon"===_(this,D)||"polyline"===_(this,D)){var p;this.sketchPoints_.splice(null===(p=this.sketchPoint_.properties)||void 0===p?void 0:p.index,1),this.sketchPoints_.forEach(((e,t)=>e.properties.index=t)),this.drawingDataSource.entities.remove(this.sketchPoint_)}_(this,E).scene.requestRender()}}getCorrectRectCorner(e,t,r,n){const i=Cartesian3.distance(r,t)/Cartesian3.distance(e,n);let o=Cartesian3.subtract(e,n,new Cartesian3);return o=Cartesian3.multiplyByScalar(o,i,new Cartesian3),Cartesian3.add(n,o,new Cartesian3)}checkForNegateMove(e,t,r,n){const i=_(this,E).scene.cartesianToCanvasCoordinates(e),o=_(this,E).scene.cartesianToCanvasCoordinates(n),a=_(this,E).scene.cartesianToCanvasCoordinates(r),s=_(this,E).scene.cartesianToCanvasCoordinates(t);return i&&o&&a&&s?{right:!!Intersections2D.computeLineSegmentLineSegmentIntersection(i.x,i.y,o.x,o.y,a.x,a.y,s.x,s.y),left:!!Intersections2D.computeLineSegmentLineSegmentIntersection(i.x,i.y,a.x,a.y,o.x,o.y,s.x,s.y)}:{right:!1,left:!1}}getMeasurements(e,t){const r={units:ol.proj.Units.METERS},n=[];if(e.forEach(((t,r)=>{r>0&&n.push(new cesium.EllipsoidGeodesic(cesium.Cartographic.fromCartesian(e[r-1]),cesium.Cartographic.fromCartesian(t),cesium.Ellipsoid.WGS84).surfaceDistance)})),"polyline"===t)r.length=n.reduce(((e,t)=>e+t),0);else if("polygon"===t)r.perimeter=n.reduce(((e,t)=>e+t),0),r.area=e.length>2?Math.sqrt(Math.pow(cesium.PolygonPipeline.computeArea2D(e),2)):0;else if("point"===t)return{};return r}}var Z=r(7680);const k={compiler:[8,">= 4.3.0"],main:function(e,t,r,n,i){return'<div class="tc-view-3d-overlay" hidden>\r\n    <svg class="tc-view-3d-overlay-svg">\r\n        <defs>\r\n            <filter id="fGaussian" x="0" y="0">\r\n                <feGaussianBlur in="SourceGraphic" stdDeviation="3" />\r\n            </filter>\r\n        </defs>\r\n        <rect width="100%" height="100%" fill="white" fill-opacity="0.1" filter="url(#fGaussian)" />  \r\n    </svg>    \r\n</div>'},useData:!0},F={compiler:[8,">= 4.3.0"],main:function(e,t,r,n,i){var o=null!=t?t:e.nullContext||{},a=e.escapeExpression,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div>\r\n    <svg xmlns:dc="http://purl.org/dc/elements/1.1/"\r\n         xmlns:cc="http://creativecommons.org/ns#"\r\n         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"\r\n         xmlns:svg="http://www.w3.org/2000/svg"\r\n         xmlns="http://www.w3.org/2000/svg"\r\n         xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\r\n         xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\r\n         width="220"\r\n         height="135"\r\n         viewBox="0 0 63.40233 35.531682"\r\n         version="1.1"\r\n         id="threedControls">\r\n        <g inkscape:groupmode="layer"\r\n           id="backgroundLayer"\r\n           inkscape:label="backgroundLayer"\r\n           transform="translate(-2.3693123,-42.387899)">\r\n            <path style="fill:#ffffff;fill-opacity:0.23999999;stroke:none;stroke-width:0.2;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:0.3169643;paint-order:stroke fill markers"\r\n                  d="M 48.005285,42.387899 A 17.766048,17.766048 0 0 0 34.067635,49.16888 17.754217,17.754217 0 0 0 20.123267,42.399784 17.754217,17.754217 0 0 0 2.3693123,60.153739 a 17.754217,17.754217 0 0 0 17.7539547,17.75447 17.754217,17.754217 0 0 0 13.923699,-6.76961 17.766048,17.766048 0 0 0 13.958319,6.78098 17.766048,17.766048 0 0 0 17.766357,-17.76584 17.766048,17.766048 0 0 0 -17.766357,-17.76584 z"\r\n                  id="background"\r\n                  inkscape:connector-curvature="0" />\r\n        </g>\r\n        <g inkscape:label="tiltLayer"\r\n           inkscape:groupmode="layer"\r\n           id="tiltLayer"\r\n           transform="translate(-26.69084,-42.254264)"\r\n           style="display:inline">\r\n            <g class="tc-view-3d-cm-tilt-indicator">\r\n                <path class="tc-view-3d-cm-tilt-inner"\r\n                      id="tiltInner"\r\n                      d="m 44.44423,52.861576 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z"\r\n                      inkscape:connector-curvature="0">\r\n                    <title>'+a(s(r,"i18n").call(o,"threed.tilt.reset",{name:"i18n",hash:{},data:i,loc:{start:{line:33,column:27},end:{line:33,column:55}}}))+'</title>\r\n                </path>\r\n                <path class="tc-view-3d-cm-tilt-inner-image"\r\n                      d="m 40.116095,64.124648 c -0.12075,-0.119221 -0.171366,-0.928328 -0.171366,-2.739326 0,-2.143319 0.03709,-2.606753 0.223349,-2.79065 0.19727,-0.194769 0.269957,-0.196719 0.622509,-0.01671 0.219537,0.112088 0.761654,0.542242 1.204705,0.955894 l 0.805547,0.752098 v 0.939855 c 0,0.51692 -0.06955,1.085596 -0.154558,1.263727 -0.173436,0.363428 -1.919571,1.804317 -2.186551,1.804317 -0.09475,0 -0.249383,-0.07614 -0.343635,-0.169192 z m 3.287741,-0.05029 c -0.307698,-0.212789 -0.317387,-0.295835 -0.317387,-2.721198 0,-1.757783 0.05096,-2.552024 0.171366,-2.670904 0.120776,-0.119243 0.941399,-0.169194 2.779684,-0.169194 2.432612,0 2.618273,0.01838 2.756146,0.27272 0.08484,0.156511 0.147831,1.267987 0.147831,2.608402 0,3.088986 0.189068,2.899662 -2.895738,2.899662 -1.872744,0 -2.3862,-0.04266 -2.641902,-0.219488 z m 0.586357,-6.180807 c -0.314529,-0.267117 -0.397432,-0.458143 -0.397432,-0.915756 0,-0.785501 0.427643,-1.207722 1.223233,-1.207722 1.162181,0 1.675866,1.23538 0.851939,2.048861 -0.522115,0.515494 -1.126934,0.542392 -1.67774,0.07462 z m 2.780604,-0.09201 c -0.374474,-0.369724 -0.423284,-0.501051 -0.3506,-0.943285 0.118405,-0.72038 0.53618,-1.088187 1.236028,-1.088187 0.699848,0 1.117624,0.367807 1.236028,1.088187 0.07269,0.442234 0.02388,0.573561 -0.3506,0.943285 -0.300932,0.297119 -0.573881,0.429526 -0.885428,0.429526 -0.311544,0 -0.584496,-0.132407 -0.885428,-0.429526 z"\r\n                      id="tiltImage"\r\n                      inkscape:connector-curvature="0">\r\n                    <title>'+a(s(r,"i18n").call(o,"threed.tilt.reset",{name:"i18n",hash:{},data:i,loc:{start:{line:39,column:27},end:{line:39,column:55}}}))+'</title>\r\n                </path>\r\n                <path class="tc-view-3d-cm-tilt-outer tc-view-3d-cm-tilt-outer-circle"\r\n                      id="tiltOuter"\r\n                      d="m 44.44423,48.705554 c -6.246102,0 -11.312196,5.070128 -11.312196,11.324146 0,6.254017 5.066094,11.330914 11.312196,11.330914 6.246102,0 11.312196,-5.076897 11.312196,-11.330914 0,-6.254018 -5.066094,-11.324146 -11.312196,-11.324146 z m 0,4.156022 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z"\r\n                      inkscape:connector-curvature="0">\r\n                    <title>'+a(s(r,"i18n").call(o,"threed.tilt.drag",{name:"i18n",hash:{},data:i,loc:{start:{line:45,column:27},end:{line:45,column:54}}}))+'</title>\r\n                </path>\r\n                <path class="tc-view-3d-cm-tilt-outer tc-view-3d-cm-tilt-outer-shell-circle"\r\n                      sodipodi:nodetypes="ssssssccccsccccssccsssccscccccccsccssscsssssccccccccccccccc"\r\n                      inkscape:connector-curvature="0"\r\n                      id="tiltShell"\r\n                      d="m 44.44423,48.705554 c -6.246102,0 -11.312196,5.070128 -11.312196,11.324146 0,6.254017 5.066094,11.330914 11.312196,11.330914 6.246102,0 11.312196,-5.076897 11.312196,-11.330914 0,-6.254018 -5.066094,-11.324146 -11.312196,-11.324146 z m 0,0.379051 c 2.995132,0 5.705501,1.203885 7.681205,3.154245 l -2.386853,2.382605 0.135232,0.135376 2.386853,-2.382606 c 1.930016,1.972963 3.12387,4.674054 3.12387,7.655475 0,2.981421 -1.193854,5.680844 -3.12387,7.655474 l -2.386853,-2.382605 -0.135232,0.135375 2.386853,2.382606 c -1.975664,1.951759 -4.686314,3.161013 -7.681205,3.161013 -1.94179,0 -3.766282,-0.506879 -5.347316,-1.395323 -0.850442,-0.477894 -1.630441,-1.06619 -2.320365,-1.745384 l 2.407138,-2.402912 c 1.358381,1.325983 3.214811,2.145699 5.260543,2.145699 4.163407,0 7.545972,-3.385283 7.545972,-7.553943 0,-4.168661 -3.382565,-7.547175 -7.545972,-7.547175 -2.045732,0 -3.902162,0.81461 -5.260543,2.13893 l -2.407138,-2.402912 c 1.972594,-1.940536 4.681097,-3.133938 7.667681,-3.133938 z m -0.189325,0.182756 v 3.01887 h 0.378651 v -3.01887 z m -7.606826,3.086558 2.400376,2.402912 C 37.721509,56.11715 36.90502,57.97796 36.90502,60.0297 c 0,2.05174 0.816489,3.910884 2.143435,5.272869 l -2.400376,2.402912 c -0.435151,-0.44326 -0.832923,-0.923297 -1.188195,-1.435068 -0.462681,-0.666492 -0.853281,-1.386809 -1.160484,-2.149815 -0.508689,-1.263436 -0.788715,-2.64392 -0.788715,-4.090898 0,-2.99182 1.197141,-5.70104 3.137394,-7.675781 z m 7.796151,0.507657 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z m -10.744219,6.978598 v 0.379051 h 3.022445 v -0.379051 z m 18.513325,0 v 0.379051 h 3.029207 v -0.379051 z m -7.931385,7.932994 v 3.01887 h 0.37189 v -3.01887 z">\r\n                    <title>'+a(s(r,"i18n").call(o,"threed.tilt.drag",{name:"i18n",hash:{},data:i,loc:{start:{line:52,column:27},end:{line:52,column:54}}}))+'</title>\r\n                </path>\r\n            </g>\r\n        </g>\r\n        <g id="rotateLayer"\r\n           inkscape:groupmode="layer"\r\n           inkscape:label="rotateLayer"\r\n           style="display:inline"\r\n           transform="translate(-2.3693123,-42.387899)">\r\n            <path class="tc-view-3d-cm-rotate-right"\r\n                  sodipodi:nodetypes="cccccccc"\r\n                  inkscape:connector-curvature="0"\r\n                  id="right"\r\n                  d="m 53.241331,72.907368 0.900176,1.930847 c 3.602027,-1.827343 6.291427,-4.493353 8.092762,-8.066897 l 0.969844,0.452626 -0.663464,-4.788009 -3.222445,2.974451 0.983506,0.459005 c -1.447339,3.107391 -3.949649,5.598011 -7.060379,7.037977 z">\r\n                <title>'+a(s(r,"i18n").call(o,"threed.rotate.right",{name:"i18n",hash:{},data:i,loc:{start:{line:66,column:23},end:{line:66,column:53}}}))+'</title>\r\n            </path>\r\n            <path class="tc-view-3d-cm-rotate-left"\r\n                  sodipodi:nodetypes="cccccccc"\r\n                  inkscape:connector-curvature="0"\r\n                  id="left"\r\n                  d="m 42.795431,72.906221 -0.900176,1.930846 c -3.602027,-1.827342 -6.291427,-4.493352 -8.092762,-8.066896 l -0.969844,0.452626 0.663465,-4.788009 3.222444,2.974451 -0.983506,0.459005 c 1.44734,3.107391 3.949649,5.598011 7.060379,7.037977 z">\r\n                <title>'+a(s(r,"i18n").call(o,"threed.rotate.left",{name:"i18n",hash:{},data:i,loc:{start:{line:73,column:23},end:{line:73,column:52}}}))+'</title>\r\n            </path>\r\n            <path class="tc-view-3d-cm-tilt-up"\r\n                  sodipodi:nodetypes="cccccccc"\r\n                  inkscape:connector-curvature="0"\r\n                  id="up"\r\n                  d="M 7.737296,54.610066 5.80645,53.70989 c 1.827342,-3.602027 4.493352,-6.291427 8.066896,-8.092762 l -0.452626,-0.969844 4.788009,0.663465 -2.974451,3.222444 -0.459005,-0.983506 c -3.107391,1.44734 -5.598011,3.949649 -7.037977,7.060379 z">\r\n                <title>'+a(s(r,"i18n").call(o,"threed.tilt.left",{name:"i18n",hash:{},data:i,loc:{start:{line:80,column:23},end:{line:80,column:50}}}))+'</title>\r\n            </path>\r\n            <path class="tc-view-3d-cm-tilt-down"\r\n                  sodipodi:nodetypes="cccccccc"\r\n                  inkscape:connector-curvature="0"\r\n                  id="down"\r\n                  d="m 7.684579,65.708846 -1.930847,0.900176 c 1.827343,3.602027 4.493353,6.291427 8.066897,8.092762 l -0.452626,0.969844 4.788009,-0.663464 -2.974451,-3.222445 -0.459005,0.983506 C 11.615165,71.321886 9.124545,68.819576 7.684579,65.708846 Z">\r\n                <title>'+a(s(r,"i18n").call(o,"threed.tilt.right",{name:"i18n",hash:{},data:i,loc:{start:{line:87,column:23},end:{line:87,column:51}}}))+'</title>\r\n            </path>\r\n            <g class="tc-view-3d-cm-rotate-indicator">\r\n                <path class="tc-view-3d-cm-rotate-inner"\r\n                      inkscape:connector-curvature="0"\r\n                      d="m 48.010487,52.995444 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z"\r\n                      id="rotateInner">\r\n                    <title>'+a(s(r,"i18n").call(o,"threed.rotate.reset",{name:"i18n",hash:{},data:i,loc:{start:{line:94,column:27},end:{line:94,column:57}}}))+'</title>\r\n                </path>\r\n                <path class="tc-view-3d-cm-rotate-inner-image"\r\n                      d="m 45.461645,60.604061 c 0.860585,-1.857231 1.777009,-3.864779 2.036499,-4.461218 0.471802,-1.084433 0.471802,-1.084433 0.66474,-0.667935 2.070474,4.46957 3.86201,8.443545 3.825603,8.485934 -0.02561,0.02982 -0.943964,-0.165127 -2.040793,-0.433206 -1.994234,-0.487419 -1.994234,-0.487419 -3.881098,-0.01711 -1.037775,0.258673 -1.950491,0.470314 -2.028258,0.470314 -0.07777,0 0.562721,-1.519553 1.423307,-3.376784 z m 1.23418,2.027617 c 1.353421,-0.310159 1.353421,-0.310159 1.353421,-2.998288 0,-1.534227 -0.05572,-2.627602 -0.129797,-2.547123 -0.101525,0.110295 -2.316061,4.831583 -2.659547,5.670031 -0.09645,0.23543 -0.15884,0.240844 1.435923,-0.12462 z"\r\n                      id="rotateImage"\r\n                      inkscape:connector-curvature="0">\r\n                    <title>'+a(s(r,"i18n").call(o,"threed.rotate.reset",{name:"i18n",hash:{},data:i,loc:{start:{line:100,column:27},end:{line:100,column:57}}}))+'</title>\r\n                </path>\r\n                <path class="tc-view-3d-cm-rotate-outer tc-view-3d-cm-rotate-outer-circle"\r\n                      inkscape:connector-curvature="0"\r\n                      d="m 48.010487,48.839422 c -6.246102,0 -11.312196,5.070128 -11.312196,11.324146 0,6.254017 5.066094,11.330914 11.312196,11.330914 6.246102,0 11.312196,-5.076897 11.312196,-11.330914 0,-6.254018 -5.066094,-11.324146 -11.312196,-11.324146 z m 0,4.156022 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z"\r\n                      id="rotateOuter">\r\n                    <title>'+a(s(r,"i18n").call(o,"threed.rotate.drag",{name:"i18n",hash:{},data:i,loc:{start:{line:106,column:27},end:{line:106,column:56}}}))+'</title>\r\n                </path>\r\n                <path class="tc-view-3d-cm-rotate-outer tc-view-3d-cm-rotate-outer-shell-circle"\r\n                      d="m 48.010487,48.839422 c -6.246102,0 -11.312196,5.070128 -11.312196,11.324146 0,6.254017 5.066094,11.330914 11.312196,11.330914 6.246102,0 11.312196,-5.076897 11.312196,-11.330914 0,-6.254018 -5.066094,-11.324146 -11.312196,-11.324146 z m 0,0.379051 c 2.995132,0 5.705501,1.203885 7.681205,3.154245 l -2.386853,2.382605 0.135232,0.135376 2.386853,-2.382606 c 1.930016,1.972963 3.12387,4.674054 3.12387,7.655475 0,2.981421 -1.193854,5.680844 -3.12387,7.655474 l -2.386853,-2.382605 -0.135232,0.135375 2.386853,2.382606 c -1.975664,1.951759 -4.686314,3.161013 -7.681205,3.161013 -1.94179,0 -3.766282,-0.506879 -5.347316,-1.395323 -0.850442,-0.477894 -1.630441,-1.06619 -2.320365,-1.745384 l 2.407138,-2.402912 c 1.358381,1.325983 3.214811,2.145699 5.260543,2.145699 4.163407,0 7.545972,-3.385283 7.545972,-7.553943 0,-4.168661 -3.382565,-7.547175 -7.545972,-7.547175 -2.045732,0 -3.902162,0.81461 -5.260543,2.13893 l -2.407138,-2.402912 c 1.972594,-1.940536 4.681097,-3.133938 7.667681,-3.133938 z m -0.189325,0.182756 v 3.01887 h 0.378651 v -3.01887 z m -7.606826,3.086558 2.400376,2.402912 c -1.326946,1.360319 -2.143435,3.221129 -2.143435,5.272869 0,2.05174 0.816489,3.910884 2.143435,5.272869 l -2.400376,2.402912 c -0.435151,-0.44326 -0.832923,-0.923297 -1.188195,-1.435068 -0.462681,-0.666492 -0.853281,-1.386809 -1.160484,-2.149815 -0.508689,-1.263436 -0.788715,-2.64392 -0.788715,-4.090898 0,-2.99182 1.197141,-5.70104 3.137394,-7.675781 z m 7.796151,0.507657 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z m -10.744219,6.978598 v 0.379051 h 3.022445 v -0.379051 z m 18.513325,0 v 0.379051 H 58.8088 v -0.379051 z m -7.931385,7.932994 v 3.01887 h 0.37189 v -3.01887 z"\r\n                      id="rotateShell"\r\n                      inkscape:connector-curvature="0"\r\n                      sodipodi:nodetypes="ssssssccccsccccssccsssccscccccccsccssscsssssccccccccccccccc">\r\n                    <title>'+a(s(r,"i18n").call(o,"threed.rotate.drag",{name:"i18n",hash:{},data:i,loc:{start:{line:113,column:27},end:{line:113,column:56}}}))+"</title>\r\n                </path>\r\n            </g>            \r\n        </g>\r\n    </svg>\r\n</div>"},useData:!0};n.Z.view=n.Z.view||{},n.Z.control=n.Z.control||{},n.Z.control.MapContents=o.default,i.Z.CESIUMNS="cesium";const U=n.Z.view.ThreeD=function(){const e=Object.prototype.hasOwnProperty;var t={VIEWNAME:"ThreeD",CLASS:"tc-view-3d",Consts:{BLANK_BASE:"blank",DEFAULT_TILE_SIZE:256},classes:{MAP3D:"tc-map-3d",LOADING:"tc-loading",CAMERACTRARROWDISABLED:"tc-disabled-arrow",FOCUS:"focus",HIGHLIGHTED:"tc-highlighted",OUTFOCUS:"tc-outfocus"},allowedControls:[],template:{},viewer:null,mapView:null,terrainProvider:null,getLocaleString:function(e,t){var r=this,i=r.map?r.map.options.locale:n.Z.Cfg.locale;return n.Z.Util.getLocaleString(i,e,t)},getRenderedHtml:function(e,t,r){return n.Z.Control.prototype.getRenderedHtml.call(this,e,t,r)}};i.Z.classes.THREED=i.Z.classes.THREED||"tc-3d",i.Z.classes.THREED_HIDDEN=i.Z.classes.THREED_HIDDEN||"tc-3d-hidden",i.Z.event.TERRAINLOADED=i.Z.event.TERRAINLOADED||"terrainloaded.tc.threed",i.Z.event.TERRAINRECEIVING=i.Z.event.TERRAINRECEIVING||"terrainreceiving.tc.threed",i.Z.event.TERRAIN404=i.Z.event.TERRAIN404||"terrain404.tc.threed",i.Z.event.THREED_DRAG=i.Z.event.THREED_DRAG||"drag.tc.threed",t.template[t.CLASS]=Z.default,t.template[t.CLASS+"-overlay"]=k,t.template[t.CLASS+"-cm-ctls"]=F;const o=function(e,t){var r=this;r.map=e,r.parent=t,Promise.resolve(r.map.getViewHTML()).then(function(e){r.viewHTML=e}.bind(r)),r.metersPerUnit=e.getMetersPerUnit(),r.maxResolution=null,r._oldMapSetCenter=e.setCenter,e.setCenter=function(n,i){e.on3DView?e.view3D.flyToMapCoordinates.call(t,n):r._oldMapSetCenter.call(e,n,i)}};o.prototype.getCenter=function(){return this.map.getCenter()},o.prototype.getExtent=function(){return this.map.getExtent()},o.prototype.getResolution=function(){return this.map.getResolution()},o.prototype.getRotation=function(){return this.map.getRotation()},o.prototype.getMaxResolution=function(){if(this.maxResolution)return this.maxResolution;if(null!==this.map.getResolutions())this.maxResolution=this.map.getResolutions()[0];else{var e=this.map.options.baselayerExtent;this.maxResolution=(e[2]-e[0])/this.parent.Consts.DEFAULT_TILE_SIZE}return this.maxResolution},o.prototype.getPixelFromCoordinate=function(e){return this.map.getPixelFromCoordinate(e)},o.prototype.setCenter=function(e){this._oldMapSetCenter.call(this.map,e)},o.prototype.setExtent=function(e){this.map.setExtent(e)},o.prototype.setResolution=function(e){this.map.setResolution(e)},o.prototype.setRotation=function(e){this.map.setRotation(e)};const m=function(e,t){return e.type===i.Z.layerType.WMTS?e.wrap.getCompatibleMatrixSets(t).length>0:e.isCompatible(t)},v=function(e,t){var r=1e6,n=t[0]-e[0],i=t[1]-e[1],o=Math.atan(i/n);return n<0&&(o+=Math.PI),[e[0]+r*Math.cos(o),e[1]+r*Math.sin(o)]},_=function(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n},w=function(e){var t=this;if((e=e||{}).nearMapCoords){var r=e.bottomPixel.clone();r.y=Math.round(9*r.y/10);var n=S.call(t,r);if(n){var i=[e.nearMapCoords,n].sort((function(t,r){return _(e.cameraPosition,t)-_(e.cameraPosition,r)}));return v.apply(this,i)}}return null},S=function(e,t){var r=this,i=L(r.viewer.scene,e);if(i){i=cesium.Cartographic.fromCartesian(i);const e=t||r.view3D.view2DCRS;return r.view3D.crs!==e?n.Z.Util.reproject([cesium.Math.toDegrees(i.longitude),cesium.Math.toDegrees(i.latitude)],r.view3D.crs,e):[cesium.Math.toDegrees(i.longitude),cesium.Math.toDegrees(i.latitude)]}return null},E=function(e,t){var r=this,n=r.viewer.camera.frustum.fovy,i=e*r.mapView.viewHTML.getBoundingClientRect().height,o=Math.cos(Math.abs(t));return i*r.mapView.metersPerUnit*o/2/Math.tan(n/2)},b=function(e,t){var r=this,n=r.viewer.scene.canvas,i=r.viewer.camera.frustum.fovy,o=2*e*Math.tan(i/2),a=Math.cos(Math.abs(t)),s=o/r.mapView.metersPerUnit/a/n.clientHeight,l=r.map.getResolutions();if(null===l)for(var c=0,u=(l=new Array(22)).length;c<u;++c)l[c]=r.mapView.getMaxResolution()/Math.pow(2,c);for(var p=0;p<l.length;p++){if(l[p]<Math.abs(s)){s=l[p-1];break}if(l[p]===Math.abs(s)){s=l[p];break}p===l.length-1&&(s=l[p])}return s},C=function(e,t,r,n,i){var o,a=cesium.Math.clamp,s=cesium.defaultValue,l=i||{},c=s(l.duration,500),u=function(e){return e},p=s(l.easing,u),h=l.callback,d=0,f=new cesium.Matrix4;return new Promise((function(i,s){function l(s){o||(o=s);var u=p(a((s-o)/c,0,1));e.transform.clone(f);var g=(u-d)*t;d=u,e.lookAtTransform(n),e.rotate(r,g),e.lookAtTransform(f),u<1?requestAnimationFrame(l):(h&&h(),i())}requestAnimationFrame(l)}))},L=function(e,t){var r=e.camera.getPickRay(t);return e.globe.pick(r,e)||e.camera.pickEllipsoid(t)},T=function(e){var t=e.canvas,r=new cesium.Cartesian2(t.clientWidth/2,t.clientHeight/2);return L(e,r)},A=function(e){var t=e.canvas,r=new cesium.Cartesian2(t.clientWidth/2,t.clientHeight);return L(e,r)},x=function(e){var t=e.camera,r=t.frustum.fovy/2,n=t.direction,i=cesium.Quaternion.fromAxisAngle(t.right,r),o=cesium.Matrix3.fromQuaternion(i),a=new cesium.Cartesian3;return cesium.Matrix3.multiplyByVector(o,n,a),new cesium.Ray(t.position,a)},P=function(e,t,r,n){var i=e.camera,o=I(e,r),a=i.right,s=cesium.Quaternion.fromAxisAngle(a,o),l=cesium.Matrix3.fromQuaternion(s),c=new cesium.Cartesian3;cesium.Cartesian3.subtract(i.position,r,c);var u=new cesium.Cartesian3;cesium.Matrix3.multiplyByVector(l,c,u),cesium.Cartesian3.add(u,r,u);var p=cesium.Matrix4.fromTranslation(u);C(i,t,u,p,n)},O=function(e,t,r){var n=new cesium.Cartesian3,i=new cesium.Cartesian3,o=new cesium.Cartesian3;cesium.Cartesian3.normalize(e,n),cesium.Cartesian3.normalize(t,i),cesium.Cartesian3.cross(n,i,o);var a=cesium.Cartesian3.dot(n,i),s=cesium.Cartesian3.magnitude(o),l=cesium.Cartesian3.dot(r,o),c=Math.atan2(s,a);return l>=0?c:-c},I=function(e,t){var r=e.camera,n=r.frustum.fovy/2,i=x(e),o=cesium.Cartesian3.clone(i.direction);cesium.Cartesian3.negate(o,o);var a=new cesium.Cartesian3;cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(t,a);var s=new cesium.Cartesian3;return cesium.Cartesian3.negate(r.right,s),O(a,o,s)+n},R=function(e,t,r,i,o,a){const s=this;return new Promise((function(o,l){var c=e.map((function(e){var t=e;return s.view3D.view2DCRS!==s.view3D.crs&&(t=n.Z.Util.reproject(e,s.view3D.view2DCRS,s.view3D.crs)),cesium.Cartographic.fromDegrees(t[0],t[1])}));cesium.when(s.viewer.terrainProvider.sampleTerrainMostDetailed(c),(function(n){var s,l,c=0;if(t===ol.geom.GeometryLayout.XYZM)s=e[0][3],l=e[e.length-1][3];else if(t===ol.geom.GeometryLayout.XYM)s=e[0][2],l=e[e.length-1][2];else{e[0][3]=n[0].time=Date.now();for(var u=1;u<n.length;u++){var p;let t=[];n[u].time=0,t=u+1<n.length?n.slice(u-1,u+1):n.slice(u-1),c+=p=new cesium.EllipsoidGeodesic(t[0],t[1]).surfaceDistance,e[u][3]=n[u].time=n[u-1].time+36e5*p/a}s=n[0].time,l=n[n.length-1].time}if(0===c)for(var h=1;h<n.length;h++){let e=[];e=h+1<n.length?n.slice(h-1,h+1):n.slice(h-1),c+=new cesium.EllipsoidGeodesic(e[0],e[1]).surfaceDistance}s=new Date(s).toISOString(),l=new Date(l).toISOString();var d=[{id:"document",name:"CZML Model",version:"1.0"},{id:"path",name:r,availability:s+"/"+l,position:{epoch:s,cartographicRadians:n.map((function(r,n){return t===ol.geom.GeometryLayout.XYZM?[new Date(e[n][3]).toISOString(),r.longitude,r.latitude,r.height]:t===ol.geom.GeometryLayout.XYM?[new Date(e[n][2]).toISOString(),r.longitude,r.latitude,r.height]:[new Date(r.time).toISOString(),r.longitude,r.latitude,r.height]})).reduce((function(e,t){return e.concat(t)}))},point:{heightReference:"CLAMP_TO_GROUND",pixelSize:i.radius,color:{rgba:i.fillColor},outlineColor:{rgba:i.strokeColor},outlineWidth:i.strokeWidth}}];o({czml:d,totalDistance:c,coordinates2D:e})}))}))},M=function(e){var t=this;t.parent=e;var r=function(e){this.isFocusingCameraCtrls=!1},o=function(){var e=this;e.isFocusingCameraCtrls=!0,e.lastFocused=performance.now(),e.div.classList.contains(e.parent.classes.OUTFOCUS)&&(e.div.classList.remove(e.parent.classes.OUTFOCUS),e.tiltIndicatorOuterCircle.classList.remove(e.parent.classes.OUTFOCUS),e.tiltIndicatorOuterShellCircle.classList.remove(e.parent.classes.OUTFOCUS),e.rotateIndicatorOuterCircle.classList.remove(e.parent.classes.OUTFOCUS),e.rotateIndicatorOuterShellCircle.classList.remove(e.parent.classes.OUTFOCUS))},a=function(){this.moving=!0},s=function(){var e=this;e.moving=!1,e.parent.map.trigger(i.Z.event.CAMERACHANGE,{position:e.parent.view3D.getCameraData()})},l=function(){var e=this,t=e.parent;e.parent.view3D.isLoadingTiles.call(e.parent)&&e.customCollisionDetection();var r=e.getCamera(),i=r.positionCartographic;e.moving&&(c(e.tiltIndicator,r.pitch),c(e.rotateIndicator,-r.heading),e.disableRotate(),e.disableTilt(5),t.view3D.crs!==t.view3D.view2DCRS?e._coordsXY=n.Z.Util.reproject([cesium.Math.toDegrees(i.longitude),cesium.Math.toDegrees(i.latitude)],t.view3D.crs,t.view3D.view2DCRS):e._coordsXY=[cesium.Math.toDegrees(i.longitude),cesium.Math.toDegrees(i.latitude)],t.mapView.setCenter(e._coordsXY),t.mapView.setResolution(b.call(t,i.height,i.latitude))),e._coordsXY&&(t._ovMap=t._ovMap||t.map.getControlsByClass("TC.control.OverviewMap")[0],t._ovMap&&t._ovMap.renderPromise().then((function(){t._ovMap.wrap.draw3DCamera({position:e._coordsXY,heading:r.heading,fov:e.parent.view3D.getFovCoords()})})))},c=function(e,t){var r=e.getBBox();const n="rotate("+cesium.Math.toDegrees(t)+" "+(r.x+r.width/2)+" "+(r.y+r.height/2)+")";document.getElementsByClassName(e.className.baseVal)[0].setAttribute("transform",n)};t.outControlsEvents=n.Z.Util.detectMouse()?["mouseleave"]:["touchleave","touchend"],t.outControls=r.bind(t),t.inControlsEvents=n.Z.Util.detectMouse()?["mouseenter"]:["touchmove","touchstart"],t.inControls=o.bind(t),t.moveStart=a.bind(t),t.moveEnd=s.bind(t),t.postRender=l.bind(t),t.selectors={tilt:"-cm-tilt",rotate:"-cm-rotate",indicator:"-indicator",leftArrow:"-left",rightArrow:"-right",downArrow:"-down",upArrow:"-up"},t.MIN_TILT=cesium.Math.toRadians(-89),t.MAX_TILT=cesium.Math.toRadians(-1),t.render()};M.prototype.bind=function(){var e=this;function t(){e.lastFocused||(e.lastFocused=performance.now()),performance.now()-e.lastFocused>5e3&&!0!==e.isFocusingCameraCtrls&&(e.div.classList.contains(e.parent.classes.OUTFOCUS)||(e.div.classList.add(e.parent.classes.OUTFOCUS),e.tiltIndicatorOuterCircle.classList.add(e.parent.classes.OUTFOCUS),e.tiltIndicatorOuterShellCircle.classList.add(e.parent.classes.OUTFOCUS),e.rotateIndicatorOuterCircle.classList.add(e.parent.classes.OUTFOCUS),e.rotateIndicatorOuterShellCircle.classList.add(e.parent.classes.OUTFOCUS))),e.rAFInOutControls=requestAnimationFrame(t)}e.getCamera().moveStart.addEventListener(e.moveStart),e.getCamera().moveEnd.addEventListener(e.moveEnd),e.parent.viewer.scene.postRender.addEventListener(e.postRender),e.outControlsEvents.forEach((function(t){e.div.addEventListener(t,e.outControls)})),e.inControlsEvents.forEach((function(t){e.div.addEventListener(t,e.inControls)})),e.rAFInOutControls=requestAnimationFrame(t)},M.prototype.unbind=function(){var e=this;e.div.classList.add(i.Z.classes.HIDDEN),e.getCamera().moveStart.removeEventListener(e.moveStart),e.getCamera().moveEnd.removeEventListener(e.moveEnd),e.parent.viewer.scene.postRender.removeEventListener(e.postRender),e.outControlsEvents.forEach((function(t){e.div.removeEventListener(t,e.outControls)})),e.inControlsEvents.forEach((function(t){e.div.removeEventListener(t,e.inControls)})),window.cancelAnimationFrame(e.rAFInOutControls),e.lastFocused=void 0,e.rAFInOutControls=void 0},M.prototype.getCamera=function(){return this.parent.viewer.scene.camera},M.prototype.getCameraState=function(){var e=this;if(e.parent.viewer){var t=e.parent.viewer.scene.camera,r=t.positionCartographic,n=A(e.parent.viewer.scene);if(n){var i=cesium.Cartesian3.distance(t.position,n);return{cp:[r.longitude,r.latitude,r.height],chpr:[t.heading,t.pitch,t.roll],bcpd:i}}}},M.prototype.render=function(){var e=this;e.div?(e.div.classList.remove(i.Z.classes.HIDDEN),e.bind()):e.parent.getRenderedHtml(e.parent.CLASS+"-cm-ctls",{},function(t){e.div=document.createElement("div"),e.div.classList.add(e.parent.CLASS+"-cm-ctls"),e.div.innerHTML=t,e.parent.map.div.appendChild(e.div);var r="."+e.parent.CLASS+e.selectors.tilt;e.tiltIndicatorInner=e.div.querySelector("[class^="+r.replace(".","")+"-inner]"),e.tiltIndicatorInner.addEventListener(i.Z.event.CLICK,e.resetTilt.bind(e)),e.tiltIndicator=e.div.querySelector(r+"-indicator"),e.tiltIndicatorOuterCircle=e.div.querySelector(r+"-outer-circle"),e.tiltIndicatorOuterShellCircle=e.div.querySelector(r+"-outer-shell-circle"),e.tiltIndicatorCircle=e.div.querySelector("[class^="+r.replace(".","")+"-outer]"),e.tiltIndicatorCircle.addEventListener("mousedown",function(e){var t=this;e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault();var r=new cesium.Cartesian2,n=e.currentTarget,i=e.currentTarget.getBoundingClientRect(),o=new cesium.Cartesian2((i.right-i.left)/2,(i.bottom-i.top)/2),a=new cesium.Cartesian2(e.clientX-i.left,e.clientY-i.top),s=cesium.Cartesian2.subtract(a,o,r);return t.draggingTilt.call(t,n,s),e.cancelBubble=!0,e.returnValue=!1,!1}.bind(e)),e.tiltUp=e.div.querySelector(r+e.selectors.upArrow),e.tiltUp.addEventListener(n.Z.Util.detectMouse()?"mousedown":"touchstart",function(t){if(t.target.disabled)return t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.cancelBubble=!0,t.returnValue=!1,!1;t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),e.inControls(t);var r=n.Z.Util.detectMouse()?"mouseup":"touchend";return document.removeEventListener(r,e.tiltUpMouseUpFunction,!1),e.tiltUpMouseUpFunction=void 0,e.tilt.call(e,5),e.tiltUpInterval=setInterval(function(){e.isTiltUpDisabled?e.tiltUpMouseUpFunction():e.tilt.call(e,5)}.bind(e),101),e.tiltUpMouseUpFunction=function(){clearInterval(e.tiltUpInterval),e.tiltUpInterval=void 0,document.removeEventListener(r,e.tiltUpMouseUpFunction,!1),e.tiltUpMouseUpFunction=void 0},document.addEventListener(r,e.tiltUpMouseUpFunction,!1),t.cancelBubble=!0,t.returnValue=!1,!1}.bind(e)),e.tiltDown=e.div.querySelector(r+e.selectors.downArrow),e.tiltDown.addEventListener(n.Z.Util.detectMouse()?"mousedown":"touchstart",function(t){if(t.target.disabled)return t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.cancelBubble=!0,t.returnValue=!1,!1;t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),e.inControls(t);var r=n.Z.Util.detectMouse()?"mouseup":"touchend";return document.removeEventListener(r,e.tiltDownMouseUpFunction,!1),e.tiltDownMouseUpFunction=void 0,e.tilt.call(e,-5),e.tiltDownInterval=setInterval(function(){e.isTiltDownDisabled?e.tiltDownMouseUpFunction():e.tilt.call(e,-5)}.bind(e),101),e.tiltDownMouseUpFunction=function(){clearInterval(e.tiltDownInterval),e.tiltDownInterval=void 0,document.removeEventListener(r,e.tiltDownMouseUpFunction,!1),e.tiltDownMouseUpFunction=void 0},document.addEventListener(r,e.tiltDownMouseUpFunction,!1),t.cancelBubble=!0,t.returnValue=!1,!1}.bind(e));var o="."+e.parent.CLASS+e.selectors.rotate;e.rotateIndicatorInner=e.div.querySelector("[class^="+o.replace(".","")+"-inner]"),e.rotateIndicatorInner.addEventListener(i.Z.event.CLICK,e.resetRotation.bind(e)),e.rotateIndicator=e.div.querySelector(o+"-indicator"),e.rotateIndicatorOuterCircle=e.div.querySelector(o+"-outer-circle"),e.rotateIndicatorOuterShellCircle=e.div.querySelector(o+"-outer-shell-circle"),e.rotateIndicatorCircle=e.div.querySelector("[class^="+o.replace(".","")+"-outer]"),e.rotateIndicatorCircle.addEventListener("mousedown",function(e){var t=this;e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault();var r=new cesium.Cartesian2,n=e.currentTarget,i=e.currentTarget.getBoundingClientRect(),o=new cesium.Cartesian2((i.right-i.left)/2,(i.bottom-i.top)/2),a=new cesium.Cartesian2(e.clientX-i.left,e.clientY-i.top),s=cesium.Cartesian2.subtract(a,o,r);return t.draggingRotate.call(t,n,s),e.cancelBubble=!0,e.returnValue=!1,!1}.bind(e)),e.rotateLeft=e.div.querySelector(o+e.selectors.leftArrow),e.rotateLeft.addEventListener(n.Z.Util.detectMouse()?"mousedown":"touchstart",function(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),e.inControls(t);var r=n.Z.Util.detectMouse()?"mouseup":"touchend";return document.removeEventListener(r,e.rotateLeftMouseUpFunction,!1),e.rotateLeftMouseUpFunction=void 0,e.rotate.call(e,-15),e.rotateLeftInterval=setInterval(function(){e.rotate.call(e,-15)}.bind(e),101),e.rotateLeftMouseUpFunction=function(){clearInterval(e.rotateLeftInterval),e.rotateLeftInterval=void 0,document.removeEventListener(r,e.rotateLeftMouseUpFunction,!1),e.rotateLeftMouseUpFunction=void 0},document.addEventListener(r,e.rotateLeftMouseUpFunction,!1),t.cancelBubble=!0,t.returnValue=!1,!1}.bind(e)),e.rotateRight=e.div.querySelector(o+e.selectors.rightArrow),e.rotateRight.addEventListener(n.Z.Util.detectMouse()?"mousedown":"touchstart",function(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),e.inControls(t);var r=n.Z.Util.detectMouse()?"mouseup":"touchend";return document.removeEventListener(r,e.rotateRightMouseUpFunction,!1),e.rotateRightMouseUpFunction=void 0,e.rotate.call(e,15),e.rotateRightInterval=setInterval(function(){e.rotate.call(e,15)}.bind(e),101),e.rotateRightMouseUpFunction=function(){clearInterval(e.rotateRightInterval),e.rotateRightInterval=void 0,document.removeEventListener(r,e.rotateRightMouseUpFunction,!1),e.rotateRightMouseUpFunction=void 0},document.addEventListener(r,e.rotateRightMouseUpFunction,!1),t.cancelBubble=!0,t.returnValue=!1,!1}.bind(e)),e.bind()}.bind(this))},M.prototype.disableTilt=function(e){var t=this,r=cesium.Math.toRadians(e),n=t.getCamera().pitch;t.isTiltDownDisabled=n+-r<t.MIN_TILT,t.isTiltUpDisabled=n+r>t.MAX_TILT,t.tiltUp.disabled=t.isTiltUpDisabled,t.tiltUp.classList.toggle(t.parent.classes.CAMERACTRARROWDISABLED,t.isTiltUpDisabled),t.tiltDown.disabled=t.isTiltDownDisabled,t.tiltDown.classList.toggle(t.parent.classes.CAMERACTRARROWDISABLED,t.isTiltDownDisabled)},M.prototype.disableRotate=function(){var e=this,t=!0,r=e.parent.viewer.scene.canvas,n=[new cesium.Cartesian2(0,r.clientHeight-1),new cesium.Cartesian2(r.clientWidth-1,r.clientHeight-1),new cesium.Cartesian2(r.clientWidth-1,0),new cesium.Cartesian2(0,0)].map(function(e){return S.call(this,e)}.bind(e.parent)).filter((function(e){return null!==e}));return n.length&&n.length>=2&&(t=!1),e.rotateIndicatorInner.disabled=t,e.rotateLeft.disabled=t,e.rotateLeft.classList.toggle(e.parent.classes.CAMERACTRARROWDISABLED,t),e.rotateRight.disabled=t,e.rotateRight.classList.toggle(e.parent.classes.CAMERACTRARROWDISABLED,t),t},M.prototype.tilt=function(e){var t=this;if(t.disableTilt(e),t.parent.viewer&&t.parent.viewer.trackedEntity)t.getCamera().rotateUp(cesium.Math.toRadians(e));else{if(null==T(t.parent.viewer.scene)&&(e>0?t.getCamera().lookUp():t.getCamera().lookDown()),e>=cesium.Math.PI_OVER_TWO&&t.isTiltUpDisabled||e<=-cesium.Math.PI_OVER_TWO&&t.isTiltDownDisabled)return;var r=cesium.Math.toRadians(e),n=T(t.parent.viewer.scene);if(n){var i=cesium.Matrix4.fromTranslation(n);t.parent.view3D.rotateAroundAxis(t.getCamera(),-r,t.getCamera().right,i,{duration:100})}}},M.prototype.rotate=function(e){var t=this;if(e=cesium.Math.toRadians(e),t.parent.viewer&&t.parent.viewer.trackedEntity)t.getCamera().rotateRight(-e);else{var r=A(t.parent.viewer.scene);r&&P(t.parent.viewer.scene,e,r,{duration:100})}},M.prototype.draggingTilt=function(e,t){var r=this;r.tiltIndicatorOuterCircle.classList.add(r.parent.classes.HIGHLIGHTED);var n=new cesium.Matrix4,i=new cesium.Matrix4,o=new cesium.Cartesian2;document.removeEventListener("mousemove",r.tiltMouseMoveFunction,!1),document.removeEventListener("mouseup",r.tiltMouseUpFunction,!1),r.tiltMouseMoveFunction=void 0,r.tiltMouseUpFunction=void 0,r.isTilting=!0;var a=r.parent.viewer.scene,s=a.camera,l=T(a);l?(r.tiltFrame=cesium.Transforms.northUpEastToFixedFrame(l,cesium.Ellipsoid.WGS84,i),r.tiltIsLook=!1):(r.tiltFrame=cesium.Transforms.northUpEastToFixedFrame(s.positionWC,cesium.Ellipsoid.WGS84,i),r.tiltIsLook=!0),r.startCursorAngle=Math.atan2(-t.y,t.x);var c=cesium.Matrix4.clone(s.transform,n);s.lookAtTransform(r.tiltFrame),r.initialCameraAngle=Math.atan2(s.position.y,s.position.x),s.lookAtTransform(c),r.tiltMouseMoveFunction=function(t){var r=this;a=r.parent.viewer.scene,s=a.camera;var i=e.getBoundingClientRect();const l=new cesium.Cartesian2((i.right-i.left)/2,(i.bottom-i.top)/2);var u=new cesium.Cartesian2(t.clientX-i.left,t.clientY-i.top),p=cesium.Cartesian2.subtract(u,l,o);console.log("Entra: "+p.toString());var h=Math.atan2(-p.y,p.x)-r.startCursorAngle,d=cesium.Math.zeroToTwoPi(r.initialCameraAngle-h);try{c=cesium.Matrix4.clone(s.transform,n),s.lookAtTransform(r.tiltFrame);var f=d-Math.atan2(s.position.y,s.position.x),g=s.pitch;(g+=f)<r.MIN_TILT?s.rotate(s.right,s.pitch-r.MIN_TILT):g>r.MAX_TILT?s.rotate(s.right,s.pitch-r.MAX_TILT):s.rotate(s.right,-f),r.disableTilt(5),s.lookAtTransform(c)}catch(t){r.tiltMouseUpFunction()}}.bind(r),r.tiltMouseUpFunction=function(e){r.tiltIndicatorOuterCircle.classList.remove(r.parent.classes.HIGHLIGHTED),r.isTilting=!1,document.removeEventListener("mousemove",r.tiltMouseMoveFunction,!1),document.removeEventListener("mouseup",r.tiltMouseUpFunction,!1),r.tiltMouseMoveFunction=void 0,r.tiltMouseUpFunction=void 0},document.addEventListener("mousemove",r.tiltMouseMoveFunction,!1),document.addEventListener("mouseup",r.tiltMouseUpFunction,!1)},M.prototype.draggingRotate=function(e,t){var r=this;if(document.removeEventListener("mousemove",r.rotateMouseMoveFunction,!1),document.removeEventListener("mouseup",r.rotateMouseUpFunction,!1),r.rotateMouseMoveFunction=void 0,r.rotateMouseUpFunction=void 0,r.rotateMouseMoveFunction=function(t){var i=e.getBoundingClientRect(),s=new cesium.Cartesian2((i.right-i.left)/2,(i.bottom-i.top)/2),c=new cesium.Cartesian2(t.clientX-i.left,t.clientY-i.top),u=cesium.Cartesian2.subtract(c,s,o),p=Math.atan2(-u.y,u.x)-r.rotateInitialCursorAngle,h=cesium.Math.zeroToTwoPi(r.rotateInitialCameraAngle-p);a=r.parent.viewer.scene.camera;try{l=cesium.Matrix4.clone(a.transform,n),a.lookAtTransform(r.rotateFrame);var d=Math.atan2(a.position.y,a.position.x);a.rotateRight(h-d),a.lookAtTransform(l)}catch(t){r.rotateMouseUpFunction()}},r.rotateMouseUpFunction=function(e){r.isRotating=!1,r.rotateIndicatorOuterCircle.classList.remove(r.parent.classes.HIGHLIGHTED),document.removeEventListener("mousemove",r.rotateMouseMoveFunction,!1),document.removeEventListener("mouseup",r.rotateMouseUpFunction,!1),r.rotateMouseMoveFunction=void 0,r.rotateMouseUpFunction=void 0},r.disableRotate())r.rotateMouseUpFunction();else{r.rotateIndicatorOuterCircle.classList.add(r.parent.classes.HIGHLIGHTED);var n=new cesium.Matrix4,i=new cesium.Matrix4,o=new cesium.Cartesian2;r.isRotating=!0,r.rotateInitialCursorAngle=Math.atan2(-t.y,t.x);var a=r.parent.viewer.scene.camera,s=T(r.parent.viewer.scene);null!=s&&null!=s||null!=(s=A(r.parent.viewer.scene))&&null!=s?(r.rotateFrame=cesium.Transforms.eastNorthUpToFixedFrame(s,cesium.Ellipsoid.WGS84,i),r.rotateIsLook=!1):(r.rotateFrame=cesium.Transforms.eastNorthUpToFixedFrame(a.positionWC,cesium.Ellipsoid.WGS84,i),r.rotateIsLook=!0);try{var l=cesium.Matrix4.clone(a.transform,n);a.lookAtTransform(r.rotateFrame),r.rotateInitialCameraAngle=Math.atan2(a.position.y,a.position.x),r.rotateInitialCameraDistance=cesium.Cartesian3.magnitude(new cesium.Cartesian3(a.position.x,a.position.y,0)),a.lookAtTransform(l)}catch(e){r.rotateMouseUpFunction()}document.addEventListener("mousemove",r.rotateMouseMoveFunction,!1),document.addEventListener("mouseup",r.rotateMouseUpFunction,!1)}},M.prototype.resetTilt=function(){var e=this,t=-e.getCamera().pitch-cesium.Math.toRadians(50);e.tilt(cesium.Math.toDegrees(t))},M.prototype.resetRotation=function(e){const t=this;return new Promise((function(r,n){var i;for(i=-t.getCamera().heading;i<-Math.PI;)i+=2*Math.PI;for(;i>Math.PI;)i-=2*Math.PI;e?e.callback=function(){r()}:r(),t.parent.viewer&&t.parent.viewer.trackedEntity&&t.parent.view3D.linked2DControls.geolocation.videoControls.call(t,{target:{className:"stop"},custom:!0});var o=A(t.parent.viewer.scene);o&&P(t.parent.viewer.scene,i,o,e)}))},M.prototype.customCollisionDetection=function(){var e,t,r=this,n=new cesium.Matrix4,i=new cesium.Cartographic,o=r.parent.viewer.scene,a=r.parent.viewer.scene.camera,s=o.screenSpaceCameraController,l=s.minimumCollisionTerrainHeight,c=s.minimumZoomDistance,u=o.globe,p=u.ellipsoid;cesium.Matrix4.equals(a.transform,cesium.Matrix4.IDENTITY)||(e=cesium.Matrix4.clone(a.transform,n),t=cesium.Cartesian3.magnitude(a.position),a._setTransform(cesium.Matrix4.IDENTITY));var h=i;p.cartesianToCartographic(a.position,h);var d=!1;if(h.height<l){var f=u.getHeight(h);null!=f&&(f+=c,h.height<f&&(h.height=f,p.cartographicToCartesian(h,a.position),d=!0))}null!=e&&(a._setTransform(e),d&&(cesium.Cartesian3.normalize(a.position,a.position),cesium.Cartesian3.negate(a.position,a.direction),cesium.Cartesian3.multiplyByScalar(a.position,Math.max(t,c),a.position),cesium.Cartesian3.normalize(a.direction,a.direction),cesium.Cartesian3.cross(a.direction,a.up,a.right),cesium.Cartesian3.cross(a.right,a.direction,a.up)))},M.prototype.limitCameraToInitExtent=function(){var e=this,t=e.viewer.camera.positionCartographic.clone();if(!(t.longitude>=e.initExtent.west&&t.longitude<=e.initExtent.east&&t.latitude>=e.initExtent.south&&t.latitude<=e.initExtent.north)){var r=e.viewer.scene.screenSpaceCameraController.maximumZoomDistance,n=.05*t.height/r;t.longitude=Math.max(e.initExtent.west-n,t.longitude),t.latitude=Math.max(e.initExtent.south-n,t.latitude),t.longitude=Math.min(e.initExtent.east+n,t.longitude),t.latitude=Math.min(e.initExtent.north+n,t.latitude),e.viewer.camera.setView({destination:cesium.Ellipsoid.WGS84.cartographicToCartesian(t),orientation:{heading:e.viewer.camera.heading,pitch:e.viewer.camera.pitch}})}e.viewer.scene.screenSpaceCameraController.minimumZoomDistance=t.height>1800?400:200};const D=function(e){var t,r=!1,o=null,a=null,s=null,l=e.map.getResolution,c=function(t){if(a)return Promise.resolve();{const o={content:"table",titles:{main:n.Z.Util.getLocaleString(e.map.options.locale,"threed.rs.panel.gfi"),max:n.Z.Util.getLocaleString(e.map.options.locale,"threed.rs.panel.gfi")}};var r,i=e.map.getControlsByClass("TC.control.ControlContainer")[0];return i?(o.position=i.POSITION.RIGHT,r=i.addControl("resultsPanel",o)):(o.div=document.createElement("div"),e.map.div.appendChild(o.div),r=e.map.addControl("resultsPanel",o)),r.then((function(e){e.caller=t,a=e,t.resultsPanel=a}))}};(s=e.map.getControlsByClass(n.Z.control.FeatureInfo)[0])&&(t=s.displayMode,c(s).then((function(){s.setDisplayMode(i.Z.infoContainer.RESULTS_PANEL),e.map.on(i.Z.event.RESULTSPANELCLOSE,(function(e){e.control===s.getDisplayControl()&&(s.querying||p())}))}))),this.clear=function(){s.closeResults(),p()},this.reset=function(){this.clear(),s.setDisplayMode(t),e.map.getResolution=l};var u=function(t){if(o)o.position=t;else{var r={position:t,billboard:{image:n.Z.Util.getBackgroundUrlFromCss(e.CLASS+"-marker"),eyeOffset:new cesium.Cartesian3(0,0,-100),verticalOrigin:cesium.VerticalOrigin.BOTTOM,heightReference:cesium.HeightReference.CLAMP_TO_GROUND}};o=e.view3D.addNativeFeature.call(e,r)}e.viewer.scene.requestRender()},p=function(){e.view3D.removeFeature.call(e,o),o=null};this.send=function(t){return new Promise((function(o,a){r=!0,s.displayMode!==i.Z.infoContainer.RESULTS_PANEL&&s.setDisplayMode(i.Z.infoContainer.RESULTS_PANEL),s.resultsPanel&&s.resultsPanel.close(),e.waiting||(e.waiting=e.map.getLoadingIndicator().addWait()),u(t),c(s).then((function(){var a,l=cesium.Ellipsoid.WGS84.cartesianToCartographic(t);a=e.view3D.crs!==e.view3D.view2DCRS?n.Z.Util.reproject([cesium.Math.toDegrees(l.longitude),cesium.Math.toDegrees(l.latitude)],e.view3D.crs,e.view3D.view2DCRS):[cesium.Math.toDegrees(l.longitude),cesium.Math.toDegrees(l.latitude)];for(var c,u=e.viewer.scene.globe._surface._tilesToRender,h=0;!c&&h<u.length;++h){var d=u[h];cesium.Rectangle.contains(d.rectangle,l)&&(c=d)}if(c){for(var f=c.data.imagery,g=f.length-1;g>=0;--g)if(!f[g].readyImagery)return void o();var y=c.tilingScheme.tileXYToNativeRectangle(c.x,c.y,c.level),m=(f.find((function(e){return e.readyImagery.imageryLayer.isBaseLayer()}))||{}).readyImagery;e.map.getResolution=function(){var t=e.view3D.crs!==e.view3D.view2DCRS?n.Z.Util.reproject([y.west,y.south],e.view3D.crs,e.view3D.view2DCRS):[y.west,y.south],r=e.view3D.crs!==e.view3D.view2DCRS?n.Z.Util.reproject([y.east,y.north],e.view3D.crs,e.view3D.view2DCRS):[y.east,y.north],i=(r[0]-t[0])/(m&&m.imageryLayer.imageryProvider.tileWidth||256),o=(r[1]-t[1])/(m&&m.imageryLayer.imageryProvider.tileHeight||256);return Math.max(i,o)}.bind(e,m,y),e.map.one(i.Z.event.NOFEATUREINFO,function(e){r=!1,o(e)}.bind(s)),e.map.one(i.Z.event.FEATUREINFO,(function(e){r=!1,o(e)})),e.map.on(i.Z.event.FEATURECLICK,(function(e){p(),o(e)})),s.isActive=!0,s.beforeRequest({xy:[0,0]}),s.callback(a)}else o()}))}))},this.get2DMarker=function(){return s.filterFeature},this.isPending=function(){return r}},U=function(t){this.layerCrs=null;var r,o={CRS:["Capability","Layer","CRS"],TILEMATRIXSET:["Contents","TileMatrixSet","Identifier"],TILEMATRIXSETLABELS:["Contents","TileMatrixSet"]},a=function(t,r,n){if(n<r.length-1)return e.call(t,r[n])?a(t[r[n]],r,++n):null;if(t instanceof Array){for(var i=[],o=0;o<t.length;o++)e.call(t[o],r[n])&&i.push(t[o][r[n]]);return i}return t[r[n]]},s=function(e,t){let r;if(r=n.Z.Util.isOnCapabilities(e.url)){let e;if(e=n.Z.capabilities[r])for(var i=a(e,o.TILEMATRIXSETLABELS,0),s=0;s<i.length;s++)if(n.Z.Util.CRSCodesEqual(t,i[s].SupportedCRS))return{id:i[s].Identifier,labels:a(i[s],["TileMatrix","Identifier"],0)}}return null},l=function(e){const t=this;return new Promise((function(r,n){let o,a,l=s(e,t.layerCrs);if(i.Z.WMTSEncoding.KVP===e.encoding)o=new cesium.Resource({url:e.url,request:new cesium.Request({type:cesium.RequestType.IMAGERY})});else if(i.Z.WMTSEncoding.RESTFUL===e.encoding){const r=e.wrap.getWMTSLayer({crs:t.layerCrs});r&&r.ResourceURL&&r.ResourceURL.length>0&&(a=r.ResourceURL[0],o=new cesium.Resource({url:a.template,request:new cesium.Request({type:cesium.RequestType.IMAGERY})}))}if(o&&l){o.tcLayer=e;let t={url:o,layer:e.layerNames,style:"default",format:a&&a.format||e.format||e.options.format,tilingScheme:new cesium.GeographicTilingScheme};i.Z.WMTSEncoding.RESTFUL===e.encoding?t.tileMatrixSetID=l.id:i.Z.WMTSEncoding.KVP===e.encoding&&l&&(t.tileMatrixSetID=l.id,t.tileMatrixLabels=l.labels),l&&l.labels&&(t.maximumLevel=parseInt(l.labels[l.labels.length-1])),r(new cesium.WebMapTileServiceImageryProvider(t))}else n("Faltan datos para instanciar la capa")}))},c=function(e){return new Promise((function(t,r){let n=new cesium.Resource({url:e.url,request:new cesium.Request({type:cesium.RequestType.IMAGERY})});n.tcLayer=e;let i={url:n,layers:e.layerNames,parameters:{version:"1.3.0",transparent:!0,format:e.format||e.options.format}};var o=function(){var t=[];if(e.capabilities&&e.capabilities.Capability&&e.capabilities.Capability.Layer&&e.names.length>0)for(var r=e.names.slice(0),n=function t(r,n){if(r){let o;for(var i=0;i<r.length;i++)if(o=r[i],e.compareNames(e.wrap.getName(o),n))return o.EX_GeographicBoundingBox;return t(o.Layer,n)}};r.length>0;){var i=n([e.capabilities.Capability.Layer],r.pop());null!==i&&t.push(i)}return t}();o&&(e.geoBBox=o),t(new cesium.WebMapServiceImageryProvider(i))}))},u=function(){(r=function(e,t){cesium.Resource.call(this,e),this.layer=t}).prototype.constructor=r,r.prototype=Object.create(cesium.Resource.prototype,{}),r.prototype.clone=function(e){var t=cesium.Resource.prototype.clone.call(this,e);return cesium.defined(e)||(e=new r({url:this._url},this.layer)),e._url=t._url,e._queryParameters=t._queryParameters,e._templateValues=t._templateValues,e.headers=t.headers,e.proxy=t.proxy,e.retryCallback=t.retryCallback,e.retryAttempts=t.retryAttempts,e._retryCount=0,e.request=t.request,e},r.prototype.fetchImage=g},p=function(){try{var e=new XMLHttpRequest;return e.open("GET","#",!0),e.responseType="blob","blob"===e.responseType}catch(e){return!1}}();function h(e){if(e.state===cesium.RequestState.ISSUED||e.state===cesium.RequestState.ACTIVE)throw new cesium.RuntimeError("The Resource is already being fetched.");e.state=cesium.RequestState.UNISSUED,e.deferred=void 0}function d(e,t,r,n){var i=function(i){var o=new Image;o.onload=function(e){n.resolve(o)}.bind(o,e),o.onerror=function(e,t){n.reject(t)}.bind(o,e),r&&(cesium.TrustedServers.contains(t)?o.crossOrigin="use-credentials":o.crossOrigin=""),o.src=i.url};e.getWebGLUrl.call(e,t).then(i,(function(e){n.reject(e)}))}function f(e,t){var r=e.request;r.url=e.url,r.requestFunction=function(){var r=e.url,n=!1;e.isDataUri||e.isBlobUri||(n=e.isCrossOriginUrl);var i=cesium.when.defer();return d(e.layer,r,n&&t,i),i.promise};var n=cesium.RequestScheduler.request(r);if(cesium.defined(n))return n.otherwise((function(e){return cesium.when.reject(e)}))}var g=function(e,t){if(cesium.defined(t)&&cesium.deprecationWarning("Resource.fetchImage.allowCrossOrigin","The allowCrossOrigin parameter has been deprecated and will be removed in cesium 1.44. It no longer needs to be specified."),e=cesium.defaultValue(e,!1),t=cesium.defaultValue(t,!0),h(this.request),!p||this.isDataUri||this.isBlobUri||!this.hasHeaders&&!e)return f(this,t);var r,n,i=this.fetchBlob();return cesium.defined(i)?i.then((function(e){if(cesium.defined(e)){n=e;var t=window.URL.createObjectURL(e);return f(r=new cesium.Resource({url:t}))}})).then((function(e){if(cesium.defined(e))return window.URL.revokeObjectURL(r.url),e.blob=n,e})).otherwise((function(e){return cesium.defined(r)&&window.URL.revokeObjectURL(r.url),cesium.when.reject(e)})):void 0};this.convert=function(e,t){switch(this.layerCrs=t,r||u(),!0){case i.Z.layerType.WMTS==e.type:return l.call(this,e);case i.Z.layerType.WMS==e.type:return c.call(this,e)}}},B=function(){var t=null,r=function(e,t){e instanceof Array&&(e="rgba("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")");var r=cesium.Color.fromCssColorString(e);return void 0!==t?r.withAlpha(t):r},i=function(e,t,r){for(var n in t){var i=e[t[n].prop];if(void 0!==i)if("function"==typeof i){var o=i(r);o&&(t[n].val=o)}else t[n].val=i}},o=function(e){var r;if(1==e.length){var n,i,o,a,s=e[0],l=1e3;n=new cesium.Cartesian3(s.x-l,s.y,s.z),i=new cesium.Cartesian3(s.x,s.y-l,s.z),o=new cesium.Cartesian3(s.x+l,s.y,s.z),a=new cesium.Cartesian3(s.x,s.y+l,s.z),r=cesium.Rectangle.fromCartesianArray([n,i,o,a],cesium.Ellipsoid.WGS84)}else r=cesium.Rectangle.fromCartesianArray(e,cesium.Ellipsoid.WGS84);var c=t.camera.getRectangleCameraCoordinates(r),u=cesium.Cartesian3.distance(c,cesium.BoundingSphere.fromPoints(e).center),p=t.camera.frustum.getPixelDimensions(t.drawingBufferWidth,t.drawingBufferHeight,u,t.pixelRatio,new cesium.Cartesian2);return p=Math.max(p.x,p.y),0==Math.round(p)?1:p},d=function(t){var r;return r=null==(r=!t.layer||t.layer&&!e.call(t.layer,"styles")?n.Z.Defaults.styles:t.layer.styles)[t.STYLETYPE]?r["polyline"===t.STYLETYPE?"line":t.STYLETYPE]:r["multipolygon"===t.STYLETYPE?"polygon":t.STYLETYPE],r=n.Z.Util.extend({},r,t.options,t.getStyle())};function f(e,t,r,n){const i={name:e,polyline:{positions:t,width:r.width,material:r.color,clampToGround:!0}};y(i,r,t),n(new cesium.Entity(i))}function g(e,t,r,n){const i={name:e,polyline:{positions:t,width:r.width,material:r.outlineColor,clampToGround:!0},polygon:{hierarchy:new cesium.PolygonHierarchy(t),material:r.color,clampToGround:!0}};y(i,r,t),n(new cesium.Entity(i))}function y(e,t,r){t.label&&(e.position=cesium.BoundingSphere.fromPoints(r).center,e.label={text:t.label,outlineColor:cesium.Color.fromCssColorString("#FFFFFF"),outlineWidth:2,style:cesium.LabelStyle.FILL_AND_OUTLINE,heightReference:cesium.HeightReference.CLAMP_TO_GROUND},t.fontColor&&(e.label.fillColor=t.fontColor),t.fontSize&&(e.label.font=t.fontSize+"pt sans-serif"))}var m=function(t){var n={},o=d(t);return n.options=function(){var n,a={},s={color:{prop:"fillColor"},opacity:{prop:"fillOpacity"},outlineColor:{prop:"strokeColor"},outlineOpacity:{prop:"strokeOpacity"},width:{prop:"strokeWidth"},fontColor:{prop:"fontColor"},fontSize:{prop:"fontSize"},label:{prop:"label"}};return i(o,s,t),e.call(s.color,"val")&&(n=e.call(s.opacity,"val")?r(s.color.val,s.opacity.val):r(s.color.val)),a.color=n,e.call(s.outlineColor,"val")&&(n=e.call(s.outlineOpacity,"val")?r(s.outlineColor.val,s.outlineOpacity.val):r(s.outlineColor.val)),a.outlineColor=n,e.call(s.width,"val")&&(a.width=s.width.val),e.call(s.label,"val")&&(a.label=s.label.val,e.call(s.fontColor,"val")&&(a.fontColor=r(s.fontColor.val)),e.call(s.fontSize,"val")&&(a.fontSize=s.fontSize.val)),a},t instanceof p.Z?n.geometryType=function(e,r){return new Promise((function(n,i){for(var o=[],a=[],s=[],l=function(e){return new cesium.GeometryInstance({id:t.id,geometry:new cesium.PolygonGeometry({polygonHierarchy:e}),attributes:{color:r.color}})},c=function(e){return new Promise((function(n,i){f(t.id,e,{material:r.outlineColor,width:r.width},(function(e){s.push(e),n()}))}))},u=0;u<e.length;u++){let t;for(var p=0;p<e[u].length;p++)0==p?(o.push(c.call(this,e[u][0])),t=new cesium.PolygonHierarchy(e[u][0])):(o.push(c.call(this,e[u][p])),t.holes.push(new cesium.PolygonHierarchy(e[u][p])));a.push(l(t))}Promise.all(o).then((function(){o=[],n([new cesium.GroundPrimitive({releaseGeometryInstances:!1,geometryInstances:a}),s])})).catch(i)}))}:t instanceof u.Z&&(n.geometryType=function(e,r){return new Promise((function(n,i){Array.isArray(e)&&1===e.length&&Array.isArray(e[0])&&(e=e[0]),g(t.id,e,r,(function(e){n(e)}))}))}),n},v=function(t){var n={},a=d(t);return n.options=function(){var n,o={},s={color:{prop:"strokeColor"},opacity:{prop:"strokeOpacity"},width:{prop:"strokeWidth"},fontColor:{prop:"fontColor"},fontSize:{prop:"fontSize"},label:{prop:"label"}};return i(a,s,t),e.call(s.width,"val")&&(o.width=s.width.val),e.call(s.color,"val")&&(n=e.call(s.opacity,"val")?r(s.color.val,s.opacity.val):r(s.color.val)),o.color=n,e.call(s.width,"val")&&(o.width=s.width.val),e.call(s.label,"val")&&(o.label=s.label.val,e.call(s.fontColor,"val")&&(o.fontColor=r(s.fontColor.val)),e.call(s.fontSize,"val")&&(o.fontSize=s.fontSize.val)),o},t instanceof c.Z?n.geometryType=function(e,r){return new Promise((function(n,i){var a=[],s=[];if(1==e.length)e=e[0],s.push(new Promise((function(n,i){f(t.id,e,r,(function(e){a.push(e),n()}))})));else{e=e.sort((function(e,t){return e.length>t.length?-1:e.length<t.length?1:0})),o(e[0]);for(var l=0;l<e.length;l++)s.push(new Promise((function(n,i){f(t.id,e[l],r,(function(e){a.push(e),n()}))})))}Promise.all(s).then((function(){s=[],n(a)})).catch(i)}))}:t instanceof l.Z&&(n.geometryType=function(e,r){return new Promise((function(n,i){f(t.id,e,r,(function(e){n(e)}))}))}),n},_=function(t){var o={},l=d(t);if(o.options=function(){var n={},o={rotation:{prop:"angle"},label:{prop:"label"},fontSize:{prop:"fontSize"},fontColor:{prop:"fontColor"},outlineLabelColor:{prop:"labelOutlineColor"},outlineLabelWidth:{prop:"labelOutlineWidth"},anchor:{prop:"anchor"},height:{prop:"height"},width:{prop:"width"},url:{prop:"url"},color:{prop:"fillColor"},opacity:{prop:"fillOpacity"},outlineColor:{prop:"strokeColor"},outlineOpacity:{prop:"strokeOpacity"},outlineWidth:{prop:"strokeWidth"},radius:{prop:"radius"}};return i(l,o,t),e.call(o.anchor,"val")&&(!e.call(o.url,"val")&&t.options.url?n.url=t.options.url:n.url=o.url.val,n.anchor=o.anchor.val),e.call(o.height,"val")&&(n.height=o.height.val),e.call(o.width,"val")&&(n.width=o.width.val),e.call(o.rotation,"val")&&(n.rotation=o.rotation.val),e.call(o.label,"val")&&(n.label=o.label.val),e.call(o.fontSize,"val")&&(n.fontSize=o.fontSize.val),e.call(o.fontColor,"val")&&(n.fontColor=r(o.fontColor.val)),e.call(o.outlineLabelColor,"val")&&(n.outlineLabelColor=r(o.outlineLabelColor.val)),e.call(o.outlineLabelWidth,"val")&&(n.outlineLabelWidth=o.outlineLabelWidth.val),e.call(o.color,"val")&&(e.call(o.opacity,"val")?n.color=r(o.color.val,o.opacity.val):n.color=r(o.color.val)),e.call(o.outlineColor,"val")&&(e.call(o.outlineOpacity,"val")?n.outlineColor=r(o.outlineColor.val,o.outlineOpacity.val):n.outlineColor=r(o.outlineColor.val)),e.call(o.outlineWidth,"val")&&(n.outlineWidth=o.outlineWidth.val),e.call(o.radius,"val")&&(n.radius=o.radius.val),n},t instanceof s.Z)o.geometryType=function(e,r){var n={name:t.id,position:e[0],billboard:{image:r.url,width:r.width,height:r.height,eyeOffset:new cesium.Cartesian3(0,0,-100),verticalOrigin:cesium.VerticalOrigin.BOTTOM,heightReference:cesium.HeightReference.CLAMP_TO_GROUND}};return r.anchor&&r.anchor.length>0&&(n.billboard.pixelOffset=new cesium.Cartesian2(r.anchor[0],r.anchor[1])),r.label?(n.label={text:r.label,font:"14pt sans-serif",heightReference:cesium.HeightReference.CLAMP_TO_GROUND,horizontalOrigin:cesium.HorizontalOrigin.LEFT,verticalOrigin:cesium.VerticalOrigin.BOTTOM,fillColor:r.fontColor,showBackground:!0,eyeOffset:new cesium.Cartesian3(3e3,0,-100)},new cesium.Entity(n)):new cesium.Entity(n)};else if(t instanceof a.Z){var c=new cesium.PinBuilder;o.geometryType=function(e,r){var i=r.label;switch(!0){case i&&/^([A-Z])\w+$/gi.test(i):case i&&!/^[0-9]*\-{0,1}[a-z]{0,4}$/gi.test(i):return new cesium.Entity({name:t.id,position:e[0],label:{text:r.label,eyeOffset:new cesium.Cartesian3(0,0,-100),heightReference:cesium.HeightReference.CLAMP_TO_GROUND,horizontalOrigin:cesium.HorizontalOrigin.CENTER,verticalOrigin:cesium.VerticalOrigin.BASELINE,font:"16px san-serif Helvetica",fillColor:cesium.Color.BLACK,outlineColor:cesium.Color.WHITE,outlineWidth:5,style:cesium.LabelStyle.FILL_AND_OUTLINE}});case/^[0-9]*\-{0,1}[a-z]{0,4}$/gi.test(i):return new cesium.Entity({name:t.id,position:e[0],billboard:{image:c.fromText(i,r.fontColor,48).toDataURL(),eyeOffset:new cesium.Cartesian3(0,0,-100),verticalOrigin:cesium.VerticalOrigin.BOTTOM,heightReference:cesium.HeightReference.CLAMP_TO_GROUND}});case r.radius&&r.radius>0:return new cesium.Entity({name:t.id,position:e[0],point:{color:r.color,pixelSize:2*r.radius-r.outlineWidth,outlineWidth:r.outlineWidth,outlineColor:r.outlineColor,heightReference:cesium.HeightReference.CLAMP_TO_GROUND}});default:return new cesium.Entity({name:t.id,position:e[0],billboard:{image:c.fromColor(cesium.Color.fromCssColorString(t.options.fillColor?t.options.fillColor:n.Z.Cfg.styles.point.fillColor),32).toDataURL(),eyeOffset:new cesium.Cartesian3(0,0,-100),verticalOrigin:cesium.VerticalOrigin.BOTTOM,horizontalOrigin:cesium.HorizontalOrigin.CENTER,heightReference:cesium.HeightReference.CLAMP_TO_GROUND}})}}}return o};this.convert=function(e,r,i,o){const d=this;t=e;var f,g,y,w,S,E=!1,b=[],C=function(e,t){Array.isArray(e)&&(i!==o&&(e=n.Z.Util.reproject(e,i,o)),t.push(e.length>2?cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]):cesium.Cartesian3.fromDegrees(e[0],e[1])))},L=r.geometry,T=function(e,t){if(Array.isArray(e))for(var r=0;r<e.length;r++)C(e[r],t)},A=function(e,t){if(Array.isArray(e))for(var r=0;r<e.length;r++)t.push([]),T(e[r],t[t.length-1])},x=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)b.push([]),A(e[t],b[b.length-1])};switch(!0){case r instanceof p.Z:S=L,Array.isArray(S)&&(x(S),g=m.call(d,r),E=!0);break;case r instanceof h.Z:L=(r=r.toPolygon()).geometry;case r instanceof u.Z||r instanceof c.Z:w=L,Array.isArray(w)&&(A(w,b),r instanceof u.Z?(g=m(r),E=!0):r instanceof c.Z&&(g=v(r),E=!0));break;case r instanceof l.Z:y=L,Array.isArray(y)&&(T(y,b),g=v(r),E=!0);break;case r instanceof s.Z:case r instanceof a.Z:T(y=[L],b),g=_(r)}return 0==b.length?null:((f={id:r.id,attributes:r.data,boundigSphere:cesium.BoundingSphere.fromPoints(b)}).geometry=E?function(e){return g.provider=e,g.geometryType(b,g.options())}:g.geometryType(b,g.options()),f)}},G={baseMap:"",baseMaps:[],baseVector:""},j=function(e){const t=this;return new Promise((function(r,n){var i=e.baseLayer instanceof d.Z;if(i){if(!m(e.baseLayer,t.view3D.crs)){var o=e.baseLayer.getFallbackLayer();o&&o.getCapabilitiesPromise().then((function(){o.isCompatible(t.view3D.crs)||e.toast(t.getLocaleString("threed.baseLayerNoCompatible",{name:e.baseLayer.layerNames}))}))}}else G.baseVector=e.baseLayer;0===G.baseMaps.length&&Promise.all(e.baseLayers.map((function(e){if(m(e,t.view3D.crs))return Promise.resolve(!1);var r=e.getFallbackLayer();return r?r.getCapabilitiesPromise().then((function(){return!r.isCompatible(t.view3D.crs)})):Promise.resolve(!0)}))).then((function(t){if(t.length>0)for(var n=0;n<e.baseLayers.length;n++)e.baseLayers[n]&&(e.baseLayers[n].mustReproject=t[n]);r()})).catch(n),G.baseMap=i?e.baseLayer:t.Consts.BLANK_BASE}))};return t.init=function(e){const t=this;t.events=t.map.$events,t.selectors={divThreedMap:e.div},e.terrain?t.terrain=e.terrain:t.terrain={url:"//idena.navarra.es/cesiumTerrain/2017/epsg4326/5m/",noDataValue:0,attributions:{name:"lvaro Huarte",site:"https://github.com/ahuarte47"}},e.terrainFallback&&(t.terrainFallback=(Array.isArray(e.terrainFallback)?e.terrainFallback:[e.terrainFallback]).map((e=>!e||e.url&&(e.coverageName||e.layerName)&&void 0!==e.noDataValue?{url:e.url.trim(),layerName:e.coverageName||e.layerName,format:e.format,noDataValue:e.noDataValue,type:e.type}:{url:"https://image.discomap.eea.europa.eu/arcgis/services/Elevation/EUElev_DEM_V11/MapServer/WCSServer",coverageName:"1",format:"GeoTIFF",noDataValue:-32767}))),e.controls&&(t.allowedControls=e.controls),t.mapView=new o(t.map,t),t.map.on(i.Z.event.PROJECTIONCHANGE,(function(e){t.mapView.metersPerUnit=t.map.getMetersPerUnit()})),t.map.view3D=t.view3D,t.getRenderedHtml(t.CLASS+"-overlay",{},(function(e){const r=new DOMParser;t.overlay=r.parseFromString(e,"text/html").body.firstChild}))},t.apply=function(t){const r=this;if(!(t=t||{}).map)throw Error("Falta referencia al mapa 2D");var o;if(r.map=t.map,null===(o=r.map.activeControl)||void 0===o||o.deactivate(),!r.map.view3D){var a=r.VIEWNAME=r.VIEWNAME.substr(0,1).toLowerCase()+r.VIEWNAME.substr(1);if(!r.map.options.views||!e.call(r.map.options.views,a))throw Error("Falta configuracin de la vista");r.init(r.map.options.views[a])}if(r.view3D.view2DCRS=t.map.crs,t.map.on(i.Z.event.PROJECTIONCHANGE,(function(e){r.view3D.view2DCRS=e.newCrs})),t.state&&r.map.toast(n.Z.Util.getLocaleString(r.map.options.locale,"threed.apply3DState"),{type:i.Z.msgType.INFO}),r.waiting||(r.waiting=r.map.getLoadingIndicator().addWait()),!r.ctrlsToMng){for(var s=[],l=0,c=r.allowedControls.length;l<c;l++){var u=r.allowedControls[l];u=u.substr(0,1).toUpperCase()+u.substr(1);var p=r.map.getControlsByClass("TC.control."+u);0===p.length&&(u=u.toUpperCase(),p=r.map.getControlsByClass("TC.control."+u)),s=s.concat(p)}r.map.on(i.Z.event.CONTROLADD,(function(e){r.allowedControls.some((t=>e.control instanceof n.Z.control[t.substr(0,1).toUpperCase()+t.substr(1)]))&&r.ctrlsToMng.push(e.control)})),r.ctrlsToMng=s}r.map.on3DView=!0,r.map.div.classList.add(i.Z.classes.THREED),r.divThreedMap=document.querySelector("#"+r.selectors.divThreedMap),r.divThreedMap.classList.add(r.classes.MAP3D,r.classes.LOADING),r.view3D.container=r.divThreedMap;const h=function(){console.log("Llega a applyEnd"),r.map.getLoadingIndicator().removeWait(r.waiting),delete r.waiting,t.callback&&t.callback()};try{r.view3D.loadViewer.call(r).then((function(){r.divThreedMap.classList.remove(r.CLASS+"-div-fadeOut"),r.divThreedMap.classList.add(r.CLASS+"-div-fadeIn"),r.mapView.viewHTML.classList.remove(r.CLASS+"-div-fadeIn"),r.mapView.viewHTML.classList.add(r.CLASS+"-div-fadeOut"),t.state||r.divThreedMap.classList.remove(r.classes.LOADING),j.call(r,r.map).then((function(){r.view3D.setCameraFromMapView.call(r),r.view3D.setBaseLayer.call(r,r.map.baseLayer),r.map.workLayers.filter((function(e){return e.type===i.Z.layerType.WMTS||e.type===i.Z.layerType.WMS})).reverse().forEach((function(e){r.view3D.addLayer.call(r,e)})),r.viewer.readyPromise.then(function(){if(r.view3D.cameraControls?r.view3D.cameraControls.render.call(r.view3D.cameraControls):r.view3D.cameraControls=new M(r),t.animateRendering||t.state||(t.animateRendering=!0),t.state)r.divThreedMap.classList.remove(r.classes.LOADING),r.view3D.cameraControls.getCamera().flyTo({destination:cesium.Cartesian3.fromRadians(t.state.cp[0],t.state.cp[1],t.state.cp[2]),orientation:{heading:t.state.chpr[0],pitch:t.state.chpr[1],roll:t.state.chpr[2]},complete:h});else if(t.animateRendering){let e=cesium.Math.toRadians(50),t=A(r.viewer.scene);const i=function(t){let n=cesium.Matrix4.fromTranslation(t);r.view3D.rotateAroundAxis(r.viewer.scene.camera,-e,r.viewer.scene.camera.right,n,{duration:2e3,callback:o})},o=function(){cesium.Camera.DEFAULT_VIEW_RECTANGLE=r.view3D.initialRectangle=r.viewer.camera.computeViewRectangle(),cesium.Camera.DEFAULT_VIEW_FACTOR=0,h()};if(t)i(t);else{let e,t=(new Date).getTime();e=setInterval((function(){let a=A(r.viewer.scene);if(a)clearInterval(e),i(a);else if((new Date).getTime()-t>15e3){clearInterval(e);let t=document.querySelectorAll("."+n.Z.control.NavBarHome.prototype.CLASS+"-btn");return t&&t.length>0&&t[0].click(),void o()}}),50)}}else h();r.map.trigger(i.Z.event.VIEWCHANGE,{view:i.Z.view.THREED}),r.events.on(i.Z.event.TERRAINLOADED,(function(){const e=function(e){var t=cesium.Ellipsoid.WGS84.cartesianToCartographic(e),n=r.viewer.scene.globe.getHeight(t)||0,i={longitude:t.longitude,latitude:t.latitude,height:t.height+n};return cesium.Ellipsoid.WGS84.cartographicToCartesian(i)};var t=r.viewer.entities.values.filter((function(e){return e.billboard}));if(t.length>0&&t.forEach((function(t){t.position=e(cesium.Property.getValueOrUndefined(t.position,cesium.JulianDate.now))})),r.viewer.billboardCollection){for(var n=0;n<r.viewer.billboardCollection.length;n++)r.viewer.billboardCollection.get(n).position=e(r.viewer.billboardCollection.get(n).position);r.viewer.scene.requestRender()}}))}.bind(r)).catch((()=>{console.log("3051"),h()}))})).catch((()=>{console.log("3053"),h()}))})).catch((()=>{console.log("3055"),h()}))}catch(e){throw h(),e}},t.unapply=function(e){var t;const r=this;r.waiting||(r.waiting=r.map.getLoadingIndicator().addWait()),null===(t=r.map.activeControl)||void 0===t||t.deactivate(),r.map.on3DView=!1,r.viewer&&r.viewer.trackedEntity&&r.view3D.linked2DControls.geolocation.wrap.simulateTrackEnd(),r.view3D.cameraControls.resetRotation({duration:1e3}).then((function(){var t=function(){r.map.div.classList.remove(i.Z.classes.THREED),r.map.trigger(i.Z.event.TERRAINPROVIDERREMOVE,{terrainProvider:r.viewer.scene.terrainProvider}),r.viewer.scene.terrainProvider.fallbackProvider&&r.viewer.scene.terrainProvider.fallbackProvider.forEach((function(e){r.map.trigger(i.Z.event.TERRAINPROVIDERREMOVE,{terrainProvider:e})})),r.view3D.setViewFromCameraView.call(r).then((function(){r.divThreedMap.classList.remove(r.classes.MAP3D,r.CLASS+"-div-fadeIn"),r.divThreedMap.classList.add(r.CLASS+"-div-fadeOut"),r.mapView.viewHTML.classList.remove(r.CLASS+"-div-fadeOut"),r.mapView.viewHTML.classList.add(r.CLASS+"-div-fadeIn"),r.view3D.destroy.call(r),r.map.getLoadingIndicator().removeWait(r.waiting),delete r.waiting,e.callback&&e.callback()})),r.mapView.setRotation(0),r._ovMap&&r._ovMap.wrap.draw3DCamera(null)},n=A(r.viewer.scene),o=cesium.Matrix4.fromTranslation(n),a=I(r.viewer.scene,n);r.view3D.rotateAroundAxis(r.viewer.scene.camera,-a,r.viewer.scene.camera.right,o,{duration:1500,callback:t})})).catch((function(e){throw e}))},t.view3D=function(){let o=null;const c=new U(/(EPSG\:?4326)/i),p=new B,h=function(t){var r=t;switch(!0){case t instanceof cesium.GroundPrimitive:this.viewer.scene.groundPrimitives.add(t);break;case t instanceof Object&&e.call(t,"billboard"):this.viewer.billboardCollection||(this.viewer.billboardCollection=this.viewer.scene.primitives.add(new cesium.BillboardCollection({scene:this.viewer.scene}))),r=this.viewer.billboardCollection.add({position:t.position,image:t.billboard.image,verticalOrigin:t.billboard.verticalOrigin,heightReference:t.billboard.heightReference,id:t.billboard.id});break;case t instanceof Object:(r=this.viewer.entities.getById(t.id))||(r=this.viewer.entities.add(t))}return this.viewer.scene.requestRender(),r},d=function(t,r,n){e.call(t.vector2DFeatures,r.layer.id)?e.call(t.vector2DFeatures[r.layer.id],r.id)?t.vector2DFeatures[r.layer.id][r.id].push(n):t.vector2DFeatures[r.layer.id][r.id]=[n]:(t.vector2DFeatures[r.layer.id]={},t.vector2DFeatures[r.layer.id][r.id]=[n]),n instanceof cesium.Entity&&(r.wrap.feature3D=n,n._wrap={parent:r})},v=[i.Z.event.BEFOREBASELAYERCHANGE,i.Z.event.BASELAYERCHANGE,i.Z.event.LAYERADD,i.Z.event.LAYERREMOVE,i.Z.event.LAYERVISIBILITY,i.Z.event.LAYEROPACITY,i.Z.event.LAYERORDER,i.Z.event.FEATUREADD,i.Z.event.FEATUREREMOVE,i.Z.event.FEATURESCLEAR,i.Z.event.ZOOMTO],_=function(t){var r=this;switch(!0){case t.type==i.Z.event.BEFOREBASELAYERCHANGE:r.waiting||(r.waiting=r.map.getLoadingIndicator().addWait());break;case t.type==i.Z.event.BASELAYERCHANGE:r.view3D.setBaseLayer.call(r,t.layer);break;case t.type==i.Z.event.LAYERADD:r.view3D.addLayer.call(r,t.layer);break;case t.type==i.Z.event.LAYERREMOVE:r.view3D.removeLayer.call(r,t.layer);break;case t.type==i.Z.event.LAYERVISIBILITY:r.view3D.setRenderOptionsLayer.call(r,t.layer,{visibility:t.layer.getVisibility()});break;case t.type==i.Z.event.LAYEROPACITY:r.view3D.setRenderOptionsLayer.call(r,t.layer,{opacity:t.layer.getOpacity()}),r.viewer.scene.requestRender();break;case t.type==i.Z.event.LAYERORDER:for(var n=0;n<r.view3D.workLayers.length;n++)if(r.view3D.workLayers[n].imageryProvider&&r.view3D.workLayers[n].imageryProvider.layers.join(",")===t.layer.names.join(",")){if(t.oldIndex>t.newIndex){const e=t.oldIndex-t.newIndex;for(let t=0;t<e;t++)r.viewer.scene.imageryLayers.lower(r.view3D.workLayers[n])}else{const e=t.newIndex-t.oldIndex;for(let t=0;t<e;t++)r.viewer.scene.imageryLayers.raise(r.view3D.workLayers[n])}r.view3D.workLayers.splice(t.newIndex,0,r.view3D.workLayers.splice(t.oldIndex,1)[0]);break}break;case t.type==i.Z.event.FEATUREADD:break;case t.type==i.Z.event.FEATUREREMOVE:if(r.view3D.vector2DFeatures&&e.call(r.view3D.vector2DFeatures,t.layer.id)){const n=function(n){e.call(r.view3D.vector2DFeatures[t.layer.id],n.id)&&(r.view3D.vector2DFeatures[t.layer.id][n.id].forEach((e=>r.view3D.removeFeature.call(r,e))),delete r.view3D.vector2DFeatures[t.layer.id][n.id])};t.feature instanceof Array?t.feature.forEach(n):n(t.feature)}break;case t.type==i.Z.event.FEATURESCLEAR:if(r.view3D.viewer.dataSources.getByName("drawing").forEach((e=>{e.entities.removeAll()})),r.view3D.vector2DFeatures&&e.call(r.view3D.vector2DFeatures,t.layer.id))for(var o in r.view3D.vector2DFeatures[t.layer.id])r.view3D.vector2DFeatures[t.layer.id][o].forEach((e=>r.view3D.removeFeature.call(r,e))),delete r.view3D.vector2DFeatures[t.layer.id][o];break;case t.type==i.Z.event.ZOOM:if(r.view3D.cameraControls&&!r.view3D.cameraControls.moving){var a=r.view3D.viewer.scene.canvas.clientWidth,s=r.view3D.viewer.scene.canvas.clientHeight;if(!r.view3D._canvasClientHeight||!r.view3D._canvasClientWidth||a!==r.view3D._canvasClientWidth||s!==r.view3D._canvasClientHeight)return r.view3D._canvasClientWidth||(r.view3D._canvasClientWidth=r.view3D.viewer.scene.canvas.clientWidth),r.view3D._canvasClientHeight||(r.view3D._canvasClientHeight=r.view3D.viewer.scene.canvas.clientHeight),r.view3D._canvasClientWidth=a,void(r.view3D._canvasClientHeight=s);r.view3D.flyToMapCoordinates.call(r,r.mapView.getCenter())}break;case t.type==i.Z.event.ZOOMTO:{if(r.lastZoom&&performance.now()-r.lastZoom<50)return;r.lastZoom=performance.now();let e=cesium.Rectangle.fromDegrees(...t.extent);r.view3D.flyToRectangle.call(r,e);break}}},L=function(){var e=this;if(e.map.on3DView&&!e.view3D.geotrackingEntity){var t=e.view3D.linked2DControls.geolocation,r=t.geotrackingLayer.features.filter((function(e){return e instanceof l.Z}));if(r&&r.length>0){var i=[];const a=new cesium.CallbackProperty(function(e,t){if(r[0].geometry.length>i.length){var o=r[0].geometry.slice(i.length).map(function(e){var t=e;return this.view3D.view2DCRS!==this.view3D.crs&&(t=n.Z.Util.reproject(e,this.view3D.view2DCRS,this.view3D.crs)),cesium.Cartographic.fromDegrees(t[0],t[1],e[2])}.bind(this)),a=[];return a=o instanceof Array?cesium.Ellipsoid.WGS84.cartographicArrayToCartesianArray(o):[cesium.Ellipsoid.WGS84.cartographicToCartesian(o)],i=i.concat(a)}return i}.bind(this),!1);var o=new cesium.Entity({id:"geotrackingEntity",polyline:{positions:a,clampToGround:!0,width:3,material:new cesium.PolylineDashMaterialProperty({color:new cesium.CallbackProperty(function(r,n){return e.viewer.scene.requestRender(),cesium.Color.fromAlpha(new cesium.Color(0,255,209),t.track.renderTrack.checked?1:0)}.bind(this),!1),gapColor:cesium.Color.TRANSPARENT})}});e.view3D.geotrackingEntity=e.viewer.entities.add(o),e.viewer.scene.requestRender()}}},x=function(e){var t=this,r=t.view3D.linked2DControls.geolocation;switch(!0){case r.const.event.IMPORTEDTRACK.indexOf(e.type)>-1:case e.target.className.indexOf("draw")>-1&&e.target.parentElement.classList.contains(r.const.className.SELECTEDTRACK):case!(e.target.parentElement&&e.target.parentElement.classList.contains(r.const.className.SELECTEDTRACK)):case e.target.className.indexOf("stop")>-1:if(t.map.on3DView&&(t.viewer.clock.shouldAnimate=!1,t.viewer.clock.currentTime=cesium.JulianDate.fromDate(new Date)),t.view3D.trackDataSource){if(t.view3D.trackDataSource.length>0){var n=t.view3D.trackDataSource.get(0).entities.values[0];t.viewer.entities.removeById(n.id)}t.view3D.trackDataSource.destroy(),delete t.view3D.trackDataSource}if(r.clearChartProgress(),e.custom){const e=r.getSelectedTrackItem();e&&e.querySelector(r.const.selector.STOP).click()}break;case e.target.classList.contains(r.const.className.PLAY):t.viewer.clock.shouldAnimate=!1;break;case e.target.classList.contains(r.const.className.PAUSE):t.viewer.clock.shouldAnimate=!0}},P=function(t){var r=this;const c=r.ctrlsToMng.map((function(e){return e.CLASS}));switch(r.map.controls.forEach((function(e){if(c.indexOf(e.CLASS)<0)switch(!0){case i.Z.view.DEFAULT==t:e.enable();break;case i.Z.view.THREED==t:e.disable()}})),!0){case i.Z.view.DEFAULT==t:document.querySelectorAll("[data-no-3d]").forEach((function(e){e.classList.remove(i.Z.classes.THREED_HIDDEN)})),r.ctrlsToMng.forEach((function(e){e.div.classList.remove(i.Z.classes.THREED)}));break;case i.Z.view.THREED==t:document.querySelectorAll("[data-no-3d]").forEach((function(e){e.classList.add(i.Z.classes.THREED_HIDDEN)})),r.ctrlsToMng.forEach((function(e){e.div.classList.add(i.Z.classes.THREED)}))}var u=!1,p=null;const h=[],d=t=>{if(r.viewer.trackedEntity)return;const o=function(){var e=r.viewer.camera.getPickRay(t.position),n=r.viewer.scene.globe.pick(e,r.viewer.scene);n&&r.view3D.getInfoOnPickedPosition.call(r,n)};if(r.map.activeControl instanceof g.default||r.map.activeControl instanceof y.default){var l=r.viewer.scene.pickPosition(t.position);h[h.length]=l}else{var c=r.viewer.scene.pick(t.position);if(c&&c.id){var u=c.id instanceof cesium.Entity?c.id.name:c.id,p=!1;for(var d in r.view3D.vector2DFeatures)if(e.call(r.view3D.vector2DFeatures[d],u)){const e=r.map.workLayers.find((e=>e.id===d)).features.filter((e=>u.indexOf(e.id)>-1&&e.showsPopup));if(e&&e.length>0){var f;if(p=!0,!(e instanceof a.Z||e instanceof s.Z)){var m=r.viewer.camera.getPickRay(t.position),v=(l=r.viewer.scene.globe.pick(m,r.viewer.scene),r.map.view3D.addNativeFeature.call(r.map,{position:l,billboard:{image:n.Z.Util.getBackgroundUrlFromCss(r.CLASS+"-marker"),eyeOffset:new cesium.Cartesian3(0,0,-100),verticalOrigin:cesium.VerticalOrigin.BOTTOM,heightReference:cesium.HeightReference.CLAMP_TO_GROUND}}));const e=function(t){if(t.control){const n=t.control,o=function(e){e.control===n&&(r.map.off(i.Z.event.RESULTSPANELCLOSE,o),r.map.view3D.removeFeature.call(r,v))};r.map.on(i.Z.event.RESULTSPANELCLOSE,o),r.map.off(i.Z.event.DRAWTABLE,e)}};r.map.on(i.Z.event.DRAWTABLE,e)}null===(f=r.map.getControlsByClass(n.Z.control.ResultsPanel).find((e=>e.isVisible())))||void 0===f||f.close(),r.map.trigger(i.Z.event.FEATURECLICK,{feature:e[0]});break}}p||o()}else o()}};let f=!1;const m=e=>{if(!r.viewer.trackedEntity){var t=r.viewer.scene.pick(e.endPosition);if(!t||!t.id||r.map.activeControl instanceof g.default?r.viewer.canvas.style.cursor="default":r.viewer.canvas.style.cursor="pointer",u&&p&&!f){const t=r.viewer.scene.globe.pick(r.viewer.camera.getPickRay(e.endPosition),r.viewer.scene);p.primitive.position=t,f=!0,r.viewer.scene.requestRender(),setTimeout((function(){f=!1}),200)}}},v=e=>{var t=r.viewer.scene.pick(e.position);t&&t.id&&(u=!0,o=r.viewer.scene.globe.pick(r.viewer.camera.getPickRay(e.position),r.viewer.scene),p=t,r.viewer.scene.screenSpaceCameraController.enableInputs=!1)},_=e=>{if(u=!1,p){const a=r.viewer.scene.globe.pick(r.viewer.camera.getPickRay(e.position),r.viewer.scene);p.primitive.position=a;var t=cesium.Ellipsoid.WGS84.cartesianToCartographic(a),n=cesium.Ellipsoid.WGS84.cartesianToCartographic(o);r.map.trigger(i.Z.event.THREED_DRAG,{pickedFeature:p.primitive,newCoords:[cesium.Math.toDegrees(t.longitude),cesium.Math.toDegrees(t.latitude)],oldCoords:[cesium.Math.toDegrees(n.longitude),cesium.Math.toDegrees(n.latitude)]}),p=null,r.viewer.scene.screenSpaceCameraController.enableInputs=!0}};if(i.Z.view.THREED===t?(!r.view3D.linked2DControls.featureInfo&&Object.keys(r.map.options.controls).indexOf("featureInfo")>-1&&r.allowedControls.indexOf("featureInfo")>-1&&(r.view3D.linked2DControls.featureInfo=new D(r)),r.eventHandlers||(r.eventHandlers={}),r.eventHandlers.handlerOfFeatures=new cesium.ScreenSpaceEventHandler(r.viewer.scene.canvas),r.eventHandlers.handlerOfFeatures.setInputAction(d,cesium.ScreenSpaceEventType.LEFT_CLICK),r.eventHandlers.handlerOfFeatures.setInputAction(m,cesium.ScreenSpaceEventType.MOUSE_MOVE),r.eventHandlers.handlerOfFeatures.setInputAction(v,cesium.ScreenSpaceEventType.LEFT_DOWN),r.eventHandlers.handlerOfFeatures.setInputAction(_,cesium.ScreenSpaceEventType.LEFT_UP)):i.Z.view.DEFAULT===t&&r.eventHandlers.handlerOfFeatures&&r.eventHandlers.handlerOfFeatures.destroy(),!r.view3D.linked2DControls.geolocation&&Object.keys(r.map.options.controls).indexOf("geolocation")>-1&&r.allowedControls.indexOf("geolocation")>-1&&(r.view3D.linked2DControls.geolocation=r.ctrlsToMng.find((function(e){return e instanceof n.Z.control.Geolocation}))),r.view3D.linked2DControls.geolocation){var w=r.view3D.linked2DControls.geolocation;if(i.Z.view.THREED===t){var S=[w.const.selector.STOP,w.const.selector.PAUSE,w.const.selector.BACKWARD,w.const.selector.FORWARD],E=x.bind(r);r.view3D.linked2DControls.geolocation.videoControls=E;var b=function(e){S.some((function(t){return e.target.classList.contains(t.replace(".",""))}))&&E(e)};w.reset=function(){n.Z.wrap.control.Geolocation.prototype.setGeotracking=w._setGeotracking,n.Z.wrap.control.Geolocation.prototype.simulateTrack=w._wrap_simulateTrack,w.simulateTrack=w._simulateTrack,w.displayTrackProfile=w._displayTrackProfile,S.forEach((function(e){document.removeEventListener("click",b)})),w.off(w.const.event.IMPORTEDTRACK,E)},document.addEventListener("click",b),w.on(w.const.event.IMPORTEDTRACK,E),w._setGeotracking=n.Z.wrap.control.Geolocation.prototype.setGeotracking,n.Z.wrap.control.Geolocation.prototype.setGeotracking=function(e){w._setGeotracking.call(w.wrap,e),e?w.on(w.const.event.POSITIONCHANGE,L.bind(r)):(w.off(w.const.event.POSITIONCHANGE,L.bind(r)),r.view3D.geotrackingEntity&&(r.viewer.entities.removeById(r.view3D.geotrackingEntity.id),delete r.view3D.geotrackingEntity))},w._displayTrackProfile=w.displayTrackProfile,w.displayTrackProfile=function(e,t){return null!=t&&t.resized&&x.call(r,{target:{className:"stop"},custom:!0}),w._displayTrackProfile.call(w,e,t)};const e=w.getSelectedTrackItem();var C;e&&w.hasElevation&&w.displayTrackProfile.call(r,e,{resized:!0}),w._simulateTrack=w.simulateTrack,w.simulateTrack=function(e){var t=this.view3D.linked2DControls.geolocation;t.map.toast(t.getLocaleString("threed.interactionSimulation"),{type:i.Z.msgType.INFO}),this.viewer.clock.shouldAnimate&&this.view3D.trackDataSource&&(C(),x.call(this,{target:{className:"stop"},custom:!0})),t.simulationSpeed=1,t.drawTrack(e,!1).then(function(){if(t.wrap.simulateTrack(),t.trackLayer&&t.trackLayer.features){var r=t.trackLayer.features.find((function(e){return e instanceof l.Z}));r&&R.call(this,r.geometry,r.wrap.feature.getGeometry().layout,"track",t.markerStyle,t.lineStyle,t.walkingSpeed).then(function(t){var i=t.czml,o=t.totalDistance,a=t.coordinates2D;this.view3D.trackDataSource=new cesium.DataSourceCollection;var s=new cesium.DataSourceDisplay({scene:this.viewer.scene,dataSourceCollection:this.view3D.trackDataSource});this.viewer.scene.preRender.addEventListener((function(e,t){s.update(t)})),this.view3D.trackDataSource.add(cesium.CzmlDataSource.load(i)).then(function(t,r,i){var a,s;this.viewer.clock.shouldAnimate=!1,a=i.clock.startTime,s=i.clock.stopTime,this.viewer.clock.startTime=a.clone(),this.viewer.clock.stopTime=s.clone(),this.viewer.clock.currentTime=a.clone(),this.viewer.clock.clockStep=cesium.ClockStep.TICK_DEPENDENT,this.viewer.clock.clockRange=cesium.ClockRange.CLAMPED,this.viewer.clock.multiplier=1;var l=i.entities.values[0];l.layout=t,l.tagLI=e,l.availability=new cesium.TimeIntervalCollection([new cesium.TimeInterval({start:a,stop:s})]),this.viewer.trackedEntity&&(this.viewer.entities.removeById(this.viewer.trackedEntity.id),this.viewer.trackedEntity=null),this.viewer.entities.add(l),this.viewer.flyTo(l).then(function(){function e(e,t){for(var r,i=0,o=this.view3D.view2DCRS!==this.view3D.crs?n.Z.Util.reproject(e[0],this.view3D.view2DCRS,this.view3D.crs):e[0],a=new cesium.Cartographic.fromDegrees(o[0],o[1]),s=1;s<e.length;s++){o=this.view3D.view2DCRS!==this.view3D.crs?n.Z.Util.reproject(e[s],this.view3D.view2DCRS,this.view3D.crs):e[s];var c=new cesium.Cartographic.fromDegrees(o[0],o[1]);if(i+=new cesium.EllipsoidGeodesic(a,c).surfaceDistance,a=c,i>t){r=e[s-1];break}}if(r){var u=l.layout===ol.geom.GeometryLayout.XYZM||l.layout===ol.geom.GeometryLayout.XYZ?2:-1;if(u>-1)return r[u]}return 0}this.viewer.trackedEntity=l;var t,i=0;C=this.viewer.scene.preUpdate.addEventListener(function(n,a){const s=this.view3D.linked2DControls.geolocation.getSelectedTrackItem();if(!s||s.getAttribute("data-id")!==l.tagLI.getAttribute("data-id")||cesium.JulianDate.greaterThanOrEquals(a,l.availability.stop))C(),x.call(this,{target:{className:"stop"},custom:!0});else if(this.viewer.clock.shouldAnimate&&l.isAvailable(a)){t||(t=cesium.Cartographic.fromCartesian(cesium.Property.getValueOrUndefined(l.position,l.availability.start)));const n=cesium.Cartographic.fromCartesian(cesium.Property.getValueOrUndefined(l.position,a));this.view3D.linked2DControls.geolocation.hasElevation&&(l.layout===ol.geom.GeometryLayout.XYZM||(l.layout,ol.geom.GeometryLayout.XYM),this.view3D.linked2DControls.geolocation.setChartProgress({p:[t.longitude,t.latitude,t.height],d:i},[n.longitude,n.latitude,e.call(this,r,i)],o,(l.layout===ol.geom.GeometryLayout.XYZM||l.layout===ol.geom.GeometryLayout.XYM)&&this.view3D.linked2DControls.geolocation.getTimeInterval(cesium.JulianDate.toDate(l.availability.start),cesium.JulianDate.toDate(a)))),i+=new cesium.EllipsoidGeodesic(t,n).surfaceDistance,t=n,this.viewer.scene.requestRender()}}.bind(this)),this.viewer.clock.shouldAnimate=!0}.bind(this)),this.viewer.scene.requestRender()}.bind(this,r.wrap.feature.getGeometry().layout,a))}.bind(this))}}.bind(this))}.bind(r),w._wrap_simulateTrack=n.Z.wrap.control.Geolocation.prototype.simulateTrack,n.Z.wrap.control.Geolocation.prototype.simulateTrack=function(){}}else{const e=r.view3D.linked2DControls.geolocation.getSelectedTrackItem();e&&r.view3D.linked2DControls.geolocation.hasElevation&&w._displayTrackProfile.call(r.view3D.linked2DControls.geolocation,e,!0)}}},O=function(){var e=this;e.map.workLayers.filter((function(e){return e instanceof f.Z})).forEach((function(t){t.owner&&(t.owner instanceof n.Z.control.DrawMeasureModify||t.owner instanceof n.Z.control.Draw)&&(t.owner.wrap.interation3D=new e.map.view3D.UI.DrawControl),t.features.forEach((function(t){e.view3D.addFeature.call(e.view3D,t)}))}))};var I,M,Z;const k=function(e){var t=this,r=200,i=function(e){var t=this,r=new cesium.Cartesian2(t.viewer.scene.canvas.clientWidth/2,t.viewer.scene.canvas.clientHeight/2);t.view3D.zoomToCartesian.call(t,{endPosition:r},e)};e?(I=function(e){var t=this;e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault();var r=t.view3D.view2DCRS;t.map.options.crs!==t.view3D.view2DCRS&&(r=t.map.options.crs);var i=n.Z.Util.reproject(t.map.options.initialExtent.slice(0,2),r,t.view3D.crs),o=n.Z.Util.reproject(t.map.options.initialExtent.slice(2),r,t.view3D.crs),a=cesium.Rectangle.fromDegrees(i[0],i[1],o[0],o[1]);return t.view3D.flyToRectangle.call(t,a,{duration:.1}),!1}.bind(t),M=function(e){i.call(t,r)}.bind(t),Z=function(e){i.call(t,-r)}.bind(t),document.querySelectorAll("."+n.Z.control.NavBarHome.prototype.CLASS+"-btn").forEach((function(e){e.addEventListener("click",I)})),document.querySelectorAll("."+n.Z.control.NavBar.prototype.CLASS+"-btn-zoomin").forEach((function(e){e.addEventListener("click",M)})),document.querySelectorAll("."+n.Z.control.NavBar.prototype.CLASS+"-btn-zoomout").forEach((function(e){e.addEventListener("click",Z)}))):(document.querySelectorAll("."+n.Z.control.NavBarHome.prototype.CLASS+"-btn").forEach((function(e){e.removeEventListener("click",I)})),document.querySelectorAll("."+n.Z.control.NavBar.prototype.CLASS+"-btn-zoomin").forEach((function(e){e.removeEventListener("click",M)})),document.querySelectorAll("."+n.Z.control.NavBar.prototype.CLASS+"-btn-zoomout").forEach((function(e){e.removeEventListener("click",Z)})))},F=function(e){return i.Z.event.MOUSEMOVE===e?n.Z.Util.detectMobile()?cesium.ScreenSpaceEventType.LEFT_CLICK:cesium.ScreenSpaceEventType.MOUSE_MOVE:i.Z.event.CLICK===e?cesium.ScreenSpaceEventType.LEFT_CLICK:e};return{container:null,crs:"EPSG:4326",crsPattern:/(EPSG\:?4326)/i,view2DCRS:null,customRender:null,baseLayer:null,workLayers:[],vector2DLayers:[],vector2DFeatures:{},linked2DControls:{},isLoadingTiles:function(){var e=this.viewer.scene.globe._surface;return!e._tileProvider.ready||e._tileLoadQueueHigh.length>0||e._tileLoadQueueMedium.length>0||e._tileLoadQueueLow.length>0||e._debug.tilesWaitingForChildren>0},loadViewer:function(){const e=this;return new Promise((function(t,o){e.viewer?t(e.viewer):Promise.all([r.e(1710),r.e(8298)]).then(r.bind(r,8298)).then((async function(r){const o=r.default;var s=null,c=null;try{s=await o.Resource.fetchJson({url:n.Z.apiLocation+"resources/data/contornoNavarra.json"}).then((function(e){return e&&e.features&&e.features.length>0?e.features[0].geometry.coordinates:[]}))}catch(e){console.warn("No se ha encontrado contorno de Navarra")}try{c=await o.Resource.fetchJson({url:n.Z.apiLocation+"resources/data/contornoEspana.json"}).then((function(e){return e&&e.features&&e.features.length>0?e.features[0].geometry.coordinates:[]}))}catch(e){console.warn("No se ha encontrado contorno de Espaa")}o.ApproximateTerrainHeights.initialize().then((function(){e.terrainFallback&&e.terrainFallback;const r=[s,c].filter((e=>null!=e));var p;e.terrainFallback&&r.length?p=new o.MergeTerrainProvider(e.terrain,e,{boundaries:r,fallback:e.terrainFallback}):(e.terrainFallback&&!r.length&&console.warn("Se ha definido fallckback de terreno pero no se ha especificado contorno"),(p=new o.CesiumTerrainProvider({url:e.terrain.url.trim()})).sampleTerrainMostDetailed=function(e){return o.sampleTerrainMostDetailed(p,e)},p.attributions={},e.terrain.attributions&&(p.getAttribution=function(){return p.attributions},p.attributions=e.terrain.attributions,e.map.trigger(i.Z.event.TERRAINPROVIDERADD,{terrainProvider:p})));var h=new o.Globe;h.baseColor=o.Color.WHITE,h.enableLighting=!1,h.tileCacheSize=1e3,h.maximumScreenSpaceError=5,e.viewer=e.view3D.viewer=new o.Viewer(e.selectors.divThreedMap,{terrainProvider:p,terrainExaggeration:1,animation:!1,timeline:!1,fullscreenButton:!1,baseLayerPicker:!1,imageryProvider:!1,navigationInstructionsInitiallyVisible:!1,navigationHelpButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,selectionIndicator:!1,globe:h,requestRenderMode:!0,maximumRenderTimeChange:1/0}),e.viewer.scene.backgroundColor=o.Color.WHITE,e.viewer.scene.screenSpaceCameraController.enableCollisionDetection=!0,e.viewer.scene.screenSpaceCameraController.maximumZoomDistance=1e6,e.viewer.scene.imageryLayers.removeAll(),e.viewer.terrainProvider.errorEvent.addEventListener((function(e){if(e.error)switch(e.error.statusCode){case 403:case 404:console.log("es un 404 de terreno")}}),e),e.viewer.scene.renderError.addEventListener((function(e,t){var r=this;t&&18===t.code||(r.divThreedMap.classList.remove(r.classes.LOADING),r.map.toast(r.getLocaleString("fi.error"),{type:i.Z.msgType.ERROR}),r.unapply())}),e),e.viewer.readyPromise=new Promise((function(t,r){e.view3D.tileLoadingHandler=new o.EventHelper,e.view3D.tileLoadingHandler.add(e.viewer.scene.globe.tileLoadProgressEvent,function(r){e.waiting||(e.waiting=e.map.getLoadingIndicator().addWait()),(e.viewer.scene.terrainProvider.allReady||!e.viewer.scene.terrainProvider.allReady&&e.viewer.scene.terrainProvider.ready)&&0===r?(e.map.getLoadingIndicator().removeWait(e.waiting),delete e.waiting,t(),e.events.trigger(i.Z.event.TERRAINLOADED,{})):e.events.trigger(i.Z.event.TERRAINRECEIVING,{})}.bind(e))})),k.call(e,!0),document.querySelectorAll(".cesium-viewer-bottom").forEach((function(e){e.parentElement.removeChild(e)})),e.view3D._event2DHandler=_.bind(e),e.map.on(v.join(" "),e.view3D._event2DHandler),P.call(e,i.Z.view.THREED),e.viewer.readyPromise.then((function(){O.call(e)})),e.view3D.getScene=function(){return e.viewer.scene},e.view3D.getFovCoords=function(t){var r=e.viewer.scene.canvas,n=new o.Cartesian2(0,r.clientHeight-1),i=new o.Cartesian2(r.clientWidth-1,r.clientHeight-1),a=[n,i,new o.Cartesian2(r.clientWidth-1,0),new o.Cartesian2(0,0)].map((function(r){return S.call(e,r,t)})).filter((function(e){return null!==e}));if(a.length&&a.length<4){var s=w.call(e,{nearMapCoords:a[0],bottomPixel:n,cameraPosition:e.view3D.cameraControls._coordsXY}),l=w.call(e,{nearMapCoords:a[1],bottomPixel:i,cameraPosition:e.view3D.cameraControls._coordsXY});s&&l&&(a[2]=l,a[3]=s)}return a},e.view3D.getCameraData=function(){const t=e.viewer.scene.camera,r=t.position,n=o.Ellipsoid.WGS84.cartesianToCartographic(r);return{latitude:o.Math.toDegrees(n.latitude),longitude:o.Math.toDegrees(n.longitude),height:n.height,heading:t.heading*(180/Math.PI),pitch:t.pitch*(180/Math.PI)}},e.view3D.Coordinates2DTo3D=function(t){const r=t instanceof o.Cartesian2?t:new o.Cartesian2(t[0],t[1]);var n=e.viewer.camera.getPickRay(r),i=e.viewer.scene.globe.pick(n,e.viewer.scene);if(i){var a,s=o.Ellipsoid.WGS84.cartesianToCartographic(i);return a=o.Math.toDegrees(s.latitude),{lon:o.Math.toDegrees(s.longitude),lat:a,ele:Math.round(s.height)}}},e.view3D.setMarker=function(t,r,i=null,a){return t instanceof o.Cartesian3||t instanceof o.Cartesian2||(t=o.Cartesian3.fromDegrees(t[0],t[1])),i?(i.position=t,i.setImage(1e3*Math.random(),r),i.pixelOffset=new o.Cartesian2(0,20),i.show=!0):i=e.map.view3D.addNativeFeature.call(e.map,{position:t,billboard:{image:r,eyeOffset:new o.Cartesian3(0,0,-100),verticalOrigin:o.VerticalOrigin.BOTTOM,heightReference:o.HeightReference.CLAMP_TO_GROUND,pixelOffset:new o.Cartesian2(0,20),id:a||n.Z.getUID()}}),e.viewer.scene.requestRender(),i},e.view3D.setCenter=function(t){const r=e.map.view3D.getScene();var n=o.Cartesian3.fromDegrees(t[0],t[1],e.view3D.getHeightFromMDT(t));const i=r.globe.pick(r.camera.getPickRay(new o.Cartesian2(e.view3D.container.clientWidth/2,e.view3D.container.clientHeight/2)),r),a=o.Cartesian3.distance(i,r.camera.positionWC);var s=new o.Matrix4;r.camera.transform.clone(s),r.camera.lookAt(n,new o.HeadingPitchRange(r.camera.heading,r.camera.pitch,a)),r.camera.lookAtTransform(s)},e.view3D.setLabel=function(t,r){e.view3D.threeDDraw.setLabel(t,r)},e.view3D.setStyle=function(t,r){e.view3D.threeDDraw.setStyle(r,t)},e.view3D.getLength=function(e){return e.polyline.positions.getValue().reduce((function(e,t,r,n){return 0===r?0:e+new o.EllipsoidGeodesic(o.Cartographic.fromCartesian(n[r-1]),o.Cartographic.fromCartesian(n[r]),o.Ellipsoid.WGS84).surfaceDistance}),0)},e.view3D.getArea=function(e){const t=e.polygon.hierarchy.getValue();return Math.sqrt(Math.pow(o.PolygonPipeline.computeArea2D(t.positions),2))};const f=function(e){const t=o.Cartographic.fromCartesian(e);return[o.Math.toDegrees(t.longitude),o.Math.toDegrees(t.latitude)]},g=function(e,t){let r;switch(t){case"polyline":r=new l.Z(e.map((function(e){return f(e)})));break;case"polygon":r=new u.Z(e.map((function(e){return f(e)})));break;case"point":r=new a.Z(f(e[0]))}return r};e.view3D.UI={DrawControl:function(t,r){return e.view3D.threeDDraw=new N(e.viewer,t),e.view3D.threeDDraw.addEventListener("drawend",(t=>{e.map.activeControl.trigger(i.Z.event.MEASURE,t.detail.measurements);const n=g(t.detail.positions,t.detail.type);e.map.activeControl.trigger(i.Z.event.DRAWEND,{feature:n}),r(n).then((function(r){d(e.view3D,r,t.detail.entity),t.detail.entity.name=r.id,r.setStyle(t.detail.entity.getStyle())}))})),e.view3D.threeDDraw.addEventListener("drawstart",(t=>{e.map.activeControl.trigger(i.Z.event.DRAWSTART,{})})),e.view3D.threeDDraw.addEventListener("drawupdate",(t=>{e.map.activeControl.trigger(i.Z.event.MEASUREPARTIAL,t.detail.measurements)})),e.view3D.threeDDraw.addEventListener("point",(t=>{const r=o.Cartographic.fromCartesian(t.detail.position);e.map.activeControl.trigger(i.Z.event.POINT,{point:[o.Math.toDegrees(r.longitude),o.Math.toDegrees(r.latitude)]})})),e.view3D.threeDDraw.addEventListener("drawmodify",(t=>{const r=g(t.detail.positions,t.detail.type),n=t.detail.entity._wrap.parent;n.setCoordinates(r.getCoordinates()),e.map.activeControl.trigger(i.Z.event.FEATUREMODIFY,{feature:n,layer:n.layer})})),e.view3D.threeDDraw},SelectControl:function(){var t=null,r=null;const n=function(e){return e.polygon?new u.Z(e.polygon.hierarchy.getValue().positions.map((function(e){return f(e)})),{id:e.id}):e.polyline?new l.Z(e.polyline.positions.getValue().map((function(e){return f(e)})),{id:e.id}):new a.Z(f(e.position.getValue(o.JulianDate.now)),{id:e.id})},s=function(){var e;null===(e=t)||void 0===e||e._wrap.parent.toggleSelectedStyle(!1)},c=function(a){e.map.on(i.Z.event.FEATUREREMOVE,p),e.view3D.threeDDraw.vertexRemove(a),e.view3D.threeDDraw.entityForEdit&&!a&&e.view3D.threeDDraw.activate(),e.view3D.threeDDraw.activeSelectMode((function(e){var i;o.defined(e)&&(t=e,r({selected:[((null===(i=e._wrap)||void 0===i?void 0:i.parent)||n(e)).wrap.feature],deselected:[]}))}))},p=function(r){var n;null!==(n=r.feature.wrap)&&void 0!==n&&n.feature3D&&(e.view3D.threeDDraw.remove(r.feature.wrap.feature3D),t=null)},h=function(){s(),e.view3D.threeDDraw.deactivateSelectMode(),e.view3D.threeDDraw.deactivateEditing(),e.map.off(i.Z.event.FEATUREREMOVE,p),e.view3D.threeDDraw.editMode=!1,e.map.activeControl.deactivate()};return{activate:c,setActive:function(e){e?c():h()},deactivate:h,on:function(e,t){r=t},getFeatures:function(){var e;return o.defined(t)?new ol.Collection([((null===(e=t.id._wrap)||void 0===e?void 0:e.parent)||n(t)).wrap.feature]):new ol.Collection}}}},t(e.viewer)})),o.Entity.prototype.getStyle=function(){var e,t;const r={};return this.polygon?Object.assign(r,{fillColor:this.polygon.material.getValue().color.toCssHexString().substring(0,7),fillOpacity:this.polygon.material.getValue().color.alpha,strokeColor:this.polyline.material.getValue().color.toCssHexString().substring(0,7),strokeWidth:this.polyline.width.getValue()}):this.polyline?Object.assign(r,{strokeColor:this.polyline.material.getValue().color.toCssHexString().substring(0,7),strokeWidth:this.polyline.width.getValue()}):this.point&&Object.assign(r,{fillColor:this.point.color.getValue().toCssHexString().substring(0,7),fillOpacity:this.point.color.getValue().alpha,strokeColor:this.point.outlineColor.getValue().toCssHexString().substring(0,7),strokeWidth:this.point.outlineWidth.getValue(),radius:(this.point.outlineWidth.getValue()+this.point.pixelSize.getValue())/2}),this.label&&(r.fontColor=null===(e=this.label)||void 0===e||null===(t=e.fillColor)||void 0===t?void 0:t.getValue().toCssHexString()),r}}))}))},setBaseLayer:function(e){var t=this,r=function(e){return m(e,t.view3D.crs)||(null!==e.getFallbackLayer()&&m(e.getFallbackLayer(),t.view3D.crs)?e=e.getFallbackLayer():(t.map.toast(t.getLocaleString("threed.crsNoCompatible",{name:e.title})),e=null)),e};t.view3D.baseLayer?(t.viewer.scene.imageryLayers.contains(t.view3D.baseLayer)&&(t.viewer.scene.imageryLayers.raiseToTop(t.view3D.baseLayer),t.viewer.scene.imageryLayers.remove(t.view3D.baseLayer,!0)),e instanceof f.Z?(t.view3D.baseLayer=t.Consts.BLANK_BASE,t.map.getLoadingIndicator().removeWait(t.waiting),delete t.waiting):(e=r(e))&&(e.map=t.map,e.isBase=!0,t.view3D.addLayer.call(t,e))):e.type===i.Z.layerType.WMTS||e.type===i.Z.layerType.WMS?e.options.relatedWMTS?(t.map.baseLayer=e=t.map.getLayer(e.options.relatedWMTS),t.map.trigger(i.Z.event.BASELAYERCHANGE,{layer:t.map.baseLayer})):(e=r(e))&&(e.isBase||(e.isBase=!0),t.view3D.addLayer.call(t,e)):t.view3D.baseLayer=t.Consts.BLANK_BASE,G.baseMap=t.map.baseLayer},addLayer:function(e){var t=this;switch(!0){case i.Z.layerType.VECTOR==e.type:t.view3D.vector2DLayers.push(e);break;case i.Z.layerType.WMTS==e.type:case i.Z.layerType.WMS==e.type:e.isBase||e.isCompatible(t.view3D.crs)?c.convert(e,t.view3D.crs).then((function(r){if(r){void 0!==r.enablePickFeatures&&(r.enablePickFeatures=!1,r.tcLayer=e),e.isBase&&t.view3D.baseLayer&&t.viewer.scene.imageryLayers.contains(t.view3D.baseLayer)&&(t.viewer.scene.imageryLayers.raiseToTop(t.view3D.baseLayer),t.viewer.scene.imageryLayers.remove(t.view3D.baseLayer,!0)),cesium.TrustedServers.add(new URL("http://"+r.url).host,"80"),cesium.TrustedServers.add(new URL("https://"+r.url).host,"443"),cesium.TrustedServers.add("http://localhost","8080");var n=t.viewer.scene.imageryLayers.addImageryProvider(r);e.isBase?(t.view3D.baseLayer=n,t.viewer.scene.imageryLayers.lowerToBottom(n)):(n.show=e.getVisibility(),n.alpha=e.getOpacity(),t.view3D.workLayers.push(n))}})):t.map.toast(t.getLocaleString("threed.crsNoCompatible",{name:e.layerNames}))}},removeLayer:function(t){var r=this;switch(!0){case i.Z.layerType.VECTOR==t.type:if(r.view3D.vector2DFeatures&&e.call(r.view3D.vector2DFeatures,t.id)){for(var n in r.view3D.vector2DFeatures[t.id])r.view3D.vector2DFeatures[t.id][n].forEach((e=>r.view3D.removeFeature.call(r,e)));delete r.view3D.vector2DFeatures[t.id]}break;case i.Z.layerType.WMTS==t.type:case i.Z.layerType.WMS==t.type:for(var o=0;o<r.view3D.workLayers.length;o++)if(t.names&&r.view3D.workLayers[o].imageryProvider.layers.join(",")===t.names.join(",")||t.title&&r.view3D.workLayers[o].imageryProvider.layers.join(",")===t.title){r.viewer.scene.imageryLayers.raiseToTop(r.view3D.workLayers[o]),r.viewer.scene.imageryLayers.remove(r.view3D.workLayers[o],!0),r.view3D.workLayers.splice(o,1);break}}},setRenderOptionsLayer:function(t,r){var n=this;switch(!0){case i.Z.layerType.VECTOR==t.type:if(n.view3D.vector2DFeatures[t.id]){for(var o in n.view3D.vector2DFeatures[t.id])n.view3D.vector2DFeatures[t.id][o].forEach((e=>n.view3D.setRenderOptionsFeature(e,{show:t.getVisibility()})));n.viewer.scene.requestRender()}break;case i.Z.layerType.WMTS==t.type:case i.Z.layerType.WMS==t.type:for(var a=0;a<n.view3D.workLayers.length;a++){const i=Array.isArray(n.view3D.workLayers[a].imageryProvider.layers)?n.view3D.workLayers[a].imageryProvider.layers.join(","):n.view3D.workLayers[a].imageryProvider.layers;if(t.names&&i===t.names.join(",")||t.title&&i===t.title){e.call(r,"visibility")&&(n.view3D.workLayers[a].show=r.visibility),e.call(r,"opacity")&&(n.view3D.workLayers[a].alpha=r.opacity);break}}n.viewer.scene.requestRender()}},flyToMapCoordinates:function(e){var t=this,r=t.view3D.view2DCRS!==t.view3D.crs?n.Z.Util.reproject(e,t.view3D.view2DCRS,t.view3D.crs):e,i=cesium.Cartesian3.fromDegrees(r[0],r[1],t.viewer.camera.positionCartographic.height),o=t.viewer.camera;o.flyTo({destination:i,orientation:{heading:o.heading,pitch:o.pitch}})}.bind(t),flyToRectangle:function(e,t){const r=this;return r.viewer.scene.camera.cancelFlight(),new Promise((function(n,i){t=t||{};var o=cesium.Math.EPSILON3;e.east===e.west&&(e.east+=o,e.west-=o),e.north===e.south&&(e.north+=o,e.south-=o);var a=.2,s=e.width*a/2,l=e.height*a/2;e.east-=s,e.west+=l,e.north+=l,e.south-=l;var c=r.viewer.scene,u=c.camera,p=u.getRectangleCameraCoordinates(e),h=cesium.Ellipsoid.WGS84.cartesianToCartographic(p);cesium.when(c.globe.terrainProvider.sampleTerrainMostDetailed([cesium.Rectangle.center(e)]),(function(e){var i={longitude:h.longitude,latitude:h.latitude,height:h.height+e[0].height||0};u.flyTo({duration:t.duration||1,destination:cesium.Ellipsoid.WGS84.cartographicToCartesian(i),complete:function(){var e=cesium.Math.toRadians(50),t=A(this.viewer.scene);t=cesium.Matrix4.fromTranslation(t),this.view3D.rotateAroundAxis(this.viewer.scene.camera,-e,this.viewer.scene.camera.right,t,{duration:250,callback:function(){n()}})}.bind(r)})}))}))}.bind(t),zoomToCartesian:function(e,t){var r=this,n=r.viewer.scene;if(!e||!e.endPosition){var i=n.canvas,o=new cesium.Cartesian2(i.clientWidth/2,i.clientHeight/2);e={endPosition:o}}var a=n.camera.getPickRay(e.endPosition),s=n.globe.pick(a,n);if(s){var l=cesium.Cartesian3.distance(a.origin,s);if(l<1)return;r.view3D._zoomTo||(r.view3D._zoomTo={amount:0}),r.view3D._zoomTo.direction=t>0?1:0,r.view3D._zoomTo.amount+=5*l/100,r.view3D._zoomTo.endPosition=e.endPosition}var c=function(t){var r=this,n=r.viewer.scene,i=n.camera.getPickRay(e.endPosition||t.endPosition),o=n.globe.pick(i,n);if(o){if(cesium.Cartesian3.distance(i.origin,o)<1)return;var a=n.camera.position,s=(n.camera.direction,new cesium.Cartesian3),l=s;cesium.Cartesian3.multiplyByScalar(i.direction,1==t.direction?t.amount:-t.amount,l),cesium.Cartesian3.add(a,l,s);var c=new cesium.Ray(s,i.direction),u=n.globe.pick(c,n);if(u){var p=function(){this.view3D._zoomTo={direction:1,amount:0,endPosition:{}}};cesium.Cartesian3.distance(s,u)<1||Math.abs(cesium.Ellipsoid.WGS84.cartesianToCartographic(s).height)<n.screenSpaceCameraController.minimumZoomDistance?p.call(r):r.viewer.camera.flyTo({destination:s,orientation:{heading:n.camera.heading,pitch:n.camera.pitch,roll:n.camera.roll},duration:1,easingFunction:cesium.EasingFunction.LINEAR_NONE,complete:function(e){this.view3D._zoomTo={direction:1,amount:0,endPosition:{}}}.bind(r,cesium.Cartesian3.distance(s,u))})}}};setTimeout(function(){c.call(r,r.view3D._zoomTo)}.bind(r),50)},rotateAroundAxis:function(e,t,r,n,i){return C(e,t,r,n,i)},addFeature:function(e,t){var r=this,n=function(){var t=p.convert(r.viewer.scene,e,r.view2DCRS,r.crs);if(t)if("function"==typeof t.geometry)t.geometry(r.viewer.terrainProvider).then((function(t){if(t instanceof Array)t.forEach((function(t){t instanceof Array?t.forEach((function(t){t=h.call(r,t),d(r,e,t)})):(t=h.call(r,t),d(r,e,t))}));else{var n=h.call(r,t);d(r,e,n)}}));else if(t.geometry instanceof Array)t.geometry.forEach((function(t){t=h.call(r,t),d(r,e,t)}));else{var n=h.call(r,t.geometry);d(r,e,n)}};if(r.linked2DControls.featureInfo&&r.linked2DControls.featureInfo.get2DMarker()===e||r.linked2DControls.featureInfo&&r.linked2DControls.featureInfo.isPending())setTimeout((function(){r.linked2DControls.featureInfo.get2DMarker()!==e&&n()}),5);else{if(r.linked2DControls.geolocation&&r.linked2DControls.geolocation.geotrackingLayer===e.layer&&e instanceof l.Z)return;n()}},removeFeature:function(e){var t=this;if(t.viewer&&e){switch(!0){case e instanceof cesium.GroundPrimitive:t.viewer.scene.groundPrimitives.remove(e);break;case e instanceof cesium.Billboard:t.viewer.billboardCollection.remove(e);break;case e instanceof cesium.Entity:break;case e instanceof Object:t.viewer.entities.removeById(e.id)}t.viewer.scene.requestRender()}},setRenderOptionsFeature:function(e,t){e&&(e.show=t.show)},addNativeFeature:function(e){return h.call(this.view3D,e)},setCameraFromMapView:function(){var e=this;e.viewer.scene.globe.terrainProvider.readyPromise.then((function(){var t=e.mapView.getCenter();if(t){var r=e.view3D.view2DCRS!==e.view3D.crs?n.Z.Util.reproject(t,e.view3D.view2DCRS,e.view3D.crs):t,i=E.call(e,e.mapView.getResolution()||0,cesium.Math.toRadians(r[0])),o=new cesium.Cartographic(cesium.Math.toRadians(r[0]),cesium.Math.toRadians(r[1]));e.viewer.scene.globe&&(o.height=e.viewer.scene.globe.getHeight(o)||0);var a=function(){if(e.map.on3DView){var t=cesium.Ellipsoid.WGS84.cartographicToCartesian(o),r={pitch:cesium.Math.toRadians(-90),heading:-e.mapView.getRotation(),roll:0};e.viewer.camera.setView({destination:t,orientation:r}),e.viewer.camera.moveBackward(i)}};0===o.height?n.Z.loadJS(!n.Z.tool||!n.Z.tool.Elevation,n.Z.apiLocation+"TC/tool/Elevation",(function(){e.view3D.elevationTool=new n.Z.tool.Elevation,e.view3D.elevationTool.getElevation({crs:e.view3D.crs,coordinates:[r]}).then((function(e){e&&e.length>0&&(o.height=e[0][2]?e[0][2]:0,a())})).catch((e=>console.log(e)))})):a()}}))},setViewFromCameraView:function(){const e=this;var t=cesium.Ellipsoid.WGS84,r=e.viewer.scene,i=T(r);if(!i){var o=e.viewer.scene.globe,a=e.viewer.camera.positionCartographic.clone(),s=o.getHeight(a);a.height=s||0,i=cesium.Ellipsoid.WGS84.cartographicToCartesian(a)}var l=cesium.Cartesian3.distance(i,e.viewer.camera.position),c=t.cartesianToCartographic(i),u=e.view3D.crs!==e.view3D.view2DCRS?n.Z.Util.reproject([cesium.Math.toDegrees(c.longitude),cesium.Math.toDegrees(c.latitude)],e.view3D.crs,e.view3D.view2DCRS):[cesium.Math.toDegrees(c.longitude),cesium.Math.toDegrees(c.latitude)];return e.mapView.setCenter(u),e.mapView.setResolution(b.call(e,l,c?c.latitude:0)),Promise.resolve()},lookAt:function(e){const t=this;t.crs!==t.view2DCRS&&(e=n.Z.Util.reproject(e,t.view2DCRS,t.crs));var r=t.viewer.camera,i=r.positionCartographic.height,o=new cesium.Cartographic(cesium.Math.toRadians(e[0]),cesium.Math.toRadians(e[1]),i);r.flyTo({destination:cesium.Cartesian3.fromRadians(o.longitude,o.latitude,o.height),duration:1})},getInfoOnPickedPosition:function(e){var t=this;e&&(t.map.one(i.Z.event.DRAWTABLE,(function(e){t.map.getLoadingIndicator().removeWait(t.waiting),delete t.waiting})),t.view3D.linked2DControls.featureInfo.send.call(t,e).then((function(e){t.map.getLoadingIndicator().removeWait(t.waiting),delete t.waiting})))},on:function(e,t){const r=this,n=function(e){return r.viewer&&r.viewer.cesiumWidget?r.Coordinates2DTo3D(e.endPosition||e.position):null};r.eventHandlers||(r.eventHandlers={}),r.eventHandlers.handlerOfMovementConversion=new cesium.ScreenSpaceEventHandler(r.viewer.scene.canvas),r.eventHandlers.handlerOfMovementConversion.setInputAction((function(e){if(e.endPosition||e.position){if(r.viewer.trackedEntity)return;t(n(e))}else t(e)}),F(e))},getHeightFromMDT:function(e){const t=this;var r=new cesium.Cartographic(cesium.Math.toRadians(e[0]),cesium.Math.toRadians(e[1]));return t.viewer.scene.globe.getHeight(r)||0},addElevationMarker:function(e,t){const r=this;r.viewer&&!r.viewer.view3DElevationMarkerPromise&&(r.viewer.view3DElevationMarkerPromise=!0,r.viewer.readyPromise.then((function(){delete r.viewer.view3DElevationMarkerPromise;const i=r.view2DCRS!==r.crs?n.Z.Util.reproject(e,r.view2DCRS,r.crs):e;let o=new cesium.Entity({position:cesium.Cartesian3.fromDegrees(i[0],i[1]),name:"elevationMarker",point:{show:!0,color:cesium.Color.RED.withAlpha(.5),pixelSize:10,outlineColor:cesium.Color.WHITE,outlineWidth:2,heightReference:cesium.HeightReference.CLAMP_TO_GROUND}});t.view3DElevationMarker=h.call(r,o)})))},setElevationMarker:function(e,t){const r=this;r.viewer&&r.viewer.readyPromise.then((function(){if(t.view3DElevationMarker){const n=e;t.view3DElevationMarker.position=cesium.Cartesian3.fromDegrees(n[0],n[1],r.viewer.camera.positionCartographic.height),t.view3DElevationMarker.show||(t.view3DElevationMarker.show=!0),r.viewer.scene.requestRender()}else r.addElevationMarker(e,t)}))},hideElevationMarker:function(e){const t=this;t.viewer&&e.view3DElevationMarker&&t.viewer.readyPromise.then((function(){t.removeFeature.call(t,e.view3DElevationMarker),delete e.view3DElevationMarker}))},destroy:function(){var e=this;e.map.on3DView=!1,e.view3D.vector2DLayers=[],e.view3D.vector2DFeatures={},e.map.off(v.join(" "),e.view3D._event2DHandler),P.call(e,i.Z.view.DEFAULT),k.call(e,!1),Promise.all(e.map.baseLayers.map((function(t){return Promise.resolve(!m(t,e.view3D.view2DCRS))}))).then((function(t){let r;if(t.length>0){for(var o,a=0;a<e.map.baseLayers.length;a++)o||t[a]||(o=e.map.baseLayers[a]),e.map.baseLayers[a]&&(e.map.baseLayers[a].mustReproject=t[a]);r=!0;const l=function(t,o,a){const s={layer:o};a&&(s.fallbackLayer=a);var l=e.map.getControlsByClass(t?n.Z.control.BasemapSelector:n.Z.control.Coordinates);l.length>0&&(l[0]instanceof n.Z.control.Coordinates&&(r=!1),s.closeCallback=function(){e.map.trigger(i.Z.event.VIEWCHANGE,{view:i.Z.view.DEFAULT})},l[0].showProjectionChangeDialog(s))};var s=G.baseMap==e.Consts.BLANK_BASE?G.baseVector:G.baseMap;s.isCompatible(e.map.getCRS())?e.map.setBaseLayer(s):s.fallbackLayer?(s.getFallbackLayer(),s.getFallbackLayer().isCompatible(e.map.getCRS())?n.Z.confirm(e.getLocaleString("threed.changeBaselayer"),(function(){l(!1,s,s.fallbackLayer)}),(function(){e.map.setBaseLayer(s.fallbackLayer)})):l(!0,s)):l(!0,s)}G.baseMap="",e.view3D.baseLayer=null,e.view3D.workLayers=[],e.map.workLayers.filter((e=>{var t;return null===(t=e.features)||void 0===t?void 0:t.length})).forEach((function(t){t.features.forEach((t=>{var r;null!=t&&null!==(r=t.wrap)&&void 0!==r&&r.feature3D&&t.setCoordinates(n.Z.Util.reproject(t.geometry,e.view3D.crs,e.view3D.view2DCRS))}))})),e.view3D.cameraControls.unbind(),e.view3D.linked2DControls.featureInfo&&e.view3D.linked2DControls.featureInfo.reset(),e.view3D.linked2DControls.geolocation&&(e.view3D.linked2DControls.geolocation.isGeo=!1,e.view3D.linked2DControls.geolocation.reset()),e.view3D.tileLoadingHandler.removeAll(),delete e.view3D.tileLoadingHandler,e.viewer.destroy(),e.viewer=null,r&&e.map.trigger(i.Z.event.VIEWCHANGE,{view:i.Z.view.DEFAULT})}))}}}(),{init:t.init.bind(t),apply:t.apply.bind(t),unapply:t.unapply.bind(t),VIEWNAME:t.VIEWNAME}}()},3418:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var n=r(688),i=r(4436);const o={Map:function(e){var t=this;t.parent=e,t.map=null,t.getMap=function(){return t._promise}},Layer:function(e){var t=this;t.parent=e,t.layer=null,i.Z.call(t),t.getLayer=function(){return t.layer?Promise.resolve(t.layer):t._promise},t.setLayer=function(e){t.layer=e}},layer:{Raster:function(){o.Layer.apply(this,arguments)},Vector:function(){o.Layer.apply(this,arguments)}},Control:function(e){this.parent=e},control:{Click:function(){o.Control.apply(this,arguments)},ScaleBar:function(){o.Control.apply(this,arguments)},NavBar:function(){o.Control.apply(this,arguments)},NavBarHome:function(){o.Control.apply(this,arguments)},Coordinates:function(){o.Control.apply(this,arguments)},Search:function(){o.Control.apply(this,arguments)},Measure:function(){o.Control.apply(this,arguments)},OverviewMap:function(){o.Control.apply(this,arguments)},FeatureInfo:function(){o.Control.apply(this,arguments)},Popup:function(){o.Control.apply(this,arguments)},GeometryFeatureInfo:function(){o.Control.apply(this,arguments)},Geolocation:function(){o.Control.apply(this,arguments)},Draw:function(){o.Control.apply(this,arguments)},Modify:function(){o.Control.apply(this,arguments)},OfflineMapMaker:function(){o.Control.apply(this,arguments)},Edit:function(){o.Control.apply(this,arguments)},ResultsPanel:function(){o.Control.apply(this,arguments)}},Feature:function(){},Geometry:function(){}};n.Z.inherit(o.Layer,i.Z),n.Z.inherit(o.layer.Raster,o.Layer),n.Z.inherit(o.layer.Vector,o.Layer),n.Z.inherit(o.control.Click,o.Control),n.Z.inherit(o.control.ScaleBar,o.Control),n.Z.inherit(o.control.NavBar,o.Control),n.Z.inherit(o.control.NavBarHome,o.Control),n.Z.inherit(o.control.Coordinates,o.Control),n.Z.inherit(o.control.Measure,o.Control),n.Z.inherit(o.control.OverviewMap,o.Control),n.Z.inherit(o.control.Popup,o.Control),n.Z.inherit(o.control.FeatureInfo,o.control.Click),n.Z.inherit(o.control.GeometryFeatureInfo,o.control.Click),n.Z.inherit(o.control.Geolocation,o.Control),n.Z.inherit(o.control.Draw,o.Control),n.Z.inherit(o.control.OfflineMapMaker,o.Control),n.Z.inherit(o.control.Edit,o.Control),n.Z.inherit(o.control.ResultsPanel,o.Control);const a=o},1455:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c});var n=r(5752),i=r.n(n);i().noConflict(),i().registerHelper("i18n",(function(e,t){const r=TC.i18n.currentLocale[e];return"string"==typeof r?t?new(i().SafeString)(r):r:e})),i().registerHelper("gt",(function(e,t){return e>t})),i().registerHelper("lt",(function(e,t){return e<t})),i().registerHelper("eq",(function(e,t){return e==t})),i().registerHelper("every",(function(){return Array.from(arguments).slice(0,arguments.length-1).every((e=>e))})),i().registerHelper("round",(function(e){return Math.round(e)})),i().registerHelper("lowerCase",(function(e){return e&&e.toLowerCase()})),i().registerHelper("startsWith",(function(e,t){return e&&e.toString().startsWith(t)})),i().registerHelper("isObject",(function(e){return e instanceof Object&&!Array.isArray(e)})),i().registerHelper("isEmpty",(function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0})),i().registerHelper("isArray",(function(e){return Array.isArray(e)})),i().registerHelper("isUrl",(function(e){return e&&/^(http|https|ftp|mailto)\:\/\//i.test(e)})),i().registerHelper("getYoutubeId",(function(e){if(e){const t=e.match(/^(?:https?:\/\/)?(?:m\.|www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/);if(t)return t[1]}return null})),i().registerHelper("getHeader",(function(e){if(e){const t=e.match(/^(h\d+)_/);if(t)return t[1]}return null}));const o=/(?:__(image|video|audio|embed)(?:_(\d+|auto)_(\d+|auto))?$)|(?:^(image|video|audio|embed)(?:_(\d+|auto)_(\d+|auto))?__)/,a=function(e){if(e&&"string"==typeof e){const t=e.match(o);if(t)return t[1]||t[4]}return null},s=function(e,t){if(e){const r=e.match(o);if(r){const e=r[t+1]||r[t+4];return"auto"!==e?e?e+"px":"auto":e}}return null},l=function(e,t,r){return a(e)===r||a(t)===r};i().registerHelper("isVideoAttribute",(function(e,t){return l(e,t,"video")})),i().registerHelper("isAudioAttribute",(function(e,t){return l(e,t,"audio")})),i().registerHelper("isImageAttribute",(function(e,t){return l(e,t,"image")})),i().registerHelper("isEmbedAttribute",(function(e,t){return l(e,t,"embed")})),i().registerHelper("hasDisplayName",(function(e){return e&&Object.prototype.hasOwnProperty.call(e,"displayName")&&Object.prototype.hasOwnProperty.call(e,"toString")})),i().registerHelper("getTagWidth",(function(e,t){let r=s(e,1);return r||(r=s(t,1)),r})),i().registerHelper("getTagHeight",(function(e,t){let r=s(e,2);return r||(r=s(t,2)),r})),i().registerHelper("removeSpecialAttributeTag",(function(e){if(!e)return null;if("string"==typeof e){const t=e.match(o);if(t){const r="__";return 0===t[0].indexOf(r)?e.substr(0,e.lastIndexOf(r)):e.substr(e.indexOf(r)+r.length)}}return e})),i().registerHelper("isKeyValue",(function(e){return e&&Object.prototype.hasOwnProperty.call(e,"value")&&"object"!=typeof e.value})),i()._getIdHelperIds=[],i().registerHelper("getId",(function(e){let t=i()._getIdHelperIds.find((t=>t.obj===e));return t||i()._getIdHelperIds.push(t={obj:e,id:TC.getUID()}),t.id})),i().registerHelper("countif",(function(e,t){const r=t?t.split(","):[];let n=0;for(let t in e)r.indexOf(t)<0&&n++;return n>0})),i().registerHelper("formatDateOrNumber",(function(e){return e&&/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])T(2[0-3]|[01][0-9]):[0-5][0-9]:[0-5][0-9](\.[0-9]{0,3}){0,1}Z$/.test(e)?new Date(e).toLocaleString(TC.i18n.currentLocaleKey&&TC.i18n.currentLocaleKey.length>2?TC.i18n.currentLocaleKey.substr(0,2):TC.i18n.currentLocaleKey,{hour12:!1}):e&&/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])Z$/.test(e)?(isNaN(Date.parse(e))&&(e=e.replace("Z","")),new Date(e).toLocaleDateString(TC.i18n.currentLocaleKey&&TC.i18n.currentLocaleKey.length>2?TC.i18n.currentLocaleKey.substr(0,2):TC.i18n.currentLocaleKey)):"number"==typeof e||"string"==typeof e&&!isNaN(e)?TC.Util.formatNumber(e,TC.i18n.currentLocaleKey):e})),i().registerHelper("formatNumber",(function(e,t){return e.toLocaleString(t)}));const c=i()},5155:(e,t)=>{"use strict";t.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,o=l(e),a=o[0],s=o[1],c=new i(function(e,t,r){return 3*(t+r)/4-r}(0,a,s)),u=0,p=s>0?a-4:a;for(r=0;r<p;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;2===s&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,c[u++]=255&t);1===s&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t);return c},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],a=16383,s=0,l=n-i;s<l;s+=a)o.push(c(e,s,s+a>l?l:s+a));1===i?(t=e[n-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return o.join("")};for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,s=o.length;a<s;++a)r[a]=o[a],n[o.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function c(e,t,n){for(var i,o,a=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return a.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},2486:(e,t,r)=>{"use strict";
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
const n=r(5155),i=r(4525),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.lW=l,t.h2=50;const a=2147483647;function s(e){if(e>a)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,l.prototype),t}function l(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return p(e)}return c(e,t,r)}function c(e,t,r){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!l.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const r=0|g(e,t);let n=s(r);const i=n.write(e,t);i!==r&&(n=n.slice(0,i));return n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(K(e,Uint8Array)){const t=new Uint8Array(e);return d(t.buffer,t.byteOffset,t.byteLength)}return h(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(K(e,ArrayBuffer)||e&&K(e.buffer,ArrayBuffer))return d(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(K(e,SharedArrayBuffer)||e&&K(e.buffer,SharedArrayBuffer)))return d(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return l.from(n,t,r);const i=function(e){if(l.isBuffer(e)){const t=0|f(e.length),r=s(t);return 0===r.length||e.copy(r,0,0,t),r}if(void 0!==e.length)return"number"!=typeof e.length||X(e.length)?s(0):h(e);if("Buffer"===e.type&&Array.isArray(e.data))return h(e.data)}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return l.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function p(e){return u(e),s(e<0?0:0|f(e))}function h(e){const t=e.length<0?0:0|f(e.length),r=s(t);for(let n=0;n<t;n+=1)r[n]=255&e[n];return r}function d(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');let n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,l.prototype),n}function f(e){if(e>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return 0|e}function g(e,t){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||K(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return V(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return z(e).length;default:if(i)return n?-1:V(e).length;t=(""+t).toLowerCase(),i=!0}}function y(e,t,r){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return O(this,t,r);case"utf8":case"utf-8":return T(this,t,r);case"ascii":return x(this,t,r);case"latin1":case"binary":return P(this,t,r);case"base64":return L(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function m(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function v(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),X(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=l.from(t,n)),l.isBuffer(t))return 0===t.length?-1:_(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):_(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function _(e,t,r,n,i){let o,a=1,s=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a=2,s/=2,l/=2,r/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){let n=-1;for(o=r;o<s;o++)if(c(e,o)===c(t,-1===n?0:o-n)){if(-1===n&&(n=o),o-n+1===l)return n*a}else-1!==n&&(o-=o-n),n=-1}else for(r+l>s&&(r=s-l),o=r;o>=0;o--){let r=!0;for(let n=0;n<l;n++)if(c(e,o+n)!==c(t,n)){r=!1;break}if(r)return o}return-1}function w(e,t,r,n){r=Number(r)||0;const i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;const o=t.length;let a;for(n>o/2&&(n=o/2),a=0;a<n;++a){const n=parseInt(t.substr(2*a,2),16);if(X(n))return a;e[r+a]=n}return a}function S(e,t,r,n){return Y(V(t,e.length-r),e,r,n)}function E(e,t,r,n){return Y(function(e){const t=[];for(let r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function b(e,t,r,n){return Y(z(t),e,r,n)}function C(e,t,r,n){return Y(function(e,t){let r,n,i;const o=[];for(let a=0;a<e.length&&!((t-=2)<0);++a)r=e.charCodeAt(a),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function L(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function T(e,t,r){r=Math.min(e.length,r);const n=[];let i=t;for(;i<r;){const t=e[i];let o=null,a=t>239?4:t>223?3:t>191?2:1;if(i+a<=r){let r,n,s,l;switch(a){case 1:t<128&&(o=t);break;case 2:r=e[i+1],128==(192&r)&&(l=(31&t)<<6|63&r,l>127&&(o=l));break;case 3:r=e[i+1],n=e[i+2],128==(192&r)&&128==(192&n)&&(l=(15&t)<<12|(63&r)<<6|63&n,l>2047&&(l<55296||l>57343)&&(o=l));break;case 4:r=e[i+1],n=e[i+2],s=e[i+3],128==(192&r)&&128==(192&n)&&128==(192&s)&&(l=(15&t)<<18|(63&r)<<12|(63&n)<<6|63&s,l>65535&&l<1114112&&(o=l))}}null===o?(o=65533,a=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|1023&o),n.push(o),i+=a}return function(e){const t=e.length;if(t<=A)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=A));return r}(n)}l.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),l.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,l.from=function(e,t,r){return c(e,t,r)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(e,t,r){return function(e,t,r){return u(e),e<=0?s(e):void 0!==t?"string"==typeof r?s(e).fill(t,r):s(e).fill(t):s(e)}(e,t,r)},l.allocUnsafe=function(e){return p(e)},l.allocUnsafeSlow=function(e){return p(e)},l.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==l.prototype},l.compare=function(e,t){if(K(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),K(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let r=e.length,n=t.length;for(let i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);let r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;const n=l.allocUnsafe(t);let i=0;for(r=0;r<e.length;++r){let t=e[r];if(K(t,Uint8Array))i+t.length>n.length?(l.isBuffer(t)||(t=l.from(t)),t.copy(n,i)):Uint8Array.prototype.set.call(n,t,i);else{if(!l.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(n,i)}i+=t.length}return n},l.byteLength=g,l.prototype._isBuffer=!0,l.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)m(this,t,t+1);return this},l.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},l.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},l.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?T(this,0,e):y.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){let e="";const r=t.h2;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},o&&(l.prototype[o]=l.prototype.inspect),l.prototype.compare=function(e,t,r,n,i){if(K(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;let o=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(t>>>=0);const s=Math.min(o,a),c=this.slice(n,i),u=e.slice(t,r);for(let e=0;e<s;++e)if(c[e]!==u[e]){o=c[e],a=u[e];break}return o<a?-1:a<o?1:0},l.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},l.prototype.indexOf=function(e,t,r){return v(this,e,t,r,!0)},l.prototype.lastIndexOf=function(e,t,r){return v(this,e,t,r,!1)},l.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}const i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let o=!1;for(;;)switch(n){case"hex":return w(this,e,t,r);case"utf8":case"utf-8":return S(this,e,t,r);case"ascii":case"latin1":case"binary":return E(this,e,t,r);case"base64":return b(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const A=4096;function x(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function P(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function O(e,t,r){const n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);let i="";for(let n=t;n<r;++n)i+=$[e[n]];return i}function I(e,t,r){const n=e.slice(t,r);let i="";for(let e=0;e<n.length-1;e+=2)i+=String.fromCharCode(n[e]+256*n[e+1]);return i}function R(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function M(e,t,r,n,i,o){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function D(e,t,r,n,i){j(t,n,i,e,r,7);let o=Number(t&BigInt(4294967295));e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o;let a=Number(t>>BigInt(32)&BigInt(4294967295));return e[r++]=a,a>>=8,e[r++]=a,a>>=8,e[r++]=a,a>>=8,e[r++]=a,r}function N(e,t,r,n,i){j(t,n,i,e,r,7);let o=Number(t&BigInt(4294967295));e[r+7]=o,o>>=8,e[r+6]=o,o>>=8,e[r+5]=o,o>>=8,e[r+4]=o;let a=Number(t>>BigInt(32)&BigInt(4294967295));return e[r+3]=a,a>>=8,e[r+2]=a,a>>=8,e[r+1]=a,a>>=8,e[r]=a,r+8}function Z(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function k(e,t,r,n,o){return t=+t,r>>>=0,o||Z(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function F(e,t,r,n,o){return t=+t,r>>>=0,o||Z(e,0,r,8),i.write(e,t,r,n,52,8),r+8}l.prototype.slice=function(e,t){const r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);const n=this.subarray(e,t);return Object.setPrototypeOf(n,l.prototype),n},l.prototype.readUintLE=l.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);let n=this[e],i=1,o=0;for(;++o<t&&(i*=256);)n+=this[e+o]*i;return n},l.prototype.readUintBE=l.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);let n=this[e+--t],i=1;for(;t>0&&(i*=256);)n+=this[e+--t]*i;return n},l.prototype.readUint8=l.prototype.readUInt8=function(e,t){return e>>>=0,t||R(e,1,this.length),this[e]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,t){return e>>>=0,t||R(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,t){return e>>>=0,t||R(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,t){return e>>>=0,t||R(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,t){return e>>>=0,t||R(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readBigUInt64LE=J((function(e){W(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||H(e,this.length-8);const n=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,i=this[++e]+256*this[++e]+65536*this[++e]+r*2**24;return BigInt(n)+(BigInt(i)<<BigInt(32))})),l.prototype.readBigUInt64BE=J((function(e){W(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||H(e,this.length-8);const n=t*2**24+65536*this[++e]+256*this[++e]+this[++e],i=this[++e]*2**24+65536*this[++e]+256*this[++e]+r;return(BigInt(n)<<BigInt(32))+BigInt(i)})),l.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);let n=this[e],i=1,o=0;for(;++o<t&&(i*=256);)n+=this[e+o]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*t)),n},l.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);let n=t,i=1,o=this[e+--n];for(;n>0&&(i*=256);)o+=this[e+--n]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*t)),o},l.prototype.readInt8=function(e,t){return e>>>=0,t||R(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){e>>>=0,t||R(e,2,this.length);const r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt16BE=function(e,t){e>>>=0,t||R(e,2,this.length);const r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt32LE=function(e,t){return e>>>=0,t||R(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e>>>=0,t||R(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readBigInt64LE=J((function(e){W(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||H(e,this.length-8);const n=this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24);return(BigInt(n)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),l.prototype.readBigInt64BE=J((function(e){W(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||H(e,this.length-8);const n=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(n)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+r)})),l.prototype.readFloatLE=function(e,t){return e>>>=0,t||R(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e>>>=0,t||R(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e>>>=0,t||R(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e>>>=0,t||R(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){M(this,e,t,r,Math.pow(2,8*r)-1,0)}let i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){M(this,e,t,r,Math.pow(2,8*r)-1,0)}let i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},l.prototype.writeUint8=l.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,1,255,0),this[t]=255&e,t+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeBigUInt64LE=J((function(e,t=0){return D(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeBigUInt64BE=J((function(e,t=0){return N(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);M(this,e,t,r,n-1,-n)}let i=0,o=1,a=0;for(this[t]=255&e;++i<r&&(o*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/o>>0)-a&255;return t+r},l.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);M(this,e,t,r,n-1,-n)}let i=r-1,o=1,a=0;for(this[t+i]=255&e;--i>=0&&(o*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/o>>0)-a&255;return t+r},l.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||M(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeBigInt64LE=J((function(e,t=0){return D(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeBigInt64BE=J((function(e,t=0){return N(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeFloatLE=function(e,t,r){return k(this,e,t,!0,r)},l.prototype.writeFloatBE=function(e,t,r){return k(this,e,t,!1,r)},l.prototype.writeDoubleLE=function(e,t,r){return F(this,e,t,!0,r)},l.prototype.writeDoubleBE=function(e,t,r){return F(this,e,t,!1,r)},l.prototype.copy=function(e,t,r,n){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);const i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},l.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){const t=e.charCodeAt(0);("utf8"===n&&t<128||"latin1"===n)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;let i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{const o=l.isBuffer(e)?e:l.from(e,n),a=o.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=o[i%a]}return this};const U={};function B(e,t,r){U[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function G(e){let t="",r=e.length;const n="-"===e[0]?1:0;for(;r>=n+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function j(e,t,r,n,i,o){if(e>r||e<t){const n="bigint"==typeof t?"n":"";let i;throw i=o>3?0===t||t===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(o+1)}${n}`:`>= -(2${n} ** ${8*(o+1)-1}${n}) and < 2 ** ${8*(o+1)-1}${n}`:`>= ${t}${n} and <= ${r}${n}`,new U.ERR_OUT_OF_RANGE("value",i,e)}!function(e,t,r){W(t,"offset"),void 0!==e[t]&&void 0!==e[t+r]||H(t,e.length-(r+1))}(n,i,o)}function W(e,t){if("number"!=typeof e)throw new U.ERR_INVALID_ARG_TYPE(t,"number",e)}function H(e,t,r){if(Math.floor(e)!==e)throw W(e,r),new U.ERR_OUT_OF_RANGE(r||"offset","an integer",e);if(t<0)throw new U.ERR_BUFFER_OUT_OF_BOUNDS;throw new U.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${t}`,e)}B("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),B("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),B("ERR_OUT_OF_RANGE",(function(e,t,r){let n=`The value of "${e}" is out of range.`,i=r;return Number.isInteger(r)&&Math.abs(r)>2**32?i=G(String(r)):"bigint"==typeof r&&(i=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(i=G(i)),i+="n"),n+=` It must be ${t}. Received ${i}`,n}),RangeError);const q=/[^+/0-9A-Za-z-_]/g;function V(e,t){let r;t=t||1/0;const n=e.length;let i=null;const o=[];for(let a=0;a<n;++a){if(r=e.charCodeAt(a),r>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function z(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(q,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function Y(e,t,r,n){let i;for(i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function K(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function X(e){return e!=e}const $=function(){const e="0123456789abcdef",t=new Array(256);for(let r=0;r<16;++r){const n=16*r;for(let i=0;i<16;++i)t[n+i]=e[r]+e[i]}return t}();function J(e){return"undefined"==typeof BigInt?Q:e}function Q(){throw new Error("BigInt not supported")}},1615:e=>{var t={utf8:{stringToBytes:function(e){return t.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(t.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],r=0;r<e.length;r++)t.push(255&e.charCodeAt(r));return t},bytesToString:function(e){for(var t=[],r=0;r<e.length;r++)t.push(String.fromCharCode(e[r]));return t.join("")}}};e.exports=t},1041:e=>{var t,r;t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&r.rotl(e,8)|4278255360&r.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=r.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],r=0,n=0;r<e.length;r++,n+=8)t[n>>>5]|=e[r]<<24-n%32;return t},wordsToBytes:function(e){for(var t=[],r=0;r<32*e.length;r+=8)t.push(e[r>>>5]>>>24-r%32&255);return t},bytesToHex:function(e){for(var t=[],r=0;r<e.length;r++)t.push((e[r]>>>4).toString(16)),t.push((15&e[r]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e.substr(r,2),16));return t},bytesToBase64:function(e){for(var r=[],n=0;n<e.length;n+=3)for(var i=e[n]<<16|e[n+1]<<8|e[n+2],o=0;o<4;o++)8*n+6*o<=8*e.length?r.push(t.charAt(i>>>6*(3-o)&63)):r.push("=");return r.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var r=[],n=0,i=0;n<e.length;i=++n%4)0!=i&&r.push((t.indexOf(e.charAt(n-1))&Math.pow(2,-2*i+8)-1)<<2*i|t.indexOf(e.charAt(n))>>>6-2*i);return r}},e.exports=r},5752:function(e){
/**!

 @license
 handlebars v4.7.7

Copyright (C) 2011-2019 by Yehuda Katz

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

*/
var t;t=function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}return r.m=e,r.c=t,r.p="",r(0)}([function(e,t,r){"use strict";var n=r(1).default;t.__esModule=!0;var i=n(r(2)),o=n(r(45)),a=r(46),s=r(51),l=n(r(52)),c=n(r(49)),u=n(r(44)),p=i.default.create;function h(){var e=p();return e.compile=function(t,r){return s.compile(t,r,e)},e.precompile=function(t,r){return s.precompile(t,r,e)},e.AST=o.default,e.Compiler=s.Compiler,e.JavaScriptCompiler=l.default,e.Parser=a.parser,e.parse=a.parse,e.parseWithoutProcessing=a.parseWithoutProcessing,e}var d=h();d.create=h,u.default(d),d.Visitor=c.default,d.default=d,t.default=d,e.exports=t.default},function(e,t){"use strict";t.default=function(e){return e&&e.__esModule?e:{default:e}},t.__esModule=!0},function(e,t,r){"use strict";var n=r(3).default,i=r(1).default;t.__esModule=!0;var o=n(r(4)),a=i(r(37)),s=i(r(6)),l=n(r(5)),c=n(r(38)),u=i(r(44));function p(){var e=new o.HandlebarsEnvironment;return l.extend(e,o),e.SafeString=a.default,e.Exception=s.default,e.Utils=l,e.escapeExpression=l.escapeExpression,e.VM=c,e.template=function(t){return c.template(t,e)},e}var h=p();h.create=p,u.default(h),h.default=h,t.default=h,e.exports=t.default},function(e,t){"use strict";t.default=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},t.__esModule=!0},function(e,t,r){"use strict";var n=r(1).default;t.__esModule=!0,t.HandlebarsEnvironment=p;var i=r(5),o=n(r(6)),a=r(10),s=r(30),l=n(r(32)),c=r(33);t.VERSION="4.7.7",t.COMPILER_REVISION=8,t.LAST_COMPATIBLE_COMPILER_REVISION=7,t.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};var u="[object Object]";function p(e,t,r){this.helpers=e||{},this.partials=t||{},this.decorators=r||{},a.registerDefaultHelpers(this),s.registerDefaultDecorators(this)}p.prototype={constructor:p,logger:l.default,log:l.default.log,registerHelper:function(e,t){if(i.toString.call(e)===u){if(t)throw new o.default("Arg not supported with multiple helpers");i.extend(this.helpers,e)}else this.helpers[e]=t},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,t){if(i.toString.call(e)===u)i.extend(this.partials,e);else{if(void 0===t)throw new o.default('Attempting to register a partial called "'+e+'" as undefined');this.partials[e]=t}},unregisterPartial:function(e){delete this.partials[e]},registerDecorator:function(e,t){if(i.toString.call(e)===u){if(t)throw new o.default("Arg not supported with multiple decorators");i.extend(this.decorators,e)}else this.decorators[e]=t},unregisterDecorator:function(e){delete this.decorators[e]},resetLoggedPropertyAccesses:function(){c.resetLoggedProperties()}};var h=l.default.log;t.log=h,t.createFrame=i.createFrame,t.logger=l.default},function(e,t){"use strict";t.__esModule=!0,t.extend=a,t.indexOf=function(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1},t.escapeExpression=function(e){if("string"!=typeof e){if(e&&e.toHTML)return e.toHTML();if(null==e)return"";if(!e)return e+"";e=""+e}return i.test(e)?e.replace(n,o):e},t.isEmpty=function(e){return!e&&0!==e||!(!c(e)||0!==e.length)},t.createFrame=function(e){var t=a({},e);return t._parent=e,t},t.blockParams=function(e,t){return e.path=t,e},t.appendContextPath=function(e,t){return(e?e+".":"")+t};var r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},n=/[&<>"'`=]/g,i=/[&<>"'`=]/;function o(e){return r[e]}function a(e){for(var t=1;t<arguments.length;t++)for(var r in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],r)&&(e[r]=arguments[t][r]);return e}var s=Object.prototype.toString;t.toString=s;var l=function(e){return"function"==typeof e};l(/x/)&&(t.isFunction=l=function(e){return"function"==typeof e&&"[object Function]"===s.call(e)}),t.isFunction=l;var c=Array.isArray||function(e){return!(!e||"object"!=typeof e)&&"[object Array]"===s.call(e)};t.isArray=c},function(e,t,r){"use strict";var n=r(7).default;t.__esModule=!0;var i=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];function o(e,t){var r=t&&t.loc,a=void 0,s=void 0,l=void 0,c=void 0;r&&(a=r.start.line,s=r.end.line,l=r.start.column,c=r.end.column,e+=" - "+a+":"+l);for(var u=Error.prototype.constructor.call(this,e),p=0;p<i.length;p++)this[i[p]]=u[i[p]];Error.captureStackTrace&&Error.captureStackTrace(this,o);try{r&&(this.lineNumber=a,this.endLineNumber=s,n?(Object.defineProperty(this,"column",{value:l,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:c,enumerable:!0})):(this.column=l,this.endColumn=c))}catch(e){}}o.prototype=new Error,t.default=o,e.exports=t.default},function(e,t,r){e.exports={default:r(8),__esModule:!0}},function(e,t,r){var n=r(9);e.exports=function(e,t,r){return n.setDesc(e,t,r)}},function(e,t){var r=Object;e.exports={create:r.create,getProto:r.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:r.getOwnPropertyDescriptor,setDesc:r.defineProperty,setDescs:r.defineProperties,getKeys:r.keys,getNames:r.getOwnPropertyNames,getSymbols:r.getOwnPropertySymbols,each:[].forEach}},function(e,t,r){"use strict";var n=r(1).default;t.__esModule=!0,t.registerDefaultHelpers=function(e){i.default(e),o.default(e),a.default(e),s.default(e),l.default(e),c.default(e),u.default(e)},t.moveHelperToHooks=function(e,t,r){e.helpers[t]&&(e.hooks[t]=e.helpers[t],r||delete e.helpers[t])};var i=n(r(11)),o=n(r(12)),a=n(r(25)),s=n(r(26)),l=n(r(27)),c=n(r(28)),u=n(r(29))},function(e,t,r){"use strict";t.__esModule=!0;var n=r(5);t.default=function(e){e.registerHelper("blockHelperMissing",(function(t,r){var i=r.inverse,o=r.fn;if(!0===t)return o(this);if(!1===t||null==t)return i(this);if(n.isArray(t))return t.length>0?(r.ids&&(r.ids=[r.name]),e.helpers.each(t,r)):i(this);if(r.data&&r.ids){var a=n.createFrame(r.data);a.contextPath=n.appendContextPath(r.data.contextPath,r.name),r={data:a}}return o(t,r)}))},e.exports=t.default},function(e,t,r){(function(n){"use strict";var i=r(13).default,o=r(1).default;t.__esModule=!0;var a=r(5),s=o(r(6));t.default=function(e){e.registerHelper("each",(function(e,t){if(!t)throw new s.default("Must pass iterator to #each");var r,o=t.fn,l=t.inverse,c=0,u="",p=void 0,h=void 0;function d(t,r,n){p&&(p.key=t,p.index=r,p.first=0===r,p.last=!!n,h&&(p.contextPath=h+t)),u+=o(e[t],{data:p,blockParams:a.blockParams([e[t],t],[h+t,null])})}if(t.data&&t.ids&&(h=a.appendContextPath(t.data.contextPath,t.ids[0])+"."),a.isFunction(e)&&(e=e.call(this)),t.data&&(p=a.createFrame(t.data)),e&&"object"==typeof e)if(a.isArray(e))for(var f=e.length;c<f;c++)c in e&&d(c,c,c===e.length-1);else if(n.Symbol&&e[n.Symbol.iterator]){for(var g=[],y=e[n.Symbol.iterator](),m=y.next();!m.done;m=y.next())g.push(m.value);for(f=(e=g).length;c<f;c++)d(c,c,c===e.length-1)}else r=void 0,i(e).forEach((function(e){void 0!==r&&d(r,c-1),r=e,c++})),void 0!==r&&d(r,c-1,!0);return 0===c&&(u=l(this)),u}))},e.exports=t.default}).call(t,function(){return this}())},function(e,t,r){e.exports={default:r(14),__esModule:!0}},function(e,t,r){r(15),e.exports=r(21).Object.keys},function(e,t,r){var n=r(16);r(18)("keys",(function(e){return function(t){return e(n(t))}}))},function(e,t,r){var n=r(17);e.exports=function(e){return Object(n(e))}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,r){var n=r(19),i=r(21),o=r(24);e.exports=function(e,t){var r=(i.Object||{})[e]||Object[e],a={};a[e]=t(r),n(n.S+n.F*o((function(){r(1)})),"Object",a)}},function(e,t,r){var n=r(20),i=r(21),o=r(22),a=function(e,t,r){var s,l,c,u=e&a.F,p=e&a.G,h=e&a.S,d=e&a.P,f=e&a.B,g=e&a.W,y=p?i:i[t]||(i[t]={}),m=p?n:h?n[t]:(n[t]||{}).prototype;for(s in p&&(r=t),r)(l=!u&&m&&s in m)&&s in y||(c=l?m[s]:r[s],y[s]=p&&"function"!=typeof m[s]?r[s]:f&&l?o(c,n):g&&m[s]==c?function(e){var t=function(t){return this instanceof e?new e(t):e(t)};return t.prototype=e.prototype,t}(c):d&&"function"==typeof c?o(Function.call,c):c,d&&((y.prototype||(y.prototype={}))[s]=c))};a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,e.exports=a},function(e,t){var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(e,t){var r=e.exports={version:"1.2.6"};"number"==typeof __e&&(__e=r)},function(e,t,r){var n=r(23);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,r){"use strict";var n=r(1).default;t.__esModule=!0;var i=n(r(6));t.default=function(e){e.registerHelper("helperMissing",(function(){if(1!==arguments.length)throw new i.default('Missing helper: "'+arguments[arguments.length-1].name+'"')}))},e.exports=t.default},function(e,t,r){"use strict";var n=r(1).default;t.__esModule=!0;var i=r(5),o=n(r(6));t.default=function(e){e.registerHelper("if",(function(e,t){if(2!=arguments.length)throw new o.default("#if requires exactly one argument");return i.isFunction(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||i.isEmpty(e)?t.inverse(this):t.fn(this)})),e.registerHelper("unless",(function(t,r){if(2!=arguments.length)throw new o.default("#unless requires exactly one argument");return e.helpers.if.call(this,t,{fn:r.inverse,inverse:r.fn,hash:r.hash})}))},e.exports=t.default},function(e,t){"use strict";t.__esModule=!0,t.default=function(e){e.registerHelper("log",(function(){for(var t=[void 0],r=arguments[arguments.length-1],n=0;n<arguments.length-1;n++)t.push(arguments[n]);var i=1;null!=r.hash.level?i=r.hash.level:r.data&&null!=r.data.level&&(i=r.data.level),t[0]=i,e.log.apply(e,t)}))},e.exports=t.default},function(e,t){"use strict";t.__esModule=!0,t.default=function(e){e.registerHelper("lookup",(function(e,t,r){return e?r.lookupProperty(e,t):e}))},e.exports=t.default},function(e,t,r){"use strict";var n=r(1).default;t.__esModule=!0;var i=r(5),o=n(r(6));t.default=function(e){e.registerHelper("with",(function(e,t){if(2!=arguments.length)throw new o.default("#with requires exactly one argument");i.isFunction(e)&&(e=e.call(this));var r=t.fn;if(i.isEmpty(e))return t.inverse(this);var n=t.data;return t.data&&t.ids&&((n=i.createFrame(t.data)).contextPath=i.appendContextPath(t.data.contextPath,t.ids[0])),r(e,{data:n,blockParams:i.blockParams([e],[n&&n.contextPath])})}))},e.exports=t.default},function(e,t,r){"use strict";var n=r(1).default;t.__esModule=!0,t.registerDefaultDecorators=function(e){i.default(e)};var i=n(r(31))},function(e,t,r){"use strict";t.__esModule=!0;var n=r(5);t.default=function(e){e.registerDecorator("inline",(function(e,t,r,i){var o=e;return t.partials||(t.partials={},o=function(i,o){var a=r.partials;r.partials=n.extend({},a,t.partials);var s=e(i,o);return r.partials=a,s}),t.partials[i.args[0]]=i.fn,o}))},e.exports=t.default},function(e,t,r){"use strict";t.__esModule=!0;var n=r(5),i={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(e){if("string"==typeof e){var t=n.indexOf(i.methodMap,e.toLowerCase());e=t>=0?t:parseInt(e,10)}return e},log:function(e){if(e=i.lookupLevel(e),"undefined"!=typeof console&&i.lookupLevel(i.level)<=e){var t=i.methodMap[e];console[t]||(t="log");for(var r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];console[t].apply(console,n)}}};t.default=i,e.exports=t.default},function(e,t,r){"use strict";var n=r(34).default,i=r(13).default,o=r(3).default;t.__esModule=!0,t.createProtoAccessControl=function(e){var t=n(null);t.constructor=!1,t.__defineGetter__=!1,t.__defineSetter__=!1,t.__lookupGetter__=!1;var r=n(null);return r.__proto__=!1,{properties:{whitelist:a.createNewLookupObject(r,e.allowedProtoProperties),defaultValue:e.allowProtoPropertiesByDefault},methods:{whitelist:a.createNewLookupObject(t,e.allowedProtoMethods),defaultValue:e.allowProtoMethodsByDefault}}},t.resultIsAllowed=function(e,t,r){return c("function"==typeof e?t.methods:t.properties,r)},t.resetLoggedProperties=function(){i(l).forEach((function(e){delete l[e]}))};var a=r(36),s=o(r(32)),l=n(null);function c(e,t){return void 0!==e.whitelist[t]?!0===e.whitelist[t]:void 0!==e.defaultValue?e.defaultValue:(function(e){!0!==l[e]&&(l[e]=!0,s.log("error",'Handlebars: Access has been denied to resolve the property "'+e+'" because it is not an "own property" of its parent.\nYou can add a runtime option to disable the check or this warning:\nSee https://handlebarsjs.com/api-reference/runtime-options.html#options-to-control-prototype-access for details'))}(t),!1)}},function(e,t,r){e.exports={default:r(35),__esModule:!0}},function(e,t,r){var n=r(9);e.exports=function(e,t){return n.create(e,t)}},function(e,t,r){"use strict";var n=r(34).default;t.__esModule=!0,t.createNewLookupObject=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return i.extend.apply(void 0,[n(null)].concat(t))};var i=r(5)},function(e,t){"use strict";function r(e){this.string=e}t.__esModule=!0,r.prototype.toString=r.prototype.toHTML=function(){return""+this.string},t.default=r,e.exports=t.default},function(e,t,r){"use strict";var n=r(39).default,i=r(13).default,o=r(3).default,a=r(1).default;t.__esModule=!0,t.checkRevision=function(e){var t=e&&e[0]||1,r=c.COMPILER_REVISION;if(!(t>=c.LAST_COMPATIBLE_COMPILER_REVISION&&t<=c.COMPILER_REVISION)){if(t<c.LAST_COMPATIBLE_COMPILER_REVISION){var n=c.REVISION_CHANGES[r],i=c.REVISION_CHANGES[t];throw new l.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+n+") or downgrade your runtime to an older version ("+i+").")}throw new l.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}},t.template=function(e,t){if(!t)throw new l.default("No environment passed to template");if(!e||!e.main)throw new l.default("Unknown template object: "+typeof e);e.main.decorator=e.main_d,t.VM.checkRevision(e.compiler);var r=e.compiler&&7===e.compiler[0],o={strict:function(e,t,r){if(!e||!(t in e))throw new l.default('"'+t+'" not defined in '+e,{loc:r});return o.lookupProperty(e,t)},lookupProperty:function(e,t){var r=e[t];return null==r||Object.prototype.hasOwnProperty.call(e,t)||h.resultIsAllowed(r,o.protoAccessControl,t)?r:void 0},lookup:function(e,t){for(var r=e.length,n=0;n<r;n++)if(null!=(e[n]&&o.lookupProperty(e[n],t)))return e[n][t]},lambda:function(e,t){return"function"==typeof e?e.call(t):e},escapeExpression:s.escapeExpression,invokePartial:function(r,n,i){i.hash&&(n=s.extend({},n,i.hash),i.ids&&(i.ids[0]=!0)),r=t.VM.resolvePartial.call(this,r,n,i);var o=s.extend({},i,{hooks:this.hooks,protoAccessControl:this.protoAccessControl}),a=t.VM.invokePartial.call(this,r,n,o);if(null==a&&t.compile&&(i.partials[i.name]=t.compile(r,e.compilerOptions,t),a=i.partials[i.name](n,o)),null!=a){if(i.indent){for(var c=a.split("\n"),u=0,p=c.length;u<p&&(c[u]||u+1!==p);u++)c[u]=i.indent+c[u];a=c.join("\n")}return a}throw new l.default("The partial "+i.name+" could not be compiled when running in runtime-only mode")},fn:function(t){var r=e[t];return r.decorator=e[t+"_d"],r},programs:[],program:function(e,t,r,n,i){var o=this.programs[e],a=this.fn(e);return t||i||n||r?o=d(this,e,a,t,r,n,i):o||(o=this.programs[e]=d(this,e,a)),o},data:function(e,t){for(;e&&t--;)e=e._parent;return e},mergeIfNeeded:function(e,t){var r=e||t;return e&&t&&e!==t&&(r=s.extend({},t,e)),r},nullContext:n({}),noop:t.VM.noop,compilerInfo:e.compiler};function a(t){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=r.data;a._setup(r),!r.partial&&e.useData&&(n=g(t,n));var i=void 0,s=e.useBlockParams?[]:void 0;function l(t){return""+e.main(o,t,o.helpers,o.partials,n,s,i)}return e.useDepths&&(i=r.depths?t!=r.depths[0]?[t].concat(r.depths):r.depths:[t]),(l=y(e.main,l,o,r.depths||[],n,s))(t,r)}return a.isTop=!0,a._setup=function(n){if(n.partial)o.protoAccessControl=n.protoAccessControl,o.helpers=n.helpers,o.partials=n.partials,o.decorators=n.decorators,o.hooks=n.hooks;else{var a=s.extend({},t.helpers,n.helpers);!function(e,t){i(e).forEach((function(r){var n=e[r];e[r]=function(e,t){var r=t.lookupProperty;return p.wrapHelper(e,(function(e){return s.extend({lookupProperty:r},e)}))}(n,t)}))}(a,o),o.helpers=a,e.usePartial&&(o.partials=o.mergeIfNeeded(n.partials,t.partials)),(e.usePartial||e.useDecorators)&&(o.decorators=s.extend({},t.decorators,n.decorators)),o.hooks={},o.protoAccessControl=h.createProtoAccessControl(n);var l=n.allowCallsToHelperMissing||r;u.moveHelperToHooks(o,"helperMissing",l),u.moveHelperToHooks(o,"blockHelperMissing",l)}},a._child=function(t,r,n,i){if(e.useBlockParams&&!n)throw new l.default("must pass block params");if(e.useDepths&&!i)throw new l.default("must pass parent depths");return d(o,t,e[t],r,0,n,i)},a},t.wrapProgram=d,t.resolvePartial=function(e,t,r){return e?e.call||r.name||(r.name=e,e=r.partials[e]):e="@partial-block"===r.name?r.data["partial-block"]:r.partials[r.name],e},t.invokePartial=function(e,t,r){var n=r.data&&r.data["partial-block"];r.partial=!0,r.ids&&(r.data.contextPath=r.ids[0]||r.data.contextPath);var i=void 0;if(r.fn&&r.fn!==f&&function(){r.data=c.createFrame(r.data);var e=r.fn;i=r.data["partial-block"]=function(t){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return r.data=c.createFrame(r.data),r.data["partial-block"]=n,e(t,r)},e.partials&&(r.partials=s.extend({},r.partials,e.partials))}(),void 0===e&&i&&(e=i),void 0===e)throw new l.default("The partial "+r.name+" could not be found");if(e instanceof Function)return e(t,r)},t.noop=f;var s=o(r(5)),l=a(r(6)),c=r(4),u=r(10),p=r(43),h=r(33);function d(e,t,r,n,i,o,a){function s(t){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],s=a;return!a||t==a[0]||t===e.nullContext&&null===a[0]||(s=[t].concat(a)),r(e,t,e.helpers,e.partials,i.data||n,o&&[i.blockParams].concat(o),s)}return(s=y(r,s,e,a,n,o)).program=t,s.depth=a?a.length:0,s.blockParams=i||0,s}function f(){return""}function g(e,t){return t&&"root"in t||((t=t?c.createFrame(t):{}).root=e),t}function y(e,t,r,n,i,o){if(e.decorator){var a={};t=e.decorator(t,a,r,n&&n[0],i,o,n),s.extend(t,a)}return t}},function(e,t,r){e.exports={default:r(40),__esModule:!0}},function(e,t,r){r(41),e.exports=r(21).Object.seal},function(e,t,r){var n=r(42);r(18)("seal",(function(e){return function(t){return e&&n(t)?e(t):t}}))},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){"use strict";t.__esModule=!0,t.wrapHelper=function(e,t){return"function"!=typeof e?e:function(){return arguments[arguments.length-1]=t(arguments[arguments.length-1]),e.apply(this,arguments)}}},function(e,t){(function(r){"use strict";t.__esModule=!0,t.default=function(e){var t=void 0!==r?r:window,n=t.Handlebars;e.noConflict=function(){return t.Handlebars===e&&(t.Handlebars=n),e}},e.exports=t.default}).call(t,function(){return this}())},function(e,t){"use strict";t.__esModule=!0;var r={helpers:{helperExpression:function(e){return"SubExpression"===e.type||("MustacheStatement"===e.type||"BlockStatement"===e.type)&&!!(e.params&&e.params.length||e.hash)},scopedId:function(e){return/^\.|this\b/.test(e.original)},simpleId:function(e){return 1===e.parts.length&&!r.helpers.scopedId(e)&&!e.depth}}};t.default=r,e.exports=t.default},function(e,t,r){"use strict";var n=r(1).default,i=r(3).default;t.__esModule=!0,t.parseWithoutProcessing=u,t.parse=function(e,t){var r=u(e,t);return new a.default(t).accept(r)};var o=n(r(47)),a=n(r(48)),s=i(r(50)),l=r(5);t.parser=o.default;var c={};function u(e,t){return"Program"===e.type?e:(o.default.yy=c,c.locInfo=function(e){return new c.SourceLocation(t&&t.srcName,e)},o.default.parse(e))}l.extend(c,s)},function(e,t){"use strict";t.__esModule=!0;var r=function(){var e={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,partialBlock:12,content:13,COMMENT:14,CONTENT:15,openRawBlock:16,rawBlock_repetition0:17,END_RAW_BLOCK:18,OPEN_RAW_BLOCK:19,helperName:20,openRawBlock_repetition0:21,openRawBlock_option0:22,CLOSE_RAW_BLOCK:23,openBlock:24,block_option0:25,closeBlock:26,openInverse:27,block_option1:28,OPEN_BLOCK:29,openBlock_repetition0:30,openBlock_option0:31,openBlock_option1:32,CLOSE:33,OPEN_INVERSE:34,openInverse_repetition0:35,openInverse_option0:36,openInverse_option1:37,openInverseChain:38,OPEN_INVERSE_CHAIN:39,openInverseChain_repetition0:40,openInverseChain_option0:41,openInverseChain_option1:42,inverseAndProgram:43,INVERSE:44,inverseChain:45,inverseChain_option0:46,OPEN_ENDBLOCK:47,OPEN:48,mustache_repetition0:49,mustache_option0:50,OPEN_UNESCAPED:51,mustache_repetition1:52,mustache_option1:53,CLOSE_UNESCAPED:54,OPEN_PARTIAL:55,partialName:56,partial_repetition0:57,partial_option0:58,openPartialBlock:59,OPEN_PARTIAL_BLOCK:60,openPartialBlock_repetition0:61,openPartialBlock_option0:62,param:63,sexpr:64,OPEN_SEXPR:65,sexpr_repetition0:66,sexpr_option0:67,CLOSE_SEXPR:68,hash:69,hash_repetition_plus0:70,hashSegment:71,ID:72,EQUALS:73,blockParams:74,OPEN_BLOCK_PARAMS:75,blockParams_repetition_plus0:76,CLOSE_BLOCK_PARAMS:77,path:78,dataName:79,STRING:80,NUMBER:81,BOOLEAN:82,UNDEFINED:83,NULL:84,DATA:85,pathSegments:86,SEP:87,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"COMMENT",15:"CONTENT",18:"END_RAW_BLOCK",19:"OPEN_RAW_BLOCK",23:"CLOSE_RAW_BLOCK",29:"OPEN_BLOCK",33:"CLOSE",34:"OPEN_INVERSE",39:"OPEN_INVERSE_CHAIN",44:"INVERSE",47:"OPEN_ENDBLOCK",48:"OPEN",51:"OPEN_UNESCAPED",54:"CLOSE_UNESCAPED",55:"OPEN_PARTIAL",60:"OPEN_PARTIAL_BLOCK",65:"OPEN_SEXPR",68:"CLOSE_SEXPR",72:"ID",73:"EQUALS",75:"OPEN_BLOCK_PARAMS",77:"CLOSE_BLOCK_PARAMS",80:"STRING",81:"NUMBER",82:"BOOLEAN",83:"UNDEFINED",84:"NULL",85:"DATA",87:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[13,1],[10,3],[16,5],[9,4],[9,4],[24,6],[27,6],[38,6],[43,2],[45,3],[45,1],[26,3],[8,5],[8,5],[11,5],[12,3],[59,5],[63,1],[63,1],[64,5],[69,1],[71,3],[74,3],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[56,1],[56,1],[79,2],[78,1],[86,3],[86,1],[6,0],[6,2],[17,0],[17,2],[21,0],[21,2],[22,0],[22,1],[25,0],[25,1],[28,0],[28,1],[30,0],[30,2],[31,0],[31,1],[32,0],[32,1],[35,0],[35,2],[36,0],[36,1],[37,0],[37,1],[40,0],[40,2],[41,0],[41,1],[42,0],[42,1],[46,0],[46,1],[49,0],[49,2],[50,0],[50,1],[52,0],[52,2],[53,0],[53,1],[57,0],[57,2],[58,0],[58,1],[61,0],[61,2],[62,0],[62,1],[66,0],[66,2],[67,0],[67,1],[70,1],[70,2],[76,1],[76,2]],performAction:function(e,t,r,n,i,o,a){var s=o.length-1;switch(i){case 1:return o[s-1];case 2:this.$=n.prepareProgram(o[s]);break;case 3:case 4:case 5:case 6:case 7:case 8:case 20:case 27:case 28:case 33:case 34:case 40:case 41:this.$=o[s];break;case 9:this.$={type:"CommentStatement",value:n.stripComment(o[s]),strip:n.stripFlags(o[s],o[s]),loc:n.locInfo(this._$)};break;case 10:this.$={type:"ContentStatement",original:o[s],value:o[s],loc:n.locInfo(this._$)};break;case 11:this.$=n.prepareRawBlock(o[s-2],o[s-1],o[s],this._$);break;case 12:this.$={path:o[s-3],params:o[s-2],hash:o[s-1]};break;case 13:this.$=n.prepareBlock(o[s-3],o[s-2],o[s-1],o[s],!1,this._$);break;case 14:this.$=n.prepareBlock(o[s-3],o[s-2],o[s-1],o[s],!0,this._$);break;case 15:this.$={open:o[s-5],path:o[s-4],params:o[s-3],hash:o[s-2],blockParams:o[s-1],strip:n.stripFlags(o[s-5],o[s])};break;case 16:case 17:this.$={path:o[s-4],params:o[s-3],hash:o[s-2],blockParams:o[s-1],strip:n.stripFlags(o[s-5],o[s])};break;case 18:this.$={strip:n.stripFlags(o[s-1],o[s-1]),program:o[s]};break;case 19:var l=n.prepareBlock(o[s-2],o[s-1],o[s],o[s],!1,this._$),c=n.prepareProgram([l],o[s-1].loc);c.chained=!0,this.$={strip:o[s-2].strip,program:c,chain:!0};break;case 21:this.$={path:o[s-1],strip:n.stripFlags(o[s-2],o[s])};break;case 22:case 23:this.$=n.prepareMustache(o[s-3],o[s-2],o[s-1],o[s-4],n.stripFlags(o[s-4],o[s]),this._$);break;case 24:this.$={type:"PartialStatement",name:o[s-3],params:o[s-2],hash:o[s-1],indent:"",strip:n.stripFlags(o[s-4],o[s]),loc:n.locInfo(this._$)};break;case 25:this.$=n.preparePartialBlock(o[s-2],o[s-1],o[s],this._$);break;case 26:this.$={path:o[s-3],params:o[s-2],hash:o[s-1],strip:n.stripFlags(o[s-4],o[s])};break;case 29:this.$={type:"SubExpression",path:o[s-3],params:o[s-2],hash:o[s-1],loc:n.locInfo(this._$)};break;case 30:this.$={type:"Hash",pairs:o[s],loc:n.locInfo(this._$)};break;case 31:this.$={type:"HashPair",key:n.id(o[s-2]),value:o[s],loc:n.locInfo(this._$)};break;case 32:this.$=n.id(o[s-1]);break;case 35:this.$={type:"StringLiteral",value:o[s],original:o[s],loc:n.locInfo(this._$)};break;case 36:this.$={type:"NumberLiteral",value:Number(o[s]),original:Number(o[s]),loc:n.locInfo(this._$)};break;case 37:this.$={type:"BooleanLiteral",value:"true"===o[s],original:"true"===o[s],loc:n.locInfo(this._$)};break;case 38:this.$={type:"UndefinedLiteral",original:void 0,value:void 0,loc:n.locInfo(this._$)};break;case 39:this.$={type:"NullLiteral",original:null,value:null,loc:n.locInfo(this._$)};break;case 42:this.$=n.preparePath(!0,o[s],this._$);break;case 43:this.$=n.preparePath(!1,o[s],this._$);break;case 44:o[s-2].push({part:n.id(o[s]),original:o[s],separator:o[s-1]}),this.$=o[s-2];break;case 45:this.$=[{part:n.id(o[s]),original:o[s]}];break;case 46:case 48:case 50:case 58:case 64:case 70:case 78:case 82:case 86:case 90:case 94:this.$=[];break;case 47:case 49:case 51:case 59:case 65:case 71:case 79:case 83:case 87:case 91:case 95:case 99:case 101:o[s-1].push(o[s]);break;case 98:case 100:this.$=[o[s]]}},table:[{3:1,4:2,5:[2,46],6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:11,14:[1,12],15:[1,20],16:17,19:[1,23],24:15,27:16,29:[1,21],34:[1,22],39:[2,2],44:[2,2],47:[2,2],48:[1,13],51:[1,14],55:[1,18],59:19,60:[1,24]},{1:[2,1]},{5:[2,47],14:[2,47],15:[2,47],19:[2,47],29:[2,47],34:[2,47],39:[2,47],44:[2,47],47:[2,47],48:[2,47],51:[2,47],55:[2,47],60:[2,47]},{5:[2,3],14:[2,3],15:[2,3],19:[2,3],29:[2,3],34:[2,3],39:[2,3],44:[2,3],47:[2,3],48:[2,3],51:[2,3],55:[2,3],60:[2,3]},{5:[2,4],14:[2,4],15:[2,4],19:[2,4],29:[2,4],34:[2,4],39:[2,4],44:[2,4],47:[2,4],48:[2,4],51:[2,4],55:[2,4],60:[2,4]},{5:[2,5],14:[2,5],15:[2,5],19:[2,5],29:[2,5],34:[2,5],39:[2,5],44:[2,5],47:[2,5],48:[2,5],51:[2,5],55:[2,5],60:[2,5]},{5:[2,6],14:[2,6],15:[2,6],19:[2,6],29:[2,6],34:[2,6],39:[2,6],44:[2,6],47:[2,6],48:[2,6],51:[2,6],55:[2,6],60:[2,6]},{5:[2,7],14:[2,7],15:[2,7],19:[2,7],29:[2,7],34:[2,7],39:[2,7],44:[2,7],47:[2,7],48:[2,7],51:[2,7],55:[2,7],60:[2,7]},{5:[2,8],14:[2,8],15:[2,8],19:[2,8],29:[2,8],34:[2,8],39:[2,8],44:[2,8],47:[2,8],48:[2,8],51:[2,8],55:[2,8],60:[2,8]},{5:[2,9],14:[2,9],15:[2,9],19:[2,9],29:[2,9],34:[2,9],39:[2,9],44:[2,9],47:[2,9],48:[2,9],51:[2,9],55:[2,9],60:[2,9]},{20:25,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:36,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:37,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{4:38,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{15:[2,48],17:39,18:[2,48]},{20:41,56:40,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:44,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{5:[2,10],14:[2,10],15:[2,10],18:[2,10],19:[2,10],29:[2,10],34:[2,10],39:[2,10],44:[2,10],47:[2,10],48:[2,10],51:[2,10],55:[2,10],60:[2,10]},{20:45,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:46,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:47,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:41,56:48,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[2,78],49:49,65:[2,78],72:[2,78],80:[2,78],81:[2,78],82:[2,78],83:[2,78],84:[2,78],85:[2,78]},{23:[2,33],33:[2,33],54:[2,33],65:[2,33],68:[2,33],72:[2,33],75:[2,33],80:[2,33],81:[2,33],82:[2,33],83:[2,33],84:[2,33],85:[2,33]},{23:[2,34],33:[2,34],54:[2,34],65:[2,34],68:[2,34],72:[2,34],75:[2,34],80:[2,34],81:[2,34],82:[2,34],83:[2,34],84:[2,34],85:[2,34]},{23:[2,35],33:[2,35],54:[2,35],65:[2,35],68:[2,35],72:[2,35],75:[2,35],80:[2,35],81:[2,35],82:[2,35],83:[2,35],84:[2,35],85:[2,35]},{23:[2,36],33:[2,36],54:[2,36],65:[2,36],68:[2,36],72:[2,36],75:[2,36],80:[2,36],81:[2,36],82:[2,36],83:[2,36],84:[2,36],85:[2,36]},{23:[2,37],33:[2,37],54:[2,37],65:[2,37],68:[2,37],72:[2,37],75:[2,37],80:[2,37],81:[2,37],82:[2,37],83:[2,37],84:[2,37],85:[2,37]},{23:[2,38],33:[2,38],54:[2,38],65:[2,38],68:[2,38],72:[2,38],75:[2,38],80:[2,38],81:[2,38],82:[2,38],83:[2,38],84:[2,38],85:[2,38]},{23:[2,39],33:[2,39],54:[2,39],65:[2,39],68:[2,39],72:[2,39],75:[2,39],80:[2,39],81:[2,39],82:[2,39],83:[2,39],84:[2,39],85:[2,39]},{23:[2,43],33:[2,43],54:[2,43],65:[2,43],68:[2,43],72:[2,43],75:[2,43],80:[2,43],81:[2,43],82:[2,43],83:[2,43],84:[2,43],85:[2,43],87:[1,50]},{72:[1,35],86:51},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{52:52,54:[2,82],65:[2,82],72:[2,82],80:[2,82],81:[2,82],82:[2,82],83:[2,82],84:[2,82],85:[2,82]},{25:53,38:55,39:[1,57],43:56,44:[1,58],45:54,47:[2,54]},{28:59,43:60,44:[1,58],47:[2,56]},{13:62,15:[1,20],18:[1,61]},{33:[2,86],57:63,65:[2,86],72:[2,86],80:[2,86],81:[2,86],82:[2,86],83:[2,86],84:[2,86],85:[2,86]},{33:[2,40],65:[2,40],72:[2,40],80:[2,40],81:[2,40],82:[2,40],83:[2,40],84:[2,40],85:[2,40]},{33:[2,41],65:[2,41],72:[2,41],80:[2,41],81:[2,41],82:[2,41],83:[2,41],84:[2,41],85:[2,41]},{20:64,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:65,47:[1,66]},{30:67,33:[2,58],65:[2,58],72:[2,58],75:[2,58],80:[2,58],81:[2,58],82:[2,58],83:[2,58],84:[2,58],85:[2,58]},{33:[2,64],35:68,65:[2,64],72:[2,64],75:[2,64],80:[2,64],81:[2,64],82:[2,64],83:[2,64],84:[2,64],85:[2,64]},{21:69,23:[2,50],65:[2,50],72:[2,50],80:[2,50],81:[2,50],82:[2,50],83:[2,50],84:[2,50],85:[2,50]},{33:[2,90],61:70,65:[2,90],72:[2,90],80:[2,90],81:[2,90],82:[2,90],83:[2,90],84:[2,90],85:[2,90]},{20:74,33:[2,80],50:71,63:72,64:75,65:[1,43],69:73,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{72:[1,79]},{23:[2,42],33:[2,42],54:[2,42],65:[2,42],68:[2,42],72:[2,42],75:[2,42],80:[2,42],81:[2,42],82:[2,42],83:[2,42],84:[2,42],85:[2,42],87:[1,50]},{20:74,53:80,54:[2,84],63:81,64:75,65:[1,43],69:82,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:83,47:[1,66]},{47:[2,55]},{4:84,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{47:[2,20]},{20:85,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:86,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{26:87,47:[1,66]},{47:[2,57]},{5:[2,11],14:[2,11],15:[2,11],19:[2,11],29:[2,11],34:[2,11],39:[2,11],44:[2,11],47:[2,11],48:[2,11],51:[2,11],55:[2,11],60:[2,11]},{15:[2,49],18:[2,49]},{20:74,33:[2,88],58:88,63:89,64:75,65:[1,43],69:90,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{65:[2,94],66:91,68:[2,94],72:[2,94],80:[2,94],81:[2,94],82:[2,94],83:[2,94],84:[2,94],85:[2,94]},{5:[2,25],14:[2,25],15:[2,25],19:[2,25],29:[2,25],34:[2,25],39:[2,25],44:[2,25],47:[2,25],48:[2,25],51:[2,25],55:[2,25],60:[2,25]},{20:92,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,31:93,33:[2,60],63:94,64:75,65:[1,43],69:95,70:76,71:77,72:[1,78],75:[2,60],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,66],36:96,63:97,64:75,65:[1,43],69:98,70:76,71:77,72:[1,78],75:[2,66],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,22:99,23:[2,52],63:100,64:75,65:[1,43],69:101,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,92],62:102,63:103,64:75,65:[1,43],69:104,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,105]},{33:[2,79],65:[2,79],72:[2,79],80:[2,79],81:[2,79],82:[2,79],83:[2,79],84:[2,79],85:[2,79]},{33:[2,81]},{23:[2,27],33:[2,27],54:[2,27],65:[2,27],68:[2,27],72:[2,27],75:[2,27],80:[2,27],81:[2,27],82:[2,27],83:[2,27],84:[2,27],85:[2,27]},{23:[2,28],33:[2,28],54:[2,28],65:[2,28],68:[2,28],72:[2,28],75:[2,28],80:[2,28],81:[2,28],82:[2,28],83:[2,28],84:[2,28],85:[2,28]},{23:[2,30],33:[2,30],54:[2,30],68:[2,30],71:106,72:[1,107],75:[2,30]},{23:[2,98],33:[2,98],54:[2,98],68:[2,98],72:[2,98],75:[2,98]},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],73:[1,108],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{23:[2,44],33:[2,44],54:[2,44],65:[2,44],68:[2,44],72:[2,44],75:[2,44],80:[2,44],81:[2,44],82:[2,44],83:[2,44],84:[2,44],85:[2,44],87:[2,44]},{54:[1,109]},{54:[2,83],65:[2,83],72:[2,83],80:[2,83],81:[2,83],82:[2,83],83:[2,83],84:[2,83],85:[2,83]},{54:[2,85]},{5:[2,13],14:[2,13],15:[2,13],19:[2,13],29:[2,13],34:[2,13],39:[2,13],44:[2,13],47:[2,13],48:[2,13],51:[2,13],55:[2,13],60:[2,13]},{38:55,39:[1,57],43:56,44:[1,58],45:111,46:110,47:[2,76]},{33:[2,70],40:112,65:[2,70],72:[2,70],75:[2,70],80:[2,70],81:[2,70],82:[2,70],83:[2,70],84:[2,70],85:[2,70]},{47:[2,18]},{5:[2,14],14:[2,14],15:[2,14],19:[2,14],29:[2,14],34:[2,14],39:[2,14],44:[2,14],47:[2,14],48:[2,14],51:[2,14],55:[2,14],60:[2,14]},{33:[1,113]},{33:[2,87],65:[2,87],72:[2,87],80:[2,87],81:[2,87],82:[2,87],83:[2,87],84:[2,87],85:[2,87]},{33:[2,89]},{20:74,63:115,64:75,65:[1,43],67:114,68:[2,96],69:116,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,117]},{32:118,33:[2,62],74:119,75:[1,120]},{33:[2,59],65:[2,59],72:[2,59],75:[2,59],80:[2,59],81:[2,59],82:[2,59],83:[2,59],84:[2,59],85:[2,59]},{33:[2,61],75:[2,61]},{33:[2,68],37:121,74:122,75:[1,120]},{33:[2,65],65:[2,65],72:[2,65],75:[2,65],80:[2,65],81:[2,65],82:[2,65],83:[2,65],84:[2,65],85:[2,65]},{33:[2,67],75:[2,67]},{23:[1,123]},{23:[2,51],65:[2,51],72:[2,51],80:[2,51],81:[2,51],82:[2,51],83:[2,51],84:[2,51],85:[2,51]},{23:[2,53]},{33:[1,124]},{33:[2,91],65:[2,91],72:[2,91],80:[2,91],81:[2,91],82:[2,91],83:[2,91],84:[2,91],85:[2,91]},{33:[2,93]},{5:[2,22],14:[2,22],15:[2,22],19:[2,22],29:[2,22],34:[2,22],39:[2,22],44:[2,22],47:[2,22],48:[2,22],51:[2,22],55:[2,22],60:[2,22]},{23:[2,99],33:[2,99],54:[2,99],68:[2,99],72:[2,99],75:[2,99]},{73:[1,108]},{20:74,63:125,64:75,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,23],14:[2,23],15:[2,23],19:[2,23],29:[2,23],34:[2,23],39:[2,23],44:[2,23],47:[2,23],48:[2,23],51:[2,23],55:[2,23],60:[2,23]},{47:[2,19]},{47:[2,77]},{20:74,33:[2,72],41:126,63:127,64:75,65:[1,43],69:128,70:76,71:77,72:[1,78],75:[2,72],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,24],14:[2,24],15:[2,24],19:[2,24],29:[2,24],34:[2,24],39:[2,24],44:[2,24],47:[2,24],48:[2,24],51:[2,24],55:[2,24],60:[2,24]},{68:[1,129]},{65:[2,95],68:[2,95],72:[2,95],80:[2,95],81:[2,95],82:[2,95],83:[2,95],84:[2,95],85:[2,95]},{68:[2,97]},{5:[2,21],14:[2,21],15:[2,21],19:[2,21],29:[2,21],34:[2,21],39:[2,21],44:[2,21],47:[2,21],48:[2,21],51:[2,21],55:[2,21],60:[2,21]},{33:[1,130]},{33:[2,63]},{72:[1,132],76:131},{33:[1,133]},{33:[2,69]},{15:[2,12],18:[2,12]},{14:[2,26],15:[2,26],19:[2,26],29:[2,26],34:[2,26],47:[2,26],48:[2,26],51:[2,26],55:[2,26],60:[2,26]},{23:[2,31],33:[2,31],54:[2,31],68:[2,31],72:[2,31],75:[2,31]},{33:[2,74],42:134,74:135,75:[1,120]},{33:[2,71],65:[2,71],72:[2,71],75:[2,71],80:[2,71],81:[2,71],82:[2,71],83:[2,71],84:[2,71],85:[2,71]},{33:[2,73],75:[2,73]},{23:[2,29],33:[2,29],54:[2,29],65:[2,29],68:[2,29],72:[2,29],75:[2,29],80:[2,29],81:[2,29],82:[2,29],83:[2,29],84:[2,29],85:[2,29]},{14:[2,15],15:[2,15],19:[2,15],29:[2,15],34:[2,15],39:[2,15],44:[2,15],47:[2,15],48:[2,15],51:[2,15],55:[2,15],60:[2,15]},{72:[1,137],77:[1,136]},{72:[2,100],77:[2,100]},{14:[2,16],15:[2,16],19:[2,16],29:[2,16],34:[2,16],44:[2,16],47:[2,16],48:[2,16],51:[2,16],55:[2,16],60:[2,16]},{33:[1,138]},{33:[2,75]},{33:[2,32]},{72:[2,101],77:[2,101]},{14:[2,17],15:[2,17],19:[2,17],29:[2,17],34:[2,17],39:[2,17],44:[2,17],47:[2,17],48:[2,17],51:[2,17],55:[2,17],60:[2,17]}],defaultActions:{4:[2,1],54:[2,55],56:[2,20],60:[2,57],73:[2,81],82:[2,85],86:[2,18],90:[2,89],101:[2,53],104:[2,93],110:[2,19],111:[2,77],116:[2,97],119:[2,63],122:[2,69],135:[2,75],136:[2,32]},parseError:function(e,t){throw new Error(e)},parse:function(e){var t=this,r=[0],n=[null],i=[],o=this.table,a="",s=0,l=0,c=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var u=this.lexer.yylloc;i.push(u);var p=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var h,d,f,g,y,m,v,_,w,S,E={};;){if(f=r[r.length-1],this.defaultActions[f]?g=this.defaultActions[f]:(null==h&&(S=void 0,"number"!=typeof(S=t.lexer.lex()||1)&&(S=t.symbols_[S]||S),h=S),g=o[f]&&o[f][h]),void 0===g||!g.length||!g[0]){var b="";if(!c){for(m in w=[],o[f])this.terminals_[m]&&m>2&&w.push("'"+this.terminals_[m]+"'");b=this.lexer.showPosition?"Parse error on line "+(s+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+w.join(", ")+", got '"+(this.terminals_[h]||h)+"'":"Parse error on line "+(s+1)+": Unexpected "+(1==h?"end of input":"'"+(this.terminals_[h]||h)+"'"),this.parseError(b,{text:this.lexer.match,token:this.terminals_[h]||h,line:this.lexer.yylineno,loc:u,expected:w})}}if(g[0]instanceof Array&&g.length>1)throw new Error("Parse Error: multiple actions possible at state: "+f+", token: "+h);switch(g[0]){case 1:r.push(h),n.push(this.lexer.yytext),i.push(this.lexer.yylloc),r.push(g[1]),h=null,d?(h=d,d=null):(l=this.lexer.yyleng,a=this.lexer.yytext,s=this.lexer.yylineno,u=this.lexer.yylloc,c>0&&c--);break;case 2:if(v=this.productions_[g[1]][1],E.$=n[n.length-v],E._$={first_line:i[i.length-(v||1)].first_line,last_line:i[i.length-1].last_line,first_column:i[i.length-(v||1)].first_column,last_column:i[i.length-1].last_column},p&&(E._$.range=[i[i.length-(v||1)].range[0],i[i.length-1].range[1]]),void 0!==(y=this.performAction.call(E,a,l,s,this.yy,g[1],n,i)))return y;v&&(r=r.slice(0,-1*v*2),n=n.slice(0,-1*v),i=i.slice(0,-1*v)),r.push(this.productions_[g[1]][0]),n.push(E.$),i.push(E._$),_=o[r[r.length-2]][r[r.length-1]],r.push(_);break;case 3:return!0}}return!0}},t=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,r=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var n=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),r.length-1&&(this.yylineno-=r.length-1);var i=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:r?(r.length===n.length?this.yylloc.first_column:0)+n[n.length-r.length].length-r[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;var e,t,r,n,i;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var o=this._currentRules(),a=0;a<o.length&&(!(r=this._input.match(this.rules[o[a]]))||t&&!(r[0].length>t[0].length)||(t=r,n=a,this.options.flex));a++);return t?((i=t[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=i.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:i?i[i.length-1].length-i[i.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,o[n],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),e||void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return void 0!==e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)},options:{},performAction:function(e,t,r,n){function i(e,r){return t.yytext=t.yytext.substring(e,t.yyleng-r+e)}switch(r){case 0:if("\\\\"===t.yytext.slice(-2)?(i(0,1),this.begin("mu")):"\\"===t.yytext.slice(-1)?(i(0,1),this.begin("emu")):this.begin("mu"),t.yytext)return 15;break;case 1:case 5:return 15;case 2:return this.popState(),15;case 3:return this.begin("raw"),15;case 4:return this.popState(),"raw"===this.conditionStack[this.conditionStack.length-1]?15:(i(5,9),"END_RAW_BLOCK");case 6:case 22:return this.popState(),14;case 7:return 65;case 8:return 68;case 9:return 19;case 10:return this.popState(),this.begin("raw"),23;case 11:return 55;case 12:return 60;case 13:return 29;case 14:return 47;case 15:case 16:return this.popState(),44;case 17:return 34;case 18:return 39;case 19:return 51;case 20:case 23:return 48;case 21:this.unput(t.yytext),this.popState(),this.begin("com");break;case 24:return 73;case 25:case 26:case 41:return 72;case 27:return 87;case 28:break;case 29:return this.popState(),54;case 30:return this.popState(),33;case 31:return t.yytext=i(1,2).replace(/\\"/g,'"'),80;case 32:return t.yytext=i(1,2).replace(/\\'/g,"'"),80;case 33:return 85;case 34:case 35:return 82;case 36:return 83;case 37:return 84;case 38:return 81;case 39:return 75;case 40:return 77;case 42:return t.yytext=t.yytext.replace(/\\([\\\]])/g,"$1"),72;case 43:return"INVALID";case 44:return 5}},rules:[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{(?=[^\/]))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]+?(?=(\{\{\{\{)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#>)/,/^(?:\{\{(~)?#\*?)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?\*?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[(\\\]|[^\]])*\])/,/^(?:.)/,/^(?:$)/],conditions:{mu:{rules:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[6],inclusive:!1},raw:{rules:[3,4,5],inclusive:!1},INITIAL:{rules:[0,1,44],inclusive:!0}}};return e}();function r(){this.yy={}}return e.lexer=t,r.prototype=e,e.Parser=r,new r}();t.default=r,e.exports=t.default},function(e,t,r){"use strict";var n=r(1).default;t.__esModule=!0;var i=n(r(49));function o(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.options=e}function a(e,t,r){void 0===t&&(t=e.length);var n=e[t-1],i=e[t-2];return n?"ContentStatement"===n.type?(i||!r?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(n.original):void 0:r}function s(e,t,r){void 0===t&&(t=-1);var n=e[t+1],i=e[t+2];return n?"ContentStatement"===n.type?(i||!r?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(n.original):void 0:r}function l(e,t,r){var n=e[null==t?0:t+1];if(n&&"ContentStatement"===n.type&&(r||!n.rightStripped)){var i=n.value;n.value=n.value.replace(r?/^\s+/:/^[ \t]*\r?\n?/,""),n.rightStripped=n.value!==i}}function c(e,t,r){var n=e[null==t?e.length-1:t-1];if(n&&"ContentStatement"===n.type&&(r||!n.leftStripped)){var i=n.value;return n.value=n.value.replace(r?/\s+$/:/[ \t]+$/,""),n.leftStripped=n.value!==i,n.leftStripped}}o.prototype=new i.default,o.prototype.Program=function(e){var t=!this.options.ignoreStandalone,r=!this.isRootSeen;this.isRootSeen=!0;for(var n=e.body,i=0,o=n.length;i<o;i++){var u=n[i],p=this.accept(u);if(p){var h=a(n,i,r),d=s(n,i,r),f=p.openStandalone&&h,g=p.closeStandalone&&d,y=p.inlineStandalone&&h&&d;p.close&&l(n,i,!0),p.open&&c(n,i,!0),t&&y&&(l(n,i),c(n,i)&&"PartialStatement"===u.type&&(u.indent=/([ \t]+$)/.exec(n[i-1].original)[1])),t&&f&&(l((u.program||u.inverse).body),c(n,i)),t&&g&&(l(n,i),c((u.inverse||u.program).body))}}return e},o.prototype.BlockStatement=o.prototype.DecoratorBlock=o.prototype.PartialBlockStatement=function(e){this.accept(e.program),this.accept(e.inverse);var t=e.program||e.inverse,r=e.program&&e.inverse,n=r,i=r;if(r&&r.chained)for(n=r.body[0].program;i.chained;)i=i.body[i.body.length-1].program;var o={open:e.openStrip.open,close:e.closeStrip.close,openStandalone:s(t.body),closeStandalone:a((n||t).body)};if(e.openStrip.close&&l(t.body,null,!0),r){var u=e.inverseStrip;u.open&&c(t.body,null,!0),u.close&&l(n.body,null,!0),e.closeStrip.open&&c(i.body,null,!0),!this.options.ignoreStandalone&&a(t.body)&&s(n.body)&&(c(t.body),l(n.body))}else e.closeStrip.open&&c(t.body,null,!0);return o},o.prototype.Decorator=o.prototype.MustacheStatement=function(e){return e.strip},o.prototype.PartialStatement=o.prototype.CommentStatement=function(e){var t=e.strip||{};return{inlineStandalone:!0,open:t.open,close:t.close}},t.default=o,e.exports=t.default},function(e,t,r){"use strict";var n=r(1).default;t.__esModule=!0;var i=n(r(6));function o(){this.parents=[]}function a(e){this.acceptRequired(e,"path"),this.acceptArray(e.params),this.acceptKey(e,"hash")}function s(e){a.call(this,e),this.acceptKey(e,"program"),this.acceptKey(e,"inverse")}function l(e){this.acceptRequired(e,"name"),this.acceptArray(e.params),this.acceptKey(e,"hash")}o.prototype={constructor:o,mutating:!1,acceptKey:function(e,t){var r=this.accept(e[t]);if(this.mutating){if(r&&!o.prototype[r.type])throw new i.default('Unexpected node type "'+r.type+'" found when accepting '+t+" on "+e.type);e[t]=r}},acceptRequired:function(e,t){if(this.acceptKey(e,t),!e[t])throw new i.default(e.type+" requires "+t)},acceptArray:function(e){for(var t=0,r=e.length;t<r;t++)this.acceptKey(e,t),e[t]||(e.splice(t,1),t--,r--)},accept:function(e){if(e){if(!this[e.type])throw new i.default("Unknown type: "+e.type,e);this.current&&this.parents.unshift(this.current),this.current=e;var t=this[e.type](e);return this.current=this.parents.shift(),!this.mutating||t?t:!1!==t?e:void 0}},Program:function(e){this.acceptArray(e.body)},MustacheStatement:a,Decorator:a,BlockStatement:s,DecoratorBlock:s,PartialStatement:l,PartialBlockStatement:function(e){l.call(this,e),this.acceptKey(e,"program")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:a,PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(e){this.acceptArray(e.pairs)},HashPair:function(e){this.acceptRequired(e,"value")}},t.default=o,e.exports=t.default},function(e,t,r){"use strict";var n=r(1).default;t.__esModule=!0,t.SourceLocation=function(e,t){this.source=e,this.start={line:t.first_line,column:t.first_column},this.end={line:t.last_line,column:t.last_column}},t.id=function(e){return/^\[.*\]$/.test(e)?e.substring(1,e.length-1):e},t.stripFlags=function(e,t){return{open:"~"===e.charAt(2),close:"~"===t.charAt(t.length-3)}},t.stripComment=function(e){return e.replace(/^\{\{~?!-?-?/,"").replace(/-?-?~?\}\}$/,"")},t.preparePath=function(e,t,r){r=this.locInfo(r);for(var n=e?"@":"",o=[],a=0,s=0,l=t.length;s<l;s++){var c=t[s].part,u=t[s].original!==c;if(n+=(t[s].separator||"")+c,u||".."!==c&&"."!==c&&"this"!==c)o.push(c);else{if(o.length>0)throw new i.default("Invalid path: "+n,{loc:r});".."===c&&a++}}return{type:"PathExpression",data:e,depth:a,parts:o,original:n,loc:r}},t.prepareMustache=function(e,t,r,n,i,o){var a=n.charAt(3)||n.charAt(2),s="{"!==a&&"&"!==a;return{type:/\*/.test(n)?"Decorator":"MustacheStatement",path:e,params:t,hash:r,escaped:s,strip:i,loc:this.locInfo(o)}},t.prepareRawBlock=function(e,t,r,n){o(e,r),n=this.locInfo(n);var i={type:"Program",body:t,strip:{},loc:n};return{type:"BlockStatement",path:e.path,params:e.params,hash:e.hash,program:i,openStrip:{},inverseStrip:{},closeStrip:{},loc:n}},t.prepareBlock=function(e,t,r,n,a,s){n&&n.path&&o(e,n);var l=/\*/.test(e.open);t.blockParams=e.blockParams;var c=void 0,u=void 0;if(r){if(l)throw new i.default("Unexpected inverse block on decorator",r);r.chain&&(r.program.body[0].closeStrip=n.strip),u=r.strip,c=r.program}return a&&(a=c,c=t,t=a),{type:l?"DecoratorBlock":"BlockStatement",path:e.path,params:e.params,hash:e.hash,program:t,inverse:c,openStrip:e.strip,inverseStrip:u,closeStrip:n&&n.strip,loc:this.locInfo(s)}},t.prepareProgram=function(e,t){if(!t&&e.length){var r=e[0].loc,n=e[e.length-1].loc;r&&n&&(t={source:r.source,start:{line:r.start.line,column:r.start.column},end:{line:n.end.line,column:n.end.column}})}return{type:"Program",body:e,strip:{},loc:t}},t.preparePartialBlock=function(e,t,r,n){return o(e,r),{type:"PartialBlockStatement",name:e.path,params:e.params,hash:e.hash,program:t,openStrip:e.strip,closeStrip:r&&r.strip,loc:this.locInfo(n)}};var i=n(r(6));function o(e,t){if(t=t.path?t.path.original:t,e.path.original!==t){var r={loc:e.path.loc};throw new i.default(e.path.original+" doesn't match "+t,r)}}},function(e,t,r){"use strict";var n=r(34).default,i=r(1).default;t.__esModule=!0,t.Compiler=c,t.precompile=function(e,t,r){if(null==e||"string"!=typeof e&&"Program"!==e.type)throw new o.default("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+e);"data"in(t=t||{})||(t.data=!0),t.compat&&(t.useDepths=!0);var n=r.parse(e,t),i=(new r.Compiler).compile(n,t);return(new r.JavaScriptCompiler).compile(i,t)},t.compile=function(e,t,r){if(void 0===t&&(t={}),null==e||"string"!=typeof e&&"Program"!==e.type)throw new o.default("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+e);"data"in(t=a.extend({},t))||(t.data=!0),t.compat&&(t.useDepths=!0);var n=void 0;function i(){var n=r.parse(e,t),i=(new r.Compiler).compile(n,t),o=(new r.JavaScriptCompiler).compile(i,t,void 0,!0);return r.template(o)}function s(e,t){return n||(n=i()),n.call(this,e,t)}return s._setup=function(e){return n||(n=i()),n._setup(e)},s._child=function(e,t,r,o){return n||(n=i()),n._child(e,t,r,o)},s};var o=i(r(6)),a=r(5),s=i(r(45)),l=[].slice;function c(){}function u(e,t){if(e===t)return!0;if(a.isArray(e)&&a.isArray(t)&&e.length===t.length){for(var r=0;r<e.length;r++)if(!u(e[r],t[r]))return!1;return!0}}function p(e){if(!e.path.parts){var t=e.path;e.path={type:"PathExpression",data:!1,depth:0,parts:[t.original+""],original:t.original+"",loc:t.loc}}}c.prototype={compiler:c,equals:function(e){var t=this.opcodes.length;if(e.opcodes.length!==t)return!1;for(var r=0;r<t;r++){var n=this.opcodes[r],i=e.opcodes[r];if(n.opcode!==i.opcode||!u(n.args,i.args))return!1}for(t=this.children.length,r=0;r<t;r++)if(!this.children[r].equals(e.children[r]))return!1;return!0},guid:0,compile:function(e,t){return this.sourceNode=[],this.opcodes=[],this.children=[],this.options=t,this.stringParams=t.stringParams,this.trackIds=t.trackIds,t.blockParams=t.blockParams||[],t.knownHelpers=a.extend(n(null),{helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0,lookup:!0},t.knownHelpers),this.accept(e)},compileProgram:function(e){var t=(new this.compiler).compile(e,this.options),r=this.guid++;return this.usePartial=this.usePartial||t.usePartial,this.children[r]=t,this.useDepths=this.useDepths||t.useDepths,r},accept:function(e){if(!this[e.type])throw new o.default("Unknown type: "+e.type,e);this.sourceNode.unshift(e);var t=this[e.type](e);return this.sourceNode.shift(),t},Program:function(e){this.options.blockParams.unshift(e.blockParams);for(var t=e.body,r=t.length,n=0;n<r;n++)this.accept(t[n]);return this.options.blockParams.shift(),this.isSimple=1===r,this.blockParams=e.blockParams?e.blockParams.length:0,this},BlockStatement:function(e){p(e);var t=e.program,r=e.inverse;t=t&&this.compileProgram(t),r=r&&this.compileProgram(r);var n=this.classifySexpr(e);"helper"===n?this.helperSexpr(e,t,r):"simple"===n?(this.simpleSexpr(e),this.opcode("pushProgram",t),this.opcode("pushProgram",r),this.opcode("emptyHash"),this.opcode("blockValue",e.path.original)):(this.ambiguousSexpr(e,t,r),this.opcode("pushProgram",t),this.opcode("pushProgram",r),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},DecoratorBlock:function(e){var t=e.program&&this.compileProgram(e.program),r=this.setupFullMustacheParams(e,t,void 0),n=e.path;this.useDecorators=!0,this.opcode("registerDecorator",r.length,n.original)},PartialStatement:function(e){this.usePartial=!0;var t=e.program;t&&(t=this.compileProgram(e.program));var r=e.params;if(r.length>1)throw new o.default("Unsupported number of partial arguments: "+r.length,e);r.length||(this.options.explicitPartialContext?this.opcode("pushLiteral","undefined"):r.push({type:"PathExpression",parts:[],depth:0}));var n=e.name.original,i="SubExpression"===e.name.type;i&&this.accept(e.name),this.setupFullMustacheParams(e,t,void 0,!0);var a=e.indent||"";this.options.preventIndent&&a&&(this.opcode("appendContent",a),a=""),this.opcode("invokePartial",i,n,a),this.opcode("append")},PartialBlockStatement:function(e){this.PartialStatement(e)},MustacheStatement:function(e){this.SubExpression(e),e.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},Decorator:function(e){this.DecoratorBlock(e)},ContentStatement:function(e){e.value&&this.opcode("appendContent",e.value)},CommentStatement:function(){},SubExpression:function(e){p(e);var t=this.classifySexpr(e);"simple"===t?this.simpleSexpr(e):"helper"===t?this.helperSexpr(e):this.ambiguousSexpr(e)},ambiguousSexpr:function(e,t,r){var n=e.path,i=n.parts[0],o=null!=t||null!=r;this.opcode("getContext",n.depth),this.opcode("pushProgram",t),this.opcode("pushProgram",r),n.strict=!0,this.accept(n),this.opcode("invokeAmbiguous",i,o)},simpleSexpr:function(e){var t=e.path;t.strict=!0,this.accept(t),this.opcode("resolvePossibleLambda")},helperSexpr:function(e,t,r){var n=this.setupFullMustacheParams(e,t,r),i=e.path,a=i.parts[0];if(this.options.knownHelpers[a])this.opcode("invokeKnownHelper",n.length,a);else{if(this.options.knownHelpersOnly)throw new o.default("You specified knownHelpersOnly, but used the unknown helper "+a,e);i.strict=!0,i.falsy=!0,this.accept(i),this.opcode("invokeHelper",n.length,i.original,s.default.helpers.simpleId(i))}},PathExpression:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth);var t=e.parts[0],r=s.default.helpers.scopedId(e),n=!e.depth&&!r&&this.blockParamIndex(t);n?this.opcode("lookupBlockParam",n,e.parts):t?e.data?(this.options.data=!0,this.opcode("lookupData",e.depth,e.parts,e.strict)):this.opcode("lookupOnContext",e.parts,e.falsy,e.strict,r):this.opcode("pushContext")},StringLiteral:function(e){this.opcode("pushString",e.value)},NumberLiteral:function(e){this.opcode("pushLiteral",e.value)},BooleanLiteral:function(e){this.opcode("pushLiteral",e.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(e){var t=e.pairs,r=0,n=t.length;for(this.opcode("pushHash");r<n;r++)this.pushParam(t[r].value);for(;r--;)this.opcode("assignToHash",t[r].key);this.opcode("popHash")},opcode:function(e){this.opcodes.push({opcode:e,args:l.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(e){e&&(this.useDepths=!0)},classifySexpr:function(e){var t=s.default.helpers.simpleId(e.path),r=t&&!!this.blockParamIndex(e.path.parts[0]),n=!r&&s.default.helpers.helperExpression(e),i=!r&&(n||t);if(i&&!n){var o=e.path.parts[0],a=this.options;a.knownHelpers[o]?n=!0:a.knownHelpersOnly&&(i=!1)}return n?"helper":i?"ambiguous":"simple"},pushParams:function(e){for(var t=0,r=e.length;t<r;t++)this.pushParam(e[t])},pushParam:function(e){var t=null!=e.value?e.value:e.original||"";if(this.stringParams)t.replace&&(t=t.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),e.depth&&this.addDepth(e.depth),this.opcode("getContext",e.depth||0),this.opcode("pushStringParam",t,e.type),"SubExpression"===e.type&&this.accept(e);else{if(this.trackIds){var r=void 0;if(!e.parts||s.default.helpers.scopedId(e)||e.depth||(r=this.blockParamIndex(e.parts[0])),r){var n=e.parts.slice(1).join(".");this.opcode("pushId","BlockParam",r,n)}else(t=e.original||t).replace&&(t=t.replace(/^this(?:\.|$)/,"").replace(/^\.\//,"").replace(/^\.$/,"")),this.opcode("pushId",e.type,t)}this.accept(e)}},setupFullMustacheParams:function(e,t,r,n){var i=e.params;return this.pushParams(i),this.opcode("pushProgram",t),this.opcode("pushProgram",r),e.hash?this.accept(e.hash):this.opcode("emptyHash",n),i},blockParamIndex:function(e){for(var t=0,r=this.options.blockParams.length;t<r;t++){var n=this.options.blockParams[t],i=n&&a.indexOf(n,e);if(n&&i>=0)return[t,i]}}}},function(e,t,r){"use strict";var n=r(13).default,i=r(1).default;t.__esModule=!0;var o=r(4),a=i(r(6)),s=r(5),l=i(r(53));function c(e){this.value=e}function u(){}u.prototype={nameLookup:function(e,t){return this.internalNameLookup(e,t)},depthedLookup:function(e){return[this.aliasable("container.lookup"),"(depths, ",JSON.stringify(e),")"]},compilerInfo:function(){var e=o.COMPILER_REVISION;return[e,o.REVISION_CHANGES[e]]},appendToBuffer:function(e,t,r){return s.isArray(e)||(e=[e]),e=this.source.wrap(e,t),this.environment.isSimple?["return ",e,";"]:r?["buffer += ",e,";"]:(e.appendToBuffer=!0,e)},initializeBuffer:function(){return this.quotedString("")},internalNameLookup:function(e,t){return this.lookupPropertyFunctionIsUsed=!0,["lookupProperty(",e,",",JSON.stringify(t),")"]},lookupPropertyFunctionIsUsed:!1,compile:function(e,t,r,n){this.environment=e,this.options=t,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!n,this.name=this.environment.name,this.isChild=!!r,this.context=r||{decorators:[],programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(e,t),this.useDepths=this.useDepths||e.useDepths||e.useDecorators||this.options.compat,this.useBlockParams=this.useBlockParams||e.useBlockParams;var i=e.opcodes,o=void 0,s=void 0,l=void 0,c=void 0;for(l=0,c=i.length;l<c;l++)o=i[l],this.source.currentLocation=o.loc,s=s||o.loc,this[o.opcode].apply(this,o.args);if(this.source.currentLocation=s,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new a.default("Compile completed with content left on stack");this.decorators.isEmpty()?this.decorators=void 0:(this.useDecorators=!0,this.decorators.prepend(["var decorators = container.decorators, ",this.lookupPropertyFunctionVarDeclaration(),";\n"]),this.decorators.push("return fn;"),n?this.decorators=Function.apply(this,["fn","props","container","depth0","data","blockParams","depths",this.decorators.merge()]):(this.decorators.prepend("function(fn, props, container, depth0, data, blockParams, depths) {\n"),this.decorators.push("}\n"),this.decorators=this.decorators.merge()));var u=this.createFunctionContext(n);if(this.isChild)return u;var p={compiler:this.compilerInfo(),main:u};this.decorators&&(p.main_d=this.decorators,p.useDecorators=!0);var h=this.context,d=h.programs,f=h.decorators;for(l=0,c=d.length;l<c;l++)d[l]&&(p[l]=d[l],f[l]&&(p[l+"_d"]=f[l],p.useDecorators=!0));return this.environment.usePartial&&(p.usePartial=!0),this.options.data&&(p.useData=!0),this.useDepths&&(p.useDepths=!0),this.useBlockParams&&(p.useBlockParams=!0),this.options.compat&&(p.compat=!0),n?p.compilerOptions=this.options:(p.compiler=JSON.stringify(p.compiler),this.source.currentLocation={start:{line:1,column:0}},p=this.objectLiteral(p),t.srcName?(p=p.toStringWithSourceMap({file:t.destName})).map=p.map&&p.map.toString():p=p.toString()),p},preamble:function(){this.lastContext=0,this.source=new l.default(this.options.srcName),this.decorators=new l.default(this.options.srcName)},createFunctionContext:function(e){var t=this,r="",i=this.stackVars.concat(this.registers.list);i.length>0&&(r+=", "+i.join(", "));var o=0;n(this.aliases).forEach((function(e){var n=t.aliases[e];n.children&&n.referenceCount>1&&(r+=", alias"+ ++o+"="+e,n.children[0]="alias"+o)})),this.lookupPropertyFunctionIsUsed&&(r+=", "+this.lookupPropertyFunctionVarDeclaration());var a=["container","depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&a.push("blockParams"),this.useDepths&&a.push("depths");var s=this.mergeSource(r);return e?(a.push(s),Function.apply(this,a)):this.source.wrap(["function(",a.join(","),") {\n  ",s,"}"])},mergeSource:function(e){var t=this.environment.isSimple,r=!this.forceBuffer,n=void 0,i=void 0,o=void 0,a=void 0;return this.source.each((function(e){e.appendToBuffer?(o?e.prepend("  + "):o=e,a=e):(o&&(i?o.prepend("buffer += "):n=!0,a.add(";"),o=a=void 0),i=!0,t||(r=!1))})),r?o?(o.prepend("return "),a.add(";")):i||this.source.push('return "";'):(e+=", buffer = "+(n?"":this.initializeBuffer()),o?(o.prepend("return buffer + "),a.add(";")):this.source.push("return buffer;")),e&&this.source.prepend("var "+e.substring(2)+(n?"":";\n")),this.source.merge()},lookupPropertyFunctionVarDeclaration:function(){return"\n      lookupProperty = container.lookupProperty || function(parent, propertyName) {\n        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {\n          return parent[propertyName];\n        }\n        return undefined\n    }\n    ".trim()},blockValue:function(e){var t=this.aliasable("container.hooks.blockHelperMissing"),r=[this.contextName(0)];this.setupHelperArgs(e,0,r);var n=this.popStack();r.splice(1,0,n),this.push(this.source.functionCall(t,"call",r))},ambiguousBlockValue:function(){var e=this.aliasable("container.hooks.blockHelperMissing"),t=[this.contextName(0)];this.setupHelperArgs("",0,t,!0),this.flushInline();var r=this.topStack();t.splice(1,0,r),this.pushSource(["if (!",this.lastHelper,") { ",r," = ",this.source.functionCall(e,"call",t),"}"])},appendContent:function(e){this.pendingContent?e=this.pendingContent+e:this.pendingLocation=this.source.currentLocation,this.pendingContent=e},append:function(){if(this.isInline())this.replaceStack((function(e){return[" != null ? ",e,' : ""']})),this.pushSource(this.appendToBuffer(this.popStack()));else{var e=this.popStack();this.pushSource(["if (",e," != null) { ",this.appendToBuffer(e,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("container.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(e){this.lastContext=e},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(e,t,r,n){var i=0;n||!this.options.compat||this.lastContext?this.pushContext():this.push(this.depthedLookup(e[i++])),this.resolvePath("context",e,i,t,r)},lookupBlockParam:function(e,t){this.useBlockParams=!0,this.push(["blockParams[",e[0],"][",e[1],"]"]),this.resolvePath("context",t,1)},lookupData:function(e,t,r){e?this.pushStackLiteral("container.data(data, "+e+")"):this.pushStackLiteral("data"),this.resolvePath("data",t,0,!0,r)},resolvePath:function(e,t,r,n,i){var o=this;if(this.options.strict||this.options.assumeObjects)this.push(function(e,t,r,n){var i=t.popStack(),o=0,a=r.length;for(e&&a--;o<a;o++)i=t.nameLookup(i,r[o],n);return e?[t.aliasable("container.strict"),"(",i,", ",t.quotedString(r[o]),", ",JSON.stringify(t.source.currentLocation)," )"]:i}(this.options.strict&&i,this,t,e));else for(var a=t.length;r<a;r++)this.replaceStack((function(i){var a=o.nameLookup(i,t[r],e);return n?[" && ",a]:[" != null ? ",a," : ",i]}))},resolvePossibleLambda:function(){this.push([this.aliasable("container.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(e,t){this.pushContext(),this.pushString(t),"SubExpression"!==t&&("string"==typeof e?this.pushString(e):this.pushStackLiteral(e))},emptyHash:function(e){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(e?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:{},types:[],contexts:[],ids:[]}},popHash:function(){var e=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(e.ids)),this.stringParams&&(this.push(this.objectLiteral(e.contexts)),this.push(this.objectLiteral(e.types))),this.push(this.objectLiteral(e.values))},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){null!=e?this.pushStackLiteral(this.programExpression(e)):this.pushStackLiteral(null)},registerDecorator:function(e,t){var r=this.nameLookup("decorators",t,"decorator"),n=this.setupHelperArgs(t,e);this.decorators.push(["fn = ",this.decorators.functionCall(r,"",["fn","props","container",n])," || fn;"])},invokeHelper:function(e,t,r){var n=this.popStack(),i=this.setupHelper(e,t),o=[];r&&o.push(i.name),o.push(n),this.options.strict||o.push(this.aliasable("container.hooks.helperMissing"));var a=["(",this.itemsSeparatedBy(o,"||"),")"],s=this.source.functionCall(a,"call",i.callParams);this.push(s)},itemsSeparatedBy:function(e,t){var r=[];r.push(e[0]);for(var n=1;n<e.length;n++)r.push(t,e[n]);return r},invokeKnownHelper:function(e,t){var r=this.setupHelper(e,t);this.push(this.source.functionCall(r.name,"call",r.callParams))},invokeAmbiguous:function(e,t){this.useRegister("helper");var r=this.popStack();this.emptyHash();var n=this.setupHelper(0,e,t),i=["(","(helper = ",this.lastHelper=this.nameLookup("helpers",e,"helper")," || ",r,")"];this.options.strict||(i[0]="(helper = ",i.push(" != null ? helper : ",this.aliasable("container.hooks.helperMissing"))),this.push(["(",i,n.paramsInit?["),(",n.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",n.callParams)," : helper))"])},invokePartial:function(e,t,r){var n=[],i=this.setupParams(t,1,n);e&&(t=this.popStack(),delete i.name),r&&(i.indent=JSON.stringify(r)),i.helpers="helpers",i.partials="partials",i.decorators="container.decorators",e?n.unshift(t):n.unshift(this.nameLookup("partials",t,"partial")),this.options.compat&&(i.depths="depths"),i=this.objectLiteral(i),n.push(i),this.push(this.source.functionCall("container.invokePartial","",n))},assignToHash:function(e){var t=this.popStack(),r=void 0,n=void 0,i=void 0;this.trackIds&&(i=this.popStack()),this.stringParams&&(n=this.popStack(),r=this.popStack());var o=this.hash;r&&(o.contexts[e]=r),n&&(o.types[e]=n),i&&(o.ids[e]=i),o.values[e]=t},pushId:function(e,t,r){"BlockParam"===e?this.pushStackLiteral("blockParams["+t[0]+"].path["+t[1]+"]"+(r?" + "+JSON.stringify("."+r):"")):"PathExpression"===e?this.pushString(t):"SubExpression"===e?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:u,compileChildren:function(e,t){for(var r=e.children,n=void 0,i=void 0,o=0,a=r.length;o<a;o++){n=r[o],i=new this.compiler;var s=this.matchExistingProgram(n);if(null==s){this.context.programs.push("");var l=this.context.programs.length;n.index=l,n.name="program"+l,this.context.programs[l]=i.compile(n,t,this.context,!this.precompile),this.context.decorators[l]=i.decorators,this.context.environments[l]=n,this.useDepths=this.useDepths||i.useDepths,this.useBlockParams=this.useBlockParams||i.useBlockParams,n.useDepths=this.useDepths,n.useBlockParams=this.useBlockParams}else n.index=s.index,n.name="program"+s.index,this.useDepths=this.useDepths||s.useDepths,this.useBlockParams=this.useBlockParams||s.useBlockParams}},matchExistingProgram:function(e){for(var t=0,r=this.context.environments.length;t<r;t++){var n=this.context.environments[t];if(n&&n.equals(e))return n}},programExpression:function(e){var t=this.environment.children[e],r=[t.index,"data",t.blockParams];return(this.useBlockParams||this.useDepths)&&r.push("blockParams"),this.useDepths&&r.push("depths"),"container.program("+r.join(", ")+")"},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},push:function(e){return e instanceof c||(e=this.source.wrap(e)),this.inlineStack.push(e),e},pushStackLiteral:function(e){this.push(new c(e))},pushSource:function(e){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),e&&this.source.push(e)},replaceStack:function(e){var t=["("],r=void 0,n=void 0,i=void 0;if(!this.isInline())throw new a.default("replaceStack on non-inline");var o=this.popStack(!0);if(o instanceof c)t=["(",r=[o.value]],i=!0;else{n=!0;var s=this.incrStack();t=["((",this.push(s)," = ",o,")"],r=this.topStack()}var l=e.call(this,r);i||this.popStack(),n&&this.stackSlot--,this.push(t.concat(l,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var e=this.inlineStack;this.inlineStack=[];for(var t=0,r=e.length;t<r;t++){var n=e[t];if(n instanceof c)this.compileStack.push(n);else{var i=this.incrStack();this.pushSource([i," = ",n,";"]),this.compileStack.push(i)}}},isInline:function(){return this.inlineStack.length},popStack:function(e){var t=this.isInline(),r=(t?this.inlineStack:this.compileStack).pop();if(!e&&r instanceof c)return r.value;if(!t){if(!this.stackSlot)throw new a.default("Invalid stack pop");this.stackSlot--}return r},topStack:function(){var e=this.isInline()?this.inlineStack:this.compileStack,t=e[e.length-1];return t instanceof c?t.value:t},contextName:function(e){return this.useDepths&&e?"depths["+e+"]":"depth"+e},quotedString:function(e){return this.source.quotedString(e)},objectLiteral:function(e){return this.source.objectLiteral(e)},aliasable:function(e){var t=this.aliases[e];return t?(t.referenceCount++,t):((t=this.aliases[e]=this.source.wrap(e)).aliasable=!0,t.referenceCount=1,t)},setupHelper:function(e,t,r){var n=[];return{params:n,paramsInit:this.setupHelperArgs(t,e,n,r),name:this.nameLookup("helpers",t,"helper"),callParams:[this.aliasable(this.contextName(0)+" != null ? "+this.contextName(0)+" : (container.nullContext || {})")].concat(n)}},setupParams:function(e,t,r){var n={},i=[],o=[],a=[],s=!r,l=void 0;s&&(r=[]),n.name=this.quotedString(e),n.hash=this.popStack(),this.trackIds&&(n.hashIds=this.popStack()),this.stringParams&&(n.hashTypes=this.popStack(),n.hashContexts=this.popStack());var c=this.popStack(),u=this.popStack();(u||c)&&(n.fn=u||"container.noop",n.inverse=c||"container.noop");for(var p=t;p--;)l=this.popStack(),r[p]=l,this.trackIds&&(a[p]=this.popStack()),this.stringParams&&(o[p]=this.popStack(),i[p]=this.popStack());return s&&(n.args=this.source.generateArray(r)),this.trackIds&&(n.ids=this.source.generateArray(a)),this.stringParams&&(n.types=this.source.generateArray(o),n.contexts=this.source.generateArray(i)),this.options.data&&(n.data="data"),this.useBlockParams&&(n.blockParams="blockParams"),n},setupHelperArgs:function(e,t,r,n){var i=this.setupParams(e,t,r);return i.loc=JSON.stringify(this.source.currentLocation),i=this.objectLiteral(i),n?(this.useRegister("options"),r.push("options"),["options=",i]):r?(r.push(i),""):i}},function(){for(var e="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),t=u.RESERVED_WORDS={},r=0,n=e.length;r<n;r++)t[e[r]]=!0}(),u.isValidJavaScriptVariableName=function(e){return!u.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(e)},t.default=u,e.exports=t.default},function(e,t,r){"use strict";var n=r(13).default;t.__esModule=!0;var i=r(5),o=void 0;function a(e,t,r){if(i.isArray(e)){for(var n=[],o=0,a=e.length;o<a;o++)n.push(t.wrap(e[o],r));return n}return"boolean"==typeof e||"number"==typeof e?e+"":e}function s(e){this.srcFile=e,this.source=[]}o||((o=function(e,t,r,n){this.src="",n&&this.add(n)}).prototype={add:function(e){i.isArray(e)&&(e=e.join("")),this.src+=e},prepend:function(e){i.isArray(e)&&(e=e.join("")),this.src=e+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}}),s.prototype={isEmpty:function(){return!this.source.length},prepend:function(e,t){this.source.unshift(this.wrap(e,t))},push:function(e,t){this.source.push(this.wrap(e,t))},merge:function(){var e=this.empty();return this.each((function(t){e.add(["  ",t,"\n"])})),e},each:function(e){for(var t=0,r=this.source.length;t<r;t++)e(this.source[t])},empty:function(){var e=this.currentLocation||{start:{}};return new o(e.start.line,e.start.column,this.srcFile)},wrap:function(e){var t=arguments.length<=1||void 0===arguments[1]?this.currentLocation||{start:{}}:arguments[1];return e instanceof o?e:(e=a(e,this,t),new o(t.start.line,t.start.column,this.srcFile,e))},functionCall:function(e,t,r){return r=this.generateList(r),this.wrap([e,t?"."+t+"(":"(",r,")"])},quotedString:function(e){return'"'+(e+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(e){var t=this,r=[];n(e).forEach((function(n){var i=a(e[n],t);"undefined"!==i&&r.push([t.quotedString(n),":",i])}));var i=this.generateList(r);return i.prepend("{"),i.add("}"),i},generateList:function(e){for(var t=this.empty(),r=0,n=e.length;r<n;r++)r&&t.add(","),t.add(a(e[r],this));return t},generateArray:function(e){var t=this.generateList(e);return t.prepend("["),t.add("]"),t}},t.default=s,e.exports=t.default}])},e.exports=t()},4525:(e,t)=>{
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
t.read=function(e,t,r,n,i){var o,a,s=8*i-n-1,l=(1<<s)-1,c=l>>1,u=-7,p=r?i-1:0,h=r?-1:1,d=e[t+p];for(p+=h,o=d&(1<<-u)-1,d>>=-u,u+=s;u>0;o=256*o+e[t+p],p+=h,u-=8);for(a=o&(1<<-u)-1,o>>=-u,u+=n;u>0;a=256*a+e[t+p],p+=h,u-=8);if(0===o)o=1-c;else{if(o===l)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,n),o-=c}return(d?-1:1)*a*Math.pow(2,o-n)},t.write=function(e,t,r,n,i,o){var a,s,l,c=8*o-i-1,u=(1<<c)-1,p=u>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,f=n?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),(t+=a+p>=1?h/l:h*Math.pow(2,1-p))*l>=2&&(a++,l/=2),a+p>=u?(s=0,a=u):a+p>=1?(s=(t*l-1)*Math.pow(2,i),a+=p):(s=t*Math.pow(2,p-1)*Math.pow(2,i),a=0));i>=8;e[r+d]=255&s,d+=f,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;e[r+d]=255&a,d+=f,a/=256,c-=8);e[r+d-f]|=128*g}},1246:e=>{function t(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
e.exports=function(e){return null!=e&&(t(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&t(e.slice(0,0))}(e)||!!e._isBuffer)}},2641:function(e,t){var r,n=this&&this.__extends||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};function r(e){if(!e)return r.__;Array.prototype.reduce||(Array.prototype.reduce=function(e,t){for(var r=t,n=0;n<this.length;n++)r=e(r,this[n],n,this);return r});var t="";return("."+e).split(".").reduce((function(e,n,i,o){t?t+="."+n:t=n;var a=e["__"+t];return void 0===a&&(r.Logger.prototype=e,a=new r.Logger(t),e["__"+t]=a),a}),r.__)}!function(e){function t(e,t,r){void 0!==t[e]&&(null!==t[e]?r[e]=t[e]:delete r[e])}function r(t){if(null!=e.enabled&&!e.enabled)return!1;if(null!=e.maxMessages&&e.maxMessages<1)return!1;try{if(t.userAgentRegex&&!new RegExp(t.userAgentRegex).test(navigator.userAgent))return!1}catch(e){}try{if(t.ipRegex&&e.clientIP&&!new RegExp(t.ipRegex).test(e.clientIP))return!1}catch(e){}return!0}function i(e,t){try{if(e.disallow&&new RegExp(e.disallow).test(t))return!1}catch(e){}return!0}function o(e){return"function"==typeof e?e instanceof RegExp?e.toString():e():e}e.requestId="";var a=function(e,t,r){this.msg=e,this.meta=t,this.finalString=r};function s(e){var t,r=o(e);switch(typeof r){case"string":return new a(r,null,r);case"number":case"boolean":return t=r.toString(),new a(t,null,t);case"undefined":return new a("undefined",null,"undefined");case"object":return r instanceof RegExp||r instanceof String||r instanceof Number||r instanceof Boolean?(t=r.toString(),new a(t,null,t)):new a(null,r,JSON.stringify(r));default:return new a("unknown",null,"unknown")}}function l(){return 1e3}function c(){return 2e3}function u(){return 3e3}function p(){return 4e3}function h(){return 5e3}function d(){return 6e3}function f(e){return e<=1e3?"trace":e<=2e3?"debug":e<=3e3?"info":e<=4e3?"warn":e<=5e3?"error":"fatal"}e.setOptions=function(e){return t("enabled",e,this),t("maxMessages",e,this),t("defaultAjaxUrl",e,this),t("clientIP",e,this),t("requestId",e,this),t("defaultBeforeSend",e,this),this},e.getAllLevel=function(){return-2147483648},e.getTraceLevel=l,e.getDebugLevel=c,e.getInfoLevel=u,e.getWarnLevel=p,e.getErrorLevel=h,e.getFatalLevel=d,e.getOffLevel=function(){return 2147483647};var g=function(e,t){this.inner=t,this.name="JL.Exception",this.message=s(e).finalString};e.Exception=g,g.prototype=new Error;var y=function(e,t,r,n){this.l=e,this.m=t,this.n=r,this.t=n};e.LogItem=y;var m=function(){function n(t,r){this.appenderName=t,this.sendLogItems=r,this.level=e.getTraceLevel(),this.sendWithBufferLevel=2147483647,this.storeInBufferLevel=-2147483648,this.bufferSize=0,this.batchSize=1,this.buffer=[],this.batchBuffer=[]}return n.prototype.setOptions=function(e){return t("level",e,this),t("ipRegex",e,this),t("userAgentRegex",e,this),t("disallow",e,this),t("sendWithBufferLevel",e,this),t("storeInBufferLevel",e,this),t("bufferSize",e,this),t("batchSize",e,this),this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize),this},n.prototype.log=function(e,t,n,o,a,s,l){var c;r(this)&&i(this,s)&&(a<this.storeInBufferLevel||(c=new y(a,s,l,(new Date).getTime()),a<this.level?this.bufferSize>0&&(this.buffer.push(c),this.buffer.length>this.bufferSize&&this.buffer.shift()):(a<this.sendWithBufferLevel||this.buffer.length&&(this.batchBuffer=this.batchBuffer.concat(this.buffer),this.buffer.length=0),this.batchBuffer.push(c),this.batchBuffer.length>=this.batchSize&&this.sendBatch())))},n.prototype.sendBatch=function(){0!=this.batchBuffer.length&&(null!=e.maxMessages&&e.maxMessages<1||(null!=e.maxMessages&&(e.maxMessages-=this.batchBuffer.length),this.sendLogItems(this.batchBuffer),this.batchBuffer.length=0))},n}();e.Appender=m;var v=function(r){function i(e){r.call(this,e,i.prototype.sendLogItemsAjax)}return n(i,r),i.prototype.setOptions=function(e){return t("url",e,this),t("beforeSend",e,this),r.prototype.setOptions.call(this,e),this},i.prototype.sendLogItemsAjax=function(t){try{var r="/jsnlog.logger";null!=e.defaultAjaxUrl&&(r=e.defaultAjaxUrl),this.url&&(r=this.url);var n=this.getXhr(r),i={r:e.requestId,lg:t};"function"==typeof this.beforeSend?this.beforeSend.call(this,n,i):"function"==typeof e.defaultBeforeSend&&e.defaultBeforeSend.call(this,n,i);var o=JSON.stringify(i);n.send(o)}catch(e){}},i.prototype.getXhr=function(t){var r=new XMLHttpRequest;if(!("withCredentials"in r)&&"undefined"!=typeof XDomainRequest){var n=new XDomainRequest;return n.open("POST",t),n}return r.open("POST",t),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("JSNLog-RequestId",e.requestId),r},i}(m);e.AjaxAppender=v;var _=function(t){function r(e){t.call(this,e,r.prototype.sendLogItemsConsole)}return n(r,t),r.prototype.clog=function(e){console.log(e)},r.prototype.cerror=function(e){console.error?console.error(e):this.clog(e)},r.prototype.cwarn=function(e){console.warn?console.warn(e):this.clog(e)},r.prototype.cinfo=function(e){console.info?console.info(e):this.clog(e)},r.prototype.cdebug=function(e){console.debug?console.debug(e):this.cinfo(e)},r.prototype.sendLogItemsConsole=function(t){try{if(!console)return;var r;for(r=0;r<t.length;++r){var n=t[r],i=n.n+": "+n.m;"undefined"==typeof window&&(i=new Date(n.t)+" | "+i),n.l<=e.getDebugLevel()?this.cdebug(i):n.l<=e.getInfoLevel()?this.cinfo(i):n.l<=e.getWarnLevel()?this.cwarn(i):this.cerror(i)}}catch(e){}},r}(m);e.ConsoleAppender=_;var w=function(){function e(e){this.loggerName=e,this.seenRegexes=[]}return e.prototype.setOptions=function(e){return t("level",e,this),t("userAgentRegex",e,this),t("disallow",e,this),t("ipRegex",e,this),t("appenders",e,this),t("onceOnly",e,this),this.seenRegexes=[],this},e.prototype.buildExceptionObject=function(e){var t={};return e.stack?t.stack=e.stack:t.e=e,e.message&&(t.message=e.message),e.name&&(t.name=e.name),e.data&&(t.data=e.data),e.inner&&(t.inner=this.buildExceptionObject(e.inner)),t},e.prototype.log=function(e,t,n){var a,l,c=0;if(!this.appenders)return this;if(e>=this.level&&r(this)&&(n?(l=this.buildExceptionObject(n)).logData=o(t):l=t,i(this,(a=s(l)).finalString))){if(this.onceOnly)for(c=this.onceOnly.length-1;c>=0;){if(new RegExp(this.onceOnly[c]).test(a.finalString)){if(this.seenRegexes[c])return this;this.seenRegexes[c]=!0}c--}for(a.meta=a.meta||{},a.meta.loggerName=this.loggerName,c=this.appenders.length-1;c>=0;)this.appenders[c].log(f(e),a.msg,a.meta,(function(){}),e,a.finalString,this.loggerName),c--}return this},e.prototype.trace=function(e){return this.log(1e3,e)},e.prototype.debug=function(e){return this.log(2e3,e)},e.prototype.info=function(e){return this.log(3e3,e)},e.prototype.warn=function(e){return this.log(4e3,e)},e.prototype.error=function(e){return this.log(5e3,e)},e.prototype.fatal=function(e){return this.log(6e3,e)},e.prototype.fatalException=function(e,t){return this.log(6e3,e,t)},e}();e.Logger=w,e.createAjaxAppender=function(e){return new v(e)},e.createConsoleAppender=function(e){return new _(e)};var S=new v("");"undefined"==typeof window&&(S=new _("")),e.__=new e.Logger(""),e.__.setOptions({level:e.getDebugLevel(),appenders:[S]})}(r||(r={})),t.JL=r,"function"==typeof __jsnlog_configure&&__jsnlog_configure(r)},3837:(e,t,r)=>{var n=r(2486).lW;
/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/e.exports=function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=r[a]={exports:{}};t[a][0].call(c.exports,(function(e){return i(t[a][1][e]||e)}),c,c.exports,e,t,r,n)}return r[a].exports}for(var o=void 0,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,r){"use strict";var n=e("./utils"),i=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(e){for(var t,r,i,a,s,l,c,u=[],p=0,h=e.length,d=h,f="string"!==n.getTypeOf(e);p<e.length;)d=h-p,i=f?(t=e[p++],r=p<h?e[p++]:0,p<h?e[p++]:0):(t=e.charCodeAt(p++),r=p<h?e.charCodeAt(p++):0,p<h?e.charCodeAt(p++):0),a=t>>2,s=(3&t)<<4|r>>4,l=1<d?(15&r)<<2|i>>6:64,c=2<d?63&i:64,u.push(o.charAt(a)+o.charAt(s)+o.charAt(l)+o.charAt(c));return u.join("")},r.decode=function(e){var t,r,n,a,s,l,c=0,u=0,p="data:";if(e.substr(0,p.length)===p)throw new Error("Invalid base64 input, it looks like a data url.");var h,d=3*(e=e.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(e.charAt(e.length-1)===o.charAt(64)&&d--,e.charAt(e.length-2)===o.charAt(64)&&d--,d%1!=0)throw new Error("Invalid base64 input, bad content length.");for(h=i.uint8array?new Uint8Array(0|d):new Array(0|d);c<e.length;)t=o.indexOf(e.charAt(c++))<<2|(a=o.indexOf(e.charAt(c++)))>>4,r=(15&a)<<4|(s=o.indexOf(e.charAt(c++)))>>2,n=(3&s)<<6|(l=o.indexOf(e.charAt(c++))),h[u++]=t,64!==s&&(h[u++]=r),64!==l&&(h[u++]=n);return h}},{"./support":30,"./utils":32}],2:[function(e,t,r){"use strict";var n=e("./external"),i=e("./stream/DataWorker"),o=e("./stream/Crc32Probe"),a=e("./stream/DataLengthProbe");function s(e,t,r,n,i){this.compressedSize=e,this.uncompressedSize=t,this.crc32=r,this.compression=n,this.compressedContent=i}s.prototype={getContentWorker:function(){var e=new i(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),t=this;return e.on("end",(function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),e},getCompressedWorker:function(){return new i(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},s.createWorkerFrom=function(e,t,r){return e.pipe(new o).pipe(new a("uncompressedSize")).pipe(t.compressWorker(r)).pipe(new a("compressedSize")).withStreamInfo("compression",t)},t.exports=s},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,r){"use strict";var n=e("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},r.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,r){"use strict";var n=e("./utils"),i=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t){return void 0!==e&&e.length?"string"!==n.getTypeOf(e)?function(e,t,r,n){var o=i,a=n+r;e^=-1;for(var s=n;s<a;s++)e=e>>>8^o[255&(e^t[s])];return-1^e}(0|t,e,e.length,0):function(e,t,r,n){var o=i,a=n+r;e^=-1;for(var s=n;s<a;s++)e=e>>>8^o[255&(e^t.charCodeAt(s))];return-1^e}(0|t,e,e.length,0):0}},{"./utils":32}],5:[function(e,t,r){"use strict";r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(e,t,r){"use strict";var n=null;n="undefined"!=typeof Promise?Promise:e("lie"),t.exports={Promise:n}},{lie:37}],7:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=e("pako"),o=e("./utils"),a=e("./stream/GenericWorker"),s=n?"uint8array":"array";function l(e,t){a.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}r.magic="\b\0",o.inherits(l,a),l.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(o.transformTo(s,e.data),!1)},l.prototype.flush=function(){a.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},r.compressWorker=function(e){return new l("Deflate",e)},r.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,t,r){"use strict";function n(e,t){var r,n="";for(r=0;r<t;r++)n+=String.fromCharCode(255&e),e>>>=8;return n}function i(e,t,r,i,a,u){var p,h,d=e.file,f=e.compression,g=u!==s.utf8encode,y=o.transformTo("string",u(d.name)),m=o.transformTo("string",s.utf8encode(d.name)),v=d.comment,_=o.transformTo("string",u(v)),w=o.transformTo("string",s.utf8encode(v)),S=m.length!==d.name.length,E=w.length!==v.length,b="",C="",L="",T=d.dir,A=d.date,x={crc32:0,compressedSize:0,uncompressedSize:0};t&&!r||(x.crc32=e.crc32,x.compressedSize=e.compressedSize,x.uncompressedSize=e.uncompressedSize);var P=0;t&&(P|=8),g||!S&&!E||(P|=2048);var O=0,I=0;T&&(O|=16),"UNIX"===a?(I=798,O|=function(e,t){var r=e;return e||(r=t?16893:33204),(65535&r)<<16}(d.unixPermissions,T)):(I=20,O|=function(e){return 63&(e||0)}(d.dosPermissions)),p=A.getUTCHours(),p<<=6,p|=A.getUTCMinutes(),p<<=5,p|=A.getUTCSeconds()/2,h=A.getUTCFullYear()-1980,h<<=4,h|=A.getUTCMonth()+1,h<<=5,h|=A.getUTCDate(),S&&(C=n(1,1)+n(l(y),4)+m,b+="up"+n(C.length,2)+C),E&&(L=n(1,1)+n(l(_),4)+w,b+="uc"+n(L.length,2)+L);var R="";return R+="\n\0",R+=n(P,2),R+=f.magic,R+=n(p,2),R+=n(h,2),R+=n(x.crc32,4),R+=n(x.compressedSize,4),R+=n(x.uncompressedSize,4),R+=n(y.length,2),R+=n(b.length,2),{fileRecord:c.LOCAL_FILE_HEADER+R+y+b,dirRecord:c.CENTRAL_FILE_HEADER+n(I,2)+R+n(_.length,2)+"\0\0\0\0"+n(O,4)+n(i,4)+y+b+_}}var o=e("../utils"),a=e("../stream/GenericWorker"),s=e("../utf8"),l=e("../crc32"),c=e("../signature");function u(e,t,r,n){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=r,this.encodeFileName=n,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(u,a),u.prototype.push=function(e){var t=e.meta.percent||0,r=this.entriesCount,n=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,a.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:r?(t+100*(r-n-1))/r:100}}))},u.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var r=i(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:r.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,r=i(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(r.dirRecord),t)this.push({data:function(e){return c.DATA_DESCRIPTOR+n(e.crc32,4)+n(e.compressedSize,4)+n(e.uncompressedSize,4)}(e),meta:{percent:100}});else for(this.push({data:r.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var r=this.bytesWritten-e,i=function(e,t,r,i,a){var s=o.transformTo("string",a(i));return c.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(e,2)+n(e,2)+n(t,4)+n(r,4)+n(s.length,2)+s}(this.dirRecords.length,r,e,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()})),e.on("error",(function(e){t.error(e)})),this},u.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(e){var t=this._sources;if(!a.prototype.error.call(this,e))return!1;for(var r=0;r<t.length;r++)try{t[r].error(e)}catch(e){}return!0},u.prototype.lock=function(){a.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=u},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,r){"use strict";var n=e("../compressions"),i=e("./ZipFileWorker");r.generateWorker=function(e,t,r){var o=new i(t.streamFiles,r,t.platform,t.encodeFileName),a=0;try{e.forEach((function(e,r){a++;var i=function(e,t){var r=e||t,i=n[r];if(!i)throw new Error(r+" is not a valid compression method !");return i}(r.options.compression,t.compression),s=r.options.compressionOptions||t.compressionOptions||{},l=r.dir,c=r.date;r._compressWorker(i,s).withStreamInfo("file",{name:e,dir:l,date:c,comment:r.comment||"",unixPermissions:r.unixPermissions,dosPermissions:r.dosPermissions}).pipe(o)})),o.entriesCount=a}catch(e){o.error(e)}return o}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,r){"use strict";function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var e=new n;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}(n.prototype=e("./object")).loadAsync=e("./load"),n.support=e("./support"),n.defaults=e("./defaults"),n.version="3.10.1",n.loadAsync=function(e,t){return(new n).loadAsync(e,t)},n.external=e("./external"),t.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,r){"use strict";var n=e("./utils"),i=e("./external"),o=e("./utf8"),a=e("./zipEntries"),s=e("./stream/Crc32Probe"),l=e("./nodejsUtils");function c(e){return new i.Promise((function(t,r){var n=e.decompressed.getContentWorker().pipe(new s);n.on("error",(function(e){r(e)})).on("end",(function(){n.streamInfo.crc32!==e.decompressed.crc32?r(new Error("Corrupted zip : CRC32 mismatch")):t()})).resume()}))}t.exports=function(e,t){var r=this;return t=n.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),l.isNode&&l.isStream(e)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then((function(e){var r=new a(t);return r.load(e),r})).then((function(e){var r=[i.Promise.resolve(e)],n=e.files;if(t.checkCRC32)for(var o=0;o<n.length;o++)r.push(c(n[o]));return i.Promise.all(r)})).then((function(e){for(var i=e.shift(),o=i.files,a=0;a<o.length;a++){var s=o[a],l=s.fileNameStr,c=n.resolve(s.fileNameStr);r.file(c,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileCommentStr.length?s.fileCommentStr:null,unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions,createFolders:t.createFolders}),s.dir||(r.file(c).unsafeOriginalName=l)}return i.zipComment.length&&(r.comment=i.zipComment),r}))}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,r){"use strict";var n=e("../utils"),i=e("../stream/GenericWorker");function o(e,t){i.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}n.inherits(o,i),o.prototype._bindStream=function(e){var t=this;(this._stream=e).pause(),e.on("data",(function(e){t.push({data:e,meta:{percent:0}})})).on("error",(function(e){t.isPaused?this.generatedError=e:t.error(e)})).on("end",(function(){t.isPaused?t._upstreamEnded=!0:t.end()}))},o.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,r){"use strict";var n=e("readable-stream").Readable;function i(e,t,r){n.call(this,t),this._helper=e;var i=this;e.on("data",(function(e,t){i.push(e)||i._helper.pause(),r&&r(t)})).on("error",(function(e){i.emit("error",e)})).on("end",(function(){i.push(null)}))}e("../utils").inherits(i,n),i.prototype._read=function(){this._helper.resume()},t.exports=i},{"../utils":32,"readable-stream":16}],14:[function(e,t,r){"use strict";t.exports={isNode:void 0!==n,newBufferFrom:function(e,t){if(n.from&&n.from!==Uint8Array.from)return n.from(e,t);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new n(e,t)},allocBuffer:function(e){if(n.alloc)return n.alloc(e);var t=new n(e);return t.fill(0),t},isBuffer:function(e){return n.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t,r){"use strict";function n(e,t,r){var n,i=o.getTypeOf(t),s=o.extend(r||{},l);s.date=s.date||new Date,null!==s.compression&&(s.compression=s.compression.toUpperCase()),"string"==typeof s.unixPermissions&&(s.unixPermissions=parseInt(s.unixPermissions,8)),s.unixPermissions&&16384&s.unixPermissions&&(s.dir=!0),s.dosPermissions&&16&s.dosPermissions&&(s.dir=!0),s.dir&&(e=g(e)),s.createFolders&&(n=f(e))&&y.call(this,n,!0);var p="string"===i&&!1===s.binary&&!1===s.base64;r&&void 0!==r.binary||(s.binary=!p),(t instanceof c&&0===t.uncompressedSize||s.dir||!t||0===t.length)&&(s.base64=!1,s.binary=!0,t="",s.compression="STORE",i="string");var m=null;m=t instanceof c||t instanceof a?t:h.isNode&&h.isStream(t)?new d(e,t):o.prepareContent(e,t,s.binary,s.optimizedBinaryString,s.base64);var v=new u(e,m,s);this.files[e]=v}var i=e("./utf8"),o=e("./utils"),a=e("./stream/GenericWorker"),s=e("./stream/StreamHelper"),l=e("./defaults"),c=e("./compressedObject"),u=e("./zipObject"),p=e("./generate"),h=e("./nodejsUtils"),d=e("./nodejs/NodejsStreamInputAdapter"),f=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return 0<t?e.substring(0,t):""},g=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},y=function(e,t){return t=void 0!==t?t:l.createFolders,e=g(e),this.files[e]||n.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function m(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var v={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,r,n;for(t in this.files)n=this.files[t],(r=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(r,n)},filter:function(e){var t=[];return this.forEach((function(r,n){e(r,n)&&t.push(n)})),t},file:function(e,t,r){if(1!==arguments.length)return e=this.root+e,n.call(this,e,t,r),this;if(m(e)){var i=e;return this.filter((function(e,t){return!t.dir&&i.test(e)}))}var o=this.files[this.root+e];return o&&!o.dir?o:null},folder:function(e){if(!e)return this;if(m(e))return this.filter((function(t,r){return r.dir&&e.test(t)}));var t=this.root+e,r=y.call(this,t),n=this.clone();return n.root=r.name,n},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var r=this.filter((function(t,r){return r.name.slice(0,e.length)===e})),n=0;n<r.length;n++)delete this.files[r[n].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,r={};try{if((r=o.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=r.type.toLowerCase(),r.compression=r.compression.toUpperCase(),"binarystring"===r.type&&(r.type="string"),!r.type)throw new Error("No output type specified.");o.checkSupport(r.type),"darwin"!==r.platform&&"freebsd"!==r.platform&&"linux"!==r.platform&&"sunos"!==r.platform||(r.platform="UNIX"),"win32"===r.platform&&(r.platform="DOS");var n=r.comment||this.comment||"";t=p.generateWorker(this,r,n)}catch(e){(t=new a("error")).error(e)}return new s(t,r.type||"string",r.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};t.exports=v},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,r){"use strict";t.exports=e("stream")},{stream:void 0}],17:[function(e,t,r){"use strict";var n=e("./DataReader");function i(e){n.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e("../utils").inherits(i,n),i.prototype.byteAt=function(e){return this.data[this.zero+e]},i.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),r=e.charCodeAt(1),n=e.charCodeAt(2),i=e.charCodeAt(3),o=this.length-4;0<=o;--o)if(this.data[o]===t&&this.data[o+1]===r&&this.data[o+2]===n&&this.data[o+3]===i)return o-this.zero;return-1},i.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),r=e.charCodeAt(1),n=e.charCodeAt(2),i=e.charCodeAt(3),o=this.readData(4);return t===o[0]&&r===o[1]&&n===o[2]&&i===o[3]},i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./DataReader":18}],18:[function(e,t,r){"use strict";var n=e("../utils");function i(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var t,r=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)r=(r<<8)+this.byteAt(t);return this.index+=e,r},readString:function(e){return n.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=i},{"../utils":32}],19:[function(e,t,r){"use strict";var n=e("./Uint8ArrayReader");function i(e){n.call(this,e)}e("../utils").inherits(i,n),i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,r){"use strict";var n=e("./DataReader");function i(e){n.call(this,e)}e("../utils").inherits(i,n),i.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},i.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},i.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./DataReader":18}],21:[function(e,t,r){"use strict";var n=e("./ArrayReader");function i(e){n.call(this,e)}e("../utils").inherits(i,n),i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,r){"use strict";var n=e("../utils"),i=e("../support"),o=e("./ArrayReader"),a=e("./StringReader"),s=e("./NodeBufferReader"),l=e("./Uint8ArrayReader");t.exports=function(e){var t=n.getTypeOf(e);return n.checkSupport(t),"string"!==t||i.uint8array?"nodebuffer"===t?new s(e):i.uint8array?new l(n.transformTo("uint8array",e)):new o(n.transformTo("array",e)):new a(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,r){"use strict";r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t,r){"use strict";var n=e("./GenericWorker"),i=e("../utils");function o(e){n.call(this,"ConvertWorker to "+e),this.destType=e}i.inherits(o,n),o.prototype.processChunk=function(e){this.push({data:i.transformTo(this.destType,e.data),meta:e.meta})},t.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,r){"use strict";var n=e("./GenericWorker"),i=e("../crc32");function o(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(o,n),o.prototype.processChunk=function(e){this.streamInfo.crc32=i(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,r){"use strict";var n=e("../utils"),i=e("./GenericWorker");function o(e){i.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}n.inherits(o,i),o.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}i.prototype.processChunk.call(this,e)},t.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,r){"use strict";var n=e("../utils"),i=e("./GenericWorker");function o(e){i.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then((function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=n.getTypeOf(e),t.isPaused||t._tickAndRepeat()}),(function(e){t.error(e)}))}n.inherits(o,i),o.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,r){"use strict";function n(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var r=0;r<this._listeners[e].length;r++)this._listeners[e][r].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",(function(e){t.processChunk(e)})),e.on("end",(function(){t.end()})),e.on("error",(function(e){t.error(e)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var e=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=n},{}],29:[function(e,t,r){"use strict";var i=e("../utils"),o=e("./ConvertWorker"),a=e("./GenericWorker"),s=e("../base64"),l=e("../support"),c=e("../external"),u=null;if(l.nodestream)try{u=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}function p(e,t){return new c.Promise((function(r,o){var a=[],l=e._internalType,c=e._outputType,u=e._mimeType;e.on("data",(function(e,r){a.push(e),t&&t(r)})).on("error",(function(e){a=[],o(e)})).on("end",(function(){try{var e=function(e,t,r){switch(e){case"blob":return i.newBlob(i.transformTo("arraybuffer",t),r);case"base64":return s.encode(t);default:return i.transformTo(e,t)}}(c,function(e,t){var r,i=0,o=null,a=0;for(r=0;r<t.length;r++)a+=t[r].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(o=new Uint8Array(a),r=0;r<t.length;r++)o.set(t[r],i),i+=t[r].length;return o;case"nodebuffer":return n.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(l,a),u);r(e)}catch(e){o(e)}a=[]})).resume()}))}function h(e,t,r){var n=t;switch(t){case"blob":case"arraybuffer":n="uint8array";break;case"base64":n="string"}try{this._internalType=n,this._outputType=t,this._mimeType=r,i.checkSupport(n),this._worker=e.pipe(new o(n)),e.lock()}catch(e){this._worker=new a("error"),this._worker.error(e)}}h.prototype={accumulate:function(e){return p(this,e)},on:function(e,t){var r=this;return"data"===e?this._worker.on(e,(function(e){t.call(r,e.data,e.meta)})):this._worker.on(e,(function(){i.delay(t,arguments,r)})),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(i.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:"nodebuffer"!==this._outputType},e)}},t.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,t,r){"use strict";if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,r.nodebuffer=void 0!==n,r.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)r.blob=!1;else{var i=new ArrayBuffer(0);try{r.blob=0===new Blob([i],{type:"application/zip"}).size}catch(e){try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(i),r.blob=0===o.getBlob("application/zip").size}catch(e){r.blob=!1}}}try{r.nodestream=!!e("readable-stream").Readable}catch(e){r.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,r){"use strict";for(var n=e("./utils"),i=e("./support"),o=e("./nodejsUtils"),a=e("./stream/GenericWorker"),s=new Array(256),l=0;l<256;l++)s[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function c(){a.call(this,"utf-8 decode"),this.leftOver=null}function u(){a.call(this,"utf-8 encode")}s[254]=s[254]=1,r.utf8encode=function(e){return i.nodebuffer?o.newBufferFrom(e,"utf-8"):function(e){var t,r,n,o,a,s=e.length,l=0;for(o=0;o<s;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(n=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(n-56320),o++),l+=r<128?1:r<2048?2:r<65536?3:4;for(t=i.uint8array?new Uint8Array(l):new Array(l),o=a=0;a<l;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(n=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(n-56320),o++),r<128?t[a++]=r:(r<2048?t[a++]=192|r>>>6:(r<65536?t[a++]=224|r>>>12:(t[a++]=240|r>>>18,t[a++]=128|r>>>12&63),t[a++]=128|r>>>6&63),t[a++]=128|63&r);return t}(e)},r.utf8decode=function(e){return i.nodebuffer?n.transformTo("nodebuffer",e).toString("utf-8"):function(e){var t,r,i,o,a=e.length,l=new Array(2*a);for(t=r=0;t<a;)if((i=e[t++])<128)l[r++]=i;else if(4<(o=s[i]))l[r++]=65533,t+=o-1;else{for(i&=2===o?31:3===o?15:7;1<o&&t<a;)i=i<<6|63&e[t++],o--;1<o?l[r++]=65533:i<65536?l[r++]=i:(i-=65536,l[r++]=55296|i>>10&1023,l[r++]=56320|1023&i)}return l.length!==r&&(l.subarray?l=l.subarray(0,r):l.length=r),n.applyFromCharCode(l)}(e=n.transformTo(i.uint8array?"uint8array":"array",e))},n.inherits(c,a),c.prototype.processChunk=function(e){var t=n.transformTo(i.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var o=t;(t=new Uint8Array(o.length+this.leftOver.length)).set(this.leftOver,0),t.set(o,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var a=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return r<0||0===r?t:r+s[e[r]]>t?r:t}(t),l=t;a!==t.length&&(i.uint8array?(l=t.subarray(0,a),this.leftOver=t.subarray(a,t.length)):(l=t.slice(0,a),this.leftOver=t.slice(a,t.length))),this.push({data:r.utf8decode(l),meta:e.meta})},c.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=c,n.inherits(u,a),u.prototype.processChunk=function(e){this.push({data:r.utf8encode(e.data),meta:e.meta})},r.Utf8EncodeWorker=u},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,r){"use strict";var n=e("./support"),i=e("./base64"),o=e("./nodejsUtils"),a=e("./external");function s(e){return e}function l(e,t){for(var r=0;r<e.length;++r)t[r]=255&e.charCodeAt(r);return t}e("setimmediate"),r.newBlob=function(e,t){r.checkSupport("blob");try{return new Blob([e],{type:t})}catch(r){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return n.append(e),n.getBlob(t)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var c={stringifyByChunk:function(e,t,r){var n=[],i=0,o=e.length;if(o<=r)return String.fromCharCode.apply(null,e);for(;i<o;)"array"===t||"nodebuffer"===t?n.push(String.fromCharCode.apply(null,e.slice(i,Math.min(i+r,o)))):n.push(String.fromCharCode.apply(null,e.subarray(i,Math.min(i+r,o)))),i+=r;return n.join("")},stringifyByChar:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&1===String.fromCharCode.apply(null,o.allocBuffer(1)).length}catch(e){return!1}}()}};function u(e){var t=65536,n=r.getTypeOf(e),i=!0;if("uint8array"===n?i=c.applyCanBeUsed.uint8array:"nodebuffer"===n&&(i=c.applyCanBeUsed.nodebuffer),i)for(;1<t;)try{return c.stringifyByChunk(e,n,t)}catch(e){t=Math.floor(t/2)}return c.stringifyByChar(e)}function p(e,t){for(var r=0;r<e.length;r++)t[r]=e[r];return t}r.applyFromCharCode=u;var h={};h.string={string:s,array:function(e){return l(e,new Array(e.length))},arraybuffer:function(e){return h.string.uint8array(e).buffer},uint8array:function(e){return l(e,new Uint8Array(e.length))},nodebuffer:function(e){return l(e,o.allocBuffer(e.length))}},h.array={string:u,array:s,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return o.newBufferFrom(e)}},h.arraybuffer={string:function(e){return u(new Uint8Array(e))},array:function(e){return p(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:s,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return o.newBufferFrom(new Uint8Array(e))}},h.uint8array={string:u,array:function(e){return p(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:s,nodebuffer:function(e){return o.newBufferFrom(e)}},h.nodebuffer={string:u,array:function(e){return p(e,new Array(e.length))},arraybuffer:function(e){return h.nodebuffer.uint8array(e).buffer},uint8array:function(e){return p(e,new Uint8Array(e.length))},nodebuffer:s},r.transformTo=function(e,t){if(t=t||"",!e)return t;r.checkSupport(e);var n=r.getTypeOf(t);return h[n][e](t)},r.resolve=function(e){for(var t=e.split("/"),r=[],n=0;n<t.length;n++){var i=t[n];"."===i||""===i&&0!==n&&n!==t.length-1||(".."===i?r.pop():r.push(i))}return r.join("/")},r.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":n.nodebuffer&&o.isBuffer(e)?"nodebuffer":n.uint8array&&e instanceof Uint8Array?"uint8array":n.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(e){if(!n[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(e){var t,r,n="";for(r=0;r<(e||"").length;r++)n+="\\x"+((t=e.charCodeAt(r))<16?"0":"")+t.toString(16).toUpperCase();return n},r.delay=function(e,t,r){setImmediate((function(){e.apply(r||null,t||[])}))},r.inherits=function(e,t){function r(){}r.prototype=t.prototype,e.prototype=new r},r.extend=function(){var e,t,r={};for(e=0;e<arguments.length;e++)for(t in arguments[e])Object.prototype.hasOwnProperty.call(arguments[e],t)&&void 0===r[t]&&(r[t]=arguments[e][t]);return r},r.prepareContent=function(e,t,o,s,c){return a.Promise.resolve(t).then((function(e){return n.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)))&&"undefined"!=typeof FileReader?new a.Promise((function(t,r){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.onerror=function(e){r(e.target.error)},n.readAsArrayBuffer(e)})):e})).then((function(t){var u=r.getTypeOf(t);return u?("arraybuffer"===u?t=r.transformTo("uint8array",t):"string"===u&&(c?t=i.decode(t):o&&!0!==s&&(t=function(e){return l(e,n.uint8array?new Uint8Array(e.length):new Array(e.length))}(t))),t):a.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,t,r){"use strict";var n=e("./reader/readerFor"),i=e("./utils"),o=e("./signature"),a=e("./zipEntry"),s=e("./support");function l(e){this.files=[],this.loadOptions=e}l.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(t)+", expected "+i.pretty(e)+")")}},isSignature:function(e,t){var r=this.reader.index;this.reader.setIndex(e);var n=this.reader.readString(4)===t;return this.reader.setIndex(r),n},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=s.uint8array?"uint8array":"array",r=i.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(r)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,r,n=this.zip64EndOfCentralSize-44;0<n;)e=this.reader.readInt(2),t=this.reader.readInt(4),r=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(e=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(e<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(e);var t=e;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;this.zip64&&(r+=20,r+=12+this.zip64EndOfCentralSize);var n=t-r;if(0<n)this.isSignature(t,o.CENTRAL_FILE_HEADER)||(this.reader.zero=n);else if(n<0)throw new Error("Corrupted zip: missing "+Math.abs(n)+" bytes.")},prepareReader:function(e){this.reader=n(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,t,r){"use strict";var n=e("./reader/readerFor"),i=e("./utils"),o=e("./compressedObject"),a=e("./crc32"),s=e("./utf8"),l=e("./compressions"),c=e("./support");function u(e,t){this.options=e,this.loadOptions=t}u.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t,r;if(e.skip(22),this.fileNameLength=e.readInt(2),r=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(r),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in l)if(Object.prototype.hasOwnProperty.call(l,t)&&l[t].magic===e)return l[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==e&&(this.dosPermissions=63&this.externalFileAttributes),3==e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var e=n(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(e){var t,r,n,i=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index+4<i;)t=e.readInt(2),r=e.readInt(2),n=e.readData(r),this.extraFields[t]={id:t,length:r,value:n};e.setIndex(i)},handleUTF8:function(){var e=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=s.utf8decode(this.fileName),this.fileCommentStr=s.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var r=i.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(r)}var n=this.findExtraFieldUnicodeComment();if(null!==n)this.fileCommentStr=n;else{var o=i.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(o)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=n(e.value);return 1!==t.readInt(1)||a(this.fileName)!==t.readInt(4)?null:s.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=n(e.value);return 1!==t.readInt(1)||a(this.fileComment)!==t.readInt(4)?null:s.utf8decode(t.readData(e.length-5))}return null}},t.exports=u},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,r){"use strict";function n(e,t,r){this.name=e,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=t,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}}var i=e("./stream/StreamHelper"),o=e("./stream/DataWorker"),a=e("./utf8"),s=e("./compressedObject"),l=e("./stream/GenericWorker");n.prototype={internalStream:function(e){var t=null,r="string";try{if(!e)throw new Error("No output type specified.");var n="string"===(r=e.toLowerCase())||"text"===r;"binarystring"!==r&&"text"!==r||(r="string"),t=this._decompressWorker();var o=!this._dataBinary;o&&!n&&(t=t.pipe(new a.Utf8EncodeWorker)),!o&&n&&(t=t.pipe(new a.Utf8DecodeWorker))}catch(e){(t=new l("error")).error(e)}return new i(t,r,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof s&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var r=this._decompressWorker();return this._dataBinary||(r=r.pipe(new a.Utf8EncodeWorker)),s.createWorkerFrom(r,e,t)},_decompressWorker:function(){return this._data instanceof s?this._data.getContentWorker():this._data instanceof l?this._data:new o(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},p=0;p<c.length;p++)n.prototype[c[p]]=u;t.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,t,n){(function(e){"use strict";var r,n,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var o=0,a=new i(u),s=e.document.createTextNode("");a.observe(s,{characterData:!0}),r=function(){s.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)r="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var l=new e.MessageChannel;l.port1.onmessage=u,r=function(){l.port2.postMessage(0)}}var c=[];function u(){var e,t;n=!0;for(var r=c.length;r;){for(t=c,c=[],e=-1;++e<r;)t[e]();r=c.length}n=!1}t.exports=function(e){1!==c.push(e)||n||r()}}).call(this,void 0!==r.g?r.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(e,t,r){"use strict";var n=e("immediate");function i(){}var o={},a=["REJECTED"],s=["FULFILLED"],l=["PENDING"];function c(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,e!==i&&d(this,e)}function u(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function p(e,t,r){n((function(){var n;try{n=t(r)}catch(n){return o.reject(e,n)}n===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,n)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function d(e,t){var r=!1;function n(t){r||(r=!0,o.reject(e,t))}function i(t){r||(r=!0,o.resolve(e,t))}var a=f((function(){t(i,n)}));"error"===a.status&&n(a.value)}function f(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}(t.exports=c).prototype.finally=function(e){if("function"!=typeof e)return this;var t=this.constructor;return this.then((function(r){return t.resolve(e()).then((function(){return r}))}),(function(r){return t.resolve(e()).then((function(){throw r}))}))},c.prototype.catch=function(e){return this.then(null,e)},c.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===a)return this;var r=new this.constructor(i);return this.state!==l?p(r,this.state===s?e:t,this.outcome):this.queue.push(new u(r,e,t)),r},u.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){p(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){o.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){p(this.promise,this.onRejected,e)},o.resolve=function(e,t){var r=f(h,t);if("error"===r.status)return o.reject(e,r.value);var n=r.value;if(n)d(e,n);else{e.state=s,e.outcome=t;for(var i=-1,a=e.queue.length;++i<a;)e.queue[i].callFulfilled(t)}return e},o.reject=function(e,t){e.state=a,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},c.resolve=function(e){return e instanceof this?e:o.resolve(new this(i),e)},c.reject=function(e){var t=new this(i);return o.reject(t,e)},c.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);for(var a=new Array(r),s=0,l=-1,c=new this(i);++l<r;)u(e[l],l);return c;function u(e,i){t.resolve(e).then((function(e){a[i]=e,++s!==r||n||(n=!0,o.resolve(c,a))}),(function(e){n||(n=!0,o.reject(c,e))}))}},c.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);for(var a,s=-1,l=new this(i);++s<r;)a=e[s],t.resolve(a).then((function(e){n||(n=!0,o.resolve(l,e))}),(function(e){n||(n=!0,o.reject(l,e))}));return l}},{immediate:36}],38:[function(e,t,r){"use strict";var n={};(0,e("./lib/utils/common").assign)(n,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,r){"use strict";var n=e("./zlib/deflate"),i=e("./utils/common"),o=e("./utils/strings"),a=e("./zlib/messages"),s=e("./zlib/zstream"),l=Object.prototype.toString,c=0,u=-1,p=0,h=8;function d(e){if(!(this instanceof d))return new d(e);this.options=i.assign({level:u,method:h,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},e||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var r=n.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==c)throw new Error(a[r]);if(t.header&&n.deflateSetHeader(this.strm,t.header),t.dictionary){var f;if(f="string"==typeof t.dictionary?o.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(r=n.deflateSetDictionary(this.strm,f))!==c)throw new Error(a[r]);this._dict_set=!0}}function f(e,t){var r=new d(t);if(r.push(e,!0),r.err)throw r.msg||a[r.err];return r.result}d.prototype.push=function(e,t){var r,a,s=this.strm,u=this.options.chunkSize;if(this.ended)return!1;a=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=o.string2buf(e):"[object ArrayBuffer]"===l.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new i.Buf8(u),s.next_out=0,s.avail_out=u),1!==(r=n.deflate(s,a))&&r!==c)return this.onEnd(r),!(this.ended=!0);0!==s.avail_out&&(0!==s.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(o.buf2binstring(i.shrinkBuf(s.output,s.next_out))):this.onData(i.shrinkBuf(s.output,s.next_out)))}while((0<s.avail_in||0===s.avail_out)&&1!==r);return 4===a?(r=n.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===c):2!==a||(this.onEnd(c),!(s.avail_out=0))},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){e===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Deflate=d,r.deflate=f,r.deflateRaw=function(e,t){return(t=t||{}).raw=!0,f(e,t)},r.gzip=function(e,t){return(t=t||{}).gzip=!0,f(e,t)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,r){"use strict";var n=e("./zlib/inflate"),i=e("./utils/common"),o=e("./utils/strings"),a=e("./zlib/constants"),s=e("./zlib/messages"),l=e("./zlib/zstream"),c=e("./zlib/gzheader"),u=Object.prototype.toString;function p(e){if(!(this instanceof p))return new p(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var r=n.inflateInit2(this.strm,t.windowBits);if(r!==a.Z_OK)throw new Error(s[r]);this.header=new c,n.inflateGetHeader(this.strm,this.header)}function h(e,t){var r=new p(t);if(r.push(e,!0),r.err)throw r.msg||s[r.err];return r.result}p.prototype.push=function(e,t){var r,s,l,c,p,h,d=this.strm,f=this.options.chunkSize,g=this.options.dictionary,y=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof e?d.input=o.binstring2buf(e):"[object ArrayBuffer]"===u.call(e)?d.input=new Uint8Array(e):d.input=e,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new i.Buf8(f),d.next_out=0,d.avail_out=f),(r=n.inflate(d,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&g&&(h="string"==typeof g?o.string2buf(g):"[object ArrayBuffer]"===u.call(g)?new Uint8Array(g):g,r=n.inflateSetDictionary(this.strm,h)),r===a.Z_BUF_ERROR&&!0===y&&(r=a.Z_OK,y=!1),r!==a.Z_STREAM_END&&r!==a.Z_OK)return this.onEnd(r),!(this.ended=!0);d.next_out&&(0!==d.avail_out&&r!==a.Z_STREAM_END&&(0!==d.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(l=o.utf8border(d.output,d.next_out),c=d.next_out-l,p=o.buf2string(d.output,l),d.next_out=c,d.avail_out=f-c,c&&i.arraySet(d.output,d.output,l,c,0),this.onData(p)):this.onData(i.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(y=!0)}while((0<d.avail_in||0===d.avail_out)&&r!==a.Z_STREAM_END);return r===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(r=n.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(d.avail_out=0))},p.prototype.onData=function(e){this.chunks.push(e)},p.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Inflate=p,r.inflate=h,r.inflateRaw=function(e,t){return(t=t||{}).raw=!0,h(e,t)},r.ungzip=h},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}}return e},r.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var o=0;o<n;o++)e[i+o]=t[r+o]},flattenChunks:function(e){var t,r,n,i,o,a;for(t=n=0,r=e.length;t<r;t++)n+=e[t].length;for(a=new Uint8Array(n),t=i=0,r=e.length;t<r;t++)o=e[t],a.set(o,i),i+=o.length;return a}},o={arraySet:function(e,t,r,n,i){for(var o=0;o<n;o++)e[i+o]=t[r+o]},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,o))},r.setTyped(n)},{}],42:[function(e,t,r){"use strict";var n=e("./common"),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var a=new n.Buf8(256),s=0;s<256;s++)a[s]=252<=s?6:248<=s?5:240<=s?4:224<=s?3:192<=s?2:1;function l(e,t){if(t<65537&&(e.subarray&&o||!e.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(e,t));for(var r="",a=0;a<t;a++)r+=String.fromCharCode(e[a]);return r}a[254]=a[254]=1,r.string2buf=function(e){var t,r,i,o,a,s=e.length,l=0;for(o=0;o<s;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),l+=r<128?1:r<2048?2:r<65536?3:4;for(t=new n.Buf8(l),o=a=0;a<l;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),r<128?t[a++]=r:(r<2048?t[a++]=192|r>>>6:(r<65536?t[a++]=224|r>>>12:(t[a++]=240|r>>>18,t[a++]=128|r>>>12&63),t[a++]=128|r>>>6&63),t[a++]=128|63&r);return t},r.buf2binstring=function(e){return l(e,e.length)},r.binstring2buf=function(e){for(var t=new n.Buf8(e.length),r=0,i=t.length;r<i;r++)t[r]=e.charCodeAt(r);return t},r.buf2string=function(e,t){var r,n,i,o,s=t||e.length,c=new Array(2*s);for(r=n=0;r<s;)if((i=e[r++])<128)c[n++]=i;else if(4<(o=a[i]))c[n++]=65533,r+=o-1;else{for(i&=2===o?31:3===o?15:7;1<o&&r<s;)i=i<<6|63&e[r++],o--;1<o?c[n++]=65533:i<65536?c[n++]=i:(i-=65536,c[n++]=55296|i>>10&1023,c[n++]=56320|1023&i)}return l(c,n)},r.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return r<0||0===r?t:r+a[e[r]]>t?r:t}},{"./common":41}],43:[function(e,t,r){"use strict";t.exports=function(e,t,r,n){for(var i=65535&e|0,o=e>>>16&65535|0,a=0;0!==r;){for(r-=a=2e3<r?2e3:r;o=o+(i=i+t[n++]|0)|0,--a;);i%=65521,o%=65521}return i|o<<16|0}},{}],44:[function(e,t,r){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,r){"use strict";var n=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t,r,i){var o=n,a=i+r;e^=-1;for(var s=i;s<a;s++)e=e>>>8^o[255&(e^t[s])];return-1^e}},{}],46:[function(e,t,r){"use strict";var n,i=e("../utils/common"),o=e("./trees"),a=e("./adler32"),s=e("./crc32"),l=e("./messages"),c=0,u=4,p=0,h=-2,d=-1,f=4,g=2,y=8,m=9,v=286,_=30,w=19,S=2*v+1,E=15,b=3,C=258,L=C+b+1,T=42,A=113,x=1,P=2,O=3,I=4;function R(e,t){return e.msg=l[t],t}function M(e){return(e<<1)-(4<e?9:0)}function D(e){for(var t=e.length;0<=--t;)e[t]=0}function N(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(i.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function Z(e,t){o._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,N(e.strm)}function k(e,t){e.pending_buf[e.pending++]=t}function F(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function U(e,t){var r,n,i=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-L?e.strstart-(e.w_size-L):0,c=e.window,u=e.w_mask,p=e.prev,h=e.strstart+C,d=c[o+a-1],f=c[o+a];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(c[(r=t)+a]===f&&c[r+a-1]===d&&c[r]===c[o]&&c[++r]===c[o+1]){o+=2,r++;do{}while(c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&o<h);if(n=C-(h-o),o=h-C,a<n){if(e.match_start=t,s<=(a=n))break;d=c[o+a-1],f=c[o+a]}}}while((t=p[t&u])>l&&0!=--i);return a<=e.lookahead?a:e.lookahead}function B(e){var t,r,n,o,l,c,u,p,h,d,f=e.w_size;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=f+(f-L)){for(i.arraySet(e.window,e.window,f,f,0),e.match_start-=f,e.strstart-=f,e.block_start-=f,t=r=e.hash_size;n=e.head[--t],e.head[t]=f<=n?n-f:0,--r;);for(t=r=f;n=e.prev[--t],e.prev[t]=f<=n?n-f:0,--r;);o+=f}if(0===e.strm.avail_in)break;if(c=e.strm,u=e.window,p=e.strstart+e.lookahead,d=void 0,(h=o)<(d=c.avail_in)&&(d=h),r=0===d?0:(c.avail_in-=d,i.arraySet(u,c.input,c.next_in,d,p),1===c.state.wrap?c.adler=a(c.adler,u,d,p):2===c.state.wrap&&(c.adler=s(c.adler,u,d,p)),c.next_in+=d,c.total_in+=d,d),e.lookahead+=r,e.lookahead+e.insert>=b)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+b-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<b)););}while(e.lookahead<L&&0!==e.strm.avail_in)}function G(e,t){for(var r,n;;){if(e.lookahead<L){if(B(e),e.lookahead<L&&t===c)return x;if(0===e.lookahead)break}if(r=0,e.lookahead>=b&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+b-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-L&&(e.match_length=U(e,r)),e.match_length>=b)if(n=o._tr_tally(e,e.strstart-e.match_start,e.match_length-b),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=b){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+b-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(Z(e,!1),0===e.strm.avail_out))return x}return e.insert=e.strstart<b-1?e.strstart:b-1,t===u?(Z(e,!0),0===e.strm.avail_out?O:I):e.last_lit&&(Z(e,!1),0===e.strm.avail_out)?x:P}function j(e,t){for(var r,n,i;;){if(e.lookahead<L){if(B(e),e.lookahead<L&&t===c)return x;if(0===e.lookahead)break}if(r=0,e.lookahead>=b&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+b-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=b-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-L&&(e.match_length=U(e,r),e.match_length<=5&&(1===e.strategy||e.match_length===b&&4096<e.strstart-e.match_start)&&(e.match_length=b-1)),e.prev_length>=b&&e.match_length<=e.prev_length){for(i=e.strstart+e.lookahead-b,n=o._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-b),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+b-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=b-1,e.strstart++,n&&(Z(e,!1),0===e.strm.avail_out))return x}else if(e.match_available){if((n=o._tr_tally(e,0,e.window[e.strstart-1]))&&Z(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return x}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=o._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<b-1?e.strstart:b-1,t===u?(Z(e,!0),0===e.strm.avail_out?O:I):e.last_lit&&(Z(e,!1),0===e.strm.avail_out)?x:P}function W(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function H(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*S),this.dyn_dtree=new i.Buf16(2*(2*_+1)),this.bl_tree=new i.Buf16(2*(2*w+1)),D(this.dyn_ltree),D(this.dyn_dtree),D(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(E+1),this.heap=new i.Buf16(2*v+1),D(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*v+1),D(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function q(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=g,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?T:A,e.adler=2===t.wrap?0:1,t.last_flush=c,o._tr_init(t),p):R(e,h)}function V(e){var t=q(e);return t===p&&function(e){e.window_size=2*e.w_size,D(e.head),e.max_lazy_match=n[e.level].max_lazy,e.good_match=n[e.level].good_length,e.nice_match=n[e.level].nice_length,e.max_chain_length=n[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=b-1,e.match_available=0,e.ins_h=0}(e.state),t}function z(e,t,r,n,o,a){if(!e)return h;var s=1;if(t===d&&(t=6),n<0?(s=0,n=-n):15<n&&(s=2,n-=16),o<1||m<o||r!==y||n<8||15<n||t<0||9<t||a<0||f<a)return R(e,h);8===n&&(n=9);var l=new H;return(e.state=l).strm=e,l.wrap=s,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=o+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+b-1)/b),l.window=new i.Buf8(2*l.w_size),l.head=new i.Buf16(l.hash_size),l.prev=new i.Buf16(l.w_size),l.lit_bufsize=1<<o+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new i.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=a,l.method=r,V(e)}n=[new W(0,0,0,0,(function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(B(e),0===e.lookahead&&t===c)return x;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,Z(e,!1),0===e.strm.avail_out))return x;if(e.strstart-e.block_start>=e.w_size-L&&(Z(e,!1),0===e.strm.avail_out))return x}return e.insert=0,t===u?(Z(e,!0),0===e.strm.avail_out?O:I):(e.strstart>e.block_start&&(Z(e,!1),e.strm.avail_out),x)})),new W(4,4,8,4,G),new W(4,5,16,8,G),new W(4,6,32,32,G),new W(4,4,16,16,j),new W(8,16,32,32,j),new W(8,16,128,128,j),new W(8,32,128,256,j),new W(32,128,258,1024,j),new W(32,258,258,4096,j)],r.deflateInit=function(e,t){return z(e,t,y,15,8,0)},r.deflateInit2=z,r.deflateReset=V,r.deflateResetKeep=q,r.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?h:(e.state.gzhead=t,p):h},r.deflate=function(e,t){var r,i,a,l;if(!e||!e.state||5<t||t<0)return e?R(e,h):h;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&t!==u)return R(e,0===e.avail_out?-5:h);if(i.strm=e,r=i.last_flush,i.last_flush=t,i.status===T)if(2===i.wrap)e.adler=0,k(i,31),k(i,139),k(i,8),i.gzhead?(k(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),k(i,255&i.gzhead.time),k(i,i.gzhead.time>>8&255),k(i,i.gzhead.time>>16&255),k(i,i.gzhead.time>>24&255),k(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),k(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(k(i,255&i.gzhead.extra.length),k(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=s(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(k(i,0),k(i,0),k(i,0),k(i,0),k(i,0),k(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),k(i,3),i.status=A);else{var d=y+(i.w_bits-8<<4)<<8;d|=(2<=i.strategy||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(d|=32),d+=31-d%31,i.status=A,F(i,d),0!==i.strstart&&(F(i,e.adler>>>16),F(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(a=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),N(e),a=i.pending,i.pending!==i.pending_buf_size));)k(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),N(e),a=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,k(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),0===l&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),N(e),a=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,k(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>a&&(e.adler=s(e.adler,i.pending_buf,i.pending-a,a)),0===l&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&N(e),i.pending+2<=i.pending_buf_size&&(k(i,255&e.adler),k(i,e.adler>>8&255),e.adler=0,i.status=A)):i.status=A),0!==i.pending){if(N(e),0===e.avail_out)return i.last_flush=-1,p}else if(0===e.avail_in&&M(t)<=M(r)&&t!==u)return R(e,-5);if(666===i.status&&0!==e.avail_in)return R(e,-5);if(0!==e.avail_in||0!==i.lookahead||t!==c&&666!==i.status){var f=2===i.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(B(e),0===e.lookahead)){if(t===c)return x;break}if(e.match_length=0,r=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(Z(e,!1),0===e.strm.avail_out))return x}return e.insert=0,t===u?(Z(e,!0),0===e.strm.avail_out?O:I):e.last_lit&&(Z(e,!1),0===e.strm.avail_out)?x:P}(i,t):3===i.strategy?function(e,t){for(var r,n,i,a,s=e.window;;){if(e.lookahead<=C){if(B(e),e.lookahead<=C&&t===c)return x;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=b&&0<e.strstart&&(n=s[i=e.strstart-1])===s[++i]&&n===s[++i]&&n===s[++i]){a=e.strstart+C;do{}while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&i<a);e.match_length=C-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=b?(r=o._tr_tally(e,1,e.match_length-b),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(Z(e,!1),0===e.strm.avail_out))return x}return e.insert=0,t===u?(Z(e,!0),0===e.strm.avail_out?O:I):e.last_lit&&(Z(e,!1),0===e.strm.avail_out)?x:P}(i,t):n[i.level].func(i,t);if(f!==O&&f!==I||(i.status=666),f===x||f===O)return 0===e.avail_out&&(i.last_flush=-1),p;if(f===P&&(1===t?o._tr_align(i):5!==t&&(o._tr_stored_block(i,0,0,!1),3===t&&(D(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),N(e),0===e.avail_out))return i.last_flush=-1,p}return t!==u?p:i.wrap<=0?1:(2===i.wrap?(k(i,255&e.adler),k(i,e.adler>>8&255),k(i,e.adler>>16&255),k(i,e.adler>>24&255),k(i,255&e.total_in),k(i,e.total_in>>8&255),k(i,e.total_in>>16&255),k(i,e.total_in>>24&255)):(F(i,e.adler>>>16),F(i,65535&e.adler)),N(e),0<i.wrap&&(i.wrap=-i.wrap),0!==i.pending?p:1)},r.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==T&&69!==t&&73!==t&&91!==t&&103!==t&&t!==A&&666!==t?R(e,h):(e.state=null,t===A?R(e,-3):p):h},r.deflateSetDictionary=function(e,t){var r,n,o,s,l,c,u,d,f=t.length;if(!e||!e.state)return h;if(2===(s=(r=e.state).wrap)||1===s&&r.status!==T||r.lookahead)return h;for(1===s&&(e.adler=a(e.adler,t,f,0)),r.wrap=0,f>=r.w_size&&(0===s&&(D(r.head),r.strstart=0,r.block_start=0,r.insert=0),d=new i.Buf8(r.w_size),i.arraySet(d,t,f-r.w_size,r.w_size,0),t=d,f=r.w_size),l=e.avail_in,c=e.next_in,u=e.input,e.avail_in=f,e.next_in=0,e.input=t,B(r);r.lookahead>=b;){for(n=r.strstart,o=r.lookahead-(b-1);r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+b-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++,--o;);r.strstart=n,r.lookahead=b-1,B(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=b-1,r.match_available=0,e.next_in=c,e.input=u,e.avail_in=l,r.wrap=s,p},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,r){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,r){"use strict";t.exports=function(e,t){var r,n,i,o,a,s,l,c,u,p,h,d,f,g,y,m,v,_,w,S,E,b,C,L,T;r=e.state,n=e.next_in,L=e.input,i=n+(e.avail_in-5),o=e.next_out,T=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),l=r.dmax,c=r.wsize,u=r.whave,p=r.wnext,h=r.window,d=r.hold,f=r.bits,g=r.lencode,y=r.distcode,m=(1<<r.lenbits)-1,v=(1<<r.distbits)-1;e:do{f<15&&(d+=L[n++]<<f,f+=8,d+=L[n++]<<f,f+=8),_=g[d&m];t:for(;;){if(d>>>=w=_>>>24,f-=w,0==(w=_>>>16&255))T[o++]=65535&_;else{if(!(16&w)){if(0==(64&w)){_=g[(65535&_)+(d&(1<<w)-1)];continue t}if(32&w){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}S=65535&_,(w&=15)&&(f<w&&(d+=L[n++]<<f,f+=8),S+=d&(1<<w)-1,d>>>=w,f-=w),f<15&&(d+=L[n++]<<f,f+=8,d+=L[n++]<<f,f+=8),_=y[d&v];r:for(;;){if(d>>>=w=_>>>24,f-=w,!(16&(w=_>>>16&255))){if(0==(64&w)){_=y[(65535&_)+(d&(1<<w)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(E=65535&_,f<(w&=15)&&(d+=L[n++]<<f,(f+=8)<w&&(d+=L[n++]<<f,f+=8)),l<(E+=d&(1<<w)-1)){e.msg="invalid distance too far back",r.mode=30;break e}if(d>>>=w,f-=w,(w=o-a)<E){if(u<(w=E-w)&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(C=h,(b=0)===p){if(b+=c-w,w<S){for(S-=w;T[o++]=h[b++],--w;);b=o-E,C=T}}else if(p<w){if(b+=c+p-w,(w-=p)<S){for(S-=w;T[o++]=h[b++],--w;);if(b=0,p<S){for(S-=w=p;T[o++]=h[b++],--w;);b=o-E,C=T}}}else if(b+=p-w,w<S){for(S-=w;T[o++]=h[b++],--w;);b=o-E,C=T}for(;2<S;)T[o++]=C[b++],T[o++]=C[b++],T[o++]=C[b++],S-=3;S&&(T[o++]=C[b++],1<S&&(T[o++]=C[b++]))}else{for(b=o-E;T[o++]=T[b++],T[o++]=T[b++],T[o++]=T[b++],2<(S-=3););S&&(T[o++]=T[b++],1<S&&(T[o++]=T[b++]))}break}}break}}while(n<i&&o<s);n-=S=f>>3,d&=(1<<(f-=S<<3))-1,e.next_in=n,e.next_out=o,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=o<s?s-o+257:257-(o-s),r.hold=d,r.bits=f}},{}],49:[function(e,t,r){"use strict";var n=e("../utils/common"),i=e("./adler32"),o=e("./crc32"),a=e("./inffast"),s=e("./inftrees"),l=1,c=2,u=0,p=-2,h=1,d=852,f=592;function g(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function y(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function m(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=h,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new n.Buf32(d),t.distcode=t.distdyn=new n.Buf32(f),t.sane=1,t.back=-1,u):p}function v(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,m(e)):p}function _(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?p:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,v(e))):p}function w(e,t){var r,n;return e?(n=new y,(e.state=n).window=null,(r=_(e,t))!==u&&(e.state=null),r):p}var S,E,b=!0;function C(e){if(b){var t;for(S=new n.Buf32(512),E=new n.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(l,e.lens,0,288,S,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(c,e.lens,0,32,E,0,e.work,{bits:5}),b=!1}e.lencode=S,e.lenbits=9,e.distcode=E,e.distbits=5}function L(e,t,r,i){var o,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new n.Buf8(a.wsize)),i>=a.wsize?(n.arraySet(a.window,t,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(i<(o=a.wsize-a.wnext)&&(o=i),n.arraySet(a.window,t,r-i,o,a.wnext),(i-=o)?(n.arraySet(a.window,t,r-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}r.inflateReset=v,r.inflateReset2=_,r.inflateResetKeep=m,r.inflateInit=function(e){return w(e,15)},r.inflateInit2=w,r.inflate=function(e,t){var r,d,f,y,m,v,_,w,S,E,b,T,A,x,P,O,I,R,M,D,N,Z,k,F,U=0,B=new n.Buf8(4),G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return p;12===(r=e.state).mode&&(r.mode=13),m=e.next_out,f=e.output,_=e.avail_out,y=e.next_in,d=e.input,v=e.avail_in,w=r.hold,S=r.bits,E=v,b=_,Z=u;e:for(;;)switch(r.mode){case h:if(0===r.wrap){r.mode=13;break}for(;S<16;){if(0===v)break e;v--,w+=d[y++]<<S,S+=8}if(2&r.wrap&&35615===w){B[r.check=0]=255&w,B[1]=w>>>8&255,r.check=o(r.check,B,2,0),S=w=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&w)<<8)+(w>>8))%31){e.msg="incorrect header check",r.mode=30;break}if(8!=(15&w)){e.msg="unknown compression method",r.mode=30;break}if(S-=4,N=8+(15&(w>>>=4)),0===r.wbits)r.wbits=N;else if(N>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<N,e.adler=r.check=1,r.mode=512&w?10:12,S=w=0;break;case 2:for(;S<16;){if(0===v)break e;v--,w+=d[y++]<<S,S+=8}if(r.flags=w,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=w>>8&1),512&r.flags&&(B[0]=255&w,B[1]=w>>>8&255,r.check=o(r.check,B,2,0)),S=w=0,r.mode=3;case 3:for(;S<32;){if(0===v)break e;v--,w+=d[y++]<<S,S+=8}r.head&&(r.head.time=w),512&r.flags&&(B[0]=255&w,B[1]=w>>>8&255,B[2]=w>>>16&255,B[3]=w>>>24&255,r.check=o(r.check,B,4,0)),S=w=0,r.mode=4;case 4:for(;S<16;){if(0===v)break e;v--,w+=d[y++]<<S,S+=8}r.head&&(r.head.xflags=255&w,r.head.os=w>>8),512&r.flags&&(B[0]=255&w,B[1]=w>>>8&255,r.check=o(r.check,B,2,0)),S=w=0,r.mode=5;case 5:if(1024&r.flags){for(;S<16;){if(0===v)break e;v--,w+=d[y++]<<S,S+=8}r.length=w,r.head&&(r.head.extra_len=w),512&r.flags&&(B[0]=255&w,B[1]=w>>>8&255,r.check=o(r.check,B,2,0)),S=w=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(v<(T=r.length)&&(T=v),T&&(r.head&&(N=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,d,y,T,N)),512&r.flags&&(r.check=o(r.check,d,T,y)),v-=T,y+=T,r.length-=T),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===v)break e;for(T=0;N=d[y+T++],r.head&&N&&r.length<65536&&(r.head.name+=String.fromCharCode(N)),N&&T<v;);if(512&r.flags&&(r.check=o(r.check,d,T,y)),v-=T,y+=T,N)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===v)break e;for(T=0;N=d[y+T++],r.head&&N&&r.length<65536&&(r.head.comment+=String.fromCharCode(N)),N&&T<v;);if(512&r.flags&&(r.check=o(r.check,d,T,y)),v-=T,y+=T,N)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;S<16;){if(0===v)break e;v--,w+=d[y++]<<S,S+=8}if(w!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}S=w=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;S<32;){if(0===v)break e;v--,w+=d[y++]<<S,S+=8}e.adler=r.check=g(w),S=w=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=m,e.avail_out=_,e.next_in=y,e.avail_in=v,r.hold=w,r.bits=S,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last){w>>>=7&S,S-=7&S,r.mode=27;break}for(;S<3;){if(0===v)break e;v--,w+=d[y++]<<S,S+=8}switch(r.last=1&w,S-=1,3&(w>>>=1)){case 0:r.mode=14;break;case 1:if(C(r),r.mode=20,6!==t)break;w>>>=2,S-=2;break e;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}w>>>=2,S-=2;break;case 14:for(w>>>=7&S,S-=7&S;S<32;){if(0===v)break e;v--,w+=d[y++]<<S,S+=8}if((65535&w)!=(w>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&w,S=w=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(T=r.length){if(v<T&&(T=v),_<T&&(T=_),0===T)break e;n.arraySet(f,d,y,T,m),v-=T,y+=T,_-=T,m+=T,r.length-=T;break}r.mode=12;break;case 17:for(;S<14;){if(0===v)break e;v--,w+=d[y++]<<S,S+=8}if(r.nlen=257+(31&w),w>>>=5,S-=5,r.ndist=1+(31&w),w>>>=5,S-=5,r.ncode=4+(15&w),w>>>=4,S-=4,286<r.nlen||30<r.ndist){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;S<3;){if(0===v)break e;v--,w+=d[y++]<<S,S+=8}r.lens[G[r.have++]]=7&w,w>>>=3,S-=3}for(;r.have<19;)r.lens[G[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,k={bits:r.lenbits},Z=s(0,r.lens,0,19,r.lencode,0,r.work,k),r.lenbits=k.bits,Z){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;O=(U=r.lencode[w&(1<<r.lenbits)-1])>>>16&255,I=65535&U,!((P=U>>>24)<=S);){if(0===v)break e;v--,w+=d[y++]<<S,S+=8}if(I<16)w>>>=P,S-=P,r.lens[r.have++]=I;else{if(16===I){for(F=P+2;S<F;){if(0===v)break e;v--,w+=d[y++]<<S,S+=8}if(w>>>=P,S-=P,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}N=r.lens[r.have-1],T=3+(3&w),w>>>=2,S-=2}else if(17===I){for(F=P+3;S<F;){if(0===v)break e;v--,w+=d[y++]<<S,S+=8}S-=P,N=0,T=3+(7&(w>>>=P)),w>>>=3,S-=3}else{for(F=P+7;S<F;){if(0===v)break e;v--,w+=d[y++]<<S,S+=8}S-=P,N=0,T=11+(127&(w>>>=P)),w>>>=7,S-=7}if(r.have+T>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;T--;)r.lens[r.have++]=N}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,k={bits:r.lenbits},Z=s(l,r.lens,0,r.nlen,r.lencode,0,r.work,k),r.lenbits=k.bits,Z){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,k={bits:r.distbits},Z=s(c,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,k),r.distbits=k.bits,Z){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(6<=v&&258<=_){e.next_out=m,e.avail_out=_,e.next_in=y,e.avail_in=v,r.hold=w,r.bits=S,a(e,b),m=e.next_out,f=e.output,_=e.avail_out,y=e.next_in,d=e.input,v=e.avail_in,w=r.hold,S=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;O=(U=r.lencode[w&(1<<r.lenbits)-1])>>>16&255,I=65535&U,!((P=U>>>24)<=S);){if(0===v)break e;v--,w+=d[y++]<<S,S+=8}if(O&&0==(240&O)){for(R=P,M=O,D=I;O=(U=r.lencode[D+((w&(1<<R+M)-1)>>R)])>>>16&255,I=65535&U,!(R+(P=U>>>24)<=S);){if(0===v)break e;v--,w+=d[y++]<<S,S+=8}w>>>=R,S-=R,r.back+=R}if(w>>>=P,S-=P,r.back+=P,r.length=I,0===O){r.mode=26;break}if(32&O){r.back=-1,r.mode=12;break}if(64&O){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&O,r.mode=22;case 22:if(r.extra){for(F=r.extra;S<F;){if(0===v)break e;v--,w+=d[y++]<<S,S+=8}r.length+=w&(1<<r.extra)-1,w>>>=r.extra,S-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;O=(U=r.distcode[w&(1<<r.distbits)-1])>>>16&255,I=65535&U,!((P=U>>>24)<=S);){if(0===v)break e;v--,w+=d[y++]<<S,S+=8}if(0==(240&O)){for(R=P,M=O,D=I;O=(U=r.distcode[D+((w&(1<<R+M)-1)>>R)])>>>16&255,I=65535&U,!(R+(P=U>>>24)<=S);){if(0===v)break e;v--,w+=d[y++]<<S,S+=8}w>>>=R,S-=R,r.back+=R}if(w>>>=P,S-=P,r.back+=P,64&O){e.msg="invalid distance code",r.mode=30;break}r.offset=I,r.extra=15&O,r.mode=24;case 24:if(r.extra){for(F=r.extra;S<F;){if(0===v)break e;v--,w+=d[y++]<<S,S+=8}r.offset+=w&(1<<r.extra)-1,w>>>=r.extra,S-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===_)break e;if(T=b-_,r.offset>T){if((T=r.offset-T)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}A=T>r.wnext?(T-=r.wnext,r.wsize-T):r.wnext-T,T>r.length&&(T=r.length),x=r.window}else x=f,A=m-r.offset,T=r.length;for(_<T&&(T=_),_-=T,r.length-=T;f[m++]=x[A++],--T;);0===r.length&&(r.mode=21);break;case 26:if(0===_)break e;f[m++]=r.length,_--,r.mode=21;break;case 27:if(r.wrap){for(;S<32;){if(0===v)break e;v--,w|=d[y++]<<S,S+=8}if(b-=_,e.total_out+=b,r.total+=b,b&&(e.adler=r.check=r.flags?o(r.check,f,b,m-b):i(r.check,f,b,m-b)),b=_,(r.flags?w:g(w))!==r.check){e.msg="incorrect data check",r.mode=30;break}S=w=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;S<32;){if(0===v)break e;v--,w+=d[y++]<<S,S+=8}if(w!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}S=w=0}r.mode=29;case 29:Z=1;break e;case 30:Z=-3;break e;case 31:return-4;default:return p}return e.next_out=m,e.avail_out=_,e.next_in=y,e.avail_in=v,r.hold=w,r.bits=S,(r.wsize||b!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&L(e,e.output,e.next_out,b-e.avail_out)?(r.mode=31,-4):(E-=e.avail_in,b-=e.avail_out,e.total_in+=E,e.total_out+=b,r.total+=b,r.wrap&&b&&(e.adler=r.check=r.flags?o(r.check,f,b,e.next_out-b):i(r.check,f,b,e.next_out-b)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0==E&&0===b||4===t)&&Z===u&&(Z=-5),Z)},r.inflateEnd=function(e){if(!e||!e.state)return p;var t=e.state;return t.window&&(t.window=null),e.state=null,u},r.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?p:((r.head=t).done=!1,u):p},r.inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?p:11===r.mode&&i(1,t,n,0)!==r.check?-3:L(e,t,n,n)?(r.mode=31,-4):(r.havedict=1,u):p},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,r){"use strict";var n=e("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,r,l,c,u,p,h){var d,f,g,y,m,v,_,w,S,E=h.bits,b=0,C=0,L=0,T=0,A=0,x=0,P=0,O=0,I=0,R=0,M=null,D=0,N=new n.Buf16(16),Z=new n.Buf16(16),k=null,F=0;for(b=0;b<=15;b++)N[b]=0;for(C=0;C<l;C++)N[t[r+C]]++;for(A=E,T=15;1<=T&&0===N[T];T--);if(T<A&&(A=T),0===T)return c[u++]=20971520,c[u++]=20971520,h.bits=1,0;for(L=1;L<T&&0===N[L];L++);for(A<L&&(A=L),b=O=1;b<=15;b++)if(O<<=1,(O-=N[b])<0)return-1;if(0<O&&(0===e||1!==T))return-1;for(Z[1]=0,b=1;b<15;b++)Z[b+1]=Z[b]+N[b];for(C=0;C<l;C++)0!==t[r+C]&&(p[Z[t[r+C]]++]=C);if(v=0===e?(M=k=p,19):1===e?(M=i,D-=257,k=o,F-=257,256):(M=a,k=s,-1),b=L,m=u,P=C=R=0,g=-1,y=(I=1<<(x=A))-1,1===e&&852<I||2===e&&592<I)return 1;for(;;){for(_=b-P,S=p[C]<v?(w=0,p[C]):p[C]>v?(w=k[F+p[C]],M[D+p[C]]):(w=96,0),d=1<<b-P,L=f=1<<x;c[m+(R>>P)+(f-=d)]=_<<24|w<<16|S|0,0!==f;);for(d=1<<b-1;R&d;)d>>=1;if(0!==d?(R&=d-1,R+=d):R=0,C++,0==--N[b]){if(b===T)break;b=t[r+p[C]]}if(A<b&&(R&y)!==g){for(0===P&&(P=A),m+=L,O=1<<(x=b-P);x+P<T&&!((O-=N[x+P])<=0);)x++,O<<=1;if(I+=1<<x,1===e&&852<I||2===e&&592<I)return 1;c[g=R&y]=A<<24|x<<16|m-u|0}}return 0!==R&&(c[m+R]=b-P<<24|64<<16|0),h.bits=A,0}},{"../utils/common":41}],51:[function(e,t,r){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,t,r){"use strict";var n=e("../utils/common"),i=0,o=1;function a(e){for(var t=e.length;0<=--t;)e[t]=0}var s=0,l=29,c=256,u=c+1+l,p=30,h=19,d=2*u+1,f=15,g=16,y=7,m=256,v=16,_=17,w=18,S=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],E=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],C=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],L=new Array(2*(u+2));a(L);var T=new Array(2*p);a(T);var A=new Array(512);a(A);var x=new Array(256);a(x);var P=new Array(l);a(P);var O,I,R,M=new Array(p);function D(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function N(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function Z(e){return e<256?A[e]:A[256+(e>>>7)]}function k(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function F(e,t,r){e.bi_valid>g-r?(e.bi_buf|=t<<e.bi_valid&65535,k(e,e.bi_buf),e.bi_buf=t>>g-e.bi_valid,e.bi_valid+=r-g):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function U(e,t,r){F(e,r[2*t],r[2*t+1])}function B(e,t){for(var r=0;r|=1&e,e>>>=1,r<<=1,0<--t;);return r>>>1}function G(e,t,r){var n,i,o=new Array(f+1),a=0;for(n=1;n<=f;n++)o[n]=a=a+r[n-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=B(o[s]++,s))}}function j(e){var t;for(t=0;t<u;t++)e.dyn_ltree[2*t]=0;for(t=0;t<p;t++)e.dyn_dtree[2*t]=0;for(t=0;t<h;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*m]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function W(e){8<e.bi_valid?k(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function H(e,t,r,n){var i=2*t,o=2*r;return e[i]<e[o]||e[i]===e[o]&&n[t]<=n[r]}function q(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&H(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!H(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function V(e,t,r){var n,i,o,a,s=0;if(0!==e.last_lit)for(;n=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],i=e.pending_buf[e.l_buf+s],s++,0===n?U(e,i,t):(U(e,(o=x[i])+c+1,t),0!==(a=S[o])&&F(e,i-=P[o],a),U(e,o=Z(--n),r),0!==(a=E[o])&&F(e,n-=M[o],a)),s<e.last_lit;);U(e,m,t)}function z(e,t){var r,n,i,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=d,r=0;r<l;r++)0!==o[2*r]?(e.heap[++e.heap_len]=c=r,e.depth[r]=0):o[2*r+1]=0;for(;e.heap_len<2;)o[2*(i=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=a[2*i+1]);for(t.max_code=c,r=e.heap_len>>1;1<=r;r--)q(e,o,r);for(i=l;r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],q(e,o,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,o[2*i]=o[2*r]+o[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,o[2*r+1]=o[2*n+1]=i,e.heap[1]=i++,q(e,o,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,o,a,s,l=t.dyn_tree,c=t.max_code,u=t.stat_desc.static_tree,p=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,g=t.stat_desc.extra_base,y=t.stat_desc.max_length,m=0;for(o=0;o<=f;o++)e.bl_count[o]=0;for(l[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<d;r++)y<(o=l[2*l[2*(n=e.heap[r])+1]+1]+1)&&(o=y,m++),l[2*n+1]=o,c<n||(e.bl_count[o]++,a=0,g<=n&&(a=h[n-g]),s=l[2*n],e.opt_len+=s*(o+a),p&&(e.static_len+=s*(u[2*n+1]+a)));if(0!==m){do{for(o=y-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[y]--,m-=2}while(0<m);for(o=y;0!==o;o--)for(n=e.bl_count[o];0!==n;)c<(i=e.heap[--r])||(l[2*i+1]!==o&&(e.opt_len+=(o-l[2*i+1])*l[2*i],l[2*i+1]=o),n--)}}(e,t),G(o,c,e.bl_count)}function Y(e,t,r){var n,i,o=-1,a=t[1],s=0,l=7,c=4;for(0===a&&(l=138,c=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=a,a=t[2*(n+1)+1],++s<l&&i===a||(s<c?e.bl_tree[2*i]+=s:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[2*v]++):s<=10?e.bl_tree[2*_]++:e.bl_tree[2*w]++,o=i,c=(s=0)===a?(l=138,3):i===a?(l=6,3):(l=7,4))}function K(e,t,r){var n,i,o=-1,a=t[1],s=0,l=7,c=4;for(0===a&&(l=138,c=3),n=0;n<=r;n++)if(i=a,a=t[2*(n+1)+1],!(++s<l&&i===a)){if(s<c)for(;U(e,i,e.bl_tree),0!=--s;);else 0!==i?(i!==o&&(U(e,i,e.bl_tree),s--),U(e,v,e.bl_tree),F(e,s-3,2)):s<=10?(U(e,_,e.bl_tree),F(e,s-3,3)):(U(e,w,e.bl_tree),F(e,s-11,7));o=i,c=(s=0)===a?(l=138,3):i===a?(l=6,3):(l=7,4)}}a(M);var X=!1;function $(e,t,r,i){F(e,(s<<1)+(i?1:0),3),function(e,t,r,i){W(e),i&&(k(e,r),k(e,~r)),n.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}r._tr_init=function(e){X||(function(){var e,t,r,n,i,o=new Array(f+1);for(n=r=0;n<l-1;n++)for(P[n]=r,e=0;e<1<<S[n];e++)x[r++]=n;for(x[r-1]=n,n=i=0;n<16;n++)for(M[n]=i,e=0;e<1<<E[n];e++)A[i++]=n;for(i>>=7;n<p;n++)for(M[n]=i<<7,e=0;e<1<<E[n]-7;e++)A[256+i++]=n;for(t=0;t<=f;t++)o[t]=0;for(e=0;e<=143;)L[2*e+1]=8,e++,o[8]++;for(;e<=255;)L[2*e+1]=9,e++,o[9]++;for(;e<=279;)L[2*e+1]=7,e++,o[7]++;for(;e<=287;)L[2*e+1]=8,e++,o[8]++;for(G(L,u+1,o),e=0;e<p;e++)T[2*e+1]=5,T[2*e]=B(e,5);O=new D(L,S,c+1,u,f),I=new D(T,E,0,p,f),R=new D(new Array(0),b,0,h,y)}(),X=!0),e.l_desc=new N(e.dyn_ltree,O),e.d_desc=new N(e.dyn_dtree,I),e.bl_desc=new N(e.bl_tree,R),e.bi_buf=0,e.bi_valid=0,j(e)},r._tr_stored_block=$,r._tr_flush_block=function(e,t,r,n){var a,s,l=0;0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return i;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return o;for(t=32;t<c;t++)if(0!==e.dyn_ltree[2*t])return o;return i}(e)),z(e,e.l_desc),z(e,e.d_desc),l=function(e){var t;for(Y(e,e.dyn_ltree,e.l_desc.max_code),Y(e,e.dyn_dtree,e.d_desc.max_code),z(e,e.bl_desc),t=h-1;3<=t&&0===e.bl_tree[2*C[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),a=e.opt_len+3+7>>>3,(s=e.static_len+3+7>>>3)<=a&&(a=s)):a=s=r+5,r+4<=a&&-1!==t?$(e,t,r,n):4===e.strategy||s===a?(F(e,2+(n?1:0),3),V(e,L,T)):(F(e,4+(n?1:0),3),function(e,t,r,n){var i;for(F(e,t-257,5),F(e,r-1,5),F(e,n-4,4),i=0;i<n;i++)F(e,e.bl_tree[2*C[i]+1],3);K(e,e.dyn_ltree,t-1),K(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,l+1),V(e,e.dyn_ltree,e.dyn_dtree)),j(e),n&&W(e)},r._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(x[r]+c+1)]++,e.dyn_dtree[2*Z(t)]++),e.last_lit===e.lit_bufsize-1},r._tr_align=function(e){F(e,2,3),U(e,m,L),function(e){16===e.bi_valid?(k(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":41}],53:[function(e,t,r){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,t,n){(function(e){!function(e,t){"use strict";if(!e.setImmediate){var r,n,i,o,a=1,s={},l=!1,c=e.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(e);u=u&&u.setTimeout?u:e,r="[object process]"==={}.toString.call(e.process)?function(e){process.nextTick((function(){h(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?(o="setImmediate$"+Math.random()+"$",e.addEventListener?e.addEventListener("message",d,!1):e.attachEvent("onmessage",d),function(t){e.postMessage(o+t,"*")}):e.MessageChannel?((i=new MessageChannel).port1.onmessage=function(e){h(e.data)},function(e){i.port2.postMessage(e)}):c&&"onreadystatechange"in c.createElement("script")?(n=c.documentElement,function(e){var t=c.createElement("script");t.onreadystatechange=function(){h(e),t.onreadystatechange=null,n.removeChild(t),t=null},n.appendChild(t)}):function(e){setTimeout(h,0,e)},u.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return s[a]=i,r(a),a++},u.clearImmediate=p}function p(e){delete s[e]}function h(e){if(l)setTimeout(h,0,e);else{var r=s[e];if(r){l=!0;try{!function(e){var r=e.callback,n=e.args;switch(n.length){case 0:r();break;case 1:r(n[0]);break;case 2:r(n[0],n[1]);break;case 3:r(n[0],n[1],n[2]);break;default:r.apply(t,n)}}(r)}finally{p(e),l=!1}}}}function d(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(o)&&h(+t.data.slice(o.length))}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,void 0!==r.g?r.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[10])(10)},5915:function(e,t){var r,n,i;n=[],void 0===(i="function"==typeof(r=function(){var e=function(){},t={},r={},n={};function i(e,t){e=e.push?e:[e];var i,o,a,s=[],l=e.length,c=l;for(i=function(e,r){r.length&&s.push(e),--c||t(s)};l--;)o=e[l],(a=r[o])?i(o,a):(n[o]=n[o]||[]).push(i)}function o(e,t){if(e){var i=n[e];if(r[e]=t,i)for(;i.length;)i[0](e,t),i.splice(0,1)}}function a(t,r){t.call&&(t={success:t}),r.length?(t.error||e)(r):(t.success||e)(t)}function s(t,r,n,i){var o,a,l=document,c=n.async,u=(n.numRetries||0)+1,p=n.before||e,h=t.replace(/[\?|#].*$/,""),d=t.replace(/^(css|img)!/,"");i=i||0,/(^css!|\.css$)/.test(h)?((a=l.createElement("link")).rel="stylesheet",a.href=d,(o="hideFocus"in a)&&a.relList&&(o=0,a.rel="preload",a.as="style")):/(^img!|\.(png|gif|jpg|svg|webp)$)/.test(h)?(a=l.createElement("img")).src=d:((a=l.createElement("script")).src=t,a.async=void 0===c||c),a.onload=a.onerror=a.onbeforeload=function(e){var l=e.type[0];if(o)try{a.sheet.cssText.length||(l="e")}catch(e){18!=e.code&&(l="e")}if("e"==l){if((i+=1)<u)return s(t,r,n,i)}else if("preload"==a.rel&&"style"==a.as)return a.rel="stylesheet";r(t,l,e.defaultPrevented)},!1!==p(t,a)&&l.head.appendChild(a)}function l(e,t,r){var n,i,o=(e=e.push?e:[e]).length,a=o,l=[];for(n=function(e,r,n){if("e"==r&&l.push(e),"b"==r){if(!n)return;l.push(e)}--o||t(l)},i=0;i<a;i++)s(e[i],n,r)}function c(e,r,n){var i,s;if(r&&r.trim&&(i=r),s=(i?n:r)||{},i){if(i in t)throw"LoadJS";t[i]=!0}function c(t,r){l(e,(function(e){a(s,e),t&&a({success:t,error:r},e),o(i,e)}),s)}if(s.returnPromise)return new Promise(c);c()}return c.ready=function(e,t){return i(e,(function(e){a(t,e)})),c},c.done=function(e){o(e,[])},c.reset=function(){t={},r={},n={}},c.isDefined=function(e){return e in t},c})?r.apply(t,n):r)||(e.exports=i)},1466:(e,t,r)=>{
/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/
e.exports=function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=r[a]={exports:{}};t[a][0].call(c.exports,(function(e){var r=t[a][1][e];return i(r||e)}),c,c.exports,e,t,r,n)}return r[a].exports}for(var o=void 0,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,n){(function(e){"use strict";var r,n,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var o=0,a=new i(u),s=e.document.createTextNode("");a.observe(s,{characterData:!0}),r=function(){s.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)r="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var l=new e.MessageChannel;l.port1.onmessage=u,r=function(){l.port2.postMessage(0)}}var c=[];function u(){var e,t;n=!0;for(var r=c.length;r;){for(t=c,c=[],e=-1;++e<r;)t[e]();r=c.length}n=!1}function p(e){1!==c.push(e)||n||r()}t.exports=p}).call(this,void 0!==r.g?r.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,r){"use strict";var n=e(1);function i(){}var o={},a=["REJECTED"],s=["FULFILLED"],l=["PENDING"];function c(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,e!==i&&d(this,e)}function u(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function p(e,t,r){n((function(){var n;try{n=t(r)}catch(t){return o.reject(e,t)}n===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,n)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function d(e,t){var r=!1;function n(t){r||(r=!0,o.reject(e,t))}function i(t){r||(r=!0,o.resolve(e,t))}function a(){t(i,n)}var s=f(a);"error"===s.status&&n(s.value)}function f(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}function g(e){return e instanceof this?e:o.resolve(new this(i),e)}function y(e){var t=new this(i);return o.reject(t,e)}function m(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);for(var a=new Array(r),s=0,l=-1,c=new this(i);++l<r;)u(e[l],l);return c;function u(e,i){function l(e){a[i]=e,++s!==r||n||(n=!0,o.resolve(c,a))}t.resolve(e).then(l,(function(e){n||(n=!0,o.reject(c,e))}))}}function v(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);for(var a=-1,s=new this(i);++a<r;)l(e[a]);return s;function l(e){t.resolve(e).then((function(e){n||(n=!0,o.resolve(s,e))}),(function(e){n||(n=!0,o.reject(s,e))}))}}t.exports=c,c.prototype.catch=function(e){return this.then(null,e)},c.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===a)return this;var r=new this.constructor(i);return this.state!==l?p(r,this.state===s?e:t,this.outcome):this.queue.push(new u(r,e,t)),r},u.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){p(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){o.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){p(this.promise,this.onRejected,e)},o.resolve=function(e,t){var r=f(h,t);if("error"===r.status)return o.reject(e,r.value);var n=r.value;if(n)d(e,n);else{e.state=s,e.outcome=t;for(var i=-1,a=e.queue.length;++i<a;)e.queue[i].callFulfilled(t)}return e},o.reject=function(e,t){e.state=a,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},c.resolve=g,c.reject=y,c.all=m,c.race=v},{1:1}],3:[function(e,t,n){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==r.g?r.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}var a=o();function s(){try{if(!a||!a.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}function l(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)r.append(e[n]);return r.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var c=Promise;function u(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function p(e,t,r){"function"==typeof t&&e.then(t),"function"==typeof r&&e.catch(r)}function h(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function d(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var f="local-forage-detect-blob-support",g=void 0,y={},m=Object.prototype.toString,v="readonly",_="readwrite";function w(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),i=0;i<t;i++)n[i]=e.charCodeAt(i);return r}function S(e){return new c((function(t){var r=e.transaction(f,_),n=l([""]);r.objectStore(f).put(n,"key"),r.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},r.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),r=navigator.userAgent.match(/Edge\//);t(r||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}function E(e){return"boolean"==typeof g?c.resolve(g):S(e).then((function(e){return g=e}))}function b(e){var t=y[e.name],r={};r.promise=new c((function(e,t){r.resolve=e,r.reject=t})),t.deferredOperations.push(r),t.dbReady?t.dbReady=t.dbReady.then((function(){return r.promise})):t.dbReady=r.promise}function C(e){var t=y[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function L(e,t){var r=y[e.name].deferredOperations.pop();if(r)return r.reject(t),r.promise}function T(e,t){return new c((function(r,n){if(y[e.name]=y[e.name]||Z(),e.db){if(!t)return r(e.db);b(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var o=a.open.apply(a,i);t&&(o.onupgradeneeded=function(t){var r=o.result;try{r.createObjectStore(e.storeName),t.oldVersion<=1&&r.createObjectStore(f)}catch(r){if("ConstraintError"!==r.name)throw r;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),o.onerror=function(e){e.preventDefault(),n(o.error)},o.onsuccess=function(){var t=o.result;t.onversionchange=function(e){e.target.close()},r(t),C(e)}}))}function A(e){return T(e,!1)}function x(e){return T(e,!0)}function P(e,t){if(!e.db)return!0;var r=!e.db.objectStoreNames.contains(e.storeName),n=e.version<e.db.version,i=e.version>e.db.version;if(n&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||r){if(r){var o=e.db.version+1;o>e.version&&(e.version=o)}return!0}return!1}function O(e){return new c((function(t,r){var n=new FileReader;n.onerror=r,n.onloadend=function(r){var n=btoa(r.target.result||"");t({__local_forage_encoded_blob:!0,data:n,type:e.type})},n.readAsBinaryString(e)}))}function I(e){return l([w(atob(e.data))],{type:e.type})}function R(e){return e&&e.__local_forage_encoded_blob}function M(e){var t=this,r=t._initReady().then((function(){var e=y[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return p(r,e,e),r}function D(e){b(e);for(var t=y[e.name],r=t.forages,n=0;n<r.length;n++){var i=r[n];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,A(e).then((function(t){return e.db=t,P(e)?x(e):t})).then((function(n){e.db=t.db=n;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=n})).catch((function(t){throw L(e,t),t}))}function N(e,t,r,n){void 0===n&&(n=1);try{var i=e.db.transaction(e.storeName,t);r(null,i)}catch(i){if(n>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return c.resolve().then((function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),x(e)})).then((function(){return D(e).then((function(){N(e,t,r,n-1)}))})).catch(r);r(i)}}function Z(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function k(e){var t=this,r={db:null};if(e)for(var n in e)r[n]=e[n];var i=y[r.name];i||(i=Z(),y[r.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=M);var o=[];function a(){return c.resolve()}for(var s=0;s<i.forages.length;s++){var l=i.forages[s];l!==t&&o.push(l._initReady().catch(a))}var u=i.forages.slice(0);return c.all(o).then((function(){return r.db=i.db,A(r)})).then((function(e){return r.db=e,P(r,t._defaultConfig.version)?x(r):e})).then((function(e){r.db=i.db=e,t._dbInfo=r;for(var n=0;n<u.length;n++){var o=u[n];o!==t&&(o._dbInfo.db=r.db,o._dbInfo.version=r.version)}}))}function F(e,t){var r=this;e=h(e);var n=new c((function(t,n){r.ready().then((function(){N(r._dbInfo,v,(function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName).get(e);a.onsuccess=function(){var e=a.result;void 0===e&&(e=null),R(e)&&(e=I(e)),t(e)},a.onerror=function(){n(a.error)}}catch(e){n(e)}}))})).catch(n)}));return u(n,t),n}function U(e,t){var r=this,n=new c((function(t,n){r.ready().then((function(){N(r._dbInfo,v,(function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName).openCursor(),s=1;a.onsuccess=function(){var r=a.result;if(r){var n=r.value;R(n)&&(n=I(n));var i=e(n,r.key,s++);void 0!==i?t(i):r.continue()}else t()},a.onerror=function(){n(a.error)}}catch(e){n(e)}}))})).catch(n)}));return u(n,t),n}function B(e,t,r){var n=this;e=h(e);var i=new c((function(r,i){var o;n.ready().then((function(){return o=n._dbInfo,"[object Blob]"===m.call(t)?E(o.db).then((function(e){return e?t:O(t)})):t})).then((function(t){N(n._dbInfo,_,(function(o,a){if(o)return i(o);try{var s=a.objectStore(n._dbInfo.storeName);null===t&&(t=void 0);var l=s.put(t,e);a.oncomplete=function(){void 0===t&&(t=null),r(t)},a.onabort=a.onerror=function(){var e=l.error?l.error:l.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return u(i,r),i}function G(e,t){var r=this;e=h(e);var n=new c((function(t,n){r.ready().then((function(){N(r._dbInfo,_,(function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName).delete(e);o.oncomplete=function(){t()},o.onerror=function(){n(a.error)},o.onabort=function(){var e=a.error?a.error:a.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return u(n,t),n}function j(e){var t=this,r=new c((function(e,r){t.ready().then((function(){N(t._dbInfo,_,(function(n,i){if(n)return r(n);try{var o=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=o.error?o.error:o.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return u(r,e),r}function W(e){var t=this,r=new c((function(e,r){t.ready().then((function(){N(t._dbInfo,v,(function(n,i){if(n)return r(n);try{var o=i.objectStore(t._dbInfo.storeName).count();o.onsuccess=function(){e(o.result)},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return u(r,e),r}function H(e,t){var r=this,n=new c((function(t,n){e<0?t(null):r.ready().then((function(){N(r._dbInfo,v,(function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName),s=!1,l=a.openKeyCursor();l.onsuccess=function(){var r=l.result;r?0===e||s?t(r.key):(s=!0,r.advance(e)):t(null)},l.onerror=function(){n(l.error)}}catch(e){n(e)}}))})).catch(n)}));return u(n,t),n}function q(e){var t=this,r=new c((function(e,r){t.ready().then((function(){N(t._dbInfo,v,(function(n,i){if(n)return r(n);try{var o=i.objectStore(t._dbInfo.storeName).openKeyCursor(),a=[];o.onsuccess=function(){var t=o.result;t?(a.push(t.key),t.continue()):e(a)},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return u(r,e),r}function V(e,t){t=d.apply(this,arguments);var r=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName);var n,i=this;if(e.name){var o=e.name===r.name&&i._dbInfo.db?c.resolve(i._dbInfo.db):A(e).then((function(t){var r=y[e.name],n=r.forages;r.db=t;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=t;return t}));n=e.storeName?o.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var r=t.version+1;b(e);var n=y[e.name],i=n.forages;t.close();for(var o=0;o<i.length;o++){var s=i[o];s._dbInfo.db=null,s._dbInfo.version=r}var l=new c((function(t,n){var i=a.open(e.name,r);i.onerror=function(e){i.result.close(),n(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}}));return l.then((function(e){n.db=e;for(var t=0;t<i.length;t++){var r=i[t];r._dbInfo.db=e,C(r._dbInfo)}})).catch((function(t){throw(L(e,t)||c.resolve()).catch((function(){})),t}))}})):o.then((function(t){b(e);var r=y[e.name],n=r.forages;t.close();for(var i=0;i<n.length;i++)n[i]._dbInfo.db=null;var o=new c((function(t,r){var n=a.deleteDatabase(e.name);n.onerror=function(){var e=n.result;e&&e.close(),r(n.error)},n.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},n.onsuccess=function(){var e=n.result;e&&e.close(),t(e)}}));return o.then((function(e){r.db=e;for(var t=0;t<n.length;t++)C(n[t]._dbInfo)})).catch((function(t){throw(L(e,t)||c.resolve()).catch((function(){})),t}))}))}else n=c.reject("Invalid arguments");return u(n,t),n}var z={_driver:"asyncStorage",_initStorage:k,_support:s(),iterate:U,getItem:F,setItem:B,removeItem:G,clear:j,length:W,key:H,keys:q,dropInstance:V};function Y(){return"function"==typeof openDatabase}var K="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",X="~~local_forage_type~",$=/^~~local_forage_type~([^~]+)~/,J="__lfsc__:",Q=J.length,ee="arbf",te="blob",re="si08",ne="ui08",ie="uic8",oe="si16",ae="si32",se="ur16",le="ui32",ce="fl32",ue="fl64",pe=Q+ee.length,he=Object.prototype.toString;function de(e){var t,r,n,i,o,a=.75*e.length,s=e.length,l=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var c=new ArrayBuffer(a),u=new Uint8Array(c);for(t=0;t<s;t+=4)r=K.indexOf(e[t]),n=K.indexOf(e[t+1]),i=K.indexOf(e[t+2]),o=K.indexOf(e[t+3]),u[l++]=r<<2|n>>4,u[l++]=(15&n)<<4|i>>2,u[l++]=(3&i)<<6|63&o;return c}function fe(e){var t,r=new Uint8Array(e),n="";for(t=0;t<r.length;t+=3)n+=K[r[t]>>2],n+=K[(3&r[t])<<4|r[t+1]>>4],n+=K[(15&r[t+1])<<2|r[t+2]>>6],n+=K[63&r[t+2]];return r.length%3==2?n=n.substring(0,n.length-1)+"=":r.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}function ge(e,t){var r="";if(e&&(r=he.call(e)),e&&("[object ArrayBuffer]"===r||e.buffer&&"[object ArrayBuffer]"===he.call(e.buffer))){var n,i=J;e instanceof ArrayBuffer?(n=e,i+=ee):(n=e.buffer,"[object Int8Array]"===r?i+=re:"[object Uint8Array]"===r?i+=ne:"[object Uint8ClampedArray]"===r?i+=ie:"[object Int16Array]"===r?i+=oe:"[object Uint16Array]"===r?i+=se:"[object Int32Array]"===r?i+=ae:"[object Uint32Array]"===r?i+=le:"[object Float32Array]"===r?i+=ce:"[object Float64Array]"===r?i+=ue:t(new Error("Failed to get type for BinaryArray"))),t(i+fe(n))}else if("[object Blob]"===r){var o=new FileReader;o.onload=function(){var r=X+e.type+"~"+fe(this.result);t(J+te+r)},o.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(r){console.error("Couldn't convert value into a JSON string: ",e),t(null,r)}}function ye(e){if(e.substring(0,Q)!==J)return JSON.parse(e);var t,r=e.substring(pe),n=e.substring(Q,pe);if(n===te&&$.test(r)){var i=r.match($);t=i[1],r=r.substring(i[0].length)}var o=de(r);switch(n){case ee:return o;case te:return l([o],{type:t});case re:return new Int8Array(o);case ne:return new Uint8Array(o);case ie:return new Uint8ClampedArray(o);case oe:return new Int16Array(o);case se:return new Uint16Array(o);case ae:return new Int32Array(o);case le:return new Uint32Array(o);case ce:return new Float32Array(o);case ue:return new Float64Array(o);default:throw new Error("Unkown type: "+n)}}var me={serialize:ge,deserialize:ye,stringToBuffer:de,bufferToString:fe};function ve(e,t,r,n){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],r,n)}function _e(e){var t=this,r={db:null};if(e)for(var n in e)r[n]="string"!=typeof e[n]?e[n].toString():e[n];var i=new c((function(e,n){try{r.db=openDatabase(r.name,String(r.version),r.description,r.size)}catch(e){return n(e)}r.db.transaction((function(i){ve(i,r,(function(){t._dbInfo=r,e()}),(function(e,t){n(t)}))}),n)}));return r.serializer=me,i}function we(e,t,r,n,i,o){e.executeSql(r,n,i,(function(e,a){a.code===a.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,s){s.rows.length?o(e,a):ve(e,t,(function(){e.executeSql(r,n,i,o)}),o)}),o):o(e,a)}),o)}function Se(e,t){var r=this;e=h(e);var n=new c((function(t,n){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){we(r,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,r){var n=r.rows.length?r.rows.item(0).value:null;n&&(n=i.serializer.deserialize(n)),t(n)}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,t),n}function Ee(e,t){var r=this,n=new c((function(t,n){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){we(r,i,"SELECT * FROM "+i.storeName,[],(function(r,n){for(var o=n.rows,a=o.length,s=0;s<a;s++){var l=o.item(s),c=l.value;if(c&&(c=i.serializer.deserialize(c)),void 0!==(c=e(c,l.key,s+1)))return void t(c)}t()}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,t),n}function be(e,t,r,n){var i=this;e=h(e);var o=new c((function(o,a){i.ready().then((function(){void 0===t&&(t=null);var s=t,l=i._dbInfo;l.serializer.serialize(t,(function(t,c){c?a(c):l.db.transaction((function(r){we(r,l,"INSERT OR REPLACE INTO "+l.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){o(s)}),(function(e,t){a(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(n>0)return void o(be.apply(i,[e,s,r,n-1]));a(t)}}))}))})).catch(a)}));return u(o,r),o}function Ce(e,t,r){return be.apply(this,[e,t,r,1])}function Le(e,t){var r=this;e=h(e);var n=new c((function(t,n){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){we(r,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,t),n}function Te(e){var t=this,r=new c((function(e,r){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){we(t,n,"DELETE FROM "+n.storeName,[],(function(){e()}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,e),r}function Ae(e){var t=this,r=new c((function(e,r){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){we(t,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],(function(t,r){var n=r.rows.item(0).c;e(n)}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,e),r}function xe(e,t){var r=this,n=new c((function(t,n){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){we(r,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,r){var n=r.rows.length?r.rows.item(0).key:null;t(n)}),(function(e,t){n(t)}))}))})).catch(n)}));return u(n,t),n}function Pe(e){var t=this,r=new c((function(e,r){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){we(t,n,"SELECT key FROM "+n.storeName,[],(function(t,r){for(var n=[],i=0;i<r.rows.length;i++)n.push(r.rows.item(i).key);e(n)}),(function(e,t){r(t)}))}))})).catch(r)}));return u(r,e),r}function Oe(e){return new c((function(t,r){e.transaction((function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(r,n){for(var i=[],o=0;o<n.rows.length;o++)i.push(n.rows.item(o).name);t({db:e,storeNames:i})}),(function(e,t){r(t)}))}),(function(e){r(e)}))}))}function Ie(e,t){t=d.apply(this,arguments);var r=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName);var n,i=this;return u(n=e.name?new c((function(t){var n;n=e.name===r.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:n,storeNames:[e.storeName]}):t(Oe(n))})).then((function(e){return new c((function(t,r){e.db.transaction((function(n){function i(e){return new c((function(t,r){n.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){r(t)}))}))}for(var o=[],a=0,s=e.storeNames.length;a<s;a++)o.push(i(e.storeNames[a]));c.all(o).then((function(){t()})).catch((function(e){r(e)}))}),(function(e){r(e)}))}))})):c.reject("Invalid arguments"),t),n}var Re={_driver:"webSQLStorage",_initStorage:_e,_support:Y(),iterate:Ee,getItem:Se,setItem:Ce,removeItem:Le,clear:Te,length:Ae,key:xe,keys:Pe,dropInstance:Ie};function Me(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}function De(e,t){var r=e.name+"/";return e.storeName!==t.storeName&&(r+=e.storeName+"/"),r}function Ne(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}function Ze(){return!Ne()||localStorage.length>0}function ke(e){var t=this,r={};if(e)for(var n in e)r[n]=e[n];return r.keyPrefix=De(e,t._defaultConfig),Ze()?(t._dbInfo=r,r.serializer=me,c.resolve()):c.reject()}function Fe(e){var t=this,r=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,r=localStorage.length-1;r>=0;r--){var n=localStorage.key(r);0===n.indexOf(e)&&localStorage.removeItem(n)}}));return u(r,e),r}function Ue(e,t){var r=this;e=h(e);var n=r.ready().then((function(){var t=r._dbInfo,n=localStorage.getItem(t.keyPrefix+e);return n&&(n=t.serializer.deserialize(n)),n}));return u(n,t),n}function Be(e,t){var r=this,n=r.ready().then((function(){for(var t=r._dbInfo,n=t.keyPrefix,i=n.length,o=localStorage.length,a=1,s=0;s<o;s++){var l=localStorage.key(s);if(0===l.indexOf(n)){var c=localStorage.getItem(l);if(c&&(c=t.serializer.deserialize(c)),void 0!==(c=e(c,l.substring(i),a++)))return c}}}));return u(n,t),n}function Ge(e,t){var r=this,n=r.ready().then((function(){var t,n=r._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(n.keyPrefix.length)),t}));return u(n,t),n}function je(e){var t=this,r=t.ready().then((function(){for(var e=t._dbInfo,r=localStorage.length,n=[],i=0;i<r;i++){var o=localStorage.key(i);0===o.indexOf(e.keyPrefix)&&n.push(o.substring(e.keyPrefix.length))}return n}));return u(r,e),r}function We(e){var t=this.keys().then((function(e){return e.length}));return u(t,e),t}function He(e,t){var r=this;e=h(e);var n=r.ready().then((function(){var t=r._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return u(n,t),n}function qe(e,t,r){var n=this;e=h(e);var i=n.ready().then((function(){void 0===t&&(t=null);var r=t;return new c((function(i,o){var a=n._dbInfo;a.serializer.serialize(t,(function(t,n){if(n)o(n);else try{localStorage.setItem(a.keyPrefix+e,t),i(r)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||o(e),o(e)}}))}))}));return u(i,r),i}function Ve(e,t){if(t=d.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var r=this.config();e.name=e.name||r.name,e.storeName=e.storeName||r.storeName}var n,i=this;return n=e.name?new c((function(t){e.storeName?t(De(e,i._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var r=localStorage.key(t);0===r.indexOf(e)&&localStorage.removeItem(r)}})):c.reject("Invalid arguments"),u(n,t),n}var ze={_driver:"localStorageWrapper",_initStorage:ke,_support:Me(),iterate:Be,getItem:Ue,setItem:qe,removeItem:He,clear:Fe,length:We,key:Ge,keys:je,dropInstance:Ve},Ye=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},Ke=function(e,t){for(var r=e.length,n=0;n<r;){if(Ye(e[n],t))return!0;n++}return!1},Xe=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},$e={},Je={},Qe={INDEXEDDB:z,WEBSQL:Re,LOCALSTORAGE:ze},et=[Qe.INDEXEDDB._driver,Qe.WEBSQL._driver,Qe.LOCALSTORAGE._driver],tt=["dropInstance"],rt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(tt),nt={description:"",driver:et.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function it(e,t){e[t]=function(){var r=arguments;return e.ready().then((function(){return e[t].apply(e,r)}))}}function ot(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var r in t)t.hasOwnProperty(r)&&(Xe(t[r])?arguments[0][r]=t[r].slice():arguments[0][r]=t[r])}return arguments[0]}var at=function(){function e(t){for(var r in i(this,e),Qe)if(Qe.hasOwnProperty(r)){var n=Qe[r],o=n._driver;this[r]=o,$e[o]||this.defineDriver(n)}this._defaultConfig=ot({},nt),this._config=ot({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":n(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,r){var n=new c((function(t,r){try{var n=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void r(i);for(var o=rt.concat("_initStorage"),a=0,s=o.length;a<s;a++){var l=o[a];if((!Ke(tt,l)||e[l])&&"function"!=typeof e[l])return void r(i)}var p=function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),r=c.reject(t);return u(r,arguments[arguments.length-1]),r}},r=0,n=tt.length;r<n;r++){var i=tt[r];e[i]||(e[i]=t(i))}};p();var h=function(r){$e[n]&&console.info("Redefining LocalForage driver: "+n),$e[n]=e,Je[n]=r,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(h,r):h(!!e._support):h(!0)}catch(e){r(e)}}));return p(n,t,r),n},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,r){var n=$e[e]?c.resolve($e[e]):c.reject(new Error("Driver not found."));return p(n,t,r),n},e.prototype.getSerializer=function(e){var t=c.resolve(me);return p(t,e),t},e.prototype.ready=function(e){var t=this,r=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return p(r,e,e),r},e.prototype.setDriver=function(e,t,r){var n=this;Xe(e)||(e=[e]);var i=this._getSupportedDrivers(e);function o(){n._config.driver=n.driver()}function a(e){return n._extend(e),o(),n._ready=n._initStorage(n._config),n._ready}function s(e){return function(){var t=0;function r(){for(;t<e.length;){var i=e[t];return t++,n._dbInfo=null,n._ready=null,n.getDriver(i).then(a).catch(r)}o();var s=new Error("No available storage method found.");return n._driverSet=c.reject(s),n._driverSet}return r()}}var l=null!==this._driverSet?this._driverSet.catch((function(){return c.resolve()})):c.resolve();return this._driverSet=l.then((function(){var e=i[0];return n._dbInfo=null,n._ready=null,n.getDriver(e).then((function(e){n._driver=e._driver,o(),n._wrapLibraryMethodsWithReady(),n._initDriver=s(i)}))})).catch((function(){o();var e=new Error("No available storage method found.");return n._driverSet=c.reject(e),n._driverSet})),p(this._driverSet,t,r),this._driverSet},e.prototype.supports=function(e){return!!Je[e]},e.prototype._extend=function(e){ot(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=rt.length;e<t;e++)it(this,rt[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),st=new at;t.exports=st},{3:3}]},{},[4])(4)},9614:(e,t,r)=>{var n,i,o,a,s;n=r(1041),i=r(1615).utf8,o=r(1246),a=r(1615).bin,(s=function(e,t){e.constructor==String?e=t&&"binary"===t.encoding?a.stringToBytes(e):i.stringToBytes(e):o(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||e.constructor===Uint8Array||(e=e.toString());for(var r=n.bytesToWords(e),l=8*e.length,c=1732584193,u=-271733879,p=-1732584194,h=271733878,d=0;d<r.length;d++)r[d]=16711935&(r[d]<<8|r[d]>>>24)|4278255360&(r[d]<<24|r[d]>>>8);r[l>>>5]|=128<<l%32,r[14+(l+64>>>9<<4)]=l;var f=s._ff,g=s._gg,y=s._hh,m=s._ii;for(d=0;d<r.length;d+=16){var v=c,_=u,w=p,S=h;c=f(c,u,p,h,r[d+0],7,-680876936),h=f(h,c,u,p,r[d+1],12,-389564586),p=f(p,h,c,u,r[d+2],17,606105819),u=f(u,p,h,c,r[d+3],22,-1044525330),c=f(c,u,p,h,r[d+4],7,-176418897),h=f(h,c,u,p,r[d+5],12,1200080426),p=f(p,h,c,u,r[d+6],17,-1473231341),u=f(u,p,h,c,r[d+7],22,-45705983),c=f(c,u,p,h,r[d+8],7,1770035416),h=f(h,c,u,p,r[d+9],12,-1958414417),p=f(p,h,c,u,r[d+10],17,-42063),u=f(u,p,h,c,r[d+11],22,-1990404162),c=f(c,u,p,h,r[d+12],7,1804603682),h=f(h,c,u,p,r[d+13],12,-40341101),p=f(p,h,c,u,r[d+14],17,-1502002290),c=g(c,u=f(u,p,h,c,r[d+15],22,1236535329),p,h,r[d+1],5,-165796510),h=g(h,c,u,p,r[d+6],9,-1069501632),p=g(p,h,c,u,r[d+11],14,643717713),u=g(u,p,h,c,r[d+0],20,-373897302),c=g(c,u,p,h,r[d+5],5,-701558691),h=g(h,c,u,p,r[d+10],9,38016083),p=g(p,h,c,u,r[d+15],14,-660478335),u=g(u,p,h,c,r[d+4],20,-405537848),c=g(c,u,p,h,r[d+9],5,568446438),h=g(h,c,u,p,r[d+14],9,-1019803690),p=g(p,h,c,u,r[d+3],14,-187363961),u=g(u,p,h,c,r[d+8],20,1163531501),c=g(c,u,p,h,r[d+13],5,-1444681467),h=g(h,c,u,p,r[d+2],9,-51403784),p=g(p,h,c,u,r[d+7],14,1735328473),c=y(c,u=g(u,p,h,c,r[d+12],20,-1926607734),p,h,r[d+5],4,-378558),h=y(h,c,u,p,r[d+8],11,-2022574463),p=y(p,h,c,u,r[d+11],16,1839030562),u=y(u,p,h,c,r[d+14],23,-35309556),c=y(c,u,p,h,r[d+1],4,-1530992060),h=y(h,c,u,p,r[d+4],11,1272893353),p=y(p,h,c,u,r[d+7],16,-155497632),u=y(u,p,h,c,r[d+10],23,-1094730640),c=y(c,u,p,h,r[d+13],4,681279174),h=y(h,c,u,p,r[d+0],11,-358537222),p=y(p,h,c,u,r[d+3],16,-722521979),u=y(u,p,h,c,r[d+6],23,76029189),c=y(c,u,p,h,r[d+9],4,-640364487),h=y(h,c,u,p,r[d+12],11,-421815835),p=y(p,h,c,u,r[d+15],16,530742520),c=m(c,u=y(u,p,h,c,r[d+2],23,-995338651),p,h,r[d+0],6,-198630844),h=m(h,c,u,p,r[d+7],10,1126891415),p=m(p,h,c,u,r[d+14],15,-1416354905),u=m(u,p,h,c,r[d+5],21,-57434055),c=m(c,u,p,h,r[d+12],6,1700485571),h=m(h,c,u,p,r[d+3],10,-1894986606),p=m(p,h,c,u,r[d+10],15,-1051523),u=m(u,p,h,c,r[d+1],21,-2054922799),c=m(c,u,p,h,r[d+8],6,1873313359),h=m(h,c,u,p,r[d+15],10,-30611744),p=m(p,h,c,u,r[d+6],15,-1560198380),u=m(u,p,h,c,r[d+13],21,1309151649),c=m(c,u,p,h,r[d+4],6,-145523070),h=m(h,c,u,p,r[d+11],10,-1120210379),p=m(p,h,c,u,r[d+2],15,718787259),u=m(u,p,h,c,r[d+9],21,-343485551),c=c+v>>>0,u=u+_>>>0,p=p+w>>>0,h=h+S>>>0}return n.endian([c,u,p,h])})._ff=function(e,t,r,n,i,o,a){var s=e+(t&r|~t&n)+(i>>>0)+a;return(s<<o|s>>>32-o)+t},s._gg=function(e,t,r,n,i,o,a){var s=e+(t&n|r&~n)+(i>>>0)+a;return(s<<o|s>>>32-o)+t},s._hh=function(e,t,r,n,i,o,a){var s=e+(t^r^n)+(i>>>0)+a;return(s<<o|s>>>32-o)+t},s._ii=function(e,t,r,n,i,o,a){var s=e+(r^(t|~n))+(i>>>0)+a;return(s<<o|s>>>32-o)+t},s._blocksize=16,s._digestsize=16,e.exports=function(e,t){if(null==e)throw new Error("Illegal argument "+e);var r=n.wordsToBytes(s(e,t));return t&&t.asBytes?r:t&&t.asString?a.bytesToString(r):n.bytesToHex(r)}},9409:(e,t,r)=>{"use strict";r.d(t,{Z:()=>fr});var n=6378137,i=.0066943799901413165,o=484813681109536e-20,a=Math.PI/2,s=1e-10,l=.017453292519943295,c=57.29577951308232,u=Math.PI/4,p=2*Math.PI,h=3.14159265359,d={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667};const f={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var g=/[\s_\-\/\(\)]/g;function y(e,t){if(e[t])return e[t];for(var r,n=Object.keys(e),i=t.toLowerCase().replace(g,""),o=-1;++o<n.length;)if((r=n[o]).toLowerCase().replace(g,"")===i)return e[r]}function m(e){var t,r,n,i={},o=e.split("+").map((function(e){return e.trim()})).filter((function(e){return e})).reduce((function(e,t){var r=t.split("=");return r.push(!0),e[r[0].toLowerCase()]=r[1],e}),{}),a={proj:"projName",datum:"datumCode",rf:function(e){i.rf=parseFloat(e)},lat_0:function(e){i.lat0=e*l},lat_1:function(e){i.lat1=e*l},lat_2:function(e){i.lat2=e*l},lat_ts:function(e){i.lat_ts=e*l},lon_0:function(e){i.long0=e*l},lon_1:function(e){i.long1=e*l},lon_2:function(e){i.long2=e*l},alpha:function(e){i.alpha=parseFloat(e)*l},gamma:function(e){i.rectified_grid_angle=parseFloat(e)},lonc:function(e){i.longc=e*l},x_0:function(e){i.x0=parseFloat(e)},y_0:function(e){i.y0=parseFloat(e)},k_0:function(e){i.k0=parseFloat(e)},k:function(e){i.k0=parseFloat(e)},a:function(e){i.a=parseFloat(e)},b:function(e){i.b=parseFloat(e)},r_a:function(){i.R_A=!0},zone:function(e){i.zone=parseInt(e,10)},south:function(){i.utmSouth=!0},towgs84:function(e){i.datum_params=e.split(",").map((function(e){return parseFloat(e)}))},to_meter:function(e){i.to_meter=parseFloat(e)},units:function(e){i.units=e;var t=y(f,e);t&&(i.to_meter=t.to_meter)},from_greenwich:function(e){i.from_greenwich=e*l},pm:function(e){var t=y(d,e);i.from_greenwich=(t||parseFloat(e))*l},nadgrids:function(e){"@null"===e?i.datumCode="none":i.nadgrids=e},axis:function(e){var t="ewnsud";3===e.length&&-1!==t.indexOf(e.substr(0,1))&&-1!==t.indexOf(e.substr(1,1))&&-1!==t.indexOf(e.substr(2,1))&&(i.axis=e)},approx:function(){i.approx=!0}};for(t in o)r=o[t],t in a?"function"==typeof(n=a[t])?n(r):i[n]=r:i[t]=r;return"string"==typeof i.datumCode&&"WGS84"!==i.datumCode&&(i.datumCode=i.datumCode.toLowerCase()),i}const v=function(e){return new C(e).output()};var _=/\s/,w=/[A-Za-z]/,S=/[A-Za-z84_]/,E=/[,\]]/,b=/[\d\.E\-\+]/;function C(e){if("string"!=typeof e)throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=1}function L(e,t,r){Array.isArray(t)&&(r.unshift(t),t=null);var n=t?{}:e,i=r.reduce((function(e,t){return T(t,e),e}),n);t&&(e[t]=i)}function T(e,t){if(Array.isArray(e)){var r=e.shift();if("PARAMETER"===r&&(r=e.shift()),1===e.length)return Array.isArray(e[0])?(t[r]={},void T(e[0],t[r])):void(t[r]=e[0]);if(e.length)if("TOWGS84"!==r){if("AXIS"===r)return r in t||(t[r]=[]),void t[r].push(e);var n;switch(Array.isArray(r)||(t[r]={}),r){case"UNIT":case"PRIMEM":case"VERT_DATUM":return t[r]={name:e[0].toLowerCase(),convert:e[1]},void(3===e.length&&T(e[2],t[r]));case"SPHEROID":case"ELLIPSOID":return t[r]={name:e[0],a:e[1],rf:e[2]},void(4===e.length&&T(e[3],t[r]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return e[0]=["name",e[0]],void L(t,r,e);default:for(n=-1;++n<e.length;)if(!Array.isArray(e[n]))return T(e,t[r]);return L(t,r,e)}}else t[r]=e;else t[r]=!0}else t[e]=!0}C.prototype.readCharicter=function(){var e=this.text[this.place++];if(4!==this.state)for(;_.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case 1:return this.neutral(e);case 2:return this.keyword(e);case 4:return this.quoted(e);case 5:return this.afterquote(e);case 3:return this.number(e);case-1:return}},C.prototype.afterquote=function(e){if('"'===e)return this.word+='"',void(this.state=4);if(E.test(e))return this.word=this.word.trim(),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in afterquote yet, index '+this.place)},C.prototype.afterItem=function(e){return","===e?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=1)):"]"===e?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=1,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},C.prototype.number=function(e){if(!b.test(e)){if(E.test(e))return this.word=parseFloat(this.word),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in number yet, index '+this.place)}this.word+=e},C.prototype.quoted=function(e){'"'!==e?this.word+=e:this.state=5},C.prototype.keyword=function(e){if(S.test(e))this.word+=e;else{if("["===e){var t=[];return t.push(this.word),this.level++,null===this.root?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,void(this.state=1)}if(!E.test(e))throw new Error("havn't handled \""+e+'" in keyword yet, index '+this.place);this.afterItem(e)}},C.prototype.neutral=function(e){if(w.test(e))return this.word=e,void(this.state=2);if('"'===e)return this.word="",void(this.state=4);if(b.test(e))return this.word=e,void(this.state=3);if(!E.test(e))throw new Error("havn't handled \""+e+'" in neutral yet, index '+this.place);this.afterItem(e)},C.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function A(e){return.017453292519943295*e}function x(e){var t=v(e),r=t.shift(),n=t.shift();t.unshift(["name",n]),t.unshift(["type",r]);var i={};return T(t,i),function(e){if("GEOGCS"===e.type?e.projName="longlat":"LOCAL_CS"===e.type?(e.projName="identity",e.local=!0):"object"==typeof e.PROJECTION?e.projName=Object.keys(e.PROJECTION)[0]:e.projName=e.PROJECTION,e.AXIS){for(var t="",r=0,n=e.AXIS.length;r<n;++r){var i=[e.AXIS[r][0].toLowerCase(),e.AXIS[r][1].toLowerCase()];-1!==i[0].indexOf("north")||("y"===i[0]||"lat"===i[0])&&"north"===i[1]?t+="n":-1!==i[0].indexOf("south")||("y"===i[0]||"lat"===i[0])&&"south"===i[1]?t+="s":-1!==i[0].indexOf("east")||("x"===i[0]||"lon"===i[0])&&"east"===i[1]?t+="e":-1===i[0].indexOf("west")&&("x"!==i[0]&&"lon"!==i[0]||"west"!==i[1])||(t+="w")}2===t.length&&(t+="u"),3===t.length&&(e.axis=t)}e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),"metre"===e.units&&(e.units="meter"),e.UNIT.convert&&("GEOGCS"===e.type?e.DATUM&&e.DATUM.SPHEROID&&(e.to_meter=e.UNIT.convert*e.DATUM.SPHEROID.a):e.to_meter=e.UNIT.convert));var o=e.GEOGCS;function a(t){return t*(e.to_meter||1)}"GEOGCS"===e.type&&(o=e),o&&(o.DATUM?e.datumCode=o.DATUM.name.toLowerCase():e.datumCode=o.name.toLowerCase(),"d_"===e.datumCode.slice(0,2)&&(e.datumCode=e.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==e.datumCode&&"new_zealand_1949"!==e.datumCode||(e.datumCode="nzgd49"),"wgs_1984"!==e.datumCode&&"world_geodetic_system_1984"!==e.datumCode||("Mercator_Auxiliary_Sphere"===e.PROJECTION&&(e.sphere=!0),e.datumCode="wgs84"),"_ferro"===e.datumCode.slice(-6)&&(e.datumCode=e.datumCode.slice(0,-6)),"_jakarta"===e.datumCode.slice(-8)&&(e.datumCode=e.datumCode.slice(0,-8)),~e.datumCode.indexOf("belge")&&(e.datumCode="rnb72"),o.DATUM&&o.DATUM.SPHEROID&&(e.ellps=o.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===e.ellps.toLowerCase().slice(0,13)&&(e.ellps="intl"),e.a=o.DATUM.SPHEROID.a,e.rf=parseFloat(o.DATUM.SPHEROID.rf,10)),o.DATUM&&o.DATUM.TOWGS84&&(e.datum_params=o.DATUM.TOWGS84),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36"),~e.datumCode.indexOf("osni_1952")&&(e.datumCode="osni52"),(~e.datumCode.indexOf("tm65")||~e.datumCode.indexOf("geodetic_datum_of_1965"))&&(e.datumCode="ire65"),"ch1903+"===e.datumCode&&(e.datumCode="ch1903"),~e.datumCode.indexOf("israel")&&(e.datumCode="isr93")),e.b&&!isFinite(e.b)&&(e.b=e.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",A],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",A],["x0","false_easting",a],["y0","false_northing",a],["long0","central_meridian",A],["lat0","latitude_of_origin",A],["lat0","standard_parallel_1",A],["lat1","standard_parallel_1",A],["lat2","standard_parallel_2",A],["azimuth","Azimuth"],["alpha","azimuth",A],["srsCode","name"]].forEach((function(t){return function(e,t){var r=t[0],n=t[1];!(r in e)&&n in e&&(e[r]=e[n],3===t.length&&(e[r]=t[2](e[r])))}(e,t)})),e.long0||!e.longc||"Albers_Conic_Equal_Area"!==e.projName&&"Lambert_Azimuthal_Equal_Area"!==e.projName||(e.long0=e.longc),e.lat_ts||!e.lat1||"Stereographic_South_Pole"!==e.projName&&"Polar Stereographic (variant B)"!==e.projName||(e.lat0=A(e.lat1>0?90:-90),e.lat_ts=e.lat1)}(i),i}function P(e){var t=this;if(2===arguments.length){var r=arguments[1];"string"==typeof r?"+"===r.charAt(0)?P[e]=m(arguments[1]):P[e]=x(arguments[1]):P[e]=r}else if(1===arguments.length){if(Array.isArray(e))return e.map((function(e){Array.isArray(e)?P.apply(t,e):P(e)}));if("string"==typeof e){if(e in P)return P[e]}else"EPSG"in e?P["EPSG:"+e.EPSG]=e:"ESRI"in e?P["ESRI:"+e.ESRI]=e:"IAU2000"in e?P["IAU2000:"+e.IAU2000]=e:console.log(e);return}}!function(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}(P);const O=P;var I=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];var R=["3857","900913","3785","102113"];const M=function(e){if(!function(e){return"string"==typeof e}(e))return e;if(function(e){return e in O}(e))return O[e];if(function(e){return I.some((function(t){return e.indexOf(t)>-1}))}(e)){var t=x(e);if(function(e){var t=y(e,"authority");if(t){var r=y(t,"epsg");return r&&R.indexOf(r)>-1}}(t))return O["EPSG:3857"];var r=function(e){var t=y(e,"extension");if(t)return y(t,"proj4")}(t);return r?m(r):t}return function(e){return"+"===e[0]}(e)?m(e):void 0};function D(e,t){var r,n;if(e=e||{},!t)return e;for(n in t)void 0!==(r=t[n])&&(e[n]=r);return e}function N(e,t,r){var n=e*t;return r/Math.sqrt(1-n*n)}function Z(e){return e<0?-1:1}function k(e){return Math.abs(e)<=h?e:e-Z(e)*p}function F(e,t,r){var n=e*r,i=.5*e;return n=Math.pow((1-n)/(1+n),i),Math.tan(.5*(a-t))/n}function U(e,t){for(var r,n,i=.5*e,o=a-2*Math.atan(t),s=0;s<=15;s++)if(r=e*Math.sin(o),o+=n=a-2*Math.atan(t*Math.pow((1-r)/(1+r),i))-o,Math.abs(n)<=1e-10)return o;return-9999}function B(e){return e}var G=[{init:function(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=N(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(e){var t,r,n=e.x,i=e.y;if(i*c>90&&i*c<-90&&n*c>180&&n*c<-180)return null;if(Math.abs(Math.abs(i)-a)<=s)return null;if(this.sphere)t=this.x0+this.a*this.k0*k(n-this.long0),r=this.y0+this.a*this.k0*Math.log(Math.tan(u+.5*i));else{var o=Math.sin(i),l=F(this.e,i,o);t=this.x0+this.a*this.k0*k(n-this.long0),r=this.y0-this.a*this.k0*Math.log(l)}return e.x=t,e.y=r,e},inverse:function(e){var t,r,n=e.x-this.x0,i=e.y-this.y0;if(this.sphere)r=a-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else{var o=Math.exp(-i/(this.a*this.k0));if(-9999===(r=U(this.e,o)))return null}return t=k(this.long0+n/(this.a*this.k0)),e.x=t,e.y=r,e},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:B,inverse:B,names:["longlat","identity"]}],j={},W=[];function H(e,t){var r=W.length;return e.names?(W[r]=e,e.names.forEach((function(e){j[e.toLowerCase()]=r})),this):(console.log(t),!0)}const q={start:function(){G.forEach(H)},add:H,get:function(e){if(!e)return!1;var t=e.toLowerCase();return void 0!==j[t]&&W[j[t]]?W[j[t]]:void 0}};var V={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:6378249.2,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},z=V.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};V.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var Y={};Y.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},Y.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},Y.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},Y.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},Y.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},Y.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},Y.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},Y.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},Y.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},Y.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},Y.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},Y.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},Y.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},Y.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},Y.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},Y.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},Y.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};const K=function(e,t,r,n,i,a,s){var l={};return l.datum_type=void 0===e||"none"===e?5:4,t&&(l.datum_params=t.map(parseFloat),0===l.datum_params[0]&&0===l.datum_params[1]&&0===l.datum_params[2]||(l.datum_type=1),l.datum_params.length>3&&(0===l.datum_params[3]&&0===l.datum_params[4]&&0===l.datum_params[5]&&0===l.datum_params[6]||(l.datum_type=2,l.datum_params[3]*=o,l.datum_params[4]*=o,l.datum_params[5]*=o,l.datum_params[6]=l.datum_params[6]/1e6+1))),s&&(l.datum_type=3,l.grids=s),l.a=r,l.b=n,l.es=i,l.ep2=a,l};var X={};function $(e){if(0===e.length)return null;var t="@"===e[0];return t&&(e=e.slice(1)),"null"===e?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:e,mandatory:!t,grid:X[e]||null,isNull:!1}}function J(e){return e/3600*Math.PI/180}function Q(e,t,r){return String.fromCharCode.apply(null,new Uint8Array(e.buffer.slice(t,r)))}function ee(e){return e.map((function(e){return[J(e.longitudeShift),J(e.latitudeShift)]}))}function te(e,t,r){return{name:Q(e,t+8,t+16).trim(),parent:Q(e,t+24,t+24+8).trim(),lowerLatitude:e.getFloat64(t+72,r),upperLatitude:e.getFloat64(t+88,r),lowerLongitude:e.getFloat64(t+104,r),upperLongitude:e.getFloat64(t+120,r),latitudeInterval:e.getFloat64(t+136,r),longitudeInterval:e.getFloat64(t+152,r),gridNodeCount:e.getInt32(t+168,r)}}function re(e,t,r,n){for(var i=t+176,o=[],a=0;a<r.gridNodeCount;a++){var s={latitudeShift:e.getFloat32(i+16*a,n),longitudeShift:e.getFloat32(i+16*a+4,n),latitudeAccuracy:e.getFloat32(i+16*a+8,n),longitudeAccuracy:e.getFloat32(i+16*a+12,n)};o.push(s)}return o}function ne(e,t){if(!(this instanceof ne))return new ne(e);t=t||function(e){if(e)throw e};var r=M(e);if("object"==typeof r){var n=ne.projections.get(r.projName);if(n){if(r.datumCode&&"none"!==r.datumCode){var i=y(Y,r.datumCode);i&&(r.datum_params=r.datum_params||(i.towgs84?i.towgs84.split(","):null),r.ellps=i.ellipse,r.datumName=i.datumName?i.datumName:r.datumCode)}r.k0=r.k0||1,r.axis=r.axis||"enu",r.ellps=r.ellps||"wgs84",r.lat1=r.lat1||r.lat0;var o,a,l,c,u,p,h,d=function(e,t,r,n,i){if(!e){var o=y(V,n);o||(o=z),e=o.a,t=o.b,r=o.rf}return r&&!t&&(t=(1-1/r)*e),(0===r||Math.abs(e-t)<s)&&(i=!0,t=e),{a:e,b:t,rf:r,sphere:i}}(r.a,r.b,r.rf,r.ellps,r.sphere),f=(o=d.a,a=d.b,d.rf,l=r.R_A,p=((c=o*o)-(u=a*a))/c,h=0,l?(c=(o*=1-p*(.16666666666666666+p*(.04722222222222222+.022156084656084655*p)))*o,p=0):h=Math.sqrt(p),{es:p,e:h,ep2:(c-u)/u}),g=function(e){return void 0===e?null:e.split(",").map($)}(r.nadgrids),m=r.datum||K(r.datumCode,r.datum_params,d.a,d.b,f.es,f.ep2,g);D(this,r),D(this,n),this.a=d.a,this.b=d.b,this.rf=d.rf,this.sphere=d.sphere,this.es=f.es,this.e=f.e,this.ep2=f.ep2,this.datum=m,this.init(),t(null,this)}else t(e)}else t(e)}ne.projections=q,ne.projections.start();const ie=ne;function oe(e,t,r){var n,i,o,s,l=e.x,c=e.y,u=e.z?e.z:0;if(c<-a&&c>-1.001*a)c=-a;else if(c>a&&c<1.001*a)c=a;else{if(c<-a)return{x:-1/0,y:-1/0,z:e.z};if(c>a)return{x:1/0,y:1/0,z:e.z}}return l>Math.PI&&(l-=2*Math.PI),i=Math.sin(c),s=Math.cos(c),o=i*i,{x:((n=r/Math.sqrt(1-t*o))+u)*s*Math.cos(l),y:(n+u)*s*Math.sin(l),z:(n*(1-t)+u)*i}}function ae(e,t,r,n){var i,o,s,l,c,u,p,h,d,f,g,y,m,v,_,w=1e-12,S=e.x,E=e.y,b=e.z?e.z:0;if(i=Math.sqrt(S*S+E*E),o=Math.sqrt(S*S+E*E+b*b),i/r<w){if(v=0,o/r<w)return a,_=-n,{x:e.x,y:e.y,z:e.z}}else v=Math.atan2(E,S);s=b/o,h=(l=i/o)*(1-t)*(c=1/Math.sqrt(1-t*(2-t)*l*l)),d=s*c,m=0;do{m++,u=t*(p=r/Math.sqrt(1-t*d*d))/(p+(_=i*h+b*d-p*(1-t*d*d))),y=(g=s*(c=1/Math.sqrt(1-u*(2-u)*l*l)))*h-(f=l*(1-u)*c)*d,h=f,d=g}while(y*y>1e-24&&m<30);return{x:v,y:Math.atan(g/Math.abs(f)),z:_}}function se(e){return 1===e||2===e}function le(e,t,r){if(function(e,t){return e.datum_type===t.datum_type&&!(e.a!==t.a||Math.abs(e.es-t.es)>5e-11)&&(1===e.datum_type?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]:2!==e.datum_type||e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]&&e.datum_params[3]===t.datum_params[3]&&e.datum_params[4]===t.datum_params[4]&&e.datum_params[5]===t.datum_params[5]&&e.datum_params[6]===t.datum_params[6])}(e,t))return r;if(5===e.datum_type||5===t.datum_type)return r;var o=e.a,a=e.es;if(3===e.datum_type){if(0!==ce(e,!1,r))return;o=n,a=i}var s=t.a,l=t.b,c=t.es;if(3===t.datum_type&&(s=n,l=6356752.314,c=i),a===c&&o===s&&!se(e.datum_type)&&!se(t.datum_type))return r;if((r=oe(r,a,o),se(e.datum_type)&&(r=function(e,t,r){if(1===t)return{x:e.x+r[0],y:e.y+r[1],z:e.z+r[2]};if(2===t){var n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],l=r[5],c=r[6];return{x:c*(e.x-l*e.y+s*e.z)+n,y:c*(l*e.x+e.y-a*e.z)+i,z:c*(-s*e.x+a*e.y+e.z)+o}}}(r,e.datum_type,e.datum_params)),se(t.datum_type)&&(r=function(e,t,r){if(1===t)return{x:e.x-r[0],y:e.y-r[1],z:e.z-r[2]};if(2===t){var n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],l=r[5],c=r[6],u=(e.x-n)/c,p=(e.y-i)/c,h=(e.z-o)/c;return{x:u+l*p-s*h,y:-l*u+p+a*h,z:s*u-a*p+h}}}(r,t.datum_type,t.datum_params)),r=ae(r,c,s,l),3===t.datum_type)&&0!==ce(t,!0,r))return;return r}function ce(e,t,r){if(null===e.grids||0===e.grids.length)return console.log("Grid shift grids not found"),-1;for(var n={x:-r.x,y:r.y},i={x:Number.NaN,y:Number.NaN},o=[],a=0;a<e.grids.length;a++){var s=e.grids[a];if(o.push(s.name),s.isNull){i=n;break}if(s.mandatory,null!==s.grid){var l=s.grid.subgrids[0],u=(Math.abs(l.del[1])+Math.abs(l.del[0]))/1e4,p=l.ll[0]-u,h=l.ll[1]-u,d=l.ll[0]+(l.lim[0]-1)*l.del[0]+u,f=l.ll[1]+(l.lim[1]-1)*l.del[1]+u;if(!(h>n.y||p>n.x||f<n.y||d<n.x||(i=ue(n,t,l),isNaN(i.x))))break}else if(s.mandatory)return console.log("Unable to find mandatory grid '"+s.name+"'"),-1}return isNaN(i.x)?(console.log("Failed to find a grid shift table for location '"+-n.x*c+" "+n.y*c+" tried: '"+o+"'"),-1):(r.x=-i.x,r.y=i.y,0)}function ue(e,t,r){var n={x:Number.NaN,y:Number.NaN};if(isNaN(e.x))return n;var i={x:e.x,y:e.y};i.x-=r.ll[0],i.y-=r.ll[1],i.x=k(i.x-Math.PI)+Math.PI;var o=pe(i,r);if(t){if(isNaN(o.x))return n;o.x=i.x-o.x,o.y=i.y-o.y;var a,s,l=9;do{if(s=pe(o,r),isNaN(s.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}a={x:i.x-(s.x+o.x),y:i.y-(s.y+o.y)},o.x+=a.x,o.y+=a.y}while(l--&&Math.abs(a.x)>1e-12&&Math.abs(a.y)>1e-12);if(l<0)return console.log("Inverse grid shift iterator failed to converge."),n;n.x=k(o.x+r.ll[0]),n.y=o.y+r.ll[1]}else isNaN(o.x)||(n.x=e.x+o.x,n.y=e.y+o.y);return n}function pe(e,t){var r,n={x:e.x/t.del[0],y:e.y/t.del[1]},i=Math.floor(n.x),o=Math.floor(n.y),a=n.x-1*i,s=n.y-1*o,l={x:Number.NaN,y:Number.NaN};if(i<0||i>=t.lim[0])return l;if(o<0||o>=t.lim[1])return l;r=o*t.lim[0]+i;var c=t.cvs[r][0],u=t.cvs[r][1];r++;var p=t.cvs[r][0],h=t.cvs[r][1];r+=t.lim[0];var d=t.cvs[r][0],f=t.cvs[r][1];r--;var g=t.cvs[r][0],y=t.cvs[r][1],m=a*s,v=a*(1-s),_=(1-a)*(1-s),w=(1-a)*s;return l.x=_*c+v*p+w*g+m*d,l.y=_*u+v*h+w*y+m*f,l}function he(e,t,r){var n,i,o,a=r.x,s=r.y,l=r.z||0,c={};for(o=0;o<3;o++)if(!t||2!==o||void 0!==r.z)switch(0===o?(n=a,i=-1!=="ew".indexOf(e.axis[o])?"x":"y"):1===o?(n=s,i=-1!=="ns".indexOf(e.axis[o])?"y":"x"):(n=l,i="z"),e.axis[o]){case"e":case"n":c[i]=n;break;case"w":case"s":c[i]=-n;break;case"u":void 0!==r[i]&&(c.z=n);break;case"d":void 0!==r[i]&&(c.z=-n);break;default:return null}return c}function de(e){var t={x:e[0],y:e[1]};return e.length>2&&(t.z=e[2]),e.length>3&&(t.m=e[3]),t}function fe(e){if("function"==typeof Number.isFinite){if(Number.isFinite(e))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof e||e!=e||!isFinite(e))throw new TypeError("coordinates must be finite numbers")}function ge(e,t,r,n){var i,o=void 0!==(r=Array.isArray(r)?de(r):{x:r.x,y:r.y,z:r.z,m:r.m}).z;if(function(e){fe(e.x),fe(e.y)}(r),e.datum&&t.datum&&function(e,t){return(1===e.datum.datum_type||2===e.datum.datum_type||3===e.datum.datum_type)&&"WGS84"!==t.datumCode||(1===t.datum.datum_type||2===t.datum.datum_type||3===t.datum.datum_type)&&"WGS84"!==e.datumCode}(e,t)&&(r=ge(e,i=new ie("WGS84"),r,n),e=i),n&&"enu"!==e.axis&&(r=he(e,!1,r)),"longlat"===e.projName)r={x:r.x*l,y:r.y*l,z:r.z||0};else if(e.to_meter&&(r={x:r.x*e.to_meter,y:r.y*e.to_meter,z:r.z||0}),!(r=e.inverse(r)))return;if(e.from_greenwich&&(r.x+=e.from_greenwich),r=le(e.datum,t.datum,r))return t.from_greenwich&&(r={x:r.x-t.from_greenwich,y:r.y,z:r.z||0}),"longlat"===t.projName?r={x:r.x*c,y:r.y*c,z:r.z||0}:(r=t.forward(r),t.to_meter&&(r={x:r.x/t.to_meter,y:r.y/t.to_meter,z:r.z||0})),n&&"enu"!==t.axis?he(t,!0,r):(o||delete r.z,r)}var ye=ie("WGS84");function me(e,t,r,n){var i,o,a;return Array.isArray(r)?(i=ge(e,t,r,n)||{x:NaN,y:NaN},r.length>2?void 0!==e.name&&"geocent"===e.name||void 0!==t.name&&"geocent"===t.name?"number"==typeof i.z?[i.x,i.y,i.z].concat(r.splice(3)):[i.x,i.y,r[2]].concat(r.splice(3)):[i.x,i.y].concat(r.splice(2)):[i.x,i.y]):(o=ge(e,t,r,n),2===(a=Object.keys(r)).length||a.forEach((function(n){if(void 0!==e.name&&"geocent"===e.name||void 0!==t.name&&"geocent"===t.name){if("x"===n||"y"===n||"z"===n)return}else if("x"===n||"y"===n)return;o[n]=r[n]})),o)}function ve(e){return e instanceof ie?e:e.oProj?e.oProj:ie(e)}const _e=function(e,t,r){e=ve(e);var n,i=!1;return void 0===t?(t=e,e=ye,i=!0):(void 0!==t.x||Array.isArray(t))&&(r=t,t=e,e=ye,i=!0),t=ve(t),r?me(e,t,r):(n={forward:function(r,n){return me(e,t,r,n)},inverse:function(r,n){return me(t,e,r,n)}},i&&(n.oProj=t),n)};var we="AJSAJS",Se="AFAFAF",Ee=65,be=73,Ce=79,Le=86,Te=90;const Ae={forward:xe,inverse:function(e){var t=Re(Ne(e.toUpperCase()));if(t.lat&&t.lon)return[t.lon,t.lat,t.lon,t.lat];return[t.left,t.bottom,t.right,t.top]},toPoint:Pe};function xe(e,t){return t=t||5,function(e,t){var r="00000"+e.easting,n="00000"+e.northing;return e.zoneNumber+e.zoneLetter+(d=e.easting,f=e.northing,g=e.zoneNumber,y=De(g),m=Math.floor(d/1e5),v=Math.floor(f/1e5)%20,i=m,o=v,a=y,s=a-1,l=we.charCodeAt(s),c=Se.charCodeAt(s),u=l+i-1,p=c+o,h=!1,u>Te&&(u=u-Te+Ee-1,h=!0),(u===be||l<be&&u>be||(u>be||l<be)&&h)&&u++,(u===Ce||l<Ce&&u>Ce||(u>Ce||l<Ce)&&h)&&++u===be&&u++,u>Te&&(u=u-Te+Ee-1),p>Le?(p=p-Le+Ee-1,h=!0):h=!1,(p===be||c<be&&p>be||(p>be||c<be)&&h)&&p++,(p===Ce||c<Ce&&p>Ce||(p>Ce||c<Ce)&&h)&&++p===be&&p++,p>Le&&(p=p-Le+Ee-1),String.fromCharCode(u)+String.fromCharCode(p))+r.substr(r.length-5,t)+n.substr(n.length-5,t);var i,o,a,s,l,c,u,p,h;var d,f,g,y,m,v}(function(e){var t,r,n,i,o,a,s,l,c=e.lat,u=e.lon,p=6378137,h=.00669438,d=.9996,f=Oe(c),g=Oe(u);l=Math.floor((u+180)/6)+1,180===u&&(l=60);c>=56&&c<64&&u>=3&&u<12&&(l=32);c>=72&&c<84&&(u>=0&&u<9?l=31:u>=9&&u<21?l=33:u>=21&&u<33?l=35:u>=33&&u<42&&(l=37));s=Oe(6*(l-1)-180+3),t=h/(1-h),r=p/Math.sqrt(1-h*Math.sin(f)*Math.sin(f)),n=Math.tan(f)*Math.tan(f),i=t*Math.cos(f)*Math.cos(f),o=Math.cos(f)*(g-s),a=p*((1-h/4-3*h*h/64-5*h*h*h/256)*f-(3*h/8+3*h*h/32+45*h*h*h/1024)*Math.sin(2*f)+(15*h*h/256+45*h*h*h/1024)*Math.sin(4*f)-35*h*h*h/3072*Math.sin(6*f));var y=d*r*(o+(1-n+i)*o*o*o/6+(5-18*n+n*n+72*i-58*t)*o*o*o*o*o/120)+5e5,m=d*(a+r*Math.tan(f)*(o*o/2+(5-n+9*i+4*i*i)*o*o*o*o/24+(61-58*n+n*n+600*i-330*t)*o*o*o*o*o*o/720));c<0&&(m+=1e7);return{northing:Math.round(m),easting:Math.round(y),zoneNumber:l,zoneLetter:Me(c)}}({lat:e[1],lon:e[0]}),t)}function Pe(e){var t=Re(Ne(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function Oe(e){return e*(Math.PI/180)}function Ie(e){return e/Math.PI*180}function Re(e){var t=e.northing,r=e.easting,n=e.zoneLetter,i=e.zoneNumber;if(i<0||i>60)return null;var o,a,s,l,c,u,p,h,d,f=.9996,g=6378137,y=.00669438,m=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),v=r-5e5,_=t;n<"N"&&(_-=1e7),p=6*(i-1)-180+3,o=.006739496752268451,d=(h=_/f/6367449.145945056)+(3*m/2-27*m*m*m/32)*Math.sin(2*h)+(21*m*m/16-55*m*m*m*m/32)*Math.sin(4*h)+151*m*m*m/96*Math.sin(6*h),a=g/Math.sqrt(1-y*Math.sin(d)*Math.sin(d)),s=Math.tan(d)*Math.tan(d),l=o*Math.cos(d)*Math.cos(d),c=.99330562*g/Math.pow(1-y*Math.sin(d)*Math.sin(d),1.5),u=v/(a*f);var w=d-a*Math.tan(d)/c*(u*u/2-(5+3*s+10*l-4*l*l-9*o)*u*u*u*u/24+(61+90*s+298*l+45*s*s-1.6983531815716497-3*l*l)*u*u*u*u*u*u/720);w=Ie(w);var S,E=(u-(1+2*s+l)*u*u*u/6+(5-2*l+28*s-3*l*l+8*o+24*s*s)*u*u*u*u*u/120)/Math.cos(d);if(E=p+Ie(E),e.accuracy){var b=Re({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});S={top:b.lat,right:b.lon,bottom:w,left:E}}else S={lat:w,lon:E};return S}function Me(e){var t="Z";return 84>=e&&e>=72?t="X":72>e&&e>=64?t="W":64>e&&e>=56?t="V":56>e&&e>=48?t="U":48>e&&e>=40?t="T":40>e&&e>=32?t="S":32>e&&e>=24?t="R":24>e&&e>=16?t="Q":16>e&&e>=8?t="P":8>e&&e>=0?t="N":0>e&&e>=-8?t="M":-8>e&&e>=-16?t="L":-16>e&&e>=-24?t="K":-24>e&&e>=-32?t="J":-32>e&&e>=-40?t="H":-40>e&&e>=-48?t="G":-48>e&&e>=-56?t="F":-56>e&&e>=-64?t="E":-64>e&&e>=-72?t="D":-72>e&&e>=-80&&(t="C"),t}function De(e){var t=e%6;return 0===t&&(t=6),t}function Ne(e){if(e&&0===e.length)throw"MGRSPoint coverting from nothing";for(var t,r=e.length,n=null,i="",o=0;!/[A-Z]/.test(t=e.charAt(o));){if(o>=2)throw"MGRSPoint bad conversion from: "+e;i+=t,o++}var a=parseInt(i,10);if(0===o||o+3>r)throw"MGRSPoint bad conversion from: "+e;var s=e.charAt(o++);if(s<="A"||"B"===s||"Y"===s||s>="Z"||"I"===s||"O"===s)throw"MGRSPoint zone letter "+s+" not handled: "+e;n=e.substring(o,o+=2);for(var l=De(a),c=function(e,t){var r=we.charCodeAt(t-1),n=1e5,i=!1;for(;r!==e.charCodeAt(0);){if(++r===be&&r++,r===Ce&&r++,r>Te){if(i)throw"Bad character: "+e;r=Ee,i=!0}n+=1e5}return n}(n.charAt(0),l),u=function(e,t){if(e>"V")throw"MGRSPoint given invalid Northing "+e;var r=Se.charCodeAt(t-1),n=0,i=!1;for(;r!==e.charCodeAt(0);){if(++r===be&&r++,r===Ce&&r++,r>Le){if(i)throw"Bad character: "+e;r=Ee,i=!0}n+=1e5}return n}(n.charAt(1),l);u<Ze(s);)u+=2e6;var p=r-o;if(p%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+e;var h,d,f,g=p/2,y=0,m=0;return g>0&&(h=1e5/Math.pow(10,g),d=e.substring(o,o+g),y=parseFloat(d)*h,f=e.substring(o+g),m=parseFloat(f)*h),{easting:y+c,northing:m+u,zoneLetter:s,zoneNumber:a,accuracy:h}}function Ze(e){var t;switch(e){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+e}function ke(e,t,r){if(!(this instanceof ke))return new ke(e,t,r);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if("object"==typeof e)this.x=e.x,this.y=e.y,this.z=e.z||0;else if("string"==typeof e&&void 0===t){var n=e.split(",");this.x=parseFloat(n[0],10),this.y=parseFloat(n[1],10),this.z=parseFloat(n[2],10)||0}else this.x=e,this.y=t,this.z=r||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}ke.fromMGRS=function(e){return new ke(Pe(e))},ke.prototype.toMGRS=function(e){return xe([this.x,this.y],e)};const Fe=ke;var Ue=.046875,Be=.01953125,Ge=.01068115234375;function je(e){var t=[];t[0]=1-e*(.25+e*(Ue+e*(Be+e*Ge))),t[1]=e*(.75-e*(Ue+e*(Be+e*Ge)));var r=e*e;return t[2]=r*(.46875-e*(.013020833333333334+.007120768229166667*e)),r*=e,t[3]=r*(.3645833333333333-.005696614583333333*e),t[4]=r*e*.3076171875,t}function We(e,t,r,n){return r*=t,t*=t,n[0]*e-r*(n[1]+t*(n[2]+t*(n[3]+t*n[4])))}function He(e,t,r){for(var n=1/(1-t),i=e,o=20;o;--o){var a=Math.sin(i),l=1-t*a*a;if(i-=l=(We(i,a,Math.cos(i),r)-e)*(l*Math.sqrt(l))*n,Math.abs(l)<s)return i}return i}const qe={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=je(this.es),this.ml0=We(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(e){var t,r,n,i=e.x,o=e.y,a=k(i-this.long0),l=Math.sin(o),c=Math.cos(o);if(this.es){var u=c*a,p=Math.pow(u,2),h=this.ep2*Math.pow(c,2),d=Math.pow(h,2),f=Math.abs(c)>s?Math.tan(o):0,g=Math.pow(f,2),y=Math.pow(g,2);t=1-this.es*Math.pow(l,2),u/=Math.sqrt(t);var m=We(o,l,c,this.en);r=this.a*(this.k0*u*(1+p/6*(1-g+h+p/20*(5-18*g+y+14*h-58*g*h+p/42*(61+179*y-y*g-479*g)))))+this.x0,n=this.a*(this.k0*(m-this.ml0+l*a*u/2*(1+p/12*(5-g+9*h+4*d+p/30*(61+y-58*g+270*h-330*g*h+p/56*(1385+543*y-y*g-3111*g))))))+this.y0}else{var v=c*Math.sin(a);if(Math.abs(Math.abs(v)-1)<s)return 93;if(r=.5*this.a*this.k0*Math.log((1+v)/(1-v))+this.x0,n=c*Math.cos(a)/Math.sqrt(1-Math.pow(v,2)),(v=Math.abs(n))>=1){if(v-1>s)return 93;n=0}else n=Math.acos(n);o<0&&(n=-n),n=this.a*this.k0*(n-this.lat0)+this.y0}return e.x=r,e.y=n,e},inverse:function(e){var t,r,n,i,o=(e.x-this.x0)*(1/this.a),l=(e.y-this.y0)*(1/this.a);if(this.es)if(r=He(t=this.ml0+l/this.k0,this.es,this.en),Math.abs(r)<a){var c=Math.sin(r),u=Math.cos(r),p=Math.abs(u)>s?Math.tan(r):0,h=this.ep2*Math.pow(u,2),d=Math.pow(h,2),f=Math.pow(p,2),g=Math.pow(f,2);t=1-this.es*Math.pow(c,2);var y=o*Math.sqrt(t)/this.k0,m=Math.pow(y,2);n=r-(t*=p)*m/(1-this.es)*.5*(1-m/12*(5+3*f-9*h*f+h-4*d-m/30*(61+90*f-252*h*f+45*g+46*h-m/56*(1385+3633*f+4095*g+1574*g*f)))),i=k(this.long0+y*(1-m/6*(1+2*f+h-m/20*(5+28*f+24*g+8*h*f+6*h-m/42*(61+662*f+1320*g+720*g*f))))/u)}else n=a*Z(l),i=0;else{var v=Math.exp(o/this.k0),_=.5*(v-1/v),w=this.lat0+l/this.k0,S=Math.cos(w);t=Math.sqrt((1-Math.pow(S,2))/(1+Math.pow(_,2))),n=Math.asin(t),l<0&&(n=-n),i=0===_&&0===S?0:k(Math.atan2(_,S)+this.long0)}return e.x=i,e.y=n,e},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]};function Ve(e){var t=Math.exp(e);return t=(t-1/t)/2}function ze(e,t){e=Math.abs(e),t=Math.abs(t);var r=Math.max(e,t),n=Math.min(e,t)/(r||1);return r*Math.sqrt(1+Math.pow(n,2))}function Ye(e){var t=Math.abs(e);return t=function(e){var t=1+e,r=t-1;return 0===r?e:e*Math.log(t)/r}(t*(1+t/(ze(1,t)+1))),e<0?-t:t}function Ke(e,t){for(var r,n=2*Math.cos(2*t),i=e.length-1,o=e[i],a=0;--i>=0;)r=n*o-a+e[i],a=o,o=r;return t+r*Math.sin(2*t)}function Xe(e,t,r){for(var n,i,o=Math.sin(t),a=Math.cos(t),s=Ve(r),l=function(e){var t=Math.exp(e);return(t+1/t)/2}(r),c=2*a*l,u=-2*o*s,p=e.length-1,h=e[p],d=0,f=0,g=0;--p>=0;)n=f,i=d,h=c*(f=h)-n-u*(d=g)+e[p],g=u*f-i+c*d;return[(c=o*l)*h-(u=a*s)*g,c*g+u*h]}const $e={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(qe.init.apply(this),this.forward=qe.forward,this.inverse=qe.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var e=this.es/(1+Math.sqrt(1-this.es)),t=e/(2-e),r=t;this.cgb[0]=t*(2+t*(-2/3+t*(t*(116/45+t*(26/45+t*(-2854/675)))-2))),this.cbg[0]=t*(t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))-2),r*=t,this.cgb[1]=r*(7/3+t*(t*(-227/45+t*(2704/315+t*(2323/945)))-1.6)),this.cbg[1]=r*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),r*=t,this.cgb[2]=r*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=r*(-26/15+t*(34/21+t*(1.6+t*(-12686/2835)))),r*=t,this.cgb[3]=r*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=r*(1237/630+t*(t*(-24832/14175)-2.4)),r*=t,this.cgb[4]=r*(4174/315+t*(-144838/6237)),this.cbg[4]=r*(-734/315+t*(109598/31185)),r*=t,this.cgb[5]=r*(601676/22275),this.cbg[5]=r*(444337/155925),r=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+r*(1/4+r*(1/64+r/256))),this.utg[0]=t*(t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))-.5),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=r*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=r*(13/48+t*(t*(557/1440+t*(281/630+t*(-1983433/1935360)))-.6)),r*=t,this.utg[2]=r*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=r*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),r*=t,this.utg[3]=r*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=r*(49561/161280+t*(-179/168+t*(6601661/7257600))),r*=t,this.utg[4]=r*(-4583/161280+t*(108847/3991680)),this.gtu[4]=r*(34729/80640+t*(-3418889/1995840)),r*=t,this.utg[5]=r*(-20648693/638668800),this.gtu[5]=.6650675310896665*r;var n=Ke(this.cbg,this.lat0);this.Zb=-this.Qn*(n+function(e,t){for(var r,n=2*Math.cos(t),i=e.length-1,o=e[i],a=0;--i>=0;)r=n*o-a+e[i],a=o,o=r;return Math.sin(t)*r}(this.gtu,2*n))},forward:function(e){var t=k(e.x-this.long0),r=e.y;r=Ke(this.cbg,r);var n=Math.sin(r),i=Math.cos(r),o=Math.sin(t),a=Math.cos(t);r=Math.atan2(n,a*i),t=Math.atan2(o*i,ze(n,i*a)),t=Ye(Math.tan(t));var s,l,c=Xe(this.gtu,2*r,2*t);return r+=c[0],t+=c[1],Math.abs(t)<=2.623395162778?(s=this.a*(this.Qn*t)+this.x0,l=this.a*(this.Qn*r+this.Zb)+this.y0):(s=1/0,l=1/0),e.x=s,e.y=l,e},inverse:function(e){var t,r,n=(e.x-this.x0)*(1/this.a),i=(e.y-this.y0)*(1/this.a);if(i=(i-this.Zb)/this.Qn,n/=this.Qn,Math.abs(n)<=2.623395162778){var o=Xe(this.utg,2*i,2*n);i+=o[0],n+=o[1],n=Math.atan(Ve(n));var a=Math.sin(i),s=Math.cos(i),l=Math.sin(n),c=Math.cos(n);i=Math.atan2(a*c,ze(l,c*s)),t=k((n=Math.atan2(l,c*s))+this.long0),r=Ke(this.cgb,i)}else t=1/0,r=1/0;return e.x=t,e.y=r,e},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"]};const Je={init:function(){var e=function(e,t){if(void 0===e){if((e=Math.floor(30*(k(t)+Math.PI)/Math.PI)+1)<0)return 0;if(e>60)return 60}return e}(this.zone,this.long0);if(void 0===e)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(e)-183)*l,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,$e.init.apply(this),this.forward=$e.forward,this.inverse=$e.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};function Qe(e,t){return Math.pow((1-e)/(1+e),t)}const et={init:function(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+u)/(Math.pow(Math.tan(.5*this.lat0+u),this.C)*Qe(this.e*e,this.ratexp))},forward:function(e){var t=e.x,r=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*r+u),this.C)*Qe(this.e*Math.sin(r),this.ratexp))-a,e.x=this.C*t,e},inverse:function(e){for(var t=e.x/this.C,r=e.y,n=Math.pow(Math.tan(.5*r+u)/this.K,1/this.C),i=20;i>0&&(r=2*Math.atan(n*Qe(this.e*Math.sin(e.y),-.5*this.e))-a,!(Math.abs(r-e.y)<1e-14));--i)e.y=r;return i?(e.x=t,e.y=r,e):null},names:["gauss"]};const tt={init:function(){et.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(e){var t,r,n,i;return e.x=k(e.x-this.long0),et.forward.apply(this,[e]),t=Math.sin(e.y),r=Math.cos(e.y),n=Math.cos(e.x),i=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*r*n),e.x=i*r*Math.sin(e.x),e.y=i*(this.cosc0*t-this.sinc0*r*n),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e},inverse:function(e){var t,r,n,i,o;if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,o=Math.sqrt(e.x*e.x+e.y*e.y)){var a=2*Math.atan2(o,this.R2);t=Math.sin(a),r=Math.cos(a),i=Math.asin(r*this.sinc0+e.y*t*this.cosc0/o),n=Math.atan2(e.x*t,o*this.cosc0*r-e.y*this.sinc0*t)}else i=this.phic0,n=0;return e.x=n,e.y=i,et.inverse.apply(this,[e]),e.x=k(e.x+this.long0),e},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]};const rt={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=s&&(this.k0=.5*(1+Z(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=s&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=s&&(this.k0=.5*this.cons*N(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/F(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=N(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-a,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(e){var t,r,n,i,o,l,c=e.x,u=e.y,p=Math.sin(u),h=Math.cos(u),d=k(c-this.long0);return Math.abs(Math.abs(c-this.long0)-Math.PI)<=s&&Math.abs(u+this.lat0)<=s?(e.x=NaN,e.y=NaN,e):this.sphere?(t=2*this.k0/(1+this.sinlat0*p+this.coslat0*h*Math.cos(d)),e.x=this.a*t*h*Math.sin(d)+this.x0,e.y=this.a*t*(this.coslat0*p-this.sinlat0*h*Math.cos(d))+this.y0,e):(r=2*Math.atan(this.ssfn_(u,p,this.e))-a,i=Math.cos(r),n=Math.sin(r),Math.abs(this.coslat0)<=s?(o=F(this.e,u*this.con,this.con*p),l=2*this.a*this.k0*o/this.cons,e.x=this.x0+l*Math.sin(c-this.long0),e.y=this.y0-this.con*l*Math.cos(c-this.long0),e):(Math.abs(this.sinlat0)<s?(t=2*this.a*this.k0/(1+i*Math.cos(d)),e.y=t*n):(t=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*n+this.cosX0*i*Math.cos(d))),e.y=t*(this.cosX0*n-this.sinX0*i*Math.cos(d))+this.y0),e.x=t*i*Math.sin(d)+this.x0,e))},inverse:function(e){var t,r,n,i,o;e.x-=this.x0,e.y-=this.y0;var l=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var c=2*Math.atan(l/(2*this.a*this.k0));return t=this.long0,r=this.lat0,l<=s?(e.x=t,e.y=r,e):(r=Math.asin(Math.cos(c)*this.sinlat0+e.y*Math.sin(c)*this.coslat0/l),t=Math.abs(this.coslat0)<s?this.lat0>0?k(this.long0+Math.atan2(e.x,-1*e.y)):k(this.long0+Math.atan2(e.x,e.y)):k(this.long0+Math.atan2(e.x*Math.sin(c),l*this.coslat0*Math.cos(c)-e.y*this.sinlat0*Math.sin(c))),e.x=t,e.y=r,e)}if(Math.abs(this.coslat0)<=s){if(l<=s)return r=this.lat0,t=this.long0,e.x=t,e.y=r,e;e.x*=this.con,e.y*=this.con,n=l*this.cons/(2*this.a*this.k0),r=this.con*U(this.e,n),t=this.con*k(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else i=2*Math.atan(l*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,l<=s?o=this.X0:(o=Math.asin(Math.cos(i)*this.sinX0+e.y*Math.sin(i)*this.cosX0/l),t=k(this.long0+Math.atan2(e.x*Math.sin(i),l*this.cosX0*Math.cos(i)-e.y*this.sinX0*Math.sin(i)))),r=-1*U(this.e,Math.tan(.5*(a+o)));return e.x=t,e.y=r,e},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(e,t,r){return t*=r,Math.tan(.5*(a+e))*Math.pow((1-t)/(1+t),.5*r)}};const nt={init:function(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),r=this.a,n=1/this.rf,i=2*n-Math.pow(n,2),o=this.e=Math.sqrt(i);this.R=this.k0*r*Math.sqrt(1-i)/(1-i*Math.pow(t,2)),this.alpha=Math.sqrt(1+i/(1-i)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),s=Math.log(Math.tan(Math.PI/4+e/2)),l=Math.log((1+o*t)/(1-o*t));this.K=a-this.alpha*s+this.alpha*o/2*l},forward:function(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),r=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),n=-this.alpha*(t+r)+this.K,i=2*(Math.atan(Math.exp(n))-Math.PI/4),o=this.alpha*(e.x-this.lambda0),a=Math.atan(Math.sin(o)/(Math.sin(this.b0)*Math.tan(i)+Math.cos(this.b0)*Math.cos(o))),s=Math.asin(Math.cos(this.b0)*Math.sin(i)-Math.sin(this.b0)*Math.cos(i)*Math.cos(o));return e.y=this.R/2*Math.log((1+Math.sin(s))/(1-Math.sin(s)))+this.y0,e.x=this.R*a+this.x0,e},inverse:function(e){for(var t=e.x-this.x0,r=e.y-this.y0,n=t/this.R,i=2*(Math.atan(Math.exp(r/this.R))-Math.PI/4),o=Math.asin(Math.cos(this.b0)*Math.sin(i)+Math.sin(this.b0)*Math.cos(i)*Math.cos(n)),a=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(i))),s=this.lambda0+a/this.alpha,l=0,c=o,u=-1e3,p=0;Math.abs(c-u)>1e-7;){if(++p>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+o/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2)),u=c,c=2*Math.atan(Math.exp(l))-Math.PI/2}return e.x=s,e.y=c,e},names:["somerc"]};var it=1e-7;const ot={init:function(){var e,t,r,n,i,o,c,h,d,f,g,y,m,v=0,_=0,w=0,S=0,E=0,b=0,C=0;this.no_off=(m="object"==typeof(y=this).PROJECTION?Object.keys(y.PROJECTION)[0]:y.PROJECTION,"no_uoff"in y||"no_off"in y||-1!==["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"].indexOf(m)),this.no_rot="no_rot"in this;var L=!1;"alpha"in this&&(L=!0);var T=!1;if("rectified_grid_angle"in this&&(T=!0),L&&(C=this.alpha),T&&(v=this.rectified_grid_angle*l),L||T)_=this.longc;else if(w=this.long1,E=this.lat1,S=this.long2,b=this.lat2,Math.abs(E-b)<=it||(e=Math.abs(E))<=it||Math.abs(e-a)<=it||Math.abs(Math.abs(this.lat0)-a)<=it||Math.abs(Math.abs(b)-a)<=it)throw new Error;var A=1-this.es;t=Math.sqrt(A),Math.abs(this.lat0)>s?(h=Math.sin(this.lat0),r=Math.cos(this.lat0),e=1-this.es*h*h,this.B=r*r,this.B=Math.sqrt(1+this.es*this.B*this.B/A),this.A=this.B*this.k0*t/e,(i=(n=this.B*t/(r*Math.sqrt(e)))*n-1)<=0?i=0:(i=Math.sqrt(i),this.lat0<0&&(i=-i)),this.E=i+=n,this.E*=Math.pow(F(this.e,this.lat0,h),this.B)):(this.B=1/t,this.A=this.k0,this.E=n=i=1),L||T?(L?(g=Math.asin(Math.sin(C)/n),T||(v=C)):(g=v,C=Math.asin(n*Math.sin(g))),this.lam0=_-Math.asin(.5*(i-1/i)*Math.tan(g))/this.B):(o=Math.pow(F(this.e,E,Math.sin(E)),this.B),c=Math.pow(F(this.e,b,Math.sin(b)),this.B),i=this.E/o,d=(c-o)/(c+o),f=((f=this.E*this.E)-c*o)/(f+c*o),(e=w-S)<-Math.pi?S-=p:e>Math.pi&&(S+=p),this.lam0=k(.5*(w+S)-Math.atan(f*Math.tan(.5*this.B*(w-S))/d)/this.B),g=Math.atan(2*Math.sin(this.B*k(w-this.lam0))/(i-1/i)),v=C=Math.asin(n*Math.sin(g))),this.singam=Math.sin(g),this.cosgam=Math.cos(g),this.sinrot=Math.sin(v),this.cosrot=Math.cos(v),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A,this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(n*n-1)/Math.cos(C))),this.lat0<0&&(this.u_0=-this.u_0)),i=.5*g,this.v_pole_n=this.ArB*Math.log(Math.tan(u-i)),this.v_pole_s=this.ArB*Math.log(Math.tan(u+i))},forward:function(e){var t,r,n,i,o,l,c,u,p={};if(e.x=e.x-this.lam0,Math.abs(Math.abs(e.y)-a)>s){if(t=.5*((o=this.E/Math.pow(F(this.e,e.y,Math.sin(e.y)),this.B))-(l=1/o)),r=.5*(o+l),i=Math.sin(this.B*e.x),n=(t*this.singam-i*this.cosgam)/r,Math.abs(Math.abs(n)-1)<s)throw new Error;u=.5*this.ArB*Math.log((1-n)/(1+n)),l=Math.cos(this.B*e.x),c=Math.abs(l)<it?this.A*e.x:this.ArB*Math.atan2(t*this.cosgam+i*this.singam,l)}else u=e.y>0?this.v_pole_n:this.v_pole_s,c=this.ArB*e.y;return this.no_rot?(p.x=c,p.y=u):(c-=this.u_0,p.x=u*this.cosrot+c*this.sinrot,p.y=c*this.cosrot-u*this.sinrot),p.x=this.a*p.x+this.x0,p.y=this.a*p.y+this.y0,p},inverse:function(e){var t,r,n,i,o,l,c,u={};if(e.x=(e.x-this.x0)*(1/this.a),e.y=(e.y-this.y0)*(1/this.a),this.no_rot?(r=e.y,t=e.x):(r=e.x*this.cosrot-e.y*this.sinrot,t=e.y*this.cosrot+e.x*this.sinrot+this.u_0),i=.5*((n=Math.exp(-this.BrA*r))-1/n),o=.5*(n+1/n),c=((l=Math.sin(this.BrA*t))*this.cosgam+i*this.singam)/o,Math.abs(Math.abs(c)-1)<s)u.x=0,u.y=c<0?-a:a;else{if(u.y=this.E/Math.sqrt((1+c)/(1-c)),u.y=U(this.e,Math.pow(u.y,1/this.B)),u.y===1/0)throw new Error;u.x=-this.rB*Math.atan2(i*this.cosgam-l*this.singam,Math.cos(this.BrA*t))}return u.x+=this.lam0,u},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]};const at={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<s)){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),r=Math.cos(this.lat1),n=N(this.e,t,r),i=F(this.e,this.lat1,t),o=Math.sin(this.lat2),a=Math.cos(this.lat2),l=N(this.e,o,a),c=F(this.e,this.lat2,o),u=F(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>s?this.ns=Math.log(n/l)/Math.log(i/c):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=n/(this.ns*Math.pow(i,this.ns)),this.rh=this.a*this.f0*Math.pow(u,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(e){var t=e.x,r=e.y;Math.abs(2*Math.abs(r)-Math.PI)<=s&&(r=Z(r)*(a-2e-10));var n,i,o=Math.abs(Math.abs(r)-a);if(o>s)n=F(this.e,r,Math.sin(r)),i=this.a*this.f0*Math.pow(n,this.ns);else{if((o=r*this.ns)<=0)return null;i=0}var l=this.ns*k(t-this.long0);return e.x=this.k0*(i*Math.sin(l))+this.x0,e.y=this.k0*(this.rh-i*Math.cos(l))+this.y0,e},inverse:function(e){var t,r,n,i,o,s=(e.x-this.x0)/this.k0,l=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(s*s+l*l),r=1):(t=-Math.sqrt(s*s+l*l),r=-1);var c=0;if(0!==t&&(c=Math.atan2(r*s,r*l)),0!==t||this.ns>0){if(r=1/this.ns,n=Math.pow(t/(this.a*this.f0),r),-9999===(i=U(this.e,n)))return null}else i=-a;return o=k(c/this.ns+this.long0),e.x=o,e.y=i,e},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"]};const st={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(e){var t,r,n,i,o,a,s,l=e.x,c=e.y,u=k(l-this.long0);return t=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),r=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/t)-this.s45),n=-u*this.alfa,i=Math.asin(Math.cos(this.ad)*Math.sin(r)+Math.sin(this.ad)*Math.cos(r)*Math.cos(n)),o=Math.asin(Math.cos(r)*Math.sin(n)/Math.cos(i)),a=this.n*o,s=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(i/2+this.s45),this.n),e.y=s*Math.cos(a)/1,e.x=s*Math.sin(a)/1,this.czech||(e.y*=-1,e.x*=-1),e},inverse:function(e){var t,r,n,i,o,a,s,l=e.x;e.x=e.y,e.y=l,this.czech||(e.y*=-1,e.x*=-1),o=Math.sqrt(e.x*e.x+e.y*e.y),i=Math.atan2(e.y,e.x)/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(i)),r=Math.asin(Math.cos(n)*Math.sin(i)/Math.cos(t)),e.x=this.long0-r/this.alfa,a=t,s=0;var c=0;do{e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-e.y)<1e-10&&(s=1),a=e.y,c+=1}while(0===s&&c<15);return c>=15?null:e},names:["Krovak","krovak"]};function lt(e,t,r,n,i){return e*i-t*Math.sin(2*i)+r*Math.sin(4*i)-n*Math.sin(6*i)}function ct(e){return 1-.25*e*(1+e/16*(3+1.25*e))}function ut(e){return.375*e*(1+.25*e*(1+.46875*e))}function pt(e){return.05859375*e*e*(1+.75*e)}function ht(e){return e*e*e*(35/3072)}function dt(e,t,r){var n=t*r;return e/Math.sqrt(1-n*n)}function ft(e){return Math.abs(e)<a?e:e-Z(e)*Math.PI}function gt(e,t,r,n,i){var o,a;o=e/t;for(var s=0;s<15;s++)if(o+=a=(e-(t*o-r*Math.sin(2*o)+n*Math.sin(4*o)-i*Math.sin(6*o)))/(t-2*r*Math.cos(2*o)+4*n*Math.cos(4*o)-6*i*Math.cos(6*o)),Math.abs(a)<=1e-10)return o;return NaN}const yt={init:function(){this.sphere||(this.e0=ct(this.es),this.e1=ut(this.es),this.e2=pt(this.es),this.e3=ht(this.es),this.ml0=this.a*lt(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(e){var t,r,n=e.x,i=e.y;if(n=k(n-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(i)*Math.sin(n)),r=this.a*(Math.atan2(Math.tan(i),Math.cos(n))-this.lat0);else{var o=Math.sin(i),a=Math.cos(i),s=dt(this.a,this.e,o),l=Math.tan(i)*Math.tan(i),c=n*Math.cos(i),u=c*c,p=this.es*a*a/(1-this.es);t=s*c*(1-u*l*(1/6-(8-l+8*p)*u/120)),r=this.a*lt(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+s*o/a*u*(.5+(5-l+6*p)*u/24)}return e.x=t+this.x0,e.y=r+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,r,n=e.x/this.a,i=e.y/this.a;if(this.sphere){var o=i+this.lat0;t=Math.asin(Math.sin(o)*Math.cos(n)),r=Math.atan2(Math.tan(n),Math.cos(o))}else{var l=gt(this.ml0/this.a+i,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(l)-a)<=s)return e.x=this.long0,e.y=a,i<0&&(e.y*=-1),e;var c=dt(this.a,this.e,Math.sin(l)),u=c*c*c/this.a/this.a*(1-this.es),p=Math.pow(Math.tan(l),2),h=n*this.a/c,d=h*h;t=l-c*Math.tan(l)/u*h*h*(.5-(1+3*p)*h*h/24),r=h*(1-d*(p/3+(1+3*p)*p*d/15))/Math.cos(l)}return e.x=k(r+this.long0),e.y=ft(t),e},names:["Cassini","Cassini_Soldner","cass"]};function mt(e,t){var r;return e>1e-7?(1-e*e)*(t/(1-(r=e*t)*r)-.5/e*Math.log((1-r)/(1+r))):2*t}var vt=.3333333333333333,_t=.17222222222222222,wt=.10257936507936508,St=.06388888888888888,Et=.0664021164021164,bt=.016415012942191543;const Ct={init:function(){var e,t=Math.abs(this.lat0);if(Math.abs(t-a)<s?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<s?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=mt(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(e){var t,r=[];return r[0]=e*vt,t=e*e,r[0]+=t*_t,r[1]=t*St,t*=e,r[0]+=t*wt,r[1]+=t*Et,r[2]=t*bt,r}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=mt(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(e){var t,r,n,i,o,l,c,p,h,d,f=e.x,g=e.y;if(f=k(f-this.long0),this.sphere){if(o=Math.sin(g),d=Math.cos(g),n=Math.cos(f),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((r=this.mode===this.EQUIT?1+d*n:1+this.sinph0*o+this.cosph0*d*n)<=s)return null;t=(r=Math.sqrt(2/r))*d*Math.sin(f),r*=this.mode===this.EQUIT?o:this.cosph0*o-this.sinph0*d*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(g+this.lat0)<s)return null;r=u-.5*g,t=(r=2*(this.mode===this.S_POLE?Math.cos(r):Math.sin(r)))*Math.sin(f),r*=n}}else{switch(c=0,p=0,h=0,n=Math.cos(f),i=Math.sin(f),o=Math.sin(g),l=mt(this.e,o),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(c=l/this.qp,p=Math.sqrt(1-c*c)),this.mode){case this.OBLIQ:h=1+this.sinb1*c+this.cosb1*p*n;break;case this.EQUIT:h=1+p*n;break;case this.N_POLE:h=a+g,l=this.qp-l;break;case this.S_POLE:h=g-a,l=this.qp+l}if(Math.abs(h)<s)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:h=Math.sqrt(2/h),r=this.mode===this.OBLIQ?this.ymf*h*(this.cosb1*c-this.sinb1*p*n):(h=Math.sqrt(2/(1+p*n)))*c*this.ymf,t=this.xmf*h*p*i;break;case this.N_POLE:case this.S_POLE:l>=0?(t=(h=Math.sqrt(l))*i,r=n*(this.mode===this.S_POLE?h:-h)):t=r=0}}return e.x=this.a*t+this.x0,e.y=this.a*r+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,r,n,i,o,l,c,u,p,h,d=e.x/this.a,f=e.y/this.a;if(this.sphere){var g,y=0,m=0;if((r=.5*(g=Math.sqrt(d*d+f*f)))>1)return null;switch(r=2*Math.asin(r),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(m=Math.sin(r),y=Math.cos(r)),this.mode){case this.EQUIT:r=Math.abs(g)<=s?0:Math.asin(f*m/g),d*=m,f=y*g;break;case this.OBLIQ:r=Math.abs(g)<=s?this.lat0:Math.asin(y*this.sinph0+f*m*this.cosph0/g),d*=m*this.cosph0,f=(y-Math.sin(r)*this.sinph0)*g;break;case this.N_POLE:f=-f,r=a-r;break;case this.S_POLE:r-=a}t=0!==f||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(d,f):0}else{if(c=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(d/=this.dd,f*=this.dd,(l=Math.sqrt(d*d+f*f))<s)return e.x=this.long0,e.y=this.lat0,e;i=2*Math.asin(.5*l/this.rq),n=Math.cos(i),d*=i=Math.sin(i),this.mode===this.OBLIQ?(c=n*this.sinb1+f*i*this.cosb1/l,o=this.qp*c,f=l*this.cosb1*n-f*this.sinb1*i):(c=f*i/l,o=this.qp*c,f=l*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(f=-f),!(o=d*d+f*f))return e.x=this.long0,e.y=this.lat0,e;c=1-o/this.qp,this.mode===this.S_POLE&&(c=-c)}t=Math.atan2(d,f),u=Math.asin(c),p=this.apa,h=u+u,r=u+p[0]*Math.sin(h)+p[1]*Math.sin(h+h)+p[2]*Math.sin(h+h+h)}return e.x=k(this.long0+t),e.y=r,e},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};function Lt(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)}const Tt={init:function(){Math.abs(this.lat1+this.lat2)<s||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=N(this.e3,this.sin_po,this.cos_po),this.qs1=mt(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=N(this.e3,this.sin_po,this.cos_po),this.qs2=mt(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=mt(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>s?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(e){var t=e.x,r=e.y;this.sin_phi=Math.sin(r),this.cos_phi=Math.cos(r);var n=mt(this.e3,this.sin_phi),i=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,o=this.ns0*k(t-this.long0),a=i*Math.sin(o)+this.x0,s=this.rh-i*Math.cos(o)+this.y0;return e.x=a,e.y=s,e},inverse:function(e){var t,r,n,i,o,a;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(t=Math.sqrt(e.x*e.x+e.y*e.y),n=1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),n=-1),i=0,0!==t&&(i=Math.atan2(n*e.x,n*e.y)),n=t*this.ns0/this.a,this.sphere?a=Math.asin((this.c-n*n)/(2*this.ns0)):(r=(this.c-n*n)/this.ns0,a=this.phi1z(this.e3,r)),o=k(i/this.ns0+this.long0),e.x=o,e.y=a,e},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(e,t){var r,n,i,o,a=Lt(.5*t);if(e<s)return a;for(var l=e*e,c=1;c<=25;c++)if(a+=o=.5*(i=1-(n=e*(r=Math.sin(a)))*n)*i/Math.cos(a)*(t/(1-l)-r/i+.5/e*Math.log((1-n)/(1+n))),Math.abs(o)<=1e-7)return a;return null}};const At={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(e){var t,r,n,i,o,a,l,c=e.x,u=e.y;return n=k(c-this.long0),t=Math.sin(u),r=Math.cos(u),i=Math.cos(n),1,(o=this.sin_p14*t+this.cos_p14*r*i)>0||Math.abs(o)<=s?(a=this.x0+1*this.a*r*Math.sin(n)/o,l=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*r*i)/o):(a=this.x0+this.infinity_dist*r*Math.sin(n),l=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*r*i)),e.x=a,e.y=l,e},inverse:function(e){var t,r,n,i,o,a;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(t=Math.sqrt(e.x*e.x+e.y*e.y))?(i=Math.atan2(t,this.rc),r=Math.sin(i),a=Lt((n=Math.cos(i))*this.sin_p14+e.y*r*this.cos_p14/t),o=Math.atan2(e.x*r,t*this.cos_p14*n-e.y*this.sin_p14*r),o=k(this.long0+o)):(a=this.phic0,o=0),e.x=o,e.y=a,e},names:["gnom"]};const xt={init:function(){this.sphere||(this.k0=N(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(e){var t,r,n=e.x,i=e.y,o=k(n-this.long0);if(this.sphere)t=this.x0+this.a*o*Math.cos(this.lat_ts),r=this.y0+this.a*Math.sin(i)/Math.cos(this.lat_ts);else{var a=mt(this.e,Math.sin(i));t=this.x0+this.a*this.k0*o,r=this.y0+this.a*a*.5/this.k0}return e.x=t,e.y=r,e},inverse:function(e){var t,r;return e.x-=this.x0,e.y-=this.y0,this.sphere?(t=k(this.long0+e.x/this.a/Math.cos(this.lat_ts)),r=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(r=function(e,t){var r=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(t)-r)<1e-6)return t<0?-1*a:a;for(var n,i,o,s,l=Math.asin(.5*t),c=0;c<30;c++)if(i=Math.sin(l),o=Math.cos(l),s=e*i,l+=n=Math.pow(1-s*s,2)/(2*o)*(t/(1-e*e)-i/(1-s*s)+.5/e*Math.log((1-s)/(1+s))),Math.abs(n)<=1e-10)return l;return NaN}(this.e,2*e.y*this.k0/this.a),t=k(this.long0+e.x/(this.a*this.k0))),e.x=t,e.y=r,e},names:["cea"]};const Pt={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(e){var t=e.x,r=e.y,n=k(t-this.long0),i=ft(r-this.lat0);return e.x=this.x0+this.a*n*this.rc,e.y=this.y0+this.a*i,e},inverse:function(e){var t=e.x,r=e.y;return e.x=k(this.long0+(t-this.x0)/(this.a*this.rc)),e.y=ft(this.lat0+(r-this.y0)/this.a),e},names:["Equirectangular","Equidistant_Cylindrical","eqc"]};const Ot={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=ct(this.es),this.e1=ut(this.es),this.e2=pt(this.es),this.e3=ht(this.es),this.ml0=this.a*lt(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var t,r,n,i=e.x,o=e.y,a=k(i-this.long0);if(n=a*Math.sin(o),this.sphere)Math.abs(o)<=s?(t=this.a*a,r=-1*this.a*this.lat0):(t=this.a*Math.sin(n)/Math.tan(o),r=this.a*(ft(o-this.lat0)+(1-Math.cos(n))/Math.tan(o)));else if(Math.abs(o)<=s)t=this.a*a,r=-1*this.ml0;else{var l=dt(this.a,this.e,Math.sin(o))/Math.tan(o);t=l*Math.sin(n),r=this.a*lt(this.e0,this.e1,this.e2,this.e3,o)-this.ml0+l*(1-Math.cos(n))}return e.x=t+this.x0,e.y=r+this.y0,e},inverse:function(e){var t,r,n,i,o,a,l,c,u;if(n=e.x-this.x0,i=e.y-this.y0,this.sphere)if(Math.abs(i+this.a*this.lat0)<=s)t=k(n/this.a+this.long0),r=0;else{var p;for(a=this.lat0+i/this.a,l=n*n/this.a/this.a+a*a,c=a,o=20;o;--o)if(c+=u=-1*(a*(c*(p=Math.tan(c))+1)-c-.5*(c*c+l)*p)/((c-a)/p-1),Math.abs(u)<=s){r=c;break}t=k(this.long0+Math.asin(n*Math.tan(c)/this.a)/Math.sin(r))}else if(Math.abs(i+this.ml0)<=s)r=0,t=k(this.long0+n/this.a);else{var h,d,f,g,y;for(a=(this.ml0+i)/this.a,l=n*n/this.a/this.a+a*a,c=a,o=20;o;--o)if(y=this.e*Math.sin(c),h=Math.sqrt(1-y*y)*Math.tan(c),d=this.a*lt(this.e0,this.e1,this.e2,this.e3,c),f=this.e0-2*this.e1*Math.cos(2*c)+4*this.e2*Math.cos(4*c)-6*this.e3*Math.cos(6*c),c-=u=(a*(h*(g=d/this.a)+1)-g-.5*h*(g*g+l))/(this.es*Math.sin(2*c)*(g*g+l-2*a*g)/(4*h)+(a-g)*(h*f-2/Math.sin(2*c))-f),Math.abs(u)<=s){r=c;break}h=Math.sqrt(1-this.es*Math.pow(Math.sin(r),2))*Math.tan(r),t=k(this.long0+Math.asin(n*h/this.a)/Math.sin(r))}return e.x=t,e.y=r,e},names:["Polyconic","poly"]};const It={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(e){var t,r=e.x,n=e.y-this.lat0,i=r-this.long0,a=n/o*1e-5,s=i,l=1,c=0;for(t=1;t<=10;t++)l*=a,c+=this.A[t]*l;var u,p=c,h=s,d=1,f=0,g=0,y=0;for(t=1;t<=6;t++)u=f*p+d*h,d=d*p-f*h,f=u,g=g+this.B_re[t]*d-this.B_im[t]*f,y=y+this.B_im[t]*d+this.B_re[t]*f;return e.x=y*this.a+this.x0,e.y=g*this.a+this.y0,e},inverse:function(e){var t,r,n=e.x,i=e.y,a=n-this.x0,s=(i-this.y0)/this.a,l=a/this.a,c=1,u=0,p=0,h=0;for(t=1;t<=6;t++)r=u*s+c*l,c=c*s-u*l,u=r,p=p+this.C_re[t]*c-this.C_im[t]*u,h=h+this.C_im[t]*c+this.C_re[t]*u;for(var d=0;d<this.iterations;d++){var f,g=p,y=h,m=s,v=l;for(t=2;t<=6;t++)f=y*p+g*h,g=g*p-y*h,y=f,m+=(t-1)*(this.B_re[t]*g-this.B_im[t]*y),v+=(t-1)*(this.B_im[t]*g+this.B_re[t]*y);g=1,y=0;var _=this.B_re[1],w=this.B_im[1];for(t=2;t<=6;t++)f=y*p+g*h,g=g*p-y*h,y=f,_+=t*(this.B_re[t]*g-this.B_im[t]*y),w+=t*(this.B_im[t]*g+this.B_re[t]*y);var S=_*_+w*w;p=(m*_+v*w)/S,h=(v*_-m*w)/S}var E=p,b=h,C=1,L=0;for(t=1;t<=9;t++)C*=E,L+=this.D[t]*C;var T=this.lat0+L*o*1e5,A=this.long0+b;return e.x=A,e.y=T,e},names:["New_Zealand_Map_Grid","nzmg"]};const Rt={init:function(){},forward:function(e){var t=e.x,r=e.y,n=k(t-this.long0),i=this.x0+this.a*n,o=this.y0+this.a*Math.log(Math.tan(Math.PI/4+r/2.5))*1.25;return e.x=i,e.y=o,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=k(this.long0+e.x/this.a),r=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=t,e.y=r,e},names:["Miller_Cylindrical","mill"]};const Mt={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=je(this.es)},forward:function(e){var t,r,n=e.x,i=e.y;if(n=k(n-this.long0),this.sphere){if(this.m)for(var o=this.n*Math.sin(i),a=20;a;--a){var l=(this.m*i+Math.sin(i)-o)/(this.m+Math.cos(i));if(i-=l,Math.abs(l)<s)break}else i=1!==this.n?Math.asin(this.n*Math.sin(i)):i;t=this.a*this.C_x*n*(this.m+Math.cos(i)),r=this.a*this.C_y*i}else{var c=Math.sin(i),u=Math.cos(i);r=this.a*We(i,c,u,this.en),t=this.a*n*u/Math.sqrt(1-this.es*c*c)}return e.x=t,e.y=r,e},inverse:function(e){var t,r,n;return e.x-=this.x0,r=e.x/this.a,e.y-=this.y0,t=e.y/this.a,this.sphere?(t/=this.C_y,r/=this.C_x*(this.m+Math.cos(t)),this.m?t=Lt((this.m*t+Math.sin(t))/this.n):1!==this.n&&(t=Lt(Math.sin(t)/this.n)),r=k(r+this.long0),t=ft(t)):(t=He(e.y/this.a,this.es,this.en),(n=Math.abs(t))<a?(n=Math.sin(t),r=k(this.long0+e.x*Math.sqrt(1-this.es*n*n)/(this.a*Math.cos(t)))):n-s<a&&(r=this.long0)),e.x=r,e.y=t,e},names:["Sinusoidal","sinu"]};const Dt={init:function(){},forward:function(e){for(var t=e.x,r=e.y,n=k(t-this.long0),i=r,o=Math.PI*Math.sin(r);;){var a=-(i+Math.sin(i)-o)/(1+Math.cos(i));if(i+=a,Math.abs(a)<s)break}i/=2,Math.PI/2-Math.abs(r)<s&&(n=0);var l=.900316316158*this.a*n*Math.cos(i)+this.x0,c=1.4142135623731*this.a*Math.sin(i)+this.y0;return e.x=l,e.y=c,e},inverse:function(e){var t,r;e.x-=this.x0,e.y-=this.y0,r=e.y/(1.4142135623731*this.a),Math.abs(r)>.999999999999&&(r=.999999999999),t=Math.asin(r);var n=k(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),r=(2*t+Math.sin(2*t))/Math.PI,Math.abs(r)>1&&(r=1);var i=Math.asin(r);return e.x=n,e.y=i,e},names:["Mollweide","moll"]};const Nt={init:function(){Math.abs(this.lat1+this.lat2)<s||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=ct(this.es),this.e1=ut(this.es),this.e2=pt(this.es),this.e3=ht(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=N(this.e,this.sinphi,this.cosphi),this.ml1=lt(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<s?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=N(this.e,this.sinphi,this.cosphi),this.ml2=lt(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=lt(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(e){var t,r=e.x,n=e.y;if(this.sphere)t=this.a*(this.g-n);else{var i=lt(this.e0,this.e1,this.e2,this.e3,n);t=this.a*(this.g-i)}var o=this.ns*k(r-this.long0),a=this.x0+t*Math.sin(o),s=this.y0+this.rh-t*Math.cos(o);return e.x=a,e.y=s,e},inverse:function(e){var t,r,n,i;e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns>=0?(r=Math.sqrt(e.x*e.x+e.y*e.y),t=1):(r=-Math.sqrt(e.x*e.x+e.y*e.y),t=-1);var o=0;return 0!==r&&(o=Math.atan2(t*e.x,t*e.y)),this.sphere?(i=k(this.long0+o/this.ns),n=ft(this.g-r/this.a),e.x=i,e.y=n,e):(n=gt(this.g-r/this.a,this.e0,this.e1,this.e2,this.e3),i=k(this.long0+o/this.ns),e.x=i,e.y=n,e)},names:["Equidistant_Conic","eqdc"]};const Zt={init:function(){this.R=this.a},forward:function(e){var t,r,n=e.x,i=e.y,o=k(n-this.long0);Math.abs(i)<=s&&(t=this.x0+this.R*o,r=this.y0);var l=Lt(2*Math.abs(i/Math.PI));(Math.abs(o)<=s||Math.abs(Math.abs(i)-a)<=s)&&(t=this.x0,r=i>=0?this.y0+Math.PI*this.R*Math.tan(.5*l):this.y0+Math.PI*this.R*-Math.tan(.5*l));var c=.5*Math.abs(Math.PI/o-o/Math.PI),u=c*c,p=Math.sin(l),h=Math.cos(l),d=h/(p+h-1),f=d*d,g=d*(2/p-1),y=g*g,m=Math.PI*this.R*(c*(d-y)+Math.sqrt(u*(d-y)*(d-y)-(y+u)*(f-y)))/(y+u);o<0&&(m=-m),t=this.x0+m;var v=u+d;return m=Math.PI*this.R*(g*v-c*Math.sqrt((y+u)*(u+1)-v*v))/(y+u),r=i>=0?this.y0+m:this.y0-m,e.x=t,e.y=r,e},inverse:function(e){var t,r,n,i,o,a,l,c,u,p,h,d;return e.x-=this.x0,e.y-=this.y0,h=Math.PI*this.R,o=(n=e.x/h)*n+(i=e.y/h)*i,h=3*(i*i/(c=-2*(a=-Math.abs(i)*(1+o))+1+2*i*i+o*o)+(2*(l=a-2*i*i+n*n)*l*l/c/c/c-9*a*l/c/c)/27)/(u=(a-l*l/3/c)/c)/(p=2*Math.sqrt(-u/3)),Math.abs(h)>1&&(h=h>=0?1:-1),d=Math.acos(h)/3,r=e.y>=0?(-p*Math.cos(d+Math.PI/3)-l/3/c)*Math.PI:-(-p*Math.cos(d+Math.PI/3)-l/3/c)*Math.PI,t=Math.abs(n)<s?this.long0:k(this.long0+Math.PI*(o-1+Math.sqrt(1+2*(n*n-i*i)+o*o))/2/n),e.x=t,e.y=r,e},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]};const kt={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(e){var t,r,n,i,o,l,c,u,p,h,d,f,g,y,m,v,_,w,S,E,b,C,L=e.x,T=e.y,A=Math.sin(e.y),x=Math.cos(e.y),P=k(L-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=s?(e.x=this.x0+this.a*(a-T)*Math.sin(P),e.y=this.y0-this.a*(a-T)*Math.cos(P),e):Math.abs(this.sin_p12+1)<=s?(e.x=this.x0+this.a*(a+T)*Math.sin(P),e.y=this.y0+this.a*(a+T)*Math.cos(P),e):(w=this.sin_p12*A+this.cos_p12*x*Math.cos(P),_=(v=Math.acos(w))?v/Math.sin(v):1,e.x=this.x0+this.a*_*x*Math.sin(P),e.y=this.y0+this.a*_*(this.cos_p12*A-this.sin_p12*x*Math.cos(P)),e):(t=ct(this.es),r=ut(this.es),n=pt(this.es),i=ht(this.es),Math.abs(this.sin_p12-1)<=s?(o=this.a*lt(t,r,n,i,a),l=this.a*lt(t,r,n,i,T),e.x=this.x0+(o-l)*Math.sin(P),e.y=this.y0-(o-l)*Math.cos(P),e):Math.abs(this.sin_p12+1)<=s?(o=this.a*lt(t,r,n,i,a),l=this.a*lt(t,r,n,i,T),e.x=this.x0+(o+l)*Math.sin(P),e.y=this.y0+(o+l)*Math.cos(P),e):(c=A/x,u=dt(this.a,this.e,this.sin_p12),p=dt(this.a,this.e,A),h=Math.atan((1-this.es)*c+this.es*u*this.sin_p12/(p*x)),S=0===(d=Math.atan2(Math.sin(P),this.cos_p12*Math.tan(h)-this.sin_p12*Math.cos(P)))?Math.asin(this.cos_p12*Math.sin(h)-this.sin_p12*Math.cos(h)):Math.abs(Math.abs(d)-Math.PI)<=s?-Math.asin(this.cos_p12*Math.sin(h)-this.sin_p12*Math.cos(h)):Math.asin(Math.sin(P)*Math.cos(h)/Math.sin(d)),f=this.e*this.sin_p12/Math.sqrt(1-this.es),v=u*S*(1-(E=S*S)*(m=(g=this.e*this.cos_p12*Math.cos(d)/Math.sqrt(1-this.es))*g)*(1-m)/6+(b=E*S)/8*(y=f*g)*(1-2*m)+(C=b*S)/120*(m*(4-7*m)-3*f*f*(1-7*m))-C*S/48*y),e.x=this.x0+v*Math.sin(d),e.y=this.y0+v*Math.cos(d),e))},inverse:function(e){var t,r,n,i,o,l,c,u,p,h,d,f,g,y,m,v,_,w,S,E,b,C,L;if(e.x-=this.x0,e.y-=this.y0,this.sphere){if((t=Math.sqrt(e.x*e.x+e.y*e.y))>2*a*this.a)return;return r=t/this.a,n=Math.sin(r),i=Math.cos(r),o=this.long0,Math.abs(t)<=s?l=this.lat0:(l=Lt(i*this.sin_p12+e.y*n*this.cos_p12/t),c=Math.abs(this.lat0)-a,o=Math.abs(c)<=s?this.lat0>=0?k(this.long0+Math.atan2(e.x,-e.y)):k(this.long0-Math.atan2(-e.x,e.y)):k(this.long0+Math.atan2(e.x*n,t*this.cos_p12*i-e.y*this.sin_p12*n))),e.x=o,e.y=l,e}return u=ct(this.es),p=ut(this.es),h=pt(this.es),d=ht(this.es),Math.abs(this.sin_p12-1)<=s?(l=gt(((f=this.a*lt(u,p,h,d,a))-(t=Math.sqrt(e.x*e.x+e.y*e.y)))/this.a,u,p,h,d),o=k(this.long0+Math.atan2(e.x,-1*e.y)),e.x=o,e.y=l,e):Math.abs(this.sin_p12+1)<=s?(f=this.a*lt(u,p,h,d,a),l=gt(((t=Math.sqrt(e.x*e.x+e.y*e.y))-f)/this.a,u,p,h,d),o=k(this.long0+Math.atan2(e.x,e.y)),e.x=o,e.y=l,e):(t=Math.sqrt(e.x*e.x+e.y*e.y),m=Math.atan2(e.x,e.y),g=dt(this.a,this.e,this.sin_p12),v=Math.cos(m),w=-(_=this.e*this.cos_p12*v)*_/(1-this.es),S=3*this.es*(1-w)*this.sin_p12*this.cos_p12*v/(1-this.es),C=1-w*(b=(E=t/g)-w*(1+w)*Math.pow(E,3)/6-S*(1+3*w)*Math.pow(E,4)/24)*b/2-E*b*b*b/6,y=Math.asin(this.sin_p12*Math.cos(b)+this.cos_p12*Math.sin(b)*v),o=k(this.long0+Math.asin(Math.sin(m)*Math.sin(b)/Math.cos(y))),L=Math.sin(y),l=Math.atan2((L-this.es*C*this.sin_p12)*Math.tan(y),L*(1-this.es)),e.x=o,e.y=l,e)},names:["Azimuthal_Equidistant","aeqd"]};const Ft={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(e){var t,r,n,i,o,a,l,c=e.x,u=e.y;return n=k(c-this.long0),t=Math.sin(u),r=Math.cos(u),i=Math.cos(n),1,((o=this.sin_p14*t+this.cos_p14*r*i)>0||Math.abs(o)<=s)&&(a=1*this.a*r*Math.sin(n),l=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*r*i)),e.x=a,e.y=l,e},inverse:function(e){var t,r,n,i,o,l,c;return e.x-=this.x0,e.y-=this.y0,r=Lt((t=Math.sqrt(e.x*e.x+e.y*e.y))/this.a),n=Math.sin(r),i=Math.cos(r),l=this.long0,Math.abs(t)<=s?(c=this.lat0,e.x=l,e.y=c,e):(c=Lt(i*this.sin_p14+e.y*n*this.cos_p14/t),o=Math.abs(this.lat0)-a,Math.abs(o)<=s?(l=this.lat0>=0?k(this.long0+Math.atan2(e.x,-e.y)):k(this.long0-Math.atan2(-e.x,e.y)),e.x=l,e.y=c,e):(l=k(this.long0+Math.atan2(e.x*n,t*this.cos_p14*i-e.y*this.sin_p14*n)),e.x=l,e.y=c,e))},names:["ortho"]};var Ut=1,Bt=2,Gt=3,jt=4,Wt=5,Ht=6,qt=1,Vt=2,zt=3,Yt=4;function Kt(e,t,r,n){var i;return e<s?(n.value=qt,i=0):(i=Math.atan2(t,r),Math.abs(i)<=u?n.value=qt:i>u&&i<=a+u?(n.value=Vt,i-=a):i>a+u||i<=-(a+u)?(n.value=zt,i=i>=0?i-h:i+h):(n.value=Yt,i+=a)),i}function Xt(e,t){var r=e+t;return r<-h?r+=p:r>+h&&(r-=p),r}const $t={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=a-u/2?this.face=Wt:this.lat0<=-(a-u/2)?this.face=Ht:Math.abs(this.long0)<=u?this.face=Ut:Math.abs(this.long0)<=a+u?this.face=this.long0>0?Bt:jt:this.face=Gt,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(e){var t,r,n,i,o,s,l={x:0,y:0},c={value:0};if(e.x-=this.long0,t=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(e.y)):e.y,r=e.x,this.face===Wt)i=a-t,r>=u&&r<=a+u?(c.value=qt,n=r-a):r>a+u||r<=-(a+u)?(c.value=Vt,n=r>0?r-h:r+h):r>-(a+u)&&r<=-u?(c.value=zt,n=r+a):(c.value=Yt,n=r);else if(this.face===Ht)i=a+t,r>=u&&r<=a+u?(c.value=qt,n=-r+a):r<u&&r>=-u?(c.value=Vt,n=-r):r<-u&&r>=-(a+u)?(c.value=zt,n=-r-a):(c.value=Yt,n=r>0?-r+h:-r-h);else{var p,d,f,g,y,m;this.face===Bt?r=Xt(r,+a):this.face===Gt?r=Xt(r,+h):this.face===jt&&(r=Xt(r,-a)),g=Math.sin(t),y=Math.cos(t),m=Math.sin(r),p=y*Math.cos(r),d=y*m,f=g,this.face===Ut?n=Kt(i=Math.acos(p),f,d,c):this.face===Bt?n=Kt(i=Math.acos(d),f,-p,c):this.face===Gt?n=Kt(i=Math.acos(-p),f,-d,c):this.face===jt?n=Kt(i=Math.acos(-d),f,p,c):(i=n=0,c.value=qt)}return s=Math.atan(12/h*(n+Math.acos(Math.sin(n)*Math.cos(u))-a)),o=Math.sqrt((1-Math.cos(i))/(Math.cos(s)*Math.cos(s))/(1-Math.cos(Math.atan(1/Math.cos(n))))),c.value===Vt?s+=a:c.value===zt?s+=h:c.value===Yt&&(s+=1.5*h),l.x=o*Math.cos(s),l.y=o*Math.sin(s),l.x=l.x*this.a+this.x0,l.y=l.y*this.a+this.y0,e.x=l.x,e.y=l.y,e},inverse:function(e){var t,r,n,i,o,s,l,c,u,p,d,f,g={lam:0,phi:0},y={value:0};if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,r=Math.atan(Math.sqrt(e.x*e.x+e.y*e.y)),t=Math.atan2(e.y,e.x),e.x>=0&&e.x>=Math.abs(e.y)?y.value=qt:e.y>=0&&e.y>=Math.abs(e.x)?(y.value=Vt,t-=a):e.x<0&&-e.x>=Math.abs(e.y)?(y.value=zt,t=t<0?t+h:t-h):(y.value=Yt,t+=a),u=h/12*Math.tan(t),o=Math.sin(u)/(Math.cos(u)-1/Math.sqrt(2)),s=Math.atan(o),(l=1-(n=Math.cos(t))*n*(i=Math.tan(r))*i*(1-Math.cos(Math.atan(1/Math.cos(s)))))<-1?l=-1:l>1&&(l=1),this.face===Wt)c=Math.acos(l),g.phi=a-c,y.value===qt?g.lam=s+a:y.value===Vt?g.lam=s<0?s+h:s-h:y.value===zt?g.lam=s-a:g.lam=s;else if(this.face===Ht)c=Math.acos(l),g.phi=c-a,y.value===qt?g.lam=-s+a:y.value===Vt?g.lam=-s:y.value===zt?g.lam=-s-a:g.lam=s<0?-s-h:-s+h;else{var m,v,_;u=(m=l)*m,v=(u+=(_=u>=1?0:Math.sqrt(1-u)*Math.sin(s))*_)>=1?0:Math.sqrt(1-u),y.value===Vt?(u=v,v=-_,_=u):y.value===zt?(v=-v,_=-_):y.value===Yt&&(u=v,v=_,_=-u),this.face===Bt?(u=m,m=-v,v=u):this.face===Gt?(m=-m,v=-v):this.face===jt&&(u=m,m=v,v=-u),g.phi=Math.acos(-_)-a,g.lam=Math.atan2(v,m),this.face===Bt?g.lam=Xt(g.lam,-a):this.face===Gt?g.lam=Xt(g.lam,-h):this.face===jt&&(g.lam=Xt(g.lam,+a))}return 0!==this.es&&(p=g.phi<0?1:0,d=Math.tan(g.phi),f=this.b/Math.sqrt(d*d+this.one_minus_f_squared),g.phi=Math.atan(Math.sqrt(this.a*this.a-f*f)/(this.one_minus_f*f)),p&&(g.phi=-g.phi)),g.lam+=this.long0,e.x=g.lam,e.y=g.phi,e},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]};var Jt=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Qt=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],er=.8487,tr=1.3523,rr=c/5,nr=18,ir=function(e,t){return e[0]+t*(e[1]+t*(e[2]+t*e[3]))};const or={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(e){var t=k(e.x-this.long0),r=Math.abs(e.y),n=Math.floor(r*rr);n<0?n=0:n>=nr&&(n=17);var i={x:ir(Jt[n],r=c*(r-.08726646259971647*n))*t,y:ir(Qt[n],r)};return e.y<0&&(i.y=-i.y),i.x=i.x*this.a*er+this.x0,i.y=i.y*this.a*tr+this.y0,i},inverse:function(e){var t={x:(e.x-this.x0)/(this.a*er),y:Math.abs(e.y-this.y0)/(this.a*tr)};if(t.y>=1)t.x/=Jt[18][0],t.y=e.y<0?-a:a;else{var r=Math.floor(t.y*nr);for(r<0?r=0:r>=nr&&(r=17);;)if(Qt[r][0]>t.y)--r;else{if(!(Qt[r+1][0]<=t.y))break;++r}var n=Qt[r],i=5*(t.y-n[0])/(Qt[r+1][0]-n[0]);i=function(e,t,r,n){for(var i=t;n;--n){var o=e(i);if(i-=o,Math.abs(o)<r)break}return i}((function(e){return(ir(n,e)-t.y)/function(e,t){return e[1]+t*(2*e[2]+3*t*e[3])}(n,e)}),i,s,100),t.x/=ir(Jt[r],i),t.y=(5*r+i)*l,e.y<0&&(t.y=-t.y)}return t.x=k(t.x+this.long0),t},names:["Robinson","robin"]};const ar={init:function(){this.name="geocent"},forward:function(e){return oe(e,this.es,this.a)},inverse:function(e){return ae(e,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]};var sr=0,lr=1,cr=2,ur=3,pr={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};const hr={init:function(){if(Object.keys(pr).forEach(function(e){if(void 0===this[e])this[e]=pr[e].def;else{if(pr[e].num&&isNaN(this[e]))throw new Error("Invalid parameter value, must be numeric "+e+" = "+this[e]);pr[e].num&&(this[e]=parseFloat(this[e]))}pr[e].degrees&&(this[e]=this[e]*l)}.bind(this)),Math.abs(Math.abs(this.lat0)-a)<s?this.mode=this.lat0<0?lr:sr:Math.abs(this.lat0)<s?this.mode=cr:(this.mode=ur,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var e=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(e),this.sw=Math.sin(e)},forward:function(e){e.x-=this.long0;var t,r,n,i,o=Math.sin(e.y),a=Math.cos(e.y),s=Math.cos(e.x);switch(this.mode){case ur:r=this.sinph0*o+this.cosph0*a*s;break;case cr:r=a*s;break;case lr:r=-o;break;case sr:r=o}switch(t=(r=this.pn1/(this.p-r))*a*Math.sin(e.x),this.mode){case ur:r*=this.cosph0*o-this.sinph0*a*s;break;case cr:r*=o;break;case sr:r*=-a*s;break;case lr:r*=a*s}return i=1/((n=r*this.cg+t*this.sg)*this.sw*this.h1+this.cw),t=(t*this.cg-r*this.sg)*this.cw*i,r=n*i,e.x=t*this.a,e.y=r*this.a,e},inverse:function(e){e.x/=this.a,e.y/=this.a;var t,r,n,i={x:e.x,y:e.y};n=1/(this.pn1-e.y*this.sw),t=this.pn1*e.x*n,r=this.pn1*e.y*this.cw*n,e.x=t*this.cg+r*this.sg,e.y=r*this.cg-t*this.sg;var o=ze(e.x,e.y);if(Math.abs(o)<s)i.x=0,i.y=e.y;else{var a,l;switch(l=1-o*o*this.pfact,l=(this.p-Math.sqrt(l))/(this.pn1/o+o/this.pn1),a=Math.sqrt(1-l*l),this.mode){case ur:i.y=Math.asin(a*this.sinph0+e.y*l*this.cosph0/o),e.y=(a-this.sinph0*Math.sin(i.y))*o,e.x*=l*this.cosph0;break;case cr:i.y=Math.asin(e.y*l/o),e.y=a*o,e.x*=l;break;case sr:i.y=Math.asin(a),e.y=-e.y;break;case lr:i.y=-Math.asin(a)}i.x=Math.atan2(e.x,e.y)}return e.x=i.x+this.long0,e.y=i.y,e},names:["Tilted_Perspective","tpers"]};const dr={init:function(){if(this.flip_axis="x"===this.sweep?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,0!==this.es){var e=1-this.es,t=1/e;this.radius_p=Math.sqrt(e),this.radius_p2=e,this.radius_p_inv2=t,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")},forward:function(e){var t,r,n,i,o=e.x,a=e.y;if(o-=this.long0,"ellipse"===this.shape){a=Math.atan(this.radius_p2*Math.tan(a));var s=this.radius_p/ze(this.radius_p*Math.cos(a),Math.sin(a));if(r=s*Math.cos(o)*Math.cos(a),n=s*Math.sin(o)*Math.cos(a),i=s*Math.sin(a),(this.radius_g-r)*r-n*n-i*i*this.radius_p_inv2<0)return e.x=Number.NaN,e.y=Number.NaN,e;t=this.radius_g-r,this.flip_axis?(e.x=this.radius_g_1*Math.atan(n/ze(i,t)),e.y=this.radius_g_1*Math.atan(i/t)):(e.x=this.radius_g_1*Math.atan(n/t),e.y=this.radius_g_1*Math.atan(i/ze(n,t)))}else"sphere"===this.shape&&(t=Math.cos(a),r=Math.cos(o)*t,n=Math.sin(o)*t,i=Math.sin(a),t=this.radius_g-r,this.flip_axis?(e.x=this.radius_g_1*Math.atan(n/ze(i,t)),e.y=this.radius_g_1*Math.atan(i/t)):(e.x=this.radius_g_1*Math.atan(n/t),e.y=this.radius_g_1*Math.atan(i/ze(n,t))));return e.x=e.x*this.a,e.y=e.y*this.a,e},inverse:function(e){var t,r,n,i,o=-1,a=0,s=0;if(e.x=e.x/this.a,e.y=e.y/this.a,"ellipse"===this.shape){this.flip_axis?(s=Math.tan(e.y/this.radius_g_1),a=Math.tan(e.x/this.radius_g_1)*ze(1,s)):(a=Math.tan(e.x/this.radius_g_1),s=Math.tan(e.y/this.radius_g_1)*ze(1,a));var l=s/this.radius_p;if(t=a*a+l*l+o*o,(n=(r=2*this.radius_g*o)*r-4*t*this.C)<0)return e.x=Number.NaN,e.y=Number.NaN,e;i=(-r-Math.sqrt(n))/(2*t),o=this.radius_g+i*o,a*=i,s*=i,e.x=Math.atan2(a,o),e.y=Math.atan(s*Math.cos(e.x)/o),e.y=Math.atan(this.radius_p_inv2*Math.tan(e.y))}else if("sphere"===this.shape){if(this.flip_axis?(s=Math.tan(e.y/this.radius_g_1),a=Math.tan(e.x/this.radius_g_1)*Math.sqrt(1+s*s)):(a=Math.tan(e.x/this.radius_g_1),s=Math.tan(e.y/this.radius_g_1)*Math.sqrt(1+a*a)),t=a*a+s*s+o*o,(n=(r=2*this.radius_g*o)*r-4*t*this.C)<0)return e.x=Number.NaN,e.y=Number.NaN,e;i=(-r-Math.sqrt(n))/(2*t),o=this.radius_g+i*o,a*=i,s*=i,e.x=Math.atan2(a,o),e.y=Math.atan(s*Math.cos(e.x)/o)}return e.x=e.x+this.long0,e},names:["Geostationary Satellite View","Geostationary_Satellite","geos"]};_e.defaultDatum="WGS84",_e.Proj=ie,_e.WGS84=new _e.Proj("WGS84"),_e.Point=Fe,_e.toPoint=de,_e.defs=O,_e.nadgrid=function(e,t){var r=new DataView(t),n=function(e){var t=e.getInt32(8,!1);if(11===t)return!1;11!==(t=e.getInt32(8,!0))&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian");return!0}(r),i=function(e,t){return{nFields:e.getInt32(8,t),nSubgridFields:e.getInt32(24,t),nSubgrids:e.getInt32(40,t),shiftType:Q(e,56,64).trim(),fromSemiMajorAxis:e.getFloat64(120,t),fromSemiMinorAxis:e.getFloat64(136,t),toSemiMajorAxis:e.getFloat64(152,t),toSemiMinorAxis:e.getFloat64(168,t)}}(r,n);i.nSubgrids>1&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored");var o=function(e,t,r){for(var n=176,i=[],o=0;o<t.nSubgrids;o++){var a=te(e,n,r),s=re(e,n,a,r),l=Math.round(1+(a.upperLongitude-a.lowerLongitude)/a.longitudeInterval),c=Math.round(1+(a.upperLatitude-a.lowerLatitude)/a.latitudeInterval);i.push({ll:[J(a.lowerLongitude),J(a.lowerLatitude)],del:[J(a.longitudeInterval),J(a.latitudeInterval)],lim:[l,c],count:a.gridNodeCount,cvs:ee(s)})}return i}(r,i,n),a={header:i,subgrids:o};return X[e]=a,a},_e.transform=ge,_e.mgrs=Ae,_e.version="__VERSION__",function(e){e.Proj.projections.add(qe),e.Proj.projections.add($e),e.Proj.projections.add(Je),e.Proj.projections.add(tt),e.Proj.projections.add(rt),e.Proj.projections.add(nt),e.Proj.projections.add(ot),e.Proj.projections.add(at),e.Proj.projections.add(st),e.Proj.projections.add(yt),e.Proj.projections.add(Ct),e.Proj.projections.add(Tt),e.Proj.projections.add(At),e.Proj.projections.add(xt),e.Proj.projections.add(Pt),e.Proj.projections.add(Ot),e.Proj.projections.add(It),e.Proj.projections.add(Rt),e.Proj.projections.add(Mt),e.Proj.projections.add(Dt),e.Proj.projections.add(Nt),e.Proj.projections.add(Zt),e.Proj.projections.add(kt),e.Proj.projections.add(Ft),e.Proj.projections.add($t),e.Proj.projections.add(or),e.Proj.projections.add(ar),e.Proj.projections.add(hr),e.Proj.projections.add(dr)}(_e);const fr=_e},6656:function(e){e.exports=function(){"use strict";function e(e,n,i,o,a){!function e(r,n,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,l=n-i+1,c=Math.log(s),u=.5*Math.exp(2*c/3),p=.5*Math.sqrt(c*u*(s-u)/s)*(l-s/2<0?-1:1);e(r,n,Math.max(i,Math.floor(n-l*u/s+p)),Math.min(o,Math.floor(n+(s-l)*u/s+p)),a)}var h=r[n],d=i,f=o;for(t(r,i,n),a(r[o],h)>0&&t(r,i,o);d<f;){for(t(r,d,f),d++,f--;a(r[d],h)<0;)d++;for(;a(r[f],h)>0;)f--}0===a(r[i],h)?t(r,i,f):t(r,++f,o),f<=n&&(i=f+1),n<=f&&(o=f-1)}}(e,n,i||0,o||e.length-1,a||r)}function t(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function r(e,t){return e<t?-1:e>t?1:0}var n=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function i(e,t,r){if(!r)return t.indexOf(e);for(var n=0;n<t.length;n++)if(r(e,t[n]))return n;return-1}function o(e,t){a(e,0,e.children.length,t,e)}function a(e,t,r,n,i){i||(i=f(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o=t;o<r;o++){var a=e.children[o];s(i,e.leaf?n(a):a)}return i}function s(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function u(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function p(e){return e.maxX-e.minX+(e.maxY-e.minY)}function h(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function d(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function f(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(t,r,n,i,o){for(var a=[r,n];a.length;)if(!((n=a.pop())-(r=a.pop())<=i)){var s=r+Math.ceil((n-r)/i/2)*i;e(t,s,r,n,o),a.push(r,s,s,n)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(e){var t=this.data,r=[];if(!d(e,t))return r;for(var n=this.toBBox,i=[];t;){for(var o=0;o<t.children.length;o++){var a=t.children[o],s=t.leaf?n(a):a;d(e,s)&&(t.leaf?r.push(a):h(e,s)?this._all(a,r):i.push(a))}t=i.pop()}return r},n.prototype.collides=function(e){var t=this.data;if(!d(e,t))return!1;for(var r=[];t;){for(var n=0;n<t.children.length;n++){var i=t.children[n],o=t.leaf?this.toBBox(i):i;if(d(e,o)){if(t.leaf||h(e,o))return!0;r.push(i)}}t=r.pop()}return!1},n.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var r=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var n=this.data;this.data=r,r=n}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},n.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},n.prototype.clear=function(){return this.data=f([]),this},n.prototype.remove=function(e,t){if(!e)return this;for(var r,n,o,a=this.data,s=this.toBBox(e),l=[],c=[];a||l.length;){if(a||(a=l.pop(),n=l[l.length-1],r=c.pop(),o=!0),a.leaf){var u=i(e,a.children,t);if(-1!==u)return a.children.splice(u,1),l.push(a),this._condense(l),this}o||a.leaf||!h(a,s)?n?(r++,a=n.children[r],o=!1):a=null:(l.push(a),c.push(r),r=0,n=a,a=a.children[0])}return this},n.prototype.toBBox=function(e){return e},n.prototype.compareMinX=function(e,t){return e.minX-t.minX},n.prototype.compareMinY=function(e,t){return e.minY-t.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(e){return this.data=e,this},n.prototype._all=function(e,t){for(var r=[];e;)e.leaf?t.push.apply(t,e.children):r.push.apply(r,e.children),e=r.pop();return t},n.prototype._build=function(e,t,r,n){var i,a=r-t+1,s=this._maxEntries;if(a<=s)return o(i=f(e.slice(t,r+1)),this.toBBox),i;n||(n=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,n-1))),(i=f([])).leaf=!1,i.height=n;var l=Math.ceil(a/s),c=l*Math.ceil(Math.sqrt(s));g(e,t,r,c,this.compareMinX);for(var u=t;u<=r;u+=c){var p=Math.min(u+c-1,r);g(e,u,p,l,this.compareMinY);for(var h=u;h<=p;h+=l){var d=Math.min(h+l-1,p);i.children.push(this._build(e,h,d,n-1))}}return o(i,this.toBBox),i},n.prototype._chooseSubtree=function(e,t,r,n){for(;n.push(t),!t.leaf&&n.length-1!==r;){for(var i=1/0,o=1/0,a=void 0,s=0;s<t.children.length;s++){var l=t.children[s],c=u(l),p=(h=e,d=l,(Math.max(d.maxX,h.maxX)-Math.min(d.minX,h.minX))*(Math.max(d.maxY,h.maxY)-Math.min(d.minY,h.minY))-c);p<o?(o=p,i=c<i?c:i,a=l):p===o&&c<i&&(i=c,a=l)}t=a||t.children[0]}var h,d;return t},n.prototype._insert=function(e,t,r){var n=r?e:this.toBBox(e),i=[],o=this._chooseSubtree(n,this.data,t,i);for(o.children.push(e),s(o,n);t>=0&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(n,i,t)},n.prototype._split=function(e,t){var r=e[t],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);var a=this._chooseSplitIndex(r,i,n),s=f(r.children.splice(a,r.children.length-a));s.height=r.height,s.leaf=r.leaf,o(r,this.toBBox),o(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(r,s)},n.prototype._splitRoot=function(e,t){this.data=f([e,t]),this.data.height=e.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(e,t,r){for(var n,i,o,s,l,c,p,h=1/0,d=1/0,f=t;f<=r-t;f++){var g=a(e,0,f,this.toBBox),y=a(e,f,r,this.toBBox),m=(i=g,o=y,s=void 0,l=void 0,c=void 0,p=void 0,s=Math.max(i.minX,o.minX),l=Math.max(i.minY,o.minY),c=Math.min(i.maxX,o.maxX),p=Math.min(i.maxY,o.maxY),Math.max(0,c-s)*Math.max(0,p-l)),v=u(g)+u(y);m<h?(h=m,n=f,d=v<d?v:d):m===h&&v<d&&(d=v,n=f)}return n||r-t},n.prototype._chooseSplitAxis=function(e,t,r){var n=e.leaf?this.compareMinX:l,i=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,r,n)<this._allDistMargin(e,t,r,i)&&e.children.sort(n)},n.prototype._allDistMargin=function(e,t,r,n){e.children.sort(n);for(var i=this.toBBox,o=a(e,0,t,i),l=a(e,r-t,r,i),c=p(o)+p(l),u=t;u<r-t;u++){var h=e.children[u];s(o,e.leaf?i(h):h),c+=p(o)}for(var d=r-t-1;d>=t;d--){var f=e.children[d];s(l,e.leaf?i(f):f),c+=p(l)}return c},n.prototype._adjustParentBBoxes=function(e,t,r){for(var n=r;n>=0;n--)s(t[n],e)},n.prototype._condense=function(e){for(var t=e.length-1,r=void 0;t>=0;t--)0===e[t].children.length?t>0?(r=e[t-1].children).splice(r.indexOf(e[t]),1):this.clear():o(e[t],this.toBBox)},n}()},3819:function(e,t,r){var n;!function(i,o){"use strict";var a="function",s="undefined",l="object",c="string",u="major",p="model",h="name",d="type",f="vendor",g="version",y="architecture",m="console",v="mobile",_="tablet",w="smarttv",S="wearable",E="embedded",b="Amazon",C="Apple",L="ASUS",T="BlackBerry",A="Firefox",x="Google",P="Huawei",O="LG",I="Microsoft",R="Motorola",M="Opera",D="Samsung",N="Sharp",Z="Sony",k="Xiaomi",F="Zebra",U="Facebook",B="Chromium OS",G="Mac OS",j=function(e){for(var t={},r=0;r<e.length;r++)t[e[r].toUpperCase()]=e[r];return t},W=function(e,t){return typeof e===c&&-1!==H(t).indexOf(H(e))},H=function(e){return e.toLowerCase()},q=function(e,t){if(typeof e===c)return e=e.replace(/^\s\s*/,""),typeof t===s?e:e.substring(0,350)},V=function(e,t){for(var r,n,i,s,c,u,p=0;p<t.length&&!c;){var h=t[p],d=t[p+1];for(r=n=0;r<h.length&&!c&&h[r];)if(c=h[r++].exec(e))for(i=0;i<d.length;i++)u=c[++n],typeof(s=d[i])===l&&s.length>0?2===s.length?typeof s[1]==a?this[s[0]]=s[1].call(this,u):this[s[0]]=s[1]:3===s.length?typeof s[1]!==a||s[1].exec&&s[1].test?this[s[0]]=u?u.replace(s[1],s[2]):o:this[s[0]]=u?s[1].call(this,u,s[2]):o:4===s.length&&(this[s[0]]=u?s[3].call(this,u.replace(s[1],s[2])):o):this[s]=u||o;p+=2}},z=function(e,t){for(var r in t)if(typeof t[r]===l&&t[r].length>0){for(var n=0;n<t[r].length;n++)if(W(t[r][n],e))return"?"===r?o:r}else if(W(t[r],e))return"?"===r?o:r;return e},Y={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},K={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[h,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[h,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[h,g],[/opios[\/ ]+([\w\.]+)/i],[g,[h,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[g,[h,M]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[h,g],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[h,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[g,[h,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[g,[h,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[h,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[h,"IE"]],[/yabrowser\/([\w\.]+)/i],[g,[h,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[h,/(.+)/,"$1 Secure Browser"],g],[/\bfocus\/([\w\.]+)/i],[g,[h,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[g,[h,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[h,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[h,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[h,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[h,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[g,[h,A]],[/\bqihu|(qi?ho?o?|360)browser/i],[[h,"360 Browser"]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[h,/(.+)/,"$1 Browser"],g],[/(comodo_dragon)\/([\w\.]+)/i],[[h,/_/g," "],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[h,g],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[h],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[h,U],g],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[h,g],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[h,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[h,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[h,"Chrome WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[h,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[h,g],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[g,[h,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[g,h],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[h,[g,z,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[h,g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[h,"Netscape"],g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[h,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[h,g],[/(cobalt)\/([\w\.]+)/i],[h,[g,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[y,"amd64"]],[/(ia32(?=;))/i],[[y,H]],[/((?:i[346]|x)86)[;\)]/i],[[y,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[y,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[y,"armhf"]],[/windows (ce|mobile); ppc;/i],[[y,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[y,/ower/,"",H]],[/(sun4\w)[;\)]/i],[[y,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[y,H]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[p,[f,D],[d,_]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[p,[f,D],[d,v]],[/\((ip(?:hone|od)[\w ]*);/i],[p,[f,C],[d,v]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[p,[f,C],[d,_]],[/(macintosh);/i],[p,[f,C]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[p,[f,N],[d,v]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[p,[f,P],[d,_]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[p,[f,P],[d,v]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[p,/_/g," "],[f,k],[d,v]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[p,/_/g," "],[f,k],[d,_]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[p,[f,"OPPO"],[d,v]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[p,[f,"Vivo"],[d,v]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[p,[f,"Realme"],[d,v]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[p,[f,R],[d,v]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[p,[f,R],[d,_]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[p,[f,O],[d,_]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[p,[f,O],[d,v]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[p,[f,"Lenovo"],[d,_]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[p,/_/g," "],[f,"Nokia"],[d,v]],[/(pixel c)\b/i],[p,[f,x],[d,_]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[p,[f,x],[d,v]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[p,[f,Z],[d,v]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[p,"Xperia Tablet"],[f,Z],[d,_]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[p,[f,"OnePlus"],[d,v]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[p,[f,b],[d,_]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[p,/(.+)/g,"Fire Phone $1"],[f,b],[d,v]],[/(playbook);[-\w\),; ]+(rim)/i],[p,f,[d,_]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[p,[f,T],[d,v]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[p,[f,L],[d,_]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[p,[f,L],[d,v]],[/(nexus 9)/i],[p,[f,"HTC"],[d,_]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[f,[p,/_/g," "],[d,v]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[p,[f,"Acer"],[d,_]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[p,[f,"Meizu"],[d,v]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[f,p,[d,v]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[f,p,[d,_]],[/(surface duo)/i],[p,[f,I],[d,_]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[p,[f,"Fairphone"],[d,v]],[/(u304aa)/i],[p,[f,"AT&T"],[d,v]],[/\bsie-(\w*)/i],[p,[f,"Siemens"],[d,v]],[/\b(rct\w+) b/i],[p,[f,"RCA"],[d,_]],[/\b(venue[\d ]{2,7}) b/i],[p,[f,"Dell"],[d,_]],[/\b(q(?:mv|ta)\w+) b/i],[p,[f,"Verizon"],[d,_]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[p,[f,"Barnes & Noble"],[d,_]],[/\b(tm\d{3}\w+) b/i],[p,[f,"NuVision"],[d,_]],[/\b(k88) b/i],[p,[f,"ZTE"],[d,_]],[/\b(nx\d{3}j) b/i],[p,[f,"ZTE"],[d,v]],[/\b(gen\d{3}) b.+49h/i],[p,[f,"Swiss"],[d,v]],[/\b(zur\d{3}) b/i],[p,[f,"Swiss"],[d,_]],[/\b((zeki)?tb.*\b) b/i],[p,[f,"Zeki"],[d,_]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[f,"Dragon Touch"],p,[d,_]],[/\b(ns-?\w{0,9}) b/i],[p,[f,"Insignia"],[d,_]],[/\b((nxa|next)-?\w{0,9}) b/i],[p,[f,"NextBook"],[d,_]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[f,"Voice"],p,[d,v]],[/\b(lvtel\-)?(v1[12]) b/i],[[f,"LvTel"],p,[d,v]],[/\b(ph-1) /i],[p,[f,"Essential"],[d,v]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[p,[f,"Envizen"],[d,_]],[/\b(trio[-\w\. ]+) b/i],[p,[f,"MachSpeed"],[d,_]],[/\btu_(1491) b/i],[p,[f,"Rotor"],[d,_]],[/(shield[\w ]+) b/i],[p,[f,"Nvidia"],[d,_]],[/(sprint) (\w+)/i],[f,p,[d,v]],[/(kin\.[onetw]{3})/i],[[p,/\./g," "],[f,I],[d,v]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[p,[f,F],[d,_]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[p,[f,F],[d,v]],[/smart-tv.+(samsung)/i],[f,[d,w]],[/hbbtv.+maple;(\d+)/i],[[p,/^/,"SmartTV"],[f,D],[d,w]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[f,O],[d,w]],[/(apple) ?tv/i],[f,[p,"Apple TV"],[d,w]],[/crkey/i],[[p,"Chromecast"],[f,x],[d,w]],[/droid.+aft(\w)( bui|\))/i],[p,[f,b],[d,w]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[p,[f,N],[d,w]],[/(bravia[\w ]+)( bui|\))/i],[p,[f,Z],[d,w]],[/(mitv-\w{5}) bui/i],[p,[f,k],[d,w]],[/Hbbtv.*(technisat) (.*);/i],[f,p,[d,w]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[f,q],[p,q],[d,w]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[d,w]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[f,p,[d,m]],[/droid.+; (shield) bui/i],[p,[f,"Nvidia"],[d,m]],[/(playstation [345portablevi]+)/i],[p,[f,Z],[d,m]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[p,[f,I],[d,m]],[/((pebble))app/i],[f,p,[d,S]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[p,[f,C],[d,S]],[/droid.+; (glass) \d/i],[p,[f,x],[d,S]],[/droid.+; (wt63?0{2,3})\)/i],[p,[f,F],[d,S]],[/(quest( 2| pro)?)/i],[p,[f,U],[d,S]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[f,[d,E]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[p,[d,v]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[p,[d,_]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[d,_]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[d,v]],[/(android[-\w\. ]{0,9});.+buil/i],[p,[f,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[h,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[h,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[h,g],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,h]],os:[[/microsoft (windows) (vista|xp)/i],[h,g],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[h,[g,z,Y]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[h,"Windows"],[g,z,Y]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[h,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[h,G],[g,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[g,h],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[h,g],[/\(bb(10);/i],[g,[h,T]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[g,[h,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[h,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[h,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[g,[h,"watchOS"]],[/crkey\/([\d\.]+)/i],[g,[h,"Chromecast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[h,B],g],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[h,g],[/(sunos) ?([\w\.\d]*)/i],[[h,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[h,g]]},X=function(e,t){if(typeof e===l&&(t=e,e=o),!(this instanceof X))return new X(e,t).getResult();var r=typeof i!==s&&i.navigator?i.navigator:o,n=e||(r&&r.userAgent?r.userAgent:""),u=r&&r.userAgentData?r.userAgentData:o,p=t?function(e,t){var r={};for(var n in e)t[n]&&t[n].length%2==0?r[n]=t[n].concat(e[n]):r[n]=e[n];return r}(K,t):K;return this.getBrowser=function(){var e,t={};return t.name=o,t.version=o,V.call(t,n,p.browser),t.major=typeof(e=t.version)===c?e.replace(/[^\d\.]/g,"").split(".")[0]:o,r&&r.brave&&typeof r.brave.isBrave==a&&(t.name="Brave"),t},this.getCPU=function(){var e={};return e.architecture=o,V.call(e,n,p.cpu),e},this.getDevice=function(){var e={};return e.vendor=o,e.model=o,e.type=o,V.call(e,n,p.device),!e.type&&u&&u.mobile&&(e.type=v),"Macintosh"==e.model&&r&&typeof r.standalone!==s&&r.maxTouchPoints&&r.maxTouchPoints>2&&(e.model="iPad",e.type=_),e},this.getEngine=function(){var e={};return e.name=o,e.version=o,V.call(e,n,p.engine),e},this.getOS=function(){var e={};return e.name=o,e.version=o,V.call(e,n,p.os),!e.name&&u&&"Unknown"!=u.platform&&(e.name=u.platform.replace(/chrome os/i,B).replace(/macos/i,G)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(e){return n=typeof e===c&&e.length>350?q(e,350):e,this},this.setUA(n),this};X.VERSION="0.7.34",X.BROWSER=j([h,g,u]),X.CPU=j([y]),X.DEVICE=j([p,f,d,m,v,w,_,S,E]),X.ENGINE=X.OS=j([h,g]),typeof t!==s?(e.exports&&(t=e.exports=X),t.UAParser=X):r.amdO?(n=function(){return X}.call(t,r,t,e))===o||(e.exports=n):typeof i!==s&&(i.UAParser=X);var $=typeof i!==s&&(i.jQuery||i.Zepto);if($&&!$.ua){var J=new X;$.ua=J.getResult(),$.ua.get=function(){return J.getUA()},$.ua.set=function(e){J.setUA(e);var t=J.getResult();for(var r in t)$.ua[r]=t[r]}}}("object"==typeof window?window:this)},7680:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={compiler:[8,">= 4.3.0"],main:function(e,t,r,n,i){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<button type="button" class="tc-ctl-3d-btn tc-float-btn" title="'+e.escapeExpression(o(r,"i18n").call(null!=t?t:e.nullContext||{},"threed.tip",{name:"i18n",hash:{},data:i,loc:{start:{line:1,column:64},end:{line:1,column:85}}}))+'"></button>'},useData:!0}}},__webpack_module_cache__={},leafPrototypes,getProto,inProgress,dataWebpackPrefix;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(r.exports,r,r.exports,__webpack_require__),r.exports}__webpack_require__.m=__webpack_modules__,__webpack_require__.amdO={},__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},getProto=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var r=Object.create(null);__webpack_require__.r(r);var n={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var i=2&t&&e;"object"==typeof i&&!~leafPrototypes.indexOf(i);i=getProto(i))Object.getOwnPropertyNames(i).forEach((t=>n[t]=()=>e[t]));return n.default=()=>e,__webpack_require__.d(r,n),r},__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.f={},__webpack_require__.e=e=>Promise.all(Object.keys(__webpack_require__.f).reduce(((t,r)=>(__webpack_require__.f[r](e,t),t)),[])),__webpack_require__.u=e=>"chunks/"+e+".sitna.js",__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),inProgress={},dataWebpackPrefix="SITNA:",__webpack_require__.l=(e,t,r,n)=>{if(inProgress[e])inProgress[e].push(t);else{var i,o;if(void 0!==r)for(var a=document.getElementsByTagName("script"),s=0;s<a.length;s++){var l=a[s];if(l.getAttribute("src")==e||l.getAttribute("data-webpack")==dataWebpackPrefix+r){i=l;break}}i||(o=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,__webpack_require__.nc&&i.setAttribute("nonce",__webpack_require__.nc),i.setAttribute("data-webpack",dataWebpackPrefix+r),i.src=e),inProgress[e]=[t];var c=(t,r)=>{i.onerror=i.onload=null,clearTimeout(u);var n=inProgress[e];if(delete inProgress[e],i.parentNode&&i.parentNode.removeChild(i),n&&n.forEach((e=>e(r))),t)return t(r)},u=setTimeout(c.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=c.bind(null,i.onerror),i.onload=c.bind(null,i.onload),o&&document.head.appendChild(i)}},__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;__webpack_require__.g.importScripts&&(e=__webpack_require__.g.location+"");var t=__webpack_require__.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpack_require__.p=e})(),(()=>{var e={179:0};__webpack_require__.f.j=(t,r)=>{var n=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==n)if(n)r.push(n[2]);else{var i=new Promise(((r,i)=>n=e[t]=[r,i]));r.push(n[2]=i);var o=__webpack_require__.p+__webpack_require__.u(t),a=new Error;__webpack_require__.l(o,(r=>{if(__webpack_require__.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var i=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;a.message="Loading chunk "+t+" failed.\n("+i+": "+o+")",a.name="ChunkLoadError",a.type=i,a.request=o,n[1](a)}}),"chunk-"+t,t)}};var t=(t,r)=>{var n,i,[o,a,s]=r,l=0;if(o.some((t=>0!==e[t]))){for(n in a)__webpack_require__.o(a,n)&&(__webpack_require__.m[n]=a[n]);if(s)s(__webpack_require__)}for(t&&t(r);l<o.length;l++)i=o[l],__webpack_require__.o(e,i)&&e[i]&&e[i][0](),e[i]=0},r=self.webpackChunkSITNA=self.webpackChunkSITNA||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var __webpack_exports__={};(()=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Cfg:()=>i.Z,Consts:()=>r.Z,Map:()=>c,feature:()=>k,layer:()=>Z,tool:()=>F});var e=__webpack_require__(688),t=__webpack_require__(268),r=__webpack_require__(330),n=__webpack_require__(3089),i=__webpack_require__(9967),o=__webpack_require__(4571),a=__webpack_require__(9085),s=__webpack_require__(5394);e.Z.Map=o.Z,e.Z.filter=s.Z,e.Z.control=e.Z.control||{},e.Z.control.Search=a.default;const l=function(n,o){const a=this;if(i.Z.controls.search&&(i.Z.controls.search.allowedSearchTypes=t.Z.extend(i.Z.controls.search.allowedSearchTypes,{urban:{},street:{},number:{},cadastral:{}}),o&&o.controls&&o.controls.search)){const e=Object.keys(o.controls.search),n=t.Z.extend(o.controls.search,{allowedSearchTypes:{}});e.forEach((function(e){if("boolean"==typeof o.controls.search[e]||t.Z.isPlainObject(o.controls.search[e])){if(o.controls.search[e])switch(!0){case"placeName"===e:n.allowedSearchTypes[r.Z.searchType.PLACENAME]=t.Z.isPlainObject(o.controls.search[e])?o.controls.search[e]:{};break;case"placeNameMunicipality"===e:n.allowedSearchTypes[r.Z.searchType.PLACENAMEMUNICIPALITY]=t.Z.isPlainObject(o.controls.search[e])?o.controls.search[e]:{};break;case"postalAddress"===e:n.allowedSearchTypes[r.Z.searchType.NUMBER]=t.Z.isPlainObject(o.controls.search[e])?o.controls.search[e]:{};break;case"cadastralParcel"===e:n.allowedSearchTypes[r.Z.searchType.CADASTRAL]=t.Z.isPlainObject(o.controls.search[e])?o.controls.search[e]:{};break;case"town"===e:n.allowedSearchTypes[r.Z.searchType.URBAN]=t.Z.isPlainObject(o.controls.search[e])?o.controls.search[e]:{};break;default:n.allowedSearchTypes[e]=t.Z.isPlainObject(o.controls.search[e])?o.controls.search[e]:{}}delete n[e]}})),o.controls.search=n}i.Z.controls.threeD&&i.Z.views&&i.Z.views.threeD&&(i.Z.views.threeD.controls=["search","toc","attribution","basemapSelector","workLayerManager","layerCatalog","featureInfo","fullScreen","loadingIndicator","navBarHome","navBar","overviewMap","legend","threeD","coordinates","geolocation","resultsPanel","share"]),e.Z.Map.call(a,n,o),a.search=null,a.loaded((async function(){const t=a._searchControl=new e.Z.control.Search;if(t.register(a),!a.activeControl){const e=a.getControlsByClass("TC.control.FeatureInfo")[0];e&&e.activate()}a._searchLayer=await t.getLayer()}))};e.Z.inherit(l,e.Z.Map),function(){const n=l.prototype;n.getQueryableData=async function(n,i){const o=this,a=o._searchControl.availableSearchTypes[n];if(a.queryableData)i&&i(a.queryableData);else{const n={request:"GetFeature",service:"WFS",typename:a.featurePrefix+":"+a.featureType,version:a.version,propertyname:(a.dataIdProperty instanceof Array?a.dataIdProperty:[a.dataIdProperty]).concat(a.outputProperties instanceof Array?a.outputProperties:[a.outputProperties]).join(","),outputformat:r.Z.format.JSON},d=a.url+"?"+t.Z.getParamString(n),f=(await e.Z.ajax({url:d,responseType:r.Z.mimeType.JSON})).data;if(a.queryableData=[],f.features){const e=f.features;for(var s=0,l=e.length;s<l;s++){const r=e[s],n={id:[]};Array.isArray(a.dataIdProperty)||(a.dataIdProperty=[a.dataIdProperty]);for(var c=0,u=a.dataIdProperty.length;c<u;c++){const e=a.dataIdProperty[c];Object.prototype.hasOwnProperty.call(r.properties,e)&&n.id.push(r.properties[e])}n.id=a.idPropertiesIdentifier?n.id.join(a.idPropertiesIdentifier):n.id.join(""),n.label=[],Array.isArray(a.outputProperties)||(a.outputProperties=[a.outputProperties]);for(var p=0,h=a.outputProperties.length;p<h;p++){const e=a.outputProperties[p];Object.prototype.hasOwnProperty.call(r.properties,e)&&n.label.push(r.properties[e])}const i=(Array.isArray(n.label)?n.label.join(""):n.label).trim().length>0;n.label=a.outputFormatLabel?t.Z.formatString(a.outputFormatLabel,...n.label):n.label.join("-"),i&&a.queryableData.push(n)}}a.queryableData=a.queryableData.sort((function(e,t){const r=o._searchControl;return a.idPropertiesIdentifier&&-1===e.id.indexOf(a.idPropertiesIdentifier)?r.removePunctuation(e.label)<r.removePunctuation(t.label)?-1:r.removePunctuation(e.label)>r.removePunctuation(t.label)?1:0:r.removePunctuation(e.label.split(" ")[0])<r.removePunctuation(t.label.split(" ")[0])?-1:r.removePunctuation(e.label.split(" ")[0])>r.removePunctuation(t.label.split(" ")[0])?1:0})),a.queryableData=a.queryableData.filter((function(e,t,r){return t<1||e.id!==r[t-1].id&&e.label!==r[t-1].label})),i&&i(a.queryableData)}return a.queryableData},n.getMunicipalities=function(e){return this.getQueryableData(r.Z.mapSearchType.MUNICIPALITY,e)},n.getUrbanAreas=function(e){return this.getQueryableData(r.Z.mapSearchType.URBAN,e)},n.getCommonwealths=function(e){return this.getQueryableData(r.Z.mapSearchType.COMMONWEALTH,e)},n.getCouncils=function(e){return this.getQueryableData(r.Z.mapSearchType.COUNCIL,e)},n.searchCommonwealth=function(e,t){return this.searchTyped(r.Z.mapSearchType.COMMONWEALTH,e,t)},n.searchCouncil=function(e,t){return this.searchTyped(r.Z.mapSearchType.COUNCIL,e,t)},n.searchUrbanArea=function(e,t){return this.searchTyped(r.Z.mapSearchType.URBAN,e,t)},n.searchMunicipality=function(e,t){return this.searchTyped(r.Z.mapSearchType.MUNICIPALITY,e,t)},n.searchTyped=function(n,i,o){const a=this,s=e.Z.getUID(),l=a._searchControl,c=l.availableSearchTypes[n];return Array.isArray(i)&&c.goToIdFormat&&(i=t.Z.formatString(c.goToIdFormat,...i)),l.data=l.data||[],l.data.push({dataLayer:c.featureType,dataRole:n,id:i,label:"",text:""}),a.removeSearch(),l.availableSearchTypes[n]&&!l.getSearchTypeByRole(n)&&(l.availableSearchTypes[n].goTo||(l.availableSearchTypes[n].goTo=function(t){return{params:{type:r.Z.layerType.WFS,url:this.url,version:this.version,geometryName:this.geometryName,featurePrefix:this.featurePrefix,featureType:this.featureType,properties:function(t){let r=[];c.idPropertiesIdentifier&&(t=t.split(c.idPropertiesIdentifier)),Array.isArray(t)||(t=[t]);for(var n=0,i=c.dataIdProperty.length;n<i;n++)r.push(new e.Z.filter.equalTo(c.dataIdProperty[n],t[n].trim()));return r=r.length>1?new e.Z.filter.and(r):r[0],r}(t),outputFormat:this.outputFormat,styles:this.styles}}}.bind(c)),l.addAllowedSearchType(n,l.availableSearchTypes[n],l)),new Promise((function(e,t){a.one(r.Z.event.SEARCHQUERYEMPTY,(function(t){a.toast(l.EMPTY_RESULTS_LABEL,{type:r.Z.msgType.INFO,duration:5e3}),o&&o(null),e(null)})),a.one(r.Z.event.FEATURESADD,(function(t){t.layer===a._searchLayer&&t.layer.features&&t.layer.features.length>0&&a.zoomToFeatures(t.layer.features),a.search={layer:t.layer,type:n};const r=t.layer.id!==s?t.layer.id:s;o&&o(r),e(r)})),l.goToResult(i,n)}))},n.searchFeature=function(t,n,i,o){const a=this,s=e.Z.getUID();let l=a._searchControl.featurePrefix;if(a.removeSearch(),t=(t||"").trim(),n=(n||"").trim(),i=(i||"").trim(),0!==t.length&&0!==n.length&&0!==i.length){t.indexOf(":")>-1&&(l=t.split(":")[0],t=t.split(":")[1]);const c=function(t){if(Array.isArray(t)){const n=t.map((function(t){return Object.prototype.hasOwnProperty.call(t,"type")?!0==(t.type===r.Z.comparison.EQUAL_TO)?new e.Z.filter.equalTo(t.name,t.value):void 0:new e.Z.filter.equalTo(t.name,t.value)}));return n.length>1?e.Z.filter.and.apply(null,n):n[0]}},u={id:s,type:r.Z.layerType.WFS,url:a._searchControl.url,version:a._searchControl.version,stealth:!0,geometryName:"the_geom",featurePrefix:l,featureType:t,maxFeatures:1,properties:c([{name:n,value:i,type:r.Z.comparison.EQUAL_TO}]),outputFormat:r.Z.format.JSON};let p;return a.addLayer(u).then((function(e){p=e,a.search={layer:e,type:r.Z.mapSearchType.GENERIC}})),a.on(r.Z.event.FEATURESADD,(function(e){const t=e.layer;if(t===p&&t.features&&t.features.length>0){for(var r=0,n=t.features.length;r<n;r++)t.features[r].showsPopup!=a._searchControl.queryableFeatures&&(t.features[r].showsPopup=a._searchControl.queryableFeatures);a.zoomToFeatures(t.features)}})),new Promise((function(e,t){a.on(r.Z.event.LAYERUPDATE,(function(t){const n=t.layer,i=t.newData;n===p&&i&&i.features&&0===i.features.length&&a.toast(a._searchControl.EMPTY_RESULTS_LABEL,{type:r.Z.msgType.INFO,duration:5e3});const l=n===p&&i&&i.features&&0===i.features.length?null:s;o&&o(l),e(l)}))}))}a.toast(a._searchControl.EMPTY_RESULTS_LABEL,{type:r.Z.msgType.INFO,duration:5e3}),o&&o(null)},n.removeSearch=function(e){const t=this;if(t.search){const e=t._searchControl.availableSearchTypes[t.search.type];if(e&&Object.prototype.hasOwnProperty.call(e,"goTo")){for(var r=0,n=t.search.layer.features.length;r<n;r++)t.search.layer.removeFeature(t.search.layer.features[r]);t.search=null}else t.removeLayer(t.search.layer).then((function(){t.search=null}))}e&&e()}}();const c=l;var u=__webpack_require__(6204),p=__webpack_require__(3048),h=__webpack_require__(8033),d=__webpack_require__(6382),f=__webpack_require__(1848),g=__webpack_require__(8683),y=__webpack_require__(1872),m=__webpack_require__(9529),v=__webpack_require__(5265),_=__webpack_require__(9180),w=__webpack_require__(52),S=__webpack_require__(4115),E=__webpack_require__(8197),b=(__webpack_require__(1446),__webpack_require__(4676),__webpack_require__(3418)),C=__webpack_require__(2641),L=(__webpack_require__(9988),__webpack_require__(4109),__webpack_require__(6314));function T(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function A(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}function x(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,O(e,t,"get"))}function P(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,O(e,t,"set"),r),r}function O(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}const I="sitna-tab";var R=new WeakMap,M=new WeakSet;class D extends L.Z{constructor(){var e,t;super(),T(e=this,t=M),t.add(e),function(e,t,r){T(e,t),t.set(e,r)}(this,R,{writable:!0,value:void 0});const n=this;P(n,R,document.createTextNode("")),n.shadowRoot.appendChild(x(n,R)),n.addEventListener(r.Z.event.CLICK,(function(e){n.onClick()}),{passive:!0})}connectedCallback(){const e=this;e.text=e.text,e.toggleAttribute("selected",e.selected),A(e,M,N).call(e)}static get observedAttributes(){return["text","selected","disabled","deselectable"]}attributeChangedCallback(e,t,r){if(t===r)return;const n=this;"selected"===e&&A(n,M,N).call(n)}get elementName(){return I}get text(){return this.getAttribute("text")||""}set text(e){const t=this;t.shadowRoot.removeChild(x(t,R)),P(t,R,document.createTextNode(e)),t.shadowRoot.appendChild(x(t,R)),e?t.setAttribute("text",e):t.removeAttribute("text")}get group(){return this.getAttribute("group")}get target(){const e=this.getAttribute("for");return e?document.getElementById(e):null}get selected(){return this.hasAttribute("selected")}set selected(e){this.toggleAttribute("selected",!!e)}get disabled(){return this.hasAttribute("disabled")}set disabled(e){this.toggleAttribute("disabled",!!e)}get deselectable(){return this.hasAttribute("deselectable")}set deselectable(e){this.toggleAttribute("deselectable",!!e)}get siblings(){const e=this;return Array.from(document.querySelectorAll(`${e.elementName}[group="${e.group}"]`)).filter((t=>t!==e))}onClick(){const e=this;if(!e.disabled){const r=!e.deselectable||!e.selected;e.toggleAttribute("selected",r),t.Z.isFunction(e.callback)&&e.callback()}}}function N(){const e=this,t=e.siblings,n=t.concat(e);e.selected&&t.forEach((e=>{e.removeAttribute("selected")}));const i=n.some((e=>e.selected));n.forEach((e=>{e.toggleAttribute("no-selection",!i);const t=e.target;t&&t.classList.toggle(r.Z.classes.HIDDEN,!e.selected)}))}customElements.get(I)||(L.Z.preloadStyle(I),customElements.define(I,D));
/**
 * @overview API SITNA: API JavaScript para la visualizacin de datos georreferenciados en aplicaciones web.
 * @version 4.1.0
 * @copyright 2019 Gobierno de Navarra
 * @license BSD-2-Clause
 * @author Fernando Lacunza <flacunza@itracasa.es>
 */
e.Z.isDebug=!1;const Z={};Z.Layer=w.Z,Z.Raster=S.Z,Z.Vector=E.Z;const k={};k.Feature=u.Z,k.Point=p.Z,k.MultiPoint=h.Z,k.Marker=d.Z,k.MultiMarker=f.Z,k.Polyline=g.Z,k.MultiPolyline=y.Z,k.Polygon=m.Z,k.MultiPolygon=v.Z,k.Circle=_.Z;const F=e.Z.tool||{};e.Z.feature=k,e.Z.layer=Z,e.Z.tool=F,e.Z.Util=t.Z,e.Z.Consts=r.Z,e.Z.i18n=n.Z,e.Z.Cfg=i.Z,e.Z.Map=o.Z,e.Z.wrap=b.Z,globalThis.TC=e.Z,e.Z.version="4.1.0 [20/7/2023, 8:11:46]",e.Z.loadCSS(e.Z.apiLocation+"css/sitna.css"),e.Z.loadProjDef({crs:"EPSG:25830",name:"ETRS89 / UTM zone 30N",def:"+proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs"}),e.Z.loadProjDef({crs:"EPSG:4258",name:"ETRS89",def:"+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs +axis=neu"}),e.Z.loadProjDef({crs:"EPSG:3040",name:"ETRS89 / UTM zone 28N (N-E)",def:"+proj=utm +zone=28 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"}),e.Z.loadProjDef({crs:"EPSG:3041",name:"ETRS89 / UTM zone 29N (N-E)",def:"+proj=utm +zone=29 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"}),e.Z.loadProjDef({crs:"EPSG:3042",name:"ETRS89 / UTM zone 30N (N-E)",def:"+proj=utm +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"}),e.Z.loadProjDef({crs:"EPSG:3043",name:"ETRS89 / UTM zone 31N (N-E)",def:"+proj=utm +zone=31 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"}),e.Z.loadProjDef({crs:"EPSG:4230",name:"ED50",def:"+proj=longlat +ellps=intl +towgs84=-87,-98,-121,0,0,0,0 +no_defs +axis=neu"}),e.Z.loadProjDef({crs:"EPSG:25828",name:"ETRS89 / UTM zone 28N",def:"+proj=utm +zone=28 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"}),e.Z.loadProjDef({crs:"EPSG:25829",name:"ETRS89 / UTM zone 29N",def:"+proj=utm +zone=29 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"}),e.Z.loadProjDef({crs:"EPSG:25831",name:"ETRS89 / UTM zone 31N",def:"+proj=utm +zone=31 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"}),document.addEventListener("DOMContentLoaded",(function(){var t,n,i="Unknown library";if(window.ol&&(i="OpenLayers "+ol.VERSION),e.Z.version=e.Z.version+" ("+i+"; @ "+e.Z.apiLocation+")",e.Z.browser=e.Z.Util.getBrowser(),fetch(e.Z.apiLocation+"config/browser-versions.json").then((e=>e.ok?e.json():Promise.resolve([]))).then((t=>{e.Z._isSupported=!0,e.Z.Cfg.acceptedBrowserVersions=t;const n=t.find((t=>t.name.toLowerCase()===e.Z.browser.name.toLowerCase()));n&&n.expired?e.Z.Cfg.loggingErrorsEnabled=!1:(n&&!isNaN(n.version)&&e.Z.browser.version<n.version&&(e.Z._isSupported=!1),e.Z.Cfg.oldBrowserAlert&&!e.Z._isSupported&&(e.Z.Cfg.loggingErrorsEnabled=!1,setTimeout((()=>{const t=e.Z.Map.get(document.querySelector("."+r.Z.classes.MAP));e.Z.i18n.loadResources(!e.Z.i18n[t.options.locale],e.Z.apiLocation+"TC/resources/",t.options.locale).then((function(){e.Z.error(e.Z.Util.getLocaleString(t.options.locale,"outdatedBrowser"),r.Z.msgErrorMode.TOAST)}))}),500)))})),/ip(ad|hone|od)/i.test(navigator.userAgent)&&(r.Z.event.CLICK="touchstart"),e.Z.Cfg.loggingErrorsEnabled){C.JL.setOptions({defaultAjaxUrl:r.Z.url.ERROR_LOGGER.includes("//localhost")?"":r.Z.url.ERROR_LOGGER});const i=(n=0,function(i){if(!(t=t||e.Z.Map.get(document.querySelector("."+r.Z.classes.MAP))))return!1;var o,a,s,l="",c=-1,u=-1;if("unhandledrejection"===i.type?(o=i.reason?i.reason instanceof XMLDocument?i.reason.firstElementChild.outerHTML:i.reason.message:"",s=!i.reason||!i.reason.stack||i.reason.stack.indexOf(e.Z.apiLocation)>=0,a=i.reason):(o=i.message,l=i.filename,c=i.lineno,u=i.colno,a=i.error,s=l.indexOf(e.Z.apiLocation)>=0),(e.Z.Cfg.notifyApplicationErrors||s)&&n<e.Z.Cfg.maxErrorCount&&e.Z.Cfg.loggingErrorsEnabled){const i=t.getPreviousMapState(),h=function(t){var p=s?r.Z.text.API_ERROR:r.Z.text.APP_ERROR;(0,C.JL)("onerrorLogger").fatalException({msg:p,errorMsg:o,url:l,lineNumber:c,column:u,appUrl:t,apiVersion:e.Z.version,prevState:i,userAgent:navigator.userAgent},a),n++};let d=location.href;const f=t.exportControlStates()||[];if(f.length>0){var p=location.href;const e=p.indexOf("#");e>0&&(p=p.substring(0,e)),t.getMapState({extraStates:{ctl:f}}).then((e=>{d=p.concat("#",e),h(d)}))}else h(d);e.Z.isDebug||e.Z.i18n.loadResources(!e.Z.i18n[t.options.locale],e.Z.apiLocation+"TC/resources/",t.options.locale).then((function(){e.Z.error(e.Z.Util.getLocaleString(t.options.locale,"genericError")+(t.options.contactEmail||"webmaster@itracasa.es"),{type:r.Z.msgType.ERROR})}))}return!1});window.addEventListener("error",i,!1),window.addEventListener("unhandledrejection",i,!1)}})),i.Z.layout=e.Z.apiLocation+"layout/responsive"})(),SITNA=__webpack_exports__})();
//# sourceMappingURL=maps/sitna.js.map